!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.UploadFiles=t():e.UploadFiles=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t),r.d(t,"upload",(function(){return f}));var n=r(1);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t,r,n,a,i,o){try{var c=e[i](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,a)}function s(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){c(i,n,a,o,s,"next",e)}function s(e){c(i,n,a,o,s,"throw",e)}o(void 0)}))}}function u(e,t){return new Promise((function(r){try{$.ajax({type:"post",url:e,data:t,contentType:!1,dataType: 'json',cache:!1,processData:!1,success:function(e){r(e)},error:function error(res) {console.warn('upload fail',res);let responseText=res.responseJSON;if(responseText){if(responseText.url&&responseText.status==='success'){console.warn('upload fail3', responseText.url,responseText.status); r(responseText);}else{r({errcode:'5001',description: '服务端异常，请稍后再试！'});}} else{r({errcode:'5000', description:'服务端异常，请稍后再试！'});}}})}catch(e){console.error("upload error",e),r({errcode:"5002",description:"服务端异常，请稍后再试！"})}}))}function l(){var e=(new Date).getTime();return"xxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)}))}function f(e,t){return p.apply(this,arguments)}function p(){return(p=s(regeneratorRuntime.mark((function e(t,r){var a,o,c,s,f,p,g,d,h,m,v,b,w,y,x,O,j,R,I,k,D,P,S,F,L,M,C,U,W,z,H,T,E,A,_,B,X,Y,N,Q,$=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=$.length>2&&void 0!==$[2]?$[2]:{},o=a.maxFileSize,c=a.fileQuality,s=a.fileLimitWidth,f=a.fileLimitHeight,p=a.fileLimitPixel,g=a.fileLimitSize,d=a.uploadData,h=void 0===d?{}:d,m=a.fieldName,v=void 0===m?"file":m,b=a.stepUploadStart,w=void 0===b?function(e){return e}:b,y=a.stepUploadFinish,x=void 0===y?function(e){return e}:y,O=a.uploadStart,j=void 0===O?function(e){return e}:O,R=a.uploadFinish,I=void 0===R?function(e){return e}:R,k=a.accept,D=void 0===k?"":k,P={fileLimitSize:g},c&&(P.fileQuality=c),s&&(P.fileLimitWidth=s),f&&(P.fileLimitHeight=f),p&&(P.fileLimitPixel=p),g&&(P.fileLimitSize=g),S=[],F=0;case 10:if(!(F<r.length)){e.next=26;break}if(L=r[F],M="k"+l(),""!==D){e.next=17;break}S.push({file:L,uid:M}),e.next=23;break;case 17:if(!D.test(L.name)){e.next=21;break}S.push({file:L,uid:M}),e.next=23;break;case 21:return e.next=23,x({errcode:"40002",description:"不支持的发票类型",file:L,localUrl:"",uid:M});case 23:F++,e.next=10;break;case 26:if(!(S.length>0)){e.next=35;break}return e.prev=27,e.next=30,j(S);case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(27),console.warn("uploadStart 回调异常",e.t0);case 35:C=0;case 36:if(!(C<S.length)){e.next=73;break}if(U=S[C].file,W=S[C].uid,z=U.size/1024/1024,!(o&&z>o)){e.next=45;break}return e.next=43,x({errcode:"30002",description:"文件大小超出限制("+o+"M)，请检查!",file:U,localUrl:"",uid:W});case 43:e.next=70;break;case 45:return e.next=47,Object(n.compressImgFile)(U,P);case 47:if("0000"===(H=e.sent).errcode){e.next=53;break}return e.next=51,x(i(i({},H),{},{file:U,localUrl:H.localUrl||"",uid:W}));case 51:e.next=70;break;case 53:return T=H.file,E=H.localUrl,A={},e.next=58,w({file:U,uid:W});case 58:for((_=e.sent)&&"0000"===_.errcode&&(A=_.data||{}),B=i(i({},h),A),X=Object.keys(B),(Y=new FormData).append(v,T),N=0;N<X.length;N++)Y.append(X[N],B[X[N]]);return e.next=67,u(t,Y);case 67:return Q=e.sent,e.next=70,x(i(i({},Q),{},{file:U,localUrl:E,uid:W}));case 70:C++,e.next=36;break;case 73:return e.next=75,I();case 75:case"end":return e.stop()}}),e,null,[[27,32]])})))).apply(this,arguments)}},function(e,t,r){var n=r(2),a=r(3).default,i=r(4).compressImgFile;e.exports={adjustSize:n.adjustSize,loadImage:n.loadImage,base64ToFile:n.base64ToFile,normalize:n.normalize,getRotateRect:n.getRotateRect,cuteImage:n.cuteImage,markImage:n.markImage,sortByRegion:n.sortByRegion,OperateCanvas:a,compressImgFile:i}},function(e,t,r){"use strict";function n(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t,r,n,a,i,o){try{var c=e[i](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,a)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){s(i,n,a,o,c,"next",e)}function c(e){s(i,n,a,o,c,"throw",e)}o(void 0)}))}}function l(e,t,r,n){var a=parseFloat(r/e),i=parseFloat(n/t),o=parseFloat(e/t);return(e>r||t>n)&&(a<i?(e=r,t=Math.floor(e/o)):e=(t=n)*o),{width:e,height:t,rate:o}}function f(e){return new Promise((function(t){var r=new Image;r.onload=u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({errcode:"0000",data:{imgObj:r,width:r.width,height:r.height}});case 1:case"end":return e.stop()}}),e)}))),r.onerror=function(){t({errcode:"2000",description:"加载图像失败"})},r.src=e}))}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t=t||"temp_"+ +new Date+"_"+Math.random().toString().replace(/0\./,"")+".jpg";for(var r=e.split(","),n=r[0].match(/:(.*?);/)[1],a=n.split("/")[1],i=atob(r[1]),o=i.length,c=new Uint8Array(o);o--;)c[o]=i.charCodeAt(o);if(t=t.split(".")[0],window.File&&"function"==typeof window.File){var s=new File([c],"".concat(t,".").concat(a),{type:n});return{errcode:"0000",data:s}}try{var u=new Blob([c],{type:n});return u.lastModifiedDate=new Date,u.name="".concat(t,".").concat(a),{errcode:"0000",data:u}}catch(e){return console.error(e),{errcode:"90002",description:"base64转换为图片异常，请检查图片是否正常"}}}function g(e){return d.apply(this,arguments)}function d(){return(d=u(regeneratorRuntime.mark((function e(t){var r,n,a,i,o,c,s,u,g,d,h,m,v,b,w,y,x,O,j,R,I,k,D,P,S=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=S.length>1&&void 0!==S[1]?S[1]:{},n=URL.createObjectURL(t),e.next=4,f(n);case 4:if("0000"===(a=e.sent).errcode){e.next=7;break}return e.abrupt("return",a);case 7:if(i=r.maxWidth,o=void 0===i?1920:i,c=r.maxHeight,s=void 0===c?1080:c,u=r.quality,g=void 0===u?.95:u,d=r.toType,h=void 0===d?"base64":d,m=r.filename,v=void 0===m?"":m,b=a.data,w=b.width,y=b.height,x=b.imgObj,O=l(w,y,o,s),j=O.width,R=O.height,I="",e.prev=13,(k=document.createElement("canvas")).width=j,k.height=R,(D=k.getContext("2d")).clearRect(0,0,j,R),D.drawImage(x,0,0,j,R),I=k.toDataURL("image/jpeg",g),"base64"!==h){e.next=23;break}return e.abrupt("return",{errcode:"0000",data:{imageWidth:j,imageHeight:R,base64:I}});case 23:e.next=29;break;case 25:return e.prev=25,e.t0=e.catch(13),console.error(e.t0),e.abrupt("return",{errcode:"90001",description:"图片转换异常, 请检查图片是否正常"});case 29:return e.next=31,p(I,v);case 31:if("0000"===(P=e.sent).errcode){e.next=34;break}return e.abrupt("return",P);case 34:return e.abrupt("return",{errcode:"0000",data:{imageWidth:j,imageHeight:R,file:P.data}});case 35:case"end":return e.stop()}}),e,null,[[13,25]])})))).apply(this,arguments)}function h(e,t,r,n,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:10,o=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,s=parseFloat(Math.PI/180),u=Math.cos,l=Math.sin,f=parseFloat(t/r);e=Math.abs(e);var p=n-i,g=a-i,d=t,h=r;return 0===(e%=360)||180===e?(p=n,g=a):90===e||270===e?(p=a,g=n):e>0&&e<90||e>180&&e<270?(p=n*u(e*s)+a*l(e*s),g=a*u(e*s)+n*l(e*s)):(e>90&&e<180||e>270&&e<360)&&(p=a*u(e*s)+n*l(e*s),g=n*u(e*s)+a*l(e*s)),o&&c&&(t<o||r<c)&&(r<c?d=f*(h=c):h=(d=o)/f),(d>p||h>g)&&(d>h?d=f*(h=g):h=(d=p)/f,d>p?h=(d=p)/f:h>g&&(d=(h=g)*f)),{rw:d,rh:h}}function m(e,t){return v.apply(this,arguments)}function v(){return(v=u(regeneratorRuntime.mark((function e(t,r){var n,a,i,o,c,s,u,l,f,p,g,d,h,m,v,b,w,y,x,O,j,R,I,k,D,P,S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.pixel,a=void 0===n?"":n,i=r.region,o=void 0===i?"":i,c=r.maxWidth,s=void 0===c?1920:c,u=r.maxHeight,l=void 0===u?1080:u,""!==o){e.next=3;break}return e.abrupt("return",{errcode:"0000",data:t});case 3:if(f=t.width,p=t.height,o&&a?(v=a.split(","),b=parseInt(v[0]),w=parseInt(v[1]),(f>p&&b<w||f<p&&b>w)&&(b=parseInt(v[1]),w=parseInt(v[0])),y=parseFloat(f/b),x=parseFloat(p/w),O=o.replace(/[\[\]]/g,"").split(","),g=parseInt(O[0])*y,d=parseInt(O[1])*x,h=parseInt(O[2])*y-g,m=parseInt(O[3])*x-d):(g=0,d=0,h=f,m=p),j=parseFloat(h/m),R=h,I=m,"function"==typeof(k=document.createElement("canvas")).getContext){e.next=12;break}return e.abrupt("return",{errcode:"unsport",description:"浏览器不支持canvas"});case 12:return s=h>1920?1920:h,l=m>1080?1080:m,k.width=s,k.height=l,(D=k.getContext("2d")).clearRect(0,0,s,l),P=s,S=l,D.save(),D.translate(s/2,l/2),R>I?R=j*(I=S):I=(R=P)/j,R>P?I=(R=P)/j:I>S&&(R=(I=S)*j),D.translate(-R/2,-I/2),D.drawImage(t,g,d,h,m,0,0,R,I),D.restore(),e.abrupt("return",{errcode:"0000",description:"success",data:k});case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){if(e.length<=1)return e;for(var t=0;t<e.length-1;t++)for(var r=0;r<e.length-t-1;r++){var n=e[r],a=e[r+1],i=a.region||"";i=i.replace(/[[\]]/g,"").split(",");var c=parseInt(i[0]),s=parseInt(i[1]),u=n.region||"";u=u.replace(/[[\]]/g,"").split(",");var l=c-parseInt(u[0]),f=s-parseInt(u[1]),p=!1;if(l<0&&f<0?p=!0:l<0?p=!(f+l>0):f<0&&(p=!(f+l>50)),p){var g=o({},a);e[r+1]=o({},n),e[r]=g}}return e}function w(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=n(e),r=0;r<t.length;r++){var a=t[r],i=a.region||"";i=i.replace(/[[\]]/g,"").split(",");for(var o=parseInt(i[0]),c=parseInt(i[1]),s=parseInt(i[2]),u=parseInt(i[3]),l=0;l<t.length;l++)if(!(l<=r)){var f=t[l],p=f.region||"";p=p.replace(/[[\]]/g,"").split(",");var g=parseInt(p[0]),d=parseInt(p[1]),h=parseInt(p[2]),m=parseInt(p[3]);if(!(s<g||u<d)){var v=Math.abs((s>h?s:h)-(o<g?o:g)),b=Math.abs(s-o)+Math.abs(h-g),w=Math.abs((u>m?u:m)-(d<c?d:c)),y=Math.abs(u-c)+Math.abs(m-d),x=v-b,O=w-y;x>0||O>0||(O=Math.abs(O)/2+6,(x=Math.abs(x)/2+6)<O?(o<g?(i=[o,c,parseInt(i[2])-x,i[3]],p=[g+x,d,p[2],p[3]],s-=x,g+=x):(i=[o+x,c,i[2],i[3]],p=[g,d,parseInt(p[2])-x,p[3]],h-=x,o+=x),t[r].region=i.join(","),t[l].region=p.join(",")):(c<d?(i=[o,c,i[2],parseInt(i[3])-O],p=[g,d+O,p[2],p[3]],u-=O,d+=O):(i=[o,c+O,i[2],i[3]],p=[g,d,p[2],parseInt(p[3])-O],m-=O,c+=O),t[r].region=i.join(","),t[l].region=p.join(",")))}}}return t}function y(e){return x.apply(this,arguments)}function x(){return(x=u(regeneratorRuntime.mark((function e(t){var r,n,a,i,o,c,s,u,l,f,p,g,d,m,v=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=v.length>1&&void 0!==v[1]?v[1]:{},n=r.maxWidth,a=void 0===n?1920:n,i=r.maxHeight,o=void 0===i?1024:i,c=r.minWidth,s=r.minHeight,"function"==typeof(u=document.createElement("canvas")).getContext){e.next=5;break}return e.abrupt("return",{errcode:"unsport",description:"浏览器不支持canvas"});case 5:return l=t.width,f=t.height,p=h(0,l,f,a,o,0,c,s),g=p.rw,d=p.rh,u.width=g,u.height=d,(m=u.getContext("2d")).clearRect(0,0,u.width,u.height),m.save(),m.drawImage(t,0,0,l,f,0,0,g,d),m.restore(),e.abrupt("return",{errcode:"0000",description:"success",data:u});case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t){return j.apply(this,arguments)}function j(){return(j=u(regeneratorRuntime.mark((function e(t,r){var n,a,i,o,c,s,u,l,f,p,g,d,m,v,b,y,x,O,j,R,I,k,D,P,S,F,L,M,C,U,W,z,H,T,E,A,_,B,X,Y,N,Q,$,q,G,J,K,V,Z;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.targetWidth,a=r.targetHeight,i=r.areaInfo,o=void 0===i?[]:i,c=r.clearCanvas,s=r.orientation,u=void 0===s?0:s,l=r.maxWidth,f=void 0===l?1920:l,p=r.maxHeight,g=void 0===p?1024:p,d=12,m=16,v=2,b=1,y=t.width,x=t.height,0!==o.length){e.next=9;break}return e.abrupt("return",{errcode:"argsErr",description:"标记区域为空"});case 9:if(void 0===c&&(c=!0),(O=document.createElement("canvas"))&&"function"==typeof O.getContext){e.next=13;break}return e.abrupt("return",{errcode:"unsport",description:"浏览器不支持canvas"});case 13:for(j=Math.abs(u)%360,R=h(j,y,x,f,g,0),I=R.rw,k=R.rh,D=O.getContext("2d"),P=0,S=0,F=0,L=0,M=y,C=x,(U=o[0].pixel)&&(W=U.split(","),y>x&&M<C||y<x&&M>C?(M=parseInt(W[1]),C=parseInt(W[0])):(M=parseInt(W[0]),C=parseInt(W[1]))),90===j||270===j?(O.width=k,O.height=I):(O.width=I,O.height=k),D.save(),D.clearRect(0,0,O.width,O.height),D.translate(O.width/2,O.height/2),D.rotate(-u*Math.PI/180),z=parseFloat(I/M),H=parseFloat(k/C),D.translate(-I/2,-k/2),D.drawImage(t,0,0,y,x,0,0,I,k),T=h(0,O.width,O.height,n,a,0),b=O.height/T.rh,d*=b,m*=b,v*=b,E=w(o),A=0;A<E.length;A++)_=E[A].region.replace(/[[\]]/g,"").split(","),E[A].region||(_=[0,0,y,x]),B=E[A].markColor||"#487BFB",X=E[A].lineColor||B,P=parseInt(_[0])*z,S=parseInt(_[1])*H,F=parseInt(_[2])*z-P,L=parseInt(_[3])*H-S,Y=parseInt(_[2])*z,N=parseInt(_[3])*H,F+P>I&&(F=I-P),L+S>k&&(L=k-S),D.save(),D.strokeStyle=X,D.lineWidth=v,"function"==typeof D.setLineDash&&D.setLineDash([10*b,10*b]),D.moveTo(P+v,S+v),D.beginPath(),D.strokeRect(P+v,S+v,F-2*v,L-2*v),D.stroke(),D.closePath(),D.restore(),D.save(),D.strokeStyle=B,D.beginPath(),Q=P+d+v+2,$=S+d+v+2,-90===u||270===u?$=N-d-v-2:-180===u||180===u?(Q=Y-d-v-2,$=N-d-v-2):90!==u&&-270!==u||(Q=Y-d-v-2),D.moveTo(Q,$),D.arc(Q,$,d,0,2*Math.PI,!1),D.closePath(),D.stroke(),D.fillStyle=B,D.fill(),D.restore();for(q=0;q<E.length;q++)G=E[q].region.replace(/[[\]]/g,"").split(","),E[q].region||(G=[0,0,y,x]),P=parseInt(G[0])*z,S=parseInt(G[1])*H,J=parseInt(G[2])*z,K=parseInt(G[3])*H,V=P+d+v+2.3,Z=S+d+v+2.3,D.save(),D.font=m+"px Times New Roman",D.fillStyle="#fff",D.textAlign="center",D.textBaseline="middle",-90===u||270===u?Z=K-d-v-2.3:-180===u||180===u?(V=J-d-v-2.3,Z=K-d-v-2.3):90!==u&&-270!==u||(V=J-d-v-2.3),0!==u?(D.translate(V,Z),D.rotate(u*Math.PI/180),D.fillText(q+1,0,0)):D.fillText(q+1,V,Z),D.restore();return D.restore(),e.abrupt("return",{errcode:"0000",description:"success",data:O});case 45:case"end":return e.stop()}}),e)})))).apply(this,arguments)}r.r(t),r.d(t,"adjustSize",(function(){return l})),r.d(t,"loadImage",(function(){return f})),r.d(t,"base64ToFile",(function(){return p})),r.d(t,"normalize",(function(){return g})),r.d(t,"getRotateRect",(function(){return h})),r.d(t,"cuteImage",(function(){return m})),r.d(t,"sortByRegion",(function(){return b})),r.d(t,"adjuestRect",(function(){return w})),r.d(t,"showImage",(function(){return y})),r.d(t,"markImage",(function(){return O}))},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return s}));var n=r(2);function a(e,t,r,n,a,i,o){try{var c=e[i](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,a)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function c(e){a(o,n,i,c,s,"next",e)}function s(e){a(o,n,i,c,s,"throw",e)}c(void 0)}))}}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,"modifyArgs",(function(e){r.displayFlag=e.displayFlag||r.displayFlag,r.width=e.width||r.width,r.height=e.height||r.height,r.emptyFillStyle=e.emptyFillStyle||r.emptyFillStyle,r.imgCanvasObj=null})),c(this,"computeDrawSize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.imgWidth,a=e.imgHeight,i=e.maxWidth,o=e.maxHeight,c=e.rotateDeg,s=void 0===c?r.rotateDeg:c,u=e.displayFlag,l=void 0===u?"showImage":u,f=e.resetLargerRatio,p=e.reset,g=void 0!==e.largerRatio?e.largerRatio:r.largerRatio,d=parseFloat(t/a),h=1*i/2,m=1*o/2;if(s!==r.rotateDeg||f||p){var v="markImage"===l?0:s,b=Object(n.getRotateRect)(v,t,a,i,o,0,h,m);r.rw=b.rw,r.rh=b.rh,r.rotateDeg=p?r.initRotateDeg:s,r.largerRatio=parseFloat(r.rw/t),r.initLargerRatio||(r.initLargerRatio=r.largerRatio)}else g!==r.largerRatio&&(r.largerRatio=g),r.rh=a*g,r.rw=r.rh*d})),c(this,"showImage",function(){var e=i(regeneratorRuntime.mark((function e(t){var a,i,o,c,s,u,l,f,p,g,d,h,m,v,b,w,y=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=y.length>1&&void 0!==y[1]?y[1]:{},i=a.resetLargerRatio,o=a.reset,c=a.largerRatio,s=void 0===c?r.largerRatio:c,u=void 0!==a.rotateDeg?a.rotateDeg:r.rotateDeg,u%=360,l=r.ctx.canvas.width,f=r.ctx.canvas.height,p=r.getOffset(u,a.offsetX,a.offsetY),g=p.offsetX,d=p.offsetY,u===r.rotateDeg&&r.imgCanvasObj){e.next=14;break}return e.next=10,Object(n.showImage)(t);case 10:if("0000"===(h=e.sent).errcode){e.next=13;break}return e.abrupt("return",h);case 13:r.imgCanvasObj=h.data;case 14:return m=r.ctx,v=r.imgCanvasObj.width,b=r.imgCanvasObj.height,r.computeDrawSize({imgWidth:v,imgHeight:b,maxWidth:l,maxHeight:f,rotateDeg:u,largerRatio:s,resetLargerRatio:i,reset:o}),w=m.canvas,m.save(),m.fillStyle=r.emptyFillStyle,m.clearRect(0,0,w.width,w.height),m.translate(w.width/2,w.height/2),m.rotate(-u*Math.PI/180),m.translate(-r.rw/2+g,-r.rh/2+d),m.drawImage(r.imgCanvasObj,0,0,v,b,0,0,r.rw,r.rh),m.restore(),e.abrupt("return",{errcode:"0000",data:{rotateDeg:r.rotateDeg,largerRatio:r.largerRatio}});case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),c(this,"cuteImage",function(){var e=i(regeneratorRuntime.mark((function e(t){var a,i,o,c,s,u,l,f,p,g,d,h,m,v,b,w,y,x,O,j,R,I=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=I.length>1&&void 0!==I[1]?I[1]:{},i=a.resetLargerRatio,o=a.reset,c=a.largerRatio,s=void 0===c?r.largerRatio:c,u=a.areaInfo,l=void 0===u?[]:u,f=void 0!==a.rotateDeg?a.rotateDeg:r.rotateDeg,f%=360,p=l[0],g=p.pixel,d=p.region,h=r.ctx.canvas.width,m=r.ctx.canvas.height,f===r.rotateDeg&&r.imgCanvasObj){e.next=14;break}return e.next=10,Object(n.cuteImage)(t,{pixel:g,region:d});case 10:if("0000"===(v=e.sent).errcode){e.next=13;break}return e.abrupt("return",v);case 13:r.imgCanvasObj=v.data;case 14:return b=r.ctx,w=b.canvas,y=r.imgCanvasObj.width,x=r.imgCanvasObj.height,O=r.getOffset(f,a.offsetX,a.offsetY),j=O.offsetX,R=O.offsetY,r.computeDrawSize({imgWidth:y,imgHeight:x,maxWidth:h,maxHeight:m,rotateDeg:f,largerRatio:s,resetLargerRatio:i,reset:o}),b.save(),b.fillStyle=r.emptyFillStyle,b.clearRect(0,0,w.width,w.height),b.translate(w.width/2,w.height/2),b.rotate(-f*Math.PI/180),b.translate(-r.rw/2+j,-r.rh/2+R),b.drawImage(r.imgCanvasObj,0,0,y,x,0,0,r.rw,r.rh),b.restore(),e.abrupt("return",{errcode:"0000",data:{rotateDeg:r.rotateDeg,largerRatio:r.largerRatio}});case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),c(this,"markImage",function(){var e=i(regeneratorRuntime.mark((function e(t){var a,i,o,c,s,u,l,f,p,g,d,h,m,v,b,w,y=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=y.length>1&&void 0!==y[1]?y[1]:{},i=a.resetLargerRatio,o=a.reset,c=a.offsetX,s=a.offsetY,u=a.largerRatio,l=void 0===u?r.largerRatio:u,f=a.areaInfo,p=void 0===f?[]:f,g=void 0!==a.rotateDeg?a.rotateDeg:r.rotateDeg,g%=360,d=r.ctx,h=d.canvas.width,m=d.canvas.height,g===r.rotateDeg&&r.imgCanvasObj){e.next=14;break}return e.next=10,Object(n.markImage)(t,{targetHeight:m,targetWidth:h,areaInfo:p,orientation:g});case 10:if("0000"===(v=e.sent).errcode){e.next=13;break}return e.abrupt("return",v);case 13:r.imgCanvasObj=v.data;case 14:return b=r.imgCanvasObj.width,w=r.imgCanvasObj.height,r.computeDrawSize({displayFlag:"markImage",imgWidth:b,imgHeight:w,maxWidth:h,maxHeight:m,rotateDeg:g,largerRatio:l,resetLargerRatio:i,reset:o}),d.save(),d.fillStyle=r.emptyFillStyle,d.clearRect(0,0,d.canvas.width,d.canvas.height),d.translate(d.canvas.width/2-r.rw/2+c,d.canvas.height/2-r.rh/2+s),d.drawImage(r.imgCanvasObj,0,0,b,w,0,0,r.rw,r.rh),d.restore(),e.abrupt("return",{errcode:"0000",data:{rotateDeg:r.rotateDeg,largerRatio:r.largerRatio}});case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.ctx=t.ctx,this.width=t.width,this.height=t.height,this.initLargerRatio=t.largerRatio||1,this.initRotateDeg=t.rotateDeg||0,this.rotateDeg=this.initRotateDeg,this.largerRatio=this.initLargerRatio,this.emptyFillStyle=t.emptyFillStyle||"#D7DAE1"}var t,r,a;return t=e,(r=[{key:"getOffset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(90===e||-270===e){var n=r;r=t,t=-n}else if(-90===e||270===e){var a=r;r=-t,t=a}else 180!==e&&-180!==e||(r=-r,t=-t);return{offsetX:t,offsetY:r}}}])&&o(t.prototype,r),a&&o(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"tempCompressImgFile",(function(){return u})),r.d(t,"compressImgFile",(function(){return f}));var n=r(2);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t,r,n,a,i,o){try{var c=e[i](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,a)}function s(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){c(i,n,a,o,s,"next",e)}function s(e){c(i,n,a,o,s,"throw",e)}o(void 0)}))}}function u(e){return l.apply(this,arguments)}function l(){return(l=s(regeneratorRuntime.mark((function e(t){var r,a,o,c,s,u,l,f,p,g,d,h,m,v,b,w,y,x,O,j,R,I,k,D,P=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=P.length>1&&void 0!==P[1]?P[1]:{},a=r.localUrl||"",o=window.URL||window.webkitURL||window.mozURL||{},-1!==(t.type||"").indexOf("image/")&&"function"==typeof o.createObjectURL&&void 0!==r.fileLimitSize){e.next=6;break}return e.abrupt("return",{errcode:"0000",localUrl:a,file:t});case 6:if(c=r.fileLimitWidth,s=r.fileLimitHeight,!(u=r.fileLimitPixel)&&c&&s&&(u=c>s?s:c),u||(u=1500),l=r.fileQuality||.98,l=isNaN(parseFloat(l))?.98:parseFloat(l),""!==a){e.next=21;break}e.prev=13,a=o.createObjectURL(t),e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(13),window.console&&console.error(e.t0),e.abrupt("return",{errcode:"0000",localUrl:a,file:t});case 21:if(f=r.fileLimitSize,p=t.size,g=1024*parseFloat(f)*1024,!(p<=g)){e.next=26;break}return e.abrupt("return",{errcode:"0000",localUrl:a,file:t});case 26:return d=g/p,e.next=29,Object(n.loadImage)(a);case 29:if("0000"===(h=e.sent).errcode){e.next=32;break}return e.abrupt("return",{errcode:"0000",localUrl:a,file:t});case 32:if(m=h.data,v=m.width,b=m.height,w=m.imgObj,y={originWidth:v,originHeight:b,width:v,height:b,localUrl:a},!(v<u||b<u)){e.next=36;break}return e.abrupt("return",i(i({errcode:"0000"},y),{},{file:t}));case 36:x=v,O=b,j=v/b,v<=b?(O=Math.floor(b*d),x=Math.floor(O*j)):(x=Math.floor(v*d),O=Math.floor(x/j)),(x<u||O<u)&&(x<=O?(x=u,O=Math.floor(x/j)):(O=u,x=Math.floor(O*j))),y.width=x,y.height=O,e.prev=43,(I=document.createElement("canvas")).width=x,I.height=O,(k=I.getContext("2d")).clearRect(0,0,x,O),k.drawImage(w,0,0,x,O),R=I.toDataURL("image/jpeg",l),I=null,e.next=58;break;case 54:return e.prev=54,e.t1=e.catch(43),window.console&&console.error(e.t1),e.abrupt("return",i(i({errcode:"0000"},y),{},{file:t}));case 58:return e.next=60,Object(n.base64ToFile)(R,t.name);case 60:if(!("0000"!==(D=e.sent).errcode||D.data.size>t.size)){e.next=63;break}return e.abrupt("return",i(i({errcode:"0000"},y),{},{width:v,height:b,file:t}));case 63:return e.abrupt("return",i(i({errcode:"0000"},y),{},{file:D.data}));case 64:case"end":return e.stop()}}),e,null,[[13,17],[43,54]])})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=s(regeneratorRuntime.mark((function e(t){var r,n,a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},e.prev=1,e.next=4,u(t,r);case 4:return n=e.sent,e.abrupt("return",n);case 8:e.prev=8,e.t0=e.catch(1),window.console&&console.error(e.t0);case 11:return a=r.localUrl||"",e.abrupt("return",{errcode:"0000",localUrl:a,file:t});case 13:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}}])}));