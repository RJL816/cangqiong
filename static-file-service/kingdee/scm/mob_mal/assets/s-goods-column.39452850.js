var e=(e,s,t)=>new Promise(((l,a)=>{var o=e=>{try{u(t.next(e))}catch(s){a(s)}},d=e=>{try{u(t.throw(e))}catch(s){a(s)}},u=e=>e.done?l(e.value):Promise.resolve(e.value).then(o,d);u((t=t.apply(e,s)).next())}));import{d as s,e as t,f as l,A as a,N as o,M as d,r as u,D as r,w as n,a as c,b as i,g as f,u as m,s as p,l as g,t as k,m as _,ab as y,B as b,i as S,F as h,j as I,k as x,ac as w,R as C,O as A,q as v,p as F,S as N,c as z,aa as O,o as B,n as j,h as V,ad as $,C as Q,H as R}from"./index-45b322f7.js";import{_ as E}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as P}from"./uni-number-box.d645de38.js";import{_ as L}from"./su-popup.9d6f394f.js";import{a as M,u as U}from"./index.f474d5f6.js";const D=E({__name:"s-float-button",props:["icon"],setup:e=>(e,d)=>{const u=o;return s(),t(u,{class:"floatButton","hover-class":"pressDown"},{default:l((()=>[a(e.$slots,"default",{},void 0,!0)])),_:3})}},[["__scopeId","data-v-ad637dc7"]]),T=E({__name:"s-select-sku",props:{selectedSkuId:{type:String,default:""},platform:{type:String,default:""},show:{type:Boolean,default:!1}},emits:["change","addCart","buy","close","skuChanged"],setup(a,{emit:z}){const O=a,B=d({selectedSkuId:O.selectedSkuId,selectedSkuIdEBiz:"",goodsInfo:{},skuList:[],selectedSkuArray:[]}),j=u(1);function V(e){if(null==e)return;let s=e.toString(),t=s.indexOf(".");if(-1==t)return $(s);{s=parseFloat(parseFloat(e).toFixed(4).toString()).toString();let l=s.substring(0,t),a=s.slice(t);return $(l)+a}}function $(e){if(null==e||null==e)return e;let s=e.split("").reverse();for(let t=0;4*t+3<s.length;t++){let e=4*t+3;s.splice(e,0,",")}return s.reverse().join("")}function Q(e,s,t){if(null!=B.selectedSkuArray[e-1]&&B.selectedSkuArray[e-1].saleValue==s)B.selectedSkuArray[e-1]=null,G(e,[],!0);else{let l=t.find((e=>e.saleValue==s)).skuIds;B.selectedSkuArray[e-1]={saleValue:s,skuIds:l,dim:e},G(e,l)}}function R(){C({title:"商品数量不能小于起订量。",icon:"none",mask:!0})}function E(){C({title:"商品数量不能大于库存量。",icon:"none",mask:!0})}function U(){p.$store("homepage").mainConfigData.userInfo,null!=B.goodsInfo.stockState&&null!=B.goodsInfo.stockState&&""!=B.goodsInfo.stockState&&j.value>B.goodsInfo.stockState?A({title:"操作确认",content:"该商品库存不足，确定要加入购物车吗？",success:function(e){e.confirm&&z("addCart",D(),j.value,O.platform)}}):z("addCart",D(),j.value,O.platform)}function D(){return""==B.selectedSkuId?O.selectedSkuId:1==O.platform?B.selectedSkuId:B.selectedSkuIdEBiz}function T(){1==O.platform?z("close",B.selectedSkuId):z("close",B.selectedSkuIdEBiz)}function H(){return e(this,null,(function*(){let e=yield p.$api.goods.detail({productId:""==B.selectedSkuId?O.selectedSkuId:B.selectedSkuId,platform:O.platform});null!=e.data&&null!=e.data&&""!=e.data||(e=yield p.$api.goods.getDetailByNumber({productNumber:B.selectedSkuId,platform:O.platform})),0==e.errorCode?(B.goodsInfo=e.data,null==B.goodsInfo.minOrderQty||null==B.goodsInfo.minOrderQty||""==B.goodsInfo.minOrderQty?j.value=1:B.goodsInfo.minOrderQty>0&&(j.value=B.goodsInfo.minOrderQty),B.selectedSkuIdEBiz=B.goodsInfo.productId):B.goodsInfo=null}))}function q(){return e(this,null,(function*(){const e=yield p.$api.goods.skuInfo({productId:""==B.selectedSkuId?O.selectedSkuId:B.selectedSkuId,platform:O.platform});0==e.errorCode?(B.skuList=e.data,0==B.selectedSkuArray.length&&function(){for(let e of B.skuList)for(let s of e.malSaleAttrs)if(s.selected){Q(e.dim,s.saleValue,e.malSaleAttrs);break}}()):console.log("获取sku出错"+e.message)}))}function G(e,s,t=!1){if(!t)for(let l of B.selectedSkuArray){if(null==l||l.dim==e)continue;let t=!1;for(let e of l.skuIds)if(s.includes(e)){t=!0;break}t||(B.selectedSkuArray[l.dim-1]=null)}for(let l of B.skuList){let e=[];for(let s of B.selectedSkuArray){if(null==s||l.dim==s.dim)continue;if(0==e.length){e=s.skuIds;continue}let t=[];for(let l of s.skuIds)e.includes(l)&&t.push(l);e=t}for(let s of l.malSaleAttrs)for(let t of s.skuIds)if(s.enable=!1,e.includes(t)||0==e.length){s.enable=!0;break}}}return r((()=>e(this,null,(function*(){yield q(),H()})))),n((()=>B.selectedSkuArray),(()=>{if(0!=B.selectedSkuArray.length&&B.selectedSkuArray.length==B.skuList.length){let e=!0;for(let t of B.selectedSkuArray)if(null==t){e=!1;break}if(!e)return;let s=[];if(1==B.selectedSkuArray.length)s=B.selectedSkuArray[0].skuIds;else{s=B.selectedSkuArray[0].skuIds.filter((e=>B.selectedSkuArray[1].skuIds.includes(e)));for(let e=2;e<B.selectedSkuArray.length;e++)s=s.filter((s=>B.selectedSkuArray[e].skuIds.includes(s)))}B.selectedSkuId=s[0],H(),q()}}),{deep:!0}),(e,d)=>{const u=v,r=F,n=o,C=c(i("uni-number-box"),P),A=N,z=c(i("su-popup"),L);return s(),t(z,{show:a.show,round:"0",onClose:T},{default:l((()=>[f(r,{class:"ss-modal-box ss-flex-col"},{default:l((()=>[f(r,{class:"modal-header ss-flex ss-col-center"},{default:l((()=>[f(r,{class:"header-left"},{default:l((()=>[f(u,{class:"sku-image",src:m(p).$url.cdn(B.goodsInfo.productImgPath),mode:"aspectFill"},null,8,["src"])])),_:1}),f(r,{class:"header-right ss-flex-col ss-row-between ss-flex-1"},{default:l((()=>[f(r,{class:"goods-title ss-line-2"},{default:l((()=>[g(k(B.goodsInfo.productName),1)])),_:1}),f(r,{class:"market-name"},{default:l((()=>[g(k(B.goodsInfo.supplierName),1)])),_:1}),f(r,{class:"header-right-bottom ss-flex ss-col-center"},{default:l((()=>[f(r,{class:"ss-flex"},{default:l((()=>[B.goodsInfo.taxPrice>0?(s(),t(r,{key:0,class:"price-text"},{default:l((()=>[g(k(V(B.goodsInfo.taxPrice)),1)])),_:1})):_("",!0)])),_:1}),B.goodsInfo.minOrderQty?(s(),t(r,{key:0,class:"moq-text"},{default:l((()=>[g(k(m(y)(B.goodsInfo.minOrderQty)),1)])),_:1})):_("",!0)])),_:1})])),_:1}),f(r,{class:"close-icon"},{default:l((()=>[f(m(M),{size:"20",onClick:T})])),_:1})])),_:1}),f(r,{class:"modal-content ss-flex-1"},{default:l((()=>[f(A,{"scroll-y":"true",class:"modal-content-scroll",onTouchmove:d[1]||(d[1]=b((()=>{}),["stop"]))},{default:l((()=>[f(r,null,{default:l((()=>[(s(!0),S(h,null,I(B.skuList,(e=>(s(),t(r,{class:"sku-item ss-m-b-20"},{default:l((()=>[f(r,{class:"label-text ss-m-b-20"},{default:l((()=>[g(k(e.saleName),1)])),_:2},1024),f(r,{class:"ss-flex ss-col-center ss-flex-wrap"},{default:l((()=>[(s(!0),S(h,null,I(e.malSaleAttrs,(a=>(s(),t(n,{class:x(["ss-reset-button spec-btn",[{"selected-btn":null!=B.selectedSkuArray[e.dim-1]&&B.selectedSkuArray[e.dim-1].saleValue==a.saleValue},{"disabled-btn":0==a.enable}]]),disabled:0==a.enable,onClick:s=>Q(e.dim,a.saleValue,e.malSaleAttrs)},{default:l((()=>[g(k(a.saleValue),1)])),_:2},1032,["class","disabled","onClick"])))),256))])),_:2},1024)])),_:2},1024)))),256))])),_:1}),f(r,{class:"buy-num-box ss-flex ss-col-center ss-row-between"},{default:l((()=>[f(r,{class:"label-text"},{default:l((()=>[g("数量")])),_:1}),f(r,{class:"ss-flex"},{default:l((()=>[B.goodsInfo.stockState?(s(),t(r,{key:0,class:"ss-m-r-16 stock"},{default:l((()=>[g(k(m(w)("exact",B.goodsInfo.stockState)),1)])),_:1})):_("",!0),f(C,{modelValue:j.value,"onUpdate:modelValue":d[0]||(d[0]=e=>j.value=e),min:Number(B.goodsInfo.minOrderQty),max:Number.MAX_SAFE_INTEGER,step:1,background:"#FFFFFF",onCanNotMinus:R,onCanNotPlus:E},null,8,["modelValue","min","max"])])),_:1})])),_:1})])),_:1})])),_:1}),f(r,{class:"modal-footer"},{default:l((()=>[f(r,{class:"buy-box ss-col-center ss-row-center"},{default:l((()=>[f(n,{class:"confirmBtn",type:"primary",onClick:U},{default:l((()=>[g("确定")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])}}},[["__scopeId","data-v-274b9db4"]]),H=E({__name:"s-goods-column",props:{goodsFields:{type:[Array,Object],default:()=>({title:{show:!0},pur_method:{show:!0},shop_name:{show:!0},price:{show:!0},sales:{show:!0}})},data:{type:Object,default:{}},size:{type:String,default:"sl"},background:{type:String,default:""},topRadius:{type:Number,default:0},bottomRadius:{type:Number,default:0},titleWidth:{type:Number,default:0},titleColor:{type:String,default:"#333"},priceColor:{type:String,default:""},originPriceColor:{type:String,default:"#C4C4C4"},priceUnit:{type:String,default:"￥"},subTitleColor:{type:String,default:"#999999"},subTitleBackground:{type:String,default:""},buttonShow:{type:Boolean,default:!0}},emits:["click","getHeight","onAddCartClicked"],setup(e,{emit:a}){const o=e;d({});const u=z((()=>({background:o.background,"border-top-left-radius":o.topRadius+"px","border-top-right-radius":o.topRadius+"px","border-bottom-left-radius":o.bottomRadius+"px","border-bottom-right-radius":o.bottomRadius+"px"}))),r=z((()=>{var e;let s=[];return(null==(e=o.goodsFields.sales)?void 0:e.show)&&s.push(O(o.data.sales_show_type,o.data.sales)),s.join(" ")})),n=()=>{a("click")};function c(e){if(null==e)return;let s=e.toString(),t=s.indexOf(".");if(-1==t)return i(s);{s=parseFloat(parseFloat(e).toFixed(4).toString()).toString();let l=s.substring(0,t),a=s.slice(t);return i(l)+a}}function i(e){if(null==e||null==e)return e;let s=e.split("").reverse();for(let t=0;4*t+3<s.length;t++){let e=4*t+3;s.splice(e,0,",")}return s.reverse().join("")}const{proxy:y}=R(),b=`sheep_${Math.ceil(1e6*Math.random()).toString(36)}`;function S(){a("onAddCartClicked",o.data.goodsid,o.data.source)}return B((()=>{j((()=>{!function(){if("md"===o.size){const e=$().in(y);e.select(`#${b}`).fields({size:!0,scrollOffset:!0}),e.exec((e=>{let s=0;const t=e[0];s=o.data.image_wh?t.width/o.data.image_wh.w*o.data.image_wh.h+t.height:t.width,a("getHeight",s)}))}}()}))})),(a,o)=>{const d=v,i=F,y=Q;return s(),t(i,{class:"ss-goods-wrap"},{default:l((()=>["md"===e.size?(s(),t(i,{key:0,class:"md-goods-card ss-flex-col",style:V([m(u)])},{default:l((()=>[f(d,{class:"md-img-box",src:m(p).$url.cdn(e.data.thumbnail),mode:"widthFix",onClick:n},null,8,["src"]),f(i,{class:"ss-flex-col ss-row-around md-goods-content",id:b},{default:l((()=>[f(i,{class:"md-goods-title ss-line-2",onClick:n},{default:l((()=>[g(k(e.data.name),1)])),_:1}),f(i,{class:"ss-flex ss-row-between purtypeMarket",onClick:n},{default:l((()=>[f(i,{class:"purtype-tag ss-line-1"},{default:l((()=>[g(k(e.data.centralpurtype_name),1)])),_:1}),1==e.data.source?(s(),t(i,{key:0,class:"marketName ss-line-1"},{default:l((()=>[g(k(e.data.suppliername),1)])),_:1})):(s(),t(i,{key:1,class:"marketName ss-line-1"},{default:l((()=>[g(k(e.data.source_name),1)])),_:1}))])),_:1}),f(i,{class:"ss-flex ss-row-between priceBuy"},{default:l((()=>[f(i,{class:"ss-flex",onClick:n},{default:l((()=>[f(i,{class:"md-goods-price"},{default:l((()=>[f(y,{class:"price-unit ss-font-24"},{default:l((()=>[g(k(e.priceUnit),1)])),_:1}),g(" "+k(c(e.data.price)),1)])),_:1}),f(i,null,{default:l((()=>[f(i,{class:"sales-text"},{default:l((()=>[g(k(m(r)),1)])),_:1})])),_:1})])),_:1}),e.buttonShow?(s(),t(m(U),{key:0,size:"24",fill:"#2770F5",onClick:S})):_("",!0)])),_:1})])),_:1})])),_:1},8,["style"])):_("",!0),"lg"===e.size?(s(),t(i,{key:1,class:"lg-goods-card ss-flex ss-col-center",style:V([m(u)])},{default:l((()=>[f(d,{class:"lg-img-box",src:m(p).$url.cdn(e.data.thumbnail),mode:"aspectFill",onClick:n},null,8,["src"]),f(i,{class:"lg-goods-content ss-flex-1 ss-flex-col ss-row-between"},{default:l((()=>[f(i,{onClick:n},{default:l((()=>[f(i,{class:"lg-goods-title ss-line-2"},{default:l((()=>[g(k(e.data.name),1)])),_:1}),f(i,{class:"ss-flex ss-row-between tag"},{default:l((()=>[f(i,{class:"purtype-tag ss-line-1"},{default:l((()=>[g(k(e.data.centralpurtype_name),1)])),_:1}),f(i)])),_:1}),1==e.data.source?(s(),t(i,{key:0,class:"lg-goods-subtitle ss-line-1"},{default:l((()=>[g(k(e.data.suppliername),1)])),_:1})):(s(),t(i,{key:1,class:"lg-goods-subtitle ss-line-1"},{default:l((()=>[g(k(e.data.source_name),1)])),_:1}))])),_:1}),f(i,null,{default:l((()=>[f(i,{class:"ss-flex ss-row-between priceSalesBuy"},{default:l((()=>[f(i,{class:"ss-flex",onClick:n},{default:l((()=>[f(i,{class:"lg-goods-price"},{default:l((()=>[f(y,{class:"ss-font-24"},{default:l((()=>[g(k(e.priceUnit),1)])),_:1}),g(" "+k(c(e.data.price)),1)])),_:1}),f(i,null,{default:l((()=>[f(i,{class:"sales-text"},{default:l((()=>[g(k(m(r)),1)])),_:1})])),_:1})])),_:1}),e.buttonShow?(s(),t(m(U),{key:0,size:"24",fill:"#2770F5",onClick:S})):_("",!0)])),_:1})])),_:1})])),_:1})])),_:1},8,["style"])):_("",!0),"sm"===e.size?(s(),t(i,{key:2,class:"sm-goods-card ss-flex-col",style:V([m(u)]),onClick:n},{default:l((()=>[f(d,{class:"sm-img-box",src:m(p).$url.cdn(e.data.thumbnail),mode:"aspectFill"},null,8,["src"]),f(i,{class:"sm-goods-content"},{default:l((()=>[f(i,{class:"sm-goods-title ss-line-2 ss-m-b-16"},{default:l((()=>[g(k(e.data.name),1)])),_:1}),1==e.data.source?(s(),t(i,{key:0,class:"sm-goods-subtitle ss-line-1"},{default:l((()=>[g(k(e.data.suppliername),1)])),_:1})):(s(),t(i,{key:1,class:"sm-goods-subtitle ss-line-1"},{default:l((()=>[g(k(e.data.source_name),1)])),_:1})),f(i,{class:"sm-goods-price"},{default:l((()=>[f(y,{class:"price-unit"},{default:l((()=>[g(k(e.priceUnit),1)])),_:1}),g(" "+k(c(e.data.price)),1)])),_:1})])),_:1})])),_:1},8,["style"])):_("",!0)])),_:1})}}},[["__scopeId","data-v-39049fd4"]]);export{D as _,T as a,H as b};
