var e=(e,t,s)=>new Promise(((l,o)=>{var a=e=>{try{n(s.next(e))}catch(t){o(t)}},r=e=>{try{n(s.throw(e))}catch(t){o(t)}},n=e=>e.done?l(e.value):Promise.resolve(e.value).then(a,r);n((s=s.apply(e,t)).next())}));import{s as t,c as s,a as l,b as o,d as a,e as r,f as n,g as i,u as d,B as c,l as u,m as f,t as m,T as p,R as g,U as _,q as h,p as C,M as k,V as x,W as I,i as b,F as S,j as y,D as v,h as w,N as V,r as M,J as L,K as A,X as N,Y as T,O as P,Z as $,C as F,k as j}from"./index-45b322f7.js";import{_ as O}from"./su-sticky.dcc8e273.js";import{_ as R}from"./s-empty.081ad1d8.js";import{_ as G}from"./s-position-item.f7427e2d.js";import{_ as E}from"./su-popup.9d6f394f.js";import{_ as D}from"./uni-number-box.d645de38.js";import{_ as B}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as Q}from"./su-fixed.9f687b80.js";import{_ as q}from"./s-layout.940eafb4.js";import{g as W,h as z}from"./index.f474d5f6.js";import"./uni-tag.2e567b2b.js";import"./uni-icons.c22fa7d9.js";const J=B({__name:"s-cart-card-item",props:{goods:{type:Object,default:{}}},emits:["clickSelectOneGoods"],setup(e,{emit:k}){const x=e,I=t.$store("cart"),b=s((()=>null!=I.selectedList.find((e=>e.goodsId==x.goods.goodsId)))),S=s((()=>x.goods.qty));function y(e){if(null==e)return;let t=e.toString(),s=t.indexOf(".");if(-1==s)return v(t);{t=parseFloat(e).toFixed(2).toString();let l=t.substring(0,s),o=t.slice(s);return v(l)+o}}function v(e){if(null==e||null==e)return e;let t=e.split("").reverse();for(let s=0;4*s+3<t.length;s++){let e=4*s+3;t.splice(e,0,",")}return t.reverse().join("")}function w(){t.$router.go("/pages/goods/index",{goodsid:x.goods.goodsId,platform:x.goods.platform})}function V(){x.goods.inStock&&x.goods.mallStatusValid&&x.goods.orgSaleable?(b.value?I.cancelSelectItem([x.goods]):I.selectItem([x.goods]),k("clickSelectOneGoods")):g({title:"该商品已下架/不可售/已售罄，无法选择",icon:"none",mask:!0})}function M(e){return null==e||null==e||""==e?0:Number(e)}function L(e){I.modifyItem({goodsId:x.goods.goodsId,platform:x.goods.platform,qty:e})}function A(){g({title:"商品数量不能小于起订量。",icon:"none",mask:!0})}function N(){g({title:"商品数量不能大于库存量。",icon:"none",mask:!0})}return(t,s)=>{const g=_,k=h,I=C,v=l(o("uni-number-box"),D);return a(),r(I,{class:"ss-flex cart"},{default:n((()=>[i(g,{checked:d(b),style:{transform:"scale(0.8)"},onClick:c(V,["stop"]),disabled:!x.goods.inStock||!x.goods.mallStatusValid||!x.goods.orgSaleable},null,8,["checked","onClick","disabled"]),i(I,{class:"ss-flex imageInfo"},{default:n((()=>[i(I,{class:"imgaebox",onClick:w},{default:n((()=>[i(k,{class:"image",src:e.goods.thumbnail},null,8,["src"]),x.goods.mallStatusValid?x.goods.orgSaleable?x.goods.inStock?f("",!0):(a(),r(I,{key:2,class:"overlay"},{default:n((()=>[u("已售罄")])),_:1})):(a(),r(I,{key:1,class:"overlay"},{default:n((()=>[u("不可售")])),_:1})):(a(),r(I,{key:0,class:"overlay"},{default:n((()=>[u("已下架")])),_:1}))])),_:1}),i(I,{class:"ss-flex-col ss-flex-1 goodsInfo"},{default:n((()=>[i(I,{class:"ss-flex-col",onClick:w},{default:n((()=>[i(I,{class:"ss-line-1 goodsName"},{default:n((()=>[u(m(e.goods.goodsName),1)])),_:1}),i(I,{class:"ss-flex ss-row-between specsMoq"},{default:n((()=>[null!=e.goods.minOrderQty&&e.goods.minOrderQty>0?(a(),r(I,{key:0},{default:n((()=>[u(m(M(e.goods.minOrderQty))+"件起订",1)])),_:1})):f("",!0)])),_:1})])),_:1}),i(I,{class:"priceNumber"},{default:n((()=>[i(I,{class:"price"},{default:n((()=>[u("￥"+m(y(e.goods.taxPrice)),1)])),_:1}),i(v,{modelValue:d(S),"onUpdate:modelValue":s[0]||(s[0]=e=>p(S)?S.value=e:null),step:1,min:M(e.goods.minOrderQty),max:Number.MAX_SAFE_INTEGER,background:"#FFFFFF",onChange:L,onCanNotMinus:A,onCanNotPlus:N},null,8,["modelValue","min","max"])])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-a9bb1ba3"]]),K=B({__name:"s-cart-card",props:{MalSupplierToCartItemsVo:{type:Object,default:{}}},emits:["selectGoodsOrMarket"],setup(e,{emit:l}){const o=e,f=t.$store("cart");k({selectedItems:s((()=>t.$store("cart").selectedList)),allSelected:s((()=>t.$store("cart").isAllSelected))});const p=s((()=>{let e=f.selectedList;for(let t of o.MalSupplierToCartItemsVo.malCartItemVoList){if(null==e.find((e=>e.goodsId==t.goodsId)))return!1}return!0})),h=s((()=>{for(let e of o.MalSupplierToCartItemsVo.malCartItemVoList)if(!e.inStock||!e.mallStatusValid||!e.orgSaleable)return!1;return!0}));function v(){l("selectGoodsOrMarket")}function w(){h.value?(p.value?f.cancelSelectItem(o.MalSupplierToCartItemsVo.malCartItemVoList):f.selectItem(o.MalSupplierToCartItemsVo.malCartItemVoList),l("selectGoodsOrMarket")):g({title:"存在已下架/不可售/已售罄的商品，无法选择全部",icon:"none",mask:!0})}return(t,s)=>{const l=_,f=C;return x((a(),r(f,null,{default:n((()=>[i(f,{class:"ss-flex-col"},{default:n((()=>[i(f,{class:"ss-flex head"},{default:n((()=>[i(f,null,{default:n((()=>[i(l,{checked:d(p),style:{transform:"scale(0.8)"},onClick:c(w,["stop"]),disabled:!d(h)},null,8,["checked","onClick","disabled"])])),_:1}),i(f,{class:"marketName"},{default:n((()=>[u(m(e.MalSupplierToCartItemsVo.supplierName),1)])),_:1}),i(f,{class:"platformTag"},{default:n((()=>[u(m(e.MalSupplierToCartItemsVo.platformName),1)])),_:1})])),_:1}),i(f,null,{default:n((()=>[(a(!0),b(S,null,y(e.MalSupplierToCartItemsVo.malCartItemVoList,(e=>(a(),r(d(J),{onClickSelectOneGoods:v,goods:e},null,8,["goods"])))),256))])),_:1})])),_:1})])),_:1},512)),[[I,null!=o.MalSupplierToCartItemsVo.malCartItemVoList&&null!=o.MalSupplierToCartItemsVo.malCartItemVoList&&o.MalSupplierToCartItemsVo.malCartItemVoList.length>0]])}}},[["__scopeId","data-v-f78dc73f"]]),U=B({__name:"s-ext-btn",props:{compId:{type:String,default:""},param:{}},emits:["showInteractiveWindow","showNotification","refreshData"],setup(s,{emit:l}){const o=s,i=k({isShow:!1,name:"扩展按钮",backgroundColor:"#FFFFFF",fontColor:"#212121"});function d(){return e(this,null,(function*(){const e=yield t.$api.extButton.btnClick({compId:o.compId,extParam:o.param});0!=e.errorCode||("show_confirm_window"==e.data.extResult.nextStep&&l("showInteractiveWindow",e.data.extResult,1),"show_notification"==e.data.extResult.nextStep&&l("showNotification",e.data.extResult,2),"refresh"==e.data.extResult.nextStep&&l("refreshData",null,3),e.data.extResult.nextStep)}))}return v((()=>{!function(){e(this,null,(function*(){const e=yield t.$api.extButton.btnInit({compId:o.compId,extParam:o.param});0==e.errorCode&&1==e.data.show?(i.name=e.data.extResult.name,e.data.extResult.backgroundColor&&(i.backgroundColor=e.data.extResult.backgroundColor),e.data.extResult.fontColor&&(i.fontColor=e.data.extResult.fontColor),i.isShow=!0):i.isShow=!1}))}()})),(e,t)=>{const s=V;return x((a(),r(s,{type:"default",class:"ext-btn",style:w({color:i.fontColor,backgroundColor:i.backgroundColor}),onClick:d},{default:n((()=>[u(m(i.name),1)])),_:1},8,["style"])),[[I,i.isShow]])}}},[["__scopeId","data-v-679949cb"]]),X=B({__name:"cart",setup(p){T((e=>({"765fe880":d(h)})));const h=t.$platform.navbar,x=t.$store("cart"),I=t.$store("address"),w=k({editMode:!1,list:s((()=>x.list)),selectedList:[],selectedIds:s((()=>x.selectedIds)),totalPriceSelected:s((()=>x.cartSelectedTotalPrice)),selectPosition:!1,selectedNumber:s((()=>x.cartSelectedTotalQty)),receiptAddress:s((()=>x.receiptAddress))}),D=s((()=>{let e=0;return x.list.forEach((t=>e+=t.malCartItemVoList.length)),e==x.selectedList.length})),B=s((()=>null==I.addressList||null==I.addressList||0==I.addressList.length)),J=s((()=>{for(let e of w.list)for(let t of e.malCartItemVoList)if(!t.inStock||!t.mallStatusValid||!t.orgSaleable)return!1;return!0})),X=M({});function H(){X.value.selectedGoods=x.selectedList}function Y(e){if(null==e)return;let t=e.toString(),s=t.indexOf(".");if(-1==s)return Z(t);{t=parseFloat(e).toFixed(2).toString();let l=t.substring(0,s),o=t.slice(s);return Z(l)+o}}function Z(e){if(null==e||null==e)return e;let t=e.split("").reverse();for(let s=0;4*s+3<t.length;s++){let e=4*s+3;t.splice(e,0,",")}return t.reverse().join("")}function ee(){w.selectPosition=!1,X.value.selectedAddressId=x.selectedAddressId,X.value.selectedGoods=x.selectedList}function te(s,l){1==l?P({title:s.title,content:s.content,showCancel:!0,success:function(s){s.confirm?X.choice="confirm":s.cancel&&(X.choice="cancel"),function(){e(this,null,(function*(){const e=yield t.$api.extButton.btnNextStep({compId:"ext_btn",extParam:X});0==e.errorCode&&"show_notification"==e.data.extResult.nextStep&&g({title:e.data.extResult.notification,icon:"none",mask:!0})}))}()}}):2==l?g({title:s.notification,icon:"none",mask:!0}):3==l&&(w.editMode=!1,x.refreshCart())}function se(){t.$router.go("/pages/user/location-detail",{isNewAddress:!0})}function le(e){t.$router.go("/pages/homepage/index","")}function oe(){if(0==x.list.length)return;if(!J.value)return void g({title:"存在已下架/不可售/已售罄的商品，无法全选",icon:"none",mask:!0});let e=[];x.list.forEach((t=>e.push(...t.malCartItemVoList))),D.value?x.cancelSelectItem(e):x.selectItem(e),X.value.selectedGoods=x.selectedList}function ae(e){let t=[];for(let s of x.list)s.malCartItemVoList.forEach((e=>{e.inStock&&e.mallStatusValid&&e.orgSaleable||t.push(e.goodsId)}));t.length>0?x.delete(t,!0):g({title:"没有需要清理的失效商品",icon:"none",mask:!0})}function re(e){return null==e||null==e||""==e}function ne(){if(re(x.selectedList))g({title:"请选择需要结算的商品。",icon:"none",mask:!0});else if(re(w.receiptAddress)||re(w.receiptAddress.wholeAddress))g({title:"请维护默认收货地址。",icon:"none",mask:!0});else{for(let e of x.selectedList)if(!e.inStock)return void P({title:"业务提示",content:"您所选的商品部分缺货，请联系商家或管理员",showCancel:!1});t.$router.go("/pages/order/submit-order")}}function ie(){return e(this,null,(function*(){let e=[];x.selectedList.forEach((t=>e.push(t.goodsId))),e.length>0?x.delete(e):g({title:"请选择一条商品记录。",icon:"none",mask:!0})}))}return v((()=>{x.getList(),X.value.user=t.$store("homepage").mainConfigData.userInfo,re(x.selectedAddressId)?X.value.selectedAddressId=I.addressList[0].id:X.value.selectedAddressId=x.selectedAddressId})),L((()=>{w.editMode=!1,x.refreshCart(),setTimeout((function(){A()}),800),X.value.selectedGoods=x.selectedList})),N((()=>{w.editMode=!1,x.refreshCart();let e=t.$router.getCurrentPage();null!=e.$vm.editAddressSuccess&&"1"==e.$vm.editAddressSuccess&&(e.$vm.editAddressSuccess="0",w.selectPosition=!1,B.value?x.refreshCart():(x.setAddressId(e.$vm.addressId),x.getList()))})),(e,t)=>{const s=C,p=V,g=l(o("su-sticky"),O),h=l(o("s-empty"),R),k=l(o("s-position-item"),G),I=l(o("su-popup"),E),v=l(o("s-cart-card"),K),M=_,L=$,A=F,N=l(o("s-ext-btn"),U),T=l(o("su-fixed"),Q),P=l(o("s-layout"),q);return a(),r(P,{tabbar:"/pages/index/cart"},{default:n((()=>[i(g,{bgColor:"#fff",stickyToTop:!1},{default:n((()=>[w.list.length&&d(x).totalCartItemNumber?(a(),r(s,{key:0,class:"cart-header ss-flex ss-col-center ss-row-between ss-p-x-30"},{default:n((()=>[i(s,{class:"ss-flex header-left ss-col-center",onClick:t[0]||(t[0]=()=>w.selectPosition=!w.selectPosition)},{default:n((()=>[i(d(W),{size:"16"}),d(B)?(a(),r(s,{key:0},{default:n((()=>[i(s,{class:"address-content ss-line-1",onClick:se},{default:n((()=>[u("点击添加收货地址")])),_:1})])),_:1})):(a(),r(s,{key:1,class:"ss-flex"},{default:n((()=>[i(s,{class:"address-tittle"},{default:n((()=>[u("配送至：")])),_:1}),i(s,{class:"address-content ss-line-1"},{default:n((()=>[u(m(w.receiptAddress.wholeAddress),1)])),_:1})])),_:1})),i(d(z),{size:"12",class:"ss-m-l-10"})])),_:1}),i(s,{class:"header-right"},{default:n((()=>[w.editMode?(a(),r(p,{key:0,class:"ss-reset-button",onClick:t[1]||(t[1]=e=>w.editMode=!1)},{default:n((()=>[u(" 退出管理 ")])),_:1})):(a(),r(p,{key:1,class:"ss-reset-button ui-TC-Main",onClick:t[2]||(t[2]=e=>w.editMode=!0)},{default:n((()=>[u(" 管理 ")])),_:1}))])),_:1})])),_:1})):f("",!0)])),_:1}),0===w.list.length||0==d(x).totalCartItemNumber?(a(),r(h,{key:0,text:"购物车空空如也",icon:"../../static/cart_empty.png",showAction:!0,actionText:"去逛逛",onClickAction:le})):f("",!0),i(I,{show:w.selectPosition,round:"0",onClose:t[4]||(t[4]=()=>w.selectPosition=!1)},{default:n((()=>[i(k,{onClickCloseIconPosition:t[3]||(t[3]=e=>w.selectPosition=!1),onAddressChanged:ee})])),_:1},8,["show"]),w.list.length&&d(x).totalCartItemNumber?(a(),r(s,{key:1,class:"cart-box ss-flex-col ss-row-between"},{default:n((()=>[i(s,{class:"ss-flex-col cart-item-list"},{default:n((()=>[(a(!0),b(S,null,y(w.list,((e,t)=>(a(),r(v,{onSelectGoodsOrMarket:H,MalSupplierToCartItemsVo:e,class:j(["cartCard",{cartCardNotFirst:t>0}])},null,8,["MalSupplierToCartItemsVo","class"])))),256)),i(s,{class:"tips"},{default:n((()=>[u("没有更多数据了")])),_:1})])),_:1}),w.list.length>0?(a(),r(T,{key:0,bottom:"",val:48,placeholder:"",isInset:!1},{default:n((()=>[i(s,{class:"cart-footer ss-flex ss-col-center ss-row-between ss-p-x-24"},{default:n((()=>[i(s,{class:"footer-left ss-flex ss-col-center"},{default:n((()=>[i(L,{class:"check-box ss-flex ss-col-center ss-p-r-30"},{default:n((()=>[i(M,{checked:d(D),style:{transform:"scale(0.8)"},onClick:c(oe,["stop"]),disabled:!d(J)},null,8,["checked","onClick","disabled"]),i(s,{class:"ss-m-l-8"},{default:n((()=>[u(" 全选 ")])),_:1})])),_:1}),w.editMode?f("",!0):(a(),r(s,{key:0},{default:n((()=>[i(s,{class:"ss-flex"},{default:n((()=>[i(A,null,{default:n((()=>[u("合计：")])),_:1}),i(s,{class:"text-price price-text"},{default:n((()=>[u(m(Y(w.totalPriceSelected)),1)])),_:1})])),_:1}),i(s,{class:"select-number"},{default:n((()=>[u("已选"+m(w.selectedNumber)+"件",1)])),_:1})])),_:1}))])),_:1}),i(s,{class:"footer-right ss-flex"},{default:n((()=>[w.editMode?(a(),r(p,{key:0,type:"default",class:"delete-lapse-btn",onClick:ae},{default:n((()=>[u(" 清理失效商品 ")])),_:1})):f("",!0),w.editMode?f("",!0):(a(),r(N,{key:1,compId:"ext_btn",param:X.value,onShowInteractiveWindow:te,onShowNotification:te,onRefreshData:te},null,8,["param"])),w.editMode?(a(),r(p,{key:2,type:"default",class:"billing-btn ss-m-l-24",onClick:ie},{default:n((()=>[u(" 删除 ")])),_:1})):(a(),r(p,{key:3,type:"default",onClick:ne,class:"billing-btn"},{default:n((()=>[u(" 结算 ")])),_:1}))])),_:1})])),_:1})])),_:1})):f("",!0)])),_:1})):f("",!0)])),_:1})}}},[["__scopeId","data-v-23f64f16"]]);export{X as default};
