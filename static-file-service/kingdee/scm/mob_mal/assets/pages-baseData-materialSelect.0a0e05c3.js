var e=(e,a,l)=>new Promise(((t,r)=>{var s=e=>{try{i(l.next(e))}catch(a){r(a)}},n=e=>{try{i(l.throw(e))}catch(a){r(a)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,n);i((l=l.apply(e,a)).next())}));import{_ as a}from"./uni-search-bar.48a9b35c.js";import{s as l,M as t,r,c as s,D as n,I as i,d as o,e as u,f as d,a as c,g as p,l as f,t as g,u as h,i as v,j as m,F as y,m as _,b as M,p as P,S as w,k as I}from"./index-45b322f7.js";import{_ as S}from"./su-sticky.dcc8e273.js";import{_ as T}from"./su-popup.9d6f394f.js";import{_ as k}from"./uni-load-more.575c3b96.js";import{_ as b}from"./s-layout.940eafb4.js";import{j as L,h as x,a as C,d as N}from"./index.f474d5f6.js";import{i as j}from"./itemList.bfc32ea9.js";import{_ as B}from"./_plugin-vue_export-helper.1b428a4d.js";import"./uni-icons.c22fa7d9.js";const D=B({__name:"materialSelect",setup(B){const D=l.$store("order"),O=t({showMaterialTypeSelect:!1,currentPageNo:1,isMaterialTypeLastPage:!1,isMaterialLastPage:!1,supplierId:"",goodsId:"",isSearch:!1}),z=r(""),E=r([]),$=r([]),F=r({}),V=s((()=>A.value.length>0?O.isMaterialTypeLastPage&&O.isMaterialLastPage?"noMore":"more":O.isSearch?O.isMaterialLastPage?"noMore":"more":O.isMaterialTypeLastPage?"noMore":"more")),R=s((()=>D.supplierIdToPlaceOrderEntityMap[O.supplierId].placeOrderItemList.find((e=>e.goodsId==O.goodsId)))),A=r([]),U=s((()=>{if(0==A.value.length)return $.value;return A.value[A.value.length-1].children}));function W(){Y(),""!=z.value&&null!=z.value&&null!=z.value&&(O.isSearch=!0),J("",20,O.currentPageNo)}function q(a){return e(this,null,(function*(){O.currentPageNo=1;let e=Q(a);yield H(a,20,1),yield J(a,20,1),A.value.push(e)}))}function G(e){let a=Q(e);D.modifyMaterial(O.supplierId,O.goodsId,a),l.$router.back()}function H(a,t,r){return e(this,null,(function*(){V.value="loading";const e=yield l.$api.baseData.getMaterialType({standard_id:BigInt(F.value.id),pageSize:t,pageNo:r,parent_id:BigInt(a)});if(0==e.errorCode){if(null==a||null==a||""==a)e.data.rows.forEach((e=>{e.type="firstLevelType"})),$.value.push(...e.data.rows);else{let l=Q(a);e.data.rows.forEach((e=>{e.type="firstLevelType",e.parentId=a})),null==l.children||null==l.children?l.children=e.data.rows:l.children.push(...e.data.rows)}O.isMaterialTypeLastPage=e.data.lastPage}}))}function J(a,t,r){return e(this,null,(function*(){V.value="loading";let e=null;if(e=null==a||null==a||""==a?yield l.$api.baseData.getMaterial({materialgroupstandard_id:BigInt(F.value.id),purtype_id:R.value.purTypeId,purorg_id:D.malOrgRelation.purOrgId,route:"bd_material",pageSize:t,pageNo:r,number:z.value,name:z.value}):yield l.$api.baseData.getMaterial({group_id:BigInt(a),materialgroupstandard_id:BigInt(F.value.id),purtype_id:R.value.purTypeId,purorg_id:D.malOrgRelation.purOrgId,route:"bd_material",pageSize:t,pageNo:r,number:z.value,name:z.value}),0==e.errorCode)if(e.data.rows.forEach((e=>{e.type="subLevelType",e.parentId=a})),O.isSearch)$.value.push(...e.data.rows);else{let l=Q(a);null==l.children?l.children=e.data.rows:l.children.push(...e.data.rows),O.isMaterialLastPage=e.data.lastPage}}))}function K(){Y(),O.isSearch=!1,H("",20,O.currentPageNo)}function Q(e){let a=null;for(let l of $.value)if(a=X(e,l),null!=a&&null!=a)break;return a}function X(e,a){if(null==a||null==a||a.id==e)return a;if(null==a.children||null==a.children)return null;for(let l of a.children){let a=X(e,l);if(null!=a&&null!=a)return a}}function Y(){O.currentPageNo=1,$.value=[],A.value=[],O.isMaterialLastPage=!1,O.isMaterialTypeLastPage=!1}return n((a=>{O.supplierId=a.supplierId,O.goodsId=a.goodsId,function(){e(this,null,(function*(){const e=yield l.$api.baseData.getMaterialTypeStand({pageSize:100,pageNo:1});0==e.errorCode&&(E.value=e.data.rows,F.value=E.value.find((e=>"物料基本分类标准"==e.name)),null==F.value&&(F.value=E.value.find((e=>"基本分类标准"==e.name))),H("",20,1))}))}()})),i((()=>{!function(){if("noMore"==V.value)return;O.currentPageNo+=1;let e="";O.isSearch?J("",20,O.currentPageNo):A.value.length>0?(e=A.value[A.value.length-1].id,O.isMaterialTypeLastPage||H(e,20,O.currentPageNo),O.isMaterialLastPage||J(e,20,O.currentPageNo)):O.isMaterialTypeLastPage||H("",20,O.currentPageNo)}(),console.log(214)})),(e,l)=>{const t=c(M("uni-search-bar"),a),r=P,s=c(M("su-sticky"),S),n=w,i=c(M("su-popup"),T),B=c(M("uni-load-more"),k),D=c(M("s-layout"),b);return o(),u(D,null,{default:d((()=>[p(s,{bgColor:"#fff",stickyToTop:!1},{default:d((()=>[p(r,{class:"search-block ss-flex ss-row-center"},{default:d((()=>[p(t,{class:"search-bar",placeholder:"请搜索物料编号/名称",onConfirm:W,onCancel:K,modelValue:z.value,"onUpdate:modelValue":l[0]||(l[0]=e=>z.value=e)},null,8,["modelValue"])])),_:1}),p(r,{class:"ss-flex ss-row-center typeSelect",onClick:l[1]||(l[1]=e=>O.showMaterialTypeSelect=!0)},{default:d((()=>[p(r,null,{default:d((()=>[f(g(F.value.name),1)])),_:1}),p(h(L))])),_:1})])),_:1}),p(r,{class:"ss-flex-col"},{default:d((()=>[A.value.length>0?(o(),u(r,{key:0,class:"ss-flex pathBox"},{default:d((()=>[(o(!0),v(y,null,m(A.value,((e,a)=>(o(),u(r,{class:"ss-flex",onClick:e=>function(e,a){A.value[a+1].children=[],A.value.splice(a+1)}(0,a)},{default:d((()=>[0!=a?(o(),u(h(x),{key:0,fill:"#999999"})):_("",!0),p(r,{class:I(["pathName",{oldPath:a!=A.value.length-1}])},{default:d((()=>[f(g(e.name),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),256))])),_:1})):_("",!0),p(j,{listData:h(U),onClickFirstLevelEntry:q,onClickEntry:G},null,8,["listData"])])),_:1}),p(i,{show:O.showMaterialTypeSelect,onClose:l[3]||(l[3]=()=>O.showMaterialTypeSelect=!1)},{default:d((()=>[p(r,{class:"ss-flex-col typeSelectWindow"},{default:d((()=>[p(r,{class:"ss-flex ss-col-center ss-row-center"},{default:d((()=>[p(r,{class:"windowTittle"},{default:d((()=>[f("请选择")])),_:1}),p(h(C),{class:"closeOne",size:"16",fill:"#999999",onClick:l[2]||(l[2]=()=>O.showMaterialTypeSelect=!1)})])),_:1}),p(n,{class:"typeStandBox","scroll-y":!0},{default:d((()=>[(o(!0),v(y,null,m(E.value,(e=>(o(),u(r,{class:"ss-flex ss-row-between typeStandItem",onClick:a=>function(e){F.value=e,O.showMaterialTypeSelect=!1,Y(),O.isSearch?J("",20,O.currentPageNo):H("",20,O.currentPageNo)}(e)},{default:d((()=>[p(r,null,{default:d((()=>[f(g(e.name),1)])),_:2},1024),e.id==F.value.id?(o(),u(h(N),{key:0,fill:"#276FF5"})):_("",!0)])),_:2},1032,["onClick"])))),256))])),_:1})])),_:1})])),_:1},8,["show"]),h(U).length>0?(o(),u(B,{key:0,status:h(V),"content-text":{contentdown:"上拉加载更多"},onClick:e.loadmore},null,8,["status","onClick"])):_("",!0)])),_:1})}}},[["__scopeId","data-v-d751c3bb"]]);export{D as default};
