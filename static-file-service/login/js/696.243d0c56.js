(self.webpackChunkkd_login=self.webpackChunkkd_login||[]).push([[696,196],{28809:function(e,t,n){"use strict";n.r(t),n.d(t,{ShortMessage:function(){return N},default:function(){return j}});n(82320),n(9112),n(97060),n(60776),n(9692),n(13468),n(43616),n(43924),n(4180),n(5960),n(97336),n(46428),n(36368),n(8896),n(6200),n(70864),n(80920),n(87912),n(36887),n(60824),n(78504),n(77864),n(86744);var o=n(85668),a=n(71252),i=n.n(a),r=n(33588),s={formContainer:"aaged7ya",title:"vKcjSRXf",content:"mtcyk1Tf",graphicContainer:"_23RtWpjC",graphicCode:"_1Af0fJJL",phoneCodeContainer:"_2OKvHj4b",btn:"_2IWgbFS9",disable:"_31AdAIj0",showPhoneCode:"zelracga",successPanel:"iQba7fyk",successImage:"_1PrHSgxL",text:"_1HsnkvFp",count:"_1-fAaEHL",successSendEmailPanel:"xGQtq1eV",loginType:"_3uyksMzF",phoneLogin:"_3ZZ4bzdz",line:"ExfTyXGM"},c=n(8288),d=n(74800),l=n(25128),u=n(99832),p=n(82499),h=n(82784),f=n(10327),y=n(61076),v=n.n(y),m=n(94348),C=n(57044),g=n(57768);function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function k(e,t,n){return(t=D(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(){return P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},P.apply(this,arguments)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,D(o.key),o)}}function w(e,t,n){return t&&M(e.prototype,t),n&&M(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function D(e){var t=function(e,t){if("object"!=b(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=b(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==b(t)?t:String(t)}function S(e,t,n){return t=T(t),function(e,t){if(t&&("object"===b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return I(e)}(e,L()?Reflect.construct(t,n||[],T(e).constructor):t.apply(e,n))}function I(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(L=function(){return!!e})()}function T(e){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},T(e)}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&F(e,t)}function F(e,t){return F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},F(e,t)}var A=function(e){function t(){return E(this,t),S(this,t,arguments)}return _(t,e),w(t,[{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){e.props.dataPipeModel&&e.props.dataPipeModel.sendData({type:"FocusInput",name:"account"})}),0)}},{key:"componentWillUnmount",value:function(){(0,m.YL)(l.c)}},{key:"render",value:function(){return o.createElement(r.c,P({selectType:"shortMessage"},this.props),o.createElement(N,this.props))}}]),t}(o.Component),N=function(e){function t(e){var n;return E(this,t),(n=S(this,t,[e])).handleLoginTypeClick=function(e){f.q.setItem((0,f.iW)(g.EF),e?g.Af:g.GK),window.location.href="#kingdeeCloud"},n._isMounted=!1,n.state={verifyCodeImg:v(),vCodeTime:0,list:[],isLoading:!1},n.oldAccount=l.c.account,n.getVerifyCode=n.getVerifyCode.bind(I(n)),n.handleNextBtnClick=n.handleNextBtnClick.bind(I(n)),n.sendMessage=n.sendMessage.bind(I(n)),n.handleReSendPhoneCode=n.handleReSendPhoneCode.bind(I(n)),n.validateFormData=n.validateFormData.bind(I(n)),n.resetPhoneCodeState=n.resetPhoneCodeState.bind(I(n)),n.showDropdownList=n.showDropdownList.bind(I(n)),n.ListenerFilterDataCenter=n.ListenerFilterDataCenter.bind(I(n)),n.handleEnterKeyDown=n.handleEnterKeyDown.bind(I(n)),n.handleAccountInputBlur=n.handleAccountInputBlur.bind(I(n)),n.handleChangeDataCenter=n.handleChangeDataCenter.bind(I(n)),n.isInitAccount=(0,f.KA)(l.c.account),n}return _(t,e),w(t,[{key:"showDropdownList",value:function(e){var t=e.data,n=this.state.list||[];if(!n.some((function(e){return e.value===t.value}))){this.include||0===n.length||(this.props.handleChangeDataCenter(n[0].value),this.include=!0);var o=n.concat(t);this.setState({list:o})}}},{key:"componentDidMount",value:function(){0!==this.props.dataCenter.length&&this.ListenerFilterDataCenter(this.props.dataCenter,this.props.currentAccountId),this._isMounted=!0,this.getVerifyCode(),document.addEventListener("keydown",this.handleEnterKeyDown),this.isInitAccount||l.c.setValue("account",""),(0,m.YL)(l.c)}},{key:"shouldComponentUpdate",value:function(e,t){var n=e.currentAccountId;return 0!==e.dataCenter.length&&0===this.props.dataCenter.length&&this.ListenerFilterDataCenter(e.dataCenter,n),!0}},{key:"ListenerFilterDataCenter",value:function(e,t){var n=this,o=e.findIndex((function(e){return e.value===t}));(0,m.Q3)(t,e,o,this.props.dataPipeModel).then((function(e){var t;null!=e&&null!==(t=e.userSourceType)&&void 0!==t&&t.includes(7)||(n.include=!1);var o=e||{},a=o.userSourceType,i=o.defaultUserSourceType;n.props.dataPipeModel.sendData({type:"currentAccountIdChange",data:{userSourceType:a,defaultUserSourceType:i}})})),l.c.setValue("accountId",t);var a="shortMsgDataCenterList",i=this.props.dataPipeModel;i&&i.registerCallback(a,this.showDropdownList),(0,m.WG)(a,e,[7],i,t)}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,clearInterval(this.vCodeTimer),document.removeEventListener("keydown",this.handleEnterKeyDown)}},{key:"handleEnterKeyDown",value:function(e){13===e.keyCode&&this.handleNextBtnClick()}},{key:"validateFormData",value:function(){var e=l.c.account,t=l.c.verifyCode,n=l.c.phoneCode;if(d.q4.isEmpty(e)){var o=(0,h.yG)("login.key051");return this.props.dataPipeModel&&this.props.dataPipeModel.sendData({type:"accountError",data:o}),!1}if(d.q4.isEmpty(t)){var a=(0,h.yG)("login.key046");return this.props.dataPipeModel&&this.props.dataPipeModel.sendData({type:"verifyCodeError",data:a}),!1}if(d.q4.isEmpty(n)){var i=(0,h.yG)("login.key047");return this.props.dataPipeModel&&this.props.dataPipeModel.sendData({type:"phoneCodeError",data:i}),!1}return!0}},{key:"handleNextBtnClick",value:function(){if(!this.validateFormData()||this.state.isLoading)return!1;this.setState({isLoading:!0}),this.login()}},{key:"getVerifyCode",value:function(){var e=this;this.setState({verifyCodeImg:v()}),this.props.dataPipeModel&&this.props.dataPipeModel.sendData({type:"FocusInput",name:"verifyCode"}),p.CE({phone:l.c.account,v:(0,d.gV)(!1,8),language:l.c.lang}).then((function(t){var n=t.description_cn||t.description;if(n){var o={message:n,level:1};return e.props.dataPipeModel&&e.props.dataPipeModel.sendData({type:"ShowNotification",error:o}),!1}e.setState({verifyCodeImg:t.content||v()}),e.verifyCodeToken=t.loginId}))}},{key:"sendMessage",value:function(){var e=this;p.Yf({useraccount:l.c.account,accountId:l.c.accountId,verifycode:l.c.verifyCode,loginid:this.verifyCodeToken,language:l.c.lang,isNew:!0}).then((function(t){if(e.setState({isLoading:!1}),t.success){var n=t.timeout||60;e.vCodeTimer=setInterval((function(){n<=0?clearInterval(e.vCodeTimer):e.setState({vCodeTime:--n})}),1e3)}else{var o={message:t.msg||t.description,level:t.level||1};e.props.dataPipeModel&&e.props.dataPipeModel.sendData({type:"ShowNotification",error:o}),e.getVerifyCode()}}))}},{key:"login",value:function(){var e=this,t=l.c.account,n=l.c.accountId,o=l.c.phoneCode,a=(0,f.am)();a&&(a=decodeURIComponent(a)),p.gx({useraccount:t,accountId:n,smsCode:o,redirect:a||"index.html?formId=pc_main_console",loginid:this.verifyCodeToken,verifycode:l.c.verifyCode,isNew:!0,language:l.c.lang}).then((function(t){var o=t.errorcode;e.setState({isLoading:!1});var a=t.msg,i=t.message,r=t.description,s=a||i||t.description_cn||r;if(0!==o){var c={message:s,level:t.level||1};return e.props.dataPipeModel&&e.props.dataPipeModel.sendData({type:"ShowNotification",error:c}),!1}var d="#shortMessage"!==window.location.hash?window.location.hash:"";if((0,m.Yv)(t.RedirectURL)){var u={message:(0,h.yG)("login.key101"),level:t.level||1};return e.props.dataPipeModel&&e.props.dataPipeModel.sendData({type:"ShowNotification",error:u}),!1}(0,f.Ub)(t.RedirectURL,d,l.c.dataCenter,n),e.setState({isLoading:!1})})).catch((function(t){e.setState({isLoading:!1})}))}},{key:"resetPhoneCodeState",value:function(){clearInterval(this.vCodeTimer),this.setState({vCodeTime:0})}},{key:"handleReSendPhoneCode",value:function(){var e=l.c.account,t=l.c.verifyCode;if(d.q4.isEmpty(e))return!1;if(d.q4.isEmpty(t)){var n=(0,h.yG)("login.key046");return this.props.dataPipeModel&&this.props.dataPipeModel.sendData({type:"verifyCodeError",data:n}),!1}if(0!==this.state.vCodeTime)return!1;this.sendMessage()}},{key:"handleAccountInputBlur",value:function(){var e=l.c.account;e!==this.oldAccount&&(this.oldAccount=e,this.props.dataPipeModel.sendData({type:"FocusInput",name:"verifyCode",emptyValue:!0}),this.getVerifyCode(),this.resetPhoneCodeState())}},{key:"handleChangeDataCenter",value:function(e){l.c.setValue("toggleDataCenter",!0),this.props.handleChangeDataCenter(e)}},{key:"render",value:function(){var e=this,t=this.state.vCodeTime,n=void 0===t?0:t,a=l.c.account,r=this.props,p=r.dataCenter,y=r.currentAccountId,v=i()(k(k({},s.phoneCodeContainer,!0),s.showPhoneCode,!0)),m=i()(k(k({},s.btn,!0),s.disable,0!==n||d.q4.isEmpty(a))),g=(0,h.yG)("login.key119"),b=0===n?g:"".concat(g,"(").concat(n,"s)");return o.createElement("div",{className:s.formContainer},o.createElement("div",{className:s.title},(0,h.yG)("login.key109")),o.createElement(c.Y3,{dataPipeModel:this.props.dataPipeModel}),this.state.list.length>1?o.createElement(c.k9,{list:this.state.list,oldDataCenter:p,selectItem:y,style:s.dropdownList,name:"accountId",onItemClick:this.handleChangeDataCenter,dataPipeModel:this.props.dataPipeModel}):o.createElement("div",{style:{height:19}}),o.createElement("div",{className:s.content},o.createElement(u.StoreContext.Provider,{value:l.c},o.createElement(C.c,{defaultAreaCode:this.props.configuration.defaultAreaCode,telViaList:this.props.countryAreaCodes,dataPipeModel:this.props.dataPipeModel,name:"account",type:"text",placeholder:(0,h.yG)("login.key108"),defaultValue:this.isInitAccount?l.c.account:"",onBlur:this.handleAccountInputBlur}),o.createElement("div",{className:s.graphicContainer},o.createElement(c.EF,{dataPipeModel:this.props.dataPipeModel,name:"verifyCode",type:"text",placeholder:(0,h.yG)("login.key024")}),o.createElement("div",{className:s.graphicCode,onClick:this.getVerifyCode},o.createElement("img",{src:this.state.verifyCodeImg}))),o.createElement("div",{className:v},o.createElement(c.EF,{dataPipeModel:this.props.dataPipeModel,name:"phoneCode",type:"text",placeholder:(0,h.yG)("login.key025")}),o.createElement("div",{className:m,onClick:this.handleReSendPhoneCode},b)),o.createElement(c.q,{text:(0,h.yG)("login.key005"),dataPipeModel:this.props.dataPipeModel,onClick:(0,f.Cu)(this.handleNextBtnClick,200),style:{height:"30px",width:"30px",borderLeftColor:"#FFFFFF"},isLoading:this.state.isLoading}),o.createElement("div",{className:s.loginType},o.createElement("div",{className:s.phoneLogin,onClick:function(){e.handleLoginTypeClick(!1)}}," ",(0,h.yG)("login.key213")),o.createElement("div",{className:s.line}),o.createElement("div",{className:s.phoneLogin,onClick:function(){e.handleLoginTypeClick(!0)}}," ",(0,h.yG)("login.key214"))))))}}]),t}(o.Component),j=A},26952:function(){},72628:function(){},99560:function(){},67716:function(){},66756:function(){},87240:function(){},4712:function(){},27292:function(){}}]);