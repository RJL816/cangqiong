"use strict";(self.webpackChunkkd_login=self.webpackChunkkd_login||[]).push([[600],{5980:function(e,t,n){n.r(t),n.d(t,{default:function(){return J}});n(82320),n(9112),n(97060),n(60776),n(22676),n(5092),n(33696),n(43924),n(5960),n(97336),n(46428),n(36368),n(8896),n(69e3),n(6200),n(34440),n(76152),n(70864),n(76124),n(80920),n(87912),n(36887),n(78504),n(97308),n(77864),n(86744);var o=n(85668),a=n(90923),i=n(71252),r=n.n(i),s="_1RK6yejh",d="_2XKZhPgs",c="qXOAeO37",l="_2t6ocKEN",u="R9nGZN6h",h="_3l74qXIv",p="_2njOS2g9",f="_2dDV_9Sv",y="_3Kr5JimC",g="_2S8EtbLi",C="_1nLnAOd3",m=n(82724),v=n(82499),b=n(25128),k=n(74800),w=n(10327),P=n(94348),M=n(61076),I=n.n(M),O=n(56284),S=n(57768),V=n(82784),E=n(572),N=n(82100),j=n(31398),G="_2hDVsxhu",D="_3H2Pk2qZ";function _(e){var t=e.pwdIsRemed,n=e.configuration,a=e.onRememberPwd,i=n.usernamepsw,r=n.hiddenresetpwd,s=n.isGlobalDeploy,d=!r||"false"===r,c=("1"===i||"2"===i)&&(0,V.yG)("login.key086"),l="true"===s||!0===s;return o.createElement("div",{className:G},o.createElement(j.c,{text:c,isMobile:!0,isSelect:t,onClick:a,showUsernamePsw:!0}),d&&!l&&o.createElement("a",{className:D,href:"#findPassword"},(0,V.yG)("login.key216")))}function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function A(){return A=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},A.apply(this,arguments)}function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){T(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function T(e,t,n){return(t=F(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,F(o.key),o)}}function F(e){var t=function(e,t){if("object"!=L(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=L(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==L(t)?t:String(t)}function x(e,t,n){return t=U(t),function(e,t){if(t&&("object"===L(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return W(e)}(e,q()?Reflect.construct(t,n||[],U(e).constructor):t.apply(e,n))}function q(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(q=function(){return!!e})()}function U(e){return U=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},U(e)}function W(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y(e,t){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Y(e,t)}var J=function(e){function t(e){var n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=x(this,t,[e])).handleLoginTypeClick=function(){var e=o.state.isPhoneLogin;w.q.setItem((0,w.iW)(S.EF),e?S.GK:S.Af),o.setState({isPhoneLogin:!e})},o.state={logining:!1,needMsgValidate:!1,vCodeTime:0,showPhoneCode:!1,needVerifyCode:!1,verifyCodeImg:I(),account:b.C.account,password:b.C.password,verifyCode:b.C.verifyCode,phoneCode:b.C.phoneCode,customDynamicCode:b.C.customDynamicCode,needCustomDynamicCode:null===(n=b.C.dataCenter.find((function(e,t){return e.value===o.props.currentAccountId})))||void 0===n?void 0:n.needCustomDynamicCode,factor:"",isKickedOut:"",pwdIsRemed:!1,isPhoneLogin:w.q.getItem((0,w.iW)(S.EF))===S.Af},o.handleLoginBtnClick=o.handleLoginBtnClick.bind(W(o)),o.resetLoginStatus=o.resetLoginStatus.bind(W(o)),o.submit=o.submit.bind(W(o)),o.isNeedMsgValidate=o.isNeedMsgValidate.bind(W(o)),o.handleSendMessage=o.handleSendMessage.bind(W(o)),o.loginFail=o.loginFail.bind(W(o)),o.handleGetVerifyCode=o.handleGetVerifyCode.bind(W(o)),o.handleAccountInputBlur=o.handleAccountInputBlur.bind(W(o)),o.handleChange=o.handleChange.bind(W(o)),o.getVerifyCode=o.getVerifyCode.bind(W(o)),o.isNeedVerifyCode=o.isNeedVerifyCode.bind(W(o)),o.dataCenterChange=o.dataCenterChange.bind(W(o)),o.initAccountInfo=o.initAccountInfo.bind(W(o)),o.showMsg=o.showMsg.bind(W(o)),o.handleRememberPwd=o.handleRememberPwd.bind(W(o)),o.handleLoginTypeClick=o.handleLoginTypeClick.bind(W(o)),o}var n,i,M;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Y(e,t)}(t,e),n=t,(i=[{key:"componentDidMount",value:function(){var e,t=this;b.C.accountId&&(null===(e=this.isNeedMsgValidate())||void 0===e||e.then((function(e){if(t.state.needMsgValidate)return!1;t.isNeedVerifyCode()}))),this.props.dataPipeModel.registerCallback("dataCenterChange",this.dataCenterChange)}},{key:"UNSAFE_componentWillMount",value:function(){this.initAccountInfo()}},{key:"componentDidUpdate",value:function(e){e.configuration.usernamepsw!==this.props.configuration.usernamepsw&&this.initAccountInfo()}},{key:"initAccountInfo",value:function(){var e=w.q.getItem(S.Mf),t=this.props.configuration.usernamepsw;if(("1"===t||"2"===t)&&e){var n=JSON.parse(e);b.C.setValue("account",n.account),this.setState({account:n.account}),n.account?this.setState({pwdIsRemed:!0}):this.setState({pwdIsRemed:!1})}}},{key:"isNeedMsgValidate",value:function(){var e=this;return v.ox({useraccount:b.C.account,accountId:b.C.accountId,language:b.C.lang}).then((function(t){e.setState({needMsgValidate:t.isNeed,factor:t.factor}),t.isNeed&&(e.setState({needVerifyCode:!0}),e.getVerifyCode())}))}},{key:"handleLoginBtnClick",value:function(){this.setState({isKickedOut:""});var e=this.state,t=e.showPhoneCode,n=e.needVerifyCode,o=e.account,a=e.password,i=e.verifyCode,r=e.phoneCode,s=e.needMsgValidate;if(!o||!a||n&&!i||t&&!r)return!1;!t&&s?this.handleSendMessage():this.getPublickKey(this.submit)}},{key:"handleSendMessage",value:function(){var e=this,t=this.state,n=t.vCodeTime,o=t.factor;if(0!==n)return!1;v.Yf({useraccount:b.C.account,verifycode:b.C.verifyCode,loginid:this.verifyCodeToken,accountId:b.C.accountId,factor:o,language:b.C.lang}).then((function(t){if(!0!==t.success)return e.props.dataPipeModel&&e.props.dataPipeModel.sendData({type:"ShowErrorMessage",message:t.msg||t.description}),"1"===t.errorcode&&e.handleGetVerifyCode(),!1;var n=t.timeout||60;e.vCodeTimer=setInterval((function(){n<=0?clearInterval(e.vCodeTimer):e.setState({vCodeTime:--n,showPhoneCode:!0})}),1e3)}))}},{key:"showMsg",value:function(e,t,n){var o=this;e===S.mI?this.props.dataPipeModel.sendData({type:"showConfirm",data:K(K({},t),{},{callback:function(e){e===E.ue.Yes&&o.getPublickKey(o.submit,{temporaryLogin:!0})}})}):e===S._W&&this.props.dataPipeModel.sendData({type:"showConfirm",data:K({btnNames:T(T({},E.ue.Yes,(0,V.yG)("login.key110")),E.ue.No,(0,V.yG)("login.key111")),type:E.au.YesNo,callback:function(e){e!==E.ue.No&&(o.setState({isKickedOut:"3"}),o.getPublickKey(o.submit))}},n)})}},{key:"submit",value:function(e){var t,n=this,o=b.C.accountId,i=b.C.account,r=b.C.password,s=b.C.phoneCode,d=b.C.verifyCode,c=b.C.customDynamicCode,l=this.state,u=l.needVerifyCode,h=l.needMsgValidate,p=l.factor,f=l.isKickedOut,y=l.isPhoneLogin,g=(0,w.am)();g&&(g=decodeURIComponent(g));var C=b.C.dataCenter.find((function(e,t){return e.value===o}));t=C&&C.closeEncrypt?r:(0,a.U)(e.publicKey,r,null==C?void 0:C.rsaPadding);var m={accountId:o,useraccount:i,accessKey:e.accessKey,password:t,redirect:g||"mobile.html",isMobile:!0,customDynamicCode:c,randomCode:b.C.randomCode,language:b.C.lang};e.formData&&Object.assign(m,K({},e.formData)),y&&Object.assign(m,{loginType:"1"}),f&&Object.assign(m,{isKickedOut:f}),u&&(m=Object.assign(m,{verifycode:d,loginid:this.verifyCodeToken})),h&&("email"===p?Object.assign(m,{emailCode:s}):Object.assign(m,{smsCode:s})),this.handleAccountInputBlur(),v.E3(m).then((function(e){var t=e.errorcode,a=e.needChangePwd,r=e.needChangeInitialPwd,s=e.message,d=e.needActive,c=e.errorData,l=e.randomCode,u=void 0===l?"":l;if(b.C.setValue("randomCode",u),d)return window.location.hash="#activeUser",!1;if(1===a||1===r)return window.location.hash="#findPassword",n.props.dataPipeModel&&n.props.dataPipeModel.sendData({type:"ShowErrorMessage",message:s}),!1;if(0!==t)return n.loginFail(e),n.showMsg(t,c,e),!1;if(n.state.pwdIsRemed){var h=n.props.configuration.usernamepsw,p=void 0===h?"2":h,f={};"1"!==p&&"2"!==p||(f.account=i),w.q.setItem(S.Mf,JSON.stringify(f))}else w.q.removeItem(S.Mf);n.setState({logining:!1}),(0,w.Ub)(e.RedirectURL,window.location.hash,b.C.dataCenter,o)}))}},{key:"loginFail",value:function(e){"needVerification"===e.errorcode?(this.setState({needVerifyCode:!0}),this.handleGetVerifyCode()):this.props.dataPipeModel&&this.props.dataPipeModel.sendData({type:"ShowErrorMessage",message:e.description_cn||e.description}),this.resetLoginStatus()}},{key:"getVerifyCode",value:function(){var e=this;!1!==this.state.needVerifyCode&&(this.setState({verifyCodeImg:I()}),v.CE({phone:b.C.account,v:(0,k.gV)(!1,8),language:b.C.lang}).then((function(t){var n=t.description_cn||t.description;if(n)return e.props.dataPipeModel&&e.props.dataPipeModel.sendData({type:"ShowErrorMessage",message:n}),!1;e.setState({verifyCodeImg:t.content||I()}),e.verifyCodeToken=t.loginId})))}},{key:"handleGetVerifyCode",value:function(){this.getVerifyCode()}},{key:"getPublickKey",value:function(e,t){var n=this;this.setState({logining:!0});var o=b.C.account+(0,k.gV)(!1,16-b.C.account.length);v.Mh({accountId:b.C.accountId,accessKey:o,language:b.C.lang}).then((function(a){if(!0!==a.success)return n.props.dataPipeModel&&n.props.dataPipeModel.sendData({type:"ShowErrorMessage",message:a.errorMessage}),n.resetLoginStatus(),!1;e({publicKey:a.publicKey,accessKey:o,formData:t})}))}},{key:"resetLoginStatus",value:function(){this.setState({logining:!1})}},{key:"isNeedVerifyCode",value:function(){var e=this;v.Q9({useraccount:b.C.account,accountId:b.C.accountId,v:(0,k.gV)(!1,8),language:b.C.lang}).then((function(t){e.setState({needVerifyCode:t.isNeed}),t.isNeed&&e.handleGetVerifyCode()}))}},{key:"handleAccountInputBlur",value:function(){var e,t=this;null===(e=this.isNeedMsgValidate())||void 0===e||e.then((function(){if(t.state.needMsgValidate)return!1;t.isNeedVerifyCode()}))}},{key:"getLoginBtnText",value:function(){var e=this.state,t=e.logining,n=e.needMsgValidate,o=e.showPhoneCode,a=e.factor;return n&&!o?"email"===a?(0,V.yG)("login.key172"):(0,V.yG)("login.key173"):t?(0,V.yG)("login.key174"):(0,V.yG)("login.key175")}},{key:"renderPhoneCodeItem",value:function(){var e=this.state,t=e.showPhoneCode,n=e.vCodeTime,a=e.factor,i=0===n?(0,V.yG)("login.key176"):(0,V.yG)({key:"login.key177",variables:{vCodeTime:n}}),s=r()(T(T({},d,!0),p,!t)),u=r()(T(T({},c,!0),l,0!==n)),h=a?(0,V.yG)("login.key178"):(0,V.yG)("login.key179");return o.createElement("div",{className:s},o.createElement(m.EF,{dataPipeModel:this.props.dataPipeModel,onChange:this.handleChange,name:"phoneCode",type:"text",placeholder:h,style:{flexGrow:1,width:180}}),o.createElement("div",{className:u,onClick:this.handleSendMessage},i))}},{key:"renderVerityCodeItem",value:function(){var e=this.state,t=e.needVerifyCode,n=e.verifyCodeImg,a=r()(T(T({},u,!0),p,!t));return o.createElement("div",{className:a},o.createElement(m.EF,{dataPipeModel:this.props.dataPipeModel,onChange:this.handleChange,name:"verifyCode",placeholder:(0,V.yG)("login.key180"),style:{flexGrow:1,width:180,border:"none"}}),o.createElement("div",{className:h,onClick:this.handleGetVerifyCode},o.createElement("img",{src:n})))}},{key:"handleChange",value:function(e,t){this.setState(T({},e,t))}},{key:"dataCenterChange",value:function(){var e,t=this,n=null===(e=b.C.dataCenter.find((function(e,n){return e.value===t.props.currentAccountId})))||void 0===e?void 0:e.needCustomDynamicCode;n!==this.state.needCustomDynamicCode&&this.setState({needCustomDynamicCode:n})}},{key:"handleRememberPwd",value:function(e){this.setState({pwdIsRemed:e})}},{key:"render",value:function(){var e=this.props,t=e.dataCenter,n=e.currentAccountId,a=e.handleChangeDataCenter,i=e.configuration,r=this.state,d=r.showPhoneCode,c=r.needVerifyCode,l=r.account,u=r.password,h=r.verifyCode,p=r.phoneCode,v=r.pwdIsRemed,k=r.isPhoneLogin,w=!l||!u||c&&!h||d&&!p?{background:"#85B8FF"}:{},M="true"===i.isGlobalDeploy||!0===i.isGlobalDeploy;return o.createElement(O.c,A({},this.props,{lang:b.C.lang}),o.createElement("div",{className:s},k?(0,V.yG)("login.key214"):(0,V.yG)("login.key213")," "),o.createElement(m.k9,{name:"accountId",dataPipeModel:this.props.dataPipeModel,list:t,selectItem:n,onItemClick:a}),k?o.createElement(N.c,{defaultAreaCode:this.props.configuration.defaultAreaCode,dataPipeModel:this.props.dataPipeModel,telViaList:this.props.countryAreaCodes,onChange:this.handleChange,name:"account",placeholder:(0,P.WQ)(i.accountplaceholder,"zh_CN",(0,V.yG)("login.key210")),type:"text",onBlur:this.handleAccountInputBlur,defaultValue:b.C.account}):o.createElement(m.EF,{dataPipeModel:this.props.dataPipeModel,onChange:this.handleChange,name:"account",placeholder:(0,P.WQ)(i.accountplaceholder,"zh_CN",(0,V.yG)("login.key210")),type:"text",onBlur:this.handleAccountInputBlur,defaultValue:b.C.account}),o.createElement(m.EF,{dataPipeModel:this.props.dataPipeModel,onChange:this.handleChange,name:"password",placeholder:(0,V.yG)("login.key182"),type:"password"}),this.renderVerityCodeItem(),this.renderPhoneCodeItem(),this.state.needCustomDynamicCode&&o.createElement(m.EF,{dataPipeModel:this.props.dataPipeModel,onChange:this.handleChange,name:"customDynamicCode",type:"text",placeholder:(0,V.yG)("login.key183")}),o.createElement(_,{configuration:i,pwdIsRemed:v,onRememberPwd:this.handleRememberPwd}),o.createElement(m.q,{dataPipeModel:this.props.dataPipeModel,style:w,text:this.getLoginBtnText(),onClick:this.handleLoginBtnClick}),o.createElement("div",{className:y},o.createElement("div",{className:g,onClick:this.handleLoginTypeClick}," ",k?(0,V.yG)("login.key213"):(0,V.yG)("login.key214")),M?null:o.createElement(o.Fragment,null,o.createElement("div",{className:C}),o.createElement("div",{className:f,onClick:function(){window.location.hash="msgLogin"}}," ",(0,V.yG)("login.key212")))))}}])&&B(n.prototype,i),M&&B(n,M),Object.defineProperty(n,"prototype",{writable:!1}),t}(o.Component)}}]);