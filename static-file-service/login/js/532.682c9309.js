(self.webpackChunkkd_login=self.webpackChunkkd_login||[]).push([[532],{3532:function(e,t,n){"use strict";n.r(t),n.d(t,{ModifyPanel:function(){return W},default:function(){return Y}});n(82320),n(9112),n(97060),n(60776),n(43924),n(5960),n(97336),n(46428),n(8896),n(6200),n(70864),n(80920),n(87912),n(36887),n(78504),n(77864),n(86744);var o=n(85668),a=n(12356),r=n(71252),i=n.n(r),s=n(90923),d="oCitc5BY",c="_2qQ5P_a4",l="_3A14-ygE",u="PrsEK0jn",p="kD9EbtqD",h="_1g_MFdcW",y="_3ddIBRya",f="_1nTuxMGB",C="_1u5meyPk",g="_2uHTK2hj",m=n(82724),v=n(74800),P=n(25128),k=n(82499),M=n(61076),w=n.n(M),b=n(3468),E=n.n(b),S=n(56284),A=n(82784),G=n(10327),I=n(57768),D=n(82100);function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function T(e,t,n){return(t=x(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function K(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,x(o.key),o)}}function j(e,t,n){return t&&K(e.prototype,t),n&&K(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function x(e){var t=function(e,t){if("object"!=F(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=F(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==F(t)?t:String(t)}function N(e,t,n){return t=q(t),function(e,t){if(t&&("object"===F(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return O(e)}(e,H()?Reflect.construct(t,n||[],q(e).constructor):t.apply(e,n))}function H(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(H=function(){return!!e})()}function q(e){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},q(e)}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&V(e,t)}function V(e,t){return V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},V(e,t)}var U=function(e){function t(e){var n;return B(this,t),(n=N(this,t,[e])).state={showModifyPanel:!1,showSuccessPanel:!1,newPassword:"",confirmPassword:""},n.showModifyPanel=n.showModifyPanel.bind(O(n)),n}return Q(t,e),j(t,[{key:"showModifyPanel",value:function(){this.setState({showModifyPanel:!0})}},{key:"componentDidMount",value:function(){P.C.setValue("password","")}},{key:"render",value:function(){var e=this.state.showModifyPanel;return o.createElement(S.c,this.props,e?o.createElement(W,{dataPipeModel:this.props.dataPipeModel}):o.createElement(R,{configuration:this.props.configuration,dataPipeModel:this.props.dataPipeModel,showModifyPanel:this.showModifyPanel,telViaList:this.props.countryAreaCodes}))}}]),t}(o.Component),R=function(e){function t(e){var n;return B(this,t),(n=N(this,t,[e])).state={verifyCodeImg:w(),vCodeTime:0,account:"",verifyCode:"",phoneCode:""},n.oldAccount=P.C.account,n.getVerifyCode=n.getVerifyCode.bind(O(n)),n.handlePhoneCodeBtnClick=n.handlePhoneCodeBtnClick.bind(O(n)),n.handleNextBtnClick=n.handleNextBtnClick.bind(O(n)),n.resetPhoneCodeState=n.resetPhoneCodeState.bind(O(n)),n.handleAccountInputBlur=n.handleAccountInputBlur.bind(O(n)),n.handleChange=n.handleChange.bind(O(n)),n.handleClick=n.handleClick.bind(O(n)),n.resetPassword=n.resetPassword.bind(O(n)),n.renderSuccessPanel=n.renderSuccessPanel.bind(O(n)),n.handleChange=n.handleChange.bind(O(n)),n}return Q(t,e),j(t,[{key:"componentDidMount",value:function(){this.getVerifyCode()}},{key:"getVerifyCode",value:function(){var e=this;k.G8({phone:P.C.account,language:P.C.lang}).then((function(t){e.setState({verifyCodeImg:t.content||w()}),e.verifyCodeToken=t.vCode,P.C.setValue("randomCode",t.vCode)}))}},{key:"handlePhoneCodeBtnClick",value:function(){return 0===this.state.vCodeTime&&(!!this.checkFormData()&&void this.verifyGraphicCode())}},{key:"verifyGraphicCode",value:function(){var e=this;k.qS({phone:P.C.account,vCode:P.C.verifyCode,token:this.verifyCodeToken,language:P.C.lang}).then((function(t){if(!t.success)return e.props.dataPipeModel&&e.props.dataPipeModel.sendData({type:"ShowErrorMessage",message:t.msg}),e.getVerifyCode(),!1;e.verifyPhone()}))}},{key:"verifyPhone",value:function(){var e=this;k.k$({phone:P.C.account,accountId:P.C.accountId,vCode:this.verifyCodeToken,language:P.C.lang}).then((function(t){if(t.success)if(t.hasSent){var n={message:t.msg};e.props.dataPipeModel&&e.props.dataPipeModel.sendData({type:"ShowErrorMessage",error:n})}else{var o=t.vCodeTime/1e3||10;e.vCodeTimer=setInterval((function(){o<=0?clearInterval(e.vCodeTimer):e.setState({vCodeTime:--o})}),1e3)}else{var a={message:t.msg};e.props.dataPipeModel&&e.props.dataPipeModel.sendData({type:"ShowErrorMessage",error:a}),e.resetPhoneCodeState()}}))}},{key:"resetPhoneCodeState",value:function(){clearInterval(this.vCodeTimer),this.setState({vCodeTime:0})}},{key:"handleNextBtnClick",value:function(){var e=this,t=this.state,n=t.account,o=t.verifyCode,a=t.phoneCode;if(!n&&!P.C.account||!o||!a)return!1;k.iG({accountId:P.C.accountId,phone:P.C.account,code:P.C.phoneCode,language:P.C.lang}).then((function(t){if(t.success)P.C.setValue("randomCode",t.randomCode),e.props.showModifyPanel();else{var n={message:t.msg};e.props.dataPipeModel&&e.props.dataPipeModel.sendData({type:"ShowErrorMessage",error:n}),t.refreshCode&&e.resetPhoneCodeState()}}))}},{key:"checkFormData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=P.C.account,n=P.C.verifyCode,o=P.C.phoneCode;return v.q4.isEmpty(t)?(this.props.dataPipeModel&&this.props.dataPipeModel.sendData({type:"ShowErrorMessage",message:(0,A.yG)("login.key153")}),!1):v.q4.isEmpty(n)||e&&v.q4.isEmpty(o)?(this.props.dataPipeModel&&this.props.dataPipeModel.sendData({type:"ShowErrorMessage",message:(0,A.yG)("login.key154")}),!1):(this.props.dataPipeModel&&this.props.dataPipeModel.sendData({type:"HideNotification"}),!0)}},{key:"handleAccountInputBlur",value:function(){var e=P.C.account;e!==this.oldAccount&&(this.oldAccount=e,this.getVerifyCode())}},{key:"handleChange",value:function(e,t){this.setState(T({},e,t))}},{key:"handleClick",value:function(){var e=this.state;e.newPassword,e.confirmPassword;if(!this.checkFormData()||!this.validateFormData())return!1;this.getPublicKey(this.resetPassword)}},{key:"validateFormData",value:function(){var e=P.C.newPassword,t=P.C.confirmPassword;return v.q4.isEmpty(e)||v.q4.isEmpty(t)?(this.props.dataPipeModel&&this.props.dataPipeModel.sendData({type:"ShowErrorMessage",message:(0,A.yG)("login.key156")}),!1):1===v.q4.checkLength(e,0,20)?(this.props.dataPipeModel&&this.props.dataPipeModel.sendData({type:"ShowErrorMessage",message:(0,A.yG)("login.key157")}),!1):!!v.q4.isEqual(e,t)||(this.props.dataPipeModel&&this.props.dataPipeModel.sendData({type:"ShowErrorMessage",message:(0,A.yG)("login.key158")}),!1)}},{key:"getPublicKey",value:function(e){var t=this,n=P.C.account+(0,v.gV)(!1,16-P.C.account.length);k.Mh({accessKey:n,accountId:P.C.accountId,language:P.C.lang}).then((function(o){if(!0!==o.success){var a={message:o.errorMessage};return t.props.dataPipeModel&&t.props.dataPipeModel.sendData({type:"ShowErrorMessage",error:a}),!1}e({publicKey:o.publicKey,accessKey:n})}))}},{key:"resetPassword",value:function(e){var t=this,n=P.C.accountId,o=P.C.account,a=P.C.newPassword;k.Uj({accountId:n,phone:o,accessKey:e.accessKey,password:(0,s.U)(e.publicKey,a),randomCode:P.C.randomCode,code:P.C.phoneCode,language:P.C.lang}).then((function(e){if(e.success)t.setState({showSuccessPanel:!0}),setTimeout((function(){window.location.hash=""}),2e3);else{var n={message:e.msg||e.error};t.props.dataPipeModel&&t.props.dataPipeModel.sendData({type:"ShowErrorMessage",error:n}),e.overtime&&setTimeout((function(){window.location.reload()}),2e3)}}))}},{key:"renderSuccessPanel",value:function(){return this.state.showSuccessPanel?a.createPortal(o.createElement("div",{className:f},o.createElement("img",{src:E()}),o.createElement("div",null,(0,A.yG)("login.key159"))),document.body):null}},{key:"render",value:function(){var e=this.state,t=e.verifyCodeImg,n=e.vCodeTime,a=0===n?(0,A.yG)("login.key160"):(0,A.yG)({key:"login.key161",variables:{vCodeTime:n}}),r=i()(T(T({},h,!0),y,0!==n)),s={flexGrow:1,width:180,border:"none"},f=G.q.getItem((0,G.iW)(I.EF));return o.createElement(o.Fragment,null,o.createElement("div",{className:d},(0,A.yG)("login.key162")),o.createElement(D.c,{defaultAreaCode:this.props.configuration.defaultAreaCode,dataPipeModel:this.props.dataPipeModel,telViaList:this.props.telViaList,name:"account",onChange:this.handleChange,defaultValue:P.C.account,placeholder:(0,A.yG)("login.key163"),onBlur:this.handleAccountInputBlur}),o.createElement("div",{className:c},o.createElement(m.EF,{dataPipeModel:this.props.dataPipeModel,onChange:this.handleChange,name:"verifyCode",placeholder:(0,A.yG)("login.key164"),style:s}),o.createElement("div",{className:l,onClick:this.getVerifyCode},o.createElement("img",{src:t}))),o.createElement("div",{className:u},o.createElement(m.EF,{dataPipeModel:this.props.dataPipeModel,onChange:this.handleChange,name:"phoneCode",placeholder:(0,A.yG)("login.key165"),style:s}),o.createElement("div",{className:p},o.createElement("div",{className:r,onClick:this.handlePhoneCodeBtnClick},a))),o.createElement(m.EF,{dataPipeModel:this.props.dataPipeModel,onChange:this.handleChange,name:"newPassword",type:"password",placeholder:(0,A.yG)("login.key166")}),o.createElement(m.EF,{dataPipeModel:this.props.dataPipeModel,onChange:this.handleChange,name:"confirmPassword",type:"password",placeholder:(0,A.yG)("login.key167")}),o.createElement(m.q,{text:(0,A.yG)("login.key171"),onClick:this.handleClick}),o.createElement("div",{className:C},o.createElement("a",{className:g,href:"#kingdeeCloud"},f===I.Af?"<".concat((0,A.yG)("login.key218")):"<".concat((0,A.yG)("login.key217")))))}}]),t}(o.Component),W=function(e){function t(e){var n;return B(this,t),(n=N(this,t,[e])).state={showSuccessPanel:!1,newPassword:"",confirmPassword:""},n.handleClick=n.handleClick.bind(O(n)),n.resetPassword=n.resetPassword.bind(O(n)),n.renderSuccessPanel=n.renderSuccessPanel.bind(O(n)),n.handleChange=n.handleChange.bind(O(n)),n}return Q(t,e),j(t,[{key:"handleClick",value:function(){var e=this.state,t=e.newPassword,n=e.confirmPassword;if(!t||!n||!this.validateFormData())return!1;this.getPublicKey(this.resetPassword)}},{key:"render",value:function(){var e=this.state,t=e.newPassword,n=e.confirmPassword,a=t&&n?{marginTop:"60px"}:{background:"#85B8FF",marginTop:"60px"};return o.createElement(o.Fragment,null,o.createElement("div",{className:d},(0,A.yG)("login.key168")),o.createElement(m.EF,{dataPipeModel:this.props.dataPipeModel,onChange:this.handleChange,name:"newPassword",type:"password",placeholder:(0,A.yG)("login.key169")}),o.createElement(m.EF,{dataPipeModel:this.props.dataPipeModel,onChange:this.handleChange,name:"confirmPassword",type:"password",placeholder:(0,A.yG)("login.key170")}),o.createElement(m.q,{text:(0,A.yG)("login.key171"),style:a,onClick:this.handleClick}),this.renderSuccessPanel())}}]),t}(o.Component),Y=U},3468:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHQAAABOCAMAAADGpcLeAAAAk1BMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ROyVeAAAAMHRSTlMA+YHRlYzI7cxMQ/bnLg38Uz8oIAcD8b/fuId4E9aZRzUX45FyY45qTxvasaKDWqzZCH2cAAADKklEQVRo3sWa23qqMBCFQU4KCFZQwTOetdqu93+6XSvxQwSbZIL7vzYukgwrMxk0FQTufp0aiaPrTmKk670baM0ycMd2iBKhPXYHWlN0LR81+FZXa4KOjZfYHeWSBwN/YvSUSvZTcDHqK5OMLzo40cexGs3IhgDtSMluOhBiqGBnNxBmQtW0IMGOpjmHFGfaPCXZvXM/6ft6AAHJGI4cEBhGUj5kg0RbxptaIDKW8HgdRHRx909BZkSI3PdFcBsKMMQ0F1CCWAYzghJsodCFFM56Y4YoIpIjjiHD5Zp2f6GIJZBTr2R87/A7dooiPn8W/gFxVvlKbvGAyy16kXDa7DZ06cl6objVfwZ55eHLxm8gbLvrQa7poEQYNLSl4SYfuByCIbypWwjh9djDDvHMvpF0zFnmw1yvcuU5RT+FXpU+s2sPVaQNnDCzI9PUaSfNCU/4Ts1fTv/QRMIp6j9tW0+Lt94rzY5eu+Wcok9/v/h9H3yUOWUshnTUocuJslznaJRjKGLvigey6KrsccypUhQZdoueQF3eGR7x2IwG56IPLbQH7yMGkv0cLxW+sdVuHFdKkrP0eWSm5eyQc2FrboBBMocdnkiiUpl85rWvNcHw7243+MYPdlxZ8RAMf4kKfBar8QhIMmYKeET+aIvDl6fJdOZ1a0tYsUM8+7hjhahUvUt12NO1aem2ib/xy8X1nFakfoGH01R4kEu/LxrFxdqj2nH5k+2J+K1UXOMK/GXFNAEfLY4o4C6ggo05n8/T2Q+Jjhd8sVJdcal4nKEeb3n7jSNQFNPrcP+qmtnKy/8pXqHPtxdf/UWHCyWMhCZqgKHk8ipzy62x3ti6YbdzZh6UcGEmsjZNKxMqIegXkhPzh63Q7tGvXndX0YlQVUi/ottfRYuB3A3RDIWZTVumuXmIpA2HKrVxMIiOpcMmW3QYh1aJuY//0CIJEsl5ktg01h6hpTHqG3xnMN7WyownYKhv2va/21aQW/HodDr5+o0QddDb08fh/RzqgQd6I56lgn3iNbrdkeg1dbnvP+kfV7BmkzH4NWdwQv+MZGEMP6N8qVecSp7H+cHMP6jqhomrZz1KAAAAAElFTkSuQmCC"}}]);