var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(O,ka,ma){O instanceof String&&(O=String(O));for(var qa=O.length,la=0;la<qa;la++){var sa=O[la];if(ka.call(ma,sa,la,O))return{i:la,v:sa}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(O,ka,ma){if(O==Array.prototype||O==Object.prototype)return O;O[ka]=ma.value;return O};$jscomp.getGlobal=function(O){O=["object"==typeof globalThis&&globalThis,O,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var ka=0;ka<O.length;++ka){var ma=O[ka];if(ma&&ma.Math==Math)return ma}throw Error("Cannot find global object");};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(O,ka){var ma=$jscomp.propertyToPolyfillSymbol[ka];if(null==ma)return O[ka];ma=O[ma];return void 0!==ma?ma:O[ka]};
$jscomp.polyfill=function(O,ka,ma,qa){ka&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(O,ka,ma,qa):$jscomp.polyfillUnisolated(O,ka,ma,qa))};$jscomp.polyfillUnisolated=function(O,ka,ma,qa){ma=$jscomp.global;O=O.split(".");for(qa=0;qa<O.length-1;qa++){var la=O[qa];if(!(la in ma))return;ma=ma[la]}O=O[O.length-1];qa=ma[O];ka=ka(qa);ka!=qa&&null!=ka&&$jscomp.defineProperty(ma,O,{configurable:!0,writable:!0,value:ka})};
$jscomp.polyfillIsolated=function(O,ka,ma,qa){var la=O.split(".");O=1===la.length;qa=la[0];qa=!O&&qa in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var sa=0;sa<la.length-1;sa++){var oa=la[sa];if(!(oa in qa))return;qa=qa[oa]}la=la[la.length-1];ma=$jscomp.IS_SYMBOL_NATIVE&&"es6"===ma?qa[la]:null;ka=ka(ma);null!=ka&&(O?$jscomp.defineProperty($jscomp.polyfills,la,{configurable:!0,writable:!0,value:ka}):ka!==ma&&(void 0===$jscomp.propertyToPolyfillSymbol[la]&&(ma=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[la]=
$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(la):$jscomp.POLYFILL_PREFIX+ma+"$"+la),$jscomp.defineProperty(qa,$jscomp.propertyToPolyfillSymbol[la],{configurable:!0,writable:!0,value:ka})))};$jscomp.polyfill("Array.prototype.find",function(O){return O?O:function(ka,ma){return $jscomp.findInternal(this,ka,ma).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(O){var ka=0;return function(){return ka<O.length?{done:!1,value:O[ka++]}:{done:!0}}};$jscomp.arrayIterator=function(O){return{next:$jscomp.arrayIteratorImpl(O)}};
$jscomp.initSymbol=function(){};$jscomp.polyfill("Symbol",function(O){if(O)return O;var ka=function(sa,oa){this.$jscomp$symbol$id_=sa;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:oa})};ka.prototype.toString=function(){return this.$jscomp$symbol$id_};var ma="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",qa=0,la=function(sa){if(this instanceof la)throw new TypeError("Symbol is not a constructor");return new ka(ma+(sa||"")+"_"+qa++,sa)};return la},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(O){if(O)return O;O=Symbol("Symbol.iterator");for(var ka="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ma=0;ma<ka.length;ma++){var qa=$jscomp.global[ka[ma]];"function"===typeof qa&&"function"!=typeof qa.prototype[O]&&$jscomp.defineProperty(qa.prototype,O,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return O},
"es6","es3");$jscomp.iteratorPrototype=function(O){O={next:O};O[Symbol.iterator]=function(){return this};return O};$jscomp.iteratorFromArray=function(O,ka){O instanceof String&&(O+="");var ma=0,qa=!1,la={next:function(){if(!qa&&ma<O.length){var sa=ma++;return{value:ka(sa,O[sa]),done:!1}}qa=!0;return{done:!0,value:void 0}}};la[Symbol.iterator]=function(){return la};return la};
$jscomp.polyfill("Array.prototype.keys",function(O){return O?O:function(){return $jscomp.iteratorFromArray(this,function(ka){return ka})}},"es6","es3");
(function(){function O(){var qa,la,sa,oa,X,va,Y,t,ya,Fa=[],Ga=[],Oa=this;this.setId=function(fa){qa=fa};this.getId=function(){return qa};this.setCodeNumber=function(fa){la=fa};this.getCodeNumber=function(){return la};this.setName=function(fa){sa=fa};this.getName=function(){return sa};this.setDesc=function(fa){oa=fa};this.getDesc=function(){return oa};this.setCreatorId=function(fa){X=fa};this.getCreatorId=function(){return X};this.setCreatorName=function(fa){va=fa};this.getCreatorName=function(){return va};
this.setEnabled=function(fa){Y=fa};this.isEnabled=function(){return Y};this.getUsers=function(){return Fa};this.setUsers=function(fa){Fa=fa};this.getRoles=function(){return Ga};this.setRoles=function(fa){Ga=fa};this.setShared=function(fa){t=fa};this.isShared=function(){return t};this.isPreset=function(){return ya};this.setPreset=function(fa){ya=fa};this.copy=function(){var fa=new O;fa.setId(qa);fa.setCodeNumber(la);fa.setName(sa);fa.setDesc(oa);fa.setEnabled(Y);fa.setCreatorId(X);fa.setCreatorName(va);
fa.setShared(t);fa.setPreset(ya);return fa};this.fromJsonObject=function(fa){Oa.setId(fa.id);Oa.setCodeNumber(fa.number);Oa.setName(fa.name);Oa.setDesc(fa.desc);Oa.setEnabled(!fa.disabled);Oa.setCreatorId(fa.creatorId);Oa.setCreatorName(fa.creatorName);Oa.setPreset(fa.preset);var Ra=[],ta=fa.users;if(ta){for(var Wa=0;Wa<ta.length;Wa++){var G=new ka;G.fromJsonObject(ta[Wa]);Ra.push(G)}Oa.setUsers(Ra)}Ra=[];if(ta=fa.roles){for(Wa=0;Wa<ta.length;Wa++)G=new ka,G.fromJsonObject(ta[Wa]),Ra.push(G);Oa.setRoles(Ra)}t=
fa.shared};this.toJsonObject=function(){var fa={};fa.number=la;fa.name=sa;fa.desc=oa;fa.disabled=!Y;fa.id=qa;fa.creatorId=X;fa.preset=ya;for(var Ra=[],ta=0;ta<Fa.length;ta++)Ra.push(Fa[ta].toJsonObject());fa.users=Ra;Ra=[];for(ta=0;ta<Ga.length;ta++)Ra.push(Ga[ta].toJsonObject());fa.roles=Ra;fa.shared=t;return fa}}function ka(){var qa=this,la,sa,oa;this.getValue=function(){return la};this.setValue=function(X){la=X};this.getText=function(){return sa};this.setText=function(X){sa=X};this.getUserObject=
function(){return oa};this.setUserObject=function(X){oa=X};this.toJsonObject=function(){var X={};X.value=la;X.text=sa;return X};this.fromJsonObject=function(X){X&&(X.value&&qa.setValue(X.value),X.text&&qa.setText(X.text))}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler=
{});"undefined"==typeof com.kingdee.bos.qing.modeler.metriclibrary&&(com.kingdee.bos.qing.modeler.metriclibrary={});"undefined"==typeof com.kingdee.bos.qing.modeler.metriclibrary.system&&(com.kingdee.bos.qing.modeler.metriclibrary.system={});var ma=com.kingdee.bos.qing.modeler.metriclibrary.system;ma.MetricSystem=O;ma.ValueTextPair=ka;com.kingdee.bos.qing.framework.common.MultilanguageManager.createPackageAccessor(ma);O.NOT_PRESET_SYSTEM=1;O.PRESET_SYSTEM=2})();(function(){function O(){var G,M,T,R;this.setId=function(C){G=C};this.getId=function(){return G};this.setName=function(C){M=C};this.getName=function(){return M};this.setType=function(C){T=C};this.getType=function(){return T};this.setLevel=function(C){R=C};this.getLevel=function(){return R};this.protectedMethod={toJsonObject:function(){var C={};C.id=G;C.name=M;C.type=T;C.level=R;return C},fromJsonObject:function(C){G=C.id;M=C.name;T=C.type;R=C.level}}}function ka(){O.call(this);var G=this.protectedMethod,
M=this,T,R,C=[],U,ja=0;this.setParentId=function(I){T=I};this.getParentId=function(){return T};this.setParentNode=function(I){R=I};this.getParentNode=function(){return R};this.setChildren=function(I){C=I};this.getChildren=function(){return C};this.setMetrics=function(I){U=I};this.getMetrics=function(){return U};this.setTotalRow=function(I){ja=I};this.getTotalRow=function(){return ja};this.getAllChildId=function(I){for(var La=M.getChildren(),ua=0;ua<La.length;ua++){var Ea=La[ua];I.push(Ea.getId());
Ea.getAllChildId(I)}};this.fromJsonObject=function(I){G.fromJsonObject(I);if((I=I.children)&&0<I.length)for(var La=0;La<I.length;La++){var ua=I[La],Ea=new ka;Ea.fromJsonObject(ua);Ea.setParentNode(M);C.push(Ea)}Ga.CatalogNodeCacheHelper.addCatalogNode(M)};this.toJsonObject=function(){var I=G.toJsonObject();I.parentId=T;return I}}function ma(){var G,M,T,R,C,U,ja,I,La,ua=!1,Ea,za,Ua,f,Za,Ya,Ja,ra,xa=!1,$a,gb=[];this.setId=function(S){G=S};this.getId=function(){return G};this.setMetricId=function(S){M=
S};this.getMetricId=function(){return M};this.setModelId=function(S){T=S};this.getModelId=function(){return T};this.setCatalogId=function(S){R=S};this.getCatalogId=function(){return R};this.setNumber=function(S){C=S};this.getNumber=function(){return C};this.setMetricName=function(S){U=S};this.getMetricName=function(){return U};this.setDesc=function(S){ja=S};this.getDesc=function(){return ja};this.setExpr=function(S){I=S};this.getExpr=function(){return I};this.setDimension=function(S){La=S};this.getDimension=
function(){return La};this.setDigest=function(S){ua=S};this.isDigest=function(){return ua};this.setWholeDimension=function(S){Ea=S};this.getWholeDimension=function(){return Ea};this.setPath=function(S){za=S};this.getPath=function(){return za};this.setMetricCreator=function(S){Ua=S};this.getMetricCreator=function(){return Ua};this.setAddTime=function(S){Za=S};this.getAddTime=function(){return Za};this.setDisplayAddTime=function(S){Ya=S};this.getDisplayAddTime=function(){return Ya};this.getAddPeople=
function(){return f};this.setDataUpdateTime=function(S){Ja=S};this.getDataUpdateTime=function(){return Ja};this.setDisplayDataUpdateTime=function(S){ra=S};this.getDisplayDataUpdateTime=function(){return ra};this.isPreset=function(){return xa};this.hasLicence=function(){return $a};this.setPreset=function(S){xa=S};this.getFilterItems=function(){return gb};this.toJsonObject=function(){var S={};S.id=G;S.metricId=M;S.modelId=T;S.catalogId=R;S.number=C;S.metricName=U;S.desc=ja;S.expr=I;S.dimension=La;S.isDigest=
ua;S.path=za;S.metricCreator=Ua;S.addTime=Za;S.displayAddTime=Ya;S.dataUpdateTime=Ja;S.displayDataUpdateTime=ra;S.isPreset=xa;return S};this.fromJsonObject=function(S){G=S.id;M=S.metricId;T=S.modelId;R=S.catalogId;C=S.number;U=S.metricName;ja=S.desc;S.expr&&(I=new qa,I.fromJsonObject(S.expr));if(S.filterConfig)for(var jb=S.filterConfig.filterItems,db=0;db<jb.length;db++){var hb=new X;hb.fromJsonObject(jb[db]);gb.push(hb)}La=S.dimension;ua="0"===S.isDigest;za=S.path;Ua=S.metricCreator;f=S.addPeople;
Za=S.addTime;Ya=S.displayAddTime;ra=S.displayDataUpdateTime;Ja=S.dataUpdateTime;xa=S.isPreset;$a=S.hasLicence}}function qa(){var G=this,M=[];this.setExprSegments=function(T){M=T};this.getExprSegments=function(){return M};this.fromJsonObject=function(T){T=T.exprSegments;for(var R=0;R<T.length;R++){var C=T[R],U=new la;U.fromJsonObject(C);M.push(U)}};this.getDisplayExpr=function(){for(var T="",R=0;R<M.length;R++){var C=M[R].getContent();T+=C}return T};this.getDisplayExprJqUi=function(){var T=$("<span>"),
R=G.getExprSegments(),C=G.getDisplayExpr();T.attr("title",C);for(C=0;C<R.length;C++){var U=R[C].getTextSegment();U=$("<span>").text(U.getText()).css("color",U.getColor());T.append(U)}return T}}function la(){function G(I){C.call(this,I,"#666")}function M(I){C.call(this,I,"#e8893a")}function T(I){C.call(this,I,"#16B0F1")}function R(I){C.call(this,I,"#789262")}function C(I,La){this.getText=function(){return I};this.getColor=function(){return La}}var U,ja;this.setType=function(I){U=I};this.getType=function(){return U};
this.setContent=function(I){ja=I};this.getContent=function(){return ja};this.getTextSegment=function(){switch(U){case la.TEXT:return new G(ja);case la.FIELD:return new T(ja);case la.METRIC:return new M(ja);case la.DIMENSION:return new R(ja)}};this.fromJsonObject=function(I){U=I.contentType;ja=I.content}}function sa(){var G=0,M=1,T,R=[];this.getTotalRow=function(){return G};this.getCurrentPage=function(){return M};this.getPageSize=function(){return T};this.getMetrics=function(){return R};this.fromJsonObject=
function(C){if(C&&(G=C.totalRow,M=C.currentPage,T=C.pageSize,(C=C.metrics)&&0<C.length))for(var U=0;U<C.length;U++){var ja=C[U],I=new ma;I.fromJsonObject(ja);R.push(I)}}}function oa(){var G,M,T,R,C,U,ja,I,La,ua,Ea,za,Ua,f,Za,Ya,Ja=[];this.isPresetMetric=function(){return f};this.equals=function(ra){return G==ra.getId()};this.getId=function(){return G};this.getModelSetId=function(){return M};this.getModelId=function(){return T};this.getMetricId=function(){return R};this.getNumber=function(){return C};
this.getName=function(){return U};this.getDesc=function(){return ja};this.setPath=function(ra){I=ra};this.getPath=function(){return I};this.setDataUpdateTime=function(ra){za=ra};this.getDataUpdateTime=function(){return za};this.setDisplayDataUpdateTime=function(ra){Ua=ra};this.getDisplayDataUpdateTime=function(){return Ua};this.setDimension=function(ra){La=ra};this.getDimension=function(){return La};this.setWholeDimension=function(ra){ua=ra};this.getWholeDimension=function(){return ua};this.setDigest=
function(ra){Za=ra==oa.DIMENSION_IS_DIGEST};this.isDigest=function(){return Za};this.getExpr=function(){return Ya};this.getFilterItems=function(){return Ja};this.getCreator=function(){return Ea};this.fromJsonObject=function(ra){G=ra.id;M=ra.modelSetId;T=ra.modelId;R=ra.metricId;C=ra.number;U=ra.name;ja=ra.desc;Ea=ra.creator;f=ra.preset;!C&&(C="");!ja&&(ja="");ra.expr&&(Ya=new qa,Ya.fromJsonObject(ra.expr));if(ra.filterConfig){ra=ra.filterConfig.filterItems;for(var xa=0;xa<ra.length;xa++){var $a=new X;
$a.fromJsonObject(ra[xa]);Ja.push($a)}}};this.toJsonObject=function(){var ra={};ra.id=G;ra.modelSetId=M;ra.modelId=T;ra.metricId=R;ra.number=C;ra.name=U;return ra}}function X(){var G,M,T,R=0,C=0,U,ja=null;this.fromJsonObject=function(ua){ua&&(G=ua.fieldName,M=ua.compareOp,T=ua.displayValue,R=ua.leftBrackets,C=ua.rightBrackets,U=ua.logicOp,ua=ua.relativeDateRange)&&(ja=new Oa,ja.fromJsonObject(ua))};this.getDisplayText=function(){var ua=La(!0,R),Ea=G+" ";switch(M){case X.COMPARE_EQUAL:var za=ta.get("equal",
"\u7b49\u4e8e");break;case X.COMPARE_NOT_EQUAL:za=ta.get("notEqual","\u4e0d\u7b49\u4e8e");break;case X.COMPARE_GREATER:za=ta.get("greater","\u5927\u4e8e");break;case X.COMPARE_GREATER_EQUAL:za=ta.get("equalOrGreater","\u5927\u4e8e\u7b49\u4e8e");break;case X.COMPARE_LESS:za=ta.get("less","\u5c0f\u4e8e");break;case X.COMPARE_LESS_EQUAL:za=ta.get("equalOrLess","\u5c0f\u4e8e\u7b49\u4e8e");break;case X.COMPARE_INCLUDE:za=ta.get("include","\u5305\u542b");break;case X.COMPARE_NOT_INCLUDE:za=ta.get("notInclude",
"\u4e0d\u5305\u542b");break;case X.COMPARE_START_WITH:za=ta.get("startWith","\u5f00\u5934\u662f");break;case X.COMPARE_END_WITH:za=ta.get("endWith","\u7ed3\u5c3e\u662f");break;case X.COMPARE_NULL:za=ta.get("compareNull","\u4e3a\u7a7a");break;case X.COMPARE_NOT_NULL:za=ta.get("compareNotNull","\u4e0d\u4e3a\u7a7a");break;case X.COMPARE_IN:za=ta.get("compareIn","\u5728......\u4e4b\u5185");break;case X.COMPARE_NOT_IN:za=ta.get("compareNotIn","\u4e0d\u5728......\u4e4b\u5185");break;case X.COMPARE_RELATIVE_DATE_RANGE:za=
ta.get("relativeDateRange","\u76f8\u5bf9\u65e5\u671f");break;default:za=""}Ea=Ea+za+" ";za=I(!0);Ea=M==X.COMPARE_IN||M==X.COMPARE_NOT_IN?Ea.replace("......",za):M==X.COMPARE_RELATIVE_DATE_RANGE?G+" "+ta.get("equalRelativeDateRange","\u7b49\u4e8e\uff08\u76f8\u5bf9\u65e5\u671f\uff09")+za:Ea+za;ua=ua+Ea+La(!1,C)+" ";U?(Ea="",U==X.LOGIC_AND?Ea=ta.get("and","\u4e14"):U==X.LOGIC_OR&&(Ea=ta.get("or","\u6216"))):Ea="";return ua+Ea+" "};var I=function(ua){if(T){if(!ua&&(M==X.COMPARE_IN||M==X.COMPARE_NOT_IN))return JSON.parse(T).join(",");
if(M==X.COMPARE_RELATIVE_DATE_RANGE)return fa.modelToDisplayText(ja,!0)}else return"";return T},La=function(ua,Ea){ua=ua?"(":")";for(var za="",Ua=0;Ua<Ea;Ua++)za+=ua;return za}}function va(){var G,M=this;this.fromJsonObject=function(T){G=T.failType;var R=M.protectedFromJson;R&&R(T)};this.getFailType=function(){return G}}function Y(){va.call(this)}function t(){va.call(this)}function ya(){va.call(this)}function Fa(){va.call(this);var G;this.protectedFromJson=function(M){G=M.failMap};this.getFailMap=
function(){return G}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.metriclibrary&&(com.kingdee.bos.qing.modeler.metriclibrary={});"undefined"==typeof com.kingdee.bos.qing.modeler.metriclibrary.model&&(com.kingdee.bos.qing.modeler.metriclibrary.model=
{});var Ga=com.kingdee.bos.qing.modeler.metriclibrary.model;Ga.Catalog=function(){var G=this,M,T,R,C,U;this.setCatalogId=function(ja){M=ja};this.getCatalogId=function(){return M};this.setSystemId=function(ja){T=ja};this.getSystemId=function(){return T};this.setCatalogName=function(ja){R=ja};this.getCatalogName=function(){return R};this.setParentId=function(ja){C=ja};this.getParentId=function(){return C};this.setSeq=function(ja){U=ja};this.getSeq=function(){return U};this.fromJsonObject=function(ja){G.setCatalogId(ja.catalogId);
G.setSystemId(ja.systemId);G.setCatalogName(ja.catalogName);G.setParentId(ja.parentId);G.setSeq(ja.seq)};this.toJsonObject=function(){var ja={};ja.catalogId=M;ja.systemId=T;ja.catalogName=R;ja.parentId=C;ja.seq=U;return ja}};Ga.CatalogNode=ka;Ga.MetricVO=ma;Ga.MetricLibraryRequest=function(){var G,M=[],T=1,R=20,C;this.setSystemId=function(U){G=U};this.getSystemId=function(){return G};this.setCatalogIds=function(U){M=U};this.getCatalogIds=function(){return M};this.setTargetPage=function(U){T=U};this.getTargetPage=
function(){return T};this.setPageSize=function(U){R=U};this.getPageSize=function(){return R};this.setSearchText=function(U){C=U};this.getSearchText=function(){return C};this.toJsonObject=function(){var U={};U.systemId=G;U.catalogIdList=M;U.targetPage=T;U.pageSize=R;U.searchText=C;return U}};Ga.MetricLibraryResponse=function(){var G,M,T=[],R;this.getMetricPagination=function(){return G};this.getCatalogNode=function(){return M};this.getSystems=function(){return T};this.isPresetSystem=function(){return R};
this.fromJsonObject=function(C){var U=C.metricPageInfo;G=new sa;U&&G.fromJsonObject(U);U=C.catalogNode;M=new ka;U&&M.fromJsonObject(U);R=C.presetSystem;if((C=C.systemList)&&0<C.length)for(U=0;U<C.length;U++){var ja=C[U],I=new Ra;I.fromJsonObject(ja);T.push(I)}}};Ga.MetricPagination=sa;Ga.ModelSet=function(){var G,M,T=!1;this.isAll=function(){return T};this.setIsAll=function(R){T=R};this.setId=function(R){G=R};this.getId=function(){return G};this.setName=function(R){M=R};this.getName=function(){return M};
this.fromJsonObject=function(R){G=R.modelSetId;M=R.modelSetName}};Ga.MetricModelInfo=function(){var G=[];this.getMetricInfos=function(){return G};this.fromJsonObject=function(M){var T=M.metricInfos;if(T)for(var R=0;R<T.length;R++){var C=T[R],U=new oa;U.fromJsonObject(C);U.setPath(M.path);U.setDataUpdateTime(M.dataUpdateTime);U.setDisplayDataUpdateTime(M.displayDataUpdateTime);U.setDigest(M.isDigest);U.setDimension(M.dimensionsName);G.push(U)}}};Ga.MetricInfo=oa;Ga.Expr=qa;Ga.ExprSegment=la;Ga.AddMetricResponse=
function(){var G,M,T=function(R){switch(R){case va.FAIL_TYPE_SYSTEM_NOTEXIST:return new t;case va.FAIL_TYPE_CATALOG_NOTEXIST:return new Y;case va.FAIL_TYPE_INVALID_METRIC:return new Fa;case va.FAIL_TYPE_SYSTEM_WITHOUT_AUTH:return new ya}};this.fromJsonObject=function(R){G=R.success;if(R=R.invalidityCase){var C=T(R.failType);C.fromJsonObject(R);M=C}};this.isSuccess=function(){return G};this.getInvalidCase=function(){return M}};Ga.AbstractAddMetricInvalidityCase=va;Ga.DetailMetricInvalidityCase=Fa;
Ga.AddMetricQueryRequest=function(){var G,M,T,R,C,U,ja;this.setModelSetId=function(I){G=I};this.setSystemId=function(I){M=I};this.setSearchText=function(I){T=I};this.setShowNoAddMetric=function(I){R=I};this.setPreset=function(I){C=I};this.setTargetPage=function(I){U=I};this.setPageSize=function(I){ja=I};this.toJsonObject=function(){var I={};I.modelSetId=G;I.systemId=M;I.searchText=T;I.showNoAddMetric=R;I.preset=C;I.targetPage=U;I.pageSize=ja;return I}};var Oa,fa,Ra,ta,Wa=com.kingdee.bos.qing.modeler.metriclibrary;
(function(){var G=com.kingdee.bos.qing.common;Oa=G.RelativePeriodModel;G=com.kingdee.bos.qing.common.ui;fa=G.RelativePeriodPanel;G=com.kingdee.bos.qing.framework.common;ta=G.MultilanguageManager.createPackageAccessor(Wa);G=com.kingdee.bos.qing.modeler.metriclibrary.system;Ra=G.MetricSystem})();Ga.CatalogNodeCacheHelper=new function(){var G=[];this.getAllCatalogNodeBySystem=function(){return G};this.addCatalogNode=function(M){G.push(M)};this.getCatalogNodeById=function(M){for(var T=0;T<G.length;T++)if(G[T].getId()===
M)return G[T]};this.removeCatalogNode=function(M){for(var T=0;T<G.length;T++)if(G[T].getId()===M.getId()){G.splice(T,1);break}};this.clearCatalogNodeCache=function(){G=[]}};ka.ROOT_NODE_ID="0";la.TEXT="text";la.FIELD="field";la.METRIC="metric";la.DIMENSION="dimension";oa.DIMENSION_IS_DIGEST="1";X.COMPARE_EQUAL="EQUAL";X.COMPARE_NOT_EQUAL="NOT_EQUAL";X.COMPARE_GREATER="GREATER";X.COMPARE_GREATER_EQUAL="GREATER_EQUAL";X.COMPARE_LESS="LESS";X.COMPARE_LESS_EQUAL="LESS_EQUAL";X.COMPARE_INCLUDE="INCLUDE";
X.COMPARE_NOT_INCLUDE="NOT_INCLUDE";X.COMPARE_START_WITH="START_WITH";X.COMPARE_END_WITH="END_WITH";X.COMPARE_NULL="NULL";X.COMPARE_NOT_NULL="NOT_NULL";X.COMPARE_IN="IN";X.COMPARE_NOT_IN="NOT_IN";X.COMPARE_RELATIVE_DATE_RANGE="RELATIVE_DATE_RANGE";X.LOGIC_AND="AND";X.LOGIC_OR="OR";va.FAIL_TYPE_SYSTEM_NOTEXIST="SYSTEM_NOT_EXIST";va.FAIL_TYPE_CATALOG_NOTEXIST="CATALOG_NOT_EXIST";va.FAIL_TYPE_INVALID_METRIC="INVALID_METRIC";va.FAIL_TYPE_SYSTEM_WITHOUT_AUTH="SYSTEM_WITHOUT_AUTH";Fa.FAIL_TYPE_NO_DATA_AUTH=
"NO_DATA_AUTH";Fa.FAIL_TYPE_NOT_EXIST="NOT_EXIST";Fa.FAIL_TYPE_IS_ADDED="IS_ADDED"})();(function(){function O(){la.call(this);var sa;this.getRemoteUrl=function(){return sa};this.setRemoteUrl=function(oa){sa=oa}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.metriclibrary&&(com.kingdee.bos.qing.modeler.metriclibrary=
{});"undefined"==typeof com.kingdee.bos.qing.modeler.metriclibrary.common&&(com.kingdee.bos.qing.modeler.metriclibrary.common={});var ka=com.kingdee.bos.qing.modeler.metriclibrary.common;ka.Facade=function(sa,oa,X,va){ma.call(this,sa,oa,X,va);var Y=this.protectedMethod;this.loadFirstSystemCatalogAndMetric=function(t,ya,Fa,Ga){Y.remote("loadFirstSystemCatalogAndMetric",{systemId:t,targetPage:ya,pageSize:Fa,catalogId:Ga})};this.loadCatalogAndMetricBySystemId=function(t){t={metricLibraryRequest:JSON.stringify(t.toJsonObject())};
Y.remote("loadCatalogAndMetricBySystemId",t)};this.loadMetricLibraryMetric=function(t){t={metricLibraryRequest:JSON.stringify(t.toJsonObject())};Y.remote("loadMetricLibraryMetric",t)};this.createCatalog=function(t){t={catalog:JSON.stringify(t.toJsonObject())};Y.remote("createCatalog",t)};this.updateCatalog=function(t){t={catalog:JSON.stringify(t.toJsonObject())};Y.remote("updateCatalog",t)};this.deleteCatalog=function(t,ya){Y.remote("deleteCatalog",{systemId:t,catalogId:ya})};this.updateCatalogSequence=
function(t,ya){t={systemId:t,catalogList:JSON.stringify(ya)};Y.remote("updateCatalogSequence",t)};this.deleteSystemMetric=function(t){Y.remote("deleteSystemMetric",{systemId:t})};this.deleteCatalogsMetric=function(t,ya){t={systemId:t,catalogIdList:JSON.stringify(ya)};Y.remote("deleteCatalogsMetric",t)};this.deleteMetric=function(t,ya){t={systemId:t,metricIdList:JSON.stringify(ya)};Y.remote("deleteMetric",t)};this.moveMetric=function(t,ya,Fa){t={systemId:t,metricIdList:JSON.stringify(ya),targetCatalogId:Fa};
Y.remote("moveMetric",t)};this.moveSystemMetric=function(t,ya){Y.remote("moveSystemMetric",{systemId:t,targetCatalogId:ya})};this.moveCatalogMetric=function(t,ya,Fa){t={systemId:t,catalogIdList:JSON.stringify(ya),targetCatalogId:Fa};Y.remote("moveCatalogMetric",t)};this.loadAllMetricIds=function(t){t={metricLibraryRequest:JSON.stringify(t.toJsonObject())};Y.remote("loadAllMetricIds",t)};this.loadFirstPageMetric=function(t){Y.remote("loadFirstPageMetric",{systemId:t})};this.getMetricByPage=function(t){t=
{addMetricQueryRequest:JSON.stringify(t.toJsonObject())};Y.remote("getMetricByPage",t)};this.getAllSelectMetric=function(t){t={addMetricQueryRequest:JSON.stringify(t.toJsonObject())};Y.remote("getAllSelectMetric",t)};this.cancelAllSelectedMetric=function(t){t={addMetricQueryRequest:JSON.stringify(t.toJsonObject())};Y.remote("cancelAllSelectedMetric",t)};this.addMetricToSystem=function(t,ya,Fa){for(var Ga=[],Oa=0;Oa<t.length;Oa++)Ga.push(t[Oa].toJsonObject());t={metricList:JSON.stringify(Ga),systemId:ya,
catalogId:Fa};Y.remote("addMetricToSystem",t)};this.loadWholeDimensionInfo=function(t){Y.remote("loadWholeDimensionInfo",{modelId:t})}};ka.RemoteImpl=O;var ma,qa,la;(function(){var sa=com.kingdee.bos.qing.framework.common;ma=sa.AbstractFacade;qa=sa.AbstractIcons;la=sa.AbstractRemoteCall})();ka.Icons=new function(){qa.call(this);var sa=this.protectedMethod;this.protectedInit=function(va,Y){va=com.kingdee.bos.qing.modeler.metriclibrary.ComboIcon;if(!va)throw Error("com.kingdee.bos.qing.modeler.metriclibrary.ComboIcon not found.");
va.define(Y,"model-common");Y.setGap(1);Y.setStartPosition(104,285);Y.setIconSize(16,16);X(0,0,"add_subDir");X(0,1,"add_dir");X(0,2,"move_up");X(0,3,"move_down");Y.setStartPosition(0,117);Y.setIconSize(16,16);oa(1,1,"btn-delete");oa(0,1,"btn-delete_hover");oa(1,2,"btn-edit");oa(0,2,"btn-edit_hover");Y.setStartPosition(171,188);Y.setIconSize(24,24);oa(0,4,"metric-card-icon");Y.setStartPosition(120,117);Y.setIconSize(32,32);oa(0,0,"metric-card-tips-icon");Y.setIconSize(16,16);Y.setStartPosition(11,
-3);oa(5,9,"metric-icon-small");Y.setStartPosition(0,151);Y.setIconSize(170,98);oa(0,0,"icon-empty");Y.setStartPosition(169,385);Y.setIconSize(170,98);oa(0,0,"invalid-metric-card-icon");Y.setStartPosition(210,335);Y.setIconSize(73,48);oa(0,0,"no-licence-metric-card-icon");Y.setStartPosition(169,229);Y.setIconSize(13,13);oa(0,0,"sort");oa(0,1,"sort-desc");oa(0,2,"sort-asc");Y.setStartPosition(0,0);Y.setIconSize(20,20);va.define(Y,"table-view");oa(0,0,"table-view");va.define(Y,"table-view-on");oa(0,
0,"table-view-on");va.define(Y,"card-view");oa(0,0,"card-view");va.define(Y,"card-view-on");oa(0,0,"card-view-on");va.define(Y,"switch-button");oa(0,0,"icon-side-close");Y.setStartPosition(33,0);Y.setIconSize(17,14);oa(0,0,"icon-side-open")};var oa=function(va,Y,t){sa.registIcon(va,Y,t)},X=function(va,Y,t){oa(va,Y,t);oa(va+1,Y,t+"_hover")}};ka.Integration=new function(){var sa=new O,oa,X,va;this.setParamPathPrefix=function(Y){oa=Y};this.getParamPathPrefix=function(){return oa};this.getRemoteImpl=
function(){return sa};this.setRemoteUrl=function(Y){sa.setRemoteUrl(Y)};this.setMetricSystemEntrance=function(Y){X=Y};this.getMetricSystemEntrance=function(){return X};this.setModelSetHomePageEntrance=function(Y){va=Y};this.getModelSetHomePageEntrance=function(){return va}}})();(function(){function O(){var c=this,u,y=new Wa,K,n=!1,h,g;this.getJqUi=function(){u||(u=y.getJqUi(),u.addClass("metric-library-manage-toolbar"),c.protectedInitToolbarUi(u),K=ub(u,h,!0,f.get("searchContent","\u8bf7\u8f93\u5165\u641c\u7d22\u5185\u5bb9"),"metric-library-manage-toolbar-search-box"),r());return u};this.getSearchText=function(){var w="";K&&(w=$.trim(K.getText()));return w};this.setSearchListener=function(w){h=w};this.getIsTableView=function(){return n};this.setViewSwitchListener=function(w){g=
w};var r=function(){var w=$("<div class='metric-library-manage-card-view-icon'>");Sa.background(w,"card-view-on");w.attr("title",f.get("cardView","\u5361\u7247\u89c6\u56fe"));var x=$("<div class='metric-library-manage-toolbar-view-switch'>"),p=$("<div class='metric-library-manage-table-view-icon'>");Sa.background(p,"table-view");p.attr("title",f.get("tableView","\u5217\u8868\u89c6\u56fe"));x.append(w);x.append(p);p.on("click",function(){Sa.background(w,"card-view");Sa.background(p,"table-view-on");
!0!==n&&(n=!0,g&&g(n))});w.on("click",function(){Sa.background(w,"card-view-on");Sa.background(p,"table-view");!1!==n&&(n=!1,g&&g(n))});u.append(x)};this.clearSearchStatus=function(){K.clear();K.getJqUi().find("input").blur()};this.protectedMethod={appendButton:function(w,x,p,H){w=y.createButton(u,!1,w,p,H);w.setIconSetter(function(P,Q){Sa.background(P,Q)});w.setIconName(x);return w}}}function ka(){var c=this,u,y,K=new U,n,h,g,r,w,x=!1,p,H,P,Q,ia,ha=!1;this.setGlobal=function(J){y=J};this.getGlobal=
function(){return y};this.setCatalogToolBar=function(J){n=J};this.setCatalogNoData=function(J){r=J};this.setContainSubLevel=function(J){x=J};this.getContainSubLevel=function(){return x};this.getJqUi=function(){if(!u){u=$("<div class='metric-library-catalog-container'>");var J=n.getJqUi();u.append(J);h=ub(u,E,!0,f.get("inputCatalogName","\u8bf7\u8f93\u5165\u76ee\u5f55\u540d\u79f0"),"metric-library-catalog-search-box");J=r.getJqUi();u.append(J);r.hide();w=new la;w.setContainSubLevelListener(ia);J=w.getUi();
u.append(J)}return u};this.setCatalogFolderNode=function(J){P=J};this.getCatalogFolderNode=function(){return P};this.setTreeNodeClickListener=function(J){Q=J};this.setContainSubLevelListener=function(J){ia=J};this.updateUi=function(J,Z,wa){P&&0!==P.getChildren().length?Z?(r&&r.hide(),w.setContainChildStatus(!1,!0,!0),n.onlyShowAddChildCatalogBtn(),Xa&&n.hideAllButton()):(r&&r.hide(),w.setContainChildStatus(!0,x,!0),!Xa&&n.showAllButton()):(n.hideAllButton(),r&&r.show(),w.setContainChildStatus(!1,
x,!1));J&&(g?ba(wa):W())};this.getCatalogTree=function(){return g};this.resetCatalogTree=function(){g&&g.getJqUi().remove();g=null};this.createNodeOnBranch=function(J,Z){Z=g.createLeafNode(Z);g.addChild(J,Z,J.getChildCount());ba(Z)};this.createNodeOnLeaf=function(J){var Z=g.getSelectedNode(),wa=Z.getParent();J=g.createLeafNode(J);for(var Aa=g.createBranch(Z.getUserObject()),aa,ca=wa.getAllChildren(),ea=0;ea<ca.length;ea++)if(ca[ea].getUserObject().getId()===Z.getUserObject().getId()){aa=ea;break}wa.removeChild(Z);
g.addChild(wa,Aa,aa);g.addChild(Aa,J,0);ba(J)};this.removeCatalogLeafNode=function(){var J=g.getSelectedNode(),Z=J.getUserObject(),wa=Z.getId(),Aa=Z.getParentNode().getChildren();for(Z=0;Z<Aa.length;Z++)if(Aa[Z].getId()===wa){Aa.splice(Z,1);break}wa=J.getParent();g.removeChild(wa,J);J=wa.getUserObject();if(0===wa.getChildCount()&&Ta.ROOT_NODE_ID!==J.getId()){Aa=g.createLeafNode(J);var aa=wa.getParent(),ca=aa.getAllChildren();for(Z=0;Z<ca.length;Z++)if(ca[Z].getUserObject().getId()===J.getId()){aa.removeChild(wa);
g.addChild(aa,Aa,Z);break}}c.updateUi(!0,!0)};this.clearSearchStatus=function(){h.clear();h.getJqUi().find("input").blur()};this.resizeAfterObserver=function(J){if(!(r instanceof db)){J=document.documentElement.clientHeight-J-20;var Z=n.getJqUi().height(),wa=K.getJqUi().height(),Aa=h.getJqUi().height(),aa=r.getJqUi().height();aa=Z+wa+Aa+aa;J=0<J-aa?(u.height()-aa>>1)+Z+wa+Aa:aa+10;r.getJqUi().css({top:J})}};var W=function(){g=new jb;g.addExpandedListener(function(Z,wa){wa.isExpanded()&&E($.trim(h.getText()).toLowerCase())});
g.setDataModel(P);g.setFunTreeNodeClick(N);p=g.getRootGroup();g.setAutoSelectedModelId(H);var J=g.getJqUi();xa.layoutCtrlWithLRTB(J,0,0,"100%",65,41,"auto");u.append(J)},ba=function(J){J||(J=g.getRootGroup(),J.setUserObject(P));p=J;var Z=P.getChildren();g.setDataModel(P);g.setFunTreeNodeClick(N);g.setSelectedNode([J]);g.setRootVisible(0<Z.length);g.getTree().expandToNode(J,!1);g.refresh()},N=function(J,Z){var wa=Z.getUserObject();J.getSelecteds()[0].getUserObject().getId()!==wa.getId()&&(p=Z,H=Z.getUserObject().getId(),
Q&&Q(wa))},E=function(J){if(g)if(""===J){if(ha){var Z=g.getSelectedNode().getUserObject().getId();p&&(Z=p.getUserObject().getId());var wa;g.getRootGroup().visiting(function(F){if(F.getUserObject().getId()===Z)return wa=F,!0});ba(wa);ha=!1}}else{ha=!0;var Aa=[],aa=[];g.getRootGroup().deepFirstVisiting(function(F){var na=F.getUserObject();-1!==na.getName().toLowerCase().indexOf(J)&&(Aa.push(F),aa.push(na.getId()))},!1);for(var ca=0;ca<Aa.length;ca++){var ea=Aa[ca];Ha(ea,aa);Ia(ea,aa);g.getTree().expandToNode(ea,
!1)}g.getTree().searchAllNodeUi(function(F,na){F=F.getUserObject();var Ca=F.getId();Ca!==Ta.ROOT_NODE_ID&&(-1!==F.getName().toLowerCase().indexOf(J)?na.show():-1===aa.indexOf(Ca)?na.hide():na.show())})}},Ha=function(J,Z,wa){if(!J.isLeafNode()){J=J.getAllChildren();for(var Aa=0;Aa<J.length;Aa++){var aa=J[Aa].getUserObject();-1!==aa.getName().toLowerCase().indexOf(wa)&&(Z.push(aa.getId()),Ha(J[Aa],Z))}}},Ia=function(J,Z){J.getUserObject().getId()!==Ta.ROOT_NODE_ID&&(J=J.getParent(),Z.push(J.getUserObject().getId()),
Ia(J,Z))}}function ma(){var c,u,y,K,n,h,g,r,w,x,p,H,P,Q;this.getJqUi=function(){if(!c){c=$("<div class='metric-library-catalog-tool-bar'>");var ha=$("<div class='metric-library-catalog-text'>");ha.text(f.get("catalog","\u76ee\u5f55"));c.append(ha);r&&(u=ia("metric-library-catalog-add-btn",w,"add_dir",f.get("addDir","\u65b0\u589e\u540c\u7ea7")),y=ia("metric-library-catalog-add-btn",x,"add_subDir",f.get("addSubDir","\u65b0\u589e\u5b50\u7ea7")),K=ia("metric-library-catalog-edit-btn",p,"btn-edit",f.get("editCatalog",
"\u7f16\u8f91\u76ee\u5f55")),n=ia("metric-library-catalog-del-btn",H,"btn-delete",f.get("deleteCatalog","\u5220\u9664\u76ee\u5f55")),h=ia("metric-library-catalog-move-up-btn",P,"move_up",f.get("moveUp","\u4e0a\u79fb")),g=ia("metric-library-catalog-move-down-btn",Q,"move_down",f.get("moveDown","\u4e0b\u79fb")),c.append(u),c.append(y),c.append(K),c.append(n),c.append(h),c.append(g))}return c};this.setCatalogEditable=function(ha){r=ha};this.setCreateSameLevelCatalog=function(ha){w=ha};this.setCreateSubLevelCatalog=
function(ha){x=ha};this.setEditCatalog=function(ha){p=ha};this.setDeleteCatalog=function(ha){H=ha};this.setMoveUpCatalog=function(ha){P=ha};this.setMoveDownCatalog=function(ha){Q=ha};this.hideAllButton=function(){r&&(u&&u.hide(),y&&y.hide(),K&&K.hide(),n&&n.hide(),h&&h.hide(),g&&g.hide())};this.showAllButton=function(){r&&(u&&u.css("right","140px")&&u.show(),y&&y.css("right","116px")&&y.show(),K&&K.show(),n&&n.show(),h&&h.show(),g&&g.show())};this.onlyShowAddChildCatalogBtn=function(){r&&(u&&u.hide(),
K&&K.hide(),n&&n.hide(),h&&h.hide(),g&&g.hide(),y&&y.css("right","20px")&&y.show())};this.hide=function(){c&&c.hide()};this.show=function(){c&&c.show()};var ia=function(ha,W,ba,N){var E=$("<div>");E.addClass(ha);E.on("click",W);Sa.backgroundWithHover(E,ba);E.attr("title",N);E.hide();return E}}function qa(){var c,u;this.getJqUi=function(){if(!c){c=$("<div class='metric-library-catalog-no-data'>");var y=f.get("addCatalog","\u65b0\u5efa\u76ee\u5f55");c.on("click",u);c.text("+"+y);c.attr("title",y);c.hide()}return c};
this.setCreateSubLevelCatalog=function(y){u=y};this.show=function(){c&&c.show()};this.hide=function(){c&&c.hide()}}function la(){var c,u,y;this.getUi=function(){if(!c){c=$("<div class='metric-library-catalog-contain-sub-level'>");u=new R;u.setEnabled(!1);u.setChecked(!0);u.setText(f.get("containSubLevel","\u5305\u542b\u4e0b\u7ea7"));u.setCustomStyle("font-size","14px");var n=u.getJqUi();xa.layoutCtrlWithLRTB(n,20,null,135,8,null);n.on("click",K);n.appendTo(c);c.hide()}return c};this.setContainChildStatus=
function(n,h,g){u.setEnabled(n);u.setChecked(h);g?c&&c.show():c&&c.hide()};this.setContainSubLevelListener=function(n){y=n};this.hide=function(){c&&c.hide()};this.show=function(){c&&c.show()};var K=function(){u.isEnabled()&&y&&y(u.isChecked())}}function sa(){var c=this,u,y,K=new Ua,n,h,g,r,w,x,p,H,P=!1,Q=[],ia;this.setGlobal=function(W){y=W};this.getGlobal=function(){return y};this.setShowMetrics=function(W){Q=W};this.getPaginationBar=function(){return K};this.setSelectedAll=function(W){P=W};this.getSelectedAll=
function(){return P};this.getJqUi=function(){u||ha();return u};this.clearSelectedMetric=function(){r&&r.setSelectedMetricsMap({});w&&w.setSelectedMetricsMap({})};this.setViewSelectedMetricsMap=function(W){r&&r.setSelectedMetricsMap(W);w&&w.setSelectedMetricsMap(W)};this.updateUi=function(){c.updateJumpLink();c.showMetrics(Q)};this.showMetrics=function(W){0!==W.length?(p.hide(),x.hide()):""!==y.getSearchText()?(x.hide(),p.show()):(x.show(),p.hide());y.getIsTableView()?(c.showTableView(),r.setMetrics(W)):
(c.showCardView(),w.setMetrics(W));ia=H.getNonemptyFirstWide()};this.updateJumpLink=function(){h&&h.is(":visible")||(h=$("<span class='metric-library-guide-enter-qing-modeler'>"),h.text(f.get("openQingModeler","\u53bb\u8f7b\u5efa\u6a21 ")),g=$("<span class='metric-library-guide-create-metric'>"),g.text(f.get("createMetric","\u65b0\u5efa\u6307\u6807")+">>"),g.on("click",function(){var W=eb.getModelSetHomePageEntrance();W&&W()}),n.append(g),n.append(h))};this.setCatalogContainerWidth=function(W){ia=
W};this.getCatalogContainerWidth=function(){return ia?ia:H.getNonemptyFirstWide()};this.getSelectedMetrics=function(){return(y.getIsTableView()?r:w).getSelectedMetrics()};this.getMetricTableView=function(){return r};this.getMetricCardView=function(){return w};this.showTableView=function(){w.hide();r.show()};this.showCardView=function(){r.hide();w.show()};this.setSplitPane=function(W){H=W};this.resizeAfterObserver=function(){H.setSecondSize(document.documentElement.clientWidth-H.getNonemptyFirstWide()-
20-8);y.getIsTableView()&&r.updateUi(!0)};var ha=function(){u=$("<div class='metric-library-metric-container'>");r=new X;r.setGlobal(y);var W=r.getJqUi();u.append(W);r.hide();w=new va;w.setGlobal(y);W=w.getJqUi();u.append(W);w.show();x=new db(f.get("noMetric","\u6682\u65e0\u6307\u6807"));W=x.getJqUi();u.append(W);W.hide();p=new hb;W=p.getJqUi();u.append(W);W.hide();W=new Za;W.setCallbackImmediately(function(){document.body.style.height=document.documentElement.clientHeight+"px";c.resizeAfterObserver();
y.getCatalogContainer().resizeAfterObserver(45)});W.setDelay(250);W.observe()};this.updatePaginationBar=function(W){n||(K.protectedMethod.setTotalSelectedRowAndSelectedAllVisual(!Xa,!Xa),K.setJumpToPageListener(function(ba,N,E){Bb(ba,N,E,y.getCatalogContainer().getContainSubLevel(),c)}),K.setSelectedAllOrNotListener(function(ba,N){Cb(ba,N,y.getCatalogContainer(),c)}),n=K.getJqUi(),xa.layoutCtrlWithLRTB(n,0,0,null,4,null,null),u.append(n));K.resetPaginationAndJumpToFirstPage(W)}}function oa(){var c=
this,u,y,K=[],n={};this.getJqUi=function(){u||(u=c.protectedInitViewUi());return u};this.setGlobal=function(h){y=h};this.show=function(){u&&u.show()};this.hide=function(){u&&u.hide()};this.setMetrics=function(h){K=h;c.updateUi()};this.getMetrics=function(){return K};this.setSelectedMetricsMap=function(h){n=h};this.getSelectedMetricsMap=function(){return n};this.getSelectedMetrics=function(){return Object.keys(n)};this.updateUi=function(h){c.protectedUpdateViewUi(u,h)};this.updateSelectedAll=function(h){c.protectedUpdateSelectedAllUi(h)};
this.protectedMethod={getGlobal:function(){return y},getMetrics:function(){return K},getSelectedMetricsMap:function(){return n},doHighLightText:function(h,g,r){if(h&&g&&r){r=r.toUpperCase();for(var w=g.toUpperCase(),x=w.split(r),p=r.length,H=0;H<x.length;H++){var P=w.indexOf(x[H]),Q=g.substr(0,x[H].length);P+=x[H].length;var ia=w.length-P;w=w.substr(P,ia);g=g.substr(P,ia);P=$("<span>");P.text(Q);P.appendTo(h);H!=x.length-1&&1<x.length&&(P=w.indexOf(r),Q=g.substr(P,p),P+=p,ia=w.length-P,w=w.substr(P,
ia),g=g.substr(P,ia),P=$("<span>"),P.text(Q),P.css("color","red"),P.clone().appendTo(h))}}},getDisplayExprJqUi:function(h){if(!h)return $("<span>");var g=$("<span>"),r=h.getExprSegments();h=h.getDisplayExpr();g.attr("title",h);for(h=0;h<r.length;h++){var w=r[h].getTextSegment();w=$("<span>").text(w.getText()).css("color",w.getColor());g.append(w)}return g}}}function X(){function c(){var V=this,a,e,m;this.reInit=function(){a=null;l()};this.getJqIcon=function(){return a};this.setOrder=function(k){e=
k;l()};this.getOrder=function(){return e};this.setColIdx=function(k){m=k};this.getColIdx=function(){return m};var l=function(){z();a.addClass("metric-library-add-metric-sort-icon");a.on("click",function(){e?e==c.ASC_ORDER?e=c.DESC_ORDER:(Q=null,a.remove()):(Q=V,e=c.ASC_ORDER);z();P&&P[0]!==a[0]&&P.remove();P=a;Ma()})},z=function(){switch(e){case c.ASC_ORDER:var k="sort-asc";break;case c.DESC_ORDER:k="sort-desc";break;default:k="sort"}!a&&(a=$("<div>"));a.attr("title","\u6392\u5e8f");Sa.background(a,
k)}}function u(){this.getTailBlankForDragging=function(){return-1};this.isRowDraggable=function(V,a){return!1};this.isColumnDraggable=function(V,a){return V.getColumnsCount()==a+1?!1:!0};this.getMinRowHeightLimited=function(V,a){return 3};this.getMinColumnWidthLimited=function(V,a){return 4};this.rowDraggedAction=function(V,a,e){var m=V.isSyncUIWhenModelChanged();V.setSyncUIWhenModelChanged(!0);a=V.getRow(a);a.setHeight(a.getHeight()+e);V.setSyncUIWhenModelChanged(m)};this.setMinColumnWidth=function(V){};
this.columnDraggedAction=function(V,a,e){var m=V.isSyncUIWhenModelChanged();V.setSyncUIWhenModelChanged(!0);a=V.getColumn(a);a.setWidth(a.getWidth()+e);V.setSyncUIWhenModelChanged(m);r&&r.hasSelected()&&(V=r.getSelected(),r.removeAllSelecteds(),V&&r.addSelected(V),V=V.getRowIdx()-Ja.getHeadRowCount(),h.scrollCellVisible(V,0,!1))}}function y(V){KTDefaultCellRender.call(this,V);var a=this,e=new La,m=this.paintCellUI;this.paintCellUI=function(z,k){var d=a.getCurrentRowIdx(),b=a.getCurrentRow(),q=a.getCurrentColIdx(),
v=b.getUserObject();b=n.getGlobal().getSearchText();var B=v&&v.getExpr()&&v.hasLicence();(new $a).setFormatString("yyyy-MM-dd HH:mm:ss");var L=function(D){var da=n.getSelectedMetricsMap(),pa=v.getId();D?da[pa]=pa:(delete da[pa],n.getGlobal().getMetricContainer().setSelectedAll(!1));da=Object.keys(da);n.getGlobal().getMetricContainer().getPaginationBar().refreshSelectedRowTotal(da.length);g[pa].setChecked(D);D=!0;pa=Object.keys(g);for(da=0;da<pa.length;da++)if(!g[pa[da]].isChecked()){D=!1;break}w.setChecked(D)};
$(z).on("click",function(D){d<Ja.getHeadRowCount()||xa.isDescendent(D.target,g[v.getId()].getJqUi()[0])||(D=g[v.getId()].isChecked(),L(!D))});if(d<Ja.getHeadRowCount())(m(z,k),0!==q||1!==d||Xa)?Q&&Q.getColIdx()===q&&1===d?(Q.reInit(),b=Q.getJqIcon(),b.appendTo($(z)),b.data("sortModel",Q),P=b):q===Ia&&1===d&&(b=new I,b.setIconType(I.ICON_TYPE_QUESTION),b.setTipsText(f.get("pathTips",'"\u8def\u5f84\u683c\u5f0f\u4e3a\uff1a\u6a21\u578b\u96c6\u540d\u79f0/\u76ee\u5f55\u540d\u79f0/\u6a21\u578b\u540d\u79f0\u3002\u76ee\u5f55\u53ef\u80fd\u5b58\u5728\u591a\u5c42\u7ea7\uff0c\u5404\u5c42\u7ea7\u4e4b\u95f4\u7531\u201c/\u201d\u5206\u9694\u3002"')),
b.setTipsSize(310,60),b=b.getJqUi(),xa.layoutCtrlWithLRTB(b,($(z).outerWidth()>>1)+((new S).measureWidth(f.get("path","\u8def\u5f84"))>>1)+7,null,null,6,null,null),b.appendTo($(z))):(b=w&&w.isChecked(),w=new R,w.setChecked(n.getGlobal().getMetricContainer().getSelectedAll()||b),w.addCheckedListener(function(D,da){if(da){(D=D.isChecked())||n.getGlobal().getMetricContainer().setSelectedAll(!1);da=n.getSelectedMetricsMap();for(var pa=Object.keys(g),Da=0;Da<pa.length;Da++)g[pa[Da]].setChecked(D),D?da[pa[Da]]=
pa[Da]:delete da[pa[Da]];D=Object.keys(da);n.getGlobal().getMetricContainer().getPaginationBar().refreshSelectedRowTotal(D.length)}}),b=w.getJqUi(),xa.layoutCtrlCenterAlign(b,14),xa.layoutCtrlMiddleAlign(b,22),$(z).append(b));else if(0!==q||Xa)if(q===ha)B=$("<div class='metric-library-table-view-cell'>"),k=v.getNumber(),B.attr("title",k),""!==b?n.doHighLightText(B,k,b):B.text(k),$(z).append(B);else if(q===W)k=$("<div class='metric-library-table-view-cell'>"),v.isPreset()&&(q=$("<div class='metric-table-item-preset'>"),
q.text(f.get("preset","\u9884\u7f6e")),$(z).append(q)),q=v.getMetricName(),k.attr("title",q),B=l(B,v),$(z).append(B),k.css({display:"inline-block"}),""!==b?n.doHighLightText(k,q,b):k.text(q),$(z).append(k),$(z).css({display:"flex","align-items":"center"});else if(q===ba)B&&(B=$("<div class='metric-library-table-view-cell'>"),k=v.getDesc(),B.attr("title",k),""!==b?n.doHighLightText(B,k,b):B.text(k),$(z).append(B));else if(q===N)B&&(b=v.getExpr(),b=n.getDisplayExprJqUi(b),b.addClass("metric-library-table-view-cell"),
xa.layoutCtrlWithLRTB(b,0,0,null,null,null,40),$(z).append(b));else if(q===wa){if(B&&(b=$("<div class='metric-library-table-view-cell'>"),B=v.getDimension(),b.attr("title",B),b.text(B),$(z).append(b),!v.isDigest())){b.addClass("metric-library-table-dimension-info");var A=$("<div class='metric-library-table-dimension-detail-info'>");A.text(f.get("dimensionDetailInfo","\u8be6\u60c5>"));A.on("click",function(D){D.stopPropagation();e.setSuggestedSize(265,125);e.mounting(A);v.getWholeDimension()?e.setText(v.getWholeDimension()):
(D=n.getGlobal().createFacade(function(da){v.setWholeDimension(da);e.setText(v.getWholeDimension())}),D.setBlockingJqUi($(h.getUI())),D.loadWholeDimensionInfo(v.getModelId()))});$(z).append(A)}}else if(q===Aa){if(B){b=$("<div class='metric-library-table-view-cell'>");B="";k=v.getFilterItems();for(q=0;q<k.length;q++)B+=k[q].getDisplayText(),B+="\r\n";b.attr("title",B);b.text(B);$(z).append(b)}}else q===Ia?(b=$("<div class='metric-library-table-view-cell'>"),B=v.getPath(),b.attr("title",B),b.text(B),
$(z).append(b)):q===Ha?B&&(B=$("<div class='metric-library-table-view-cell'>"),k=v.getMetricCreator(),B.attr("title",k),""!==b?n.doHighLightText(B,k,b):B.text(k),$(z).append(B)):q===J?B&&(B=$("<div class='metric-library-table-view-cell'>"),k=v.getAddPeople(),B.attr("title",k),""!==b?n.doHighLightText(B,k,b):B.text(k),$(z).append(B)):q===Z?B&&(b=$("<div class='metric-library-table-view-cell'>"),B=v.getDisplayAddTime(),b.text(B),b.attr("title",B),$(z).append(b)):q===E&&B&&(b=$("<div class='metric-library-table-view-cell'>"),
B=v.getDisplayDataUpdateTime(),b.text(B),b.attr("title",B),$(z).append(b));else b=n.getSelectedMetricsMap(),B=v.getId(),k=new R,k.setUserObject(v),k.setChecked(n.getGlobal().getMetricContainer().getSelectedAll()||void 0!==b[B]&&null!==b[B]),k.addCheckedListener(function(D,da){da&&(D=D.isChecked(),L(D))}),g[B]=k,b=k.getJqUi(),xa.layoutCtrlCenterAlign(b,14),xa.layoutCtrlWithLRTB(b,null,null,16,10,null,null),$(z).append(b)};var l=function(z,k){z?(z=$("<div>"),Sa.background(z,"metric-icon-small"),z.css({height:"16px",
width:"16px",margin:"0 2px","flex-shrink":"0"})):(z=ra.createWarning(),k=k.hasLicence()?f.get("metricTableInValidTips","\u6307\u6807\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664"):f.get("noLicenceTips","\u5f53\u524d\u7cfb\u7edf\u6ca1\u6709\u3010\u8f7b\u5efa\u6a21\u3011\u6a21\u5757\u7684\u4f7f\u7528\u8bb8\u53ef\uff0c\u8bf7\u4e0e\u7cfb\u7edf\u7ba1\u7406\u5458\u8054\u7cfb"),z.attr("title",k));return z}}oa.call(this);var K=this.protectedMethod,n=K,h,g={},r,w,x,p,H=[],P,Q,ia,ha=1,W=2,ba=3,N=4,E=5,Ha=
6,Ia=7,J=8,Z=9,wa=10,Aa=11,aa,ca=[],ea=[{width:80,text:f.get("code","\u7f16\u7801")},{width:100,text:f.get("metricName","\u540d\u79f0")},{width:150,text:f.get("metricDesc","\u63cf\u8ff0")},{width:150,text:f.get("expr","\u8868\u8fbe\u5f0f")},{width:120,text:f.get("dataUpdateTime","\u6570\u636e\u66f4\u65b0\u65f6\u95f4")},{width:100,text:f.get("metricCreator","\u6307\u6807\u521b\u5efa\u4eba")},{width:100,text:f.get("path","\u8def\u5f84")},{width:120,text:f.get("addPeople","\u6dfb\u52a0\u4eba")},{width:120,
text:f.get("addTime","\u6dfb\u52a0\u65f6\u95f4")},{width:120,text:f.get("dimension","\u7ef4\u5ea6")},{width:120,text:f.get("filterCondition","\u8fc7\u6ee4\u6761\u4ef6")}],F=[{width:50},{width:80,text:f.get("code","\u7f16\u7801")},{width:100,text:f.get("metricName","\u540d\u79f0")},{width:150,text:f.get("metricDesc","\u63cf\u8ff0")},{width:150,text:f.get("expr","\u8868\u8fbe\u5f0f")},{width:120,text:f.get("dataUpdateTime","\u6570\u636e\u66f4\u65b0\u65f6\u95f4")},{width:100,text:f.get("metricCreator",
"\u6307\u6807\u521b\u5efa\u4eba")},{width:100,text:f.get("path","\u8def\u5f84")},{width:120,text:f.get("addPeople","\u6dfb\u52a0\u4eba")},{width:120,text:f.get("addTime","\u6dfb\u52a0\u65f6\u95f4")},{width:120,text:f.get("dimension","\u7ef4\u5ea6")},{width:120,text:f.get("filterCondition","\u8fc7\u6ee4\u6761\u4ef6")}];this.protectedInitViewUi=function(){ia=$("<div class='metric-library-table-view'>");h=Ja.createTable();h.setDraggableAdjusting(!0,3,0,new u);r=h.getSelectionModel();h.setColumnFitVisibleWidth(!1);
h.setScrollerVisible("auto");var V=$(h.getUI());Ja.setupSingleRowSelection(h);h.setCellAcrossListener(Ca);xa.layoutCtrlWithLRTB(V,5,5,null,0,5,null);ia.append(V);return ia};this.setScrollerVisible=function(V){h.setScrollerVisible(V)};this.setHeadRowMap=function(V){x=V};this.protectedUpdateViewUi=function(V,a){a||(g={});Ma()};this.relayoutViews=function(){h&&h.relayoutViews()};this.protectedUpdateSelectedAllUi=function(V){w.setChecked(V);$.each(g,function(a,e){e.setChecked(V)})};var na=function(V){Ja.clear(h);
Xa?(x=ea,ha=0,W=1,ba=2,N=3,E=4,Ha=5,Ia=6,J=7,Z=8,wa=9,Aa=10):(x=F,ha=1,W=2,ba=3,N=4,E=5,Ha=6,Ia=7,J=8,Z=9,wa=10,Aa=11);aa=[ha,W,Z];var a=ia.width()-10;ca=Xa?[.08*a,.1*a,.18*a,.15*a,.08*a,.07*a,.19*a,.07*a,.08*a,.11*a,.11*a]:[.03*a,.08*a,.1*a,.17*a,.14*a,.08*a,.07*a,.18*a,.07*a,.08*a,.11*a,.11*a];var e=x.length;h.addColumns(e);var m=Ja.createHeadRow(h);m.setHeight(28);for(a=0;a<e;a++)h.getColumn(a).setWidth(ca[a]),x[a].text&&m.getCell(a).setValue(x[a].text);a=new y(h);a.setEllipsis(!0);a.setOutsideVisible(!1);
h.setCellRender(a);e=new KTBorderStyle;e.setBottomBorderWidth(1);e.setBottomBorderPen("solid");e.setBottomBorderColor("#e5e5e5");for(a=0;a<V.length;a++){m=V[a];var l=Ja.createRow(h,!1);l.setBorder(e);l.setUserObject(m);l.setHeight(40)}Ja.refresh(h);w&&w.setChecked(Pa())},Ca=function(V,a,e,m){V=V&&0<V.length?V[0]:null;if(p!==V){if(p)for(var l=0;l<H.length;l++){var z=H[l][0],k=z["qdm-bg"];delete z["qdm-bg"];k&&$(z).css("background-color",k)}l=$(p);l=Ba(l);l.removeClass("metric-library-add-metric-sort-icon_hover");
(z=l.data("sortModel"))&&!z.getOrder()&&l.remove();if(V&&a>=Ja.getHeadRowCount())for(e=h.getColumnsCount(),l=0;l<e;l++)z=m(a,l),z[0]["qdm-bg"]=z.css("background-color"),z.css("background-color","rgb(240, 240, 240)"),H.push(z);else-1<aa.indexOf(e)?(a=Ba($(V)),0===a.length&&(a=$(V),m=new c,m.setOrder(null),m.setColIdx(e),e=m.getJqIcon(),e.appendTo(a),e.data("sortModel",m),a=e),a.addClass("metric-library-add-metric-sort-icon_hover")):(p=null,H=[]);p=V}},Ba=function(V){return V.find(".metric-library-add-metric-sort-icon")},
Ma=function(){if(Q){var V=Q.getOrder()===c.ASC_ORDER,a=[].concat(K.getMetrics());a.sort(ab(V));for(var e=[],m=[],l=[],z=[],k=[],d=0;d<a.length;d++){var b=Na(a[d]);b||0===b?/^\d+?.*$/.test(b)?(m=m||[],m.push(a[d])):/^[a-zA-Z]+?.*$/.test(b)?(l=l||[],l.push(a[d])):/^[\u4e00-\u9fa5]+?.*$/.test(b)?(z=z||[],z.push(a[d])):(k=k||[],k.push(a[d])):(e=e||[],e.push(a[d]))}a=V?[].concat(m||[]).concat(l||[]).concat(z||[]).concat(k||[]).concat(e||[]):[].concat(e||[]).concat(k||[]).concat(z||[]).concat(l||[]).concat(m||
[]);na(a)}else na(K.getMetrics())},ab=function(V){return function(a,e){a=Na(a);e=Na(e);var m=a-e;isNaN(m)&&(m=String(a).localeCompare(String(e),"zh-CN",{sensitivity:"accent"}));return V?m:-m}},Na=function(V){return Q.getColIdx()===ha?V.getNumber():Q.getColIdx()===W?V.getMetricName():V.getAddTime()};c.DESC_ORDER="desc";c.ASC_ORDER="asc";var Pa=function(){var V=Object.keys(g);if(0===V.length)return!1;for(var a=0;a<V.length;a++)if(!g[V[a]].isChecked())return!1;return!0}}function va(){function c(n){var h,
g;this.getJqUi=function(){h||r();return h};this.setSelected=function(x){g&&g.setChecked(x)};this.getSelected=function(){return g.isChecked()};this.setSelectedStatus=function(x){x?h.addClass("metric-card-item-selected"):h.removeClass("metric-card-item-selected")};this.getMetric=function(){return n};var r=function(){var x=u.getGlobal().getSearchText();h=$("<div class='metric-library-metric-card-item'>");h.on("click",function(N){y.showClickStatus(n)});var p=$("<div class='metric-card-item-icon'>");Sa.background(p,
"metric-card-icon");var H=$("<div class='metric-card-item-name'>"),P=n.getMetricName(),Q=$("<span>");Q.appendTo(H);H.attr("title",P);""!==x?u.doHighLightText(Q,P,x):Q.text(P);n.isPreset()&&(Q=$("<div class='metric-item-preset'>"),xa.layoutCtrl(Q,15,16,null,null),Q.text(f.get("preset","\u9884\u7f6e")),h.append(Q),p.css("left","58px"),H.css("left","97px"));if(!Xa){g=new R;var ia=n.getId(),ha=u.getSelectedMetricsMap();g.setChecked(u.getGlobal().getMetricContainer().getSelectedAll()||void 0!==ha[ia]&&
null!==ha[ia]);Q=g.getJqUi();xa.layoutCtrlWithLRTB(Q,null,15,15,16,null,null);g.addCheckedListener(function(N,E){E&&(ha=u.getSelectedMetricsMap(),g.setChecked(N.isChecked()),N.isChecked()?ha[ia]=ia:(delete ha[ia],u.getGlobal().getMetricContainer().setSelectedAll(!1)),N=Object.keys(ha),u.getGlobal().getMetricContainer().getPaginationBar().refreshSelectedRowTotal(N.length))});h.append(Q)}Q=function(N,E,Ha){var Ia=$("<div>");Ia.addClass(N);Ia.attr("title",Ha);""!==x?(Ia.text(E),u.doHighLightText(Ia,
Ha,x)):Ia.text(E+" "+Ha);return Ia};h.append(p);h.append(H);p=new I;p.setIconType(I.ICON_TYPE_INFO);p.setTipsSize(310,290);p.setTipsHtml(w(n));p=p.getJqUi();xa.layoutCtrlWithLRTB(p,null,Xa?15:45,null,19,null,null);var W=n.getNumber(),ba=function(){var N=$("<span>"),E="("+W+")";""!==x?u.doHighLightText(N,E,x):N.text(E);N.css({"margin-left":"10px",color:"#C0C0C0"});N.appendTo(H);H.attr("title",P+E);E=$("<div>");if(n.hasLicence()){N=f.get("metricCardInValidTips","\u8be5\u6307\u6807\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664");
var Ha="invalid-metric-card-icon";xa.layoutCtrlWithLRTB(E,75,0,150,45,0,93)}else N=f.get("noLicenceTips","\u5f53\u524d\u7cfb\u7edf\u6ca1\u6709\u3010\u8f7b\u5efa\u6a21\u3011\u6a21\u5757\u7684\u4f7f\u7528\u8bb8\u53ef\uff0c\u8bf7\u4e0e\u7cfb\u7edf\u7ba1\u7406\u5458\u8054\u7cfb"),Ha="no-licence-metric-card-icon",xa.layoutCtrlWithLRTB(E,110,0,73,70,0,48);Sa.background(E,Ha);Ha=$("<div class='metric-card-item-invalid-text'>");Ha.text(N);h.append(E);h.append(Ha)};n&&n.getExpr()&&n.hasLicence()?(h.append(Q("metric-card-item-code",
f.get("tipsCode","\u7f16\u7801\uff1a"),W)),h.append(Q("metric-card-item-desc",f.get("tipsDesc","\u63cf\u8ff0\uff1a"),n.getDesc())),h.append(Q("metric-card-item-expr",f.get("tipsExpr","\u8868\u8fbe\u5f0f\uff1a"),"").append(u.getDisplayExprJqUi(n.getExpr()))),h.append(p)):ba();return h},w=function(x){var p=$("<div>");p.css("overflow","auto hidden");xa.layoutCtrl(p,null,null,280,260);var H=function(ia,ha){var W=$("<div class='metric-card-item-tips-info'>"),ba=$("<span>");ba.text(ia);ia=$("<span>");ia.text(ha);
W.attr("title",ha);W.append(ba);W.append(ia);return W};p.append(H(f.get("tipsCode","\u7f16\u7801\uff1a"),x.getNumber()));p.append(H(f.get("tipsName","\u540d\u79f0\uff1a"),x.getMetricName()));p.append(H(f.get("tipsDesc","\u63cf\u8ff0\uff1a"),x.getDesc()));p.append(H(f.get("tipsExpr","\u8868\u8fbe\u5f0f\uff1a"),"").append(u.getDisplayExprJqUi(n.getExpr())));var P=x.getDisplayDataUpdateTime();p.append(H(f.get("tipsDataUpdateTime","\u6570\u636e\u66f4\u65b0\u65f6\u95f4\uff1a"),P));p.append(H(f.get("tipsMetricCreator",
"\u6307\u6807\u521b\u5efa\u4eba\uff1a"),x.getMetricCreator()));p.append(H(f.get("tipsPath","\u8def\u5f84\uff1a"),x.getPath()));p.append(H(f.get("tipsAddPeople","\u6dfb\u52a0\u4eba\uff1a"),x.getAddPeople()));P=x.getDisplayAddTime();p.append(H(f.get("tipsAddTime","\u6dfb\u52a0\u65f6\u95f4\uff1a"),P));p.append(H(f.get("tipsDimension","\u7ef4\u5ea6\uff1a"),x.getDimension()));P="";x=x.getFilterItems();for(var Q=0;Q<x.length;Q++)P+=x[Q].getDisplayText(),P+="\r\n";p.append(H(f.get("tipsFilterCondition",
"\u8fc7\u6ee4\u6761\u4ef6\uff1a"),P));return p}}oa.call(this);var u=this.protectedMethod,y=this,K=[];this.protectedInitViewUi=function(){return $("<div class='metric-library-card-view'>")};this.protectedUpdateSelectedAllUi=function(n){K.forEach(function(h){h.setSelected(n)})};this.protectedUpdateViewUi=function(n){n.empty();K=[];for(var h=u.getMetrics(),g=$(document.createDocumentFragment()),r=0;r<h.length;r++){var w=new c(h[r]);K.push(w);w.getJqUi().appendTo(g)}g.appendTo(n)};this.showClickStatus=
function(n){K.forEach(function(h){h.getMetric().getId()===n.getId()?h.setSelectedStatus(!0):h.setSelectedStatus(!1)})}}function Y(c){ua.call(this);var u=this,y=this.protectedMethod,K,n,h,g;(function(){y.setTitle(f.get("addMetric","\u6dfb\u52a0\u6307\u6807"));var r=.8*c.getMetricContainer().getJqUi().width();r=Math.max(1250,r);u.setSize(r,700);y.setSelectable(!0);y.setContentPaneCreator(function(){n=$("<div>");K=new ya;K.setContainer(n);K.setGlobal(c);K.loadMetric();return n});y.setFooterPaneCreator(function(x){var p=
new M(f.get("confirm","\u786e\u5b9a"));p.setHighlight(!0);var H=p.getJqUi();H.addClass("sa-ctrl-dialog-footer-ok");H.appendTo(x);p.addActionListener(function(P){g=K.getSelectedMetric();0<g.length?c.createFacade(function(Q){var ia=new vb;ia.fromJsonObject(Q);w(ia)},function(Q){(Q=Fa.OperateExceptionPrompt.getOperateExceptionDetail(Q))?(y.destroy(),Q.showPrompt(),Q=!0):Q=!1;return Q}).addMetricToSystem(g,Qa,c.getSelectedCatalog().getId()):y.destroy()});p=new M(f.get("cancel","\u53d6\u6d88"));p.setHighlight(!1);
H=p.getJqUi();H.addClass("sa-ctrl-dialog-footer-cancel");H.appendTo(x);p.addActionListener(function(P){y.destroy();return!0})});var w=function(x){if(x.isSuccess())h&&h(!0),y.destroy();else{x=x.getInvalidCase();var p=x.getFailType();if(p==kb.FAIL_TYPE_INVALID_METRIC){var H=x.getFailMap(),P=function(N){for(var E=0;E<g.length;E++)if(N==g[E].getId())return g[E]},Q=function(N){return N.getName()+"("+N.getNumber()+")"},ia=Object.keys(H);x=0;for(var ha="",W=0;W<ia.length;W++){p=ia[W];var ba=H[p];x+=ba.length;
a:{switch(p){case nb.FAIL_TYPE_NOT_EXIST:p=f.get("metricNotExist","\u6307\u6807\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff1a");break a;case nb.FAIL_TYPE_NO_DATA_AUTH:p=f.get("metricNoAuth","\u6307\u6807\u65e0\u6570\u636e\u6743\u9650\uff1a");break a;case nb.FAIL_TYPE_IS_ADDED:p=f.get("metricIsExist","\u6307\u6807\u5df2\u5b58\u5728\uff1a");break a}p=void 0}ha+=W+1+"\u3001";ha+=p;ha+=Q(P(ba[0]));for(p=1;p<ba.length;p++)ha+="\u3001",ha+=Q(P(ba[p]));ha+="\r\n"}p=C.createFeedbackDialog();p.setMsgImageType(C.MSG_WARNING);
p.setTitle(f.get("operatingTips","\u64cd\u4f5c\u63d0\u793a"));H=f.get("someFail","\u5171#1\u4e2a\u6307\u6807\uff0c\u6dfb\u52a0\u6210\u529f#2\u4e2a\uff0c\u5931\u8d25#3\u4e2a\u3002");H=H.replace("#1",g.length+"");H=H.replace("#2",g.length-x+"");H=H.replace("#3",x+"");p.setMessage(H);p.setDetail(ha);p.setOptionType(C.OPTION_OK);p.setButtonText(C.RETURN_OK,f.get("iSee","\u6211\u77e5\u9053\u4e86"));y.destroy();p.showDialog();h&&h(!1)}else{x=f.get("addFail","\u6dfb\u52a0\u5931\u8d25\u3002");switch(p){case kb.FAIL_TYPE_SYSTEM_NOTEXIST:x+=
f.get("systemNotExist","\u201c#1\u201d\u6307\u6807\u4f53\u7cfb\u4e0d\u5b58\u5728\u3002").replace("#1",fb);break;case kb.FAIL_TYPE_CATALOG_NOTEXIST:x+=f.get("catalogNotExist","\u201c#1\u201d\u76ee\u5f55\u4e0d\u5b58\u5728\u3002").replace("#1",c.getSelectedCatalog().getName());break;case kb.FAIL_TYPE_SYSTEM_WITHOUT_AUTH:x+=f.get("operateWithoutAuth","\u60a8\u6ca1\u6709\u6743\u9650\u64cd\u4f5c\u8be5\u6307\u6807\u4f53\u7cfb\u3002")}y.destroy();c.getMessageCurtain().showPrompt(x,2E3)}}};y.setClosingAction(function(x){})})();
this.setAddSuccessCallback=function(r){h=r};this.show=function(){u.showDialog();n.css("left","0px");n.css("right","0px");n.css("top","0px")}}function t(){function c(d){KTDefaultCellRender.call(this,d);var b=this,q=this.paintCellUI;this.paintCellUI=function(L,A){var D=b.getCurrentRowIdx(),da=b.getCurrentRow(),pa=b.getCurrentColIdx(),Da=da.getUserObject();(new $a).setFormatString("yyyy-MM-dd HH:mm:ss");b.setPaddingHV(8,1);if(D<Ja.getHeadRowCount())q(L,A),0===pa&&1===D?(P=new R,m(),P.addCheckedListener(function(Va,
Ka){if(Ka){Va=Va.isChecked();for(Ka=0;Ka<N.length;Ka++){var bb=N[Ka];if(!a(bb)){var cb=J[bb.getId()];cb&&cb.setChecked(Va);Va&&V(bb)||(Va?e(bb):y.protectedDeleteSelectedMetric(bb))}}H.refreshSelectedRowTotal(Ia);Na()}}),A=P.getJqUi(),xa.layoutCtrl(A,12,0,14,18),A.appendTo(L)):ha&&ha.getColIdx()===pa&&1===D?(ha.reInit(),A=ha.getJqIcon(),A.appendTo($(L)),A.data("sortModel",ha),g=A):pa===Z[t.SOURCE_IDX_KEY]&&1===D&&(A=new I,A.setIconType(I.ICON_TYPE_QUESTION),A.setTipsText(f.get("pathTips",'"\u8def\u5f84\u683c\u5f0f\u4e3a\uff1a\u6a21\u578b\u96c6\u540d\u79f0/\u76ee\u5f55\u540d\u79f0/\u6a21\u578b\u540d\u79f0\u3002\u76ee\u5f55\u53ef\u80fd\u5b58\u5728\u591a\u5c42\u7ea7\uff0c\u5404\u5c42\u7ea7\u4e4b\u95f4\u7531\u201c/\u201d\u5206\u9694\u3002"')),
A.setTipsSize(310,60),A=A.getJqUi(),xa.layoutCtrlWithLRTB(A,($(L).outerWidth()>>1)+((new S).measureWidth(f.get("path","\u8def\u5f84"))>>1)+7,null,null,3,null,null),A.appendTo($(L)));else if(pa===Z[t.CHECKBOX_IDX_KEY])D=new R,A=D.getJqUi(),a(Da)?(da=!0,D.setEnabled(!1),A.attr("title",f.get("metricExist","\u8be5\u6307\u6807\u5df2\u88ab\u6dfb\u52a0\u5230\u5f53\u524d\u6307\u6807\u4f53\u7cfb\u7684\u76ee\u5f55\u4e2d\u3002"))):(da=V(Da),J[Da.getId()]=D,D.setUserObject(Da),D.addCheckedListener(function(Va,
Ka){Ka&&(Va.isChecked()?e(Da):y.protectedDeleteSelectedMetric(Da),H.refreshSelectedRowTotal(Ia),m(),Na())})),D.setChecked(da),xa.layoutCtrl(A,12,4,14,18),A.appendTo(L);else if(pa===Z[t.METRIC_CODE_IDX_KEY])A=$("<div class='metric-library-add-metric-cell-item'>"),D=Da.getNumber(),Ha&&""!=$.trim(ia.getText())?B(A,D,$.trim(ia.getText())):A.text(D),A.attr("title",D),$(L).append(A);else if(pa===Z[t.METRIC_NAME_IDX_KEY])A=$("<div class='metric-library-add-metric-cell-item'>"),D=$("<span>"),D.addClass("metric-library-add-metric-cell-name"),
da=Da.getName(),Ha&&""!=$.trim(ia.getText())?B(D,da,$.trim(ia.getText())):D.text(da),A.attr("title",da),da=$("<span>"),Sa.background(da,"metric-icon-small"),da.css({"padding-right":"16px"}),da.appendTo(A),D.appendTo(A),$(L).append(A);else if(pa===Z[t.METRIC_DESC_IDX_KEY])A=$("<div class='metric-library-add-metric-cell-item'>"),D=Da.getDesc(),A.attr("title",D),Ha&&""!=$.trim(ia.getText())?B(A,D,$.trim(ia.getText())):A.text(D),$(L).append(A);else if(pa===Z[t.EXPR_IDX_KEY])A=Da.getExpr().getDisplayExprJqUi(),
A.addClass("metric-library-add-metric-cell-item"),xa.layoutCtrlWithLRTB(A,0,0,null,null,null,28),D=Da.getExpr().getDisplayExpr(),A.attr("title",D),$(L).append(A);else if(pa===Z[t.DIMENSION_IDX_KEY])A=$("<span class='metric-library-add-metric-cell-item'>"),D=Da.getDimension(),xa.layoutCtrlWithLRTB(A,0,0,null,null,null,28),Da.isDigest()&&v(Da,A,L),A.attr("title",D),A.text(D),$(L).append(A);else if(pa===Z[t.SOURCE_IDX_KEY])A=$("<div class='metric-library-add-metric-cell-item'>"),D=Da.getPath(),A.attr("title",
D),A.text(D),$(L).append(A);else if(pa===Z[t.FILTER_IDX_KEY]){A=$("<div class='metric-library-add-metric-cell-item'>");D="";da=Da.getFilterItems();for(pa=0;pa<da.length;pa++)D+=da[pa].getDisplayText(),D+="\r\n";A.attr("title",D);A.text(D);$(L).append(A)}else pa===Z[t.CREATOR_IDX_KEY]?(A=Da.getCreator(),D=$("<div class='metric-library-add-metric-cell-item'>"),D.text(A),D.attr("title",A),$(L).append(D)):pa===Z[t.DATA_UPDATE_TIME_IDX_KEY]&&(A=$("<div class='metric-library-add-metric-cell-item'>"),D=
Da.getDisplayDataUpdateTime(),A.text(D),A.attr("title",D),$(L).append(A))};var v=function(L,A,D){var da=$("<span>");da.text(f.get("dimensionDetailInfo","\u8be6\u60c5>"));da.addClass("metric-library-add-metric-cell-detail");da.on("click",function(){var pa=da.data("tips");pa||(pa=new La,pa.setSuggestedSize(265,100),pa.mounting(da),da.data("tips",pa));L.getWholeDimension()?pa.setText(L.getWholeDimension()):x.createFacade(function(Da){pa.setText(Da);L.setWholeDimension(Da)}).loadWholeDimensionInfo(L.getModelId())});
A.css("right","32px");da.appendTo($(D))},B=function(L,A,D){if(L&&A&&D){D=D.toUpperCase();for(var da=A.toUpperCase(),pa=da.split(D),Da=D.length,Va=0;Va<pa.length;Va++){var Ka=da.indexOf(pa[Va]),bb=A.substr(0,pa[Va].length);Ka+=pa[Va].length;var cb=da.length-Ka;da=da.substr(Ka,cb);A=A.substr(Ka,cb);Ka=$("<span>");Ka.text(bb);Ka.appendTo(L);Va!=pa.length-1&&1<pa.length&&(Ka=da.indexOf(D),bb=A.substr(Ka,Da),Ka+=Da,cb=da.length-Ka,da=da.substr(Ka,cb),A=A.substr(Ka,cb),Ka=$("<span>"),Ka.text(bb),Ka.css("color",
"red"),Ka.clone().appendTo(L))}}}}function u(){var d=this,b,q,v;this.reInit=function(){b=null;B()};this.getJqIcon=function(){return b};this.setOrder=function(A){q=A;B()};this.getOrder=function(){return q};this.setColIdx=function(A){v=A};this.getColIdx=function(){return v};var B=function(){L();b.addClass("metric-library-add-metric-sort-icon");b.on("click",function(){q?q==u.ASC_ORDER?q=u.DESC_ORDER:(ha=null,b.remove()):(ha=d,q=u.ASC_ORDER);L();g&&g[0]!=b[0]&&g.remove();g=b;l()})},L=function(){switch(q){case u.ASC_ORDER:var A=
"sort-asc";break;case u.DESC_ORDER:A="sort-desc";break;default:A="sort"}!b&&(b=$("<div>"));b.attr("title","\u6392\u5e8f");Sa.background(b,A)}}var y=this,K,n,h,g,r,w,x,p,H=new Ua,P,Q,ia,ha,W,ba=[],N=[],E,Ha=!1,Ia=0,J={},Z,wa=[],Aa,aa;this.loadMetric=function(){y.protectedLoadMetric()};this.setGlobal=function(d){x=d};this.setContainer=function(d){K=d};this.getSelectedMetric=function(){return ba};var ca=function(){r=$("<span>");r.css({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",
"z-index":"2"});var d=$("<span>"),b=f.get("noSelectMetric","\u6682\u65e0\u53ef\u9009\u7684\u6307\u6807\uff0c\u73b0\u5728\u53bb")+" ";d.text(b);d.appendTo(r);d=$("<span>");d.css({color:"#2B87F3",cursor:"pointer"});d.text(f.get("createMetric","\u65b0\u5efa\u6307\u6807"));d.on("click",function(){var q=eb.getModelSetHomePageEntrance();q&&q()});d.appendTo(r);r.appendTo(h);r.hide()},ea=function(){h.width()&&F();var d=y.protectedGetHearRowInfo();Q=Ja.createTable();Q.setColumnFitVisibleWidth(!1);Q.addColumns(d.length);
for(var b=Ja.createHeadRow(Q),q=0;q<d.length;q++){var v=d[q],B=0<wa.length?wa[q]:v.width;Q.getColumn(q).setWidth(B);v.name&&b.getCell(q).setValue(v.name)}d=new c(Q);d.setOutsideVisible(!1);Q.setCellRender(d);Q.setSyncUIWhenModelChanged(!0);Q.setCellAcrossListener(function(L,A,D){L=L&&0<L.length?L[0]:null;if(Aa!=L){if(Aa){var da=$(Aa);da=Ma(da);da.removeClass("metric-library-add-metric-sort-icon_hover");var pa=da.data("sortModel");pa&&!pa.getOrder()&&da.remove();Aa=null}1==A&&-1<aa.indexOf(D)&&(A=
Ma($(L)),0==A.length&&(A=$(L),da=new u,da.setOrder(null),da.setColIdx(D),D=da.getJqIcon(),D.appendTo(A),D.data("sortModel",da),A=D),A.addClass("metric-library-add-metric-sort-icon_hover"),Aa=L)}});d=$(Q.getUI());d.addClass("metric-library-add-metric-list-table");d.appendTo(h)},F=function(){var d=h.width()-10;wa=[.04*d,.12*d,.15*d,.2*d,.1*d,.28*d,.11*d,.2*d,.2*d,.2*d]},na=function(){var d=$("<div>");d.addClass("metric-library-add-metric-right-container");p=new fa;p.setText(f.get("selectedMetric","\u5df2\u9009\u6307\u6807")+
"("+ba.length+")");var b=p.getJqUi();b.addClass("metric-library-add-metric-selected-label");b.appendTo(d);b=new fa;b.setText(f.get("allClear","\u5168\u90e8\u6e05\u9664"));b=b.getJqUi();b.on("click",function(){ba=[];for(var q=Object.keys(J),v=0;v<q.length;v++)J[q[v]].setChecked(!1);Na();Ia=0;H.refreshSelectedRowTotal(Ia);m()});b.addClass("metric-library-add-metric-clear-all-label");b.appendTo(d);Ca(d);d.appendTo(K)},Ca=function(d){n=$("<div>");n.addClass("metric-library-add-metric-selected-metric-list");
n.appendTo(d)},Ba=function(d){Ja.clear(Q);ea();ab(d);Ja.refresh(Q);0<N.length?(r.hide(),w.hide()):Ha?(w.show(),r.hide()):(w.hide(),r.show())},Ma=function(d){return d.find(".metric-library-add-metric-sort-icon")},ab=function(d){if(d&&0<d.length){var b=new KTBorderStyle;b.setBottomBorderWidth(1);b.setBottomBorderPen("solid");b.setBottomBorderColor("#e5e5e5");for(var q=0;q<d.length;q++){var v=Ja.createRow(Q,!1);v.setBorder(b);v.setUserObject(d[q])}}},Na=function(){n.empty();if(0<ba.length){for(var d=
$(document.createDocumentFragment()),b=0;b<ba.length;b++)Pa(ba[b]).appendTo(d);d.appendTo(n)}p.setText(f.get("selectedMetric","\u5df2\u9009\u6307\u6807")+"("+ba.length+")")},Pa=function(d){var b=d.getName()+"("+d.getNumber()+")",q=$("<div>");q.addClass("metric-library-add-metric-selected-item");var v=$("<div>");v.text(d.getName());v.attr("title",b);v.addClass("metric-library-add-metric-selected-item-name");b=$("<div>");xa.makeTextOmissible(b);b.css("color","rgb(192, 192, 192)");var B=$("<span>");
B.css("color","rgb(192, 192, 192)");B.text("("+d.getNumber()+")");B.appendTo(b);b.appendTo(v);v.appendTo(q);var L=$("<div>");L.on("click",function(){y.protectedDeleteSelectedMetric(d);var A=J[d.getId()];A&&A.setChecked(!1);H.refreshSelectedRowTotal(Ia);m();Na()});Sa.background(L,"btn-delete");L.addClass("metric-library-add-metric-selected-item-icon");L.appendTo(q);q.mouseenter(function(){L.show()}).mouseleave(function(){L.hide()});return q},V=function(d){for(var b=0;b<ba.length;b++)if(ba[b].equals(d))return!0;
return!1},a=function(d){for(var b=0;b<E.length;b++)if(E[b]==d.getId())return!0;return!1},e=function(d){ba.push(d);Ia++},m=function(){for(var d=!0,b=0;b<N.length;b++)if(!a(N[b])&&!V(N[b])){d=!1;break}P.setChecked(d)},l=function(){if(ha){var d=ha.getOrder()==u.ASC_ORDER,b=[].concat(N);b.sort(z(d));for(var q=[],v=[],B=[],L=[],A=[],D=0;D<b.length;D++){var da=k(b[D]);da||0===da?/^\d+?.*$/.test(da)?(v=v||[],v.push(b[D])):/^[a-zA-Z]+?.*$/.test(da)?(B=B||[],B.push(b[D])):/^[\u4e00-\u9fa5]+?.*$/.test(da)?
(L=L||[],L.push(b[D])):(A=A||[],A.push(b[D])):(q=q||[],q.push(b[D]))}b=d?[].concat(v||[]).concat(B||[]).concat(L||[]).concat(A||[]).concat(q||[]):[].concat(q||[]).concat(A||[]).concat(L||[]).concat(B||[]).concat(v||[]);Ba(b)}else Ba(N)},z=function(d){return function(b,q){b=k(b);q=k(q);var v=b-q;isNaN(v)&&(v=String(b).localeCompare(String(q),"zh-CN",{sensitivity:"accent"}));return d?v:-v}},k=function(d){switch(ha.getColIdx()){case Z[t.METRIC_CODE_IDX_KEY]:return d.getNumber();case Z[t.METRIC_NAME_IDX_KEY]:return d.getName();
case Z[t.CREATOR_IDX_KEY]:return d.getCreator()}};u.DESC_ORDER="desc";u.ASC_ORDER="asc";this.protectedMethod={getPaginationBar:function(){return H},getMetricTable:function(){return Q},getMapMetricCheckBox:function(){return J},getSelectedCount:function(){return Ia},setSelectedCount:function(d){Ia=d},setExistMetricId:function(d){E=d},checkMetricIsExist:a,getSelectAllCheckBox:function(){return P},getCurrentPageMetric:function(){return N},setCurrentPageMetric:function(d){N=d},getSearchStatus:function(){return Ha},
setSearchStatus:function(d){Ha=d},getSearchBox:function(){return ia},getSwitchButton:function(){return W},getGlobal:function(){return x},updateCurrentPageMetric:function(d){N=[];for(var b=0;b<d.length;b++){var q=new wb;q.fromJsonObject(d[b]);q=q.getMetricInfos();N=N.concat(q)}},updateMetricTable:Ba,checkMetricIsSelected:V,addMetricToSelectedList:e,updateSelectAllCheckBox:m,updateSelectedMetricList:Na,createMetricRow:ab,doSortMetric:l,init:function(){K.css("display","flex");Z=y.protectedGetColumnIndexMap();
aa=[Z[t.METRIC_CODE_IDX_KEY],Z[t.METRIC_NAME_IDX_KEY],Z[t.CREATOR_IDX_KEY]];var d=$("<div>");d.css({width:"80%",height:"100%"});var b=$("<div>");b.addClass("metric-library-add-metric-manage-bar");ia=new G;ia.setSearchListenerDelay(1E3);ia.setShowSearchIcon(!0);ia.setPlaceholder(f.get("searchContent","\u8bf7\u8f93\u5165\u641c\u7d22\u5185\u5bb9"));ia.getJqUi().addClass("metric-library-add-metric-search-box");var q=$("<div>");q.addClass("metric-library-add-metric-switch-button-container");var v=$("<div>");
v.text(f.get("showNoAddMetric","\u4ec5\u663e\u793a\u5c1a\u672a\u6dfb\u52a0\u7684\u6307\u6807"));v.addClass("metric-library-add-metric-switch-button-text");v.appendTo(q);W=new T;W.setOn(!0);v=W.getJqUi();v.addClass("metric-library-add-metric-switch-button");v.appendTo(q);q.appendTo(b);y.protectedInitManageBar(b);b.appendTo(d);h=$("<div>");h.addClass("metric-library-add-metric-list-view");ca();w=(new hb).getJqUi();w.appendTo(h);w.hide();y.protectedInitPaginationBar(h);ea();h.appendTo(d);d.appendTo(K);
na()}}}function ya(){t.call(this);var c=this.protectedMethod,u=this,y,K,n,h=[],g=[],r,w=[ya.METRIC_TYPE_SELF_BULD,ya.METRIC_TYPE_PRESET],x=[{width:40},{width:145,name:f.get("code","\u7f16\u7801")},{width:150,name:f.get("name","\u540d\u79f0")},{width:180,name:f.get("metricDesc","\u63cf\u8ff0")},{width:120,name:f.get("metricCreator","\u6307\u6807\u521b\u5efa\u4eba")},{width:235,name:f.get("path","\u8def\u5f84")},{width:130,name:f.get("dataUpdateTime","\u6570\u636e\u66f4\u65b0\u65f6\u95f4")},{width:160,
name:f.get("expr","\u8868\u8fbe\u5f0f")},{width:120,name:f.get("dimension","\u7ef4\u5ea6")},{width:110,name:f.get("filterCondition","\u8fc7\u6ee4\u6761\u4ef6")}],p={},H,P,Q;this.protectedLoadMetric=function(){c.getGlobal().createFacade(function(aa){var ca=aa.presetModelSet,ea=aa.normalModelSet,F=new ob;F.setIsAll(!0);F.setName(f.get("all","\u5168\u90e8"));h.push(F);g.push(F);for(F=0;F<ca.length;F++){var na=new ob;na.fromJsonObject(ca[F]);h.push(na)}for(F=0;F<ea.length;F++)na=new ob,na.fromJsonObject(ea[F]),
g.push(na);c.updateCurrentPageMetric(aa.metricModel);c.setExistMetricId(aa.existMetric);P=aa.count;p[t.CHECKBOX_IDX_KEY]=0;p[t.METRIC_CODE_IDX_KEY]=1;p[t.METRIC_NAME_IDX_KEY]=2;p[t.METRIC_DESC_IDX_KEY]=3;p[t.CREATOR_IDX_KEY]=4;p[t.SOURCE_IDX_KEY]=5;p[t.DATA_UPDATE_TIME_IDX_KEY]=6;p[t.EXPR_IDX_KEY]=7;p[t.DIMENSION_IDX_KEY]=8;p[t.FILTER_IDX_KEY]=9;c.init();c.updateMetricTable(c.getCurrentPageMetric())}).loadFirstPageMetric(Qa)};this.protectedGetColumnIndexMap=function(){return p};this.protectedGetHearRowInfo=
function(){return x};this.protectedInitManageBar=function(aa){ia(aa);wa(aa);ha(aa);c.getSwitchButton().addStateChangeListener(function(ca,ea,F){E()})};this.protectedInitPaginationBar=function(aa){var ca=c.getPaginationBar();ca.setComboBoxItemModelsAndSelectedItem([5,10,20,50,100,500,1E3],2);ca.setJumpToPageListener(function(ea,F,na){ba(ea,F,na)});ca.resetPaginationAndJumpToFirstPage(P);ca.refreshPagination();ca.setSelectedAllOrNotListener(function(ea,F){ea?Ia(F):J()});ca=ca.getJqUi();ca.addClass("metric-library-add-metric-pagination-bar");
ca.appendTo(aa)};this.protectedDeleteSelectedMetric=function(aa){for(var ca=u.getSelectedMetric(),ea=c.getSelectedCount(),F=0;F<ca.length;F++)if(ca[F].equals(aa)){ca.splice(F,1);(K.isAll()||aa.getModelSetId()==K.getId())&&Z(aa)&&H==ya.METRIC_TYPE_PRESET==aa.isPresetMetric()&&(ea--,c.setSelectedCount(ea));break}};var ia=function(aa){var ca=$("<div>");ca.addClass("metric-library-add-metric-selector-container");var ea=$("<div>");ea.addClass("metric-library-add-metric-selector-text");ea.text(f.get("modelSet",
"\u6a21\u578b\u96c6"));ea.appendTo(ca);n=new U;r=g;n.setSelectedModel(r[0]);n.setDropdownCreator(function(F,na,Ca){na=$("<div>");na.appendTo(F);na.css({width:"100%",height:"100%","z-index":"999999"});var Ba=new G;Ba.setPlaceholder(f.get("search","\u641c\u7d22"));Ba.addSearchListener(function(){ab()});F=new fa(f.get("noMatchModelSet","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c"));F.setEnabled(!1);var Ma=F.getJqUi();Ma.css({position:"absolute","text-align":"center",top:"10px",
width:"100%",height:"12px","justify-content":"center"});Ma.hide();var ab=function(){var Pa=$.trim(Ba.getText());if(Pa&&""!=Pa){Pa=Pa.toLowerCase();for(var V=[],a=0;a<r.length;a++)-1!=r[a].getName().toLowerCase().indexOf(Pa)&&V.push(r[a]);Na.setItemModels(V);0==V.length?Ma.show():Ma.hide()}else Ma.hide(),Na.setItemModels(r),Na.scrollSelectedToVisible()};F=Ba.getJqUi();F.css({position:"absolute",height:"25px",top:"0px",left:"0px",right:"0px"});F.find("input").on("keydown",function(Pa){13===(Pa.keyCode||
Pa.which||Pa.charCode)&&ab()});F.appendTo(na);var Na=new za;Na.setToggleSelectingEnabled(!1);Na.setItemModels(r);Na.setSelecteds(n.getSelectedModel()?[n.getSelectedModel()]:[]);Na.setCustomItemPainter(function(Pa,V){V&&(Pa.text(V.getName()),Pa.attr("title",V.getName()))});Na.addSelectedChangedListener(function(Pa,V,a){Ca(0<a.length?a[0]:null)});F=Na.getJqUi();F.css({position:"absolute",top:"25px",bottom:"0px",width:"100%"});setTimeout(function(){Na.scrollSelectedToVisible()},0);F.appendTo(na);Ma.appendTo(F);
return[150,-1]});n.setCustomPainter(function(F,na){F&&(na.text(F.getName()),na.attr("title",F.getName()))});n.addSelectionListener(function(F){K=F.getSelectedModel();E()});ea=n.getJqUi();ea.css({width:"150px",position:"relative"});ea.appendTo(ca);y=new Ea;y.setItemModels(g);y.setCustomPainter(function(F,na,Ca){Ca&&(na.text(Ca.getName()),na.attr("title",Ca.getName()))});y.setSelected(g[0]);K=g[0];y.addSelectedChangedListener(Ha);y.getJqUi().css({position:"relative",width:"150px"});ca.appendTo(aa)},
ha=function(aa){var ca=c.getSearchBox();ca.addSearchListener(function(){W($.trim(ca.getText()))});var ea=ca.getJqUi();ea.find("input").on("keydown",function(F){13===(F.keyCode||F.which||F.charCode)&&W($.trim(ca.getText()))});ea.appendTo(aa)},W=function(aa){var ca=c.getSearchStatus();""==aa?ca&&(c.setSearchStatus(!1),E()):(c.setSearchStatus(!0),E())},ba=function(aa,ca,ea){var F=(new Date).getTime();Q=F;var na=c.getGlobal().createFacade(function(Ba){if(Q==F){var Ma=Ba.count;ea&&ea(Ma);c.updateCurrentPageMetric(Ba.metricModel);
c.doSortMetric()}}),Ca=c.getSwitchButton().isOn()?Qa:null;na.getMetricByPage(N(aa,ca,Ca))},N=function(aa,ca,ea){var F=new xb;F.setModelSetId(K.getId());F.setSystemId(ea);F.setSearchText($.trim(c.getSearchBox().getText()));F.setPreset(H==ya.METRIC_TYPE_PRESET);F.setTargetPage(aa);F.setPageSize(ca);F.setShowNoAddMetric(c.getSwitchButton().isOn());return F},E=function(){var aa=c.getPaginationBar();ba(1,aa.getPageSize(),function(ca){for(var ea=0,F=c.getPaginationBar(),na=u.getSelectedMetric(),Ca=na.length-
1;0<=Ca;Ca--){var Ba=na[Ca];(K.isAll()||Ba.getModelSetId()==K.getId())&&Z(Ba)&&H==ya.METRIC_TYPE_PRESET==Ba.isPresetMetric()&&ea++}F.resetPaginationAndJumpToFirstPage(ca);F.refreshSelectedRowTotal(ea);F.refreshPagination();c.setSelectedCount(ea)})},Ha=function(aa,ca,ea){K=ea;E()},Ia=function(aa){var ca=c.getGlobal(),ea=c.getMapMetricCheckBox();ca.createFacade(function(F){for(var na=F.selectedMetric,Ca=0;Ca<na.length;Ca++){var Ba=new yb;Ba.fromJsonObject(na[Ca]);var Ma=ea[Ba.getId()];Ma&&Ma.setChecked(!0);
c.checkMetricIsSelected(Ba)||c.addMetricToSelectedList(Ba)}c.updateSelectAllCheckBox();c.updateSelectedMetricList();c.getPaginationBar().refreshTotalRow(F.count);c.setSelectedCount(na.length);aa&&aa(na.length)}).getAllSelectMetric(N(null,null,Qa))},J=function(){var aa=c.getGlobal(),ca=u.getSelectedMetric(),ea=c.getMapMetricCheckBox();aa.createFacade(function(F){if(0!=F.length){for(var na=c.getSelectedCount(),Ca=0;Ca<F.length;Ca++)for(var Ba=0;Ba<ca.length;Ba++){var Ma=ca[Ba];if(Ma.getId()==F[Ca]){ca.splice(Ba,
1);(Ba=ea[Ma.getId()])&&Ba.setChecked(!1);na--;break}}c.setSelectedCount(na);c.updateSelectAllCheckBox();c.updateSelectedMetricList()}}).cancelAllSelectedMetric(N(null,null,Qa))},Z=function(aa){if(!c.getSearchStatus())return!0;var ca=c.getSearchBox();ca=$.trim(ca.getText()).toLowerCase();var ea=aa.getName(),F=aa.getNumber();aa=aa.getDesc();return-1!=ea.toLowerCase().indexOf(ca)||-1!=F.toLowerCase().indexOf(ca)||-1!=aa.toLowerCase().indexOf(ca)},wa=function(aa){var ca=$("<div>");ca.addClass("metric-library-add-metric-selector-container");
var ea=$("<div>");ea.addClass("metric-library-add-metric-selector-text");ea.text(f.get("metricType","\u6307\u6807\u7c7b\u578b"));ea.appendTo(ca);ea=new Ea;ea.setItemModels(w);ea.setCustomPainter(function(F,na,Ca){Ca&&(F=Ca==ya.METRIC_TYPE_PRESET?f.get("presetMetric","\u9884\u7f6e\u6307\u6807"):f.get("enterpriseBuild","\u81ea\u5efa\u6307\u6807"),na.text(F),na.attr("title",F))});ea.setSelected(w[0]);H=w[0];ea.addSelectedChangedListener(Aa);ea=ea.getJqUi();ea.css({position:"relative",width:"80px"});
ea.appendTo(ca);ca.appendTo(aa)},Aa=function(aa,ca,ea){H=ea;r=H==ya.METRIC_TYPE_PRESET?h:g;n.setSelectedModel(r[0]);K=r[0]}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.metriclibrary&&(com.kingdee.bos.qing.modeler.metriclibrary=
{});"undefined"==typeof com.kingdee.bos.qing.modeler.metriclibrary.ui&&(com.kingdee.bos.qing.modeler.metriclibrary.ui={});var Fa=com.kingdee.bos.qing.modeler.metriclibrary.ui;Fa.Main=function(){function c(){O.call(this);var a=this,e=this.protectedMethod,m,l,z,k,d;this.protectedInitToolbarUi=function(){m=e.appendButton(J,"addMetric",f.get("addMetric","\u6dfb\u52a0\u6307\u6807"),f.get("addMetric","\u6dfb\u52a0\u6307\u6807"));l=e.appendButton(Z,"removeMetric",f.get("removeMetric","\u79fb\u9664\u6307\u6807"),
f.get("removeMetric","\u79fb\u9664\u6307\u6807"));z=e.appendButton(Aa,"moveMetric",f.get("moveMetric","\u79fb\u52a8\u5230"),f.get("moveMetric","\u79fb\u52a8\u5230"));k=e.appendButton(function(){var v=W,B=ba,L=N;v.clearSearchStatus();L.clearSelectedMetric();L.setSelectedAll(!1);L.getPaginationBar().refreshSelectedRowTotal(0);B.clearSearchStatus();B.setContainSubLevel(!1);pb.clearCatalogNodeCache();zb(v,B,L)},"refresh",f.get("refresh","\u5237\u65b0"),f.get("refresh","\u5237\u65b0"));d=e.appendButton(Db,
"exit",f.get("exit","\u9000\u51fa"),f.get("exit","\u9000\u51fa"))};this.showAvailableToolbarButton=function(){Xa?(q(),a.protectedInitToolbarUi(),b()):(q(),a.protectedInitToolbarUi())};var b=function(){m.getJqUi().remove();l.getJqUi().remove();z.getJqUi().remove()},q=function(){b();k.getJqUi().remove();d.getJqUi().remove()}}function u(){var a=this;this.deleteMetric=function(){a.protectedDeleteMetric()};this.protectedMethod={funSuccessCallBack:function(e){e=f.get("removeMetricSuccess","\u79fb\u9664\u6307\u6807\u6210\u529f\u3002");
E.getMessageCurtain().showSuccess(e,2E3);e=E.getSelectedCatalog();N.clearSelectedMetric();var m=N.getPaginationBar();ib(e,ba.getContainSubLevel(),N,null);m.refreshSelectedRowTotal(0)},funErrorCallBack:function(e,m){return(e=Fa.OperateExceptionPrompt.getOperateExceptionDetail(e,null,null))?(e.showPrompt(),!0):!1}}}function y(){u.call(this);var a=this.protectedMethod;this.protectedDeleteMetric=function(){var e=E.createFacade(function(m){a.funSuccessCallBack(m);N.setSelectedAll(!1)},function(m,l){return a.funErrorCallBack(m,
l)});e.setShowBlocking(!0);e.deleteSystemMetric(Qa)}}function K(a){u.call(this);var e=this.protectedMethod;this.protectedDeleteMetric=function(){var m=E.createFacade(function(l){e.funSuccessCallBack(l);N.setSelectedAll(!1)},function(l,z){return e.funErrorCallBack(l,z)});m.setShowBlocking(!0);m.deleteCatalogsMetric(Qa,a)}}function n(a){u.call(this);var e=this.protectedMethod;this.protectedDeleteMetric=function(){var m=E.createFacade(function(l){e.funSuccessCallBack(l)},function(l,z){return e.funErrorCallBack(l,
z)});m.setShowBlocking(!0);m.deleteMetric(Qa,a)}}function h(){ua.call(this);var a=this.protectedMethod,e=this,m,l,z;(function(){a.setSelectable(!0);a.setContentPaneCreator(function(){e.setSize(360,270);var k=$("<div>"),d=new fa;d.setRequired(!0);d.setText(f.get("catalogName","\u540d\u79f0"));d=d.getJqUi();l=new Ra;m&&l.setText(m);var b=l.getJqUi();d.appendTo(k);b.appendTo(k);xa.layoutCtrl(d,34,40,70,23);xa.layoutCtrl(b,34,70,260,23);return k});a.setFooterPaneCreator(function(k){var d=new M(f.get("confirm",
"\u786e\u5b9a"));d.setHighlight(!0);var b=d.getJqUi();b.addClass("sa-ctrl-dialog-footer-ok");b.appendTo(k);d.addActionListener(function(q){z&&z.operateCatalog($.trim(l.getText()),a);return!0});d=new M(f.get("cancel","\u53d6\u6d88"));d.setHighlight(!1);b=d.getJqUi();b.addClass("sa-ctrl-dialog-footer-cancel");b.appendTo(k);d.addActionListener(function(q){a.destroy();return!0})});a.setClosingAction(function(k){})})();this.setOldName=function(k){m=k};this.setTitle=function(k){a.setTitle(k)};this.setOperateCatalogImpl=
function(k){z=k};this.textFieldFocus=function(){l&&l.requestFocus()}}function g(){var a=this;this.operateCatalog=function(e,m){var l=!1;if(""!==e&&50<e.length)var z=f.get("catalogNameTooLong","\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002");else if(""===e)z=f.get("catalogNameCannotEmpty","\u8bf7\u8f93\u5165\u76ee\u5f55\u540d\u79f0\u3002");else for(var k=pb.getAllCatalogNodeBySystem(),d=0;d<k.length;d++){var b=k[d];if(E.getSelectedCatalog().getId()!==b.getId()&&e===b.getName()){z=
f.get("duplicateName","\u540d\u79f0\u91cd\u590d\u3002");break}}z?m.getMessageCurtain().showPrompt(z):l=a.protectedCheck(e,m);l&&(l=new rb,l.setSystemId(Qa),l.setCatalogName(e),a.protectedOperateCatalog(l,m))}}function r(a,e){g.call(this);this.protectedCheck=function(m,l){return!0};this.protectedOperateCatalog=function(m,l){m.setParentId(a.getId());var z=E.createFacade(function(k){l.destroy();var d=f.get("createCatalogSuccess","\u65b0\u5efa\u76ee\u5f55\u6210\u529f\u3002");E.getMessageCurtain().showSuccess(d,
2E3);d=new Ta;d.fromJsonObject(k);d.setLevel(a.getLevel()+1);d.setParentNode(a);a.getChildren().push(d);e instanceof ja.LeafNode?ba.createNodeOnLeaf(d):ba.createNodeOnBranch(e,d);k=N.getPaginationBar();k.refreshTotalRow(0);k.refreshSelectedRowTotal(0);ba.updateUi(!1,!1);N.showMetrics([])},function(k,d){return(k=Fa.OperateExceptionPrompt.getOperateExceptionDetail(k,a.getName(),l))?(k.showPrompt(),!0):!1});z.setShowBlocking(!0);z.createCatalog(m)}}function w(){g.call(this);this.protectedCheck=function(a,
e){return a===E.getSelectedCatalog().getName()?(e.destroy(),!1):!0};this.protectedOperateCatalog=function(a,e){var m=E.getSelectedCatalog();a.setCatalogId(m.getId());var l=E.createFacade(function(z){e.destroy();z=f.get("editCatalogSuccess","\u7f16\u8f91\u76ee\u5f55\u6210\u529f\u3002");E.getMessageCurtain().showSuccess(z,2E3);m.setName(a.getCatalogName());ba.getCatalogTree().refresh()},function(z,k){return(z=Fa.OperateExceptionPrompt.getOperateExceptionDetail(z,m.getName(),e))?(z.showPrompt(),!0):
!1});l.setShowBlocking(!0);l.updateCatalog(a)}}function x(){ua.call(this);var a=this.protectedMethod,e=this,m,l=new U;(function(){a.setTitle(f.get("moveTo","\u79fb\u52a8\u5230"));a.setSelectable(!0);a.setContentPaneCreator(function(){e.setSize(400,300);return z()});a.setFooterPaneCreator(function(k){var d=new M(f.get("confirm","\u786e\u5b9a"));d.setHighlight(!0);var b=d.getJqUi();b.addClass("sa-ctrl-dialog-footer-ok");b.appendTo(k);d.addActionListener(function(q){m&&m.moveMetric(l.getSelectedModel().getSelectedGroup(),
a);return!0});d=new M(f.get("cancel","\u53d6\u6d88"));d.setHighlight(!1);b=d.getJqUi();b.addClass("sa-ctrl-dialog-footer-cancel");b.appendTo(k);d.addActionListener(function(q){a.destroy();return!0})});a.setClosingAction(function(k){})})();this.setMoveMetricImpl=function(k){m=k};var z=function(){var k=$("<div>"),d=new fa;d.setText(f.get("catalog","\u76ee\u5f55"));d=d.getJqUi();d.appendTo(k);xa.layoutCtrl(d,25,50,70,23);d=ba.getCatalogTree().getRootGroup().getUserObject();var b=new p(d.getChildren()),
q=new ha;q.setSelectedGroup(d.getChildren()[0]);q.setPath(d.getChildren()[0].getName());l.setSelectedModel(q);l.setDropdownCreator(function(v,B,L){return b.createJqPopup(v,B,L)});l.setCustomPainter(function(v,B){B.text(v?v.getPath():"");B.attr("title",v?v.getPath():"")});d=l.getJqUi();d.appendTo(k);xa.layoutCtrl(d,100,50,240,23);return k}}function p(a){var e;this.createJqPopup=function(q,v,B){e=B;v=new ja;v.setRootVisible(!1);v.setNodePainter(m);B=v.setRoot;var L=new Ab;L.setName(" ");L.setId("0");
L=z(L);d(L,a);B.call(v,L);v.hookLoadingHandler(b);v.addSelectingListener(l);v.getRoot().setExpanded(!0);v.getRoot().setSelectable(!1);v.setLineHeight(30);v.getJqUi().css({overflow:"hidden auto",border:"1px solid rgba(138, 153, 170, 0.4)",width:"100%",position:"absolute","max-height":"162px",background:"white"});v.getJqUi().appendTo(q);return[-1,Math.min(30*a.length,162)]};var m=function(q,v){v=v.getUserObject().getName();q.css("width","calc(100% - 30px)");q.css("padding-left","4px");q.css("padding-right",
"4px");q.text(v);q.attr("title",v)},l=function(q,v){var B=v.getTreePath();q="";for(var L=1;L<B.length;L++)1<L&&(q+="/"),q+=B[L].getUserObject().getName();B=new ha;B.setSelectedGroup(v.getUserObject());B.setPath(q);e(B)},z=function(q){var v=new ja.BranchNode;v.setUserObject(q);return v},k=function(q){var v=new ja.LeafNode;v.setUserObject(q);return v},d=function(q,v){if(v)for(var B=0;B<v.length;B++){var L=v[B];if(L instanceof Ta){var A=L.getChildren();A&&0<A.length?(L=z(L),q.addChild(L)):q.addChild(k(L))}else q.addChild(k(L))}},
b=function(q,v){d(q,q.getUserObject().getChildren());v()}}function H(){var a=this;this.moveMetric=function(e,m){a.protectedMoveMetric(e,m)};this.protectedMethod={funMoveSuccessCallBack:function(e,m){e.destroy();e=f.get("moveMetricSuccess","\u79fb\u52a8\u6307\u6807\u6210\u529f\u3002");E.getMessageCurtain().showSuccess(e,2E3);N.clearSelectedMetric();N.getPaginationBar().refreshSelectedRowTotal(0);e=E.getSelectedCatalog();ib(e,ba.getContainSubLevel(),N,null)},funMoveFailedCallBack:function(e,m,l){return(e=
Fa.OperateExceptionPrompt.getOperateExceptionDetail(e,m,l))?(e.showPrompt(),!0):!1}}}function P(){H.call(this);var a=this.protectedMethod,e=[];this.setMoveMetrics=function(m){e=m};this.protectedMoveMetric=function(m,l){var z=E.createFacade(function(k){a.funMoveSuccessCallBack(l,k)},function(k,d){return a.funMoveFailedCallBack(k,m.getName(),l)});z.setShowBlocking(!0);z.moveMetric(Qa,e,m.getId())}}function Q(){H.call(this);var a=this.protectedMethod;this.protectedMoveMetric=function(e,m){var l=E.createFacade(function(z){a.funMoveSuccessCallBack(m,
z)},function(z,k){return a.funMoveFailedCallBack(z,e.getName(),m)});l.setShowBlocking(!0);l.moveSystemMetric(Qa,e.getId())}}function ia(){H.call(this);var a=this.protectedMethod,e;this.setCatalogIds=function(m){e=m};this.protectedMoveMetric=function(m,l){var z=E.createFacade(function(k){a.funMoveSuccessCallBack(l,k)},function(k,d){return a.funMoveFailedCallBack(k,m.getName(),l)});z.setShowBlocking(!0);z.moveCatalogMetric(Qa,e,m.getId())}}function ha(){var a,e;this.setSelectedGroup=function(m){a=m};
this.getSelectedGroup=function(){return a};this.setPath=function(m){e=m};this.getPath=function(){return e}}var W,ba,N,E=new function(){var a,e=!1;this.getSelectedCatalog=function(){return ba&&ba.getCatalogTree()?ba.getCatalogTree().getSelectedNode().getUserObject():ba.getCatalogFolderNode()};this.getMessageCurtain=function(){a||(a=new Oa,a.getJqUi().appendTo($("body")));return a};this.getSearchText=function(){return W.getSearchText()};this.getIsTableView=function(){return W.getIsTableView()};this.setSearchStatus=
function(m){e=m};this.getSearchStatus=function(){return e};this.createFacade=function(m,l,z,k){k||(k=eb.getRemoteImpl());return new lb(k,m,function(d,b,q){return l?l(d,b,q):!1},z)};this.getCatalogContainer=function(){return ba};this.getMetricContainer=function(){return N}};this.getJqUi=function(){var a=$("<div class='metric-library-manage'>");W=new c;W.setSearchListener(function(k){var d=ba,b=N,q=d.getCatalogTree();q&&(0!==k.length||b.getGlobal().getSearchStatus())&&(b.getGlobal().setSearchStatus(0<
k.length),b.clearSelectedMetric(),b.setSelectedAll(!1),b.getPaginationBar().refreshSelectedRowTotal(0),k=q.getSelectedNode().getUserObject(),d=d.getContainSubLevel(),ib(k,d,b,null))});W.setViewSwitchListener(function(k){var d=N;k=k?d.getMetricCardView():d.getMetricTableView();d.setViewSelectedMetricsMap(k.getSelectedMetricsMap());d.showMetrics(k.getMetrics())});a.append(W.getJqUi());ba=Ha();ba.setGlobal(E);ba.setTreeNodeClickListener(function(k){var d=ba,b=N,q=b.getPaginationBar(),v=k.getId()===Ta.ROOT_NODE_ID;
q.refreshSelectedRowTotal(0);b.setSelectedAll(!1);d.updateUi(!1,v);d=d.getContainSubLevel();b.clearSelectedMetric();ib(k,d,b,null)});ba.setContainSubLevelListener(function(k){ba.setContainSubLevel(k);var d=E.getSelectedCatalog(),b=N;b.getPaginationBar().refreshSelectedRowTotal(0);ib(d,k,b,null)});var e=ba.getJqUi();N=Ia();var m=N.getJqUi(),l=new ta;l.setHorizontalSplit(!0);l.setSplitLineWide(8);l.setResizeMode(ta.RESIZE_MODE_FIRST_FIXED);l.setFirstChild(ta.createChildWrapper(e,function(){e.css({width:l.getNonemptyFirstWide()+
"px"});m.css({width:document.documentElement.clientWidth-l.getNonemptyFirstWide()-20-8+"px"})}));l.setSecondChild(ta.createChildWrapper(m));N.setSplitPane(l);l.setFirstSize(250,224,400);l.setSecondSize(document.documentElement.clientWidth-250-20-8,document.documentElement.clientWidth-400-20-8,document.documentElement.clientWidth-224-20-8);var z=l.getJqUi();z.addClass("metric-library-manage-main");a.append(z);zb(W,ba,N);return a};var Ha=function(){var a=new ma;a.setCatalogEditable(!0);a.setCreateSameLevelCatalog(ca);
a.setCreateSubLevelCatalog(ea);a.setEditCatalog(Ca);a.setDeleteCatalog(Ba);a.setMoveUpCatalog(ab);a.setMoveDownCatalog(Na);var e=new qa;e.setCreateSubLevelCatalog(F);var m=new ka;m.setCatalogToolBar(a);m.setCatalogNoData(e);return m},Ia=function(){var a=new sa;a.setGlobal(E);a.setCatalogContainerWidth(250);return a},J=function(){var a=E.getSelectedCatalog();a?a.getId()!==Ta.ROOT_NODE_ID?(a=new Y(E),a.setAddSuccessCallback(function(e){var m=E.getSelectedCatalog(),l=N.getPaginationBar();ib(m,ba.getContainSubLevel(),
N,[l.resetPaginationAndJumpToFirstPage]);e&&E.getMessageCurtain().showSuccess(f.get("addMetricSuccess","\u6dfb\u52a0\u6210\u529f\u3002"));e=N.getSelectedMetrics().length;l.refreshSelectedRowTotal(e)}),a.show()):0===a.getChildren().length?E.getMessageCurtain().showPrompt(f.get("createCatalogTips","\u8bf7\u5148\u521b\u5efa\u76ee\u5f55\uff0c\u518d\u6dfb\u52a0\u6307\u6807\u3002")):E.getMessageCurtain().showPrompt(f.get("rootNodeNotAddMetric","\u4e0d\u80fd\u5728\u6839\u8282\u70b9\u4e0a\u6dfb\u52a0\u6307\u6807\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u76ee\u5f55\u3002")):
E.getMessageCurtain().showPrompt(f.get("systemNotExist","\u201c#1\u201d\u6307\u6807\u4f53\u7cfb\u4e0d\u5b58\u5728\u3002").replace("#1",fb))},Z=function(){if(0===N.getSelectedMetrics().length){var a=f.get("removeMetricTips","\u8bf7\u9009\u62e9\u9700\u8981\u79fb\u9664\u7684\u6307\u6807\u3002");E.getMessageCurtain().showPrompt(a)}else a=f.get("confirmDeleteMetric","\u79fb\u9664\u6307\u6807\u540e\uff0c\u901a\u8fc7\u8be5\u6307\u6807\u4f53\u7cfb\u4f7f\u7528\u6307\u6807\u7684\u529f\u80fd\u5c06\u53d7\u5230\u5f71\u54cd\uff0c\u786e\u5b9a\u79fb\u9664\u5417\uff1f"),
Pa(a,function(e){wa().deleteMetric()})},wa=function(){if(!N.getSelectedAll()){var a=N.getSelectedMetrics();return new n(a)}a=E.getSelectedCatalog();if(a.getId()===Ta.ROOT_NODE_ID)return new y;var e=[];e.push(a.getId());ba.getContainSubLevel()&&a.getAllChildId(e);return new K(e)},Aa=function(){if(0===N.getSelectedMetrics().length){var a=f.get("moveMetricTips","\u8bf7\u9009\u62e9\u9700\u8981\u79fb\u52a8\u7684\u6307\u6807\u3002");E.getMessageCurtain().showPrompt(a)}else{a=aa();var e=new x;e.setMoveMetricImpl(a);
e.showDialog()}},aa=function(){if(!N.getSelectedAll()){var a=N.getSelectedMetrics(),e=new P;e.setMoveMetrics(a);return e}a=E.getSelectedCatalog();e=a.getId();if(e===Ta.ROOT_NODE_ID)return new Q;e=[e];ba.getContainSubLevel()&&a.getAllChildId(e);a=new ia;a.setCatalogIds(e);return a},ca=function(){var a=new h,e=E.getSelectedCatalog(),m=ba.getCatalogTree().getSelectedNode();a.setOperateCatalogImpl(new r(e.getParentNode(),m.getParent()));a.setTitle(f.get("addSameLevelCatalog","\u65b0\u5efa\u540c\u7ea7"));
a.showDialog();a.textFieldFocus()},ea=function(){4<=E.getSelectedCatalog().getLevel()?E.getMessageCurtain().showPrompt(f.get("modelGroupMaxLevel","\u6700\u591a\u53ef\u652f\u63014\u7ea7\u76ee\u5f55\uff0c\u5f53\u524d\u76ee\u5f55\u4e3a\u7b2c4\u7ea7\u76ee\u5f55\uff0c\u65e0\u6cd5\u65b0\u589e\u4e0b\u7ea7\u76ee\u5f55\u3002")):na(f.get("addSubDir","\u65b0\u5efa\u5b50\u7ea7"))},F=function(){na(f.get("addCatalog","\u65b0\u5efa\u76ee\u5f55"))},na=function(a){var e=new h;e.setTitle(a);a=E.getSelectedCatalog();
var m=ba.getCatalogTree().getSelectedNode();e.setOperateCatalogImpl(new r(a,m));e.showDialog();e.textFieldFocus()},Ca=function(){var a=new h,e=E.getSelectedCatalog().getName();a.setOldName(e);a.setTitle(f.get("updateModelCatalogText","\u7f16\u8f91\u76ee\u5f55"));a.setOperateCatalogImpl(new w);a.showDialog();a.textFieldFocus()},Ba=function(){var a=ba.getCatalogTree().getSelectedNode();a instanceof ja.BranchNode?(a=f.get("deleteChildCatalog","\u8bf7\u5148\u5220\u9664\u76ee\u5f55\u4e0b\u7684\u5b50\u76ee\u5f55\u518d\u5220\u9664\u76ee\u5f55\u3002"),
E.getMessageCurtain().showPrompt(a)):(a=a.getUserObject(),0<a.getTotalRow()?(a=f.get("deleteMetricBeforeCatalog","\u8bf7\u5148\u79fb\u9664\u76ee\u5f55\u4e0b\u7684\u6307\u6807\u518d\u5220\u9664\u76ee\u5f55\u3002"),E.getMessageCurtain().showPrompt(a)):(a=a.getName(),a=f.get("confirmToDelCatalogPrefix","\u5220\u9664\u201c").concat(a).concat(f.get("confirmToDelCatalogSuffix","\u201d\u540e\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u786e\u5b9a\u5220\u9664\u5417\uff1f")),Pa(a,V)))},Ma=function(a,e){var m=ba.getCatalogTree().getSelectedNode();
if(m){var l=m.getUserObject(),z=m.getParent(),k=z.getUserObject().getChildren();if(a?k[0].getId()!==l.getId():k[k.length-1].getId()!==l.getId()){e=k.concat([]);var d=k.indexOf(l),b=a?d-1:d+1;e[d]=e.splice(b,1,e[d])[0];a=[];l=k.length;for(var q=0;q<e.length;q++){var v=e[q],B=new rb;B.setCatalogId(v.getId());B.setSeq(l);a.push(B.toJsonObject());l--}(new lb(eb.getRemoteImpl(),function(L){k[d]=k.splice(b,1,k[d])[0];z.removeChild(m);z.insertChild(m,b);ba.updateUi(!0,!1,m)},function(L,A){return(L=Fa.OperateExceptionPrompt.getOperateExceptionDetail(L,
null,null))?(L.showPrompt(),!0):!1})).updateCatalogSequence(Qa,a)}else E.getMessageCurtain().showPrompt(e)}},ab=function(){Ma(!0,f.get("unableMoveUp","\u540c\u5c42\u7ea7\u7684\u7b2c\u4e00\u4e2a\u76ee\u5f55\u4e0d\u652f\u6301\u4e0a\u79fb\u3002"))},Na=function(){Ma(!1,f.get("unableMoveDown","\u540c\u5c42\u7ea7\u7684\u6700\u540e\u4e00\u4e2a\u76ee\u5f55\u4e0d\u652f\u6301\u4e0b\u79fb\u3002"))};Fa.OperateExceptionPrompt=new function(){function a(e,m,l,z){this.showPrompt=function(){l.showPrompt(e.replace("#1",
m));z&&z()}}this.getOperateExceptionDetail=function(e,m,l){switch(e){case 20010001:return new a(f.get("duplicateName","\u540d\u79f0\u91cd\u590d\u3002"),null,l.getMessageCurtain(),null);case 20010002:return new a(f.get("deleteMetricBeforeCatalog","\u8bf7\u5148\u79fb\u9664\u76ee\u5f55\u4e0b\u7684\u6307\u6807\u518d\u5220\u9664\u76ee\u5f55\u3002"),null,E.getMessageCurtain(),l&&l.destroy());case 20010003:return new a(f.get("catalogNotExist","\u201c#1\u201d\u76ee\u5f55\u4e0d\u5b58\u5728\u3002"),m,E.getMessageCurtain(),
l&&l.destroy());case 20010004:return new a(f.get("deleteChildCatalog","\u8bf7\u5148\u5220\u9664\u76ee\u5f55\u4e0b\u7684\u5b50\u76ee\u5f55\u518d\u5220\u9664\u76ee\u5f55\u3002"),null,E.getMessageCurtain(),l&&l.destroy());case 20010301:return new a(f.get("systemNotExist","\u201c#1\u201d\u6307\u6807\u4f53\u7cfb\u4e0d\u5b58\u5728\u3002"),fb,E.getMessageCurtain(),l&&l.destroy());case 20010302:return new a(f.get("systemDisabled","\u201c#1\u201d\u6307\u6807\u4f53\u7cfb\u5df2\u88ab\u7981\u7528\u3002"),fb,
E.getMessageCurtain(),l&&l.destroy());case 20010303:return new a(f.get("operateWithoutAuth","\u60a8\u6ca1\u6709\u6743\u9650\u64cd\u4f5c\u8be5\u6307\u6807\u4f53\u7cfb\u3002"),null,E.getMessageCurtain(),l&&l.destroy());case 20011005:return new a(f.get("noMenuPermission","\u60a8\u6ca1\u6709\u5f53\u524d\u83dc\u5355\u6743\u9650\u3002"),null,E.getMessageCurtain(),l&&l.destroy())}return null}};var Pa=function(a,e){var m=C.createFeedbackDialog();m.setMsgImageType(C.MSG_DELETE);m.setMessage(a);m.showDialog();
m.setClosingChecker(function(l){l===C.RETURN_OK&&e&&e(m);return!0})},V=function(a){var e=E.getSelectedCatalog();a=e.getId();var m=e.getName();e=E.createFacade(function(l){l=f.get("deleteCatalogSuccess","\u5220\u9664\u76ee\u5f55\u6210\u529f\u3002");E.getMessageCurtain().showSuccess(l,2E3);ba.removeCatalogLeafNode();N.clearSelectedMetric();N.getPaginationBar().refreshSelectedRowTotal(0);pb.clearCatalogNodeCache();Eb(W,ba,N)},function(l,z){return(l=Fa.OperateExceptionPrompt.getOperateExceptionDetail(l,
m,null))?(l.showPrompt(),!0):!1});e.setShowBlocking(!0);e.deleteCatalog(Qa,a)}};var Ga=com.kingdee.bos.qing.modeler.metriclibrary,Oa,fa,Ra,ta,Wa,G,M,T,R,C,U,ja,I,La,ua,Ea,za,Ua,f,Za,Ya,Ja,ra,xa,$a,gb,S,jb,db,hb,Sa,lb,eb,ob,wb,yb,Ta,rb,mb,sb,tb,pb,Ab,vb,kb,nb,xb,Qa,fb,Xa;(function(){var c=com.kingdee.bos.qing.ui.component;Oa=c.MessageCurtain;fa=c.Label;Ra=c.TextField;ta=c.SplitPane;Wa=c.Toolbar;G=c.SearchBox;M=c.Button;T=c.SwitchButton;R=c.CheckBox;C=c.MessageDialog;U=c.DropdownSelector;ja=c.Tree;
I=c.HelpIcon;La=c.Tips;ua=c.AbstractModalDialog;Ea=c.ComboBox;za=c.List;c=com.kingdee.bos.qing.biz.common;Ua=c.ComplexPaginationBar;c=com.kingdee.bos.qing.framework.common;f=c.MultilanguageManager.createPackageAccessor(Ga);Za=c.WindowResizeObserver;Ya=c.TabbedUiUtil;c=com.kingdee.bos.qing.common.ui;Ja=c.TableUtil;ra=c.CommonIconUtil;c=com.kingdee.bos.qing.common;xa=c.DomUtil;$a=c.DateFormater;gb=c.Util;S=c.TextMeasurer;c=com.kingdee.bos.qing.modeler.common.ui;jb=c.CatalogTree;db=c.NoDataContainer;
hb=c.SearchNoDataContainer;c=com.kingdee.bos.qing.modeler.metriclibrary.common;Sa=c.Icons;lb=c.Facade;eb=c.Integration;c=com.kingdee.bos.qing.modeler.metriclibrary.model;Ta=c.CatalogNode;rb=c.Catalog;mb=c.MetricLibraryRequest;sb=c.MetricLibraryResponse;tb=c.MetricPagination;pb=c.CatalogNodeCacheHelper;ob=c.ModelSet;wb=c.MetricModelInfo;yb=c.MetricInfo;vb=c.AddMetricResponse;kb=c.AbstractAddMetricInvalidityCase;nb=c.DetailMetricInvalidityCase;xb=c.AddMetricQueryRequest;c=com.kingdee.bos.qing.modeler.metriclibrary.system;
Ab=c.MetricSystem;Qa=gb.decodeParamFromUrl(location.search,"systemId");fb=gb.decodeParamFromUrl(location.search,"systemName")})();var ub=function(c,u,y,K,n){var h=new G;h.setSearchListenerDelay(1E3);h.addSearchListener(function(){u($.trim(h.getText()).toLowerCase())});h.setShowSearchIcon(y);h.setPlaceholder(K);y=h.getJqUi();y.addClass(n);y.find("input").on("keydown",function(g){13===(g.keyCode||g.which||g.charCode)&&u($.trim(h.getText()).toLowerCase())});c.append(y);return h},Db=function(){Ya.closeCurrentTab()},
qb=function(c){return(c=Fa.OperateExceptionPrompt.getOperateExceptionDetail(c))?(c.showPrompt(),!0):!1},zb=function(c,u,y){var K,n=u.getCatalogTree();n&&0!==n.getSelectedNode().getLevel()&&(K=n.getSelectedNode().getUserObject().getId());n=y.getPaginationBar().getPageSize();(new lb(eb.getRemoteImpl(),function(h){u.resetCatalogTree();var g=new sb,r=new Ta,w=0,x=[];h&&(g.fromJsonObject(h),r=g.getCatalogNode(),x=g.getMetricPagination(),w=x.getTotalRow(),x=x.getMetrics(),(Xa=g.isPresetSystem())&&y.getGlobal().getMessageCurtain().showPrompt(f.get("presetSystemTips",
"\u201c\u9884\u7f6e\u7684\u6307\u6807\u4f53\u7cfb\u4e0d\u5141\u8bb8\u6dfb\u52a0\u6307\u6807\u3001\u7f16\u8f91\u76ee\u5f55\u7b49\u64cd\u4f5c\uff0c\u5982\u6709\u9700\u8981\uff0c\u53ef\u590d\u5236\u540e\u518d\u8fdb\u884c\u64cd\u4f5c\u3002")));y.updatePaginationBar(w);r.setId(Ta.ROOT_NODE_ID);r.setLevel(0);r.setName(fb);r.setTotalRow(w);u.setCatalogFolderNode(r);u.updateUi(!0,!0);if(0!==u.getCatalogTree().getSelectedNode().getLevel()){g=[];for(r=0;r<x.length;r++)x[r].getCatalogId()===K&&g.push(x[r]);
y.setShowMetrics(g);u.updateUi(!1)}else y.setShowMetrics(x);y.updateUi();c.showAvailableToolbarButton()},qb)).loadFirstSystemCatalogAndMetric(Qa,1,n,K)},Eb=function(c,u,y){var K=y.getPaginationBar(),n=new lb(eb.getRemoteImpl(),function(g){u.resetCatalogTree();var r=new sb;r.fromJsonObject(g);g=r.getCatalogNode();var w=r.getMetricPagination();r=w.getTotalRow();w=w.getMetrics();K.resetPaginationAndJumpToFirstPage(r);g.setId(Ta.ROOT_NODE_ID);g.setLevel(0);g.setName(fb);g.setTotalRow(r);u.setCatalogFolderNode(g);
u.updateUi(!0,!0);c.showAvailableToolbarButton();y.setShowMetrics(w);y.updateUi()},qb),h=new mb;h.setSystemId(Qa);h.setTargetPage(1);h.setPageSize(K.getPageSize());n.loadCatalogAndMetricBySystemId(h)},ib=function(c,u,y,K){var n=y.getGlobal().getSearchText(),h=y.getPaginationBar(),g=y.getGlobal().createFacade(function(x){var p=new tb;p.fromJsonObject(x);x=p.getMetrics();p=p.getTotalRow();c.setTotalRow(p);if(K&&0<K.length)for(var H=0;H<K.length;H++){var P=K[H];P&&P(p)}h.refreshTotalRow(p);y.setShowMetrics(x);
y.updateUi()},function(x,p){return qb(x)}),r=new mb;if(Ta.ROOT_NODE_ID===c.getId())r.setSystemId(Qa);else{var w=[];w.push(c.getId());u&&c.getAllChildId(w);r.setCatalogIds(w)}r.setTargetPage(h.getCurrentPage());r.setPageSize(h.getPageSize());r.setSearchText(n);g.loadMetricLibraryMetric(r)},Bb=function(c,u,y,K,n){var h=n.getPaginationBar(),g=n.getGlobal(),r=g.getSelectedCatalog(),w=[];y?w.push(y):w.push(h.refreshPagination);y=g.getSearchText();g=g.createFacade(function(H){var P=new tb;P.fromJsonObject(H);
H=P.getMetrics();P=P.getTotalRow();if(w&&0<w.length)for(var Q=0;Q<w.length;Q++){var ia=w[Q];ia&&ia(P)}h.refreshTotalRow(P);n.setShowMetrics(H);n.updateUi()});var x=new mb;if(Ta.ROOT_NODE_ID===r.getId())x.setSystemId(Qa);else{var p=[];p.push(r.getId());K&&r.getAllChildId(p);x.setCatalogIds(p)}x.setTargetPage(c);x.setPageSize(u);x.setSearchText(y);g.loadMetricLibraryMetric(x);c=n.getSelectedMetrics().length;h.refreshSelectedRowTotal(c)},Cb=function(c,u,y,K){var n=K.getGlobal(),h=n.getIsTableView()?
K.getMetricTableView():K.getMetricCardView();K.setSelectedAll(c);y=y.getContainSubLevel();if(c){K=n.createFacade(function(x){for(var p={},H=0;H<x.length;H++){var P=x[H];p[P]=P}h.setSelectedMetricsMap(p)},function(x,p){return qb(x)});var g=new mb,r=n.getSelectedCatalog();if(Ta.ROOT_NODE_ID===r.getId())g.setSystemId(Qa);else{var w=[];w.push(r.getId());y&&r.getAllChildId(w);g.setCatalogIds(w)}g.setSearchText(n.getSearchText());K.loadAllMetricIds(g)}else K.clearSelectedMetric();h.updateSelectedAll(c);
u&&u(r.getTotalRow())};t.CHECKBOX_IDX_KEY="CHECKBOX_IDX_KEY";t.METRIC_CODE_IDX_KEY="METRIC_CODE_IDX_KEY";t.METRIC_NAME_IDX_KEY="METRIC_NAME_IDX_KEY";t.METRIC_DESC_IDX_KEY="METRIC_DESC_IDX_KEY";t.EXPR_IDX_KEY="EXPR_IDX_KEY";t.DIMENSION_IDX_KEY="DIMENSION_IDX_KEY";t.SOURCE_IDX_KEY="SOURCE_IDX_KEY";t.FILTER_IDX_KEY="FILTER_IDX_KEY";t.CREATOR_IDX_KEY="CREATOR_IDX_KEY";t.DATA_UPDATE_TIME_IDX_KEY="DATA_UPDATE_TIME_IDX_KEY";ya.METRIC_TYPE_SELF_BULD="build";ya.METRIC_TYPE_PRESET="preset"})();
//qingVersionTag: 20250324