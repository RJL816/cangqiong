var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(oa){var xa=0;return function(){return xa<oa.length?{done:!1,value:oa[xa++]}:{done:!0}}};$jscomp.arrayIterator=function(oa){return{next:$jscomp.arrayIteratorImpl(oa)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(oa,xa,eb){if(oa==Array.prototype||oa==Object.prototype)return oa;oa[xa]=eb.value;return oa};$jscomp.getGlobal=function(oa){oa=["object"==typeof globalThis&&globalThis,oa,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var xa=0;xa<oa.length;++xa){var eb=oa[xa];if(eb&&eb.Math==Math)return eb}throw Error("Cannot find global object");};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(oa,xa){var eb=$jscomp.propertyToPolyfillSymbol[xa];if(null==eb)return oa[xa];eb=oa[eb];return void 0!==eb?eb:oa[xa]};
$jscomp.polyfill=function(oa,xa,eb,cb){xa&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(oa,xa,eb,cb):$jscomp.polyfillUnisolated(oa,xa,eb,cb))};$jscomp.polyfillUnisolated=function(oa,xa,eb,cb){eb=$jscomp.global;oa=oa.split(".");for(cb=0;cb<oa.length-1;cb++){var qb=oa[cb];if(!(qb in eb))return;eb=eb[qb]}oa=oa[oa.length-1];cb=eb[oa];xa=xa(cb);xa!=cb&&null!=xa&&$jscomp.defineProperty(eb,oa,{configurable:!0,writable:!0,value:xa})};
$jscomp.polyfillIsolated=function(oa,xa,eb,cb){var qb=oa.split(".");oa=1===qb.length;cb=qb[0];cb=!oa&&cb in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var wb=0;wb<qb.length-1;wb++){var Ab=qb[wb];if(!(Ab in cb))return;cb=cb[Ab]}qb=qb[qb.length-1];eb=$jscomp.IS_SYMBOL_NATIVE&&"es6"===eb?cb[qb]:null;xa=xa(eb);null!=xa&&(oa?$jscomp.defineProperty($jscomp.polyfills,qb,{configurable:!0,writable:!0,value:xa}):xa!==eb&&(void 0===$jscomp.propertyToPolyfillSymbol[qb]&&(eb=1E9*Math.random()>>>0,
$jscomp.propertyToPolyfillSymbol[qb]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(qb):$jscomp.POLYFILL_PREFIX+eb+"$"+qb),$jscomp.defineProperty(cb,$jscomp.propertyToPolyfillSymbol[qb],{configurable:!0,writable:!0,value:xa})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(oa){if(oa)return oa;var xa=function(wb,Ab){this.$jscomp$symbol$id_=wb;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:Ab})};xa.prototype.toString=function(){return this.$jscomp$symbol$id_};var eb="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",cb=0,qb=function(wb){if(this instanceof qb)throw new TypeError("Symbol is not a constructor");return new xa(eb+(wb||"")+"_"+cb++,wb)};return qb},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(oa){if(oa)return oa;oa=Symbol("Symbol.iterator");for(var xa="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),eb=0;eb<xa.length;eb++){var cb=$jscomp.global[xa[eb]];"function"===typeof cb&&"function"!=typeof cb.prototype[oa]&&$jscomp.defineProperty(cb.prototype,oa,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return oa},
"es6","es3");$jscomp.iteratorPrototype=function(oa){oa={next:oa};oa[Symbol.iterator]=function(){return this};return oa};$jscomp.iteratorFromArray=function(oa,xa){oa instanceof String&&(oa+="");var eb=0,cb=!1,qb={next:function(){if(!cb&&eb<oa.length){var wb=eb++;return{value:xa(wb,oa[wb]),done:!1}}cb=!0;return{done:!0,value:void 0}}};qb[Symbol.iterator]=function(){return qb};return qb};
$jscomp.polyfill("Array.prototype.keys",function(oa){return oa?oa:function(){return $jscomp.iteratorFromArray(this,function(xa){return xa})}},"es6","es3");$jscomp.polyfill("Array.prototype.fill",function(oa){return oa?oa:function(xa,eb,cb){var qb=this.length||0;0>eb&&(eb=Math.max(0,qb+eb));if(null==cb||cb>qb)cb=qb;cb=Number(cb);0>cb&&(cb=Math.max(0,qb+cb));for(eb=Number(eb||0);eb<cb;eb++)this[eb]=xa;return this}},"es6","es3");$jscomp.typedArrayFill=function(oa){return oa?oa:Array.prototype.fill};
$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.findInternal=function(oa,xa,eb){oa instanceof String&&(oa=String(oa));for(var cb=oa.length,qb=0;qb<cb;qb++){var wb=oa[qb];if(xa.call(eb,wb,qb,oa))return{i:qb,v:wb}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(oa){return oa?oa:function(xa,eb){return $jscomp.findInternal(this,xa,eb).v}},"es6","es3");$jscomp.polyfill("Object.is",function(oa){return oa?oa:function(xa,eb){return xa===eb?0!==xa||1/xa===1/eb:xa!==xa&&eb!==eb}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(oa){return oa?oa:function(xa,eb){var cb=this;cb instanceof String&&(cb=String(cb));var qb=cb.length;eb=eb||0;for(0>eb&&(eb=Math.max(eb+qb,0));eb<qb;eb++){var wb=cb[eb];if(wb===xa||Object.is(wb,xa))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(oa,xa,eb){if(null==oa)throw new TypeError("The 'this' value for String.prototype."+eb+" must not be null or undefined");if(xa instanceof RegExp)throw new TypeError("First argument to String.prototype."+eb+" must not be a regular expression");return oa+""};$jscomp.polyfill("String.prototype.includes",function(oa){return oa?oa:function(xa,eb){return-1!==$jscomp.checkStringArgs(this,xa,"includes").indexOf(xa,eb||0)}},"es6","es3");
(function(){"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});com.kingdee.bos.qing.modeler.SpecialWordChecker=new function(){var oa="! $ & * + , - . / : < << = > @ ABORT ACCESS ACCESSED ACCOUNT ACTIVATE ADD ADMIN ADMINISTER ADMINISTRATOR ADVISE ADVISOR AFTER ALGORITHM ALIAS ALL ALLOCATE ALLOW ALL_ROWS ALTER ALWAYS ANALYZE ANCILLARY AND AND_EQUAL ANTIJOIN ANY APPEND APPLY ARCHIVE ARCHIVELOG ARRAY AS ASC ASSOCIATE AT ATTRIBUTE ATTRIBUTES AUDIT AUTHENTICATED AUTHENTICATION AUTHID AUTHORIZATION AUTO AUTOALLOCATE AUTOEXTEND AUTOMATIC AVAILABILITY BACKUP BECOME BEFORE BEGIN BEHALF BETWEEN BFILE BIGFILE BINARY_DOUBLE BINARY_DOUBLE_INFINITY BINARY_DOUBLE_NAN BINARY_FLOAT BINARY_FLOAT_INFINITY BINARY_FLOAT_NAN BINDING BITMAP BITS BLOB BLOCK BLOCKS BLOCKSIZE BLOCK_RANGE BODY BOTH BOUND BROADCAST BUFFER BUFFER_CACHE BUFFER_POOL BUILD BULK BY BYPASS_RECURSIVE_CHECK BYPASS_UJVC BYTE CACHE CACHE_CB CACHE_INSTANCES CACHE_TEMP_TABLE CALL CANCEL CARDINALITY CASCADE CASE CAST CATEGORY CERTIFICATE CFILE CHAINED CHANGE CHAR CHARACTER CHAR_CS CHECK CHECKPOINT CHILD CHOOSE CHUNK CIV_GB CLASS CLEAR CLOB CLONE CLOSE CLOSE_CACHED_OPEN_CURSORS CLUSTER CLUSTERING_FACTOR COALESCE COARSE COLLECT COLLECTIONS_GET_REFS COLUMN COLUMNS COLUMN_STATS COLUMN_VALUE COMMENT COMMIT COMMITTED COMPACT COMPATIBILITY COMPILE COMPLETE COMPOSITE_LIMIT COMPRESS COMPUTE CONFORMING CONNECT CONNECT_BY_ISCYCLE CONNECT_BY_ISLEAF CONNECT_BY_ROOT CONNECT_TIME CONSIDER CONSISTENT CONSTRAINT CONSTRAINTS CONTAINER CONTENT CONTENTS CONTEXT CONTINUE CONTROLFILE CONVERT CORRUPTION COST CPU_COSTING CPU_PER_CALL CPU_PER_SESSION CREATE CREATE_STORED_OUTLINES CROSS CUBE CUBE_GB CURRENT CURRENT_DATE CURRENT_SCHEMA CURRENT_TIME CURRENT_TIMESTAMP CURRENT_USER CURSOR CURSOR_SHARING_EXACT CURSOR_SPECIFIC_SEGMENT CYCLE DANGLING DATA DATABASE DATAFILE DATAFILES DATAOBJNO DATE DATE_MODE DAY DBA DBA_RECYCLEBIN DBTIMEZONE DDL DEALLOCATE DEBUG DEC DECIMAL DECLARE DECREMENT DEFAULT DEFERRABLE DEFERRED DEFINED DEFINER DEGREE DELAY DELETE DEMAND DENSE_RANK DEREF DEREF_NO_REWRITE DESC DETACHED DETERMINES DICTIONARY DIMENSION DIRECTORY DISABLE DISASSOCIATE DISCONNECT DISK DISKGROUP DISKS DISMOUNT DISTINCT DISTINGUISHED DISTRIBUTED DML DML_UPDATE DOCUMENT DOMAIN_INDEX_NO_SORT DOMAIN_INDEX_SORT DOUBLE DOWNGRADE DRIVING_SITE DROP DUMP DYNAMIC DYNAMIC_SAMPLING DYNAMIC_SAMPLING_EST_CDN EACH ELEMENT ELSE EMPTY ENABLE ENCRYPTED ENCRYPTION END ENFORCE ENFORCED ENTRY ERROR ERROR_ON_OVERLAP_TIME ESCAPE ESTIMATE EVENTS EXCEPT EXCEPTIONS EXCHANGE EXCLUDING EXCLUSIVE EXECUTE EXEMPT EXISTS EXPAND_GSET_TO_UNION EXPIRE EXPLAIN EXPLOSION EXPORT EXPR_CORR_CHECK EXTEND EXTENDS EXTENT EXTENTS EXTERNAL EXTERNALLY EXTRACT FACT FAILED FAILED_LOGIN_ATTEMPTS FAILGROUP FALSE FAST FBTSCAN FIC_CIV FIC_PIV FILE FILTER FINAL FINE FINISH FIRST FIRST_ROWS FLAGGER FLASHBACK FLOAT FLOB FLUSH FOLLOWING FOR FORCE FORCE_XML_QUERY_REWRITE FOREIGN FREELIST FREELISTS FREEPOOLS FRESH FROM FULL FUNCTION FUNCTIONS GATHER_PLAN_STATISTICS GBY_CONC_ROLLUP GENERATED GLOBAL GLOBALLY GLOBAL_NAME GLOBAL_TOPIC_ENABLED GRANT GROUP GROUPING GROUPS GROUP_BY GUARANTEE GUARANTEED GUARD HASH HASHKEYS HASH_AJ HASH_SJ HAVING HEADER HEAP HIERARCHY HIGH HINTSET_BEGIN HINTSET_END HOUR HWM_BROKERED IDENTIFIED IDENTIFIER IDENTITY IDGENERATORS IDLE_TIME IF IGNORE IGNORE_ON_CLAUSE IGNORE_OPTIM_EMBEDDED_HINTS IGNORE_WHERE_CLAUSE IMMEDIATE IMPORT IN INCLUDE_VERSION INCLUDING INCREMENT INCREMENTAL INDEX INDEXED INDEXES INDEXTYPE INDEXTYPES INDEX_ASC INDEX_COMBINE INDEX_DESC INDEX_FFS INDEX_FILTER INDEX_JOIN INDEX_ROWS INDEX_RRS INDEX_SCAN INDEX_SKIP_SCAN INDEX_SS INDEX_SS_ASC INDEX_SS_DESC INDEX_STATS INDICATOR INFINITE INFORMATIONAL INITIAL INITIALIZED INITIALLY INITRANS INLINE INNER INSERT INSTANCE INSTANCES INSTANTIABLE INSTANTLY INSTEAD INT INTEGER INTEGRITY INTERMEDIATE INTERNAL_CONVERT INTERNAL_USE INTERPRETED INTERSECT INTERVAL INTO INVALIDATE IN_MEMORY_METADATA IS ISOLATION ISOLATION_LEVEL ITERATE ITERATION_NUMBER JAVA JOB JOIN KEEP KERBEROS KEY KEYFILE KEYS KEYSIZE KEY_LENGTH KILL LAST LATERAL LAYER LDAP_REGISTRATION LDAP_REGISTRATION_ENABLED LDAP_REG_SYNC_INTERVAL LEADING LEFT LENGTH LESS LEVEL LEVELS LIBRARY LIKE LIKE2 LIKE4 LIKEC LIKE_EXPAND LIMIT LINK LIST LOB LOCAL LOCALTIME LOCALTIMESTAMP LOCAL_INDEXES LOCATION LOCATOR LOCK LOCKED LOG LOGFILE LOGGING LOGICAL LOGICAL_READS_PER_CALL LOGICAL_READS_PER_SESSION LOGOFF LOGON LONG MAIN MANAGE MANAGED MANAGEMENT MANUAL MAPPING MASTER MATCHED MATERIALIZE MATERIALIZED MAX MAXARCHLOGS MAXDATAFILES MAXEXTENTS MAXIMIZE MAXINSTANCES MAXLOGFILES MAXLOGHISTORY MAXLOGMEMBERS MAXSIZE MAXTRANS MAXVALUE MEASURES MEMBER MEMORY MERGE MERGE_AJ MERGE_CONST_ON MERGE_SJ METHOD MIGRATE MIN MINEXTENTS MINIMIZE MINIMUM MINUS MINUTE MINVALUE MIRROR MLSLABEL MODE MODEL MODEL_DONTVERIFY_UNIQUENESS MODEL_MIN_ANALYSIS MODEL_NO_ANALYSIS MODEL_PBY MODEL_PUSH_REF MODIFY MONITORING MONTH MOUNT MOVE MOVEMENT MULTISET MV_MERGE NAME NAMED NAN NATIONAL NATIVE NATURAL NAV NCHAR NCHAR_CS NCLOB NEEDED NESTED NESTED_TABLE_FAST_INSERT NESTED_TABLE_GET_REFS NESTED_TABLE_ID NESTED_TABLE_SET_REFS NESTED_TABLE_SET_SETID NETWORK NEVER NEW NEXT NLS_CALENDAR NLS_CHARACTERSET NLS_COMP NLS_CURRENCY NLS_DATE_FORMAT NLS_DATE_LANGUAGE NLS_ISO_CURRENCY NLS_LANG NLS_LANGUAGE NLS_LENGTH_SEMANTICS NLS_NCHAR_CONV_EXCP NLS_NUMERIC_CHARACTERS NLS_SORT NLS_SPECIAL_CHARS NLS_TERRITORY NL_AJ NL_SJ NO NOAPPEND NOARCHIVELOG NOAUDIT NOCACHE NOCOMPRESS NOCPU_COSTING NOCYCLE NODELAY NOFORCE NOGUARANTEE NOLOGGING NOMAPPING NOMAXVALUE NOMINIMIZE NOMINVALUE NOMONITORING NONE NOORDER NOOVERRIDE NOPARALLEL NOPARALLEL_INDEX NORELY NOREPAIR NORESETLOGS NOREVERSE NOREWRITE NORMAL NOROWDEPENDENCIES NOSEGMENT NOSORT NOSTRICT NOSWITCH NOT NOTHING NOVALIDATE NOWAIT NO_ACCESS NO_BASETABLE_MULTIMV_REWRITE NO_BUFFER NO_CPU_COSTING NO_EXPAND NO_EXPAND_GSET_TO_UNION NO_FACT NO_FILTERING NO_INDEX NO_INDEX_FFS NO_INDEX_SS NO_MERGE NO_MODEL_PUSH_REF NO_MONITORING NO_MULTIMV_REWRITE NO_ORDER_ROLLUPS NO_PARALLEL NO_PARALLEL_INDEX NO_PARTIAL_COMMIT NO_PRUNE_GSETS NO_PUSH_PRED NO_PUSH_SUBQ NO_QKN_BUFF NO_QUERY_TRANSFORMATION NO_REF_CASCADE NO_REWRITE NO_SEMIJOIN NO_SET_TO_JOIN NO_STAR_TRANSFORMATION NO_STATS_GSETS NO_SWAP_JOIN_INPUTS NO_TRIGGER NO_UNNEST NO_USE_HASH NO_USE_MERGE NO_USE_NL NO_XML_QUERY_REWRITE NULL NULLS NUMBER NUMERIC NVARCHAR2 OBJECT OBJNO OBJNO_REUSE OF OFF OFFLINE OID OIDINDEX OLD ON ONLINE ONLY OPAQUE OPAQUE_TRANSFORM OPAQUE_XCANONICAL OPCODE OPEN OPERATOR OPTIMAL OPTIMIZER_FEATURES_ENABLE OPTIMIZER_GOAL OPTION OPT_ESTIMATE OR ORA_ROWSCN ORDER ORDERED ORDERED_PREDICATES ORGANIZATION OR_EXPAND OUTER OUTLINE OUT_OF_LINE OVER OVERFLOW OVERFLOW_NOMOVE OVERLAPS OWN PACKAGE PACKAGES PARALLEL PARALLEL_INDEX PARAMETERS PARENT PARITY PARTIALLY PARTITION PARTITIONS PARTITION_HASH PARTITION_LIST PARTITION_RANGE PASSWORD PASSWORD_GRACE_TIME PASSWORD_LIFE_TIME PASSWORD_LOCK_TIME PASSWORD_REUSE_MAX PASSWORD_REUSE_TIME PASSWORD_VERIFY_FUNCTION PCTFREE PCTINCREASE PCTTHRESHOLD PCTUSED PCTVERSION PERCENT PERFORMANCE PERMANENT PFILE PHYSICAL PIV_GB PIV_SSF PLAN PLSQL_CODE_TYPE PLSQL_DEBUG PLSQL_OPTIMIZE_LEVEL PLSQL_WARNINGS POLICY POST_TRANSACTION POWER PQ_DISTRIBUTE PQ_MAP PQ_NOMAP PREBUILT PRECEDING PRECISION PREPARE PRESENT PRESERVE PRIMARY PRIOR PRIVATE PRIVATE_SGA PRIVILEGE PRIVILEGES PROCEDURE PROFILE PROGRAM PROJECT PROTECTED PROTECTION PUBLIC PURGE PUSH_PRED PUSH_SUBQ PX_GRANULE QB_NAME QUERY QUERY_BLOCK QUEUE QUEUE_CURR QUEUE_ROWP QUIESCE QUOTA RANDOM RANGE RAPIDLY RAW RBA READ READS REAL REBALANCE REBUILD RECORDS_PER_BLOCK RECOVER RECOVERABLE RECOVERY RECYCLE RECYCLEBIN REDUCED REDUNDANCY REF REFERENCE REFERENCED REFERENCES REFERENCING REFRESH REF_CASCADE_CURSOR REGEXP_LIKE REGISTER REJECT REKEY RELATIONAL RELY REMOTE_MAPPED RENAME REPAIR REPLACE REQUIRED RESET RESETLOGS RESIZE RESOLVE RESOLVER RESOURCE RESTORE_AS_INTERVALS RESTRICT RESTRICTED RESTRICT_ALL_REF_CONS RESUMABLE RESUME RETENTION RETURN RETURNING REUSE REVERSE REVOKE REWRITE REWRITE_OR_ERROR RIGHT ROLE ROLES ROLLBACK ROLLUP ROW ROWDEPENDENCIES ROWID ROWNUM ROWS ROW_LENGTH RULE RULES SAMPLE SAVEPOINT SAVE_AS_INTERVALS SB4 SCALE SCALE_ROWS SCAN SCAN_INSTANCES SCHEDULER SCHEMA SCN SCN_ASCENDING SCOPE SD_ALL SD_INHIBIT SD_SHOW SECOND SECURITY SEED SEGMENT SEG_BLOCK SEG_FILE SELECT SELECTIVITY SEMIJOIN SEMIJOIN_DRIVER SEQUENCE SEQUENCED SEQUENTIAL SERIALIZABLE SERVERERROR SESSION SESSIONS_PER_USER SESSIONTIMEZONE SESSIONTZNAME SESSION_CACHED_CURSORS SET SETS SETTINGS SET_TO_JOIN SEVERE SHARE SHARED SHARED_POOL SHRINK SHUTDOWN SIBLINGS SID SIMPLE SINGLE SINGLETASK SIZE SKIP SKIP_EXT_OPTIMIZER SKIP_UNQ_UNUSABLE_IDX SKIP_UNUSABLE_INDEXES SMALLFILE SMALLINT SNAPSHOT SOME SORT SOURCE SPACE SPECIFICATION SPFILE SPLIT SPREADSHEET SQL SQLLDR SQL_TRACE STANDBY STAR START STARTUP STAR_TRANSFORMATION STATEMENT_ID STATIC STATISTICS STOP STORAGE STORE STREAMS STRICT STRIP STRUCTURE SUBMULTISET SUBPARTITION SUBPARTITIONS SUBPARTITION_REL SUBSTITUTABLE SUCCESSFUL SUMMARY SUPPLEMENTAL SUSPEND SWAP_JOIN_INPUTS SWITCH SWITCHOVER SYNONYM SYSAUX SYSDATE SYSDBA SYSOPER SYSTEM SYSTIMESTAMP SYS_DL_CURSOR SYS_FBT_INSDEL SYS_OP_BITVEC SYS_OP_CAST SYS_OP_COL_PRESENT SYS_OP_ENFORCE_NOT_NULL $SYS_OP_MINE_VALUE SYS_OP_NOEXPAND SYS_OP_NTCIMG $SYS_PARALLEL_TXN SYS_RID_ORDER TABLE TABLES TABLESPACE TABLESPACE_NO TABLE_STATS TABNO TEMPFILE TEMPLATE TEMPORARY THAN THE THEN THREAD THROUGH TIME TIMEOUT TIMESTAMP TIMEZONE_ABBR TIMEZONE_HOUR TIMEZONE_MINUTE TIMEZONE_REGION TIME_ZONE TIV_GB TIV_SSF TO TOPLEVEL TRACE TRACING TRACKING TRAILING TRANSACTION TRANSITIONAL TREAT TRIGGER TRIGGERS TRUE TRUNCATE TRUSTED TUNING TX TYPE TYPES TZ_OFFSET UB2 UBA UID UNARCHIVED UNBOUND UNBOUNDED UNDER UNDO UNDROP UNIFORM UNION UNIQUE UNLIMITED UNLOCK UNNEST UNPACKED UNPROTECTED UNQUIESCE UNRECOVERABLE UNTIL UNUSABLE UNUSED UPDATABLE UPDATE UPDATED UPD_INDEXES UPD_JOININDEX UPGRADE UPSERT UROWID USAGE USE USER USER_DEFINED USER_RECYCLEBIN USE_ANTI USE_CONCAT USE_HASH USE_MERGE USE_NL USE_NL_WITH_INDEX USE_PRIVATE_OUTLINES USE_SEMI USE_STORED_OUTLINES USE_TTT_FOR_GSETS USE_WEAK_NAME_RESL USING VALIDATE VALIDATION VALUE VALUES VARCHAR VARCHAR2 VARRAY VARYING VECTOR_READ VECTOR_READ_TRACE VERSION VERSIONS VIEW WAIT WELLFORMED WHEN WHENEVER WHERE WHITESPACE WITH WITHIN WITHOUT WORK WRITE XID XMLATTRIBUTES XMLCOLATTVAL XMLELEMENT XMLFOREST XMLPARSE XMLSCHEMA XMLTYPE X_DYN_PRUNE YEAR ZONE [ ] ^ | ABS ABSENT ABSOLUTE ACCORDING ACTION ADA AGGREGATE ALSO ANALYSE ARE ARRAY_AGG ARRAY_MAX_CARDINALITY ASENSITIVE ASSERTION ASSIGNMENT ASYMMETRIC ATOMIC AVG BACKWARD BASE64 BEGIN_FRAME BEGIN_PARTITION BERNOULLI BIGINT BINARY BIT BIT_LENGTH BLOCKED BOM BOOLEAN BREADTH C CALLED CASCADED CATALOG CATALOG_NAME CEIL CEILING CHAIN CHARACTERISTICS CHARACTERS CHARACTER_LENGTH CHARACTER_SET_CATALOG CHARACTER_SET_NAME CHARACTER_SET_SCHEMA CHAR_LENGTH CLASS_ORIGIN COBOL COLLATE COLLATION COLLATION_CATALOG COLLATION_NAME COLLATION_SCHEMA COLUMN_NAME COMMAND_FUNCTION COMMAND_FUNCTION_CODE COMMENTS CONCURRENTLY CONDITION CONDITION_NUMBER CONFIGURATION CONFLICT CONNECTION CONNECTION_NAME CONSTRAINT_CATALOG CONSTRAINT_NAME CONSTRAINT_SCHEMA CONSTRUCTOR CONTAINS CONTROL CONVERSION COPY CORR CORRESPONDING COUNT COVAR_POP COVAR_SAMP CSV CUME_DIST CURRENT_CATALOG CURRENT_DEFAULT_TRANSFORM_GROUP CURRENT_PATH CURRENT_ROLE CURRENT_ROW CURRENT_TRANSFORM_GROUP_FOR_TYPE CURSOR_NAME DATALINK DATETIME_INTERVAL_CODE DATETIME_INTERVAL_PRECISION DB DEFAULTS DELIMITER DELIMITERS DEPENDS DEPTH DERIVED DESCRIBE DESCRIPTOR DETERMINISTIC DIAGNOSTICS DISCARD DISPATCH DLNEWCOPY DLPREVIOUSCOPY DLURLCOMPLETE DLURLCOMPLETEONLY DLURLCOMPLETEWRITE DLURLPATH DLURLPATHONLY DLURLPATHWRITE DLURLSCHEME DLURLSERVER DLVALUE DO DOMAIN DYNAMIC_FUNCTION DYNAMIC_FUNCTION_CODE ENCODING END-EXEC END_FRAME END_PARTITION ENUM EQUALS EVENT EVERY EXCEPTION EXCLUDE EXEC EXP EXPRESSION EXTENSION FAMILY FETCH FIRST_VALUE FLAG FLOOR FORTRAN FORWARD FOUND FRAME_ROW FREE FREEZE FS FUSION G GENERAL GET GO GOTO GRANTED GREATEST HANDLER HEX HOLD ILIKE IMMEDIATELY IMMUTABLE IMPLEMENTATION IMPLICIT INDENT INHERIT INHERITS INOUT INPUT INSENSITIVE INTERSECTION INVOKER ISNULL K KEY_MEMBER KEY_TYPE LABEL LAG LANGUAGE LARGE LAST_VALUE LEAD LEAKPROOF LEAST LIKE_REGEX LISTEN LN LOAD LOGGED LOWER M MAP MATCH MAX_CARDINALITY MESSAGE_LENGTH MESSAGE_OCTET_LENGTH MESSAGE_TEXT MOD MODIFIES MODULE MORE MUMPS NAMES NAMESPACE NESTING NFC NFD NFKC NFKD NIL NORMALIZE NORMALIZED NOTIFY NOTNULL NTH_VALUE NTILE NULLABLE NULLIF OCCURRENCES_REGEX OCTETS OCTET_LENGTH OFFSET OIDS OPTIONS ORDERING ORDINALITY OTHERS OUT OUTPUT OVERLAY OVERRIDING OWNED OWNER P PAD PARAMETER PARAMETER_MODE PARAMETER_NAME PARAMETER_ORDINAL_POSITION PARAMETER_SPECIFIC_CATALOG PARAMETER_SPECIFIC_NAME PARAMETER_SPECIFIC_SCHEMA PARSER PARTIAL PASCAL PASSING PASSTHROUGH PATH PERCENTILE_CONT PERCENTILE_DISC PERCENT_RANK PERIOD PERMISSION PLACING PLANS PLI PORTION POSITION POSITION_REGEX PRECEDES PREPARED PROCEDURAL QUOTE RANK REASSIGN RECHECK RECURSIVE REGR_AVGX REGR_AVGY REGR_COUNT REGR_INTERCEPT REGR_R2 EXIT PRINT PROC FILLFACTOR RAISERROR FREETEXT READTEXT BREAK FREETEXTTABLE RECONFIGURE BROWSE REPLICATION RESTORE HOLDLOCK CLUSTERED ROWCOUNT IDENTITY_INSERT ROWGUIDCOL IDENTITYCOL SAVE SESSION_USER CONTAINSTABLE SETUSER SYSTEM_USER TEXTSIZE LINENO TOP TRAN NOCHECK DBCC NONCLUSTERED TSEQUAL DENY OFFSETS UPDATETEXT OPENDATASOURCE OPENQUERY OPENROWSET DUMMY OPENXML WAITFOR WHILE ERRLVL WRITETEXT L S RK SEQ MS XXFIELDXX".split(" ");
this.isSpecialWord=function(xa){return xa&&0!=xa.length?-1<oa.indexOf(xa.trim().toUpperCase()):!0}}})();(function(){function oa(){var h=this,m;this.setType=function(c){m=c};this.getType=function(){return m};this.toJsonObject=function(){var c={};c.type=m;h.protectedToJsonObject(c);return c};this.fromJsonObject=function(c){m=c.type;h.protectedFromJsonObject(c)};this.supportIncrementalMaterialize=function(){return!1};this.protectedToJsonObject=function(c){};this.protectedFromJsonObject=function(c){}}function xa(){function h(){var l,n,p=!1;this.setFieldFullName=function(u){l=u};this.getFieldFullName=function(){return l};
this.setNumber=function(u){n=u};this.getNumber=function(){return n};this.isManualModified=function(){return p};this.setManualModified=function(u){p=u};this.fromJsonObject=function(u){l=u.fieldFullName;n=u.number;p=1==u.manualModified};this.toJsonObject=function(){var u={};u.fieldFullName=l;u.number=n;u.manualModified=p;return u}}oa.call(this);var m=this,c,d=[],e=[],k,a=[],b=[];m.setType(oa.TYPE_TABLE_MODELER);this.getPage=function(){c||(c=new cb,c.addPropertyChangeCallback(g));return c};this.getNode=
function(l){if(c)return c.getNode(l)};this.getAllNodes=function(){if(c)return c.getAllNodes()};this.getOutputNodes=function(){return c?c.getOutputNodes():[]};this.setAllNodeCoordinate=function(l){if(c)return c.setAllNodeCoordinate(l)};this.getAllNodeCoordinate=function(){if(c)return c.getAllNodeCoordinate()};this.getRelatedLine=function(l,n){if(c)return c.getRelatedLine(l,n)};this.getAllLines=function(){if(c)return c.getAllLines()};this.getPrevNode=function(l){if((l=m.getRelatedLine(l,xa.GET_LINE_STRATEGY_IN))&&
0<l.length)return m.getNode(l[0].getFromId())};this.getNextNode=function(l){if((l=m.getRelatedLine(l,xa.GET_LINE_STRATEGY_OUT))&&0<l.length)return m.getNode(l[0].getToId())};this.getFromToNode=function(l){if(c){var n=c.getNode(l.getFromId());l=c.getNode(l.getToId());return[n,l]}};this.insertSource=function(l,n){for(var p=!1,u=l.getSourceId(),E=0;E<d.length;E++)if(u==d[E].getSourceId()){p=!0;break}p||(d.splice(n,0,l),g(oa.KEY_ADD_PREPARED_SOURCE,[l]))};this.batchAddSource=function(l){for(var n=[],
p=0;p<l.length;p++){for(var u=!1,E=l[p],V=E.getSourceId(),J=0;J<d.length;J++)if(V==d[J].getSourceId()){u=!0;break}u||(d.push(E),n.push(E))}g(oa.KEY_ADD_PREPARED_SOURCE,n)};this.setSource=function(l){d=l;g(oa.KEY_SET_PREPARED_SOURCE,d)};this.removeSource=function(l){var n=d.indexOf(l);return-1<n?(d.splice(n,1),g(oa.KEY_REMOVE_PREPARED_SOURCE,[l]),n):-1};this.batchRemoveUserSqlTable=function(l){l=m.getUserSqlTables(l);for(var n=0;n<l.length;n++)m.removeTableIfUseless(l[n])};this.batchRemoveSource=function(l){for(var n=
0;n<l.length;n++){var p=d.indexOf(l[n]);-1<p&&d.splice(p,1)}g(oa.KEY_REMOVE_PREPARED_SOURCE,l)};this.getSource=function(l){for(var n=0,p=d.length;n<p;n++)if(d[n].getId()==l)return d[n]};this.getNodeSource=function(l){if(l instanceof wb&&(l=m.getTable(l.getTableUid())))return m.getSource(l.getSourceUid())};this.getAllSource=function(){return d};this.isSourceUsed=function(l){l=l.getId();for(var n=0,p=e.length;n<p;n++){var u=e[n];if(u.getSourceUid()==l&&f(u))return!0}return!1};this.addTable=function(l){for(var n=
0,p=e.length;n<p;n++)if(e[n].isSame(l))return;e.push(l)};this.updateTable=function(l,n){for(var p=0,u=e.length;p<u;p++)if(e[p].isSame(n)){e.splice(p,1);e.splice(p,0,l);break}f(n)&&(l=c.getNodesByTableId(n.getUid()),g(oa.KEY_UPDATE_TABLE,l))};this.batchAddTable=function(l){for(var n=0;n<l.length;n++)m.addTable(l[n])};this.removeTableIfUseless=function(l,n){l=l.getUid();for(var p=!0,u=c.getAllNodes(),E=0;E<u.length;E++){var V=u[E];if(V instanceof wb&&V.getTableUid()==l&&V!=n){p=!1;break}}if(p){n=[];
for(E=0;E<e.length;E++)e[E].getUid()==l&&n.push(E);for(E=n.length-1;0<=E;E--)e.splice(n[E],1)}return p};this.getNodeTable=function(l){if(l instanceof wb)return m.getTable(l.getTableUid())};this.getTableByNodeId=function(l){l=m.getNode(l).getTableUid();return m.getTable(l)};this.getTable=function(l){for(var n=0,p=e.length;n<p;n++)if(e[n].getUid()==l)return e[n]};this.getUserSqlTables=function(l){for(var n=[],p=0,u=e.length;p<u;p++){var E=e[p];E.isUserSql()&&E.getSourceUid()==l&&n.push(E)}return n};
this.getAllUserSqlTables=function(){for(var l=[],n=0,p=e.length;n<p;n++)e[n].isUserSql()&&l.push(e[n]);return l};this.getAllTable=function(l){for(var n=[],p=0,u=e.length;p<u;p++){var E=e[p];l?(f(E)||E.isUserSql())&&n.push(E):f(E)&&n.push(E)}return n};this.getSameTable=function(l){for(var n=0,p=e.length;n<p;n++)if(e[n].isSame(l))return e[n]};this.setMaterializedConfig=function(l){k=l};this.getMaterializedConfig=function(){return k};this.supportIncrementalMaterialize=function(){var l=m.getAllNodes();
if(!l)return!1;for(var n=0,p=0;p<l.length;p++){var u=l[p].getType();if(u===qb.TYPE_TABLE)n++;else if(u!==fa.TYPE_FIELD_SELECT&&u!==fa.TYPE_FIELD_SETTING&&u!==fa.TYPE_FILTER&&u!==fa.TYPE_CALCULATED_FIELD&&u!==fa.TYPE_CUSTOM_GROUP)return!1}return 1===n};this.addFieldNumberMap=function(l,n,p,u){for(var E,V=0;V<b.length;V++){var J=b[V];if(J.getFieldFullName()==l.getFullName()){E=J;break}}E||(E=new h,b.push(E),E.setFieldFullName(l.getFullName()));E.setNumber(n);E.setManualModified(p?!0:!1);!u&&g(xa.KEY_CHANGE_FIELD_NUMBER,
l)};this.isNumberManualModified=function(l){for(var n=0;n<b.length;n++){var p=b[n];if(p.getFieldFullName()==l.getFullName())return p.isManualModified()}return!1};this.getFieldNumberMap=function(){for(var l={},n=0;n<b.length;n++){var p=b[n];l[p.getFieldFullName()]=p.getNumber()}return l};this.removeFieldNumber=function(l){for(var n=[],p=[],u=0;u<b.length;u++){var E=b[u],V=E.getFieldFullName().split("_");1<V.length&&V[0]==l.getId()?n.push(E):p.push(E)}b=p;return n};this.removeFieldNumberByFullName=
function(l){for(var n=0;n<b.length;n++)if(b[n].getFieldFullName()===l){b.splice(n,1);break}};this.restoreFieldNumber=function(l){for(var n=0;n<l.length;n++){for(var p=!1,u=l[n],E=0;E<b.length;E++)if(u.getFieldFullName()==b[E].getFieldFullName()){p=!0;break}p||b.push(u)}};this.addPropertyChangeCallback=function(l){a.push(l)};this.removePropertyChangeCallback=function(l){l=a.indexOf(l);-1<l&&a.splice(l,1)};this.clearPropertyChangeCallback=function(){a=[]};this.protectedToJsonObject=function(l){l.page=
c.toJsonObject();for(var n=[],p=0;p<d.length;p++)n.push(d[p].toJsonObject());l.sources=n;n=[];for(p=0;p<e.length;p++){var u=e[p];(f(u)||u.isUserSql())&&n.push(u.toJsonObject())}l.tables=n;k&&(l.materializedConfig=k.toJsonObject());n=[];for(p=0;p<b.length;p++)n.push(b[p].toJsonObject());l.fieldNumberMap=n};this.isUserSqlTableInUse=function(l){l=m.getSameTable(l);return f(l)};this.protectedFromJsonObject=function(l){var n=l.sources;if(n)for(var p=0;p<n.length;p++){var u=n[p],E=new qa;E.fromJsonObject(u);
d.push(E)}if(n=l.tables)for(p=0;p<n.length;p++)u=new Ra,u.fromJsonObject(n[p]),e.push(u);if(p=l.page)c=new cb,c.fromJsonObject(p),c.addPropertyChangeCallback(g);(p=l.materializedConfig)?(k=new ib,k.fromJsonObject(p)):k=null;if(l=l.fieldNumberMap)for(p=0;p<l.length;p++)n=new h,n.fromJsonObject(l[p]),b.push(n);if(c)for(l=c.getAllNodes(),p=0;p<l.length;p++)n=l[p],n instanceof wb&&!m.getTable(n.getTableUid())&&(0<e.length?n.setTableUid(e[0].getUid()):l.splice(p,1))};var f=function(l){var n=m.getAllNodes();
if(n)for(var p=0;p<n.length;p++){var u=n[p];if(u instanceof wb&&u.getTableUid()==l.getUid())return!0}return!1},g=function(l,n){for(var p=0,u=a.length;p<u;p++)a[p](l,n)}}function eb(){function h(a,b,f,g){this.getLeftExtension=function(){return a};this.getTopExtension=function(){return b};this.getHorizonExtension=function(){return a+f};this.getVerticalExtension=function(){return b+g}}var m=this,c=1024,d=768,e=[];this.getWidth=function(){return c};this.getHeight=function(){return d};this.addPropertyChangeCallback=
function(a){e.push(a)};this.setExtension=function(a,b,f,g){a=new h(a,b,f,g);c+=a.getHorizonExtension();d+=a.getVerticalExtension();k(oa.KEY_PAGE_SIZE,a)};this.toJsonObject=function(){var a={};a.width=c;a.height=d;m.protectedToJsonObject(a);return a};this.fromJsonObject=function(a){c=a.width;d=a.height;m.protectedFromJsonObject(a)};this.protectedToJsonObject=function(a){};this.protectedFromJsonObject=function(a){};var k=function(a,b){for(var f=0,g=e.length;f<g;f++)e[f](a,b)};this.protectedMethod={firePropertyChangeEvt:k}}
function cb(){eb.call(this);var h=this.protectedMethod,m=this,c=[],d=[];this.getNode=function(a){for(var b=0,f=c.length;b<f;b++){var g=c[b];if(Y.ModelConverter.treatAsSameNode(g.getId(),a))return g}};this.getAllNodes=function(){return c};this.getNodesByTableId=function(a){for(var b=[],f=0;f<c.length;f++)c[f]instanceof wb&&c[f].getTableUid()==a&&b.push(c[f]);return b};this.getOutputNodes=function(){for(var a=[],b=0;b<c.length;b++){for(var f=c[b],g=!0,l=0;l<d.length;l++){var n=d[l];if(f.getId()==n.getFromId()){g=
!1;break}}g&&a.push(f)}return a};this.getAllNodeCoordinate=function(){for(var a={},b=0;b<c.length;b++){var f=c[b],g=f.getId();a[g]=[f.getX(),f.getY()]}return a};this.setAllNodeCoordinate=function(a){for(var b=Object.keys(a),f=0;f<b.length;f++){var g=b[f],l=m.getNode(g);g=a[g];l.setPosition(g[0],g[1])}k(xa.KEY_NODE_RELAYOUT,this)};this.addNode=function(a){a.addPropertyChangeCallback(k);c.push(a);k(xa.KEY_ADD_NODE,a)};this.removeNode=function(a,b){var f=c.indexOf(a);a.removePropertyChangeCallback(k);
-1<f&&(c.splice(f,1),k(xa.KEY_REMOVE_NODE,b))};this.linkNode=function(a,b){m.addLine(a,b);k(xa.KEY_LINK_NODE,b)};this.breakLink=function(a,b){for(var f=0;f<d.length;f++){var g=d[f];if(g.getFromId()==a.getId()&&g.getToId()==b.getId()){m.removeLine(g);k(xa.KEY_BREAK_LINK,b);break}}};this.addLine=function(a,b){var f=new ja;f.setFromId(a.getId());f.setToId(b.getId());e(f)&&(f.setId(Y.UIDHelper.getUID(Y.UIDHelper.NS_LINE)),d.push(f),k(xa.KEY_ADD_LINE,f))};this.getAllLines=function(){return d};this.removeLine=
function(a){var b=d.indexOf(a);-1<b&&(d.splice(b,1),k(xa.KEY_REMOVE_LINE,a))};this.getRelatedLine=function(a,b){var f=[];if(!a)return f;a=a.getId();for(var g=0,l=d.length;g<l;g++){var n=d[g];if((b&xa.GET_LINE_STRATEGY_IN)==xa.GET_LINE_STRATEGY_IN&&n.getToId()==a||(b&xa.GET_LINE_STRATEGY_OUT)==xa.GET_LINE_STRATEGY_OUT&&n.getFromId()==a){for(var p=!1,u=0;u<f.length;u++){var E=f[u];if(E.getFromId()==n.getFromId()&&E.getToId()==n.getToId()){p=!0;break}}p||f.push(n)}}return f};this.protectedToJsonObject=
function(a){for(var b=[],f=0;f<c.length;f++)b.push(c[f].toJsonObject());a.nodes=b;b=[];for(f=0;f<d.length;f++)b.push(d[f].toJsonObject());a.lines=b};this.protectedFromJsonObject=function(a){for(var b=a.nodes,f=0;f<b.length;f++){var g=b[f],l=g.type,n;l==qb.TYPE_TABLE?n=new wb:l==qb.TYPE_TRANSFORM&&(n=Y.TransformNodeFactory.createTransformNode(g.config.type));n&&(n.fromJsonObject(g),n.addPropertyChangeCallback(k),c.push(n))}a=a.lines;for(f=0;f<a.length;f++)b=a[f],g=new ja,g.fromJsonObject(b),e(g)&&
d.push(g)};var e=function(a){for(var b=0;b<d.length;b++){var f=d[b];if(f.getFromId()==a.getFromId()&&f.getToId()==a.getToId())return!1}return m.getNode(a.getFromId())&&m.getNode(a.getToId())?!0:!1},k=function(a,b){h.firePropertyChangeEvt(a,b)}}function qb(){var h=this,m,c,d,e,k,a,b,f,g,l=[];this.setId=function(p){m=p};this.getId=function(){return m};this.setAlias=function(p){c=p;e=void 0;n(xa.KEY_NODE_CHANGE_ALIAS,h)};this.getAlias=function(){return c};this.setNameIndex=function(p){e=p};this.getNameIndex=
function(){return e};this.getX=function(){return k};this.getY=function(){return a};this.getWidth=function(){return b};this.getHeight=function(){return f};this.setPosition=function(p,u){k=p;a=u};this.changePosition=function(p,u){h.setPosition(p,u);n(xa.KEY_NODE_CHANGE_POSITION,h)};this.setSize=function(p,u){b=p;f=u};this.setType=function(p){d=p};this.getType=function(){return d};this.setFieldSettingConfig=function(p,u){g=p;!u&&n(xa.KEY_TRANSFORM_FIELD_SETTING,h)};this.getFieldSettingConfig=function(){return g};
this.addPropertyChangeCallback=function(p){l.push(p)};this.removePropertyChangeCallback=function(p){p=l.indexOf(p);-1<p&&l.splice(p,1)};this.canGenerateNewField=function(){return!1};this.toJsonObject=function(){var p={};p.id=m;p.alias=c;p.x=k;p.y=a;p.type=d;e&&(p.nameIndex=e);h.protectedToJson(p);g&&(p.fieldSettingConfig=g.toJsonObject());return p};this.fromJsonObject=function(p){m=p.id;c=p.alias;k=p.x;a=p.y;d=p.type;var u=parseInt(p.nameIndex);isNaN(u)||(e=u);p.fieldSettingConfig&&(g=new G,g.fromJsonObject(p.fieldSettingConfig));
h.protectedFromJson(p)};this.protectedToJson=function(p){};this.protectedFromJson=function(p){};var n=function(p,u){for(var E=0,V=l.length;E<V;E++)l[E](p,u)};this.protectedMethod={firePropertyChangeEvt:function(p){n(p,h)}}}function wb(){qb.call(this);var h=this,m=this.protectedMethod,c,d,e;h.setSize(150,40);h.setType(qb.TYPE_TABLE);this.setName=function(k){c=k};this.getName=function(){return c};this.setTableUid=function(k){d=k};this.getTableUid=function(){return d};this.setSelectedFields=function(k,
a){if(k)for(var b=0;b<k.length;b++)k[b].setFromNode(h.getId());e=k;a&&m.firePropertyChangeEvt(oa.KEY_TABLE_NODE_SELECT_FIELD)};this.getSelectedFields=function(){return e};this.protectedToJson=function(k){k.tableId=d;if(e){for(var a=[],b=0;b<e.length;b++)a.push(e[b].toJsonObject());k.selectedFields=a}};this.protectedFromJson=function(k){d=k.tableId;if(k=k.selectedFields){for(var a=[],b=0;b<k.length;b++){var f=new w;f.fromJsonObject(k[b]);a.push(f)}e=a}};this.clone=function(){var k=new wb;k.setId(h.getId());
k.setAlias(h.getAlias());k.setType(h.getType());k.setPosition(h.getX(),h.getY());k.setSize(h.getWidth(),h.getHeight());k.setTableUid(d);k.setName(c);k.setSelectedFields(e);return k}}function Ab(){qb.call(this);var h=this.protectedMethod,m;this.setSize(50,30);this.setType(qb.TYPE_TRANSFORM);this.isMultiInDegree=function(){return!1};this.getType=function(){throw Error("override me");};this.setConfig=function(c){m=c;m.addPropertyChangeCallback(h.firePropertyChangeEvt)};this.getConfig=function(){return m};
this.getNodeIdInConfig=function(){return m?m.getNodeIdInConfig():[]};this.protectedToJson=function(c){c.config=m.toJsonObject()};this.protectedFromJson=function(c){m.fromJsonObject(c.config)}}function Vb(){Ab.call(this);this.canGenerateNewField=function(){return!0};this.getGeneratedSourceFieldName=function(h){throw Error("override me");};this.getGeneratedFieldSourceTableName=function(h){throw Error("override me");}}function Db(){Ab.call(this);this.getType=function(){return fa.TYPE_FIELD_SELECT}}function ub(){Ab.call(this);
this.getType=function(){return fa.TYPE_FIELD_SETTING}}function Hb(){Ab.call(this);this.getType=function(){return fa.TYPE_FILTER}}function Ea(){Vb.call(this);this.getType=function(){return fa.TYPE_COLUMN_TO_ROW};this.getGeneratedSourceFieldName=function(h,m,c){if(c instanceof Ea)return" ";c=h.getFromNode();var d=m.getNode(c);m=d.getId();c=h.getFullName();var e=d.getConfig().getTargetAttrField();e.setFromNode(m);if(e.getFullName()===c)return e.getAlias();d=d.getConfig().getTargetValueFields();for(e=
0;e<d.length;e++)if(d[e].setFromNode(m),d[e].getFullName()===c)return d[e].getAlias();return h.getAlias()};this.getGeneratedFieldSourceTableName=function(h,m){return Y.DisplayNameHelper.getNodeDisplayName(this)}}function Na(){Ab.call(this);this.getType=function(){return fa.TYPE_SORT}}function xb(){var h=this;Vb.call(this);this.getType=function(){return fa.TYPE_GROUP_BY};this.getGeneratedSourceFieldName=function(c,d,e){c=m(c);var k=c.getFromNode();k=d.getNode(k);var a=k.getType();return a===fa.TYPE_GROUP_BY||
a===fa.TYPE_CALCULATED_FIELD?Y.FieldNumberHelper.getFieldNumberByFullName(c.getFullName()):a===fa.TYPE_CUSTOM_GROUP?k.getConfig().getSelectedField().getAlias():a===fa.TYPE_COLUMN_TO_ROW?k.getGeneratedSourceFieldName(c,d,e):c.getName()};this.getGeneratedFieldSourceTableName=function(c,d){c=m(c).getFromNode();c=d.getNode(c);return c.getType()===fa.TYPE_CUSTOM_GROUP?(c=c.getConfig().getSelectedField().getFromNode(),d=d.getNode(c),Y.DisplayNameHelper.getNodeDisplayName(d)):Y.DisplayNameHelper.getNodeDisplayName(c)};
var m=function(c){var d=c,e=c.getFullName();c=c.getFromNode();var k=h.getConfig(),a=k.getAggregateFieldItems();k=k.getGroupFieldItems().concat(a);for(a=0;a<k.length;a++){var b=k[a].getName();if(e===c+"_"+b){d=k[a].getField();break}}return d}}function yb(){var h=this;Vb.call(this);this.getType=function(){return fa.TYPE_CUSTOM_GROUP};this.getGeneratedSourceFieldName=function(m,c,d){return h.getConfig().getSelectedField().getAlias()};this.getGeneratedFieldSourceTableName=function(m,c){m=h.getConfig().getSelectedField().getFromNode();
c=c.getNode(m);return Y.DisplayNameHelper.getNodeDisplayName(c)}}function wa(){Vb.call(this);this.getType=function(){return fa.TYPE_CALCULATED_FIELD};this.getGeneratedSourceFieldName=function(h,m,c){if(c instanceof wa)return" ";c=h.getFromNode();m=m.getNode(c).getConfig().getCalculatedFields();c=h.getAlias();for(var d=0;d<m.length;d++)if(m[d].getFullName()===h.getFullName()){c=m[d].getAlias();break}return c};this.getGeneratedFieldSourceTableName=function(h){return Y.DisplayNameHelper.getNodeDisplayName(this)}}
function Q(){var h=[];this.addExtraFromNode=function(m){h.push(m)};this.getExtraFromNode=function(){return h};this.isMultiInDegree=function(){return!0};this.affectByAddOrRemoveNode=function(m,c){throw Error("override me");};this.affectByLink=function(m,c){throw Error("override me");};this.affectByBreakLink=function(m,c){throw Error("override me");};this.getSuggestUpwardIdWhenDelete=function(){throw Error("override me");}}function Ha(){Ab.call(this);Q.call(this);var h=this;this.getType=function(){return fa.TYPE_JOIN};
this.affectByAddOrRemoveNode=function(m,c){console.log("join config affect by node");var d=h.getConfig(),e=d.getRelationModel();e.getLeft()==m.getId()?(m=c?c.getId():null,e.setLeft(m)):e.getRight()==m.getId()&&(m=c?c.getId():null,e.setRight(m));d.setRelationModel(e)};this.affectByLink=function(m,c){var d=h.getConfig(),e=d.getRelationModel(),k=e.getLeft(),a=e.getRight();c=c.getId();k&&m.getNode(k)?a&&m.getNode(a)||e.setRight(c):e.setLeft(c);d.setRelationModel(e)};this.affectByBreakLink=function(m,
c){m=h.getConfig();var d=m.getRelationModel(),e=d.getLeft(),k=d.getRight();c=c.getId();c==e?d.setLeft(null):c==k&&d.setRight(null);m.setRelationModel(d)};this.getSuggestUpwardIdWhenDelete=function(){return h.getConfig().getLeft()}}function Ob(){Vb.call(this);Q.call(this);var h=this,m;this.getType=function(){return fa.TYPE_UNION};this.affectByAddOrRemoveNode=function(c,d){if(d){for(var e=h.getConfig(),k=e.getNodeItems(),a=0,b=0;b<k.length;b++){var f=k[b];if(f.getNodeId()==c.getId()){a=b;f.setNodeId(d.getId());
f.setAlias(Y.DisplayNameHelper.getNodeDisplayName(d));break}}c=e.getUnionItems();for(b=0;b<c.length;b++)c[b].getUnionInnerItemByIndex(a).setNodeId(d.getId());e.firePropertyChangeEvt()}};this.affectByLink=function(c,d){c=h.getConfig();for(var e=c.getNodeItems(),k=0;k<e.length;k++)if(d.getId()==e[k].getNodeId()&&Y.DisplayNameHelper.getNodeDisplayName(d)==e[k].getAlias()){c.firePropertyChangeEvt();return}m=c.getBaseNodeItem();k=new jb;k.setNodeId(d.getId());k.setAlias(Y.DisplayNameHelper.getNodeDisplayName(d));
c.setBaseNodeItem(k);e=c.getUnionItems();for(k=0;k<e.length;k++)e[k].getUnionInnerItemByIndex(0).setNodeId(d.getId());c.firePropertyChangeEvt()};this.affectByBreakLink=function(c,d){c=h.getConfig();c.setBaseNodeItem(m);d=c.getUnionItems();for(var e=0;e<d.length;e++)d[e].getUnionInnerItemByIndex(0).setNodeId(m.getNodeId());c.firePropertyChangeEvt()};this.getSuggestUpwardIdWhenDelete=function(){return h.getConfig().getBaseNodeItem().getNodeId()};this.getGeneratedSourceFieldName=function(c,d,e){if(e instanceof
Ob)return" ";d=h.getConfig().getUnionItems();e=c.getAlias();for(var k=0;k<d.length;k++)if(d[k].getName()===c.getName()){a:{c=d[k];d=(d=h.getFieldSettingConfig())?d.getModifiedField():[];e=c.getName();for(k=0;k<d.length;k++){var a=d[k];if(e==a.getName()){e=a.getAlias();break a}}e=c.getAlias()}break}return e};this.getGeneratedFieldSourceTableName=function(c){return Y.DisplayNameHelper.getNodeDisplayName(this)}}function ja(){var h,m,c;this.setId=function(d){h=d};this.getId=function(){return h};this.setFromId=
function(d){m=d};this.getFromId=function(){return m};this.setToId=function(d){c=d};this.getToId=function(){return c};this.toJsonObject=function(){var d={};d.id=h;d.fromNode=m;d.toNode=c;return d};this.fromJsonObject=function(d){h=d.id;m=d.fromNode;c=d.toNode}}function fa(){var h=this,m,c=[];this.getNodeIdInConfig=function(){return[]};this.addPropertyChangeCallback=function(d){c.push(d)};this.toJsonObject=function(){var d={};d.type=m;h.protectedToJsonObject(d);return d};this.fromJsonObject=function(d){m=
d.type;h.protectedFromJsonObject(d)};this.protectedToJsonObject=function(d){};this.protectedFromJsonObject=function(d){};this.protectedMethod={firePropertyChangeEvt:function(d){for(var e=0,k=c.length;e<k;e++)c[e](d)},setType:function(d){m=d}}}function Ja(){this.affectByPrevNode=function(h,m){throw Error("override me");};this.getConfigCopy=function(){throw Error("override me");}}function ea(){function h(){var e,k;this.setState=function(a,b){e=a;k=b};this.isSelectAll=function(){return e};this.getSelected=
function(){return k}}fa.call(this);var m=this.protectedMethod,c=[],d=!0;m.setType(fa.TYPE_FIELD_SELECT);this.extractSelectState=function(){var e=new h;e.setState(d,c);return e};this.setSelectState=function(e,k){d=e.isSelectAll();c=e.getSelected();k||m.firePropertyChangeEvt(xa.KEY_TRANSFORM_SELECT_FIELD)};this.isSelectAll=function(){return d};this.isSelected=function(e){if(d)return!0;for(var k=0,a=c.length;k<a;k++)if(c[k].getFullName()==e.getFullName())return!0;return!1};this.getSelected=function(){return c};
this.protectedToJsonObject=function(e){e.selectAll=d;var k=[];if(!d)for(var a=0,b=c.length;a<b;a++)k.push(c[a].toJsonObject());e.selectedFields=k};this.protectedFromJsonObject=function(e){d=e.selectAll;e=e.selectedFields;for(var k=0;k<e.length;k++){var a=e[k],b=new w;b.fromJsonObject(a);c.push(b)}}}function G(){fa.call(this);var h=this.protectedMethod,m=[];h.setType(fa.TYPE_FIELD_SETTING);this.setModifiedField=function(d,e){m=d;!e&&h.firePropertyChangeEvt(xa.KEY_TRANSFORM_FIELD_SETTING)};this.getModifiedField=
function(){return c()};this.getModifiedFieldByFullName=function(d){for(var e=0;e<m.length;e++)if(m[e].getFullName()==d)return m[e];return null};this.copy=function(){var d=new G;d.setModifiedField(c(),!0);return d};this.protectedToJsonObject=function(d){for(var e=[],k=0;k<m.length;k++)e.push(m[k].toJsonObject());d.fields=e};this.protectedFromJsonObject=function(d){d=d.fields;for(var e=0;e<d.length;e++){var k=d[e],a=new w;a.fromJsonObject(k);m.push(a)}};this.fitRuntimeProperty=function(d){for(var e=
0,k=d.length;e<k;e++)for(var a=d[e],b=a.getFullName(),f=0;f<m.length;f++){var g=m[f];b==g.getFullName()&&g.setDataType(a.getDataType())}};var c=function(){for(var d=[],e=0;e<m.length;e++)d.push(m[e].clone());return d}}function O(){fa.call(this);var h=this.protectedMethod,m=this,c,d,e="F"+(new Date).getTime(),k,a=!0,b;h.setType(fa.TYPE_CUSTOM_GROUP);this.setSelectedField=function(f){c=f};this.getSelectedField=function(){return c};this.setGroupName=function(f,g){d=f;!g&&h.firePropertyChangeEvt(xa.KEY_TRANSFORM_CUSTOM_GROUP)};
this.getGroupName=function(){return d};this.setName=function(f){e=f};this.getName=function(){return e};this.setOtherGroupName=function(f){k=f;h.firePropertyChangeEvt(xa.KEY_TRANSFORM_CUSTOM_GROUP)};this.getOtherGroupName=function(){var f=com.kingdee.bos.qing.framework.common.MultilanguageManager.createPackageAccessor(Y);return k||f.get("others","\u5176\u5b83")};this.setHasOtherGroup=function(f,g){a=f;!g&&h.firePropertyChangeEvt(xa.KEY_TRANSFORM_CUSTOM_GROUP)};this.getHasOtherGroup=function(){return a};
this.getCustomGroupType=function(){return b?b.getCustomGroupType():c?c.getOutputDataType()==w.DT_STRING?O.STRING:O.NUMBER:null};this.setGroups=function(f,g){b=new ya;b.setGroups(f);b.setCustomGroupType(g);h.firePropertyChangeEvt(xa.KEY_TRANSFORM_CUSTOM_GROUP)};this.getGroups=function(){return b?b.getGroups():null};this.getGroupAndField=function(){return{field:m.getSelectedField(),groups:m.getGroups(),groupType:m.getCustomGroupType()}};this.setGroupAndField=function(f){m.setSelectedField(f.field);
m.setGroups(f.groups,f.groupType)};this.protectedToJsonObject=function(f){f.field=c?c.toJsonObject():void 0;f.groupName=d;f.hasOtherGroup=a;f.otherGroupName=m.getOtherGroupName();f.name=m.getName();b&&b.getGroups()&&b.getGroups().length&&(f.customGroups=b.toJsonObject())};this.protectedFromJsonObject=function(f){var g=new w;g.fromJsonObject(f.field);c=g;d=f.groupName;e=f.name;a=f.hasOtherGroup;k=f.otherGroupName;f.customGroups&&(b=new ya,b.fromJsonObject(f.customGroups))}}function ya(){var h,m;this.setCustomGroupType=
function(c){h=c};this.getCustomGroupType=function(){return h};this.setGroups=function(c){m=c};this.getGroups=function(){return m};this.toJsonObject=function(){var c={};c.customGroupType=h;if(m&&0<m.length){var d=[];m.forEach(function(e){d.push(e.toJsonObject())});c.groups=d}return c};this.fromJsonObject=function(c){h=c.customGroupType;m=[];h===O.STRING?c.groups.forEach(function(d){var e=new ca;e.fromJsonObject(d);m.push(e)}):c.groups.forEach(function(d){var e=new N;e.fromJsonObject(d);m.push(e)})}}
function ka(){var h,m;this.setCollapse=function(c){m=c};this.getCollapse=function(){return m};this.setName=function(c){h=c};this.getName=function(){return h};this.protectedMethod={toJsonObject:function(){var c={};c.name=h;return c},fromJsonObject:function(c){h=c.name}}}function ca(){ka.call(this);var h=this.protectedMethod,m=this,c=[],d=[];this.setSelecteds=function(e){d=e};this.getSelecteds=function(){return d};this.setMembers=function(e){c=e};this.getMembers=function(){return c.slice()};this.toJsonObject=
function(){var e=h.toJsonObject();e.items=c;return e};this.fromJsonObject=function(e){h.fromJsonObject(e);c=e.items||[]};this.clone=function(){var e=new ca;e.setName(m.getName());e.setMembers(c);return e}}function N(){ka.call(this);var h=this.protectedMethod,m=this,c=0,d=0,e=Ga.COMPARE_GREATER_EQUAL,k=Ga.COMPARE_LESS;this.setFrom=function(a){c=a};this.getFrom=function(){return c};this.setFromBoundary=function(a){e=a};this.getFromBoundary=function(){return e};this.setTo=function(a){d=a};this.getTo=
function(){return d};this.setToBoundary=function(a){k=a};this.getToBoundary=function(){return k};this.toJsonObject=function(){var a=h.toJsonObject(),b=new Ga;b.setCompareOp(e);b.setValue(c.toString());var f=new Ga;f.setCompareOp(k);f.setValue(d.toString());a.items=[b.toJsonObject(),f.toJsonObject()];return a};this.fromJsonObject=function(a){h.fromJsonObject(a);a=a.items;var b=new Ga;b.fromJsonObject(a[0]);e=b.getCompareOp();c=parseFloat(b.getValue());b=new Ga;b.fromJsonObject(a[1]);k=b.getCompareOp();
d=parseFloat(b.getValue())};this.clone=function(){var a=new N;a.setName(m.getName());a.setFrom(c);a.setFromBoundary(e);a.setTo(d);a.setToBoundary(k);return a}}function Ga(){var h,m;this.setValue=function(c){m=c};this.getValue=function(){return m};this.setCompareOp=function(c){h=c};this.getCompareOp=function(){return h};this.fromJsonObject=function(c){m=c.value;h=c.compareOp};this.toJsonObject=function(){var c={};c.value=m;c.compareOp=h;return c}}function Pa(){fa.call(this);var h=this.protectedMethod,
m=[],c=[],d={};h.setType(fa.TYPE_GROUP_BY);this.setGroupFieldItems=function(k){m=k;h.firePropertyChangeEvt(xa.KEY_TRANSFORM_GROUP_BY)};this.getGroupFieldItems=function(){return m};this.copyGroupFieldItems=function(){return m.concat([])};this.setAggregateFieldItems=function(k){c=k;h.firePropertyChangeEvt(xa.KEY_TRANSFORM_GROUP_BY)};this.getAggregateFieldItems=function(){return c};this.copyAggregateFieldItems=function(){return c.concat([])};this.setMapInitFieldItem=function(k){d=k};this.getMapInitFieldItem=
function(){return d};this.protectedToJsonObject=function(k){k.groupFieldItems=e(m);k.aggregateFieldItems=e(c)};var e=function(k){var a=[];k.forEach(function(b){a.push(b.toJsonObject())});return a};this.protectedFromJsonObject=function(k){var a=k.aggregateFieldItems;k=k.groupFieldItems;for(var b=[],f=0;f<k.length;f++){var g=k[f],l=new Ia;l.fromJsonObject(g);b.push(l)}m=b;k=[];for(b=0;b<a.length;b++)f=a[b],g=new Oa,g.fromJsonObject(f),k.push(g);c=k}}function Qa(){var h,m;this.setField=function(c){m=
c};this.getField=function(){return m};this.setName=function(c){h=c};this.getName=function(){return h};this.protectedMethod={toJsonObject:function(){var c={};c.name=h;c.field=m.toJsonObject();return c},fromJsonObject:function(c){h=c.name;c=c.field;m=new w;m.fromJsonObject(c)}}}function Ia(){Qa.call(this);var h=this.protectedMethod,m=this,c=!1,d=Y.DateGroupType.YEAR,e={};this.setDateGroup=function(k){c=k};this.getDateGroup=function(){return c};this.setDateGroupType=function(k){d=k};this.getDateGroupType=
function(){return d};this.setDateGroupTypeMap=function(k){e=k};this.getDateGroupTypeMap=function(){return e};this.updateGroupByFieldProperty=function(){c=!0;m.setDateGroupType(Y.DateGroupType.YEAR)};this.toJsonObject=function(){var k=h.toJsonObject();c&&(k.dateGroupType=d);k.isDateGroup=c;return k};this.fromJsonObject=function(k){h.fromJsonObject(k);if(c=k.isDateGroup)d=k.dateGroupType,e.alias=m.getField().getAlias(),e.dateGroupType=d}}function Oa(){Qa.call(this);var h=this.protectedMethod,m=this,
c,d,e={};this.setFunctionType=function(k){c=k};this.getFunctionType=function(){return c};this.setFunctionTypeMap=function(k){e=k};this.getFunctionTypeMap=function(){return e};this.setCalculateByDateType=function(k){d=k};this.getCalculateByDateType=function(){return d};this.toJsonObject=function(){var k=h.toJsonObject();k.functionType=c;d&&(k.calculateByDateType=d);return k};this.fromJsonObject=function(k){h.fromJsonObject(k);m.setFunctionType(k.functionType);m.setCalculateByDateType(k.calculateByDateType);
e.alias=m.getField().getAlias();e.functionType=c;e.calculateByDateType=d}}function M(){fa.call(this);Ja.call(this);var h=this,m=this.protectedMethod;m.setType(fa.TYPE_JOIN);var c,d;this.init=function(e,k,a,b){d=e;c=new C;c.init(k,a,b)};this.setJoinType=function(e){d=e;m.firePropertyChangeEvt(xa.KEY_TRANSFORM_JOIN)};this.getJoinType=function(){return d};this.getLeft=function(){if(c)return c.getLeft()};this.getRight=function(){if(c)return c.getRight()};this.getRelationModel=function(){return c.clone()};
this.setRelationModel=function(e){c=e;m.firePropertyChangeEvt(xa.KEY_TRANSFORM_JOIN)};this.affectByPrevNode=function(e,k){c&&(c.getLeft()==e?c.setLeft(k):c.getRight()==e&&c.setRight(k))};this.getConfigCopy=function(){var e=new M;e.fromJsonObject(h.toJsonObject());return e};this.protectedToJsonObject=function(e){e.leftNode=c.getLeft();e.rightNode=c.getRight();e.joinType=d;for(var k=[],a=c.getRelations(),b=0,f=a.length;b<f;b++){var g=[],l=a[b],n=l[0];l=l[1];n&&(g[0]=n.toJsonObject());l&&(g[1]=l.toJsonObject());
k.push(g)}e.allRelations=k};this.protectedFromJsonObject=function(e){var k=e.leftNode,a=e.rightNode;d=e.joinType;e=e.allRelations;for(var b=[],f=0;f<e.length;f++){var g=e[f];if(2==g.length){var l=[];if(g[0]){var n=new w;n.fromJsonObject(g[0]);l[0]=n}g[1]&&(n=new w,n.fromJsonObject(g[1]),l[1]=n);b.push(l)}}c=new C;c.init(k,a,b)}}function C(){var h,m,c;this.init=function(d,e,k){h=d;m=e;c=k};this.clone=function(){for(var d=new C,e=[],k=0;k<c.length;k++){var a=c[k],b=[];b[0]=a[0]&&a[0].clone();b[1]=a[1]&&
a[1].clone();e.push(b)}d.init(h,m,e);return d};this.setLeft=function(d){h=d};this.getLeft=function(){return h};this.setRight=function(d){m=d};this.getRight=function(){return m};this.setRelations=function(d){c=d};this.getRelations=function(){return c}}function F(){fa.call(this);var h=this,m=this.protectedMethod;m.setType(fa.TYPE_FILTER);var c=[];this.getFilterItems=function(){return c};this.setFilterItems=function(d){c=d};this.copyFilterItems=function(){for(var d=[],e=0;e<c.length;e++)d.push(c[e].copy());
return d};this.firePropertyChangeEvt=function(){m.firePropertyChangeEvt(xa.KEY_TRANSFORM_FILTER)};this.getNotEmptyFilterItems=function(){for(var d=[],e=0;e<c.length;e++)c[e].isEmpty()||d.push(c[e]);return d};this.protectedToJsonObject=function(d){for(var e=h.getNotEmptyFilterItems(),k=[],a=0,b=e.length;a<b;a++)k.push(e[a].toJsonObject());d.filterItems=k};this.protectedFromJsonObject=function(d){if(d){d=d.filterItems;for(var e=0;e<d.length;e++){var k=new x;k.fromJsonObject(d[e]);c.push(k)}}}}function x(){var h,
m,c,d,e=0,k=0,a,b=null;this.setField=function(g){(h=g)&&!g.isMulBaseData()&&m&&c&&(g=g.getOutputDataType(),g!=w.DT_DATE&&g!=w.DT_DATETIME||x.REG_DATETIME.test(c)||x.isCompareOpWithinOrNotWithinValue(m)||(c=(new Date).getTime()));f()};this.updateNotExistFieldByMyself=function(){var g=new w;g.setFromNode(h.getSourceNodeId());g.setName(h.getName());g.setAlias(h.getAlias());h=g};this.getField=function(){return h};this.getTargetFieldFullName=function(){return h?h.getFullName():null};this.setCompareOp=
function(g){m=g};this.getCompareOp=function(){return m};this.setValue=function(g){c=g;f()};this.getValue=function(){return c};this.setDisplayValue=function(g){d=g};this.getDisplayValue=function(g){if(d){if(!g&&x.isCompareOpWithinOrNotWithinValue(m))return JSON.parse(d).join(",");if(x.isCompareOpRelativeDateRangeValue(m))return g=h.getOutputDataType()==w.DT_DATETIME,W.modelToDisplayText(b,g)}else return"";return d};this.setLeftBracketCount=function(g){e=g};this.getLeftBracketCount=function(){return e};
this.setRightBracketCount=function(g){k=g};this.getRightBracketCount=function(){return k};this.setLogicOp=function(g){a=g};this.getLogicOp=function(){return a};this.setRelativeDateRange=function(g){b=g};this.getRelativeDateRange=function(){return b};this.isEmpty=function(){return 0==e&&0==k&&!h&&!m&&!c&&!a};this.equals=function(g){if(m!==g.getCompareOp()||c!==g.getValue()||d!==g.getDisplayValue()||e!==g.getLeftBracketCount()||k!==g.getRightBracketCount()||a!==g.getLogicOp()||!h.equals(g.getField()))return!1;
a:{var l=b;g=g.getRelativeDateRange();var n=Object.getOwnPropertyNames(l),p=Object.getOwnPropertyNames(g);if(n.length!==p.length)l=!1;else{for(p=0;p<n.length;p++){var u=n[p];if(l[u]!==g[u]){l=!1;break a}}l=!0}}if(!l)return!1};var f=function(){if(h&&m){var g=h.getOutputDataType();if(c){var l=h.isEnum(),n=h.isMulBaseData(),p=l?h.getEnumValue():null;if(x.isCompareOpWithinOrNotWithinValue(m))if(l){g=JSON.parse(c);l=[];for(n=0;n<g.length;n++){var u=p[g[n]];u&&l.push(u)}d=JSON.stringify(l)}else d=c;else n?
d=c:g==w.DT_DATE||g==w.DT_DATETIME?(p=new Date,p.setTime(c),l=new com.kingdee.bos.qing.common.DateFormater,n=l.setFormatString,g=g==w.DT_DATE?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss",n.call(l,g),d=l.format(p)):g==w.DT_BOOLEAN?(p=com.kingdee.bos.qing.framework.common.MultilanguageManager.createPackageAccessor(Y),d=c==w.BOOLEAN_TRUE?p.get("dataTypeTrue","\u771f"):c==w.BOOLEAN_FALSE?p.get("dataTypeFalse","\u5047"):""):d=l?p[c]?p[c]:"":c}else d=x.isCompareOpRelativeDateRangeValue(m)&&null!=b?W.modelToDisplayText(b,
g==w.DT_DATETIME):null}};this.copy=function(){var g=new x;g.setField(h);g.setCompareOp(m);g.setValue(c);g.setDisplayValue(d);g.setLeftBracketCount(e);g.setRightBracketCount(k);g.setLogicOp(a);g.setRelativeDateRange(b);return g};this.toJsonObject=function(){if(!h)return null;var g={};g.field=h.toJsonObject();g.compareOp=m;g.value=c;g.displayValue=d;g.leftBrackets=e;g.rightBrackets=k;g.logicOp=a;b&&(g.relativeDateRange=b.toJsonObject());return g};this.fromJsonObject=function(g){g&&(h=new w,h.fromJsonObject(g.field),
m=g.compareOp,c=g.value,d=g.displayValue,e=g.leftBrackets,k=g.rightBrackets,a=g.logicOp,g=g.relativeDateRange)&&(b=new gb,b.fromJsonObject(g))}}function Aa(){fa.call(this);var h=this.protectedMethod;h.setType(fa.TYPE_COLUMN_TO_ROW);var m=this,c,d=[],e=[],k=1;this.setTargetAttrField=function(b){c=b};this.getTargetAttrField=function(){return c};this.getAttrFieldAlias=function(){return c?c.getAlias():""};this.addTargetAttrField=function(b){c=new w;c.setName("F"+(new Date).getTime()+k);c.setAlias(b);
c.setDataType(w.DT_STRING);k+=1};this.setAttrFieldAlias=function(b){c?c.setAlias(b):m.addTargetAttrField(b)};this.setTargetValueFields=function(b){d=b};this.getTargetValueFields=function(){return d};this.getTargetValueFieldAlias=function(){var b=[],f;for(f in d)b.push(d[f].getAlias());return b};this.getTargetValueFieldAlia=function(b){return m.getTargetValueFieldAlias()[b]};this.getTargetValueFieldSize=function(){return d.length};this.addTargetValueField=function(b,f){var g=new w;g.setName("F"+(new Date).getTime()+
k);g.setAlias(f);g.setDataType(w.DT_STRING);d[b]=g;k+=1};this.setValueFieldAlias=function(b,f){d[b]?d[b].setAlias(f):m.addTargetValueField(b,f)};this.deleteTargetValueField=function(b){if(e&&0<e.length)for(var f=0;f<e.length;f++){var g=e[f];g&&g.getFields().splice(b,1)}d.splice(b,1)};this.getUsedFieldNames=function(){var b=[];if(e&&0<e.length)for(var f in e){var g=e[f].getUsedFieldNames();a(b,g)}return b};this.getUsedFields=function(){var b=[];if(e&&0<e.length)for(var f in e){var g=e[f].getFields();
a(b,g)}return b};var a=function(b,f){if(f&&0<f.length){b=b?b:[];for(var g in f){var l=f[g];l&&b.push(l)}}};this.addColumnToRowItem=function(b,f){e[b]=f};this.deleteColumnToRowItem=function(b){e.splice(b,1)};this.getColumnToRowItem=function(b){return e[b]};this.setColumnToRowItems=function(b){e=b};this.getColumnToRowItems=function(){return e};this.clone=function(){var b=new Aa,f=new w;f.fromJsonObject(c.toJsonObject());b.setTargetAttrField(f);f=[];for(var g=0;g<d.length;g++){var l=new w;l.fromJsonObject(d[g].toJsonObject());
f.push(l)}b.setTargetValueFields(f);f=[];for(g=0;g<e.length;g++)f.push(e[g].clone());b.setColumnToRowItems(f);return b};this.firePropertyChangeEvt=function(){h.firePropertyChangeEvt(xa.KEY_TRANSFORM_COLUMN_TO_ROW)};this.protectedToJsonObject=function(b){b.targetAttrField=c.toJsonObject();var f=[],g;for(g in d)f.push(d[g].toJsonObject());b.targetValueFields=f;f=[];for(g=0;g<e.length;g++)f.push(e[g].toJsonObject());b.columnToRowItems=f;return b};this.protectedFromJsonObject=function(b){c=new w;c.fromJsonObject(b.targetAttrField);
if(b.columnToRowItems)for(var f=b.columnToRowItems,g=0;g<f.length;g++){var l=new za;l.fromJsonObject(f[g]);e.push(l)}if(b.targetValueFields)for(b=b.targetValueFields,f=0;f<b.length;f++)g=new w,g.fromJsonObject(b[f]),d.push(g)}}function za(){var h=this,m,c=[];this.setName=function(d){m=d};this.getName=function(){return m};this.setFields=function(d){c=d};this.getFields=function(){return c};this.getField=function(d){return c[d]};this.getUsedFieldNames=function(){for(var d=[],e=0;e<c.length;e++)c[e]&&
d.push(c[e].getFullName());return d};this.toJsonObject=function(){var d={};d.name=h.getName();for(var e=[],k=0;k<c.length;k++)c[k]?e.push(c[k].toJsonObject()):e.push((new w).toJsonObject());d.fields=e;return d};this.fromJsonObject=function(d){h.setName(d.name);d=d.fields;for(var e=0;e<d.length;e++)if(d[e]&&d[e].name){var k=new w;k.fromJsonObject(d[e]);c.push(k)}else c.push(null)};this.clone=function(){var d=new za;d.setName(m);for(var e=[],k=0;k<c.length;k++)if(c[k]){var a=new w;a.fromJsonObject(c[k].toJsonObject());
e.push(a)}else e.push(null);d.setFields(e);return d}}function U(){fa.call(this);var h=this.protectedMethod;h.setType(fa.TYPE_SORT);var m=[];this.getSortItems=function(){return m};this.setSortItems=function(c){m=c};this.copySortItems=function(){for(var c=[],d=0;d<m.length;d++)c.push(m[d].copy());return c};this.firePropertyChangeEvt=function(){h.firePropertyChangeEvt&&h.firePropertyChangeEvt(xa.KEY_TRANSFORM_SORT)};this.protectedToJsonObject=function(c){for(var d=[],e=0,k=m.length;e<k;e++)d.push(m[e].toJsonObject());
c.sortItems=d};this.protectedFromJsonObject=function(c){if(c){c=c.sortItems;for(var d=0;d<c.length;d++){var e=new ba;e.fromJsonObject(c[d]);m.push(e)}}}}function ba(){var h,m;this.setField=function(c){h=c};this.getField=function(){return h};this.updateNotExistFieldByMyself=function(){var c=new w;c.setFromNode(h.getSourceNodeId());c.setName(h.getName());c.setAlias(h.getAlias());h=c};this.getTargetFieldFullName=function(){return h?h.getFullName():null};this.initSortRule=function(){m=ba.ORDER_ASC};this.setOrder=
function(c){m=c};this.getOrder=function(){return m};this.copy=function(){var c=new ba;c.setField(h);c.setOrder(m);return c};this.toJsonObject=function(){var c={};c.field=h.toJsonObject();c.order=m;return c};this.fromJsonObject=function(c){c&&(h=new w,h.fromJsonObject(c.field),m=c.order)}}function Ta(){fa.call(this);var h=this.protectedMethod,m=[];h.setType(fa.TYPE_CALCULATED_FIELD);this.setCalculatedFields=function(d){m=d;h.firePropertyChangeEvt(xa.KEY_TRANSFORM_CALCULATED_FIELD)};this.getCalculatedFields=
function(){return m};this.copyCalculatedFields=function(){return m.concat([])};this.protectedToJsonObject=function(d){d.calculatedFields=c(m)};var c=function(d){var e=[];d.forEach(function(k){e.push(k.toJsonObject())});return e};this.protectedFromJsonObject=function(d){d=d.calculatedFields;for(var e=[],k=0;k<d.length;k++){var a=d[k],b=new Xa;b.fromJsonObject(a);e.push(b)}m=e}}function Xa(){w.call(this);var h=this,m;this.setFormula=function(c){m=c};this.getFormula=function(){return m};this.protectedToJsonObject=
function(c){c.formula=m};this.protectedFromJsonObject=function(c){m=c.formula};this.clone=function(){var c=new Xa;c.setFromNode(h.getSourceNodeId());c.setName(h.getName());c.setAlias(h.getAlias());c.setDataType(h.getDataType());c.setAppointedDataType(h.getAppointedDataType());c.setScale(h.getScale());c.setRoundMode(h.getRoundMode());c.setFormula(m);return c}}function D(){fa.call(this);Ja.call(this);var h=this,m=this.protectedMethod;m.setType(fa.TYPE_UNION);var c=[],d=[];this.setNodeItems=function(a){c=
a};this.getNodeItems=function(){return c};this.addNodeItem=function(a){c.push(a)};this.setUnionItems=function(a){d=a};this.getUnionItems=function(){return d};this.addUnionItem=function(a){d.push(a)};this.affectByPrevNode=function(a,b){for(var f=0;f<c.length;f++){var g=c[f];if(g.getNodeId()==a){g.setNodeId(b);break}}for(f=0;f<d.length;f++){g=d[f].getUnionInnerItems();for(var l=0;l<g.length;l++){var n=g[l];if(n.getNodeId()==a){n.setNodeId(b);break}}}};this.getConfigCopy=function(){return h.clone()};
this.getNodeIdInConfig=function(){for(var a=[],b=0;b<c.length;b++)a.push(c[b].getNodeId());return a};this.getNodeItemsSlice=function(a,b){for(var f=[],g=0;g<c.length;g++)if(0!=g||!a){var l=c[g];b?l.isExist()&&f.push(l):f.push(l)}return f};this.getNodeFields=function(){for(var a={},b=0;b<d.length;b++)for(var f=d[b].getUnionInnerItems(),g=0;g<f.length;g++){var l=f[g];if(!l.isEmpty()&&l.isFieldExist()){var n=l.getField();l=l.getNodeId();var p=a[l]?a[l]:[];a[l]=p;p.push(n)}}return a};this.getBaseNodeItem=
function(){return c[0]};this.setBaseNodeItem=function(a){c&&0<c.length&&(c[0]=a)};this.checkNodeToUnionExistExceptBase=function(){return 1<c.length};this.checkUnionItemSelectEmpty=function(){for(var a=0;a<d.length;a++)if(d[a].isSelected())return!1;return!0};this.firePropertyChangeEvt=function(){m.firePropertyChangeEvt&&m.firePropertyChangeEvt(xa.KEY_TRANSFORM_UNION)};this.updateUnionItem=function(a,b){for(var f=0;f<d.length;f++)d[f].update(a,b)};this.checkFieldExist=function(a,b){for(var f=0;f<d.length;f++)if(!d[f].update(a,
b))return!1;return!0};this.addOneNodeToUnion=function(a,b,f,g){for(var l=0;l<d.length;l++)d[l].appendEmptyUnionInnerItem(a,f);for(l=0;l<b.length;l++){var n=b[l];a:{var p=n;for(var u=f,E=0;E<d.length;E++)if(d[E].tryAddUnionInnerItem(p,u)){p=!0;break a}p=!1}p||k(a,n).setSelected(g)}};this.deleteOneNodeToUnion=function(a){for(var b=0,f=0;f<c.length;f++)if(a==c[f].getNodeId()){b=f;break}c.splice(b,1);for(f=0;f<d.length;f++)d[f].deleteUnionInnerItemByNodeIndex(b);d=d.filter(function(g){return!g.isEmpty()})};
this.addOneUnionItem=function(a,b){return k(a,b)};this.tryDeleteOneUnionItem=function(a){d[a].isEmpty()&&d.splice(a,1)};this.getSelectedUnionItem=function(a){for(var b=[],f=0;f<d.length;f++){var g=d[f];g.isSelected()&&b.push(g)}f=[];for(g=0;g<b.length;g++){var l=b[g];if(l.getName())f.push(l.getName());else{var n=l.getBaseField().getName();n=e(f,n);l.setName(n);f.push(n)}}f=[];for(g=0;g<b.length;g++){l=b[g];if(l.getName())a:{n=l;for(var p=a?a.getModifiedField():[],u=n.getName(),E=0;E<p.length;E++){var V=
p[E];if(u==V.getName()){n=V.getAlias();break a}}n=n.getAlias()}else n=null;n?f.push(n):(n=l.getBaseField().getAlias(),n=e(f,n),l.setAlias(n),f.push(n))}return b};this.clone=function(){for(var a=new D,b=[],f=0;f<c.length;f++)b.push(c[f].clone());a.setNodeItems(b);b=[];for(f=0;f<d.length;f++)b.push(d[f].clone());a.setUnionItems(b);return a};this.protectedToJsonObject=function(a){if(a){for(var b=[],f=0;f<c.length;f++)b.push(c[f].toJsonObject());a.nodeItems=b;b=[];for(f=0;f<d.length;f++){var g=d[f];g.isSelected()&&
b.push(g.toNotEmptyUnionInnerItem().toJsonObject())}a.unionItems=b}};this.protectedFromJsonObject=function(a){if(a){for(var b=a.nodeItems,f=0;f<b.length;f++){var g=new jb;g.fromJsonObject(b[f]);c.push(g)}a=a.unionItems;for(f=0;f<a.length;f++)b=new Sa,b.fromJsonObject(a[f]),d.push(b);for(f=0;f<d.length;f++)d[f].fill(c)}};var e=function(a,b){for(var f=1,g=b;-1<a.indexOf(g);)g=b+"_"+f,f++;return g},k=function(a,b){for(var f=new Sa,g=[],l=0;l<c.length;l++){var n=c[l].getNodeId(),p=new rb;p.setNodeId(n);
n==a&&p.setField(b);g.push(p)}f.setUnionInnerItems(g);d.push(f);return f}}function jb(){var h,m,c=!0;this.getNodeId=function(){return h};this.setNodeId=function(d){h=d};this.getAlias=function(){return m};this.setAlias=function(d){m=d};this.isExist=function(){return c};this.setExist=function(d){c=d};this.clone=function(){var d=new jb;d.setNodeId(h);d.setAlias(m);d.setExist(c);return d};this.toJsonObject=function(){var d={};d.nodeId=h;d.alias=m;return d};this.fromJsonObject=function(d){d&&(h=d.nodeId,
m=d.alias)}}function Sa(){var h,m,c=[],d=!0;this.getName=function(){return h};this.setName=function(k){h=k};this.getAlias=function(){return m};this.setAlias=function(k){m=k};this.getUnionInnerItems=function(){return c};this.setUnionInnerItems=function(k){c=k};this.isSelected=function(){return d};this.setSelected=function(k){d=k};this.getUnionInnerItemsCount=function(){return c.length};this.update=function(k,a){k=c[k];if(k.isEmpty())return!0;for(var b=k.getField(),f=0;f<a.length;f++)if(a[f].getFullName()==
b.getFullName())return k.setField(a[f]),k.setFieldExist(!0),!0;k.updateNotExistFieldByMyself();k.setFieldExist(!1);return!1};this.appendEmptyUnionInnerItem=function(k,a){a<c.length||(a=new rb,a.setNodeId(k),c.push(a))};this.getUnionInnerItemByIndex=function(k){return c[k]};this.fill=function(k){if(c.length!=k.length){for(var a=[],b=0,f=0;f<k.length;f++){var g=c[b];g&&k[f].getNodeId()==g.getNodeId()?(a.push(c[b]),b++):(g=new rb,g.setNodeId(k[f].getNodeId()),a.push(g))}c=a}};this.isEmpty=function(){for(var k=
0;k<c.length;k++)if(!c[k].isEmpty())return!1;return!0};this.tryAddUnionInnerItem=function(k,a){a=c[a];if(!a.isEmpty())return!1;var b=e();if(b&&k&&b.getAlias()!=k.getAlias())return!1;a.setField(k);return!0};this.deleteUnionInnerItemByNodeIndex=function(k){c.splice(k,1)};this.toNotEmptyUnionInnerItem=function(){var k=new Sa;k.setName(h);k.setAlias(m);for(var a=[],b=0;b<c.length;b++){var f=c[b];f&&!f.isEmpty()&&a.push(f)}k.setUnionInnerItems(a);k.setSelected(d);return k};this.getBaseField=function(){return e()};
this.clone=function(){var k=new Sa;k.setName(h);k.setAlias(m);for(var a=[],b=0;b<c.length;b++)a.push(c[b].clone());k.setUnionInnerItems(a);k.setSelected(d);return k};this.toJsonObject=function(){var k={};k.name=h;k.alias=m;for(var a=[],b=0;b<c.length;b++)a.push(c[b].toJsonObject());k.unionInnerItems=a;return k};this.fromJsonObject=function(k){if(k){h=k.name;m=k.alias;k=k.unionInnerItems;for(var a=0;a<k.length;a++){var b=new rb;b.fromJsonObject(k[a]);c.push(b)}d=!0}};var e=function(){if(c)for(var k=
0;k<c.length;k++){var a=c[k];if(a&&a.getField())return a.getField()}}}function rb(){var h,m,c=!0;this.getField=function(){return h};this.setField=function(d){h=d};this.getNodeId=function(){return m};this.setNodeId=function(d){m=d};this.isFieldExist=function(){return c};this.setFieldExist=function(d){c=d};this.getFiledAlias=function(){return h?h.getAlias():""};this.isEmpty=function(){return!h};this.updateNotExistFieldByMyself=function(){var d=new w;d.setFromNode(h.getSourceNodeId());d.setName(h.getName());
d.setAlias(h.getAlias());h=d};this.clone=function(){var d=new rb;d.setField(h);d.setNodeId(m);d.setFieldExist(c);return d};this.toJsonObject=function(){var d={};d.field=h.toJsonObject();d.nodeId=m;return d};this.fromJsonObject=function(d){d&&(h=new w,h.fromJsonObject(d.field),m=d.nodeId)}}function Ra(){var h,m,c,d,e,k,a,b=this;this.setUid=function(f){h=f};this.getUid=function(){return h};this.isUserSql=function(){return k?!0:!1};this.getUserSql=function(){return k};this.setUserSql=function(f){k=f};
this.setTableName=function(f){m=f};this.getTableName=function(){return m};this.setSourceUid=function(f){c=f};this.getSourceUid=function(){return c};this.setNamespace=function(f){d=f};this.getNamespace=function(){return d};this.setDisplayName=function(f){e=f};this.getDisplayName=function(){return e};this.setDisableDrag=function(f){a=f};this.getDisableDrag=function(){return a};this.isSame=function(f){return c==f.getSourceUid()&&m==f.getTableName()&&d==f.getNamespace()&&(!b.isUserSql()&&!f.isUserSql()||
b.isUserSql()&&f.isUserSql()&&(f=f.getUserSql(),f.getSqlType()==k.getSqlType()&&f.getContent()==k.getContent()))?!0:!1};this.toJsonObject=function(){var f={};f.id=h;f.name=m;f.sourceId=c;f.namespace=d;b.isUserSql()&&(f.userSQL=k.toJsonObject());return f};this.fromJsonObject=function(f){h=f.id;m=f.name;c=f.sourceId;d=f.namespace;e=f.displayName;f.userSQL&&(k=new Ma,k.fromJsonObject(f.userSQL))};this.clone=function(){var f=new Ra;f.setUid(h);f.setTableName(m);f.setNamespace(d);f.setDisplayName(e);f.setSourceUid(c);
k&&f.setUserSql(k.copy());return f}}function Ma(){var h,m;this.getSqlType=function(){return h};this.setSqlType=function(c){h=c};this.setContent=function(c){m=c};this.getContent=function(){return m};this.fromJsonObject=function(c){h=c.type;m=c.content};this.toJsonObject=function(){var c={};c.type=h;c.content=m;return c};this.copy=function(){var c=new Ma;c.setSqlType(h);c.setContent(m);return c}}function qa(){var h,m,c,d,e,k;this.setId=function(a){h=a};this.getId=function(){return h};this.getSourceId=
function(){return m};this.setSourceId=function(a){m=a};this.setSourceRefId=function(a){c=sId};this.getSourceRefId=function(){return c};this.getName=function(){return d};this.setName=function(a){d=a};this.setSourceType=function(a){e=a};this.getSourceType=function(){return e};this.setModelId=function(a){k=a};this.getModelId=function(){return k};this.toJsonObject=function(){var a={};a.id=h;a.modelSetSourceId=m;a.modelSetSourceRefId=c;a.modelId=k;a.type=e;return a};this.fromJsonObject=function(a){h=a.id;
m=a.modelSetSourceId;c=a.modelSetSourceRefId;e=a.type;d=a.name}}function w(){var h=this,m,c,d,e,k,a,b,f,g;this.setFromNode=function(n){m=n};this.getFromNode=function(){return m};this.getSourceNodeId=function(){return m};this.setName=function(n){c=n};this.getName=function(){return c};this.getFullName=function(){return m+"_"+c};this.setAlias=function(n){d=n};this.getAlias=function(){return d?d:c};this.getAppointedAlias=function(){return d};this.setDataType=function(n){l(n);e=n};this.getDataType=function(){return e};
this.setAppointedDataType=function(n){n&&l(n);a=n==k?null:n};this.getAppointedDataType=function(){return a};this.getOriginalDataType=function(){return k};this.setOriginalDataType=function(n){k=n};this.getOutputDataType=function(){return a?a:e};this.setRoundMode=function(n){f=n};this.getRoundMode=function(){return f};this.setScale=function(n){b=n};this.getScale=function(){return b};this.setExtensions=function(n){g=n};this.getEnumValue=function(){return g?g[w.EXTENSION_BIZ_FIELD_ENUM_KEY]:null};this.isMulBaseData=
function(){return g?g[w.EXTENSION_IS_MUL_BASE_DATA]:!1};this.isPk=function(){return g?g[w.EXTENSION_IS_PK]:!1};this.getSourceDisplayName=function(){return g?g[w.EXTENSION_SOURCE_FIELD_ALIAS]:null};this.isEnum=function(){if(h.isMulBaseData()||h.getOutputDataType()!=w.DT_STRING)return!1;var n=h.getEnumValue();return 0==(n?Object.keys(n):[]).length?!1:!0};this.fromJsonObject=function(n){c=n.name;d=n.alias;e=n.dataType;a=n.appointedDataType;m=n.fromNode;void 0!=n.scale&&(b=n.scale);k=n.originalDataType;
n.roundMode&&(f=n.roundMode);g=n.extensions;h.protectedFromJsonObject(n)};this.protectedFromJsonObject=function(n){};this.toJsonObject=function(){var n={};n.name=c;n.alias=d;n.dataType=e;n.fromNode=m;a&&(n.appointedDataType=a);void 0!=b&&(n.scale=b);f&&(n.roundMode=f);g&&(n.extensions=g);h.protectedToJsonObject(n);return n};this.protectedToJsonObject=function(n){};var l=function(n){if(n!==w.DT_STRING&&n!==w.DT_INT&&n!==w.DT_NUMBER&&n!==w.DT_DATE&&n!==w.DT_DATETIME&&n!==w.DT_BOOLEAN)throw Error("IllegalArgument: "+
n);};this.clone=function(){var n=new w;n.setName(c);e&&n.setDataType(e);n.setAlias(d);a&&n.setAppointedDataType(a);k&&n.setOriginalDataType(k);n.setFromNode(m);void 0!=b&&n.setScale(b);f&&n.setRoundMode(f);n.setExtensions(g);return n};this.equals=function(n){return c==n.getName()&&d==n.getAlias()&&a==n.getAppointedDataType()&&b==n.getScale()&&f==n.getRoundMode()?!0:!1}}function sa(){var h,m=[],c=[],d;this.setOutputVertexId=function(e){h=e};this.addEdge=function(e){m.push(e)};this.addVertex=function(e){c.push(e)};
this.getVertexes=function(){return c};this.setPreviewConfig=function(e){d=e};this.toJsonObject=function(){for(var e={},k=[],a=[],b=0,f=m.length;b<f;b++)k.push(m[b].toJsonObject());b=0;for(f=c.length;b<f;b++)a.push(c[b].toJsonObject());e.edges=k;e.vertexes=a;e.outputVertexId=h;e.previewConfig=d?d.toJsonObject():null;return e};this.appendVertexAfter=function(e,k){if(null!=e&&null!=k){a:{for(var a=0;a<m.length;a++){var b=m[a];if(b.getFromId()==e.getId()){a=b.getToId();for(b=0;b<c.length;b++){var f=c[b];
if(a==f.getId()){b=f;break a}}break}}b=null}a=null;for(f=0;f<m.length;f++){var g=m[f];if(g.getFromId()==e.getId()){a=g;break}}b?(b.getConfig&&(f=b.getConfig(),f.affectByPrevNode&&(f=f.getConfigCopy(),f.affectByPrevNode(e.getId(),k.getId()),b.setConfig(f))),f=new Ka,f.setFromId(k.getId()),f.setToId(b.getId()),m.push(f)):h=k.getId();e=new Ka(e.getId(),k.getId());m.push(e);c.push(k);k=m.indexOf(a);-1<k&&m.splice(k,1)}}}function Va(){var h,m,c,d;this.isExtractAllData=function(){return c};this.isPreviewAllData=
function(){return d};this.getExtractCount=function(){return h};this.setExtractCount=function(e){h=e};this.getPreviewCount=function(){return m};this.setPreviewCount=function(e){m=e};this.setExtractAllData=function(e){c=e};this.setPreviewAllData=function(e){d=e};this.setPreviewPartlyDataMode=function(e,k,a){h=k;m=a;c=e};this.setPreviewPartlyDataMode=function(e,k,a,b){h=k;m=a;c=e;d=b};this.setPreviewAllDataMode=function(){d=c=!0};this.backup=function(){var e=new Va;e.setExtractCount(h);e.setPreviewCount(m);
e.setExtractAllData(c);e.setPreviewAllData(d);return e};this.toJsonObject=function(){var e={};e.extractCount=c?Va.ALL_DATA_NUMBER:h;e.previewCount=d?Va.ALL_DATA_NUMBER:m;return e}}function Ka(h,m){var c=h,d=m;this.setFromId=function(e){c=e};this.getFromId=function(){return c};this.setToId=function(e){d=e};this.getToId=function(){return d};this.toJsonObject=function(){var e={};e.fromId=c;e.toId=d;return e}}function Wa(){var h=this,m,c;this.setId=function(d){m=d};this.getId=function(){return m};this.toJsonObject=
function(){var d={};d.id=m;d.type=c;h.protectedToJson(d);return d};this.protectedToJson=function(d){};this.protectedMethod={setType:function(d){c=d}}}function lb(){Wa.call(this);var h,m,c;this.protectedMethod.setType(Wa.TYPE_SOURCE);this.setTable=function(d){h=d};this.setSource=function(d){m=d};this.setSelectedFields=function(d){c=d};this.protectedToJson=function(d){d.table=h.toJsonObject();d.source=m.toJsonObject();if(c){for(var e=[],k=0;k<c.length;k++)e.push(c[k].toJsonObject());d.selectedFields=
e}}}function Eb(){Wa.call(this);var h;this.setConfig=function(m){h=m};this.getConfig=function(){return h};this.protectedToJson=function(m){m.config=h.toJsonObject()}}function Qb(){Eb.call(this);this.protectedMethod.setType(Wa.TYPE_TRANSFORM_FIELD_SELECT)}function Tb(){Eb.call(this);this.protectedMethod.setType(Wa.TYPE_TRANSFORM_FIELD_SETTING)}function ab(){Eb.call(this);this.protectedMethod.setType(Wa.TYPE_TRANSFORM_GROUP_BY)}function Cb(){Eb.call(this);this.protectedMethod.setType(Wa.TYPE_TRANSFORM_CUSTOM_GROUP)}
function Fb(){Eb.call(this);this.protectedMethod.setType(Wa.TYPE_TRANSFORM_JOIN)}function Ya(){Eb.call(this);this.protectedMethod.setType(Wa.TYPE_TRANSFORM_FILTER)}function kb(){Eb.call(this);this.protectedMethod.setType(Wa.TYPE_TRANSFORM_COLUMN_TO_ROW)}function Z(){Eb.call(this);this.protectedMethod.setType(Wa.TYPE_TRANSFORM_SORT)}function ha(){Eb.call(this);this.protectedMethod.setType(Wa.TYPE_TRANSFORM_CALCULATED_FIELD)}function hb(){Eb.call(this);this.protectedMethod.setType(Wa.TYPE_TRANSFORM_UNION)}
function Mb(){var h=[],m,c,d=[];this.isValid=function(){return m};this.getCases=function(){return d};this.getCheckedNodeIds=function(){return h};this.isModelEmpty=function(){return c};this.fromJsonObject=function(e){m=e.valid;h=e.nodeIds;c=e.modelIsEmpty;if(e=e.cases){d=[];for(var k=new Nb,a=0;a<e.length;a++){var b=e[a],f=k.getInvalidityCase(b.type);b&&(f.fromJsonObject(b),d.push(f))}}}}function Nb(){this.getInvalidityCase=function(h){switch(h){case T.TYPE_MULTI_OUTPUT:return new q;case T.TYPE_LACK_OUTPUT:return new H;
case T.TYPE_INVALID_CONFIG:return new P;case T.TYPE_LACK_INPUT:return new va;case T.TYPE_INVALID_UPWARDNODE:return new Za;case T.TYPE_INVALID_SOURCE:return new Ca;case T.TYPE_TABLE_NO_FIELD:return new bb;case T.TYPE_TABLE_NO_AUTHORITY:return new La;case T.TYPE_MODEL_DELETED:return new ma;case T.TYPE_MODEL_NO_DATA_PERMISSION:return new ra;case T.TYPE_MODEL_INCOMPLETE:return new ta;case T.TYPE_MODEL_DAMAGE:return new db;case T.TYPE_MODEL_CYCLE_REFERENCE:return new fb;case T.TYPE_INCOMPLETE_MATERIALIZED_CONFIG:return new Lb}}}
function T(){var h,m=this;this.getType=function(){return h};this.fromJsonObject=function(c){h=c.type;m.protectedFromJsonObject(c)};this.protectedFromJsonObject=function(c){}}function q(){T.call(this);var h=[];this.protectedFromJsonObject=function(m){h=m.outputNodes};this.getOutputNodeIds=function(){return h}}function H(){T.call(this)}function P(){T.call(this);var h;this.protectedFromJsonObject=function(m){h=m.nodeIds};this.getNodeIds=function(){return h}}function La(){T.call(this);var h;this.protectedFromJsonObject=
function(m){h=m.nodeIds};this.getNodeIds=function(){return h}}function ma(){T.call(this);var h;this.protectedFromJsonObject=function(m){h=m.nodeIds};this.getNodeIds=function(){return h}}function ra(){T.call(this);var h;this.protectedFromJsonObject=function(m){h=m.nodeIds};this.getNodeIds=function(){return h}}function ta(){T.call(this);var h;this.protectedFromJsonObject=function(m){h=m.nodeIds};this.getNodeIds=function(){return h}}function db(){T.call(this);var h;this.protectedFromJsonObject=function(m){h=
m.nodeIds};this.getNodeIds=function(){return h}}function fb(){T.call(this);var h,m;this.protectedFromJsonObject=function(c){h=c.nodeIds;m=c.cycleRefModelNames};this.getNodeIds=function(){return h};this.getCycleRefModelNames=function(){return m}}function va(){T.call(this);var h;this.protectedFromJsonObject=function(m){h=m.nodeIds};this.getNodeIds=function(){return h}}function Za(){T.call(this);var h;this.protectedFromJsonObject=function(m){h=m.nodeIds};this.getNodeIds=function(){return h}}function Ca(){T.call(this);
var h;this.protectedFromJsonObject=function(m){h=m.nodeIds};this.getNodeIds=function(){return h}}function bb(){T.call(this);var h;this.protectedFromJsonObject=function(m){h=m.nodeIds};this.getNodeIds=function(){return h}}function Lb(){T.call(this)}function Ua(){var h,m=[],c=[];this.getField=function(d){return m[d]};this.getAllField=function(){return m};this.getColumnCount=function(){return m?m.length:0};this.getOneRow=function(d){return c[d]};this.getRowCount=function(){return c?c.length:0};this.getNodeId=
function(){return h};this.fromJsonObject=function(d){for(var e=d.fields,k=0;k<e.length;k++){var a=new w;a.fromJsonObject(e[k]);m.push(a)}c=d.data;h=d.nodeId};this.toJsonObject=function(){var d={};d.data=c;d.nodeId=h;for(var e=[],k=0;k<m.length;k++)e.push(m[k].toJsonObject());d.fields=e;return d}}function ib(){var h=ib.TYPE_ONCE,m=ib.STRATEGY_FULL,c,d;this.setType=function(e){if(e===ib.TYPE_ONCE||e===ib.TYPE_TIMING)h=e;else throw Error("IllegalArgument: "+e);};this.getType=function(){return h};this.setStrategy=
function(e){if(e===ib.STRATEGY_FULL||e===ib.STRATEGY_INCREMENTAL)m=e;else throw Error("IllegalArgument: "+e);};this.getStrategy=function(){return m};this.setSchedule=function(e){c=e};this.getSchedule=function(){return c};this.setBasedFields=function(e){d=e};this.getBasedFields=function(){return d};this.copy=function(){var e=new ib;e.setType(h);e.setStrategy(m);c&&e.setSchedule(c.copy());if(d){for(var k=[],a=0;a<d.length;a++)k.push(d[a].copy());e.setBasedFields(k)}return e};this.toJsonObject=function(){var e=
{};e.type=h;e.strategy=m;c&&(e.schedule=c.toJsonObject());if(d){for(var k=[],a=0;a<d.length;a++)k.push(d[a].toJsonObject());e.basedFields=k}return e};this.fromJsonObject=function(e){h=e.type;m=e.strategy;e.schedule&&(c=new L,c.fromJsonObject(e.schedule));if(e=e.basedFields){d=[];for(var k=0;k<e.length;k++){var a=new ob;a.fromJsonObject(e[k]);d.push(a)}}};this.equals=function(e){if(e instanceof ib){if(h!==e.getType()||m!==e.getStrategy())return!1;var k=e.getSchedule();if(c&&!k||!c&&k)return!1;if(c&&
k){var a=c.toJsonObject();k=k.toJsonObject();for(var b in a)if(a[b]!==k[b])return!1}e=e.getBasedFields();if(!d&&!e)return!0;if(!d||!e||d.length!==e.length)return!1;for(a=0;a<d.length;a++)if(!d[a].equals(e[a]))return!1;return!0}return!1}}function ob(){var h,m,c,d;this.setTableId=function(e){h=e};this.getTableId=function(){return h};this.setTableName=function(e){m=e};this.getTableName=function(){return m};this.setName=function(e){c=e};this.getName=function(){return c};this.setAlias=function(e){d=e};
this.getAlias=function(){return d};this.copy=function(){var e=new ob;e.setTableId(h);e.setTableName(m);e.setName(c);e.setAlias(d);return e};this.toJsonObject=function(){var e={};e.tableId=h;e.tableName=m;e.name=c;e.alias=d;return e};this.fromJsonObject=function(e){h=e.tableId;m=e.tableName;c=e.name;d=e.alias};this.equals=function(e){return e instanceof ob?h===e.getTableId()&&m===e.getTableName()&&c===e.getName()&&d===e.getAlias():!1}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&
(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var Y=com.kingdee.bos.qing.modeler.designer;Y.QingModeler=function(){var h;this.setModelerModel=function(m){h=m};this.getModelerModel=function(){return h};this.toJsonObject=
function(){var m={};m.modelerModel=h.toJsonObject();return m};this.fromJsonObject=function(m){(m=m.modelerModel)&&m.type==oa.TYPE_TABLE_MODELER&&(h=new xa,h.fromJsonObject(m))}};Y.ModelerModel=oa;Y.Table=Ra;Y.DesignTimeSource=qa;Y.Integration=function(){var h,m,c,d,e,k=!0;this.setMapTableException=function(a){e=a};this.getMapTableException=function(){return e};this.setMapSourceType=function(a){d=a};this.getMapSourceType=function(){return d};this.setMapSourcePermission=function(a){c=a};this.getMapSourcePermission=
function(){return c};this.setModelName=function(a){h=a};this.getModelName=function(){return h};this.setModelDesc=function(a){m=a};this.getModelDesc=function(){return m};this.setModelIsValid=function(a){k=a};this.isValidModel=function(){return k}};Y.Page=cb;Y.TableModeler=xa;Y.Config=fa;Y.JoinConfig=M;Y.FilterConfig=F;Y.FilterItem=x;Y.UnionConfig=D;Y.FieldSettingConfig=G;Y.NodeItem=jb;Y.UnionItem=Sa;Y.UnionInnerItem=rb;Y.ColumnToRowConfig=Aa;Y.ColumnToRowItem=za;Y.SortConfig=U;Y.SortItem=ba;Y.GroupFieldItem=
Ia;Y.AggregateFieldItem=Oa;Y.TableNode=wb;Y.FieldSelectNode=Db;Y.FieldSettingNode=ub;Y.JoinNode=Ha;Y.GroupByNode=xb;Y.CustomGroupNode=yb;Y.SortNode=Na;Y.FilterNode=Hb;Y.ColumnToRowNode=Ea;Y.CalculatedFieldNode=wa;Y.UnionNode=Ob;Y.CalculatedField=Xa;Y.Field=w;Y.CustomGroupConfig=O;Y.NumberGroupItem=Ga;Y.PreviewConfig=Va;Y.ModelerValidity=Mb;Y.LackInputNodeCase=va;Y.InvalidConfigCase=P;Y.InvalidUpwardNodeCase=Za;Y.AbstractInvalidityCase=T;Y.InvalidSourceCase=Ca;Y.TableNoFieldCase=bb;Y.TableNoAuthorityCase=
La;Y.ModelDeletedCase=ma;Y.ModelNoDataPermissionCase=ra;Y.ModelInCompleteCase=ta;Y.ModelDamageCase=db;Y.ModelCycleReferenceCase=fb;Y.ExecuteResult=function(){var h,m=[],c,d,e;this.getNodeId=function(){return h};this.getValidity=function(){return d};this.getPreviewData=function(){return c};this.getFields=function(){return m};this.getTimestamp=function(){return e};this.fromJsonObject=function(k){h=k.nodeId;e=k.timestamp;var a=k.validity;a&&(d=new Mb,d.fromJsonObject(a));if(a=k.previewData)c=new Ua,
c.fromJsonObject(a);if(k=k.fields)for(a=0;a<k.length;a++){var b=k[a],f=new w;f.fromJsonObject(b);m.push(f)}}};Y.UserSQL=Ma;Y.FieldValues=function(){var h=[];this.setValues=function(m){h=m};this.getValues=function(){return h};this.fromJsonObject=function(m){(m=m.fieldValues)&&(h=m.values)}};Y.MaterializedConfig=ib;Y.BasedField=ob;Y.PreviewData=Ua;Y.PreviewResult=function(){var h,m,c,d,e;this.getPreviewData=function(){return h};this.getTotalRowCount=function(){return c};this.getJobId=function(){return d};
this.getJobName=function(){return e};this.getModelerValidity=function(){return m};this.fromJsonObject=function(k){k.modelerValidity?m=k.modelerValidity:(h=new Ua,h.fromJsonObject(k.previewData),d=k.jobId,e=k.jobName,c=k.totalRowCount)}};var gb,W,L;(function(){var h=com.kingdee.bos.qing.common;gb=h.RelativePeriodModel;h=com.kingdee.bos.qing.common.ui;W=h.RelativePeriodPanel;h=com.kingdee.bos.qing.schedule;L=h.QingSchedule})();Y.ModelConverter=new function(){var h=this;this.convertToRuntimeModel=function(e,
k){var a=new sa,b=[],f=[k];c(e,k,f,b);for(var g=0,l=b.length;g<l;g++){var n=b[g];n=new Ka(n.getFromId(),n.getToId());a.addEdge(n)}g=0;for(l=f.length;g<l;g++){var p=void 0;b=e;n=f[g];if(n instanceof wb){p=new lb;p.setId(n.getId());var u=n.getTableUid();u=b.getTable(u);var E=u.getSourceUid();E=b.getSource(E);p.setTable(u);p.setSource(E);p.setSelectedFields(h.getSelectedFieldsWhenSelectAll(b,n));b=p}else{switch(n.getType()){case fa.TYPE_FIELD_SELECT:p=new Qb;break;case fa.TYPE_FIELD_SETTING:p=new Tb;
break;case fa.TYPE_GROUP_BY:p=new ab;break;case fa.TYPE_CUSTOM_GROUP:p=new Cb;break;case fa.TYPE_JOIN:p=new Fb;break;case fa.TYPE_FILTER:p=new Ya;break;case fa.TYPE_COLUMN_TO_ROW:p=new kb;break;case fa.TYPE_SORT:p=new Z;break;case fa.TYPE_CALCULATED_FIELD:p=new ha;break;case fa.TYPE_UNION:p=new hb}p?(p.setId(n.getId()),p.setConfig(n.getConfig()),b=p):b=void 0}b&&a.addVertex(b)}a.setOutputVertexId(k.getId());k=a.getVertexes();b=e.getAllNodes();e=[];f={};for(g=0;g<k.length;g++)for(l=k[g],n=0;n<b.length;n++)if(p=
b[n],u=p.getFieldSettingConfig(),p.getId()==l.getId()&&u){e.push(l);f[p.getId()]=u;break}for(g=0;g<e.length;g++)l=e[g],k=new Tb,k.setId(l.getId()+"FIELDSETTING"),k.setConfig(f[l.getId()]),a.appendVertexAfter(l,k);return a};this.getUpwardNode=function(e,k,a){var b=[];!a&&b.push(k);c(e,k,b);return b};this.getDownwardNode=function(e,k,a){var b=[];!a&&b.push(k);d(e,k,b);return b};this.getUpDownwardNode=function(e,k,a){return m(e,k,a)};this.getLinkableNodes=function(e,k){k=m(e,k);var a=e.getAllNodes();
if(a.length==k.length)return[];for(var b=[],f=0;f<a.length;f++){for(var g=a[f],l=!1,n=0;n<k.length;n++)if(k[n].getId()==g.getId()){l=!0;break}l||(l=e.getRelatedLine(g,xa.GET_LINE_STRATEGY_OUT))&&0!=l.length||b.push(g)}return b};var m=function(e,k,a){var b=[];!a&&b.push(k);c(e,k,b);d(e,k,b);return b};this.getOutputNode=function(e,k){for(var a=e.getRelatedLine(k,xa.GET_LINE_STRATEGY_OUT);0<a.length;)k=e.getNode(a[0].getToId()),a=e.getRelatedLine(k,xa.GET_LINE_STRATEGY_OUT);return k};var c=function(e,
k,a,b){k=e.getRelatedLine(k,xa.GET_LINE_STRATEGY_IN);for(var f=0,g=k.length;f<g;f++){var l=k[f];b&&b.push(l);l=e.getNode(l.getFromId());a.push(l);c(e,l,a,b)}},d=function(e,k,a){k=e.getRelatedLine(k,xa.GET_LINE_STRATEGY_OUT);for(var b=0,f=k.length;b<f;b++){var g=e.getNode(k[b].getToId());a.push(g);d(e,g,a)}};this.treatAsSameNode=function(e,k){return e==k||e+"FIELDSETTING"==k||e==k+"FIELDSETTING"?!0:!1};this.getSelectedFieldsWhenSelectAll=function(e,k){var a=k.getSelectedFields();if(a)return a;a=[];
e=e.getFieldNumberMap();e=Object.keys(e);for(var b=0;b<e.length;b++){var f=e[b],g=f.split("_");if(!(2>g.length)&&(g=g[0],g==k.getId())){var l=new w;l.setFromNode(g);l.setName(f.substring(g.length+1));a.push(l)}}return a}};oa.TYPE_TABLE_MODELER="table";oa.TYPE_RELATION_MODELER="relation";oa.TYPE_METRIC_MODELER="metric";oa.KEY_UPDATE_TABLE="update_table";oa.KEY_PAGE_SIZE="page_change_size";oa.KEY_ADD_PREPARED_SOURCE="add_prepared_source";oa.KEY_REMOVE_PREPARED_SOURCE="remove_prepared_source";oa.KEY_SET_PREPARED_SOURCE=
"set_prepared_source";oa.KEY_TABLE_NODE_SELECT_FIELD="table_node_select_field";xa.KEY_ADD_NODE="page_add_node";xa.KEY_REMOVE_NODE="page_remove_node";xa.KEY_LINK_NODE="page_link_node";xa.KEY_BREAK_LINK="page_break_link";xa.KEY_NODE_CHANGE_POSITION="node_change_position";xa.KEY_ADD_LINE="page_add_line";xa.KEY_REMOVE_LINE="page_remove_line";xa.KEY_NODE_CHANGE_ALIAS="node_change_alias";xa.KEY_NODE_RELAYOUT="node_relayout";xa.KEY_CHANGE_TRANSFORM_CONFIG="change_transform_config_";xa.KEY_TRANSFORM_JOIN=
xa.KEY_CHANGE_TRANSFORM_CONFIG+"join";xa.KEY_TRANSFORM_SELECT_FIELD=xa.KEY_CHANGE_TRANSFORM_CONFIG+"select_field";xa.KEY_TRANSFORM_FIELD_SETTING=xa.KEY_CHANGE_TRANSFORM_CONFIG+"field_setting";xa.KEY_TRANSFORM_FILTER=xa.KEY_CHANGE_TRANSFORM_CONFIG+"filter";xa.KEY_TRANSFORM_COLUMN_TO_ROW=xa.KEY_CHANGE_TRANSFORM_CONFIG+"column_to_row";xa.KEY_TRANSFORM_SORT=xa.KEY_CHANGE_TRANSFORM_CONFIG+"sort";xa.KEY_TRANSFORM_GROUP_BY=xa.KEY_CHANGE_TRANSFORM_CONFIG+"group_by";xa.KEY_TRANSFORM_CALCULATED_FIELD=xa.KEY_CHANGE_TRANSFORM_CONFIG+
"calculated_field";xa.KEY_TRANSFORM_CUSTOM_GROUP=xa.KEY_CHANGE_TRANSFORM_CONFIG+"custom_group";xa.KEY_TRANSFORM_UNION=xa.KEY_CHANGE_TRANSFORM_CONFIG+"union";xa.KEY_CHANGE_FIELD_NUMBER="change_field_number";xa.GET_LINE_STRATEGY_IN=1;xa.GET_LINE_STRATEGY_OUT=16;xa.GET_LINE_STRATEGY_ALL=17;Y.TableNodeFactory=new function(){this.createTableNode=function(h){var m=new wb;m.setId(Y.UIDHelper.getUID(Y.UIDHelper.NS_NODE));m.setTableUid(h.getUid());return m}};Y.TransformNodeFactory=new function(){this.createTransformNode=
function(h){switch(h){case fa.TYPE_FIELD_SELECT:h=new Db;h.setConfig(new ea);break;case fa.TYPE_FIELD_SETTING:h=new ub;h.setConfig(new G);break;case fa.TYPE_FILTER:h=new Hb;h.setConfig(new F);break;case fa.TYPE_COLUMN_TO_ROW:h=new Ea;h.setConfig(new Aa);break;case fa.TYPE_SORT:h=new Na;h.setConfig(new U);break;case fa.TYPE_GROUP_BY:h=new xb;h.setConfig(new Pa);break;case fa.TYPE_CALCULATED_FIELD:h=new wa;h.setConfig(new Ta);break;case fa.TYPE_CUSTOM_GROUP:h=new yb;h.setConfig(new O);break;case fa.TYPE_JOIN:h=
new Ha;h.setConfig(new M);break;case fa.TYPE_UNION:h=new Ob;h.setConfig(new D);break;default:h=new Db}h.setId(Y.UIDHelper.getUID(Y.UIDHelper.NS_NODE));return h}};qb.TYPE_TABLE="table";qb.TYPE_TRANSFORM="transform";fa.TYPE_FIELD_SELECT="field_select";fa.TYPE_FIELD_SETTING="field_setting";fa.TYPE_FILTER="filter";fa.TYPE_COLUMN_TO_ROW="column_to_row";fa.TYPE_SORT="sort";fa.TYPE_GROUP_BY="group_by";fa.TYPE_CALCULATED_FIELD="calculated_field";fa.TYPE_CUSTOM_GROUP="custom_group";fa.TYPE_JOIN="join";fa.TYPE_UNION=
"union";O.NUMBER="NUMBER";O.STRING="STRING";Y.CustomGroupFactory=new function(){this.createGroupByFieldType=function(h,m){h===O.STRING?(h=new ca,h.setName(m.name),m.members&&h.setMembers(m.members)):(h=new N,h.setName(m.name));return h}};Ga.COMPARE_GREATER="GREATER";Ga.COMPARE_GREATER_EQUAL="GREATER_EQUAL";Ga.COMPARE_LESS="LESS";Ga.COMPARE_LESS_EQUAL="LESS_EQUAL";Y.DateGroupType=new function(){var h=com.kingdee.bos.qing.framework.common.MultilanguageManager.createPackageAccessor(Y);this.dateTypeTextConvert=
function(m){switch(m){case Y.DateGroupType.YEAR:m=h.get("year","\u5e74");break;case Y.DateGroupType.QUARTER:m=h.get("quarter","\u5b63\u5ea6");break;case Y.DateGroupType.MONTH:m=h.get("month","\u6708");break;case Y.DateGroupType.DAY:m=h.get("day","\u65e5");break;case Y.DateGroupType.YEAR_QUARTER:m=h.get("yearQuarter","\u5e74\u5b63");break;case Y.DateGroupType.YEAR_MONTH:m=h.get("yearMonth","\u5e74\u6708");break;case Y.DateGroupType.YEAR_MONTH_DAY:m=h.get("yearMonthDay","\u5e74\u6708\u65e5");break;
default:throw Error("Unknown DateType: "+m);}return m}};Y.DateGroupType.YEAR="YEAR";Y.DateGroupType.QUARTER="QUARTER";Y.DateGroupType.MONTH="MONTH";Y.DateGroupType.DAY="DAY";Y.DateGroupType.YEAR_QUARTER="YEAR_QUARTER";Y.DateGroupType.YEAR_MONTH="YEAR_MONTH";Y.DateGroupType.YEAR_MONTH_DAY="YEAR_MONTH_DAY";Oa.SUM="SUM";Oa.AVG="AVG";Oa.MAX="MAX";Oa.MIN="MIN";Oa.COUNT="COUNT";Oa.DISTINCT_COUNT="DISTINCT_COUNT";Y.CalculateByDateType=new function(){var h=com.kingdee.bos.qing.framework.common.MultilanguageManager.createPackageAccessor(Y);
this.calculateByDateTextConvert=function(m){switch(m){case Y.CalculateByDateType.LAST_PERIOD_VALUE:m=h.get("lastPeriodValue","\u4e0a\u671f\u503c");break;case Y.CalculateByDateType.LAST_PERIOD_RATIO:m=h.get("lastPeriodRatio","\u73af\u6bd4\u589e\u957f\u7387");break;case Y.CalculateByDateType.SAME_PERIOD_LAST_YEAR_VALUE:m=h.get("samePeriodLastYearValue","\u53bb\u5e74\u540c\u671f\u503c");break;case Y.CalculateByDateType.SAME_PERIOD_LAST_YEAR_RATIO:m=h.get("samePeriodLastYearRatio","\u540c\u6bd4\u589e\u957f\u7387");
break;case Y.CalculateByDateType.RUNNINGSUM:m=h.get("runningSum","\u7d2f\u8ba1");break;case Y.CalculateByDateType.RUNNINGSUMY:m=h.get("runningSumY","\u5e74\u5185\u7d2f\u8ba1");break;case Y.CalculateByDateType.RUNNINGSUMQ:m=h.get("runningSumQ","\u5b63\u5ea6\u5185\u7d2f\u8ba1");break;case Y.CalculateByDateType.RUNNINGSUMM:m=h.get("runningSumM","\u6708\u5185\u7d2f\u8ba1");break;default:throw Error("Unknown calculateByDateType: "+m);}return m}};Y.CalculateByDateType.LAST_PERIOD_VALUE="LP_V";Y.CalculateByDateType.LAST_PERIOD_RATIO=
"LP";Y.CalculateByDateType.SAME_PERIOD_LAST_YEAR_VALUE="SPLY_V";Y.CalculateByDateType.SAME_PERIOD_LAST_YEAR_RATIO="SPLY";Y.CalculateByDateType.RUNNINGSUM="RS";Y.CalculateByDateType.RUNNINGSUMY="RSY";Y.CalculateByDateType.RUNNINGSUMQ="RSQ";Y.CalculateByDateType.RUNNINGSUMM="RSM";M.TYPE_INNER_JOIN="innerJoin";M.TYPE_LEFT_JOIN="leftJoin";M.TYPE_RIGHT_JOIN="rightJoin";M.TYPE_FULL_JOIN="fullJoin";x.REG_NUMBER=/^-?\d+(\.\d+)?$/;x.REG_DATETIME=/^-?\d+(\.\d+)?$/;x.COMPARE_EQUAL="EQUAL";x.COMPARE_NOT_EQUAL=
"NOT_EQUAL";x.COMPARE_GREATER="GREATER";x.COMPARE_GREATER_EQUAL="GREATER_EQUAL";x.COMPARE_LESS="LESS";x.COMPARE_LESS_EQUAL="LESS_EQUAL";x.COMPARE_INCLUDE="INCLUDE";x.COMPARE_NOT_INCLUDE="NOT_INCLUDE";x.COMPARE_START_WITH="START_WITH";x.COMPARE_END_WITH="END_WITH";x.COMPARE_NULL="NULL";x.COMPARE_NOT_NULL="NOT_NULL";x.COMPARE_IN="IN";x.COMPARE_NOT_IN="NOT_IN";x.COMPARE_RELATIVE_DATE_RANGE="RELATIVE_DATE_RANGE";x.LOGIC_AND="AND";x.LOGIC_OR="OR";x.COMPARES_FOR_STRING=[x.COMPARE_EQUAL,x.COMPARE_NOT_EQUAL,
x.COMPARE_INCLUDE,x.COMPARE_NOT_INCLUDE,x.COMPARE_START_WITH,x.COMPARE_END_WITH,x.COMPARE_NULL,x.COMPARE_NOT_NULL,x.COMPARE_IN,x.COMPARE_NOT_IN];x.COMPARES_FOR_ENUM=[x.COMPARE_EQUAL,x.COMPARE_NOT_EQUAL,x.COMPARE_NULL,x.COMPARE_NOT_NULL,x.COMPARE_IN,x.COMPARE_NOT_IN];x.COMPARES_FOR_NUMBER=[x.COMPARE_EQUAL,x.COMPARE_NOT_EQUAL,x.COMPARE_GREATER,x.COMPARE_GREATER_EQUAL,x.COMPARE_LESS,x.COMPARE_LESS_EQUAL,x.COMPARE_NULL,x.COMPARE_NOT_NULL,x.COMPARE_IN,x.COMPARE_NOT_IN];x.COMPARES_FOR_DATETIME=[x.COMPARE_RELATIVE_DATE_RANGE,
x.COMPARE_EQUAL,x.COMPARE_NOT_EQUAL,x.COMPARE_GREATER,x.COMPARE_GREATER_EQUAL,x.COMPARE_LESS,x.COMPARE_LESS_EQUAL,x.COMPARE_NULL,x.COMPARE_NOT_NULL];x.COMPARES_FOR_BOOLEAN=[x.COMPARE_EQUAL,x.COMPARE_NOT_EQUAL,x.COMPARE_NULL,x.COMPARE_NOT_NULL];x.isCompareOpWithoutValue=function(h){return h==x.COMPARE_NULL||h==x.COMPARE_NOT_NULL};x.isCompareOpWithinOrNotWithinValue=function(h){return h==x.COMPARE_IN||h==x.COMPARE_NOT_IN};x.isCompareOpRelativeDateRangeValue=function(h){return h==x.COMPARE_RELATIVE_DATE_RANGE};
x.getSelectableCompares=function(h,m){switch(h){case w.DT_STRING:return m?x.COMPARES_FOR_ENUM:x.COMPARES_FOR_STRING;case w.DT_NUMBER:case w.DT_INT:return x.COMPARES_FOR_NUMBER;case w.DT_DATE:case w.DT_DATETIME:return x.COMPARES_FOR_DATETIME;case w.DT_BOOLEAN:return x.COMPARES_FOR_BOOLEAN;default:throw Error("Unknown DataType");}};x.FiltersCheckingResult=function(h,m){var c=m;this.getFiltersErrorRow=function(){return h};this.getPrompt=function(){return c};this.setPrompt=function(d){c=d}};ba.ORDER_ASC=
"ASC";ba.ORDER_DESC="DESC";w.DT_BOOLEAN="BOOLEAN";w.DT_INT="INT";w.DT_NUMBER="NUMBER";w.DT_DATE="DATE";w.DT_DATETIME="DATETIME";w.DT_STRING="STRING";w.ROUND_MODE_UP="ROUND_UP";w.ROUND_MODE_DOWN="ROUND_DOWN";w.ROUND_MODE_HALF_UP="ROUND_HALF_UP";w.BOOLEAN_TRUE="true";w.BOOLEAN_FALSE="false";w.EXTENSION_BIZ_FIELD_ENUM_KEY="bizFieldEnumKey";w.EXTENSION_IS_MUL_BASE_DATA="isMulBaseData";w.EXTENSION_IS_PK="isPK";w.EXTENSION_SOURCE_FIELD_ALIAS="sourceFieldAlias";Y.UIDHelper=new function(){var h,m={};this.init=
function(b){m={};h=b;d();e();k();a()};this.getUID=function(b){var f=m[b];f||(f=0);f+=1;m[b]=f;return b+f};var c=function(b,f,g){for(var l=0,n=0;n<f.length;n++)for(var p=g(f[n]),u=0;u<p.length;u++){var E=p[u];l=Math.max(l,parseInt(E.slice(b.length,E.length)))}m[b]=l},d=function(){var b=h.getAllNodes();b&&c(Y.UIDHelper.NS_NODE,b,function(f){var g=[];g.push(f.getId());f instanceof wb||(f=f.getNodeIdInConfig(),g=g.concat(f));return g})},e=function(){var b=h.getAllSource();b&&c(Y.UIDHelper.NS_SOURCE,b,
function(f){return[f.getId()]})},k=function(){var b=h.getAllTable(!0);b&&c(Y.UIDHelper.NS_TABLE,b,function(f){return[f.getUid()]})},a=function(){var b=h.getAllLines();b&&c(Y.UIDHelper.NS_LINE,b,function(f){return[f.getId()]})}};Y.UIDHelper.NS_NODE="n";Y.UIDHelper.NS_LINE="l";Y.UIDHelper.NS_TABLE="t";Y.UIDHelper.NS_SOURCE="s";Va.ALL_DATA_NUMBER=-1;Wa.TYPE_SOURCE="source";Wa.TYPE_TRANSFORM_FIELD_SELECT="field_select";Wa.TYPE_TRANSFORM_FIELD_SETTING="field_setting";Wa.TYPE_TRANSFORM_GROUP_BY="group_by";
Wa.TYPE_TRANSFORM_CUSTOM_GROUP="custom_group";Wa.TYPE_TRANSFORM_FILTER="filter";Wa.TYPE_TRANSFORM_COLUMN_TO_ROW="column_to_row";Wa.TYPE_TRANSFORM_SORT="sort";Wa.TYPE_TRANSFORM_JOIN="join";Wa.TYPE_TRANSFORM_CALCULATED_FIELD="calculated_field";Wa.TYPE_TRANSFORM_UNION="union";T.TYPE_MULTI_OUTPUT="multiOutput";T.TYPE_LACK_OUTPUT="lackOutputNode";T.TYPE_INVALID_CONFIG="invalidConfig";T.TYPE_LACK_INPUT="lackInputNode";T.TYPE_INVALID_UPWARDNODE="invalidUpwardNode";T.TYPE_INVALID_SOURCE="invalidSource";T.TYPE_TABLE_NO_FIELD=
"tableNoField";T.TYPE_TABLE_NO_AUTHORITY="tableNoAuthority";T.TYPE_DBCONNECTION_FAIL="DBConnectionFail";T.TYPE_DBSOURCE_NO_AUTHORITY="DBSourceNoAuthority";T.TYPE_SOURCE_NOT_EXISTS="sourceNotExists";T.TYPE_TABLE_NOT_EXISTS="tableNotExists";T.TYPE_MODEL_DELETED="modelDeleted";T.TYPE_MODEL_NO_DATA_PERMISSION="modelNoDataPermission";T.TYPE_MODEL_INCOMPLETE="modelInComplete";T.TYPE_MODEL_DAMAGE="modelDamage";T.TYPE_MODEL_CYCLE_REFERENCE="modelCycleReference";T.TYPE_INCOMPLETE_MATERIALIZED_CONFIG="incompleteMaterializedConfig";
ib.TYPE_ONCE="once";ib.TYPE_TIMING="timing";ib.STRATEGY_FULL="full";ib.STRATEGY_INCREMENTAL="incremental";Y.ENTITY_SEPARATOR="@#!&@"})();(function(){function oa(){var qb,wb,Ab,Vb,Db;this.setFromTable=function(ub){qb=ub};this.getFromTable=function(){return qb};this.setFromProperty=function(ub){Ab=ub};this.getFromProperty=function(){return Ab};this.setToTable=function(ub){wb=ub};this.getToTable=function(){return wb};this.setToProperty=function(ub){Vb=ub};this.getToProperty=function(){return Vb};this.setRelated=function(ub){Db=ub};this.getRelated=function(){return Db};this.fromJsonObject=function(ub){qb=ub.fromModel;wb=ub.toModel;Ab=
ub.fromField;Vb=ub.toField;Db=ub.related};this.toJsonObject=function(ub){ub={};ub.fromModel=qb;ub.toModel=wb;ub.fromField=Ab;ub.toField=Vb;ub.related=Db;return ub}}function xa(){var qb=this,wb,Ab,Vb;this.setUid=function(Db){wb=Db};this.getUid=function(){return wb};this.setId=function(Db){Vb=Db};this.getId=function(){return Vb};this.getSourceType=function(){return Ab};this.fromJsonObject=function(Db){wb=Db.id;Ab=Db.type;qb.protectedFromJsonObject(Db)};this.toJsonObject=function(){var Db={};Db.type=
Ab;Db.id=wb;qb.protectedToJsonObject(Db);return Db};this.protectedToJsonObject=function(Db){};this.protectedFromJsonObject=function(Db){};this.protectedMethod={setSourceType:function(Db){Ab=Db}}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==
typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var eb=com.kingdee.bos.qing.modeler.designer;eb.AbstractModelerSource=xa;eb.ModelSetDataSource=function(){var qb,wb,Ab,Vb,Db,ub,Hb;this.getErrorMessage=function(){return Hb};this.getSpecificType=function(){return ub};this.getSourceName=function(){return qb};this.setSourceName=function(Ea){qb=Ea};this.getId=function(){return wb};this.setId=function(Ea){wb=Ea};this.setCreatorName=function(Ea){Ab=Ea};this.getCreatorName=
function(){return Ab};this.setCreateTime=function(Ea){Vb=Ea};this.getCreateTime=function(){return Vb};this.setSourceType=function(Ea){Db=Ea};this.getSourceType=function(){return Db};this.fromJsonObject=function(Ea){wb=Ea.id;qb=Ea.sourceName;Db=Ea.sourceType;Vb=Ea.createTime;Ab=Ea.creatorName;var Na=Ea.source;Db===xa.SOURCE_TYPE_PUBLIC_DATA_SOURCE&&"DB"===Na.sourceType?ub=Na.publicSourceType:Db===xa.SOURCE_TYPE_MODELSET_DB_SOURCE&&Na.dbType?ub=Na.dbType:Db===xa.SOURCE_TYPE_MODELSET_FILE_SOURCE&&Na.fileType&&
(ub=Na.fileType);Ea.errorMessage&&(Hb=Ea.errorMessage)}};eb.Meta=function(){var qb,wb,Ab,Vb,Db;this.setTableNode=function(ub){qb=ub};this.getTableNode=function(){return qb};this.setPropertyMap=function(ub){wb=ub};this.getPropertyMap=function(){return wb};this.setSourceType=function(ub){Ab=ub};this.getSourceType=function(){return Ab};this.setRelations=function(ub){Vb=ub};this.getRelations=function(){return Vb};this.setErrorMap=function(ub){Db=ub};this.getErrorMap=function(){return Db};this.fromJsonObject=
function(ub){qb=ub.tableNode;if(wb=ub.propertiesMap)for(var Hb in wb){var Ea=wb[Hb];if(Ea&&0<Ea.length){for(var Na=[],xb=0;xb<Ea.length;xb++){var yb=new cb,wa=Ea[xb];yb.fromJsonObject(Ea[xb]);wa.number&&yb.setName(wa.number);Na.push(yb)}wb[Hb]=Na}}Ab=ub.sourceType;if((Hb=ub.relations)&&0<Hb.length)for(Vb=[],xb=0;xb<Hb.length;xb++)Ea=new oa,Ea.fromJsonObject(Hb[xb]),Vb.push(Ea);Db=ub.errorMap}};var cb=eb.Field;oa.R_1_1="From1To1";oa.R_1_N="From1ToN";oa.R_N_1="FromNTo1";oa.KFW_FROM=1;oa.KFW_TO=2;oa.KEY_FROM_ENTITY=
"fromEntity";oa.KEY_FROM_PROPERTY="fromProperty";oa.KEY_FROM_PROPERTY_ALIAS_CHANED="fromPropertyAliasChanged";oa.KEY_TO_PROPERTY_ALIAS_CHANED="toPropertyAliasChanged";oa.KEY_TO_ENTITY="toEntity";oa.KEY_TO_PROPERTY="toProperty";oa.KEY_RELATED="related";xa.SOURCE_TYPE_PUBLIC_DATA_SOURCE="PublicDBSource";xa.SOURCE_TYPE_CURRENT_ENTITY_SOURCE="ERPCloudEntity";xa.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE="ERPCloudDBCenter";xa.SOURCE_TYPE_MODELSET_FILE_SOURCE="FileSource";xa.SOURCE_TYPE_MODELSET_DB_SOURCE="DBSource";
xa.SOURCE_TYPE_MODEL_SET_SOURCE="ModelSet";xa.SOURCE_TYPE_OPEN_API_SOURCE="OpenAPI"})();(function(){function oa(ja,fa,Ja,ea){qb.call(this,ja,fa,Ja,ea);var G=this.protectedMethod;this.loadAlternativeSource=function(O){G.remote("loadAlternativeSource",{sourceType:O})};this.loadTables=function(O){O={source:JSON.stringify(O.toJsonObject()),needFilterMetric:!0};G.remote("loadTables",O)};this.checkKSQLSupport=function(O,ya){G.remote("checkKSQLSupport",{sourceId:O,namespace:ya})};this.getMeta=function(O,ya){O={source:JSON.stringify(O.toJsonObject()),table:JSON.stringify(ya.toJsonObject())};
G.remote("getMeta",O)};this.getFieldInfo=function(O){O={model:JSON.stringify(O.toJsonObject()),timestamp:(new Date).getTime()};G.remote("getFieldInfo",O)};this.getPreviewData=function(O){O={model:JSON.stringify(O.toJsonObject())};G.remote("getPreviewData",O)};this.getFieldValues=function(O,ya){O={model:JSON.stringify(O.toJsonObject()),fields:JSON.stringify(ya)};G.remote("getFieldValues",O)};this.checkModelerValid=function(O){O={model:JSON.stringify(O)};G.remote("checkModelerValid",O)};this.checkNodeValid=
function(O){O={model:JSON.stringify(O.toJsonObject())};G.remote("checkNodeValid",O)};this.getDBCenterTables=function(O){G.remote("getDBCenterTables",{appNumber:O})};this.checkUserSqlSourcePermission=function(O){G.remote("checkUserSqlSourcePermission",{sourceId:O})};this.checkConnection=function(O){G.remote("checkConnection",{sourceId:O})};this.checkUserSqlExecutable=function(O,ya,ka,ca){G.remote("checkUserSqlExecutable",{sourceId:ka,sqlType:O,sqlContent:ya,namespace:ca})};this.checkFormula=function(O,
ya,ka,ca,N){O={checking:JSON.stringify({name:O,fromNode:ya,formula:ka,fields:ca,calculatedFields:N})};G.remote("checkFormula",O)};this.checkAllFormula=function(O,ya){O={checking:JSON.stringify({fields:O,calculatedFields:ya})};G.remote("checkAllFormula",O)};this.exportModelResult=function(O,ya,ka,ca){O={jobId:O,jobName:ya,totalRowCount:ka,model:JSON.stringify(ca)};G.remote("exportModelResult",O)};this.checkReferencedModel=function(O,ya,ka){O={source:JSON.stringify(O.toJsonObject()),table:JSON.stringify(ya.toJsonObject()),
modelId:ka};G.remote("checkReferencedModel",O)};this.getFirstPageResultData=function(O,ya){O={model:JSON.stringify(O),previewConfig:JSON.stringify(ya.toJsonObject())};G.remote("getFirstPageResultData",O)};this.updateResultDataByPage=function(O,ya,ka,ca){G.remote("updateResultDataByPage",{jobId:O,jobName:ya,startIndex:ka,pageSize:ca})};this.getTotalRowCount=function(O,ya){G.remote("getTotalRowCount",{jobId:O,jobName:ya})};this.deleteResultDataFile=function(O,ya){G.remote("deleteResultDataFile",{jobId:O,
jobName:ya})};this.cronExpression=function(O){G.remote("cronExpression",{cron:O})};this.checkDataWarehouseConfig=function(){G.remote("checkDataWarehouseConfig",{})};this.checkModelSetSourceConnect=function(O){G.remote("checkModelSetSourceConnect",{sourceId:O})}}function xa(ja,fa){this.getX=function(){return ja};this.getY=function(){return fa};this.isOnLeft=function(Ja){return Ja.getX()>ja};this.isOnRight=function(Ja){return Ja.getX()<ja};this.isAbove=function(Ja){return Ja.getY()>fa};this.isBelow=
function(Ja){return Ja.getY()<fa}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var eb=com.kingdee.bos.qing.modeler.designer;eb.DesignerFacade=oa;eb.RemoteImpl=
function(){wb.call(this);var ja;this.getRemoteUrl=function(){return ja};this.setRemoteUrl=function(fa){ja=fa}};eb.RectCutLineLayoutHelper=function(ja){function fa(){var N=[],Ga=!1;this.isBetween=function(Qa,Ia){return 0<N.length?N[0]==Qa&&N[N.length-1]==Ia:!1};this.getLength=function(){return N.length};this.setEnd=function(Qa){Ga=Qa};this.isEnd=function(){return Ga};this.addRect=function(Qa){N.push(Qa)};this.getAllRect=function(){return N};this.getLastRect=function(){if(0<N.length)return N[N.length-
1]};this.generateLinePath=function(Qa,Ia){if(0==N.length)return null;var Oa=N[N.length-1];if(!N[0].isInRect(Qa)||!Oa.isInRect(Ia))return null;Oa=[];Oa.push(Qa);for(var M=1;M<N.length;M++){var C=Oa,F=C.push;a:{var x=Oa[Oa.length-1],Aa=N[M-1],za=N[M];var U=x.getX();x=x.getY();Aa=Aa.getOverlapLineSegment(za);if(Aa.isHorizontal()){if(U>Aa.getStartX()&&U<Aa.getEndX()){U=new xa(U,Aa.getStartY());break a}}else if(x>Aa.getStartY()&&x<Aa.getEndY()){U=new xa(Aa.getStartX(),x);break a}U=Aa.getMidPoint()}F.call(C,
U)}Oa.push(Ia);Ia=[];Ia.push(Qa);for(M=1;M<Oa.length;M++){x=Oa[M-1];var ba=Oa[M];Qa=N[M-1];U=[];za=x.getX();Aa=x.getY();F=ba.getX();C=ba.getY();Qa.isOnBorder(x)&&Qa.isOnBorder(ba)?(x=Qa.getPositionRelation(x,ba),x==Ja.POSITION_RELATION_ADJACENT_SIDE?(U=za,za=Qa,Qa=new xa(F,Aa),za.isOnBorder(Qa)&&(Qa=new xa(U,C)),za=[],za.push(new xa(U,Aa)),za.push(Qa),za.push(new xa(F,C)),U=za):x==Ja.POSITION_RELATION_SAME_SIDE?(U=za,x=Qa,U==F?(ba=Math.min(10,x.getWidth()>>1),za=new xa(U-ba,Aa),Qa=new xa(F-ba,C),
x.isInRect(za)&&x.isInRect(Qa)||(za=new xa(U+ba,Aa),Qa=new xa(U+ba,C))):(ba=Math.min(10,x.getHeight()>>1),za=new xa(U,Aa-ba),Qa=new xa(F,C-ba),x.isInRect(za)&&x.isInRect(Qa)||(za=new xa(U,Aa+ba),Qa=new xa(F,C+ba))),x=[],x.push(new xa(U,Aa)),x.push(za),x.push(Qa),x.push(new xa(F,C)),U=x):za==F||Aa==C?(U.push(new xa(za,Aa)),U.push(new xa(F,C))):U=Pa(za,Aa,F,C,Qa)):za==F||Aa==C?(U.push(new xa(za,Aa)),U.push(new xa(F,C))):U=Pa(za,Aa,F,C,Qa);Qa=U;Qa.splice(0,1);Ia=Ia.concat(Qa)}Oa=Ia;M=[];for(Ia=0;Ia<
Oa.length;Ia++){Qa=Oa[Ia];C=M.length;if(F=1<C)F=M[C-2],U=M[C-1],Aa=Qa,F=F.getX()==U.getX()&&U.getX()==Aa.getX()||F.getY()==U.getY()&&U.getY()==Aa.getY()?!0:!1;F&&M.splice(C-1,1);M.push(Qa)}return M};this.clone=function(){for(var Qa=new fa,Ia=0;Ia<N.length;Ia++)Qa.addRect(N[Ia]);return Qa};var Pa=function(Qa,Ia,Oa,M,C){var F=Qa+Oa>>1,x=[];x.push(new xa(Qa,Ia));var Aa=new xa(F,Ia);F=new xa(F,M);if(C.isOnBorder(Aa)||C.isOnBorder(F))Ia=Ia+M>>1,Aa=new xa(Qa,Ia),F=new xa(Oa,Ia);x.push(Aa);x.push(F);x.push(new xa(Oa,
M));return x}}function Ja(N,Ga,Pa,Qa){var Ia=this;this.isInRect=function(M){var C=M.getX();M=M.getY();return C>=N.getX()&&M>=N.getY()&&C>=Pa.getX()&&M<=Pa.getY()&&C<=Ga.getX()&&M>=Ga.getY()&&C<=Qa.getX()&&M<=Qa.getY()?!0:!1};this.isAdjoin=function(M){return null!=Ia.getOverlapLineSegment(M)};this.getOverlapLineSegment=function(M){var C=[];Ia.isOnBorder(M.getLeftTop())&&Oa(C,M.getLeftTop());Ia.isOnBorder(M.getRightTop())&&Oa(C,M.getRightTop());Ia.isOnBorder(M.getLeftBottom())&&Oa(C,M.getLeftBottom());
Ia.isOnBorder(M.getRightBottom())&&Oa(C,M.getRightBottom());M.isOnBorder(N)&&Oa(C,N);M.isOnBorder(Ga)&&Oa(C,Ga);M.isOnBorder(Pa)&&Oa(C,Pa);M.isOnBorder(Qa)&&Oa(C,Qa);return 2>C.length?null:new ea(C[0],C[1])};this.getBoundMidPoint=function(M){return(M=Ia.getOverlapLineSegment(M))?M.getMidPoint():null};var Oa=function(M,C){for(var F=!1,x=0;x<M.length;x++){var Aa=M[x];if(Aa.getX()==C.getX()&&Aa.getY()==C.getY()){F=!0;break}}F||M.push(C)};this.isOnBorder=function(M){return-1<Ia.getBorderIndex(M)};this.getWidth=
function(){return Ga.getX()-N.getX()};this.getHeight=function(){return Qa.getY()-Ga.getY()};this.getPositionRelation=function(M,C){M=Ia.getBorderIndex(M);C=Ia.getBorderIndex(C);C=Math.abs(M-C);if(0==C)return Ja.POSITION_RELATION_SAME_SIDE;if(1==C||3==C)return Ja.POSITION_RELATION_ADJACENT_SIDE;if(2==C)return Ja.POSITION_RELATION_OPPOSITE_SIDE};this.getOverlap=function(M){var C=M.getLeftTop(),F=M.getRightTop(),x=M.getLeftBottom();M=M.getRightBottom();C=new xa(Math.max(N.getX(),C.getX()),Math.max(N.getY(),
C.getY()));F=new xa(Math.min(Ga.getX(),F.getX()),Math.max(Ga.getY(),F.getY()));x=new xa(Math.max(Pa.getX(),x.getX()),Math.min(Pa.getY(),x.getY()));M=new xa(Math.min(Qa.getX(),M.getX()),Math.min(Qa.getY(),M.getY()));x=new Ja(C,F,x,M);return x.isValid()?x:null};this.isValid=function(){return N.isOnLeft(Ga)&&N.getY()==Ga.getY()&&Pa.isOnLeft(Qa)&&Pa.getY()==Qa.getY()&&N.isAbove(Pa)&&N.getX()==Pa.getX()&&Ga.isAbove(Qa)&&Ga.getX()==Ga.getX()?!0:!1};this.getLeftTop=function(){return N};this.getRightTop=
function(){return Ga};this.getLeftBottom=function(){return Pa};this.getRightBottom=function(){return Qa};this.getBorderIndex=function(M){var C=M.getX();M=M.getY();return M==N.getY()&&C>=N.getX()&&C<=Ga.getX()?0:C==Ga.getX()&&M>=Ga.getY()&&M<=Qa.getY()?1:M==Qa.getY()&&C>=Pa.getX()&&C<=Qa.getX()?2:C==N.getX()&&M>=N.getY()&&M<=Pa.getY()?3:-1}}function ea(N,Ga){this.getStartX=function(){return Math.min(N.getX(),Ga.getX())};this.getEndX=function(){return Math.max(N.getX(),Ga.getX())};this.getStartY=function(){return Math.min(N.getY(),
Ga.getY())};this.getEndY=function(){return Math.max(N.getY(),Ga.getY())};this.getMidPoint=function(){return new xa(N.getX()+Ga.getX()>>1,N.getY()+Ga.getY()>>1)};this.isHorizontal=function(){return N.getY()==Ga.getY()};this.isVertical=function(){return N.getX()==Ga.getX()}}var G,O,ya,ka;this.getLinePathCoordinate=function(N,Ga){try{G=N;O=Ga;var Pa=G.getX()+G.getWidth(),Qa=G.getY()+(G.getHeight()>>1),Ia=O.getX(),Oa=O.getY()+(O.getHeight()>>1);ya=new xa(Pa,Qa);ka=new xa(Ia,Oa);ya.getX();ya.getY();ka.getX();
ka.getY();var M=Math.min(O.getX(),G.getX())-50,C=Math.max(O.getX()+O.getWidth(),G.getX()+G.getWidth())+50,F=Math.min(O.getY(),G.getY())-50,x=Math.max(O.getY()+O.getHeight(),G.getY()+O.getHeight())+50;var Aa=new xa(M,F);var za=new xa(C,F);var U=new xa(M,x);var ba=new xa(C,x);var Ta=[new Ja(Aa,za,U,ba)],Xa=ja.getAllNodes();for(N=0;N<Xa.length;N++){Ga=void 0;var D=Xa[N];Pa=Ta;Qa=[];var jb=D.getX(),Sa=D.getY(),rb=D.getWidth(),Ra=D.getHeight(),Ma=new xa(jb,Sa),qa=new xa(jb+rb,Sa),w=new xa(jb,Sa+Ra),sa=
new xa(jb+rb,Sa+Ra);Ga=new Ja(Ma,qa,w,sa);for(Ia=0;Ia<Pa.length;Ia++){Oa=Qa;var Va=Oa.concat;var Ka=Pa[Ia],Wa=Ka.getOverlap(Ga);if(Wa){Aa=[];var lb=Ka.getLeftTop(),Eb=Ka.getRightTop(),Qb=Ka.getLeftBottom(),Tb=Ka.getRightBottom(),ab=Wa.getLeftTop(),Cb=Wa.getRightTop(),Fb=Wa.getLeftBottom(),Ya=Wa.getRightBottom();if(lb.isOnLeft(ab)){var kb=lb,Z=new xa(ab.getX(),lb.getY()),ha=Qb,hb=new xa(ab.getX(),Qb.getY()),Mb=new Ja(kb,Z,ha,hb);Aa.push(Mb)}lb.isAbove(ab)&&(kb=new xa(ab.getX(),lb.getY()),Z=Eb,ha=ab,
hb=new xa(Tb.getX(),Cb.getY()),Mb=new Ja(kb,Z,ha,hb),Aa.push(Mb));Eb.isOnRight(Cb)&&(kb=Cb,Z=new xa(Eb.getX(),Cb.getY()),ha=new xa(Ya.getX(),Tb.getY()),Mb=new Ja(kb,Z,ha,Tb),Aa.push(Mb));Qb.isBelow(Ya)&&(kb=Fb,Z=Ya,ha=new xa(Fb.getX(),Qb.getY()),hb=new xa(Ya.getX(),Tb.getY()),Mb=new Ja(kb,Z,ha,hb),Aa.push(Mb));var Nb=Aa}else Nb=[Ka];Qa=Va.call(Oa,Nb)}Ta=Qa}var T=Ta;console.log("passable rect:"+T.length);var q,H;for(Ta=0;Ta<T.length;Ta++){var P=T[Ta];P.isInRect(ya)&&(q=P);P.isInRect(ka)&&(H=P)}if(q&&
H&&q!=H){P=H;var La=new fa;La.addRect(q);H=[];ca(La,T,q,P,H);if(0==H.length)var ma=null;else{T=[];for(Ta=0;Ta<H.length;Ta++){var ra=H[Ta].generateLinePath(ya,ka),ta=ra.length;T.push(ra);if(void 0==fb){var db=Ta;var fb=ta}else ta<fb&&(db=Ta,fb=ta)}ma=T[db]}}else ma=null;return ma}catch(va){return null}};var ca=function(N,Ga,Pa,Qa,Ia){for(var Oa=N.getLastRect(),M=N.getAllRect(),C=[],F=0;F<Ga.length;F++){var x=Ga[F];-1<M.indexOf(x)||x!=Oa&&Oa.isAdjoin(x)&&C.push(x)}if(0!=C.length)if(-1<C.indexOf(Qa))N.addRect(Qa),
Ia.push(N);else for(Oa=0;Oa<C.length;Oa++)M=C[Oa],F=N.clone(),F.addRect(M),ca(F,Ga,Pa,Qa,Ia)};Ja.POSITION_RELATION_SAME_SIDE="same_side";Ja.POSITION_RELATION_ADJACENT_SIDE="adjacent_side";Ja.POSITION_RELATION_OPPOSITE_SIDE="opposite_side"};eb.Coordinate=xa;var cb,qb,wb,Ab,Vb,Db,ub,Hb,Ea,Na,xb,yb,wa,Q,Ha;(function(){var ja=com.kingdee.bos.qing.framework.common;cb=ja.AbstractIcons;qb=ja.AbstractFacade;wb=ja.AbstractRemoteCall;Ab=ja.MultilanguageManager.createPackageAccessor(eb);ja=com.kingdee.bos.qing.common;
Vb=ja.RelativePeriodModel;ja=com.kingdee.bos.qing.ui.component;Db=ja.SimpleConfirmer;ub=ja.MessageDialog;Hb=eb.Field;Ea=eb.ModelerModel;Na=eb.TableModeler;xb=eb.TableNode;yb=eb.Meta;wa=eb.PreviewConfig;Q=eb.ExecuteResult;Ha=eb.FilterItem})();eb.Icons=new function(){cb.call(this);var ja=this.protectedMethod,fa;this.setComboIconImpl=function(G){fa=G};this.protectedInit=function(G,O){if(!fa)throw Error("qing modeler comboIcon not found.");fa.define(O,"designer");O.setIconSize(16,16);Ja(0,0,"edit");Ja(0,
1,"delete");Ja(0,2,"add");Ja(0,3,"zoomIn");Ja(0,4,"zoomOut");Ja(0,5,"layout");Ja(0,6,"rightArrow");Ja(0,7,"leftArrow");Ja(0,8,"upArrow");Ja(0,9,"downArrow");ea(0,10,"qingWarning");ea(0,11,"relation");ea(0,12,"qingTable");Ja(0,13,"expanded");Ja(0,14,"expand");ea(0,15,"btn_edit");ea(1,12,"qingTableWhite");ea(1,13,"expandTriangle");ea(1,14,"collapseTriangle");ea(1,16,"checkMark");ea(0,19,"reset");Ja(0,18,"moveUp");Ja(0,20,"createDim");Ja(0,21,"publicDimension");O.setStartPosition(84,35);ea(0,0,"select_field");
ea(0,1,"field_setting");ea(0,2,"join");ea(0,3,"union");ea(0,4,"filter");ea(0,5,"sort");ea(0,6,"group_by");ea(0,7,"calculated_field");ea(0,11,"column_to_row");O.setStartPosition(84,52);ea(0,0,"entity-sub");ea(0,1,"entity-entry");ea(0,2,"unlock");ea(0,3,"lock_by_other");ea(0,4,"lock_by_me");O.setIconSize(20,20);O.setStartPosition(0,35);ea(0,0,"leftJoin");ea(0,1,"rightJoin");ea(0,2,"innerJoin");ea(0,3,"fullJoin");O.setStartPosition(238,35);O.setIconSize(32,32);ea(0,0,"metric_icon");O.setStartPosition(288,
35);O.setIconSize(16,16);ea(0,1,"custom_group");O.setStartPosition(0,55);O.setIconSize(20,20);Ja(0,0,"setting");ea(0,1,"warning");O.setIconSize(18,18);O.setStartPosition(43,55);Ja(0,0,"preview");O.setIconSize(60,80);O.setStartPosition(0,98);ea(0,0,"no_source");O.setIconSize(138,78);O.setStartPosition(240,240);ea(0,0,"no_data_cloud");O.setIconSize(253,140);O.setStartPosition(62,71);ea(0,0,"drag_node_prompt");O.setIconSize(210,170);O.setStartPosition(0,211);ea(0,0,"no_node_and_source");fa.define(O,
"source");O.setStartPosition(0,20);O.setIconSize(16,16);ea(0,0,"entity");ea(0,1,"data");ea(0,2,"modelSet");ea(0,3,"file");ea(0,4,"data-center");ea(0,5,"table");ea(0,6,"openapi");ea(0,8,"KSQL");ea(0,9,"SQL");O.setStartPosition(85,-1);O.setIconSize(16,16);ea(0,0,"table_selected");ea(0,3,"KSQL_selected");ea(0,4,"SQL_selected");O.setStartPosition(101,0);ea(0,0,"f7");O.setStartPosition(0,40);O.setIconSize(20,20);O.setGap(0,1);ea(0,0,"modelset-source-icon");ea(0,1,"mysql");ea(0,2,"datacenter-source-icon");
ea(0,3,"entity-source-icon");ea(0,4,"oracle");ea(0,5,"postgresql");ea(0,6,"sqlserver");ea(0,7,"greenplum");ea(0,8,"access");ea(0,9,"db2");ea(0,10,"odps");ea(0,11,"sparksql");ea(1,1,"redshift");ea(1,2,"apachedrill");ea(1,3,"hive");ea(1,4,"impala");ea(1,5,"kylin");ea(1,6,"dm");ea(1,7,"gaussdb");ea(1,8,"sybaseiq");ea(1,9,"sqlite");ea(1,10,"sybase");ea(2,2,"doris");ea(2,3,"hana");O.setGap(0,0);ea(1,0,"excel");ea(2,0,"txt");ea(2,1,"csv");ea(1,11,"xml");ea(2,4,"kingbase");ea(2,5,"tdsql");ea(2,6,"gbase");
ea(2,7,"vastbase");ea(2,8,"yashandb");ea(2,9,"openapi-source-icon");ea(2,10,"tidb");O.setStartPosition(120,-1);O.setIconSize(16,16);Ja(0,0,"refresh");O.setStartPosition(5,110);O.setIconSize(120,93);ea(0,0,"no-permission");O.setStartPosition(100,100);O.setIconSize(138,84);ea(0,0,"search-no-result");fa.define(O,"metatree");O.setGap(1);O.setStartPosition(1,1);O.setIconSize(16,16);ea(0,0,"DATE");ea(0,1,"STRING");ea(0,5,"TABLE");ea(0,8,"DATETIME");ea(0,9,"BOOLEAN");ea(0,10,"NUMBER");ea(0,11,"INT");ea(1,
0,"DATE_hover");ea(1,1,"STRING_hover");ea(1,5,"TABLE_hover");ea(1,8,"DATETIME_hover");ea(1,9,"BOOLEAN_hover");ea(1,10,"NUMBER_hover");ea(1,11,"INT_hover")};var Ja=function(G,O,ya){ea(G,O,ya+"_hover");ea(G+1,O,ya)},ea=function(G,O,ya){ja.registIcon(G,O,ya)}};eb.PropDataTypeUtil=new function(){this.getDataTypeDesc=function(ja){switch(ja){case Hb.DT_STRING:ja=Ab.get("text","\u6587\u672c");break;case Hb.DT_NUMBER:ja=Ab.get("number","\u6570\u503c");break;case Hb.DT_INT:ja=Ab.get("integer","\u6574\u6570");
break;case Hb.DT_DATE:ja=Ab.get("dataTypeDate","\u65e5\u671f");break;case Hb.DT_DATETIME:ja=Ab.get("dateTime","\u65e5\u671f\u65f6\u95f4");break;case Hb.DT_BOOLEAN:ja=Ab.get("bool","\u5e03\u5c14");break;default:ja=""}return ja}};eb.FieldNumberHelper=new function(){var ja;this.init=function(G){ja=G};this.generateDefaultNumber=function(G,O){if(!ja)throw Error("uninitialized");for(var ya=ja.getFieldNumberMap(),ka=0;ka<G.length;ka++){var ca=G[ka].getFullName();ya[ca]||fa(G[ka],null,!1,!1,O)}};this.generateDefaultNumberByAssignedName=
function(G,O,ya,ka){if(!ja)throw Error("uninitialized");fa(G,O,ya,ka)};this.getFieldNumber=function(G){if(!ja)throw Error("uninitialized");return ja.getFieldNumberMap()[G.getFullName()]};this.clearInvalidNumber=function(G,O){if(G&&O&&0!=O.length){var ya=ja.getFieldNumberMap();ya=Object.keys(ya);for(var ka=[],ca=0;ca<ya.length;ca++){var N=ya[ca],Ga=G.getId();if(0==N.indexOf(Ga+"_")){Ga=!1;for(var Pa=0;Pa<O.length;Pa++)if(O[Pa].getFullName()==N){Ga=!0;break}Ga||ka.push(N)}}for(ca=0;ca<ka.length;ca++)ja.removeFieldNumberByFullName(ka[ca])}};
this.getFieldNumberByFullName=function(G){if(!ja)throw Error("uninitialized");return ja.getFieldNumberMap()[G]};this.removeFieldNumberByFullName=function(G){if(!ja)throw Error("uninitialized");ja.removeFieldNumberByFullName(G)};this.removeFieldNumberIfFieldNotExist=function(G,O){if(O){G||O();var ya=G.split("_");1>ya.length&&O();(ya=ja.getNode(ya[0]))?eb.NodeFieldHelper.asynGetFields(ja,ya,function(ka){for(var ca=!1,N=0;N<ka.length;N++)if(ka[N].getFullName()==G){ca=!0;break}ca||ja.removeFieldNumberByFullName(G);
O(!ca)}):(ja.removeFieldNumberByFullName(G),O(!0))}};this.isDynamicFieldNumber=function(G){return!ja.isNumberManualModified(G)&&(G=ja.getNode(G.getFromNode()))&&G.canGenerateNewField()?!0:!1};this.isNumberManualModified=function(G){return ja.isNumberManualModified(G)};var fa=function(G,O,ya,ka,ca){var N=O?O:G.getName(),Ga=ja.getFieldNumberMap(),Pa=Object.keys(Ga),Qa=!1,Ia=!1;N=Ja(N);for(var Oa=0;Oa<Pa.length;Oa++)if(Pa[Oa]!=G.getFullName()&&Ga[Pa[Oa]]&&N.toLowerCase()==Ga[Pa[Oa]].toLowerCase()){Qa=
!0;Ga=G.getFromNode();Ia=0==Pa[Oa].indexOf(Ga+"_");break}Qa?Ia?(ca=ea(N),ja.addFieldNumberMap(G,ca,ya,ka)):(O=O?O:G.getName(),ca=ca?ca:ja.getNode(G.getSourceNodeId()),ca=eb.DisplayNameHelper.getNodeDisplayName(ca),ca=Ja(ca+"_"+O),ca=ea(ca),ja.addFieldNumberMap(G,ca,ya,ka)):ja.addFieldNumberMap(G,N,ya,ka)},Ja=function(G){G=G.replace(/[^\u3000\u4E00-\u9FA5a-zA-Z0-9_()]/g,"_");com.kingdee.bos.qing.modeler.SpecialWordChecker.isSpecialWord(G)&&(G+="_");G.match(/^([\u3000\u4E00-\u9FA5a-zA-Z_()])/)||(G=
"_"+G);25<G.length&&(G=G.substring(0,25));return G},ea=function(G,O){var ya=G;if(O){var ka=24-(O+"").length;G.length>ka&&(G=G.substring(0,ka));G=G+"_"+O}ka=ja.getFieldNumberMap();for(var ca=Object.keys(ka),N=!1,Ga=0;Ga<ca.length;Ga++)if(G.toLowerCase()==ka[ca[Ga]].toLowerCase()){N=!0;break}return N?ea(ya,O?++O:1):G}};eb.NodeFieldHelper=new function(){var ja=this,fa,Ja,ea,G;this.asynGetFields=function(ca,N,Ga,Pa,Qa){var Ia;if(!(Ia=!N))a:{Ia=eb.ModelConverter.getUpwardNode(Ja,N,!1);for(var Oa=0;Oa<
Ia.length;Oa++)if(ea.isInvalidNode(Ia[Oa].getId())){Ia=!0;break a}Ia=!1}Ia?Ga([]):(Ia=eb.NodeResultCache.getOneNodeField(N.getId()))?Ga(Ia):ya(ca,N,Ga,Pa,Qa)};this.getFieldValues=function(ca,N,Ga,Pa,Qa,Ia){ca=eb.ModelConverter.convertToRuntimeModel(ca,N);ka(ca)?Pa([]):(N=new oa(fa,function(Oa){Pa(Oa.fieldValues)},function(Oa,M){Qa&&Qa();return!1}),Ia?N.setBlockingJqUi(Ia):N.setShowBlocking(!1),N.getFieldValues(ca,Ga))};this.getMeta=function(ca,N,Ga,Pa){if(ea.isInvalidNode(N.getId())){var Qa=ea.getInvalidState(N);
if(!(Qa instanceof com.kingdee.bos.qing.modeler.designer.TableNoFieldState)){ca=new yb;ca.setErrorMap({isValid:!1,message:Qa.getPrompt()});Ga(ca);return}}Qa=ca.getTable(N.getTableUid());ca=ca.getSource(Qa.getSourceUid());(new oa(fa,function(Ia){var Oa=new yb;Oa.fromJsonObject(Ia);Ga(Oa)},function(){Pa&&Pa();return!1})).getMeta(ca,Qa)};this.init=function(ca){Ja&&Ja.removePropertyChangeCallback(O);Ja=ca;Ja.addPropertyChangeCallback(O);eb.FieldNumberHelper.init(Ja)};this.setRemoteImpl=function(ca){fa=
ca};this.setNodeStatusMonitor=function(ca){ea=ca};this.setNodeInvalidCallback=function(ca){G=ca};this.getPreviewData=function(ca,N,Ga){var Pa=(new Date).getTime(),Qa=new oa(fa,function(Ia){var Oa=new Q;Oa.fromJsonObject(Ia);(Ia=Oa.getValidity())?G&&G(Ia,Pa):N&&N(Oa)},function(Ia,Oa){return eb.DppVersionExceptionHandler.handle(Ia)});Ga&&Qa.setBlockingJqUi(Ga);Qa.getPreviewData(ca)};var O=function(ca,N){if(ca==Na.KEY_TRANSFORM_JOIN||ca==Na.KEY_TRANSFORM_COLUMN_TO_ROW||ca==Na.KEY_TRANSFORM_SELECT_FIELD||
ca==Na.KEY_TRANSFORM_FIELD_SETTING||ca==Ea.KEY_TABLE_NODE_SELECT_FIELD||ca==Na.KEY_TRANSFORM_GROUP_BY||ca==Na.KEY_TRANSFORM_CALCULATED_FIELD||ca==Na.KEY_TRANSFORM_CUSTOM_GROUP||ca==Na.KEY_TRANSFORM_UNION||ca==Na.KEY_BREAK_LINK||ca==Na.KEY_LINK_NODE||ca==Na.KEY_ADD_NODE)console.log("clean cache"),ja.clearDownwardNodeCache(N.getId());else if(ca==Ea.KEY_UPDATE_TABLE)for(ca=0;ca<N.length;ca++)console.log("clean the relative cache of userSQL "),ja.clearDownwardNodeCache(N[ca].getId())};this.clearDownwardNodeCache=
function(ca){ca=Ja.getNode(ca);ca=eb.ModelConverter.getDownwardNode(Ja,ca,!1);for(var N=0;N<ca.length;N++)eb.NodeResultCache.removeNodeCache(ca[N].getId())};var ya=function(ca,N,Ga,Pa,Qa){ca=eb.ModelConverter.convertToRuntimeModel(ca,N);if(ka(ca))Ga([]);else{var Ia=(new Date).getTime(),Oa=new oa(fa,function(M){var C=new Q;C.fromJsonObject(M);Ia=C.getTimestamp()?C.getTimestamp():Ia;(M=C.getValidity())?(G&&G(M,Ia),Ga([])):(C=C.getFields(),N instanceof xb&&eb.FieldNumberHelper.clearInvalidNumber(N,C),
eb.FieldNumberHelper.generateDefaultNumber(C),eb.NodeResultCache.cacheOneNodeField(N.getId(),C,Ia),Ga(eb.NodeResultCache.getOneNodeField(N.getId())))},function(M,C){if(eb.DppVersionExceptionHandler.handle(M))return!0;Pa&&Pa();return!1});Qa?Oa.setBlockingJqUi(Qa):Oa.setShowBlocking(!1);Oa.getFieldInfo(ca)}},ka=function(ca){ca=ca.getVertexes();for(var N=0;N<ca.length;N++)if(ea.isInvalidNode(ca[N].getId()))return!0;return!1}};eb.NodeResultCache=new function(){var ja={},fa={},Ja=[],ea={};this.cacheOneNodeField=
function(G,O,ya){if(ya){var ka=fa[G],ca=ea[G];if((!ka||ka<ya)&&(!ca||ca<ya))for(ja[G]=O,ea[G]=void 0,ya=0;ya<Ja.length;ya++)(ka=Ja[ya])&&ka(G,O)}};this.removeNodeCache=function(G){ja[G]=void 0;fa[G]=void 0;ea[G]=(new Date).getTime()};this.getOneNodeField=function(G){return ja[G]};this.addCacheChangeListener=function(G){Ja.push(G)};this.clear=function(){ja={};fa={};ea={}}};eb.LockHelper=new function(){var ja,fa,Ja,ea,G,O,ya,ka,ca=!1;this.show=function(Ga){O=$("<div>");O.addClass("modeler-designer-lock-statusbar");
ya=$("<div>");ka=$("<div>");ka.addClass("modeler-designer-lock-text");ya.addClass("modeler-designer-lock-icon");O.append(ka);O.append(ya);O.appendTo(Ga);O.on("click",N);ca=!0};this.registerLockRequestSender=function(Ga){ea=Ga};this.setGlobal=function(Ga){ja=Ga};this.setLockStateChangeListener=function(Ga){G=Ga};this.setLockInfo=function(Ga,Pa,Qa){if(ca){Ja=Pa;fa=Ga?eb.LockHelper.STATE_LOCK_BY_ME:Pa?eb.LockHelper.STATE_LOCK_BY_OTHER:eb.LockHelper.STATE_UNLOCK;G&&G(fa==eb.LockHelper.STATE_LOCK_BY_ME);
if(!Qa){if(fa==eb.LockHelper.STATE_LOCK_BY_OTHER){var Ia=Ab.get("lockByOtherPrompt","\u5f53\u524d\u6a21\u578b\u5df2\u88ab\u201c#1\u201d\u9501\u5b9a\uff0c\u60a8\u7684\u4fee\u6539\u5c06\u65e0\u6cd5\u4fdd\u5b58\uff0c\u5efa\u8bae\u60a8\u9501\u5b9a\u5f53\u524d\u6a21\u578b\u540e\u518d\u8fdb\u884c\u7f16\u8f91\u3002");Ia=Ia.replace("#1",Ja)}else fa==eb.LockHelper.STATE_UNLOCK&&(Ia=Ab.get("unlockPrompt","\u5f53\u524d\u6a21\u578b\u672a\u9501\u5b9a\uff0c\u4e0d\u53ef\u7f16\u8f91\uff0c\u8bf7\u9501\u5b9a\u6a21\u578b\u540e\u518d\u8fdb\u884c\u64cd\u4f5c"));
Ia?ja.getMessageCurtain().showPrompt(Ia,-1):fa==eb.LockHelper.STATE_LOCK_BY_ME&&ja.getMessageCurtain().showSuccess(Ab.get("lockSuccess","\u60a8\u5df2\u6210\u529f\u9501\u5b9a\u8be5\u6a21\u578b"))}Ga="lock_by_other";if(fa==eb.LockHelper.STATE_UNLOCK){Ga="unlock";var Oa=Ab.get("unlock","\u672a\u9501\u5b9a")}else fa==eb.LockHelper.STATE_LOCK_BY_OTHER?Oa=Ab.get("lockedBy","\u5df2\u88ab\u201c#1\u201d\u9501\u5b9a").replace("#1",Ja):fa==eb.LockHelper.STATE_LOCK_BY_ME&&(Oa=Ab.get("lockedBy","\u5df2\u88ab\u201c#1\u201d\u9501\u5b9a").replace("#1",
Ab.get("me","\u6211")),Ga="lock_by_me");eb.Icons.background(ya,Ga);ka.text(Oa);ka.attr("title",Oa)}};this.setMaxWidth=function(Ga){ka&&ka.css("max-width",Math.max(0,Math.min(Ga-50,250))+"px")};var N=function(){if(ea){var Ga=fa!=eb.LockHelper.STATE_LOCK_BY_ME;if(Ga)ea(Ga);else{var Pa=new Db;Pa.setText(Ab.get("confirmUnlock","\u786e\u5b9a\u8981\u89e3\u9501\u5f53\u524d\u6a21\u578b\uff1f"));Pa.setConfirmedListener(function(Qa){Qa&&ea(Ga)});Pa.show(O)}}}};eb.LockHelper.STATE_LOCK_BY_ME="lock_by_me";eb.LockHelper.STATE_LOCK_BY_OTHER=
"lock_by_other";eb.LockHelper.STATE_UNLOCK="unlock";eb.DppVersionExceptionHandler=new function(){var ja=!1;this.handle=function(fa){if(20001101!=fa)return!1;ja||(ja=!0,fa=ub.createFeedbackDialog(),fa.setMsgImageType(ub.MSG_WARNING),fa.setMessage(Ab.get("dppVersionException","\u8f7b\u5efa\u6a21\u5ba2\u6237\u7aef\u7248\u672c\u4e0e\u6570\u636e\u5904\u7406\u5f15\u64ce\u7248\u672c\u4e0d\u4e00\u81f4\uff0c\u8bf7\u8054\u7cfb\u8fd0\u7ef4\u4eba\u5458\u5347\u7ea7\u5ba2\u6237\u7aef\u6216\u5f15\u64ce\u3002")),
fa.setOptionType(ub.OPTION_OK),fa.setButtonText(ub.RETURN_OK,Ab.get("iSee","\u6211\u77e5\u9053\u4e86")),fa.setClosedAction(function(){ja=!1}),fa.showDialog());return!0}};eb.FilterCheckHelper=new function(){this.checkFilterField=function(Ja,ea){if(!ea)return Ja=Ab.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5"),new Ha.FiltersCheckingResult(-1,Ja);for(var G,O=0;O<Ja.length;O++){var ya=Ja[O];if(!ya.isEmpty()){G=ja(ya,O,ea);if(!G)if(G=O,ya=fa(ya)){var ka=Ab.get("incompleteFilter","\u7b2c#1\u884c\u4e0d\u5b8c\u6574\uff0c");
ka=ka.replace("#1",G+1);G=new Ha.FiltersCheckingResult(G,ka+ya)}else G=null;if(G)break}}return G};this.checkFilterLogical=function(Ja){var ea=0,G=-1,O,ya=0;for(O=0;O<Ja.length;O++)Ja[O].isEmpty()||(ya=O);O=ya;for(ya=0;ya<Ja.length;ya++){var ka=Ja[ya];if(!ka.isEmpty()){ea+=ka.getLeftBracketCount();ea-=ka.getRightBracketCount();0>G&&0!=ea&&(G=ya);if(0>ea)return Ja=Ab.get("bracketMismatch","\u5de6\u53f3\u62ec\u53f7\u4e0d\u5339\u914d\u3002"),new Ha.FiltersCheckingResult(G,Ja);if(ya!=O&&!ka.getLogicOp())return Ja=
Ab.get("lackLogicalSymbol","\u7b2c#1\u884c\u7f3a\u5c11\u903b\u8f91\u7b26"),Ja=Ja.replace("#1",ya+1),new Ha.FiltersCheckingResult(ya,Ja);if(ya==O&&ka.getLogicOp())return Ja=Ab.get("logicalSymbolUnnecessary","\u5b58\u5728\u591a\u4f59\u7684\u903b\u8f91\u3002"),new Ha.FiltersCheckingResult(ya,Ja)}}return 0<ea?(Ja=Ab.get("bracketMismatch","\u5de6\u53f3\u62ec\u53f7\u4e0d\u5339\u914d\u3002"),new Ha.FiltersCheckingResult(G,Ja)):null};this.checkFieldExisted=function(Ja,ea){return ja(Ja,-1,ea)?!1:!0};var ja=
function(Ja,ea,G){Ja=Ja.getField();for(var O=0;O<G.length;O++)if(Ja&&G[O].getFullName()==Ja.getFullName())return null;G=Ab.get("lackField","\u7b2c#1\u884c\u5b57\u6bb5\u4e0d\u5b58\u5728\u3002");G=G.replace("#1",ea+1);return new Ha.FiltersCheckingResult(ea,G)},fa=function(Ja){var ea=Ja.getCompareOp(),G=Ja.getField(),O=Ja.getValue(),ya=G?G.getOutputDataType():null;G=G?G.isEnum():!1;G=Ha.getSelectableCompares(ya,G);Ja=Ja.getRelativeDateRange();if(!ea)return Ab.get("lackComparisonOperator","\u7f3a\u5c11\u6bd4\u8f83\u7b26\u3002");
for(var ka=!1,ca=0;ca<G.length;ca++)if(ea==G[ca]){ka=!0;break}if(!ka)return Ab.get("comparisonMismatch","\u6bd4\u8f83\u7b26\u4e0d\u5339\u914d\u3002");if(!Ha.isCompareOpWithoutValue(ea)){if(!O&&!Ja)return Ab.get("lackValue","\u7f3a\u5c11\u503c\u3002");if(ya==Hb.DT_NUMBER||ya==Hb.DT_INT){if(!Ha.REG_NUMBER.test(O)&&!Ha.isCompareOpWithinOrNotWithinValue(ea))return Ab.get("valueMustBeNum","\u503c\u5fc5\u987b\u4e3a\u6570\u5b57\u3002")}else if(ya==Hb.DT_DATE||ya==Hb.DT_DATETIME)if(Ha.isCompareOpRelativeDateRangeValue(ea)){if(!(Ja instanceof
Vb))return Ab.get("invalidRelativeDateValue","\u65e0\u6548\u7684\u76f8\u5bf9\u65e5\u671f\u503c\u3002")}else{if(!Ha.REG_DATETIME.test(O))return Ab.get("invalidDateValue","\u65e0\u6548\u7684\u65e5\u671f\u503c\u3002")}else if(ya==Hb.DT_BOOLEAN&&O!=Hb.BOOLEAN_TRUE&&O!=Hb.BOOLEAN_FALSE)return Ab.get("wrongBoolean","\u9519\u8bef\u7684\u5e03\u5c14\u503c\u3002")}return null}};eb.SortCheckHelper=new function(){var ja=this;this.checkAllSortItemExist=function(fa,Ja){for(var ea=0;ea<fa.length;ea++)if(!ja.checkOneSortItemExist(fa[ea],
Ja))return!1;return!0};this.checkOneSortItemExist=function(fa,Ja){for(var ea=0;ea<Ja.length;ea++)if(Ja[ea].getFullName()==fa.getTargetFieldFullName())return!0;return!1}};eb.PreviewConfigManager=new function(){var ja=new wa;ja.setPreviewPartlyDataMode(!1,1E3,100);var fa=new wa;fa.setPreviewPartlyDataMode(!1,1E3,100,!1);this.updatePreviewConfig=function(Ja,ea,G){ja.setPreviewPartlyDataMode(Ja,ea,G)};this.updateTrialExecutionConfig=function(Ja,ea,G,O){fa.setPreviewPartlyDataMode(Ja,ea,G,O)};this.getPreviewConfig=
function(){return ja.backup()};this.getTrialExecutionConfig=function(){return fa.backup()};this.getRowCountText=function(){var Ja=ja.isExtractAllData()?Ab.get("extractAllData","\u62bd\u53d6\u5168\u91cf\u6570\u636e\u8fdb\u884c\u8ba1\u7b97, "):Ab.get("onlyExtractSomeRows","\u4ec5\u62bd\u53d6\u524d#1\u884c\u8fdb\u884c\u8ba1\u7b97, ").replace("#1",ja.getExtractCount());return Ja+=Ab.get("previewRows","\u663e\u793a\u8ba1\u7b97\u7ed3\u679c\u7684\u524d#1\u884c\u6570\u636e").replace("#1",ja.getPreviewCount())}};
var Ob=new function(){var ja;this.hookCollector=function(fa){ja=fa};this.occur=function(fa,Ja){try{ja&&ja(fa,Ja)}catch(ea){window.console&&console.warn(ea)}}};Ob.BUTTON_TYPE="button-type";Ob.DATATABLE_MODEL_TRANSFORM_NODE_TYPE="datatable-model-transform-node-type";Ob.ENTER_DATA_AUTH_MANAGE="enter-data-auth-manage";Ob.SAVE="\u4fdd\u5b58";Ob.REFRESH="\u5237\u65b0";Ob.DEPLOY="\u90e8\u7f72";Ob.ROLLBACK_CURRENT_DEPLOY="\u56de\u9000\u5230\u6700\u65b0\u90e8\u7f72\u72b6\u6001";Ob.UNDO="\u64a4\u9500";Ob.REDO=
"\u53cd\u64a4\u9500";Ob.CLEAR="\u6e05\u9664";Ob.MODEL_CHECK="\u6a21\u578b\u6821\u9a8c";Ob.MODEL_PREVIEW="\u6a21\u578b\u9884\u89c8";Ob.MODEL_PROPERTY="\u6a21\u578b\u5c5e\u6027";Ob.SOURCE_MANAGE="\u6570\u636e\u6e90\u7ba1\u7406";Ob.MODEL_PREVIEW_EXPORT_TO_EXCEL="\u9884\u89c8-\u5bfc\u51fa\u5230Excel";Ob.METRIC_DELETE="\u5220\u9664";Ob.ENTER_DATA_AUTH_MANAGE_AFTER_DEPLOY="\u6210\u529f\u90e8\u7f72\u540e\u70b9\u51fb\u8df3\u8f6c\u8fdb\u5165";eb.UserOperationReporter=Ob})();(function(){function oa(){var Ea;this.setCaption=function(Na){Ea=Na};this.getCaption=function(){return Ea?Ea:""};this.perform=function(){throw Error("Override me.");};this.unperform=function(){throw Error("Override me.");}}function xa(){oa.call(this);var Ea=this,Na,xb,yb;this.setMethod=function(wa,Q){Na=wa;xb=Q};this.setValue=function(wa){yb=wa};this.perform=function(){var wa=Na();xb(yb);yb=wa};this.unperform=function(){Ea.perform()}}function eb(){oa.call(this);var Ea,Na,xb,yb,wa,Q;this.getNode=function(){return Ea};
this.getCaption=function(){return Q==eb.TYPE_DATATYPE?wb.get("actionNodeChangeDataType","\u4fee\u6539\u6570\u636e\u7c7b\u578b"):Q==eb.TYPE_ALIAS?wb.get("actionNodeChangeAlias","\u4fee\u6539\u663e\u793a\u540d\u79f0"):wb.get("actionNodeFieldSetting","\u8282\u70b9\u5b57\u6bb5\u8bbe\u7f6e")};this.setValue=function(Ob,ja,fa){Q=fa;Ea=Ob;Na=Ob.getFieldSettingConfig();xb=new Hb;Ob=[];if(Na){fa=Na.getModifiedField();for(var Ja=0;Ja<fa.length;Ja++)fa[Ja].getFullName()!=ja.getFullName()&&Ob.push(fa[Ja])}Ob.push(ja);
xb.setModifiedField(Ob,!0);wa=ja;yb=cb.FieldNumberHelper.getFieldNumber(ja)};this.perform=function(){Ea.setFieldSettingConfig(xb);Ha()};this.unperform=function(){Ea.setFieldSettingConfig(Na);yb&&Ha(yb)};var Ha=function(Ob){Q!=eb.TYPE_DATATYPE&&(Ob=Ob?Ob:wa.getAlias(),cb.FieldNumberHelper.isDynamicFieldNumber(wa)&&Ea.getId()==wa.getFromNode()&&cb.FieldNumberHelper.generateDefaultNumberByAssignedName(wa,Ob,!1))}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==
typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var cb=com.kingdee.bos.qing.modeler.designer;cb.CommandManager=function(){var Ea=[],Na=[],xb=new qb;this.perform=function(Q){Q.perform();yb(Ea,Q);Na.length=0;wa(Q,!0)};this.addPerformedListener=function(Q){xb.addListener(Q)};
this.isCanUndo=function(){return 0<Ea.length};this.isCanRedo=function(){return 0<Na.length};this.undo=function(){var Q=Ea.pop();Q&&(Q.unperform(),yb(Na,Q),wa(Q,!1,!0))};this.redo=function(){var Q=Na.pop();Q&&(Q.perform(),yb(Ea,Q),wa(Q,!1,!1))};this.reset=function(){Ea.length=0;Na.length=0;wa(null)};var yb=function(Q,Ha){Q.push(Ha);32<Q.length&&Q.splice(0,1)},wa=function(Q,Ha,Ob){xb.fireEvent(function(ja){ja(Q,Ha,Ob)})}};cb.ActionSetModel=function(){oa.call(this);var Ea,Na,xb;this.setValue=function(yb,
wa,Q){Na=yb;xb=wa;Ea=Q};this.perform=function(){Ea(xb)};this.unperform=function(){Ea(Na)}};cb.ActionAddSource=function(){oa.call(this);var Ea,Na,xb;this.getCaption=function(){return Ea};this.setValue=function(yb,wa){for(var Q="",Ha=0;Ha<yb.length;Ha++)Q+=yb[Ha].getName(),Ha<yb.length-1&&(Q+="\uff0c");Ea=wb.get("actionAddSource","\u6dfb\u52a0\u6570\u636e\u6e90\u201c#1\u201d").replace("#1",Q);Na=yb;xb=wa};this.perform=function(){xb.batchAddSource(Na)};this.unperform=function(){xb.batchRemoveSource(Na)}};
cb.ActionRemoveSource=function(){oa.call(this);var Ea,Na,xb,yb,wa;this.getCaption=function(){return Ea};this.setValue=function(Q,Ha){Ea=wb.get("actionRemoveSource","\u5220\u9664\u6570\u636e\u6e90\u201c#1\u201d").replace("#1",Q.getName());Na=Q;xb=Ha};this.perform=function(){yb=xb.removeSource(Na);wa=xb.getUserSqlTables(Na.getId());xb.batchRemoveUserSqlTable(Na.getId())};this.unperform=function(){if(-1<yb){xb.insertSource(Na,yb);for(var Q=0;Q<wa.length;Q++)xb.addTable(wa[Q])}}};cb.ActionAddRemoveSource=
function(){oa.call(this);var Ea,Na,xb,yb;this.getCaption=function(){return Ea};this.setValue=function(wa,Q,Ha){Na=Ha.getAllSource();var Ob="",ja="";xb=[];for(var fa=0;fa<Na.length;fa++){var Ja=Na[fa];-1<Q.indexOf(Ja)?(0<ja.length&&(ja+="\uff0c"),ja+=Ja.getName()):xb.push(Ja)}for(fa=0;fa<wa.length;fa++)Q=wa[fa],xb.push(Q),0<Ob.length&&(Ob+="\uff0c"),Ob+=Q.getName();Ea="";0<Ob.length&&(Ea+=wb.get("actionAddSource","\u6dfb\u52a0\u6570\u636e\u6e90\u201c#1\u201d").replace("#1",Ob));0<ja.length&&(0<Ea.length&&
(Ea+="\uff1b"),Ea+=wb.get("actionRemoveSource","\u5220\u9664\u6570\u636e\u6e90\u201c#1\u201d").replace("#1",ja));yb=Ha};this.perform=function(){yb.setSource(xb)};this.unperform=function(){yb.setSource(Na)}};cb.ActionAddTableNode=function(){oa.call(this);var Ea,Na,xb,yb,wa;this.getCaption=function(){if(!yb){var Q=cb.DisplayNameHelper.getNodeDisplayName(Ea);yb=wb.get("actionAddNode","\u65b0\u589e\u8282\u70b9\u201d#1\u201c").replace("#1",Q)}return yb};this.setValue=function(Q,Ha,Ob){Ea=Q;Na=Ha;xb=Ob};
this.perform=function(){if(wa){var Q=wa.getRelativeNode();if(Q){var Ha=wa.getRelativePos(),Ob=Q.getX()+Ha[0];Q=Q.getY()+Ha[1];Ea.setPosition(Ob,Q)}xb.restoreFieldNumber(wa.getFieldNumberMap())}xb.addTable(Na);cb.NodeHelper.addNode(Ea)};this.unperform=function(){wa=cb.NodeHelper.removeNode(Ea)}};cb.ActionAddUserSqlTable=function(){oa.call(this);var Ea,Na,xb,yb,wa;this.getCaption=function(){return Ea};this.setValue=function(Q,Ha,Ob,ja){Na=Ob;xb=Q;xb.getUid();Ha?(yb=Ha,Ea=wb.get("revokeEditSQL","\u7f16\u8f91\u81ea\u5b9a\u4e49SQL/KSQL\u201c#1\u201d")):
Ea=wb.get("revokeCreateSQL","\u65b0\u5efa\u81ea\u5b9a\u4e49SQL/KSQL\u201c#1\u201d");Ea=Ea.replace("#1",Q.getTableName());wa=ja};this.perform=function(){yb?Na.updateTable(xb,yb):Na.addTable(xb);wa&&wa(xb)};this.unperform=function(){yb?Na.updateTable(yb,xb):Na.removeTableIfUseless(xb);wa&&wa(yb)}};cb.ActionRemoveUserSqlTable=function(){oa.call(this);var Ea,Na,xb,yb;this.getCaption=function(){return Ea};this.setValue=function(wa,Q,Ha){Ea=wb.get("revokeDelSQL","\u5220\u9664\u81ea\u5b9a\u4e49SQL/KSQL\u201c#1\u201d");
Ea=Ea.replace("#1",wa.getTableName());Na=Q;xb=Na.getSameTable(wa);yb=Ha};this.perform=function(){Na.removeTableIfUseless(xb)&&yb&&yb(xb)};this.unperform=function(){Na.addTable(xb);yb&&yb(xb)}};cb.ActionAddTransformNode=function(){oa.call(this);var Ea,Na,xb,yb,wa,Q;this.getCaption=function(){if(!yb){var Ha=cb.DisplayNameHelper.getNodeDisplayName(Ea);yb=wb.get("actionAddNode","\u65b0\u589e\u8282\u70b9\u201d#1\u201c").replace("#1",Ha)}return yb};this.setValue=function(Ha,Ob,ja,fa){Ea=Ha;Na=Ob;xb=ja;
Q=fa};this.perform=function(){cb.NodeHelper.addNode(Ea,Na,xb);wa&&Q.restoreFieldNumber(wa.getFieldNumberMap())};this.unperform=function(){wa=cb.NodeHelper.removeNode(Ea)}};cb.ActionRemoveNode=function(){oa.call(this);var Ea,Na,xb,yb;this.getCaption=function(){return yb};this.setValue=function(wa,Q){Ea=wa;Na=Q};this.perform=function(){if(!yb){var wa=cb.DisplayNameHelper.getNodeDisplayName(Ea);yb=wb.get("actionRemoveNode","\u79fb\u9664\u8282\u70b9\u201d#1\u201c").replace("#1",wa)}xb=cb.NodeHelper.removeNode(Ea)};
this.unperform=function(){Na.restoreFieldNumber(xb.getFieldNumberMap());var wa=xb.getRelativeNode();if(wa){var Q=xb.getRelativePos(),Ha=wa.getX()+Q[0];wa=wa.getY()+Q[1];Ea.setPosition(Ha,wa)}Ha=xb.getUpwardNodes();(wa=xb.getRemovedTable())&&Na.addTable(wa);cb.NodeHelper.addNode(Ea,Ha[0],Ha);(Ha=xb.getDownwardNode())&&cb.NodeHelper.linkNode(Ea,Ha)}};cb.ActionLinkNode=function(){oa.call(this);var Ea,Na;this.getCaption=function(){var xb=wb.get("actionLinkNodes","\u8fde\u63a5\u8282\u70b9\u201d#1\u201c\uff0c\u201c#2\u201d");
xb=xb.replace("#1",cb.DisplayNameHelper.getNodeDisplayName(Ea));return xb=xb.replace("#2",cb.DisplayNameHelper.getNodeDisplayName(Na))};this.setValue=function(xb,yb){Ea=xb;Na=yb};this.perform=function(){cb.NodeHelper.linkNode(Ea,Na)};this.unperform=function(){cb.NodeHelper.breakLink(Ea,Na)}};cb.ActionChangeModelInfo=function(){oa.call(this);var Ea,Na,xb,yb,wa;this.getCaption=function(){return wb.get("editModelInfo","\u7f16\u8f91\u6a21\u578b\u5c5e\u6027")};this.setValue=function(Q,Ha,Ob,ja,fa){Ea=
Q;Na=Ha;xb=Ob;yb=ja;wa=fa};this.perform=function(){Ea.setModelName(Na);Ea.setModelDesc(yb)};this.unperform=function(){Ea.setModelName(xb);Ea.setModelDesc(wa)}};cb.ActionMoveNode=function(){oa.call(this);var Ea,Na,xb,yb;this.getCaption=function(){if(!yb){var wa=cb.DisplayNameHelper.getNodeDisplayName(Ea);yb=wb.get("actionMoveNode","\u79fb\u52a8\u8282\u70b9\u201c#1\u201c").replace("#1",wa)}return yb};this.setValue=function(wa,Q){Ea=wa;Na=Q;xb=[Na[0]-Ea.getX(),Na[1]-Ea.getY()]};this.perform=function(){Ea.changePosition(Na[0],
Na[1])};this.unperform=function(){Ea.changePosition(Ea.getX()-xb[0],Ea.getY()-xb[1])}};cb.ActionNodeRename=function(){oa.call(this);var Ea,Na,xb,yb,wa;this.getCaption=function(){wa||(wa=wb.get("actionRenameNode","\u91cd\u547d\u540d\u8282\u70b9\u201d#1\u201c\u4e3a\u201d#2\u201c").replace("#1",yb).replace("#2",Na));return wa};this.setValue=function(Q,Ha){Ea=Q;Na=Ha;xb=Q.getAlias();yb=cb.DisplayNameHelper.getNodeDisplayName(Ea)};this.perform=function(){Ea.setAlias(Na)};this.unperform=function(){Ea.setAlias(xb)}};
cb.ActionChangeConfig=function(){xa.call(this);var Ea;this.setNode=function(Na){Ea=Na};this.getNode=function(){return Ea}};cb.ActionRelayout=function(){oa.call(this);var Ea,Na,xb;this.setValue=function(yb,wa){Ea=yb;xb=wa};this.perform=function(){Na=Ea.getAllNodeCoordinate();Ea.setAllNodeCoordinate(xb)};this.unperform=function(){Ea.setAllNodeCoordinate(Na)}};cb.ActionChangeModelProp=function(){xa.call(this)};cb.ActionChangeMaterializedConfig=function(){oa.call(this);var Ea,Na,xb;this.getCaption=function(){return wb.get("editMaterializedConfig",
"\u7f16\u8f91\u7269\u5316\u5b58\u50a8\u8bbe\u7f6e")};this.setValue=function(yb,wa){Ea=yb;xb=wa};this.perform=function(){Na=Ea.getMaterializedConfig();Ea.setMaterializedConfig(xb)};this.unperform=function(){Ea.setMaterializedConfig(Na)}};cb.ActionNodeFieldSetting=eb;cb.ActionFieldNumberMapping=function(){oa.call(this);var Ea,Na,xb,yb,wa;this.getCaption=function(){return wb.get("actionChangeFieldNumber","\u4fee\u6539\u5b57\u6bb5\u540d\u79f0")};this.setValue=function(Q,Ha,Ob){Ea=Q;Na=Ha;xb=Ob;yb=Q.getFieldNumberMap()[Ha.getFullName()]};
this.perform=function(){wa=Ea.isNumberManualModified(Na);Ea.addFieldNumberMap(Na,xb,!0)};this.unperform=function(){Ea.addFieldNumberMap(Na,yb,wa)}};var qb,wb,Ab,Vb,Db,ub,Hb;(function(){var Ea=com.kingdee.bos.qing.common;qb=Ea.EventListenerList;Ea=com.kingdee.bos.qing.framework.common;wb=Ea.MultilanguageManager.createPackageAccessor(cb);Ab=cb.TableModeler;Vb=cb.TableNode;Db=cb.JoinNode;ub=cb.UnionNode;Hb=cb.FieldSettingConfig})();eb.TYPE_ALIAS="alias";eb.TYPE_DATATYPE="datatype";cb.NodeHelper=new function(){function Ea(ja){var fa=
[],Ja,ea,G={},O,ya;this.getRemovedNode=function(){return ja};this.setUpwardNodes=function(ka){fa=ka};this.getUpwardNodes=function(){return fa};this.setDownwardNode=function(ka){Ja=ka};this.getDownwardNode=function(){return Ja};this.setRemovedTable=function(ka){ea=ka};this.getRemovedTable=function(){return ea};this.setRelativeNode=function(ka){ya=ka};this.getRelativeNode=function(){return ya};this.setRelativePos=function(ka){O=ka};this.getRelativePos=function(){return O};this.setFieldNumberMap=function(ka){G=
ka};this.getFieldNumberMap=function(){return G}}var Na,xb,yb;this.setModeler=function(ja){Na=ja};this.setModelerChecker=function(ja){yb=ja};this.setNodeStatusMonitor=function(ja){xb=ja};this.addNode=function(ja,fa,Ja){if(fa){var ea=Na.getPage().getRelatedLine(fa,Ab.GET_LINE_STRATEGY_OUT);if(ea&&0!=ea.length){ea=Na.getPage();var G=ea.getRelatedLine(fa,Ab.GET_LINE_STRATEGY_OUT)[0],O=!ja.getX()||!ja.getY();O&&Q(fa,ja);ea.addNode(ja);ea.addLine(fa,ja);if(Ja)for(fa=0;fa<Ja.length;fa++)ea.addLine(Ja[fa],
ja);Ja=Na.getNode(G.getToId());ea.removeLine(G);ea.addLine(ja,Ja);O&&(Ha(Ja),wa(Ja));(Ja instanceof Db||Ja instanceof ub)&&Ja.affectByAddOrRemoveNode(Na.getNode(G.getFromId()),ja)}else if(ea=Na.getPage(),ja.getX()&&ja.getY()||Q(fa,ja),ea.addNode(ja),ea.addLine(fa,ja),Ja)for(fa=0;fa<Ja.length;fa++)ea.addLine(Ja[fa],ja)}else Na.getPage().addNode(ja);yb.checkDownwardNode(ja);xb&&xb.setSelected(ja)};this.removeNode=function(ja){var fa=new Ea(ja);a:for(var Ja=Na.getAllNodes(),ea=0;ea<Ja.length;ea++){var G=
Ja[ea];if(G!=ja){fa.setRelativeNode(G);Ja=[ja.getX()-G.getX(),ja.getY()-G.getY()];fa.setRelativePos(Ja);break a}}fa.setFieldNumberMap(Na.removeFieldNumber(ja));ea=Na.getRelatedLine(ja,Ab.GET_LINE_STRATEGY_IN);G=Na.getRelatedLine(ja,Ab.GET_LINE_STRATEGY_OUT);Ja=Na.getPage();var O;0<G.length&&(O=Na.getNode(G[0].getToId()));if(O instanceof Db||O instanceof ub)if(0<ea.length){var ya=Ob(ja,ea);O.affectByAddOrRemoveNode(ja,ya)}else O.affectByAddOrRemoveNode(ja,null);else O&&0<ea.length&&(ya=Na.getNode(ea[0].getFromId()),
Ja.addLine(ya,O));for(ya=0;ya<ea.length;ya++)Ja.removeLine(ea[ya]);for(ya=0;ya<G.length;ya++)Ja.removeLine(G[ya]);G=[];for(ya=0;ya<ea.length;ya++)G.push(Na.getNode(ea[ya].getFromId()));fa.setUpwardNodes(G);ja instanceof Vb&&!Na.getTable(ja.getTableUid()).isUserSql()&&(ja instanceof Vb?(ea=Na.getTable(ja.getTableUid()),ea=Na.removeTableIfUseless(ea,ja)?ea:null):ea=null,fa.setRemovedTable(ea));O&&(yb.checkDownwardNode(O),fa.setDownwardNode(O),cb.NodeFieldHelper.clearDownwardNodeCache(O.getId()));Ja.removeNode(ja,
fa);xb.getSelected()==ja&&(ja=Na.getAllNodes(),0<ja.length?xb.setSelected(ja[0]):xb.setSelected(null));return fa};this.reHandleNodeRelation=function(ja,fa){if(ja){for(var Ja=Na.getPage(),ea=Na.getRelatedLine(ja,Ab.GET_LINE_STRATEGY_IN),G=0;G<ea.length;G++)Ja.removeLine(ea[G]);for(G=0;G<fa.length;G++)(ea=fa[G])&&Ja.addLine(ea,ja);yb.checkDownwardNode(ja)}};this.linkNode=function(ja,fa){fa instanceof Db||fa instanceof ub?fa.affectByLink(Na,ja):Na.getPage().linkNode(ja,fa);yb.checkDownwardNode(ja)};
this.breakLink=function(ja,fa){fa instanceof Db||fa instanceof ub?fa.affectByBreakLink(Na,ja):Na.getPage().breakLink(ja,fa);yb.checkDownwardNode(fa)};var wa=function(ja){(ja=Na.getRelatedLine(ja,Ab.GET_LINE_STRATEGY_OUT))&&0<ja.length&&(ja=Na.getNode(ja[0].getToId()),Ha(ja),wa(ja))},Q=function(ja,fa){var Ja=ja.getY()+(ja.getHeight()>>1)-(fa.getHeight()>>1);fa.setPosition(ja.getX()+ja.getWidth()+150,Ja)},Ha=function(ja){ja.changePosition(ja.getX()+ja.getWidth()+150,ja.getY())},Ob=function(ja,fa){if(!fa||
0==fa.length)return null;var Ja=fa[0].getFromId(),ea=Na.getNode(Ja);if(1==fa.length)return ea;if(ja instanceof Db||ja instanceof ub)Ja=ja.getSuggestUpwardIdWhenDelete();if(!Ja)return ea;(ja=Na.getNode(Ja))&&(ea=ja);return ea}}})();(function(){function oa(){var G,O,ya,ka=!1,ca=!1,N;this.setId=function(Ga){N=Ga};this.getId=function(){return N};this.setMatch=function(Ga){ka=Ga};this.getMatch=function(){return ka};this.setName=function(Ga){G=Ga};this.getName=function(){return G};this.setDisplayName=function(Ga){O=Ga};this.getDisplayName=function(){return O};this.setParentNode=function(Ga){ya=Ga};this.getParentNode=function(){return ya};this.setChecked=function(Ga){ca=Ga};this.isChecked=function(){return ca};this.check=function(Ga){};
this.getSubNodeLevel=function(){for(var Ga=-1,Pa=ya;Pa;)Ga++,Pa=Pa.getParentNode();return Ga}}function xa(){oa.call(this);var G=this,O=[],ya=!0;this.setChildren=function(ka){O=ka};this.getChildren=function(){return O};this.setExpanded=function(ka){ya=ka};this.isExpanded=function(){return ya};this.check=function(ka,ca){if(0!==O.length&&ka!==G.isChecked()){G.setChecked(ka);for(var N=0;N<O.length;N++)O[N].check(ka,ca)}};this.toJsonObject=function(){var ka={};ka.children=O;return ka};this.fromJsonObject=
function(ka,ca){G.setName(ka.name);G.setDisplayName(ka.displayName);G.setId(ka.id);if(ka=ka.children)for(var N=0;N<ka.length;N++){var Ga=ka[N];if(Ga.type){var Pa=new eb;Pa.fromJsonObject(Ga);Pa.setParentNode(G);O.push(Pa);ca&&Pa.setCommentInfo(ca)}else Pa=new xa,Pa.fromJsonObject(Ga),Pa.setParentNode(G),O.push(Pa)}}}function eb(){oa.call(this);var G=this,O,ya,ka,ca,N;this.setUserSql=function(Ga){ca=Ga};this.getUserSql=function(){return ca};this.setCommentInfo=function(Ga){ya=Ga};this.getCommentInfo=
function(){return ya};this.setType=function(Ga){O=Ga};this.getType=function(){return O};this.setErrorMessage=function(Ga){ka=Ga};this.getErrorMessage=function(){return ka};this.setDisableDrag=function(Ga){N=Ga};this.getDisableDrag=function(){return N};this.fromJsonObject=function(Ga){G.setType(Ga.type);G.setName(Ga.name);G.setDisplayName(Ga.displayName);G.setCommentInfo(Ga.commentInfo);G.setId(Ga.id)};this.check=function(Ga,Pa){Ga!==G.isChecked()&&(G.setChecked(Ga),Pa&&Pa(G.getParentNode()))}}function cb(){var G=
this,O,ya;this.getType=function(){return O};this.getDisplayName=function(){throw Error("override me");};this.getIconName=function(){return ya};this.getNodeCreator=function(){return ka};var ka=function(ca,N,Ga){ca=fa.createTransformNode(G.getType());Ga(ca)};this.protectedMethod={setType:function(ca){O=ca},setIconName:function(ca){ya=ca}}}function qb(){cb.call(this);var G=this.protectedMethod;G.setType(Ob.TYPE_FIELD_SELECT);G.setIconName("select_field");this.getDisplayName=function(){return ja.get("selectField",
"\u9009\u62e9\u5b57\u6bb5")}}function wb(){cb.call(this);var G=this.protectedMethod;G.setType(Ob.TYPE_SORT);G.setIconName("sort");this.getDisplayName=function(){return ja.get("sort","\u6392\u5e8f")}}function Ab(){cb.call(this);var G=this.protectedMethod;G.setType(Ob.TYPE_GROUP_BY);G.setIconName("group_by");this.getDisplayName=function(){return ja.get("groupBy","\u5206\u7ec4\u6c47\u603b")}}function Vb(){cb.call(this);var G=this.protectedMethod;G.setType(Ob.TYPE_CUSTOM_GROUP);G.setIconName("custom_group");
this.getDisplayName=function(){return ja.get("customGroup","\u81ea\u5b9a\u4e49\u5206\u7ec4")}}function Db(){ub.call(this);var G=this.protectedMethod;G.setType(Ob.TYPE_CALCULATED_FIELD);G.setIconName("calculated_field");this.getDisplayName=function(){return ja.get("calculatedField","\u8ba1\u7b97\u5b57\u6bb5")}}function ub(){cb.call(this);var G;this.getNodeCreator=function(){return O};this.setCustomNodeCreator=function(ya){G=ya};var O=function(ya,ka,ca){G&&G(ya,ka,ca)}}function Hb(){ub.call(this);var G=
this.protectedMethod;G.setType(Ob.TYPE_JOIN);G.setIconName("join");this.getDisplayName=function(){return ja.get("joinTable","\u5173\u8054\u8868")}}function Ea(){ub.call(this);var G=this.protectedMethod;G.setType(Ob.TYPE_FILTER);G.setIconName("filter");this.getDisplayName=function(){return ja.get("filter","\u8fc7\u6ee4")}}function Na(){ub.call(this);var G=this.protectedMethod;G.setType(Ob.TYPE_UNION);G.setIconName("union");this.getDisplayName=function(){return ja.get("union","\u5408\u5e76\u8868")}}
function xb(){ub.call(this);var G=this.protectedMethod;G.setType(Ob.TYPE_COLUMN_TO_ROW);G.setIconName("column_to_row");this.getDisplayName=function(){return ja.get("columnToRow","\u5217\u8f6c\u884c")}}function yb(){var G;this.setType=function(O){G=O};this.getType=function(){return G};this.getDisplayName=function(){throw Error("override me");}}function wa(){yb.call(this);this.setType(yb.TYPE_DELETE);this.getDisplayName=function(){return ja.get("delete","\u5220\u9664")}}function Q(){yb.call(this);this.setType(yb.TYPE_RENAME);
this.getDisplayName=function(){return ja.get("rename","\u91cd\u547d\u540d")}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var Ha=com.kingdee.bos.qing.modeler.designer;
Ha.FolderNode=xa;Ha.LeafNode=eb;Ha.NodeStatusMonitor=function(){var G=this,O,ya=[],ka=[],ca=[],N={};this.reset=function(){G.setSelected(void 0);G.setInvalidNodes([])};this.addSelectNodeListener=function(Pa){ya.push(Pa)};this.removeSelectNodeListener=function(Pa){Pa=ya.indexOf(Pa);-1<Pa&&ya.splice(Pa,1)};this.setSelected=function(Pa){if(O!==Pa){var Qa=O;Pa=O=Pa;for(var Ia=0;Ia<ya.length;Ia++)(0,ya[Ia])(Qa,Pa)}};this.getSelected=function(){return O};this.setInvalidNodes=function(Pa,Qa){ka=Pa;N={};if(Pa&&
Qa)for(var Ia=Math.min(Pa.length,Qa.length),Oa=0;Oa<Ia;Oa++){var M=Pa[Oa];if(M){var C=Qa[Oa];N[M.getId()]=C}}Ga()};this.getInvalidNodes=function(){return ka};this.isInvalidNode=function(Pa){if(!ka)return!1;for(var Qa=0;Qa<ka.length;Qa++){var Ia=ka[Qa];if(Ia&&Ia.getId()==Pa)return!0}return!1};this.getInvalidPrompt=function(Pa){if(Pa&&(Pa=N[Pa.getId()]))return Pa.getPrompt()};this.addInvalidNode=function(Pa,Qa){Pa&&(0>ka.indexOf(Pa)&&ka.push(Pa),Qa&&(N[Pa.getId()]=Qa),Ga())};this.removeInvalidNode=
function(Pa){var Qa=ka.indexOf(Pa);-1<Qa&&(ka.splice(Qa,1),N[Pa.getId()]=null,Ga())};this.batchUpdateNodeValidity=function(Pa,Qa,Ia){if(Pa&&Qa)for(var Oa=Math.min(Pa.length,Qa.length),M=0;M<Oa;M++){var C=Pa[M];if(C){var F=Qa[M],x=ka.indexOf(C);0>x&&ka.push(C);N[C.getId()]=F}}if(Ia)for(M=0;M<Ia.length;M++)C=Ia[M],x=ka.indexOf(C),-1<x&&(ka.splice(x,1),N[C.getId()]=null);Ga()};this.addInvalidNodeChangeListener=function(Pa){ca.push(Pa)};this.removeInvalidNodeChangeListener=function(Pa){Pa=ca.indexOf(Pa);
-1<Pa&&ca.splice(Pa,1)};this.getInvalidState=function(Pa){return N[Pa.getId()]};var Ga=function(){for(var Pa=0;Pa<ca.length;Pa++)(0,ca[Pa])(ka)}};Ha.DraggingTableNode=function(){var G,O;this.setTableNode=function(ya){G=ya};this.getTableNode=function(){return G};this.setTable=function(ya){O=ya};this.getTable=function(){return O}};Ha.JoinTransformType=Hb;Ha.NodeOperateType=yb;var Ob,ja,fa,Ja;(function(){Ob=Ha.Config;fa=Ha.TransformNodeFactory;var G=com.kingdee.bos.qing.framework.common;ja=G.MultilanguageManager.createPackageAccessor(Ha);
G=com.kingdee.bos.qing.common;Ja=G.TextMeasurer})();var ea=new function(){var G=[qb,Ea,Hb,Na,Db,Vb,Ab,wb,xb],O,ya=0;this.getAllTypes=function(){O||ka();return G};this.getMaxDisplayNameLength=function(){if(!ya){var ca=new Ja;ca.setFontSize(12);for(var N=0;N<G.length;N++){var Ga=G[N].getDisplayName();ya=Math.max(ya,ca.measureWidth(Ga))}}return ya};this.getType=function(ca){O||ka();return O[ca]};var ka=function(){var ca=G;G=[];O={};for(var N=0,Ga=ca.length;N<Ga;N++){var Pa=new ca[N];G.push(Pa);O[Pa.getType()]=
Pa}}};Ha.TransformTypeFactory=ea;yb.TYPE_RENAME="rename";yb.TYPE_DELETE="delete";Ha.NodeOperateTypeFactory=new function(){var G=!1,O=[wa,Q];this.getAllTypes=function(){if(!G){for(var ya=[],ka=0;ka<O.length;ka++)ya[ka]=new O[ka];O=ya;G=!0}return O}}})();(function(){function oa(){var q;this.getPrompt=function(){return q};this.setPrompt=function(H){q=H}}function xa(q){oa.call(this);q=D.get("lackInputNodePrompt","\u8282\u70b9\u6ca1\u6709\u8fde\u63a5\u6570\u636e\u8868");this.setPrompt(q)}function eb(){oa.call(this);this.setPrompt(D.get("upwardNodeInvalid","\u4e0a\u6e38\u8282\u70b9\u8bbe\u7f6e\u4e0d\u5b8c\u6574"))}function cb(q){oa.call(this);q=q?q:D.get("defaultConfigPrompt","\u8282\u70b9\u8bbe\u7f6e\u4e0d\u5b8c\u6574");this.setPrompt(q)}function qb(){oa.call(this);
this.setPrompt(D.get("invalidSourcePrompt","\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664"))}function wb(){oa.call(this);this.setPrompt(D.get("tableNoFieldPrompt","\u8282\u70b9\u7f3a\u5c11\u5b57\u6bb5"))}function Ab(){oa.call(this);this.setPrompt(D.get("tableNoAuthorityPrompt","\u65e0\u6743\u67e5\u770b\u8868\u6570\u636e"))}function Vb(){oa.call(this);this.setPrompt(D.get("tableModelDeleted","\u8be5\u8868\u5bf9\u5e94\u7684\u6a21\u578b\u5df2\u88ab\u5220\u9664"))}function Db(){oa.call(this);
this.setPrompt(D.get("tableModelNoDataPermission","\u60a8\u672a\u88ab\u6388\u6743\u4f7f\u7528\u8be5\u8868\u5bf9\u5e94\u7684\u6a21\u578b"))}function ub(){oa.call(this);this.setPrompt(D.get("tableModelInComplete","\u8be5\u8868\u5bf9\u5e94\u7684\u6a21\u578b\u8bbe\u7f6e\u4e0d\u5b8c\u6574"))}function Hb(){oa.call(this);this.setPrompt(D.get("tableModelDamage","\u8be5\u8868\u5bf9\u5e94\u7684\u6a21\u578b\u5df2\u635f\u574f"))}function Ea(q){oa.call(this);if(1==q.length)q=D.get("tableModelCycleReference","\u8be5\u8868\u5bf9\u5e94\u7684\u6a21\u578b'#1'\u4e0e\u5f53\u524d\u6a21\u578b\u5b58\u5728\u5faa\u73af\u5f15\u7528").replace("#1",
q[0]),this.setPrompt(q);else{for(var H=0;H<q.length;H++){if(0==H){var P=D.get("tableModelCycleReference","\u8be5\u8868\u5bf9\u5e94\u7684\u6a21\u578b'#1'\u4e0e\u5f53\u524d\u6a21\u578b\u5b58\u5728\u5faa\u73af\u5f15\u7528");P=P.replace("#1",q[H])}H==q.length-1?(P+=D.get("tableModelRefCurrentModel",",'#1'\u6a21\u578b\u5f15\u7528\u4e86\u5f53\u524d\u6a21\u578b"),P=P.replace("#1",q[H])):(P+=D.get("tableModelRefOtherModel",",'#1'\u6a21\u578b\u5f15\u7528\u4e86'#2'\u6a21\u578b"),P=P.replace("#1",q[H]).replace("#2",
q[H+1]))}this.setPrompt(P)}}function Na(){var q;this.setModeler=function(H){q=H};this.getNodeChecker=function(H){var P=new Q;H instanceof lb&&(P=new yb);H instanceof rb?P=new Ha:H instanceof Ra?P=new Ob:H instanceof Ma?P=new ja:H instanceof Ka?P=new fa:H instanceof Wa?P=new Ja:H instanceof sa?P=new ea:H instanceof qa?P=new G:H instanceof Va?P=new O:H instanceof w&&(P=new ya);P&&P.setModeler(q);return P}}function xb(){var q;this.checkNode=function(H,P,La){throw Error("override me");};this.setModeler=
function(H){q=H};this.protectedMethod={getModeler:function(){return q}}}function yb(){xb.call(this);this.checkNode=function(q,H,P){H()}}function wa(){xb.call(this);var q=this,H=this.protectedMethod;this.checkNode=function(P,La,ma){var ra,ta=ba.ModelConverter.getUpwardNode(H.getModeler(),P,!0);ta&&0!=ta.length||(ra=new xa(P));ra?La&&La(ra):q.protectedCheckNode(P,La,ma)};this.protectedCheckNode=function(P,La,ma){}}function Q(){wa.call(this)}function Ha(){wa.call(this);var q=this.protectedMethod,H,P;
this.protectedCheckNode=function(ma,ra,ta){H=ma;P=ra;ra=q.getModeler();var db=ra.getPrevNode(H);ba.NodeFieldHelper.asynGetFields(ra,db,La,function(){ta(ma)})};var La=function(ma){if(ma&&0!=ma.length){var ra=H.getConfig();if(!ra.isSelectAll()){var ta=!1;ra=ra.getSelected();for(var db=0;db<ra.length;db++){for(var fb=ra[db],va=0;va<ma.length;va++){var Za=ma[va];if(fb.getFullName()==Za.getFullName()){ta=!0;break}}if(ta)break}if(!ta){P(new cb(D.get("noFieldSelect","\u672a\u9009\u62e9\u5b57\u6bb5")));return}}P()}else P(new cb(D.get("noFieldToSelect",
"\u65e0\u53ef\u9009\u5b57\u6bb5")))}}function Ob(){wa.call(this);var q=this.protectedMethod,H,P;this.protectedCheckNode=function(ma,ra,ta){H=ma;P=ra;ra=q.getModeler();var db=ra.getPrevNode(H);ba.NodeFieldHelper.asynGetFields(ra,db,La,function(){ta(ma)})};var La=function(ma){ma&&0!=ma.length?P():P(new cb(D.get("noFieldToSet","\u65e0\u53ef\u8bbe\u7f6e\u5b57\u6bb5")))}}function ja(){wa.call(this);var q=this.protectedMethod,H,P,La;this.protectedCheckNode=function(Za,Ca,bb){H=Za;P=Ca;La=bb;Za=q.getModeler();
var Lb=H.getConfig();Ca=Za.getNode(Lb.getLeft());bb=Za.getNode(Lb.getRight());Ca&&bb?(Lb=Lb.getRelationModel())?(Lb=Lb.getRelations())&&0!=Lb.length?ma(Za,Ca,bb,Lb):P(new cb(D.get("invalidRelation","\u5173\u8054\u5173\u7cfb\u8bbe\u7f6e\u4e0d\u5b8c\u6574"))):P(new cb(D.get("invalidRelation","\u5173\u8054\u5173\u7cfb\u8bbe\u7f6e\u4e0d\u5b8c\u6574"))):P(new cb(D.get("invalidRelation","\u5173\u8054\u5173\u7cfb\u8bbe\u7f6e\u4e0d\u5b8c\u6574")))};var ma=function(Za,Ca,bb,Lb){ba.NodeFieldHelper.asynGetFields(Za,
Ca,function(Ua){fb(Lb,Ua,!0)},function(){La(H)});ba.NodeFieldHelper.asynGetFields(Za,bb,function(Ua){fb(Lb,Ua)},function(){La(H)})},ra,ta=!1,db=!1,fb=function(Za,Ca,bb){if(Ca&&0!=Ca.length)for(var Lb=bb?0:1,Ua=0;Ua<Za.length;Ua++){var ib=Za[Ua][Lb];if(!ib){ra=D.get("invalidRelation","\u5173\u8054\u5173\u7cfb\u8bbe\u7f6e\u4e0d\u5b8c\u6574");bb?ta=!0:db=!0;va();return}for(var ob=!1,Y=0;Y<Ca.length;Y++)if(Ca[Y].getFullName()==ib.getFullName()){ob=!0;break}if(!ob){ra=D.get("invalidRelation","\u5173\u8054\u5173\u7cfb\u8bbe\u7f6e\u4e0d\u5b8c\u6574");
bb?ta=!0:db=!0;va();return}}else ra=D.get("invalidRelation","\u5173\u8054\u5173\u7cfb\u8bbe\u7f6e\u4e0d\u5b8c\u6574");bb?ta=!0:db=!0;va()},va=function(){if(ta&&db){var Za;ra&&(Za=new cb(ra));P(Za)}}}function fa(){wa.call(this);var q=this.protectedMethod,H,P;this.protectedCheckNode=function(ma,ra,ta){H=ma;P=ra;ra=q.getModeler();var db=ra.getPrevNode(H);ba.NodeFieldHelper.asynGetFields(ra,db,La,function(){ta(ma)})};var La=function(ma){if(ma&&0!=ma.length){var ra=H.getConfig();ra.updateFilterItems(ma);
ra=ra.getNotEmptyFilterItems();0==ra.length?P(new cb(D.get("noFilterSetting","\u672a\u8bbe\u7f6e\u8fc7\u6ee4\u6761\u4ef6\uff0c\u65e0\u6cd5\u9884\u89c8\u6570\u636e\uff0c\u8bf7\u8bbe\u7f6e\u8fc7\u6ee4\u6761\u4ef6"))):Eb.checkFilterField(ra,ma)?P(new cb(D.get("invalidFilterSetting","\u8fc7\u6ee4\u6761\u4ef6\u4e0d\u5b8c\u6574\uff0c\u65e0\u6cd5\u9884\u89c8\u6570\u636e\uff0c\u8bf7\u4fee\u6539\u8fc7\u6ee4\u6761\u4ef6"))):P()}else P(new cb(D.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5")))}}function Ja(){wa.call(this);
var q=this.protectedMethod,H,P;this.protectedCheckNode=function(ma,ra,ta){H=ma;P=ra;ra=q.getModeler();var db=ra.getPrevNode(H);ba.NodeFieldHelper.asynGetFields(ra,db,La,function(){ta(ma)})};var La=function(ma){if(ma&&0!==ma.length){var ra=H.getConfig(),ta=ra.getColumnToRowItems();if(ta&&0!==ta.length){ta={};for(var db=0;db<ma.length;db++){var fb=ma[db];ta[fb.getFullName()]=fb}ma=ra.getUsedFieldNames();for(ra=0;ra<ma.length;ra++)if(!ta[ma[ra]]){P(new cb(D.get("notExistColumnToRowField","\u201c\u5217\u8f6c\u884c\u201d\u4f7f\u7528\u7684\u5b57\u6bb5\u4e0d\u5b58\u5728")));
return}P()}else P(new cb(D.get("noColumnToRowSettings","\u672a\u8fdb\u884c\u201c\u5217\u8f6c\u884c\u201d\u8bbe\u7f6e")))}else P(new cb(D.get("noFieldToSet","\u65e0\u53ef\u8bbe\u7f6e\u5b57\u6bb5")))}}function ea(){wa.call(this);var q=this.protectedMethod,H,P;this.protectedCheckNode=function(ma,ra,ta){H=ma;P=ra;ra=q.getModeler();var db=ra.getPrevNode(H);ba.NodeFieldHelper.asynGetFields(ra,db,La,function(){ta(ma)})};var La=function(ma){if(ma&&0!=ma.length){var ra=H.getConfig().getAllSortItem();0==ra.length?
P(new cb(D.get("noSortItemSetting","\u672a\u8bbe\u7f6e\u6392\u5e8f\u4f9d\u636e\uff0c\u65e0\u6cd5\u9884\u89c8\u6570\u636e\uff0c\u8bf7\u8bbe\u7f6e\u6392\u5e8f\u4f9d\u636e"))):ba.SortCheckHelper.checkAllSortItemExist(ra,ma)?P():P(new cb(D.get("invalidSortSetting","\u6392\u5e8f\u4f9d\u636e\u8bbe\u7f6e\u4e0d\u5b8c\u6574\uff0c\u65e0\u6cd5\u9884\u89c8\u6570\u636e\uff0c\u8bf7\u4fee\u6539\u6392\u5e8f\u4f9d\u636e")))}else P(new cb(D.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5")))}}function G(){wa.call(this);
var q=this.protectedMethod,H,P;this.protectedCheckNode=function(ma,ra,ta){H=ma;P=ra;ra=q.getModeler();var db=ra.getPrevNode(H);ba.NodeFieldHelper.asynGetFields(ra,db,La,function(){ta(ma)})};var La=function(ma){ma&&0!=ma.length?0===H.getConfig().getGroupFieldItems().length?P(new cb(D.get("noSelectGroupFields","\u672a\u9009\u62e9\u5206\u7ec4\u5b57\u6bb5"))):P():P(new cb(D.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5")))}}function O(){wa.call(this);var q=this.protectedMethod,H,P;this.protectedCheckNode=
function(ma,ra,ta){H=ma;P=ra;ra=q.getModeler();var db=ra.getPrevNode(H);ba.NodeFieldHelper.asynGetFields(ra,db,La,function(){ta(ma)})};var La=function(ma){ma&&0!=ma.length?0===H.getConfig().getCalculatedFields().length?P(new cb(D.get("noSetCalculatedField","\u672a\u8bbe\u7f6e\u8ba1\u7b97\u5b57\u6bb5"))):P():P(new cb(D.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5")))}}function ya(){wa.call(this);var q=this.protectedMethod,H,P;this.protectedCheckNode=function(ma,ra,ta){H=ma;P=ra;ra=q.getModeler();
var db=ra.getPrevNode(H);ba.NodeFieldHelper.asynGetFields(ra,db,La,function(){ta(ma)})};var La=function(ma){if(ma&&ma.length){var ra=H.getConfig();ma=ra.getGroupName();var ta=ra.getSelectedField(),db=ra.getGroups();ra=ra.getHasOtherGroup();switch(!0){case !ma:var fb=new cb(D.get("noSetGroupName","\u672a\u8bbe\u7f6e\u7ec4\u540d"));break;case !ta:fb=new cb(D.get("noSetGroupName","\u672a\u9009\u62e9\u5b57\u6bb5"));break;case !db.length&&!ra:fb=new cb(D.get("noSetGroupName","\u672a\u521b\u5efa\u4efb\u4f55\u5206\u7ec4"))}fb?
P(fb):P()}else P(new cb(D.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5")))}}function ka(){this.getHandler=function(q,H){switch(q.getType()){case Z.TYPE_MULTI_OUTPUT:var P=new N;break;case Z.TYPE_LACK_OUTPUT:P=new Ga;break;case Z.TYPE_INVALID_CONFIG:P=new Pa;break;case Z.TYPE_LACK_INPUT:P=new Qa;break;case Z.TYPE_INVALID_SOURCE:P=new Ia;break;case Z.TYPE_TABLE_NO_FIELD:P=new Oa;break;case Z.TYPE_TABLE_NO_AUTHORITY:P=new M;break;case Z.TYPE_MODEL_DELETED:P=new C;break;case Z.TYPE_MODEL_NO_DATA_PERMISSION:P=
new F;break;case Z.TYPE_MODEL_INCOMPLETE:P=new x;break;case Z.TYPE_MODEL_DAMAGE:P=new Aa;break;case Z.TYPE_MODEL_CYCLE_REFERENCE:P=new za;break;case Z.TYPE_INCOMPLETE_MATERIALIZED_CONFIG:P=new U}P&&(P.setCase(q),P.setGlobal(H));return P}}function ca(){var q,H;this.setCase=function(P){q=P};this.setGlobal=function(P){H=P};this.getDetail=function(){throw Error("override me");};this.protectedMethod={getCase:function(){return q},getGlobal:function(){return H},getDisplayNameString:function(P){for(var La=
H.getModelerModel(),ma="",ra=0;ra<P.length;ra++){var ta=La.getNode(P[ra]);ta=ba.DisplayNameHelper.getNodeDisplayName(ta);ma+="\u201c"+ta+"\u201d";ra<P.length-1&&(ma+=D.get("comma","\u3001"))}return ma}}}function N(){ca.call(this);var q=this.protectedMethod;this.getDetail=function(){var H=q.getCase().getOutputNodeIds(),P=D.get("onlyOneOutputAllowed","\u6570\u636e\u8868\u6a21\u578b\u4ec5\u53ef\u5b58\u5728\u4e00\u4e2a\u8f93\u51fa\u8282\u70b9\uff0c\u5f53\u524d\u6a21\u578b\u5b58\u5728#1#2\u4e2a\u8f93\u51fa\u8282\u70b9"),
La=q.getDisplayNameString(H);P=P.replace("#2",H.length);return P.replace("#1",La)}}function Ga(){ca.call(this);this.getDetail=function(){return D.get("lackOutputNode","\u6a21\u578b\u7f3a\u5c11\u8f93\u51fa\u8282\u70b9")}}function Pa(){ca.call(this);var q=this.protectedMethod;this.getDetail=function(){var H=q.getCase().getNodeIds(),P=D.get("invalidNodeConfig","#1\u8282\u70b9\u7684\u8bbe\u7f6e\u4e0d\u5b8c\u6574");H=q.getDisplayNameString(H);return P.replace("#1",H)}}function Qa(){ca.call(this);var q=
this.protectedMethod;this.getDetail=function(){var H=q.getCase().getNodeIds(),P=D.get("lackInputNodeDetail","#1\u8282\u70b9\u6ca1\u6709\u8fde\u63a5\u6570\u636e\u8868");H=q.getDisplayNameString(H);return P.replace("#1",H)}}function Ia(){ca.call(this);var q=this.protectedMethod;this.getDetail=function(){var H=q.getCase().getNodeIds(),P=D.get("invalidNodeSource","#1\u8282\u70b9\u7684\u8868\u4e0d\u5b58\u5728");H=q.getDisplayNameString(H);return P.replace("#1",H)}}function Oa(){ca.call(this);var q=this.protectedMethod;
this.getDetail=function(){var H=q.getCase().getNodeIds(),P=D.get("tableNoField","#1\u8282\u70b9\u7f3a\u5c11\u5b57\u6bb5");H=q.getDisplayNameString(H);return P.replace("#1",H)}}function M(){ca.call(this);var q=this.protectedMethod;this.getDetail=function(){var H=q.getCase().getNodeIds(),P=D.get("tableNoAuthority","\u65e0\u6743\u67e5\u770b#1\u8282\u70b9\u7684\u8868\u6570\u636e");H=q.getDisplayNameString(H);return P.replace("#1",H)}}function C(){ca.call(this);var q=this.protectedMethod;this.getDetail=
function(){var H=q.getCase().getNodeIds();H=q.getDisplayNameString(H);return D.get("nodeModelDeleted","#1\u8282\u70b9\u5bf9\u5e94\u7684\u6a21\u578b\u5df2\u88ab\u5220\u9664").replace("#1",H)}}function F(){ca.call(this);var q=this.protectedMethod;this.getDetail=function(){var H=q.getCase().getNodeIds();H=q.getDisplayNameString(H);return D.get("nodeModelNoDataPermission","\u60a8\u672a\u88ab\u6388\u6743\u4f7f\u7528#1\u8282\u70b9\u5bf9\u5e94\u7684\u6a21\u578b").replace("#1",H)}}function x(){ca.call(this);
var q=this.protectedMethod;this.getDetail=function(){var H=q.getCase().getNodeIds();H=q.getDisplayNameString(H);return D.get("nodeModelInComplete","#1\u8282\u70b9\u5bf9\u5e94\u7684\u6a21\u578b\u8bbe\u7f6e\u4e0d\u5b8c\u6574").replace("#1",H)}}function Aa(){ca.call(this);var q=this.protectedMethod;this.getDetail=function(){var H=q.getCase().getNodeIds();H=q.getDisplayNameString(H);return D.get("nodeModelDamage","#1\u8282\u70b9\u5bf9\u5e94\u7684\u6a21\u578b\u5df2\u635f\u574f").replace("#1",H)}}function za(){ca.call(this);
var q=this.protectedMethod;this.getDetail=function(){var H=q.getCase(),P=H.getNodeIds();H=H.getCycleRefModelNames();P=q.getDisplayNameString(P);var La=D.get("modelCannotCycleReference","\u6a21\u578b\u4e4b\u95f4\u4e0d\u5141\u8bb8\u5faa\u73af\u5f15\u7528\uff0c");if(1==H.length)La+=D.get("nodeModelCycleReference","\u8282\u70b9#1\u5bf9\u5e94\u7684\u6a21\u578b'#2'\u4e0e\u5f53\u524d\u6a21\u578b\u5b58\u5728\u5faa\u73af\u5f15\u7528"),La=La.replace("#1",P).replace("#2",H[0]);else for(var ma=0;ma<H.length;ma++){if(0==
ma){var ra=D.get("nodeModelRefOtherModel","\u8282\u70b9#1\u5bf9\u5e94\u7684\u6a21\u578b'#2'\u5f15\u7528\u4e86'#3'\u6a21\u578b\uff0c");ra=ra.replace("#1",P).replace("#2",H[ma]).replace("#3",H[ma+1])}else ma==H.length-1?(ra=D.get("nodeModelRefCurrentModel","'#1'\u6a21\u578b\u5f15\u7528\u4e86\u5f53\u524d\u6a21\u578b"),ra=ra.replace("#1",H[ma])):(ra=D.get("modelRefOtherModel","'#1'\u6a21\u578b\u5f15\u7528\u4e86'#2'\u6a21\u578b\uff0c"),ra=ra.replace("#1",H[ma]).replace("#2",H[ma+1]));La+=ra}return La}}
function U(){ca.call(this);this.getDetail=function(){return D.get("incompleteMaterializedConfig","\u7269\u5316\u5b58\u50a8\u8bbe\u7f6e\u4e0d\u5b8c\u6574")}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&
(com.kingdee.bos.qing.modeler.designer={});var ba=com.kingdee.bos.qing.modeler.designer;ba.ModelerChecker=function(){var q=this,H,P,La,ma,ra,ta=[],db={};this.setRemoteImpl=function(W){H=W};this.setGlobal=function(W){P=W};this.init=function(W){ra&&ra.removePropertyChangeCallback(va);ra=W;ra.addPropertyChangeCallback(va);ma=new Na;ma.setModeler(ra)};this.setNodeStatusMonitor=function(W){La=W};this.check=function(W,L){(new Xa(H,function(h){q.setGlobalCheckResult(h,!0)})).checkModelerValid(W)};this.backgroundCheck=
function(W){var L=new Xa(H,function(h){var m=new Qb;m.fromJsonObject(h);Y(m)},function(){},function(){for(var h=P.getModelerModel().getAllNodes(),m=0;m<h.length;m++)bb(h[m])});L.setShowBlocking(!1);Za();L.checkModelerValid(W)};this.setGlobalCheckResult=function(W,L,h){var m=new Qb;m.fromJsonObject(W);if(m.isValid())L&&(W=Ta.createFeedbackDialog(),W.setMessage(D.get("tableModelerValid","\u5f53\u524d\u6570\u636e\u8868\u6a21\u578b\u6821\u9a8c\u901a\u8fc7")),W.setTitle(D.get("operatingTips","\u64cd\u4f5c\u63d0\u793a")),
W.setOptionType(Ta.OPTION_OK),W.setButtonText(Ta.RETURN_OK,D.get("iSee","\u6211\u77e5\u9053\u4e86")),W.showDialog());else{L=h?h:D.get("tableModelerInvalid","\u5f53\u524d\u6570\u636e\u8868\u6a21\u578b\u6821\u9a8c\u5931\u8d25\uff0c\u65e0\u6cd5\u90e8\u7f72\u6216\u9884\u89c8\u6570\u636e");W=Ta.createFeedbackDialog();W.setMsgImageType(Ta.MSG_WARNING);W.setTitle(D.get("operatingTips","\u64cd\u4f5c\u63d0\u793a"));W.setMessage(L);L=W.setDetail;h="";if(m.isModelEmpty())h=D.get("noModeler","\u5f53\u524d\u6a21\u578b\u672a\u5efa\u6a21");
else{for(var c=m.getCases(),d=new ka,e=[],k=0,a=c.length;k<a;k++){var b=d.getHandler(c[k],P);b&&e.push(b.getDetail())}k=0;for(a=e.length;k<a;k++)h+=k+1+"\u3001"+e[k],k<a-1?(h+="\uff1b",h+="\r\n"):h+=D.get("period","\u3002")}L.call(W,h);W.setOptionType(Ta.OPTION_OK);W.setButtonText(Ta.RETURN_OK,D.get("iSee","\u6211\u77e5\u9053\u4e86"));W.showDialog()}Y(m)};var fb=(new Date).getTime();this.updateNodeValidity=function(W,L){if(!L)fb=(new Date).getTime();else if(L<fb)return;fb=L;L=W.getCheckedNodeIds();
var h=[],m=[],c=[];W=gb(W);for(var d=0;d<L.length;d++){var e=L[d],k=ra.getNode(e);(e=W[e])?-1<h.indexOf(k)||(h.push(k),c.push(e)):m.push(k)}La.batchUpdateNodeValidity(h,c,m)};var va=function(W,L){(0==W.indexOf(Sa.KEY_CHANGE_TRANSFORM_CONFIG)&&W!=Sa.KEY_TRANSFORM_JOIN&&W!=Sa.KEY_TRANSFORM_UNION||W==jb.KEY_TABLE_NODE_SELECT_FIELD)&&q.checkDownwardNode(L)};this.focusNodeValidity=function(W,L,h){console.log("focus");0>ta.indexOf(W)?L&&L():(h=(h=db[W.getId()])?h:[],h.push(L),db[W.getId()]=h)};this.checkDownwardNode=
function(W){Ca(W,!0);Lb(W)};this.checkCurrentNode=function(W,L){Ca(W);Ua(W,L)};var Za=function(){for(var W=P.getModelerModel().getAllNodes(),L=0;L<W.length;L++)Ca(W[L])},Ca=function(W,L){if(L)for(W=ba.ModelConverter.getDownwardNode(P.getModelerModel(),W,!1),L=0;L<W.length;L++)console.log("start check"+W[L].getId()),ta.push(W[L]);else console.log("start check"+W.getId()),ta.push(W)},bb=function(W,L){var h=ta.indexOf(W);if(-1<h&&(console.log("finish check "+W.getId()),ta.splice(h,1),h=db[W.getId()]))for(var m=
0;m<h.length;m++)h[m]();db[W.getId()]=[];L&&(W=P.getModelerModel().getNextNode(W))&&bb(W,!0)},Lb=function(W){var L=P.getModelerModel();W=ba.ModelConverter.getOutputNode(L,W);W=ba.ModelConverter.convertToRuntimeModel(L,W);for(var h=[],m=W.getVertexes(),c=0;c<m.length;c++){var d=L.getNode(m[c].getId());d&&h.push(d)}var e=(new Date).getTime();L=new Xa(H,function(k){var a=new Qb;a.fromJsonObject(k);q.updateNodeValidity(a,e)},function(){},function(){for(var k=0;k<h.length;k++)bb(h[k])});L.setShowBlocking(!1);
L.checkNodeValid(W)},Ua=function(W,L,h){var m=P.getModelerModel();if(ib(W))La.addInvalidNode(W,new eb),ob(m,W),L&&L(),bb(W,!0);else{var c=ma.getNodeChecker(W);c?c.checkNode(W,function(d){d?(La.addInvalidNode(W,d),ob(m,W),bb(W,!0)):(La.removeInvalidNode(W),bb(W),h&&(d=m.getNextNode(W))&&Ua(d,L,!0));L&&L()},function(d){bb(d)}):bb(W,h)}},ib=function(W){if(W=ba.ModelConverter.getUpwardNode(P.getModelerModel(),W,!0))for(var L=0;L<W.length;L++)if(La.isInvalidNode(W[L].getId()))return!0;return!1},ob=function(W,
L){if(L=W.getNextNode(L))La.addInvalidNode(L,new eb),ob(W,L)},Y=function(W){var L=[],h=[];if(W.isValid())La.setInvalidNodes(L);else{var m=P.getModelerModel();W=gb(W);for(var c=Object.keys(W),d=0;d<c.length;d++){var e=c[d],k=m.getNode(e);k&&-1==L.indexOf(k)&&(L.push(m.getNode(e)),h.push(W[e]))}La.setInvalidNodes(L,h);for(d=0;d<L.length;d++)ob(m,L[d])}},gb=function(W){var L={};W=W.getCases();for(var h=P.getModelerModel(),m=0;m<W.length;m++){var c=W[m];if(c instanceof Tb){var d=c.getNodeIds();for(c=
0;c<d.length;c++){var e=d[c],k=h.getNode(e);L[e]=new xa(k)}}else if(c instanceof ab)for(d=c.getNodeIds(),c=0;c<d.length;c++)e=d[c],L[e]||(L[e]=new cb);else if(c instanceof Cb)for(d=c.getNodeIds(),c=0;c<d.length;c++)e=d[c],L[e]||(L[e]=new eb);else if(c instanceof Fb)for(d=c.getNodeIds(),c=0;c<d.length;c++)e=d[c],L[e]||(L[e]=new qb);else if(c instanceof Ya)for(d=c.getNodeIds(),c=0;c<d.length;c++)e=d[c],L[e]||(L[e]=new wb);else if(c instanceof kb)for(d=c.getNodeIds(),c=0;c<d.length;c++)e=d[c],L[e]||
(L[e]=new Ab);else if(c instanceof ha)for(d=c.getNodeIds(),c=0;c<d.length;c++)e=d[c],L[e]||(L[e]=new Vb);else if(c instanceof hb)for(d=c.getNodeIds(),c=0;c<d.length;c++)e=d[c],L[e]||(L[e]=new Db);else if(c instanceof Mb)for(d=c.getNodeIds(),c=0;c<d.length;c++)e=d[c],L[e]||(L[e]=new ub);else if(c instanceof Nb)for(d=c.getNodeIds(),c=0;c<d.length;c++)e=d[c],L[e]||(L[e]=new Hb);else if(c instanceof T)for(d=c.getNodeIds(),k=c.getCycleRefModelNames(),c=0;c<d.length;c++)e=d[c],L[e]||(L[e]=new Ea(k))}return L}};
ba.LackInputState=xa;ba.TableNoFieldState=wb;ba.InvalidityCaseHandlerFactory=ka;var Ta,Xa,D,jb,Sa,rb,Ra,Ma,qa,w,sa,Va,Ka,Wa,lb,Eb,Qb,Tb,ab,Cb,Fb,Ya,kb,Z,ha,hb,Mb,Nb,T;(function(){var q=com.kingdee.bos.qing.ui.component;Ta=q.MessageDialog;q=com.kingdee.bos.qing.framework.common;D=q.MultilanguageManager.createPackageAccessor(ba);Sa=ba.TableModeler;jb=ba.ModelerModel;Xa=ba.DesignerFacade;rb=ba.FieldSelectNode;Ra=ba.FieldSettingNode;Ma=ba.JoinNode;qa=ba.GroupByNode;w=ba.CustomGroupNode;sa=ba.SortNode;
Va=ba.CalculatedFieldNode;Ka=ba.FilterNode;Wa=ba.ColumnToRowNode;lb=ba.TableNode;Eb=ba.FilterCheckHelper;Qb=ba.ModelerValidity;Tb=ba.LackInputNodeCase;ab=ba.InvalidConfigCase;Z=ba.AbstractInvalidityCase;Fb=ba.InvalidSourceCase;Cb=ba.InvalidUpwardNodeCase;Ya=ba.TableNoFieldCase;kb=ba.TableNoAuthorityCase;ha=ba.ModelDeletedCase;hb=ba.ModelNoDataPermissionCase;Mb=ba.ModelInCompleteCase;Nb=ba.ModelDamageCase;T=ba.ModelCycleReferenceCase})()})();(function(){function oa(a){var b=this,f,g=new qb,l,n,p,u,E,V,J,z,B,I;this.setScaleHelper=function(X){n=X};this.setGlobal=function(X){I=X};this.changeNodeDisplayName=function(){throw Error("override me");};this.getNamePositionRect=function(){throw Error("override me");};this.getOperateIconUi=function(){return p};this.changePosition=function(X,$a){f&&(X=aa([X,$a]),g.setAttributes(f,{transform:"translate("+X[0]+","+X[1]+")"}))};this.getSvgElement=function(){if(!f){f=g.createNode("g");g.setAttributes(f,
{transform:"translate("+ia(a.getX())+","+ia(a.getY())+")"});b.protectedAddUi(f);var X=g.createNode("rect");g.setAttributes(X,{width:ia(20),height:ia(20),x:ia(a.getWidth()-20),y:0,fill:"none","pointer-events":"visible"});f.appendChild(X);p=$(X);X=g.createNode("text");g.setAttributes(X,{fill:"#427cac",x:ia(a.getWidth()-10)+"px",y:ia(21)+"px","font-size":ia(18)+"px"});g.setText(X,"\u22ee");f.appendChild(X);u=$(X);g.setTitle(X,D.get("moreOperation","\u66f4\u591a\u64cd\u4f5c"));u.addClass(oa.NODE_OPERATE_ICON_CLASS);
p.addClass(oa.NODE_OPERATE_ICON_CLASS);u.hide();p.hide();pa();la()}return f};this.remove=function(){f&&f.remove();f=null};this.protectedAddUi=function(X){};this.setSelected=function(X){E=X;pa()};this.isSelected=function(){return E};this.setHover=function(X){(V=X)?(p.show(),u.show()):(u.hide(),p.hide())};this.isHover=function(){return V};this.setInvalid=function(X,$a){J=X;B=$a;la()};var ia=function(X){return n?n.getScaledSize(X):X},aa=function(X){return n?n.getScaledCoordinate(X):X},pa=function(){if(f)if(E){l=
g.createNode("rect");var X=Math.max(2,ia(2));g.setAttributes(l,{width:ia(a.getWidth())+X,height:ia(a.getHeight())+X,x:-(X>>1),y:-(X>>1),rx:ia(4),fill:"none","stroke-width":X,stroke:"#276ff5"});f.appendChild(l)}else l&&l.remove(),l=null},la=function(){if(f)if(J){if(z=g.createNode("image"),g.setAttributes(z,{width:ia(16),height:ia(16),x:ia(a.getWidth()-16>>1),y:-ia(19),href:C.SvgIconHelper.makeUrl("error")}),f.appendChild(z),B){var X=g.createNode("title");g.setText(X,B);z.appendChild(X)}}else z&&z.remove(),
z=null};this.protectedMethod={getSvgHelper:function(){return g},getScaledSize:ia,getScaledCoordinate:aa,getGlobal:function(){return I}}}function xa(a){oa.call(this,a);var b=this.protectedMethod,f,g,l,n,p=0;this.protectedAddUi=function(V){g=V;V=b.getSvgHelper();var J=V.createNode("rect");V.setAttributes(J,{width:b.getScaledSize(a.getWidth()),height:b.getScaledSize(a.getHeight()),x:0,y:0,rx:b.getScaledSize(4),fill:"#fafafa","stroke-width":b.getScaledSize(1),stroke:"#999"});g.appendChild(J);V=b.getSvgHelper();
f=V.createNode("text");$(f).addClass(oa.NODE_NAME_UI_CLASS);V.setAttributes(f,{fill:"#666",x:b.getScaledSize(40),y:b.getScaledSize(16),"font-size":b.getScaledSize(11)});u(C.DisplayNameHelper.getNodeDisplayName(a));g.appendChild(f);V=b.getSvgHelper();J=V.createNode("rect");var z=V.setAttributes,B=b.getScaledSize(30),I=b.getScaledSize(30),ia=b.getScaledSize(5),aa=b.getScaledSize(a.getHeight()-30)>>1,pa=b.getScaledSize(4);var la=b.getGlobal().getModelerModel().getNodeSource(a);la=C.SvgIconHelper.getTableIconColor(la);
z.call(V,J,{width:B,height:I,x:ia,y:aa,rx:pa,fill:la});z=V.createNode("image");B=V.setAttributes;I=b.getScaledSize(20);ia=b.getScaledSize(20);aa=b.getScaledSize(10);pa=b.getScaledSize(a.getHeight()-20)>>1;la=C.SvgIconHelper;var X=la.makeUrl,$a="table",nb=b.getGlobal().getModelerModel().getTableByNodeId(a.getId());nb&&nb.isUserSql()&&($a=nb.getUserSql().getSqlType());B.call(V,z,{width:I,height:ia,x:aa,y:pa,href:X.call(la,$a)});g.appendChild(J);g.appendChild(z);V=b.getSvgHelper();l=V.createNode("text");
V.setAttributes(l,{fill:"#666",x:b.getScaledSize(57),y:b.getScaledSize(a.getHeight()-4-5+1),"font-size":b.getScaledSize(10)});n=V.createNode("image");V.setAttributes(n,{width:b.getScaledSize(16),height:b.getScaledSize(16),x:b.getScaledSize(38),y:b.getScaledSize(a.getHeight()-4-16),href:C.SvgIconHelper.makeUrl("field_num")});g.appendChild(n);g.appendChild(l);E()};this.changeNodeDisplayName=function(){u(C.DisplayNameHelper.getNodeDisplayName(a))};this.getNamePositionRect=function(){var V=b.getScaledSize(a.getX()+
40),J=b.getScaledSize(a.getY()+5),z=b.getScaledSize(100),B=Math.max(14,b.getScaledSize(18));return[V,J,z,B]};this.setFieldCount=function(V){p=V;E()};var u=function(V){var J=b.getSvgHelper(),z=C.SvgTextTrimer.trim(V,b.getScaledSize(11),b.getScaledSize(100));J.setText(f,z);J.setTitle(g,V)},E=function(){if(l){var V=b.getSvgHelper();V.setText(l,p);var J=D.get("selectedFields","\u5df2\u9009\u62e9#1\u4e2a\u5b57\u6bb5").replace("#1",p);V.setTitle(l,J);V.setTitle(n,J)}}}function eb(a){oa.call(this,a);var b=
this.protectedMethod,f,g;this.protectedAddUi=function(l){g=l;var n=b.getSvgHelper(),p=n.createNode("rect");n.setAttributes(p,{width:b.getScaledSize(a.getWidth()),height:b.getScaledSize(a.getHeight()),x:0,y:0,rx:b.getScaledSize(4),fill:"#fafafa","stroke-width":b.getScaledSize(1),stroke:"#999","pointer-events":"visible"});var u=C.DisplayNameHelper.getNodeDisplayName(a);f=n.createNode("text");$(f).addClass(oa.NODE_NAME_UI_CLASS);n.setAttributes(f,{fill:"#666",x:(b.getScaledSize(a.getWidth())>>1)+"px",
y:b.getScaledSize(a.getHeight()+11+3)+"px","font-size":b.getScaledSize(11)+"px","text-anchor":"middle"});n.setTitle(g,u);u=C.SvgTextTrimer.trim(u,b.getScaledSize(11),b.getScaledSize(150));n.setText(f,u);l.appendChild(p);l.appendChild(f);n=C.SvgIconHelper.getIconUrl(a);p=b.getSvgHelper();u=p.createNode("image");p.setAttributes(u,{width:b.getScaledSize(20),height:b.getScaledSize(20),x:b.getScaledSize(a.getWidth()-20>>1),y:b.getScaledSize(a.getHeight()-20>>1),href:n});l.appendChild(u)};this.changeNodeDisplayName=
function(){var l=b.getSvgHelper(),n=C.DisplayNameHelper.getNodeDisplayName(a);l.setTitle(g,n);n=C.SvgTextTrimer.trim(n,b.getScaledSize(11),b.getScaledSize(150));l.setText(f,n)};this.getNamePositionRect=function(){var l=C.DisplayNameHelper.getNodeDisplayName(a),n=Math.min(C.SvgTextTrimer.measureText(l),150);n+=20;l=b.getScaledSize(a.getX()+(a.getWidth()-n>>1));var p=b.getScaledSize(a.getY()+a.getHeight()+3);n=b.getScaledSize(n);var u=Math.max(80,n),E=Math.max(14,b.getScaledSize(18));return[l-(u-n>>
1),p,u,E]}}function cb(){function a(J,z,B,I){this.getX1=function(){return J};this.getX2=function(){return B};this.getY1=function(){return z};this.getY2=function(){return I}}var b=!1,f,g,l=[],n,p;this.isPrepared=function(){return b};this.prepare=function(J,z,B){p=B;g=z;J=J.getAllNodes();f=[];for(z=0;z<J.length;z++){var I=J[z];B=I.getX();var ia=I.getY(),aa=B+I.getWidth();I=ia+I.getHeight();f.push(new a(B,ia,aa,I))}b=!0};this.anchor=function(J){V();n=J;var z=!1,B=!1;for(J=0;J<f.length;J++){var I=f[J];
if(!z){z=I;var ia=n[1]+(n[3]>>1);var aa=z.getY1()+z.getY2()>>1;if(10>=Math.abs(aa-ia)){ia=u(z);var pa=p.getScaledSize(aa);E(ia[0],pa,ia[1],pa);n[1]=aa-(n[3]>>1);aa=!0}else aa=!1;aa?z=!0:(ia=n[1],aa=z.getY1(),10>=Math.abs(aa-ia)?(ia=u(z),pa=p.getScaledSize(aa),E(ia[0],pa,ia[1],pa),n[1]=aa,aa=!0):aa=!1,aa?z=!0:(ia=n[1]+n[3],aa=z.getY2(),10>=Math.abs(ia-aa)?(z=u(z),ia=p.getScaledSize(aa),E(z[0],ia,z[1],ia),n[1]=aa-n[3],z=!0):z=!1))}B||(B=I,aa=n[0],I=B.getX1(),10>=Math.abs(I-aa)?(aa=u(B,!0),ia=p.getScaledSize(I),
E(ia,aa[0],ia,aa[1]),n[0]=I,I=!0):I=!1,I||(aa=n[0]+n[2],I=B.getX2(),10>=Math.abs(I-aa)?(B=u(B,!0),aa=p.getScaledSize(I),E(aa,B[0],aa,B[1]),n[0]=I-n[2],I=!0):I=!1),B=I);if(z&&B)break}};this.abort=function(){V()};var u=function(J,z){if(z){z=n[1];var B=J.getY1();z<B?J=J.getY2():(z=B,J=n[1]+n[3])}else z=n[0],B=J.getX1(),z<B?J=J.getX2():(z=B,J=n[0]+n[2]);return p.getScaledCoordinate([z-15,J+15])},E=function(J,z,B,I){var ia=$("<div>");ia.addClass("modeler-designer-auxiliary-line");g.append(ia);l.push(ia);
F.layoutCtrl(ia,J,z,B-J,I-z)},V=function(){for(var J=0;J<l.length;J++)l[J].remove();l=[]}}function qb(){var a=this;this.createNode=function(b){return document.createElementNS("http://www.w3.org/2000/svg",b)};this.createWithAttrs=function(b,f){b=a.createNode(b);a.setAttributes(b,f);return b};this.setText=function(b,f){$(b).empty();f=document.createTextNode(f);b.appendChild(f)};this.setTitle=function(b,f){var g=b.getElementsByTagName("title");0==g.length?(g=a.createNode("title"),b.appendChild(g)):g=
g[0];a.setText(g,f)};this.addClass=function(b,f){$(b).addClass(f)};this.createPath=function(b,f,g,l){var n=a.createNode("path"),p=a.getPathCoordinate(b,f),u=a.getPathCoordinate(b+g,f);g=a.getPathCoordinate(b+g,f+l);b=a.getPathCoordinate(b,f+l);a.setAttributes(n,{d:"M"+p+" L"+u+" L"+g+" L"+b+" Z"});return n};this.setAttributes=function(b,f){for(var g in f)b.setAttribute(g,f[g])};this.getPathCoordinate=function(b,f){return""+b+" "+f}}function wb(){var a=this,b,f,g=[],l,n;this.protectedGetItemModels=
function(){};this.protectedGetListPainter=function(){};this.protectedGetListItemSize=function(){return[100,20]};this.protectedGetSuggestDropdownPos=function(){};this.protectedGetOperateIconHeight=function(){return 0};this.protectedGetOperateIconUi=function(){};this.addSelectedCallback=function(J){g.push(J)};this.setNode=function(J){J!=l&&p();l=J};this.setScaleHelper=function(J){n=J};var p=function(){if(f){var J=$(document.body);J.off("mousedown",V);J.off("mousewheel",E);f.detach();f=null}},u=function(){b=
new Ra;b.setItemModels(a.protectedGetItemModels());b.addPressedListener(function(J,z){p();if((z=J.getSelecteds())&&0!=z.length){for(var B=0;B<g.length;B++)(0,g[B])(z[0],l);J.setSelecteds([])}});b.setCustomItemPainter(function(J,z){var B=a.protectedGetListItemSize()[1];J.css({height:B+"px","line-height":B+"px"});(B=a.protectedGetListPainter())&&B(J,z)})},E=function(J){return F.isDescendent(J.target,b.getJqUi()[0])?!0:!1},V=function(J){var z=a.protectedGetOperateIconUi();z.is(":visible")&&(F.isDescendent(J.target,
z[0])||F.isDescendent(J.target,f[0]))||p()};this.protectedMethod={getNode:function(){return l},doDropdown:function(){console.log("do drop down");if(f)p();else{b||u();var J=$(document.body),z=a.protectedGetSuggestDropdownPos(),B=z[0],I=z[1],ia=J.prop("clientHeight"),aa=a.protectedGetListItemSize()[1],pa=a.protectedGetItemModels().length;aa=Math.min(pa*aa+2,(ia>>1)-10);I+aa>ia&&(z=z[1]-aa-a.protectedGetOperateIconHeight(),0<=z&&(I=z));z=a.protectedGetListItemSize()[0];f=$("<div>");f.css("cursor","pointer");
f.css("position","absolute");f.css("left",B+"px");f.css("top",I+"px");f.css("width",z+"px");f.css("height",aa+"px");f.css("box-shadow","0 0 2px 0 #ccc");f.css("z-index","999999");f.appendTo(J);B=b.getJqUi();B.appendTo(f);B.css("position","absolute");B.css("left","0px");B.css("top","0px");B.css("width","100%");B.css("height","100%");b.scrollSelectedToVisible();J.on("mousedown",V);J.on("mousewheel",E)}},getScaledSize:function(J){return n?n.getScaledSize(J):J},getScaledCoordinate:function(J){return n?
n.getScaledCoordinate(J):J}}}function Ab(a){Ma.call(this);var b=this.protectedMethod,f=this,g,l,n;(function(){b.setTitle(D.get("linkOtherNode","\u8fde\u63a5\u5176\u4ed6\u8282\u70b9"));f.setSize(300,280);b.setContentPaneCreator(function(){l||(l=new Vb(a),l.setGlobal(g));return l.getJqUi()});b.setClosingChecker2(function(p){p=l.getLinkNode();n&&n(p,a);return!0});b.setClosingAction(function(p){})})();this.setGlobal=function(p){g=p};this.getLinkableNode=function(){l||(l=new Vb(a),l.setGlobal(g));return l.getLinkableNode()};
this.setLinkCallback=function(p){n=p}}function Vb(a){var b=this,f,g,l,n=[];this.getJqUi=function(){if(!f){f=$("<div>");var p=$("<div>");n=[];l=new sa;for(var u=b.getLinkableNode(),E=0,V=0;V<u.length;V++){var J=u[V],z=new Va;z.setUserObject(J);z.setText(C.DisplayNameHelper.getNodeDisplayName(J));n.push(z);0==V&&z.setChecked(!0);l.addElement(z);J=z.getJqUi();F.layoutCtrl(J,0,E,200,25);J.appendTo(p);E+=30}F.layoutCtrlWithLRTB(p,0,0,null,0,0,null);p.css("overflow","scroll");p.appendTo(f)}return f};this.setGlobal=
function(p){g=p};this.getLinkNode=function(){for(var p=0;p<n.length;p++){var u=n[p];if(u.isChecked())return u.getUserObject()}};this.getLinkableNode=function(){return C.ModelConverter.getLinkableNodes(g.getModelerModel(),a)}}function Db(){Ma.call(this);var a=this.protectedMethod,b=this,f,g,l,n;(function(){a.setTitle(D.get("joinSetting","\u5173\u8054\u8868\u8bbe\u7f6e"));a.setSelectable(!0);a.setContentPaneCreator(function(){f||p();b.setSize(570,420);var u=f.getJqUi();u.css("overflow","scroll");return u});
a.setFooterPaneCreator(function(u){var E=new qa(D.get("confirm","\u786e\u5b9a"));E.setHighlight(!0);var V=E.getJqUi();V.addClass("sa-ctrl-dialog-footer-ok");V.appendTo(u);E.addActionListener(function(J){var z=C.TransformNodeFactory.createTransformNode(La.TYPE_JOIN),B=f.getConfig();f.checkModelValid(B,function(I){if(I)return a.getMessageCurtain().showPrompt(I),!1;I=B.getRelationModel().getRight();I=l.getNode(I);z.addExtraFromNode(I);z.setConfig(B);n(z);a.destroy();return!0})});E=new qa(D.get("cancel",
"\u53d6\u6d88"));E.setHighlight(!1);V=E.getJqUi();V.addClass("sa-ctrl-dialog-footer-cancel");V.appendTo(u);E.addActionListener(function(J){a.destroy();return!0})});a.setClosingAction(function(u){})})();this.setNodeCreateCallback=function(u){n=u};this.setFromNode=function(u){g=u};this.setModelerModel=function(u){l=u};this.getNodeToJoin=function(){f||p();return f.getNodeToJoin()};var p=function(){f=new ub;f.setLeftNode(g);f.setModelerModel(l)}}function ub(){function a(){var y=this,K,da,Ba,Bb;this.getJqUi=
function(){K||zb();return K};this.setSelectedChangedListener=function(Ub){Ba=Ub};this.setItemModels=function(Ub){Bb=Ub;K||zb();y.protectedSetItemModels(Ub);Ub=y.getSelected();0>Bb.indexOf(Ub)&&y.setSelected(null)};this.protectedSetItemModels=function(Ub){throw Error("Implement");};this.getItemModels=function(){return Bb};this.setEnabled=function(Ub){y.protectedGetChooseCtrl()&&y.protectedGetChooseCtrl().setEnabled(Ub)};this.getSelected=function(){if(K)return y.protectedGetSelected()};this.protectedGetSelected=
function(){throw Error("Implement");};this.setSelected=function(Ub){K||zb();y.protectedSetSelected(Ub)};this.protectedSetSelected=function(Ub){throw Error("Implement");};this.setInvalidPrompt=function(Ub){Ub?(da||(da=$("<div>"),da.appendTo(K),F.layoutCtrl(da,0,4,16,16),bb.background(da,"qingWarning")),da.show(),da.attr("title",Ub),F.layoutCtrlWithLRTB(y.protectedGetChooseCtrl().getJqUi(),16,0,null,0,0,null)):da&&(da.hide(),F.layoutCtrlWithLRTB(y.protectedGetChooseCtrl().getJqUi(),0,0,null,0,0,null))};
this.protectedInit=function(Ub){throw Error("Implement");};this.protectedGetChooseCtrl=function(){throw Error("Implement");};var zb=function(){K=$("<div>");y.protectedInit(K)};this.protectedMethod={fireSelectedChangedEvent:function(Ub){Ba&&Ba(Ub)}}}function b(){a.call(this);var y=this.protectedMethod,K;this.protectedSetItemModels=function(Ba){K.setItemModels(Ba)};this.protectedSetSelected=function(Ba){K.setSelected(Ba)};this.protectedGetSelected=function(){return K.getSelected()};this.protectedInit=
function(Ba){K=new Ka;K.setCustomPainter(da);K.addSelectedChangedListener(function(zb,Ub,Pb){y.fireSelectedChangedEvent(Pb)});var Bb=K.getJqUi();Ba.append(Bb)};this.protectedGetChooseCtrl=function(){return K};this.setEnabled=function(Ba){K&&K.setEnabled(Ba)};var da=function(Ba,Bb,zb){zb&&V.getNode(zb.getId())&&(Ba=$("<div>"),Ba.addClass("modeler-propertyarea-join-relation-node-icon"),bb.background(Ba,"TABLE"),Ba.appendTo(Bb),zb=C.DisplayNameHelper.getNodeDisplayName(zb),Ba=$("<div>"),Ba.addClass("modeler-propertyarea-join-relation-node-text"),
Ba.text(zb),Ba.attr("title",zb),Ba.appendTo(Bb))}}function f(){a.call(this);var y=this.protectedMethod,K,da;this.protectedSetItemModels=function(Ba){K&&K.setItemModel(Ba)};this.protectedSetSelected=function(Ba){da.setSelectedModel(Ba)};this.protectedGetSelected=function(){return da.getSelectedModel()};this.protectedInit=function(Ba){K=(new O).createChooseFieldPanel(V,!0);da=new Eb;da.setDropdownCreator(function(zb,Ub,Pb){return K.createJqPopup(zb,Ub,Pb)});da.addSelectionListener(function(zb,Ub){Ub&&
(zb=zb.getSelectedModel(),y.fireSelectedChangedEvent(zb))});da.setCustomPainter(function(zb,Ub){zb?(Ub.text(zb.getAlias()),Ub.attr("title",zb.getAlias())):Ub.text("")});var Bb=da.getJqUi();Ba.append(Bb)};this.protectedGetChooseCtrl=function(){return da}}function g(y){var K,da,Ba,Bb,zb,Ub;this.setConfig=function(tb,Jb){(K=tb)?mb():Kb()};this.setLeftNode=function(tb){da=tb;K?mb():Kb()};this.getNodePair=function(){return[Bb.getSelected(),zb.getSelected()]};this.setNodeChangeListener=function(tb){Ub=
tb};this.getJqUi=function(){Ba||Pb();return Ba};var Pb=function(){Ba=$("<div>");Ba.addClass("modeler-propertyarea-lineitem");Bb=new b;var tb=Bb.getJqUi();Bb.setEnabled(!1);Bb.setSelectedChangedListener(function(Jb){Bb.setInvalidPrompt();Ub&&Ub(Jb,!0)});tb.addClass("modeler-propertyarea-join-combobox-left");tb.appendTo(Ba);zb=new b;tb=zb.getJqUi();zb.setSelectedChangedListener(function(Jb){zb.setInvalidPrompt();Ub&&Ub(Jb)});tb.appendTo(Ba);tb.addClass("modeler-propertyarea-join-combobox-right")},mb=
function(){var tb=y.getNode(K.getLeft()),Jb=y.getNode(K.getRight()),Sb,Yb,ac=D.get("nodeNotFound","\u8282\u70b9\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664");tb||(Sb=ac);Jb||(Yb=ac);Bb.setInvalidPrompt(Sb);zb.setInvalidPrompt(Yb);tb?(tb=y.getNode(K.getLeft()),Bb.setItemModels([tb]),Sb=nb(tb),zb.setItemModels(Sb)):Jb&&zb.setItemModels([Jb]);Bb.setSelected(tb);zb.setSelected(Jb)},Kb=function(){Bb.setItemModels([da]);Bb.setSelected(da);var tb=nb(da);zb.setItemModels(tb);0<tb.length&&zb.setSelected(tb[0])}}
function l(){var y=this,K,da,Ba,Bb,zb,Ub;this.getJqUi=function(){K||Pb();return K};this.autoMatchField=function(){if(da&&Ba){var Kb=da.getItemModels(),tb=Ba.getItemModels();if(Kb&&tb)for(var Jb=0;Jb<Kb.length;Jb++)for(var Sb=0;Sb<tb.length;Sb++){var Yb=Kb[Jb],ac=tb[Sb];if(Yb.getAlias()==ac.getAlias()){da.setSelected(Yb);da.setInvalidPrompt();Ba.setSelected(ac);Ba.setInvalidPrompt();return}}}};this.setRemovable=function(Kb){Kb?Ub.show():Ub.hide()};this.setLeftEnabled=function(Kb){da&&da.setEnabled(Kb)};
this.setRightEnabled=function(Kb){Ba&&Ba.setEnabled(Kb)};this.setDeleteCallback=function(Kb){zb=Kb};this.remove=function(){K&&K.remove()};this.getFieldPair=function(){return[da.getSelected(),Ba.getSelected()]};this.setLeftRelation=function(Kb,tb){if(da){var Jb=da.getSelected();!tb&&Jb&&(tb=Jb);da.setItemModels(Kb);mb(Kb,!0,tb)}};this.setRelationChangeListener=function(Kb){Bb=Kb};this.setRightRelation=function(Kb,tb){if(Ba){var Jb=Ba.getSelected();!tb&&Jb&&(tb=Jb);Ba.setItemModels(Kb);mb(Kb,!1,tb)}};
this.getFieldPair=function(){return[da.getSelected(),Ba.getSelected()]};var Pb=function(){K=$("<div>");da=new f;var Kb=da.getJqUi();Kb.addClass("modeler-propertyarea-join-combobox-left");da.setSelectedChangedListener(function(Sb){Sb&&(da.setInvalidPrompt(),Bb&&Bb())});Ba=new f;var tb=Ba.getJqUi();Ba.setSelectedChangedListener(function(Sb){Sb&&(Ba.setInvalidPrompt(),Bb&&Bb())});tb.addClass("modeler-propertyarea-join-combobox-right");var Jb=$("<div>");Jb.text("=");Jb.appendTo(K);Jb.addClass("modeler-propertyarea-join-equal");
Jb=new Wa;Jb.setText("\u00d7");Jb.addActionListener(function(Sb){y.remove();zb&&zb(y)});Ub=Jb.getJqUi();Ub.appendTo(K);F.layoutCtrlWithLRTB(Ub,null,0,18,3,null,18);Ub.css("z-index",999);Kb.appendTo(K);tb.appendTo(K)},mb=function(Kb,tb,Jb){tb=tb?da:Ba;for(var Sb,Yb=0;Yb<Kb.length;Yb++){var ac=Kb[Yb];if(Jb&&ac.getFullName()==Jb.getFullName()){Sb=ac;break}}if(Sb)tb.setSelected(Sb);else if(Jb){var cc=D.get("fieldNotExist","\u5b57\u6bb5\u4e0d\u5b58\u5728");tb.setSelected(Jb)}else cc=D.get("noFieldSelect",
"\u672a\u9009\u62e9\u5b57\u6bb5");tb.setInvalidPrompt(cc)}}function n(){var y,K,da=[];this.isValid=function(){return K||y||0<da.length?!1:!0};this.isLackLeftNode=function(){return y};this.setLackLeftNode=function(Ba){y=Ba};this.isLackRightNode=function(){return K};this.setLackRightNode=function(Ba){K=Ba};this.getInvalidRelationIdx=function(){return da};this.addInvalidRelationIdx=function(Ba){0>da.indexOf(Ba)&&da.push(Ba)}}var p,u,E,V,J,z,B=[],I=[],ia,aa,pa,la=[ma.TYPE_LEFT_JOIN,ma.TYPE_RIGHT_JOIN,
ma.TYPE_INNER_JOIN,ma.TYPE_FULL_JOIN],X,$a;this.setLeftNode=function(y){E=y};this.setJoinConfig=function(y){J=y};this.setModelerModel=function(y){V=y};this.getJqUi=function(){p||pb();return p};this.getConfig=function(){for(var y=new ma,K,da=0;da<I.length;da++){var Ba=I[da];Ba.isChecked()&&(K=Ba.getUserObject())}da=z.getNodePair();var Bb;(Ba=da[0])&&(Bb=Ba.getId());var zb;(da=da[1])&&(zb=da.getId());da=Zb();y.init(K,Bb,zb,da);return y};this.updateUi=function(){Rb()};this.setJoinTypeChangeListener=
function(y){X=y};this.setRelationChangeListener=function(y){$a=y};this.checkModelValid=function(y,K){y.getJoinType()?(y=y.getRelationModel(),Ib(y,function(da){da.isValid()?K():K(D.get("invalidJoinConfig","\u5173\u8054\u8868\u8bbe\u7f6e\u4e0d\u5b8c\u6574\u3002"))})):K(D.get("invalidJoinConfig","\u5173\u8054\u8868\u8bbe\u7f6e\u4e0d\u5b8c\u6574\u3002"))};this.getNodeToJoin=function(){return nb(E)};var nb=function(y){y=C.ModelConverter.getLinkableNodes(V,y);if(J){var K=J.getRelationModel();(K=V.getNode(K.getRight()))&&
y.splice(0,0,K)}return y},Ib=function(y,K){var da=new n;V.getNode(y.getRight())||da.setLackRightNode(!0);V.getNode(y.getLeft())||da.setLackLeftNode(!0);if(da.isValid()){for(var Ba=y.getRelations(),Bb=0;Bb<Ba.length;Bb++){var zb=Ba[Bb];zb[0]&&zb[1]||da.addInvalidRelationIdx(Bb)}Gb(y,da,K)}else K(da)},Gb=function(y,K,da){vb(y,K,function(Ba){Ba.isValid()?sb(y,Ba,da):da(Ba)})},vb=function(y,K,da){sb(y,K,da,!0)},sb=function(y,K,da,Ba){var Bb=Ba?y.getLeft():y.getRight(),zb=Ba?0:1;Ba=V.getNode(Bb);C.NodeFieldHelper.asynGetFields(V,
Ba,function(Ub){for(var Pb=y.getRelations(),mb=0;mb<Pb.length;mb++){var Kb=Pb[mb][zb];if(!Kb){K.addInvalidRelationIdx(mb);break}Kb=Kb.getFullName();for(var tb=!1,Jb=0;Jb<Ub.length;Jb++)if(Ub[Jb].getFullName()==Kb){tb=!0;break}tb||K.addInvalidRelationIdx(mb)}da(K)})},Rb=function(){p||pb();if(J){for(var y=J.getJoinType(),K=0;K<I.length;K++)if(I[K].getUserObject()==y){I[K].setChecked(!0);break}K=J.getRelationModel();Xb();y=K.getRelations();for(K=0;K<y.length;K++)Da();z.setConfig(J);K=V.getNode(J.getLeft());
y=V.getNode(J.getRight());K&&na(K,!0);y&&na(y)}else Xb(),Da(),z.setLeftNode(E),y=z.getNodePair(),K=y[0],y=y[1],K&&na(K,!0,Wb),y&&na(y,!1,Wb);ua()},Wb=function(){!B||1>B.length||B[0].autoMatchField()},Xb=function(){for(var y=0;y<B.length;y++)B[y].remove();B=[]},Zb=function(){for(var y=[],K=0;K<B.length;K++)y.push(B[K].getFieldPair());return y},pb=function(){p=$("<div>");var y=Fa(D.get("joinType","\u5173\u8054\u7c7b\u578b")),K=$("<div>");K.addClass("modeler-propertyarea-adaptive-lineitem");u=new sa;
for(var da=0;da<la.length;da++){var Ba=void 0,Bb=void 0,zb=la[da],Ub=$("<div>");Ub.addClass("modeler-propertyarea-join-radioitem");var Pb=new Va;I.push(Pb);1==I.length&&Pb.setChecked(!0);Pb.addCheckedListener(A);u.addElement(Pb);Pb.setUserObject(zb);Pb=Pb.getJqUi();switch(zb){case ma.TYPE_LEFT_JOIN:Bb=D.get("leftJoin","\u5de6\u8fde\u63a5");break;case ma.TYPE_RIGHT_JOIN:Bb=D.get("rightJoin","\u53f3\u8fde\u63a5");break;case ma.TYPE_INNER_JOIN:Bb=D.get("innerJoin","\u5185\u8fde\u63a5");break;case ma.TYPE_FULL_JOIN:Bb=
D.get("fullJoin","\u5916\u8fde\u63a5")}var mb=$("<div>");mb.text(Bb);var Kb=$("<div>"),tb=bb,Jb=tb.background;switch(zb){case ma.TYPE_LEFT_JOIN:Ba="leftJoin";break;case ma.TYPE_RIGHT_JOIN:Ba="rightJoin";break;case ma.TYPE_INNER_JOIN:Ba="innerJoin";break;case ma.TYPE_FULL_JOIN:Ba="fullJoin"}Jb.call(tb,Kb,Ba);F.layoutCtrlWithLRTB(Pb,0,0,null,0,null,23);F.layoutCtrlMiddleAlign(Kb,20);F.layoutCtrl(Kb,22,null,20,20);F.layoutCtrl(mb,50,null,70,23);F.layoutCtrlMiddleAlign(mb,23);mb.css({color:"#666","line-height":"23px"});
Ub.append(mb);Ub.append(Pb);Ub.append(Kb);Ub.attr("title",Bb);Ub.appendTo(K)}da=Fa(D.get("joinConfig","\u5173\u8054\u4f9d\u636e"));Ba=r();zb=R();p.append(y);p.append(K);p.append(da);p.append(Ba);p.append(zb);Rb()},Fa=function(y){var K=$("<div>");y=(new w(y)).getJqUi();K.addClass("modeler-propertyarea-lineitem");K.append(y);F.layoutCtrlWithLRTB(y,0,0,null,0,0,null);return K},R=function(){var y=$("<div>");y.css({position:"relative",overflow:"auto"});var K=new Wa;K.setText(D.get("addJoinField","\u6dfb\u52a0\u5173\u8054\u5b57\u6bb5"));
pa=K.getJqUi();K.addActionListener(function(da){da=Da();var Ba=z.getNodePair();ia?da.setLeftRelation(ia):Ba&&Ba[0]&&na(Ba[0],!0);aa?da.setRightRelation(aa):Ba&&Ba[1]&&na(Ba[1])});pa.addClass("modeler-designer-add-btn");y.append(pa);return y},Da=function(){var y=new l;y.setRelationChangeListener(t);y.setDeleteCallback(function(da){da=B.indexOf(da);-1<da&&(B.splice(da,1),ua());t()});var K=y.getJqUi();K.addClass("modeler-propertyarea-lineitem");K.css("height","25px");K.insertBefore(pa);B.push(y);ua();
return y},ua=function(){var y=!1,K=!1,da=z.getNodePair();da[0]&&V.getNode(da[0].getId())&&(y=!0);da[1]&&V.getNode(da[1].getId())&&(K=!0);da=1<B.length;for(var Ba=0;Ba<B.length;Ba++){var Bb=B[Ba];Bb.setRemovable(da);Bb.setLeftEnabled(y);Bb.setRightEnabled(K)}},t=function(){if($a){var y=Zb(),K=J.getRelationModel(),da=z.getNodePair(),Ba=da[0];Ba&&K.setLeft(Ba.getId());(da=da[1])&&K.setRight(da.getId());K.setRelations(y);Ib(K,function(Bb){Bb.isValid()&&$a(K)})}},r=function(){z=new g(V);var y=z.getJqUi();
z.setNodeChangeListener(function(K,da){ua();na(K,da,function(){Wb();t()})});y.addClass("modeler-propertyarea-lineitem");return y},A=function(y,K){K&&X&&X(y.getUserObject())},v=!1,S=!1,na=function(y,K,da){!y||K&&v||!K&&S||(K?v=!0:S=!0,C.NodeFieldHelper.asynGetFields(V,y,function(Ba){var Bb=K?0:1;K?ia=Ba:aa=Ba;K?v=!1:S=!1;for(var zb=0;zb<B.length;zb++){var Ub=void 0,Pb=B[zb];if(J){var mb=J.getRelationModel().getRelations()[zb];mb&&(mb=mb[Bb])&&(Ub=mb)}K?Pb.setLeftRelation(Ba,Ub):Pb.setRightRelation(Ba,
Ub)}da&&da()},function(){K?v=!1:S=!1}))}}function Hb(){function a(){Xa.FieldsProvider.call(this);var B=this.protectedMethod,I=new b;(function(){I.setCustomItemPainter(function(ia,aa){var pa=$("<div>");pa.addClass("modeler-designer-calculated-field-list-item-icon");bb.background(pa,aa.getOutputDataType());pa.appendTo(ia);pa=$("<div>");pa.addClass("modeler-designer-calculated-field-list-item-text");pa.text(aa.getAlias());pa.appendTo(ia)});I.addDBLClickListener(function(ia){ia="["+ia.getSelecteds()[0].getAlias()+
"]";B.fireChoosingEvent(ia)})})();this.setAllFields=function(ia){I.setAllFields(ia)};this.getJqUi=function(){return I.getJqUi()}}function b(){var B,I=$("<div>"),ia,aa;this.setAllFields=function(pa){B=pa};this.getJqUi=function(){var pa=$("<div>"),la=new Qb;la.setSearchListenerDelay(200);la.setPlaceholder(D.get("search","\u641c\u7d22"));la.addSearchListener(function(){var $a=la.getText().trim(),nb=new Ra;if($a){for(var Ib=[],Gb=0;Gb<B.length;Gb++){var vb=B[Gb];0<=vb.getAlias().toUpperCase().indexOf($a.toUpperCase())&&
Ib.push(vb)}I.empty();0<Ib.length?nb.setItemModels(Ib):($a=new w,$a.setText(D.get("nothingSearched","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),$a.setEnabled(!1),$a.setAlign(w.ALIGN_CENTER),$a=$a.getJqUi(),$a.addClass("modeler-designer-calculated-field-list-item-search-result"),$a.appendTo(I))}else I.empty(),nb.setItemModels(B);nb.addDBLClickListener(ia);nb.setCustomItemPainter(aa);nb.getJqUi().appendTo(I)});var X=la.getJqUi();X.addClass("modeler-designer-calculated-field-list-item-search");
X.appendTo(pa);X=new Ra;X.setItemModels(B);X.addDBLClickListener(ia);X.setCustomItemPainter(aa);I.addClass("modeler-designer-calculated-field-list-item-list");X.getJqUi().appendTo(I);I.appendTo(pa);return pa};this.setCustomItemPainter=function(pa){aa=pa};this.addDBLClickListener=function(pa){ia=pa}}Ma.call(this);var f=this,g=this.protectedMethod,l=new Xa,n,p,u,E;(function(){f.setSize(800,570);g.setSelectable(!0);g.setContentPaneCreator(function(){return l.getJqUi()});g.setClosingChecker(function(){var B=
l.isValidToAccepted();if(B){var I,ia=l.getEditedDisplayName();ia&&50<ia.length&&(I=D.get("nameTooLongPrompt","\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002"));if(I)return g.getMessageCurtain().showPrompt(I),!1}return B});g.setClosingAction(function(B){if(B&&(l.acceptEditing(),B=l.getEditedDisplayName(),E.setAlias(B),E.setFormula(l.getEditedExecutableFormula()),n(),p)){var I=C.TransformNodeFactory.createTransformNode(La.TYPE_CALCULATED_FIELD);E.setFromNode(I.getId());I.getConfig().setCalculatedFields([E]);
p(I);C.FieldNumberHelper.generateDefaultNumberByAssignedName(E,E.getAlias());B=I.getFieldSettingConfig();B||(B=new C.FieldSettingConfig,I.setFieldSettingConfig(B));I=[];var ia=new Ca;ia.setName(E.getName());ia.setFromNode(E.getFromNode());ia.setAlias(E.getAlias());I.push(ia);B.setModifiedField(I,!0)}});l.setFunctionsProviderCreator(function(B){return B.getInstanceForDataModeling()});l.setDuplicatedNameChecker(function(B,I){a:{for(var ia=0;ia<u.length;ia++){var aa=u[ia];if(B!=aa.getName()&&I==aa.getAlias()){B=
!0;break a}}B=!1}return B});l.setDisplayNameTranslator(function(B,I){return I?J(B):V(B)})})();this.setSyntaxValidator=function(B){l.setSyntaxValidator(B)};this.setContext=function(B,I,ia){var aa=B,pa=D.get("addCustomField","\u65b0\u5efa\u8ba1\u7b97\u5b57\u6bb5");if(ia)for(aa=[],pa=D.get("modifyCustomField","\u7f16\u8f91\u8ba1\u7b97\u5b57\u6bb5"),ia=0;ia<B.length;ia++)B[ia].getFullName()!==I.getFullName()&&aa.push(B[ia]);u=aa;E=I;g.setTitle(pa)};this.edit=function(B,I,ia){n=I;p=ia;I=new a;I.setAllFields(u);
l.setFieldsProvider(I);B=B?E.getAlias():"";l.setEditingTarget(E.getName(),B,E.getFormula());f.showDialog();l.prepareToStart()};var V=function(B){return z(B,function(I){return I.getAlias()},function(I){return I.getFullName()})},J=function(B){return z(B,function(I){return I.getFullName()},function(I){return I.getAlias()})},z=function(B,I,ia){for(var aa={},pa=0;pa<u.length;pa++){var la=u[pa],X="["+I(la)+"]";la="["+ia(la)+"]";if(X!=la)for(var $a=null;-1!=B.indexOf(X);)$a||($a="["+x.createUUID()+"]",aa[$a]=
la),B=B.replace(X,$a)}for($a in aa)for(la=aa[$a];-1!=B.indexOf($a);)B=B.replace($a,la);return B}}function Ea(a){Ma.call(this);var b=this.protectedMethod,f=this,g,l,n,p,u;(function(){if(a){var J=a.getConfig().copyFilterItems();g=new Na(J)}else g=new Na([]);b.setTitle(D.get("filterCondition","\u8fc7\u6ee4\u6761\u4ef6"));b.setSelectable(!0);b.setContentPaneCreator(function(){g.setFromNode(l);g.setModelerModel(n);f.setSize(800,450);return g.getJqUi()});b.setFooterPaneCreator(function(z){var B=new qa(D.get("confirm",
"\u786e\u5b9a"));B.setHighlight(!0);var I=B.getJqUi();I.addClass("sa-ctrl-dialog-footer-ok");I.appendTo(z);B.addActionListener(function(ia){if(ia=g.checkModelValid())b.getMessageCurtain().showPrompt(ia);else{ia=g.getFilterItem();if(a)u&&u(ia);else{a=C.TransformNodeFactory.createTransformNode(La.TYPE_FILTER);var aa=new ra;aa.setFilterItems(ia);a.setConfig(aa);p&&p(a)}E()}});B=new qa(D.get("cancel","\u53d6\u6d88"));B.setHighlight(!1);I=B.getJqUi();I.addClass("sa-ctrl-dialog-footer-cancel");I.appendTo(z);
B.addActionListener(function(ia){E()})});b.setClosingAction(function(z){E()})})();this.updateTableUi=function(J){J?J(function(z){V(z)}):C.NodeFieldHelper.asynGetFields(n,l,function(z){V(z)})};this.setAfterSetCallback=function(J){p=J};this.setConfigChangeListen=function(J){u=J};this.setFromNode=function(J){l=J};this.setModelerModel=function(J){n=J};var E=function(){b.destroy();g.destroy()},V=function(J){J||(J=[]);g.setFields(J);g.updateUi()}}function Na(a){function b(R){KTDefaultCellRender.call(this,
R);var Da=this,ua=this.paintCellUI;this.paintCellUI=function(t,r){if(Da.getCurrentRowIdx()<U.getHeadRowCount()||!Da.getCell())ua(t,r);else{var A=Da.getCellWidth(),v=Da.getCellHeight(),S=Da.getCurrentRow();if(0==Da.getCurrentColIdx())S=Da.getCell().getValue(),t=$(t),t.find(".modeler-designer-filter-table-prompt").remove(),S&&(A=ba.createWarning(),A.addClass("modeler-designer-filter-table-prompt"),A.attr("title",S),A.appendTo(t));else if(1==Da.getCurrentColIdx()||5==Da.getCurrentColIdx()){r=1==Da.getCurrentColIdx();
var na=Da.getCell().getValue();la(t,A,v,r,na,S)}else if(2==Da.getCurrentColIdx())r=Da.getCell().getValue(),X(t,A,v,r,S);else if(3==Da.getCurrentColIdx()){r=Da.getCell().getValue();var y=S.getUserObject().getField();na=y?y.getOutputDataType():null;y=y?y.isEnum():!1;t=U.createCtrlInCell(t,A,v,Ka);t.setSelected(r);t.setItemModels(na?ta.getSelectableCompares(na,y):[]);t.setUserObject(S);t.setCustomPainter($a);t.addSelectedChangedListener(sb)}else 4==Da.getCurrentColIdx()?(r=Da.getCell().getValue(),nb(t,
A,v,r,S)):6==Da.getCurrentColIdx()?(r=Da.getCell().getValue(),Gb(t,A,v,r,S)):ua(t,r)}}}function f(){Ma.call(this);var R=this,Da=this.protectedMethod,ua;this.edit=function(t,r,A){Da.setTitle(D.get("relativeDateRange","\u76f8\u5bf9\u65e5\u671f"));ua||(R.setSize(450,430),ua=new Ta,ua.setContainsTime(r),r=new Aa,r.fromJsonObject(t.toJsonObject()),ua.setModel(r),Da.setContentPaneCreator(function(){return ua.getJqUi()}),Da.setClosingAction(function(v){v&&(v=ua.getModel(),A(v))}))}}function g(){Ma.call(this);
var R=this,Da=this.protectedMethod,ua=new w,t=new w,r=new Ya,A,v;this.setCaption=function(y,K){Da.setTitle(y);ua.setText(K)};this.setText=function(y,K){r.setText(y);var da=0;y&&(y=y.split("\n").length,da=1E3<y?1E3:y);t.setText(da+"/1000\u9879");v=function(Ba){var Bb=Ba?$.trim(r.getText()):null;K(Ba,Bb)};Da.setClosingAction(v)};this.showDialogLeftAnchorTo=function(y){y&&(R.setSize(470,450),y=F.upwardCoordinate(document.body,[0,0],document.body),R.setPosition(Math.max(0,y[0]-10),Math.max(6,y[1]-450+
40)));r.addEditedListener(na);Da.setContentPaneCreator(S);R.showDialog();r.requestFocus()};this.setClosingChecker=function(y){y&&(A=function(){var K=y($.trim(r.getText()));K&&Da.getMessageCurtain().showPrompt(K);return K?!1:!0},Da.setClosingChecker(A))};var S=function(){t.setAlign(w.ALIGN_RIGHT);F.layoutCtrlWithLRTB(ua.getJqUi(),0,0,null,0,null,23);F.layoutCtrlWithLRTB(r.getJqUi(),0,0,null,30,null,260);F.layoutCtrlWithLRTB(t.getJqUi(),290,0,null,287,null,23);var y=$("<div>");y.append(ua.getJqUi());
y.append(r.getJqUi());y.append(t.getJqUi());return y},na=function(y){var K=y.getText(),da=[];K&&(da=K.trim().replace(/(\n\s*)+/g,"\n").split("\n"));K=da.length;1E3<K&&(y.setText(da.slice(0,1E3).join("\n")),K=1E3);t.setText(K+"/1000\u9879");Da.getMessageCurtain().hide()}}function l(){var R=[],Da,ua,t=[],r=[],A;this.setItemModel=function(y,K){A=K;R=y};this.setListItemPainter=function(y){};this.setSelectedItemModel=function(y){t=y;r=t.slice(0)};this.setLastTimeSelectedModel=function(y){r=y};this.getSelectedItemModel=
function(){return t};this.createJqPopup=function(y,K,da,Ba){Da=$("<div>");Da.appendTo(y);ua=$("<div>");Da.addClass("modeler-designer-field-popup");ua.addClass("modeler-designer-enum-popup-list-owner");for(y=0;y<R.length;y++)S(R[y],ua,K,!1);K=new qa;K.setHighlight(!0);K.setText(D.get("ok","\u786e\u5b9a"));K=K.getJqUi();K.css("z-index",3);K.css("margin-left",10);F.layoutCtrlWithLRTB(K,"50%",null,50,null,8,28);K.on("click",function(Bb){r=t.slice(0);da(t)});y=new qa(D.get("cancle","\u53d6\u6d88"));y.setHighlight(!1);
y=y.getJqUi();y.css("z-index",3);y.css("margin-left",-80);F.layoutCtrlWithLRTB(y,"50%",null,50,null,8,28);y.on("click",function(Bb){t=r.slice(0);Ba()});ua.appendTo(Da);K.appendTo(Da);y.appendTo(Da);ua.css("height","77%");return[-1,260]};var v=function(y,K){K=y.getUserObject();y=y.isChecked();K&&y?(y=na(K),0>y&&t.push(K)):K&&!y&&(y=na(K),-1<y&&t.splice(y,1))},S=function(y,K,da){var Ba=na(y);da=$("<div>");da.addClass("modeler-designer-field-popup-list-item");da.data("model",y);var Bb=$("<div>"),zb=
new kb;zb.setUserObject(y);zb.setChecked(-1<Ba);zb.addCheckedListener(v);Ba=zb.getJqUi();Ba.addClass("modeler-designer-field-selection-checkbox-icon");Ba.data("model",zb);zb=$("<div>");zb.text(y.fieldValue);zb.addClass("modeler-designer-field-selection-checkbox-text");Bb.append(Ba);Bb.append(zb);da.append(Bb);K.append(da)},na=function(y){for(var K=0;K<t.length;K++)if(A(y,t[K]))return K;return-1}}var n=this,p,u,E,V=[],J,z;this.setFromNode=function(R){};this.setModelerModel=function(R){E=R};this.setFields=
function(R){V=R};this.getJqUi=function(){p||B();return p};this.getFilterItem=function(){return a};var B=function(){p=$("<div>");J=U.createTable();J.setDraggableAdjusting(!1);J.setSyncUIWhenModelChanged(!0);J.setColumnFitVisibleWidth(!0);J.setScrollerVisible("hidden","auto");U.bindTextEditor(J,I,aa);U.bindTableListenerForCtrl(J,pa);var R=new b(J);R.setOutsideVisible(!1);J.setCellRender(R);R=$(J.getUI());F.layoutCtrlWithLRTB(R,5,5,null,5,5,null);R.css("border","1px solid #dbdbdb");R.appendTo(p);z=new rb;
z.setCallbackImmediately(function(){n.updateUi()});z.observe();return p};this.destroy=function(){z.unobserve()};this.locateToErrorRow=function(R,Da){for(var ua=U.getHeadRowCount();ua<J.getRowsCount();ua++)J.getRow(ua).getCell(0).setValue("");-1!=R&&J.getRow(R+U.getHeadRowCount()).getCell(0).setValue(Da)};this.checkModelValid=function(){var R=C.FilterCheckHelper.checkFilterField(a,V);if(R||(R=C.FilterCheckHelper.checkFilterLogical(a)))return n.locateToErrorRow(R.getFiltersErrorRow(),R.getPrompt()),
R.getPrompt();n.locateToErrorRow(-1);return null};var I=function(R,Da){if(4!=Da)return!1;R=J.getRow(R).getUserObject();Da=R.getCompareOp();if(ta.isCompareOpWithoutValue(Da)||ta.isCompareOpWithinOrNotWithinValue(Da)||!C.FilterCheckHelper.checkFieldExisted(R,V))return!1;R=R.getField();return ia(R)},ia=function(R){var Da=R?R.getOutputDataType():null;return R&&R.isMulBaseData()?!0:Da?(R=R?R.isEnum():!1,(Da==Ca.DT_STRING||Da==Ca.DT_NUMBER||Da==Ca.DT_INT)&&!R):!1},aa=function(R,Da,ua,t,r){R=R.getUserObject();
R.getValue()!==t&&(R.setValue(t),ua.setValue(t),n.checkModelValid());return!0},pa=function(R,Da,ua,t){R=null;if(Da){Da=KTableUIAbstractView.createCellId(J.getRow(ua),J.getColumn(J.getColumnsCount()-1));R=n.getJqUi().find("#"+Da);var r=ua-U.getHeadRowCount();ua=$("<div>");ua.text(D.get("insertRow","\u63d2\u5165"));ua.addClass("modeler-designer-filter-table-op");ua.css("left","4px");ua.appendTo(R);ua.on("click",function(A){A=new ta;a.splice(r,0,A);n.updateUi()});ua=$("<div>");ua.text(D.get("deleteRow",
"\u5220\u9664"));ua.addClass("modeler-designer-filter-table-op");10<=a.length?ua.css("right","8px"):ua.css("right","4px");ua.appendTo(R);ua.on("click",function(A){a.splice(r,1);n.updateUi()})}else u&&u.find(".modeler-designer-filter-table-op").remove();u=R};this.updateUi=function(){J||B();for(var R=a.length-1;0<=R;R--){var Da=a[R];if(Da.isEmpty())a.splice(R,1);else break}U.clear(J);J.addColumns(8);J.getColumn(0).setWidth(20);J.getColumn(1).setWidth(45);J.getColumn(2).setWidth(145);J.getColumn(3).setWidth(75);
J.getColumn(4).setWidth(170);J.getColumn(5).setWidth(45);J.getColumn(6).setWidth(45);R=U.createHeadRow(J);R.getCell(1).setValue(D.get("leftBracket","\u5de6\u62ec\u53f7"));R.getCell(2).setValue(D.get("field","\u5b57\u6bb5"));R.getCell(3).setValue(D.get("compare","\u6bd4\u8f83"));R.getCell(4).setValue(D.get("value","\u503c"));R.getCell(5).setValue(D.get("rightBracket","\u53f3\u62ec\u53f7"));R.getCell(6).setValue(D.get("logic","\u903b\u8f91"));var ua=a.length,t=Math.max(9,ua+4);for(R=0;R<t;R++){R<ua?
Da=a[R]:(Da=new ta,a.push(Da));var r=U.createRow(J);r.setUserObject(Da);r.getCell(0).setValue("");r.getCell(1).setValue(Da.getLeftBracketCount());r.getCell(2).setValue(Da.getField());r.getCell(3).setValue(Da.getCompareOp());ta.isCompareOpRelativeDateRangeValue(Da.getCompareOp())?r.getCell(4).setValue(Da.getRelativeDateRange()?Da.getRelativeDateRange():""):r.getCell(4).setValue(Da.getValue()?Da.getValue():"");r.getCell(5).setValue(Da.getRightBracketCount());r.getCell(6).setValue(Da.getLogicOp()?Da.getLogicOp():
"")}n.checkModelValid();U.refresh(J)};var la=function(R,Da,ua,t,r,A){R=U.createCtrlInCell(R,Da,ua,Ka);R.setSelected(r);R.setItemModels([0,1,2,3,4]);R.setUserObject(A);R.setCustomPainter(function(v,S,na){v=t?"(":")";for(var y="",K=0;K<na;K++)y+=v;S.text(y)});R.addSelectedChangedListener(t?Rb:Wb)},X=function(R,Da,ua,t,r){var A=(new O).createChooseFieldPanel(E,!1);A.setItemModel(V);R=U.createCtrlInCell(R,Da,ua,Eb);R.setUserObject(r);R.setSelectedModel(t);R.setDropdownCreator(function(v,S,na){return A.createJqPopup(v,
S,na)});R.addSelectionListener(function(v){var S=v.getSelectedModel();v=v.getUserObject();var na=v.getUserObject(),y=na.getField(),K=y?y.getOutputDataType():"",da=S?S.getOutputDataType():"";na.setField(S);v.getCell(2).setValue(S);if(K!=da||y.getEnumValue()!=S.getEnumValue()){y=na.getCompareOp();S=S?S.isEnum():!1;S=ta.getSelectableCompares(da,S);da=!1;for(K=0;K<S.length;K++)if(y==S[K]){da=!0;break}da||(y=ta.COMPARE_EQUAL);na.setCompareOp(y);vb(v.getCell(3),y);na.setValue(null);vb(v.getCell(4)," ")}n.checkModelValid()});
R.setCustomPainter(function(v,S){S.text(v?v.getAlias():"")})},$a=function(R,Da,ua){switch(ua){case ta.COMPARE_EQUAL:R=D.get("equal","\u7b49\u4e8e");break;case ta.COMPARE_NOT_EQUAL:R=D.get("notEqual","\u4e0d\u7b49\u4e8e");break;case ta.COMPARE_GREATER:R=D.get("greater","\u5927\u4e8e");break;case ta.COMPARE_GREATER_EQUAL:R=D.get("equalOrGreater","\u5927\u4e8e\u7b49\u4e8e");break;case ta.COMPARE_LESS:R=D.get("less","\u5c0f\u4e8e");break;case ta.COMPARE_LESS_EQUAL:R=D.get("equalOrLess","\u5c0f\u4e8e\u7b49\u4e8e");
break;case ta.COMPARE_INCLUDE:R=D.get("include","\u5305\u542b");break;case ta.COMPARE_NOT_INCLUDE:R=D.get("notInclude","\u4e0d\u5305\u542b");break;case ta.COMPARE_START_WITH:R=D.get("startWith","\u5f00\u5934\u662f");break;case ta.COMPARE_END_WITH:R=D.get("endWith","\u7ed3\u5c3e\u662f");break;case ta.COMPARE_NULL:R=D.get("compareNull","\u4e3a\u7a7a");break;case ta.COMPARE_NOT_NULL:R=D.get("compareNotNull","\u4e0d\u4e3a\u7a7a");break;case ta.COMPARE_IN:R=D.get("compareIn","\u5728......\u4e4b\u5185");
break;case ta.COMPARE_NOT_IN:R=D.get("compareNotIn","\u4e0d\u5728......\u4e4b\u5185");break;case ta.COMPARE_RELATIVE_DATE_RANGE:R=D.get("relativeDateRange","\u76f8\u5bf9\u65e5\u671f");break;default:R=""}Da.text(R)},nb=function(R,Da,ua,t,r){var A=r.getUserObject(),v=$(R);v.empty();if(C.FilterCheckHelper.checkFieldExisted(A,V)){v.css("cursor","");var S=A.getCompareOp(),na=A.getField(),y=na?na.getOutputDataType():"",K=na?na.getEnumValue():null,da=na?na.isEnum():!1;if(!ta.isCompareOpWithoutValue(S))if(ta.isCompareOpWithinOrNotWithinValue(S))if(da){var Ba=
[],Bb;for(Bb in K)Ba.push({fieldValue:K[Bb],fieldName:Bb});var zb=[];(t=JSON.parse(A.getValue()))&&t.forEach(function(Sb){Ba.forEach(function(Yb){Sb==Yb.fieldName&&zb.push({fieldValue:Yb.fieldValue,fieldName:Yb.fieldName})})});var Ub=new l;Ub.setItemModel(Ba,function(Sb,Yb){return Sb&&Yb&&Sb.fieldName==Yb.fieldName});Ub.setSelectedItemModel(zb);R=U.createCtrlInCell(R,Da,ua,Eb);R.setUserObject(r);R.setSelectedModel(zb);R.setDropdownCreator(function(Sb,Yb,ac,cc){return Ub.createJqPopup(Sb,Yb,ac,cc)});
R.addSelectionListener(function(Sb){var Yb=Sb.getSelectedModel();Sb=Sb.getUserObject().getUserObject();if(null==Yb||0==Yb.length)Sb.setValue(null);else{JSON.parse(Sb.getValue());var ac=[],cc;for(cc in Yb)ac.push(Yb[cc].fieldName);Sb.setValue(JSON.stringify(ac))}n.checkModelValid()});R.setCustomPainter(function(Sb,Yb){var ac=[],cc;for(cc in Sb)ac.push(Sb[cc].fieldValue);Yb.text(ac.join(","))})}else{var Pb=U.createCtrlInCell(R,Da,ua,Fb);Pb.setClearable(!0);Pb.setUserObject(r);Pb.getJqUi().find(".sa-ctrl-f7selector-text").on("click",
function(){Ib(A,Pb)});Pb.addActionListener(function(Sb){Ib(A,Pb)});null!=t&&""!=t&&" "!=t&&t&&Pb.setModel(JSON.parse(t).join(","));Pb.setCustomPainter(function(Sb){return Sb});Pb.addClearListener(function(Sb){Zb(Sb,A,null)})}else if(ia(na))R=$("<div>"),R.text(t),R.addClass("modeler-designer-common-table-cell-editable"),R.appendTo(v),v.css("cursor","pointer");else if(y==Ca.DT_DATE||y==Ca.DT_DATETIME)if(ta.isCompareOpRelativeDateRangeValue(S)){var mb=y==Ca.DT_DATETIME;v="";var Kb=t;Kb instanceof Aa?
v=Ta.modelToDisplayText(Kb,mb):(Kb=new Aa,Kb.setPeriod(Aa.PERIOD_DAY),Kb.setWhichPeriod(0));var tb=U.createCtrlInCell(R,Da,ua,w);v&&18<v.length&&(tb.getJqUi().attr("title",v),v=v.substring(0,18)+"...");tb.setText(v);tb.setUserObject(r);R=tb.getJqUi();R.css("line-height","28px");R.on("click",function(Sb){Sb=Kb;var Yb=Jb,ac=new f;ac.edit(Sb,mb,Yb);ac.showDialog()});Da=$("<div>");bb.background(Da,"btn_edit");Da.addClass("modeler-designer-filter-item-format-icon");Da.appendTo(R);var Jb=function(Sb){A.setRelativeDateRange(Sb);
tb.setText(Ta.modelToDisplayText(Sb,mb));r.getCell(4).setValue(Sb);n.checkModelValid()}}else v=new Date,t=t?parseInt(t):null,isNaN(t)||null==t?(A=r.getUserObject(),A.setValue(v.getTime())):v.setTime(t),R=U.createCtrlInCell(R,Da,ua,y==Ca.DT_DATETIME?Cb:ab),R.setDateObject(v),R.setUserObject(r),R.addModelChangedListener(pb);else if(y==Ca.DT_BOOLEAN)R=U.createCtrlInCell(R,Da,ua,Ka),R.setSelected(t),R.setItemModels([Ca.BOOLEAN_TRUE,Ca.BOOLEAN_FALSE]),R.setUserObject(r),R.setCustomPainter(function(Sb,
Yb,ac){Sb=ac==Ca.BOOLEAN_TRUE?D.get("dataTypeTrue","\u771f"):ac==Ca.BOOLEAN_FALSE?D.get("dataTypeFalse","\u5047"):"";Yb.text(Sb)}),R.addSelectedChangedListener(Fa);else if(da){Ba=[];for(Bb in K)Ba=Ba.concat(Bb);R=U.createCtrlInCell(R,Da,ua,Ka);R.setSelected(t);R.setItemModels(Ba);R.setUserObject(r);R.setCustomPainter(function(Sb,Yb,ac){Yb.text(K[ac])});R.addSelectedChangedListener(Fa)}}else R=$("<div>"),Da=A.getDisplayValue(!1),R.text(Da),R.attr("title",Da),R.addClass("modeler-designer-common-table-cell-not-editable"),
R.appendTo(v)},Ib=function(R,Da){var ua=D.get("enterSplit","\u7cbe\u786e\u5339\u914d\u591a\u503c\uff0c\u5404\u9879\u4e4b\u95f4\u4f7f\u7528\u56de\u8f66\u4f5c\u4e3a\u5206\u9694\u7b26"),t=R.getCompareOp()==ta.COMPARE_IN?D.get("compareIn","\u5728......\u4e4b\u5185"):D.get("compareNotIn","\u4e0d\u5728......\u4e4b\u5185"),r=JSON.parse(R.getValue());r=r?r.join("\n"):"";var A=new g;A.setCaption(t,ua);A.setClosingChecker(function(v){if(v&&5E4<v.length)return D.get("matchTooLong","\u5339\u914d\u9879\u4e0d\u80fd\u8d85\u8fc750000\u4e2a\u5b57\u7b26")});
A.setText(r,function(v,S){v&&Zb(Da,R,S)});A.showDialogLeftAnchorTo(Da.getJqUi())},Gb=function(R,Da,ua,t,r){R=U.createCtrlInCell(R,Da,ua,Ka);R.setSelected(t?t:null);R.setItemModels([null,ta.LOGIC_AND,ta.LOGIC_OR]);R.setUserObject(r);R.setCustomPainter(function(A,v,S){A="";S==ta.LOGIC_AND?A=D.get("and","\u4e14"):S==ta.LOGIC_OR&&(A=D.get("or","\u6216"));v.text(A)});R.addSelectedChangedListener(Xb)},vb=function(R,Da){R.setValue(""===Da?" ":"");R.setValue(Da)},sb=function(R,Da,ua){R=R.getUserObject();
var t=R.getUserObject();t.setCompareOp(ua);R.getCell(3).setValue(ua);if(ta.isCompareOpWithoutValue(Da)!=ta.isCompareOpWithoutValue(ua)||ta.isCompareOpRelativeDateRangeValue(Da)!=ta.isCompareOpRelativeDateRangeValue(ua)||ta.isCompareOpWithinOrNotWithinValue(Da)!=ta.isCompareOpWithinOrNotWithinValue(ua))t.setValue(null),t.setRelativeDateRange(null),vb(R.getCell(4)," ");n.checkModelValid()},Rb=function(R,Da,ua){R=R.getUserObject();R.getUserObject().setLeftBracketCount(ua);R.getCell(1).setValue(ua);n.checkModelValid()},
Wb=function(R,Da,ua){R=R.getUserObject();R.getUserObject().setRightBracketCount(ua);R.getCell(5).setValue(ua);n.checkModelValid()},Xb=function(R,Da,ua){R=R.getUserObject();R.getUserObject().setLogicOp(ua);R.getCell(6).setValue(ua);n.checkModelValid()},Zb=function(R,Da,ua){null!=ua&&R.setModel(ua.replace(/(\s*\n\s*)+/g,","));if(null==ua||Da.getValue()!=JSON.stringify(ua.split("\n"))){R=R.getUserObject();if(null!=ua&&""!=ua){ua=JSON.parse(JSON.stringify(ua.split("\n")));var t=[];ua&&ua.forEach(function(r){""!=
r.trim()&&t.push($.trim(r))});ua=JSON.stringify(t);Da.setValue(ua);R.getCell(4).setValue(ua)}else Da.setValue(null),R.getCell(4).setValue(null);n.checkModelValid()}},pb=function(R){var Da=""+R.getDateObject().getTime();R=R.getUserObject();R.getUserObject().setValue(Da);R.getCell(4).setValue(Da);n.checkModelValid()},Fa=function(R,Da,ua){R=R.getUserObject();R.getUserObject().setValue(ua);R.getCell(4).setValue(ua);n.checkModelValid()}}function xb(){Mb.AbstractWizardStep.call(this);var a,b,f,g,l,n,p;
this.getSubTitle=function(){return D.get("unionConfigSelectNode","\u9009\u62e9\u8868")};this.getJqUi=function(u){p||(a=u,b=new yb,b.setItemModels(n),b.setGlobal(f),b.setMessageCurtain(a.getMessageCurtain()),p=b.getJqUi());return p};this.intoThisStep=function(u,E){};this.outThisStep=function(u,E){if((u=b.getSelectedNodeItem())&&0!=u.length){u=new wa;u.setFromNode(g);u.setModelerModel(f.getModelerModel());u.setAfterSetCallback(l);var V=b.getSelectedNodeItem(),J=new db,z=J.setNodeItems,B=[],I=new fb;
I.setNodeId(g.getId());I.setAlias(C.DisplayNameHelper.getNodeDisplayName(g));B.push(I);for(I=0;I<V.length;I++)B.push(V[I]);z.call(J,B);u.setUnionConfig(J);E(u)}else a.getMessageCurtain().showPrompt(D.get("needSelectedTable","\u8bf7\u81f3\u5c11\u9009\u4e2d\u4e00\u4e2a\u8868\u3002"))};this.setGlobal=function(u){f=u};this.setFromNode=function(u){g=u};this.setAfterSetCallback=function(u){l=u};this.setItemModels=function(u){n=u}}function yb(){function a(){var E=[],V,J,z,B,I,ia;this.getJqUi=function(){if(!J){J=
$("<div>");V=new Qb;V.addSearchListener(la);V.setPlaceholder(D.get("searchTable","\u8bf7\u8f93\u5165\u641c\u7d22\u5185\u5bb9"));V.setShowSearchIcon(!0);var X=V.getJqUi();F.layoutCtrlWithLRTB(X,17,null,230,0,null,23);J.append(X);z=$("<div>");z.addClass("modeler-designer-node-selection-left-node-area");J.append(z);X=new Ia;X.setType(Ia.TYPE_NO_SEARCH_RESULT);X.setText(D.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c"));B=X.getJqUi();B.hide();B.appendTo(z);X=
new Ia;X.setText(D.get("noTableToSelect","\u6682\u65e0\u53ef\u9009\u62e9\u7684\u8868"));I=X.getJqUi();I.hide();I.appendTo(z);for(X=0;X<f.length;X++)E.push(aa(f[X]));X=$(document.createDocumentFragment());for(var $a=0;$a<E.length;$a++)X.append(E[$a].getJqUi());z.append(X);pa(E)}return J};this.setSelectedCallback=function(X){ia=X};this.clearNodeSelected=function(){for(var X=0;X<E.length;X++){for(var $a=E[X],nb=!1,Ib=0;Ib<g.length;Ib++)if(g[Ib].getNodeId()==$a.getNodeId()){nb=!0;break}nb||$a.setSelected(!1)}};
var aa=function(X){var $a=new Ob;$a.setNodeItem(X);$a.setGlobal(n);$a.setSelectedCallback(function(Gb){var vb=n.getNodeStatusMonitor(),sb=Gb.getNodeId();if(vb.isInvalidNode(sb))p.showPrompt(D.get("nodeNoDataAndCanNotSelect","\u8be5\u8282\u70b9\u6ca1\u6709\u6570\u636e, \u65e0\u6cd5\u88ab\u9009\u4e2d\u3002")),Gb.setSelected(!1),Gb.setEnabled(!1);else{vb=Gb.getNodeItem();if(Gb.isSelected())g.push(vb);else for(Gb=vb.getNodeId(),vb=0;vb<g.length;vb++)if(g[vb].getNodeId()==Gb){g.splice(vb,1);break}ia&&
ia()}});for(var nb=0;nb<g.length;nb++){var Ib=g[nb];if(X.getNodeId()==Ib.getNodeId()){$a.setSelected(!0);break}}return $a},pa=function(X){if(X){for(var $a=0;$a<E.length;$a++)E[$a].hide();B.hide();I.hide();if(0==X.length)V.getText().trim()?B.show():I.show();else for($a=0;$a<X.length;$a++)X[$a].show()}},la=function(X){if(X=V.getText().trim()){for(var $a=[],nb=0;nb<E.length;nb++){var Ib=E[nb];0<=Ib.getNodeItemAlias().toUpperCase().indexOf(X.toUpperCase())&&$a.push(Ib)}pa($a)}else pa(E)}}function b(){var E,
V,J,z;this.setDeleteCallback=function(la){z=la};this.getJqUi=function(){if(!V){V=$("<div>");V.addClass("modeler-designer-node-selection-right");E=new w;E.setText(D.get("selectedTable","\u5df2\u9009\u8868")+"("+g.length+")");E.getJqUi().addClass("modeler-designer-node-selection-selectedtablelabel");V.append(E.getJqUi());var la=new w;la.setText(D.get("clearAll","\u5168\u90e8\u6e05\u9664"));la=la.getJqUi();la.addClass("modeler-designer-node-selection-clearalllabel");la.on("mousedown",pa);V.append(la);
J=$("<div>");J.addClass("modeler-designer-table-selected-table-area");V.append(J);B()}return V};this.updateSelectedNodeAliasUi=function(){B()};var B=function(){if(g){J.empty();for(var la=$(document.createDocumentFragment()),X=0;X<g.length;X++){var $a=la,nb=$a.append,Ib=g[X],Gb=$("<div>");Gb.addClass("modeler-designer-table-selected-list-item");Gb.on("mouseenter",I);Gb.on("mouseleave",ia);var vb=$("<div>"),sb=Ib.getAlias();vb.text(sb);vb.addClass("modeler-designer-table-selected-list-item-alias");
Gb.append(vb);vb=$("<div>");vb.addClass("modeler-designer-table-selected-list-item-icon");bb.background(vb,"delete");vb.data("nodeId",Ib.getNodeId());vb.on("click",aa);Gb.append(vb);nb.call($a,Gb)}J.append(la);E.setText(D.get("selectedTable","\u5df2\u9009\u8868")+"("+g.length+")")}},I=function(la){$(la.currentTarget).find(".modeler-designer-table-selected-list-item-icon").css("display","block")},ia=function(la){$(la.currentTarget).find(".modeler-designer-table-selected-list-item-icon").css("display",
"none")},aa=function(la){la=$(la.currentTarget).data("nodeId");for(var X=0;X<g.length;X++)la==g[X].getNodeId()&&g.splice(X,1);B();z&&z()},pa=function(){g=[];B();z&&z()}}var f=[],g=[],l,n,p;this.getJqUi=function(){l||u();return l};this.setSelectedNodeItem=function(E){g=E};this.getSelectedNodeItem=function(){return g};this.setItemModels=function(E){f=E};this.setGlobal=function(E){n=E};this.setMessageCurtain=function(E){p=E};var u=function(){l=$("<div>");var E=new a,V=new b;E.setSelectedCallback(function(){V.updateSelectedNodeAliasUi()});
V.setDeleteCallback(function(){E.clearNodeSelected()});var J=new Z;J.setHorizontalSplit(!0);J.setEnabled(!0);J.setFirstSize(565,-1,-1);J.setSecondSize(200,185,300);J.setResizeMode(Z.RESIZE_MODE_SECOND_FIXED);J.setFirstChild(Z.createChildWrapper(E.getJqUi()));J.setSecondChild(Z.createChildWrapper(V.getJqUi()));l.append(J.getJqUi())}}function wa(){Mb.AbstractWizardStep.call(this);var a=this,b,f,g,l,n,p;this.getSubTitle=function(){return D.get("unionConfigFieldMapping","\u5b57\u6bb5\u5339\u914d")};this.getJqUi=
function(E){n||(b=E,p=new Q,p.setUnionConfig(f),p.setModeler(g),n=p.getJqUi());return n};this.intoThisStep=function(E,V){E=f.getNodeItems();u(E,0,{})};this.outThisStep=function(E,V){if(E)a.over(),V(null);else if(E=p.getUnacceptableError())b.getMessageCurtain().showPrompt(E.getErrorDesc());else if(f.checkUnionItemSelectEmpty())b.getMessageCurtain().showPrompt(D.get("noSelectedField","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b57\u6bb5\u3002"));else{E=f.getNodeItems();for(var J=C.TransformNodeFactory.createTransformNode(La.TYPE_UNION),
z=1;z<E.length;z++){var B=g.getNode(E[z].getNodeId());J.addExtraFromNode(B)}z=J.getConfig();z.setNodeItems(E);E=f.getSelectedUnionItem();z.setUnionItems(E);l&&l(J);J=J.getId();for(z=0;z<E.length;z++){var I=E[z];B=new Ca;B.setName(I.getName());B.setFromNode(J);var ia=I.getBaseField().getFromNode();I=(ia=g.getNode(ia))&&ia.canGenerateNewField()?I.getAlias():I.getName();C.FieldNumberHelper.generateDefaultNumberByAssignedName(B,I,!1)}V(null)}};this.isLastStep=function(){return!0};this.over=function(){p.destroy()};
this.setUnionConfig=function(E){f=E};this.setFromNode=function(E){};this.setModelerModel=function(E){g=E};this.setAfterSetCallback=function(E){l=E};var u=function(E,V,J){if(E.length==V)p.updateSelectableNodeFields(J),p.updateUi();else{var z=g.getNode(E[V].getNodeId());C.NodeFieldHelper.asynGetFields(g,z,function(B){B||(B=[]);f.addOneNodeToUnion(z.getId(),B,V,!0);J[z.getId()]=B.slice();u(E,V+1,J)})}}}function Q(){function a(nb){KTDefaultCellRender.call(this,nb);var Ib=this,Gb=this.paintCellUI,vb=new b,
sb=new g,Rb=new l;this.getTable=function(){return nb};this.paintCellUI=function(Wb,Xb){var Zb=Ib.getCurrentRowIdx(),pb=Ib.getCurrentColIdx();1==Zb&&0==pb?vb.paintAllCheckBoxCell(Ib,Wb,Xb):Zb<U.getHeadRowCount()?(Gb(Wb,Xb),Rb.paintError(Ib,Wb,Xb)):0==pb?vb.paintCell(Ib,Wb,Xb):1==pb?sb.paintBaseCell(Ib,Wb,Xb):sb.paintCell(Ib,Wb,Xb)}}function b(){this.paintCell=function(Gb,vb,sb){Gb.getCurrentRowIdx()==U.getHeadRowCount()&&J&&J.cleanOnRefreshTable();Gb=Gb.getCurrentRow().getUserObject();sb=new kb;sb.setChecked(Gb.isSelected());
sb.setUserObject(Gb);sb.addCheckedListener(Ib);J.addCheckBox(sb);Gb=sb.getJqUi();Gb.addClass("modeler-designer-field-table-checkbox");Gb.appendTo($(vb))};this.paintAllCheckBoxCell=function(Gb,vb,sb){a:{Gb=Gb.getCell().getUserObject().getUnionItems();for(sb=0;sb<Gb.length;sb++)if(!Gb[sb].isSelected()){Gb=!1;break a}Gb=!0}sb=new kb;sb.addCheckedListener(nb);sb.setChecked(Gb);J.setAllCheckBox(sb);Gb=sb.getJqUi();Gb.addClass("modeler-designer-field-table-checkbox");Gb.appendTo($(vb))};var nb=function(Gb,
vb){vb&&J.handleAllCheckBoxChange()},Ib=function(Gb,vb){vb&&(Gb.getUserObject().setSelected(Gb.isChecked()),J.handleCheckBoxChange())}}function f(){var nb=[],Ib;this.addCheckBox=function(Gb){nb.push(Gb)};this.setAllCheckBox=function(Gb){Ib=Gb};this.cleanOnRefreshTable=function(){nb=[]};this.handleAllCheckBoxChange=function(){for(var Gb=0;Gb<nb.length;Gb++){var vb=nb[Gb];vb.setChecked(Ib.isChecked());vb.getUserObject().setSelected(Ib.isChecked())}};this.handleCheckBoxChange=function(){for(var Gb=!0,
vb=0;vb<nb.length;vb++)Gb=Gb&&nb[vb].isChecked();Ib.setChecked(Gb)}}function g(){this.paintBaseCell=function(sb,Rb,Wb){sb.getCellWidth();sb.getCellHeight();sb.getCurrentColIdx();var Xb=sb.getCurrentRowIdx();Wb=sb.getCurrentRow().getUserObject();var Zb=sb.getCell(),pb=Zb.getUserObject();sb=sb.getCurrentCol().getUserObject();Zb=Zb.getValue();var Fa=$("<div>");Fa.text(Zb);Fa.attr("title",Zb);Fa.css("line-height","30px");Fa.css("padding-left","2px");Fa.css("padding-right","2px");Fa.css("height","28px");
Fa.css("top","1px");$(Rb).append(Fa);sb.isExist()&&nb(pb,Wb.getBaseField(),Rb,!0)&&(Fa.css("padding-left","17px"),Wb=$("<div>"),Wb.css("cursor","pointer"),Wb.attr("title",D.get("delete","\u5220\u9664")),bb.backgroundWithHover(Wb,"delete"),Wb.addClass("modeler-designer-field-delete"),Wb.on("click",function(){pb.setField(null);pb.setFieldExist(!0);u.tryDeleteOneUnionItem(Xb-3);pa()}),Wb.appendTo($(Rb)))};this.paintCell=function(sb,Rb,Wb){var Xb=sb.getCellWidth(),Zb=sb.getCellHeight(),pb=sb.getCurrentColIdx();
Wb=sb.getCurrentRow().getUserObject();var Fa=sb.getCurrentCol().getUserObject();sb=sb.getCell().getUserObject();var R=(new O).createChooseFieldPanel(I,!0),Da=z[sb.getNodeId()];R.setItemModel(Da?Da:[null]);R.setShowFieldNameEnable(!1);Xb=U.createCtrlInCell($(Rb),Xb,Zb,Eb);Xb.setUserObject(Wb);Xb.getJqUi().attr("data-colIndex",pb);pb=sb.getField();Xb.setSelectedModel(pb);Xb.setDropdownCreator(function(t,r,A){return R.createJqPopup(t,r,A)});Xb.addSelectionListener(X);var ua=!1;Fa.isExist()&&(ua=nb(sb,
Wb.getBaseField(),Rb,!1));Xb.setCustomPainter(function(t,r){t=$a(t);r.text(t);r.attr("title",t);ua&&r.css("left","15px")});Fa.isExist()||Xb.setEnabled(!1)};var nb=function(sb,Rb,Wb,Xb){sb=Ib(sb,Rb);if(!sb)return!1;sb.isAcceptable()||B||(B=sb);Rb=$("<div>");Rb.text("!");Rb.addClass("modeler-designer-field-notmatch-prompt");Rb.attr("title",sb.getErrorDesc());Xb||Rb.css("left","5px");Rb.appendTo($(Wb));return!0},Ib=function(sb,Rb){if(!sb.isFieldExist())return Rb=D.get("fieldNotExist","\u4e0d\u5b58\u5728\u7684\u5b57\u6bb5"),
new n(!0,Rb);sb=sb.getField();if(!sb||!Rb||sb.getFullName()==Rb.getFullName())return null;if(!Gb(sb,Rb))return Rb=D.get("enumFieldInConsistent","\u679a\u4e3e\u5b57\u6bb5\u5efa\u7acb\u6620\u5c04\u65f6\uff0c\u5b57\u6bb5\u7c7b\u578b\u548c\u679a\u4e3e\u503c\u5fc5\u987b\u5b8c\u5168\u4e00\u81f4\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9"),new n(!1,Rb);if(!vb(sb,Rb)){var Wb=D.get("dataTypeNotMatch","\u5b57\u6bb5\u201c#1\u201d\u7684\u6570\u636e\u7c7b\u578b\u4e3a#2\uff0c\u4e0e\u5b57\u6bb5\u201c#3\u201d\u7684#4\u6570\u636e\u7c7b\u578b\u4e0d\u4e00\u81f4");
Wb=Wb.replace("#1",sb.getAlias());Wb=Wb.replace("#2",C.PropDataTypeUtil.getDataTypeDesc(sb.getOutputDataType()));Wb=Wb.replace("#3",Rb.getAlias());Wb=Wb.replace("#4",C.PropDataTypeUtil.getDataTypeDesc(Rb.getOutputDataType()));return new n(!0,Wb)}},Gb=function(sb,Rb){sb=sb?sb.getEnumValue():null;Rb=Rb?Rb.getEnumValue():null;if(!sb&&!Rb)return!0;if(!sb&&Rb||sb&&!Rb||Object.keys(Rb).length!=Object.keys(sb).length)return!1;for(var Wb in Rb){var Xb=Rb[Wb],Zb=sb[Wb];if(!Zb||Zb!=Xb)return!1}return!0},vb=
function(sb,Rb){sb=sb?sb.getOutputDataType():null;Rb=Rb?Rb.getOutputDataType():null;if(!sb||!Rb)return!0;switch(Rb){case Ca.DT_STRING:return!0;case Ca.DT_INT:case Ca.DT_NUMBER:return sb==Ca.DT_INT||sb==Ca.DT_NUMBER;case Ca.DT_DATE:case Ca.DT_DATETIME:return sb==Ca.DT_DATE||sb==Ca.DT_DATETIME;case Ca.DT_BOOLEAN:return sb==Ca.DT_BOOLEAN}return!1}}function l(){this.paintError=function(nb,Ib,Gb){nb.getCellWidth();nb.getCellHeight();nb.getCurrentColIdx();(nb=nb.getCell())&&!nb.getUserObject().isExist()&&
(nb=ba.createWarning(),nb.addClass("modeler-designer-node-item-error"),nb.attr("title",D.get("invalidSourcePrompt","\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664")),$(Ib).append(nb))}}function n(nb,Ib){this.isAcceptable=function(){return nb};this.getErrorDesc=function(){return Ib}}var p,u,E,V,J,z={},B,I,ia;this.getJqUi=function(){p||aa();return p};this.setUnionConfig=function(nb){u=nb};this.updateUi=function(){pa()};this.updateSelectableNodeFields=function(nb){z={};if(nb)for(var Ib in nb)if(nb[Ib]&&
0!=nb[Ib].length){var Gb=nb[Ib].slice();Gb.unshift(null);z[Ib]=Gb}};this.setModeler=function(nb){I=nb};this.getUnacceptableError=function(){return B};this.setTableStyle=function(nb){$(E.getUI()).addClass(nb)};this.destroy=function(){ia.unobserve()};var aa=function(){p=$("<div>");E=U.createTable();U.bindTableListenerForCtrl(E);V=new a(E);V.setOutsideVisible(!1);E.setCellRender(V);J=new f;var nb=$(E.getUI());nb.addClass("modeler-designer-field-table");nb.appendTo(p);ia=new rb;ia.setCallback(function(){E.relayoutViews()});
ia.observe()},pa=function(){B=null;J.cleanOnRefreshTable();U.clear(E);var nb=u.getNodeItems();E.addColumns(nb.length+1);E.getColumn(0).setWidth(40);for(var Ib=0;Ib<nb.length;Ib++)E.getColumn(Ib+1).setWidth(200),E.getColumn(Ib+1).setUserObject(nb[Ib]);nb=u.getNodeItems();var Gb=U.createHeadRow(E);Gb.getCell(0).setUserObject(u);for(Ib=0;Ib<nb.length;Ib++){var vb=nb[Ib].getAlias();Gb.getCell(Ib+1).setValue(vb);Gb.getCell(Ib+1).setUserObject(nb[Ib])}nb=u.getUnionItems();for(Ib=0;Ib<nb.length;Ib++)Gb=
nb[Ib],vb=U.createRow(E),la(Gb,vb);setTimeout(function(){U.refresh(E)},0)},la=function(nb,Ib){Ib.setUserObject(nb);nb=nb.getUnionInnerItems();for(var Gb=0;Gb<nb.length;Gb++){var vb=nb[Gb];Ib.getCell(Gb+1).setUserObject(vb);vb=$a(vb.getField());Ib.getCell(Gb+1).setValue(vb)}},X=function(nb,Ib){if(Ib){Ib=nb.getUserObject();var Gb=nb.getSelectedModel();nb=nb.getJqUi().attr("data-colIndex")-1;var vb=Ib.getUnionInnerItemByIndex(nb),sb=vb.getField();if(!Gb||!sb||Gb.getFullName()!=sb.getFullName()){for(var Rb=
u.getUnionItems(),Wb=0;Gb&&Wb<Rb.length;Wb++){var Xb=Rb[Wb].getUnionInnerItemByIndex(nb),Zb=Xb.getField();if(Zb&&Zb.getFullName()==Gb.getFullName()){Xb.setField(null);u.tryDeleteOneUnionItem(Wb);break}}vb.isFieldExist()&&sb&&(Wb=u.getNodeItems(),u.addOneUnionItem(Wb[nb].getNodeId(),sb.clone()));vb.setField(Gb);vb.setFieldExist(!0);for(Wb=0;Wb<Rb.length;Wb++)if(Ib==Rb[Wb]){u.tryDeleteOneUnionItem(Wb);break}pa()}}},$a=function(nb){return nb?nb.isEnum()?nb.getAlias()+"("+D.get("enumField","\u679a\u4e3e\u5b57\u6bb5")+
")":nb.getAlias():""}}function Ha(){var a=this,b,f;this.getJqUi=function(){if(!b){b=$("<div>");b.addClass("modeler-designer-node-selection-item");var g=$("<div>");g.addClass("modeler-designer-node-selection-item-table-icon");bb.background(g,"table");b.append(g);var l=$("<div>");l.text(f.getAlias());l.addClass("modeler-designer-node-selection-item-text");b.append(l);a.protectedInit(b,g,l)}return b};this.getNodeItem=function(){return f};this.setNodeItem=function(g){f=g};this.getNodeId=function(){return f.getNodeId()};
this.getNodeItemAlias=function(){return f.getAlias()};this.hide=function(){b&&b.hide()};this.show=function(){b&&b.show()};this.protectedInit=function(g,l,n){throw Error("override me");}}function Ob(){Ha.call(this);var a=this,b=!1,f,g,l;this.protectedInit=function(u){f=new kb;f.setChecked(b);f.addCheckedListener(p);var E=f.getJqUi();E.addClass("modeler-designer-node-selection-checkbox");u.append(E);var V=$("<div>");V.addClass("modeler-designer-node-selection-preview-icon");V.css("cursor","pointer");
V.on("click",n);bb.backgroundWithHover(V,"preview");V.hide();u.mouseenter(function(){V.show()});u.mouseleave(function(){V.hide()});u.append(V)};this.setSelectedCallback=function(u){g=u};this.isSelected=function(){return b};this.setSelected=function(u){b=u;f&&f.setChecked(u)};this.setEnabled=function(u){f.setEnabled(u)};this.setGlobal=function(u){l=u};var n=function(){var u=l.getModelerModel(),E=u.getNode(a.getNodeItem().getNodeId());u=C.ModelConverter.convertToRuntimeModel(u,E);u.setPreviewConfig(C.PreviewConfigManager.getPreviewConfig());
var V=new ja;V.setRuntimeModel(u);V.setGlobal(l);V.setNode(E);V.showDialog()},p=function(u,E){E&&(b=u.isChecked(),g&&g(a))}}function ja(){Ma.call(this);var a=this,b=this.protectedMethod,f,g,l,n,p,u;(function(){b.setTitle(D.get("dataPreview","\u6570\u636e\u9884\u89c8"));var z=$(document.body),B=z.prop("clientWidth");z=z.prop("clientHeight");var I=Math.min(1,Math.max(.8,1.16-2E-4*B));B=parseInt(I*B);z=parseInt(I*z);a.setSize(B,z);b.setSelectable(!0);b.setContentPaneCreator(function(){u=$("<div>");E();
return u});b.getDialogCtrl().setFullScreenEnabled();b.getDialogCtrl().setResizeEnabled();b.getDialogCtrl().addResizeListener(function(){l.relayoutViews()});b.setFooterPaneCreator(null);b.setClosingAction(function(ia){})})();this.setRuntimeModel=function(z){n=z};this.setGlobal=function(z){f=z};this.setNode=function(z){g=z};var E=function(){V()||C.NodeFieldHelper.getPreviewData(n,function(z){p=z.getPreviewData();if(!V())if(p&&0!=p.getRowCount()){z=new KTBorderStyle;z.setBorderWidth(1);z.setBorderPen("solid");
z.setBorderColor("#E3E3E3");var B=new KTStyle;B.setVerticalAlign("bottom");l=new KTable;l.setBorder(z);l.setStyle(B);l.setDraggableAdjusting(!0,1,0);l.setSyncUIWhenModelChanged(!1);l.setLargeDataMode(!0);l.setFrozenRows(1);l.getCellRender().setOutsideVisible(!1);l.setColumnFitVisibleWidth(!1);z=p.getColumnCount()+1;l.addColumns(z);var I=new KTStyle;I.setTextAlign("center");I.setBold(!0);I.setColor("#666");I.setBackgroundColor("#E9E9E9");B=new KTStyle;B.setTextAlign("center");var ia=l.addRow();ia.setStyle(I);
ia.setHeight(22);for(I=0;I<z;I++){var aa=ia.getCell(I),pa=l.getColumn(I);0==I?(aa.setValue(D.get("rowNum","\u5e8f\u53f7")),pa.setWidth(40),pa.setStyle(B)):(aa.setValue(p.getField(I-1).getAlias()),pa.setWidth(150))}z=$(l.getUI());z.appendTo(u);F.layoutCtrlWithLRTB(z,0,0,null,32,0,null);z=new KTStyle;z.setColor("#333");z.setBackgroundColor("#fff");B=new KTStyle;B.setColor("#333");B.setBackgroundColor("#F3F3F3");ia=new KTStyle;ia.setTextAlign("right");for(I=0;I<p.getRowCount();I++)for(pa=0==I%2?z:B,
aa=l.addRow(),aa.setHeight(22),aa.setStyle(pa),pa=0;pa<p.getColumnCount()+1;pa++){var la=aa.getCell(pa);if(0==pa)la.setValue(I+1);else{var X=p.getOneRow(I),$a=p.getField(pa-1),nb=la,Ib=nb.setValue;X=X[pa-1];var Gb=$a;var vb=Gb.getOutputDataType();if(null==X||void 0==X)X="";else if(vb==Ca.DT_DATE)Gb=new hb,Gb.setFormatString("yyyy-MM-dd"),X=Gb.format(X);else if(vb==Ca.DT_DATETIME)Gb=new hb,Gb.setFormatString("yyyy-MM-dd HH:mm:ss"),X=Gb.format(X);else if(vb==Ca.DT_BOOLEAN)X=X?"true":"false";else if(vb==
Ca.DT_NUMBER&&(Gb=Gb.getScale()))for(X+="",vb=X.split("."),2>vb.length?(X+=".",vb=""):vb=vb[1],Gb-=vb.length,vb=0;vb<Gb;vb++)X+="0";Ib.call(nb,X);$a=$a.getOutputDataType();$a!=Ca.DT_INT&&$a!=Ca.DT_NUMBER||la.setStyle(ia)}}l.updateUI();z=new w;z.setText(C.PreviewConfigManager.getRowCountText());z.getJqUi().appendTo(u);F.layoutCtrlWithLRTB(z.getJqUi(),0,0,null,4,null,23)}else J(D.get("noData","\u5f53\u524d\u9884\u89c8\u89c4\u5219\u4e0b\uff0c\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e"))},
u)},V=function(){var z=f.getNodeStatusMonitor();if(!z.isInvalidNode(g.getId()))return!1;(z=z.getInvalidPrompt(g))||(z=D.get("invalidNodeConfig","\u8282\u70b9#1\u8bbe\u7f6e\u4e0d\u5b8c\u6574").replace("#1",g.getAlias()));J(z);return!0},J=function(z){var B=new fa;u.append(B.getJqUi());B.setText(z)}}function fa(){var a,b;this.getJqUi=function(){a||(a=$("<div>"),a.addClass("modeler-designer-preview-no-data-background"),b=$("<div>"),b.addClass("modeler-designer-preview-no-data-text"),b.appendTo(a));return a};
this.setText=function(f){b.text(f)};this.hide=function(){a.hide()};this.show=function(){a.show()}}function Ja(a){Ma.call(this);var b=this,f=this.protectedMethod,g,l,n,p,u=[],E;this.setFields=function(B){u=B;B=a;n=new ea;B=B?B.getConfig():null;n.setColumnToRowConfig(B);n.setCurrentFields(u);n.setMessageCurtain(f.getMessageCurtain());n.setModeler(E)};this.setFunCallback=function(B){g=B};this.setConfigChangeListener=function(B){l=B};this.setModeler=function(B){E=B};this.initUi=function(){f.setSelectable(!0);
f.setTitle(D.get("columnToRow","\u5217\u8f6c\u884c"));b.setSize(620,560);var B=$("<div>"),I=$("<div>");I.css({position:"absolute"});var ia=$("<span>");ia.addClass("modeler-designer-column-to-row-add-column-desc");ia.text(D.get("configColumnDesc","\u5217\u8f6c\u884c\u529f\u80fd\u8bf4\u660e"));ia.appendTo(I);ia=V().getJqUi();ia.css({display:"inline-block",top:"10px","margin-left":"5px","z-index":"2"});ia.appendTo(I);B.append(I);f.setContentPaneCreator(function(){B.append(n.getJqUi());return B});f.setClosingChecker(J,
!0);f.setClosingAction(z)};var V=function(){var B=$("<div>"),I=$("<span>");I.text(D.get("columnToRowHelpIconTips","\u201c\u5217\u8f6c\u884c\u201d\u529f\u80fd\u53ef\u5c06\u539f\u59cb\u6570\u636e\u4e2d\u7684\u540c\u4e00\u884c\u591a\u5217\u6570\u636e\u8f6c\u6362\u4e3a\u591a\u884c\u6570\u636e "));I.appendTo(B);I=Sa.getColumnToRowUrl();I=$("<a onclick='javascript:window.open(\""+I+"\");' href='#'>");I.text(D.get("viewDetails","\u67e5\u770b\u5e2e\u52a9\u6587\u6863"));I.css({cursor:"pointer",color:"#5582f3"});
I.appendTo(B);I=new T;I.setIconType(T.ICON_TYPE_QUESTION);I.setTipsSize(200,70);I.setTipsHtml(B[0]);return I},J=function(B){if(n.getColumnToRowConfig()){var I=n.getErrorMessage();if(I)return f.getMessageCurtain().showError(I),B(!1),!1}B(!0)},z=function(B){if(B){B=n.getColumnToRowConfig();var I;if(I=B)I=B.getColumnToRowItems(),I=!(null==I||0===I.length);if(I){I=[];var ia=B.getColumnToRowItems();if(null!=ia&&0<ia.length){for(var aa=0;aa<ia.length;aa++){var pa=ia[aa];pa&&pa.getName()&&I.push(pa)}B.setColumnToRowItems(I)}}p=
B;if(a)l&&l(p);else for(a=C.TransformNodeFactory.createTransformNode(La.TYPE_COLUMN_TO_ROW),a.setConfig(p),g&&g(a),I=p,B=a.getId(),ia=I.getTargetAttrField(),ia.setFromNode(B),C.FieldNumberHelper.generateDefaultNumberByAssignedName(ia,ia.getAlias()),I=I.getTargetValueFields(),ia=0;ia<I.length;ia++)I[ia].setFromNode(B),C.FieldNumberHelper.generateDefaultNumberByAssignedName(I[ia],I[ia].getAlias());f.destroy()}}}function ea(){function a(pb){KTDefaultCellRender.call(this,pb);var Fa=this,R=this.paintCellUI;
this.paintCellUI=function(y,K){var da=Fa.getCellWidth(),Ba=Fa.getCellHeight(),Bb=Fa.getCurrentRow();if(Fa.getCurrentRowIdx()<U.getHeadRowCount()&&22==Bb.getHeight())if(1==Fa.getCurrentColIdx()){var zb=$a(D.get("targetFieldName","\u8f6c\u7f6e\u540e\u7684\u5c5e\u6027\u5217"),p.getAttrFieldAlias());p.setAttrFieldAlias(Ib(Fa.getCurrentColIdx(),zb));Da(y,da,Ba,Bb,zb,!1,Fa.getCurrentColIdx())}else 2==Fa.getCurrentColIdx()?4==pb.getColumnsCount()?(zb=$a(D.get("targetFieldValue","\u8f6c\u7f6e\u540e\u7684\u503c\u5217"),
p.getTargetValueFieldAlia(Fa.getCurrentColIdx()-2)),p.setValueFieldAlias(Fa.getCurrentColIdx()-2,Ib(Fa.getCurrentColIdx(),zb)),Da(y,da,Ba,Bb,zb,!1,Fa.getCurrentColIdx())):(zb=$a(D.get("targetFieldValue","\u8f6c\u7f6e\u540e\u7684\u503c\u5217")+(Fa.getCurrentColIdx()-1),p.getTargetValueFieldAlia(Fa.getCurrentColIdx()-2)),p.setValueFieldAlias(Fa.getCurrentColIdx()-2,Ib(Fa.getCurrentColIdx(),zb)),Da(y,da,Ba,Bb,zb,!0,Fa.getCurrentColIdx())):2<Fa.getCurrentColIdx()&&Fa.getCurrentColIdx()<pb.getColumnsCount()-
1?(zb=$a(D.get("targetFieldValue","\u8f6c\u7f6e\u540e\u7684\u503c\u5217")+(Fa.getCurrentColIdx()-1),p.getTargetValueFieldAlia(Fa.getCurrentColIdx()-2)),p.setValueFieldAlias(Fa.getCurrentColIdx()-2,Ib(Fa.getCurrentColIdx(),zb)),Da(y,da,Ba,Bb,zb,!0,Fa.getCurrentColIdx())):R(y,K);else{zb=Fa.getCurrentRowIdx()-3;var Ub=$(y);Fa.getCurrentRowIdx()>=U.getHeadRowCount()&&1==Fa.getCurrentColIdx()?(Ba=!0,y=Ub.find(".modeler-designer-column-to-row-tablecell-editable"),K=y.eq(0),da=Bb.getCell(1).getValue(),0===
y.length&&(Ba=!1,K=$("<div>"),K.addClass("modeler-designer-column-to-row-tablecell-editable"),K.appendTo(Ub),Ub.css("cursor","pointer")),K.text(da),Ba&&((Ba=p.getColumnToRowItem(zb))||(Ba=new Za),Ba.setName(da),p.addColumnToRowItem(zb,Ba)),ia()):Fa.getCurrentRowIdx()>=U.getHeadRowCount()&&1<Fa.getCurrentColIdx()&&Fa.getCurrentColIdx()<pb.getColumnsCount()-1?(y=Bb.getCell(Fa.getCurrentColIdx()).getValue(),na(Ub,da,Ba,y,Bb,zb,Fa.getCurrentColIdx())):R(y,K);Rb(Ub,Bb,pb,Fa.getCurrentColIdx(),zb)}};var Da=
function(y,K,da,Ba,Bb,zb,Ub){var Pb=$(y),mb=U.createCtrlInCell(y,K,da,w);mb.setText(r(Bb));mb.setUserObject(Ba);y=mb.getJqUi();y.css({"line-height":"28px",width:"100%"});y.find(".sa-ctrl-label-text").css({width:"87%","margin-left":"5px"});K=$("<div>");bb.background(K,"edit");K.css("left","90%");K.on("click",function(){ua(Pb,mb,Ub)});K.addClass("modeler-designer-column-to-row-format-icon");K.appendTo(y);zb&&(K.css("left","80%"),y.find(".sa-ctrl-label-text").css("width","80%"),zb=$("<div>"),bb.background(zb,
"delete"),zb.css("left","90%"),zb.addClass("modeler-designer-column-to-row-format-icon"),zb.on("click",function(){p.deleteTargetValueField(Ub-2);pb.removeColumn(Ub);ia()}),zb.appendTo(y));A(Pb,Ub,Bb)},ua=function(y,K,da){var Ba=K.getText().replace("\uff08"+D.get("fieldNameReplace","\u540d\u79f0\uff1a"),"\uff08");Ba=X(Ba,"\uff09")?Ba.substring(Ba.indexOf("\uff08")+1,Ba.length-1):"";var Bb=new lb;Bb.setText(Ba);var zb=$("<div>"),Ub=$(document.body),Pb=$("<div class='sa-ctrl-common-modallayer'>");Pb.appendTo(Ub);
var mb=new Nb(Pb);mb.setSelectable(!0);var Kb=D.get("modifyFieldName","\u4fee\u6539\u5b57\u6bb5\u540d\u79f0");mb.setTitle(Kb);Kb=Ub.prop("clientWidth");var tb=Ub.prop("clientHeight");mb.setBounds(Kb-312>>1,tb-175>>1,312,175);mb.setToolbarVisible(!1);mb.setContent(t(Bb,zb));mb.showFooterPane();Pb.appendTo(Ub);var Jb=function(){var Sb=Bb.getText().trim(),Yb=v(Sb,da);if(Yb)return zb.text(Yb),zb.attr("title",Yb),setTimeout(function(){zb.text("")},5E3),!1;Ba!=Sb&&S(y,K,Sb,da);return!0};mb.addClosingListener(function(Sb,
Yb){Yb?Jb()&&(mb.destroy(),Pb.remove()):(mb.destroy(),Pb.remove())});return mb},t=function(y,K){var da=$("<div>"),Ba=new w;Ba.setText(D.get("fieldName","\u5b57\u6bb5\u540d\u79f0"));Ba.setRequired(!0);Ba=Ba.getJqUi();F.layoutCtrl(Ba,25,7,75,23);Ba.appendTo(da);y=y.getJqUi();F.layoutCtrl(y,100,7,155,23);y.appendTo(da);K.css("color","#FCAD05");F.layoutCtrl(K,25,37,230,23);K.css({overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"});K.appendTo(da);return da},r=function(y){return y.replace("\uff08",
"\uff08"+D.get("fieldNameReplace","\u540d\u79f0\uff1a"))},A=function(y,K,da){y=Ib(K,da);1!==K?p.setValueFieldAlias(K-2,y):p.setAttrFieldAlias(y)},v=function(y,K){if(null==y||""==y||0==y.length)return D.get("fieldNameIsNull","\u5b57\u6bb5\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a\u3002");if(50<y.length)return D.get("fieldNameCanNotExceedLimit","\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002");if(y){if(!y.match(/^[\s\u3000\u4E00-\u9FA5a-zA-Z0-9_]{1,}$/))return D.get("headNameComponentCheckError",
"\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\u3002");var da=p.getAttrFieldAlias(),Ba=p.getTargetValueFieldAlias().indexOf(y);if(y==da&&1!==K||-1<Ba&&Ba!==K-2)return D.get("headNameRepeatCheckError","\u5b57\u6bb5\u540d\u79f0\u5df2\u5b58\u5728\u3002");var Bb={};u.forEach(function(zb){Bb[zb.getAlias()]=zb});if(null!=Bb[y])return D.get("headNameRepeatCheckError","\u5b57\u6bb5\u540d\u79f0\u5df2\u5b58\u5728\u3002")}},S=function(y,K,
da,Ba){var Bb=K.getText();X(Bb,"\uff09")?K.setText(Bb.substring(0,Bb.indexOf("\uff08")+1)+da+"\uff09"):K.setText(Bb+"\uff08"+da+"\uff09");A(y,Ba,K.getText());K.setText(r(K.getText()));V.showSuccess(D.get("editSuccess","\u4fee\u6539\u6210\u529f\u3002"))},na=function(y,K,da,Ba,Bb,zb,Ub){var Pb=(new O).createChooseFieldPanel(z,!1);Pb.setItemModel(u);K=U.createCtrlInCell(y,K,da,Eb);K.setUserObject(Bb);K.setSelectedModel(Ba);K.setDropdownCreator(function(mb,Kb,tb){return Pb.createJqPopup(mb,Kb,tb)});K.setCustomPainter(function(mb,
Kb){Bb.getCell(Ub).setValue(mb);Kb.text(mb?"\u5b57\u6bb5 ["+mb.getAlias()+"] \u7684\u503c":"");if(mb){var tb=p.getColumnToRowItem(zb);tb||(tb=new Za);var Jb=tb.getName();Jb||(Jb=(Jb=mb.getAlias())?Jb:mb.getFullName(),Bb.getCell(1).setValue(Jb),tb.setName(Jb));Jb=tb.getFields();Jb[Ub-2]=mb;tb.setFields(Jb);p.addColumnToRowItem(zb,tb)}Rb(y,Bb,pb,Ub,zb);mb&&!J[mb.getFullName()]&&(Kb.css("left","18px"),mb=ba.createWarning(),mb.attr("title",D.get("disappearedField","\u5b57\u6bb5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002")),
mb.addClass("modeler-designer-column-to-row-prompt"),mb.css({left:"6px",right:"2px"}),mb.appendTo($(y)));ia()})}}var b=this,f,g,l,n,p,u=[],E,V,J={},z;this.getJqUi=function(){if(!g){g=$("<div>");var pb=$("<div class='modeler-designer-column-to-row-table'>");f=U.createTable();f.setSyncUIWhenModelChanged(!0);f.setDraggableAdjusting(!0,3,0,new G);U.bindTextEditor(f,Gb,vb);U.bindTableListenerForCtrl(f,sb);var Fa=new a(f);Fa.setOutsideVisible(!1);f.setCellRender(Fa);var R=p.getAttrFieldAlias();Fa=p.getTargetValueFieldAlias();
if(null==Fa||0===Fa.length)Fa=[""];var Da=Fa.length+3;f.addColumns(Da);f.getColumn(0).setWidth(25);f.getColumn(1).setWidth(200);for(var ua=0;ua<Fa.length;ua++)f.getColumn(2+ua).setWidth(200);f.getColumn(Da-1).setWidth(162);Da=U.createHeadRow(f);Da.getCell(1).setValue(R);for(R=0;R<Fa.length;R++)Da.getCell(2+R).setValue(Fa[R]);Fa=$(f.getUI());F.layoutCtrlWithLRTB(Fa,0,0,null,50,0,null);pb.append(Fa);g.append(pb);I();Fa.children().eq(1).css("width","100%");pa();aa()}return g};this.isExistError=function(){for(var pb=
p.getColumnToRowItems(),Fa=0;Fa<pb.length;Fa++){var R=f.getRow(Fa+3);if(!Wb(f,null,R))return!0}return!1};this.setModeler=function(pb){z=pb};this.getErrorMessage=function(){var pb=null,Fa=p.getColumnToRowItems();if(null!=Fa&&0<Fa.length)if(b.isExistError())pb=E;else{a:{pb=p.getColumnToRowItems();Fa=p.getTargetValueFieldSize();if(pb&&0<pb.length)for(var R=0;R<Fa;R++){b:{var Da=void 0;var ua=pb,t=R,r=!0;for(Da in ua){var A=ua[Da];if(A&&(r=!1,A.getField(t))){Da=!1;break b}}Da=!r}if(Da){pb=D.get("existUnconfiguredColumn",
"\u201c\u8f6c\u7f6e\u540e\u7684\u503c\u5217#1\u201d\u672a\u8bbe\u7f6e\u3002").replace("#1",R+1);break a}}pb=void 0}pb||(pb=Zb())}return pb};this.setMessageCurtain=function(pb){V=pb};this.setCurrentFields=function(pb){u=pb;B(pb)};this.setColumnToRowConfig=function(pb){p=null!=pb?pb.clone():new va};this.getColumnToRowConfig=function(){return p};var B=function(pb){pb.forEach(function(Fa){J[Fa.getFullName()]=Fa})},I=function(){U.clearWithoutHead(f);for(var pb=p.getTargetValueFieldSize(),Fa=p.getColumnToRowItems(),
R=0;R<Fa.length;R++){var Da=U.createRow(f),ua=Fa[R];if(ua){var t=ua.getName();Da.getCell(1).setValue(t);ua=ua.getFields();for(t=0;t<pb;t++){var r=Da.getCell(2+t),A=r.setValue,v;a:if(v=ua[t])for(var S=v.getFullName(),na=0;na<u.length;na++)if(S==u[na].getFullName()){v=u[na];break a}A.call(r,v)}}else{for(ua=0;ua<pb;ua++)Da.getCell(2+ua).setValue(null);Da.getCell(1).setValue("")}}for(pb=Fa?Fa.length:0;10>pb;pb++){Fa=U.createRow(f);R=2;for(Da=f.getColumnsCount()-1;R<Da;R++)Fa.getCell(R).setValue(null);
Fa.getCell(1).setValue("")}U.refresh(f);ia()},ia=function(){$(".modeler-designer-column-to-row-tips-row-text").remove();var pb=p.getColumnToRowItems();if(pb=f.getRow(pb.length+3)){var Fa=f.getColumn(1);Fa=KTableUIAbstractView.createCellId(pb,Fa);var R=g.find("#"+Fa);Fa=$("<div class='modeler-designer-column-to-row-tips-row-text'>");Fa.css("line-height","26px");Fa.appendTo(R);Fa.text(D.get("enterAttrName","\u8bf7\u8f93\u5165\u5c5e\u6027\u540d"));for(var Da=p.getTargetValueFieldSize(),ua=0;ua<Da;ua++)Fa=
f.getColumn(2+ua),Fa=KTableUIAbstractView.createCellId(pb,Fa),R=g.find("#"+Fa),R=R.find(".sa-ctrl-combobox-text"),Fa=$("<div class='modeler-designer-column-to-row-tips-row-text'>"),Fa.appendTo(R),Fa.text(D.get("selectColumn","\u8bf7\u9009\u62e9\u9700\u8981\u8f6c\u7f6e\u7684\u5217"))}},aa=function(){var pb=$("<div class='modeler-designer-column-to-row-delete'>"),Fa=$("<div>"),R=$("<span class='modeler-designer-column-to-row-delete-button'>");R.text(D.get("clearColumnToRowSetting","\u6e05\u7a7a\u8bbe\u7f6e"));
R.on("click",function(){p=new va;I()});Fa.append(R);pb.append(Fa);g.append(pb)},pa=function(){var pb=$("<div>");F.layoutCtrlWithLRTB(pb,null,0,130,390,null,50);pb.addClass("modeler-designer-column-to-row-add-column");var Fa=$("<div>");F.layoutCtrlWithLRTB(Fa,null,0,80,6,null,20);Fa.addClass("modeler-designer-column-to-row-advanced-setting");Fa.on("click",la);pb.append(Fa);var R=$("<div>");F.layoutCtrlWithLRTB(R,null,20,130,0,0,20);R.addClass("modeler-designer-column-to-row-advanced-setting-desc");
R.text(D.get("advancedSetting","\u9ad8\u7ea7"));R.css("text-align","right");R.appendTo(Fa);R=$("<div>");F.layoutCtrlWithLRTB(R,null,4,7,4,null,7);R.addClass("modeler-designer-column-to-row-advanced-setting-desc-icon");R.appendTo(Fa);l=$("<div class='modeler-designer-column-to-row-add-column-button'>");F.layoutCtrlWithLRTB(l,null,1,160,26,null,28);l.text(D.get("addColumnButton","\u65b0\u589e\u201c\u8f6c\u7f6e\u540e\u7684\u503c\u5217\u201d"));l.on("click",function(Da){Da=f.getColumnsCount();f.insertColumn(Da-
1,"").setWidth(200);I();la()});pb.append(l);l.hide();g.append(pb)},la=function(){"block"===l.css("display")?l.hide():l.show()},X=function(pb,Fa){return pb.indexOf(Fa)==pb.length-Fa.length},$a=function(pb,Fa){if(!Fa){Fa=0;var R=p.getAttrFieldAlias();R&&(Fa=nb(R,Fa));R=p.getTargetValueFieldAlias();if(null!=R&&0<R.length)for(var Da in R)Fa=nb(R[Da],Fa);for(Da=0;Da<u.length;Da++)Fa=nb(u[Da].getAlias(),Fa);Fa="column"+(parseInt(Fa)+1)}return pb+"\uff08"+Fa+"\uff09"},nb=function(pb,Fa){if(0!==pb.indexOf("column"))return Fa;
(pb=pb.substring(6,pb.length))&&/^\+?[1-9][0-9]*$/.test(pb)&&(pb=parseInt(pb),null!=Fa&&void 0!=Fa&&Fa<pb&&(Fa=pb));return Fa},Ib=function(pb,Fa){return Fa&&X(Fa,"\uff09")?Fa.substring(Fa.indexOf("\uff08")+1,Fa.lastIndexOf("\uff09")):"column"+pb},Gb=function(pb,Fa){return 1==Fa},vb=function(pb,Fa,R,Da,ua){R.setValue(Da);return!0},sb=function(pb,Fa,R,Da){pb=null;Fa?(Fa=KTableUIAbstractView.createCellId(f.getRow(R),f.getColumn(f.getColumnsCount()-1)),pb=b.getJqUi().find("#"+Fa),Fa=$("<div>"),Fa.text(D.get("insertRow",
"\u63d2\u5165")),Fa.addClass("modeler-designer-filter-table-op"),Fa.css("left","35px"),Fa.on("click",function(){p.getColumnToRowItems().splice(R-3,0,null);I()}),Fa.appendTo(pb),Fa=$("<div>"),Fa.text(D.get("deleteRow","\u5220\u9664")),Fa.addClass("modeler-designer-filter-table-op"),Fa.css("right","35px"),Fa.on("click",function(){p.deleteColumnToRowItem(R-3);I()}),Fa.appendTo(pb)):n&&n.find(".modeler-designer-filter-table-op").remove();n=pb},Rb=function(pb,Fa,R,Da,ua){for(var t=0;t<Da;t++)pb=pb.prev();
Wb(R,pb,Fa);if(1<Da&&0<=ua)a:for(Fa=Da-2,Da=3;Da<R.getRowsCount();Da++){if(pb=R.getRow(Da).getCell(1).getValue())b:{pb=ua;t=Fa;var r=R.getRow(pb+3).getCell(t+2).getValue();if(r=r?r.getFullName():"")for(var A=p.getColumnToRowItems(),v=0;v<A.length;v++){var S=A[v];if(S)for(var na=S.getFields(),y=0;y<na.length;y++)if(na[y]&&(v!==pb||y!==t)&&na[y].getFullName()==r){na.splice(y,1,null);S.setFields(na);pb=!0;break b}}pb=!1}if(pb){I();break a}}},Wb=function(pb,Fa,R){if(R){try{var Da=R.getCell(1)}catch(A){return}var ua=
!1;Da&&Da.getValue()&&(ua=!0);Da=!1;for(var t=2;t<pb.getColumnsCount()-1;t++){var r=R.getCell(t);if(r&&r.getValue()){Da=!0;break}}if(ua&&!Da||Da&&!ua)return E=D.get("existColumnToRowErrorItem","\u5b58\u5728\u4e0d\u5b8c\u6574\u7684\u914d\u7f6e\u9879\u3002"),Fa&&Xb(Fa,E),!1;ua=!1;for(Da=2;Da<pb.getColumnsCount()-1;Da++)if((t=R.getCell(Da))&&t.getValue()&&(t=t.getValue())&&!J[t.getFullName()]){ua=!0;break}if(ua)return E=D.get("disappearedField","\u5b57\u6bb5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002"),
!1}Fa&&Xb(Fa,null);return!0},Xb=function(pb,Fa){pb=$(pb);pb.find(".modeler-designer-column-to-row-prompt").remove();if(Fa){var R=ba.createWarning();R.attr("title",Fa);R.addClass("modeler-designer-column-to-row-prompt");R.css({left:"5px",right:"0px"});R.appendTo(pb)}},Zb=function(){var pb={};u.forEach(function(t){pb[t.getAlias()]=t});var Fa=[],R=p.getAttrFieldAlias(),Da=p.getTargetValueFieldAlias();Fa.push(R);Fa=Fa.concat(Da);for(var ua in Fa)if(R=Fa[ua],pb[R])return D.get("existsSameColumnName","\u5f53\u524d\u8bbe\u7f6e\u7684\u7b2c#1\u5217\u5217\u540d\u79f0\u201c#2\u201d\u4e0e\u5df2\u5b58\u5728\u7684\u5217\u540d\u79f0\u91cd\u590d\u3002").replace("#1",
parseInt(ua)+1).replace("#2",R)}}function G(){this.isRowDraggable=function(a,b){return!0};this.isColumnDraggable=function(a,b){return!0};this.getMinRowHeightLimited=function(a,b){return 3};this.getMinColumnWidthLimited=function(a,b){return 4};this.rowDraggedAction=function(a,b,f){var g=a.isSyncUIWhenModelChanged();a.setSyncUIWhenModelChanged(!0);b=a.getRow(b);b.setHeight(b.getHeight()+f);a.setSyncUIWhenModelChanged(g)};this.columnDraggedAction=function(a,b,f){var g=a.isSyncUIWhenModelChanged();a.setSyncUIWhenModelChanged(!0);
b=a.getColumn(b);b.setWidth(b.getWidth()+f);a.setSyncUIWhenModelChanged(g)};this.getTailBlankForDragging=function(){return 0}}function O(){function a(){var V=[],J,z,B,I,ia,aa=!1,pa=!0;this.setItemModel=function(la){V=la};this.setShowFieldNameEnable=function(la){pa=la};this.setRawTypeSwitchListener=function(la){};this.setSearchListener=function(la){J=la};this.setListItemPainter=function(la){z=la};this.setShowFieldNameListener=function(la){B=la};this.createJqPopup=function(la,X,$a){I=$("<div>");I.appendTo(la);
ia=$("<div>");I.addClass("modeler-designer-field-popup");la=D.get("search","\u641c\u7d22");var nb=new Qb;nb.setSearchListenerDelay(200);nb.setPlaceholder(la);nb.addSearchListener(function(){J(V,nb.getText(),ia,X,z,aa)});la=nb.getJqUi();la.addClass("modeler-designer-field-popup-search");la.appendTo(I);ia.addClass("modeler-designer-field-popup-list-owner");ia.on("click",function(vb){var sb=$(vb.currentTarget);vb=$(vb.target);if(vb=F.upwardSearchHasClass(vb,sb,"modeler-designer-field-popup-list-item"))vb.addClass("modeler-designer-list-item_selected_enabled"),
sb=vb.data("model"),$a(sb)});ia.appendTo(I);la=I.find(".sa-ctrl-textfield-input");la.css("top","0px");la.css("height","100%");if(0==V.length)g(ia,D.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5"));else for(la=0;la<V.length;la++)z(V[la],ia,X);if(pa){var Ib=D.get("showFieldName","\u663e\u793a\u539f\u5b57\u6bb5\u540d\u79f0");la=new w;la.setText(Ib);la=la.getJqUi();la.attr("title",Ib);la.addClass("modeler-designer-field-popup-show-field-name-label");Ib=new Tb;Ib.addStateChangeListener(function(vb,
sb,Rb){(aa=Rb)?B&&B(ia,!0):B&&B(ia,!1)});Ib.setOn(!1);Ib=Ib.getJqUi();Ib.addClass("modeler-designer-field-popup-show-field-name-button");var Gb=$("<div>");Gb.addClass("modeler-designer-field-popup-show-field-name");Ib.appendTo(Gb);la.appendTo(Gb);Gb.appendTo(I)}else ia.css("bottom","5px")}}var b,f;this.createChooseFieldPanel=function(V,J){b=V;f=J;V=new a;V.setListItemPainter(u);V.setSearchListener(l);V.setShowFieldNameListener(n);return V};var g=function(V,J){var z=new w;z.setText(J);z.setEnabled(!1);
z.setAlign(w.ALIGN_CENTER);J=z.getJqUi();J.addClass("modeler-designer-field-popup-no-data");J.appendTo(V)},l=function(V,J,z,B,I,ia){J=J.trim().toLowerCase();for(var aa=[],pa,la=0;la<V.length;la++)(pa=V[la])&&(pa=-1!=pa.getAlias().toLowerCase().indexOf(J)?!0:ia&&-1!=pa.getName().toLowerCase().indexOf(J)?!0:!1)&&aa.push(V[la]);z.children().remove();if(0<aa.length){for(la=0;la<aa.length;la++)I(aa[la],z,B);aa.length=0}else""==J?g(z,D.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5")):g(z,D.get("noSearchResult",
"\u627e\u4e0d\u5230\u7b26\u5408\u7684\u7ed3\u679c"));n(z,ia)},n=function(V,J){if(J)for(V=V.find(".modeler-designer-field-popup-list-item-text-name"),J=0;J<V.length;J++){var z=V.eq(J);z.css("display","inline-block");var B=z.prev().text()+z.text();z.prev().attr("title",null);z.parent().attr("title",B)}else for(V=V.find(".modeler-designer-field-popup-list-item-text-name"),J=0;J<V.length;J++)z=V.eq(J),z.css("display","none"),z.parent().attr("title",null),z.prev().attr("title",z.prev().text())},p=function(V,
J){var z=J?J.getAlias():"",B=$("<span>");B.text(z);B.attr("title",z);B.addClass("modeler-designer-field-popup-list-item-text-alias");if(J){z=C.FieldNumberHelper.getFieldNumber(J)?C.FieldNumberHelper.getFieldNumber(J):"";var I=J.getFromNode();I=b.getNode(I);J=(I=b.getNodeSource(I))&&I.getSourceType()==Ua.SOURCE_TYPE_CURRENT_ENTITY_SOURCE?J.getName():z}else J="";z=$("<span>");z.addClass("modeler-designer-field-popup-list-item-text-name");z.text("("+J+")");V.append(B);V.append(z)},u=function(V,J,z){var B=
$("<div>");B.addClass("modeler-designer-field-popup-list-item");B.data("model",V);if(f){var I=$("<div>");I.addClass("modeler-designer-field-popup-list-item-icon");V&&bb.background(I,V.getOutputDataType());var ia=$("<div>");ia.addClass("modeler-designer-field-popup-list-item-text");p(ia,V);B.append(ia);B.append(I)}else p(B,V);J.append(B);z&&V&&z.getFullName()==V.getFullName()&&E(J,B)},E=function(V,J){var z=null;0<V.height()?(clearTimeout(z),J.addClass("modeler-designer-list-item_selected_enabled"),
V.prop("scrollTop",J.prop("offsetTop"))):z=setTimeout(function(){E(V,J)},0)}}function ya(){this.makeUrl=function(a){return"../qinganalysis/qingmodeler/designer/svgicon/"+a+".svg"};this.getTableIconColor=function(a){var b="#ffa500";if(a)switch(a.getSourceType()){case Ua.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:case Ua.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE:b="#A06AE2";break;case Ua.SOURCE_TYPE_MODEL_SET_SOURCE:b="#40A9FF";break;case Ua.SOURCE_TYPE_MODELSET_FILE_SOURCE:b="#F67682";break;case Ua.SOURCE_TYPE_OPEN_API_SOURCE:b=
"#73D13D"}return b}}function ka(){var a=this,b={};this.init=function(g){a.protectedInit(g);g=g.getAllNodes();b={};if(g)for(var l=0;l<g.length;l++)a.getNodeDisplayName(g[l])};this.protectedInit=function(g){};this.protectedGetDefaultName=function(g){throw Error("override me");};this.getNodeDisplayName=function(g){if(!g)return"";var l=g.getAlias();if(l)return b[g.getId()]=l;l=g.getId();if(l=b[l])return l;var n=a.protectedGetDefaultName(g);l=g.getNameIndex();l=f(n,l);n=l[0];(l=l[1])&&g.setNameIndex(l);
return b[g.getId()]=n};this.isDuplicate=function(g,l){for(var n=Object.keys(b),p=!1,u=0,E=n.length;u<E;u++)if(b[n[u]]==g&&(!l||l.getId()!=n[u])){p=!0;break}return p};var f=function(g,l){var n=l?g+"_"+l:g;var p=[n,l];a.isDuplicate(n)&&(p=f(g,l?l+1:1));return p};this.protectedMethod={cacheDisplayName:function(g,l){b[g]=l}}}function ca(){var a,b,f=0,g={},l={},n,p,u;this.getSelectedEntityName=function(){var aa,pa;for(pa in g){var la=g[pa];la&&la.isChecked()&&(aa=aa?aa+C.ENTITY_SEPARATOR+pa:pa)}return aa};
this.setFunUpdateProperties=function(aa){a=aa};this.setMeta=function(aa){p=aa};this.setSelectedTableNames=function(aa){if(p.getTableNode())for(u=aa,aa=0;aa<u.length;aa++){var pa=u[aa],la=g[pa];la&&(la.setChecked(!0),ia(la,!0),a(l[pa],pa))}};this.getJqUi=function(){if(!b){b=$("<div>");b.addClass("modeler-designer-selected-field-entry-panel");if(!p.getTableNode()){var aa=$("<div>");aa.addClass("modeler-designer-select-field-no-data-text");aa.text(D.get("noTableToSelect","\u6682\u65e0\u53ef\u9009\u62e9\u7684\u8868"));
aa.appendTo(b);return b}var pa=new Lb;pa.fromJsonObject(p.getTableNode());var la=new Qa;la.setLevel(0);la.toFolderLevelNode(pa);E(la,0);pa=p.getPropertyMap();for(aa in pa)l[aa]=pa[aa]}return b};var E=function(aa,pa){if(aa.getDisplayName()){var la=pa,X=$("<div>");X.addClass("modeler-designer-selected-entity-item");var $a=new kb;$a.setUserObject(aa);0==la&&aa.getName();g[aa.getName()]=$a;$a.addCheckedListener(ia);$a=$a.getJqUi();F.layoutCtrl($a,20*la,30*f,15,20);$a.appendTo(X);$a=$("<div>");$a.addClass("modeler-designer-selected-entity-item-ui");
$a.attr("entity-name",aa.getName());$a.on("click",B);F.layoutCtrlWithLRTB($a,20*la+18,10,null,30*f,0,20);var nb=$("<div>");nb.addClass("modeler-designer-selected-entity-item-text");nb.text(aa.getDisplayName());nb.attr("title",aa.getDisplayName());F.layoutCtrl(nb,23,2,null,20);nb.appendTo($a);nb=$("<span>");nb.addClass("modeler-designer-selected-entity-item-icon");bb.background(nb,"entity-entry");0==la&&bb.background(nb,"entity-sub");F.layoutCtrl(nb,2,2,16,16);nb.appendTo($a);$a.appendTo(X);X.appendTo(b);
f++;++pa}if(la=aa.getChildren())for(X=0;X<la.length;X++)$a=new Qa,$a.setLevel(pa),$a.toFolderLevelNode(la[X]),$a.setParentNode(aa),E($a,pa)},V=function(aa,pa){if((aa=aa.getChildren())&&0<aa.length)for(var la=0;la<aa.length;la++){var X=aa[la];pa[X.getName()]=X;V(X,pa)}},J=function(aa,pa){if(aa=aa.getParentNode())pa[aa.getName()]=aa,J(aa,pa)},z=function(aa){var pa={};if(!aa)return pa;if(aa=aa.getChildren())for(var la=0;la<aa.length;la++){var X=aa[la];pa[X.getName()]=X}return pa},B=function(aa){aa=$(aa.currentTarget).attr("entity-name");
a(l[aa],aa);n&&I(!1);n=aa;I(!0)},I=function(aa){var pa=b.find("[entity-name='"+n+"']");pa&&(aa?pa.addClass("modeler-designer-selected-entity-item-ui_selected"):pa.removeClass("modeler-designer-selected-entity-item-ui_selected"))},ia=function(aa,pa){if(pa){pa=aa.getUserObject();a(l[pa.getName()],pa.getName());var la=pa.getParentNode(),X=z(pa),$a={};V(pa,$a);var nb={};J(pa,nb);var Ib=!1;for(vb in $a){var Gb=g[vb];if(Gb&&Gb.isChecked()){Ib=!0;break}}var vb=Ib;Ib=!1;for(sb in nb)if((Gb=g[sb])&&Gb.isChecked()){Ib=
!0;break}var sb=Ib;if(aa.isChecked()){n&&I(!1);n=pa.getName();I(!0);la&&(aa=g[la.getName()])&&aa.setEnabled(!0);for(var Rb in g)aa=g[Rb],pa.getName()==Rb||la&&Rb==la.getName()||vb&&$a[Rb]||sb&&nb[Rb]||(X[Rb]?aa.setEnabled(!0):aa.setEnabled(!1))}else for(Rb in n&&I(!1),n=pa.getName(),I(!0),la=z(la),g)aa=g[Rb],pa.getName()==Rb||sb&&nb[Rb]||(la[Rb]?aa.setEnabled(!0):($a[Rb]&&aa.isChecked()&&aa.setChecked(!1),aa.setEnabled(!sb)))}}}function N(){var a,b,f,g;this.setMeta=function(l){a=l};this.setCurrentTableName=
function(l){b=l};this.getCurrentTableName=function(){return b};this.setSelectedPropertyName=function(l){f=l};this.getSelectedPropertyName=function(){return f};this.getMeta=function(){return a};this.getJqUi=function(){};this.getSelectedProperties=function(){return null};this.getSelectedEntityName=function(){};this.getIsEntityView=function(){return!1};this.setWidth=function(l){g=l};this.getWidth=function(l){return g}}function Ga(){N.call(this);var a=this,b,f,g,l,n,p={},u=[];this.setLockPropertyName=
function(I){u=I};this.setArrProperties=function(I,ia){l=ia;g=I;E(!0)};this.getTableFieldMap=function(){return p};var E=function(I){if(g&&0!=g.length){n=[];if(p[l])var ia=p[l];else{ia=g;for(var aa=a.getCurrentTableName().split(C.ENTITY_SEPARATOR),pa=0;pa<ia.length;pa++){var la=ia[pa],X=new Oa;X.setField(la);X.setDisplayName(la.getAlias());u&&-1!=u.indexOf(la.getName())&&(X.setEnabled(!1),X.setShowRelationIcon(!0));X.setSelected(!0);-1!=aa.indexOf(l)&&a.getSelectedPropertyName()&&-1==a.getSelectedPropertyName().indexOf(la.getName())&&
X.setSelected(!1);n.push(X)}p[l]||(p[l]=n);ia=n}f.setArrFieldItems(ia,I)}},V=function(){var I=a.getMeta().getRelations();if(I&&0<I.length){u=[];for(var ia=0;ia<I.length;ia++){var aa=I[ia];-1==u.indexOf(aa.getFromProperty())&&u.push(aa.getFromProperty())}}};this.getJqUi=function(){b||J();return b};var J=function(){b=$("<div>");b.addClass("modeler-designer-selected-field-panel");f=new Pa;f.setJqNoDataUI(z());f.setShowAllCheckbox(!0);f.setFunFieldCheckClick(function(ia,aa){aa.setSelected(ia)});var I=
f.getJqUi();I.addClass("modeler-designer-selected-field-list-panel");I.appendTo(b);l=a.getCurrentTableName();a.getMeta().getPropertyMap()&&(g=a.getMeta().getPropertyMap()[l]);V();E()},z=function(){var I=$("<div>");I.text(D.get("noDataTips","\u6682\u65e0\u6570\u636e"));I.addClass("modeler-designer-select-field-no-data-text");return I},B=!0;this.getSelectedProperties=function(){if(!g)return[];var I=[],ia={};B=!0;var aa=p[a.getCurrentTableName()];if(!aa)return[];for(var pa=0;pa<aa.length;pa++){var la=
aa[pa],X=la.getField();ia[X.getFullName()]||(la.getSelected()?(I.push(X),ia[X.getFullName()]=!0):B=!1)}return I};this.isSelectAll=function(){return B}}function Pa(){var a=[],b=[],f,g,l,n,p,u=!1,E=!1,V=!0,J=!0,z=!0,B,I,ia,aa,pa,la,X,$a;this.getContentPaneCreator=function(){return vb};this.show=function(){g.show()};this.hide=function(){g.hide()};this.getJqUi=function(){g||vb();return g};this.setJqNoDataUI=function(ua){I=ua};this.getArrFieldItems=function(){return a};this.setArrFieldItems=function(ua,
t){a=[];nb(ua,t);Wb()};this.setFunFieldCheckClick=function(ua){pa=ua};this.setFunAllCheckboxClick=function(ua){la=ua};this.setAllCheckboxSelected=function(ua){ia.setChecked(ua)};this.setShowSearchText=function(ua){z=ua};var nb=function(ua,t){B.empty();ua&&0!==ua.length?I&&I.hide():I&&I.show();t&&(u=!1,n&&n.setChecked(!1),l&&l.clear());E&&(t=Gb(ua),B.append(sb(t==ua.length)),Rb(t));for(t=0;t<ua.length;t++){var r=ua[t];r.setFunFieldCheckClick(R);a.push(r)}b=a;f=new k;f.setItemHeight(31);ua=f.getJqUi();
f.setItemUiCreator(function(A){A=b[A];A.initJqUi();var v=A.getJqUi();v.css({width:"100%",position:"relative"});n&&n.isChecked()&&!A.getSelected()&&v.hide();return v});$a=E?31:0;F.layoutCtrlWithLRTB(ua,0,0,null,$a,0,null);Ib();ua.appendTo(B)},Ib=function(){f.setItemCount(b.length);setTimeout(f.repaint,0)},Gb=function(ua){for(var t=0,r=0;r<ua.length;r++)ua[r].getSelected()&&t++;return t},vb=function(){if(!g){g=$("<div>");if(z){var ua=$("<div class='modeler-designer-select-field-search-text'>");ua.text(D.get("search",
"\u641c\u7d22"));ua.appendTo(g)}ua=g;var t=ua.append;l=new Qb;l.setShowSearchIcon(!0);l.addSearchListener(Wb);l.setSearchListenerDelay(500);l.setPlaceholder(D.get("inputSearchText","\u8f93\u5165\u641c\u7d22\u6587\u672c"));var r=l.getJqUi();r.addClass("modeler-designer-select-field-search-box");z?r.css("left","10px"):r.css("width","90%");t.call(ua,r);V&&g.append(pb);B=$("<div class='modeler-designer-select-field-list'>");J&&B.css("overflow","scroll");I&&g.append(I);g.append(B)}return g},sb=function(ua){var t=
$("<div>");t.addClass("modeler-desinger-select-field-lineitem");ia=new kb;ia.setChecked(ua);ia.addCheckedListener(Zb);ua=ia.getJqUi();ua.addClass("modeler-designer-field-item-checkbox");ua.appendTo(t);ua=$("<div>");ua.addClass("modeler-designer-field-item-allcheckbox-text");ua.text(D.get("selectAll","\u5168\u9009"));ua.appendTo(t);aa=$("<div>");aa.addClass("modeler-designer-field-item-selected-prompt");aa.text(D.get("selectedItemsPrompt","(\u5df2\u9009\u62e9#1\u9879)"));aa.appendTo(t);return t},Rb=
function(ua){aa&&aa.text(D.get("selectedItemsPrompt","(\u5df2\u9009\u62e9#1\u9879)").replace("#1",ua))},Wb=function(ua){p=$.trim(l.getText());Xb(a,p)},Xb=function(ua,t){var r=[];if(0==t.length){X&&X.hide();ua&&0!==ua.length||I.show();for(var A=0;A<ua.length;A++){var v=ua[A];if(!u||v.getSelected())v.show(!0),r.push(v)}b=r;ia&&ia.setChecked(Da())}else{var S=!0;for(A=0;A<ua.length;A++)if(v=ua[A],!u||v.getSelected())-1===v.getDisplayName().toLowerCase().indexOf(t.toLowerCase())?v.show(!1):(v.show(!0),
S=!1,r.push(v));S?(X||(X=$("<div>"),X.addClass("modeler-designer-addsource-noresult-view-container"),ua=$("<div>"),ua.addClass("modeler-designer-addsource-noresult-view-icon"),bb.background(ua,"search-no-result"),ua.appendTo(X),ua=$("<div>"),ua.addClass("modeler-designer-addsource-noresult-view-tip"),ua.text(D.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),ua.appendTo(X),X.appendTo(g),X.hide()),X.show(),I&&I.hide(),ia&&ia.setChecked(!1)):(X&&X.hide(),ia&&
ia.setChecked(Da()));b=r}Ib()};this.updateSelectedItemsPrompt=function(){Rb(Gb(a))};var Zb=function(ua,t){if(t){for(var r=0;r<a.length;r++){var A=a[r];A.isShow()&&A.getEnabled()&&A.setSelected(ua.isChecked())}la&&la(ua,t);ua=Gb(a);Rb(ua);f.keepState();f.repaint();f.restoreState()}},pb=function(){n=new kb;n.setChecked(u);n.addCheckedListener(Fa);n.setText(D.get("showOnlyChecked","\u4ec5\u663e\u793a\u9009\u4e2d\u9879"));var ua=n.getJqUi();F.layoutCtrl(ua,290,5,200,23);return ua},Fa=function(ua,t){t&&
((u=ua.isChecked())?a.forEach(function(r){r.getSelected()||r.show(!1)}):a.forEach(function(r){r.show(!0)}),Xb(a,p))};this.setShowAllCheckbox=function(ua){E=ua};this.setShowScroll=function(ua){J=ua};this.setShowOnlyChecked=function(ua){V=ua};var R=function(ua,t){pa&&pa(ua,t);ua=Gb(a);Rb(ua);ia&&ia.setChecked(Da())},Da=function(){for(var ua=!0,t=0;t<a.length;t++){var r=a[t];if(r.isShow()&&!r.getSelected()){ua=!1;break}}return ua}}function Qa(){Lb.call(this);var a=this,b,f;this.getLevel=function(){return b};
this.setLevel=function(g){b=g};this.getParentNode=function(){return f};this.setParentNode=function(g){f=g};this.toFolderLevelNode=function(g){a.setName(g.getName());a.setDisplayName(g.getDisplayName());a.setChildren(g.getChildren());a.setLevel(b)}}function Ia(){var a,b=Ia.TYPE_TEXT,f=D.get("noDataTips","\u6682\u65e0\u6570\u636e"),g;this.getJqUi=function(){if(!a)switch(a=$("<div>"),a.addClass("modeler-designer-no-data"),b){case Ia.TYPE_TEXT:n(f,"modeler-designer-no-data-only-text");break;case Ia.TYPE_NO_SOURCE:l("no_source",
"modeler-designer-no-data-icon");n(f,"modeler-designer-no-data-text");break;case Ia.TYPE_NO_SEARCH_RESULT:l("search-no-result","modeler-designer-node-selection-icon");n(f,"modeler-designer-node-selection-tip");break;case Ia.TYPE_NO_DATA_WITH_CLOUD:l("no_data_cloud","modeler-designer-no-data-cloud-icon");n(f,"modeler-designer-no-data-text");break;default:throw Error("The view type error, please set first.");}return a};this.setType=function(p){b=p};this.setText=function(p){f=p?p:"";g&&g.text(f)};var l=
function(p,u){var E=$("<div>");E.addClass(u);bb.background(E,p);E.appendTo(a)},n=function(p,u){g=$("<div>");g.addClass(u);g.text(p);g.appendTo(a)}}function Oa(){var a=this,b,f,g=!1,l=!0,n=!0,p,u,E,V;this.setField=function(z){b=z};this.getField=function(){return b};this.setDisplayName=function(z){b&&b.setAlias(z)};this.getDisplayName=function(){return b.getAlias()};this.getFieldType=function(){return b.getOutputDataType()};this.setSelected=function(z){g=z;p&&p.setChecked(z)};this.setShowRelationIcon=
function(z){E=z};this.show=function(z){z?u&&u.show():u&&u.hide();n=z};this.isShow=function(){return n};this.getSelected=function(){return p?p.isChecked():g};this.setEnabled=function(z){l=z};this.getEnabled=function(){return l};this.getJqUi=function(){return u};this.getName=function(){return f};this.setFunFieldCheckClick=function(z){V=z};this.initJqUi=function(){u=$("<div>");p=new kb;p.setUserObject(a);p.setChecked(g);p.setEnabled(a.getEnabled());p.addCheckedListener(function(z,B){B&&(V&&V(z.isChecked(),
a),f="F"+(new Date).getTime())});J(a,p);return u};var J=function(z,B){var I=$("<div>");I.addClass("modeler-desinger-select-field-lineitem");B=B.getJqUi();B.addClass("modeler-designer-field-item-checkbox");B.appendTo(I);B=$("<div>");B.addClass("modeler-designer-field-item-checkbox-text");B.text(z.getDisplayName());B.attr("title",z.getDisplayName());z=z.getFieldType();var ia=$("<div>");ia.addClass("modeler-designer-field-item-icon");bb.background(ia,z);ia.appendTo(I);B.appendTo(I);E&&(z=$("<div>"),
z.addClass("modeler-designer-field-item-relation-icon"),bb.background(z,"relation"),z.appendTo(I));I.appendTo(u)}}function M(){Ma.call(this);var a=this.protectedMethod,b=this,f,g,l,n,p=!1,u=!1,E,V,J;(function(){a.setSelectable(!0);a.setContentPaneCreator(function(){b.setSize(440,330);return z()});a.setFooterPaneCreator(function(aa){var pa=new qa(D.get("confirm","\u786e\u5b9a"));pa.setHighlight(!0);var la=pa.getJqUi();la.addClass("sa-ctrl-dialog-footer-ok");la.appendTo(aa);pa.addActionListener(function(X){X=
f.getValue();var $a=g.getValue();J&&J(p,X,$a,u);a.destroy();return!0});pa=new qa(D.get("cancel","\u53d6\u6d88"));pa.setHighlight(!1);la=pa.getJqUi();la.addClass("sa-ctrl-dialog-footer-cancel");la.appendTo(aa);pa.addActionListener(function(X){a.destroy();return!0})});a.setClosingAction(function(aa){})})();this.setTitle=function(aa){E=aa};this.setOriginExtractCount=function(aa){l=aa};this.setOriginPreviewCount=function(aa){n=aa};this.setAllData=function(aa){p=aa};this.setAllDataPreview=function(aa){u=
aa};this.isCreatePreviewAllBtn=function(aa){V=aa};this.setConfirmCallback=function(aa){J=aa};var z=function(){a.setTitle(E);var aa=$("<div>"),pa=$("<div>");pa.text(D.get("extractSet","\u62bd\u53d6\u8bbe\u7f6e"));F.layoutCtrl(pa,30,20,100,24);pa.appendTo(aa);pa.css({color:"#333333","line-height":"24px","font-size":"14px"});pa=I("extract",D.get("extract","\u62bd\u53d6\u524d"),aa);var la=pa.getJqUi();F.layoutCtrlWithLRTB(la,60,null,300,60,null,null);f=new e;var X=f.getJqUi();f.setConstraint(1,1E4,1);
f.setValue(l);F.layoutCtrlWithLRTB(X,122,null,100,49,null,null);X.appendTo(aa);X=$("<div>");X.text(D.get("rowDataCalculate","\u884c\u6570\u636e\u8ba1\u7b97"));X.css("color","#666");F.layoutCtrlWithLRTB(X,170,0);F.layoutCtrlMiddleAlign(X,22);X.appendTo(la);la=I("extractAll",D.get("all","\u5168\u91cf"),aa);X=la.getJqUi();F.layoutCtrlWithLRTB(X,60,null,300,90,null,null);var $a=$("<div>");bb.background($a,"warning");$a.attr("title",D.get("extractAllWarn","\u62bd\u53d6\u5168\u91cf\u6570\u636e\u8ba1\u7b97\u65f6\uff0c\u4f1a\u589e\u52a0\u6570\u636e\u9884\u89c8\u7684\u65f6\u957f\uff0c\u589e\u52a0\u670d\u52a1\u5668\u538b\u529b\uff0c\n\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\uff0c\u56e0\u6b64\u63a8\u8350\u62bd\u53d6\u90e8\u5206\u6570\u636e\u3002"));
F.layoutCtrlWithLRTB($a,110,null,20,80,null,20);$a.appendTo(aa);X=new sa;X.addElement(pa);X.addElement(la);X.addChangedListener(function(nb,Ib){Ib&&("extract"===nb.getUserObject()?(p=!1,f.setEnabled(!0),$a.hide()):(p=!0,f.setEnabled(!1),$a.show()))});p?(ia(X,"extractAll"),f.setEnabled(!1),$a.show()):(ia(X,"extract"),f.setEnabled(!0),$a.hide());pa=$("<div>");pa.text(D.get("dataPreview","\u6570\u636e\u9884\u89c8"));F.layoutCtrl(pa,30,115,100,24);pa.appendTo(aa);pa.css({color:"#333333","line-height":"24px",
"font-size":"14px"});pa=I("dataPreview",D.get("previewResult","\u9884\u89c8\u8ba1\u7b97\u7ed3\u679c\u7684\u524d"),aa);pa.setChecked(!0);la=pa.getJqUi();F.layoutCtrlWithLRTB(la,60,null,300,155,null,null);g=new e;X=g.getJqUi();g.setConstraint(1,1E3,1);g.setValue(n);F.layoutCtrlWithLRTB(X,180,null,100,144,null,null);X.appendTo(aa);X=$("<div>");X.text(D.get("rowData","\u884c\u6570\u636e"));X.css("color","#666");F.layoutCtrlWithLRTB(X,230,0);F.layoutCtrlMiddleAlign(X,22);X.appendTo(la);V&&B(aa,pa);return aa},
B=function(aa,pa){var la=I("PreviewAll",D.get("all","\u5168\u91cf"),aa),X=la.getJqUi();F.layoutCtrlWithLRTB(X,60,null,300,185,null,null);var $a=$("<div>");bb.background($a,"warning");$a.attr("title",D.get("PreviewAllWarn","\u9884\u89c8\u5168\u91cf\u6570\u636e\u8ba1\u7b97\u65f6\uff0c\u4f1a\u589e\u52a0\u6570\u636e\u9884\u89c8\u7684\u65f6\u957f\uff0c\u589e\u52a0\u670d\u52a1\u5668\u538b\u529b\uff0c\n\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\uff0c\u56e0\u6b64\u63a8\u8350\u9884\u89c8\u90e8\u5206\u6570\u636e\u3002"));
F.layoutCtrlWithLRTB($a,110,null,20,175,null,20);$a.appendTo(aa);aa=new sa;aa.addElement(pa);aa.addElement(la);aa.addChangedListener(function(nb,Ib){Ib&&("dataPreview"===nb.getUserObject()?(u=!1,g.setEnabled(!0),$a.hide()):(u=!0,g.setEnabled(!1),$a.show()))});u?(ia(aa,"PreviewAll"),g.setEnabled(!1),$a.show()):(ia(aa,"dataPreview"),g.setEnabled(!0),$a.hide())},I=function(aa,pa,la){var X=new Va;X.setUserObject(aa);X.setText(pa);aa=X.getJqUi();la.append(aa);return X},ia=function(aa,pa){aa.toCheckTheElement(function(la){return la.getUserObject()===
pa})}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var C=com.kingdee.bos.qing.modeler.designer;C.DragHandler=function(){var a=$(document.body),b,f,g,l,
n,p,u,E,V,J,z;this.bindDragUi=function(la,X){var $a=!1,nb=[-1,-1],Ib=null,Gb=function(){b=$a=!1;Ib=null;nb=[-1,-1]};la.on("mousedown",function(vb){$a=!0;b=!1;Ib=$(vb.target);nb=[vb.screenX,vb.screenY]});la.on("mouseup",function(vb){Gb()});la.on("mouseleave",function(vb){$a&&Gb()});la.on("mousemove",function(vb){var sb=!1;$a&&(sb=5<Math.abs(vb.screenX-nb[0])||5<Math.abs(vb.screenY-nb[1]));sb&&($a=!1,(l=X(Ib))&&!1!==l.getTable().getDisableDrag()?(p=new cb,g=E(),n=l.getTableNode(),b=!0,a.on("mousemove",
B),a.on("mouseup",I),a.on("mouseleave",aa)):Gb())})};this.bindDropUi=function(la,X,$a,nb,Ib){E=X;V=$a;J=nb;u=Ib};var B=function(la){if(b){if(!f){f=$("<div onselectstart='return false'>");f.addClass("modeler-dragdrop-mask");var X=F.getCurrentTargetPosition(la);X=F.upwardCoordinate(la.target,X,a[0]);f.data("target-origin-pos-left",X[0]);f.data("target-origin-pos-top",X[1]);f.appendTo(a)}if(X=V(la,g,n)){var $a=X.getJqPhysicalUi();p.isPrepared()||p.prepare(X.getModeler(),$a,u);z||(z=$("<div>"),F.layoutCtrlWithLRTB(z,
0,0,null,0,0,null),z.css("z-index",999999));z.appendTo($a);ia();la=[n.getX(),n.getY()];la=u.getScaledCoordinate(la);la=F.upwardCoordinate($a[0],la,a[0]);X=u.getScaledSize(n.getWidth());$a=u.getScaledSize(n.getHeight());F.layoutCtrl(f,la[0],la[1],X,$a)}else console.log("moving"),f.text(""),X=F.getCurrentTargetPosition(la),X=F.upwardCoordinate(la.target,X,a[0]),F.layoutCtrl(f,X[0]-20,X[1]-15,40,30)}},I=function(la){V(la,g,n)?(ia(),J(l,function(){f.remove();f=null}),pa(!0)):pa()},ia=function(){var la=
[n.getX(),n.getY(),n.getWidth(),n.getHeight()];p.anchor(la);n.setPosition(la[0],la[1])},aa=function(){pa()},pa=function(la){b=!1;!la&&f&&f.animate({left:f.data("target-origin-pos-left"),top:f.data("target-origin-pos-top"),width:4,height:3},function(){f.remove();f=null});a.off("mousemove",B);a.off("mouseup",I);a.off("mouseleave",aa);z&&z.remove();p&&p.abort()}};C.DragInsideCheckResult=function(a,b){this.getJqPhysicalUi=function(){return a};this.getModeler=function(){return b}};C.Svg=qb;C.TransformNodeCreator=
function(){wb.call(this);var a=this.protectedMethod,b=this,f,g,l,n,p,u,E=new qb;this.protectedGetItemModels=function(){return P.getAllTypes()};this.protectedGetListPainter=function(){return V};this.protectedGetOperateIconUi=function(){return g};this.protectedGetSuggestDropdownPos=function(){var z=$(document.body),B=J();B=F.upwardCoordinate(f.parent()[0],B,z[0]);z=B[0];B=B[1]+b.protectedGetOperateIconHeight();return[z,B]};this.protectedGetListItemSize=function(){return[Math.max(100,P.getMaxDisplayNameLength()+
26+5),30]};this.protectedGetOperateIconHeight=function(){return a.getScaledSize(20+a.getNode().getHeight())>>1};var V=function(z,B){var I=$("<div>");I.appendTo(z);F.layoutCtrl(I,5,null,16,16);F.layoutCtrlMiddleAlign(I,16);bb.background(I,B.getIconName());I=$("<div>");I.text(B.getDisplayName());I.attr("title",B.getDisplayName());I.css({"font-size":"12px","text-overflow":"ellipsis"});F.layoutCtrlWithLRTB(I,26,0,null,0,0,null);I.appendTo(z)};this.hook=function(z,B){var I=z!=a.getNode();b.setNode(z);
f=$(B);l||(l=E.createNode("g"),g=$(l),g.addClass(b.getMark()),g.on("click",a.doDropdown),n=E.createNode("rect"),E.setAttributes(n,{width:a.getScaledSize(30),height:a.getScaledSize(35),x:-a.getScaledSize(2)+"px",y:0,fill:"none","pointer-events":"visible"}),$(l).css("cursor","pointer"),l.appendChild(n));I&&($(p).remove(),$(u).remove(),u=E.createNode("circle"),E.setAttributes(u,{r:a.getScaledSize(20)>>1,fill:"#fff"}),l.appendChild(u),z=a.getNode(),p=E.createNode("image"),E.setAttributes(p,{width:a.getScaledSize(20),
height:a.getScaledSize(20),x:a.getScaledSize(2),y:a.getScaledSize(z.getHeight()-20)>>1,href:C.SvgIconHelper.makeUrl("add")}),l.appendChild(p));z=J();E.setAttributes(l,{transform:"translate("+z[0]+","+z[1]+")"});z=a.getNode();E.setAttributes(p,{width:a.getScaledSize(20),height:a.getScaledSize(20),x:a.getScaledSize(2),y:a.getScaledSize(z.getHeight()-20)>>1});I=a.getScaledSize(2);E.setAttributes(u,{r:a.getScaledSize(20)>>1,cx:(a.getScaledSize(20)>>1)+I,cy:a.getScaledSize(z.getHeight())>>1});E.setAttributes(n,
{width:a.getScaledSize(40),height:a.getScaledSize(40),x:-a.getScaledSize(2)+"px",y:0});B.appendChild(l)};this.release=function(){$(p).remove();$(u).remove();g&&g.detach();b.setNode(null)};this.getMark=function(){return"modeler-designer-transform-creator"};var J=function(){var z=a.getNode(),B=z.getX()+z.getWidth();z=z.getY();return a.getScaledCoordinate([B,z])}};C.NodeOperateCreator=function(){wb.call(this);var a=this.protectedMethod,b=this,f,g;this.hook=function(n,p,u){b.setNode(n);f=p;g=u};this.showOperateList=
function(){console.log("show operate");a.doDropdown()};this.getMark=function(){return"modeler-designer-node-operate"};this.protectedGetItemModels=function(){return C.NodeOperateTypeFactory.getAllTypes()};this.protectedGetListPainter=function(){return l};this.protectedGetOperateIconUi=function(){return g};this.protectedGetSuggestDropdownPos=function(){var n=$(document.body),p=a.getNode();var u=p.getX()+p.getWidth();p=p.getY()+p.getHeight();u=a.getScaledCoordinate([u-15,p-15]);u=F.upwardCoordinate(f[0],
u,n[0]);n=u[0];u=u[1]+b.protectedGetOperateIconHeight();return[n,u]};var l=function(n,p){n.text(p.getDisplayName())}};C.NodeRelinkHelper=function(){var a=this,b,f,g,l,n,p,u,E,V;this.hook=function(z,B){var I=z!=b;I&&(b=z);f||(l=new qb,f=l.createNode("g"),g=$(f),g.addClass(a.getMark()),g.on("click",J),$(f).css("cursor","pointer"));I&&($(p).remove(),$(n).remove(),n=l.createNode("circle"),l.setAttributes(n,{r:u.getScaledSize(16)>>1,fill:"#fff"}),f.appendChild(n),p=l.createNode("image"),l.setAttributes(p,
{width:u.getScaledSize(16),height:u.getScaledSize(16),x:u.getScaledSize(2),y:u.getScaledSize(b.getHeight()-16)>>1,href:C.SvgIconHelper.makeUrl("relink")}),f.appendChild(p),z=l.createNode("title"),l.setText(z,D.get("linkOtherNode","\u8fde\u63a5\u5176\u4ed6\u8282\u70b9")),f.appendChild(z));z=b.getX();I=b.getY();z=u.getScaledCoordinate([z,I]);l.setAttributes(f,{transform:"translate("+z[0]+","+z[1]+")"});l.setAttributes(p,{width:u.getScaledSize(16),height:u.getScaledSize(16),x:-(u.getScaledSize(16)>>
1),y:-(u.getScaledSize(16)>>1)});l.setAttributes(n,{r:u.getScaledSize(16)>>1,cx:0,cy:0});B.appendChild(f)};this.release=function(){$(p).remove();$(n).remove();g&&g.detach();b=null};this.getMark=function(){return"modeler-designer-transform-creator"};this.setScaleHelper=function(z){u=z};this.setGlobal=function(z){E=z};this.setLinkCallback=function(z){V=z};var J=function(){var z=new Ab(b);z.setGlobal(E);z.setLinkCallback(V);var B=z.getLinkableNode();B&&0!=B.length?z.showDialog():E.getMessageCurtain().showPrompt(D.get("noNodeToLink",
"\u6682\u65e0\u53ef\u8fde\u63a5\u8282\u70b9\uff0c\u8bf7\u4ece\u8868\u533a\u57df\u62d6\u5165\u4e00\u4e2a\u53ef\u8fde\u63a5\u7684\u8282\u70b9\u3002"))}};C.AbstractNodeUI=oa;C.LineUi=function(a,b){var f,g=new qb,l,n;this.getSvgElement=function(){f||(f=g.createNode("path"),g.setAttributes(f,{d:p(),"stroke-width":l?l.getScaledSize(1):1,fill:"none",stroke:"#7f93bc"}),u());return f};this.setScaleHelper=function(E){l=E};this.remove=function(){f&&f.remove();f=null};this.changePosition=function(){f&&g.setAttributes(f,
{d:p()})};this.setSelected=function(E){n=E;u()};var p=function(){for(var E=C.LineCoordinateHelper.getLinePathCoordinate(a,b),V="",J=0;J<E.length;J++){var z=E[J];z=[z.getX(),z.getY()];z=l?l.getScaledCoordinate(z):z;V=0==J?V+"M":V+" L";V+=g.getPathCoordinate(z[0],z[1])}return V},u=function(){f&&(n?g.setAttributes(f,{"stroke-width":l?l.getScaledSize(2):2,stroke:"#276ff5"}):g.setAttributes(f,{"stroke-width":l?l.getScaledSize(1):1,stroke:"#7f93bc"}))}};C.DraggingAnchor=cb;C.NodeRenameHelper=function(){var a,
b,f,g,l,n,p=!1;this.hook=function(z,B,I){p=!1;a=z;l=B.getNamePositionRect();n=I;u()};this.release=function(){f&&f.hide()};this.setCallback=function(z){g=z};var u=function(){b||(b=new lb,f=b.getJqUi(),$(document.body).append(f),b.addEditedListener(V),b.addBlurListener(J),f.css("z-index",99999));var z=C.DisplayNameHelper.getNodeDisplayName(a);b.setText(z);E();f.show();setTimeout(function(){b.requestFocus()},0)},E=function(){var z=$(document.body),B=[l[0],l[1]];B=F.upwardCoordinate(n[0],B,z[0]);f.find(".sa-ctrl-textarea-real").css("font-size",
l[3]+"px");F.layoutCtrl(f,B[0],B[1],l[2],l[3])},V=function(){console.log("start edit");p=!0},J=function(z){console.log("blur");f.hide();p&&(z=z.getText(),g(a,z))}};C.ModelInfoDialog=function(){Ma.call(this);var a=this.protectedMethod,b=this,f,g,l;(function(){a.setTitle(D.get("modelProp","\u6a21\u578b\u5c5e\u6027"));b.setSize(400,300);a.setContentPaneCreator(function(){var n=$("<div>"),p=new w;p.setRequired(!0);p.setText(D.get("name","\u540d\u79f0"));p=p.getJqUi();f=new lb;var u=f.getJqUi(),E=l.getIntegration();
f.setText(E.getModelName());var V=new w;V.setText(D.get("desc","\u63cf\u8ff0"));V=V.getJqUi();g=new Ya;var J=g.getJqUi();g.setText(E.getModelDesc());p.appendTo(n);u.appendTo(n);V.appendTo(n);J.appendTo(n);F.layoutCtrl(p,8,0,70,23);F.layoutCtrl(u,76,0,280,23);F.layoutCtrl(V,8,48,70,23);F.layoutCtrl(J,76,54,280,120);return n});a.setClosingChecker2(function(n){n=$.trim(f.getText());var p=$.trim(g.getText()),u=l.getIntegration(),E=u.getModelName(),V=u.getModelDesc();if(n==E&&p==V)return!0;var J;0==n.length?
J=D.get("nameIsEmptyPrompt","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a\u3002"):50<n.length&&(J=D.get("nameTooLongPrompt","\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002"));500<p.length&&(J=D.get("descTooLongPrompt","\u63cf\u8ff0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7500\u4e2a\u5b57\u7b26\u3002"));if(J)return a.getMessageCurtain().showPrompt(J),!1;J=new ob;J.setValue(u,n,u.getModelName(),p,u.getModelDesc());l.getCommandManager().perform(J);return!0});a.setClosingAction(function(n){})})();
this.setGlobal=function(n){l=n}};C.JoinConfigPanel=ub;C.CustomGroupSelectFieldPanel=function(){var a,b,f,g,l;this.getJqUi=function(){a||n();return a};this.protectedSetItemModels=function(p){f&&f.setItemModel(p)};this.protectedSetSelected=function(p){b.setSelectedModel(p)};this.addSelectionListener=function(p){g=p};this.setModeler=function(p){l=p};var n=function(){a=$("<div>");f=(new O).createChooseFieldPanel(l,!0);b=new Eb;b.setDropdownCreator(function(u,E,V){return f.createJqPopup(u,E,V)});b.addSelectionListener(function(u,
E){E&&(u=u.getSelectedModel(),g(u))});b.setCustomPainter(function(u,E){u?(E.text(u.getAlias()),E.attr("title",u.getAlias())):E.text("")});var p=b.getJqUi();a.append(p)}};C.FilterConfigDialog=Ea;C.FormulaEditorDialog=Hb;C.ColumnToRowConfigDialog=Ja;C.FieldItemUI=Oa;C.SelectFieldPanel=Pa;C.NoDataView=Ia;C.FieldSelectDialog=function(a,b,f,g,l){Ma.call(this);var n=this,p=this.protectedMethod,u,E,V=l,J,z,B;this.setFunUpdateTableArea=function(pa){B=pa};this.checkBeforeLoadField=function(){var pa=new ib(a,
function(X){X&&0==X.isValid?(C.SourceCheck.showInvalidFeedBack(X),J&&J(),B(g.getNamespace(),X.invalidityType)):(aa(850,520),B(g.getNamespace(),null))}),la=x.decodeParamFromUrl(window.location.search,"modelId");pa.setShowBlocking(!0);pa.checkReferencedModel(b,g,la)};this.showSelectFieldDialog=function(pa,la){aa(pa,la)};var I=function(pa){if(pa){if(pa=E.getSelectedProperties())for(var la=0;la<pa.length;la++)pa[la].setFromNode(f.getId());E.isSelectAll()?f.setSelectedFields(null):f.setSelectedFields(pa);
la=f;var X=g;if(E.getIsEntityView()){var $a=E.getSelectedEntityName();la=g.clone();X=f.clone();$a!=g.getTableName()&&(la.setTableName($a),($a=V.getSameTable(la))?(la.setUid($a.getUid()),X.setTableUid($a.getUid())):($a=C.UIDHelper.getUID(C.UIDHelper.NS_TABLE),la.setUid($a),X.setTableUid($a)));X=[X,la];la=X[0];X=X[1]}V.addTable(X);pa&&C.FieldNumberHelper.generateDefaultNumber(pa,la);pa=J;z(la,X);pa&&pa()}else J&&J()},ia=function(){if(!E)return!1;if(E.getIsEntityView()){var pa=E.getSelectedEntityName();
if(!pa)return p.getMessageCurtain().showPrompt(D.get("needSelectedEntity","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b9e\u4f53\u6216\u8005\u5206\u5f55\u8868\u3002")),!1;E.setCurrentTableName(pa)}return(pa=E.getSelectedProperties())&&0==pa.length?(p.getMessageCurtain().showPrompt(D.get("noSelectedField","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b57\u6bb5\u3002")),!1):!0},aa=function(pa,la){u=$("<div>");n.setSize(pa,la);n.setPosition(window.innerWidth-pa>>1,window.innerHeight-la>>1);p.setTitle(D.get("selectField",
"\u9009\u62e9\u5b57\u6bb5"));p.setContentPaneCreator(function(){return u});p.setClosingAction(I);pa=new ib(a,function(X){var $a=new Y;$a.fromJsonObject(X);E=C.SelectFieldFactory.createSelectFieldToDialog($a.getSourceType());E.setMeta($a);E.setCurrentTableName(g.getTableName());E.setWidth(850);E.getIsEntityView()&&p.setTitle(D.get("selectEntityAndField","\u9009\u62e9\u6570\u636e\u8868\u53ca\u5b57\u6bb5"));E.getJqUi().appendTo(u);p.setClosingChecker(ia);n.showDialog();X=(X=$a.getErrorMap())?X:{};B(g.getNamespace(),
X.invalidityType)},function(X,$a){p.setFooterClosingOnly(!0);n.showDialog();if(20001004==X)return X=new Ia,X.setType(Ia.TYPE_NO_DATA_WITH_CLOUD),X.setText(D.get("noSourceTips","\u6570\u636e\u6e90\u4e0d\u5b58\u5728\uff0c\u8bf7\u68c0\u67e5\u6a21\u578b\u96c6\u6570\u636e\u6e90")),X=X.getJqUi(),X.appendTo(u),!0;if(2030800==X)return X=new Ia,X.setType(Ia.TYPE_NO_DATA_WITH_CLOUD),X.setText(D.get("fileEncodingSelectTips","\u7f16\u7801\u4e0d\u6b63\u786e\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u6587\u4ef6\u7f16\u7801\u3002")),
X=X.getJqUi(),X.appendTo(u),!0});pa.setShowBlocking(!0);pa.getMeta(b,g)};this.setGlobal=function(pa){};this.setModeler=function(pa){V=pa};this.setFunFinishCallback=function(pa){J=pa};this.setAddNodeCallback=function(pa){z=pa}};C.ModelPreviewHelper=function(){function a(n){Ma.call(this);var p=this,u=this.protectedMethod,E,V,J,z,B,I,ia,aa,pa=!1;(function(){u.setTitle(D.get("preview","\u9884\u89c8"));var vb=$(document.body),sb=vb.prop("clientWidth");vb=vb.prop("clientHeight");var Rb=Math.min(1,Math.max(.8,
1.16-2E-4*sb));sb=parseInt(Rb*sb);vb=parseInt(Rb*vb);p.setSize(sb,vb);u.getDialogCtrl().setMinSize(680,240);u.setSelectable(!0);u.getDialogCtrl().setFullScreenEnabled();u.getDialogCtrl().setResizeEnabled();u.getDialogCtrl().addResizeListener(function(){z&&z.relayoutViews()});u.setContentPaneCreator(function(){var Wb=$("<div>");E=n.getPreviewData();var Xb=n.getTotalRowCount();I=Xb;pa=1E5<Xb;ia=n.getJobName();aa=n.getJobId();if(E&&0!=E.getRowCount()){Xb=new KTBorderStyle;Xb.setBorderWidth(1);Xb.setBorderPen("solid");
Xb.setBorderColor("#E3E3E3");var Zb=new KTStyle;Zb.setVerticalAlign("bottom");z=new KTable;z.setBorder(Xb);z.setStyle(Zb);z.setDraggableAdjusting(!0,1,0);z.setSyncUIWhenModelChanged(!1);z.setLargeDataMode(!0);z.setFrozenRows(1);z.getCellRender().setOutsideVisible(!1);z.setColumnFitVisibleWidth(!1);Xb=E.getColumnCount()+1;z.addColumns(Xb);var pb=new KTStyle;pb.setTextAlign("center");pb.setBold(!0);pb.setColor("#666");pb.setBackgroundColor("#E9E9E9");Zb=new KTStyle;Zb.setTextAlign("center");var Fa=
z.addRow();Fa.setStyle(pb);Fa.setHeight(22);for(pb=0;pb<Xb;pb++){var R=Fa.getCell(pb),Da=z.getColumn(pb);0===pb?(R.setValue(D.get("rowNum","\u5e8f\u53f7")),Da.setWidth(40),Da.setStyle(Zb)):(R.setValue(E.getField(pb-1).getAlias()),Da.setWidth(150))}Xb=$(z.getUI());Xb.appendTo(Wb);F.layoutCtrlWithLRTB(Xb,0,0,null,32,0,null);Gb(1,E.getRowCount());z.updateUI();z.setLargeDataMode(!0);la(Wb);Xb=$("<div>");Xb.addClass("modeler-designer-model-preview-rowcount-container");Xb.appendTo(V);pa?(Zb=D.get("showRowCount",
"\u4ec5\u663e\u793a#1\u884c").replace("#1","100000"),Fa=$("<span>"),Fa.text(D.get("getTotalRowCount","\u603b\u884c\u6570")),Fa.addClass("modeler-designer-model-preview-rowcount-btn"),Fa.css("cursor","pointer"),X(Fa),Fa.appendTo(V)):Zb=D.get("totalRowCount","\u5171#1\u884c").replace("#1",I+"");J=$("<span>");J.text(Zb);J.appendTo(Xb);B=new Wa;B.getJqUi().appendTo(V);B.addActionListener(Ib);nb(!1);B.getJqUi().addClass("modeler-designer-model-preview-export-btn")}else Xb=new Ia,Xb.setText(D.get("modelNoData",
"\u5f53\u524d\u6a21\u578b\u6ca1\u6709\u53ef\u9884\u89c8\u7684\u6570\u636e")),Xb.setType(Ia.TYPE_NO_DATA_WITH_CLOUD),Xb=Xb.getJqUi(),Xb.css("top","calc(50% - 110px)"),Xb.appendTo(Wb),p.setSize(800,600);return Wb});u.setFooterPaneCreator(null);u.setClosingAction(function(Wb){Wb=new ib(b);Wb.setShowBlocking(!1);Wb.deleteResultDataFile(aa,ia)})})();this.setPreviewConfig=function(vb){};var la=function(vb){var sb=new L;sb.protectedMethod.setTotalSelectedRowAndSelectedAllVisual(!1,!1);sb.protectedMethod.setTotalRowVisual(!1);
sb.protectedMethod.setCurrentPageVisual(!0);sb.protectedMethod.setFirstBtnAndEndBtnVisual(!0);sb.setComboBoxItemModelsAndSelectedItem([5,10,20,50,100,500,1E3],4);var Rb=pa?1E5:I;sb.setJumpToPageListener(function(Wb,Xb,Zb){Zb&&Zb(Rb);$a(Wb,Xb)});V=sb.getJqUi();V.appendTo(vb);sb.resetPaginationAndJumpToFirstPage(Rb)},X=function(vb){vb.on("click",function(){var sb=D.get("showRowCount","\u4ec5\u663e\u793a#1\u884c").replace("#1","100000"),Rb=D.get("totalRowCount","\u5171#1\u884c").replace("#1",""+I);J.text(sb+
"/"+Rb);vb.remove()})},$a=function(vb,sb){var Rb=(vb-1)*sb+1;var Wb=vb*sb>I?I:vb*sb;vb=new ib(b,function(Xb){E=new h;E.fromJsonObject(Xb);for(Xb=z.getRowsCount()-1;0<Xb;Xb--)z.removeRow(Xb);Gb(Rb,Wb);z.updateUI();z.setLargeDataMode(!0)});vb.setShowBlocking(!1);vb.updateResultDataByPage(aa,ia,Rb-1,sb)},nb=function(vb){vb?(B.setText(D.get("exporting","\u6b63\u5728\u5bfc\u51fa...")),B.setEnabled(!1)):(B.setText(D.get("exportToExcel","\u5bfc\u51fa\u5230Excel")),B.setEnabled(!0))},Ib=function(){var vb=
new ib(b,function(sb){nb(!1);var Rb=x.formatDate("yyyyMMdd_HHmmss");jb.downloadFile("QingModeler-"+Rb+".xlsx",sb)},function(sb,Rb){nb(!1);return 20001106==sb?(sb=new ha,sb.setOptionType(ha.OPTION_OK),sb.setMessage(Rb),sb.showDialog(),!0):!1});vb.setShowBlocking(!1);nb(!0);vb.exportModelResult(aa,ia,pa?1E5:I,g);c.occur(c.BUTTON_TYPE,c.MODEL_PREVIEW_EXPORT_TO_EXCEL)},Gb=function(vb,sb){var Rb=new KTStyle;Rb.setColor("#333");Rb.setBackgroundColor("#fff");var Wb=new KTStyle;Wb.setColor("#333");Wb.setBackgroundColor("#F3F3F3");
var Xb=new za;Xb.setFormatString("#,##0.00");for(var Zb=0;vb<=sb;vb++,Zb++){var pb=1==vb%2?Rb:Wb,Fa=z.addRow();Fa.setHeight(22);Fa.setStyle(pb);for(pb=0;pb<E.getColumnCount()+1;pb++){var R=Fa.getCell(pb);if(0==pb)R.setValue(vb);else{var Da=E.getOneRow(Zb),ua=E.getField(pb-1).getOutputDataType();Da=Da[pb-1];null==Da||void 0==Da?Da="":ua==Ca.DT_DATE?(ua=new hb,ua.setFormatString("yyyy-MM-dd"),Da=ua.format(Da)):ua==Ca.DT_DATETIME?(ua=new hb,ua.setFormatString("yyyy-MM-dd HH:mm:ss"),Da=ua.format(Da)):
ua==Ca.DT_BOOLEAN?Da=void 0===Da?"":Da?"true":"false":ua==Ca.DT_NUMBER&&(Da=Xb.format(Da));R.setValue(Da)}}}}}var b,f,g;this.setRemoteImpl=function(n){b=n};this.setGlobal=function(n){};this.setModelChecker=function(n){f=n};this.preview=function(n){g=n;l(n)};var l=function(n){var p=new M;p.setTitle(D.get("trialExecution","\u8bd5\u6267\u884c"));p.isCreatePreviewAllBtn(!0);var u=C.PreviewConfigManager.getTrialExecutionConfig();p.setOriginExtractCount(u.getExtractCount());p.setOriginPreviewCount(u.getPreviewCount());
p.setAllData(u.isExtractAllData());p.setAllDataPreview(u.isPreviewAllData());p.setConfirmCallback(function(E,V,J,z){C.PreviewConfigManager.updateTrialExecutionConfig(E,V,J,z);E=new ib(b,function(B){var I=new d;I.fromJsonObject(B);I.getModelerValidity()?f.setGlobalCheckResult(I.getModelerValidity(),!1,D.get("tableModelerIncomplete","\u6570\u636e\u8868\u6a21\u578b\u8bbe\u7f6e\u4e0d\u5b8c\u6574\uff0c\u65e0\u6cd5\u9884\u89c8\u6570\u636e")):(new a(I)).showDialog()});V=C.PreviewConfigManager.getTrialExecutionConfig();
E.getFirstPageResultData(n,V)});p.showDialog()}};C.TableModelerDisplayNameHelper=function(){ka.call(this);var a=this.protectedMethod,b;this.protectedGetDefaultName=function(g){if(g instanceof H)return g=g.getTableUid(),(g=b.getTable(g))?g.getDisplayName()?g.getDisplayName():g.getTableName():D.get("table","\u8868");g=g.getType();return P.getType(g).getDisplayName()};this.protectedInit=function(g){b&&b.removePropertyChangeCallback(f);b=g;b.addPropertyChangeCallback(f)};var f=function(g,l){g==q.KEY_NODE_CHANGE_ALIAS?
a.cacheDisplayName(l.getId(),l.getAlias()):g==q.KEY_REMOVE_NODE&&(g=l.getRemovedNode(),a.cacheDisplayName(g.getId(),void 0))}};C.NodeItemUi=Ha;C.UnionConfigFieldMappingPane=Q;C.UnionConfigSelectNodePane=yb;C.InvalidBackgroundPane=fa;C.PreviewCountSetDialog=M;var F,x,Aa,za,U,ba,Ta,Xa,D,jb,Sa,rb,Ra,Ma,qa,w,sa,Va,Ka,Wa,lb,Eb,Qb,Tb,ab,Cb,Fb,Ya,kb,Z,ha,hb,Mb,Nb,T,q,H,P,La,ma,ra,ta,db,fb,va,Za,Ca,bb,Lb,Ua,ib,ob,Y,gb,W,L,h,m,c,d,e,k;(function(){var a=com.kingdee.bos.qing.common;F=a.DomUtil;hb=a.DateFormater;
x=a.Util;Aa=a.RelativePeriodModel;za=a.NumberFormater;a=com.kingdee.bos.qing.common.ui;U=a.TableUtil;ba=a.CommonIconUtil;Ta=a.RelativePeriodPanel;Xa=a.FormulaEditorPanel;a=com.kingdee.bos.qing.framework.common;D=a.MultilanguageManager.createPackageAccessor(C);jb=a.RemoteFramework;Sa=a.OfficialArticleUtil;rb=a.WindowResizeObserver;a=com.kingdee.bos.qing.ui.component;Ra=a.List;Ma=a.AbstractModalDialog;qa=a.Button;w=a.Label;sa=a.RadioButtonGroup;Va=a.RadioButton;Ka=a.ComboBox;Wa=a.WorkButton;lb=a.TextField;
Eb=a.DropdownSelector;Qb=a.SearchBox;Tb=a.SwitchButton;ab=a.DateSelector;Cb=a.DateTimeSelector;Fb=a.F7Selector;Ya=a.TextArea;kb=a.CheckBox;Z=a.SplitPane;ha=a.MessageDialog;Mb=a.WizardDialog;Nb=a.Dialog;T=a.HelpIcon;e=a.Spinner;k=a.DynamicScroller;a=com.kingdee.bos.qing.biz.common;L=a.ComplexPaginationBar;q=C.TableModeler;P=C.TransformTypeFactory;La=C.Config;ma=C.JoinConfig;ra=C.FilterConfig;ta=C.FilterItem;db=C.UnionConfig;fb=C.NodeItem;va=C.ColumnToRowConfig;Za=C.ColumnToRowItem;H=C.TableNode;Ca=
C.Field;bb=C.Icons;Lb=C.FolderNode;Ua=C.AbstractModelerSource;ib=C.DesignerFacade;ob=C.ActionChangeModelInfo;Y=C.Meta;gb=C.RectCutLineLayoutHelper;W=C.Coordinate;h=C.PreviewData;m=C.AbstractInvalidityCase;c=C.UserOperationReporter;d=C.PreviewResult})();C.NodeUIFactory=new function(){this.create=function(a,b,f){if(a instanceof H){var g=new xa(a);var l=a.getSelectedFields();l?g.setFieldCount(l.length):C.NodeFieldHelper.asynGetFields(f.getModelerModel(),a,function(n){g.setFieldCount(n.length)})}else g=
new eb(a);g&&g.setScaleHelper(b);g&&g.setGlobal(f);return g}};oa.NODE_UI_CLASS="modeler-designer-node";oa.NODE_OPERATE_ICON_CLASS="modeler-designer-node-operate-icon";oa.NODE_NAME_UI_CLASS="modeler-designer-node-name";C.LineCoordinateHelper=new function(){var a;this.setModelerModel=function(b){a=b};this.getLinePathCoordinate=function(b,f){var g=b.getX()+b.getWidth(),l=b.getY()+(b.getHeight()>>1);var n=f.getX();var p=f.getY()+(f.getHeight()>>1),u=1>Math.abs(l-p),E=g>n,V=Math.abs(l-p)<b.getHeight()+
f.getHeight()>>1,J=[];J.push(new W(g,l));V&&E?(E=10,V=Math.max(b.getHeight(),f.getHeight()),n-E>b.getX()&&p>b.getY()+b.getHeight()&&(E=n-b.getX()+10),u=new W(g+10,l),g=new W(g+10,Math.min(l,p)-V),l=new W(n-E,Math.min(l,p)-V),E=new W(n-E,p),J.push(u),J.push(g),J.push(l),J.push(E)):u||(E?V||(E=b.getHeight()-f.getHeight()>>1,E=l<p?E:-E,u=new W(g+10,l),g=new W(g+10,(l+p>>1)+E),l=new W(n-10,(l+p>>1)+E),E=new W(n-10,p),J.push(u),J.push(g),J.push(l),J.push(E)):(u=new W(g+n>>1,l),g=new W(g+n>>1,p),J.push(u),
J.push(g)));J.push(new W(n,p));n=J;a:{p=n;if(!(2>p.length))for(J=1;J<p.length;J++){b:{g=p[J-1];E=p[J];l=g.getX();g=g.getY();u=E.getX();E=E.getY();V=a.getAllNodes();for(var z=0;z<V.length;z++){var B=V[z],I=B.getX(),ia=I+B.getWidth(),aa=B.getY();B=aa+B.getHeight();if(l>I&&l<ia&&u>I&&u<ia){if(Math.max(g,E)>aa&&Math.min(g,E)<B){l=!0;break b}}else if(g>aa&&g<B&&E>aa&&E<B&&Math.max(l,u)>I&&Math.min(l,u)<ia){l=!0;break b}}l=!1}if(l){p=!0;break a}}p=!1}p&&(b=(new gb(a)).getLinePathCoordinate(b,f))&&(n=b);
return n}};C.LineCoordinateHelper.BASE_LINE_SHAPE_S="s";C.LineCoordinateHelper.BASE_LINE_SHAPE_U="u";C.LineCoordinateHelper.BASE_LINE_SHAPE_Z="z";C.SvgTextTrimer=new function(){var a,b,f;this.init=function(){f=$("<div>");F.layoutCtrl(f,-10,-10,10,10);a=new qb;var l=a.createNode("svg");a.setAttributes(l,{width:10,height:10});b=a.createNode("text");l.appendChild(b);f.append($(l));$(document.body).append(f);f.hide()};this.trim=function(l,n,p){f.show();a.setAttributes(b,{"font-size":n+"px"});n=g(l);for(var u=
l,E=1;n>p&&E<l.length;)u=l.slice(0,l.length-E)+"...",n=g(u),E++;f.hide();return u};this.measureText=function(l){f.show();l=g(l);f.hide();return l};var g=function(l){a.setText(b,l);return b.getComputedTextLength()}};P.getType(La.TYPE_JOIN).setCustomNodeCreator(function(a,b,f){var g=new Db;g.setNodeCreateCallback(f);g.setFromNode(a);g.setModelerModel(b.getModelerModel());(a=g.getNodeToJoin())&&0!=a.length?g.showDialog():b.getMessageCurtain().showPrompt(D.get("noNodeToJoinPrompt","\u6682\u65e0\u53ef\u5173\u8054\u8282\u70b9\uff0c\u8bf7\u4ece\u8868\u533a\u57df\u62d6\u5165\u4e00\u4e2a\u53ef\u5173\u8054\u7684\u8868"))});
P.getType(La.TYPE_CALCULATED_FIELD).setCustomNodeCreator(function(a,b,f){C.NodeFieldHelper.asynGetFields(b.getModelerModel(),a,function(g){if(g&&0!==g.length){var l=new C.CalculatedField;l.setName("F"+(new Date).getTime());for(var n=[],p=0;p<g.length;p++)n.push(g[p].toJsonObject());var u,E=null;p=b.getRemoteImpl();var V=new ib(p,function(J){var z=J.ok,B=J.errorPosition,I=J.errorPrompt;u=J.dataType;E(z,B,I)});V.setShowBlocking(!1);p=new Hb;p.setContext(g,l,!1);p.setSyntaxValidator(function(J,z,B){E=
B;V.checkFormula(z,l.getSourceNodeId(),J,n,[])});p.edit(!1,function(){u=u?u:Ca.DT_NUMBER;l.setDataType(u)},f)}else g=D.get("upwardNodeInvalid","\u4e0a\u6e38\u8282\u70b9\u8bbe\u7f6e\u4e0d\u5b8c\u6574"),(p=b.getNodeStatusMonitor().getInvalidState(a))&&(g=p.getPrompt()),b.getMessageCurtain().showPrompt(g+D.get("noCalculatedFieldToCreate","\uff0c\u65e0\u6cd5\u521b\u5efa\u8ba1\u7b97\u5b57\u6bb5\u3002"))},void 0)});P.getType(La.TYPE_FILTER).setCustomNodeCreator(function(a,b,f){var g=new Ea;g.setAfterSetCallback(f);
g.setFromNode(a);g.setModelerModel(b.getModelerModel());g.showDialog();g.updateTableUi()});C.UnionNodeUtil=new function(){this.getNodeItemsToUnion=function(a,b){var f=[];a=C.ModelConverter.getLinkableNodes(a,b);for(b=0;b<a.length;b++){var g=a[b],l=new fb,n=C.DisplayNameHelper.getNodeDisplayName(g);l.setAlias(n);l.setNodeId(g.getId());f.push(l)}return f}};P.getType(La.TYPE_UNION).setCustomNodeCreator(function(a,b,f){var g=C.UnionNodeUtil.getNodeItemsToUnion(b.getModelerModel(),a);if(g&&0!=g.length){var l=
new xb;l.setFromNode(a);l.setGlobal(b);l.setItemModels(g);l.setAfterSetCallback(f);a=new Mb;a.setTitle(D.get("union","\u5408\u5e76\u8868"));a.setSteps([l]);a.show(800,480)}else b.getMessageCurtain().showPrompt(D.get("noNodeToUnionPrompt","\u6682\u65e0\u53ef\u5408\u5e76\u8282\u70b9\uff0c\u8bf7\u4ece\u8868\u533a\u57df\u62d6\u5165\u4e00\u4e2a\u53ef\u5408\u5e76\u7684\u8868\u3002"))});P.getType(La.TYPE_COLUMN_TO_ROW).setCustomNodeCreator(function(a,b,f){var g=new Ja;g.setFunCallback(f);g.setModeler(b.getModelerModel());
C.NodeFieldHelper.asynGetFields(b.getModelerModel(),a,function(l){l=l?l:[];g.setFields(l);g.initUi();g.showDialog()})});C.SvgIconHelper=new function(){ya.call(this);var a=this;this.getIconUrl=function(b){b=b.getType();b=P.getType(b).getIconName();return a.makeUrl(b)}};C.DisplayNameHelper=new function(){var a;this.registerImpl=function(b){a=b};this.isDuplicate=function(b,f){if(!a)throw Error("need register first");return a.isDuplicate(b,f)};this.getNodeDisplayName=function(b){if(!a)throw Error("need register first");
return a.getNodeDisplayName(b)}};Ia.TYPE_TEXT="text";Ia.TYPE_NO_SOURCE="noSource";Ia.TYPE_NO_SEARCH_RESULT="noSearchResult";Ia.TYPE_NO_DATA_WITH_CLOUD="noDataWithCloud";C.SelectFieldFactory=new function(){var a={};this.addSelectFieldToPanel=function(b,f){a[b]=f};this.createSelectFieldToDialog=function(b,f){var g=a[b];b=g?new g(b,f):new Ga;return b}};C.SourceCheck=new function(){this.showInvalidFeedBack=function(a){var b=ha.createFeedbackDialog();b.setMsgImageType(ha.MSG_WARNING);b.setTitle(D.get("operatingTips",
"\u64cd\u4f5c\u63d0\u793a"));switch(a.invalidityType){case m.TYPE_DBCONNECTION_FAIL:var f=D.get("dbconnectionFail","\u8be5\u8868\u6240\u5728\u7684\u6570\u636e\u6e90\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");break;case m.TYPE_DBSOURCE_NO_AUTHORITY:f=D.get("dbsourceNoAuth","\u60a8\u6ca1\u6709\u8be5\u8868\u6240\u5728\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");break;case m.TYPE_SOURCE_NOT_EXISTS:f=D.get("sourceNotExists","\u8be5\u8868\u6240\u5728\u7684\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");
break;case m.TYPE_TABLE_NOT_EXISTS:f=D.get("tableNotExist","\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664");break;case m.TYPE_MODEL_DELETED:f=D.get("modelDeleted","\u8be5\u6a21\u578b\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");break;case m.TYPE_MODEL_NO_DATA_PERMISSION:f=D.get("modelNoDataPermission","\u60a8\u672a\u88ab\u6388\u6743\u4f7f\u7528\u8be5\u6a21\u578b\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");break;case m.TYPE_MODEL_INCOMPLETE:f=D.get("model_incomplete",
"\u8be5\u6a21\u578b\u8bbe\u7f6e\u4e0d\u5b8c\u6574\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");break;case m.TYPE_MODEL_DAMAGE:f=D.get("modelDamage","\u8be5\u6a21\u578b\u5df2\u635f\u574f\uff0c\u65e0\u6cd5\u4f7f\u7528\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");break;case m.TYPE_MODEL_CYCLE_REFERENCE:f=D.get("modelCycleReference","\u8be5\u6a21\u578b\u4e0e\u5f53\u524d\u6a21\u578b\u5b58\u5728\u5faa\u73af\u5f15\u7528\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");if(1<a.cycleRefModelNames.length){for(var g=
"",l=0;l<a.cycleRefModelNames.length;l++){if(l==a.cycleRefModelNames.length-1){var n=D.get("modelRefCurrentModel","'#1'\u6a21\u578b\u5f15\u7528\u4e86\u5f53\u524d\u6a21\u578b\u3002");n=n.replace("#1",a.cycleRefModelNames[l])}else n=D.get("modelRefOtherModel","'#1'\u6a21\u578b\u5f15\u7528\u4e86'#2'\u6a21\u578b\uff0c"),n=n.replace("#1",a.cycleRefModelNames[l]).replace("#2",a.cycleRefModelNames[l+1]);g+=n}b.setDetail(g)}break;default:f=a.message}b.setMessage(f);b.setOptionType(ha.OPTION_OK);b.setButtonText(ha.RETURN_OK,
D.get("iSee","\u6211\u77e5\u9053\u4e86"));b.showDialog()}};C.SelectFieldFactory.addSelectFieldToPanel(Ua.SOURCE_TYPE_CURRENT_ENTITY_SOURCE,function(){N.call(this);var a=this,b,f,g;this.getJqUi=function(){if(!b){b=$("<div>");g=new Ga;g.setMeta(a.getMeta());g.setCurrentTableName(a.getCurrentTableName());g.setSelectedPropertyName(a.getSelectedPropertyName());var p=g.getJqUi(),u=new Z;u.setHorizontalSplit(!0);u.setSplitLineWide(8);u.setResizeMode(Z.RESIZE_MODE_FIRST_FIXED);u.setFirstSize(200,185,300);
u.setSecondSize(a.getWidth()-250,350,-1);f=new ca;f.setFunUpdateProperties(n);f.setMeta(a.getMeta());u.setFirstChild(Z.createChildWrapper(f.getJqUi()));u.setSecondChild(Z.createChildWrapper(p));u.getJqUi().appendTo(b);f.setSelectedTableNames(a.getCurrentTableName().split(C.ENTITY_SEPARATOR))}return b};this.getIsEntityView=function(){return!0};var l=!0;this.getSelectedProperties=function(){var p=[],u={};l=!0;for(var E=a.getCurrentTableName().split(C.ENTITY_SEPARATOR),V=0;V<E.length;V++){var J=E[V];
J=g.getTableFieldMap()[J];for(var z=0;z<J.length;z++){var B=J[z],I=B.getField();u[I.getFullName()]||(B.getSelected()?(p.push(I),u[I.getFullName()]=!0):l=!1)}}return p};this.isSelectAll=function(){return l};this.getSelectedEntityName=function(){return f.getSelectedEntityName()};var n=function(p,u){g.setArrProperties(p,u)}})})();(function(){function oa(){var q=this,H,P,La;this.getCurrentNodeId=function(){throw Error("override me");};this.protectedUpdateUi=function(){};this.protectedInitUi=function(ra){};this.setGlobal=function(ra){H=ra};this.getJqUi=function(){if(!P){P=$("<div>");P.css({"overflow-x":"hidden","overflow-y":"auto"});var ra=$("<div>");ra.addClass("modeler-propertyarea-lineitem-title");ra.appendTo(P);var ta=$("<div>");ta.appendTo(ra);Ha.layoutCtrlWithLRTB(ta,5,0,null,2,2,null);ta.css("border-left","3px solid #5582f3");
ta=$("<div>");ta.text(La);Ha.layoutCtrl(ta,15,null,200,null);Ha.layoutCtrlMiddleAlign(ta,16);ta.appendTo(ra);ta.css({"font-weight":"bold",color:"#666"});q.protectedInitUi(P)}return P};this.updateUi=function(){q.protectedUpdateUi()};var ma=function(){var ra=$("<div>");ra.addClass("modeler-propertyarea-lineitem");return ra};this.protectedMethod={getGlobal:function(){return H},createJqLineItem:function(ra,ta){ra=(new fa(ra)).getJqUi();ra.addClass("modeler-propertyarea-lineitem-caption");ta=ta.getJqUi();
ta.addClass("modeler-propertyarea-lineitem-ctrl");var db=ma();db.append(ra);db.append(ta);return db},createJqLineContainer:ma,setTitle:function(ra){La=ra},getJqOwner:function(){return P}}}function xa(){oa.call(this);var q=this.protectedMethod,H,P,La,ma,ra,ta,db,fb,va;q.setTitle(Q.get("tableProp","\u8868"));this.setNode=function(h){H=h};this.getCurrentNodeId=function(){return H.getId()};this.protectedInitUi=function(h){var m=q.getGlobal().getModelerModel(),c=m.getNodeSource(H),d=new Ja;d.setEnabled(!1);
var e=c.getName();d.setText(e?e:Q.get("theSourceIsDeleted","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664"));q.createJqLineItem(Q.get("source","\u6570\u636e\u6e90"),d).appendTo(h);m=m.getNodeTable(H);c.getSourceType()==Mb.SOURCE_TYPE_CURRENT_ENTITY_SOURCE?(c=new Ja,c.setEnabled(!1),c.setText(m.getDisplayName()),q.createJqLineItem(Q.get("entityName","\u5b9e\u4f53\u540d"),c).appendTo(h),va=new Ja,va.setEnabled(!1),va.setText(m.getTableName()),q.createJqLineItem(Q.get("tag","\u6807\u8bc6"),va).appendTo(h)):
(fb=new Ja,fb.setEnabled(!1),fb.setText(m.getTableName()),q.createJqLineItem(Q.get("tableName","\u8868\u540d"),fb).appendTo(h));Za(h);La=new eb;La.setFunShowSelectedFieldDialog(Ca);gb();q.createJqLineItem(Q.get("field","\u5b57\u6bb5"),La).appendTo(h)};this.protectedUpdateUi=function(){var h=wa.DisplayNameHelper.getNodeDisplayName(H);P.setText(h);h=q.getGlobal().getModelerModel().getNodeTable(H);h.isUserSql()&&fb.setText(h.getTableName());h&&va&&va.setText(h.getTableName());gb()};var Za=function(h){P=
new Ja;var m=wa.DisplayNameHelper.getNodeDisplayName(H);P.setText(m);m=q.createJqLineItem(Q.get("alias","\u522b\u540d"),P);P.addBlurListener(W);P.addAcceptableListener(function(c,d){W(c)});m.appendTo(h)},Ca=function(){var h=q.getGlobal().getModelerModel();wa.NodeFieldHelper.getMeta(h,H,function(m){m.getErrorMap()&&0==m.getErrorMap().isValid?wa.SourceCheck.showInvalidFeedBack(m.getErrorMap()):(ma=new Hb(m.getSourceType()),ma.setFunContentPaneCreator(function(){var c=$("<div>");db=qa.createSelectFieldToDialog(m.getSourceType());
var d=H.getSelectedFields(),e=[];d&&0!=d.length||(d=q.getGlobal().getModelerModel(),d=wa.ModelConverter.getSelectedFieldsWhenSelectAll(d,H));for(var k=0;k<d.length;k++)e.push(d[k].getName());db.setSelectedPropertyName(e);e=ob().getTableName();db.setMeta(m);db.setCurrentTableName(e);db.setWidth(800);db.getJqUi().appendTo(c);return c}),ma.setShowAllCheckbox(!0),ma.setFunClosingChecker(bb),ma.setFunConfirmClose(Ua),ma.showSelectFieldDialog(800,520))})},bb=function(){ta=db.getSelectedEntityName();if(db.getIsEntityView()){if(!ta)return ma.showPrompt(Q.get("needSelectedEntity",
"\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b9e\u4f53\u6216\u8005\u5206\u5f55\u8868\u3002")),!1;db.setCurrentTableName(ta)}return(ra=db.getSelectedProperties())&&0==ra.length?(ma.showPrompt(Q.get("noSelectedField","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b57\u6bb5\u3002")),!1):!0},Lb=function(){var h=q.getGlobal().getModelerModel(),m=h.getTable(H.getTableUid()),c=m.getTableName();m=m.clone();if(ta!=c){m.setTableName(ta);if(c=h.getSameTable(m))return c.getUid();c=wa.UIDHelper.getUID(wa.UIDHelper.NS_TABLE);
m.setUid(c);H.setTableUid(c);h.addTable(m);return c}return H.getTableUid()},Ua=function(h){if(h){h=q.getGlobal().getModelerModel().getTable(H.getTableUid()).getTableName();var m=db.getIsEntityView()&&ta!=h;if(m)L([ra,Lb(),ta],ib,Y);else{var c=H.getSelectedFields();if(c){if(m=!ra||c.length!=ra.length,!m){for(var d={},e=0;e<c.length;e++){var k=c[e];d[k.getFullName()]=k}for(e=0;e<ra.length;e++)if(k=ra[e],!d[k.getFullName()]){m=!0;break}}}else m=null!=ra;m&&L([ra,H.getTableUid(),h],ib,Y)}}},ib=function(){var h=
ob().getTableName();return[H.getSelectedFields(),H.getTableUid(),h]},ob=function(){return q.getGlobal().getModelerModel().getTable(H.getTableUid())},Y=function(h){var m=h[0];m?La.setSelectedFieldCount(m.length):La.setSelectedFieldCount(0);db.getIsEntityView()&&(h[1]&&H.setTableUid(h[1]),ob().setTableName(h[2]));H.setSelectedFields(m,!0)},gb=function(){var h=H.getSelectedFields();La.setSelectedFieldCount(h?h.length:0)},W=function(h){h=h.getText();var m;h=$.trim(h);var c=/^[\u3000\u4E00-\u9FA5a-zA-Z0-9_]{1,}$/;
0==h.length?m=Q.get("nameIsEmpty","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a"):50<$.trim(h).length?m=Q.get("nameTooLong","\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26"):wa.DisplayNameHelper.isDuplicate(h,H)?m=Q.get("duplicateName","\u540d\u79f0\u91cd\u590d"):h.match(c)||(m=Q.get("invalidNodeName","\u8282\u70b9\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210"));m?(m=Q.get("modifyAbandoned","#1\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002").replace("#1",
m),q.getGlobal().getMessageCurtain().showPrompt(m),P.setText(wa.DisplayNameHelper.getNodeDisplayName(H))):(m=new za,m.setValue(H,h),q.getGlobal().getCommandManager().perform(m))},L=function(h,m,c){var d=new U;d.setNode(H);d.setMethod(m,c);d.setValue(h);d.setCaption(Q.get("actionTableNodeConfig","\u8868\u8282\u70b9\u8bbe\u7f6e\uff1a#1").replace("#1",Q.get("selectField","\u9009\u62e9\u5b57\u6bb5")));q.getGlobal().getCommandManager().perform(d)}}function eb(){var q=this,H,P,La,ma=0,ra;this.getJqUi=function(){if(!H){H=
$("<div>");H.addClass("modeler-propertyarea-tablenode-property-ui");La=new Ja;La.setEnabled(!1);P=La.getJqUi();La.protectedMethod.getJqInput().css("color","#666");Ha.layoutCtrlWithLRTB(P,0,0,null,0,0,null);P.appendTo(H);var ta=$("<div>");ta.addClass("modeler-propertyarea-tablenode-property-icon");Oa.backgroundWithHover(ta,"edit");ta.on("click",ra);Ha.layoutCtrlWithLRTB(ta,null,0,16,4,0,16);ta.appendTo(H);q.setSelectedFieldCount(ma)}return H};this.setSelectedFieldCount=function(ta){ma=ta;var db=Q.get("selectedFields",
"\u5df2\u9009\u62e9#1\u4e2a\u5b57\u6bb5").replace("#1",ma);0==ta&&(db=Q.get("selectedAllFields","\u5df2\u9009\u62e9\u6240\u6709\u5b57\u6bb5"));La&&La.setText(db)};this.setFunShowSelectedFieldDialog=function(ta){ra=ta}}function cb(q){oa.call(this);var H=this.protectedMethod,P=function(){var La=wa.TransformTypeFactory.getType(q.getType());return La&&La.getDisplayName()};H.setTitle(P());this.getCurrentNodeId=function(){return q.getId()};H.getNode=function(){return q};H.doConfigChangeAction=function(La,
ma,ra){var ta=new U;ta.setNode(q);ta.setMethod(ma,ra);ta.setValue(La);ta.setCaption(Q.get("actionTransConfig","\u8f6c\u6362\u8282\u70b9\u8bbe\u7f6e\uff1a#1").replace("#1",P()));H.getGlobal().getCommandManager().perform(ta)};H.asynGetFields=function(La){var ma=H.getGlobal().getModelerModel(),ra=ma.getPrevNode(q);wa.NodeFieldHelper.asynGetFields(ma,ra,function(ta){var db=[],fb=q.getFieldSettingConfig();fb=fb?fb.getModifiedField():[];for(var va=0;va<ta.length;va++){for(var Za=ta[va].clone(),Ca=0;Ca<
fb.length;Ca++){var bb=fb[Ca];if(Za.getFullName()==bb.getFullName()){bb.getAppointedAlias()&&Za.setAlias(bb.getAppointedAlias());Ca=bb.getAppointedDataType()?bb.getAppointedDataType():Za.getOriginalDataType();Za.setDataType(Ca);break}}db.push(Za)}La(db)},void 0,H.getJqOwner())};H.asyncGetFieldValues=function(La,ma){var ra=H.getGlobal().getModelerModel(),ta=ra.getPrevNode(q);wa.NodeFieldHelper.getFieldValues(ra,ta,La,ma,void 0,H.getJqOwner())}}function qb(q){cb.call(this,q);var H=this.protectedMethod,
P,La,ma;this.protectedInitUi=function(va){P=va;La=q.getConfig()};this.protectedUpdateUi=function(){if(ma)ma.updateUi();else{var va=H.getGlobal().getModelerModel();ma=new ab;var Za=va.getNode(La.getLeft());ma.setLeftNode(Za);ma.setModelerModel(va);ma.setJoinConfig(La);va=ma.getJqUi();va.addClass("modeler-propertyarea-join-container");va.appendTo(P);ma.setJoinTypeChangeListener(ra);ma.setRelationChangeListener(db)}};var ra=function(va){H.doConfigChangeAction(va,La.getJoinType,ta)},ta=function(va){La.setJoinType(va);
ma.updateUi()},db=function(va){H.doConfigChangeAction(va,La.getRelationModel,fb)},fb=function(va){La.setRelationModel(va);ma.updateUi()}}function wb(q){cb.call(this,q);var H=this.protectedMethod,P,La,ma,ra,ta=[];this.protectedInitUi=function(Za){P=Za};this.protectedUpdateUi=function(){H.asynGetFields(function(Za){if(Za&&0!=Za.length){La&&La.hide();ra&&ra.show();if(!ra){ra=new w;ra.setShowAllCheckbox(!0);ra.setShowOnlyChecked(!1);ra.setShowScroll(!1);ra.setShowSearchText(!1);ra.setFunFieldCheckClick(fb);
ra.setFunAllCheckboxClick(db);var Ca=ra.getJqUi();Ha.layoutCtrlWithLRTB(Ca,0,0,null,31,5,null);Ca.css("min-height","240px");Ca.appendTo(P)}ta=[];ma=q.getConfig();Ca=ma.isSelectAll();for(var bb=0;bb<Za.length;bb++){var Lb=Za[bb],Ua=new Ma;Ua.setField(Lb);Ua.setDisplayName(Lb.getAlias());Lb.isPk()&&(Ua.setEnabled(!1),Ua.setSelected(!0));Lb=Ca?!0:ma.isSelected(Lb);Ua.setSelected(Lb);ta.push(Ua)}ra.setArrFieldItems(ta);Za=[];bb=0;for(Ua=ta.length;bb<Ua;bb++)Lb=ta[bb],Lb.getSelected()&&Za.push(Lb.getField());
bb=ma.extractSelectState();bb.setState(Ca,Za);ma.setSelectState(bb,!0)}else ra&&ra.hide(),La?La.show():(Ca=new sa,Ca.setType(sa.TYPE_NO_SOURCE),Ca.setText(Q.get("currentNodeNoField","\u5f53\u524d\u8282\u70b9\u6ca1\u6709\u53ef\u9009\u62e9\u7684\u5b57\u6bb5")),La=Ca.getJqUi(),La.appendTo(P))})};var db=function(Za,Ca){if(Ca){Ca=[];if(Za.isChecked()){Za=0;for(var bb=ta.length;Za<bb;Za++){var Lb=ta[Za];(Lb.isShow()||Lb.getSelected())&&Ca.push(Lb.getField())}}else for(Za=0,bb=ta.length;Za<bb;Za++)Lb=ta[Za],
Lb.getSelected()&&Ca.push(Lb.getField());va(Ca.length==ta.length,Ca)}},fb=function(Za,Ca){var bb=[];Ca.setSelected(Za);Za=0;for(Ca=ta.length;Za<Ca;Za++){var Lb=ta[Za];Lb.getSelected()&&bb.push(Lb.getField())}va(bb.length==ta.length,bb)},va=function(Za,Ca){var bb=ma.extractSelectState();bb.setState(Za,Ca);H.doConfigChangeAction(bb,ma.extractSelectState,ma.setSelectState)}}function Ab(q){function H(d){KTDefaultCellRender.call(this,d);var e=this,k=[F.DT_STRING,F.DT_NUMBER,F.DT_INT,F.DT_DATE,F.DT_DATETIME,
F.DT_BOOLEAN],a=this.paintCellUI;this.paintCellUI=function(b,f){var g=e.getCurrentRowIdx(),l=e.getCurrentRow(),n=e.getCurrentColIdx(),p=l.getUserObject(),u=Ca&&-1<Ca.indexOf(p);if(g<Ob.getHeadRowCount())a(b,f);else if(n==ob)u&&(u=$(b),u.empty(),b=$("<div>"),b.attr("title",Q.get("fieldNotFound","\u5b57\u6bb5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664")),Oa.background(b,"qingWarning"),Ha.layoutCtrlCenterAlign(b,16),Ha.layoutCtrlMiddleAlign(b,16),b.appendTo(u));else if(n==Y)u&&(u=$(b),u.empty(),
b=$("<div>"),b.css("cursor","pointer"),b.attr("title",Q.get("clearSetting","\u6e05\u9664\u8bbe\u7f6e")),Oa.backgroundWithHover(b,"delete"),Ha.layoutCtrlCenterAlign(b,16),Ha.layoutCtrlMiddleAlign(b,16),b.on("click",function(){for(var V=-1,J=bb.getModifiedField(),z=0;z<J.length;z++)if(J[z].getFullName()==p.getFullName()){V=z;break}-1<V&&(J.splice(V,1),ra.doConfigChangeAction(J,bb.getModifiedField,bb.setModifiedField))}),b.appendTo(u));else if(n==Lb)u=$(b),u.empty(),u=$("<div>"),l=p.getAlias(),u.text(l),
u.attr("title",l),u.css("line-height","28px"),u.css("padding-left","2px"),u.css("padding-right","2px"),u.css("overflow","hidden"),u.css("white-space","nowrap"),u.css("text-overflow","ellipsis"),u.addClass("modeler-designer-tablecell-editable"),u.appendTo(b);else if(n==Ua){f=p.getOutputDataType();var E=p.getDataType()?p.getDataType():F.DT_STRING;b=Ob.createCtrlInCell(b,e.getCellWidth(),e.getCellHeight(),G);b.setItemModels(k);b.setEnabled(!u);b.setSelected(f);b.setUserObject(l);b.setCustomPainter(function(V,
J,z){V=V?!1:z==E;var B=$("<div>");Oa.background(B,z);B.addClass("modeler-designer-select-field-dataType-icon");J.append(B);B=wa.PropDataTypeUtil.getDataTypeDesc(z);z=$("<div>");z.addClass("modeler-designer-select-text");V=B+(V?"("+Q.get("origin","\u539f\u59cb")+")":"");z.text(V);z.attr("title",V);J.append(z)});b.addSelectedChangedListener(h)}else n==ib&&(f=p.getOutputDataType(),f==F.DT_NUMBER&&(l=new P(p),l.setEnabled(!u),u=l.getJqUi(),l=e.getCellWidth()-16>>1,f=e.getCellHeight()-16>>1,Ha.layoutCtrl(u,
l,f,16,16),u.appendTo($(b))))}}function P(d){var e,k;this.setEnabled=function(b){k=b};this.getJqUi=function(){e||(e=$("<div>"),e.css("cursor","pointer"),Oa.backgroundWithHover(e,"edit"),e.on("click",a));return e};var a=function(){k&&(new La(d)).showDialog()}}function La(d){N.call(this);var e=this.protectedMethod,k=this,a;(function(){var b=d.getAlias();e.setTitle(Q.get("scaleOfField","\u5b57\u6bb5\u3010#1\u3011\u7684\u7cbe\u5ea6").replace("#1",b));k.setSize(320,240);e.setContentPaneCreator(function(){a||
(a=new ma(d));return a.createJqUi()});e.setClosingChecker2(function(f){f=c(d);f.setRoundMode(a.getRoundMode());f.setScale(a.getScale());m(f);return!0});e.setClosingAction(function(f){})})()}function ma(d){var e,k,a,b=[F.ROUND_MODE_HALF_UP,F.ROUND_MODE_UP,F.ROUND_MODE_DOWN];this.createJqUi=function(){e=$("<div>");var g=(new fa(Q.get("roundMode","\u820d\u5165\u65b9\u5f0f"))).getJqUi();k=new G;k.setItemModels(b);k.setCustomPainter(f);var l=d.getRoundMode();l=l?l:F.ROUND_MODE_HALF_UP;var n=k.getJqUi();
k.setSelected(l);Ha.layoutCtrl(g,20,20,100,24);Ha.layoutCtrl(n,100,20,160,24);g.appendTo(e);n.appendTo(e);g=(new fa(Q.get("decimalDigits","\u5c0f\u6570\u4f4d\u6570"))).getJqUi();a=new ka;l=d.getScale();void 0==l&&(l=2);a.setValue(l);a.setConstraint(0,10,1);l=a.getJqUi();Ha.layoutCtrl(g,20,70,100,24);Ha.layoutCtrl(l,100,70,160,24);g.appendTo(e);l.appendTo(e);return e};this.getRoundMode=function(){if(k)return k.getSelected()};this.getScale=function(){if(a)return a.getValue()};var f=function(g,l,n){switch(n){case F.ROUND_MODE_HALF_UP:var p=
Q.get("roundHalfUp","\u56db\u820d\u4e94\u5165");break;case F.ROUND_MODE_UP:p=Q.get("roundUp","\u5411\u4e0a\u820d\u5165");break;case F.ROUND_MODE_DOWN:p=Q.get("roundDown","\u5411\u4e0b\u820d\u5165")}l.text(p)}}cb.call(this,q);var ra=this.protectedMethod,ta,db,fb,va,Za,Ca,bb,Lb=0,Ua=1,ib=2,ob,Y;this.protectedInitUi=function(d){ta=d;bb=ra.getNode().getConfig()};this.protectedUpdateUi=function(){ra.asynGetFields(function(d){Za!=d&&(db=null,fb&&fb.remove());if(d&&0!=d.length||0!=bb.getModifiedField().length){va&&
va.hide();Za=d;bb.fitRuntimeProperty(Za);db||(db=Ob.createTable(),db.setColumnFitVisibleWidth(!0),d=new H(db),d.setOutsideVisible(!0),db.setCellRender(d),db.setSyncUIWhenModelChanged(!0),Ob.bindTextEditor(db,W,L),Ob.bindTableListenerForCtrl(db),fb=$(db.getUI()),Ha.layoutCtrlWithLRTB(fb,10,10,null,38,10,null),fb.appendTo(ta));fb.show();var e=[];d=[];for(var k=0,a=Za.length;k<a;k++){for(var b=Za[k].clone(),f=e,g=bb.getModifiedField(),l=0;l<g.length;l++)if(b.getFullName()==g[l].getFullName()){b=g[l];
break}gb(b,f,0);d.push(b)}Ca=[];e=bb.getModifiedField();for(k=0;k<e.length;k++){a=e[k];b=!0;for(f=0;f<d.length;f++)if(d[f].getFullName()==a.getFullName()){b=!1;break}b&&Ca.push(a)}a=(k=0<Ca.length)?5:3;e=k?1:0;Lb=0+e;Ua=1+e;ib=2+e;ob=k?0:null;Y=k?4:null;e=db.keepScrollStatus();Ob.clear(db);db.addColumns(a);db.getColumn(Lb).setWidth(100);db.getColumn(Ua).setWidth(100);db.getColumn(ib).setWidth(50);a=Ob.createHeadRow(db);a.getCell(Lb).setValue(Q.get("fieldName","\u5b57\u6bb5\u540d\u79f0"));a.getCell(Ua).setValue(Q.get("dataType",
"\u6570\u636e\u7c7b\u578b"));a.getCell(ib).setValue(Q.get("accuracy","\u7cbe\u5ea6"));k&&(db.getColumn(ob).setWidth(35),db.getColumn(Y).setWidth(35));for(k=0;k<Ca.length;k++)b=Ca[k],a=Ob.createRow(db),a.setUserObject(b),a.getCell(Lb).setValue(b.getAlias());for(k=0;k<d.length;k++)b=d[k],a=Ob.createRow(db),a.setUserObject(b),a.getCell(Lb).setValue(b.getAlias());Ob.refresh(db);db.restoreScrollStatus(e)}else fb&&fb.hide(),va?va.show():(d=new sa,d.setType(sa.TYPE_NO_SOURCE),d.setText(Q.get("currentNodeNoFieldToSet",
"\u5f53\u524d\u8282\u70b9\u6ca1\u6709\u53ef\u8bbe\u7f6e\u7684\u5b57\u6bb5")),va=d.getJqUi(),va.appendTo(ta))})};var gb=function(d,e,k){var a=d.getAlias();a=0<k?a+"_"+k:a;-1<e.indexOf(a)?gb(d,e,k+1):(d.setAlias(a),e.push(a))},W=function(d,e){return e==Lb&&(!Ca||Ca.length<d+1-Ob.getHeadRowCount())?!0:!1},L=function(d,e,k,a,b){a=a?a.trim():"";d=d.getUserObject();e=/^[\u3000\u4E00-\u9FA5a-zA-Z0-9_]{1,}$/;if(d.getAlias()!=a){if(0==a.length)var f=Q.get("nameIsEmpty","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a");
else if(50<a.length)f=Q.get("nameTooLong","\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26");else if(a.match(e)){e=!1;b=[];for(var g=bb.getModifiedField(),l=0;l<Za.length;l++){for(var n=Za[l],p=n.getAlias(),u=0;u<g.length;u++){var E=g[u];if(n.getFullName()==E.getFullName()){p=E.getAlias();break}}b.push(p)}for(g=0;g<b.length;g++)if(b[g]==a){e=!0;break}e&&(f=Q.get("duplicateName","\u540d\u79f0\u91cd\u590d"))}else f=Q.get("invalidFieldName","\u5b57\u6bb5\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210");
f?(f=Q.get("modifyAbandoned","#1\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002").replace("#1",f),ra.getGlobal().getMessageCurtain().showPrompt(f)):(f=c(d),f.setAlias(a),k.setValue(a),m(f))}},h=function(d,e,k){d=d.getUserObject().getUserObject();d=c(d);d.setAppointedDataType(k);m(d)},m=function(d){for(var e=!1,k=0;k<Za.length;k++)if(Za[k].getFullName()==d.getFullName()){e=Za[k].equals(d);break}var a=-1,b=bb.getModifiedField();for(k=0;k<b.length;k++)if(b[k].getFullName()==d.getFullName()){a=k;break}-1<
a&&b.splice(a,1);e||b.push(d);ra.doConfigChangeAction(b,bb.getModifiedField,bb.setModifiedField)},c=function(d){for(var e=bb.getModifiedField(),k=0;k<e.length;k++){var a=e[k];if(a.getFullName()==d.getFullName())return a}return d.clone()}}function Vb(q){function H(){var r=[],A,v,S,na,y,K,da;this.getJqUi=function(){if(!A){A=$("<div>");da=new O;da.setText(Q.get("addToGroup","\u6dfb\u52a0\u5230"));var tb=da.getJqUi();Ha.layoutCtrl(tb,0,0,70,20);tb.css("margin-right",5);A.append(tb);var Jb=$("<div>");
Ha.layoutCtrl(Jb,55,0,15,15);Ha.layoutCtrlMiddleAlign(Jb,15);Jb.appendTo(tb);A.on("click",Ba);Oa.background(Jb,"expandTriangle")}return A};this.setItemModels=function(tb){r=tb};this.setEnabled=function(tb){da.setEnabled(tb)};var Ba=function(tb){if(y)Kb();else if(da.isEnabled()){v||(zb(),Ub());v.setItemModels(r);tb=$(document.body);var Jb=[0,A.outerHeight()-1];Jb=Ha.upwardCoordinate(A[0],Jb,tb[0]);var Sb=Jb[1];Jb=tb.prop("clientHeight");var Yb=Math.min(25*Math.max(1,Math.min(r.length,10))+2,(Jb>>1)-
10);Sb+Yb>Jb&&(Jb=[0,0],Jb=Ha.upwardCoordinate(A[0],Jb,tb[0]),Jb=Jb[1]-Yb+1,0<=Jb&&(Sb=Jb));y=$("<div>");y.addClass("sa-ctrl-common-popup sa-ctrl-common-unselectable modeler-designer-custom-group-popup");Ha.layoutCtrlWithLRTB(y,null,16,150,Sb,null,Yb+24);y.appendTo(tb);Sb=S.getJqUi();Ha.layoutCtrl(Sb,0,0,"100%",23);Sb.appendTo(y);Sb=v.getJqUi();Ha.layoutCtrlWithLRTB(Sb,0,0,"100%",24,0,null);Sb.appendTo(y);tb.on("mousedown",mb);tb.on("mousewheel",Pb);$(window).on("resize",Kb)}},Bb=function(tb,Jb){na||
(na=new fa,na.setText(Jb),na.setEnabled(!1),na.setAlign(fa.ALIGN_CENTER),Jb=na.getJqUi(),Jb.addClass("modeler-designer-field-popup-no-data"),Jb.css("top",30),Jb.appendTo(tb))},zb=function(){S=new ha;S.setSearchListenerDelay(200);S.setPlaceholder(Q.get("search","\u641c\u7d22"));S.addSearchListener(function(){var tb=S.getText().trim();na&&na.getJqUi().remove();na=null;if(tb){var Jb=[];r.forEach(function(Sb){-1<Sb.getGroupItem().getName().toLowerCase().indexOf(tb.toLowerCase())&&Jb.push(Sb)});v.setItemModels(Jb);
Jb.length||Bb(y,Q.get("nothingSearched","\u627e\u4e0d\u5230\u7b26\u5408\u7684\u7ed3\u679c"))}else v.setItemModels(r)})},Ub=function(){v=new hb;v.setBorderVisible(!1);v.setToggleSelectingEnabled(!1);v.setCustomItemPainter(function(tb,Jb){Jb=Jb.getGroupItem().getName();tb.text(Jb);tb.attr("title",Jb)});v.addPressedListener(function(tb,Jb){K(tb);Kb()})};this.addPressedItemFunc=function(tb){K=tb};var Pb=function(tb){Ha.isDescendent(tb.target,v.getJqUi()[0])||Kb()},mb=function(tb){A.is(":visible")&&(Ha.isDescendent(tb.target,
A[0])||Ha.isDescendent(tb.target,y[0]))||Kb()},Kb=function(){if(y){var tb=$(document.body);tb.off("mousedown",mb);tb.off("mousewheel",Pb);$(window).off("resize",Kb);y.detach();y=null;S.clear()}}}function P(){var r=this,A,v,S,na,y,K,da=!0,Ba=!1,Bb=!0,zb,Ub,Pb;var mb="GroupItem_"+com.kingdee.bos.qing.common.Util.createUUID();this.setNewCreated=function(){Pb=!0};this.getType=function(){return Ub};this.setId=function($b){mb=$b};this.getId=function(){return mb};this.setGroupItem=function($b){zb=$b};this.getGroupItem=
function(){return zb};this.setCollapse=function($b){da=!$b};this.setEditEnable=function($b){Bb=$b};this.setEditingStatus=function($b){Ba=$b};this.protectedUpdatePanel=function(){throw Error("overwrite method");};this.getJqUi=function(){if(!A){A=$("<div class='modeler-designer-custom-group-panel'>");S=$("<div class='modeler-designer-custom-group-panel-title'>");A.append(S);Kb();v=$("<div>");v.css({position:"relative",overflow:"hidden auto"});var $b=r.protectedUpdatePanel();$b&&v.append($b);A.append(v);
ec()}return A};var Kb=function(){S.empty();if(Ba){var $b=new Ja,bc=$b.getJqUi();bc.css({width:"100%",height:"100%"});$b.setPlaceholder(Q.get("inputGroupName","\u8bf7\u8f93\u5165\u5206\u7ec4\u540d\u79f0"));$b.setText(zb.getName());$b.addBlurListener(function(){tb($b.getText())});$b.addAcceptableListener(function(gc,hc){tb($b.getText())});S.append(bc);S.css("margin-bottom",8);setTimeout($b.requestFocus,0)}else{bc=$("<div class='modeler-designer-custom-group-panel-inner-title'>");na=$("<div>");Ha.layoutCtrl(na,
0,4.4,15,15);var dc=$("<div class='sa-ctrl-common-foreground_enabled modeler-designer-custom-group-title-text'>");Ha.layoutCtrlWithLRTB(dc,19,0,null,0,0);Ha.layoutCtrlMiddleAlign(dc,25);Ha.makeTextOmissible(dc);var fc=zb.getName();dc.text(fc);dc.attr("title",fc);bc.append(na);bc.append(dc);Jb(bc);bc.mouseenter(Sb);bc.mouseleave(Yb);bc.on("click",cc);bc.appendTo(S);S.css("margin-bottom",2)}},tb=function($b){var bc=aa($b,zb.getName(),I,!0);if(bc||Pb)$b=bc?$.trim($b):zb.getName(),bc=zb.clone(),bc.setName($b),
r.setGroupItem(bc),E();Ba=!1;Kb();ec()},Jb=function($b){y=$("<div>");K=$("<div>");Ha.layoutCtrlWithLRTB(K,null,35,17,null,null,15);Ha.layoutCtrlMiddleAlign(K,15);Ha.layoutCtrlWithLRTB(y,null,10,17,null,null,15);Ha.layoutCtrlMiddleAlign(y,15);Oa.backgroundWithHover(y,"delete");Oa.backgroundWithHover(K,"edit");$b.append(K);$b.append(y);K.on("click",function(bc){ac(bc,"RENAME")});y.on("click",function(bc){ac(bc,"DELETE")});y.hide();K.hide()},Sb=function(){Bb&&(y.show(),K.show())},Yb=function(){Bb&&(y.hide(),
K.hide())},ac=function($b,bc){$b.stopPropagation();if("RENAME"===bc)Ba=!0,Kb();else{$b=r.getId();bc=-1;for(var dc=0;dc<Y.length;dc++)if(Y[dc].getId()===$b){bc=dc;break}$b=bc;-1<$b&&Y.splice($b,1);E()}},cc=function(){da=!da;zb.setCollapse(!da);ec()},ec=function(){da?(na&&Oa.background(na,"expandTriangle"),v.show()):(na&&Oa.background(na,"collapseTriangle"),v.hide())};this.protectedMethod={setType:function($b){Ub=$b}}}function La(){function r(y){var K=this,da,Ba=[],Bb=[];this.highlightItem=function(mb){if(da){for(var Kb=
da.find(".modeler-designer-custom-group-list-item"),tb=!1,Jb=0;Jb<Kb.length;Jb++){var Sb=Kb.eq(Jb),Yb=Sb.data("text");-1<Yb.toLowerCase().indexOf(mb.toLowerCase())?(tb=Yb.replace(new RegExp(mb,"i"),function(ac){return"<span class='modeler-designer-custom-group-list-item_highlight'>"+ac+"</span>"}),Sb.children(":first").html(tb),Sb.show(),tb=!0):Sb.hide()}return tb}};this.recovery=function(){if(da)for(var mb=da.find(".modeler-designer-custom-group-list-item"),Kb=0;Kb<mb.length;Kb++){var tb=mb.eq(Kb);
tb.show();tb.children(":first").text(tb.data("text"))}};this.setSelecteds=function(mb){Bb=mb;Ub()};this.getSelecteds=function(){return Bb};this.setItemModels=function(mb){Ba=mb;zb()};this.getJqUi=function(){if(!da){da=$("<div>");var mb=$("<div>");mb.addClass("modeler-designer-custom-group-list-owner");mb.on("mousedown",Pb);mb.appendTo(da);zb();Ub()}return da};var zb=function(){if(da){var mb=da.children(".modeler-designer-custom-group-list-owner");mb.empty();for(var Kb=$(document.createDocumentFragment()),
tb=0;tb<Ba.length;tb++){var Jb=Ba[tb],Sb=$("<div>");Sb.attr("title",Jb.value);Sb.addClass("modeler-designer-custom-group-list-item");Sb.data("model",Jb.key);Sb.data("text",Jb.value);Jb=$("<div>"+Jb.value+"</div>");Ha.makeTextOmissible(Jb);var Yb=$("<div class='modeler-designer-custom-group-list-item-mark-container'>");Ha.layoutCtrlWithLRTB(Yb,null,0,17,null,0,17);var ac=$("<div class='modeler-designer-custom-group-list-item-mark-icon'>");Oa.background(ac,"checkMark");Ha.layoutCtrlWithLRTB(ac,null,
-1,15,null,-1,15);Jb.appendTo(Sb);Yb.appendTo(Sb);ac.appendTo(Sb);Kb.append(Sb)}mb.append(Kb)}},Ub=function(){if(da){da.find(".modeler-designer-custom-group-list-item_selected_enabled").removeClass("modeler-designer-custom-group-list-item_selected_enabled");for(var mb=da.find(".modeler-designer-custom-group-list-item"),Kb=0;Kb<Bb.length;Kb++)for(var tb=Bb[Kb],Jb=0;Jb<mb.length;Jb++){var Sb=mb.eq(Jb);if(Sb.data("model")===tb){Sb.addClass("modeler-designer-custom-group-list-item_selected_enabled");
break}}}},Pb=function(mb){mb=$(mb.target);if(mb=Ha.upwardSearchHasClass(mb,da,"modeler-designer-custom-group-list-item")){mb=mb.data("model");var Kb=Bb.slice(),tb=Kb.indexOf(mb);-1<tb?Kb.splice(tb,1):Kb.push(mb);K.setSelecteds(Kb);y.setSelecteds(Kb)}}}P.call(this);var A=this,v,S=[];this.protectedMethod.setType(Ya.STRING);this.getSelectedMembers=function(){return v?v.getSelecteds():[]};this.setSelectedMembers=function(y){S=y;v&&v.setSelecteds(S)};this.highlightMember=function(y){if(y)return(y=v.highlightItem(y))?
A.getJqUi().show():A.getJqUi().hide(),y};this.recovery=function(){A.getJqUi().show();v&&v.recovery()};this.protectedUpdatePanel=function(){var y=na(A.getGroupItem());v=new r(A.getGroupItem());v.setItemModels(y);v.setSelecteds(S);y=v.getJqUi();A.highlightMember(h.getText().trim());return y};var na=function(y){var K=y.getMembers();if(!p)return K.map(function(Ba){return{key:Ba,value:Ba}});var da=[];K.forEach(function(Ba,Bb){p[Ba]?da.push({key:Ba,value:p[Ba]}):K.splice(Bb,1)});y.setMembers(K);return da}}
function ma(){P.call(this);var r=this,A,v;this.protectedMethod.setType(Ya.NUMBER);this.protectedUpdatePanel=function(){A=$(document.createDocumentFragment());v=r.getGroupItem();var na=new S;na.setValue(v.getFrom());na.setFuncValueSetter(function(K){var da=v.clone();da.setFrom(K);r.setGroupItem(da)});na.setBoundary(v.getFromBoundary());na.setFuncBoundarySetter(function(K){var da=v.clone();da.setFromBoundary(K);r.setGroupItem(da)});na.setComboBoxSelectors([kb.COMPARE_GREATER_EQUAL,kb.COMPARE_GREATER]);
var y=new S;y.setValue(v.getTo());y.setFuncValueSetter(function(K){var da=v.clone();da.setTo(K);r.setGroupItem(da)});y.setBoundary(v.getToBoundary());y.setFuncBoundarySetter(function(K){var da=v.clone();da.setToBoundary(K);r.setGroupItem(da)});y.setComboBoxSelectors([kb.COMPARE_LESS,kb.COMPARE_LESS_EQUAL]);A.append(na.getJqUi());A.append(y.getJqUi());return A};var S=function(){var na,y,K,da,Ba,Bb;this.setValue=function(mb){y=mb};this.setBoundary=function(mb){K=mb};this.setFuncValueSetter=function(mb){da=
mb};this.setFuncBoundarySetter=function(mb){Ba=mb};this.setComboBoxSelectors=function(mb){Bb=mb};var zb=function(mb){switch(mb){case kb.COMPARE_GREATER_EQUAL:return">=";case kb.COMPARE_LESS_EQUAL:return"<=";case kb.COMPARE_GREATER:return">";case kb.COMPARE_LESS:return"<";default:return""}},Ub=function(mb,Kb,tb){da(tb);B();E()},Pb=function(mb,Kb,tb){Ba(tb);B();E()};this.getJqUi=function(){na=$("<div class='modeler-designer-custom-group-number-inline-row'>");var mb=new G,Kb=mb.getJqUi();mb.setEnabled(!gb);
Ha.layoutCtrlWithLRTB(Kb,0,"70%",null,0);mb.setCustomPainter(function(ac,cc,ec){cc.text(zb(ec))});mb.addSelectedChangedListener(Pb);mb.setSelected(K);mb.setItemModels(Bb);mb=$("<div class='modeler-designer-custom-group-ctrl'>");Ha.layoutCtrlWithLRTB(mb,"38%",0,null,0);var tb=m.getOutputDataType(),Jb=tb===F.DT_INT?-2147483648:-1*Number.MAX_VALUE;tb=tb===F.DT_INT?2147483647:Number.MAX_VALUE;var Sb=new ka;Sb.setEnabled(!gb);var Yb=$("<div class='warning-icon'></div>");Oa.background(Yb,"qingWarning");
Ha.layoutCtrl(Yb,-16,4,16,16);Sb.supportDecimal(10);Sb.setConstraint(Jb,tb,1);Sb.setValue(y);Sb.addValueChangedListener(Ub,!0);mb.append(Yb);mb.append(Sb.getJqUi());Kb.appendTo(na);mb.appendTo(na);return na}}}cb.call(this,q);var ra=this.protectedMethod,ta,db,fb,va,Za,Ca,bb,Lb,Ua=[],ib=[],ob=[],Y=[],gb,W,L,h,m,c,d,e,k,a,b,f,g,l=!0,n,p,u=ra.doConfigChangeAction,E=function(){for(var r=[],A=0;A<Y.length;A++)Y[A].getId()!==La.UNGROUP&&r.push(Y[A].getGroupItem());A=V(m.getOutputDataType());u({field:m,groups:r,
groupType:A},function(){f=a.getSelectedField();return a.getGroupAndField()},a.setGroupAndField)},V=function(r){return r===F.DT_STRING?Ya.STRING:Ya.NUMBER},J=function(r){switch(r){case "DATA_DECREMENT":return Q.get("dataDecrement","\u5206\u7ec4\u6570\u503c\u5fc5\u987b\u9012\u589e\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");case "DATA_CROSSOVER":return Q.get("dataCrossOver","\u6570\u636e\u8303\u56f4\u4e0e\u5176\u4ed6\u5206\u7ec4\u6709\u4ea4\u53c9\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");case "FIELD_TYPE_CHANGE":return Q.get("fieldTypeChange",
"\u5b57\u6bb5\u7c7b\u578b\u53d8\u5316\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u5b57\u6bb5");case "FIELD_NOT_EXIST":return Q.get("fieldNotFound","\u5b57\u6bb5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664");default:throw Error("Unknown Error Type: "+r);}},z=function(r,A,v,S,na,y){if(null!==v){if(v<na)v=!0;else if(v>na)v=!1;else if(r===ma.TO)v=S===kb.COMPARE_GREATER_EQUAL&&y===kb.COMPARE_LESS_EQUAL;else if(r===ma.FROM)v=!(S===kb.COMPARE_LESS_EQUAL&&y===kb.COMPARE_GREATER_EQUAL);else throw Error("Unknown NumberGroupPanel Type: "+
r);v||(r=r===ma.FROM?"DATA_CROSSOVER":"DATA_DECREMENT",A.show(),A.attr("title",J(r)))}},B=function(){var r=null,A=null,v;Y.forEach(function(S){var na=S.getGroupItem();S=S.getJqUi().find(".warning-icon");v=$(S[0]);v.hide();z(ma.FROM,v,r,A,na.getFrom(),na.getFromBoundary());r=na.getFrom();A=na.getFromBoundary();v=$(S[1]);v.hide();z(ma.TO,v,r,A,na.getTo(),na.getToBoundary());r=na.getTo();A=na.getToBoundary()})},I=function(r){for(var A=0;A<Y.length;A++)if(Y[A].getGroupItem().getName()===r||a.getOtherGroupName()===
r)return!0;return!1},ia=function(r){for(var A=0;A<ib.length;A++)if(ib[A].getAlias()===r)return!0;return!1},aa=function(r,A,v,S){r=$.trim(r);var na=/^([\u3000\u4E00-\u9FA5a-zA-Z_]{1,})[\u3000\u4E00-\u9FA5a-zA-Z0-9_]{0,}$/;S&&(na=/^([\u3000\u4E00-\u9FA5a-zA-Z0-9_]{1,})[\u3000\u4E00-\u9FA5a-zA-Z0-9_]{0,}$/);if(r===(A||""))return!1;switch(!0){case !r.length:var y=Q.get("nameIsEmpty","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a");break;case 50<r.length:y=Q.get("nameTooLong","\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26");
break;case !r.match(na):y=S?Q.get("invalidGroupName","\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210"):Q.get("invalidGroupNameNoStartNumber","\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\uff0c\u4e14\u4e0d\u80fd\u4ee5\u6570\u5b57\u5f00\u5934");break;case v(r):y=Q.get("duplicateName","\u540d\u79f0\u91cd\u590d")}return y?(y=Q.get("modifyAbandoned","#1\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002").replace("#1",
y),ra.getGlobal().getMessageCurtain().showPrompt(y),!1):!0};this.clearCache=function(){f=null};var pa=function(r){if(aa(r.getText(),a.getGroupName(),ia)){var A=$.trim(r.getText());r.setText(A);la(A);n=A;u(A,$a,X)}else r.setText(a.getGroupName())},la=function(r){if(r!==n){var A=new F;A.setFromNode(q.getId());A.setName(a.getName());A.setAlias(r);wa.FieldNumberHelper.isDynamicFieldNumber(A)&&wa.FieldNumberHelper.generateDefaultNumberByAssignedName(A,r)}},X=function(r){if(q.getFieldSettingConfig()){for(var A=
q.getFieldSettingConfig().getModifiedField(),v=[],S=0;S<A.length;S++){var na=A[S];na.getName()===a.getName()&&(na.setAlias(r),!na.getAppointedDataType()&&na.setAppointedDataType(F.DT_STRING));v.push(na)}q.getFieldSettingConfig().setModifiedField(v,!0)}else v=[],A=new wa.FieldSettingConfig,S=new F,S.setFromNode(q.getId()),S.setName(a.getName()),S.setAlias(r),v.push(S),A.setModifiedField(v,!0),q.setFieldSettingConfig(A);a.setGroupName(r)},$a=function(){return a.getGroupName()},nb=function(r,A){A&&(l=
r.isChecked(),u(r.isChecked(),a.getHasOtherGroup,function(v){a.setHasOtherGroup(v);l=v}))},Ib=function(r){if(aa(r.getText(),a.getOtherGroupName(),I,!0)){var A=$.trim(r.getText());r.setText(A);u(A,a.getOtherGroupName,a.setOtherGroupName)}else r.setText(a.getOtherGroupName())},Gb=function(r){a:{r=r.getSelecteds()[0].getGroupItem();for(var A=0;A<Y.length;A++)if(Y[A].getGroupItem()===r){r=Y[A];break a}r=null}A=r.getGroupItem();for(var v=[],S=0;S<Y.length;S++)if(Y[S].getId()===r.getId())A.setSelecteds([]);
else{var na=Y[S].getSelectedMembers();if(na&&na.length){v=v.concat(na);var y=Y[S],K=na;na=y.getGroupItem();var da=na.getMembers().slice();na.setSelecteds([]);for(var Ba=0;Ba<K.length;Ba++){var Bb=da.indexOf(K[Ba]);-1<Bb&&da.splice(Bb,1)}K=na.clone();K.setMembers(da);K.setCollapse(na.getCollapse());y.setGroupItem(K)}}if(v.length){S=A.getMembers().slice();y=A.clone();y.setMembers(S.concat(v));y.setCollapse(A.getCollapse());r.setGroupItem(y);if(h.getText().trim())for(h.clear(),r=0;r<Y.length;r++)Y[r].recovery();
E()}},vb=function(r,A){var v=$("<div class='flex-center modeler-designer-custom-group-line-item'>");Ha.makeTextOmissible(r);v.append(r);v.append(A);return v};this.protectedInitUi=function(r){a=q.getConfig();l=a.getHasOtherGroup();if(!ta){r.addClass("modeler-designer-custom-group-owner");r.css("overflow","hidden");ta=$("<div class='modeler-designer-custom-group-container'>");Ha.layoutCtrlWithLRTB(ta,0,0,null,39,45);ta.appendTo(r);d=new Ja;d.addBlurListener(pa);var A=(new fa(Q.get("name","\u540d\u79f0"))).getJqUi();
A.addClass("modeler-propertyarea-lineitem-caption");var v=d.getJqUi();v.addClass("modeler-propertyarea-lineitem-ctrl");vb(A,v).appendTo(ta);A=$("<div>");Lb=$("<div>");Lb.hide();Oa.background(Lb,"qingWarning");Ha.layoutCtrl(Lb,-16,4,16,16);c=new Fb;c.setModeler(ra.getGlobal().getModelerModel());c.addSelectionListener(function(S){m&&m.getFullName()===S.getFullName()||(b=!0,m=S,g=gb=null,h.clear(),Rb(),Y=[],pb())});A.append(Lb);A.append(c.getJqUi());v=(new fa(Q.get("groupField","\u5206\u7ec4\u4f9d\u636e"))).getJqUi();
v.addClass("modeler-propertyarea-lineitem-caption");A.addClass("modeler-propertyarea-lineitem-ctrl");vb(v,A).appendTo(ta);Wb();sb();db=$("<div>");Ha.layoutCtrlWithLRTB(db,0,0);db.css("overflow-y","auto");db.appendTo(ta);fb=$("<div>");fb.appendTo(db);A=$("<div>");Ha.layoutCtrlWithLRTB(A,0,0,null,null,0);A.appendTo(r);k=new ea;k.addCheckedListener(nb);r=k.getJqUi();r.css({position:"relative",width:"60%","max-width":170});k.setText(Q.get("unGroupMember","\u672a\u8bbe\u7f6e\u5206\u7ec4\u7684\u503c\u5212\u5206\u5230"));
e=new Ja;e.addBlurListener(Ib);v=e.getJqUi();v.addClass("modeler-designer-custom-group-line-item-right");vb(r,v).appendTo(A);va=$("<div class='flex-center' style='justify-content: flex-start; margin: 0 8px'>");va.appendTo(A)}};this.protectedUpdateUi=function(){var r=a.getSelectedField(),A=a.getCustomGroupType();ra.asynGetFields(function(v){Ua=[];ib=[];m=gb=null;for(var S=0;S<v.length;S++){var na=v[S],y=na.getOutputDataType();ib.push(na);if(r&&r.getFullName()===na.getFullName())m=na,a.setSelectedField(m);
else if(y!==F.DT_STRING&&y!==F.DT_NUMBER&&y!==F.DT_INT)continue;Ua.push(na)}A=a.getCustomGroupType();if(r&&!m)gb="FIELD_NOT_EXIST",A&&r.setDataType(A),m=r;else if(v=A,m&&v&&(S=m.getOutputDataType(),v!==Ya.NUMBER||S!==F.DT_INT&&S!==F.DT_NUMBER))if(v!==Ya.STRING||S!==F.DT_STRING)gb="FIELD_TYPE_CHANGE";v=a.getGroupName();if(q.getFieldSettingConfig()&&q.getFieldSettingConfig().getModifiedField()){S=q.getFieldSettingConfig().getModifiedField();for(na=0;na<S.length;na++)if(y=S[na],y.getName()===a.getName()){!y.getAppointedDataType()&&
y.setAppointedDataType(F.DT_STRING);v=y.getAlias();a.getGroupName()?(a.setGroupName(v,!0),la(v),n=v):v=void 0;break}q.getFieldSettingConfig().setModifiedField(S,!0)}d.setText(v);d.setEnabled(!gb);d.getJqUi().attr("title",v);e.setText(a.getOtherGroupName());e.setEnabled(!gb);e.getJqUi().attr("title",a.getOtherGroupName());W.setEnabled(!gb);L.setEnabled(!gb);k.setChecked(l);k.setEnabled(!gb);gb?a.setHasOtherGroup(!1,!0):a.setHasOtherGroup(a.getHasOtherGroup(),!0);c.protectedSetItemModels(Ua);c.protectedSetSelected(m);
Lb.hide();gb&&(v=Lb,S=gb,v.show(),v.attr("title",J(S)));b||(gb?(ob=[],Fa()):f&&m&&f.getFullName()===m.getFullName()?Fa():t())})};var sb=function(){h=new ha;h.setPlaceholder(Q.get("searchTable","\u8bf7\u8f93\u5165\u641c\u7d22\u5185\u5bb9"));h.setShowSearchIcon(!0);h.setSearchListenerDelay(200);h.addSearchListener(function(r){if(r=r.getText().trim()){for(var A=!0,v=0;v<Y.length;v++)Y[v].highlightMember(r)&&(A=!1);A?(bb||(r=new sa,r.setType(sa.TYPE_NO_SEARCH_RESULT),r.setText(Q.get("noSearchResult",
"\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),bb=r.getJqUi(),bb.appendTo(db)),bb.show(),fb.hide()):Rb()}else{for(r=0;r<Y.length;r++)Y[r].recovery();Rb()}});Ca=h.getJqUi();Ca.css({position:"relative",height:"25px",margin:"0 8px 8px"});ta.append(Ca);Ca.hide()},Rb=function(){bb&&(bb.hide(),fb.show())},Wb=function(){Za=$("<div class='modeler-designer-custom-group-ctrl-container flex-center'>");var r=(new fa(Q.get("groupSetting","\u5206\u7ec4\u8bbe\u7f6e"))).getJqUi();Ha.makeTextOmissible(r);
r.appendTo(Za);L=Xb();r=L.getJqUi();r.addClass("modeler-designer-custom-group-ctrl-setting-new-btn");r.appendTo(Za);W=new H;r=W.getJqUi();r.addClass("modeler-designer-custom-group-ctrl-setting-add-btn");r.appendTo(Za);W.addPressedItemFunc(Gb);ta.append(Za);Za.hide()},Xb=function(){var r=new O;r.setText(Q.get("addGroup","\u65b0\u589e\u5206\u7ec4"));r.addActionListener(function(){var A=m.getOutputDataType()===F.DT_STRING?new La:new ma;var v=A.setGroupItem,S=Cb,na=S.createGroupByFieldType,y=A.getType();
var K=!1;for(var da=1;!K;){K=!0;for(var Ba=Q.get("group","\u5206\u7ec4")+da.toString(),Bb=0;Bb<Y.length;Bb++)if(Y[Bb].getGroupItem().getName()===Ba){da++;K=!1;break}}K=Q.get("group","\u5206\u7ec4")+da.toString();v.call(A,na.call(S,y,{name:K}));A.setEditingStatus(!0);A.setNewCreated();fb.append(A.getJqUi());Y.push(A);W&&W.setItemModels(Y)});return r},Zb=function(){fb.empty();va.empty();Za.hide();Ca.hide()},pb=function(){m?ra.asyncGetFieldValues([m.toJsonObject()],function(r){if(r){ob=[];var A=r.fields;
p=A.length&&A[0].extensions?A[0].extensions.bizFieldEnumKey:null;r=r.values;r=r.length?r[0]:[];for(A=0;A<r.length;A++){var v=r[A];null!==v&&""!==v&&ob.push(v)}b?(Zb(),Za.show(),m.getOutputDataType()===F.DT_STRING?Da(null):R(null),E(),f=m,b=!1):Fa()}}):Zb()},Fa=function(){Zb();if(m){Za.show();var r=a.getGroups();a.getCustomGroupType()===Ya.STRING?Da(r):R(r);f=m}},R=function(r){db.css("height","calc(100% - 97px)");W.getJqUi().hide();for(var A=$(document.createDocumentFragment()),v=r?r.length:3,S=[],
na=0;na<v;na++){if(r){var y=r[na];var K=new ma;K.setGroupItem(y);K.setCollapse(y.getCollapse())}else K=new ma,K.setGroupItem(Cb.createGroupByFieldType(K.getType(),{name:Q.get("group","\u5206\u7ec4")+(na+1)}));K.setEditEnable(!gb);A.append(K.getJqUi());S.push(K)}fb.append(A);Y=S;B();A=ob.length?ob:[0];r=Math.min.apply(null,A);A=Math.max.apply(null,A);v=(new fa(m.getAlias()+Q.get("fieldValueRange","\u5b57\u6bb5\u7684\u503c\u533a\u95f4")+"\uff1a")).getJqUi();S=(new fa(Q.get("minValue","\u6700\u5c0f\u503c")+
r)).getJqUi();na=(new fa(Q.get("maxValue","\u6700\u5927\u503c")+A)).getJqUi();S.attr("title",r);na.attr("title",A);Ha.makeTextOmissible(S);Ha.makeTextOmissible(na);va.append(v);va.append(S);va.append("\uff0c");va.append(na)},Da=function(r){W.getJqUi().show();Ca.show();db.css("height","calc(100% - 110px)");var A=ob.slice(),v=$(document.createDocumentFragment()),S=[],na=[];if(null===r){var y=new La;y.setGroupItem(Cb.createGroupByFieldType(y.getType(),{name:Q.get("group","\u5206\u7ec4")+1}));y.setEditEnable(!gb);
v.append(y.getJqUi());S.push(y)}r=r||[];r.forEach(function(K){var da=new La;da.setGroupItem(K);da.setCollapse(K.getCollapse());da.setSelectedMembers(K.getSelecteds());da.setEditEnable(!gb);v.append(da.getJqUi());S.push(da);na=na.concat(K.getMembers())});fb.append(v);Y=S;ua(na,A)},ua=function(r,A){if(!gb){var v=!1,S=[];g&&(v=g.getGroupItem().getCollapse(),S=g.getGroupItem().getSelecteds());g=new La;if(A.length)for(var na=0;na<r.length;na++){var y=A.indexOf(r[na]);-1<y&&A.splice(y,1)}g.setGroupItem(Cb.createGroupByFieldType(g.getType(),
{name:Q.get("noGroupedLabel","\u672a\u8bbe\u7f6e\u5206\u7ec4\u7684\u7ef4\u5ea6\u6210\u5458"),members:A}));g.getGroupItem().setSelecteds(S);g.getGroupItem().setCollapse(v);g.setId(La.UNGROUP);g.setCollapse(v);g.setSelectedMembers(S);g.setEditEnable(!1);fb.prepend(g.getJqUi());Y.unshift(g);W&&W.setItemModels(Y)}},t=function(r,A){var v;return function(){v&&clearTimeout(v);v=setTimeout(r,A)}}(pb,500);La.UNGROUP="unGroup";ma.FROM="from";ma.TO="to"}function Db(q){function H(Ca,bb){function Lb(t){var r=
this,A=!0,v=!0,S,na,y,K,da,Ba;this.getGroupByFieldItem=function(){return t};this.setShowSortArrow=function(Pb){A=Pb};this.setFieldValid=function(Pb){v=Pb};this.setInValidText=function(Pb){S=Pb};this.checkGroupByFieldItemStatus=function(){for(var Pb=!1,mb=0;mb<L.length;mb++){var Kb=L[mb];if(Kb.getFullName()===t.getField().getFullName()){Pb=!0;r.protectedCheckDataTypeValid(t,Kb);break}}Pb||(r.setFieldValid(Pb),Pb=Q.get("fieldNotExist","\u4e0d\u5b58\u5728\u7684\u5b57\u6bb5"),r.setInValidText(Pb))};this.setMoveUpGroupByField=
function(Pb){da=Pb};this.setShowPropertySettingMenu=function(Pb){Ba=Pb};this.createMenuModel=function(Pb){var mb=new Ga;r.protectedCreateMenuModel(mb,v);var Kb=Pa.createActionMenuItem(Q.get("rename","\u91cd\u547d\u540d"),function(){Rb(r,Pb)});mb.addItemModel(Kb);Kb=Pa.createActionMenuItem(Q.get("remove","\u79fb\u9664"),function(){Xb(t,Pb)});mb.addItemModel(Kb);return mb};this.getJqUi=function(){if(!na){na=$("<div class='model-designer-selected-group-by-field-item'>");var Pb=ja.createWarning();Pb.css({position:"absolute",
"margin-top":"5px"});Pb.attr("title",S);Pb.appendTo(na);Pb.hide();var mb=$("<div class='model-designer-selected-group-by-field-name'>"),Kb=t.getField().getAppointedAlias();Kb=Kb?Kb:c(t.getField().getFullName(),t);mb.text(Kb);mb.attr("title",Kb);mb.appendTo(na);r.protectedInitGroupByFieldItemUi(mb);v||(mb.css("margin-left","16px"),Pb.show());na.mouseenter(Bb);na.mouseleave(zb);Ub()}return na};var Bb=function(){y&&y.show();A&&K&&K.show()},zb=function(){y&&y.hide();K&&K.hide()},Ub=function(){K=$("<div class='model-designer-selected-group-by-field-sort-arrow'>");
Oa.backgroundWithHover(K,"moveUp");K.attr("title",Q.get("moveUpField","\u4e0a\u79fb\u5b57\u6bb5"));K.on("click",function(mb){r.protectedMoveUpGroupByField(t,da)});K.appendTo(na);y=$("<div class='model-designer-selected-group-by-field-menubtn'>");y.on("mousedown",function(mb){mb=$(mb.target);r.protectedShowPropertySettingMenu(mb,Ba)});var Pb=$("<div class='model-designer-selected-group-by-field-menubtn-text'>");Pb.text("\u25b2");Pb.appendTo(y);y.appendTo(na);y.hide();K.hide()}}function Ua(t){Lb.call(this,
t);var r=this;this.protectedInitGroupByFieldItemUi=function(A){var v=t.getField().getOutputDataType();if(t.getDateGroup()||Zb(v))!t.getDateGroup()&&Zb(v)&&(t.updateGroupByFieldProperty(),v=f(t),t.getDateGroupTypeMap().alias=v,t.getField().setAlias(v),g(t)),v=Ta.dateTypeTextConvert(t.getDateGroupType()),A.text(v+Q.get("colon","\uff1a")+t.getField().getAlias())};this.protectedMoveUpGroupByField=function(A,v){v(A,fb.copyGroupFieldItems())};this.protectedShowPropertySettingMenu=function(A,v){v(r,A,fb.copyGroupFieldItems())};
this.protectedCreateMenuModel=function(A,v){var S=t.getField().getOutputDataType();Zb(S)&&v&&Ib(A,t,fb.copyGroupFieldItems())};this.protectedCheckDataTypeValid=function(A,v){v=v.getOutputDataType();A.getField().setAppointedDataType(v);A.getDateGroup()&&!Zb(v)&&(r.setFieldValid(!1),A=Q.get("dateGroupInValid","\u975e\u201c\u65e5\u671f\u578b\u201d\u3001\u201c\u65e5\u671f\u65f6\u95f4\u578b\u201d\u5b57\u6bb5\uff0c\u65e5\u671f\u5206\u7ec4\u8bbe\u7f6e\u65e0\u6548\u3002"),r.setInValidText(A))}}function ib(t){Lb.call(this,
t);var r=this;this.protectedInitGroupByFieldItemUi=function(A){var v=X(t.getFunctionType())+Q.get("colon","\uff1a")+t.getField().getAlias();A.text(v)};this.protectedMoveUpGroupByField=function(A,v){v(A,fb.copyAggregateFieldItems())};this.protectedShowPropertySettingMenu=function(A,v){v(r,A,fb.copyAggregateFieldItems())};this.protectedCreateMenuModel=function(A,v){la(A,v,t,fb.copyAggregateFieldItems())};this.protectedCheckDataTypeValid=function(A,v){var S=A.getFunctionType();v=v.getOutputDataType();
A.getField().setAppointedDataType(v);A=[Xa.COUNT,Xa.DISTINCT_COUNT];pb(v)?A.push(Xa.SUM,Xa.AVG,Xa.MAX,Xa.MIN):Zb(v)&&A.push(Xa.MAX,Xa.MIN);-1===A.indexOf(S)&&(r.setFieldValid(!1),S=Q.get("functionTypeInValid","\u805a\u5408\u65b9\u5f0f\u4e0d\u6b63\u786e"),r.setInValidText(S))}}var ob=this,Y,gb,W=[],L=[],h,m;this.setFields=function(t){L=t};this.getJqUi=function(){if(!Y){Y=$("<div class='modeler-designer-group-agg-area'>");var t=$("<div class='modeler-designer-group-agg-title'>");t.text(bb);var r=$("<span class='modeler-designer-group-add-btn'>");
Oa.backgroundWithHover(r,"add");r.attr("title",Q.get("addField","\u6dfb\u52a0\u5b57\u6bb5"));r.on("click",e);r.appendTo(t);t.appendTo(Y);gb=$("<div class='modeler-designer-group-agg-field-area'>");gb.appendTo(Y)}return Y};this.getJqFieldArea=function(){return gb};this.setGroupByFieldItems=function(t){W=t};this.setFunConfigGetterAndSetter=function(t,r){m=t;h=r};this.updatePanel=function(){if(q.getFieldSettingConfig())for(var t=q.getFieldSettingConfig().getModifiedField(),r=0;r<W.length;r++){var A=
!1,v=W[r],S=Fa(v),na=v.getField().getFullName();S&&(na=q.getId()+"_"+v.getName());for(var y=0;y<t.length;y++){var K=t[y],da=K.getFullName();if(na===da){A=!0;(K=y=K.getAppointedAlias())||(K=c(na,v));v.getField().getAlias()!==K&&(v.getField().setAlias(K),d(v));break}}!A&&(na=fb.getMapInitFieldItem()[na])&&(A=na.getAlias(),na=na.getNumber(),A&&v.getField().setAlias(A),S&&na&&B(v.getName(),na))}else for(t=fb.getMapInitFieldItem(),r=0;r<W.length;r++)v=W[r],S=v.getField().getFullName(),Fa(v)&&(S=q.getId()+
"_"+v.getName(),t[S]&&B(v.getName(),t[S].getNumber())),t[S]&&(S=t[S].getAlias())&&v.getField().setAlias(S);(t=ob.getJqFieldArea())&&t.empty();r=$(document.createDocumentFragment());for(v=0;v<W.length;v++)S=ob.createGroupByFieldItemUi(W[v],Ca),S.checkGroupByFieldItemStatus(),0===v&&S.setShowSortArrow(!1),S.setMoveUpGroupByField(aa),S.setShowPropertySettingMenu(pa),S.getJqUi().appendTo(r);r.appendTo(t)};var c=function(t,r){for(var A,v=0;v<L.length;v++)if(t===L[v].getFullName()){A=L[v].getAlias();break}A||
(A=r.getField().getAlias());return A},d=function(t,r){r=r?r:t.getField().getAlias();t instanceof Xa?t.getFunctionTypeMap().alias=r:t.getDateGroupTypeMap().alias=r;if(Fa(t)){var A=new F;A.setName(t.getName());A.setFromNode(q.getId());wa.FieldNumberHelper.isNumberManualModified(A)||wa.FieldNumberHelper.generateDefaultNumberByAssignedName(A,r)}};this.createGroupByFieldItemUi=function(t,r){switch(r){case Za.GROUP:return new Ua(t);case Za.AGGREGATE:return new ib(t)}};var e=function(){var t=new Hb,r=k(L);
t.setArrAllFieldItems(r);t.setFunFieldCheckboxClickHandler(function(A,v){if(Ca===Za.GROUP&&A){var S=v.getField();if(!Zb(S.getAppointedDataType())){for(var na=!1,y=fb.getGroupFieldItems(),K=0;K<y.length;K++)if(y[K].getField().getFullName()===S.getFullName()){na=!0;break}na&&(t.protectedMethod.getMessageCurtain().showPrompt(Q.get("notDateTypeDuplicateSelect","\u4ec5\u201c\u65e5\u671f\u201d\u3001\u201c\u65e5\u671f\u65f6\u95f4\u201d\u7c7b\u578b\u7684\u5b57\u6bb5\u652f\u6301\u91cd\u590d\u9009\u62e9\uff0c\u5df2\u653e\u5f03\u9009\u62e9\u3002")),
v.setSelected(!1))}}v.setSelected(A)});t.setFunConfirmClose(function(A){a(A,t)});t.showSelectFieldDialog(640,480)},k=function(t){var r=[];t.forEach(function(A){var v=new Ma,S=A.clone();v.setField(S);v.setDisplayName(A.getAlias());r.push(v)});return r},a=function(t,r){if(t){var A=[];r.getArrAllFieldItems().forEach(function(y){y.getSelected()&&A.push(y)});if(0!==A.length){t=Ca===Za.GROUP?fb.copyGroupFieldItems():fb.copyAggregateFieldItems();r=[];for(var v=0;v<A.length;v++){var S=A[v],na=S.getField().clone();
S=b(na,S.getName(),Ca);r.push(S);t.push(S)}ia(t,r)}}},b=function(t,r,A){switch(A){case Za.GROUP:A=t.getOutputDataType();var v=Zb(A);A=new ba;A.setName(r);A.setDateGroup(v);A.setField(t);if(v){var S=fb.getGroupFieldItems();r=[];for(v=0;v<S.length;v++)S[v].getDateGroup()&&A.getField().getFullName()===S[v].getField().getFullName()&&r.push(S[v]);if(0===r.length)v=Ta.YEAR;else{for(v=S=0;v<r.length;v++)S=Math.max(va.indexOf(r[v].getDateGroupType()),S);S+=1;r=va.indexOf(Ta.YEAR_MONTH_DAY);v=va[S>=r?r:S]}A.setDateGroupType(v);
r={};r.dateGroupType=v;A.setDateGroupTypeMap(r);g(A);v=f(A);r.alias=v;t.setAlias(v)}return A;case Za.AGGREGATE:return A=t.getOutputDataType(),A=pb(A)?Xa.SUM:Xa.COUNT,v=new Xa,v.setName(r),v.setField(t),v.setFunctionType(A),u(v),r=E(v),S={},S.functionType=A,S.alias=r,S.calculateByDateType=null,v.setFunctionTypeMap(S),t.setAlias(r),v}},f=function(t){var r=t.getField();if(!Fa(t))return r.getAlias();r=n();return p(t,r,50)},g=function(t){if(Fa(t)&&!sb(t)){var r=l();r=p(t,r,25);B(t.getName(),r)}},l=function(t,
r){for(var A=[],v=La.getGlobal().getModelerModel().getFieldNumberMap(),S=Object.keys(v),na=0;na<S.length;na++)(!t||r||S[na]!==t.getField().getFullName())&&v[S[na]]&&A.push(v[S[na]]);return A},n=function(t,r){for(var A=[],v=0;v<L.length;v++)t&&!r&&L[v].getFullName()===t.getField().getFullName()||A.push(L[v].getAlias());v=fb.getAggregateFieldItems();r=fb.getGroupFieldItems().concat(v);for(v=0;v<r.length;v++){var S=r[v];!Fa(S)||t&&S.getName()===t.getName()||A.push(S.getField().getAlias())}return A},
p=function(t,r,A){var v=c(t.getField().getFullName(),t),S=t.getDateGroup(),na=0;if(S){t=t.getDateGroupType();var y=Ta.dateTypeTextConvert(t);na=y.length+2}v.length+na>A&&(v=v.substring(0,A-na));t=S?v+"("+y+")":v;var K=[];if(J(r,t))for(v=v.substring(0,A-3-na),t=S?v+"("+y+")":v,A=0;A<r.length;A++)v=r[A],0===v.indexOf(t)&&K.push(v);return z(K,t)},u=function(t){var r=wa.FieldNumberHelper.getFieldNumberByFullName(q.getId()+"_"+t.getName());if(sb(t))return r;for(var A=fb.getAggregateFieldItems(),v=!1,S=
0;S<A.length;S++)if(t.getName()!==A[S].getName()){if(r&&A[S].getField().getFullName()===t.getField().getFullName()&&A[S].getFunctionType()===Xa.SUM){v=!0;break}if(A[S].getField().getFullName()===t.getField().getFullName()&&A[S].getField().getAlias()===t.getField().getAlias()){v=!0;break}}r=l(t,v);r=V(t,r,25);B(t.getName(),r);return r},E=function(t){for(var r=fb.getAggregateFieldItems(),A=!1,v=0;v<r.length;v++){var S=r[v],na=S.getField();if(t.getName()!==S.getName()&&na.getFullName()===t.getField().getFullName()&&
na.getAlias()===t.getField().getAlias()){A=!0;break}}r=n(t,A);return V(t,r,50)},V=function(t,r,A){var v=c(t.getField().getFullName(),t),S=t.getFunctionType(),na=t.getCalculateByDateType(),y=I(S),K=y.length;na&&(y=I(na),K=y.length+Q.get("of","\u7684").length);v.length+K>A&&(v=v.substring(0,A-K));S=na?v+Q.get("of","\u7684")+y:v+y;t=[];if(J(r,S))for(v=v.substring(0,A-3-K),S=na?v+Q.get("of","\u7684")+y:v+y,A=0;A<r.length;A++)v=r[A],0===v.indexOf(S)&&t.push(v);return z(t,S)},J=function(t,r){for(var A=
!1,v=0;v<t.length;v++)if(t[v]===r){A=!0;break}return A},z=function(t,r){if(0<t.length){for(var A=1,v=!1;!v;){v=!1;for(var S=0;S<t.length;S++)if(t[S]===r+"_"+A){A++;v=!0;break}v=!v}r=r+"_"+A}return r},B=function(t,r,A){var v=new F;v.setName(t);v.setFromNode(q.getId());wa.FieldNumberHelper.getFieldNumberByFullName(q.getId()+"_"+t)!==r&&wa.FieldNumberHelper.generateDefaultNumberByAssignedName(v,r,A)},I=function(t){switch(t){case Xa.AVG:t=Q.get("avg_value","\u5e73\u5747\u503c");break;case Xa.MAX:t=Q.get("max_value",
"\u6700\u5927\u503c");break;case Xa.MIN:t=Q.get("min_value","\u6700\u5c0f\u503c");break;case Xa.COUNT:case Xa.DISTINCT_COUNT:t=Q.get("count","\u8ba1\u6570");break;case D.LAST_PERIOD_VALUE:t=Q.get("lastPeriodValue","\u4e0a\u671f\u503c");break;case D.LAST_PERIOD_RATIO:t=Q.get("chain","\u73af\u6bd4");break;case D.SAME_PERIOD_LAST_YEAR_VALUE:t=Q.get("samePeriodLastYearValue","\u53bb\u5e74\u540c\u671f\u503c");break;case D.SAME_PERIOD_LAST_YEAR_RATIO:t=Q.get("year_on_year_growth","\u540c\u6bd4");break;
case D.RUNNINGSUM:t=Q.get("runningSum","\u7d2f\u8ba1");break;case D.RUNNINGSUMY:t=Q.get("runningSumY","\u5e74\u5185\u7d2f\u8ba1");break;case D.RUNNINGSUMQ:t=Q.get("runningSumQ","\u5b63\u5ea6\u5185\u7d2f\u8ba1");break;case D.RUNNINGSUMM:t=Q.get("runningSumM","\u6708\u5185\u7d2f\u8ba1");break;default:t=""}return t},ia=function(t,r){for(var A={},v=0;v<t.length;v++){var S=q.getId()+"_"+t[v].getName();A[S]=wa.FieldNumberHelper.getFieldNumberByFullName(S)}ma(t,m,function(na){for(var y=0;y<r.length;y++)if(Fa(r[y])){var K=
q.getId()+"_"+r[y].getName();K=A[K];na.length===t.length?B(r[y].getName(),K):wa.FieldNumberHelper.removeFieldNumberByFullName(q.getId()+"_"+r[y].getName())}var da=fb.getMapInitFieldItem();for(y=0;y<r.length;y++)if(K=r[y].getField().getFullName(),Fa(r[y])&&(K=q.getId()+"_"+r[y].getName()),na.length===t.length){var Ba=new P;Ba.setFullName(K);Ba.setAlias(r[y].getField().getAlias());Ba.setNumber(wa.FieldNumberHelper.getFieldNumberByFullName(K));da[K]=Ba}else delete da[K];fb.setMapInitFieldItem(da);h(na)})},
aa=function(t,r){t=r.indexOf(t);0<t&&(r[t]=r.splice(t-1,1,r[t])[0],ma(r,m,h))},pa=function(t,r,A){var v=t.getJqUi(),S=v.data("menu");if(S&&S.isShowing())v.data("menu",null),S.hide();else{var na=v.outerWidth(),y=v.outerHeight(),K=Math.min(181,Math.max(na,140));S=new Pa;S.setWidth(K);S.setModel(t.createMenuModel(A));S.setHideListener(function(){v.data("menu",null)});v.data("menu",S);t=La.getGlobal().getTopJqUi();na=[na-K-2,y+3];na=Ha.upwardCoordinate(v[0],na,t[0]);S.show(t,na[0],na[1],r,!0,[0,-y-2])}},
la=function(t,r,A,v){var S=A.getFunctionType(),na=Pa.createSubMenu(Q.get("measure","\u5ea6\u91cf")+(S?"("+X(S)+")":""),!0,Q.get("measure","\u5ea6\u91cf"));S&&na.setChecked(!0);var y=A.getField().getOutputDataType(),K=[Xa.COUNT,Xa.DISTINCT_COUNT];pb(y)&&r?K=[Xa.SUM,Xa.AVG,Xa.MAX,Xa.MIN,Xa.COUNT,Xa.DISTINCT_COUNT]:Zb(y)&&r&&(K=[Xa.MAX,Xa.MIN,Xa.COUNT,Xa.DISTINCT_COUNT]);K.forEach(function(da){var Ba=X(da);Ba=Pa.createRadio(Ba,da,S===da,function(){da!==S&&$a(A,da,v)});na.addItemModel(Ba)});t.addItemModel(na);
t.addSeperator();r=Q.get("calculateByDate","\u6309\u65e5\u671f\u8ba1\u7b97");r=Pa.createSubMenu(r,!0);y=function(da){var Ba=A.getCalculateByDateType()===da,Bb=D.calculateByDateTextConvert(da);return Pa.createCheckbox(Bb,Ba,function(zb){zb=zb.isChecked()?da:null;nb(A,zb,v)})};r.addItemModel(y(D.LAST_PERIOD_VALUE));r.addItemModel(y(D.LAST_PERIOD_RATIO));r.addItemModel(y(D.SAME_PERIOD_LAST_YEAR_VALUE));r.addItemModel(y(D.SAME_PERIOD_LAST_YEAR_RATIO));r.addSeperator();r.addItemModel(y(D.RUNNINGSUM));
r.addItemModel(y(D.RUNNINGSUMY));t.addItemModel(r);t.addSeperator()},X=function(t){switch(t){case Xa.SUM:t=Q.get("sum","\u6c42\u548c");break;case Xa.AVG:t=Q.get("avg","\u5e73\u5747");break;case Xa.MAX:t=Q.get("max","\u6700\u5927");break;case Xa.MIN:t=Q.get("min","\u6700\u5c0f");break;case Xa.COUNT:t=Q.get("count","\u8ba1\u6570");break;case Xa.DISTINCT_COUNT:t=Q.get("distinct_count","\u53bb\u91cd\u8ba1\u6570");break;default:throw Error("Unknown aggregationType: "+t);}return t},$a=function(t,r,A){var v=
{};v.alias=t.getField().getAlias();v.functionType=r;ma(v,t.getFunctionTypeMap,function(S){var na=S.functionType,y=S.alias;if(vb(t,t.getFunctionTypeMap()))t.setFunctionType(na);else{var K=t.getFunctionTypeMap().functionType;K=I(K)!==I(na);t.getFunctionTypeMap().calculateByDateType&&(K=!1);var da=r!==na;t.setFunctionType(na);var Ba=E(t);K&&u(t);da&&(Ba=y);t.getField().setAlias(Ba);S.alias=Ba}R(t);S.functionType=na;S.calculateByDateType=t.getCalculateByDateType();t.setFunctionTypeMap(S);fb.setAggregateFieldItems(A)})},
nb=function(t,r,A){var v={};v.alias=t.getField().getAlias();v.calculateByDateType=r;ma(v,t.getFunctionTypeMap,function(S){var na=S.calculateByDateType,y=S.alias;if(vb(t,t.getFunctionTypeMap()))t.setCalculateByDateType(na);else{var K=t.getFunctionTypeMap().calculateByDateType;K=I(K)!==I(na);var da=r!==na;t.setCalculateByDateType(na);var Ba=E(t);K&&u(t);da&&(Ba=y);t.getField().setAlias(Ba);S.alias=Ba}R(t);S.calculateByDateType=na;S.functionType=t.getFunctionType();t.setFunctionTypeMap(S);fb.setAggregateFieldItems(A)})},
Ib=function(t,r,A){var v=r.getDateGroupType();va.forEach(function(S){var na=Ta.dateTypeTextConvert(S);na=Pa.createRadio(na,S,v===S,function(){S!==v&&Gb(r,S,A)});t.addItemModel(na)});t.addSeperator()},Gb=function(t,r,A){var v={};v.alias=t.getField().getAlias();v.dateGroupType=r;ma(v,t.getDateGroupTypeMap,function(S){var na=S.dateGroupType,y=S.alias,K=t.getDateGroupTypeMap().alias,da=n(t,!1);da=p(t,da,50);K!==da?t.setDateGroupType(na):(K=r!==na,t.setDateGroupType(na),g(t),da=f(t),K&&(da=y),t.getField().setAlias(da),
S.alias=da);R(t);S.dateGroupType=na;t.setDateGroupTypeMap(S);fb.setGroupFieldItems(A)})},vb=function(t,r){r=r.alias;for(var A=fb.getAggregateFieldItems(),v=!1,S=0;S<A.length;S++)if(t.getName()!==A[S].getName()&&A[S].getField().getFullName()===t.getField().getFullName()&&A[S].getField().getAlias()===t.getField().getAlias()){v=!0;break}A=n(t,v);t=V(t,A,50);return r!==t},sb=function(t){var r=new F;r.setFromNode(q.getId());r.setName(t.getName());return wa.FieldNumberHelper.isNumberManualModified(r)},
Rb=function(t,r){var A=fb.getGroupFieldItems(),v=fb.getAggregateFieldItems(),S=A.concat(v),na=t.getGroupByFieldItem(),y=t.getJqUi();y.hide();var K=$("<div class ='modeler-designer-selected-field-rename'>");K.insertBefore(y);var da=new Ja;t=da.getJqUi();t.appendTo(K);A=na.getField();var Ba=A.getAppointedAlias()?A.getAppointedAlias():c(A.getFullName(),na);da.setText(Ba);da.addAcceptableListener(function(Pb,mb){mb&&zb();Ub()});da.requestFocus();Ha.layoutCtrl(t,null,null,"calc(100% - 30px)",25);t.css("right",
25);t=$("<div>");t.attr("title",Q.get("reset","\u91cd\u7f6e"));t.on("click",function(Pb){Pb=[];for(var mb=0;mb<r.length;mb++)r[mb].getField().getFullName()===na.getField().getFullName()&&Pb.push(r[mb]);0<Pb.length&&(Pb=n(na,!1),Pb=(na instanceof ba?p:V)(na,Pb,50),Wb(na,Pb,r));Ub()});Oa.background(t,"reset");Ha.layoutCtrlWithLRTB(t,null,7,16,null,null,16);t.css("cursor","pointer");t.css("margin-top","5px");t.appendTo(K);var Bb=function(Pb){Ha.isDescendent(Pb.target,K[0])||(zb(),Ub())},zb=function(){var Pb=
$.trim(da.getText()),mb=/^[\u3000\u4E00-\u9FA5a-zA-Z0-9_]{1,}$/;Pb=Pb||0!==Pb.length?Pb:Ba;if(Ba!==Pb){if(0===Pb.length)var Kb=Q.get("nameIsEmpty","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a");else if(50<Pb.length)Kb=Q.get("nameTooLong","\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26");else if(Pb.match(mb)){mb=[];for(var tb=0;tb<L.length;tb++){for(var Jb=!1,Sb=L[tb],Yb=0;Yb<S.length;Yb++)S[Yb].getField().getFullName()===Sb.getFullName()&&(mb.push(S[Yb].getField()),Jb=!0);Jb||mb.push(Sb)}Jb=
!1;for(tb=0;tb<mb.length;tb++)if(mb[tb].getAlias()===Pb){Jb=!0;break}Jb&&(Kb=Q.get("duplicateName","\u540d\u79f0\u91cd\u590d"))}else Kb=Q.get("invalidFieldAlias","\u663e\u793a\u5b57\u6bb5\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210");Kb?(Kb=Q.get("modifyAbandoned","#1\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002").replace("#1",Kb),La.getGlobal().getMessageCurtain().showPrompt(Kb),da.setText(Ba)):Wb(na,Pb,r)}},Ub=function(){document.body.removeEventListener("mousedown",
Bb);K.remove();y.show()};document.body.addEventListener("mousedown",Bb)},Wb=function(t,r,A){ma(r,function(){var v=t.getField().getAppointedAlias();v||(v=c(t.getField().getFullName(),t));return v},function(v){v!==t.getField().getAlias()&&d(t,v);t.getField().setAlias(v);R(t);h(A)})},Xb=function(t,r){var A=r.indexOf(t);r.splice(A,1);var v=Fa(t),S=t.getField().getFullName(),na=!1;v&&(S=q.getId()+"_"+t.getName(),na=sb(t));var y=wa.FieldNumberHelper.getFieldNumberByFullName(S),K=t.getField().getAlias(),
da=fb.getMapInitFieldItem(),Ba=da[S];ma(r,m,function(Bb){-1!==Bb.indexOf(t)?(da[S]=Ba,t.getField().setAlias(K),Da(t,!1),v&&B(t.getName(),y,na)):(Da(t,!0),delete da[S],v&&wa.FieldNumberHelper.removeFieldNumberByFullName(S));fb.setMapInitFieldItem(da);h(Bb)})},Zb=function(t){return t===F.DT_DATE||t===F.DT_DATETIME},pb=function(t){return t===F.DT_INT||t===F.DT_NUMBER},Fa=function(t){return t instanceof Xa||t.getDateGroup()},R=function(t){var r=q.getFieldSettingConfig();r||(r=new wa.FieldSettingConfig);
var A=Fa(t),v=r.getModifiedField(),S=new F;S.setName(A?t.getName():t.getField().getName());S.setFromNode(A?q.getId():t.getField().getFromNode());S.setAlias(t.getField().getAlias());!A&&S.setAppointedDataType(ua(v,S.getFullName()));t=!1;for(A=0;A<v.length;A++)if(v[A].getFullName()===S.getFullName()){t=!0;var na=A;break}t?v.splice(na,1,S):v.push(S);r.setModifiedField(v,!0);q.setFieldSettingConfig(r)},Da=function(t,r){var A=q.getFieldSettingConfig();if(A){var v=Fa(t),S=A.getModifiedField(),na=new F;
na.setName(v?t.getName():t.getField().getName());na.setFromNode(v?q.getId():t.getField().getFromNode());na.setAlias(t.getField().getAlias());!v&&na.setAppointedDataType(ua(S,na.getFullName()));if(r)for(t=0;t<S.length;t++){if(S[t].getFullName()===na.getFullName()){S.splice(t,1);break}}else S.push(na);A.setModifiedField(S,!0);q.setFieldSettingConfig(A)}},ua=function(t,r){for(var A=0;A<t.length;A++)if(t[A].getFullName()===r)return t[A].getOutputDataType();for(A=0;A<L.length;A++)if(L[A].getFullName()===
r)return L[A].getOutputDataType();return null}}function P(){var Ca,bb,Lb;this.setFullName=function(Ua){Ca=Ua};this.getFullName=function(){return Ca};this.setNumber=function(Ua){bb=Ua};this.getNumber=function(){return bb};this.setAlias=function(Ua){Lb=Ua};this.getAlias=function(){return Lb};this.toJsonObject=function(){var Ua={};Ua.fullName=Ca;Ua.number=bb;Ua.alias=Lb;return Ua}}cb.call(this,q);var La=this.protectedMethod,ma=La.doConfigChangeAction,ra,ta,db,fb,va=[Ta.YEAR,Ta.QUARTER,Ta.MONTH,Ta.DAY,
Ta.YEAR_QUARTER,Ta.YEAR_MONTH,Ta.YEAR_MONTH_DAY],Za={GROUP:"GROUP",AGGREGATE:"AGGREGATE"};this.protectedInitUi=function(Ca){fb=q.getConfig();if(!ra&&(ra=$("<div class='modeler-designer-group-agg-container'>"),ra.appendTo(Ca),ta=new H(Za.GROUP,Q.get("groupByFields","\u5206\u7ec4\u5b57\u6bb5")),ta.setFunConfigGetterAndSetter(fb.getGroupFieldItems,fb.setGroupFieldItems),ta.getJqUi().appendTo(ra),db=new H(Za.AGGREGATE,Q.get("aggregateFields","\u6c47\u603b\u5b57\u6bb5")),db.setFunConfigGetterAndSetter(fb.getAggregateFieldItems,
fb.setAggregateFieldItems),db.getJqUi().appendTo(ra),Ca=fb.getMapInitFieldItem(),0===Object.keys(Ca).length)){var bb=fb.getGroupFieldItems().concat(fb.getAggregateFieldItems());Ca={};for(var Lb=0;Lb<bb.length;Lb++){var Ua=bb[Lb],ib=Ua.getField().getFullName();if(Ua instanceof Xa||Ua.getDateGroup())ib=q.getId()+"_"+Ua.getName();var ob=new P;ob.setFullName(ib);ob.setAlias(Ua.getField().getAlias());(Ua=wa.FieldNumberHelper.getFieldNumberByFullName(ib))&&ob.setNumber(Ua);Ca[ib]=ob}fb.setMapInitFieldItem(Ca)}};
this.protectedUpdateUi=function(){La.asynGetFields(function(Ca){var bb=fb.getGroupFieldItems(),Lb=fb.getAggregateFieldItems();ta.setFields(Ca);ta.setGroupByFieldItems(bb);ta.updatePanel();db.setFields(Ca);db.setGroupByFieldItems(Lb);db.updatePanel()})}}function ub(q){function H(){var d,e,k,a;this.getJqUi=function(){if(!d){d=$("<div>");var f=new fa;f.setText(Q.get("transposedFields","\u9700\u8981\u8f6c\u7f6e\u7684\u5b57\u6bb5"));f=f.getJqUi();Ha.layoutCtrl(f,10,7,100,15);d.append(f);f=$("<div>");f.css("border-bottom",
"1px solid #e5e5e5");e=ja.createWarning();Ha.layoutCtrlWithLRTB(e,4,null,null,null,3,null);f.append(e);e.hide();a=new fa;k=a.getJqUi();f.append(k);var g=$("<div>");g.css("cursor","pointer");g.attr("title",Q.get("editor","\u7f16\u8f91"));g.on("click",h);Oa.backgroundWithHover(g,"edit");Ha.layoutCtrlWithLRTB(g,null,0,16,0,0,16);f.append(g);Ha.layoutCtrlWithLRTB(f,115,10,null,7,null,18);d.append(f)}return d};this.showNormalSetting=function(f){e.hide();b(4,f)};this.showWarningWhenNotSetting=function(){var f=
Q.get("notExistCondition","\u672a\u8bbe\u7f6e\u9700\u8981\u8f6c\u7f6e\u7684\u5b57\u6bb5");e.show();e.attr("title",f);b(24,Q.get("notExistCondition","\u672a\u8bbe\u7f6e\u9700\u8981\u8f6c\u7f6e\u7684\u5b57\u6bb5"))};this.showWarningWhenSetting=function(f){var g=Q.get("invalidCondition","\u8f6c\u7f6e\u8bbe\u7f6e\u4e0d\u5b8c\u6574\uff0c\u8bf7\u4fee\u6539\u201c\u5217\u8f6c\u884c\u201d\u8bbe\u7f6e");e.show();e.attr("title",g);b(24,f)};var b=function(f,g){k.attr("title",g);Ha.layoutCtrlWithLRTB(k,f,20,null,
null,3,16);a.setText(g)};this.hide=function(){d&&d.hide()};this.show=function(){d&&d.show()}}cb.call(this,q);var P=this.protectedMethod,La,ma,ra,ta,db,fb=[],va=q.getConfig(),Za,Ca,bb,Lb;this.protectedInitUi=function(d){La=d;Za=new H;d=Za.getJqUi();d.appendTo(La);Ha.layoutCtrlWithLRTB(d,0,0,null,31,null,30);Ua();Y()};var Ua=function(){var d=$("<div>"),e=new fa;e.setText(Q.get("transposedAttrFieldName","\u8f6c\u7f6e\u540e\u7684\u5c5e\u6027\u5217\u540d"));e=e.getJqUi();Ha.layoutCtrl(e,10,7,100,15);d.append(e);
e=$("<div>");e.css("border-bottom","1px solid #e5e5e5");Ca=new Ja;ra=Ca.getJqUi();Ha.layoutCtrlWithLRTB(ra,0,16,null,null,3,16);ra.removeClass("sa-ctrl-common-singlelineborder");e.append(ra);Ca.addAcceptableListener(ib);Ca.addBlurListener(function(k){ib(k,!0)});Ha.layoutCtrlWithLRTB(e,115,10,null,7,null,18);d.append(e);Ha.layoutCtrlWithLRTB(d,0,0,null,62,null,30);d.appendTo(La)},ib=function(d,e){e?(d=d.getText(),ob(d,!0)?(e=va.clone(),e.setAttrFieldAlias(d),m(e)):W()):W()},ob=function(d,e){if(null==
d||""==d||0==d.length)return P.getGlobal().getMessageCurtain().showPrompt(Q.get("fieldNameIsNull","\u5b57\u6bb5\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a\u3002")),!1;if(50<d.length)return P.getGlobal().getMessageCurtain().showPrompt(Q.get("fieldNameCanNotExceedLimit","\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002")),!1;if(d){if(!d.match(/^[\s\u3000\u4E00-\u9FA5a-zA-Z0-9_]{1,}$/))return P.getGlobal().getMessageCurtain().showPrompt(Q.get("headNameComponentCheckError","\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\u3002")),
!1;var k=va.getAttrFieldAlias(),a=va.getTargetValueFieldAlia(0);if(e&&d==a||!e&&d==k)return P.getGlobal().getMessageCurtain().showPrompt(Q.get("headNameRepeatCheckError","\u5b57\u6bb5\u540d\u79f0\u5df2\u5b58\u5728\u3002")),!1;var b={};fb.forEach(function(f){b[f.getAlias()]=f});if(null!=b[d])return P.getGlobal().getMessageCurtain().showPrompt(Q.get("headNameRepeatCheckError","\u5b57\u6bb5\u540d\u79f0\u5df2\u5b58\u5728\u3002")),!1}return!0},Y=function(){var d=$("<div>"),e=new fa;e.setText(Q.get("transposedValueFieldName",
"\u8f6c\u7f6e\u540e\u7684\u503c\u5217\u540d"));e=e.getJqUi();Ha.layoutCtrl(e,10,7,100,15);d.append(e);e=$("<div>");e.css("border-bottom","1px solid #e5e5e5");bb=new Ja;ta=bb.getJqUi();Ha.layoutCtrlWithLRTB(ta,0,16,null,null,3,16);ta.removeClass("sa-ctrl-common-singlelineborder");e.append(ta);bb.addAcceptableListener(gb);bb.addBlurListener(function(k){gb(k,!0)});Lb=new fa;db=Lb.getJqUi();Ha.layoutCtrlWithLRTB(db,4,20,null,null,3,16);e.append(db);db.hide();ma=$("<div>");ma.css("cursor","pointer");ma.attr("title",
Q.get("editor","\u7f16\u8f91"));ma.on("click",h);Oa.backgroundWithHover(ma,"edit");Ha.layoutCtrlWithLRTB(ma,null,0,16,0,0,16);e.append(ma);ma.hide();Ha.layoutCtrlWithLRTB(e,115,10,null,7,null,18);d.append(e);Ha.layoutCtrlWithLRTB(d,0,0,null,93,null,30);d.appendTo(La)},gb=function(d,e){e?(d=d.getText(),ob(d,!1)?(e=va.clone(),e.setValueFieldAlias(0,d),m(e)):L()):L()};this.protectedUpdateUi=function(){P.asynGetFields(function(d){fb=d?d:[];var e=q.getFieldSettingConfig();if(e){d=q.getId();var k=va.getTargetAttrField();
k.setFromNode(d);e=e.getModifiedField();for(var a=0;a<e.length;a++)if(e[a].getFullName()==k.getFullName()){var b=k.getAlias()!=e[a].getAlias();k.setAlias(e[a].getAlias());b&&!wa.FieldNumberHelper.isNumberManualModified(k)&&wa.FieldNumberHelper.generateDefaultNumberByAssignedName(k,k.getAlias());break}k=va.getTargetValueFields();for(a=0;a<k.length;a++)for(k[a].setFromNode(d),b=0;b<e.length;b++)if(e[b].getFullName()==k[a].getFullName()){var f=k[a].getAlias()!=e[b].getAlias();k[a].setAlias(e[b].getAlias());
f&&!wa.FieldNumberHelper.isNumberManualModified(k[a])&&wa.FieldNumberHelper.generateDefaultNumberByAssignedName(k[a],k[a].getAlias());break}}d=0<va.getColumnToRowItems().length;a:{e=va.getUsedFieldNames();a=fb;k=[];for(b=0;b<a.length;b++)k.push(a[b].getFullName());for(a=0;a<e.length;a++)if(!k.includes(e[a])){e=!1;break a}e=!0}k=va.getUsedFields();a="";if(k&&0<k.length){a=k[0].getAlias();b=k[0].getFullName();for(f=0;f<fb.length;f++)b==fb[f].getFullName()&&(a=fb[f].getAlias());a=Q.get("selectedField",
"\u5df2\u9009\u62e9\u201c#1\u201d").replace("#1",a);b=Q.get("selectedNumber","\u7b49#1\u4e2a\u5b57\u6bb5").replace("#1",k.length);1<k.length&&(a+=b)}d?e?Za.showNormalSetting(a):Za.showWarningWhenSetting(a):Za.showWarningWhenNotSetting();W();L()})};var W=function(){var d=va.getAttrFieldAlias();Ca.setText(d);ra.attr("title",d)},L=function(){for(var d="",e=va.getTargetValueFieldAlias(),k=0;k<e.length;k++)d=d+e[k]+",";d=d.substr(0,d.length-1);1<e.length?(ma.show(),ta.hide(),db.show(),Lb.setText(d),db.attr("title",
d)):(ma.hide(),db.hide(),ta.show(),bb.setText(d),ta.attr("title",d))},h=function(){var d=new Ra(q);d.setConfigChangeListener(m);d.setModeler(P.getGlobal().getModelerModel());d.setFields(fb);d.initUi();d.showDialog()},m=function(d){var e=d.clone(),k=va.clone(),a=q.getId();k=k.getTargetValueFields();e=e.getTargetValueFields();for(var b=0;b<k.length;b++){k[b].setFromNode(a);for(var f=k[b].getFullName(),g=!1,l=0;l<e.length;l++)if(e[l].setFromNode(a),f==e[l].getFullName()){g=!0;break}g||wa.FieldNumberHelper.removeFieldNumberByFullName(f)}P.doConfigChangeAction(d.clone(),
va.clone,c)},c=function(d){var e=q.getId(),k=d.getTargetAttrField();k.setFromNode(e);wa.FieldNumberHelper.isNumberManualModified(k)||wa.FieldNumberHelper.generateDefaultNumberByAssignedName(k,k.getAlias());k=d.getTargetValueFields();for(var a=0;a<k.length;a++)k[a].setFromNode(e),wa.FieldNumberHelper.isNumberManualModified(k[a])||wa.FieldNumberHelper.generateDefaultNumberByAssignedName(k[a],k[a].getAlias());var b=d.clone();e=q.getFieldSettingConfig();e||(e=new wa.FieldSettingConfig,q.setFieldSettingConfig(e));
k=[];a=q.getId();var f=b.getTargetAttrField();f.setFromNode(a);k.push(f);b=b.getTargetValueFields();for(f=0;f<b.length;f++)b[f].setFromNode(a),k.push(b[f]);e.setModifiedField(k,!0);va.setTargetAttrField(d.getTargetAttrField());va.setTargetValueFields(d.getTargetValueFields());va.setColumnToRowItems(d.getColumnToRowItems());va.firePropertyChangeEvt()}}function Hb(q){N.call(this);var H=this,P=this.protectedMethod,La,ma,ra,ta,db=!1,fb,va,Za;this.setArrAllFieldItems=function(Ca){La=Ca};this.getArrAllFieldItems=
function(){if(ma)return ma.getArrFieldItems()};this.setGlobal=function(Ca){};this.setFunConfirmClose=function(Ca){ra=Ca};this.setFunClosingChecker=function(Ca){ta=Ca};this.showPrompt=function(Ca){P.getMessageCurtain().showPrompt(Ca)};this.setFunContentPaneCreator=function(Ca){Za=Ca};this.showSelectFieldDialog=function(Ca,bb){H.setSize(Ca,bb);H.setPosition(window.innerWidth-Ca>>1,window.innerHeight-bb>>1);q==Mb.SOURCE_TYPE_CURRENT_ENTITY_SOURCE?P.setTitle(Q.get("selectEntityAndField","\u9009\u62e9\u6570\u636e\u8868\u53ca\u5b57\u6bb5")):
P.setTitle(Q.get("selectField","\u9009\u62e9\u5b57\u6bb5"));P.setClosingAction(ra);P.setClosingChecker(ta);Za?(P.setContentPaneCreator(Za),H.showDialog()):(ma=new w,ma.setShowAllCheckbox(db),ma.setFunFieldCheckClick(fb),ma.setFunAllCheckboxClick(va),Ca=new sa,Ca.setType(sa.TYPE_NO_SOURCE),Ca.setText(Q.get("currentNodeNoField","\u5f53\u524d\u8282\u70b9\u6ca1\u6709\u53ef\u9009\u62e9\u7684\u5b57\u6bb5")),ma.setJqNoDataUI(Ca.getJqUi()),P.setContentPaneCreator(ma.getContentPaneCreator()),H.showDialog(),
ma.setArrFieldItems(La))};this.setShowAllCheckbox=function(Ca){db=Ca};this.setFunFieldCheckboxClickHandler=function(Ca){fb=Ca};this.setFunAllCheckboxClickHandler=function(Ca){va=Ca}}function Ea(q){function H(){var Ua,ib=[];this.getJqUi=function(){Ua||(Ua=$("<div>"),Ua.addClass("modeler-designer-sort-item-list"));return Ua};this.setSortItemPanels=function(ob){ib=ob};this.empty=function(){Ua&&Ua.empty()};this.updateUi=function(){for(var ob=$(document.createDocumentFragment()),Y=0;Y<ib.length;Y++){var gb=
ib[Y];ob.append(gb.getJqUi());gb.updateUi()}Ua.append(ob)}}function P(Ua){var ib=this,ob=new G,Y=new La(Ua),gb,W,L;this.setDestroyCallback=function(c){L=c};this.getSortItem=function(){return Ua};this.getJqUi=function(){gb||h();return gb};var h=function(){gb=$("<div>");gb.addClass("modeler-designer-sort-item-panel");var c=$("<div>");c.addClass("modeler-designer-sort-item-row-panel");var d=new fa;d.setText(Q.get("targetField","\u76ee\u6807\u5b57\u6bb5"));d=d.getJqUi();d.appendTo(c);Ha.layoutCtrl(d,
1,5,50,12);W=ja.createWarning();Ha.layoutCtrlWithLRTB(W,65,null,null,null,2,null);W.attr("title",Q.get("fieldNotExist","\u4e0d\u5b58\u5728\u7684\u5b57\u6bb5"));c.append(W);ob.setCustomPainter(function(e,k,a){a&&(k.text(a.getAlias()),k.attr("title",a.getAlias()))});ob.addSelectedChangedListener(function(e,k,a){k!=a&&(e=Ua.copy(),e.setField(a),e.initSortRule(),ra(e,ib.getSortItem,m))});ob.setDropdownAsLongAsPossible(!0);ob.getJqUi().appendTo(c);c.appendTo(gb);Y.getJqUi().appendTo(gb);c=new O;c.setText("\u00d7");
c.addActionListener(function(e){L&&L()});c=c.getJqUi();c.addClass("modeler-designer-sort-item-delete");c.appendTo(gb);return gb},m=function(c){for(var d=va.getSortItems(),e=0;e<d.length;e++)if(d[e].getTargetFieldFullName()==Ua.getTargetFieldFullName()){d[e]=c;break}Ua=c;Y.setSortItem(Ua);va.firePropertyChangeEvt()};this.updateUi=function(){var c=Lb(Ua);ob.setItemModels(c);ob.setSelected(Ua.getField());var d=65;wa.SortCheckHelper.checkOneSortItemExist(Ua,c)?W.hide():(W.show(),d=85);Ha.layoutCtrlWithLRTB(ob.getJqUi(),
d,30,null,0,null,18);Y.updateUi()}}function La(Ua){var ib,ob;this.getJqUi=function(){ib||Y();return ib};this.setSortItem=function(h){Ua=h};var Y=function(){ib=$("<div>");ib.addClass("modeler-designer-sort-item-row-panel");var h=new fa;h.setText(Q.get("order","\u6392\u5e8f\u65b9\u5f0f"));h=h.getJqUi();h.appendTo(ib);Ha.layoutCtrl(h,1,5,50,12);h=W(jb.ORDER_ASC,Q.get("orderAsc","\u5347\u5e8f"),ib);var m=h.getJqUi();Ha.layoutCtrlWithLRTB(m,65,null,50,0,null,20);m=W(jb.ORDER_DESC,Q.get("orderDesc","\u964d\u5e8f"),
ib);var c=m.getJqUi();Ha.layoutCtrlWithLRTB(c,null,24,50,0,null,20);ob=new Qa;ob.addElement(h);ob.addElement(m);ob.addChangedListener(function(d,e){d=d.getUserObject();e&&d!=Ua.getOrder()&&(d==jb.ORDER_ASC?ra(jb.ORDER_ASC,Ua.getOrder,gb):ra(jb.ORDER_DESC,Ua.getOrder,gb))});L(ob,Ua.getOrder());return ib},gb=function(h){Ua.setOrder(h);va.firePropertyChangeEvt()},W=function(h,m,c){var d=new Ia;d.setUserObject(h);d.setText(m);h=d.getJqUi();c.append(h);return d},L=function(h,m){h.toCheckTheElement(function(c){return c.getUserObject()===
m})};this.updateUi=function(){L(ob,Ua.getOrder())}}cb.call(this,q);var ma=this.protectedMethod,ra=ma.doConfigChangeAction,ta,db,fb,va,Za;this.protectedUpdateUi=function(){ma.asynGetFields(function(Ua){Ua||(Ua=[]);Za=Ua;Ua=va.getSortItems();if(Za)for(var ib=0;ib<Ua.length;ib++){for(var ob=!1,Y=Ua[ib],gb=0;gb<Za.length;gb++){var W=Za[gb];if(Y.getTargetFieldFullName()==W.getFullName()){Y.setField(W);ob=!0;break}}ob||Y.updateNotExistFieldByMyself()}Ua=va.getSortItems();ib=[];for(ob=0;ob<Ua.length;ob++)Y=
Ca(Ua[ob]),ib.push(Y);fb.empty();fb.setSortItemPanels(ib);fb.updateUi();0==Ua.length?db.css("margin-top","0px"):db.css("margin-top","-4px");db.show()})};this.protectedInitUi=function(Ua){ta=Ua;va=q.getConfig();fb=new H;Ua=fb.getJqUi();ta.append(Ua);Ua=new O;var ib=Q.get("addSortBasis","\u6dfb\u52a0\u6392\u5e8f\u4f9d\u636e");Ua.setText(ib);Ua.addActionListener(function(ob){ob=va.copySortItems();var Y=Lb();if(Y=0!=Y.length?Y[0]:null){var gb=new jb;gb.setField(Y);gb.initSortRule();ob.push(gb);Y=!0}else Y=
!1;Y?ra(ob,va.getSortItems,bb):ma.getGlobal().getMessageCurtain().showPrompt(Q.get("noFieldToAdd","\u6682\u65e0\u53ef\u6dfb\u52a0\u7684\u5b57\u6bb5\u3002"))});db=Ua.getJqUi();db.attr("title",ib);db.addClass("modeler-designer-create-sort-item");db.hide();ta.append(db)};var Ca=function(Ua){var ib=new P(Ua);ib.setDestroyCallback(function(){for(var ob=va.copySortItems(),Y=0;Y<ob.length;Y++)if(Ua.getTargetFieldFullName()==ob[Y].getTargetFieldFullName()){ob.splice(Y,1);break}ra(ob,va.getSortItems,bb)});
return ib},bb=function(Ua){va.setSortItems(Ua);va.firePropertyChangeEvt()},Lb=function(Ua){for(var ib=va.getSortItems(),ob=[],Y=0;Y<Za.length;Y++){a:{var gb=Za[Y];if(!Ua||Ua.getTargetFieldFullName()!=gb.getFullName())for(var W=0;W<ib.length;W++)if(ib[W].getTargetFieldFullName()==gb.getFullName()){gb=!1;break a}gb=!0}gb&&ob.push(Za[Y])}return ob}}function Na(q){function H(Ua){KTDefaultCellRender.call(this,Ua);var ib=this;this.paintCellUI=function(ob,Y){Y=ib.getCell().getValue();var gb=$("<div>");gb.text(Y);
gb.attr("title",Y);gb.addClass("modeler-designer-filter-item-rule-text");gb.appendTo(ob)}}function P(){var Ua,ib,ob;this.getJqUi=function(){if(!Ua){Ua=$("<div>");var gb=new fa;gb.setText(Q.get("filterCondition","\u8fc7\u6ee4\u6761\u4ef6"));gb=gb.getJqUi();Ha.layoutCtrl(gb,10,7,50,15);Ua.append(gb);gb=$("<div>");gb.css("border-bottom","1px solid #e5e5e5");ib=ja.createWarning();Ha.layoutCtrlWithLRTB(ib,0,null,null,null,3,null);gb.append(ib);ob=new fa;gb.append(ob.getJqUi());var W=$("<div>");W.css("cursor",
"pointer");W.attr("title",Q.get("editor","\u7f16\u8f91"));W.on("click",Za);Oa.backgroundWithHover(W,"edit");Ha.layoutCtrlWithLRTB(W,null,0,16,0,0,16);gb.append(W);Ha.layoutCtrlWithLRTB(gb,70,10,null,7,null,18);Ua.append(gb)}return Ua};this.showNormalSetting=function(){ib.hide();Y(0,Q.get("setAlready","\u5df2\u8bbe\u7f6e"))};this.showWarningWhenNotSetting=function(){var gb=Q.get("pleaseSetFilter","\u8bf7\u8bbe\u7f6e\u8fc7\u6ee4\u6761\u4ef6");ib.show();ib.attr("title",gb);Y(20,Q.get("notSet","\u672a\u8bbe\u7f6e"))};
this.showWarningWhenSetting=function(){var gb=Q.get("FilterSettingNotCompleted","\u8fc7\u6ee4\u6761\u4ef6\u4e0d\u5b8c\u6574\uff0c\u8bf7\u4fee\u6539\u8fc7\u6ee4\u6761\u4ef6");ib.show();ib.attr("title",gb);Y(20,Q.get("setAlready","\u5df2\u8bbe\u7f6e"))};var Y=function(gb,W){Ha.layoutCtrlWithLRTB(ob.getJqUi(),gb,null,100,null,3,16);ob.setText(W)};this.hide=function(){Ua&&Ua.hide()};this.show=function(){Ua&&Ua.show()}}cb.call(this,q);var La=this.protectedMethod,ma,ra,ta,db,fb,va;this.protectedUpdateUi=
function(){La.asynGetFields(function(Ua){Ua||(Ua=[]);va=Ua;Ua=db.getFilterItems();if(va)for(var ib=0;ib<Ua.length;ib++){var ob=!1,Y=Ua[ib];if(!Y.isEmpty()){for(var gb=0;gb<va.length;gb++){var W=va[gb];if(Y.getTargetFieldFullName()==W.getFullName()){Y.setField(W);ob=!0;break}}ob||Y.updateNotExistFieldByMyself()}}ta.show();Ua=0!=db.getNotEmptyFilterItems().length;ib=wa.FilterCheckHelper.checkFilterField(db.getNotEmptyFilterItems(),va);Ua&&!ib?ta.showNormalSetting():Ua?ta.showWarningWhenSetting():ta.showWarningWhenNotSetting();
Ua=db.getNotEmptyFilterItems();ib=0;0==Ua.length?ra.css("border",""):(ib=30*Ua.length+2,ra.css("border","1px solid #dbdbdb"));Ha.layoutCtrlWithLRTB(ra,10,10,null,68,null,ib);fb.getColumn(0).setWidth(30);fb.getColumn(1).setWidth(170);fb.getColumn(2).setWidth(30);fb.getColumn(3).setWidth(30);for(ib=fb.getRowsCount()-1;0<=ib;ib--)fb.removeRow(ib);ob=Ua.length;for(ib=0;ib<ob;ib++){gb=Ua[ib];Y=Ob.createRow(fb);Y.setUserObject(gb);W=gb.getLeftBracketCount();Y.getCell(0).setValue(Lb(!0,W));W=Y.getCell(1);
var L=W.setValue,h=gb,m=h.getField(),c=h.getCompareOp(),d=m.getAlias();switch(c){case Sa.COMPARE_EQUAL:var e=Q.get("equal","\u7b49\u4e8e");break;case Sa.COMPARE_NOT_EQUAL:e=Q.get("notEqual","\u4e0d\u7b49\u4e8e");break;case Sa.COMPARE_GREATER:e=Q.get("greater","\u5927\u4e8e");break;case Sa.COMPARE_GREATER_EQUAL:e=Q.get("equalOrGreater","\u5927\u4e8e\u7b49\u4e8e");break;case Sa.COMPARE_LESS:e=Q.get("less","\u5c0f\u4e8e");break;case Sa.COMPARE_LESS_EQUAL:e=Q.get("equalOrLess","\u5c0f\u4e8e\u7b49\u4e8e");
break;case Sa.COMPARE_INCLUDE:e=Q.get("include","\u5305\u542b");break;case Sa.COMPARE_NOT_INCLUDE:e=Q.get("notInclude","\u4e0d\u5305\u542b");break;case Sa.COMPARE_START_WITH:e=Q.get("startWith","\u5f00\u5934\u662f");break;case Sa.COMPARE_END_WITH:e=Q.get("endWith","\u7ed3\u5c3e\u662f");break;case Sa.COMPARE_NULL:e=Q.get("compareNull","\u4e3a\u7a7a");break;case Sa.COMPARE_NOT_NULL:e=Q.get("compareNotNull","\u4e0d\u4e3a\u7a7a");break;case Sa.COMPARE_IN:e=Q.get("compareIn","\u5728......\u4e4b\u5185");
break;case Sa.COMPARE_NOT_IN:e=Q.get("compareNotIn","\u4e0d\u5728......\u4e4b\u5185");break;case Sa.COMPARE_RELATIVE_DATE_RANGE:e=Q.get("relativeDateRange","\u76f8\u5bf9\u65e5\u671f");break;default:e=""}e=d+e;h=h.getDisplayValue(!0);e=Sa.isCompareOpWithinOrNotWithinValue(c)?e.replace("......",h):Sa.isCompareOpRelativeDateRangeValue(c)?m.getAlias()+Q.get("equalRelativeDateRange","\u7b49\u4e8e\uff08\u76f8\u5bf9\u65e5\u671f\uff09")+h:e+h;L.call(W,e);W=gb.getRightBracketCount();Y.getCell(2).setValue(Lb(!1,
W));W=gb.getLogicOp();Y=Y.getCell(3);gb=Y.setValue;W?(L="",W==Sa.LOGIC_AND?L=Q.get("and","\u4e14"):W==Sa.LOGIC_OR&&(L=Q.get("or","\u6216")),W=L):W=void 0;gb.call(Y,W)}Ob.refresh(fb)})};this.protectedInitUi=function(Ua){ma=Ua;db=q.getConfig();ta=new P;Ua=ta.getJqUi();ma.append(Ua);Ha.layoutCtrlWithLRTB(Ua,0,0,null,31,null,30);ta.hide();fb=Ob.createTable();ra=$(fb.getUI());ra.appendTo(ma);Ua=new H(fb);Ua.setOutsideVisible(!1);fb.setCellRender(Ua);fb.addColumns(4);fb.getColumn(0).setWidth(30);fb.getColumn(1).setWidth(170);
fb.getColumn(2).setWidth(30);fb.getColumn(3).setWidth(30);fb.setDraggableAdjusting(!1);fb.setFrozenRows(0);fb.setSyncUIWhenModelChanged(!0);fb.setColumnFitVisibleWidth(!0);fb.setScrollerVisible("hidden","auto");Ha.layoutCtrlWithLRTB(ra,10,10,null,60,null,0)};var Za=function(){var Ua=La.getGlobal().getModelerModel(),ib=Ua.getPrevNode(q),ob=new rb(q);ob.setConfigChangeListen(Ca);ob.setFromNode(ib);ob.setModelerModel(Ua);ob.showDialog();ob.updateTableUi(La.asynGetFields)},Ca=function(Ua){La.doConfigChangeAction(Ua,
db.getFilterItems,bb)},bb=function(Ua){db.setFilterItems(Ua);db.firePropertyChangeEvt()},Lb=function(Ua,ib){Ua=Ua?"(":")";for(var ob="",Y=0;Y<ib;Y++)ob+=Ua;return ob}}function xb(q){function H(){var L,h=[];this.getJqUi=function(){L||(L=$("<div class='modeler-designer-calculated-field-panel'>"));return L};this.setCalculatedFieldViewItems=function(m){h=m};this.empty=function(){L&&L.empty()};this.updateUi=function(){for(var m=$(document.createDocumentFragment()),c=0;c<h.length;c++)m.append(h[c].getJqUi());
L.append(m)}}function P(L){var h=!0,m,c,d;this.setValid=function(k){h=k};this.getValid=function(){return h};this.getJqUi=function(){m||e();return m};this.setFunEditCalculatedField=function(k){c=k};this.setFunDeleteCalculatedField=function(k){d=k};var e=function(){m=$("<div class='modeler-designer-calculated-field-item'>");var k=L.getDataType(),a=$("<div class='modeler-designer-calculated-field-item-icon'>");Oa.background(a,k);k=L.getAlias();var b=$("<div class='modeler-designer-calculated-field-item-alias'>");
b.text(k);b.attr("title",k);var f=$("<div class='modeler-designer-calculated-field-item-edit-btn'>");f.attr("title",Q.get("editCalculatedField","\u7f16\u8f91"));f.on("click",function(n){c(L)});Oa.backgroundWithHover(f,"edit");var g=$("<div class='modeler-designer-calculated-field-item-delete-btn'>");g.attr("title",Q.get("deleteCalculatedField","\u5220\u9664"));g.on("click",function(n){d(L)});Oa.backgroundWithHover(g,"delete");var l=ja.createWarning();Ha.layoutCtrlWithLRTB(l,5,null,null,null,10,null);
l.attr("title",Q.get("invalidCalculatedField","\u8ba1\u7b97\u5b57\u6bb5#1\u65e0\u6548").replace("#1",'"'+k+'"'));l.appendTo(m);a.appendTo(m);b.appendTo(m);f.appendTo(m);g.appendTo(m);h?l.hide():(a.css("margin-left","25px"),b.css("margin-left","45px"),l.show())}}cb.call(this,q);var La=this.protectedMethod,ma=La.doConfigChangeAction,ra,ta,db=[],fb=[],va=!1;this.protectedInitUi=function(L){ta=q.getConfig();ra=new H;ra.getJqUi().appendTo(L);var h=new O;h.setText(Q.get("createCalculatedFiled","\u521b\u5efa\u8ba1\u7b97\u5b57\u6bb5"));
h.addActionListener(Za);h=h.getJqUi();h.attr("title",Q.get("createCalculatedFiled","\u521b\u5efa\u8ba1\u7b97\u5b57\u6bb5"));h.addClass("modeler-designer-create-calculated-field-btn");h.appendTo(L)};var Za=function(L){if(0<db.length){var h=new Va;h.setName("F"+(new Date).getTime());h.setFromNode(q.getId());Ca(h,!1,function(){db.push(h);Lb(h)})}else{L=Q.get("upwardNodeInvalid","\u4e0a\u6e38\u8282\u70b9\u8bbe\u7f6e\u4e0d\u5b8c\u6574");var m=La.getGlobal().getNodeStatusMonitor().getInvalidState(q);m&&
(L=m.getPrompt());La.getGlobal().getMessageCurtain().showPrompt(L+Q.get("noCalculatedFieldToCreate","\uff0c\u65e0\u6cd5\u521b\u5efa\u8ba1\u7b97\u5b57\u6bb5\u3002"))}},Ca=function(L,h,m){var c=[],d=[];bb(c,d,h,L);var e,k=null,a=La.getGlobal().getRemoteImpl(),b=new Tb(a,function(f){var g=f.ok,l=f.errorPosition,n=f.errorPrompt;e=f.dataType;k(g,l,n)});b.setShowBlocking(!1);a=new Z;a.setContext(db,L,h);a.setSyntaxValidator(function(f,g,l){k=l;b.checkFormula(g,L.getSourceNodeId(),f,c,d)});a.edit(h,function(){e=
e?e:F.DT_NUMBER;L.setDataType(e);m&&m(L)})},bb=function(L,h,m,c){for(var d=0;d<db.length;d++){var e=db[d];m&&e.getFullName()===c.getFullName()||(e instanceof F?L.push(e.toJsonObject()):h.push(e.toJsonObject()))}},Lb=function(L){var h=ta.copyCalculatedFields();h.push(L);ma(h,ta.getCalculatedFields,function(m){-1!==m.indexOf(L)?gb(L):wa.FieldNumberHelper.removeFieldNumberByFullName(L.getFullName());W(m);va=!0;ta.setCalculatedFields(m)})};this.protectedUpdateUi=function(){La.asynGetFields(function(L){L||
(L=[]);var h=q.getFieldSettingConfig(),m=ta.getCalculatedFields();db=L.concat(m);if(h){h=h.getModifiedField();for(var c=0;c<m.length;c++)for(var d=m[c].getFullName(),e=0;e<h.length;e++){var k=h[e].getFullName();if(d===k){d=m[c].getAlias()!==h[e].getAlias();m[c].setAlias(h[e].getAlias());d&&gb(m[c]);va=!0;break}}}Ua(L)})};var Ua=function(L){if(va||fb!==L){var h=[],m=[];bb(h,m);var c=La.getGlobal().getRemoteImpl();c=new Tb(c,function(d){if(d=d.map){var e=ta.getCalculatedFields();ra.empty();for(var k=
[],a=0;a<e.length;a++){var b=e[a],f=d[b.getName()];if(f){var g=f.valid;b.setDataType(f.dataType);b=new P(b);b.setValid(g);b.setFunEditCalculatedField(ib);b.setFunDeleteCalculatedField(Y);k.push(b)}}ra.setCalculatedFieldViewItems(k);ra.updateUi()}});c.setShowBlocking(!1);c.checkAllFormula(h,m);fb=L;va=!1}},ib=function(L){var h=L.clone();Ca(h,!0,function(){var m=ta.getCalculatedFields().indexOf(L),c=ta.copyCalculatedFields();c.splice(m,1,h);ob(c,m)})},ob=function(L,h){ma(L,ta.getCalculatedFields,function(m){W(m);
gb(m[h]);va=!0;ta.setCalculatedFields(m)})},Y=function(L){var h=ta.copyCalculatedFields(),m=h.indexOf(L);if(-1<m){var c=wa.FieldNumberHelper.getFieldNumberByFullName(L.getFullName()),d=wa.FieldNumberHelper.isNumberManualModified(L);h.splice(m,1);ma(h,ta.getCalculatedFields,function(e){-1!==e.indexOf(L)?wa.FieldNumberHelper.generateDefaultNumberByAssignedName(L,c,d):wa.FieldNumberHelper.removeFieldNumberByFullName(L.getFullName());W(e);va=!0;ta.setCalculatedFields(e)})}},gb=function(L){wa.FieldNumberHelper.isNumberManualModified(L)||
wa.FieldNumberHelper.generateDefaultNumberByAssignedName(L,L.getAlias())},W=function(L){var h=q.getFieldSettingConfig();h||(h=new wa.FieldSettingConfig,q.setFieldSettingConfig(h));for(var m=[],c=h.getModifiedField(),d=0;d<c.length;d++)c[d].getFromNode()!=q.getId()&&m.push(c[d]);for(d=0;d<L.length;d++)m.push(L[d].clone());h.setModifiedField(m,!0)}}function yb(q){function H(){var L,h,m=[];this.getUnionConfig=function(){return L};this.setUnionConfig=function(c){L=c};this.getFieldSettingConfig=function(){return h};
this.setFieldSettingConfig=function(c){h=c};this.getFieldNumberMapItems=function(){return m};this.setFieldNumberMapItems=function(c){m=c};this.getFieldNumberMapItem=function(c){for(var d=0;d<m.length;d++)if(m[d].getFieldFullName()==c)return m[d];return null};this.copy=function(){var c=new H;c.setUnionConfig(L.clone());h&&c.setFieldSettingConfig(h.copy());c.setFieldNumberMapItems(m.slice());return c}}function P(){var L,h,m;this.getJqUi=function(){L||c();return L};this.showNormalSetting=function(){m.hide();
var d=Q.get("setAlready","\u5df2\u8bbe\u7f6e");Ha.layoutCtrlWithLRTB(h.getJqUi(),0,null,100,null,3,16);h.setText(d)};this.showWarningWhenSetting=function(){var d=Q.get("unionConfigInvalid","\u5408\u5e76\u8868\u8bbe\u7f6e\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u3002");m.show();m.attr("title",d);d=Q.get("setAlready","\u5df2\u8bbe\u7f6e");Ha.layoutCtrlWithLRTB(h.getJqUi(),20,null,100,null,3,16);h.setText(d)};this.hide=function(){L&&L.hide()};this.show=function(){L&&L.show()};var c=function(){L=
$("<div>");var d=new fa;d.setText(Q.get("union","\u5408\u5e76\u8868"));d=d.getJqUi();Ha.layoutCtrl(d,10,7,50,15);L.append(d);d=$("<div>");d.css("border-bottom","1px solid #e5e5e5");m=ja.createWarning();Ha.layoutCtrlWithLRTB(m,0,null,null,null,3,null);d.append(m);h=new fa;d.append(h.getJqUi());var e=$("<div>");e.css("cursor","pointer");e.attr("title",Q.get("editor","\u7f16\u8f91"));e.on("click",function(){var k=new La(Ca);k.setConfirmCallback(ib);k.setGlobal(db.getGlobal());k.showDialog()});Oa.backgroundWithHover(e,
"edit");Ha.layoutCtrlWithLRTB(e,null,0,16,0,0,16);d.append(e);Ha.layoutCtrlWithLRTB(d,70,10,null,7,null,18);L.append(d)}}function La(L){N.call(this);var h=this.protectedMethod,m=this,c,d={},e,k,a=L.clone();(function(){m.setSize(800,480);h.setTitle(Q.get("editUnion","\u7f16\u8f91\u5408\u5e76\u8868"));h.setSelectable(!0);h.setContentPaneCreator(function(){e=new ma(a);e.setNodeFields(d);e.setGlobal(k);var n=e.getJqUi(),p=a.getNodeItems();g(p,0);return n});h.setFooterPaneCreator(function(n){var p=new ya(Q.get("confirm",
"\u786e\u5b9a"));p.setHighlight(!0);var u=p.getJqUi();u.addClass("sa-ctrl-dialog-footer-ok");u.appendTo(n);p.addActionListener(function(E){f()&&(c&&c(a),b())});p=new ya(Q.get("cancel","\u53d6\u6d88"));p.setHighlight(!1);u=p.getJqUi();u.addClass("sa-ctrl-dialog-footer-cancel");u.appendTo(n);p.addActionListener(function(E){b()})});h.setClosingAction(function(n){b()})})();this.setConfirmCallback=function(n){c=n};this.setGlobal=function(n){k=n};var b=function(){h.destroy();e.destroy()},f=function(){if(!a)return!1;
var n=e.getUnacceptableError();if(a.checkNodeToUnionExistExceptBase()){if(a.checkUnionItemSelectEmpty())return h.getMessageCurtain().showPrompt(Q.get("noSelectedField","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b57\u6bb5\u3002")),!1;if(n)return h.getMessageCurtain().showPrompt(n.getErrorDesc()),!1}else return h.getMessageCurtain().showPrompt(Q.get("needAddTable","\u8bf7\u81f3\u5c11\u6dfb\u52a0\u4e00\u4e2a\u8868\u3002")),!1;return!0},g=function(n,p){if(n.length==p)l(),e.updateMappingPane();else{var u=
bb.getNode(n[p].getNodeId());u?wa.NodeFieldHelper.asynGetFields(bb,u,function(E){E||(E=[]);d[u.getId()]=E.slice();a.updateUnionItem(p,E);g(n,p+1)}):(a.updateUnionItem(p,[]),g(n,p+1))}},l=function(){var n=a.getNodeFields(),p=new Qb,u=a.getNodeItems();p.setNodeItems(u);for(var E=0;E<u.length;E++){var V=u[E].getNodeId(),J=d[V];if(J){var z=n[V]?n[V]:[];if(J.length!=z.length){for(var B=p,I=E,ia=[],aa=0;aa<J.length;aa++){var pa=J[aa];if(pa){for(var la=!0,X=0;X<z.length;X++)if(pa.getFullName()==z[X].getFullName()){la=
!1;break}la&&ia.push(pa)}}B.addOneNodeToUnion(V,ia,I,!1)}}}n=p.getUnionItems();for(E=0;E<n.length;E++)a.addUnionItem(n[E])}}function ma(L){function h(){var b,f,g,l;this.getJqUi=function(){b||n();return b};this.setSelectedCallback=function(B){l=B};var n=function(){b=$("<div>");var B=$("<div>");B.addClass("modeler-designer-union-node-table-list-title");B.appendTo(b);var I=$("<div>");I.addClass("modeler-designer-workarea-title-text");I.text(Q.get("selectedTable","\u5df2\u9009\u8868"));I.appendTo(B);
I=$("<div>");I.addClass("modeler-designer-workarea-title-btn");Oa.backgroundWithHover(I,"add");I.on("click",V);I.attr("title",Q.get("addTable","\u6dfb\u52a0\u6570\u636e\u8868"));I.appendTo(B);f=new hb;f.setBorderVisible(!1);f.setToggleSelectingEnabled(!1);f.setCustomItemPainter(p);f.setCustomSelectedsPainter(E);f.setItemModels(L.getNodeItemsSlice(!0));B=f.getJqUi();B.appendTo(b);Ha.layoutCtrlWithLRTB(B,0,0,null,25,0,null);B=Q.get("addTable","\u6dfb\u52a0\u6570\u636e\u8868");g=$("<div>");g.addClass("modeler-designer-union-node-table-list-text-link");
g.text(B);g.attr("title",B);g.css("cursor","pointer");g.css("color","#0E5FD8");g.on("click",function(ia){V()});g.appendTo(b);g.hide()},p=function(B,I){B.css("height","30px");B.css("cursor","pointer");var ia=$("<div>");ia.appendTo(B);ia.addClass("modeler-designer-sourcearea-icon");ia.css("top","9px");ia.css("left","12px");Oa.background(ia,"table");var aa=I.getAlias(),pa=$("<div>");pa.text(aa);pa.addClass("modeler-designer-sourcearea-name");pa.css("left","34px");pa.attr("title",aa);pa.appendTo(B);I.isExist()||
(aa=ja.createWarning(),aa.attr("title",Q.get("invalidSourcePrompt","\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664")),Ha.layoutCtrlWithLRTB(aa,12,null,null,8,null,null),aa.appendTo(B),ia.css("left","34px"),pa.css("left","56px"));var la=$("<div>");la.addClass("modeler-designer-sourcearea-delete-btn");la.on("click",function(X){L.deleteOneNodeToUnion(I.getNodeId());B.remove();u();l&&l()});Oa.backgroundWithHover(la,"delete");la.appendTo(B);la.hide();I.getNodeId()!=L.getBaseNodeItem().getNodeId()&&
(B.mouseenter(function(){la.show()}),B.mouseleave(function(){la.hide()}))},u=function(){L.checkNodeToUnionExistExceptBase()?(g.hide(),f.getJqUi().show()):(g.show(),f.getJqUi().hide())},E=function(B,I){B&&0<B.length&&(B=B[0],B.css("background-color",""),B.css("color",""));I&&0<I.length&&(I=I[0],I.css("background-color","#eff3fd"),I.css("color","rgb(130, 130, 130)"))},V=function(){var B=new ra(L);B.setGlobal(k);B.setConfirmCallback(function(I){for(var ia=L.getNodeItemsSlice(!0),aa=0;aa<ia.length;aa++){for(var pa=
ia[aa],la=pa.getNodeId(),X=!1,$a=0;$a<I.length;$a++)if(la==I[$a].getNodeId()){X=!0;break}pa.isExist()&&!X&&(L.deleteOneNodeToUnion(la),delete d[la])}J(ia,I);I=L.getNodeItemsSlice(!0);z(I,ia,0,d);u()});B.showDialog()},J=function(B,I){I.forEach(function(ia){for(var aa=!0,pa=0;pa<B.length;pa++){var la=B[pa];if(la.isExist()&&ia.getNodeId()==la.getNodeId()){aa=!1;break}}aa&&L.addNodeItem(ia)})},z=function(B,I,ia,aa){if(B.length==ia)f.setItemModels(B),l&&l();else{var pa=B[ia];if(pa.isExist()){for(var la=
0;la<I.length;la++)if(pa.getNodeId()==I[la].getNodeId()){z(B,I,ia+1,aa);return}var X=bb.getNode(pa.getNodeId());wa.NodeFieldHelper.asynGetFields(bb,X,function($a){$a||($a=[]);aa[X.getId()]=$a.slice();L.addOneNodeToUnion(X.getId(),$a,ia+1,!0);z(B,I,ia+1,aa)})}else z(B,I,ia+1,aa)}}}var m=this,c,d,e,k;this.getJqUi=function(){c||a();return c};this.getUnacceptableError=function(){return e.getUnacceptableError()};this.destroy=function(){e.destroy()};var a=function(){c=$("<div>");var b=new h;b.setSelectedCallback(function(){m.updateMappingPane()});
e=new Ka;e.setUnionConfig(L);e.setModeler(bb);e.getJqUi().addClass("modeler-designer-node-selection-right");e.setTableStyle("modeler-designer-union-node-edit-table");var f=new ca;f.setHorizontalSplit(!0);f.setEnabled(!0);f.setFirstSize(200,185,300);f.setSecondSize(565,-1,-1);f.setResizeMode(ca.RESIZE_MODE_FIRST_FIXED);f.setFirstChild(ca.createChildWrapper(b.getJqUi()));f.setSecondChild(ca.createChildWrapper(e.getJqUi()));c.append(f.getJqUi())};this.updateMappingPane=function(){e.updateSelectableNodeFields(d);
e.updateUi()};this.setNodeFields=function(b){d=b};this.setGlobal=function(b){k=b}}function ra(L){N.call(this);var h=this.protectedMethod,m=this,c,d,e;(function(){h.setTitle(Q.get("addNodeToUnion","\u6dfb\u52a0\u5408\u5e76\u8868"));h.setSelectable(!0);h.setContentPaneCreator(function(){d=new lb;d.setSelectedNodeItem(L.getNodeItemsSlice(!0,!0));var k=d,a=k.setItemModels;var b=[];for(var f=bb.getRelatedLine(q,x.GET_LINE_STRATEGY_IN),g=0;g<f.length;g++){var l=f[g].getFromId();if(l!=L.getBaseNodeItem().getNodeId()){var n=
bb.getNode(l),p=new Eb;n=wa.DisplayNameHelper.getNodeDisplayName(n);p.setAlias(n);p.setNodeId(l);b.push(p)}}f=e.getModelerModel();g=L.getBaseNodeItem();(g=f.getNode(g.getNodeId()))&&(b=b.concat(wa.UnionNodeUtil.getNodeItemsToUnion(f,g)));a.call(k,b);d.setGlobal(e);d.setMessageCurtain(h.getMessageCurtain());m.setSize(800,480);return d.getJqUi()});h.setFooterPaneCreator(function(k){var a=new ya(Q.get("confirm","\u786e\u5b9a"));a.setHighlight(!0);var b=a.getJqUi();b.addClass("sa-ctrl-dialog-footer-ok");
b.appendTo(k);a.addActionListener(function(f){c&&c(d.getSelectedNodeItem());h.destroy()});a=new ya(Q.get("cancel","\u53d6\u6d88"));a.setHighlight(!1);b=a.getJqUi();b.addClass("sa-ctrl-dialog-footer-cancel");b.appendTo(k);a.addActionListener(function(f){h.destroy()})});h.setClosingAction(function(k){})})();this.setConfirmCallback=function(k){c=k};this.setGlobal=function(k){e=k}}function ta(){Wa.call(this);var L;this.setErrorDesc=function(h){L=h};this.protectedInit=function(h,m,c){h.css("left","0px");
L?(m=ja.createWarning(),m.addClass("modeler-designer-node-selection-item-error"),m.attr("title",L),h.append(m)):(m.css("left","0px"),c.css("margin-left","22px"))}}cb.call(this,q);var db=this.protectedMethod,fb,va,Za,Ca,bb,Lb;this.protectedUpdateUi=function(){var L=Ca.getNodeItems();for(var h=wa.ModelConverter.getUpwardNode(bb,q,!0),m=!1,c=0;c<L.length;c++){for(var d=L[c],e=d.getNodeId(),k=!1,a=0;a<h.length;a++){var b=h[a];if(e==b.getId()){d.setAlias(wa.DisplayNameHelper.getNodeDisplayName(b));k=!0;
break}}d.setExist(k);m||k||(m=!0)}L=m;h=Ca.getNodeItems();Ua(h,0,L)};this.protectedInitUi=function(L){fb=L;Ca=q.getConfig();bb=db.getGlobal().getModelerModel();Za=new P;L=Za.getJqUi();fb.append(L);Ha.layoutCtrlWithLRTB(L,0,0,null,31,null,30);Za.hide();va=$("<div>");Ha.layoutCtrlWithLRTB(va,10,10,null,60,null,null);fb.append(va)};var Ua=function(L,h,m){if(L.length==h||m)W(m);else{var c=bb.getNode(L[h].getNodeId());wa.NodeFieldHelper.asynGetFields(bb,c,function(d){d||(d=[]);m=!Ca.checkFieldExist(h,
d);Ua(L,h+1,m)})}},ib=function(L){Lb=ob(Ca);for(var h=L.getSelectedUnionItem(q.getFieldSettingConfig()),m=q.getId(),c=Lb,d=0;d<h.length;d++){var e=h[d],k=new F;k.setName(e.getName());k.setFromNode(m);var a=c.getFieldNumberMapItem(k.getFullName());if(a)e=a.getNumber();else{var b=e.getBaseField().getFromNode();e=(b=bb.getNode(b))&&b.canGenerateNewField()?e.getAlias():e.getName()}a=a?a.isManualModified():!1;wa.FieldNumberHelper.generateDefaultNumberByAssignedName(k,e,a,!0)}L.setUnionItems(h);L=ob(L);
if(m=L.getFieldSettingConfig()){c=[];d=Lb.getUnionConfig().getUnionItems();for(k=0;k<d.length;k++){a=d[k];e=!1;for(b=0;b<h.length;b++)if(h[b].getName()==a.getName()){e=!0;break}e&&(e=new F,e.setName(a.getName()),e.setFromNode(q.getId()),(a=m.getModifiedFieldByFullName(e.getFullName()))&&c.push(a))}m.setModifiedField(c,!0)}db.doConfigChangeAction(L,Y,gb)},ob=function(L){var h=new H;h.setUnionConfig(L);(L=q.getFieldSettingConfig())&&h.setFieldSettingConfig(L.copy());L=bb.removeFieldNumber(q).slice();
h.setFieldNumberMapItems(L);return h},Y=function(){bb.removeFieldNumber(q);return Lb.copy()},gb=function(L){var h=L.getUnionConfig();Ca.setNodeItems(h.getNodeItems());Ca.setUnionItems(h.getUnionItems());bb.restoreFieldNumber(L.getFieldNumberMapItems());q.setFieldSettingConfig(L.getFieldSettingConfig(),!0);Lb=L;Ca.firePropertyChangeEvt()},W=function(L){Za.show();L?Za.showWarningWhenSetting():Za.showNormalSetting();va.empty();L=Ca.getNodeItems();for(var h=$(document.createDocumentFragment()),m=0;m<
L.length;m++){var c=L[m],d=new ta;c.isExist()||d.setErrorDesc(Q.get("invalidSourcePrompt","\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664"));d.setNodeItem(c);h.append(d.getJqUi())}va.append(h)}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==
typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var wa=com.kingdee.bos.qing.modeler.designer;wa.PropertyArea=function(){var q=this,H,P,La,ma,ra,ta={},db,fb=!1,va;this.getJqUi=function(){H||Za();return H};this.setNodeStatusMonitor=function(W){La&&La.removeSelectNodeListener(Ca);La&&La.removeInvalidNodeChangeListener(bb);La=W;La.addSelectNodeListener(Ca);La.addInvalidNodeChangeListener(bb)};this.setGlobal=function(W){ma=W;W=Object.keys(ta);for(var L=0;L<W.length;L++)ta[W[L]].setGlobal(ma)};
this.setModelerModel=function(W){ra&&ra.removePropertyChangeCallback(ib);ra=W;ra.addPropertyChangeCallback(ib);ta={}};this.setHideListener=function(W){db=W};this.show=function(W){fb!=!W&&(fb=!W,fb||(gb(),Lb(La.getSelected())))};var Za=function(){H=$("<div>");H.addClass("modeler-designer-workarea");H.addClass("modeler-designer-common-border");var W=$("<div>");W.addClass("modeler-designer-workarea-title");var L=$("<div>");L.addClass("modeler-designer-workarea-title-text");L.text(Q.get("properties",
"\u5c5e\u6027"));W.append(L);P=$("<div>");P.addClass("modeler-designer-workarea-container");L=$("<div>");Oa.backgroundWithHover(L,"rightArrow");Ha.layoutCtrlWithLRTB(L,null,5,16,5,null,16);L.on("click",function(){fb=!0;db&&db()});L.css("cursor","pointer");L.appendTo(W);H.append(W);H.append(P)},Ca=function(W,L){gb();fb||Lb(L)},bb=function(W){q.afterResize()},Lb=function(W){if(W){var L=Ua(W),h=L.getJqUi();Ha.layoutCtrlWithLRTB(h,0,0,null,0,0,null);P.append(h);W.getType()===M.TYPE_CUSTOM_GROUP&&L.clearCache();
L.updateUi();va=L}},Ua=function(W){if(W){var L=W.getId(),h=ta[L];h||(h=Nb.createPanel(W),h.setGlobal(ma),ta[L]=h);return h}},ib=function(W,L){if(W==x.KEY_REMOVE_NODE){W=L.getRemovedNode();var h=ta[W.getId()];h&&h.getJqUi().remove();ta[W.getId()]=void 0;(L=L.getDownwardNode())&&Y(L)}else if(W==x.KEY_LINK_NODE||W==x.KEY_ADD_NODE||W==x.KEY_BREAK_LINK)Y(L);else if(W==x.KEY_NODE_CHANGE_ALIAS)L instanceof C&&ob(L),(va instanceof qb||va instanceof yb)&&va.updateUi();else if(0==W.indexOf(x.KEY_CHANGE_TRANSFORM_CONFIG)||
W==Aa.KEY_TABLE_NODE_SELECT_FIELD)ob(L);else if(W==Aa.KEY_UPDATE_TABLE)for(W=0;W<L.length;W++)ob(L[W])},ob=function(W){va&&W&&va.getCurrentNodeId()==W.getId()&&va.updateUi()},Y=function(W){if(va){var L=ra.getNode(va.getCurrentNodeId());L&&-1<wa.ModelConverter.getUpwardNode(ra,L,!1).indexOf(W)&&va.updateUi()}},gb=function(){va=null;for(var W=Object.keys(ta),L=0;L<W.length;L++){var h=ta[W[L]];h&&h.getJqUi().detach()}};this.afterResize=function(){var W=La.getSelected();(W=Ua(W))&&W.getJqUi()&&W.updateUi()}};
wa.SelectFieldDialog=Hb;var Q,Ha,Ob,ja,fa,Ja,ea,G,O,ya,ka,ca,N,Ga,Pa,Qa,Ia,Oa,M,C,F,x,Aa,za,U,ba,Ta,Xa,D,jb,Sa,rb,Ra,Ma,qa,w,sa,Va,Ka,Wa,lb,Eb,Qb,Tb,ab,Cb,Fb,Ya,kb,Z,ha,hb,Mb;(function(){var q=com.kingdee.bos.qing.framework.common;Q=q.MultilanguageManager.createPackageAccessor(wa);q=com.kingdee.bos.qing.common;Ha=q.DomUtil;q=com.kingdee.bos.qing.common.ui;Ob=q.TableUtil;ja=q.CommonIconUtil;q=com.kingdee.bos.qing.ui.component;fa=q.Label;Ja=q.TextField;ea=q.CheckBox;G=q.ComboBox;ha=q.SearchBox;N=q.AbstractModalDialog;
Ga=q.MenuModel;Pa=q.Menu;ka=q.Spinner;hb=q.List;ca=q.SplitPane;Qa=q.RadioButtonGroup;Ia=q.RadioButton;O=q.WorkButton;ya=q.Button;Oa=wa.Icons;C=wa.TableNode;Aa=wa.ModelerModel;M=wa.Config;F=wa.Field;za=wa.ActionNodeRename;U=wa.ActionChangeConfig;x=wa.TableModeler;ab=wa.JoinConfigPanel;ba=wa.GroupFieldItem;Ta=wa.DateGroupType;Xa=wa.AggregateFieldItem;D=wa.CalculateByDateType;jb=wa.SortItem;Sa=wa.FilterItem;rb=wa.FilterConfigDialog;Z=wa.FormulaEditorDialog;Ra=wa.ColumnToRowConfigDialog;Ma=wa.FieldItemUI;
qa=wa.SelectFieldFactory;w=wa.SelectFieldPanel;Fb=wa.CustomGroupSelectFieldPanel;Cb=wa.CustomGroupFactory;Ya=wa.CustomGroupConfig;kb=wa.NumberGroupItem;sa=wa.NoDataView;Va=wa.CalculatedField;Tb=wa.DesignerFacade;Mb=wa.AbstractModelerSource;Ka=wa.UnionConfigFieldMappingPane;Wa=wa.NodeItemUi;lb=wa.UnionConfigSelectNodePane;Eb=wa.NodeItem;Qb=wa.UnionConfig})();var Nb=new function(){this.createPanel=function(q){if(q instanceof C){var H=new xa;H.setNode(q)}else q&&(H=T.createPanel(q));return H}},T=new function(){this.createPanel=
function(q){switch(q.getType()){case M.TYPE_JOIN:return new qb(q);case M.TYPE_FIELD_SELECT:return new wb(q);case M.TYPE_FIELD_SETTING:return new Ab(q);case M.TYPE_GROUP_BY:return new Db(q);case M.TYPE_CUSTOM_GROUP:return new Vb(q);case M.TYPE_SORT:return new Ea(q);case M.TYPE_FILTER:return new Na(q);case M.TYPE_COLUMN_TO_ROW:return new ub(q);case M.TYPE_CALCULATED_FIELD:return new xb(q);case M.TYPE_UNION:return new yb(q)}}}})();(function(){function oa(){var Ma,qa,w,sa,Va,Ka,Wa,lb;this.setTableArea=function(Z){};this.setGlobal=function(Z){Wa=Z};this.getGlobal=function(){return Wa};this.setRemoteImpl=function(Z){};this.setModelerModel=function(Z){qa&&qa.removePropertyChangeCallback(Tb);qa=Z;qa.addPropertyChangeCallback(Tb);Eb()};this.getJqUi=function(){if(!Ma){Ma=$("<div>");Ma.addClass("modeler-designer-workarea");Ma.addClass("modeler-designer-common-border");var Z=$("<div>");Z.addClass("modeler-designer-workarea-title");
var ha=$("<div>");ha.addClass("modeler-designer-workarea-title-text");ha.text(N.get("source","\u6570\u636e\u6e90"));Z.append(ha);ha=$("<div>");ha.addClass("modeler-designer-workarea-title-btn");rb.backgroundWithHover(ha,"add");ha.on("click",Qb);ha.attr("title",N.get("selectDataSource","\u9009\u62e9\u6570\u636e\u6e90"));ha.appendTo(Ma);w=$("<div>");w.addClass("modeler-designer-workarea-container");sa=new M;sa.setBorderVisible(!1);sa.setToggleSelectingEnabled(!1);sa.setCustomItemPainter(Cb);sa.setCustomSelectedsPainter(Fb);
sa.addSelectedChangedListener(Ya);Va=sa.getJqUi();Va.appendTo(w);ca.layoutCtrlWithLRTB(Va,0,0,null,0,0,null);Ma.append(Z);Ma.append(w);Eb()}return Ma};this.showDialogIfNoSource=function(){var Z=qa.getAllSource();if(!Z||0==Z.length){var ha=Qb();Z=new Ga;Z.setCallbackImmediately(function(){ha.updateTable()});Z.observe()}};var Eb=function(){if(qa){var Z=qa.getAllSource();sa.setItemModels(Z);if(Z&&0!=Z.length){Ka&&Ka.hide();var ha=!1,hb=sa.getSelecteds();if(hb)for(var Mb=0;Mb<hb.length;Mb++)for(var Nb=
hb[Mb],T=0;T<Z.length;T++){var q=Z[T];if(q==Nb){ha=!0;1===Z.length&&(hb.push(null),sa.setSelecteds([q]));break}}ha||sa.setSelecteds([Z[0]]);Va.show()}else Va.hide(),Ka||(Ka=$("<div>"),Ka.appendTo(Ma),Ka.addClass("modeler-designer-sourcearea-nosource"),Z=$("<div>"),Z.appendTo(Ka),rb.background(Z,"no_data_cloud"),ca.layoutCtrlCenterAlign(Z,138),ca.layoutCtrl(Z,null,0,null,78),Z=$("<div>"),Z.text(N.get("selectDataSource","\u9009\u62e9\u6570\u636e\u6e90")),Z.attr("title",N.get("selectDataSource","\u9009\u62e9\u6570\u636e\u6e90")),
Z.on("click",Qb),Z.appendTo(Ka),Z.addClass("modeler-designer-sourcearea-text-add")),Ka.show()}},Qb=function(){var Z=new xa;Z.setGlobal(Wa);Z.setSelectedCallback(ab);Z.setModeler(qa);Z.showDialog();return Z},Tb=function(Z){if(Z==Q.KEY_ADD_PREPARED_SOURCE||Z==Q.KEY_REMOVE_PREPARED_SOURCE||Z==Q.KEY_SET_PREPARED_SOURCE)console.log("update source area ui"),Eb()},ab=function(Z,ha){if(Z&&0!=Z.length||ha&&0!=ha.length){var hb=new ea;hb.setValue(Z,ha,qa);Wa.getCommandManager().perform(hb)}},Cb=function(Z,
ha){Z.css("height","30px");Z.css("cursor","pointer");var hb=ha.getSourceType();if(hb){var Mb=ha.getName();Mb||(Mb=Ra.createSourceNameByType(hb),ha.setName(Mb));Z.attr("name",Mb);var Nb=0,T=Wa.getIntegration().getMapSourcePermission();if(T)for(var q=Object.keys(T),H=0;H<q.length;H++)if(q[H]===ha.getSourceId()){q=T[q[H]];if(!q)break;T=q.errorCode;T!=oa.CURRENT_USER_NOPERMISSION_PUBLIC_SOURCE_ERRORCODE&&T!=oa.CURRENT_USER_NOPERMISSION_DATACENTER_ERRORCODE&&(Nb=Ra.createExceptionIcon(q.errorMessage),
Nb.addClass("modeler-designer-sourcearea-exception-icon"),Nb.appendTo(Z),Nb=22);Z.data("errorCode",T);break}T=$("<div>");T.addClass("modeler-designer-sourcearea-icon");T.css("top","9px");rb.background(T,Ra.getSourceIconName(hb));T.css("left",12+Nb+"px");T.appendTo(Z);T=$("<div>");T.text(Mb);T.addClass("modeler-designer-sourcearea-name");T.css("left",34+Nb+"px");T.attr("title",N.get("name","\u540d\u79f0")+"\uff1a"+Mb+"\n"+N.get("type","\u7c7b\u578b")+"\uff1a"+Ra.translateSourceType(hb));T.appendTo(Z)}else Ra.updateDeletedSourceStatus(Z);
var P=$("<div>");P.addClass("modeler-designer-sourcearea-delete-btn");P.on("mousedown",function(La){La.stopPropagation();qa.isSourceUsed(ha)?Wa.getMessageCurtain().showPrompt(N.get("theSourceIsUsed","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u6570\u636e\u8868\u6a21\u578b\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u7a97\u53e3\u5220\u9664\u8be5\u6570\u636e\u6e90\u4e0b\u7684\u8868\uff0c\u518d\u5220\u9664\u6570\u636e\u6e90\u3002")):kb().setClosingChecker(function(ma){ma==ba.RETURN_OK&&(ma=new Ja,ma.setValue(ha,
qa),Wa.getCommandManager().perform(ma),Z.is(lb)&&Hb.SourceConnectStep.removeTableTree(),Z.remove());return!0})});rb.backgroundWithHover(P,"delete");P.appendTo(Z);P.hide();Z.mouseenter(function(){P.show()}).mouseleave(function(){P.hide()})},Fb=function(Z,ha){ha&&0<ha.length&&(Z&&0<Z.length&&(Z=Z[0],Z.css("background-color",""),Z.css("color","")),ha=ha[0],ha.css("background-color","#eff3fd"),ha.css("color","rgb(130, 130, 130)"))},Ya=function(Z,ha,hb){Z=hb[0];lb=ha=sa.getItemUiByModel(Z);Hb.ConnectSourceCreator.getSourceConnector(Z,
ha).getFunConnectSource()()},kb=function(){var Z=ba.createFeedbackDialog();Z.setMsgImageType(ba.MSG_DELETE);Z.setOptionType(ba.OPTION_OK_CANCEL);Z.setMessage(N.get("confirmDeleteSource","\u786e\u5b9a\u5220\u9664\u8be5\u6570\u636e\u6e90\u5417\uff1f"));Z.showDialog();return Z}}function xa(){Qa.call(this);var Ma=this,qa=this.protectedMethod,w,sa,Va,Ka;(function(){qa.setTitle(N.get("selectDataSource","\u9009\u62e9\u6570\u636e\u6e90"));Ma.setSize(791,600);qa.setSelectable(!0);qa.setContentPaneCreator(function(){w=
new cb;w.setRemoteImpl(Hb.ModelSetSourceIntegration.getRemoteImpl());var lb=$("<div>");w.setArrExistsSource(Va.getAllSource());w.setContainer(lb);w.setMultiSelect(!0);w.loadDataSource();return lb});qa.setFooterPaneCreator(function(lb){var Eb=new Pa(N.get("confirm","\u786e\u5b9a"));Eb.setHighlight(!0);var Qb=Eb.getJqUi();Qb.addClass("sa-ctrl-dialog-footer-ok");Qb.appendTo(lb);Eb.addActionListener(function(Tb){Tb=w.getSelected();w.getTable()?Wa(Tb):qa.destroy()});Eb=new Pa(N.get("cancel","\u53d6\u6d88"));
Eb.setHighlight(!1);Qb=Eb.getJqUi();Qb.addClass("sa-ctrl-dialog-footer-cancel");Qb.appendTo(lb);Eb.addActionListener(function(Tb){qa.destroy();return!0})});qa.setClosingAction(function(lb){})})();this.setGlobal=function(lb){Ka=lb};this.updateTable=function(){var lb=$(document.body),Eb=lb.prop("clientWidth");lb=lb.prop("clientHeight");Eb=Math.max(0,Eb-791>>1);lb=Math.max(0,lb-600>>1);qa.getDialogCtrl().setBounds(Eb,lb,791,600);w.updateUiByObserver()};this.setSelectedCallback=function(lb){sa=lb};this.setModeler=
function(lb){Va=lb};var Wa=function(lb){(new (Hb.ModelSetSourceIntegration.getModelSetSourceFacade())(Hb.ModelSetSourceIntegration.getRemoteImpl(),function(Eb){for(var Qb,Tb=0,ab=0;ab<lb.length;ab++){for(var Cb=!1,Fb=0;Fb<Eb.length;Fb++)if(lb[ab].getId()==Eb[Fb].id){Cb=!0;break}Cb||(Tb++,1==Tb&&(Qb=lb[ab].getSourceName()))}if(0<Tb){w.rePaintSource(Eb);if(1<Tb){var Ya=N.get("moreSourceDeleted","\u201c#1\u201d\u7b49#N\u4e2a\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");
Ya=Ya.replace("#N",""+Tb)}else Ya=N.get("sourceDeleted","\u201c#1\u201d\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");Ya=Ya.replace("#1",Qb);qa.getMessageCurtain().showPrompt(Ya)}else{Tb=0;Eb=!0;ab=!1;Qb=[];Cb=Va.getAllSource();for(Fb=0;Fb<Cb.length;Fb++){for(var kb=Cb[Fb],Z=!1,ha=lb.length-1;0<=ha;ha--)kb.getSourceId()===lb[ha].getId()&&(Z=!0,lb.splice(ha,1));Z||(Va.isSourceUsed(kb)?(Tb++,(kb=kb.getName())?Eb&&(Eb=!1,Ya=kb):ab=!0):Qb.push(kb))}if(0<Tb)ab?Qb=
N.get("sourceIsDeleted","\u5f53\u524d\u8bbe\u8ba1\u5668\u4e2d\u5b58\u5728\u5df2\u88ab\u5220\u9664\u7684\u6570\u636e\u6e90\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u5668\u4e2d\u5220\u9664\u8be5\u6570\u636e\u6e90\uff0c\u518d\u91cd\u65b0\u9009\u62e9\u6570\u636e\u6e90\u3002"):(1<Tb?(Qb=N.get("moreSourceIsUsed","\u201c#1\u201d\u7b49#N\u4e2a\u6570\u636e\u6e90\u5df2\u88ab\u6570\u636e\u8868\u6a21\u578b\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u7a97\u53e3\u5220\u9664\u6570\u636e\u6e90\u4e0b\u7684\u8868\uff0c\u518d\u53d6\u6d88\u52fe\u9009\u6570\u636e\u6e90\u3002"),
Qb=Qb.replace("#N",""+Tb)):Qb=N.get("sourceIsUsed","\u201c#1\u201d\u6570\u636e\u6e90\u5df2\u88ab\u6570\u636e\u8868\u6a21\u578b\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u7a97\u53e3\u5220\u9664\u6570\u636e\u6e90\u4e0b\u7684\u8868\uff0c\u518d\u53d6\u6d88\u52fe\u9009\u6570\u636e\u6e90\u3002"),Qb=Qb.replace("#1",Ya)),qa.getMessageCurtain().showPrompt(Qb),w.rePaintSource();else{if(Ka.getIntegration()&&(Ya=Ka.getIntegration().getMapSourcePermission()))for(Tb=Object.keys(Ya),Eb=0;Eb<lb.length;Eb++)for(ab=
0;ab<Tb.length;ab++)if(Tb[ab]==lb[Eb].getId()){Ya[Tb[ab]]=null;break}Ya=[];for(Tb=0;Tb<lb.length;Tb++)Eb=new xb,Eb.setName(lb[Tb].getSourceName()),Eb.setSourceType(lb[Tb].getSourceType()),Eb.setId(Hb.UIDHelper.getUID(Hb.UIDHelper.NS_SOURCE)),Eb.setSourceId(lb[Tb].getId()),Eb.setModelId(Hb.ModelSetSourceIntegration.getModelId()),Ya.push(Eb);sa&&sa(Ya,Qb);qa.destroy()}}})).designerLoadSources()}}function eb(Ma,qa,w){Qa.call(this);var sa=this,Va=this.protectedMethod,Ka,Wa,lb,Eb,Qb,Tb=[],ab,Cb,Fb,Ya;
(function(){qa?Va.setTitle(N.get("EditSQL","\u7f16\u8f91SQL/KSQL")):Va.setTitle(N.get("customSQL","\u81ea\u5b9a\u4e49SQL/KSQL"));sa.setSize(590,450);Va.setSelectable(!0);var kb=function(){Va.destroy()},Z=function(){lb.setTableName(Ka.getText().trim());lb.setDisplayName(Ka.getText());var ha=new ja,hb=ab.isChecked()?"SQL":"KSQL";ha.setSqlType(hb);ha.setContent(Wa.getText());lb.setUserSql(ha);(new yb(Ma,function(Mb){for(Mb=0;Mb<Tb.length;Mb++)(0,Tb[Mb])(lb,Eb);kb()},function(Mb,Nb){Va.getMessageCurtain().showError(Nb);
return!0})).checkUserSqlExecutable(hb,Wa.getText(),Qb.getSourceId(),lb.getNamespace())};Va.setContentPaneCreator(function(){var ha=$("<div>"),hb=new Xa;hb.setText(N.get("name","\u540d\u79f0"));hb=hb.getJqUi();Ka=new D;lb.getTableName()&&Ka.setText(lb.getTableName());var Mb=Ka.getJqUi(),Nb=new Ia;ab=new Oa;ab.setText("SQL");ab.setChecked(!0);Cb=new Oa;Cb.setText("KSQL");Nb.addElement(ab);Nb.addElement(Cb);Nb=ab.getJqUi();var T=Cb.getJqUi(),q=new Xa;q.setText(N.get("SQLContent","\u5185\u5bb9"));q=q.getJqUi();
Wa=new jb;if(lb&&lb.getUserSql()){var H=lb.getUserSql();"KSQL"==H.getSqlType()&&Cb.setChecked(!0);Wa.setText(H.getContent())}H=Wa.getJqUi();ha.append(hb);ha.append(Mb);ha.append(Nb);w&&ha.append(T);ha.append(q);ha.append(H);var P=12;ca.layoutCtrl(hb,10,P,80,23);ca.layoutCtrl(Mb,90,P,420,23);ca.layoutCtrl(q,10,P+=50,80,23);ca.layoutCtrl(Nb,90,P,80,23);ca.layoutCtrl(T,170,P,80,23);ca.layoutCtrl(H,90,P+50,420,200);return ha});Va.setFooterPaneCreator(function(ha){var hb=new Pa(N.get("confirm","\u786e\u5b9a"));
hb.setHighlight(!0);var Mb=hb.getJqUi();Mb.addClass("sa-ctrl-dialog-footer-ok");Mb.appendTo(ha);hb.addActionListener(function(Nb){Nb="";var T=Ka.getText().trim(),q=Wa.getText().toLowerCase();0==T.length?Nb=N.get("nameIsEmptyPrompt","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a\u3002"):50<T.length?Nb=N.get("nameTooLongPrompt","\u540d\u79f0\u4e0d\u53ef\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002"):0<T.indexOf(" ")?Nb=N.get("nameWithSpace","\u540d\u79f0\u4e0d\u80fd\u643a\u5e26\u7a7a\u683c\u3002"):/^[\u4E00-\u9FA5A-Za-z0-9_]+$/.test(T)?
q&&""!=$.trim(q)?0!=q.trim().toLowerCase().indexOf("select")?Nb=N.get("onlyAllowSelection","\u53ea\u5141\u8bb8\u67e5\u8be2\u64cd\u4f5c\u3002"):-1==q.indexOf("from")&&-1==q.indexOf("FROM")&&(Nb=N.get("sqlError","sql\u6267\u884c\u51fa\u9519\uff0c\u8bf7\u68c0\u67e5sql\u8bed\u53e5\u3002")):Nb=N.get("noQuery","\u8bf7\u8f93\u5165\u67e5\u8be2\u8bed\u53e5\u3002"):Nb=N.get("invalidName","\u540d\u79f0\u53ea\u80fd\u4f7f\u7528\u4e2d\u6587\u3001\u6570\u5b57\u3001\u5b57\u6bcd\u6216\u4e0b\u5212\u7ebf\u3002");0<
Nb.length?Va.getMessageCurtain().showPrompt(Nb):(Nb=Ka.getText().trim(),qa?(T=Eb.getTableName(),Nb=Fb(Nb,T)):Nb=Fb(Nb,void 0),Nb?Va.getMessageCurtain().showPrompt(N.get("duplicateNameTips","\u540d\u79f0\u91cd\u590d\u3002")):Ya&&Ya(Z,kb,qa))});hb=new Pa(N.get("cancel","\u53d6\u6d88"));hb.setHighlight(!1);Mb=hb.getJqUi();Mb.addClass("sa-ctrl-dialog-footer-cancel");Mb.appendTo(ha);hb.addActionListener(function(Nb){Va.destroy();return!0})});Va.setClosingAction(function(ha){})})();this.setModel=function(kb){lb=
kb;qa&&(Eb=kb.clone())};this.getModel=function(){return lb};this.setSource=function(kb){Qb=kb};this.addConfirmListener=function(kb){Tb.push(kb)};this.setTableNameChecker=function(kb){Fb=kb};this.setPermAndConnChecker=function(kb){Ya=kb}}function cb(){function Ma(va){KTDefaultCellRender.call(this,va);var Za=this,Ca=this.paintCellUI;this.paintCellUI=function(ib,ob){var Y=Za.getCurrentRowIdx(),gb=Za.getCurrentRow(),W=Za.getCurrentColIdx();gb=gb.getUserObject();var L=new x;L.setFormatString("yyyy-MM-dd HH:mm:ss");
Za.setPaddingHV(8,1);if(Y<F.getHeadRowCount()){if(Ca(ib,ob),0===W&&1===Y){if(!ha)return;gb=Cb&&Cb.isChecked();Cb=new Aa;Cb.setChecked(gb);Cb.addCheckedListener(function(c,d){if(d){d=Object.keys(Fb);for(var e=0;e<d.length;e++)Fb[d[e]].setChecked(c.isChecked())}});gb=Cb.getJqUi();ca.layoutCtrl(gb,12,0,14,18);gb.appendTo(ib)}}else if(0===W)gb=ha?Lb(gb):Ua(gb),ca.layoutCtrl(gb,12,4,14,18),gb.appendTo(ib);else if(1===W){L=$("<div class='modeler-designer-addsource-name-info'>");Y=$("<span class='modeler-designer-addsource-cell-item-name'>");
W=gb.getSourceName();var h=gb.getErrorMessage(),m=bb(gb);h&&(h=Ra.createExceptionIcon(h),ca.layoutCtrlWithLRTB(h,5,null,16,8,null,16),h.appendTo(L),m.css("margin-left","23px"));m.appendTo(L);W||(W=gb.getSourceType(),W=Ra.createSourceNameByType(W),gb.setSourceName(W));Z&&""!=$.trim(ab.getText())?fb(Y,W,$.trim(ab.getText())):Y.text(W);Y.attr("title",W);Y.appendTo(L);L.appendTo(ib)}else 2===W?(L=$("<div class='modeler-designer-addsource-cell-item'>"),W=Ra.translateSourceType(gb.getSourceType()),Z&&""!=
$.trim(ab.getText())?fb(L,W,ab.getText()):L.text(W),L.attr("title",W),L.appendTo(ib)):3===W?(L=$("<div class='modeler-designer-addsource-cell-item'>"),gb=gb.getCreatorName(),Z&&""!=$.trim(ab.getText())?fb(L,gb,ab.getText()):L.text(gb),L.attr("title",gb),L.appendTo(ib)):4===W&&(Y=$("<div class='modeler-designer-addsource-cell-item'>"),gb=gb.getCreateTime(),gb=L.format(gb),Y.text(gb),Y.attr("title",gb),Y.appendTo(ib));Ca(ib,ob)};var bb=function(ib){var ob=$("<span>");ob.addClass("modeler-designer-addsource-source-icon");
switch(ib.getSourceType()){case Ea.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:ib="entity-source-icon";break;case Ea.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE:ib="datacenter-source-icon";break;case Ea.SOURCE_TYPE_MODEL_SET_SOURCE:ib="modelset-source-icon";break;case Ea.SOURCE_TYPE_OPEN_API_SOURCE:ib="openapi-source-icon";break;default:if(ib.getSpecificType())ib=ib.getSpecificType().toLowerCase();else throw Error("unknown type");}rb.background(ob,ib);return ob},Lb=function(ib){var ob=ib.getErrorMessage(),Y=ib.getId(),
gb=new Aa,W=!1,L=gb.getJqUi(),h=!1;if(0<kb.length)for(var m=kb.length-1;0<=m;m--)if(Y===kb[m].getSourceId()){h=W=!0;break}if(!h&&ob)return gb.setEnabled(!1),gb.setChecked(W),L;ob=Object.keys(Fb);for(h=0;h<ob.length;h++)if(Y===ob[h]){W=Fb[ob[h]].isChecked();break}Fb[Y]=gb;gb.setChecked(W);gb.setUserObject(ib);gb.addCheckedListener(function(c){c=c.isChecked();var d=Object.keys(Fb);if(c)for(var e=0;e<d.length;e++)if(!Fb[d[e]].isChecked())return;Cb.setChecked(c)});return L},Ua=function(ib){var ob=new Oa,
Y=!1,gb=ob.getJqUi();if(ib.getErrorMessage())ob.setEnabled(!1),gb.children().eq(0).css("background-color","#ddd");else{for(var W=ib.getId(),L=Object.keys(Fb),h=0;h<L.length;h++)W===L[h]&&(Y=Fb[L[h]].isChecked());Fb[W]=ob;ob.addCheckedListener(function(m,c){if(c&&m.isChecked())for(m=0;m<L.length;m++)W!=L[m]&&Fb[L[m]].setChecked(!1)})}ob.setChecked(Y);ob.setUserObject(ib);return gb}}var qa,w,sa,Va,Ka,Wa,lb,Eb,Qb,Tb,ab,Cb,Fb={},Ya=[],kb,Z=!1,ha,hb=!1;this.setMultiSelect=function(va){ha=va};this.setContainer=
function(va){Eb=va};this.setArrExistsSource=function(va){kb=va};this.getJqUi=function(){qa||db();return qa};this.setRemoteImpl=function(va){Qb=va};this.getTable=function(){return Tb};this.getSelected=function(){for(var va=Object.keys(Fb),Za=[],Ca=0;Ca<va.length;Ca++){var bb=Fb[va[Ca]];if(bb.isChecked()&&(Za.push(bb.getUserObject()),!ha))break}return Za};this.updateUiByObserver=function(){hb&&(0===Ya.length?ra():P(Ya))};this.rePaintSource=function(va){va?Mb(va):(P(Ya),ha&&ta())};var Mb=function(va){if(0==
va.length)Fb={},Ya=[],Va&&Va.css("right","15px"),Wa&&(Wa.hide(),ab.clear()),qa&&qa.remove(),ra();else{sa&&sa.hide();Wa&&Wa.show();ab&&ab.clear();Va&&Va.css("right","205px");Ya=[];Fb={};for(var Za=0;Za<va.length;Za++){var Ca=new fa;Ca.fromJsonObject(va[Za]);Ya.push(Ca)}P(Ya);ha&&ta()}},Nb=function(){Va=$("<div>");Va.attr("title",N.get("refresh","\u5237\u65b0"));rb.backgroundWithHover(Va,"refresh");Va.addClass("modeler-designer-addsource-btn-refresh");Va.on("click",T);Va.appendTo(Eb)},T=function(){(new (Hb.ModelSetSourceIntegration.getModelSetSourceFacade())(Qb,
function(va){Mb(va)})).designerLoadSources()},q=function(){Wa=$("<div>");Wa.css("display","flex");var va=$("<div class = 'modeler-designer-addsource-modelset-source-link'>");va.text(N.get("modelSetSourceManage","\u6570\u636e\u6e90\u7ba1\u7406"));va.attr("title",N.get("modelSetSourceManage","\u6570\u636e\u6e90\u7ba1\u7406"));va.on("click",function(){ya&&ya.occur(ya.BUTTON_TYPE,ya.SOURCE_MANAGE);Hb.ModelSetSourceIntegration.getDataSourceManageEntrance()()});va.appendTo(Wa);va=new U;va.setIconType(U.ICON_TYPE_QUESTION);
va.setTipsSize(380,54);var Za=va.getJqUi();Za.css("position","relative");var Ca="<span>"+N.get("sourceHelpTip","\u4ee5\u4e0b\u6570\u636e\u6e90\u662f\u5728\u5f53\u524d\u6a21\u578b\u96c6\u7684\u201c\u6570\u636e\u6e90\u7ba1\u7406\u201d\u4e2d\u5b9a\u4e49\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u5982\u679c\u9700\u8981\u5176\u4ed6\u7684\u6570\u636e\u6e90\uff0c\u8bf7\u5728\u201c\u6570\u636e\u6e90\u7ba1\u7406\u201d\u6dfb\u52a0\u3002")+"</span>";va.setTipsHtml(Ca);Za.appendTo(Wa);La();Wa.appendTo(Eb)},H=function(va){if(""===
va)Z&&(Z=!1,P(Ya));else{Z=!0;va=va.toLowerCase();for(var Za=[],Ca=0;Ca<Ya.length;Ca++){var bb=Ya[Ca],Lb=bb.getSourceName(),Ua=bb.getSourceType(),ib=Ra.translateSourceType(Ua),ob=bb.getCreatorName();Lb||(Lb=Ra.createSourceNameByType(Ua));-1==Lb.toLowerCase().indexOf(va)&&-1==ib.toLowerCase().indexOf(va)&&-1==ob.toLowerCase().indexOf(va)||Za.push(bb)}P(Za)}},P=function(va){w&&w.remove();db();if(va&&0<va.length){for(var Za=0;Za<va.length;Za++)ma(va[Za]);Ka&&Ka.hide()}else Ka?Ka.show():(Ka=$("<div>"),
Ka.addClass("modeler-designer-addsource-noresult-view-container"),va=$("<div>"),va.addClass("modeler-designer-addsource-noresult-view-icon"),rb.background(va,"search-no-result"),va.appendTo(Ka),va=$("<div>"),va.addClass("modeler-designer-addsource-noresult-view-tip"),va.text(N.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),va.appendTo(Ka),Ka.appendTo(Eb));qa.appendTo(Eb);F.refresh(Tb)},La=function(){lb||(ab=new C,ab.setShowSearchIcon(!0),ab.setPlaceholder(N.get("searchContent",
"\u8bf7\u8f93\u5165\u540d\u79f0/\u7c7b\u578b/\u521b\u5efa\u4eba")),ab.setSearchListenerDelay(1E3),ab.addSearchListener(function(){H($.trim(ab.getText()))}),lb=ab.getJqUi(),lb.find(":input").on("keydown",function(va){13==(va.keyCode||va.which||va.charCode)&&H($.trim(ab.getText()))}),lb.addClass("modeler-designer-addsource-search-box"));lb.appendTo(Wa)},ma=function(va){if(va){var Za=F.createRow(Tb,!1),Ca=new KTBorderStyle;Ca.setBottomBorderWidth(1);Ca.setBottomBorderPen("solid");Ca.setBottomBorderColor("#e5e5e5");
Za.setBorder(Ca);Za.setUserObject(va)}},ra=function(){if(sa)sa.show();else{sa=$("<div>");sa.addClass("modeler-designer-addsource-nodata-view-container");var va=$("<div>");va.addClass("modeler-designer-addsource-nodata-view-icon");rb.background(va,"no_data_cloud");va.appendTo(sa);va=$("<div>");va.addClass("modeler-designer-addsource-nodata-view-tip");va.text(N.get("pleaseCreateSource","\u8bf7\u5148\u5728\u201c\u6570\u636e\u6e90\u7ba1\u7406\u201d\u4e2d\u521b\u5efa\u6570\u636e\u6e90\u8fde\u63a5\u4fe1\u606f"));
va.appendTo(sa);va=$("<a>");va.addClass("modeler-designer-addsource-nodata-view-text");va.text(N.get("modelSetSourceManage","\u6570\u636e\u6e90\u7ba1\u7406"));va.attr("title",N.get("modelSetSourceManage","\u6570\u636e\u6e90\u7ba1\u7406"));va.on("click",function(){Hb.ModelSetSourceIntegration.getDataSourceManageEntrance()()});va.appendTo(sa);sa.appendTo(Eb);Va||Nb();Va.css("right","15px")}},ta=function(){for(var va=Object.keys(Fb),Za=0;Za<va.length;Za++)if(!Fb[va[Za]].isChecked()){Cb.setChecked(!1);
return}Cb.setChecked(!0)};this.loadDataSource=function(){(new (Hb.ModelSetSourceIntegration.getModelSetSourceFacade())(Qb,function(va){hb||(hb=!0);if(0===va.length)ra();else{db();for(var Za=0;Za<va.length;Za++){var Ca=new fa;Ca.fromJsonObject(va[Za]);Ya.push(Ca);ma(Ca)}F.refresh(Tb);ha&&ta()}})).designerLoadSources()};var db=function(){qa=$("<div class='modeler-designer-addsource-list-table'>");Tb=F.createTable();Tb.setColumnFitVisibleWidth(!0);Tb.addColumns(5);Tb.getColumn(0).setWidth(40);Tb.getColumn(1).setWidth(190);
Tb.getColumn(2).setWidth(190);Tb.getColumn(3).setWidth(95);Tb.getColumn(4).setWidth(215);Tb.setScrollerVisible("hidden");var va=F.createHeadRow(Tb);va.getCell(1).setValue(N.get("name","\u540d\u79f0"));va.getCell(2).setValue(N.get("type","\u7c7b\u578b"));va.getCell(3).setValue(N.get("creator","\u521b\u5efa\u4eba"));va.getCell(4).setValue(N.get("createTime","\u521b\u5efa\u65f6\u95f4"));va=new Ma(Tb);va.setOutsideVisible(!1);Tb.setCellRender(va);Tb.setSyncUIWhenModelChanged(!0);w=$(Tb.getUI());w.appendTo(qa);
qa.appendTo(Eb);Wa||q();Va||Nb();Va.css("right","255px")},fb=function(va,Za,Ca){if(va&&Za&&Ca){Ca=Ca.toUpperCase();for(var bb=Za.toUpperCase(),Lb=bb.split(Ca),Ua=Ca.length,ib=0;ib<Lb.length;ib++){var ob=bb.indexOf(Lb[ib]),Y=Za.substr(0,Lb[ib].length);ob+=Lb[ib].length;var gb=bb.length-ob;bb=bb.substr(ob,gb);Za=Za.substr(ob,gb);ob=$("<span>");ob.text(Y);ob.appendTo(va);ib!=Lb.length-1&&1<Lb.length&&(ob=bb.indexOf(Ca),Y=Za.substr(ob,Ua),ob+=Ua,gb=bb.length-ob,bb=bb.substr(ob,gb),Za=Za.substr(ob,gb),
ob=$("<span>"),ob.text(Y),ob.css("color","red"),ob.clone().appendTo(va))}}}}function qb(Ma){var qa,w,sa,Va=!1,Ka=[],Wa,lb,Eb,Qb=[];this.getJqUi=function(){sa||(qa=new za,qa.setRootVisible(!1),qa.setNodePainter(ab),w=kb(Ma),qa.setRoot(w),w.setExpanded(!0),w.setSelectable(!1),qa.setLineHeight(30),sa=qa.getJqUi(),ca.layoutCtrl(sa,0,1,"100%",118),qa.addSelectingListener(Tb),sa.css({top:"31px",background:"white",height:"auto",width:"100%",bottom:"30px",overflow:"hidden auto"}));return sa};var Tb=function(ha,
hb){ha=qa.searchUiByModel(hb);ha.attr("id","modeler-designer-tablearea-table-selected");ha.siblings().removeAttr("id")};this.scrollNodeToVisibleByName=function(ha){for(var hb,Mb=0;Mb<Qb.length;Mb++)Qb[Mb].getUserObject().getName()==ha&&(hb=Qb[Mb]);if(ha=qa.searchUiByModel(hb))ha.attr("id","modeler-designer-tablearea-table-selected"),ha.siblings().removeAttr("id"),document.querySelector(".sa-ctrl-tree").scrollTop=ha.prop("offsetTop")};this.updateExceptionNodeUi=function(ha,hb){for(var Mb=sa.children(),
Nb,T,q=0;q<Mb.length;q++){var H=Mb.eq(q),P=H.data("model"),La=P.getUserObject();if(P.isLeafNode()&&La.getCommentInfo()==ha){Nb=H;T=La;break}}Nb&&(ha=Nb.children().eq(0),Mb=ha.children(".modeler-designer-tablearea-table-exception-icon"),Nb=0,0<Mb.length&&Mb.remove(),(hb=Ra.getModelExceptionTips(hb))?(La.setDisableDrag(!1),Nb+=20,ha.css("margin-left","20px"),Mb=Ra.createExceptionIcon(hb),Mb.addClass("modeler-designer-tablearea-table-exception-icon"),Mb.appendTo(ha)):La.setDisableDrag(!0),T.setErrorMessage(hb),
ha.css("margin-left",Nb+"px"))};var ab=function(ha,hb){var Mb=function(P){var La=$("<div>");ca.layoutCtrlWithLRTB(La,"",0,50,0,0,16);var ma=$("<div class='modeler-designer-tablearea-table-name-edit'>");rb.backgroundWithHover(ma,"edit");ma.on("click",function(){lb&&lb(hb.getUserObject())});var ra=$("<div class='modeler-designer-tablearea-table-name-delete'>");rb.backgroundWithHover(ra,"delete");ra.on("click",function(){Eb&&Eb(hb.getUserObject(),ra)});T.getErrorMessage()&&(ma.css("right","72px"),ra.css("right",
"34px"));ma.appendTo(La);ra.appendTo(La);La.appendTo(P);La.hide();P.on("mouseenter",function(){La.show();T.getErrorMessage()?q.css("right","90px"):q.css("right","70px")});P.on("mouseleave",function(){La.hide();T.getErrorMessage()?q.css("right","50px"):q.css("right","30px")})},Nb=20*hb.getLevel();ha.css("padding-left","4px");ha.css("padding-right","4px");ha.css("width","calc(100% - "+Nb+"px)");var T=hb.getUserObject(),q=$("<div>");q.addClass("modeler-designer-tablearea-table-name");q.text(T.getDisplayName());
q.attr("title",T.getDisplayName());q.appendTo(ha);if(hb.isLeafNode()){Nb=$("<div>");Nb.addClass("modeler-designer-tablearea-table-icon");var H=T.getUserSql()?T.getUserSql().getSqlType():"entity"==T.getType()?"entity-sub":"table";rb.background(Nb,H);Nb.appendTo(ha);ha.css("overflow","");T.getErrorMessage()&&(ha.css("margin-left","20px"),Nb=Ra.createExceptionIcon(T.getErrorMessage()),Nb.addClass("modeler-designer-tablearea-table-exception-icon"),Nb.appendTo(ha));T.getUserSql()&&(Mb(ha),Qb.push(hb))}};
this.doSearch=function(ha){Wa&&Wa.hide();if(""===ha)Va&&(Ya(),Fb(),qa.setRoot(w),Va=!1);else if(sa){ha=ha.toLowerCase();Va&&Fb();var hb=kb(Ma);hb.deepFirstVisiting(function(Mb){var Nb=Mb.getUserObject().getDisplayName();if(Nb&&-1!=Nb.toLowerCase().indexOf(ha))for(Mb=Mb.getTreePath(),Nb=0;Nb<Mb.length;Nb++){var T=Mb[Nb];!T.isLeafNode()&&Mb[Nb+1]&&T.setExpanded(!0);T=T.getUserObject();T.setMatch(!0);Ka.push(T)}},!1);Cb(hb);qa.setRoot(hb);0===Ka.length&&(Wa=$("<div>"),Wa.text(N.get("noSearchResult",
"\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),Wa.addClass("modeler-designer-tablearea-noresult-tip"),Wa.appendTo(sa));Va=!0}};var Cb=function(ha){if(ha.isExpanded())for(var hb=ha.getAllChildren(),Mb=0;Mb<hb.length;Mb++){var Nb=hb[Mb];Nb.getUserObject().getMatch()?Nb.isLeafNode()||Cb(Nb):ha.removeChild(Nb)}},Fb=function(){if(0<Ka.length)for(var ha=0;ha<Ka.length;ha++)Ka[ha].setMatch(!1);Ka=[]},Ya=function(){w.deepFirstVisiting(function(ha){ha!=w&&(ha.isLeafNode()||ha.setExpanded(!1))},
!1)};this.setUserSqlDeleteListener=function(ha){Eb=ha};this.setUserSqlEditListener=function(ha){lb=ha};var kb=function(ha){var hb=new za.BranchNode;hb.setUserObject(ha);if((ha=ha.getChildren())&&0<ha.length)for(var Mb=0;Mb<ha.length;Mb++){var Nb=ha[Mb];if(Nb instanceof wa){var T=hb;Nb=Nb.getChildren()?kb(Nb):Z(Nb);T.addChild(Nb)}else hb.addChild(Z(Nb))}return hb},Z=function(ha){var hb=new za.LeafNode;hb.setUserObject(ha);return hb};this.setSelectedNode=function(){}}function wb(Ma){var qa,w,sa,Va,
Ka,Wa=!1,lb=[],Eb=[],Qb;this.setUserSqlDeleteListener=function(Ya){Ka=Ya};this.setUserSqlEditListener=function(Ya){Va=Ya};var Tb=function(){var Ya=Wa?lb:Ma.getChildren();qa.getJqUi().empty();qa.setItemCount(Ya.length);qa.setItemUiCreator(ab);qa.repaint()},ab=function(Ya){var kb=function(Nb){var T=$("<div>");ca.layoutCtrlWithLRTB(T,"",0,50,0,0,16);var q=$("<div class='modeler-designer-tablearea-table-name-edit'>");rb.backgroundWithHover(q,"edit");q.on("click",function(){Va&&Va(Z)});var H=$("<div class='modeler-designer-tablearea-table-name-delete'>");
rb.backgroundWithHover(H,"delete");H.on("click",function(){Ka&&Ka(Z,H)});Z.getErrorMessage()&&(q.css("right","72px"),H.css("right","34px"));q.appendTo(T);H.appendTo(T);T.appendTo(Nb);T.hide();Nb.on("mouseenter",function(){T.show();Z.getErrorMessage()?hb.css("right","90px"):hb.css("right","70px")});Nb.on("mouseleave",function(){T.hide();Z.getErrorMessage()?hb.css("right","50px"):hb.css("right","30px")})},Z=(Wa?lb:Ma.getChildren())[Ya],ha=$("<div class='modeler-designer-tablearea-dbCenter-item'>");
ha.css("padding-left","4px");ha.css("padding-right","4px");ha.css("height","30px");ha.css("width","calc(100% - 10px)");ha.data("model",Z);ha.on("click",function(){Cb(ha)});ha.on("mouseenter",function(){ha.addClass("modeler-designer-tablearea-dbCenter-table-hover")});ha.on("mouseleave",function(){ha.removeClass("modeler-designer-tablearea-dbCenter-table-hover")});var hb=$("<div>");hb.addClass("modeler-designer-tablearea-dbCenter-table-name");hb.text(Z.getDisplayName());hb.attr("title",Z.getDisplayName());
hb.appendTo(ha);Ya=$("<div class='modeler-designer-tablearea-dbCenter-table-icon'>");var Mb=Z.getUserSql()?Z.getUserSql().getSqlType():"table";rb.background(Ya,Mb);Ya.appendTo(ha);ha.css("overflow","");Z.getErrorMessage()&&(ha.css("margin-left","20px"),Ya=Ra.createExceptionIcon(Z.getErrorMessage()),Ya.addClass("modeler-designer-tablearea-dbCenter-table-exception-icon"),Ya.appendTo(ha));Z.getUserSql()&&kb(ha);return ha},Cb=function(Ya){for(var kb=0;kb<Eb.length;kb++)Eb[kb].removeClass("modeler-designer-tablearea-table-selected");
Eb=[Ya];Ya.addClass("modeler-designer-tablearea-table-selected")};this.setSelectedNode=function(Ya){if(Ya){Ya=Ya.getDisplayName();for(var kb=qa.getPaintedItems(),Z=0;Z<kb.length;Z++){var ha=kb[Z],hb=ha.data("model");if(hb&&hb.getDisplayName()===Ya){Cb(ha);break}}}};var Fb=function(Ya,kb){for(var Z=0;Z<Ya.length;Z++){var ha=Ya[Z];if(ha.getDisplayName()===kb)return ha}};this.updateExceptionNodeUi=function(Ya,kb){kb=Ra.getModelExceptionTips(kb);for(var Z=qa.getPaintedItems(),ha,hb,Mb=0;Mb<Z.length;Mb++){var Nb=
Z[Mb],T=Nb.data("model");if(T&&T.getDisplayName()===Ya){ha=Nb;hb=T;break}}ha?ha&&(Ya=ha.children(".modeler-designer-tablearea-dbCenter-table-exception-icon"),Z=0,0<Ya.length&&Ya.remove(),kb&&(Z+=20,ha.css("margin-left","20px"),Ya=Ra.createExceptionIcon(kb),Ya.addClass("modeler-designer-tablearea-dbCenter-table-exception-icon"),Ya.appendTo(ha)),hb.setErrorMessage(kb),ha.css("margin-left",Z+"px")):(ha=Ma.getChildren(),(hb=Fb(ha,Ya))&&hb.setErrorMessage(kb))};this.scrollNodeToVisibleByName=function(Ya){var kb=
Wa?lb:Ma.getChildren(),Z=Fb(kb,Ya);if(Z)for(kb=30*kb.indexOf(Z),qa.repaint(kb),kb=qa.getPaintedItems(),Z=0;Z<kb.length;Z++){var ha=kb[Z],hb=ha.data("model");if(hb&&hb.getDisplayName()===Ya){Cb(ha);break}}};this.setSearchClearCallBack=function(Ya){Qb=Ya};this.doSearch=function(Ya){Ya=$.trim(Ya).toLowerCase();sa&&sa.hide();var kb=Ma.getChildren();if(0===Ya.length)Wa=!1,Tb();else{Wa=!0;lb=[];for(var Z=0;Z<kb.length;Z++){var ha=kb[Z],hb=ha.getDisplayName();hb&&-1!==hb.toLowerCase().indexOf(Ya)&&lb.push(ha)}Tb();
0===lb.length&&(sa=$("<div>"),sa.text(N.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),sa.addClass("modeler-designer-tablearea-noresult-tip"),sa.appendTo(w))}};this.getJqUi=function(){w||(qa=new Sa,qa.setItemHeight(30),w=qa.getJqUi(),ca.layoutCtrlWithLRTB(w,0,0,"100%",0,30,null),w.addClass("modeler-designer-tablearea-dbCenter"),Qb&&Qb(),Tb());return w}}function Ab(){var Ma,qa,w=Hb.SourceConnectStep.getExeSourceChangeCallback(),sa=function(){Hb.SourceConnectStep.clearTableAreaSearchBox();
var Va=Ma.data("errorCode");Va?w&&w(qa,Va):Hb.SourceConnectStep.checkSourceConnectivity(qa,Ma)};this.setJqItem=function(Va){Ma=Va};this.getJqItem=function(){return Ma};this.setSource=function(Va){qa=Va};this.getSource=function(){return qa};this.getFunConnectSource=function(){return sa};this.protectedMethod={setFunConnectSource:function(Va){sa=Va},getFunFailCallback:function(){return w}}}function Vb(){Ab.call(this)}function Db(){Ab.call(this);var Ma=this;this.protectedMethod.setFunConnectSource(function(){Hb.SourceConnectStep.checkModelSetSourceConnect(Ma.getSource(),
Ma.getJqItem());Hb.SourceConnectStep.clearTableAreaSearchBox()})}function ub(){Ab.call(this);var Ma=this.protectedMethod,qa=this;Ma.setFunConnectSource(function(){Hb.SourceConnectStep.clearTableAreaSearchBox();Ma.getFunFailCallback()(qa.getSource(),oa.SOURCE_EXCEPTION_DELETED_ERRORCODE)})}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==
typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var Hb=com.kingdee.bos.qing.modeler.designer;Hb.SourceArea=oa;Hb.TableArea=function(){var Ma,qa,w,sa,Va,Ka,Wa,lb,Eb,Qb,Tb,ab,Cb,Fb,Ya,kb,Z,ha,hb,Mb,Nb,T,q,H={};this.getSearchBox=function(){return lb};this.getJqTableTree=function(){return Qb};this.setTableNodeCreator=function(c){q=c};this.setGlobal=function(c){Ka=c};this.setRemoteImpl=
function(c){sa=c};this.setDragHandler=function(c){Va=c};this.updateNodeStatus=function(c,d){Eb&&Eb.updateExceptionNodeUi(c,d)};this.getJqUi=function(){if(!Ma){Ma=$("<div>");Ma.addClass("modeler-designer-workarea");Ma.addClass("modeler-designer-common-border");ab=$("<div>");ab.addClass("modeler-designer-workarea-title");Tb=$("<span>");Tb.addClass("modeler-designer-tablearea-title-text");Tb.text(N.get("table","\u8868"));ab.append(Tb);qa=$("<div>");qa.addClass("modeler-designer-workarea-container");
var c=$("<div>"),d=$("<div>");d.text(N.get("customSQL","\u81ea\u5b9a\u4e49SQL/KSQL"));d.attr("title",N.get("customSQL","\u81ea\u5b9a\u4e49SQL/KSQL"));var e=$("<div>");rb.backgroundWithHover(e,"add");c.append(d);c.append(e);ca.layoutCtrlWithLRTB(c,0,0,null,null,0,25);ca.layoutCtrlWithLRTB(d,5,null,170,5,0,18);ca.layoutCtrlWithLRTB(e,null,0,18,5,0,18);ca.makeTextOmissible(d);c.css({"border-top":"1px solid #e5e5e5"});e.css({cursor:"pointer"});e.on("click",La);T=c;T.hide();qa.append(T);qa.appendTo(Ma);
Za();Ma.append(ab)}return Ma};this.setSource=function(c){c&&c!=w&&(w=c);H[c]=void 0;ob()};this.setExceptionSource=function(c,d){kb=new Date;c&&c!=w&&(w=c);H[w]=d;W();Qb&&Qb.remove();ha&&ha.hide();ib(c,d)};var P=function(c,d){Qb&&Qb.remove();d?(Eb=new wb(c),Eb.setSearchClearCallBack(function(){lb&&lb.clear()})):Eb=new qb(c);Eb.setUserSqlDeleteListener(db);Eb.setUserSqlEditListener(ra);Qb=Eb.getJqUi();Qb.appendTo(qa);L(!1)},La=function(){if(H[w])return ma(H[w],!1),!0;if(h()&&!hb.getSelectPair())Ka.getMessageCurtain().showPrompt(N.get("chooseAppWarn",
"\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u5e94\u7528\u3002"));else{var c=new yb(sa,function(e){var k=new Ob;k.setSourceUid(w.getId());var a=Hb.UIDHelper.getUID(Hb.UIDHelper.NS_TABLE);k.setUid(a);h()&&k.setNamespace(hb.getSelectPair().value);e=new eb(sa,!1,e);e.setModel(k);e.setSource(w);e.setTableNameChecker(Ca);e.setPermAndConnChecker(ta);e.addConfirmListener(function(b,f){var g=Ka.getModelerModel(),l=new G;l.setValue(b,f,g,Ua);Ka.getCommandManager().perform(l);Ka.getMessageCurtain().showSuccess(N.get("CreateSQLSuccess",
"\u65b0\u5efa\u81ea\u5b9a\u4e49SQL\u6210\u529f\u3002"))});e.showDialog()},function(e){ma(e+"",!1);return!0});if(hb&&hb.getSelectPair())var d=hb.getSelectPair().value;c.checkKSQLSupport(w.getSourceId(),d)}},ma=function(c,d){switch(c){case oa.PUBLIC_SOURCE_IS_DELETED_ERRORCODE:case oa.SOURCE_CONNECT_FAILED_ERRORCODE:case oa.SOURCE_EXCEPTION_DELETED_ERRORCODE:case oa.SOURCE_EXCEPTION_DELETED_ERRORCODE_1:d?Ka.getMessageCurtain().showPrompt(N.get("editSQLWithoutSource","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7f16\u8f91\u81ea\u5b9a\u4e49SQL/KSQL\u3002")):
Ka.getMessageCurtain().showPrompt(N.get("createSQLWithoutSource","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u65b0\u5efa\u81ea\u5b9a\u4e49SQL/KSQL\u3002"));break;default:d?Ka.getMessageCurtain().showPrompt(N.get("editWithoutPerm","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u65e0\u6cd5\u7f16\u8f91\u81ea\u5b9a\u4e49SQL/KSQL\u3002")):Ka.getMessageCurtain().showPrompt(N.get("createWithoutPerm","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u65e0\u6cd5\u65b0\u5efa\u81ea\u5b9a\u4e49SQL/KSQL\u3002"))}},
ra=function(c){if(H[w]||c.getErrorMessage())return ma(H[w],!0),!0;var d=new yb(sa,function(k){var a=new Ob;a.setSourceUid(w.getId());a.setTableName(c.getName());a.setUserSql(c.getUserSql());h()&&a.setNamespace(c.getCommentInfo());a=Ka.getModelerModel().getSameTable(a).clone();k=new eb(sa,!0,k);k.setModel(a);k.setSource(w);k.setTableNameChecker(Ca);k.setPermAndConnChecker(ta);k.addConfirmListener(function(b,f){var g=Ka.getModelerModel(),l=new G;l.setValue(b,f,g,Ua);Ka.getCommandManager().perform(l);
Ka.getMessageCurtain().showSuccess(N.get("EditSQLSuccess","\u7f16\u8f91\u81ea\u5b9a\u4e49SQL\u6210\u529f\u3002"))});k.showDialog()},function(k){ma(k+"",!0);return!0});if(hb&&hb.getSelectPair())var e=hb.getSelectPair().value;d.checkKSQLSupport(w.getSourceId(),e)},ta=function(c,d,e){var k=N.get("createWithoutPerm","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u65e0\u6cd5\u65b0\u5efa\u81ea\u5b9a\u4e49SQL/KSQL\u3002");e&&(k=N.get("editWithoutPerm","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u65e0\u6cd5\u7f16\u8f91\u81ea\u5b9a\u4e49SQL/KSQL\u3002"));
(new yb(sa,function(a){a?c():(d(),Ka.getMessageCurtain().showPrompt(k))},function(){d();Ka.getMessageCurtain().showPrompt(k);return!0})).checkUserSqlSourcePermission(w.getSourceId())},db=function(c,d){var e=new Ta;e.setText(N.get("ConfirmDeleteSQL","\u786e\u5b9a\u5220\u9664\u8be5\u81ea\u5b9a\u4e49SQL\u5417\uff1f"));e.setConfirmedListener(function(k){if(k){k=new Ob;k.setSourceUid(w.getId());k.setTableName(c.getName());k.setUserSql(c.getUserSql());h()&&k.setNamespace(c.getCommentInfo());var a=Ka.getModelerModel();
if(a.isUserSqlTableInUse(k))Ka.getMessageCurtain().showPrompt(N.get("customSQLUsedInDesign","\u8be5\u81ea\u5b9a\u4e49SQL/KSQL\u5df2\u88ab\u6570\u636e\u8868\u6a21\u578b\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u7a97\u53e3\u5220\u9664\u3002"));else{var b=new O;b.setValue(k,a,Ua);Ka.getCommandManager().perform(b);Ka.getMessageCurtain().showSuccess(N.get("DeleteSQLSuccess","\u5220\u9664\u81ea\u5b9a\u4e49SQL\u6210\u529f\u3002"))}}});e.show(d,!1)},fb=function(){ha&&ha.hide();Wa&&Wa.hide();Fb&&Fb.hide();
Qb&&Qb.remove();L(!0);if(Ya)va(),Ya.show();else{Ya=$("<div>");Ya.addClass("modeler-designer-tablearea-notable-view");Ya.appendTo(qa);var c=$("<div>");rb.background(c,"no_data_cloud");c.addClass("modeler-designer-tablearea-notable-icon");c.appendTo(Ya);Mb=$("<div>");Mb.addClass("modeler-designer-tablearea-notable-text");va();Mb.appendTo(Ya)}},va=function(){switch(w.getSourceType()){case Ea.SOURCE_TYPE_MODEL_SET_SOURCE:Mb.text(N.get("noModelTip","\u6682\u65e0\u53ef\u7528\u7684\u6a21\u578b"));break;
default:Mb.text(N.get("noTableTip","\u6682\u65e0\u53ef\u7528\u7684\u6570\u636e\u8868"))}},Za=function(){Wa||(lb=new C,lb.setSearchListenerDelay(1E3),lb.addSearchListener(function(){Eb&&Eb.doSearch($.trim(lb.getText()),function(){lb.clear()})}),lb.setShowSearchIcon(!0),lb.setPlaceholder(N.get("searchTable","\u8bf7\u8f93\u5165\u641c\u7d22\u5185\u5bb9")),Wa=lb.getJqUi(),Wa.addClass("modeler-designer-tablearea-search-box"),Wa.find(":input").on("keydown",function(c){13==(c.keyCode||c.which||c.charCode)&&
Eb&&Eb.doSearch($.trim(lb.getText()))}));Wa.appendTo(qa)},Ca=function(c,d){for(var e=bb(),k=[],a=0;a<e.length;a++)k.push(e[a].getName());d&&k.splice(k.indexOf(d),1);return-1<k.indexOf(c)},bb=function(){for(var c=Ka.getModelerModel().getUserSqlTables(w.getId()),d=[],e=0;e<c.length;e++){var k=c[e];if(!h()||hb.getSelectPair()&&hb.getSelectPair().value&&k.getNamespace()==hb.getSelectPair().value){var a=new Na;a.setName(k.getTableName());a.setDisplayName(k.getTableName());a.setUserSql(k.getUserSql());
a.setCommentInfo(k.getNamespace());d.push(a)}}return d},Lb=function(c){for(var d=bb(),e=0;e<d.length;e++)c.getChildren().push(d[e])},Ua=function(c){Qb&&Qb.remove();var d=H[w];if(d)ib(w,d);else{0<$.trim(lb.getText()).length&&lb.clear();d=new wa;var e=h();e?hb.getSelectPair()&&hb.getSelectPair().value&&d.fromJsonObject(Nb,hb.getSelectPair().value):d.fromJsonObject(Nb);Lb(d);P(d,e);Va.bindDragUi(Qb,m);e&&Qb.css("top","65px");c&&Eb.scrollNodeToVisibleByName(c.getTableName())}},ib=function(c,d){for(var e=
h(),k=Ka.getModelerModel().getAllTable(),a=[],b=0;b<k.length;b++)c.getId()===k[b].getSourceUid()&&a.push(k[b]);if(a&&0<a.length){switch(d){case oa.SOURCE_EXCEPTION_DELETED_ERRORCODE:var f=N.get("tableNotExist","\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664");break;case oa.PUBLIC_SOURCE_IS_DELETED_ERRORCODE:case oa.PUBLIC_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:case oa.DATACENTER_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:case oa.SOURCE_CONNECT_FAILED_ERRORCODE:f=N.get("tableCanNotUse","\u8be5\u6570\u636e\u6e90\u4e0b\u7684\u8868\u5747\u65e0\u6cd5\u4f7f\u7528")}c=
new wa;k=c.getChildren();for(b=0;b<a.length;b++){var g=new Na;g.setName(a[b].getTableName());g.setDisplayName(a[b].getTableName());g.setUserSql(a[b].getUserSql());f&&g.setErrorMessage(f);k.push(g)}P(c,e);Cb&&Cb.remove();switch(d){case oa.PUBLIC_SOURCE_IS_DELETED_ERRORCODE:case oa.PUBLIC_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:case oa.DATACENTER_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:case oa.SOURCE_CONNECT_FAILED_ERRORCODE:var l=N.get("sourceCanNotUse","\u8be5\u6570\u636e\u6e90\u65e0\u6cd5\u4f7f\u7528\uff0c\u4ec5\u5c55\u793a\u5728\u6a21\u578b\u8bbe\u8ba1\u4e2d\u5df2\u4f7f\u7528\u7684\u8868\u3002");
break;case oa.CURRENT_USER_NOPERMISSION_PUBLIC_SOURCE_ERRORCODE:case oa.CURRENT_USER_NOPERMISSION_DATACENTER_ERRORCODE:l=N.get("showUsedTable","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u4ec5\u5c55\u793a\u5728\u6a21\u578b\u8bbe\u8ba1\u4e2d\u5df2\u4f7f\u7528\u7684\u8868\u3002")}l&&(Cb=Ra.createExceptionIcon(l),Cb.addClass("modeler-designer-tablearea-title-exception-icon"),Cb.appendTo(ab));Wa&&Wa.show()}else switch(Cb&&Cb.remove(),d){case oa.MODELSET_SOURCE_ALL_MODEL_CANCEL_DEPLOY_ERRORCODE:case oa.SOURCE_EXCEPTION_DELETED_ERRORCODE:case oa.PUBLIC_SOURCE_IS_DELETED_ERRORCODE:case oa.SOURCE_CONNECT_FAILED_ERRORCODE:fb();
break;case oa.CURRENT_USER_NOPERMISSION_DATACENTER_ERRORCODE:case oa.CURRENT_USER_NOPERMISSION_PUBLIC_SOURCE_ERRORCODE:case oa.DATACENTER_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:case oa.PUBLIC_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:ha&&ha.hide(),Wa&&Wa.hide(),Ya&&Ya.hide(),L(!0),Fb?Fb.show():(Fb=$("<div>"),Fb.addClass("modeler-designer-tablearea-nopermission-view"),Fb.appendTo(qa),d=$("<div>"),d.addClass("modeler-designer-tablearea-nopermission-icon"),rb.background(d,"no-permission"),d.appendTo(Fb),
d=$("<div>"),d.addClass("modeler-designer-tablearea-nopermission-text"),d.text(N.get("noPermission","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650")),d.appendTo(Fb))}},ob=function(){var c=new Date;kb=c;if(h())Qb&&Qb.remove(),Y();else{ha&&ha.hide();var d=new yb(sa,function(e){if(kb===c){Nb=e;var k=new wa;k.fromJsonObject(e);Lb(k);0===k.getChildren().length?fb():(P(k,!1),Va.bindDragUi(Qb,m))}});d.setBlockingJqUi(qa);w.setModelId(Hb.ModelSetSourceIntegration.getModelId());
d.loadTables(w)}W();Cb&&Cb.remove();Fb&&Fb.hide();Ya&&Ya.hide();Wa.show()},Y=function(){L();ha?(ha.show(),gb()):(hb=new (Hb.ModelSetSourceIntegration.getDataCenterSelector()),ha=hb.getJqUi(),ha.appendTo(qa),Z=hb.getTextField(),hb.setFunSelectedChangeListener(function(c){(new yb(sa,function(d){var e=new wa;e.fromJsonObject(d,c);Nb=d;Lb(e);P(e,!0);Qb.css("top","65px");Va.bindDragUi(Qb,m)})).getDBCenterTables(c)}))},gb=function(){var c=hb.getSelectPair();c&&(Z.setText(c.text),hb.getFunSelectedChangeListener()(c.value))},
W=function(){switch(w.getSourceType()){case Ea.SOURCE_TYPE_MODEL_SET_SOURCE:Tb.text(N.get("model","\u6a21\u578b"));break;case Ea.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:Tb.text(N.get("entity","\u5b9e\u4f53"));break;case Ea.SOURCE_TYPE_MODELSET_FILE_SOURCE:Tb.text(N.get("table","\u8868"));break;default:Tb.text(N.get("table","\u8868"))}},L=function(c){if(c)T&&T.hide(),Qb&&Qb.css("bottom","1px");else switch(w.getSourceType()){case Ea.SOURCE_TYPE_MODEL_SET_SOURCE:case Ea.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:case Ea.SOURCE_TYPE_MODELSET_FILE_SOURCE:T.hide();
Qb&&Qb.css("bottom","1px");break;default:T.show(),Qb&&Qb.css("bottom","30px")}},h=function(){return w.getSourceType()===Ea.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE},m=function(c){var d=c.parent();if(d&&d.hasClass("sa-ctrl-tree-nodeline")){var e=d.data("model").getUserObject();e instanceof Na&&d.addClass("modeler-designer-tablearea-table-item")}else d&&d.hasClass("modeler-designer-tablearea-dbCenter")?(c.addClass("modeler-designer-tablearea-table-item"),(e=c.data("model"))&&Eb.setSelectedNode(e)):c.hasClass("modeler-designer-tablearea-table-icon")||
c.hasClass("modeler-designer-tablearea-table-name")?(d=c.parents(".sa-ctrl-tree-nodeline"),e=d.data("model").getUserObject(),e instanceof Na&&d.addClass("modeler-designer-tablearea-table-item")):c.hasClass("modeler-designer-tablearea-dbCenter-table-icon")||c.hasClass("modeler-designer-tablearea-dbCenter-table-name")?(d=c.parents(".modeler-designer-tablearea-dbCenter-item"),(e=d.data("model"))&&Eb.setSelectedNode(e),d.addClass("modeler-designer-tablearea-table-item")):c.hasClass("sa-ctrl-tree-nodeline")&&
(e=c.data("model").getUserObject(),e instanceof Na&&c.addClass("modeler-designer-tablearea-table-item"));return ca.upwardSearchHasClass(c,Qb,"modeler-designer-tablearea-table-item")?(c=new Ob,c.setSourceUid(w.getId()),c.setTableName(e.getName()),e.getCommentInfo()&&c.setNamespace(e.getCommentInfo()),e.getName()&&c.setTableName(e.getName()),e.getDisplayName()&&c.setDisplayName(e.getDisplayName()),e.getUserSql()&&c.setUserSql(e.getUserSql()),(d=Ka.getModelerModel().getSameTable(c))?(!1!==e.getDisableDrag()?
d.setDisableDrag(!0):d.setDisableDrag(!1),c=d):(!1!==e.getDisableDrag()?c.setDisableDrag(!0):c.setDisableDrag(!1),e=Hb.UIDHelper.getUID(Hb.UIDHelper.NS_TABLE),c.setUid(e)),e=q(c),d=new Ha,d.setTableNode(e),d.setTable(c),d):null}};Hb.SourceListPanel=cb;var Ea=Hb.AbstractModelerSource,Na=Hb.LeafNode,xb=Hb.DesignTimeSource,yb,wa,Q,Ha,Ob,ja,fa,Ja,ea,G,O,ya,ka,ca,N,Ga,Pa,Qa,Ia,Oa,M,C,F,x,Aa,za,U,ba,Ta,Xa,D,jb,Sa;var rb=Hb.Icons;(function(){var Ma=com.kingdee.bos.qing.framework.common;N=Ma.MultilanguageManager.createPackageAccessor(Hb);
Ga=Ma.WindowResizeObserver;Ma=com.kingdee.bos.qing.common;ca=Ma.DomUtil;x=Ma.DateFormater;Ma=com.kingdee.bos.qing.ui.component;Qa=Ma.AbstractModalDialog;Pa=Ma.Button;Ia=Ma.RadioButtonGroup;Oa=Ma.RadioButton;M=Ma.List;C=Ma.SearchBox;Aa=Ma.CheckBox;za=Ma.Tree;U=Ma.HelpIcon;ba=Ma.MessageDialog;Ta=Ma.SimpleConfirmer;Xa=Ma.Label;D=Ma.TextField;jb=Ma.TextArea;Sa=Ma.DynamicScroller;Ma=com.kingdee.bos.qing.common.ui;F=Ma.TableUtil;yb=Hb.DesignerFacade;wa=Hb.FolderNode;Q=Hb.ModelerModel;Ha=Hb.DraggingTableNode;
Ob=Hb.Table;ja=Hb.UserSQL;fa=Hb.ModelSetDataSource;Ja=Hb.ActionRemoveSource;ea=Hb.ActionAddRemoveSource;G=Hb.ActionAddUserSqlTable;O=Hb.ActionRemoveUserSqlTable;ya=Hb.UserOperationReporter;ka=Hb.AbstractInvalidityCase})();oa.CURRENT_USER_NOPERMISSION_DATACENTER_ERRORCODE="20002101";oa.CURRENT_USER_NOPERMISSION_PUBLIC_SOURCE_ERRORCODE="20002102";oa.PUBLIC_SOURCE_IS_DELETED_ERRORCODE="20002103";oa.PUBLIC_SOURCE_CREATOR_NOPERMISSION_ERRORCODE="20002104";oa.DATACENTER_SOURCE_CREATOR_NOPERMISSION_ERRORCODE=
"20002105";oa.MODELSET_SOURCE_ALL_MODEL_CANCEL_DEPLOY_ERRORCODE="20002106";oa.SOURCE_CONNECT_FAILED_ERRORCODE="2025008";oa.SOURCE_EXCEPTION_DELETED_ERRORCODE="2025009";oa.SOURCE_EXCEPTION_DELETED_ERRORCODE_1="20001004";var Ra=new function(){var Ma=this;this.translateSourceType=function(qa){switch(qa){case Ea.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:return N.get("currentEntity","\u91d1\u8776\u4e91\u00b7\u82cd\u7a79-\u4e1a\u52a1\u5b9e\u4f53");case Ea.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE:return N.get("currentDataCenter",
"\u91d1\u8776\u4e91\u00b7\u82cd\u7a79-\u6570\u636e\u4e2d\u5fc3");case Ea.SOURCE_TYPE_MODELSET_DB_SOURCE:return N.get("modelSetDBSource","\u6570\u636e\u5e93");case Ea.SOURCE_TYPE_PUBLIC_DATA_SOURCE:return N.get("publicDBSource","\u516c\u5171\u6570\u636e\u6e90-\u6570\u636e\u5e93");case Ea.SOURCE_TYPE_MODEL_SET_SOURCE:return N.get("modelSet","\u6a21\u578b\u96c6");case Ea.SOURCE_TYPE_MODELSET_FILE_SOURCE:return N.get("modelSetFile","\u6587\u4ef6");case Ea.SOURCE_TYPE_OPEN_API_SOURCE:return N.get("openAPI",
"OpenAPI")}};this.createExceptionIcon=function(qa){var w=$("<div>");rb.background(w,"qingWarning");w.attr("title",qa);return w};this.createSourceNameByType=function(qa){var w;qa===Ea.SOURCE_TYPE_CURRENT_ENTITY_SOURCE?w=N.get("businessEntity","\u4e1a\u52a1\u5b9e\u4f53"):qa===Ea.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE&&(w=N.get("dataCenter","\u6570\u636e\u4e2d\u5fc3"));return w};this.getSourceIconName=function(qa){switch(qa){case Ea.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:return"entity";case Ea.SOURCE_TYPE_MODEL_SET_SOURCE:return"modelSet";
case Ea.SOURCE_TYPE_MODELSET_FILE_SOURCE:return"file";case Ea.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE:return"data-center";case Ea.SOURCE_TYPE_OPEN_API_SOURCE:return"openapi";default:return"data"}};this.updateSourceItemStatus=function(qa,w,sa){var Va=qa.children(".modeler-designer-sourcearea-exception-icon"),Ka=qa.children(".modeler-designer-sourcearea-icon"),Wa=qa.children(".modeler-designer-sourcearea-name"),lb=12,Eb=34;Va&&Va.remove();w||(Va=Ma.createExceptionIcon(sa),Va.addClass("modeler-designer-sourcearea-exception-icon"),
Va.appendTo(qa),lb+=22,Eb+=22);Ka.css("left",lb+"px");Wa.css("left",Eb+"px")};this.updateDeletedSourceStatus=function(qa){var w=Ma.createExceptionIcon(N.get("sourceExceptionDeleted","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002"));w.addClass("modeler-designer-sourcearea-exception-icon");w.appendTo(qa);w=qa.children(".modeler-designer-sourcearea-icon");w.length?(w.css("left","34px"),w=qa.children(".modeler-designer-sourcearea-name"),w.css("left",
"56px")):(w=$("<div>"),w.addClass("modeler-designer-sourcearea-name"),w.text(N.get("theSourceIsDeleted","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664")),w.css("left","34px"),w.appendTo(qa))};this.getModelExceptionTips=function(qa){if(!qa)return null;switch(qa){case ka.TYPE_MODEL_DELETED:return N.get("modelDeleted","\u8be5\u6a21\u578b\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");case ka.TYPE_MODEL_NO_DATA_PERMISSION:return N.get("modelNoPermission","\u60a8\u672a\u88ab\u6388\u6743\u4f7f\u7528\u8be5\u6a21\u578b\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");
case ka.TYPE_MODEL_INCOMPLETE:return N.get("modelNoComplete","\u8be5\u6a21\u578b\u8bbe\u7f6e\u4e0d\u5b8c\u6574\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");case ka.TYPE_MODEL_DAMAGE:return N.get("modelBad","\u8be5\u6a21\u578b\u5df2\u635f\u574f\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");case ka.TYPE_MODEL_CYCLE_REFERENCE:return N.get("modelCycleRef","\u8be5\u6a21\u578b\u4e0e\u5f53\u524d\u6a21\u578b\u5b58\u5728\u5faa\u73af\u5f15\u7528\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");case ka.TYPE_TABLE_NOT_EXISTS:return N.get("tableNotExistCantUse",
"\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002")}}};Hb.SourceConnectStep=new function(){var Ma,qa,w;this.setGlobal=function(Va){Ma=Va};this.setRemoteImpl=function(Va){qa=Va};this.setSourceArea=function(Va){};this.setTableArea=function(Va){w=Va};this.removeTableTree=function(){var Va=w.getJqTableTree();Va&&Va.remove()};this.clearTableAreaSearchBox=function(){w.getSearchBox().clear()};this.getExeSourceChangeCallback=function(){return w.setExceptionSource};
var sa=function(Va,Ka,Wa){var lb=Ma.getIntegration().getMapSourcePermission();Ka?lb&&(lb[Va]=null):(Ka={},Ka.errorMessage=Wa,lb&&(lb[Va]=Ka))};this.checkModelSetSourceConnect=function(Va,Ka){(new yb(qa,function(Wa){var lb=Wa?!1:!0;Ra.updateSourceItemStatus(Ka,lb,Wa);w.setSource(Va);sa(Va.getSourceId(),lb,Wa)},function(Wa){if(20001004===Wa)return Ka.data("errorCode",oa.SOURCE_EXCEPTION_DELETED_ERRORCODE),w.setExceptionSource(Va,oa.SOURCE_EXCEPTION_DELETED_ERRORCODE),Ra.updateDeletedSourceStatus(Ka),
!0})).checkModelSetSourceConnect(Va.getSourceId())};this.checkSourceConnectivity=function(Va,Ka){(new yb(qa,function(Wa){if(Wa)w.setSource(Va);else{var lb=N.get("sourceConnectFailed","\u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");w.setExceptionSource(Va,oa.SOURCE_CONNECT_FAILED_ERRORCODE)}sa(Va.getSourceId(),Wa,lb);Ra.updateSourceItemStatus(Ka,Wa,lb)},function(Wa,lb){var Eb=Wa.toString();if(20001004===Wa)Ka.data("errorCode",oa.SOURCE_EXCEPTION_DELETED_ERRORCODE),
w.setExceptionSource(Va,oa.SOURCE_EXCEPTION_DELETED_ERRORCODE),Ra.updateDeletedSourceStatus(Ka);else{var Qb="206"==Eb.substr(0,3)?N.get("openAPIConnectFailed","OpenAPI\u7684\u8fde\u63a5\u4fe1\u606f\u65e0\u6548\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002"):-1!=lb.indexOf("2030900")?N.get("xmlParseFailed","xml\u6587\u4ef6\u5904\u7406\u5931\u8d25\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002"):N.get("sourceConnectFailed","\u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");
w.setExceptionSource(Va,oa.SOURCE_CONNECT_FAILED_ERRORCODE)}Qb&&(sa(Va.getSourceId(),!1,Qb),Ra.updateSourceItemStatus(Ka,!1,Qb));return!0})).checkConnection(Va.getSourceId())}};Hb.ConnectSourceCreator=new function(){var Ma;this.getSourceConnector=function(qa,w){if(!Ma){Ma={};var sa=new Db,Va=new Vb;Ma[Ea.SOURCE_TYPE_MODEL_SET_SOURCE]=sa;Ma[Ea.SOURCE_TYPE_PUBLIC_DATA_SOURCE]=Va;Ma[Ea.SOURCE_TYPE_MODELSET_DB_SOURCE]=Va;Ma[Ea.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE]=Va;Ma[Ea.SOURCE_TYPE_CURRENT_ENTITY_SOURCE]=
Va;Ma[Ea.SOURCE_TYPE_MODELSET_FILE_SOURCE]=Va;Ma[Ea.SOURCE_TYPE_OPEN_API_SOURCE]=Va}sa=(sa=qa.getSourceType())?Ma[sa]:new ub;sa.setSource(qa);sa.setJqItem(w);return sa}};Hb.ModelSetSourceIntegration=new function(){var Ma,qa,w,sa,Va,Ka;this.setModelId=function(Wa){Ka=Wa};this.getModelId=function(){return Ka};this.setDataSourceManageEntrance=function(Wa){Ma=Wa};this.getDataSourceManageEntrance=function(){return Ma};this.setRemoteImpl=function(Wa){qa=Wa};this.getRemoteImpl=function(){return qa};this.registerDataCenterSelectorConstructor=
function(Wa){w=Wa};this.getDataCenterSelector=function(){return w};this.registerMetricDataCenterSelector=function(Wa){sa=Wa};this.getMetricDataCenterSelector=function(){return sa};this.setModelSetSourceFacade=function(Wa){Va=Wa};this.getModelSetSourceFacade=function(){return Va}}})();(function(){function oa(){var ea=this,G,O,ya,ka,ca,N,Ga,Pa;this.setCurrentNode=function(Qa){G=Qa};this.getCurrentNode=function(){return G};this.setModelerModel=function(Qa){O=Qa};this.setGlobal=function(Qa){Pa=Qa};this.getGlobal=function(){return Pa};this.setNodeStatusMonitor=function(Qa){ya=Qa};this.setDirty=function(Qa){ka=Qa};this.isDirty=function(){return ka};this.setMask=function(Qa){ca=Qa;ca.setClickCallback(ea.protectedShowPreviewContent)};this.getMask=function(){return ca};this.setInvalidBackgroundPane=
function(Qa){N=Qa};this.getInvalidBackgroundPane=function(){return N};this.setModelerChecker=function(Qa){Ga=Qa};this.protectedGetModelerChecker=function(){return Ga};this.clear=function(){G=null;ea.protectedClear()};this.protectedClear=function(){throw Error("Implement me.");};this.showPreviewContent=function(){G?Ga.focusNodeValidity(G,ea.protectedRefresh):(N.setText(Vb.get("dataLoading","\u6570\u636e\u52a0\u8f7d\u4e2d")),N.show())};this.protectedGetModeler=function(){return O};this.protectedRefresh=
function(){throw Error("Implement me.");};this.protectedChangeBackgroundStatus=function(Qa){if(Qa||!ea.isCurrentNodeValid()){var Ia=N,Oa=Ia.setText;Qa||(Qa=(Qa=ya.getInvalidPrompt(G))?Qa:Vb.get("invalidNodeConfig","\u8282\u70b9#1\u8bbe\u7f6e\u4e0d\u5b8c\u6574").replace("#1",G.getAlias()));Oa.call(Ia,Qa);N.show()}else N.hide()};this.protectedChangeMaskStatus=function(Qa){Qa||!ea.isCurrentNodeValid()?ca.hide():ca.show()};this.protectedShowPreviewContent=function(){throw Error("Implement me.");};this.afterResize=
function(Qa){(Qa||ya&&ya.getSelected())&&ea.protectedAfterResize(Qa)};this.protectedAfterResize=function(){throw Error("Implement me.");};this.getRuntimeModel=function(){if(G&&O)return wa.convertToRuntimeModel(O,G)};this.isCurrentNodeValid=function(){return G?!ya.isInvalidNode(G.getId()):!0}}function xa(){function ea(F){KTDefaultCellRender.call(this,F);var x=this,Aa=[Q.DT_STRING,Q.DT_NUMBER,Q.DT_INT,Q.DT_DATE,Q.DT_DATETIME,Q.DT_BOOLEAN],za=this.paintCellUI;this.paintCellUI=function(U,ba){var Ta=x.getCurrentRowIdx(),
Xa=x.getCurrentRow(),D=x.getCurrentColIdx(),jb=Xa.getUserObject(),Sa=x.getCell();if(Ta<Db.getHeadRowCount())za(U,ba);else if(0==D)ba=$("<div>"),Xa=qb.FieldNumberHelper.getFieldNumber(jb),ba.text(Xa),ba.attr("title",Xa),ba.css("line-height","28px"),ba.css("padding-left","2px"),ba.css("padding-right","2px"),ba.addClass("modeler-designer-tablecell-editable"),qb.FieldNumberHelper.isDynamicFieldNumber(jb)&&G.getCurrentNode().getId()==jb.getFromNode()&&ba.css("color","#c0c0c0"),ba.appendTo(U);else if(1==
D)jb=$("<div>"),Xa=Sa.getValue(),jb.text(Xa),jb.attr("title",Xa),jb.css("line-height","28px"),jb.css("padding-left","2px"),jb.css("padding-right","2px"),jb.addClass("modeler-designer-tablecell-editable"),jb.appendTo(U);else if(3==D){if(Ta=jb.getFromNode(),Sa=G.protectedGetModeler(),Ta=Sa.getNode(Ta))ba=$("<div>"),D=qb.DisplayNameHelper.getNodeDisplayName(Ta),Ta.getGeneratedFieldSourceTableName&&(D=(Xa=Ta.getGeneratedFieldSourceTableName(jb,Sa))?Xa:D),ba.text(D),ba.attr("title",D),ba.css("line-height",
"28px"),ba.css("padding-left","2px"),ba.css("padding-right","2px"),ba.appendTo(U)}else if(2==D){Sa=jb.getOutputDataType();var rb=jb.getOriginalDataType()?jb.getOriginalDataType():Q.DT_STRING;U=Db.createCtrlInCell(U,x.getCellWidth(),x.getCellHeight(),Ab);U.setItemModels(Aa);U.setSelected(Sa);U.setUserObject(Xa);U.setCustomPainter(function(Ra,Ma,qa){Ra=Ra?!1:qa==rb;var w=$("<div>");ub.background(w,qa);w.addClass("modeler-designer-select-field-dataType-icon");Ma.append(w);w=qb.PropDataTypeUtil.getDataTypeDesc(qa);
qa=$("<div>");qa.addClass("modeler-designer-select-text");Ra=w+(Ra?"("+Vb.get("origin","\u539f\u59cb")+")":"");qa.text(Ra);qa.attr("title",Ra);Ma.append(qa)});U.addSelectedChangedListener(C)}else if(4==D){ba=$("<div>");Xa=jb.getName();Ta=jb.getFromNode();Sa=G.protectedGetModeler();if(Ta=Sa.getNode(Ta))Ta.getGeneratedSourceFieldName?Xa=(jb=Ta.getGeneratedSourceFieldName(jb,Sa,G.getCurrentNode()))?jb:Xa:null!=jb.getSourceDisplayName()&&(Xa=jb.getSourceDisplayName()+"("+Xa+")");ba.text(Xa);ba.attr("title",
Xa);ba.css("line-height","28px");ba.css("padding-left","2px");ba.css("padding-right","2px");ba.appendTo(U)}}}wb.AbstractTabPane.call(this);oa.call(this);var G=this,O,ya,ka,ca,N;this.getTitle=function(){return Vb.get("field","\u5b57\u6bb5")};this.setMessageCurtain=function(F){N=F};this.getJqUi=function(){if(!O){O=$("<div>");ya&&Ga();var F=new Ob,x=F.getJqUi();F.hide();G.setInvalidBackgroundPane(F);Hb.layoutCtrlWithLRTB(x,0,0,null,0,0,null);O.append(x)}return O};this.into=function(){!ya||G.isDirty()?
(G.showPreviewContent(),G.setDirty(!1)):G.afterResize(!0)};this.protectedAfterResize=function(F){ka&&ya&&0!=ya.length&&(F?Pa():ka.relayoutViews())};this.updateNumberCellValue=function(F){if(ya){for(var x=-1,Aa=0,za=ya.length;Aa<za;Aa++)if(ya[Aa].getFullName()==F.getFullName()){x=Aa;break}-1<x&&(x+=Db.getHeadRowCount(),(x=ka.getRow(x))&&x.getCell(0).setValue(qb.FieldNumberHelper.getFieldNumber(F)))}};this.setRemoteImpl=function(F){};this.protectedClear=function(){ya=null};this.reload=function(){G.showPreviewContent()};
this.protectedRefresh=function(){G.protectedChangeBackgroundStatus();G.isCurrentNodeValid()&&G.protectedShowPreviewContent()};this.protectedShowPreviewContent=function(){if(G.getCurrentNode()){var F=G.getCurrentNode().getId();qb.NodeFieldHelper.asynGetFields(G.getGlobal().getModelerModel(),G.getCurrentNode(),function(x){G.getCurrentNode()&&F==G.getCurrentNode().getId()&&(ya=x,Pa())},function(){},O)}};var Ga=function(){ka=Db.createTable();ka.setColumnFitVisibleWidth(!0);var F=new ea(ka);F.setOutsideVisible(!1);
ka.setCellRender(F);ka.setSyncUIWhenModelChanged(!0);Db.bindTextEditor(ka,Qa,Ia);Db.bindTableListenerForCtrl(ka);ca=$(ka.getUI());Hb.layoutCtrlWithLRTB(ca,10,10,null,10,10,null);ca.appendTo(O)},Pa=function(){ka||Ga();Db.clear(ka);ka.addColumns(5);var F=ka.getColumn(0),x=ka.getColumn(1),Aa=ka.getColumn(3),za=ka.getColumn(2),U=ka.getColumn(4);F.setWidth(200);x.setWidth(200);Aa.setWidth(140);za.setWidth(140);U.setWidth(140);F.setUserObject(0);x.setUserObject(1);Aa.setUserObject(3);za.setUserObject(2);
U.setUserObject(4);F=Db.createHeadRow(ka);F.getCell(0).setValue(Vb.get("fieldName","\u5b57\u6bb5\u540d\u79f0"));F.getCell(1).setValue(Vb.get("fieldAlias","\u663e\u793a\u540d\u79f0"));F.getCell(3).setValue(Vb.get("tableSource","\u6765\u6e90\u8868"));F.getCell(2).setValue(Vb.get("dataType","\u6570\u636e\u7c7b\u578b"));F.getCell(4).setValue(Vb.get("fieldSource","\u6765\u6e90\u5b57\u6bb5"));if(ya)for(F=0,x=ya.length;F<x;F++)Aa=Db.createRow(ka),Aa.setUserObject(ya[F]),Aa.getCell(1).setValue(ya[F].getAlias()),
Aa.getCell(0).setValue(qb.FieldNumberHelper.getFieldNumber(ya[F]));Db.refresh(ka)},Qa=function(F,x){return 1==x||0==x?!0:!1},Ia=function(F,x,Aa,za,U){if(!(0>ka.getColumnIndex(x)))if(1==x.getUserObject()){x=za;x=x?x.trim():"";F=F.getUserObject();za=M(F);var ba=/^[\u3000\u4E00-\u9FA5a-zA-Z0-9_]{1,}$/;if(za.getAlias()!=x){if(0==x.length)var Ta=Vb.get("fieldAliasIsEmpty","\u663e\u793a\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a");else if(50<x.length)Ta=Vb.get("fieldAliasTooLong","\u663e\u793a\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26");
else if(x.match(ba)){za=!1;ba=[];var Xa=G.getCurrentNode().getFieldSettingConfig();Xa=Xa?Xa.getModifiedField():[];for(var D=0;D<ya.length;D++){for(var jb=ya[D],Sa=jb.getAlias(),rb=0;rb<Xa.length;rb++){var Ra=Xa[rb];if(jb.getFullName()==Ra.getFullName()){Sa=Ra.getAlias();break}}ba.push(Sa)}for(Xa=0;Xa<ba.length;Xa++)if(ba[Xa]==x){za=!0;break}za&&(Ta=Vb.get("duplicateFieldAlias","\u663e\u793a\u540d\u79f0\u5df2\u5b58\u5728"))}else Ta=Vb.get("invalidFieldAlias","\u663e\u793a\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210");
Ta?(Ta=U?Ta+Vb.get("punctuation_period","\u3002"):Vb.get("modifyAbandoned","#1\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002").replace("#1",Ta),N&&N.showPrompt(Ta)):(za=M(F),za.setAlias(x),U=new ja,U.setValue(G.getCurrentNode(),za,ja.TYPE_ALIAS),G.getGlobal().getCommandManager().perform(U),Aa.setValue(x))}}else 0==x.getUserObject()&&Oa(F,x,Aa,za,U)},Oa=function(F,x,Aa,za,U){za=za?za.trim():"";var ba=F.getUserObject();if(G.getGlobal().getModelerModel().getFieldNumberMap()[ba.getFullName()]!=za){F=/^([\u4E00-\u9FA5a-zA-Z_])[\u4E00-\u9FA5a-zA-Z0-9_]{0,}$/;
if(0==za.length)var Ta=Vb.get("fieldNumberIsEmpty","\u5b57\u6bb5\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a");else if(25<za.length)Ta=Vb.get("fieldNumberTooLong","\u5b57\u6bb5\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc725\u4e2a\u5b57\u7b26");else if(za.match(F))if(com.kingdee.bos.qing.modeler.SpecialWordChecker.isSpecialWord(za))Ta=Vb.get("specialWordAsFieldNumberPrompt","\u201c#1\u201d\u4e3a\u7279\u6b8a\u5173\u952e\u5b57\uff0c\u4e0d\u80fd\u4f5c\u4e3a\u5b57\u6bb5\u540d\u79f0").replace("#1",za);else{F=
G.getGlobal().getModelerModel().getFieldNumberMap();x=Object.keys(F);for(var Xa=0;Xa<x.length;Xa++)if(F[x[Xa]]&&za.toLowerCase()==F[x[Xa]].toLowerCase()&&x[Xa]!=ba.getFullName()){var D=x[Xa];break}D&&(Ta=Vb.get("duplicateFieldNumber","\u5b57\u6bb5\u540d\u79f0\u5df2\u5b58\u5728"))}else Ta=Vb.get("invalidFieldNumber","\u5b57\u6bb5\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\uff0c\u4e14\u4e0d\u80fd\u4ee5\u6570\u5b57\u5f00\u5934");
var jb=function(){var Sa=new fa;Sa.setValue(G.getGlobal().getModelerModel(),ba,za);G.getGlobal().getCommandManager().perform(Sa);Aa.setValue(za)};Ta?D?qb.FieldNumberHelper.removeFieldNumberIfFieldNotExist(D,function(Sa){Sa?jb():(Ta=U?Ta+Vb.get("punctuation_period","\u3002"):Vb.get("modifyAbandoned","#1\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002").replace("#1",Ta),N&&N.showPrompt(Ta))}):(Ta=U?Ta+Vb.get("punctuation_period","\u3002"):Vb.get("modifyAbandoned","#1\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002").replace("#1",
Ta),N&&N.showPrompt(Ta)):jb()}},M=function(F){var x=G.getCurrentNode().getFieldSettingConfig();x=x?x.getModifiedField():[];for(var Aa=0;Aa<x.length;Aa++){var za=x[Aa];if(za.getFullName()==F.getFullName())return za}return F.clone()},C=function(F,x,Aa){F=F.getUserObject().getUserObject();F=M(F);F.setAppointedDataType(Aa);Aa=new ja;Aa.setValue(G.getCurrentNode(),F,ja.TYPE_DATATYPE);G.getGlobal().getCommandManager().perform(Aa)}}function eb(){function ea(Ia){KTDefaultCellRender.call(this,Ia);var Oa=this,
M=this.paintCellUI;this.paintCellUI=function(C,F){var x=Oa.getCurrentRowIdx(),Aa=Oa.getCurrentRow(),za=Oa.getCurrentColIdx(),U=Aa.getUserObject();Aa=new Na;Aa.setFormatString("#,##0.00");x<Db.getHeadRowCount()?M(C,F):(F=ca.getField(za).getOutputDataType(),za=U[za],null==za||void 0==za?za="":F==Q.DT_DATE?(Aa=new Ea,Aa.setFormatString("yyyy-MM-dd"),za=Aa.format(za)):F==Q.DT_DATETIME?(Aa=new Ea,Aa.setFormatString("yyyy-MM-dd HH:mm:ss"),za=Aa.format(za)):F==Q.DT_BOOLEAN?za=void 0===za?"":za?"true":"false":
F==Q.DT_NUMBER&&(za=Aa.format(za)),Aa=$("<div>"),Aa.text(za),Aa.attr("title",za),Aa.css("line-height","28px"),Aa.css("padding-left","2px"),Aa.css("padding-right","2px"),F!=Q.DT_INT&&F!=Q.DT_NUMBER||Aa.css("text-align","right"),Aa.appendTo(C))}}wb.AbstractTabPane.call(this);oa.call(this);var G=this,O,ya,ka,ca,N;this.getTitle=function(){return Vb.get("preview","\u9884\u89c8")};this.getJqUi=function(){if(!O){O=$("<div>");var Ia=$("<div>");Ia.css("cursor","pointer");Ia.attr("title",Vb.get("previewSet",
"\u9884\u89c8\u8bbe\u7f6e"));Ia.on("click",Qa);ub.backgroundWithHover(Ia,"setting");Hb.layoutCtrl(Ia,10,4,20,20);Ia.appendTo(O);N=$("<div>");Hb.layoutCtrlWithLRTB(N,40,10,null,5,null,20);N.css({"font-size":"14px",color:"#666",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"});N.appendTo(O);Pa();Ia=new cb;var Oa=Ia.getJqUi();G.setMask(Ia);Ia.hide();Hb.layoutCtrlWithLRTB(Oa,5,5,null,28,5,null);O.append(Oa);Ia=new Ob;Oa=Ia.getJqUi();G.setInvalidBackgroundPane(Ia);Ia.hide();Hb.layoutCtrlWithLRTB(Oa,
5,5,null,28,5,null);O.append(Oa);Ga()}return O};this.setRemoteImpl=function(Ia){};this.into=function(){!ca||G.isDirty()?(G.showPreviewContent(),G.setDirty(!1)):G.afterResize()};this.protectedAfterResize=function(){ya&&ca&&0!=ca.getRowCount()&&ya.relayoutViews()};this.protectedClear=function(){ca=null};this.reload=function(){G.showPreviewContent()};this.protectedRefresh=function(){G.protectedChangeBackgroundStatus();G.protectedChangeMaskStatus()};this.protectedShowPreviewContent=function(){var Ia=
G.getRuntimeModel();if(Ia){var Oa=qb.PreviewConfigManager.getPreviewConfig();Ia.setPreviewConfig(Oa);(new Date).getTime();qb.NodeFieldHelper.getPreviewData(Ia,function(M){var C=G.getCurrentNode(),F=M.getPreviewData();if(C&&wa.treatAsSameNode(M.getNodeId(),C.getId())&&(ca=F,ca&&0!=ca.getRowCount()||(G.protectedChangeBackgroundStatus(Vb.get("noData","\u5f53\u524d\u9884\u89c8\u89c4\u5219\u4e0b,\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e")),G.protectedChangeMaskStatus(!0)),ya||Pa(),ca)){ka||
(ka=$(ya.getUI()),Hb.layoutCtrlWithLRTB(ka,10,10,null,30,10,null),ka.appendTo(O));F=ca.getColumnCount();M=ca.getRowCount();Db.clear(ya);if(0!=F&&0!=M){ya.addColumns(F);var x=Db.createHeadRow(ya);for(C=0;C<F;C++)ya.getColumn(C).setWidth(150),x.getCell(C).setValue(ca.getField(C).getAlias());for(C=0;C<M;C++)F=ca.getOneRow(C),Db.createRow(ya).setUserObject(F)}Db.refresh(ya)}},O)}};var Ga=function(){var Ia=qb.PreviewConfigManager.getRowCountText();N.text(Ia)},Pa=function(){ya=Db.createTable();ya.setColumnFitVisibleWidth(!1);
var Ia=new ea(ya);Ia.setOutsideVisible(!1);ya.setCellRender(Ia);ya.setSyncUIWhenModelChanged(!0)},Qa=function(){var Ia=new Ja,Oa=qb.PreviewConfigManager.getPreviewConfig();Ia.setTitle(Vb.get("previewSet","\u9884\u89c8\u8bbe\u7f6e"));Ia.setOriginExtractCount(Oa.getExtractCount());Ia.setOriginPreviewCount(Oa.getPreviewCount());Ia.setAllData(Oa.isExtractAllData());Ia.setConfirmCallback(function(M,C,F){qb.PreviewConfigManager.updatePreviewConfig(M,C,F);G.showPreviewContent();Ga()});Ia.showDialog()}}function cb(){var ea=
this,G,O;this.setClickCallback=function(ka){O=ka};this.getJqUi=function(){G||ya();return G};var ya=function(){G=$("<div>");G.addClass("modeler-designer-preview-mask");var ka=$("<div>");ka.text(Vb.get("refreshPreviewData","\u7f16\u8f91\u5b8c\u6210\u540e\uff0c\u70b9\u51fb\u6b64\u5904\u5237\u65b0\u9884\u89c8\u6570\u636e\u3002"));ka.on("click",function(ca){ea.hide();O&&O()});ka.addClass("modeler-designer-preview-mask-button");ka.appendTo(G)};this.show=function(){G.show()};this.hide=function(){G.hide()}}
"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var qb=com.kingdee.bos.qing.modeler.designer;qb.PreviewArea=function(){var ea,G,O,ya,ka,ca,N,Ga,Pa,Qa,Ia=
!1,Oa;this.getJqUi=function(){ka||M();return ka};this.setModelerModel=function(U){ea&&ea.removePropertyChangeCallback(x);ea=U;ea.addPropertyChangeCallback(x)};this.setModelerChecker=function(U){Pa=U};this.setNodeStatusMonitor=function(U){G&&G.removeSelectNodeListener(C);G&&G.removeInvalidNodeChangeListener(F);G=U;G.addSelectNodeListener(C);G.addInvalidNodeChangeListener(F)};this.setGlobal=function(U){O=U;N&&N.setGlobal(O)};this.setRemoteImpl=function(U){ya=U};this.setHideListener=function(U){Qa=U};
this.show=function(U){Ia!=!U&&((Ia=!U)||ca.getCurrentTabPane().into())};var M=function(){ka=$("<div>");N=new xa;Ga=new eb;N.setRemoteImpl(ya);Ga.setRemoteImpl(ya);Ga.setNodeStatusMonitor(G);N.setNodeStatusMonitor(G);N.setGlobal(O);Ga.setModelerChecker(Pa);N.setModelerChecker(Pa);ca=new wb;ca.setTabLevel(wb.SECOND_LEVEL);ca.addTab(N,!0);ca.addTab(Ga);var U=$("<div>");ub.background(U,"downArrow");Hb.layoutCtrlWithLRTB(U,null,5,16,8,null,16);U.css("cursor","pointer");U.on("click",function(){Ia=!0;Qa&&
Qa()});U.appendTo(ka);ka.append(ca.getJqUi())},C=function(U,ba){Ga.clear();N.clear();ba&&(Oa=G.getInvalidState(ba),U=O.getModelerModel(),N.setCurrentNode(ba),N.setModelerModel(U),N.setMessageCurtain(O.getMessageCurtain()),Ga.setCurrentNode(ba),Ga.setModelerModel(U));Ia||(ba=ca.getCurrentTabPane(),(U=ba.getJqUi().find(".sa-common-loading-modallayer"))&&U.remove(),ba.showPreviewContent())},F=function(U){if(U=ca.getCurrentTabPane())if(U=U.getCurrentNode())U=G.getInvalidState(U),Oa!=U&&za(),Oa=U},x=function(U,
ba){if(U==Ha.KEY_REMOVE_NODE){if(ba=ba.getDownwardNode())Aa(ba)&&za(),console.log("change preview "+U)}else if(U==Ha.KEY_LINK_NODE||U==Ha.KEY_ADD_NODE||U==Ha.KEY_BREAK_LINK||U==xb.KEY_TABLE_NODE_SELECT_FIELD||0==U.indexOf(Ha.KEY_CHANGE_TRANSFORM_CONFIG))Aa(ba)&&za(),console.log("change preview "+U);else if(U==Ha.KEY_NODE_CHANGE_ALIAS)ba instanceof yb&&(U=ca.getCurrentTabPane(),U==N&&N.afterResize());else if(U==xb.KEY_UPDATE_TABLE)for(U=0;U<ba.length;U++)Aa(ba[U])&&za();else U==Ha.KEY_CHANGE_FIELD_NUMBER&&
(U=ca.getCurrentTabPane(),U==N&&(N.updateNumberCellValue(ba),N.afterResize()))},Aa=function(U){var ba=ca.getCurrentTabPane().getCurrentNode();if(-1<qb.ModelConverter.getUpwardNode(ea,ba,!1).indexOf(U))return!0},za=function(){if(!Ia){var U=ca.getCurrentTabPane();U.reload();U==Ga?N.setDirty(!0):Ga.setDirty(!0)}};this.afterResize=function(U){ca.getCurrentTabPane().afterResize(U)}};var wb,Ab,Vb,Db,ub,Hb,Ea,Na,xb,yb,wa,Q,Ha,Ob,ja,fa,Ja;(function(){var ea=com.kingdee.bos.qing.ui.component;wb=ea.TabContainer;
Ab=ea.ComboBox;ea=com.kingdee.bos.qing.common.ui;Db=ea.TableUtil;ea=com.kingdee.bos.qing.common;Hb=ea.DomUtil;Ea=ea.DateFormater;Na=ea.NumberFormater;ea=com.kingdee.bos.qing.framework.common;Vb=ea.MultilanguageManager.createPackageAccessor(qb);yb=qb.TableNode;xb=qb.ModelerModel;wa=qb.ModelConverter;Q=qb.Field;Ha=qb.TableModeler;ub=qb.Icons;Ob=qb.InvalidBackgroundPane;ja=qb.ActionNodeFieldSetting;fa=qb.ActionFieldNumberMapping;Ja=qb.PreviewCountSetDialog})()})();(function(){function oa(){var ka,ca,N,Ga,Pa,Qa,Ia,Oa,M,C,F,x,Aa={},za=[],U=!0,ba=!0,Ta=!0,Xa,D,jb,Sa,rb,Ra;this.getJqUi=function(){if(!D){Va();if(Ka())for(var ab=ka.getModelerModel(),Cb=ab.getAllTable(),Fb=0;Fb<Cb.length;Fb++){var Ya=Cb[Fb];if(ab.getSource(Ya.getSourceUid()).getSourceType()!==Ja.SOURCE_TYPE_MODELSET_FILE_SOURCE){var kb=Ya.getUid(),Z=sa(ab,kb,!1);0<Z.length&&(za.push(Ya),Aa[kb]=Z)}}D=$("<div>");Ra=$("<div>");ab=new xb;Ga=new yb;Pa=new yb;Qa=new yb;Ga.setText(Ab.get("neverExtract",
"\u4e0d\u8fdb\u884c\u7269\u5316\u5b58\u50a8\uff0c\u603b\u662f\u5b9e\u65f6\u6267\u884c\u6a21\u578b"));Pa.setText(Ab.get("onceExtract","\u4ec5\u5728\u90e8\u7f72\u65f6\u7269\u5316\u5b58\u50a8\u4e00\u6b21\uff0c\u4ee5\u540e\u4e0d\u518d\u66f4\u65b0"));Qa.setText(Ab.get("timingExtract","\u5b9a\u65f6\u8fdb\u884c\u7269\u5316\u5b58\u50a8"));ab.addElement(Ga);ab.addElement(Pa);ab.addElement(Qa);Cb=Ga.getJqUi();Fb=Pa.getJqUi();Ya=Qa.getJqUi();wb.layoutCtrl(Cb,0,0,530,23);wb.layoutCtrl(Fb,0,35,530,23);wb.layoutCtrl(Ya,
0,70,530,23);Cb.appendTo(D);Fb.appendTo(D);Ya.appendTo(D);kb=$("<div>");kb.text(Ab.get("materializationMethod","\u7269\u5316\u65b9\u5f0f"));var ha=new wa;ha.setIconType(wa.ICON_TYPE_QUESTION);ha.setTipsSize(300,105);ha.setTipsHtml(Ab.get("materializationTechniqueTips","\u5168\u91cf\u7269\u5316\uff1a\u6839\u636e\u6267\u884c\u8ba1\u5212\uff0c\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u6267\u884c\u6a21\u578b\uff0c\u5e76\u5c06\u6a21\u578b\u7684\u6267\u884c\u7ed3\u679c\u8fdb\u884c\u7269\u5316\u5b58\u50a8\u3002<br/>\u589e\u91cf\u7269\u5316\uff1a\u6839\u636e\u6267\u884c\u8ba1\u5212\uff0c\u5728\u6307\u5b9a\u7684\u65f6\u95f4\uff0c\u6309\u7167\u6240\u9009\u7684\u4f9d\u636e\u5b57\u6bb5\u8fdb\u884c\u589e\u91cf\u6570\u636e\u63d0\u53d6\u5e76\u6267\u884c\u6a21\u578b\uff0c\u5c06\u6267\u884c\u7ed3\u679c\u66f4\u65b0\u81f3\u5386\u53f2\u7269\u5316\u7ed3\u679c\u4e2d\u3002"));
Cb=new xb;Ia=new yb;Oa=new yb;Ia.setText(Ab.get("fullMaterialize","\u5168\u91cf\u7269\u5316"));Oa.setText(Ab.get("incrementalMaterialize","\u589e\u91cf\u7269\u5316"));Cb.addElement(Ia);Cb.addElement(Oa);Fb=$("<div>");Z=$("<div>");Ya=$("<div>");ha=ha.getJqUi();var hb=Ia.getJqUi(),Mb=Oa.getJqUi();wb.layoutCtrl(Z,0,0,540,19);wb.layoutCtrl(hb,20,30,250,23);wb.layoutCtrl(Ya,20,60,520,23);wb.layoutCtrl(Fb,0,0,540,90);kb.appendTo(Z);ha.appendTo(Z);Z.appendTo(Fb);hb.appendTo(Fb);Mb.appendTo(Ya);Ya.appendTo(Fb);
Fb.appendTo(Ra);kb.addClass("modeler-designer-materialized-method-label");ha.addClass("modeler-designer-materialized-method-label-tips");Z.css({"border-bottom":"1px solid #CCCCCC"});Mb.css({display:"inline-block"});Oa.setCustomStyle("position","relative");Z=new Na;Z.setText(Ab.get("basedField","\u4f9d\u636e\u5b57\u6bb5"));M=Wa();kb=new wa;kb.setIconType(wa.ICON_TYPE_QUESTION);kb.setTipsSize(200,70);kb.setTipsText(Ab.get("basedFieldHelpTips","\u4ec5\u652f\u6301\u201c\u65e5\u671f\u65f6\u95f4\u201d\u578b\u548c\u201c\u6574\u6570\u201d\u578b\u7684\u81ea\u589e\u5b57\u6bb5\u4f5c\u4e3a\u589e\u91cf\u7269\u5316\u7684\u4f9d\u636e\u5b57\u6bb5\u3002"));
Sa=$("<div>");fa.background(Sa,"qingWarning");Sa.hide();jb=$("<div>");Z=Z.getJqUi();ha=M.getJqUi();kb=kb.getJqUi();wb.layoutCtrl(Z,0,0,50,23);wb.layoutCtrl(kb,52,3,16,16);wb.layoutCtrl(Sa,80,3,16,16);wb.layoutCtrl(ha,80,0,150,23);Z.appendTo(jb);kb.appendTo(jb);Sa.appendTo(jb);ha.appendTo(jb);jb.appendTo(Ya);jb.addClass("modeler-designer-materialized-based-field");Ya=new Na;Ya.setText(Ab.get("executePlan","\u6267\u884c\u8ba1\u5212"));C=new Vb;C.isOnlyPeriod(!0);C.setCronAnalysisFacade(Eb);C.setScheduleChangedListener(lb);
rb=$("<div>");Ya=Ya.getJqUi();kb=C.getJqUi();wb.layoutCtrl(Ya,0,0,540,23);wb.layoutCtrl(kb,11,30,300,200);wb.layoutCtrl(rb,0,100,540,225);wb.layoutCtrl(Ra,20,105,540,350);Ya.appendTo(rb);kb.appendTo(rb);rb.appendTo(Ra);Ra.appendTo(D);Ya.children(":first-child").css("font-weight","bold");Ya.css("border-bottom","1px solid #CCCCCC");ab.addChangedListener(Qb);Cb.addChangedListener(Tb);F||(Ga.getJqUi().hide(),Pa.getJqUi().css("top","0px"),Qa.getJqUi().css("top","35px"),Ra.css("top","70px"),Fb.hide(),Ya.hide(),
rb.css("top","0px"),kb.css({left:"-9px",top:"-5px"}));qa()}return D};this.setGlobal=function(ab){ka=ab};this.setRemoteImpl=function(ab){ca=ab};this.setSupportIncrementConfig=function(ab){F=ab};this.setMessageCurtain=function(ab){N=ab};this.setMaterializedConfig=function(ab){x=ab;qa()};this.getMaterializedConfig=function(){Ma();return x};this.checkMaterializedConfig=function(){Ma();if(!x)return!0;if(!U)return N.showPrompt(Ab.get("noDataWarehouseConfig","\u5f53\u524d\u73af\u5883\u672a\u914d\u7f6e\u201c\u8f7b\u6570\u4ed3\u6570\u636e\u6e90\u201d\u53c2\u6570\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u5728MC\u4e2d\u8fdb\u884c\u914d\u7f6e\u3002")),
!1;if(!ba)return N.showPrompt(Ab.get("dataWarehouseConfigParseError","\u201c\u8f7b\u6570\u4ed3\u6570\u636e\u6e90\u201d\u53c2\u6570\u89e3\u6790\u5f02\u5e38\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u5728MC\u4e2d\u91cd\u65b0\u914d\u7f6e\u3002")),!1;if(G.TYPE_TIMING===x.getType()){if(G.STRATEGY_INCREMENTAL===x.getStrategy()){if(!Ka())return N.showPrompt(Ab.get("noSupportIncrement","\u5f53\u524d\u6a21\u578b\u4e0d\u652f\u6301\u589e\u91cf\u7269\u5316\u3002")),!1;var ab=x.getBasedFields();if(!ab||0===ab.length)return N.showPrompt(Ab.get("noBasedField",
"\u4f9d\u636e\u5b57\u6bb5\u4e0d\u80fd\u4e3a\u7a7a\u3002")),!1;for(var Cb=0;Cb<ab.length;Cb++){var Fb=w(ab[Cb].getTableId(),ab[Cb].getName());if(!Fb||ja.DT_INT!==Fb.getOriginalDataType()&&ja.DT_DATETIME!==Fb.getOriginalDataType())return N.showPrompt(Ab.get("incompleteMaterializedConfig","\u7269\u5316\u5b58\u50a8\u8bbe\u7f6e\u4e0d\u5b8c\u6574")+Ab.get("punctuation_period","\u3002")),!1}}ab=x.getSchedule();if(ab.getPeriod()===Db.Period_Custom){Cb=ab.getCron();if("undefined"==typeof Cb||""===Cb)return ab=
F?Ab.get("cronEmptyError","\u6267\u884c\u8ba1\u5212\u4e2d\u8868\u8fbe\u5f0f\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u683c\u5f0f\u5982 0 0 12 * * ?"):Ab.get("cronEmptyErrorForMetric","\u8868\u8fbe\u5f0f\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u683c\u5f0f\u5982 0 0 12 * * ?"),N.showPrompt(ab),!1;if(ab=ab.getCronMsg())return ab=F?Ab.get("executePlanIng","\u6267\u884c\u8ba1\u5212\u4e2d")+ab:ab,N.showPrompt(ab),!1;if(!Ta)return Xa?(ab=F?Ab.get("cronMinimumIntervalError","\u6267\u884c\u8ba1\u5212\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e#1\u5206\u949f\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002"):
Ab.get("cronMinimumIntervalErrorForMetric","\u8868\u8fbe\u5f0f\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e#1\u5206\u949f\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002"),ab=ab.replace("#1",Xa)):ab=F?Ab.get("cronIntervalError","\u6267\u884c\u8ba1\u5212\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e1\u5c0f\u65f6\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002"):Ab.get("cronIntervalErrorForMetric","\u8868\u8fbe\u5f0f\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e1\u5c0f\u65f6\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002"),
N.showPrompt(ab),!1}}return!0};var Ma=function(){if(Qa&&Qa.isChecked()){x=new G;x.setType(G.TYPE_TIMING);x.setStrategy(G.STRATEGY_FULL);if(Oa&&Oa.isChecked()){x.setStrategy(G.STRATEGY_INCREMENTAL);var ab=M.getSelectedModel();if(ab){var Cb=new O;Cb.setTableId(ab.getTableId());Cb.setTableName(ab.getTableName());Cb.setName(ab.getField().getName());Cb.setAlias(ab.getField().getAlias());x.setBasedFields([Cb])}}x.setSchedule(C.getSchedule())}else x=Pa&&Pa.isChecked()?new G:null},qa=function(){Ia.setChecked(!0);
Ga.setChecked(!0);F||Pa.setChecked(!0);if(x)if(G.TYPE_ONCE===x.getType())Pa.setChecked(!0);else{Qa.setChecked(!0);if(G.STRATEGY_INCREMENTAL===x.getStrategy()){var ab=x.getBasedFields();if(ab&&0<ab.length){a:{var Cb=ab[0].getTableId(),Fb=ab[0].getName(),Ya=ka.getModelerModel(),kb=Ya.getTable(Cb);Ya=Ya.getPage().getNodesByTableId(Cb);if(kb&&Ya&&0<Ya.length){if(Cb=w(Cb,Fb)){ab=new cb(kb,Cb,!1);break a}}else kb=new Ob,kb.setUid(Cb),kb.setDisplayName(ab[0].getTableName());Cb=new ja;Cb.setName(Fb);Cb.setAlias(ab[0].getAlias());
ab=new cb(kb,Cb,!0)}ab&&(Oa.setChecked(!0),M.setSelectedModel(ab))}}C.setSchedule(x.getSchedule())}},w=function(ab,Cb){ab=sa(ka.getModelerModel(),ab,!0);for(var Fb=0;Fb<ab.length;Fb++)if(Cb===ab[Fb].getName())return ab[Fb]},sa=function(ab,Cb,Fb){var Ya=[];(Cb=ab.getPage().getNodesByTableId(Cb))&&1===Cb.length&&qb.NodeFieldHelper.asynGetFields(ab,Cb[0],function(kb){if(Fb)Ya=kb;else for(var Z=0;Z<kb.length;Z++){var ha=kb[Z].getOriginalDataType();ja.DT_INT!==ha&&ja.DT_DATETIME!==ha||Ya.push(kb[Z])}});
return Ya},Va=function(){(new ea(ca,function(ab){ba=U=!0},function(ab,Cb){return 30001001===ab?(U=!1,N.showPrompt(Ab.get("noDataWarehouseConfig","\u5f53\u524d\u73af\u5883\u672a\u914d\u7f6e\u201c\u8f7b\u6570\u4ed3\u6570\u636e\u6e90\u201d\u53c2\u6570\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u5728MC\u4e2d\u8fdb\u884c\u914d\u7f6e\u3002")),!0):30001002===ab?(ba=!1,N.showPrompt(Ab.get("dataWarehouseConfigParseError","\u201c\u8f7b\u6570\u4ed3\u6570\u636e\u6e90\u201d\u53c2\u6570\u89e3\u6790\u5f02\u5e38\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u5728MC\u4e2d\u91cd\u65b0\u914d\u7f6e\u3002")),
!0):!1})).checkDataWarehouseConfig()},Ka=function(){var ab=ka.getModelerModel().getAllTable();return!ab||1<ab.length||1===ab.length&&ka.getModelerModel().getSource(ab[0].getSourceUid()).getSourceType()===Ja.SOURCE_TYPE_MODELSET_FILE_SOURCE?!1:ka.getModelerModel().supportIncrementalMaterialize()},Wa=function(){var ab=new xa;ab.setTables(za);ab.setTableFieldMap(Aa);var Cb=new Q;Cb.setDropdownCreator(function(Fb,Ya,kb){return ab.createJqPopup(Fb,Ya,kb)});Cb.addSelectionListener(function(Fb){var Ya=Fb.getSelectedModel();
Fb=M.getJqUi();Fb.css({left:80,width:150});Sa.hide();Ya.isDeleted()?(Fb.css({left:96,width:134}),Sa.attr("title",Ab.get("basedFieldNotExist","\u5b57\u6bb5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664")),Sa.show()):(Ya=Ya.getField().getOriginalDataType(),ja.DT_INT!==Ya&&ja.DT_DATETIME!==Ya&&(Fb.css({left:96,width:134}),Sa.attr("title",Ab.get("basedFieldTypeFail","\u5b57\u6bb5\u7c7b\u578b\u5fc5\u987b\u4e3a\u65e5\u671f\u65f6\u95f4\u6216\u6574\u6570")),Sa.show()))});Cb.setCustomPainter(function(Fb,
Ya){Fb&&(Fb=Fb.getTableName()+"."+Fb.getField().getAlias(),Ya.attr("title",Fb),Ya.text(Fb))});return Cb},lb=function(){var ab=C.getSchedule(),Cb=ab.getCron();if(x&&x.getSchedule()){var Fb=x.getSchedule().getCron();Db.Period_Custom===ab.getPeriod()&&Cb&&Cb===Fb&&(ab.setCronMsg(ub.getCronCheckingTips()),Fb=new ea(ca,function(Ya){ab.setCronMsg(null);Ta=Ya.cronInterval;Xa=Ya.timingMaterializedConfigMinimumTime},function(Ya,kb){return 20001008===Ya?(ab.setCronMsg(ub.getCronErrorTips()),!0):!1}),Fb.setShowBlocking(!1),
Fb.cronExpression(Cb))}},Eb=function(ab,Cb,Fb){(new ea(ca,function(Ya){Ta=Ya.cronInterval;Xa=Ya.timingMaterializedConfigMinimumTime;if(!Ta){if(Xa)kb=F?Ab.get("cronMinimumIntervalError","\u6267\u884c\u8ba1\u5212\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e#1\u5206\u949f\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002"):Ab.get("cronMinimumIntervalErrorForMetric","\u8868\u8fbe\u5f0f\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e#1\u5206\u949f\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002"),
kb=kb.replace("#1",Xa);else var kb=F?Ab.get("cronIntervalError","\u6267\u884c\u8ba1\u5212\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e1\u5c0f\u65f6\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002"):Ab.get("cronIntervalErrorForMetric","\u8868\u8fbe\u5f0f\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e1\u5c0f\u65f6\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002");N.showPrompt(kb)}Cb&&Cb(Ya.cronData)},function(Ya,kb){var Z=!1;20001008===Ya&&(kb=Ab.get("cronError",
"\u53c2\u6570\u9519\u8bef\uff0c\u8868\u8fbe\u5f0f\u6709\u8bef\u3002"),Z=!0);Fb&&Fb(Ya,kb);return Z})).cronExpression(ab)},Qb=function(ab,Cb){Qa&&Qa.isChecked()?Ra.show():Ra.hide()},Tb=function(ab,Cb){if(Ia&&Ia.isChecked())M&&M.setEnabled(!1);else if(M&&M.setEnabled(!0),!Ka())return M&&M.setEnabled(!1),N.showPrompt(Ab.get("noSupportIncrement","\u5f53\u524d\u6a21\u578b\u4e0d\u652f\u6301\u589e\u91cf\u7269\u5316\u3002")),!1}}function xa(){function ka(){var Oa,M,C,F,x,Aa,za;this.getJqUi=function(){Oa||
U();return Oa.getJqUi()};this.setSelectedModel=function(Ra){Aa=Ra};this.setSelectedModelSetter=function(Ra){za=Ra};this.setSearchText=function(Ra){F=Ra;Sa()};this.setTables=function(Ra){M=Ra;Sa()};this.setTableFieldMap=function(Ra){C=Ra;Sa()};var U=function(){Oa=new Hb;Oa.setBorderVisible(!0);Oa.setCustomItemPainter(ba);Oa.setMultiSelectable(!1);Oa.setCustomSelectedsPainter(Ta);Oa.addPressedListener(function(Ra,Ma){Ra=Ra.getSelecteds()[0];Ra instanceof cb&&za&&za(Ra)})},ba=function(Ra,Ma){if(Ma instanceof
cb){var qa=Ma.getField();Ra.css("margin-left","20px");Ra.addClass("modeler-designer-materialized-field-list-item");Ra.css("cursor","pointer");var w=$("<div>");w.text(qa.getAlias());w.attr("title",qa.getAlias());w.addClass("modeler-designer-materialized-table-field-text");Ra.append(w);Ra.data("model",Ma);qa=qa.getOriginalDataType();w=$("<div>");w.addClass("modeler-designer-materialized-table-field-icon");wb.layoutCtrl(w,10,3,16,16);fa.background(w,qa);w.data("myIconName",qa);w.appendTo(Ra);Aa&&Ma&&
Aa.getField().getFullName()===Ma.getField().getFullName()&&D(Ra,Ma)}else jb(Ra,Ma)},Ta=function(Ra,Ma){for(var qa=0;qa<Ra.length;qa++){var w=Ra[qa];Xa(w,!1)}for(qa=0;qa<Ma.length;qa++)w=Ma[qa],Xa(w,!0)},Xa=function(Ra,Ma){Ra=Ra.find(".modeler-designer-materialized-table-field-icon");"qingTable"===Ra.data("myIconName")&&fa.background(Ra,Ma?"qingTableWhite":"qingTable")},D=function(Ra,Ma){if(0<Ra.height()){var qa=Ra.find(".modeler-designer-materialized-table-field-icon"),w=qa.data("myIconName");fa.background(qa,
w+"_hover");Ra.css("color","#fff");Ra.css("background-color","#88a7f6");Ra.css("background-color","var(--color-lightish, #88a7f6)");Oa.setSelecteds([Ma]);Oa.scrollSelectedToVisible(Ma)}else setTimeout(function(){D(Ra,Ma)},0)},jb=function(Ra,Ma){var qa=$("<div>");wb.layoutCtrl(qa,0,2,16,16);fa.backgroundWithHover(qa,"expanded");qa.appendTo(Ra);var w=$("<div>");wb.layoutCtrl(w,20,3,16,16);fa.background(w,"qingTable");w.data("myIconName","qingTable");w.addClass("modeler-designer-materialized-table-field-icon");
w.appendTo(Ra);w=$("<div>");w.text(Ma.getTableName());w.addClass("modeler-designer-materialized-table-field-text");w.css("left","40px");w.css("font-weight","bold");Ra.on("click",function(sa){sa=$(sa.currentTarget).data("model");var Va=!sa.isExpand();sa.setExpand(Va);fa.backgroundWithHover(qa,Va?"expanded":"expand");Va=Oa.getJqUi().find(".modeler-designer-materialized-field-list-item");for(var Ka=sa.isExpand(),Wa=0;Wa<Va.length;Wa++){var lb=$(Va[Wa]);lb.data("model").getTableId()===sa.getTableId()&&
lb.css("display",Ka?"":"none")}});Ra.data("model",Ma);Ra.append(w)},Sa=function(){if(Oa&&M){for(var Ra=[],Ma=0;Ma<M.length;Ma++){var qa=M[Ma];Ra.push(new eb(qa));if(C){var w=C[qa.getUid()];if(w)for(var sa=0;sa<w.length;sa++)Ra.push(new cb(qa,w[sa],!1))}}if(Ma=F){qa=[];for(w=0;w<Ra.length;w++)sa=Ra[w],sa instanceof eb?(0<qa.length&&qa[qa.length-1]instanceof eb&&qa.splice(qa.length-1),qa.push(sa)):-1<sa.getField().getAlias().toUpperCase().indexOf(Ma)&&qa.push(sa);qa[qa.length-1]instanceof eb&&qa.splice(qa.length-
1);Ra=qa}Oa.setItemModels(Ra,rb);0===Ra.length?(x||(x=$("<div>"),wb.layoutCtrlCenterAlign(x,135),x.css({color:"#c0c0c0",top:"35px","text-align":"center"}),x.appendTo(ca)),Ra=F?Ab.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c"):Ab.get("noSelectField","\u6682\u65e0\u53ef\u9009\u5b57\u6bb5"),x.text(Ra),x.show(),Oa.getJqUi().hide()):(x&&x.hide(),Oa.getJqUi().show())}},rb=function(Ra,Ma){return Ra instanceof eb&&Ma instanceof eb||Ra instanceof cb&&Ma instanceof
cb?Ra.equals(Ma):!1}}var ca,N,Ga,Pa,Qa;this.createJqPopup=function(Oa,M,C){ca=$("<div>");ca.css({"background-color":"#fff",height:"100%",width:"100%"});ca.appendTo(Oa);Pa=new Ha;Pa.setShowSearchIcon(!0);Pa.setPlaceholder(Ab.get("searchField","\u8bf7\u8f93\u5165\u5b57\u6bb5\u540d\u79f0"));Pa.setSearchListenerDelay(800);Pa.addSearchListener(Ia);Oa=Pa.getJqUi();wb.layoutCtrlWithLRTB(Oa,0,0,null,0,null,25);ca.append(Oa);Qa=new ka;Qa.setSelectedModel(M);Qa.setSelectedModelSetter(C);Qa.setTables(N);M=Qa.getJqUi();
wb.layoutCtrlWithLRTB(M,0,0,null,25,0,null);ca.append(M);Qa.setTableFieldMap(Ga);M=30;if(N&&Ga)for(M+=20*N.length,C=0;C<N.length;C++)M+=20*Ga[N[C].getUid()].length;90>=M?M=90:320<M&&(M=320);return[-1,M]};this.setTables=function(Oa){N=Oa};this.setTableFieldMap=function(Oa){Ga=Oa};var Ia=function(){var Oa=$.trim(Pa.getText()).toUpperCase();Qa.setSearchText(Oa)}}function eb(ka){var ca=!0;this.getTableId=function(){return ka.getUid()};this.setExpand=function(N){ca=N};this.isExpand=function(){return ca};
this.getTableName=function(){return ka.getDisplayName()?ka.getDisplayName():ka.getTableName()};this.equals=function(N){return ka.getUid()===N.getTableId()}}function cb(ka,ca,N){this.getField=function(){return ca};this.getTableId=function(){return ka.getUid()};this.getTableName=function(){return ka.getDisplayName()?ka.getDisplayName():ka.getTableName()};this.isDeleted=function(){return N};this.equals=function(Ga){return ka.getUid()===Ga.getTableId()&&ca.equals(Ga.getField())}}"undefined"==typeof com&&
(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var qb=com.kingdee.bos.qing.modeler.designer;qb.MaterializedConfigDialog=function(){Ea.call(this);var ka=this,ca=this.protectedMethod,
N,Ga,Pa,Qa=!1,Ia,Oa;(function(){ca.setTitle(Ab.get("materializedConfig","\u7269\u5316\u5b58\u50a8\u8bbe\u7f6e"));ka.setSize(620,570);ca.setContentPaneCreator(function(){if(!Ia){Ia=$("<div>");Pa=new oa;Pa.setGlobal(N);Pa.setRemoteImpl(Ga);Pa.setSupportIncrementConfig(Qa);Pa.setMessageCurtain(ca.getMessageCurtain());Oa=Pa.getJqUi();Oa.appendTo(Ia);var M=N.getModelerModel();M=M.getMaterializedConfig()?M.getMaterializedConfig().copy():null;Pa.setMaterializedConfig(M)}return Ia});ca.setClosingChecker2(function(M){M=
N.getModelerModel();var C=M.getMaterializedConfig();if(!Pa.checkMaterializedConfig())return!1;var F=Pa.getMaterializedConfig();if(!F&&!C||F&&C&&F.equals(C))return!0;C=new ya;C.setValue(M,F);N.getCommandManager().perform(C);return!0});ca.setClosingAction(function(M){})})();this.setGlobal=function(M){N=M};this.setRemoteImpl=function(M){Ga=M};this.setSupportIncrementConfig=function(M){Qa=M}};var wb,Ab,Vb,Db,ub,Hb,Ea,Na,xb,yb,wa,Q,Ha,Ob,ja,fa,Ja,ea,G,O,ya;(function(){var ka=com.kingdee.bos.qing.common;
wb=ka.DomUtil;ka=com.kingdee.bos.qing.framework.common;Ab=ka.MultilanguageManager.createPackageAccessor(qb);ka=com.kingdee.bos.qing.schedule;Vb=ka.ScheduleSelector;Db=ka.QingSchedule;ub=ka.QingScheduleUtil;ka=com.kingdee.bos.qing.ui.component;Hb=ka.List;Ea=ka.AbstractModalDialog;Na=ka.Label;xb=ka.RadioButtonGroup;yb=ka.RadioButton;wa=ka.HelpIcon;Q=ka.DropdownSelector;Ha=ka.SearchBox;Ob=qb.Table;ja=qb.Field;fa=qb.Icons;Ja=qb.AbstractModelerSource;ea=qb.DesignerFacade;G=qb.MaterializedConfig;O=qb.BasedField;
ya=qb.ActionChangeMaterializedConfig})()})();(function(){function oa(){var M=1,C=[];this.zoomIn=function(){var x=oa.SUPPORT_SCALES.indexOf(M);x<oa.SUPPORT_SCALES.length-1&&(M=oa.SUPPORT_SCALES[x+1],F())};this.zoomOut=function(){var x=oa.SUPPORT_SCALES.indexOf(M);0<x&&(M=oa.SUPPORT_SCALES[x-1],F())};this.autoAdaptScale=function(x,Aa,za,U){x=Math.max(x/M/za,Aa/M/U);if(1>x)1>M&&(M=1,F());else{x=1/x;Aa=[];for(za=0;za<oa.SUPPORT_SCALES.length;za++)Aa.push(oa.SUPPORT_SCALES[za]);Aa.sort();for(za=0;za<Aa.length;za++)if(x<Aa[za]){x=Aa[za];break}M=x;
F()}};this.isMinScale=function(){return oa.SUPPORT_SCALES[0]==M};this.isMaxScale=function(){return oa.SUPPORT_SCALES[oa.SUPPORT_SCALES.length-1]==M};this.getRatio=function(){return M};this.setCustomRatio=function(x){M=x};this.getScaledSize=function(x){return 1==M?x:M*x};this.getRawSize=function(x){return 1==M?x:x/M};this.getScaledCoordinate=function(x){return 1==M?x:[M*x[0],M*x[1]]};this.getRawCoordinate=function(x){return 1==M?x:[x[0]/M,x[1]/M]};this.addPropertyChangedListener=function(x){C.push(x)};
var F=function(){for(var x=0;x<C.length;x++){var Aa=C[x];Aa&&Aa()}}}function xa(){var M=new wa,C,F=this,x,Aa,za,U,ba,Ta,Xa,D={},jb={},Sa,rb=!1;this.create=function(w,sa){x=sa;C||(C=M.createNode("svg"),sa=Sa.getScaledSize(w.getWidth()),w=Sa.getScaledSize(w.getHeight()),M.setAttributes(C,{width:sa,height:w}),x[0].appendChild(C))};this.setScaleHelper=function(w){Sa=w};this.setTransformNodeCreator=function(w){za=w};this.setNodeOperateCreator=function(w){U=w};this.setNodeRelinkHelper=function(w){Ta=w};
this.setNodeStatusMonitor=function(w){Xa=w};this.setGlobal=function(w){Aa=w};this.clear=function(){C&&C.remove();C=null;ba&&ba.release()};this.addNodeUi=function(w){if(C){var sa=Q.create(w,Sa,Aa),Va=w.getId();Ra(w,sa);D[Va]=sa}};this.removeNode=function(w){w=w.getId();var sa=D[w];sa&&(sa.remove(),za.release(),D[w]=null)};this.renameNode=function(w,sa){var Va=w.getId();if(Va=D[Va])ba||(ba=new G),ba.setCallback(sa),ba.hook(w,Va,x)};this.getTransformCreatorMark=function(){return za.getMark()};this.changeNodePosition=
function(w){var sa=w.getId();if(sa=D[sa])sa.changePosition(w.getX(),w.getY()),za.release(),za.hook(w,C),ba&&ba.release()};this.changeNodeDisplayName=function(w){w=w.getId();(w=D[w])&&w.changeNodeDisplayName()};this.addSelectedNodeUi=function(w){var sa=w.getId();if(sa=D[sa])sa.setSelected(!0),sa.remove(),Ra(w,sa),sa.isHover()&&Ma(w)};this.cleanSelectedUi=function(){var w=Object.keys(D);za.release();for(var sa=0,Va=w.length;sa<Va;sa++){var Ka=w[sa];(Ka=D[Ka])&&Ka.setSelected(!1)}w=Object.keys(jb);sa=
0;for(Va=w.length;sa<Va;sa++)Ka=w[sa],(Ka=jb[Ka])&&Ka.setSelected(!1)};this.getNodeIdFromUi=function(w){return w.attr("id")};this.getNodeUiMark=function(){return ka.NODE_UI_CLASS};this.getNodeOperateUiMark=function(){return ka.NODE_OPERATE_ICON_CLASS};this.getNodeNameUiMark=function(){return ka.NODE_NAME_UI_CLASS};this.showNodeOperateSelector=function(){U&&U.showOperateList()};this.setNodeHover=function(w){var sa=w.getId();if(sa=D[sa])sa.setHover(!0),Ra(w,sa),rb=!0,U.hook(w,x,sa.getOperateIconUi()),
za.hook(w,C),Ma(w)};this.cleanHoverUi=function(){if(rb){for(var w=Object.keys(D),sa=0,Va=w.length;sa<Va;sa++){var Ka=D[w[sa]];Ka&&Ka.setHover(!1);za.release();Ta.release();console.log("leave")}rb=!1}};this.setInvalidNodeUi=function(w,sa){w=w.getId();(w=D[w])&&w.setInvalid(!0,sa)};this.cleanInvalidNodeUi=function(){for(var w=Object.keys(D),sa=0,Va=w.length;sa<Va;sa++){var Ka=D[w[sa]];Ka&&Ka.setInvalid(!1)}};this.setFieldCount=function(w,sa){w=w.getId();(w=D[w])&&w.setFieldCount(sa)};var Ra=function(w,
sa){sa=sa.getSvgElement();M.addClass(sa,F.getNodeUiMark());w=w.getId();sa.setAttribute("id",w);C.appendChild(sa)},Ma=function(w){Xa.getInvalidState(w)instanceof ya&&Ta.hook(w,C)};this.addLineUi=function(w,sa,Va){C&&(sa=new fa(sa,Va),sa.setScaleHelper(Sa),Va=w.getId(),jb[Va]=sa,qa(w,sa))};this.updateLineUi=function(w){var sa=jb[w.getId()];sa&&(sa.remove(),qa(w,sa))};this.changeLinePosition=function(w){(w=jb[w.getId()])&&w.changePosition()};this.removeLine=function(w){w=w.getId();var sa=jb[w];sa&&(jb[w]=
null,sa.remove())};this.addSelectedLineUi=function(w){var sa=jb[w.getId()];sa&&(sa.setSelected(!0),sa.remove(),qa(w,sa))};var qa=function(w,sa){w=w.getId();sa=sa.getSvgElement();sa.setAttribute("id",w);C.appendChild(sa)}}function eb(){this.adaptSize=function(M){var C=M.getPage();var F=M.getAllNodes(),x=M.getPage();if(1>F.length)var Aa=[0,0,x.getWidth(),x.getHeight()];else{var za=F[0];x=za.getX();var U=za.getY();Aa=x+za.getWidth();za=U+za.getHeight();for(var ba=1;ba<F.length;ba++){var Ta=F[ba];x=Math.min(x,
Ta.getX());U=Math.min(U,Ta.getY());Aa=Math.max(Aa,Ta.getX()+Ta.getWidth());za=Math.max(za,Ta.getY()+Ta.getHeight())}Aa=[x-100,U-100,Aa+100,za+100]}U=C.getWidth();za=C.getHeight();F=-Aa[0];x=-Aa[1];U=Aa[2]-U;Aa=Aa[3]-za;if(0!=F||0!=U||0!=x||0!=Aa){if(0!=F||0!=x)for(M=M.getAllNodes(),za=0;za<M.length;za++)ba=M[za],ba.setPosition(ba.getX()+F,ba.getY()+x);C.setExtension(F,x,U,Aa);return!0}return!1}}function cb(){var M,C,F,x,Aa,za,U,ba;this.startDrag=function(rb,Ra){console.log("start drag page");Aa=Ra;
C=[rb.clientX,rb.clientY];F=(rb=Aa.position())?[rb.left,rb.top]:[0,0];za=$("<div>");za.css("z-index",999999);za.appendTo($(document.body));za.css("cursor","move");ub.layoutCtrlWithLRTB(za,0,0,null,0,0,null);za.on("mousemove",Ta);za.on("mouseup",Xa);za.on("mouseleave",D)};this.setMovableArea=function(rb){x=rb};this.setGlobal=function(rb){U=rb};this.setScaleHelper=function(rb){ba=rb};var Ta=function(rb){var Ra=rb.clientX-C[0];rb=rb.clientY-C[1];if(M)var Ma=!0;else Ma=Math.abs(rb),Ma=5<Math.abs(Ra)||
5<Ma?M=!0:!1;Ma&&Aa.css({left:Sa(F[0]+Ra,!0)+"px",top:Sa(F[1]+rb,!1)+"px"})},Xa=function(rb){jb()},D=function(rb){jb()},jb=function(){console.log("destroy drag page");za.css("cursor","default");za&&za.remove();za=null},Sa=function(rb,Ra){if(Ra){Ra=9999;var Ma=Aa.width();var qa=x.width()}else Ra=9999,Ma=Aa.height(),qa=x.height();Ra=ba.getScaledSize(Ra);var w=Ma>Ra;Ra=0<rb?w?0:Math.min(rb,Ra-Ma):w?Math.max(rb,qa-Ma):Math.max(rb,qa-Ra);Ra!=rb&&U.getMessageCurtain().showPrompt(Hb.get("svgMaxSize","\u5df2\u8fbe\u5230\u7ed8\u5236\u533a\u57df\u6700\u5927\u5c3a\u5bf8\u3002"));
return Ra}}function qb(){var M,C,F,x,Aa,za,U,ba,Ta=!1,Xa,D;this.setTarget=function(w){F=w};this.setScaleHelper=function(w){D=w};this.setModelerModel=function(w){Xa=w};this.setMovableArea=function(w){M=w};this.startDrag=function(w){console.log("start drag");ba=new Ja;ba.prepare(Xa,M,D);C=[w.clientX,w.clientY];x=$("<div>");x.css("z-index",999999);x.appendTo($(document.body));ub.layoutCtrlWithLRTB(x,0,0,null,0,0,null);x.on("mousemove",jb);x.on("mouseup",Sa);x.on("mouseleave",Ma)};this.setEndMoveCallback=
function(w){za=w};var jb=function(w){if(Ta)var sa=!0;else sa=Math.abs(w.clientY-C[1]),sa=5<Math.abs(w.clientX-C[0])||5<sa?Ta=!0:!1;if(sa){if(!Aa){Aa=$("<div>");Aa.addClass("modeler-dragdrop-mask");Aa.appendTo(M);var Va=F.getX(),Ka=F.getY(),Wa=F.getWidth();sa=F.getHeight();U=[Va,Ka];Va=D.getScaledCoordinate(U);Wa=D.getScaledSize(Wa);sa=D.getScaledSize(sa);ub.layoutCtrl(Aa,Va[0],Va[1],Wa,sa)}w=Ra(w);rb(w);w=D.getScaledCoordinate(w);ub.layoutCtrl(Aa,w[0],w[1],null,null)}},Sa=function(w){Aa&&(w=Ra(w),
rb(w),za&&za(w[0],w[1]));qa()},rb=function(w){if(Aa){var sa=D.getRawSize(Aa.width()),Va=D.getRawSize(Aa.height()),Ka=D.getRawCoordinate(w);sa=[Ka[0],Ka[1],sa,Va];ba.anchor(sa);w[0]=sa[0];w[1]=sa[1]}},Ra=function(w){var sa=w.clientX-C[0];w=w.clientY-C[1];var Va=D.getScaledCoordinate(U);return[Va[0]+sa,Va[1]+w]},Ma=function(w){qa()},qa=function(){console.log("destroy");x&&(x.off("mousemove",jb),x.off("mouseup",Sa),x.off("mouseleave",Ma),x.remove(),x=null);Aa&&(Aa&&Aa.remove(),Aa=null);ba&&ba.abort()}}
function wb(){var M,C,F,x,Aa,za;this.getJqUi=function(){if(!M){M=$("<div>");M.addClass("modeler-designer-page-toolbar");za=$("<div>");za.addClass("modeler-designer-ratio-text");Xa();za.appendTo(M);var Sa=ba(),rb=Ta(),Ra=U();x=$("<div>");x.on("click",jb);x.attr("title",Hb.get("overallView","\u5168\u5c40\u89c6\u56fe"));Db.Icons.backgroundWithHover(x,"upArrow");x.css("cursor","pointer");var Ma=x;var qa=5;ub.layoutCtrl(Ma,qa,5,16,16);ub.layoutCtrl(Ra,qa+=26,5,16,16);ub.layoutCtrl(rb,qa+=26,5,16,16);ub.layoutCtrl(Sa,
qa+=26,5,16,16);ub.layoutCtrl(za,qa+26,0,35,25);M.append(Ra);M.append(rb);M.append(Sa);M.append(Ma)}return M};this.getUiMark=function(){return"modeler-designer-page-toolbar"};this.manage=function(Sa,rb){C=Sa;C.addPropertyChangedListener(Xa);F=rb};this.setGlobal=function(Sa){Aa=Sa};var U=function(){var Sa=$("<div>");Sa.on("click",function(rb){(new Ab).autoLayout(Aa)});Sa.attr("title",Hb.get("autoLayout","\u81ea\u52a8\u5e03\u5c40"));Db.Icons.backgroundWithHover(Sa,"layout");Sa.css("cursor","pointer");
return Sa},ba=function(){var Sa=$("<div>");Db.Icons.backgroundWithHover(Sa,"zoomOut");Sa.on("click",function(){C.zoomOut()});Sa.attr("title",Hb.get("zoomOut","\u7f29\u5c0f"));Sa.css("cursor","pointer");return Sa},Ta=function(){var Sa=$("<div>");Db.Icons.backgroundWithHover(Sa,"zoomIn");Sa.on("click",function(){C.zoomIn()});Sa.attr("title",Hb.get("zoomIn","\u653e\u5927"));Sa.css("cursor","pointer");return Sa},Xa=function(){var Sa=C?C.getRatio():1;Sa=parseInt(100*Sa)+"%";za.text(Sa);za.attr("title",
Hb.get("currentRatio","\u5f53\u524d\u6bd4\u4f8b#1").replace("#1",Sa))},D=!1,jb=function(){var Sa=parseInt(M.css("bottom"))+M.height()+5,rb=parseInt(M.css("left"));F.setPosition(rb,null,null,Sa);D?(Db.Icons.backgroundWithHover(x,"upArrow"),F.show(!1),D=!1):(Db.Icons.backgroundWithHover(x,"downArrow"),F.show(!0),D=!0)}}function Ab(){var M={},C=0,F,x,Aa=[],za,U;this.autoLayout=function(jb){F=jb;x=F.getModelerModel();za=[];U=[];jb=x.getAllNodes();for(var Sa=0;Sa<jb.length;Sa++){var rb=jb[Sa],Ra=x.getRelatedLine(rb,
Na.GET_LINE_STRATEGY_IN);Ra&&0!=Ra.length||za.push(rb);(Ra=x.getRelatedLine(rb,Na.GET_LINE_STRATEGY_OUT))&&0!=Ra.length||U.push(rb)}for(jb=0;jb<za.length;jb++)Ta(za[jb],0);for(jb=0;jb<U.length;jb++){Sa=U[jb];a:{rb=Sa;for(Ra=0;Ra<Aa.length;Ra++)if(-1<Aa[Ra].indexOf(rb)){rb=!0;break a}rb=!1}rb||(rb=[],ba(Sa,rb),Aa.push(rb))}for(Sa=jb=0;Sa<Aa.length;Sa++)for(rb=Aa[Sa],Ra=0;Ra<rb.length;Ra++)Xa[rb[Ra].getId()]=[0,jb],jb+=120;D(1);jb=new Oa;jb.setCaption(Hb.get("autoLayout","\u81ea\u52a8\u5e03\u5c40"));
jb.setValue(x,Xa);F.getCommandManager().perform(jb)};var ba=function(jb,Sa){if(jb){var rb=x.getRelatedLine(jb,Na.GET_LINE_STRATEGY_IN);if(rb&&0!=rb.length)for(jb=0;jb<rb.length;jb++)ba(x.getNode(rb[jb].getFromId()),Sa);else Sa.push(jb)}},Ta=function(jb,Sa){C=Math.max(C,Sa);var rb=jb.getId(),Ra=M[rb];M[rb]=void 0==Ra?Sa:Math.max(Ra,Sa);(jb=x.getNextNode(jb))&&Ta(jb,++Sa)},Xa={},D=function(jb){if(!(jb>C)){for(var Sa=Object.keys(M),rb=0;rb<Sa.length;rb++){var Ra=Sa[rb];if(M[Ra]==jb){var Ma=x.getNode(Ra),
qa=x.getRelatedLine(Ma,Na.GET_LINE_STRATEGY_IN),w=0,sa=0;if(1==qa.length){var Va=x.getNode(qa[0].getFromId()),Ka=Xa[Va.getId()];w=Ka[1]+(Va.getHeight()-Ma.getHeight()>>1);sa=Ka[0]+Va.getWidth()}else if(1<qa.length){for(var Wa=w=0;Wa<qa.length;Wa++)Va=x.getNode(qa[Wa].getFromId()),Ka=Xa[Va.getId()],sa=Math.max(sa,Ka[0]+Va.getWidth()),w+=Ka[1]+(Va.getHeight()>>1);w=w/qa.length-(Ma.getHeight()>>1)}Xa[Ra]=[sa+100,w]}}D(++jb)}}}function Vb(){var M=this,C,F,x,Aa,za=!1,U,ba,Ta,Xa,D,jb,Sa;this.setContainer=
function(Ka){U=Ka};this.manageViewPosition=function(Ka,Wa){D=Ka;jb=Wa};this.show=function(Ka){za=Ka;C||Ra();za?(C.show(),rb()):C.hide()};this.setGlobal=function(Ka){F=Ka};this.init=function(Ka){x&&x.removePropertyChangeCallback(Va);x=Ka;x.addPropertyChangeCallback(Va)};this.setPosition=function(Ka,Wa,lb,Eb){C||Ra();ub.layoutCtrlWithLRTB(C,Ka,Wa,null,lb,Eb,null)};this.getUiMark=function(){return"modeler-designer-overall-view"};var rb=function(){if(za){Aa&&Aa.clear();var Ka=x.getPage(),Wa=Ka.getWidth();
var lb=Ka.getHeight();1.5<Wa/lb?(Ka=240/Wa,Wa=240,lb*=Ka):(Ka=160/lb,lb=160,Wa*=Ka);lb=[Ka,Wa,lb];Wa=lb[0];Ka=lb[1];lb=lb[2];ub.layoutCtrl(ba,240-Ka>>1,160-lb>>1,Ka,lb);Ka=Aa;lb=Ka.setScaleHelper;Ta||(Ta=new oa);Ta.setCustomRatio(Wa);lb.call(Ka,Ta);Aa.create(x.getPage(),ba);Wa=x.getAllNodes();for(Ka=0;Ka<Wa.length;Ka++){lb=Wa[Ka];Aa.addNodeUi(Wa[Ka]);var Eb=x.getRelatedLine(lb,Na.GET_LINE_STRATEGY_OUT);Eb&&0<Eb.length&&(Eb=Eb[0],Aa.addLineUi(Eb,lb,x.getNode(Eb.getToId())))}}},Ra=function(){C=$("<div>");
C.addClass(M.getUiMark());C.css({position:"absolute",width:"240px",height:"160px"});C.appendTo(U);Xa=$("<div>");ub.layoutCtrlWithLRTB(Xa,0,0,null,0,0,null);Xa.appendTo(C);Xa.css("z-index",99);ba=$("<div>");ba.appendTo(C);x&&(Aa=new xa,Aa.setGlobal(F),C.on("mousedown",Ma))},Ma=function(Ka){Sa||(Sa=$("<div>"),Sa.addClass("modeler-designer-overall-view-capture"),Sa.appendTo(Xa));Sa.show();var Wa=D.width(),lb=D.height(),Eb=jb.width(),Qb=jb.height(),Tb=ba.width(),ab=ba.height();Sa.css({width:Tb/Eb*Wa+
"px",height:ab/Qb*lb+"px"});Wa=ub.getCurrentTargetPosition(Ka);Wa=ub.upwardCoordinate(Ka.target,Wa,C[0]);w(Wa);C.css("cursor","move");C.on("mousemove",qa);C.on("mouseup",sa);C.on("mouseleave",sa)},qa=function(Ka){var Wa=ub.getCurrentTargetPosition(Ka);Wa=ub.upwardCoordinate(Ka.target,Wa,C[0]);w(Wa);Wa=Sa.position();var lb=ba.position();Ka=lb.left-Wa.left;Wa=lb.top-Wa.top;lb=D.width()/Sa.width();ub.layoutCtrl(jb,Ka*lb,Wa*lb,null,null)},w=function(Ka){ub.layoutCtrl(Sa,Ka[0]-(Sa.width()>>1),Ka[1]-(Sa.height()>>
1),null,null)},sa=function(){Sa.hide();C.css("cursor","default");C.off("mousemove",qa);C.off("mouseup",sa);C.off("mouseleave",sa)},Va=function(Ka,Wa){if(Ka==Na.KEY_ADD_NODE||Ka==Na.KEY_REMOVE_NODE||Ka==Ea.KEY_PAGE_SIZE||Ka==Na.KEY_NODE_CHANGE_POSITION||Ka==Na.KEY_ADD_LINE||Ka==Na.KEY_REMOVE_LINE||Ka==Na.KEY_NODE_CHANGE_ALIAS||Ka==Na.KEY_NODE_RELAYOUT||Ka==Ea.KEY_TABLE_NODE_SELECT_FIELD)console.log("update overall view"),rb()}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee=
{});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var Db=com.kingdee.bos.qing.modeler.designer;Db.PageArea=function(){var M,C,F,x,Aa,za,U,ba,Ta,Xa=new eb,D=new Vb,jb,Sa;this.getJqUi=function(){F||rb();return F};this.setFunUpdateTableArea=
function(T){Sa=T};this.setModelerModel=function(T){U&&U.removePropertyChangeCallback(Wa);U=T;U.addPropertyChangeCallback(Wa);Db.NodeHelper.setModeler(T);Db.LineCoordinateHelper.setModelerModel(T);D.init(U);qa();Fb()};this.repaint=function(){qa();Fb()};this.setGlobal=function(T){M=T};this.setRemoteImpl=function(T){C=T};this.setNodeStatusMonitor=function(T){za&&(za.removeSelectNodeListener(Qb),za.removeInvalidNodeChangeListener(ab));za=T;za.addSelectNodeListener(Qb);za.addInvalidNodeChangeListener(ab);
Db.NodeHelper.setNodeStatusMonitor(za)};this.setModelerChecker=function(T){Db.NodeHelper.setModelerChecker(T)};this.setDragHandler=function(T){Aa=T};var rb=function(){F=$("<div>");F.on("mousedown",Z);F.on("mousemove",hb);F.addClass("modeler-designer-page");$(document.body).on("keydown",ha);Db.SvgTextTrimer.init();Db.NodeResultCache.addCacheChangeListener(function(q,H){Eb(U.getNode(q),H.length)});Ra();Ma();D.setContainer(F);D.setGlobal(M);jb=new wb;jb.manage(Ta,D);jb.setGlobal(M);var T=jb.getJqUi();
F.append(T);x=$("<div>");x.appendTo(F);ub.layoutCtrlWithLRTB(x,0,0,null,0,0,null);Aa.bindDropUi(x,w,sa,Va,Ta);U&&Cb();D.manageViewPosition(F,x)},Ra=function(){Ta=new oa;Ta.addPropertyChangedListener(function(){var T=x.width(),q=x.height();qa();var H=x.width(),P=x.height(),La=x.position();ub.layoutCtrl(x,La.left+(T-H>>1),La.top+(q-P>>1),null,null)})},Ma=function(){var T=new Ha;T.setScaleHelper(Ta);T.addSelectedCallback(function(P,La){P.getNodeCreator()(La,M,function(ma){var ra=ma.isMultiInDegree()?
ma.getExtraFromNode():null,ta=new N;ta.setValue(ma,La,ra,U);M.getCommandManager().perform(ta)})});var q=new Ob;q.setScaleHelper(Ta);q.addSelectedCallback(function(P,La){P.getType()==ea.TYPE_DELETE?(P=new Ga,P.setValue(La,U),M.getCommandManager().perform(P)):P.getType()==ea.TYPE_RENAME&&ba.renameNode(La,Nb)});var H=new ja;H.setScaleHelper(Ta);H.setGlobal(M);H.setLinkCallback(function(P,La){var ma=new Pa;ma.setValue(P,La);M.getCommandManager().perform(ma)});ba=new xa;ba.setNodeOperateCreator(q);ba.setTransformNodeCreator(T);
ba.setScaleHelper(Ta);ba.setNodeRelinkHelper(H);ba.setNodeStatusMonitor(za);ba.setGlobal(M)},qa=function(){ba&&ba.clear();Cb();for(var T=U.getAllNodes(),q=0;q<T.length;q++){var H=T[q];ba.addNodeUi(T[q]);var P=U.getRelatedLine(H,Na.GET_LINE_STRATEGY_OUT);P&&0<P.length&&(P=P[0],ba.addLineUi(P,H,U.getNode(P.getToId())))}(q=za.getSelected())&&Tb(q);if(T=za.getInvalidNodes())for(q=0;q<T.length;q++)ba.setInvalidNodeUi(T[q],za.getInvalidPrompt(T[q]))},w=function(){var T=[0,0];T=ub.upwardCoordinate(F[0],
T,document.body);var q=[F.prop("clientWidth"),F.prop("clientHeight")];q=ub.upwardCoordinate(F[0],q,document.body);return new function(H,P,La,ma){this.getLeft=function(){return H};this.getRight=function(){return P};this.getTop=function(){return La};this.getBottom=function(){return ma}}(T[0],q[0],T[1],q[1])},sa=function(T,q,H){var P=ub.getCurrentTargetPosition(T);P=ub.upwardCoordinate(T.target,P,document.body);T=P[0];P=P[1];if(T<q.getLeft()||T>q.getRight()||P<q.getTop()||P>q.getBottom())return null;
q=[0,0];q=ub.upwardCoordinate(x[0],q,document.body);T-=q[0];q=P-q[1];T-=parseInt(Ta.getScaledSize(H.getWidth())>>1);q-=parseInt(Ta.getScaledSize(H.getHeight())>>1);q=Ta.getRawCoordinate([T,q]);H.setPosition(q[0],q[1]);return new yb(x,U)},Va=function(T,q){var H=T.getTableNode();T=T.getTable();var P=T.getSourceUid();P=U.getSource(P);H=new O(C,P,H,T,U);H.setFunUpdateTableArea(Sa);H.setGlobal(M);H.setFunFinishCallback(q);H.setAddNodeCallback(Ka);H.checkBeforeLoadField()},Ka=function(T,q){var H=T.getSelectedFields();
if(H){var P=(new Date).getTime();Db.NodeResultCache.cacheOneNodeField(T.getId(),H,P)}H=new ca;H.setValue(T,q,U);M.getCommandManager().perform(H)},Wa=function(T,q){if(T==Na.KEY_ADD_NODE)lb(q),(T=Xa.adaptSize(U))||ba.addNodeUi(q);else if(T==Na.KEY_REMOVE_NODE){var H=q.getRemovedNode();(T=Xa.adaptSize(U))||ba.removeNode(H);console.log("remove")}else if(T==Ea.KEY_PAGE_SIZE){qa();T=x.position();H=Ta.getScaledSize(q.getLeftExtension());var P=Ta.getScaledSize(q.getTopExtension());ub.layoutCtrl(x,T.left-
H,T.top-P,null,null);console.log("resize")}else if(T==Na.KEY_NODE_CHANGE_POSITION){if(T=Xa.adaptSize(U),!T)for(ba.changeNodePosition(q),H=U.getRelatedLine(q,Na.GET_LINE_STRATEGY_ALL),T=0,P=H.length;T<P;T++)ba.changeLinePosition(H[T])}else if(T==Na.KEY_ADD_LINE)(T=U.getFromToNode(q))&&ba.addLineUi(q,T[0],T[1]);else if(T==Na.KEY_REMOVE_LINE)ba.removeLine(q);else if(T==Na.KEY_NODE_CHANGE_ALIAS)ba.changeNodeDisplayName(q);else if(T==Na.KEY_TRANSFORM_JOIN)console.log("change node relation"),H=q.getConfig(),
T=U.getNode(H.getLeft()),H=U.getNode(H.getRight()),H=[T,H],Db.NodeHelper.reHandleNodeRelation(q,H);else if(T==Na.KEY_TRANSFORM_UNION){P=q.getConfig().getNodeItems();H=[];for(T=0;T<P.length;T++){var La=U.getNode(P[T].getNodeId());H.push(La)}Db.NodeHelper.reHandleNodeRelation(q,H)}else T==Na.KEY_NODE_RELAYOUT?((T=Xa.adaptSize(U))||qa(),Ya(),Fb()):T==Ea.KEY_TABLE_NODE_SELECT_FIELD&&((T=q.getSelectedFields())?Eb(q,T.length):Db.NodeFieldHelper.asynGetFields(U,q,function(ma){Eb(q,ma.length)}))},lb=function(T){var q=
Ta.getScaledSize(T.getX()),H=Ta.getScaledSize(T.getY()),P=Ta.getScaledSize(T.getWidth());T=Ta.getScaledSize(T.getHeight());var La=x.position(),ma=La.left;La=La.top;var ra=F.width(),ta=F.height(),db=0,fb=0;0>q+ma?db=-(q+ma)+30:q+ma+P>ra&&(db=ra-(q+ma+P)-30);0>H+La?fb=-(H+La)+30:H+La+T>ta&&(fb=ta-(H+La+T)-30);0==db&&0==fb||ub.layoutCtrl(x,ma+db,La+fb,null,null)},Eb=function(T,q){T instanceof xb&&ba.setFieldCount(T,q)},Qb=function(T,q){ba.cleanSelectedUi();q&&Tb(q)},Tb=function(T){if(U.getNode(T.getId())){var q=
U.getRelatedLine(T,Na.GET_LINE_STRATEGY_ALL);if(q)for(var H=0;H<q.length;H++)ba.addSelectedLineUi(q[H]);ba.addSelectedNodeUi(T)}},ab=function(T){ba.cleanInvalidNodeUi();for(var q=0;q<T.length;q++){var H=T[q];ba.setInvalidNodeUi(H,za.getInvalidPrompt(H))}},Cb=function(){var T=U.getPage(),q=Ta.getScaledSize(T.getWidth()),H=Ta.getScaledSize(T.getHeight());ub.layoutCtrl(x,null,null,q,H);ba.create(T,x)},Fb=function(){var T=U.getPage(),q=Ta.getScaledSize(T.getWidth()),H=Ta.getScaledSize(T.getHeight());
setTimeout(function(){ub.layoutCtrl(x,-(q-F.width()>>1),-(H-F.height()>>1),null,null)},0)},Ya=function(){var T=U.getPage(),q=Ta.getScaledSize(T.getWidth());T=Ta.getScaledSize(T.getHeight());Ta.autoAdaptScale(q,T,F.width(),F.height())},kb,Z=function(T){var q=$(T.target);if(!(ub.upwardSearchHasClass(q,F,ba.getTransformCreatorMark())||ub.upwardSearchHasClass(q,F,jb.getUiMark())||ub.upwardSearchHasClass(q,F,D.getUiMark())))if(ub.upwardSearchHasClass(q,F,ba.getNodeOperateUiMark()))ba.showNodeOperateSelector(),
T.stopPropagation();else if(q=ub.upwardSearchHasClass(q,F,ba.getNodeUiMark())){q=ba.getNodeIdFromUi(q);var H=U.getNode(q);za.setSelected(H);var P=new qb;P.setTarget(H);P.setEndMoveCallback(function(La,ma){var ra=new Qa;ra.setValue(H,[La,ma]);M.getCommandManager().perform(ra)});P.setMovableArea(x);P.setScaleHelper(Ta);P.setModelerModel(U);P.startDrag(T);kb==q?(Mb(T),kb=null):(kb=q,setTimeout(function(){kb=null},1E3))}else q=new cb,q.setMovableArea(F),q.setGlobal(M),q.setScaleHelper(Ta),q.startDrag(T,
x)},ha=function(T){if("Delete"==T.key||46==T.keyCode){T=new Ga;var q=za.getSelected();q&&(T.setValue(q,U),M.getCommandManager().perform(T))}},hb=function(T){T=$(T.target);if(!ub.upwardSearchHasClass(T,F,D.getUiMark())){var q=ub.upwardSearchHasClass(T,F,ba.getNodeUiMark());if(q){T=ba.getNodeIdFromUi(q);T=U.getNode(T);if(q=U.getRelatedLine(T,Na.GET_LINE_STRATEGY_ALL))for(var H=0;H<q.length;H++)ba.updateLineUi(q[H]);ba.setNodeHover(T)}else ub.upwardSearchHasClass(T,F,ba.getTransformCreatorMark())||ba.cleanHoverUi()}},
Mb=function(T){T=$(T.target);if(T=ub.upwardSearchHasClass(T,F,ba.getNodeNameUiMark()))if(T=ub.upwardSearchHasClass(T,F,ba.getNodeUiMark()))T=ba.getNodeIdFromUi(T),T=U.getNode(T),ba.renameNode(T,Nb)},Nb=function(T,q){var H;q=$.trim(q);var P=/^[\u3000\u4E00-\u9FA5a-zA-Z0-9_]{1,}$/;0==q.length?H=Hb.get("nameIsEmpty","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a"):50<$.trim(q).length?H=Hb.get("nameTooLong","\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26"):Db.DisplayNameHelper.isDuplicate(q,
T)?H=Hb.get("duplicateName","\u540d\u79f0\u91cd\u590d"):q.match(P)||(H=Hb.get("invalidNodeName","\u8282\u70b9\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210"));H?(H=Hb.get("modifyAbandoned","#1\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002").replace("#1",H),M.getMessageCurtain().showPrompt(H)):(H=new Ia,H.setValue(T,q),M.getCommandManager().perform(H))}};var ub,Hb,Ea,Na,xb,yb,wa,Q,Ha,Ob,ja,fa,Ja,ea,G,O,ya,ka,ca,N,Ga,Pa,Qa,Ia,Oa;(function(){var M=
com.kingdee.bos.qing.common;ub=M.DomUtil;M=com.kingdee.bos.qing.framework.common;Hb=M.MultilanguageManager.createPackageAccessor(Db);yb=Db.DragInsideCheckResult;wa=Db.Svg;Q=Db.NodeUIFactory;Ea=Db.ModelerModel;Na=Db.TableModeler;xb=Db.TableNode;Ha=Db.TransformNodeCreator;Ob=Db.NodeOperateCreator;ja=Db.NodeRelinkHelper;fa=Db.LineUi;ka=Db.AbstractNodeUI;Ja=Db.DraggingAnchor;ea=Db.NodeOperateType;G=Db.NodeRenameHelper;ca=Db.ActionAddTableNode;N=Db.ActionAddTransformNode;Ga=Db.ActionRemoveNode;Pa=Db.ActionLinkNode;
Qa=Db.ActionMoveNode;Ia=Db.ActionNodeRename;Oa=Db.ActionRelayout;O=Db.FieldSelectDialog;ya=Db.LackInputState})();oa.SUPPORT_SCALES=[.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5]})();(function(){function oa(){var M=this,C,F,x,Aa,za,U,ba,Ta,Xa,D,jb,Sa,rb,Ra,Ma,qa,w,sa,Va;this.setGlobal=function(q){Aa=q};this.setNodeStatusMonitor=function(q){U&&U.removeSelectNodeListener(ab);U=q;U.addSelectNodeListener(ab);qb.NodeFieldHelper.setNodeStatusMonitor(U)};this.setModelerChecker=function(q){ba=q};this.updateModelerModel=function(){if(Ra){var q=Aa.getModelerModel();za&&za.removePropertyChangeCallback(T);za=q;za.addPropertyChangeCallback(T);q=za;var H=new Qa;H.init(q);com.kingdee.bos.qing.modeler.designer.DisplayNameHelper.registerImpl(H);
qb.UIDHelper.init(za);Ra.setModelerModel(za);Sa.setModelerModel(za);qa.setModelerModel(za);Ma.setModelerModel(za);Ya()}};this.setRemoteImpl=function(q){F=q};var Ka=!0;this.resize=function(){Qb();Ta&&Ta.resize();qa.afterResize(!0);var q=0<document.body.clientHeight;!Ka&&q&&setTimeout(function(){Ra.repaint()},0);Ka=q};this.getJqUi=function(){C||Wa();return C};this.showDialogIfNoSource=function(){Sa&&Sa.showDialogIfNoSource()};var Wa=function(){C=$("<div>");C.addClass("modeler-designer-main");x=new ea;
lb();Ma=new ja;Ma.setGlobal(Aa);Ma.setNodeStatusMonitor(U);Ma.setHideListener(function(){Tb=!0;Fb(!0);Xa.collapseSecondHalf(!0);Ma.show(!1)});Ra=new fa;Ra.setDragHandler(x);Ra.setGlobal(Aa);Ra.setNodeStatusMonitor(U);Ra.setRemoteImpl(F);Ra.setModelerChecker(ba);Ra.setFunUpdateTableArea(function(q,H){rb&&rb.updateNodeStatus(q,H)});qa=new Ja;qa.setNodeStatusMonitor(U);qa.setRemoteImpl(F);qa.setGlobal(Aa);qa.setModelerChecker(ba);qa.setHideListener(function(){Z=!0;hb(!0);Nb(!0);qa.show(!1)});Eb();M.updateModelerModel()},
lb=function(){Sa=new Q;Sa.setGlobal(Aa);Sa.setRemoteImpl(F);rb=new Ob;rb.setGlobal(Aa);rb.setRemoteImpl(F);rb.setDragHandler(x);rb.setTableNodeCreator(function(q){return Pa.createTableNode(q)});Ha.setSourceArea(Sa);Ha.setTableArea(rb);Ha.setRemoteImpl(F);Ha.setGlobal(Aa)},Eb=function(){D=new Vb;D.setHorizontalSplit(!1);D.setSplitLineWide(8);D.setResizeMode(Vb.RESIZE_MODE_SECOND_FIXED);D.setSecondSize(-1,60,-1);D.setFirstChild(Vb.createChildWrapper(Sa.getJqUi()));D.setSecondChild(Vb.createChildWrapper(rb.getJqUi()));
Qb();jb=new Vb;jb.setHorizontalSplit(!1);jb.setSplitLineWide(8);jb.setResizeMode(Vb.RESIZE_MODE_SECOND_FIXED);jb.setFirstSize(-1,120,-1);jb.setSecondSize(240,210,350);jb.setFirstChild(Vb.createChildWrapper(Ra.getJqUi()));jb.setSecondChild(Vb.createChildWrapper(qa.getJqUi(),function(){qa.afterResize()}));Xa=new Vb;Xa.setHorizontalSplit(!0);Xa.setSplitLineWide(8);Xa.setResizeMode(Vb.RESIZE_MODE_SECOND_FIXED);Xa.setFirstSize(-1,120,-1);Xa.setSecondSize(280,210,450);Xa.setFirstChild(jb);Xa.setSecondChild(Vb.createChildWrapper(Ma.getJqUi(),
function(){Ma.afterResize()}));Ta=new Vb;Ta.setHorizontalSplit(!0);Ta.setSplitLineWide(8);Ta.setResizeMode(Vb.RESIZE_MODE_FIRST_FIXED);Ta.setFirstSize(206,172,450);Ta.setSecondSize(-1,600,-1);Ta.setFirstChild(D);Ta.setSecondChild(Xa);C=Ta.getJqUi();C.addClass("modeler-designer-main");Fb(!0);Xa.collapseSecondHalf(!0);Ma.show(!1)},Qb=function(){kb?(D.setFirstSize(360,60,-1),D.setSplitLineWide(0)):(D.setFirstSize(360,60,Math.max(60,.382*C[0].clientHeight)),D.setSplitLineWide(8))},Tb=!1,ab=function(){Tb||
Cb()},Cb=function(){Fb(!1);Xa.collapseSecondHalf(!1);Ma.show(!0)},Fb=function(q){if(!w){w=$("<div>");w.addClass("modeler-designer-property-show-btn");w.on("click",Cb);var H=$("<div>");H.appendTo(w);wa.backgroundWithHover(H,"leftArrow");var P=$("<div>");P.text(ub.get("properties","\u5c5e\u6027"));P.appendTo(w);wb.layoutCtrlCenterAlign(P,20);wb.layoutCtrlWithLRTB(P,null,null,null,25,0,null);wb.layoutCtrlCenterAlign(H,16);wb.layoutCtrlWithLRTB(H,null,null,null,5,null,16);w.appendTo(C)}q?(w.show(),Xa.setSplitLineWide(33)):
(w.hide(),Xa.setSplitLineWide(8))},Ya=function(){if(za){var q=za.getAllSource();q=!q||0==q.length;kb!=q&&(kb=q,Qb(),D.collapseSecondHalf(q));var H=za.getAllNodes();H=!H||0==H.length;Z||(H?(hb(!0),Nb(!0),qa.show(!1)):ha());H?(Va||(Va=new cb,Va.setNodeStatusMonitor(U),Va.getJqUi().appendTo(Xa.getJqUi())),Va.setNoNode(H),Va.setNoSource(q),Va.show(),w&&w.css("z-index",0)):(Va&&Va.hide(),w&&w.css("z-index",100))}},kb=!1,Z=!1,ha=function(){hb(!1);Nb(!1);qa.show(!0)},hb=function(q){if(!sa){sa=$("<div>");
sa.on("click",ha);sa.addClass("modeler-designer-preview-show-btn");var H=$("<div>");H.appendTo(sa);wa.backgroundWithHover(H,"upArrow");var P=$("<div>");P.text(ub.get("fieldAndPreviewData","\u5b57\u6bb5/\u9884\u89c8"));P.appendTo(sa);wb.layoutCtrlMiddleAlign(P,20);wb.layoutCtrlMiddleAlign(H,16);wb.layoutCtrlWithLRTB(P,5,null,120,null,null,null);wb.layoutCtrlWithLRTB(H,null,5,16,null,null,16);sa.appendTo(jb.getJqUi())}q?(sa.show(),jb.setSplitLineWide(33)):(sa.hide(),jb.setSplitLineWide(8))},Mb=!1,Nb=
function(q){Mb!=q&&(jb.collapseSecondHalf(q),Mb=q)},T=function(q,H){if(q==yb.KEY_ADD_PREPARED_SOURCE||q==yb.KEY_REMOVE_PREPARED_SOURCE||q==yb.KEY_SET_PREPARED_SOURCE||q==xb.KEY_ADD_NODE||q==xb.KEY_REMOVE_NODE)console.log("update main ui"),Ya()}}function xa(){var M,C,F,x,Aa;this.getJqUi=function(){M||(M=$("<div>"),M.addClass("modeler-designer-statusbar"),C=$("<span>"),C.addClass("modeler-designer-statusbar-name"),C.appendTo(M),F=$("<span>"),F.addClass("modeler-designer-statusbar-dirtystate"),F.appendTo(M),
x=$("<span>"),x.addClass("modeler-designer-statusbar-prompt"),x.appendTo(M));return M};this.setCurrentName=function(U){C.text(U)};this.showDirtyState=function(U){F.text(U?"*":"")};this.showShortPrompt=function(U,ba,Ta){clearTimeout(Aa);x.text(U);x.css("color",Ta?Ta:"");if(ba){var Xa=0,D=function(){if(6<Xa)za();else{if(0==Xa%2){x.text(U);var jb=650}else x.text(""),jb=350;Aa=setTimeout(D,jb);Xa++}};D()}else za()};var za=function(){Aa=setTimeout(function(){x.text("")},5E3)}}function eb(){var M=new Ab,
C,F=$("<div>"),x=$("<div>"),Aa=$("<div>");this.getJqUi=function(){C||(C=M.getJqUi(),C.addClass("modeler-designer-toolbar"),za(F),za(x),za(Aa));return C};this.addButton=function(ba,Ta,Xa,D){return U(x,!1,ba,Ta,Xa,D)};this.addButtonForHeadCustom=function(ba,Ta,Xa,D){return U(F,!1,ba,Ta,Xa,D)};this.addButtonForTailCustom=function(ba,Ta,Xa,D){return U(Aa,!1,ba,Ta,Xa,D)};this.addMenuButton=function(ba,Ta,Xa,D){return U(x,!0,ba,Ta,Xa,D)};this.addMenuButtonForHeadCustom=function(ba,Ta,Xa,D){return U(F,!0,
ba,Ta,Xa,D)};this.addMenuButtonForTailCustom=function(ba,Ta,Xa,D){return U(Aa,!0,ba,Ta,Xa,D)};this.getAllBtnWidth=function(){return F.width()+x.width()+Aa.width()};var za=function(ba){ba.css({"float":"left",position:"relative",height:"100%"});ba.appendTo(C)},U=function(ba,Ta,Xa,D,jb,Sa){ba=M.createButton(ba,Ta,Xa,jb,Sa?Sa:jb);ba.setIconSetter(function(rb,Ra){wa.background(rb,Ra)});ba.setIconName(D);return ba}}function cb(){var M,C,F,x,Aa;this.setNodeStatusMonitor=function(Ta){};this.setNoNode=function(Ta){ba()};
this.setNoSource=function(Ta){F=Ta;ba()};this.show=function(){M&&M.show()};this.hide=function(){M&&M.hide()};this.getJqUi=function(){M||(M=$("<div>"),M.css("background","#f7f7f7"),M.css("z-index",1E3),wb.layoutCtrlWithLRTB(M,0,0,null,0,0,null),ba());return M};var za=function(){if(!x){x=$("<div>");wb.layoutCtrlMiddleAlign(x,180);wb.layoutCtrlCenterAlign(x,260);x.appendTo(M);C=$("<div>");C.addClass("modeler-designer-no-node-prompt");wb.layoutCtrl(C,10,0,260,20);C.appendTo(x);C.text(ub.get("dragInNode",
"\u62d6\u5165\u8868\uff0c\u5f00\u59cb\u521b\u5efa\u6a21\u578b"));var Ta=$("<div>");wb.layoutCtrl(Ta,0,40,253,140);wa.background(Ta,"drag_node_prompt");Ta.appendTo(x)}return x},U=function(){Aa||(Aa=$("<div>"),wb.layoutCtrlMiddleAlign(Aa,170),wb.layoutCtrlCenterAlign(Aa,210),wa.background(Aa,"no_node_and_source"),Aa.appendTo(M));return Aa},ba=function(){F?(za().hide(),U().show()):(za().show(),U().hide())}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==
typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var qb=com.kingdee.bos.qing.modeler.designer;qb.Designer=function(){var M=this,C,F=new eb,x=new O,Aa=new xa,za=new G,U=new N,ba,Ta,Xa,D,jb,Sa,rb,Ra=!0,Ma;this.setMessageResize=function(Z){Ma=Z};var qa=new function(){this.getModelerModel=
function(){Sa||(Sa=new xb,qb.NodeFieldHelper.init(Sa),U.init(Sa));return Sa};this.getIntegration=function(){return rb};this.getTopJqUi=function(){return C};this.getMessageCurtain=function(){return Ta};this.getCommandManager=function(){return x};this.getRemoteImpl=function(){return Xa};this.getNodeStatusMonitor=function(){return za}};this.setEditable=function(Z){Ra=Z};this.isEditable=function(){return Ra};this.setRemoteImpl=function(Z){Xa=Z;ba&&ba.setRemoteImpl(Xa);qb.NodeFieldHelper.setRemoteImpl(Xa);
U.setRemoteImpl(Xa)};this.setIntegration=function(Z){rb=Z};this.getIntegration=function(){return rb};this.setLockInfo=function(Z,ha,hb){qb.LockHelper.setLockInfo(Z,ha,hb)};this.setLockStateChangeListener=function(Z){qb.LockHelper.setLockStateChangeListener(Z)};this.registerLockRequestSender=function(Z){qb.LockHelper.registerLockRequestSender(Z)};this.createJqUi=function(){C=$("<div onselectstart='return false'>");C.addClass("modeler-designer");Ta=new Db;Ta.getJqUi().appendTo(C);Fb();Eb();Ra&&(qb.LockHelper.setGlobal(qa),
qb.LockHelper.show(C));sa();C.append(F.getJqUi());C.append(Aa.getJqUi());ba=new oa;ba.setRemoteImpl(Xa);ba.setGlobal(qa);ba.setNodeStatusMonitor(za);ba.setModelerChecker(U);C.append(ba.getJqUi());x.addPerformedListener(Wa);return C};this.resize=function(){kb()};this.clearDirty=function(){Cb(!1)};this.isDirty=function(){return D};this.setDirtyListener=function(Z){jb=Z};this.insertToolbarBtn=function(Z,ha,hb,Mb){return F.addButtonForHeadCustom(Z,ha,hb,Mb)};this.insertMenuButton=function(Z,ha,hb,Mb){return F.addMenuButtonForHeadCustom(Z,
ha,hb,Mb)};this.appendToolbarBtn=function(Z,ha,hb,Mb){return F.addButtonForTailCustom(Z,ha,hb,Mb)};this.getMsgCurtain=function(){return Ta};this.getJsonModel=function(){var Z=qa.getModelerModel(),ha=new Ea;ha.setModelerModel(Z);return ha.toJsonObject()};this.setJsonModel=function(Z){if(Z){var ha=new Ea;ha.fromJsonObject(Z);w(ha.getModelerModel())}else w(new xb);qa.getCommandManager().reset();Cb(!1);rb&&!rb.isValidModel()?Ta.showError(ub.get("modelIsInvalid","\u6a21\u578b\u89e3\u6790\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u6a21\u578b\u3002")):
ba.showDialogIfNoSource()};this.setJsonValidity=function(Z,ha){U&&U.setGlobalCheckResult(Z,!1,ha)};this.setUndoAbleJsonModel=function(Z,ha){var hb=new Ea;hb.fromJsonObject(Z);Z=hb.getModelerModel();hb=new ca;hb.setCaption(ha);hb.setValue(Sa,Z,w);x.perform(hb)};var w=function(Z){qb.NodeResultCache.clear();za.reset();Sa&&Sa.clearPropertyChangeCallback();Sa=Z;qb.NodeFieldHelper.init(Sa);U.init(Sa);ba.updateModelerModel();Z=M.getJsonModel();U&&U.backgroundCheck(Z);a:if((Z=Sa.getAllNodes())&&0!=Z.length){for(var ha=
0;ha<Z.length;ha++){var hb=Z[ha];if(hb instanceof Na){za.setSelected(hb);break a}}za.setSelected(Z[0])}},sa=function(){var Z=F.addButton(Va,"btn_undo",ub.get("undo","\u64a4\u6d88")),ha=F.addButton(Ka,"btn_redo",ub.get("redo","\u53cd\u64a4\u6d88"));F.addButton(lb,"btn_clean",ub.get("clear","\u6e05\u9664"));Z.setEnabled(x.isCanUndo());ha.setEnabled(x.isCanRedo());x.addPerformedListener(function(hb,Mb,Nb){Z.setEnabled(x.isCanUndo());ha.setEnabled(x.isCanRedo())});M.isEditable()&&F.addButton(Qb,"btn_check",
ub.get("checkModeler","\u6a21\u578b\u6821\u9a8c"));F.addButton(Tb,"btn_preview",ub.get("trialExecution","\u8bd5\u6267\u884c"));F.addButton(ab,"btn_materialized_config",ub.get("materializedConfig","\u7269\u5316\u5b58\u50a8\u8bbe\u7f6e"))},Va=function(){x.isCanUndo()&&x.undo();Ia.occur(Ia.BUTTON_TYPE,Ia.UNDO)},Ka=function(){x.isCanRedo()&&x.redo();Ia.occur(Ia.BUTTON_TYPE,Ia.REDO)},Wa=function(Z,ha,hb){Cb(!0);Z&&(ha=ha?"":(hb?ub.get("undo","\u64a4\u6d88"):ub.get("redo","\u53cd\u64a4\u6d88"))+" ",ha+=
Z.getCaption(),Aa.showShortPrompt(ha),(Z instanceof ya||Z instanceof ka)&&za.setSelected(Z.getNode()))},lb=function(){var Z=new ca;Z.setCaption(ub.get("clear","\u6e05\u9664"));var ha=new xb;ha.batchAddSource(Sa.getAllSource());ha.batchAddTable(Sa.getAllUserSqlTables());Z.setValue(Sa,ha,w);x.perform(Z);Ia.occur(Ia.BUTTON_TYPE,Ia.CLEAR)},Eb=function(){U.init(qa.getModelerModel());U.setGlobal(qa);U.setNodeStatusMonitor(za);qb.NodeFieldHelper.setNodeInvalidCallback(function(Z,ha){U.updateNodeValidity(Z,
ha)})},Qb=function(){U.check(M.getJsonModel());Ia.occur(Ia.BUTTON_TYPE,Ia.MODEL_CHECK)},Tb=function(){var Z=new Ga;Z.setRemoteImpl(Xa);Z.setGlobal(qa);Z.setModelChecker(U);Z.preview(M.getJsonModel());Ia.occur(Ia.BUTTON_TYPE,Ia.MODEL_PREVIEW)},ab=function(){var Z=new Oa;Z.setGlobal(qa);Z.setRemoteImpl(Xa);Z.setSupportIncrementConfig(Sa.getType()===yb.TYPE_TABLE_MODELER);Z.showDialog()},Cb=function(Z){D=Z;Aa&&Aa.showDirtyState(D);jb&&jb(D)},Fb=function(){Ya();var Z=new Hb;Z.setCallbackImmediately(function(){Ya()});
Z.setDelay(100);Z.setCallback(function(){kb()});Z.observe()},Ya=function(){document.body.style.height=document.documentElement.clientHeight+"px"},kb=function(){qb.LockHelper.setMaxWidth(C.width()-F.getAllBtnWidth());ba.resize();Ma&&Ma()}};var wb,Ab,Vb,Db,ub,Hb,Ea,Na,xb,yb,wa,Q,Ha,Ob,ja,fa,Ja,ea,G,O,ya,ka,ca,N,Ga,Pa,Qa,Ia,Oa;(function(){var M=com.kingdee.bos.qing.ui.component;Ab=M.Toolbar;Vb=M.SplitPane;Db=M.MessageCurtain;M=com.kingdee.bos.qing.common;wb=M.DomUtil;M=qb;Ea=M.QingModeler;Na=qb.TableNode;
yb=M.ModelerModel;wa=M.Icons;Q=M.SourceArea;Ha=M.SourceConnectStep;Ob=M.TableArea;ja=M.PropertyArea;fa=M.PageArea;Ja=M.PreviewArea;ea=M.DragHandler;xb=M.TableModeler;G=M.NodeStatusMonitor;O=M.CommandManager;ya=M.ActionChangeConfig;ka=M.ActionNodeFieldSetting;N=M.ModelerChecker;ca=M.ActionSetModel;Ga=M.ModelPreviewHelper;Pa=M.TableNodeFactory;Qa=M.TableModelerDisplayNameHelper;Oa=M.MaterializedConfigDialog;Ia=M.UserOperationReporter;M=com.kingdee.bos.qing.framework.common;ub=M.MultilanguageManager.createPackageAccessor(qb);
Hb=M.WindowResizeObserver})()})();
//qingVersionTag: 20250324