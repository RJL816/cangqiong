var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(qa){var Ua=0;return function(){return Ua<qa.length?{done:!1,value:qa[Ua++]}:{done:!0}}};$jscomp.arrayIterator=function(qa){return{next:$jscomp.arrayIteratorImpl(qa)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(qa,Ua,Oa){if(qa==Array.prototype||qa==Object.prototype)return qa;qa[Ua]=Oa.value;return qa};$jscomp.getGlobal=function(qa){qa=["object"==typeof globalThis&&globalThis,qa,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var Ua=0;Ua<qa.length;++Ua){var Oa=qa[Ua];if(Oa&&Oa.Math==Math)return Oa}throw Error("Cannot find global object");};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(qa,Ua){var Oa=$jscomp.propertyToPolyfillSymbol[Ua];if(null==Oa)return qa[Ua];Oa=qa[Oa];return void 0!==Oa?Oa:qa[Ua]};
$jscomp.polyfill=function(qa,Ua,Oa,ib){Ua&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(qa,Ua,Oa,ib):$jscomp.polyfillUnisolated(qa,Ua,Oa,ib))};$jscomp.polyfillUnisolated=function(qa,Ua,Oa,ib){Oa=$jscomp.global;qa=qa.split(".");for(ib=0;ib<qa.length-1;ib++){var Ya=qa[ib];if(!(Ya in Oa))return;Oa=Oa[Ya]}qa=qa[qa.length-1];ib=Oa[qa];Ua=Ua(ib);Ua!=ib&&null!=Ua&&$jscomp.defineProperty(Oa,qa,{configurable:!0,writable:!0,value:Ua})};
$jscomp.polyfillIsolated=function(qa,Ua,Oa,ib){var Ya=qa.split(".");qa=1===Ya.length;ib=Ya[0];ib=!qa&&ib in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var Ma=0;Ma<Ya.length-1;Ma++){var ya=Ya[Ma];if(!(ya in ib))return;ib=ib[ya]}Ya=Ya[Ya.length-1];Oa=$jscomp.IS_SYMBOL_NATIVE&&"es6"===Oa?ib[Ya]:null;Ua=Ua(Oa);null!=Ua&&(qa?$jscomp.defineProperty($jscomp.polyfills,Ya,{configurable:!0,writable:!0,value:Ua}):Ua!==Oa&&(void 0===$jscomp.propertyToPolyfillSymbol[Ya]&&(Oa=1E9*Math.random()>>>0,
$jscomp.propertyToPolyfillSymbol[Ya]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(Ya):$jscomp.POLYFILL_PREFIX+Oa+"$"+Ya),$jscomp.defineProperty(ib,$jscomp.propertyToPolyfillSymbol[Ya],{configurable:!0,writable:!0,value:Ua})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(qa){if(qa)return qa;var Ua=function(Ma,ya){this.$jscomp$symbol$id_=Ma;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:ya})};Ua.prototype.toString=function(){return this.$jscomp$symbol$id_};var Oa="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",ib=0,Ya=function(Ma){if(this instanceof Ya)throw new TypeError("Symbol is not a constructor");return new Ua(Oa+(Ma||"")+"_"+ib++,Ma)};return Ya},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(qa){if(qa)return qa;qa=Symbol("Symbol.iterator");for(var Ua="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Oa=0;Oa<Ua.length;Oa++){var ib=$jscomp.global[Ua[Oa]];"function"===typeof ib&&"function"!=typeof ib.prototype[qa]&&$jscomp.defineProperty(ib.prototype,qa,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return qa},
"es6","es3");$jscomp.iteratorPrototype=function(qa){qa={next:qa};qa[Symbol.iterator]=function(){return this};return qa};$jscomp.iteratorFromArray=function(qa,Ua){qa instanceof String&&(qa+="");var Oa=0,ib=!1,Ya={next:function(){if(!ib&&Oa<qa.length){var Ma=Oa++;return{value:Ua(Ma,qa[Ma]),done:!1}}ib=!0;return{done:!0,value:void 0}}};Ya[Symbol.iterator]=function(){return Ya};return Ya};
$jscomp.polyfill("Array.prototype.keys",function(qa){return qa?qa:function(){return $jscomp.iteratorFromArray(this,function(Ua){return Ua})}},"es6","es3");$jscomp.findInternal=function(qa,Ua,Oa){qa instanceof String&&(qa=String(qa));for(var ib=qa.length,Ya=0;Ya<ib;Ya++){var Ma=qa[Ya];if(Ua.call(Oa,Ma,Ya,qa))return{i:Ya,v:Ma}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(qa){return qa?qa:function(Ua,Oa){return $jscomp.findInternal(this,Ua,Oa).v}},"es6","es3");
(function(){"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});com.kingdee.bos.qing.modeler.SpecialWordChecker=new function(){var qa="! $ & * + , - . / : < << = > @ ABORT ACCESS ACCESSED ACCOUNT ACTIVATE ADD ADMIN ADMINISTER ADMINISTRATOR ADVISE ADVISOR AFTER ALGORITHM ALIAS ALL ALLOCATE ALLOW ALL_ROWS ALTER ALWAYS ANALYZE ANCILLARY AND AND_EQUAL ANTIJOIN ANY APPEND APPLY ARCHIVE ARCHIVELOG ARRAY AS ASC ASSOCIATE AT ATTRIBUTE ATTRIBUTES AUDIT AUTHENTICATED AUTHENTICATION AUTHID AUTHORIZATION AUTO AUTOALLOCATE AUTOEXTEND AUTOMATIC AVAILABILITY BACKUP BECOME BEFORE BEGIN BEHALF BETWEEN BFILE BIGFILE BINARY_DOUBLE BINARY_DOUBLE_INFINITY BINARY_DOUBLE_NAN BINARY_FLOAT BINARY_FLOAT_INFINITY BINARY_FLOAT_NAN BINDING BITMAP BITS BLOB BLOCK BLOCKS BLOCKSIZE BLOCK_RANGE BODY BOTH BOUND BROADCAST BUFFER BUFFER_CACHE BUFFER_POOL BUILD BULK BY BYPASS_RECURSIVE_CHECK BYPASS_UJVC BYTE CACHE CACHE_CB CACHE_INSTANCES CACHE_TEMP_TABLE CALL CANCEL CARDINALITY CASCADE CASE CAST CATEGORY CERTIFICATE CFILE CHAINED CHANGE CHAR CHARACTER CHAR_CS CHECK CHECKPOINT CHILD CHOOSE CHUNK CIV_GB CLASS CLEAR CLOB CLONE CLOSE CLOSE_CACHED_OPEN_CURSORS CLUSTER CLUSTERING_FACTOR COALESCE COARSE COLLECT COLLECTIONS_GET_REFS COLUMN COLUMNS COLUMN_STATS COLUMN_VALUE COMMENT COMMIT COMMITTED COMPACT COMPATIBILITY COMPILE COMPLETE COMPOSITE_LIMIT COMPRESS COMPUTE CONFORMING CONNECT CONNECT_BY_ISCYCLE CONNECT_BY_ISLEAF CONNECT_BY_ROOT CONNECT_TIME CONSIDER CONSISTENT CONSTRAINT CONSTRAINTS CONTAINER CONTENT CONTENTS CONTEXT CONTINUE CONTROLFILE CONVERT CORRUPTION COST CPU_COSTING CPU_PER_CALL CPU_PER_SESSION CREATE CREATE_STORED_OUTLINES CROSS CUBE CUBE_GB CURRENT CURRENT_DATE CURRENT_SCHEMA CURRENT_TIME CURRENT_TIMESTAMP CURRENT_USER CURSOR CURSOR_SHARING_EXACT CURSOR_SPECIFIC_SEGMENT CYCLE DANGLING DATA DATABASE DATAFILE DATAFILES DATAOBJNO DATE DATE_MODE DAY DBA DBA_RECYCLEBIN DBTIMEZONE DDL DEALLOCATE DEBUG DEC DECIMAL DECLARE DECREMENT DEFAULT DEFERRABLE DEFERRED DEFINED DEFINER DEGREE DELAY DELETE DEMAND DENSE_RANK DEREF DEREF_NO_REWRITE DESC DETACHED DETERMINES DICTIONARY DIMENSION DIRECTORY DISABLE DISASSOCIATE DISCONNECT DISK DISKGROUP DISKS DISMOUNT DISTINCT DISTINGUISHED DISTRIBUTED DML DML_UPDATE DOCUMENT DOMAIN_INDEX_NO_SORT DOMAIN_INDEX_SORT DOUBLE DOWNGRADE DRIVING_SITE DROP DUMP DYNAMIC DYNAMIC_SAMPLING DYNAMIC_SAMPLING_EST_CDN EACH ELEMENT ELSE EMPTY ENABLE ENCRYPTED ENCRYPTION END ENFORCE ENFORCED ENTRY ERROR ERROR_ON_OVERLAP_TIME ESCAPE ESTIMATE EVENTS EXCEPT EXCEPTIONS EXCHANGE EXCLUDING EXCLUSIVE EXECUTE EXEMPT EXISTS EXPAND_GSET_TO_UNION EXPIRE EXPLAIN EXPLOSION EXPORT EXPR_CORR_CHECK EXTEND EXTENDS EXTENT EXTENTS EXTERNAL EXTERNALLY EXTRACT FACT FAILED FAILED_LOGIN_ATTEMPTS FAILGROUP FALSE FAST FBTSCAN FIC_CIV FIC_PIV FILE FILTER FINAL FINE FINISH FIRST FIRST_ROWS FLAGGER FLASHBACK FLOAT FLOB FLUSH FOLLOWING FOR FORCE FORCE_XML_QUERY_REWRITE FOREIGN FREELIST FREELISTS FREEPOOLS FRESH FROM FULL FUNCTION FUNCTIONS GATHER_PLAN_STATISTICS GBY_CONC_ROLLUP GENERATED GLOBAL GLOBALLY GLOBAL_NAME GLOBAL_TOPIC_ENABLED GRANT GROUP GROUPING GROUPS GROUP_BY GUARANTEE GUARANTEED GUARD HASH HASHKEYS HASH_AJ HASH_SJ HAVING HEADER HEAP HIERARCHY HIGH HINTSET_BEGIN HINTSET_END HOUR HWM_BROKERED IDENTIFIED IDENTIFIER IDENTITY IDGENERATORS IDLE_TIME IF IGNORE IGNORE_ON_CLAUSE IGNORE_OPTIM_EMBEDDED_HINTS IGNORE_WHERE_CLAUSE IMMEDIATE IMPORT IN INCLUDE_VERSION INCLUDING INCREMENT INCREMENTAL INDEX INDEXED INDEXES INDEXTYPE INDEXTYPES INDEX_ASC INDEX_COMBINE INDEX_DESC INDEX_FFS INDEX_FILTER INDEX_JOIN INDEX_ROWS INDEX_RRS INDEX_SCAN INDEX_SKIP_SCAN INDEX_SS INDEX_SS_ASC INDEX_SS_DESC INDEX_STATS INDICATOR INFINITE INFORMATIONAL INITIAL INITIALIZED INITIALLY INITRANS INLINE INNER INSERT INSTANCE INSTANCES INSTANTIABLE INSTANTLY INSTEAD INT INTEGER INTEGRITY INTERMEDIATE INTERNAL_CONVERT INTERNAL_USE INTERPRETED INTERSECT INTERVAL INTO INVALIDATE IN_MEMORY_METADATA IS ISOLATION ISOLATION_LEVEL ITERATE ITERATION_NUMBER JAVA JOB JOIN KEEP KERBEROS KEY KEYFILE KEYS KEYSIZE KEY_LENGTH KILL LAST LATERAL LAYER LDAP_REGISTRATION LDAP_REGISTRATION_ENABLED LDAP_REG_SYNC_INTERVAL LEADING LEFT LENGTH LESS LEVEL LEVELS LIBRARY LIKE LIKE2 LIKE4 LIKEC LIKE_EXPAND LIMIT LINK LIST LOB LOCAL LOCALTIME LOCALTIMESTAMP LOCAL_INDEXES LOCATION LOCATOR LOCK LOCKED LOG LOGFILE LOGGING LOGICAL LOGICAL_READS_PER_CALL LOGICAL_READS_PER_SESSION LOGOFF LOGON LONG MAIN MANAGE MANAGED MANAGEMENT MANUAL MAPPING MASTER MATCHED MATERIALIZE MATERIALIZED MAX MAXARCHLOGS MAXDATAFILES MAXEXTENTS MAXIMIZE MAXINSTANCES MAXLOGFILES MAXLOGHISTORY MAXLOGMEMBERS MAXSIZE MAXTRANS MAXVALUE MEASURES MEMBER MEMORY MERGE MERGE_AJ MERGE_CONST_ON MERGE_SJ METHOD MIGRATE MIN MINEXTENTS MINIMIZE MINIMUM MINUS MINUTE MINVALUE MIRROR MLSLABEL MODE MODEL MODEL_DONTVERIFY_UNIQUENESS MODEL_MIN_ANALYSIS MODEL_NO_ANALYSIS MODEL_PBY MODEL_PUSH_REF MODIFY MONITORING MONTH MOUNT MOVE MOVEMENT MULTISET MV_MERGE NAME NAMED NAN NATIONAL NATIVE NATURAL NAV NCHAR NCHAR_CS NCLOB NEEDED NESTED NESTED_TABLE_FAST_INSERT NESTED_TABLE_GET_REFS NESTED_TABLE_ID NESTED_TABLE_SET_REFS NESTED_TABLE_SET_SETID NETWORK NEVER NEW NEXT NLS_CALENDAR NLS_CHARACTERSET NLS_COMP NLS_CURRENCY NLS_DATE_FORMAT NLS_DATE_LANGUAGE NLS_ISO_CURRENCY NLS_LANG NLS_LANGUAGE NLS_LENGTH_SEMANTICS NLS_NCHAR_CONV_EXCP NLS_NUMERIC_CHARACTERS NLS_SORT NLS_SPECIAL_CHARS NLS_TERRITORY NL_AJ NL_SJ NO NOAPPEND NOARCHIVELOG NOAUDIT NOCACHE NOCOMPRESS NOCPU_COSTING NOCYCLE NODELAY NOFORCE NOGUARANTEE NOLOGGING NOMAPPING NOMAXVALUE NOMINIMIZE NOMINVALUE NOMONITORING NONE NOORDER NOOVERRIDE NOPARALLEL NOPARALLEL_INDEX NORELY NOREPAIR NORESETLOGS NOREVERSE NOREWRITE NORMAL NOROWDEPENDENCIES NOSEGMENT NOSORT NOSTRICT NOSWITCH NOT NOTHING NOVALIDATE NOWAIT NO_ACCESS NO_BASETABLE_MULTIMV_REWRITE NO_BUFFER NO_CPU_COSTING NO_EXPAND NO_EXPAND_GSET_TO_UNION NO_FACT NO_FILTERING NO_INDEX NO_INDEX_FFS NO_INDEX_SS NO_MERGE NO_MODEL_PUSH_REF NO_MONITORING NO_MULTIMV_REWRITE NO_ORDER_ROLLUPS NO_PARALLEL NO_PARALLEL_INDEX NO_PARTIAL_COMMIT NO_PRUNE_GSETS NO_PUSH_PRED NO_PUSH_SUBQ NO_QKN_BUFF NO_QUERY_TRANSFORMATION NO_REF_CASCADE NO_REWRITE NO_SEMIJOIN NO_SET_TO_JOIN NO_STAR_TRANSFORMATION NO_STATS_GSETS NO_SWAP_JOIN_INPUTS NO_TRIGGER NO_UNNEST NO_USE_HASH NO_USE_MERGE NO_USE_NL NO_XML_QUERY_REWRITE NULL NULLS NUMBER NUMERIC NVARCHAR2 OBJECT OBJNO OBJNO_REUSE OF OFF OFFLINE OID OIDINDEX OLD ON ONLINE ONLY OPAQUE OPAQUE_TRANSFORM OPAQUE_XCANONICAL OPCODE OPEN OPERATOR OPTIMAL OPTIMIZER_FEATURES_ENABLE OPTIMIZER_GOAL OPTION OPT_ESTIMATE OR ORA_ROWSCN ORDER ORDERED ORDERED_PREDICATES ORGANIZATION OR_EXPAND OUTER OUTLINE OUT_OF_LINE OVER OVERFLOW OVERFLOW_NOMOVE OVERLAPS OWN PACKAGE PACKAGES PARALLEL PARALLEL_INDEX PARAMETERS PARENT PARITY PARTIALLY PARTITION PARTITIONS PARTITION_HASH PARTITION_LIST PARTITION_RANGE PASSWORD PASSWORD_GRACE_TIME PASSWORD_LIFE_TIME PASSWORD_LOCK_TIME PASSWORD_REUSE_MAX PASSWORD_REUSE_TIME PASSWORD_VERIFY_FUNCTION PCTFREE PCTINCREASE PCTTHRESHOLD PCTUSED PCTVERSION PERCENT PERFORMANCE PERMANENT PFILE PHYSICAL PIV_GB PIV_SSF PLAN PLSQL_CODE_TYPE PLSQL_DEBUG PLSQL_OPTIMIZE_LEVEL PLSQL_WARNINGS POLICY POST_TRANSACTION POWER PQ_DISTRIBUTE PQ_MAP PQ_NOMAP PREBUILT PRECEDING PRECISION PREPARE PRESENT PRESERVE PRIMARY PRIOR PRIVATE PRIVATE_SGA PRIVILEGE PRIVILEGES PROCEDURE PROFILE PROGRAM PROJECT PROTECTED PROTECTION PUBLIC PURGE PUSH_PRED PUSH_SUBQ PX_GRANULE QB_NAME QUERY QUERY_BLOCK QUEUE QUEUE_CURR QUEUE_ROWP QUIESCE QUOTA RANDOM RANGE RAPIDLY RAW RBA READ READS REAL REBALANCE REBUILD RECORDS_PER_BLOCK RECOVER RECOVERABLE RECOVERY RECYCLE RECYCLEBIN REDUCED REDUNDANCY REF REFERENCE REFERENCED REFERENCES REFERENCING REFRESH REF_CASCADE_CURSOR REGEXP_LIKE REGISTER REJECT REKEY RELATIONAL RELY REMOTE_MAPPED RENAME REPAIR REPLACE REQUIRED RESET RESETLOGS RESIZE RESOLVE RESOLVER RESOURCE RESTORE_AS_INTERVALS RESTRICT RESTRICTED RESTRICT_ALL_REF_CONS RESUMABLE RESUME RETENTION RETURN RETURNING REUSE REVERSE REVOKE REWRITE REWRITE_OR_ERROR RIGHT ROLE ROLES ROLLBACK ROLLUP ROW ROWDEPENDENCIES ROWID ROWNUM ROWS ROW_LENGTH RULE RULES SAMPLE SAVEPOINT SAVE_AS_INTERVALS SB4 SCALE SCALE_ROWS SCAN SCAN_INSTANCES SCHEDULER SCHEMA SCN SCN_ASCENDING SCOPE SD_ALL SD_INHIBIT SD_SHOW SECOND SECURITY SEED SEGMENT SEG_BLOCK SEG_FILE SELECT SELECTIVITY SEMIJOIN SEMIJOIN_DRIVER SEQUENCE SEQUENCED SEQUENTIAL SERIALIZABLE SERVERERROR SESSION SESSIONS_PER_USER SESSIONTIMEZONE SESSIONTZNAME SESSION_CACHED_CURSORS SET SETS SETTINGS SET_TO_JOIN SEVERE SHARE SHARED SHARED_POOL SHRINK SHUTDOWN SIBLINGS SID SIMPLE SINGLE SINGLETASK SIZE SKIP SKIP_EXT_OPTIMIZER SKIP_UNQ_UNUSABLE_IDX SKIP_UNUSABLE_INDEXES SMALLFILE SMALLINT SNAPSHOT SOME SORT SOURCE SPACE SPECIFICATION SPFILE SPLIT SPREADSHEET SQL SQLLDR SQL_TRACE STANDBY STAR START STARTUP STAR_TRANSFORMATION STATEMENT_ID STATIC STATISTICS STOP STORAGE STORE STREAMS STRICT STRIP STRUCTURE SUBMULTISET SUBPARTITION SUBPARTITIONS SUBPARTITION_REL SUBSTITUTABLE SUCCESSFUL SUMMARY SUPPLEMENTAL SUSPEND SWAP_JOIN_INPUTS SWITCH SWITCHOVER SYNONYM SYSAUX SYSDATE SYSDBA SYSOPER SYSTEM SYSTIMESTAMP SYS_DL_CURSOR SYS_FBT_INSDEL SYS_OP_BITVEC SYS_OP_CAST SYS_OP_COL_PRESENT SYS_OP_ENFORCE_NOT_NULL $SYS_OP_MINE_VALUE SYS_OP_NOEXPAND SYS_OP_NTCIMG $SYS_PARALLEL_TXN SYS_RID_ORDER TABLE TABLES TABLESPACE TABLESPACE_NO TABLE_STATS TABNO TEMPFILE TEMPLATE TEMPORARY THAN THE THEN THREAD THROUGH TIME TIMEOUT TIMESTAMP TIMEZONE_ABBR TIMEZONE_HOUR TIMEZONE_MINUTE TIMEZONE_REGION TIME_ZONE TIV_GB TIV_SSF TO TOPLEVEL TRACE TRACING TRACKING TRAILING TRANSACTION TRANSITIONAL TREAT TRIGGER TRIGGERS TRUE TRUNCATE TRUSTED TUNING TX TYPE TYPES TZ_OFFSET UB2 UBA UID UNARCHIVED UNBOUND UNBOUNDED UNDER UNDO UNDROP UNIFORM UNION UNIQUE UNLIMITED UNLOCK UNNEST UNPACKED UNPROTECTED UNQUIESCE UNRECOVERABLE UNTIL UNUSABLE UNUSED UPDATABLE UPDATE UPDATED UPD_INDEXES UPD_JOININDEX UPGRADE UPSERT UROWID USAGE USE USER USER_DEFINED USER_RECYCLEBIN USE_ANTI USE_CONCAT USE_HASH USE_MERGE USE_NL USE_NL_WITH_INDEX USE_PRIVATE_OUTLINES USE_SEMI USE_STORED_OUTLINES USE_TTT_FOR_GSETS USE_WEAK_NAME_RESL USING VALIDATE VALIDATION VALUE VALUES VARCHAR VARCHAR2 VARRAY VARYING VECTOR_READ VECTOR_READ_TRACE VERSION VERSIONS VIEW WAIT WELLFORMED WHEN WHENEVER WHERE WHITESPACE WITH WITHIN WITHOUT WORK WRITE XID XMLATTRIBUTES XMLCOLATTVAL XMLELEMENT XMLFOREST XMLPARSE XMLSCHEMA XMLTYPE X_DYN_PRUNE YEAR ZONE [ ] ^ | ABS ABSENT ABSOLUTE ACCORDING ACTION ADA AGGREGATE ALSO ANALYSE ARE ARRAY_AGG ARRAY_MAX_CARDINALITY ASENSITIVE ASSERTION ASSIGNMENT ASYMMETRIC ATOMIC AVG BACKWARD BASE64 BEGIN_FRAME BEGIN_PARTITION BERNOULLI BIGINT BINARY BIT BIT_LENGTH BLOCKED BOM BOOLEAN BREADTH C CALLED CASCADED CATALOG CATALOG_NAME CEIL CEILING CHAIN CHARACTERISTICS CHARACTERS CHARACTER_LENGTH CHARACTER_SET_CATALOG CHARACTER_SET_NAME CHARACTER_SET_SCHEMA CHAR_LENGTH CLASS_ORIGIN COBOL COLLATE COLLATION COLLATION_CATALOG COLLATION_NAME COLLATION_SCHEMA COLUMN_NAME COMMAND_FUNCTION COMMAND_FUNCTION_CODE COMMENTS CONCURRENTLY CONDITION CONDITION_NUMBER CONFIGURATION CONFLICT CONNECTION CONNECTION_NAME CONSTRAINT_CATALOG CONSTRAINT_NAME CONSTRAINT_SCHEMA CONSTRUCTOR CONTAINS CONTROL CONVERSION COPY CORR CORRESPONDING COUNT COVAR_POP COVAR_SAMP CSV CUME_DIST CURRENT_CATALOG CURRENT_DEFAULT_TRANSFORM_GROUP CURRENT_PATH CURRENT_ROLE CURRENT_ROW CURRENT_TRANSFORM_GROUP_FOR_TYPE CURSOR_NAME DATALINK DATETIME_INTERVAL_CODE DATETIME_INTERVAL_PRECISION DB DEFAULTS DELIMITER DELIMITERS DEPENDS DEPTH DERIVED DESCRIBE DESCRIPTOR DETERMINISTIC DIAGNOSTICS DISCARD DISPATCH DLNEWCOPY DLPREVIOUSCOPY DLURLCOMPLETE DLURLCOMPLETEONLY DLURLCOMPLETEWRITE DLURLPATH DLURLPATHONLY DLURLPATHWRITE DLURLSCHEME DLURLSERVER DLVALUE DO DOMAIN DYNAMIC_FUNCTION DYNAMIC_FUNCTION_CODE ENCODING END-EXEC END_FRAME END_PARTITION ENUM EQUALS EVENT EVERY EXCEPTION EXCLUDE EXEC EXP EXPRESSION EXTENSION FAMILY FETCH FIRST_VALUE FLAG FLOOR FORTRAN FORWARD FOUND FRAME_ROW FREE FREEZE FS FUSION G GENERAL GET GO GOTO GRANTED GREATEST HANDLER HEX HOLD ILIKE IMMEDIATELY IMMUTABLE IMPLEMENTATION IMPLICIT INDENT INHERIT INHERITS INOUT INPUT INSENSITIVE INTERSECTION INVOKER ISNULL K KEY_MEMBER KEY_TYPE LABEL LAG LANGUAGE LARGE LAST_VALUE LEAD LEAKPROOF LEAST LIKE_REGEX LISTEN LN LOAD LOGGED LOWER M MAP MATCH MAX_CARDINALITY MESSAGE_LENGTH MESSAGE_OCTET_LENGTH MESSAGE_TEXT MOD MODIFIES MODULE MORE MUMPS NAMES NAMESPACE NESTING NFC NFD NFKC NFKD NIL NORMALIZE NORMALIZED NOTIFY NOTNULL NTH_VALUE NTILE NULLABLE NULLIF OCCURRENCES_REGEX OCTETS OCTET_LENGTH OFFSET OIDS OPTIONS ORDERING ORDINALITY OTHERS OUT OUTPUT OVERLAY OVERRIDING OWNED OWNER P PAD PARAMETER PARAMETER_MODE PARAMETER_NAME PARAMETER_ORDINAL_POSITION PARAMETER_SPECIFIC_CATALOG PARAMETER_SPECIFIC_NAME PARAMETER_SPECIFIC_SCHEMA PARSER PARTIAL PASCAL PASSING PASSTHROUGH PATH PERCENTILE_CONT PERCENTILE_DISC PERCENT_RANK PERIOD PERMISSION PLACING PLANS PLI PORTION POSITION POSITION_REGEX PRECEDES PREPARED PROCEDURAL QUOTE RANK REASSIGN RECHECK RECURSIVE REGR_AVGX REGR_AVGY REGR_COUNT REGR_INTERCEPT REGR_R2 EXIT PRINT PROC FILLFACTOR RAISERROR FREETEXT READTEXT BREAK FREETEXTTABLE RECONFIGURE BROWSE REPLICATION RESTORE HOLDLOCK CLUSTERED ROWCOUNT IDENTITY_INSERT ROWGUIDCOL IDENTITYCOL SAVE SESSION_USER CONTAINSTABLE SETUSER SYSTEM_USER TEXTSIZE LINENO TOP TRAN NOCHECK DBCC NONCLUSTERED TSEQUAL DENY OFFSETS UPDATETEXT OPENDATASOURCE OPENQUERY OPENROWSET DUMMY OPENXML WAITFOR WHILE ERRLVL WRITETEXT L S RK SEQ MS XXFIELDXX".split(" ");
this.isSpecialWord=function(Ua){return Ua&&0!=Ua.length?-1<qa.indexOf(Ua.trim().toUpperCase()):!0}}})();(function(){function qa(){var u=this,F,Q=[],r=[],w=[],L;this.setType=function(t){F=t};this.getType=function(){return F};this.supportIncrementalMaterialize=function(){return!1};this.protectedIsTableInUse=function(){throw Error("override me");};this.insertSource=function(t,a){for(var c=!1,m=t.getSourceId(),b=0;b<Q.length;b++)if(m==Q[b].getSourceId()){c=!0;break}c||(Q.splice(a,0,t),n(qa.KEY_ADD_PREPARED_SOURCE,[t]))};this.batchAddSource=function(t){for(var a=[],c=0;c<t.length;c++){for(var m=!1,b=t[c],
d=b.getSourceId(),h=0;h<Q.length;h++)if(d==Q[h].getSourceId()){m=!0;break}m||(Q.push(b),a.push(b))}n(qa.KEY_ADD_PREPARED_SOURCE,a)};this.setSource=function(t,a){Q=t;!a&&n(qa.KEY_SET_PREPARED_SOURCE,Q)};this.removeSource=function(t){var a=Q.indexOf(t);return-1<a?(Q.splice(a,1),n(qa.KEY_REMOVE_PREPARED_SOURCE,[t]),a):-1};this.batchRemoveUserSqlTable=function(t){t=u.getUserSqlTables(t);for(var a=0;a<t.length;a++)u.removeTableIfUseless(t[a])};this.batchRemoveSource=function(t){for(var a=0;a<t.length;a++){var c=
Q.indexOf(t[a]);-1<c&&Q.splice(c,1)}n(qa.KEY_REMOVE_PREPARED_SOURCE,t)};this.getSource=function(t){for(var a=0,c=Q.length;a<c;a++)if(Q[a].getId()==t)return Q[a]};this.getAllSource=function(){return Q};this.isSourceUsed=function(t){t=t.getId();for(var a=0,c=r.length;a<c;a++){var m=r[a];if(m.getSourceUid()==t&&u.protectedIsTableInUse(m))return!0}return!1};this.addTable=function(t){for(var a=0,c=r.length;a<c;a++)if(r[a].isSame(t))return;r.push(t);t.addPropertyChangeCallback(n);n(qa.KEY_ADD_TABLE,t)};
this.updateTable=function(t,a){for(var c=-1,m=0,b=r.length;m<b;m++)if(r[m].isSame(a)){c=m;break}-1<c&&(r.splice(c,1),r.splice(c,0,t),a.removePropertyChangeCallback(n),t.addPropertyChangeCallback(n))};this.batchAddTable=function(t){for(var a=0;a<t.length;a++)u.addTable(t[a])};this.setTables=function(t){r=t};this.getTable=function(t){for(var a=0,c=r.length;a<c;a++)if(r[a].getUid()==t)return r[a]};this.removeTable=function(t){var a=r.indexOf(t);-1<a&&(r.splice(a,1),t.removePropertyChangeCallback(n),
n(qa.KEY_REMOVE_TABLE,t));return a};this.batchRemoveTable=function(t){for(var a=0;a<t.length;a++){var c=t[a];u.removeTable(c);c.removePropertyChangeCallback(n)}};this.insertTable=function(t,a){for(var c=0,m=r.length;c<m;c++)if(r[c].isSame(t))return;r.splice(a,0,t);t.addPropertyChangeCallback(n);n(qa.KEY_ADD_TABLE,t)};this.getUserSqlTables=function(t){for(var a=[],c=0,m=r.length;c<m;c++){var b=r[c];b.isUserSql()&&b.getSourceUid()==t&&a.push(b)}return a};this.getAllUserSqlTables=function(){for(var t=
[],a=0,c=r.length;a<c;a++)r[a].isUserSql()&&t.push(r[a]);return t};this.getAllTable=function(t){for(var a=[],c=0,m=r.length;c<m;c++){var b=r[c];t?(u.protectedIsTableInUse(b)||b.isUserSql())&&a.push(b):u.protectedIsTableInUse(b)&&a.push(b)}return a};this.getSameTable=function(t){for(var a=0,c=r.length;a<c;a++)if(r[a].isSame(t))return r[a]};this.isSameTableAndSourceExist=function(t,a,c){for(var m=0;m<r.length;m++){var b=r[m];if(b.getTableName()==a&&b.getNamespace()==c&&u.getSource(b.getSourceUid()).getSourceId()==
t)return!0}return!1};this.setMaterializedConfig=function(t){L=t};this.getMaterializedConfig=function(){return L};this.toJsonObject=function(){var t={};t.type=F;for(var a=[],c=0;c<Q.length;c++)a.push(Q[c].toJsonObject());t.sources=a;a=[];for(c=0;c<r.length;c++){var m=r[c];(u.protectedIsTableInUse(m)||m.isUserSql())&&a.push(m.toJsonObject())}t.tables=a;L&&(t.materializedConfig=L.toJsonObject());u.protectedToJsonObject(t);return t};this.fromJsonObject=function(t){F=t.type;var a=t.sources;if(a)for(var c=
0;c<a.length;c++){var m=a[c],b=new Ya;b.fromJsonObject(m);Q.push(b)}if(a=t.tables)for(c=0;c<a.length;c++)m=new Oa,m.fromJsonObject(a[c]),m.addPropertyChangeCallback(n),r.push(m);(c=t.materializedConfig)?(L=new xa,L.fromJsonObject(c)):L=null;u.protectedFromJsonObject(t)};this.isUserSqlTableInUse=function(t){t=u.getSameTable(t);return u.protectedIsTableInUse(t)};this.protectedToJsonObject=function(t){};this.protectedFromJsonObject=function(t){};this.addPropertyChangeCallback=function(t){w.push(t)};
this.removePropertyChangeCallback=function(t){t=w.indexOf(t);-1<t&&w.splice(t,1)};this.clearPropertyChangeCallback=function(){w=[]};var n=function(t,a){for(var c=0,m=w.length;c<m;c++)w[c](t,a)};this.protectedMethod={firePropertyChangeEvt:n,copy:function(t){t.setType(F);for(var a=[],c=0;c<Q.length;c++)a.push(Q[c].copy());t.setSource(a,!0);a=[];for(c=0;c<r.length;c++)a.push(r[c].clone());t.setTables(a);L&&t.setMaterializedConfig(L.copy())}}}function Ua(){var u=this,F,Q,r,w,L,n,t,a,c=[];this.setId=function(b){F=
b};this.getId=function(){return F};this.setAlias=function(b){Q=b;w=void 0;m(qa.KEY_NODE_CHANGE_ALIAS,u)};this.getAlias=function(){return Q};this.setNameIndex=function(b){w=b};this.getNameIndex=function(){return w};this.getX=function(){return L};this.getY=function(){return n};this.getWidth=function(){return t};this.getHeight=function(){return a};this.setPosition=function(b,d){L=b;n=d};this.changePosition=function(b,d){u.setPosition(b,d);m(qa.KEY_NODE_CHANGE_POSITION,u)};this.setSize=function(b,d){t=
b;a=d};this.setType=function(b){r=b};this.getType=function(b){return r};this.addPropertyChangeCallback=function(b){c.push(b)};this.removePropertyChangeCallback=function(b){b=c.indexOf(b);-1<b&&c.splice(b,1)};this.toJsonObject=function(){var b={};b.id=F;b.alias=Q;b.x=L;b.y=n;b.type=r;w&&(b.nameIndex=w);u.protectedToJson(b);return b};this.fromJsonObject=function(b){F=b.id;Q=b.alias;L=b.x;n=b.y;r=b.type;var d=parseInt(b.nameIndex);isNaN(d)||(w=d);u.protectedFromJson(b)};this.protectedToJson=function(b){};
this.protectedFromJson=function(b){};var m=function(b,d){for(var h=0,O=c.length;h<O;h++)c[h](b,d)};this.protectedMethod={firePropertyChangeEvt:function(b){m(b,u)}}}function Oa(){var u=this,F,Q,r,w,L,n,t,a=[],c=[];this.setUid=function(b){F=b};this.getUid=function(){return F};this.isUserSql=function(){return n?!0:!1};this.getUserSql=function(){return n};this.setUserSql=function(b){n=b};this.setTableName=function(b){Q=b};this.getTableName=function(){return Q};this.setSourceUid=function(b){r=b};this.getSourceUid=
function(){return r};this.setNamespace=function(b){w=b};this.getNamespace=function(){return w};this.setDisplayName=function(b){L=b};this.getDisplayName=function(){return L};this.setSelectedFields=function(b){t=b;m(qa.KEY_TABLE_SELECT_FIELD,u)};this.getSelectedFields=function(){return t};this.setFilterItems=function(b){a=b;m(qa.KEY_TABLE_SET_FILTER,u)};this.getFilterItems=function(){return a};this.addPropertyChangeCallback=function(b){c.push(b)};this.removePropertyChangeCallback=function(b){b=c.indexOf(b);
-1<b&&c.splice(b,1)};this.isSame=function(b){return r==b.getSourceUid()&&Q==b.getTableName()&&w==b.getNamespace()&&(!u.isUserSql()&&!b.isUserSql()||u.isUserSql()&&b.isUserSql()&&(b=b.getUserSql(),b.getSqlType()==n.getSqlType()&&b.getContent()==n.getContent()))?!0:!1};this.toJsonObject=function(){var b={};b.id=F;b.name=Q;b.sourceId=r;b.namespace=w;u.isUserSql()&&(b.userSQL=n.toJsonObject());if(t){for(var d=[],h=0;h<t.length;h++)d.push(t[h].toJsonObject());b.selectedFields=d}if(a){d=[];for(h=0;h<a.length;h++)d.push(a[h].toJsonObject());
b.filterItems=d}return b};this.fromJsonObject=function(b){F=b.id;Q=b.name;r=b.sourceId;w=b.namespace;L=b.displayName;b.userSQL&&(n=new ib,n.fromJsonObject(b.userSQL));var d=b.selectedFields;if(d){for(var h=[],O=0;O<d.length;O++){var f=new Ma;f.fromJsonObject(d[O]);h.push(f)}t=h}if(b=b.filterItems){d=[];for(O=0;O<b.length;O++)h=new M,h.fromJsonObject(b[O]),d.push(h);a=d}};this.clone=function(){var b=new Oa;b.setUid(F);b.setTableName(Q);b.setNamespace(w);b.setDisplayName(L);b.setSourceUid(r);n&&b.setUserSql(n.copy());
var d=[];if(t){for(var h=0;h<t.length;h++)d.push(t[h].clone());b.setSelectedFields(d)}d=[];for(h=0;h<a.length;h++)d.push(a[h].copy());b.setFilterItems(d);return b};var m=function(b,d){for(var h=0,O=c.length;h<O;h++)c[h](b,d)}}function ib(){var u,F;this.getSqlType=function(){return u};this.setSqlType=function(Q){u=Q};this.setContent=function(Q){F=Q};this.getContent=function(){return F};this.fromJsonObject=function(Q){u=Q.type;F=Q.content};this.toJsonObject=function(){var Q={};Q.type=u;Q.content=F;
return Q};this.copy=function(){var Q=new ib;Q.setSqlType(u);Q.setContent(F);return Q}}function Ya(){var u,F,Q,r,w,L;this.setId=function(n){u=n};this.getId=function(){return u};this.getSourceId=function(){return F};this.setSourceId=function(n){F=n};this.setSourceRefId=function(n){Q=sId};this.getSourceRefId=function(){return Q};this.getName=function(){return r};this.setName=function(n){r=n};this.setSourceType=function(n){w=n};this.getSourceType=function(){return w};this.setModelId=function(n){L=n};
this.getModelId=function(){return L};this.copy=function(){var n=new Ya;n.setId(u);n.setSourceId(F);n.setSourceType(w);n.setName(r);n.setSourceType(w);n.setModelId(L);return n};this.toJsonObject=function(){var n={};n.id=u;n.modelSetSourceId=F;n.modelSetSourceRefId=Q;n.modelId=L;n.type=w;return n};this.fromJsonObject=function(n){u=n.id;F=n.modelSetSourceId;Q=n.modelSetSourceRefId;w=n.type;r=n.name}}function Ma(){var u=this,F,Q,r,w,L,n,t,a,c,m;this.setTableId=function(d){F=d};this.getTableId=function(){return F};
this.setFromNode=function(d){Q=d};this.getSourceNodeId=function(){return Q};this.setName=function(d){r=d};this.getName=function(){return r};this.getFullName=function(){return Q?Q+"_"+r:F+"_"+r};this.setAlias=function(d){w=d};this.getAlias=function(){return w?w:r};this.setDataType=function(d){b(d);L=d};this.getDataType=function(){return L};this.setAppointedDataType=function(d){d&&b(d);n=d==L?null:d};this.getAppointedDataType=function(){return n};this.getOutputDataType=function(){return n?n:L};this.setRoundMode=
function(d){a=d};this.getRoundMode=function(){return a};this.setScale=function(d){t=d};this.getScale=function(){return t};this.getFormat=function(){return c};this.setFormat=function(d){c=d};this.setExtensions=function(d){m=d};this.getEnumValue=function(){return m?m[Ma.EXTENSION_BIZ_FIELD_ENUM_KEY]:null};this.isMulBaseData=function(){return m?m[Ma.EXTENSION_IS_MUL_BASE_DATA]:!1};this.isPk=function(){return m?m[Ma.EXTENSION_IS_PK]:!1};this.isEnum=function(){if(u.isMulBaseData()||u.getOutputDataType()!=
Ma.DT_STRING)return!1;var d=u.getEnumValue();return 0==(d?Object.keys(d):[]).length?!1:!0};this.fromJsonObject=function(d){r=d.name;w=d.alias;L=d.dataType;n=d.appointedDataType;Q=d.fromNode;void 0!=d.scale&&(t=d.scale);d.roundMode&&(a=d.roundMode);m=d.extensions;d.format&&(c=d.format);d.tableId&&(F=d.tableId)};this.toJsonObject=function(){var d={};d.name=r;d.alias=w;d.dataType=L;d.fromNode=Q;n&&(d.appointedDataType=n);void 0!=t&&(d.scale=t);a&&(d.roundMode=a);m&&(d.extensions=m);F&&(d.tableId=F);
return d};var b=function(d){if(d!==Ma.DT_STRING&&d!==Ma.DT_INT&&d!==Ma.DT_NUMBER&&d!==Ma.DT_DATE&&d!==Ma.DT_DATETIME&&d!==Ma.DT_BOOLEAN)throw Error("IllegalArgument: "+d);};this.clone=function(){var d=new Ma;d.setName(r);L&&d.setDataType(L);d.setAlias(w);n&&d.setAppointedDataType(n);d.setFromNode(Q);void 0!=t&&d.setScale(t);a&&d.setRoundMode(a);d.setExtensions(m);c&&d.setFormat(c);F&&d.setTableId(F);return d};this.equals=function(d){return r==d.getName()&&w==d.getAlias()&&n==d.getAppointedDataType()&&
t==d.getScale()&&a==d.getRoundMode()?!0:!1}}function ya(){var u,F,Q,r;this.isExtractAllData=function(){return Q};this.isPreviewAllData=function(){return r};this.setExtractPartlyData=function(w,L){u=w;F=L};this.setExtractAllDataAndPreviewCount=function(w){u=ya.ALL_DATA_NUMBER;F=w};this.getExtractCount=function(){return u};this.setExtractCount=function(w){u=w};this.getPreviewCount=function(){return F};this.setPreviewCount=function(w){F=w};this.setExtractAllData=function(w){Q=w};this.setPreviewAllData=
function(w){r=w};this.setPreviewPartlyDataMode=function(w,L,n){u=L;F=n;Q=w};this.setPreviewPartlyDataMode=function(w,L,n,t){u=L;F=n;Q=w;r=t};this.setPreviewAllDataMode=function(){r=Q=!0};this.backup=function(){var w=new ya;w.setExtractCount(u);w.setPreviewCount(F);w.setExtractAllData(Q);w.setPreviewAllData(r);return w};this.toJsonObject=function(){var w={};w.extractCount=Q?ya.ALL_DATA_NUMBER:u;w.previewCount=r?ya.ALL_DATA_NUMBER:F;return w}}function Da(){var u=this,F,Q;this.setId=function(r){F=r};
this.getId=function(){return F};this.toJsonObject=function(){var r={};r.id=F;r.type=Q;u.protectedToJson(r);return r};this.protectedToJson=function(r){};this.protectedMethod={setType:function(r){Q=r}}}function va(){var u=[],F,Q=[];this.isValid=function(){return F};this.getCases=function(){return Q};this.getCheckedNodeIds=function(){return u};this.fromJsonObject=function(r){F=r.valid;u=r.nodeIds;if(r=r.cases){Q=[];for(var w=new I,L=0;L<r.length;L++){var n=r[L],t=w.getInvalidityCase(n.type);n&&(t.fromJsonObject(n),
Q.push(t))}}}}function I(){this.getInvalidityCase=function(u){switch(u){case K.TYPE_MULTI_OUTPUT:return new J;case K.TYPE_LACK_OUTPUT:return new X;case K.TYPE_INVALID_CONFIG:return new Z;case K.TYPE_LACK_INPUT:return new N;case K.TYPE_INVALID_UPWARDNODE:return new g;case K.TYPE_INVALID_SOURCE:return new ka;case K.TYPE_TABLE_NO_FIELD:return new C;case K.TYPE_TABLE_NO_AUTHORITY:return new ra}}}function K(){var u,F=this;this.getType=function(){return u};this.fromJsonObject=function(Q){u=Q.type;F.protectedFromJsonObject(Q)};
this.protectedFromJsonObject=function(Q){}}function J(){K.call(this);var u=[];this.protectedFromJsonObject=function(F){u=F.outputNodes};this.getOutputNodeIds=function(){return u}}function X(){K.call(this)}function Z(){K.call(this);var u;this.protectedFromJsonObject=function(F){u=F.nodeIds};this.getNodeIds=function(){return u}}function ra(){K.call(this);var u;this.protectedFromJsonObject=function(F){u=F.nodeIds};this.getNodeIds=function(){return u}}function N(){K.call(this);var u;this.protectedFromJsonObject=
function(F){u=F.nodeIds};this.getNodeIds=function(){return u}}function g(){K.call(this);var u;this.protectedFromJsonObject=function(F){u=F.nodeIds};this.getNodeIds=function(){return u}}function ka(){K.call(this);var u;this.protectedFromJsonObject=function(F){u=F.nodeIds};this.getNodeIds=function(){return u}}function C(){K.call(this);var u;this.protectedFromJsonObject=function(F){u=F.nodeIds};this.getNodeIds=function(){return u}}function ia(){var u,F=[],Q=[];this.getField=function(r){return F[r]};
this.getAllField=function(){return F};this.getColumnCount=function(){return F?F.length:0};this.getOneRow=function(r){return Q[r]};this.getRowCount=function(){return Q?Q.length:0};this.getNodeId=function(){return u};this.fromJsonObject=function(r){for(var w=r.fields,L=0;L<w.length;L++){var n=new Ma;n.fromJsonObject(w[L]);F.push(n)}Q=r.data;u=r.nodeId}}function M(){var u,F,Q,r,w=0,L=0,n,t=null;this.setField=function(c){(u=c)&&!c.isMulBaseData()&&F&&Q&&(c=c.getOutputDataType(),c!==Ma.DT_DATE&&c!==Ma.DT_DATETIME||
M.REG_DATETIME.test(Q)||M.isCompareOpWithinOrNotWithinValue(F)||(Q=(new Date).getTime()));a()};this.updateNotExistFieldByMyself=function(){var c=new Ma;c.setFromNode(u.getSourceNodeId());c.setName(u.getName());c.setAlias(u.getAlias());u=c};this.updateNotExistField=function(c){var m=new Ma;m.setFromNode(c.getSourceNodeId());m.setName(c.getName());m.setAlias(c.getAlias());u=m};this.getField=function(){return u};this.getTargetFieldFullName=function(){return u?u.getFullName():null};this.setCompareOp=
function(c){F=c};this.getCompareOp=function(){return F};this.setValue=function(c){Q=c;a()};this.getValue=function(){return Q};this.setDisplayValue=function(c){r=c};this.getDisplayValue=function(c){return r?!c&&M.isCompareOpWithinOrNotWithinValue(F)?JSON.parse(r).join(","):M.isCompareOpRelativeDateRangeValue(F)?(c=u.getOutputDataType()===Ma.DT_DATETIME,ua.modelToDisplayText(t,c)):r:""};this.setLeftBracketCount=function(c){w=c};this.getLeftBracketCount=function(){return w};this.setRightBracketCount=
function(c){L=c};this.getRightBracketCount=function(){return L};this.setLogicOp=function(c){n=c};this.getLogicOp=function(){return n};this.setRelativeDateRange=function(c){t=c};this.getRelativeDateRange=function(){return t};this.isEmpty=function(){return 0===w&&0===L&&!u&&!F&&!Q&&!n};var a=function(){if(u&&F){var c=u.getOutputDataType();if(Q){var m=u.isEnum(),b=u.isMulBaseData(),d=m?u.getEnumValue():null;if(M.isCompareOpWithinOrNotWithinValue(F))if(m){c=JSON.parse(Q);m=[];for(b=0;b<c.length;b++){var h=
d[c[b]];h&&m.push(h)}r=JSON.stringify(m)}else r=Q;else b?r=Q:c===Ma.DT_DATE||c===Ma.DT_DATETIME?(d=new Date,d.setTime(Q),m=new com.kingdee.bos.qing.common.DateFormater,b=m.setFormatString,c=c===Ma.DT_DATE?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss",b.call(m,c),r=m.format(d)):c===Ma.DT_BOOLEAN?(d=com.kingdee.bos.qing.framework.common.MultilanguageManager.createPackageAccessor(aa),r=Q===Ma.BOOLEAN_TRUE?d.get("dataTypeTrue","\u771f"):Q===Ma.BOOLEAN_FALSE?d.get("dataTypeFalse","\u5047"):""):r=m?d[Q]?d[Q]:"":Q}else r=
M.isCompareOpRelativeDateRangeValue(F)&&null!=t?ua.modelToDisplayText(t,c===Ma.DT_DATETIME):null}};this.copy=function(){var c=new M;c.setField(u);c.setCompareOp(F);c.setValue(Q);c.setDisplayValue(r);c.setLeftBracketCount(w);c.setRightBracketCount(L);c.setLogicOp(n);c.setRelativeDateRange(t);return c};this.equals=function(c){if(!c)return!1;var m;if(m=u.equals(c.getField())&&F===c.getCompareOp()&&Q===c.getValue()&&w===c.getLeftBracketCount()&&L===c.getRightBracketCount()&&n===c.getLogicOp())m=t||c.getRelativeDateRange()?
t&&c.getRelativeDateRange()?JSON.stringify(t.toJsonObject())===JSON.stringify(c.getRelativeDateRange().toJsonObject()):!1:!0;return m?!0:!1};this.toJsonObject=function(){if(!u)return null;var c={};c.field=u.toJsonObject();c.compareOp=F;c.value=Q;c.displayValue=r;c.leftBrackets=w;c.rightBrackets=L;c.logicOp=n;t&&(c.relativeDateRange=t.toJsonObject());return c};this.fromJsonObject=function(c){c&&(u=new Ma,u.fromJsonObject(c.field),F=c.compareOp,Q=c.value,r=c.displayValue,w=c.leftBrackets,L=c.rightBrackets,
n=c.logicOp,c=c.relativeDateRange)&&(t=new Aa,t.fromJsonObject(c))}}function la(){var u=this,F,Q=[];this.getNodeIdInConfig=function(){return[]};this.addPropertyChangeCallback=function(r){Q.push(r)};this.toJsonObject=function(){var r={};r.type=F;u.protectedToJsonObject(r);return r};this.fromJsonObject=function(r){F=r.type;u.protectedFromJsonObject(r)};this.protectedToJsonObject=function(r){};this.protectedFromJsonObject=function(r){};this.protectedMethod={firePropertyChangeEvt:function(r){for(var w=
0,L=Q.length;w<L;w++)Q[w](r)},setType:function(r){F=r}}}function na(){la.call(this);var u=this,F=this.protectedMethod;F.setType(la.TYPE_FILTER);var Q=[];this.getFilterItems=function(){return Q};this.setFilterItems=function(r){Q=r};this.copyFilterItems=function(){for(var r=[],w=0;w<Q.length;w++)r.push(Q[w].copy());return r};this.firePropertyChangeEvt=function(){F.firePropertyChangeEvt(TableModeler.KEY_TRANSFORM_FILTER)};this.getNotEmptyFilterItems=function(){for(var r=[],w=0;w<Q.length;w++)Q[w].isEmpty()||
r.push(Q[w]);return r};this.protectedToJsonObject=function(r){for(var w=u.getNotEmptyFilterItems(),L=[],n=0,t=w.length;n<t;n++)L.push(w[n].toJsonObject());r.filterItems=L};this.protectedFromJsonObject=function(r){if(r){r=r.filterItems;for(var w=0;w<r.length;w++){var L=new M;L.fromJsonObject(r[w]);Q.push(L)}}};this.clone=function(){var r=new na;r.setFilterItems(u.getNotEmptyFilterItems());return r}}function xa(){var u=xa.TYPE_ONCE,F=xa.STRATEGY_FULL,Q,r;this.setType=function(w){if(w===xa.TYPE_ONCE||
w===xa.TYPE_TIMING)u=w;else throw Error("IllegalArgument: "+w);};this.getType=function(){return u};this.setStrategy=function(w){if(w===xa.STRATEGY_FULL||w===xa.STRATEGY_INCREMENTAL)F=w;else throw Error("IllegalArgument: "+w);};this.getStrategy=function(){return F};this.setSchedule=function(w){Q=w};this.getSchedule=function(){return Q};this.setBasedFields=function(w){r=w};this.getBasedFields=function(){return r};this.copy=function(){var w=new xa;w.setType(u);w.setStrategy(F);Q&&w.setSchedule(Q.copy());
if(r){for(var L=[],n=0;n<r.length;n++)L.push(r[n].copy());w.setBasedFields(L)}return w};this.toJsonObject=function(){var w={};w.type=u;w.strategy=F;Q&&(w.schedule=Q.toJsonObject());if(r){for(var L=[],n=0;n<r.length;n++)L.push(r[n].toJsonObject());w.basedFields=L}return w};this.fromJsonObject=function(w){u=w.type;F=w.strategy;w.schedule&&(Q=new fa,Q.fromJsonObject(w.schedule));if(w=w.basedFields){r=[];for(var L=0;L<w.length;L++){var n=new za;n.fromJsonObject(w[L]);r.push(n)}}};this.equals=function(w){if(w instanceof
xa){if(u!==w.getType()||F!==w.getStrategy())return!1;var L=w.getSchedule();if(Q&&!L||!Q&&L)return!1;if(Q&&L){var n=Q.toJsonObject();L=L.toJsonObject();for(var t in n)if(n[t]!==L[t])return!1}w=w.getBasedFields();if(!r&&!w)return!0;if(!r||!w||r.length!==w.length)return!1;for(n=0;n<r.length;n++)if(!r[n].equals(w[n]))return!1;return!0}return!1}}function za(){var u,F,Q,r;this.setTableId=function(w){u=w};this.getTableId=function(){return u};this.setTableName=function(w){F=w};this.getTableName=function(){return F};
this.setName=function(w){Q=w};this.getName=function(){return Q};this.setAlias=function(w){r=w};this.getAlias=function(){return r};this.copy=function(){var w=new za;w.setTableId(u);w.setTableName(F);w.setName(Q);w.setAlias(r);return w};this.toJsonObject=function(){var w={};w.tableId=u;w.tableName=F;w.name=Q;w.alias=r;return w};this.fromJsonObject=function(w){u=w.tableId;F=w.tableName;Q=w.name;r=w.alias};this.equals=function(w){return w instanceof za?u===w.getTableId()&&F===w.getTableName()&&Q===w.getName()&&
r===w.getAlias():!1}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var aa=com.kingdee.bos.qing.modeler.designer;aa.QingModeler=function(){var u;this.setModelerModel=
function(F){u=F};this.getModelerModel=function(){return u};this.toJsonObject=function(){var F={};F.modelerModel=u.toJsonObject();return F};this.fromJsonObject=function(F){(F=F.modelerModel)&&(u=aa.ModelerModerParser.parseToModel(F.type,F))}};aa.AbstractModelerModelParser=function(){this.parseToModel=function(u){throw Error("override me");}};aa.ModelerModel=qa;aa.AbstractPage=function(){function u(n,t,a,c){this.getLeftExtension=function(){return n};this.getTopExtension=function(){return t};this.getHorizonExtension=
function(){return n+a};this.getVerticalExtension=function(){return t+c}}var F=this,Q=1024,r=768,w=[];this.getWidth=function(){return Q};this.getHeight=function(){return r};this.addPropertyChangeCallback=function(n){w.push(n)};this.setExtension=function(n,t,a,c){n=new u(n,t,a,c);Q+=n.getHorizonExtension();r+=n.getVerticalExtension();L(qa.KEY_PAGE_SIZE,n)};this.toJsonObject=function(){var n={};n.width=Q;n.height=r;F.protectedToJsonObject(n);return n};this.fromJsonObject=function(n){Q=n.width;r=n.height;
F.protectedFromJsonObject(n)};this.protectedToJsonObject=function(n){};this.protectedFromJsonObject=function(n){};var L=function(n,t){for(var a=0,c=w.length;a<c;a++)w[a](n,t)};this.protectedMethod={firePropertyChangeEvt:L}};aa.Node=Ua;aa.Table=Oa;aa.DesignTimeSource=Ya;aa.Field=Ma;aa.UserSQL=ib;aa.PreviewConfig=ya;aa.RuntimeModel=function(){var u,F=[],Q=[],r;this.setOutputVertexId=function(w){u=w};this.addEdge=function(w){F.push(w)};this.addVertex=function(w){Q.push(w)};this.getVertexes=function(){return Q};
this.setPreviewConfig=function(w){r=w};this.toJsonObject=function(){for(var w={},L=[],n=[],t=0,a=F.length;t<a;t++)L.push(F[t].toJsonObject());t=0;for(a=Q.length;t<a;t++)n.push(Q[t].toJsonObject());w.edges=L;w.vertexes=n;w.outputVertexId=u;w.previewConfig=r?r.toJsonObject():null;return w}};aa.Edge=function(u,F){this.toJsonObject=function(){var Q={};Q.fromId=u;Q.toId=F;return Q}};aa.SourceVertex=function(){Da.call(this);var u,F,Q;this.protectedMethod.setType(Da.TYPE_SOURCE);this.setTable=function(r){u=
r};this.setSource=function(r){F=r};this.setSelectedFields=function(r){Q=r};this.protectedToJson=function(r){r.table=u.toJsonObject();r.source=F.toJsonObject();if(Q){for(var w=[],L=0;L<Q.length;L++)w.push(Q[L].toJsonObject());r.selectedFields=w}}};aa.ExecuteResult=function(){var u,F=[],Q,r;this.getNodeId=function(){return u};this.getValidity=function(){return r};this.getPreviewData=function(){return Q};this.getFields=function(){return F};this.fromJsonObject=function(w){u=w.nodeId;var L=w.validity;
L&&(r=new va,r.fromJsonObject(L));if(L=w.previewData)Q=new ia,Q.fromJsonObject(L);if(w=w.fields)for(L=0;L<w.length;L++){var n=w[L],t=new Ma;t.fromJsonObject(n);F.push(t)}}};aa.PreviewData=ia;aa.PreviewResult=function(){var u,F,Q,r,w;this.getPreviewData=function(){return u};this.getTotalRowCount=function(){return Q};this.getJobId=function(){return r};this.getJobName=function(){return w};this.getModelerValidity=function(){return F};this.fromJsonObject=function(L){L.modelerValidity?F=L.modelerValidity:
(u=new ia,u.fromJsonObject(L.previewData),r=L.jobId,w=L.jobName,Q=L.totalRowCount)}};aa.FilterItem=M;aa.MaterializedConfig=xa;aa.BasedField=za;aa.FilterConfig=na;var Aa,ua,fa;(function(){var u=com.kingdee.bos.qing.common;Aa=u.RelativePeriodModel;u=com.kingdee.bos.qing.common.ui;ua=u.RelativePeriodPanel;u=com.kingdee.bos.qing.schedule;fa=u.QingSchedule})();aa.ModelerModerParser=new function(){var u={};this.registerParser=function(F,Q){u[F]=Q};this.parseToModel=function(F,Q){return(F=u[F])&&F.parseToModel(Q)}};
qa.TYPE_TABLE_MODELER="table";qa.TYPE_RELATION_MODELER="relation";qa.TYPE_METRIC_MODELER="metric";qa.KEY_UPDATE_TABLE="update_table";qa.KEY_ADD_TABLE="add_table";qa.KEY_REMOVE_TABLE="remove_table";qa.KEY_TABLE_SELECT_FIELD="table_select_field";qa.KEY_TABLE_SET_FILTER="table_set_filter";qa.KEY_PAGE_SIZE="page_change_size";qa.KEY_ADD_PREPARED_SOURCE="add_prepared_source";qa.KEY_REMOVE_PREPARED_SOURCE="remove_prepared_source";qa.KEY_SET_PREPARED_SOURCE="set_prepared_source";qa.KEY_NODE_CHANGE_ALIAS=
"node_change_alias";qa.KEY_NODE_CHANGE_POSITION="node_change_position";qa.KEY_TABLE_NODE_SELECT_FIELD="table_node_select_field";Ua.TYPE_TABLE="table";Ua.TYPE_TRANSFORM="transform";Ma.DT_BOOLEAN="BOOLEAN";Ma.DT_INT="INT";Ma.DT_NUMBER="NUMBER";Ma.DT_DATE="DATE";Ma.DT_DATETIME="DATETIME";Ma.DT_STRING="STRING";Ma.ROUND_MODE_UP="ROUND_UP";Ma.ROUND_MODE_DOWN="ROUND_DOWN";Ma.ROUND_MODE_HALF_UP="ROUND_HALF_UP";Ma.BOOLEAN_TRUE="true";Ma.BOOLEAN_FALSE="false";Ma.EXTENSION_BIZ_FIELD_ENUM_KEY="bizFieldEnumKey";
Ma.EXTENSION_IS_MUL_BASE_DATA="isMulBaseData";Ma.EXTENSION_IS_PK="isPK";aa.UIDHelper=new function(){var u,F={};this.init=function(b,d){F={};u=b;d&aa.UIDHelper.SUPPORT_TYPE_NODE&&t();d&aa.UIDHelper.SUPPORT_TYPE_SOURCE&&a();d&aa.UIDHelper.SUPPORT_TYPE_TABLE&&c();d&aa.UIDHelper.SUPPORT_TYPE_LINE&&m();d&aa.UIDHelper.SUPPORT_TYPE_DIMENSION&&r();d&aa.UIDHelper.SUPPORT_TYPE_PUBLIC_DIMENSION&&w();d&aa.UIDHelper.SUPPORT_TYPE_METRIC&&L();d&aa.UIDHelper.SUPPORT_TYPE_REFERENCE&&n()};this.getUID=function(b){var d=
F[b];d||(d=0);d+=1;F[b]=d;return b+d};var Q=function(b,d,h){for(var O=0,f=0;f<d.length;f++)for(var e=h(d[f]),z=0;z<e.length;z++){var H=e[z];O=Math.max(O,parseInt(H.slice(b.length,H.length)))}F[b]=O},r=function(){var b=u.getAllDimension();b&&Q(aa.UIDHelper.NS_DIMENSION,b,function(d){return[d.getDimensionId()]})},w=function(){var b=u.getPublicDimensions();b&&Q(aa.UIDHelper.NS_PUBLIC_DIMENSION,b,function(d){return[d.getId()]});(b=u.getAllDimension())&&Q(aa.UIDHelper.NS_PUBLIC_DIMENSION,b,function(d){return[d.getPublicDimensionId()]})},
L=function(){var b=u.getAllMetric();b&&Q(aa.UIDHelper.NS_METRIC,b,function(d){return[d.getId()]})},n=function(){var b=u.getExprReferences();b&&Q(aa.UIDHelper.NS_REFERENCE,b,function(d){return[d.getId()]})},t=function(){var b=u.getAllNodes();b&&Q(aa.UIDHelper.NS_NODE,b,function(d){var h=[];h.push(d.getId());d.getType()==Ua.TYPE_TRANSFORM&&(d=d.getNodeIdInConfig(),h=h.concat(d));return h})},a=function(){var b=u.getAllSource();b&&Q(aa.UIDHelper.NS_SOURCE,b,function(d){return[d.getId()]})},c=function(){var b=
u.getAllTable();b&&Q(aa.UIDHelper.NS_TABLE,b,function(d){return[d.getUid()]})},m=function(){var b=u.getAllLines();b&&Q(aa.UIDHelper.NS_LINE,b,function(d){return[d.getId()]})}};aa.UIDHelper.NS_NODE="n";aa.UIDHelper.NS_LINE="l";aa.UIDHelper.NS_TABLE="t";aa.UIDHelper.NS_SOURCE="s";aa.UIDHelper.NS_DIMENSION="d";aa.UIDHelper.NS_PUBLIC_DIMENSION="pd";aa.UIDHelper.NS_METRIC="m";aa.UIDHelper.NS_REFERENCE="r";aa.UIDHelper.SUPPORT_TYPE_NODE=1;aa.UIDHelper.SUPPORT_TYPE_LINE=2;aa.UIDHelper.SUPPORT_TYPE_TABLE=
4;aa.UIDHelper.SUPPORT_TYPE_SOURCE=8;aa.UIDHelper.SUPPORT_TYPE_DIMENSION=16;aa.UIDHelper.SUPPORT_TYPE_PUBLIC_DIMENSION=32;aa.UIDHelper.SUPPORT_TYPE_METRIC=64;aa.UIDHelper.SUPPORT_TYPE_REFERENCE=128;aa.UIDHelper.METRIC_SCENE=aa.UIDHelper.SUPPORT_TYPE_TABLE|aa.UIDHelper.SUPPORT_TYPE_SOURCE|aa.UIDHelper.SUPPORT_TYPE_DIMENSION|aa.UIDHelper.SUPPORT_TYPE_PUBLIC_DIMENSION|aa.UIDHelper.SUPPORT_TYPE_METRIC|aa.UIDHelper.SUPPORT_TYPE_REFERENCE;ya.ALL_DATA_NUMBER=-1;Da.TYPE_SOURCE="source";Da.TYPE_TRANSFORM_FIELD_SELECT=
"field_select";Da.TYPE_TRANSFORM_FIELD_SETTING="field_setting";Da.TYPE_TRANSFORM_GROUP_BY="group_by";Da.TYPE_TRANSFORM_FILTER="filter";Da.TYPE_TRANSFORM_SORT="sort";Da.TYPE_TRANSFORM_JOIN="join";K.TYPE_MULTI_OUTPUT="multiOutput";K.TYPE_LACK_OUTPUT="lackOutputNode";K.TYPE_INVALID_CONFIG="invalidConfig";K.TYPE_LACK_INPUT="lackInputNode";K.TYPE_INVALID_UPWARDNODE="invalidUpwardNode";K.TYPE_INVALID_SOURCE="invalidSource";K.TYPE_TABLE_NO_FIELD="tableNoField";K.TYPE_TABLE_NO_AUTHORITY="tableNoAuthority";
M.REG_NUMBER=/^-?\d+(\.\d+)?$/;M.REG_DATETIME=/^-?\d+(\.\d+)?$/;M.COMPARE_EQUAL="EQUAL";M.COMPARE_NOT_EQUAL="NOT_EQUAL";M.COMPARE_GREATER="GREATER";M.COMPARE_GREATER_EQUAL="GREATER_EQUAL";M.COMPARE_LESS="LESS";M.COMPARE_LESS_EQUAL="LESS_EQUAL";M.COMPARE_INCLUDE="INCLUDE";M.COMPARE_NOT_INCLUDE="NOT_INCLUDE";M.COMPARE_START_WITH="START_WITH";M.COMPARE_END_WITH="END_WITH";M.COMPARE_NULL="NULL";M.COMPARE_NOT_NULL="NOT_NULL";M.COMPARE_IN="IN";M.COMPARE_NOT_IN="NOT_IN";M.COMPARE_RELATIVE_DATE_RANGE="RELATIVE_DATE_RANGE";
M.LOGIC_AND="AND";M.LOGIC_OR="OR";M.COMPARES_FOR_STRING=[M.COMPARE_EQUAL,M.COMPARE_NOT_EQUAL,M.COMPARE_INCLUDE,M.COMPARE_NOT_INCLUDE,M.COMPARE_START_WITH,M.COMPARE_END_WITH,M.COMPARE_NULL,M.COMPARE_NOT_NULL,M.COMPARE_IN,M.COMPARE_NOT_IN];M.COMPARES_FOR_ENUM=[M.COMPARE_EQUAL,M.COMPARE_NOT_EQUAL,M.COMPARE_NULL,M.COMPARE_NOT_NULL,M.COMPARE_IN,M.COMPARE_NOT_IN];M.COMPARES_FOR_NUMBER=[M.COMPARE_EQUAL,M.COMPARE_NOT_EQUAL,M.COMPARE_GREATER,M.COMPARE_GREATER_EQUAL,M.COMPARE_LESS,M.COMPARE_LESS_EQUAL,M.COMPARE_NULL,
M.COMPARE_NOT_NULL,M.COMPARE_IN,M.COMPARE_NOT_IN];M.COMPARES_FOR_DATETIME=[M.COMPARE_RELATIVE_DATE_RANGE,M.COMPARE_EQUAL,M.COMPARE_NOT_EQUAL,M.COMPARE_GREATER,M.COMPARE_GREATER_EQUAL,M.COMPARE_LESS,M.COMPARE_LESS_EQUAL,M.COMPARE_NULL,M.COMPARE_NOT_NULL];M.COMPARES_FOR_BOOLEAN=[M.COMPARE_EQUAL,M.COMPARE_NOT_EQUAL,M.COMPARE_NULL,M.COMPARE_NOT_NULL];M.isCompareOpWithoutValue=function(u){return u===M.COMPARE_NULL||u===M.COMPARE_NOT_NULL};M.isCompareOpWithinOrNotWithinValue=function(u){return u===M.COMPARE_IN||
u===M.COMPARE_NOT_IN};M.isCompareOpRelativeDateRangeValue=function(u){return u===M.COMPARE_RELATIVE_DATE_RANGE};M.getSelectableCompares=function(u,F){switch(u){case Ma.DT_STRING:return F?M.COMPARES_FOR_ENUM:M.COMPARES_FOR_STRING;case Ma.DT_NUMBER:case Ma.DT_INT:return M.COMPARES_FOR_NUMBER;case Ma.DT_DATE:case Ma.DT_DATETIME:return M.COMPARES_FOR_DATETIME;case Ma.DT_BOOLEAN:return M.COMPARES_FOR_BOOLEAN;default:throw Error("Unknown DataType");}};M.FiltersCheckingResult=function(u,F){var Q=F;this.getFiltersErrorRow=
function(){return u};this.getPrompt=function(){return Q};this.setPrompt=function(r){Q=r}};la.TYPE_FIELD_SELECT="field_select";la.TYPE_FIELD_SETTING="field_setting";la.TYPE_FILTER="filter";la.TYPE_SORT="sort";la.TYPE_GROUP_BY="group_by";la.TYPE_CALCULATED_FIELD="calculated_field";la.TYPE_CUSTOM_GROUP="custom_group";la.TYPE_JOIN="join";la.TYPE_UNION="union";xa.TYPE_ONCE="once";xa.TYPE_TIMING="timing";xa.STRATEGY_FULL="full";xa.STRATEGY_INCREMENTAL="incremental";aa.ENTITY_SEPARATOR="@#!&@"})();(function(){function qa(){var Ya,Ma,ya,Da,va;this.setFromTable=function(I){Ya=I};this.getFromTable=function(){return Ya};this.setFromProperty=function(I){ya=I};this.getFromProperty=function(){return ya};this.setToTable=function(I){Ma=I};this.getToTable=function(){return Ma};this.setToProperty=function(I){Da=I};this.getToProperty=function(){return Da};this.setRelated=function(I){va=I};this.getRelated=function(){return va};this.fromJsonObject=function(I){Ya=I.fromModel;Ma=I.toModel;ya=I.fromField;Da=
I.toField;va=I.related};this.toJsonObject=function(I){I={};I.fromModel=Ya;I.toModel=Ma;I.fromField=ya;I.toField=Da;I.related=va;return I}}function Ua(){var Ya=this,Ma,ya,Da;this.setUid=function(va){Ma=va};this.getUid=function(){return Ma};this.setId=function(va){Da=va};this.getId=function(){return Da};this.getSourceType=function(){return ya};this.fromJsonObject=function(va){Ma=va.id;ya=va.type;Ya.protectedFromJsonObject(va)};this.toJsonObject=function(){var va={};va.type=ya;va.id=Ma;Ya.protectedToJsonObject(va);
return va};this.protectedToJsonObject=function(va){};this.protectedFromJsonObject=function(va){};this.protectedMethod={setSourceType:function(va){ya=va}}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&
(com.kingdee.bos.qing.modeler.designer={});var Oa=com.kingdee.bos.qing.modeler.designer;Oa.AbstractModelerSource=Ua;Oa.ModelSetDataSource=function(){var Ya,Ma,ya,Da,va,I,K;this.getErrorMessage=function(){return K};this.getSpecificType=function(){return I};this.getSourceName=function(){return Ya};this.setSourceName=function(J){Ya=J};this.getId=function(){return Ma};this.setId=function(J){Ma=J};this.setCreatorName=function(J){ya=J};this.getCreatorName=function(){return ya};this.setCreateTime=function(J){Da=
J};this.getCreateTime=function(){return Da};this.setSourceType=function(J){va=J};this.getSourceType=function(){return va};this.fromJsonObject=function(J){Ma=J.id;Ya=J.sourceName;va=J.sourceType;Da=J.createTime;ya=J.creatorName;var X=J.source;va===Ua.SOURCE_TYPE_PUBLIC_DATA_SOURCE&&"DB"===X.sourceType?I=X.publicSourceType:va===Ua.SOURCE_TYPE_MODELSET_DB_SOURCE&&X.dbType?I=X.dbType:va===Ua.SOURCE_TYPE_MODELSET_FILE_SOURCE&&X.fileType&&(I=X.fileType);J.errorMessage&&(K=J.errorMessage)}};Oa.Meta=function(){var Ya,
Ma,ya,Da,va;this.setTableNode=function(I){Ya=I};this.getTableNode=function(){return Ya};this.setPropertyMap=function(I){Ma=I};this.getPropertyMap=function(){return Ma};this.setSourceType=function(I){ya=I};this.getSourceType=function(){return ya};this.setRelations=function(I){Da=I};this.getRelations=function(){return Da};this.setErrorMap=function(I){va=I};this.getErrorMap=function(){return va};this.fromJsonObject=function(I){Ya=I.tableNode;if(Ma=I.propertiesMap)for(var K in Ma){var J=Ma[K];if(J&&0<
J.length){for(var X=[],Z=0;Z<J.length;Z++){var ra=new ib,N=J[Z];ra.fromJsonObject(J[Z]);N.number&&ra.setName(N.number);X.push(ra)}Ma[K]=X}}ya=I.sourceType;if((K=I.relations)&&0<K.length)for(Da=[],Z=0;Z<K.length;Z++)J=new qa,J.fromJsonObject(K[Z]),Da.push(J);va=I.errorMap}};var ib=Oa.Field;qa.R_1_1="From1To1";qa.R_1_N="From1ToN";qa.R_N_1="FromNTo1";qa.KFW_FROM=1;qa.KFW_TO=2;qa.KEY_FROM_ENTITY="fromEntity";qa.KEY_FROM_PROPERTY="fromProperty";qa.KEY_FROM_PROPERTY_ALIAS_CHANED="fromPropertyAliasChanged";
qa.KEY_TO_PROPERTY_ALIAS_CHANED="toPropertyAliasChanged";qa.KEY_TO_ENTITY="toEntity";qa.KEY_TO_PROPERTY="toProperty";qa.KEY_RELATED="related";Ua.SOURCE_TYPE_PUBLIC_DATA_SOURCE="PublicDBSource";Ua.SOURCE_TYPE_CURRENT_ENTITY_SOURCE="ERPCloudEntity";Ua.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE="ERPCloudDBCenter";Ua.SOURCE_TYPE_MODELSET_FILE_SOURCE="FileSource";Ua.SOURCE_TYPE_MODELSET_DB_SOURCE="DBSource";Ua.SOURCE_TYPE_MODEL_SET_SOURCE="ModelSet";Ua.SOURCE_TYPE_OPEN_API_SOURCE="OpenAPI"})();(function(){function qa(){var ya,Da,va,I=!1,K,J,X=!1,Z;this.setUid=function(ra){J=ra};this.getUid=function(){return J};this.setId=function(ra){Z=ra};this.getId=function(){return Z};this.setCommentInfo=function(ra){K=ra};this.getCommentInfo=function(){return K};this.setMatch=function(ra){I=ra};this.getMatch=function(){return I};this.setName=function(ra){ya=ra};this.getName=function(){return ya};this.setDisplayName=function(ra){Da=ra};this.getDisplayName=function(){return Da};this.setParentNode=function(ra){va=
ra};this.getParentNode=function(){return va};this.setChecked=function(ra){X=ra};this.isChecked=function(){return X};this.check=function(ra){};this.getSubNodeLevel=function(){for(var ra=-1,N=va;N;)ra++,N=N.getParentNode();return ra}}function Ua(){qa.call(this);var ya=this,Da=[],va=!0;this.setChildren=function(I){Da=I};this.getChildren=function(){return Da};this.setExpanded=function(I){va=I};this.isExpanded=function(){return va};this.check=function(I,K){var J=function(Z){Z.getParentNode()&&(K&&K(Z.getParentNode()),
1==Z.getParentNode().getChildren().length&&J(Z.getParentNode()))};if(0!==Da.length&&I!==ya.isChecked()){ya.setChecked(I);for(var X=0;X<Da.length;X++)Da[X].check(I,K);J(ya)}};this.toJsonObject=function(){var I={};I.children=Da;return I};this.fromJsonObject=function(I,K){ya.setName(I.name);ya.setDisplayName(I.displayName);ya.setId(I.id);if(I=I.children)for(var J=0;J<I.length;J++){var X=I[J];if(X.type){var Z=new Oa;Z.fromJsonObject(X);Z.setParentNode(ya);Da.push(Z);K&&Z.setCommentInfo(K)}else Z=new Ua,
Z.fromJsonObject(X),Z.setParentNode(ya),Da.push(Z)}}}function Oa(){qa.call(this);var ya=this,Da,va,I,K,J;this.setNumber=function(X){va=X};this.getNumber=function(){return va};this.setUserSql=function(X){J=X};this.getUserSql=function(){return J};this.setCommentInfo=function(X){I=X};this.getCommentInfo=function(){return I};this.setType=function(X){Da=X};this.getType=function(){return Da};this.setErrorMessage=function(X){K=X};this.getErrorMessage=function(){return K};this.fromJsonObject=function(X){ya.setType(X.type);
ya.setName(X.name);ya.setDisplayName(X.displayName);ya.setId(X.id);ya.setNumber(X.number);X.commentInfo&&(ya.setName(X.name),ya.setCommentInfo(X.commentInfo))};this.check=function(X,Z){var ra=function(N){N.getParentNode()&&(Z&&Z(N.getParentNode()),1==N.getParentNode().getChildren().length&&ra(N.getParentNode()))};X!==ya.isChecked()&&(ya.setChecked(X),ra(ya))}}function ib(){var ya=!1,Da=!1,va=!1,I=Ma.get("selectTable","\u9009\u62e9\u8868"),K=Ma.get("metricSearchTable","\u641c\u7d22\u6570\u636e\u8868\u540d\u79f0"),
J=Ma.get("metricSearchTable","\u641c\u7d22\u6570\u636e\u8868\u540d\u79f0"),X=10,Z=360;this.getCodePlaceHolder=function(){return J};this.getPlaceHolder=function(){return K};this.isShowAppUi=function(){return ya};this.isShowEntityMark=function(){return Da};this.isShowModelNumber=function(){return va};this.getTitle=function(){return I};this.getTop=function(){return X};this.getHeight=function(){return Z};this.protectedMethod={setShowAppUi:function(ra){ya=ra},setShowEntityMark:function(ra){Da=ra},setShowModelNumber:function(ra){va=
ra},setTitle:function(ra){I=ra},setTop:function(ra){X=ra},setHeight:function(ra){Z=ra},setPlaceHolder:function(ra){K=ra},setCodePlaceHolder:function(ra){J=ra}}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&
(com.kingdee.bos.qing.modeler.designer={});var Ya=com.kingdee.bos.qing.modeler.designer;Ya.FolderNode=Ua;Ya.LeafNode=Oa;Ya.DraggingTableNode=function(){var ya,Da;this.setTableNode=function(va){ya=va};this.getTableNode=function(){return ya};this.setTable=function(va){Da=va};this.getTable=function(){return Da}};Ya.NodeStatusMonitor=function(){var ya=this,Da,va=[],I=[],K=[],J={};this.reset=function(){ya.setSelected(void 0);ya.setInvalidNodes([])};this.addSelectNodeListener=function(Z){va.push(Z)};this.removeSelectNodeListener=
function(Z){Z=va.indexOf(Z);-1<Z&&va.splice(Z,1)};this.setSelected=function(Z){if(Da!==Z){var ra=Da;Z=Da=Z;for(var N=0;N<va.length;N++)(0,va[N])(ra,Z)}};this.getSelected=function(){return Da};this.setInvalidNodes=function(Z,ra){I=Z;J={};if(Z&&ra)for(var N=Math.min(Z.length,ra.length),g=0;g<N;g++){var ka=Z[g];if(ka){var C=ra[g];J[ka.getId()]=C}}X()};this.getInvalidNodes=function(){return I};this.isInvalidNode=function(Z){if(!I)return!1;for(var ra=0;ra<I.length;ra++){var N=I[ra];if(N&&N.getId()==Z)return!0}return!1};
this.getInvalidPrompt=function(Z){if(Z&&(Z=J[Z.getId()]))return Z.getPrompt()};this.addInvalidNode=function(Z,ra){Z&&(0>I.indexOf(Z)&&I.push(Z),ra&&(J[Z.getId()]=ra),X())};this.removeInvalidNode=function(Z){var ra=I.indexOf(Z);-1<ra&&(I.splice(ra,1),J[Z.getId()]=null,X())};this.batchUpdateNodeValidity=function(Z,ra,N){if(Z&&ra)for(var g=Math.min(Z.length,ra.length),ka=0;ka<g;ka++){var C=Z[ka];if(C){var ia=ra[ka],M=I.indexOf(C);0>M&&I.push(C);J[C.getId()]=ia}}if(N)for(ka=0;ka<N.length;ka++)C=N[ka],
M=I.indexOf(C),-1<M&&(I.splice(M,1),J[C.getId()]=null);X()};this.addInvalidNodeChangeListener=function(Z){K.push(Z)};this.removeInvalidNodeChangeListener=function(Z){Z=K.indexOf(Z);-1<Z&&K.splice(Z,1)};this.getInvalidState=function(Z){return J[Z.getId()]};var X=function(){for(var Z=0;Z<K.length;Z++)(0,K[Z])(I)}};Ya.MetricEntitySource=function(){ib.call(this);var ya=this.protectedMethod;ya.setShowEntityMark(!0);ya.setTitle(Ma.get("selectEntity","\u9009\u62e9\u5b9e\u4f53"));ya.setHeight(310);ya.setPlaceHolder(Ma.get("metricSearchEntity",
"\u641c\u7d22\u5b9e\u4f53\u540d\u79f0"));ya.setCodePlaceHolder(Ma.get("metricSearchEntityCode","\u641c\u7d22\u5b9e\u4f53\u540d\u79f0/\u5b9e\u4f53\u6807\u8bc6"))};Ya.MetricDataCenterSource=function(){ib.call(this);var ya=this.protectedMethod;ya.setShowAppUi(!0);ya.setTop(15);ya.setHeight(330)};Ya.MetricDefaultSource=function(){ib.call(this)};Ya.MetricModelSetSource=function(){ib.call(this);var ya=this.protectedMethod;ya.setShowModelNumber(!0);ya.setTitle(Ma.get("selectModel","\u9009\u62e9\u6a21\u578b"));
ya.setHeight(310);ya.setPlaceHolder(Ma.get("metricSearchModel","\u641c\u7d22\u6a21\u578b\u540d\u79f0"));ya.setCodePlaceHolder(Ma.get("metricSearchModelCode","\u641c\u7d22\u6a21\u578b\u540d\u79f0/\u6a21\u578b\u7f16\u7801"))};var Ma=com.kingdee.bos.qing.framework.common.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.modeler.designer)})();(function(){function qa(){var Z=1,ra=[];this.zoomIn=function(){var g=qa.SUPPORT_SCALES.indexOf(Z);g<qa.SUPPORT_SCALES.length-1&&(Z=qa.SUPPORT_SCALES[g+1],N())};this.zoomOut=function(){var g=qa.SUPPORT_SCALES.indexOf(Z);0<g&&(Z=qa.SUPPORT_SCALES[g-1],N())};this.isMinScale=function(){return qa.SUPPORT_SCALES[0]==Z};this.isMaxScale=function(){return qa.SUPPORT_SCALES[qa.SUPPORT_SCALES.length-1]==Z};this.getRatio=function(){return Z};this.setCustomRatio=function(g){Z=g};this.getScaledSize=function(g){return 1==
Z?g:Z*g};this.getRawSize=function(g){return 1==Z?g:g/Z};this.getScaledCoordinate=function(g){return 1==Z?g:[Z*g[0],Z*g[1]]};this.getRawCoordinate=function(g){return 1==Z?g:[g[0]/Z,g[1]/Z]};this.addPropertyChangedListener=function(g){ra.push(g)};var N=function(){for(var g=0;g<ra.length;g++){var ka=ra[g];ka&&ka()}}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing=
{});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var Ua=com.kingdee.bos.qing.modeler.designer;Ua.Toolbar=function(){var Z=new Oa,ra,N=$("<div>"),g=$("<div>"),ka=$("<div>");this.getJqUi=function(){ra||(ra=Z.getJqUi(),ra.addClass("modeler-designer-toolbar"),C(N),C(g),C(ka));return ra};this.addButton=function(M,la,na,xa){return ia(g,!1,M,la,na,xa)};this.addButtonForHeadCustom=
function(M,la,na,xa){return ia(N,!1,M,la,na,xa)};this.addButtonForTailCustom=function(M,la,na,xa){return ia(ka,!1,M,la,na,xa)};this.addMenuButton=function(M,la,na,xa){return ia(g,!0,M,la,na,xa)};this.addMenuButtonForHeadCustom=function(M,la,na,xa){return ia(N,!0,M,la,na,xa)};this.addMenuButtonForTailCustom=function(M,la,na,xa){return ia(ka,!0,M,la,na,xa)};this.getAllBtnWidth=function(){return N.width()+g.width()+ka.width()};var C=function(M){M.css({"float":"left",position:"relative",height:"100%"});
M.appendTo(ra)},ia=function(M,la,na,xa,za,aa){M=Z.createButton(M,la,na,za,aa);M.setIconSetter(function(Aa,ua){Ua.Icons.background(Aa,ua)});M.setIconName(xa);return M}};Ua.RemoteImpl=function(){Da.call(this);var Z;this.getRemoteUrl=function(){return Z};this.setRemoteUrl=function(ra){Z=ra}};Ua.Integration=function(){var Z,ra,N,g,ka,C=!0;this.setMapTableException=function(ia){ka=ia};this.getMapTableException=function(){return ka};this.setMapSourceType=function(ia){g=ia};this.getMapSourceType=function(){return g};
this.setMapSourcePermission=function(ia){N=ia};this.getMapSourcePermission=function(){return N};this.setModelName=function(ia){Z=ia};this.getModelName=function(){return Z};this.setModelDesc=function(ia){ra=ia};this.getModelDesc=function(){return ra};this.setModelIsValid=function(ia){C=ia};this.isValidModel=function(){return C}};Ua.StatusBar=function(){var Z,ra,N,g,ka;this.getJqUi=function(){Z||(Z=$("<div>"),Z.addClass("modeler-designer-statusbar"),ra=$("<span>"),ra.addClass("modeler-designer-statusbar-name"),
ra.appendTo(Z),N=$("<span>"),N.addClass("modeler-designer-statusbar-dirtystate"),N.appendTo(Z),g=$("<span>"),g.addClass("modeler-designer-statusbar-prompt"),g.appendTo(Z));return Z};this.setCurrentName=function(ia){ra.text(ia)};this.showDirtyState=function(ia){N.text(ia?"*":"")};this.showShortPrompt=function(ia,M,la){clearTimeout(ka);g.text(ia);g.css("color",la?la:"");if(M){var na=0,xa=function(){if(6<na)C();else{if(0==na%2){g.text(ia);var za=650}else g.text(""),za=350;ka=setTimeout(xa,za);na++}};
xa()}else C()};var C=function(){ka=setTimeout(function(){g.text("")},5E3)}};Ua.DesignerFacade=function(Z,ra,N,g){Ma.call(this,Z,ra,N,g);var ka=this.protectedMethod;this.loadTables=function(C){C={source:JSON.stringify(C.toJsonObject()),needFilterMetric:!0};ka.remote("loadTables",C)};this.getMeta=function(C,ia){C={source:JSON.stringify(C.toJsonObject()),table:JSON.stringify(ia.toJsonObject())};ka.remote("getMeta",C)};this.getTableField=function(C,ia){for(var M=[],la=[],na=0;na<C.length;na++)M.push(C[na].toJsonObject());
for(na=0;na<ia.length;na++)la.push(ia[na].toJsonObject());C={sources:JSON.stringify(M),tables:JSON.stringify(la)};ka.remote("getTableField",C)};this.getTableFieldWithCheckModel=function(C){C={model:JSON.stringify(C.toJsonObject())};ka.remote("getTableFieldWithCheckModel",C)};this.getDBCenterTables=function(C){ka.remote("getDBCenterTables",{appNumber:C})};this.checkConnection=function(C){ka.remote("checkConnection",{sourceId:C})};this.checkMetricFormula=function(C,ia,M,la){var na={};if(M)for(var xa=
Object.keys(M),za=0;za<xa.length;za++){for(var aa=xa[za],Aa=M[aa],ua=[],fa=0;fa<Aa.length;fa++)ua.push(Aa[fa].toJsonObject());na[aa]=ua}C={expr:C,metricId:la,model:JSON.stringify(ia.toJsonObject()),fields:JSON.stringify(na)};ka.remote("checkMetricFormula",C)};this.previewMetrics=function(C,ia,M,la){C={modeler:JSON.stringify(C),filters:JSON.stringify(ia),previewConfig:JSON.stringify(M),metricId:la};ka.remote("previewMetrics",C)};this.getFirstPageMetric=function(C,ia){C={model:JSON.stringify(C),previewConfig:JSON.stringify(ia.toJsonObject())};
ka.remote("getFirstPageMetric",C)};this.updateMetricByPage=function(C,ia,M,la,na){C={model:JSON.stringify(C),jobId:ia,jobName:M,startIndex:la,pageSize:na};ka.remote("updateMetricByPage",C)};this.exportMetricData=function(C,ia,M,la){C={jobId:C,jobName:ia,totalRowCount:M,model:JSON.stringify(la)};ka.remote("exportMetricData",C)};this.getTotalRowCount=function(C,ia){ka.remote("getTotalRowCount",{jobId:C,jobName:ia})};this.deleteResultDataFile=function(C,ia){ka.remote("deleteResultDataFile",{jobId:C,
jobName:ia})};this.getMetricDimValues=function(C,ia,M){C={modeler:JSON.stringify(C),dimensionId:ia,metricId:M};ka.remote("getMetricDimValues",C)};this.getTablePreviewData=function(C,ia,M,la){C={source:JSON.stringify(C.toJsonObject()),table:JSON.stringify(ia.toJsonObject()),filters:JSON.stringify(M),rowCount:la};ka.remote("getTablePreviewData",C)};this.getDataRowCount=function(C,ia,M){C={source:JSON.stringify(C.toJsonObject()),table:JSON.stringify(ia.toJsonObject()),filters:JSON.stringify(M)};ka.remote("getDataRowCount",
C)};this.cronExpression=function(C){ka.remote("cronExpression",{cron:C})};this.checkDataWarehouseConfig=function(){ka.remote("checkDataWarehouseConfig",{})};this.checkReferencedModel=function(C,ia,M){C={source:JSON.stringify(C.toJsonObject()),table:JSON.stringify(ia.toJsonObject()),modelId:M};ka.remote("checkReferencedModel",C)};this.checkModelerValid=function(C){C={model:JSON.stringify(C)};ka.remote("checkModelerValid",C)};this.checkMetricTableException=function(C,ia,M){C={source:JSON.stringify(C.toJsonObject()),
table:JSON.stringify(ia.toJsonObject()),modelId:M};ka.remote("checkMetricTableException",C)}};Ua.PageScaleHelper=qa;var Oa,ib,Ya,Ma,ya,Da,va,I,K,J;(function(){var Z=com.kingdee.bos.qing.ui.component;Oa=Z.Toolbar;ib=Z.SimpleConfirmer;va=Z.MessageDialog;Z=com.kingdee.bos.qing.framework.common;Ya=Z.AbstractIcons;ya=Z.MultilanguageManager.createPackageAccessor(Ua);Da=Z.AbstractRemoteCall;Ma=Z.AbstractFacade;Z=com.kingdee.bos.qing.common;J=Z.RelativePeriodModel;I=Ua.FilterItem;K=Ua.Field})();Ua.Icons=
new function(){Ya.call(this);var Z=this.protectedMethod,ra;this.setComboIconImpl=function(ka){ra=ka};this.protectedInit=function(ka,C){if(!ra)throw Error("qing modeler comboIcon not found.");ra.define(C,"designer");C.setIconSize(16,16);N(0,0,"edit");N(0,1,"delete");N(0,2,"add");N(0,3,"zoomIn");N(0,4,"zoomOut");N(0,5,"layout");N(0,6,"rightArrow");N(0,7,"leftArrow");N(0,8,"upArrow");N(0,9,"downArrow");g(0,10,"qingWarning");g(0,11,"relation");g(0,12,"qingTable");N(0,13,"expanded");N(0,14,"expand");g(0,
15,"btn_edit");N(0,17,"trial_calc");g(1,12,"qingTable_hover");N(0,18,"moveUp");g(0,19,"reset");N(0,20,"createDim");N(0,21,"publicDimension");N(0,22,"metric_filter");N(2,21,"metric_copy");N(2,22,"new_filter");g(4,22,"exist_filter");C.setStartPosition(84,35);g(0,0,"select_field");g(0,1,"field_setting");g(0,2,"join");g(0,3,"union");g(0,4,"filter");g(0,5,"sort");g(0,6,"group_by");g(0,7,"calculate_field");N(0,8,"metric",!0);C.setStartPosition(84,52);g(0,0,"entity-sub");g(0,1,"entity-entry");g(0,2,"unlock");
g(0,3,"lock_by_other");g(0,4,"lock_by_me");g(0,5,"tick");g(0,6,"cross");C.setIconSize(20,20);C.setStartPosition(0,35);g(0,0,"leftJoin");g(0,1,"rightJoin");g(0,2,"innerJoin");g(0,3,"fullJoin");C.setStartPosition(238,35);C.setIconSize(32,32);g(0,0,"metric_icon");C.setStartPosition(288,35);C.setIconSize(16,16);N(0,0,"table_relation_with_hover");g(1,0,"table_relation");g(0,1,"custom_group");C.setStartPosition(0,55);C.setIconSize(20,20);N(0,0,"setting");g(0,1,"warning");C.setIconSize(60,80);C.setStartPosition(0,
98);g(0,0,"no_source");C.setIconSize(138,78);C.setStartPosition(240,240);g(0,0,"no_data_cloud");C.setIconSize(253,140);C.setStartPosition(62,71);g(0,0,"drag_node_prompt");C.setIconSize(210,170);C.setStartPosition(0,211);g(0,0,"no_node_and_source");ra.define(C,"source");C.setStartPosition(0,20);C.setIconSize(16,16);g(0,0,"entity");g(0,1,"data");g(0,2,"modelSet");g(0,3,"file");g(0,4,"data-center");g(0,5,"table");g(0,6,"openapi");C.setStartPosition(85,0);C.setIconSize(16,16);g(0,0,"table_selected");
C.setStartPosition(101,0);g(0,0,"f7");C.setStartPosition(0,40);C.setIconSize(20,20);C.setGap(0,1);g(0,0,"modelset-source-icon");g(0,1,"mysql");g(0,2,"datacenter-source-icon");g(0,3,"entity-source-icon");g(0,4,"oracle");g(0,5,"postgresql");g(0,6,"sqlserver");g(0,7,"greenplum");g(0,8,"access");g(0,9,"db2");g(0,10,"odps");g(0,11,"sparksql");g(1,1,"redshift");g(1,2,"apachedrill");g(1,3,"hive");g(1,4,"impala");g(1,5,"kylin");g(1,6,"dm");g(1,7,"gaussdb");g(1,8,"sybaseiq");g(1,9,"sqlite");g(1,10,"sybase");
g(2,2,"doris");g(2,3,"hana");C.setGap(0,0);g(1,0,"excel");g(2,0,"txt");g(2,1,"csv");g(1,11,"xml");g(2,4,"kingbase");g(2,5,"tdsql");g(2,6,"gbase");g(2,7,"vastbase");g(2,8,"yashandb");g(2,9,"openapi-source-icon");g(2,10,"tidb");C.setStartPosition(120,-1);C.setIconSize(16,16);N(0,0,"refresh");C.setStartPosition(180,-1);C.setIconSize(16,16);N(0,0,"menu");C.setStartPosition(0,110);C.setIconSize(120,93);g(0,0,"no-permission");C.setStartPosition(100,100);C.setIconSize(138,84);g(0,0,"search-no-result");ra.define(C,
"metatree");C.setGap(1);C.setStartPosition(1,1);C.setIconSize(16,16);N(0,0,"DATE",!0);N(0,1,"STRING",!0);N(0,5,"TABLE",!0);N(0,8,"DATETIME",!0);N(0,9,"BOOLEAN",!0);N(0,10,"NUMBER",!0);N(0,11,"INT",!0);ra.define(C,"metric");C.setStartPosition(0,0);C.setIconSize(260,160);g(0,0,"add_metric");C.setStartPosition(0,164);C.setIconSize(210,170);g(0,0,"no_metric");C.setStartPosition(230,165);C.setIconSize(12,12);g(0,0,"add_metric_plug_sign")};var N=function(ka,C,ia,M){var la=ia+"_hover";M?(g(ka,C,ia),g(ka+
1,C,la)):(g(ka,C,la),g(ka+1,C,ia))},g=function(ka,C,ia){Z.registIcon(ka,C,ia)}};Ua.LockHelper=new function(){var Z,ra,N,g,ka,C,ia,M,la=!1;this.show=function(xa){C=$("<div>");C.addClass("modeler-designer-lock-statusbar");ia=$("<div>");M=$("<div>");M.addClass("modeler-designer-lock-text");ia.addClass("modeler-designer-lock-icon");C.append(M);C.append(ia);C.appendTo(xa);C.on("click",na);la=!0};this.registerLockRequestSender=function(xa){g=xa};this.setGlobal=function(xa){Z=xa};this.setLockStateChangeListener=
function(xa){ka=xa};this.setLockInfo=function(xa,za,aa){if(la){N=za;ra=xa?Ua.LockHelper.STATE_LOCK_BY_ME:za?Ua.LockHelper.STATE_LOCK_BY_OTHER:Ua.LockHelper.STATE_UNLOCK;ka&&ka(ra==Ua.LockHelper.STATE_LOCK_BY_ME);if(!aa){if(ra==Ua.LockHelper.STATE_LOCK_BY_OTHER){var Aa=ya.get("lockByOtherPrompt","\u5f53\u524d\u6a21\u578b\u5df2\u88ab\u201c#1\u201d\u9501\u5b9a\uff0c\u60a8\u7684\u4fee\u6539\u5c06\u65e0\u6cd5\u4fdd\u5b58\uff0c\u5efa\u8bae\u60a8\u9501\u5b9a\u5f53\u524d\u6a21\u578b\u540e\u518d\u8fdb\u884c\u7f16\u8f91\u3002");
Aa=Aa.replace("#1",N)}else ra==Ua.LockHelper.STATE_UNLOCK&&(Aa=ya.get("unlockPrompt","\u5f53\u524d\u6a21\u578b\u672a\u9501\u5b9a\uff0c\u4e0d\u53ef\u7f16\u8f91\uff0c\u8bf7\u9501\u5b9a\u6a21\u578b\u540e\u518d\u8fdb\u884c\u64cd\u4f5c"));Aa?Z.getMessageCurtain().showPrompt(Aa,-1):ra==Ua.LockHelper.STATE_LOCK_BY_ME&&Z.getMessageCurtain().showSuccess(ya.get("lockSuccess","\u60a8\u5df2\u6210\u529f\u9501\u5b9a\u8be5\u6a21\u578b"))}xa="lock_by_other";if(ra==Ua.LockHelper.STATE_UNLOCK){xa="unlock";var ua=ya.get("unlock",
"\u672a\u9501\u5b9a")}else ra==Ua.LockHelper.STATE_LOCK_BY_OTHER?ua=ya.get("lockedBy","\u5df2\u88ab\u201c#1\u201d\u9501\u5b9a").replace("#1",N):ra==Ua.LockHelper.STATE_LOCK_BY_ME&&(ua=ya.get("lockedBy","\u5df2\u88ab\u201c#1\u201d\u9501\u5b9a").replace("#1",ya.get("me","\u6211")),xa="lock_by_me");Ua.Icons.background(ia,xa);M.text(ua);M.attr("title",ua)}};this.setMaxWidth=function(xa){M&&M.css("max-width",Math.max(0,Math.min(xa-50,250))+"px")};var na=function(){if(g){var xa=ra!=Ua.LockHelper.STATE_LOCK_BY_ME;
if(xa)g(xa);else{var za=new ib;za.setText(ya.get("confirmUnlock","\u786e\u5b9a\u8981\u89e3\u9501\u5f53\u524d\u6a21\u578b\uff1f"));za.setConfirmedListener(function(aa){aa&&g(xa)});za.show(C)}}}};Ua.LockHelper.STATE_LOCK_BY_ME="lock_by_me";Ua.LockHelper.STATE_LOCK_BY_OTHER="lock_by_other";Ua.LockHelper.STATE_UNLOCK="unlock";Ua.DppVersionExceptionHandler=new function(){var Z=!1;this.handle=function(ra){if(20001101!=ra)return!1;Z||(Z=!0,ra=va.createFeedbackDialog(),ra.setMsgImageType(va.MSG_WARNING),
ra.setMessage(ya.get("dppVersionException","\u8f7b\u5efa\u6a21\u5ba2\u6237\u7aef\u7248\u672c\u4e0e\u6570\u636e\u5904\u7406\u5f15\u64ce\u7248\u672c\u4e0d\u4e00\u81f4\uff0c\u8bf7\u8054\u7cfb\u8fd0\u7ef4\u4eba\u5458\u5347\u7ea7\u5ba2\u6237\u7aef\u6216\u5f15\u64ce\u3002")),ra.setOptionType(va.OPTION_OK),ra.setButtonText(va.RETURN_OK,ya.get("iSee","\u6211\u77e5\u9053\u4e86")),ra.setClosedAction(function(){Z=!1}),ra.showDialog());return!0}};Ua.PropDataTypeUtil=new function(){this.getDataTypeDesc=function(Z){switch(Z){case K.DT_STRING:Z=
ya.get("text","\u6587\u672c");break;case K.DT_NUMBER:Z=ya.get("number","\u6570\u503c");break;case K.DT_INT:Z=ya.get("integer","\u6574\u6570");break;case K.DT_DATE:Z=ya.get("dataTypeDate","\u65e5\u671f");break;case K.DT_DATETIME:Z=ya.get("dateTime","\u65e5\u671f\u65f6\u95f4");break;case K.DT_BOOLEAN:Z=ya.get("bool","\u5e03\u5c14");break;default:Z=""}return Z}};qa.SUPPORT_SCALES=[.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5];Ua.NodeResultCache=new function(){var Z={},ra={},N=[];this.cacheOneNodeField=function(g,
ka,C){if(C){var ia=ra[g];if(!ia||ia<C)for(Z[g]=ka,C=0;C<N.length;C++)(ia=N[C])&&ia(g,ka)}};this.removeNodeCache=function(g){Z[g]=void 0;ra[g]=void 0};this.getOneNodeField=function(g){return Z[g]};this.addCacheChangeListener=function(g){N.push(g)};this.clear=function(){Z={};ra={}}};Ua.FilterCheckHelper=new function(){this.checkFilterField=function(N,g){if(!g)return N=ya.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5"),new I.FiltersCheckingResult(-1,N);for(var ka,C=0;C<N.length;C++){var ia=N[C];
if(!ia.isEmpty()){ka=Z(ia,C,g);if(!ka)if(ka=C,ia=ra(ia)){var M=ya.get("incompleteFilter","\u7b2c#1\u884c\u4e0d\u5b8c\u6574\uff0c");M=M.replace("#1",ka+1);ka=new I.FiltersCheckingResult(ka,M+ia)}else ka=null;if(ka)break}}return ka};this.checkFilterLogical=function(N){var g=0,ka=-1,C,ia=0;for(C=0;C<N.length;C++)N[C].isEmpty()||(ia=C);C=ia;for(ia=0;ia<N.length;ia++){var M=N[ia];if(!M.isEmpty()){g+=M.getLeftBracketCount();g-=M.getRightBracketCount();0>ka&&0!=g&&(ka=ia);if(0>g)return N=ya.get("bracketMismatch",
"\u5de6\u53f3\u62ec\u53f7\u4e0d\u5339\u914d\u3002"),new I.FiltersCheckingResult(ka,N);if(ia!==C&&!M.getLogicOp())return N=ya.get("lackLogicalSymbol","\u7b2c#1\u884c\u7f3a\u5c11\u903b\u8f91\u7b26"),N=N.replace("#1",ia+1),new I.FiltersCheckingResult(ia,N);if(ia==C&&M.getLogicOp())return N=ya.get("logicalSymbolUnnecessary","\u5b58\u5728\u591a\u4f59\u7684\u903b\u8f91\u3002"),new I.FiltersCheckingResult(ia,N)}}return 0<g?(N=ya.get("bracketMismatch","\u5de6\u53f3\u62ec\u53f7\u4e0d\u5339\u914d\u3002"),new I.FiltersCheckingResult(ka,
N)):null};this.checkFieldExisted=function(N,g){return Z(N,-1,g)?!1:!0};var Z=function(N,g,ka){N=N.getField();for(var C=0;C<ka.length;C++)if(N&&ka[C].getFullName()===N.getFullName())return null;ka=ya.get("lackField","\u7b2c#1\u884c\u5b57\u6bb5\u4e0d\u5b58\u5728\u3002");ka=ka.replace("#1",g+1);return new I.FiltersCheckingResult(g,ka)},ra=function(N){var g=N.getCompareOp(),ka=N.getField(),C=N.getValue(),ia=ka?ka.getOutputDataType():null;ka=ka?ka.isEnum():!1;ka=I.getSelectableCompares(ia,ka);N=N.getRelativeDateRange();
if(!g)return ya.get("lackComparisonOperator","\u7f3a\u5c11\u6bd4\u8f83\u7b26\u3002");for(var M=!1,la=0;la<ka.length;la++)if(g===ka[la]){M=!0;break}if(!M)return ya.get("comparisonMismatch","\u6bd4\u8f83\u7b26\u4e0d\u5339\u914d\u3002");if(!I.isCompareOpWithoutValue(g)){if(!C&&!N)return ya.get("lackValue","\u7f3a\u5c11\u503c\u3002");if(ia===K.DT_NUMBER||ia===K.DT_INT){if(!I.REG_NUMBER.test(C)&&!I.isCompareOpWithinOrNotWithinValue(g))return ya.get("valueMustBeNum","\u503c\u5fc5\u987b\u4e3a\u6570\u5b57\u3002")}else if(ia===
K.DT_DATE||ia===K.DT_DATETIME)if(I.isCompareOpRelativeDateRangeValue(g)){if(!(N instanceof J))return ya.get("invalidRelativeDateValue","\u65e0\u6548\u7684\u76f8\u5bf9\u65e5\u671f\u503c\u3002")}else{if(!I.REG_DATETIME.test(C))return ya.get("invalidDateValue","\u65e0\u6548\u7684\u65e5\u671f\u503c\u3002")}else if(ia===K.DT_BOOLEAN&&C!==K.BOOLEAN_TRUE&&C!==K.BOOLEAN_FALSE)return ya.get("wrongBoolean","\u9519\u8bef\u7684\u5e03\u5c14\u503c\u3002")}return null}};var X=new function(){var Z;this.hookCollector=
function(ra){Z=ra};this.occur=function(ra,N){try{Z&&Z(ra,N)}catch(g){window.console&&console.warn(g)}}};X.BUTTON_TYPE="button-type";X.FUNCTION="function";X.DATATABLE_MODEL_TRANSFORM_NODE_TYPE="datatable-model-transform-node-type";X.METRIC_MODEL_DIMENSION_TYPE="metric-model-dimension-type";X.ENTER_DATA_AUTH_MANAGE="enter-data-auth-manage";X.SAVE="\u4fdd\u5b58";X.REFRESH="\u5237\u65b0";X.DEPLOY="\u90e8\u7f72";X.ROLLBACK_CURRENT_DEPLOY="\u56de\u9000\u5230\u6700\u65b0\u90e8\u7f72\u72b6\u6001";X.UNDO=
"\u64a4\u9500";X.REDO="\u53cd\u64a4\u9500";X.CLEAR="\u6e05\u9664";X.MODEL_CHECK="\u6a21\u578b\u6821\u9a8c";X.MODEL_PREVIEW="\u6a21\u578b\u9884\u89c8";X.MODEL_PROPERTY="\u6a21\u578b\u5c5e\u6027";X.SOURCE_MANAGE="\u6570\u636e\u6e90\u7ba1\u7406";X.MODEL_PREVIEW_EXPORT_TO_EXCEL="\u9884\u89c8-\u5bfc\u51fa\u5230Excel";X.METRIC_DELETE="\u5220\u9664";X.TRIAL_CALCULATE="\u8bd5\u8ba1\u7b97";X.TRIAL_CALCULATE_DIMENSION_FILTER="\u8bd5\u8ba1\u7b97-\u7ef4\u5ea6\u8fc7\u6ee4";X.SOURCE_TABLE_FILTER="\u6e90\u8868\u8fc7\u6ee4";
X.SELECT_FIELD="\u9009\u62e9\u5b57\u6bb5";X.METRIC_FILTER="\u6307\u6807\u8fc7\u6ee4";X.NUMBER_FOMMAT="\u6570\u5b57\u683c\u5f0f";X.ADD_DIMENSION="\u65b0\u589e\u7ef4\u5ea6";X.PUBLIC_DIMENSION_SETTING="\u516c\u5171\u7ef4\u5ea6\u8bbe\u7f6e";X.ENTER_DATA_AUTH_MANAGE_AFTER_DEPLOY="\u6210\u529f\u90e8\u7f72\u540e\u70b9\u51fb\u8df3\u8f6c\u8fdb\u5165";Ua.UserOperationReporter=X})();(function(){function qa(){var Ya;this.setCaption=function(Ma){Ya=Ma};this.getCaption=function(){return Ya?Ya:""};this.perform=function(){throw Error("Override me.");};this.unperform=function(){throw Error("Override me.");}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler=
{});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var Ua=com.kingdee.bos.qing.modeler.designer;Ua.CommandManager=function(){var Ya=[],Ma=[],ya=new ib;this.perform=function(I){I.perform();Da(Ya,I);Ma.length=0;va(I,!0)};this.addPerformedListener=function(I){ya.addListener(I)};this.isCanUndo=function(){return 0<Ya.length};this.isCanRedo=function(){return 0<Ma.length};this.undo=function(){var I=Ya.pop();I&&(I.unperform(),Da(Ma,I),va(I,!1,!0))};this.redo=
function(){var I=Ma.pop();I&&(I.perform(),Da(Ya,I),va(I,!1,!1))};this.reset=function(){Ya.length=0;Ma.length=0;va(null)};var Da=function(I,K){I.push(K);32<I.length&&I.splice(0,1)},va=function(I,K,J){ya.fireEvent(function(X){X(I,K,J)})}};Ua.AbstractAction=qa;Ua.ActionSetModel=function(){qa.call(this);var Ya,Ma,ya;this.setValue=function(Da,va,I){Ma=Da;ya=va;Ya=I};this.perform=function(){Ya(ya)};this.unperform=function(){Ya(Ma)}};Ua.ActionChangeModelInfo=function(){qa.call(this);var Ya,Ma,ya,Da,va;this.getCaption=
function(){return Oa.get("editModelInfo","\u7f16\u8f91\u6a21\u578b\u5c5e\u6027")};this.setValue=function(I,K,J,X,Z){Ya=I;Ma=K;ya=J;Da=X;va=Z};this.perform=function(){Ya.setModelName(Ma);Ya.setModelDesc(Da)};this.unperform=function(){Ya.setModelName(ya);Ya.setModelDesc(va)}};Ua.ActionAddRemoveSource=function(){qa.call(this);var Ya,Ma,ya,Da;this.getCaption=function(){return Ya};this.setValue=function(va,I,K){Ma=K.getAllSource();var J="",X="";ya=[];for(var Z=0;Z<Ma.length;Z++){var ra=Ma[Z];-1<I.indexOf(ra)?
(0<X.length&&(X+="\uff0c"),X+=ra.getName()):ya.push(ra)}for(Z=0;Z<va.length;Z++)I=va[Z],ya.push(I),0<J.length&&(J+="\uff0c"),J+=I.getName();Ya="";0<J.length&&(Ya+=Oa.get("actionAddSource","\u6dfb\u52a0\u6570\u636e\u6e90\u201c#1\u201d").replace("#1",J));0<X.length&&(0<Ya.length&&(Ya+="\uff1b"),Ya+=Oa.get("actionRemoveSource","\u5220\u9664\u6570\u636e\u6e90\u201c#1\u201d").replace("#1",X));Da=K};this.perform=function(){Da.setSource(ya)};this.unperform=function(){Da.setSource(Ma)}};Ua.ActionMoveNode=
function(){qa.call(this);var Ya,Ma,ya,Da;this.getCaption=function(){if(!Da){var va=Ua.DisplayNameHelper.getNodeDisplayName(Ya);Da=Oa.get("actionMoveNode","\u79fb\u52a8\u8282\u70b9\u201c#1\u201c").replace("#1",va)}return Da};this.setValue=function(va,I){Ya=va;Ma=I;ya=[Ma[0]-Ya.getX(),Ma[1]-Ya.getY()]};this.perform=function(){Ya.changePosition(Ma[0],Ma[1])};this.unperform=function(){Ya.changePosition(Ya.getX()-ya[0],Ya.getY()-ya[1])}};Ua.ActionChangeMaterializedConfig=function(){qa.call(this);var Ya,
Ma,ya;this.getCaption=function(){return Oa.get("editMaterializedConfig","\u7f16\u8f91\u7269\u5316\u5b58\u50a8\u8bbe\u7f6e")};this.setValue=function(Da,va){Ya=Da;ya=va};this.perform=function(){Ma=Ya.getMaterializedConfig();Ya.setMaterializedConfig(ya)};this.unperform=function(){Ya.setMaterializedConfig(Ma)}};var Oa,ib;(function(){var Ya=com.kingdee.bos.qing.framework.common;Oa=Ya.MultilanguageManager.createPackageAccessor(Ua);Ya=com.kingdee.bos.qing.common;ib=Ya.EventListenerList})()})();(function(){function qa(){var Aa,ua,fa,u,F,Q,r,w,L,n,t,a,c={},m=[],b=!0,d=!0,h=!0,O,f,e,z,H,D;this.getJqUi=function(){if(!f){l();if(p())for(var S=Aa.getModelerModel(),Ja=S.getAllTable(),ca=0;ca<Ja.length;ca++){var Ga=Ja[ca];if(S.getSource(Ga.getSourceUid()).getSourceType()!==la.SOURCE_TYPE_MODELSET_FILE_SOURCE){var $a=Ga.getUid(),oa=k(S,$a,!1);0<oa.length&&(m.push(Ga),c[$a]=oa)}}f=$("<div>");D=$("<div>");S=new Z;u=new ra;F=new ra;Q=new ra;u.setText(ya.get("neverExtract","\u4e0d\u8fdb\u884c\u7269\u5316\u5b58\u50a8\uff0c\u603b\u662f\u5b9e\u65f6\u6267\u884c\u6a21\u578b"));
F.setText(ya.get("onceExtract","\u4ec5\u5728\u90e8\u7f72\u65f6\u7269\u5316\u5b58\u50a8\u4e00\u6b21\uff0c\u4ee5\u540e\u4e0d\u518d\u66f4\u65b0"));Q.setText(ya.get("timingExtract","\u5b9a\u65f6\u8fdb\u884c\u7269\u5316\u5b58\u50a8"));S.addElement(u);S.addElement(F);S.addElement(Q);Ja=u.getJqUi();ca=F.getJqUi();Ga=Q.getJqUi();Ma.layoutCtrl(Ja,0,0,530,23);Ma.layoutCtrl(ca,0,35,530,23);Ma.layoutCtrl(Ga,0,70,530,23);Ja.appendTo(f);ca.appendTo(f);Ga.appendTo(f);$a=$("<div>");$a.text(ya.get("materializationMethod",
"\u7269\u5316\u65b9\u5f0f"));var W=new N;W.setIconType(N.ICON_TYPE_QUESTION);W.setTipsSize(300,105);W.setTipsHtml(ya.get("materializationTechniqueTips","\u5168\u91cf\u7269\u5316\uff1a\u6839\u636e\u6267\u884c\u8ba1\u5212\uff0c\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u6267\u884c\u6a21\u578b\uff0c\u5e76\u5c06\u6a21\u578b\u7684\u6267\u884c\u7ed3\u679c\u8fdb\u884c\u7269\u5316\u5b58\u50a8\u3002<br/>\u589e\u91cf\u7269\u5316\uff1a\u6839\u636e\u6267\u884c\u8ba1\u5212\uff0c\u5728\u6307\u5b9a\u7684\u65f6\u95f4\uff0c\u6309\u7167\u6240\u9009\u7684\u4f9d\u636e\u5b57\u6bb5\u8fdb\u884c\u589e\u91cf\u6570\u636e\u63d0\u53d6\u5e76\u6267\u884c\u6a21\u578b\uff0c\u5c06\u6267\u884c\u7ed3\u679c\u66f4\u65b0\u81f3\u5386\u53f2\u7269\u5316\u7ed3\u679c\u4e2d\u3002"));
Ja=new Z;r=new ra;w=new ra;r.setText(ya.get("fullMaterialize","\u5168\u91cf\u7269\u5316"));w.setText(ya.get("incrementalMaterialize","\u589e\u91cf\u7269\u5316"));Ja.addElement(r);Ja.addElement(w);ca=$("<div>");oa=$("<div>");Ga=$("<div>");W=W.getJqUi();var Ta=r.getJqUi(),Ca=w.getJqUi();Ma.layoutCtrl(oa,0,0,540,19);Ma.layoutCtrl(Ta,20,30,250,23);Ma.layoutCtrl(Ga,20,60,520,23);Ma.layoutCtrl(ca,0,0,540,90);$a.appendTo(oa);W.appendTo(oa);oa.appendTo(ca);Ta.appendTo(ca);Ca.appendTo(Ga);Ga.appendTo(ca);
ca.appendTo(D);$a.addClass("modeler-designer-materialized-method-label");W.addClass("modeler-designer-materialized-method-label-tips");oa.css({"border-bottom":"1px solid #CCCCCC"});Ca.css({display:"inline-block"});w.setCustomStyle("position","relative");oa=new X;oa.setText(ya.get("basedField","\u4f9d\u636e\u5b57\u6bb5"));L=E();$a=new N;$a.setIconType(N.ICON_TYPE_QUESTION);$a.setTipsSize(200,70);$a.setTipsText(ya.get("basedFieldHelpTips","\u4ec5\u652f\u6301\u201c\u65e5\u671f\u65f6\u95f4\u201d\u578b\u548c\u201c\u6574\u6570\u201d\u578b\u7684\u81ea\u589e\u5b57\u6bb5\u4f5c\u4e3a\u589e\u91cf\u7269\u5316\u7684\u4f9d\u636e\u5b57\u6bb5\u3002"));
z=$("<div>");M.background(z,"qingWarning");z.hide();e=$("<div>");oa=oa.getJqUi();W=L.getJqUi();$a=$a.getJqUi();Ma.layoutCtrl(oa,0,0,50,23);Ma.layoutCtrl($a,52,3,16,16);Ma.layoutCtrl(z,80,3,16,16);Ma.layoutCtrl(W,80,0,150,23);oa.appendTo(e);$a.appendTo(e);z.appendTo(e);W.appendTo(e);e.appendTo(Ga);e.addClass("modeler-designer-materialized-based-field");Ga=new X;Ga.setText(ya.get("executePlan","\u6267\u884c\u8ba1\u5212"));n=new Da;n.isOnlyPeriod(!0);n.setCronAnalysisFacade(B);n.setScheduleChangedListener(A);
H=$("<div>");Ga=Ga.getJqUi();$a=n.getJqUi();Ma.layoutCtrl(Ga,0,0,540,23);Ma.layoutCtrl($a,11,30,300,200);Ma.layoutCtrl(H,0,100,540,225);Ma.layoutCtrl(D,20,105,540,350);Ga.appendTo(H);$a.appendTo(H);H.appendTo(D);D.appendTo(f);Ga.children(":first-child").css("font-weight","bold");Ga.css("border-bottom","1px solid #CCCCCC");S.addChangedListener(Y);Ja.addChangedListener(ha);t||(u.getJqUi().hide(),F.getJqUi().css("top","0px"),Q.getJqUi().css("top","35px"),D.css("top","70px"),ca.hide(),Ga.hide(),H.css("top",
"0px"),$a.css({left:"-9px",top:"-5px"}));q()}return f};this.setGlobal=function(S){Aa=S};this.setRemoteImpl=function(S){ua=S};this.setSupportIncrementConfig=function(S){t=S};this.setMessageCurtain=function(S){fa=S};this.setMaterializedConfig=function(S){a=S;q()};this.getMaterializedConfig=function(){G();return a};this.checkMaterializedConfig=function(){G();if(!a)return!0;if(!b)return fa.showPrompt(ya.get("noDataWarehouseConfig","\u5f53\u524d\u73af\u5883\u672a\u914d\u7f6e\u201c\u8f7b\u6570\u4ed3\u6570\u636e\u6e90\u201d\u53c2\u6570\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u5728MC\u4e2d\u8fdb\u884c\u914d\u7f6e\u3002")),
!1;if(!d)return fa.showPrompt(ya.get("dataWarehouseConfigParseError","\u201c\u8f7b\u6570\u4ed3\u6570\u636e\u6e90\u201d\u53c2\u6570\u89e3\u6790\u5f02\u5e38\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u5728MC\u4e2d\u91cd\u65b0\u914d\u7f6e\u3002")),!1;if(xa.TYPE_TIMING===a.getType()){if(xa.STRATEGY_INCREMENTAL===a.getStrategy()){if(!p())return fa.showPrompt(ya.get("noSupportIncrement","\u5f53\u524d\u6a21\u578b\u4e0d\u652f\u6301\u589e\u91cf\u7269\u5316\u3002")),!1;var S=a.getBasedFields();if(!S||0===S.length)return fa.showPrompt(ya.get("noBasedField",
"\u4f9d\u636e\u5b57\u6bb5\u4e0d\u80fd\u4e3a\u7a7a\u3002")),!1;for(var Ja=0;Ja<S.length;Ja++){var ca=v(S[Ja].getTableId(),S[Ja].getName());if(!ca||ia.DT_INT!==ca.getOriginalDataType()&&ia.DT_DATETIME!==ca.getOriginalDataType())return fa.showPrompt(ya.get("incompleteMaterializedConfig","\u7269\u5316\u5b58\u50a8\u8bbe\u7f6e\u4e0d\u5b8c\u6574")+ya.get("punctuation_period","\u3002")),!1}}S=a.getSchedule();if(S.getPeriod()===va.Period_Custom){Ja=S.getCron();if("undefined"==typeof Ja||""===Ja)return S=t?
ya.get("cronEmptyError","\u6267\u884c\u8ba1\u5212\u4e2d\u8868\u8fbe\u5f0f\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u683c\u5f0f\u5982 0 0 12 * * ?"):ya.get("cronEmptyErrorForMetric","\u8868\u8fbe\u5f0f\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u683c\u5f0f\u5982 0 0 12 * * ?"),fa.showPrompt(S),!1;if(S=S.getCronMsg())return S=t?ya.get("executePlanIng","\u6267\u884c\u8ba1\u5212\u4e2d")+S:S,fa.showPrompt(S),!1;if(!h)return O?(S=t?ya.get("cronMinimumIntervalError","\u6267\u884c\u8ba1\u5212\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e#1\u5206\u949f\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002"):
ya.get("cronMinimumIntervalErrorForMetric","\u8868\u8fbe\u5f0f\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e#1\u5206\u949f\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002"),S=S.replace("#1",O)):S=t?ya.get("cronIntervalError","\u6267\u884c\u8ba1\u5212\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e1\u5c0f\u65f6\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002"):ya.get("cronIntervalErrorForMetric","\u8868\u8fbe\u5f0f\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e1\u5c0f\u65f6\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002"),
fa.showPrompt(S),!1}}return!0};var G=function(){if(Q&&Q.isChecked()){a=new xa;a.setType(xa.TYPE_TIMING);a.setStrategy(xa.STRATEGY_FULL);if(w&&w.isChecked()){a.setStrategy(xa.STRATEGY_INCREMENTAL);var S=L.getSelectedModel();if(S){var Ja=new za;Ja.setTableId(S.getTableId());Ja.setTableName(S.getTableName());Ja.setName(S.getField().getName());Ja.setAlias(S.getField().getAlias());a.setBasedFields([Ja])}}a.setSchedule(n.getSchedule())}else a=F&&F.isChecked()?new xa:null},q=function(){r.setChecked(!0);
u.setChecked(!0);t||F.setChecked(!0);if(a)if(xa.TYPE_ONCE===a.getType())F.setChecked(!0);else{Q.setChecked(!0);if(xa.STRATEGY_INCREMENTAL===a.getStrategy()){var S=a.getBasedFields();if(S&&0<S.length){a:{var Ja=S[0].getTableId(),ca=S[0].getName(),Ga=Aa.getModelerModel(),$a=Ga.getTable(Ja);Ga=Ga.getPage().getNodesByTableId(Ja);if($a&&Ga&&0<Ga.length){if(Ja=v(Ja,ca)){S=new ib($a,Ja,!1);break a}}else $a=new C,$a.setUid(Ja),$a.setDisplayName(S[0].getTableName());Ja=new ia;Ja.setName(ca);Ja.setAlias(S[0].getAlias());
S=new ib($a,Ja,!0)}S&&(w.setChecked(!0),L.setSelectedModel(S))}}n.setSchedule(a.getSchedule())}},v=function(S,Ja){S=k(Aa.getModelerModel(),S,!0);for(var ca=0;ca<S.length;ca++)if(Ja===S[ca].getName())return S[ca]},k=function(S,Ja,ca){var Ga=[];(Ja=S.getPage().getNodesByTableId(Ja))&&1===Ja.length&&Ya.NodeFieldHelper.asynGetFields(S,Ja[0],function($a){if(ca)Ga=$a;else for(var oa=0;oa<$a.length;oa++){var W=$a[oa].getOriginalDataType();ia.DT_INT!==W&&ia.DT_DATETIME!==W||Ga.push($a[oa])}});return Ga},
l=function(){(new na(ua,function(S){d=b=!0},function(S,Ja){return 30001001===S?(b=!1,fa.showPrompt(ya.get("noDataWarehouseConfig","\u5f53\u524d\u73af\u5883\u672a\u914d\u7f6e\u201c\u8f7b\u6570\u4ed3\u6570\u636e\u6e90\u201d\u53c2\u6570\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u5728MC\u4e2d\u8fdb\u884c\u914d\u7f6e\u3002")),!0):30001002===S?(d=!1,fa.showPrompt(ya.get("dataWarehouseConfigParseError","\u201c\u8f7b\u6570\u4ed3\u6570\u636e\u6e90\u201d\u53c2\u6570\u89e3\u6790\u5f02\u5e38\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u5728MC\u4e2d\u91cd\u65b0\u914d\u7f6e\u3002")),
!0):!1})).checkDataWarehouseConfig()},p=function(){var S=Aa.getModelerModel().getAllTable();return!S||1<S.length||1===S.length&&Aa.getModelerModel().getSource(S[0].getSourceUid()).getSourceType()===la.SOURCE_TYPE_MODELSET_FILE_SOURCE?!1:Aa.getModelerModel().supportIncrementalMaterialize()},E=function(){var S=new Ua;S.setTables(m);S.setTableFieldMap(c);var Ja=new g;Ja.setDropdownCreator(function(ca,Ga,$a){return S.createJqPopup(ca,Ga,$a)});Ja.addSelectionListener(function(ca){var Ga=ca.getSelectedModel();
ca=L.getJqUi();ca.css({left:80,width:150});z.hide();Ga.isDeleted()?(ca.css({left:96,width:134}),z.attr("title",ya.get("basedFieldNotExist","\u5b57\u6bb5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664")),z.show()):(Ga=Ga.getField().getOriginalDataType(),ia.DT_INT!==Ga&&ia.DT_DATETIME!==Ga&&(ca.css({left:96,width:134}),z.attr("title",ya.get("basedFieldTypeFail","\u5b57\u6bb5\u7c7b\u578b\u5fc5\u987b\u4e3a\u65e5\u671f\u65f6\u95f4\u6216\u6574\u6570")),z.show()))});Ja.setCustomPainter(function(ca,Ga){ca&&
(ca=ca.getTableName()+"."+ca.getField().getAlias(),Ga.attr("title",ca),Ga.text(ca))});return Ja},A=function(){var S=n.getSchedule(),Ja=S.getCron();if(a&&a.getSchedule()){var ca=a.getSchedule().getCron();va.Period_Custom===S.getPeriod()&&Ja&&Ja===ca&&(S.setCronMsg(I.getCronCheckingTips()),ca=new na(ua,function(Ga){S.setCronMsg(null);h=Ga.cronInterval;O=Ga.timingMaterializedConfigMinimumTime},function(Ga,$a){return 20001008===Ga?(S.setCronMsg(I.getCronErrorTips()),!0):!1}),ca.setShowBlocking(!1),ca.cronExpression(Ja))}},
B=function(S,Ja,ca){(new na(ua,function(Ga){h=Ga.cronInterval;O=Ga.timingMaterializedConfigMinimumTime;if(!h){if(O)$a=t?ya.get("cronMinimumIntervalError","\u6267\u884c\u8ba1\u5212\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e#1\u5206\u949f\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002"):ya.get("cronMinimumIntervalErrorForMetric","\u8868\u8fbe\u5f0f\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e#1\u5206\u949f\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002"),
$a=$a.replace("#1",O);else var $a=t?ya.get("cronIntervalError","\u6267\u884c\u8ba1\u5212\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e1\u5c0f\u65f6\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002"):ya.get("cronIntervalErrorForMetric","\u8868\u8fbe\u5f0f\u7684\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u5c0f\u4e8e1\u5c0f\u65f6\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u8868\u8fbe\u5f0f\u3002");fa.showPrompt($a)}Ja&&Ja(Ga.cronData)},function(Ga,$a){var oa=!1;20001008===Ga&&($a=ya.get("cronError",
"\u53c2\u6570\u9519\u8bef\uff0c\u8868\u8fbe\u5f0f\u6709\u8bef\u3002"),oa=!0);ca&&ca(Ga,$a);return oa})).cronExpression(S)},Y=function(S,Ja){Q&&Q.isChecked()?D.show():D.hide()},ha=function(S,Ja){if(r&&r.isChecked())L&&L.setEnabled(!1);else if(L&&L.setEnabled(!0),!p())return L&&L.setEnabled(!1),fa.showPrompt(ya.get("noSupportIncrement","\u5f53\u524d\u6a21\u578b\u4e0d\u652f\u6301\u589e\u91cf\u7269\u5316\u3002")),!1}}function Ua(){function Aa(){var w,L,n,t,a,c,m;this.getJqUi=function(){w||b();return w.getJqUi()};
this.setSelectedModel=function(D){c=D};this.setSelectedModelSetter=function(D){m=D};this.setSearchText=function(D){t=D;z()};this.setTables=function(D){L=D;z()};this.setTableFieldMap=function(D){n=D;z()};var b=function(){w=new K;w.setBorderVisible(!0);w.setCustomItemPainter(d);w.setMultiSelectable(!1);w.setCustomSelectedsPainter(h);w.addPressedListener(function(D,G){D=D.getSelecteds()[0];D instanceof ib&&m&&m(D)})},d=function(D,G){if(G instanceof ib){var q=G.getField();D.css("margin-left","20px");
D.addClass("modeler-designer-materialized-field-list-item");D.css("cursor","pointer");var v=$("<div>");v.text(q.getAlias());v.attr("title",q.getAlias());v.addClass("modeler-designer-materialized-table-field-text");D.append(v);D.data("model",G);q=q.getOriginalDataType();v=$("<div>");v.addClass("modeler-designer-materialized-table-field-icon");Ma.layoutCtrl(v,10,3,16,16);M.background(v,q);v.data("myIconName",q);v.appendTo(D);c&&G&&c.getField().getFullName()===G.getField().getFullName()&&f(D,G)}else e(D,
G)},h=function(D,G){for(var q=0;q<D.length;q++){var v=D[q];O(v,!1)}for(q=0;q<G.length;q++)v=G[q],O(v,!0)},O=function(D,G){D=D.find(".modeler-designer-materialized-table-field-icon");"qingTable"===D.data("myIconName")&&M.background(D,G?"qingTableWhite":"qingTable")},f=function(D,G){if(0<D.height()){var q=D.find(".modeler-designer-materialized-table-field-icon"),v=q.data("myIconName");M.background(q,v+"_hover");D.css("color","#fff");D.css("background-color","#88a7f6");D.css("background-color","var(--color-lightish, #88a7f6)");
w.setSelecteds([G]);w.scrollSelectedToVisible(G)}else setTimeout(function(){f(D,G)},0)},e=function(D,G){var q=$("<div>");Ma.layoutCtrl(q,0,2,16,16);M.backgroundWithHover(q,"expanded");q.appendTo(D);var v=$("<div>");Ma.layoutCtrl(v,20,3,16,16);M.background(v,"qingTable");v.data("myIconName","qingTable");v.addClass("modeler-designer-materialized-table-field-icon");v.appendTo(D);v=$("<div>");v.text(G.getTableName());v.addClass("modeler-designer-materialized-table-field-text");v.css("left","40px");v.css("font-weight",
"bold");D.on("click",function(k){k=$(k.currentTarget).data("model");var l=!k.isExpand();k.setExpand(l);M.backgroundWithHover(q,l?"expanded":"expand");l=w.getJqUi().find(".modeler-designer-materialized-field-list-item");for(var p=k.isExpand(),E=0;E<l.length;E++){var A=$(l[E]);A.data("model").getTableId()===k.getTableId()&&A.css("display",p?"":"none")}});D.data("model",G);D.append(v)},z=function(){if(w&&L){for(var D=[],G=0;G<L.length;G++){var q=L[G];D.push(new Oa(q));if(n){var v=n[q.getUid()];if(v)for(var k=
0;k<v.length;k++)D.push(new ib(q,v[k],!1))}}if(G=t){q=[];for(v=0;v<D.length;v++)k=D[v],k instanceof Oa?(0<q.length&&q[q.length-1]instanceof Oa&&q.splice(q.length-1),q.push(k)):-1<k.getField().getAlias().toUpperCase().indexOf(G)&&q.push(k);q[q.length-1]instanceof Oa&&q.splice(q.length-1);D=q}w.setItemModels(D,H);0===D.length?(a||(a=$("<div>"),Ma.layoutCtrlCenterAlign(a,135),a.css({color:"#c0c0c0",top:"35px","text-align":"center"}),a.appendTo(ua)),D=t?ya.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c"):
ya.get("noSelectField","\u6682\u65e0\u53ef\u9009\u5b57\u6bb5"),a.text(D),a.show(),w.getJqUi().hide()):(a&&a.hide(),w.getJqUi().show())}},H=function(D,G){return D instanceof Oa&&G instanceof Oa||D instanceof ib&&G instanceof ib?D.equals(G):!1}}var ua,fa,u,F,Q;this.createJqPopup=function(w,L,n){ua=$("<div>");ua.css({"background-color":"#fff",height:"100%",width:"100%"});ua.appendTo(w);F=new ka;F.setShowSearchIcon(!0);F.setPlaceholder(ya.get("searchField","\u8bf7\u8f93\u5165\u5b57\u6bb5\u540d\u79f0"));
F.setSearchListenerDelay(800);F.addSearchListener(r);w=F.getJqUi();Ma.layoutCtrlWithLRTB(w,0,0,null,0,null,25);ua.append(w);Q=new Aa;Q.setSelectedModel(L);Q.setSelectedModelSetter(n);Q.setTables(fa);L=Q.getJqUi();Ma.layoutCtrlWithLRTB(L,0,0,null,25,0,null);ua.append(L);Q.setTableFieldMap(u);L=30;if(fa&&u)for(L+=20*fa.length,n=0;n<fa.length;n++)L+=20*u[fa[n].getUid()].length;90>=L?L=90:320<L&&(L=320);return[-1,L]};this.setTables=function(w){fa=w};this.setTableFieldMap=function(w){u=w};var r=function(){var w=
$.trim(F.getText()).toUpperCase();Q.setSearchText(w)}}function Oa(Aa){var ua=!0;this.getTableId=function(){return Aa.getUid()};this.setExpand=function(fa){ua=fa};this.isExpand=function(){return ua};this.getTableName=function(){return Aa.getDisplayName()?Aa.getDisplayName():Aa.getTableName()};this.equals=function(fa){return Aa.getUid()===fa.getTableId()}}function ib(Aa,ua,fa){this.getField=function(){return ua};this.getTableId=function(){return Aa.getUid()};this.getTableName=function(){return Aa.getDisplayName()?
Aa.getDisplayName():Aa.getTableName()};this.isDeleted=function(){return fa};this.equals=function(u){return Aa.getUid()===u.getTableId()&&ua.equals(u.getField())}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&
(com.kingdee.bos.qing.modeler.designer={});var Ya=com.kingdee.bos.qing.modeler.designer;Ya.MaterializedConfigDialog=function(){J.call(this);var Aa=this,ua=this.protectedMethod,fa,u,F,Q=!1,r,w;(function(){ua.setTitle(ya.get("materializedConfig","\u7269\u5316\u5b58\u50a8\u8bbe\u7f6e"));Aa.setSize(620,570);ua.setContentPaneCreator(function(){if(!r){r=$("<div>");F=new qa;F.setGlobal(fa);F.setRemoteImpl(u);F.setSupportIncrementConfig(Q);F.setMessageCurtain(ua.getMessageCurtain());w=F.getJqUi();w.appendTo(r);
var L=fa.getModelerModel();L=L.getMaterializedConfig()?L.getMaterializedConfig().copy():null;F.setMaterializedConfig(L)}return r});ua.setClosingChecker2(function(L){L=fa.getModelerModel();var n=L.getMaterializedConfig();if(!F.checkMaterializedConfig())return!1;var t=F.getMaterializedConfig();if(!t&&!n||t&&n&&t.equals(n))return!0;n=new aa;n.setValue(L,t);fa.getCommandManager().perform(n);return!0});ua.setClosingAction(function(L){})})();this.setGlobal=function(L){fa=L};this.setRemoteImpl=function(L){u=
L};this.setSupportIncrementConfig=function(L){Q=L}};var Ma,ya,Da,va,I,K,J,X,Z,ra,N,g,ka,C,ia,M,la,na,xa,za,aa;(function(){var Aa=com.kingdee.bos.qing.common;Ma=Aa.DomUtil;Aa=com.kingdee.bos.qing.framework.common;ya=Aa.MultilanguageManager.createPackageAccessor(Ya);Aa=com.kingdee.bos.qing.schedule;Da=Aa.ScheduleSelector;va=Aa.QingSchedule;I=Aa.QingScheduleUtil;Aa=com.kingdee.bos.qing.ui.component;K=Aa.List;J=Aa.AbstractModalDialog;X=Aa.Label;Z=Aa.RadioButtonGroup;ra=Aa.RadioButton;N=Aa.HelpIcon;g=
Aa.DropdownSelector;ka=Aa.SearchBox;C=Ya.Table;ia=Ya.Field;M=Ya.Icons;la=Ya.AbstractModelerSource;na=Ya.DesignerFacade;xa=Ya.MaterializedConfig;za=Ya.BasedField;aa=Ya.ActionChangeMaterializedConfig})()})();(function(){function qa(){function a(H,D,G,q){this.getX1=function(){return H};this.getX2=function(){return G};this.getY1=function(){return D};this.getY2=function(){return q}}var c=!1,m,b,d=[],h,O;this.isPrepared=function(){return c};this.prepare=function(H,D,G){O=G;b=D;H=H.getAllNodes();m=[];for(D=0;D<H.length;D++){var q=H[D];G=q.getX();var v=q.getY(),k=G+q.getWidth();q=v+q.getHeight();m.push(new a(G,v,k,q))}c=!0};this.anchor=function(H){z();h=H;var D=!1,G=!1;for(H=0;H<m.length;H++){var q=m[H];if(!D){D=
q;var v=h[1]+(h[3]>>1);var k=D.getY1()+D.getY2()>>1;if(10>=Math.abs(k-v)){v=f(D);var l=O.getScaledSize(k);e(v[0],l,v[1],l);h[1]=k-(h[3]>>1);k=!0}else k=!1;k?D=!0:(v=h[1],k=D.getY1(),10>=Math.abs(k-v)?(v=f(D),l=O.getScaledSize(k),e(v[0],l,v[1],l),h[1]=k,k=!0):k=!1,k?D=!0:(v=h[1]+h[3],k=D.getY2(),10>=Math.abs(v-k)?(D=f(D),v=O.getScaledSize(k),e(D[0],v,D[1],v),h[1]=k-h[3],D=!0):D=!1))}G||(G=q,k=h[0],q=G.getX1(),10>=Math.abs(q-k)?(k=f(G,!0),v=O.getScaledSize(q),e(v,k[0],v,k[1]),h[0]=q,q=!0):q=!1,q||(k=
h[0]+h[2],q=G.getX2(),10>=Math.abs(q-k)?(G=f(G,!0),k=O.getScaledSize(q),e(k,G[0],k,G[1]),h[0]=q-h[2],q=!0):q=!1),G=q);if(D&&G)break}};this.abort=function(){z()};var f=function(H,D){if(D){D=h[1];var G=H.getY1();D<G?H=H.getY2():(D=G,H=h[1]+h[3])}else D=h[0],G=H.getX1(),D<G?H=H.getX2():(D=G,H=h[0]+h[2]);return O.getScaledCoordinate([D-15,H+15])},e=function(H,D,G,q){var v=$("<div>");v.addClass("modeler-designer-auxiliary-line");b.append(v);d.push(v);X.layoutCtrl(v,H,D,G-H,q-D)},z=function(){for(var H=
0;H<d.length;H++)d[H].remove();d=[]}}function Ua(){var a=this;this.createNode=function(c){return document.createElementNS("http://www.w3.org/2000/svg",c)};this.createWithAttrs=function(c,m){c=a.createNode(c);a.setAttributes(c,m);return c};this.setText=function(c,m){$(c).empty();m=document.createTextNode(m);c.appendChild(m)};this.setTitle=function(c,m){var b=c.getElementsByTagName("title");0==b.length?(b=a.createNode("title"),c.appendChild(b)):b=b[0];a.setText(b,m)};this.addClass=function(c,m){$(c).addClass(m)};
this.createPath=function(c,m,b,d){var h=a.createNode("path"),O=a.getPathCoordinate(c,m),f=a.getPathCoordinate(c+b,m);b=a.getPathCoordinate(c+b,m+d);c=a.getPathCoordinate(c,m+d);a.setAttributes(h,{d:"M"+O+" L"+f+" L"+b+" L"+c+" Z"});return h};this.setAttributes=function(c,m){for(var b in m)c.setAttribute(b,m[b])};this.getPathCoordinate=function(c,m){return""+c+" "+m}}function Oa(){var a,c,m=0,b={},d={},h,O,f;this.getSelectedEntityName=function(){var k,l;for(l in b){var p=b[l];p&&p.isChecked()&&(k=
k?k+I.ENTITY_SEPARATOR+l:l)}return k};this.setFunUpdateProperties=function(k){a=k};this.setMeta=function(k){O=k};this.setSelectedTableNames=function(k){if(O.getTableNode())for(f=k,k=0;k<f.length;k++){var l=f[k],p=b[l];p&&(p.setChecked(!0),v(p,!0),a(d[l],l))}};this.getJqUi=function(){if(!c){c=$("<div>");c.addClass("modeler-designer-selected-field-entry-panel");if(!O.getTableNode()){var k=new Da;k.setType(Da.TYPE_NO_SOURCE);k.getJqUi().appendTo(c);return c}var l=new Q;l.fromJsonObject(O.getTableNode());
var p=new ya;p.setLevel(0);p.toFolderLevelNode(l);e(p,0);l=O.getPropertyMap();for(k in l)d[k]=l[k]}return c};var e=function(k,l){if(k.getDisplayName()){var p=l,E=$("<div>");E.addClass("modeler-designer-selected-entity-item");var A=new C;A.setUserObject(k);0==p&&k.getName();b[k.getName()]=A;A.addCheckedListener(v);A=A.getJqUi();X.layoutCtrl(A,20*p,30*m,15,20);A.appendTo(E);A=$("<div>");A.addClass("modeler-designer-selected-entity-item-ui");A.attr("entity-name",k.getName());A.on("click",G);X.layoutCtrlWithLRTB(A,
20*p+18,10,null,30*m,0,20);var B=$("<div>");B.addClass("modeler-designer-selected-entity-item-text");B.text(k.getDisplayName());B.attr("title",k.getDisplayName());X.layoutCtrl(B,23,2,null,20);B.appendTo(A);B=$("<span>");B.addClass("modeler-designer-selected-entity-item-icon");F.background(B,"entity-entry");0==p&&F.background(B,"entity-sub");X.layoutCtrl(B,2,2,16,16);B.appendTo(A);A.appendTo(E);E.appendTo(c);m++;++l}if(p=k.getChildren())for(E=0;E<p.length;E++)A=new ya,A.setLevel(l),A.toFolderLevelNode(p[E]),
A.setParentNode(k),e(A,l)},z=function(k,l){if((k=k.getChildren())&&0<k.length)for(var p=0;p<k.length;p++){var E=k[p];l[E.getName()]=E;z(E,l)}},H=function(k,l){if(k=k.getParentNode())l[k.getName()]=k,H(k,l)},D=function(k){var l={};if(!k)return l;if(k=k.getChildren())for(var p=0;p<k.length;p++){var E=k[p];l[E.getName()]=E}return l},G=function(k){k=$(k.currentTarget).attr("entity-name");a(d[k],k);h&&q(!1);h=k;q(!0)},q=function(k){var l=c.find("[entity-name='"+h+"']");l&&(k?l.addClass("modeler-designer-selected-entity-item-ui_selected"):
l.removeClass("modeler-designer-selected-entity-item-ui_selected"))},v=function(k,l){if(l){l=k.getUserObject();a(d[l.getName()],l.getName());var p=l.getParentNode(),E=D(l),A={};z(l,A);var B={};H(l,B);var Y=!1;for(S in A){var ha=b[S];if(ha&&ha.isChecked()){Y=!0;break}}var S=Y;Y=!1;for(Ja in B)if((ha=b[Ja])&&ha.isChecked()){Y=!0;break}var Ja=Y;if(k.isChecked()){h&&q(!1);h=l.getName();q(!0);p&&(k=b[p.getName()])&&k.setEnabled(!0);for(var ca in b)k=b[ca],l.getName()==ca||p&&ca==p.getName()||S&&A[ca]||
Ja&&B[ca]||(E[ca]?k.setEnabled(!0):k.setEnabled(!1))}else for(ca in h&&q(!1),h=l.getName(),q(!0),p=D(p),b)k=b[ca],l.getName()==ca||Ja&&B[ca]||(p[ca]?k.setEnabled(!0):(A[ca]&&k.isChecked()&&k.setChecked(!1),k.setEnabled(!Ja)))}}}function ib(){var a,c,m,b;this.setMeta=function(d){a=d};this.setCurrentTableName=function(d){c=d};this.getCurrentTableName=function(){return c};this.setSelectedPropertyName=function(d){m=d};this.getSelectedPropertyName=function(){return m};this.getMeta=function(){return a};
this.getJqUi=function(){};this.getSelectedProperties=function(){return null};this.getSelectedEntityName=function(){};this.getIsEntityView=function(){return!1};this.setWidth=function(d){b=d};this.getWidth=function(d){return b}}function Ya(){ib.call(this);var a=this,c,m,b,d,h,O,f={},e=[];this.setLockPropertyName=function(G){e=G};this.setArrProperties=function(G,q){h=q;d=G;z(!0)};this.getTableFieldMap=function(){return f};var z=function(G){m&&m.hide();if(d&&0!=d.length){O=[];if(f[h])var q=f[h];else{q=
d;for(var v=a.getCurrentTableName().split(I.ENTITY_SEPARATOR),k=0;k<q.length;k++){var l=q[k],p=new va;p.setField(l);p.setDisplayName(l.getAlias());e&&-1!=e.indexOf(l.getName())&&(p.setEnabled(!1),p.setShowRelationIcon(!0));p.setSelected(!0);-1!=v.indexOf(h)&&a.getSelectedPropertyName()&&-1==a.getSelectedPropertyName().indexOf(l.getName())&&p.setSelected(!1);O.push(p)}f[h]||(f[h]=O);q=O}b.setArrFieldItems(q,G)}else m?m.show():(G=new Da,G.setType(Da.TYPE_NO_DATA_WITH_CLOUD),m=G.getJqUi(),b.setJqNoDataUI(m),
m.appendTo(c))},H=function(){var G=a.getMeta().getRelations();if(G&&0<G.length){e=[];for(var q=0;q<G.length;q++){var v=G[q];-1==e.indexOf(v.getFromProperty())&&e.push(v.getFromProperty())}}};this.getJqUi=function(){c||D();return c};var D=function(){c=$("<div>");c.addClass("modeler-designer-selected-field-panel");b=new Ma;b.setShowAllCheckbox(!0);b.setFunFieldCheckClick(function(q,v){v.setSelected(q)});var G=b.getJqUi();G.addClass("modeler-designer-selected-field-list-panel");G.appendTo(c);h=a.getCurrentTableName();
a.getMeta().getPropertyMap()&&(d=a.getMeta().getPropertyMap()[h]);H();z()};this.getSelectedProperties=function(){if(!d)return[];var G=[],q={},v=!0,k=f[a.getCurrentTableName()];if(!k)return[];for(var l=0;l<k.length;l++){var p=k[l],E=p.getField();q[E.getFullName()]||(p.getSelected()?(G.push(E),q[E.getFullName()]=!0):v=!1)}return v?null:G}}function Ma(){var a=[],c=[],m,b,d,h,O,f=!1,e=!1,z=!0,H=!0,D=!0,G,q,v,k,l,p,E,A;this.getContentPaneCreator=function(){return S};this.show=function(){b.show()};this.hide=
function(){b.hide()};this.getJqUi=function(){b||S();return b};this.setJqNoDataUI=function(x){q=x};this.getArrFieldItems=function(){return a};this.setArrFieldItems=function(x,Na){a=[];B(x,Na);Ga()};this.setFunFieldCheckClick=function(x){l=x};this.setFunAllCheckboxClick=function(x){p=x};this.setAllCheckboxSelected=function(x){v.setChecked(x)};this.setShowSearchText=function(x){D=x};var B=function(x,Na){G.empty();x&&0!==x.length?q&&q.hide():q&&q.show();Na&&(f=!1,h&&h.setChecked(!1),d&&d.clear());e&&
(Na=ha(x),G.append(Ja(Na==x.length)),ca(Na));for(Na=0;Na<x.length;Na++){var ba=x[Na];ba.setFunFieldCheckClick(Ca);a.push(ba)}c=a;m=new xa;m.setItemHeight(31);x=m.getJqUi();m.setItemUiCreator(function(Ea){Ea=c[Ea];Ea.initJqUi();var Xa=Ea.getJqUi();Xa.css({width:"100%",position:"relative"});h&&h.isChecked()&&!Ea.getSelected()&&Xa.hide();return Xa});A=e?31:0;X.layoutCtrlWithLRTB(x,0,0,null,A,0,null);Y();x.appendTo(G)},Y=function(){m.setItemCount(c.length);setTimeout(m.repaint,0)},ha=function(x){for(var Na=
0,ba=0;ba<x.length;ba++)x[ba].getSelected()&&Na++;return Na},S=function(){if(!b){b=$("<div>");if(D){var x=$("<div class='modeler-designer-select-field-search-text'>");x.text(K.get("search","\u641c\u7d22"));x.appendTo(b)}x=b;var Na=x.append;d=new ia;d.setShowSearchIcon(!0);d.addSearchListener(Ga);d.setSearchListenerDelay(500);d.setPlaceholder(K.get("inputSearchText","\u8f93\u5165\u641c\u7d22\u6587\u672c"));var ba=d.getJqUi();ba.addClass("modeler-designer-select-field-search-box");D?ba.css("left","10px"):
ba.css("width","90%");Na.call(x,ba);z&&b.append(W);G=$("<div class='modeler-designer-select-field-list'>");H&&G.css("overflow","scroll");q&&b.append(q);b.append(G)}return b},Ja=function(x){var Na=$("<div>");Na.addClass("modeler-desinger-select-field-lineitem");v=new C;v.setChecked(x);v.addCheckedListener(oa);x=v.getJqUi();x.addClass("modeler-designer-field-item-checkbox");x.appendTo(Na);x=$("<div>");x.addClass("modeler-designer-field-item-allcheckbox-text");x.text(K.get("selectAll","\u5168\u9009"));
x.appendTo(Na);k=$("<div>");k.addClass("modeler-designer-field-item-selected-prompt");k.text(K.get("selectedItemsPrompt","(\u5df2\u9009\u62e9#1\u9879)"));k.appendTo(Na);return Na},ca=function(x){k&&k.text(K.get("selectedItemsPrompt","(\u5df2\u9009\u62e9#1\u9879)").replace("#1",x))},Ga=function(x){O=$.trim(d.getText());$a(a,O)},$a=function(x,Na){var ba=[];if(0==Na.length){E&&E.hide();x&&0!==x.length||q.show();for(var Ea=0;Ea<x.length;Ea++){var Xa=x[Ea];if(!f||Xa.getSelected())Xa.show(!0),ba.push(Xa)}c=
ba;v&&v.setChecked(ma())}else{var ja=!0;for(Ea=0;Ea<x.length;Ea++)if(Xa=x[Ea],!f||Xa.getSelected())-1===Xa.getDisplayName().toLowerCase().indexOf(Na.toLowerCase())?Xa.show(!1):(Xa.show(!0),ja=!1,ba.push(Xa));ja?(E||(E=$("<div>"),E.addClass("modeler-designer-addsource-noresult-view-container"),x=$("<div>"),x.addClass("modeler-designer-addsource-noresult-view-icon"),F.background(x,"search-no-result"),x.appendTo(E),x=$("<div>"),x.addClass("modeler-designer-addsource-noresult-view-tip"),x.text(K.get("noSearchResult",
"\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),x.appendTo(E),E.appendTo(b),E.hide()),E.show(),q&&q.hide(),v&&v.setChecked(!1)):(E&&E.hide(),v&&v.setChecked(ma()));c=ba}Y()};this.updateSelectedItemsPrompt=function(){ca(ha(a))};var oa=function(x,Na){if(Na){for(var ba=0;ba<a.length;ba++){var Ea=a[ba];Ea.isShow()&&Ea.getEnabled()&&Ea.setSelected(x.isChecked())}p&&p(x,Na);x=ha(a);ca(x);m.keepState();m.repaint();m.restoreState()}},W=function(){h=new C;h.setChecked(f);h.addCheckedListener(Ta);
h.setText(K.get("showOnlyChecked","\u4ec5\u663e\u793a\u9009\u4e2d\u9879"));var x=h.getJqUi();X.layoutCtrl(x,290,5,200,23);return x},Ta=function(x,Na){Na&&((f=x.isChecked())?a.forEach(function(ba){ba.getSelected()||ba.show(!1)}):a.forEach(function(ba){ba.show(!0)}),$a(a,O))};this.setShowAllCheckbox=function(x){e=x};this.setShowScroll=function(x){H=x};this.setShowOnlyChecked=function(x){z=x};var Ca=function(x,Na){l&&l(x,Na);x=ha(a);ca(x);v&&v.setChecked(ma())},ma=function(){for(var x=!0,Na=0;Na<a.length;Na++){var ba=
a[Na];if(ba.isShow()&&!ba.getSelected()){x=!1;break}}return x}}function ya(){Q.call(this);var a=this,c,m;this.getLevel=function(){return c};this.setLevel=function(b){c=b};this.getParentNode=function(){return m};this.setParentNode=function(b){m=b};this.toFolderLevelNode=function(b){a.setName(b.getName());a.setDisplayName(b.getDisplayName());a.setChildren(b.getChildren());a.setLevel(c)}}function Da(){var a,c=Da.TYPE_TEXT,m=K.get("noDataTips","\u6682\u65e0\u6570\u636e"),b;this.getJqUi=function(){if(!a)switch(a=
$("<div>"),a.addClass("modeler-designer-no-data"),c){case Da.TYPE_TEXT:h(m,"modeler-designer-no-data-only-text");break;case Da.TYPE_NO_SOURCE:d("no_source","modeler-designer-no-data-icon");h(m,"modeler-designer-no-data-text");break;case Da.TYPE_NO_SEARCH_RESULT:d("search-no-result","modeler-designer-node-selection-icon");h(m,"modeler-designer-node-selection-tip");break;case Da.TYPE_NO_DATA_WITH_CLOUD:d("no_data_cloud","modeler-designer-no-data-cloud-icon");h(m,"modeler-designer-no-data-text");break;
default:throw Error("The view type error, please set first.");}return a};this.setType=function(O){c=O};this.setText=function(O){m=O?O:"";b&&b.text(m)};var d=function(O,f){var e=$("<div>");e.addClass(f);F.background(e,O);e.appendTo(a)},h=function(O,f){b=$("<div>");b.addClass(f);b.text(O);b.appendTo(a)}}function va(){var a=this,c,m=!1,b=!0,d=!0,h,O,f,e;this.setField=function(H){c=H};this.getField=function(){return c};this.setDisplayName=function(H){c&&c.setAlias(H)};this.getDisplayName=function(){return c.getAlias()};
this.getFieldType=function(){return c.getOutputDataType()};this.setSelected=function(H){m=H;h&&h.setChecked(H)};this.setShowRelationIcon=function(H){f=H};this.show=function(H){H?O&&O.show():O&&O.hide();d=H};this.isShow=function(){return d};this.getSelected=function(){return h?h.isChecked():m};this.setEnabled=function(H){b=H};this.getEnabled=function(){return b};this.getJqUi=function(){return O};this.setFunFieldCheckClick=function(H){e=H};this.initJqUi=function(){O=$("<div>");h=new C;h.setUserObject(a);
h.setChecked(m);h.setEnabled(a.getEnabled());h.addCheckedListener(function(H,D){D&&e&&e(H.isChecked(),a)});z(a,h);return O};var z=function(H,D){var G=$("<div>");G.addClass("modeler-desinger-select-field-lineitem");D=D.getJqUi();D.addClass("modeler-designer-field-item-checkbox");D.appendTo(G);D=$("<div>");D.addClass("modeler-designer-field-item-checkbox-text");D.text(H.getDisplayName());D.attr("title",H.getDisplayName());H=H.getFieldType();var q=$("<div>");q.addClass("modeler-designer-field-item-icon");
F.background(q,H);q.appendTo(G);D.appendTo(G);f&&(H=$("<div>"),H.addClass("modeler-designer-field-item-relation-icon"),F.background(H,"relation"),H.appendTo(G));G.appendTo(O)}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&
(com.kingdee.bos.qing.modeler.designer={});var I=com.kingdee.bos.qing.modeler.designer;I.AbstractDesigner=function(){var a=this,c,m,b=new ua,d=new fa,h=new u,O,f,e,z,H=!0,D;this.setMessageResize=function(B){D=B};var G=new function(){this.getModelerModel=function(){return a.protectedGetModelerModel()};this.getIntegration=function(){return c};this.getMessageCurtain=function(){return O};this.getCommandManager=function(){return h};this.getRemoteImpl=function(){return z}};this.protectedInit=function(){};
this.protectedResize=function(){};this.protectedGetModelerModel=function(){throw Error("override me");};this.setJsonModel=function(B){throw Error("override me");};this.protectedUpdateModelerModel=function(B){throw Error("override me");};this.getJsonModel=function(){var B=G.getModelerModel(),Y=new za;Y.setModelerModel(B);return Y.toJsonObject()};this.setJsonValidity=function(B,Y){throw Error("override me");};this.setUndoAbleJsonModel=function(B,Y){var ha=new za;ha.fromJsonObject(B);B=ha.getModelerModel();
ha=new Aa;ha.setCaption(Y);ha.setValue(a.protectedGetModelerModel(),B,a.protectedUpdateModelerModel);h.perform(ha)};this.setRemoteImpl=function(B){z=B};this.setEditable=function(B){H=B};this.isEditable=function(){return H};this.createJqUi=function(){m=$("<div onselectstart='return false'>");m.addClass("modeler-designer");O=new ka;O.getJqUi().appendTo(m);v();m.append(b.getJqUi());m.append(d.getJqUi());a.protectedInit();H&&(I.LockHelper.setGlobal(G),I.LockHelper.show(m));return m};this.resize=function(){k()};
this.setIntegration=function(B){c=B};this.getIntegration=function(){return c};this.setLockInfo=function(B,Y,ha){I.LockHelper.setLockInfo(B,Y,ha)};this.setLockStateChangeListener=function(B){I.LockHelper.setLockStateChangeListener(B)};this.registerLockRequestSender=function(B){I.LockHelper.registerLockRequestSender(B)};this.insertToolbarBtn=function(B,Y,ha,S){return b.addButtonForHeadCustom(B,Y,ha,S)};this.insertMenuButton=function(B,Y,ha,S){return b.addMenuButtonForHeadCustom(B,Y,ha,S)};this.appendToolbarBtn=
function(B,Y,ha,S){return b.addButtonForTailCustom(B,Y,ha,S)};this.getMsgCurtain=function(){return O};this.clearDirty=function(){q(!1)};this.isDirty=function(){return f};this.setDirtyListener=function(B){e=B};var q=function(B){f=B;d&&d.showDirtyState(f);e&&e(f)},v=function(){l();var B=new J;B.setCallbackImmediately(function(){l()});B.setDelay(100);B.setCallback(function(){k()});B.observe()},k=function(){I.LockHelper.setMaxWidth(m.width()-b.getAllBtnWidth());a.protectedResize();D&&D()},l=function(){document.body.style.height=
document.documentElement.clientHeight+"px"},p=function(){h.isCanUndo()&&h.undo();t.occur(t.BUTTON_TYPE,t.UNDO)},E=function(){h.isCanRedo()&&h.redo();t.occur(t.BUTTON_TYPE,t.REDO)},A=function(){var B=new n;B.setGlobal(G);B.setRemoteImpl(z);B.showDialog()};this.protectedMethod={addToolbarButton:function(B,Y,ha,S){return b.addButton(B,Y,ha,S)},getGlobal:function(){return G},getMainUi:function(){return m},addUndoRedoBtn:function(B){var Y=b.addButton(p,"btn_undo",K.get("undo","\u64a4\u6d88")),ha=b.addButton(E,
"btn_redo",K.get("redo","\u53cd\u64a4\u6d88"));Y.setEnabled(h.isCanUndo());ha.setEnabled(h.isCanRedo());h.addPerformedListener(function(S,Ja,ca){Y.setEnabled(h.isCanUndo());ha.setEnabled(h.isCanRedo())});h.addPerformedListener(function(S,Ja,ca){q(!0);S&&(Ja=Ja?"":(ca?K.get("undo","\u64a4\u6d88"):K.get("redo","\u53cd\u64a4\u6d88"))+" ",Ja+=S.getCaption(),d.showShortPrompt(Ja),B&&B(S))})},addMaterializedConfigBtn:function(){b.addButton(A,"btn_materialized_config",K.get("materializedConfig","\u7269\u5316\u5b58\u50a8\u8bbe\u7f6e"))}}};
I.ModelInfoDialog=function(){g.call(this);var a=this.protectedMethod,c=this,m,b,d;(function(){a.setTitle(K.get("modelProp","\u6a21\u578b\u5c5e\u6027"));c.setSize(400,300);a.setContentPaneCreator(function(){var h=$("<div>"),O=new Z;O.setRequired(!0);O.setText(K.get("name","\u540d\u79f0"));O=O.getJqUi();m=new ra;var f=m.getJqUi(),e=d.getIntegration();m.setText(e.getModelName());var z=new Z;z.setText(K.get("desc","\u63cf\u8ff0"));z=z.getJqUi();b=new N;var H=b.getJqUi();b.setText(e.getModelDesc());O.appendTo(h);
f.appendTo(h);z.appendTo(h);H.appendTo(h);X.layoutCtrl(O,8,0,70,23);X.layoutCtrl(f,76,0,280,23);X.layoutCtrl(z,8,48,70,23);X.layoutCtrl(H,76,54,280,120);return h});a.setClosingChecker2(function(h){h=$.trim(m.getText());var O=$.trim(b.getText()),f=d.getIntegration(),e=f.getModelName(),z=f.getModelDesc();if(h==e&&O==z)return!0;var H;0==h.length?H=K.get("nameIsEmptyPrompt","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a\u3002"):50<h.length&&(H=K.get("nameTooLongPrompt","\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002"));
500<O.length&&(H=K.get("descTooLongPrompt","\u63cf\u8ff0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7500\u4e2a\u5b57\u7b26\u3002"));if(H)return a.getMessageCurtain().showPrompt(H),!1;H=new aa;H.setValue(f,h,f.getModelName(),O,f.getModelDesc());d.getCommandManager().perform(H);return!0});a.setClosingAction(function(h){})})();this.setGlobal=function(h){d=h}};I.NoNodePromptUi=function(){var a,c,m,b,d;this.setNoNode=function(e){f()};this.setNoSource=function(e){m=e;f()};this.show=function(){a&&a.show()};this.hide=
function(){a&&a.hide()};this.getJqUi=function(){a||(a=$("<div>"),a.css("background","#f7f7f7"),a.css("z-index",1E3),X.layoutCtrlWithLRTB(a,0,0,null,0,0,null),f());return a};var h=function(){if(!b){b=$("<div>");X.layoutCtrlMiddleAlign(b,180);X.layoutCtrlCenterAlign(b,260);b.appendTo(a);c=$("<div>");c.addClass("modeler-designer-no-node-prompt");X.layoutCtrl(c,10,0,260,20);c.appendTo(b);c.text(K.get("dragInNode","\u62d6\u5165\u8868\uff0c\u5f00\u59cb\u521b\u5efa\u6a21\u578b"));var e=$("<div>");X.layoutCtrl(e,
0,40,253,140);F.background(e,"drag_node_prompt");e.appendTo(b)}return b},O=function(){d||(d=$("<div>"),X.layoutCtrlMiddleAlign(d,170),X.layoutCtrlCenterAlign(d,210),F.background(d,"no_node_and_source"),d.appendTo(a));return d},f=function(){m?(h().hide(),O().show()):(h().show(),O().hide())}};I.DragHandler=function(){var a=$(document.body),c,m,b,d,h,O,f,e,z,H,D;this.bindDragUi=function(p,E){var A=!1,B=[-1,-1],Y=null,ha=function(){c=A=!1;Y=null;B=[-1,-1]};p.on("mousedown",function(S){A=!0;c=!1;Y=$(S.target);
B=[S.screenX,S.screenY]});p.on("mouseup",function(S){ha()});p.on("mouseleave",function(S){A&&ha()});p.on("mousemove",function(S){var Ja=!1;A&&(Ja=5<Math.abs(S.screenX-B[0])||5<Math.abs(S.screenY-B[1]));Ja&&(A=!1,(d=E(Y))?(O=new qa,b=e(),h=d.getTableNode(),c=!0,a.on("mousemove",G),a.on("mouseup",q),a.on("mouseleave",k)):ha())})};this.bindDropUi=function(p,E,A,B,Y){e=E;z=A;H=B;f=Y};var G=function(p){if(c){if(!m){m=$("<div onselectstart='return false'>");m.addClass("modeler-dragdrop-mask");var E=X.getCurrentTargetPosition(p);
E=X.upwardCoordinate(p.target,E,a[0]);m.data("target-origin-pos-left",E[0]);m.data("target-origin-pos-top",E[1]);m.appendTo(a)}if(E=z(p,b,h)){var A=E.getJqPhysicalUi();O.isPrepared()||O.prepare(E.getModeler(),A,f);D||(D=$("<div>"),X.layoutCtrlWithLRTB(D,0,0,null,0,0,null),D.css("z-index",999999));D.appendTo(A);v();p=[h.getX(),h.getY()];p=f.getScaledCoordinate(p);p=X.upwardCoordinate(A[0],p,a[0]);E=f.getScaledSize(h.getWidth());A=f.getScaledSize(h.getHeight());X.layoutCtrl(m,p[0],p[1],E,A)}else console.log("moving"),
m.text(""),E=X.getCurrentTargetPosition(p),E=X.upwardCoordinate(p.target,E,a[0]),X.layoutCtrl(m,E[0]-20,E[1]-15,40,30)}},q=function(p){z(p,b,h)?(v(),H(d,function(){m.remove();m=null}),l(!0)):l()},v=function(){var p=[h.getX(),h.getY(),h.getWidth(),h.getHeight()];O.anchor(p);h.setPosition(p[0],p[1])},k=function(){l()},l=function(p){c=!1;!p&&m&&m.animate({left:m.data("target-origin-pos-left"),top:m.data("target-origin-pos-top"),width:4,height:3},function(){m.remove();m=null});a.off("mousemove",G);a.off("mouseup",
q);a.off("mouseleave",k);D&&D.remove();O&&O.abort()}};I.NodeDragHelper=function(){var a,c,m,b,d,h,O,f,e=!1,z,H;this.setTarget=function(p){m=p};this.setScaleHelper=function(p){H=p};this.setModelerModel=function(p){z=p};this.setMovableArea=function(p){a=p};this.startDrag=function(p){console.log("start drag");f=new qa;f.prepare(z,a,H);c=[p.clientX,p.clientY];b=$("<div>");b.css("z-index",999999);b.appendTo($(document.body));X.layoutCtrlWithLRTB(b,0,0,null,0,0,null);b.on("mousemove",D);b.on("mouseup",
G);b.on("mouseleave",k)};this.setEndMoveCallback=function(p){h=p};var D=function(p){if(e)var E=!0;else E=Math.abs(p.clientY-c[1]),E=5<Math.abs(p.clientX-c[0])||5<E?e=!0:!1;if(E){if(!d){d=$("<div>");d.addClass("modeler-dragdrop-mask");d.appendTo(a);var A=m.getX(),B=m.getY(),Y=m.getWidth();E=m.getHeight();O=[A,B];A=H.getScaledCoordinate(O);Y=H.getScaledSize(Y);E=H.getScaledSize(E);X.layoutCtrl(d,A[0],A[1],Y,E)}p=v(p);q(p);p=H.getScaledCoordinate(p);X.layoutCtrl(d,p[0],p[1],null,null)}},G=function(p){d&&
(p=v(p),q(p),h&&h(p[0],p[1]));l()},q=function(p){if(d){var E=H.getRawSize(d.width()),A=H.getRawSize(d.height()),B=H.getRawCoordinate(p);E=[B[0],B[1],E,A];f.anchor(E);p[0]=E[0];p[1]=E[1]}},v=function(p){var E=p.clientX-c[0];p=p.clientY-c[1];var A=H.getScaledCoordinate(O);return[A[0]+E,A[1]+p]},k=function(p){l()},l=function(){console.log("destroy");b&&(b.off("mousemove",D),b.off("mouseup",G),b.off("mouseleave",k),b.remove(),b=null);d&&(d&&d.remove(),d=null);f&&f.abort()}};I.PageDragHelper=function(){var a,
c,m,b,d,h,O,f;this.startDrag=function(q,v){console.log("start drag page");d=v;c=[q.clientX,q.clientY];m=(q=d.position())?[q.left,q.top]:[0,0];h=$("<div>");h.css("z-index",999999);h.appendTo($(document.body));h.css("cursor","move");X.layoutCtrlWithLRTB(h,0,0,null,0,0,null);h.on("mousemove",e);h.on("mouseup",z);h.on("mouseleave",H)};this.setMovableArea=function(q){b=q};this.setGlobal=function(q){O=q};this.setScaleHelper=function(q){f=q};var e=function(q){var v=q.clientX-c[0];q=q.clientY-c[1];if(a)var k=
!0;else k=Math.abs(q),k=5<Math.abs(v)||5<k?a=!0:!1;k&&d.css({left:G(m[0]+v,!0)+"px",top:G(m[1]+q,!1)+"px"})},z=function(q){D()},H=function(q){D()},D=function(){console.log("destroy drag page");h.css("cursor","default");h&&h.remove();h=null},G=function(q,v){if(v){v=9999;var k=d.width();var l=b.width()}else v=9999,k=d.height(),l=b.height();v=f.getScaledSize(v);var p=k>v;v=0<q?p?0:Math.min(q,v-k):p?Math.max(q,l-k):Math.max(q,l-v);v!=q&&O.getMessageCurtain().showPrompt(K.get("svgMaxSize","\u5df2\u8fbe\u5230\u7ed8\u5236\u533a\u57df\u6700\u5927\u5c3a\u5bf8\u3002"));
return v}};I.DragInsideCheckResult=function(a,c){this.getJqPhysicalUi=function(){return a};this.getModeler=function(){return c}};I.FieldSelectDialog=function(a,c,m,b,d){g.call(this);var h=this,O=this.protectedMethod,f,e,z=d,H,D;this.showSelectFieldDialog=function(k,l){h.setSize(k,l);h.setPosition(window.innerWidth-k>>1,window.innerHeight-l>>1);O.setTitle(K.get("selectField","\u9009\u62e9\u5b57\u6bb5"));O.setClosingAction(G);O.setClosingChecker(q);O.setContentPaneCreator(v);h.showDialog()};var G=function(k){if(k)if((k=
e.getSelectedProperties())&&m.setSelectedFields(k),e.getIsEntityView()){var l=e.getSelectedEntityName();k=b.clone();var p=m.clone();if(l!=b.getTableName()){var E=z.getAllTable(),A=!1;k.setTableName(l);for(l=0;l<E.length;l++){var B=E[l];if(k.isSame(B)){A=!0;k.setUid(B.getUid());p.setTableUid(B.getUid());break}}A||(E=I.UIDHelper.getUID(I.UIDHelper.NS_TABLE),k.setUid(E),p.setTableUid(E))}E=H;D(p,k);E&&E()}else k=H,D(m,b),k&&k();else H&&H()},q=function(){if(!e)return!1;if(e.getIsEntityView()){var k=e.getSelectedEntityName();
if(!k)return O.getMessageCurtain().showPrompt(K.get("needSelectedEntity","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b9e\u4f53\u6216\u8005\u5206\u5f55\u8868\u3002")),!1;e.setCurrentTableName(k)}return(k=e.getSelectedProperties())&&0==k.length?(O.getMessageCurtain().showPrompt(K.get("noSelectedField","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b57\u6bb5\u3002")),!1):!0},v=function(){f=$("<div>");var k=new L(a,function(l){var p=new w;p.fromJsonObject(l);e=I.SelectFieldFactory.createSelectFieldToDialog(p.getSourceType());
e.setMeta(p);e.setCurrentTableName(b.getTableName());e.setWidth(850);e.getIsEntityView()&&O.setTitle(K.get("selectEntityAndField","\u9009\u62e9\u6570\u636e\u8868\u53ca\u5b57\u6bb5"));e.getJqUi().appendTo(f)});k.setBlockingJqUi(f);k.setShowBlocking(!0);k.getMeta(c,b);return f};this.setGlobal=function(k){};this.setModeler=function(k){z=k};this.setFunFinishCallback=function(k){H=k};this.setAddNodeCallback=function(k){D=k}};I.SelectFieldPanel=Ma;I.SvgHelper=Ua;I.ChooseFieldPanelHelper=function(){function a(){var f=
[],e,z,H,D,G,q=!1,v=!0,k;this.setItemModel=function(l){f=l};this.setShowFieldNameEnable=function(l){v=l};this.setRawTypeSwitchListener=function(l){};this.setSearchListener=function(l){e=l};this.setListItemPainter=function(l){z=l};this.setShowFieldNameListener=function(l){H=l};this.setSearchBoxPlaceholder=function(l){k=l};this.createJqPopup=function(l,p,E){D=$("<div>");D.appendTo(l);G=$("<div>");D.addClass("modeler-designer-field-popup");l=k?k:K.get("search","\u641c\u7d22");var A=new ia;A.setSearchListenerDelay(200);
A.setPlaceholder(l);A.addSearchListener(function(){e(f,A.getText(),G,p,z,q)});l=A.getJqUi();l.addClass("modeler-designer-field-popup-search");l.appendTo(D);G.addClass("modeler-designer-field-popup-list-owner");G.on("click",function(ha){var S=$(ha.currentTarget);ha=$(ha.target);if(ha=X.upwardSearchHasClass(ha,S,"modeler-designer-field-popup-list-item"))ha.addClass("modeler-designer-list-item_selected_enabled"),S=ha.data("model"),E(S)});G.appendTo(D);l=D.find(".sa-ctrl-textfield-input");l.css("top",
"0px");l.css("height","100%");if(0==f.length)m(G,K.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5"));else for(l=0;l<f.length;l++)z(f[l],G,p);if(v){var B=K.get("showFieldName","\u663e\u793a\u539f\u5b57\u6bb5\u540d\u79f0");l=new Z;l.setText(B);l=l.getJqUi();l.attr("title",B);l.addClass("modeler-designer-field-popup-show-field-name-label");B=new M;B.addStateChangeListener(function(ha,S,Ja){(q=Ja)?H&&H(G,!0):H&&H(G,!1)});B.setOn(!1);B=B.getJqUi();B.addClass("modeler-designer-field-popup-show-field-name-button");
var Y=$("<div>");Y.addClass("modeler-designer-field-popup-show-field-name");B.appendTo(Y);l.appendTo(Y);Y.appendTo(D)}else G.css("bottom","5px")}}var c;this.createChooseFieldPanel=function(f){c=f;f=new a;f.setListItemPainter(h);f.setSearchListener(b);f.setShowFieldNameListener(d);return f};var m=function(f,e){var z=new Z;z.setText(e);z.setEnabled(!1);z.setAlign(Z.ALIGN_CENTER);e=z.getJqUi();e.addClass("modeler-designer-field-popup-no-data");e.appendTo(f)},b=function(f,e,z,H,D,G){e=e.toLowerCase();
for(var q=[],v,k=0;k<f.length;k++)(v=f[k])&&(v=-1!=v.getAlias().toLowerCase().indexOf(e)?!0:G&&-1!=v.getName().toLowerCase().indexOf(e)?!0:!1)&&q.push(f[k]);z.children().remove();if(0<q.length){for(k=0;k<q.length;k++)D(q[k],z,H);q.length=0}else""==e?m(z,K.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5")):m(z,K.get("noSearchResult","\u627e\u4e0d\u5230\u7b26\u5408\u7684\u7ed3\u679c"));d(z,G)},d=function(f,e){if(e)for(f=f.find(".modeler-designer-field-popup-list-item-text-name"),e=0;e<f.length;e++){var z=
f.eq(e);z.css("display","inline-block");var H=z.prev().text()+z.text();z.prev().attr("title",null);z.parent().attr("title",H)}else for(f=f.find(".modeler-designer-field-popup-list-item-text-name"),e=0;e<f.length;e++)z=f.eq(e),z.css("display","none"),z.parent().attr("title",null),z.prev().attr("title",z.prev().text())},h=function(f,e,z){var H=$("<div>");H.addClass("modeler-designer-field-popup-list-item");H.data("model",f);c(H,f);e.append(H);z&&f&&z.getFullName()==f.getFullName()&&O(e,H)},O=function(f,
e){var z=null;0<f.height()?(clearTimeout(z),e.addClass("modeler-designer-list-item_selected_enabled"),f.prop("scrollTop",e.prop("offsetTop"))):z=setTimeout(function(){O(f,e)},0)}};I.CommonSvgIconHelper=function(){this.makeUrl=function(a){return"../qinganalysis/qingmodeler/designer/svgicon/"+a+".svg"};this.getTableIconColor=function(a){var c="#ffa500";if(a)switch(a.getSourceType()){case r.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:case r.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE:c="#A06AE2";break;case r.SOURCE_TYPE_MODEL_SET_SOURCE:c=
"#40A9FF";break;case r.SOURCE_TYPE_MODELSET_FILE_SOURCE:c="#F67682";break;case r.SOURCE_TYPE_OPEN_API_SOURCE:c="#73D13D"}return c}};I.AbstractDisplayNameHelper=function(){var a=this,c={};this.init=function(b){a.protectedInit(b);b=b.getAllNodes();c={};if(b)for(var d=0;d<b.length;d++)a.getNodeDisplayName(b[d])};this.protectedInit=function(b){};this.protectedGetDefaultName=function(b){throw Error("override me");};this.getNodeDisplayName=function(b){if(!b)return"";var d=b.getAlias();if(d)return c[b.getId()]=
d;d=b.getId();if(d=c[d])return d;var h=a.protectedGetDefaultName(b);d=b.getNameIndex();d=m(h,d);h=d[0];(d=d[1])&&b.setNameIndex(d);return c[b.getId()]=h};this.isDuplicate=function(b,d){for(var h=Object.keys(c),O=!1,f=0,e=h.length;f<e;f++)if(c[h[f]]==b&&(!d||d.getId()!=h[f])){O=!0;break}return O};var m=function(b,d){var h=d?b+"_"+d:b;var O=[h,d];a.isDuplicate(h)&&(O=m(b,d?d+1:1));return O};this.protectedMethod={cacheDisplayName:function(b,d){c[b]=d}}};I.PageSizeHelper=function(){this.adaptSize=function(a){var c=
a.getPage();var m=a.getAllNodes(),b=a.getPage();if(1>m.length)var d=[0,0,b.getWidth(),b.getHeight()];else{var h=m[0];b=h.getX();var O=h.getY();d=b+h.getWidth();h=O+h.getHeight();for(var f=1;f<m.length;f++){var e=m[f];b=Math.min(b,e.getX());O=Math.min(O,e.getY());d=Math.max(d,e.getX()+e.getWidth());h=Math.max(h,e.getY()+e.getHeight())}d=[b-100,O-100,d+100,h+100]}O=c.getWidth();h=c.getHeight();m=-d[0];b=-d[1];O=d[2]-O;d=d[3]-h;if(0!=m||0!=O||0!=b||0!=d){if(0!=m||0!=b)for(a=a.getAllNodes(),h=0;h<a.length;h++)f=
a[h],f.setPosition(f.getX()+m,f.getY()+b);c.setExtension(m,b,O,d);return!0}return!1}};I.SelectFieldView=Ya;I.AbstractLeftRightSelector=function(){var a=this,c,m,b,d,h,O,f;this.getJqUi=function(){c||(d=e(">",!0,!1),h=e(">>",!0,!0),O=e("<",!1,!1),f=e("<<",!1,!0),m=z(a.protectedCreateLeftJqTitle(),a.protectedGetLeftCtrl()),b=z(a.protectedCreateRightJqTitle(),a.protectedGetRightCtrl()),c=$("<div>"),c.append(m),c.append(b),c.append(d.getJqUi()),c.append(O.getJqUi()),c.append(h.getJqUi()),c.append(f.getJqUi()));
return c};this.relayout=function(){var H=c.prop("clientWidth"),D=c.prop("clientHeight");X.layoutCtrlWithLRTB(m,0,(H>>1)+36,null,0,0,null);X.layoutCtrlWithLRTB(b,(H>>1)+36,0,null,0,0,null);X.layoutCtrlWithLRTB(d.getJqUi(),null,null,null,null,(D>>1)+8,28);X.layoutCtrlCenterAlign(d.getJqUi(),40);X.layoutCtrlWithLRTB(O.getJqUi(),null,null,null,(D>>1)+8,null,28);X.layoutCtrlCenterAlign(O.getJqUi(),40);X.layoutCtrlWithLRTB(h.getJqUi(),null,null,null,null,(D>>1)+56,28);X.layoutCtrlCenterAlign(h.getJqUi(),
40);X.layoutCtrlWithLRTB(f.getJqUi(),null,null,null,(D>>1)+56,null,28);X.layoutCtrlCenterAlign(f.getJqUi(),40)};var e=function(H,D,G){H=new la(H);H.getJqUi().css({border:"1px solid #ddd","font-size":"18px"});H.addActionListener(function(q){a.protectedSelect(D,G)});return H},z=function(H,D){var G=$("<div>");G.append(D.getJqUi());H?(G.append(H),X.layoutCtrlWithLRTB(H,0,0,null,0,null,20),X.layoutCtrlWithLRTB(D.getJqUi(),0,0,null,22,0,null)):X.layoutCtrlWithLRTB(D.getJqUi(),0,0,null,0,0,null);return G};
this.protectedCreateLeftJqTitle=function(){return null};this.protectedCreateRightJqTitle=function(){return null};this.protectedGetLeftCtrl=function(){throw Error("Implement");};this.protectedGetRightCtrl=function(){throw Error("Implement");};this.protectedSelect=function(H){throw Error("Implement");}};I.NoDataView=Da;var K,J,X,Z,ra,N,g,ka,C,ia,M,la,na,xa,za,aa,Aa,ua,fa,u,F,Q,r,w,L,n,t;(function(){var a=com.kingdee.bos.qing.common;X=a.DomUtil;a=com.kingdee.bos.qing.framework.common;K=a.MultilanguageManager.createPackageAccessor(I);
J=a.WindowResizeObserver;a=com.kingdee.bos.qing.ui.component;g=a.AbstractModalDialog;Z=a.Label;ra=a.TextField;N=a.TextArea;ka=a.MessageCurtain;C=a.CheckBox;ia=a.SearchBox;M=a.SwitchButton;la=a.WorkButton;na=a.SplitPane;xa=a.DynamicScroller;aa=I.ActionChangeModelInfo;Aa=I.ActionSetModel;ua=I.Toolbar;fa=I.StatusBar;u=I.CommandManager;F=I.Icons;Q=I.FolderNode;r=I.AbstractModelerSource;w=I.Meta;L=I.DesignerFacade;za=I.QingModeler;n=I.MaterializedConfigDialog;t=I.UserOperationReporter})();I.SvgTextTrimer=
new function(){var a,c,m;this.init=function(){m=$("<div>");X.layoutCtrl(m,-10,-10,10,10);a=new Ua;var d=a.createNode("svg");a.setAttributes(d,{width:10,height:10});c=a.createNode("text");d.appendChild(c);m.append($(d));$(document.body).append(m);m.hide()};this.trim=function(d,h,O){m.show();a.setAttributes(c,{"font-size":h+"px"});h=b(d);for(var f=d,e=1;h>O&&e<d.length;)f=d.slice(0,d.length-e)+"...",h=b(f),e++;m.hide();return f};this.measureText=function(d){m.show();d=b(d);m.hide();return d};var b=
function(d){a.setText(c,d);return c.getComputedTextLength()}};I.DisplayNameHelper=new function(){var a;this.registerImpl=function(c){a=c};this.isDuplicate=function(c,m){if(!a)throw Error("need register first");return a.isDuplicate(c,m)};this.getNodeDisplayName=function(c){if(!a)throw Error("need register first");return a.getNodeDisplayName(c)}};Da.TYPE_TEXT="text";Da.TYPE_NO_SOURCE="noSource";Da.TYPE_NO_SEARCH_RESULT="noSearchResult";Da.TYPE_NO_DATA_WITH_CLOUD="noDataWithCloud";I.SelectFieldFactory=
new function(){var a={};this.addSelectFieldToPanel=function(c,m){a[c]=m};this.createSelectFieldToDialog=function(c,m){var b=a[c];c=b?new b(c,m):new Ya;return c}};I.SelectFieldFactory.addSelectFieldToPanel(r.SOURCE_TYPE_CURRENT_ENTITY_SOURCE,function(){ib.call(this);var a=this,c,m,b;this.getJqUi=function(){if(!c){c=$("<div>");b=new Ya;b.setMeta(a.getMeta());b.setCurrentTableName(a.getCurrentTableName());b.setSelectedPropertyName(a.getSelectedPropertyName());var h=b.getJqUi(),O=new na;O.setHorizontalSplit(!0);
O.setSplitLineWide(8);O.setResizeMode(na.RESIZE_MODE_FIRST_FIXED);O.setFirstSize(200,185,300);O.setSecondSize(a.getWidth()-250,350,-1);m=new Oa;m.setFunUpdateProperties(d);m.setMeta(a.getMeta());O.setFirstChild(na.createChildWrapper(m.getJqUi()));O.setSecondChild(na.createChildWrapper(h));O.getJqUi().appendTo(c);m.setSelectedTableNames(a.getCurrentTableName().split(I.ENTITY_SEPARATOR))}return c};this.getIsEntityView=function(){return!0};this.getSelectedProperties=function(){for(var h=[],O={},f=!0,
e=a.getCurrentTableName().split(I.ENTITY_SEPARATOR),z=0;z<e.length;z++){var H=e[z];H=b.getTableFieldMap()[H];for(var D=0;D<H.length;D++){var G=H[D],q=G.getField();O[q.getFullName()]||(G.getSelected()?(h.push(q),O[q.getFullName()]=!0):f=!1)}}return f?null:h};this.getSelectedEntityName=function(){return m.getSelectedEntityName()};var d=function(h,O){b.setArrProperties(h,O)}})})();(function(){function qa(){var xa=this,za,aa,Aa,ua,fa,u,F,Q;this.setCurrentNode=function(n){za=n};this.getCurrentNode=function(){return za};this.setModelerModel=function(n){aa=n};this.setNodeStatusMonitor=function(n){Aa=n};this.setDirty=function(n){ua=n};this.isDirty=function(){return ua};this.setMask=function(n){fa=n};this.getMask=function(){return fa};this.setInValidBackgroundPanel=function(n){u=n};this.getInValidBackgroundPanel=function(){return u};this.setModelerChecker=function(n){F=n};this.protectedGetModelerChecker=
function(){return F};this.clear=function(){za=null;xa.protectedClear()};this.protectedClear=function(){throw Error("Implement me.");};this.showPreviewContent=function(){za?xa instanceof Ua?F.focusNodeValidity(za,r):F.focusNodeValidity(za,w):(fa.hide(),u.setText(Z.get("dataLoading","\u6570\u636e\u52a0\u8f7d\u4e2d")),u.show())};this.protectedGetModeler=function(){return aa};var r=function(){xa.isCurrentNodeValid()?(u.hide(),xa.protectedShowPreviewContent()):(u.setText(L()),u.show())},w=function(){xa.isCurrentNodeValid()?
(u.hide(),fa.setClickCallback(xa.protectedShowPreviewContent),fa.show()):(fa.hide(),u.setText(L()),u.show())};this.protectedShowPreviewContent=function(){throw Error("Implement me.");};this.afterResize=function(){console.log("preview area resize.....");Aa&&Aa.getSelected()&&xa.protectedAfterResize()};this.protectedAfterResize=function(){throw Error("Implement me.");};this.setRuntimeModelGetter=function(n){Q=n};this.getRuntimeModel=function(){if(za&&aa)return Q(aa,za)};this.isCurrentNodeValid=function(){return za?
!Aa.isInvalidNode(za.getId()):!0};var L=function(){var n=Aa.getInvalidPrompt(za);return n?n:Z.get("invalidNodeConfig","\u8282\u70b9#1\u8bbe\u7f6e\u4e0d\u5b8c\u6574").replace("#1",za.getAlias())}}function Ua(){function xa(F){KTDefaultCellRender.call(this,F);var Q=this,r=this.paintCellUI;this.paintCellUI=function(w,L){var n=Q.getCurrentRowIdx(),t=Q.getCurrentRow(),a=Q.getCurrentColIdx();t=t.getUserObject();if(n<ra.getHeadRowCount())r(w,L);else if(0==a)L=$("<div>"),t=t.getName(),L.text(t),L.attr("title",
t),L.css("line-height","28px"),L.css("padding-left","2px"),L.css("padding-right","2px"),L.appendTo(w);else if(1==a)L=$("<div>"),t=t.getAlias(),L.text(t),L.attr("title",t),L.css("line-height","28px"),L.css("padding-left","2px"),L.css("padding-right","2px"),L.appendTo(w);else if(2==a){if(t=t.getSourceNodeId(),L=za.protectedGetModeler().getNode(t))t=$("<div>"),L=ya.DisplayNameHelper.getNodeDisplayName(L),t.text(L),t.attr("title",L),t.css("line-height","28px"),t.css("padding-left","2px"),t.css("padding-right",
"2px"),t.appendTo(w)}else 3==a&&(L=$("<div>"),t=ia.getDataTypeDesc(t.getAppointedDataType()),L.text(t),L.attr("title",t),L.css("line-height","28px"),L.css("padding-left","2px"),L.css("padding-right","2px"),L.appendTo(w))}}Da.AbstractTabPane.call(this);qa.call(this);var za=this,aa,Aa,ua,fa;this.getTitle=function(){return Z.get("field","\u5b57\u6bb5")};this.getJqUi=function(){if(!aa){aa=$("<div>");Aa&&u();var F=new Ma,Q=F.getJqUi();za.setMask(F);F.hide();g.layoutCtrlWithLRTB(Q,0,0,null,0,0,null);aa.append(Q);
F=new Ya;Q=F.getJqUi();F.hide();za.setInValidBackgroundPanel(F);g.layoutCtrlWithLRTB(Q,0,0,null,0,0,null);aa.append(Q)}return aa};this.into=function(){!Aa||za.isDirty()?(za.showPreviewContent(),za.setDirty(!1)):za.afterResize()};this.protectedAfterResize=function(){ua&&Aa&&0!=Aa.length&&ua.relayoutViews()};this.setRemoteImpl=function(F){};this.protectedClear=function(){Aa=null};this.reload=function(){za.showPreviewContent()};this.protectedShowPreviewContent=function(){ya.NodeFieldHelper.asynGetFields(za.getGlobal().getModelerModel(),
za.getCurrentNode(),function(F){Aa=F;ua||u();ra.clear(ua);ua.addColumns(4);ua.getColumn(0).setWidth(200);ua.getColumn(1).setWidth(200);ua.getColumn(2).setWidth(140);ua.getColumn(3).setWidth(140);F=ra.createHeadRow(ua);F.getCell(0).setValue(Z.get("fieldName","\u5b57\u6bb5\u540d\u79f0"));F.getCell(1).setValue(Z.get("fieldAlias","\u663e\u793a\u540d\u79f0"));F.getCell(2).setValue(Z.get("tableSource","\u6765\u6e90\u8868"));F.getCell(3).setValue(Z.get("dataType","\u6570\u636e\u7c7b\u578b"));if(Aa){F=0;
for(var Q=Aa.length;F<Q;F++)ra.createRow(ua).setUserObject(Aa[F])}ra.refresh(ua)},function(){},aa)};var u=function(){ua=ra.createTable();ua.setColumnFitVisibleWidth(!0);var F=new xa(ua);F.setOutsideVisible(!1);ua.setCellRender(F);ua.setSyncUIWhenModelChanged(!0);fa=$(ua.getUI());g.layoutCtrlWithLRTB(fa,10,10,null,10,10,null);fa.appendTo(aa)}}function Oa(){function xa(a){KTDefaultCellRender.call(this,a);var c=this,m=this.paintCellUI;this.paintCellUI=function(b,d){var h=c.getCurrentRowIdx(),O=c.getCurrentRow(),
f=c.getCurrentColIdx();O=O.getUserObject();if(h<ra.getHeadRowCount())m(b,d);else{d=u.getField(f);h=d.getOutputDataType();f=O[f];if(null==f||void 0==f)f="";else if(h==M.DT_DATE)O=new ka,O.setFormatString("yyyy-MM-dd"),f=O.format(f);else if(h==M.DT_DATETIME)O=new ka,O.setFormatString("yyyy-MM-dd HH:mm:ss"),f=O.format(f);else if(h==M.DT_BOOLEAN)f=void 0===f?"":f?"true":"false";else if(h==M.DT_NUMBER&&(O=d.getScale()))for(f+="",d=f.split("."),2>d.length?(f+=".",d=""):d=d[1],O-=d.length,d=0;d<O;d++)f+=
"0";O=$("<div>");O.text(f);O.attr("title",f);O.css("line-height","28px");O.css("padding-left","2px");O.css("padding-right","2px");O.appendTo(b)}}}Da.AbstractTabPane.call(this);qa.call(this);var za=this,aa,Aa,ua,fa,u,F=1E3,Q=100,r=!1,w;this.getTitle=function(){return Z.get("preview","\u9884\u89c8")};this.getJqUi=function(){if(!aa){aa=$("<div>");var a=$("<div>");a.css("cursor","pointer");a.attr("title",Z.get("previewSet","\u9884\u89c8\u8bbe\u7f6e"));a.on("click",t);N.backgroundWithHover(a,"setting");
g.layoutCtrl(a,10,3,20,20);a.appendTo(aa);w=$("<div>");g.layoutCtrlWithLRTB(w,40,10,null,5,null,20);w.css({"font-size":"14px",color:"#666",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"});w.appendTo(aa);n();a=new Ma;var c=a.getJqUi();za.setMask(a);a.hide();g.layoutCtrlWithLRTB(c,5,5,null,28,5,null);aa.append(c);a=new Ya;c=a.getJqUi();za.setInValidBackgroundPanel(a);a.hide();g.layoutCtrlWithLRTB(c,5,5,null,28,5,null);aa.append(c);L()}return aa};this.setRemoteImpl=function(a){Aa=
a};this.into=function(){!u||za.isDirty()?(za.showPreviewContent(),za.setDirty(!1)):za.afterResize()};this.protectedAfterResize=function(){ua&&u&&0!=u.getRowCount()&&ua.relayoutViews()};this.protectedClear=function(){u=null};this.reload=function(){za.showPreviewContent()};this.protectedShowPreviewContent=function(){var a=za.getRuntimeModel();if(a){var c=(new Date).getTime(),m=new C(Aa,function(d){var h=za.getCurrentNode(),O=new na;O.fromJsonObject(d);if(d=O.getValidity())za.protectedGetModelerChecker().updateNodeValidity(d,
c);else if(d=O.getPreviewData(),h&&O.getNodeId()==h.getId()&&(u=d,u&&0!=u.getRowCount()||(za.getMask().hide(),za.getInValidBackgroundPanel().setText(Z.get("noData","\u5f53\u524d\u9884\u89c8\u89c4\u5219\u4e0b,\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e")),za.getInValidBackgroundPanel().show()),ua||n(),u)){fa||(fa=$(ua.getUI()),g.layoutCtrlWithLRTB(fa,10,10,null,30,10,null),fa.appendTo(aa));d=u.getColumnCount();h=u.getRowCount();ra.clear(ua);if(0!=d&&0!=h){ua.addColumns(d);var f=ra.createHeadRow(ua);
for(O=0;O<d;O++)ua.getColumn(O).setWidth(150),f.getCell(O).setValue(u.getField(O).getAlias());for(O=0;O<h;O++)d=u.getOneRow(O),ra.createRow(ua).setUserObject(d)}ra.refresh(ua)}},function(d,h){return ya.DppVersionExceptionHandler.handle(d)}),b=new la;r?b.setExtractAllDataAndPreviewCount(Q):b.setExtractPartlyData(F,Q);a.setPreviewConfig(b);m.setBlockingJqUi(aa);m.getPreviewData(a)}};var L=function(){var a=r?Z.get("extractAllData","\u62bd\u53d6\u5168\u91cf\u6570\u636e\u8fdb\u884c\u8ba1\u7b97, "):Z.get("onlyExtractSomeRows",
"\u4ec5\u62bd\u53d6\u524d#1\u884c\u8fdb\u884c\u8ba1\u7b97, ").replace("#1",F);a+=Z.get("previewRows","\u663e\u793a\u8ba1\u7b97\u7ed3\u679c\u7684\u524d#1\u884c\u6570\u636e").replace("#1",Q);w.text(a)},n=function(){ua=ra.createTable();ua.setColumnFitVisibleWidth(!1);var a=new xa(ua);a.setOutsideVisible(!1);ua.setCellRender(a);ua.setSyncUIWhenModelChanged(!0)},t=function(){var a=new ib;a.setTitle(Z.get("previewSet","\u9884\u89c8\u8bbe\u7f6e"));a.setOriginExtractCount(F);a.setOriginPreviewCount(Q);a.setAllData(r);
a.setConfirmCallback(function(c,m,b){r=c;F=m;Q=b;za.showPreviewContent();L()});a.showDialog()}}function ib(){J.call(this);var xa=this.protectedMethod,za=this,aa,Aa,ua,fa,u=!1,F=!1,Q,r,w;(function(){xa.setSelectable(!0);xa.setContentPaneCreator(function(){za.setSize(440,330);return L()});xa.setFooterPaneCreator(function(c){var m=new X(Z.get("confirm","\u786e\u5b9a"));m.setHighlight(!0);var b=m.getJqUi();b.addClass("sa-ctrl-dialog-footer-ok");b.appendTo(c);m.addActionListener(function(d){d=aa.getValue();
var h=Aa.getValue();w&&w(u,d,h,F);xa.destroy();return!0});m=new X(Z.get("cancel","\u53d6\u6d88"));m.setHighlight(!1);b=m.getJqUi();b.addClass("sa-ctrl-dialog-footer-cancel");b.appendTo(c);m.addActionListener(function(d){xa.destroy();return!0})});xa.setClosingAction(function(c){})})();this.setTitle=function(c){Q=c};this.setOriginExtractCount=function(c){ua=c};this.setOriginPreviewCount=function(c){fa=c};this.setAllData=function(c){u=c};this.setAllDataPreview=function(c){F=c};this.isCreatePreviewAllBtn=
function(c){r=c};this.setConfirmCallback=function(c){w=c};var L=function(){xa.setTitle(Q);var c=$("<div>"),m=$("<div>");m.text(Z.get("extractSet","\u62bd\u53d6\u8bbe\u7f6e"));g.layoutCtrl(m,30,20,100,24);m.appendTo(c);m.css({color:"#333333","line-height":"24px","font-size":"14px"});m=t("extract",Z.get("extract","\u62bd\u53d6\u524d"),c);var b=m.getJqUi();g.layoutCtrlWithLRTB(b,60,null,300,60,null,null);aa=new va;var d=aa.getJqUi();aa.setConstraint(1,1E4,1);aa.setValue(ua);g.layoutCtrlWithLRTB(d,120,
null,100,49,null,null);d.appendTo(c);d=$("<div>");d.text(Z.get("rowDataCalculate","\u884c\u6570\u636e\u8ba1\u7b97"));d.css("color","#666");g.layoutCtrlWithLRTB(d,170,0);g.layoutCtrlMiddleAlign(d,22);d.appendTo(b);b=t("extractAll",Z.get("all","\u5168\u91cf"),c);d=b.getJqUi();g.layoutCtrlWithLRTB(d,60,null,300,90,null,null);var h=$("<div>");N.background(h,"warning");h.attr("title",Z.get("extractAllWarn","\u62bd\u53d6\u5168\u91cf\u6570\u636e\u8ba1\u7b97\u65f6\uff0c\u4f1a\u589e\u52a0\u6570\u636e\u9884\u89c8\u7684\u65f6\u957f\uff0c\u589e\u52a0\u670d\u52a1\u5668\u538b\u529b\uff0c\n\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\uff0c\u56e0\u6b64\u63a8\u8350\u62bd\u53d6\u90e8\u5206\u6570\u636e\u3002"));
g.layoutCtrlWithLRTB(h,110,null,20,79,null,20);h.appendTo(c);d=new I;d.addElement(m);d.addElement(b);d.addChangedListener(function(O,f){f&&("extract"==O.getUserObject()?(u=!1,aa.setEnabled(!0),h.hide()):(u=!0,aa.setEnabled(!1),h.show()))});u?(a(d,"extractAll"),aa.setEnabled(!1),h.show()):(a(d,"extract"),aa.setEnabled(!0),h.hide());m=$("<div>");m.text(Z.get("dataPreview","\u6570\u636e\u9884\u89c8"));g.layoutCtrl(m,30,115,100,24);m.appendTo(c);m.css({color:"#333333","line-height":"24px","font-size":"14px"});
m=t("dataPreview",Z.get("previewResult","\u9884\u89c8\u8ba1\u7b97\u7ed3\u679c\u7684\u524d"),c);m.setChecked(!0);b=m.getJqUi();g.layoutCtrlWithLRTB(b,60,null,300,155,null,null);Aa=new va;d=Aa.getJqUi();Aa.setConstraint(1,1E3,1);Aa.setValue(fa);g.layoutCtrlWithLRTB(d,180,null,100,144,null,null);d.appendTo(c);d=$("<div>");d.text(Z.get("rowData","\u884c\u6570\u636e"));d.css("color","#666");g.layoutCtrlWithLRTB(d,230,0);g.layoutCtrlMiddleAlign(d,22);d.appendTo(b);r&&n(c,m);return c},n=function(c,m){var b=
t("PreviewAll",Z.get("all","\u5168\u91cf"),c),d=b.getJqUi();g.layoutCtrlWithLRTB(d,60,null,300,185,null,null);var h=$("<div>");N.background(h,"warning");h.attr("title",Z.get("PreviewAllWarn","\u9884\u89c8\u5168\u91cf\u6570\u636e\u8ba1\u7b97\u65f6\uff0c\u4f1a\u589e\u52a0\u6570\u636e\u9884\u89c8\u7684\u65f6\u957f\uff0c\u589e\u52a0\u670d\u52a1\u5668\u538b\u529b\uff0c\n\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\uff0c\u56e0\u6b64\u63a8\u8350\u9884\u89c8\u90e8\u5206\u6570\u636e\u3002"));g.layoutCtrlWithLRTB(h,
110,null,20,175,null,20);h.appendTo(c);c=new I;c.addElement(m);c.addElement(b);c.addChangedListener(function(O,f){f&&("dataPreview"===O.getUserObject()?(F=!1,Aa.setEnabled(!0),h.hide()):(F=!0,Aa.setEnabled(!1),h.show()))});F?(a(c,"PreviewAll"),Aa.setEnabled(!1),h.show()):(a(c,"dataPreview"),Aa.setEnabled(!0),h.hide())},t=function(c,m,b){var d=new K;d.setUserObject(c);d.setText(m);c=d.getJqUi();b.append(c);return d},a=function(c,m){c.toCheckTheElement(function(b){return b.getUserObject()===m})}}function Ya(){var xa,
za;this.getJqUi=function(){xa||(xa=$("<div>"),xa.addClass("modeler-designer-preview-no-data-background"),za=$("<div>"),za.addClass("modeler-designer-preview-no-data-text"),za.appendTo(xa));return xa};this.setText=function(aa){za.text(aa)};this.hide=function(){xa.hide()};this.show=function(){xa.show()}}function Ma(){var xa=this,za,aa;this.setClickCallback=function(ua){aa=ua};this.getJqUi=function(){za||Aa();return za};var Aa=function(){za=$("<div>");za.addClass("modeler-designer-preview-mask");var ua=
$("<div>");ua.text(Z.get("refreshPreviewData","\u7f16\u8f91\u5b8c\u6210\u540e\uff0c\u70b9\u51fb\u6b64\u5904\u5237\u65b0\u9884\u89c8\u6570\u636e\u3002"));ua.on("click",function(fa){xa.hide();aa&&aa()});ua.addClass("modeler-designer-preview-mask-button");ua.appendTo(za)};this.show=function(){za.show()};this.hide=function(){za.hide()}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&
(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var ya=com.kingdee.bos.qing.modeler.designer;ya.AbstractPreviewArea=function(){var xa=this,za,aa,Aa,ua,fa,u,F,Q,r,w,L=!1,n;this.protectedModelerPropChangeListener=function(b,d){};this.protectedGetRuntimeModel=function(b,d){throw Error("override me");};this.getJqUi=function(){fa||t();return fa};
this.setModelerModel=function(b){za&&za.removePropertyChangeCallback(m);za=b;za.addPropertyChangeCallback(m)};this.setModelerChecker=function(b){r=b};this.setNodeStatusMonitor=function(b){aa&&aa.removeSelectNodeListener(a);aa&&aa.removeInvalidNodeChangeListener(c);aa=b;aa.addSelectNodeListener(a);aa.addInvalidNodeChangeListener(c)};this.setGlobal=function(b){Aa=b};this.setRemoteImpl=function(b){ua=b};this.setHideListener=function(b){w=b};this.show=function(b){L!=!b&&((L=!b)||u.getCurrentTabPane().into())};
var t=function(){fa=$("<div>");F=new Ua;Q=new Oa;F.setRemoteImpl(ua);Q.setRemoteImpl(ua);Q.setNodeStatusMonitor(aa);F.setNodeStatusMonitor(aa);Q.setModelerChecker(r);F.setModelerChecker(r);Q.setRuntimeModelGetter(xa.protectedGetRuntimeModel);F.setRuntimeModelGetter(xa.protectedGetRuntimeModel);u=new Da;u.setTabLevel(Da.SECOND_LEVEL);u.addTab(F,!0);u.addTab(Q);var b=$("<div>");N.background(b,"downArrow");g.layoutCtrlWithLRTB(b,null,5,16,8,null,16);b.css("cursor","pointer");b.on("click",function(){L=
!0;w&&w()});b.appendTo(fa);fa.append(u.getJqUi())},a=function(b,d){Q.clear();F.clear();d&&(n=aa.getInvalidState(d),b=Aa.getModelerModel(),F.setCurrentNode(d),F.setModelerModel(b),Q.setCurrentNode(d),Q.setModelerModel(b));L||(d=u.getCurrentTabPane(),(b=d.getJqUi().find(".sa-common-loading-modallayer"))&&b.remove(),d.showPreviewContent())},c=function(b){if(b=u.getCurrentTabPane())if(b=b.getCurrentNode()){b=aa.getInvalidState(b);if(n!=b&&!L){var d=u.getCurrentTabPane();d.reload();d==Q?F.setDirty(!0):
Q.setDirty(!0)}n=b}},m=function(b,d){xa.protectedModelerPropChangeListener(b,d)};this.afterResize=function(){u.getCurrentTabPane().afterResize()}};ya.PreviewCountSetDialog=ib;var Da,va,I,K,J,X,Z,ra,N,g,ka,C,ia,M,la,na;(function(){var xa=com.kingdee.bos.qing.ui.component;Da=xa.TabContainer;va=xa.Spinner;I=xa.RadioButtonGroup;K=xa.RadioButton;J=xa.AbstractModalDialog;X=xa.Button;xa=com.kingdee.bos.qing.common.ui;ra=xa.TableUtil;xa=com.kingdee.bos.qing.common;g=xa.DomUtil;ka=xa.DateFormater;xa=com.kingdee.bos.qing.framework.common;
Z=xa.MultilanguageManager.createPackageAccessor(ya);C=ya.DesignerFacade;M=ya.Field;ia=ya.PropDataTypeUtil;la=ya.PreviewConfig;N=ya.Icons;na=ya.ExecuteResult})()})();(function(){function qa(){var G,q,v,k,l,p,E,A;this.setTableArea=function(oa){};this.setGlobal=function(oa){E=oa};this.getGlobal=function(){return E};this.setRemoteImpl=function(oa){};this.setModelerModel=function(oa){q&&q.removePropertyChangeCallback(ha);q=oa;q.addPropertyChangeCallback(ha);B()};this.getJqUi=function(){if(!G){G=$("<div>");G.addClass("modeler-designer-workarea");G.addClass("modeler-designer-common-border");var oa=$("<div>");oa.addClass("modeler-designer-workarea-title");var W=$("<div>");
W.addClass("modeler-designer-workarea-title-text");W.text(fa.get("source","\u6570\u636e\u6e90"));oa.append(W);W=$("<div>");W.addClass("modeler-designer-workarea-title-btn");H.backgroundWithHover(W,"add");W.on("click",Y);W.attr("title",fa.get("selectDataSource","\u9009\u62e9\u6570\u636e\u6e90"));W.appendTo(G);v=$("<div>");v.addClass("modeler-designer-workarea-container");k=new L;k.setBorderVisible(!1);k.setToggleSelectingEnabled(!1);k.setCustomItemPainter(Ja);k.setCustomSelectedsPainter(ca);k.addSelectedChangedListener(Ga);
l=k.getJqUi();l.appendTo(v);ua.layoutCtrlWithLRTB(l,0,0,null,0,0,null);G.append(oa);G.append(v);B()}return G};this.showDialogIfNoSource=function(){var oa=q.getAllSource();if(!oa||0==oa.length){var W=Y();oa=new u;oa.setCallbackImmediately(function(){W.updateTable()});oa.observe()}};var B=function(){if(q){var oa=q.getAllSource();k.setItemModels(oa);if(oa&&0!=oa.length){p&&p.hide();var W=!1,Ta=k.getSelecteds();if(Ta)for(var Ca=0;Ca<Ta.length;Ca++)for(var ma=Ta[Ca],x=0;x<oa.length;x++){var Na=oa[x];if(Na==
ma){W=!0;1===oa.length&&(Ta.push(null),k.setSelecteds([Na]));break}}W||k.setSelecteds([oa[0]]);l.show()}else l.hide(),p||(p=$("<div>"),p.appendTo(G),p.addClass("modeler-designer-sourcearea-nosource"),oa=$("<div>"),oa.appendTo(p),H.background(oa,"no_data_cloud"),ua.layoutCtrlCenterAlign(oa,138),ua.layoutCtrl(oa,null,0,null,78),oa=$("<div>"),oa.text(fa.get("selectDataSource","\u9009\u62e9\u6570\u636e\u6e90")),oa.attr("title",fa.get("selectDataSource","\u9009\u62e9\u6570\u636e\u6e90")),oa.on("click",
Y),oa.appendTo(p),oa.addClass("modeler-designer-sourcearea-text-add")),p.show()}},Y=function(){var oa=new Ua;oa.setGlobal(E);oa.setSelectedCallback(S);oa.setModeler(q);oa.showDialog();return oa},ha=function(oa){if(oa==g.KEY_ADD_PREPARED_SOURCE||oa==g.KEY_REMOVE_PREPARED_SOURCE||oa==g.KEY_SET_PREPARED_SOURCE)console.log("update source area ui"),B()},S=function(oa,W){if(oa&&0!=oa.length||W&&0!=W.length){var Ta=new na;Ta.setValue(oa,W,q);E.getCommandManager().perform(Ta)}},Ja=function(oa,W){oa.css("height",
"30px");oa.css("cursor","pointer");var Ta=W.getSourceType();if(Ta){var Ca=W.getName();Ca||(Ca=D.createSourceNameByType(Ta),W.setName(Ca));oa.attr("name",Ca);var ma=0,x=E.getIntegration().getMapSourcePermission();if(x)for(var Na=Object.keys(x),ba=0;ba<Na.length;ba++)if(Na[ba]===W.getSourceId()){Na=x[Na[ba]];if(!Na)break;x=Na.errorCode;x!=qa.CURRENT_USER_NOPERMISSION_PUBLIC_SOURCE_ERRORCODE&&x!=qa.CURRENT_USER_NOPERMISSION_DATACENTER_ERRORCODE&&(ma=D.createExceptionIcon(Na.errorMessage),ma.addClass("modeler-designer-sourcearea-exception-icon"),
ma.appendTo(oa),ma=22);oa.data("errorCode",x);break}x=$("<div>");x.addClass("modeler-designer-sourcearea-icon");x.css("top","9px");H.background(x,D.getSourceIconName(Ta));x.css("left",12+ma+"px");x.appendTo(oa);x=$("<div>");x.text(Ca);x.addClass("modeler-designer-sourcearea-name");x.css("left",34+ma+"px");x.attr("title",fa.get("name","\u540d\u79f0")+"\uff1a"+Ca+"\n"+fa.get("type","\u7c7b\u578b")+"\uff1a"+D.translateSourceType(Ta));x.appendTo(oa)}else D.updateDeletedSourceStatus(oa);var Ea=$("<div>");
Ea.addClass("modeler-designer-sourcearea-delete-btn");Ea.on("mousedown",function(Xa){Xa.stopPropagation();q.isSourceUsed(W)?E.getMessageCurtain().showPrompt(fa.get("theSourceIsUsed","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u6570\u636e\u8868\u6a21\u578b\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u7a97\u53e3\u5220\u9664\u8be5\u6570\u636e\u6e90\u4e0b\u7684\u8868\uff0c\u518d\u5220\u9664\u6570\u636e\u6e90\u3002")):$a().setClosingChecker(function(ja){ja==d.RETURN_OK&&(ja=new la,ja.setValue(W,q),E.getCommandManager().perform(ja),
oa.is(A)&&K.SourceConnectStep.removeTableTree(),oa.remove());return!0})});H.backgroundWithHover(Ea,"delete");Ea.appendTo(oa);Ea.hide();oa.mouseenter(function(){Ea.show()}).mouseleave(function(){Ea.hide()})},ca=function(oa,W){W&&0<W.length&&(oa&&0<oa.length&&(oa=oa[0],oa.css("background-color",""),oa.css("color","")),W=W[0],W.css("background-color","#eff3fd"),W.css("color","rgb(130, 130, 130)"))},Ga=function(oa,W,Ta){oa=Ta[0];A=W=k.getItemUiByModel(oa);K.ConnectSourceCreator.getSourceConnector(oa,
W).getFunConnectSource()()},$a=function(){var oa=d.createFeedbackDialog();oa.setMsgImageType(d.MSG_DELETE);oa.setOptionType(d.OPTION_OK_CANCEL);oa.setMessage(fa.get("confirmDeleteSource","\u786e\u5b9a\u5220\u9664\u8be5\u6570\u636e\u6e90\u5417\uff1f"));oa.showDialog();return oa}}function Ua(){Q.call(this);var G=this,q=this.protectedMethod,v,k,l,p;(function(){q.setTitle(fa.get("selectDataSource","\u9009\u62e9\u6570\u636e\u6e90"));G.setSize(791,600);q.setSelectable(!0);q.setContentPaneCreator(function(){v=
new ib;v.setRemoteImpl(K.ModelSetSourceIntegration.getRemoteImpl());var A=$("<div>");v.setArrExistsSource(l.getAllSource());v.setContainer(A);v.setMultiSelect(!0);v.loadDataSource();return A});q.setFooterPaneCreator(function(A){var B=new F(fa.get("confirm","\u786e\u5b9a"));B.setHighlight(!0);var Y=B.getJqUi();Y.addClass("sa-ctrl-dialog-footer-ok");Y.appendTo(A);B.addActionListener(function(ha){ha=v.getSelected();v.getTable()?E(ha):q.destroy()});B=new F(fa.get("cancel","\u53d6\u6d88"));B.setHighlight(!1);
Y=B.getJqUi();Y.addClass("sa-ctrl-dialog-footer-cancel");Y.appendTo(A);B.addActionListener(function(ha){q.destroy();return!0})});q.setClosingAction(function(A){})})();this.setGlobal=function(A){p=A};this.updateTable=function(){var A=$(document.body),B=A.prop("clientWidth");A=A.prop("clientHeight");B=Math.max(0,B-791>>1);A=Math.max(0,A-600>>1);q.getDialogCtrl().setBounds(B,A,791,600);v.updateUiByObserver()};this.setSelectedCallback=function(A){k=A};this.setModeler=function(A){l=A};var E=function(A){(new (K.ModelSetSourceIntegration.getModelSetSourceFacade())(K.ModelSetSourceIntegration.getRemoteImpl(),
function(B){for(var Y,ha=0,S=0;S<A.length;S++){for(var Ja=!1,ca=0;ca<B.length;ca++)if(A[S].getId()==B[ca].id){Ja=!0;break}Ja||(ha++,1==ha&&(Y=A[S].getSourceName()))}if(0<ha){v.rePaintSource(B);if(1<ha){var Ga=fa.get("moreSourceDeleted","\u201c#1\u201d\u7b49#N\u4e2a\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");Ga=Ga.replace("#N",""+ha)}else Ga=fa.get("sourceDeleted","\u201c#1\u201d\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");
Ga=Ga.replace("#1",Y);q.getMessageCurtain().showPrompt(Ga)}else{ha=0;B=!0;S=!1;Y=[];Ja=l.getAllSource();for(ca=0;ca<Ja.length;ca++){for(var $a=Ja[ca],oa=!1,W=A.length-1;0<=W;W--)$a.getSourceId()===A[W].getId()&&(oa=!0,A.splice(W,1));oa||(l.isSourceUsed($a)?(ha++,($a=$a.getName())?B&&(B=!1,Ga=$a):S=!0):Y.push($a))}if(0<ha)S?Y=fa.get("sourceIsDeleted","\u5f53\u524d\u8bbe\u8ba1\u5668\u4e2d\u5b58\u5728\u5df2\u88ab\u5220\u9664\u7684\u6570\u636e\u6e90\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u5668\u4e2d\u5220\u9664\u8be5\u6570\u636e\u6e90\uff0c\u518d\u91cd\u65b0\u9009\u62e9\u6570\u636e\u6e90\u3002"):
(1<ha?(Y=fa.get("moreSourceIsUsed","\u201c#1\u201d\u7b49#N\u4e2a\u6570\u636e\u6e90\u5df2\u88ab\u6570\u636e\u8868\u6a21\u578b\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u7a97\u53e3\u5220\u9664\u6570\u636e\u6e90\u4e0b\u7684\u8868\uff0c\u518d\u53d6\u6d88\u52fe\u9009\u6570\u636e\u6e90\u3002"),Y=Y.replace("#N",""+ha)):Y=fa.get("sourceIsUsed","\u201c#1\u201d\u6570\u636e\u6e90\u5df2\u88ab\u6570\u636e\u8868\u6a21\u578b\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u7a97\u53e3\u5220\u9664\u6570\u636e\u6e90\u4e0b\u7684\u8868\uff0c\u518d\u53d6\u6d88\u52fe\u9009\u6570\u636e\u6e90\u3002"),
Y=Y.replace("#1",Ga)),q.getMessageCurtain().showPrompt(Y),v.rePaintSource();else{if(p.getIntegration()&&(Ga=p.getIntegration().getMapSourcePermission()))for(ha=Object.keys(Ga),B=0;B<A.length;B++)for(S=0;S<ha.length;S++)if(ha[S]==A[B].getId()){Ga[ha[S]]=null;break}Ga=[];for(ha=0;ha<A.length;ha++)B=new Z,B.setName(A[ha].getSourceName()),B.setSourceType(A[ha].getSourceType()),B.setId(K.UIDHelper.getUID(K.UIDHelper.NS_SOURCE)),B.setSourceId(A[ha].getId()),B.setModelId(K.ModelSetSourceIntegration.getModelId()),
Ga.push(B);k&&k(Ga,Y);q.destroy()}}})).designerLoadSources()}}function Oa(G,q,v){Q.call(this);var k=this,l=this.protectedMethod,p,E,A,B,Y,ha=[],S,Ja,ca,Ga;(function(){q?l.setTitle(fa.get("EditSQL","\u7f16\u8f91SQL/KSQL")):l.setTitle(fa.get("customSQL","\u81ea\u5b9a\u4e49SQL/KSQL"));k.setSize(590,450);l.setSelectable(!0);var $a=function(){l.destroy()},oa=function(){A.setTableName(p.getText().trim());A.setDisplayName(p.getText());var W=new ia,Ta=S.isChecked()?"SQL":"KSQL";W.setSqlType(Ta);W.setContent(E.getText());
A.setUserSql(W);(new ra(G,function(Ca){for(Ca=0;Ca<ha.length;Ca++)(0,ha[Ca])(A,B);$a()},function(Ca,ma){l.getMessageCurtain().showError(ma);return!0})).checkUserSqlExecutable(Ta,E.getText(),Y.getSourceId(),A.getNamespace())};l.setContentPaneCreator(function(){var W=$("<div>"),Ta=new O;Ta.setText(fa.get("name","\u540d\u79f0"));Ta=Ta.getJqUi();p=new f;A.getTableName()&&p.setText(A.getTableName());var Ca=p.getJqUi(),ma=new r;S=new w;S.setText("SQL");S.setChecked(!0);Ja=new w;Ja.setText("KSQL");ma.addElement(S);
ma.addElement(Ja);ma=S.getJqUi();var x=Ja.getJqUi(),Na=new O;Na.setText(fa.get("SQLContent","\u5185\u5bb9"));Na=Na.getJqUi();E=new e;if(A&&A.getUserSql()){var ba=A.getUserSql();"KSQL"==ba.getSqlType()&&Ja.setChecked(!0);E.setText(ba.getContent())}ba=E.getJqUi();W.append(Ta);W.append(Ca);W.append(ma);v&&W.append(x);W.append(Na);W.append(ba);var Ea=12;ua.layoutCtrl(Ta,10,Ea,80,23);ua.layoutCtrl(Ca,90,Ea,420,23);ua.layoutCtrl(Na,10,Ea+=50,80,23);ua.layoutCtrl(ma,90,Ea,80,23);ua.layoutCtrl(x,170,Ea,80,
23);ua.layoutCtrl(ba,90,Ea+50,420,200);return W});l.setFooterPaneCreator(function(W){var Ta=new F(fa.get("confirm","\u786e\u5b9a"));Ta.setHighlight(!0);var Ca=Ta.getJqUi();Ca.addClass("sa-ctrl-dialog-footer-ok");Ca.appendTo(W);Ta.addActionListener(function(ma){ma="";var x=p.getText().trim(),Na=E.getText().toLowerCase();0==x.length?ma=fa.get("nameIsEmptyPrompt","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a\u3002"):50<x.length?ma=fa.get("nameTooLongPrompt","\u540d\u79f0\u4e0d\u53ef\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002"):
0<x.indexOf(" ")?ma=fa.get("nameWithSpace","\u540d\u79f0\u4e0d\u80fd\u643a\u5e26\u7a7a\u683c\u3002"):/^[\u4E00-\u9FA5A-Za-z0-9_]+$/.test(x)?Na&&""!=$.trim(Na)?0!=Na.trim().toLowerCase().indexOf("select")?ma=fa.get("onlyAllowSelection","\u53ea\u5141\u8bb8\u67e5\u8be2\u64cd\u4f5c\u3002"):-1==Na.indexOf("from")&&-1==Na.indexOf("FROM")&&(ma=fa.get("sqlError","sql\u6267\u884c\u51fa\u9519\uff0c\u8bf7\u68c0\u67e5sql\u8bed\u53e5\u3002")):ma=fa.get("noQuery","\u8bf7\u8f93\u5165\u67e5\u8be2\u8bed\u53e5\u3002"):
ma=fa.get("invalidName","\u540d\u79f0\u53ea\u80fd\u4f7f\u7528\u4e2d\u6587\u3001\u6570\u5b57\u3001\u5b57\u6bcd\u6216\u4e0b\u5212\u7ebf\u3002");0<ma.length?l.getMessageCurtain().showPrompt(ma):(ma=p.getText().trim(),q?(x=B.getTableName(),ma=ca(ma,x)):ma=ca(ma,void 0),ma?l.getMessageCurtain().showPrompt(fa.get("duplicateNameTips","\u540d\u79f0\u91cd\u590d\u3002")):Ga&&Ga(oa,$a,q))});Ta=new F(fa.get("cancel","\u53d6\u6d88"));Ta.setHighlight(!1);Ca=Ta.getJqUi();Ca.addClass("sa-ctrl-dialog-footer-cancel");
Ca.appendTo(W);Ta.addActionListener(function(ma){l.destroy();return!0})});l.setClosingAction(function(W){})})();this.setModel=function($a){A=$a;q&&(B=$a.clone())};this.getModel=function(){return A};this.setSource=function($a){Y=$a};this.addConfirmListener=function($a){ha.push($a)};this.setTableNameChecker=function($a){ca=$a};this.setPermAndConnChecker=function($a){Ga=$a}}function ib(){function G(P){KTDefaultCellRender.call(this,P);var da=this,pa=this.paintCellUI;this.paintCellUI=function(T,U){var Fa=
da.getCurrentRowIdx(),Sa=da.getCurrentRow(),La=da.getCurrentColIdx();Sa=Sa.getUserObject();var eb=new a;eb.setFormatString("yyyy-MM-dd HH:mm:ss");da.setPaddingHV(8,1);if(Fa<t.getHeadRowCount()){if(pa(T,U),0===La&&1===Fa){if(!W)return;Sa=Ja&&Ja.isChecked();Ja=new c;Ja.setChecked(Sa);Ja.addCheckedListener(function(R,wa){if(wa){wa=Object.keys(ca);for(var Ia=0;Ia<wa.length;Ia++)ca[wa[Ia]].setChecked(R.isChecked())}});Sa=Ja.getJqUi();ua.layoutCtrl(Sa,12,0,14,18);Sa.appendTo(T)}}else if(0===La)Sa=W?cb(Sa):
y(Sa),ua.layoutCtrl(Sa,12,4,14,18),Sa.appendTo(T);else if(1===La){eb=$("<div class='modeler-designer-addsource-name-info'>");Fa=$("<span class='modeler-designer-addsource-cell-item-name'>");La=Sa.getSourceName();var ta=Sa.getErrorMessage(),Pa=Va(Sa);ta&&(ta=D.createExceptionIcon(ta),ua.layoutCtrlWithLRTB(ta,5,null,16,8,null,16),ta.appendTo(eb),Pa.css("margin-left","23px"));Pa.appendTo(eb);La||(La=Sa.getSourceType(),La=D.createSourceNameByType(La),Sa.setSourceName(La));oa&&""!=$.trim(S.getText())?
ea(Fa,La,$.trim(S.getText())):Fa.text(La);Fa.attr("title",La);Fa.appendTo(eb);eb.appendTo(T)}else 2===La?(eb=$("<div class='modeler-designer-addsource-cell-item'>"),La=D.translateSourceType(Sa.getSourceType()),oa&&""!=$.trim(S.getText())?ea(eb,La,S.getText()):eb.text(La),eb.attr("title",La),eb.appendTo(T)):3===La?(eb=$("<div class='modeler-designer-addsource-cell-item'>"),Sa=Sa.getCreatorName(),oa&&""!=$.trim(S.getText())?ea(eb,Sa,S.getText()):eb.text(Sa),eb.attr("title",Sa),eb.appendTo(T)):4===La&&
(Fa=$("<div class='modeler-designer-addsource-cell-item'>"),Sa=Sa.getCreateTime(),Sa=eb.format(Sa),Fa.text(Sa),Fa.attr("title",Sa),Fa.appendTo(T));pa(T,U)};var Va=function(T){var U=$("<span>");U.addClass("modeler-designer-addsource-source-icon");switch(T.getSourceType()){case J.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:T="entity-source-icon";break;case J.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE:T="datacenter-source-icon";break;case J.SOURCE_TYPE_MODEL_SET_SOURCE:T="modelset-source-icon";break;case J.SOURCE_TYPE_OPEN_API_SOURCE:T=
"openapi-source-icon";break;default:if(T.getSpecificType())T=T.getSpecificType().toLowerCase();else throw Error("unknown type");}H.background(U,T);return U},cb=function(T){var U=T.getErrorMessage(),Fa=T.getId(),Sa=new c,La=!1,eb=Sa.getJqUi(),ta=!1;if(0<$a.length)for(var Pa=$a.length-1;0<=Pa;Pa--)if(Fa===$a[Pa].getSourceId()){ta=La=!0;break}if(!ta&&U)return Sa.setEnabled(!1),Sa.setChecked(La),eb;U=Object.keys(ca);for(ta=0;ta<U.length;ta++)if(Fa===U[ta]){La=ca[U[ta]].isChecked();break}ca[Fa]=Sa;Sa.setChecked(La);
Sa.setUserObject(T);Sa.addCheckedListener(function(R){R=R.isChecked();var wa=Object.keys(ca);if(R)for(var Ia=0;Ia<wa.length;Ia++)if(!ca[wa[Ia]].isChecked())return;Ja.setChecked(R)});return eb},y=function(T){var U=new w,Fa=!1,Sa=U.getJqUi();if(T.getErrorMessage())U.setEnabled(!1),Sa.children().eq(0).css("background-color","#ddd");else{for(var La=T.getId(),eb=Object.keys(ca),ta=0;ta<eb.length;ta++)La===eb[ta]&&(Fa=ca[eb[ta]].isChecked());ca[La]=U;U.addCheckedListener(function(Pa,R){if(R&&Pa.isChecked())for(Pa=
0;Pa<eb.length;Pa++)La!=eb[Pa]&&ca[eb[Pa]].setChecked(!1)})}U.setChecked(Fa);U.setUserObject(T);return Sa}}var q,v,k,l,p,E,A,B,Y,ha,S,Ja,ca={},Ga=[],$a,oa=!1,W,Ta=!1;this.setMultiSelect=function(P){W=P};this.setContainer=function(P){B=P};this.setArrExistsSource=function(P){$a=P};this.getJqUi=function(){q||Qa();return q};this.setRemoteImpl=function(P){Y=P};this.getTable=function(){return ha};this.getSelected=function(){for(var P=Object.keys(ca),da=[],pa=0;pa<P.length;pa++){var Va=ca[P[pa]];if(Va.isChecked()&&
(da.push(Va.getUserObject()),!W))break}return da};this.updateUiByObserver=function(){Ta&&(0===Ga.length?V():Ea(Ga))};this.rePaintSource=function(P){P?Ca(P):(Ea(Ga),W&&Ka())};var Ca=function(P){if(0==P.length)ca={},Ga=[],l&&l.css("right","15px"),E&&(E.hide(),S.clear()),q&&q.remove(),V();else{k&&k.hide();E&&E.show();S&&S.clear();l&&l.css("right","205px");Ga=[];ca={};for(var da=0;da<P.length;da++){var pa=new M;pa.fromJsonObject(P[da]);Ga.push(pa)}Ea(Ga);W&&Ka()}},ma=function(){l=$("<div>");l.attr("title",
fa.get("refresh","\u5237\u65b0"));H.backgroundWithHover(l,"refresh");l.addClass("modeler-designer-addsource-btn-refresh");l.on("click",x);l.appendTo(B)},x=function(){(new (K.ModelSetSourceIntegration.getModelSetSourceFacade())(Y,function(P){Ca(P)})).designerLoadSources()},Na=function(){E=$("<div>");E.css("display","flex");var P=$("<div class = 'modeler-designer-addsource-modelset-source-link'>");P.text(fa.get("modelSetSourceManage","\u6570\u636e\u6e90\u7ba1\u7406"));P.attr("title",fa.get("modelSetSourceManage",
"\u6570\u636e\u6e90\u7ba1\u7406"));P.on("click",function(){aa&&aa.occur(aa.BUTTON_TYPE,aa.SOURCE_MANAGE);K.ModelSetSourceIntegration.getDataSourceManageEntrance()()});P.appendTo(E);P=new b;P.setIconType(b.ICON_TYPE_QUESTION);P.setTipsSize(380,54);var da=P.getJqUi();da.css("position","relative");var pa="<span>"+fa.get("sourceHelpTip","\u4ee5\u4e0b\u6570\u636e\u6e90\u662f\u5728\u5f53\u524d\u6a21\u578b\u96c6\u7684\u201c\u6570\u636e\u6e90\u7ba1\u7406\u201d\u4e2d\u5b9a\u4e49\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u5982\u679c\u9700\u8981\u5176\u4ed6\u7684\u6570\u636e\u6e90\uff0c\u8bf7\u5728\u201c\u6570\u636e\u6e90\u7ba1\u7406\u201d\u6dfb\u52a0\u3002")+
"</span>";P.setTipsHtml(pa);da.appendTo(E);Xa();E.appendTo(B)},ba=function(P){if(""===P)oa&&(oa=!1,Ea(Ga));else{oa=!0;P=P.toLowerCase();for(var da=[],pa=0;pa<Ga.length;pa++){var Va=Ga[pa],cb=Va.getSourceName(),y=Va.getSourceType(),T=D.translateSourceType(y),U=Va.getCreatorName();cb||(cb=D.createSourceNameByType(y));-1==cb.toLowerCase().indexOf(P)&&-1==T.toLowerCase().indexOf(P)&&-1==U.toLowerCase().indexOf(P)||da.push(Va)}Ea(da)}},Ea=function(P){v&&v.remove();Qa();if(P&&0<P.length){for(var da=0;da<
P.length;da++)ja(P[da]);p&&p.hide()}else p?p.show():(p=$("<div>"),p.addClass("modeler-designer-addsource-noresult-view-container"),P=$("<div>"),P.addClass("modeler-designer-addsource-noresult-view-icon"),H.background(P,"search-no-result"),P.appendTo(p),P=$("<div>"),P.addClass("modeler-designer-addsource-noresult-view-tip"),P.text(fa.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),P.appendTo(p),p.appendTo(B));q.appendTo(B);t.refresh(ha)},Xa=function(){A||
(S=new n,S.setShowSearchIcon(!0),S.setPlaceholder(fa.get("searchContent","\u8bf7\u8f93\u5165\u540d\u79f0/\u7c7b\u578b/\u521b\u5efa\u4eba")),S.setSearchListenerDelay(1E3),S.addSearchListener(function(){ba($.trim(S.getText()))}),A=S.getJqUi(),A.find(":input").on("keydown",function(P){13==(P.keyCode||P.which||P.charCode)&&ba($.trim(S.getText()))}),A.addClass("modeler-designer-addsource-search-box"));A.appendTo(E)},ja=function(P){if(P){var da=t.createRow(ha,!1),pa=new KTBorderStyle;pa.setBottomBorderWidth(1);
pa.setBottomBorderPen("solid");pa.setBottomBorderColor("#e5e5e5");da.setBorder(pa);da.setUserObject(P)}},V=function(){if(k)k.show();else{k=$("<div>");k.addClass("modeler-designer-addsource-nodata-view-container");var P=$("<div>");P.addClass("modeler-designer-addsource-nodata-view-icon");H.background(P,"no_data_cloud");P.appendTo(k);P=$("<div>");P.addClass("modeler-designer-addsource-nodata-view-tip");P.text(fa.get("pleaseCreateSource","\u8bf7\u5148\u5728\u201c\u6570\u636e\u6e90\u7ba1\u7406\u201d\u4e2d\u521b\u5efa\u6570\u636e\u6e90\u8fde\u63a5\u4fe1\u606f"));
P.appendTo(k);P=$("<a>");P.addClass("modeler-designer-addsource-nodata-view-text");P.text(fa.get("modelSetSourceManage","\u6570\u636e\u6e90\u7ba1\u7406"));P.attr("title",fa.get("modelSetSourceManage","\u6570\u636e\u6e90\u7ba1\u7406"));P.on("click",function(){K.ModelSetSourceIntegration.getDataSourceManageEntrance()()});P.appendTo(k);k.appendTo(B);l||ma();l.css("right","15px")}},Ka=function(){for(var P=Object.keys(ca),da=0;da<P.length;da++)if(!ca[P[da]].isChecked()){Ja.setChecked(!1);return}Ja.setChecked(!0)};
this.loadDataSource=function(){(new (K.ModelSetSourceIntegration.getModelSetSourceFacade())(Y,function(P){Ta||(Ta=!0);if(0===P.length)V();else{Qa();for(var da=0;da<P.length;da++){var pa=new M;pa.fromJsonObject(P[da]);Ga.push(pa);ja(pa)}t.refresh(ha);W&&Ka()}})).designerLoadSources()};var Qa=function(){q=$("<div class='modeler-designer-addsource-list-table'>");ha=t.createTable();ha.setColumnFitVisibleWidth(!0);ha.addColumns(5);ha.getColumn(0).setWidth(40);ha.getColumn(1).setWidth(190);ha.getColumn(2).setWidth(190);
ha.getColumn(3).setWidth(95);ha.getColumn(4).setWidth(215);ha.setScrollerVisible("hidden");var P=t.createHeadRow(ha);P.getCell(1).setValue(fa.get("name","\u540d\u79f0"));P.getCell(2).setValue(fa.get("type","\u7c7b\u578b"));P.getCell(3).setValue(fa.get("creator","\u521b\u5efa\u4eba"));P.getCell(4).setValue(fa.get("createTime","\u521b\u5efa\u65f6\u95f4"));P=new G(ha);P.setOutsideVisible(!1);ha.setCellRender(P);ha.setSyncUIWhenModelChanged(!0);v=$(ha.getUI());v.appendTo(q);q.appendTo(B);E||Na();l||ma();
l.css("right","255px")},ea=function(P,da,pa){if(P&&da&&pa){pa=pa.toUpperCase();for(var Va=da.toUpperCase(),cb=Va.split(pa),y=pa.length,T=0;T<cb.length;T++){var U=Va.indexOf(cb[T]),Fa=da.substr(0,cb[T].length);U+=cb[T].length;var Sa=Va.length-U;Va=Va.substr(U,Sa);da=da.substr(U,Sa);U=$("<span>");U.text(Fa);U.appendTo(P);T!=cb.length-1&&1<cb.length&&(U=Va.indexOf(pa),Fa=da.substr(U,y),U+=y,Sa=Va.length-U,Va=Va.substr(U,Sa),da=da.substr(U,Sa),U=$("<span>"),U.text(Fa),U.css("color","red"),U.clone().appendTo(P))}}}}
function Ya(G){var q,v,k,l=!1,p=[],E,A,B,Y=[];this.getJqUi=function(){k||(q=new m,q.setRootVisible(!1),q.setNodePainter(S),v=$a(G),q.setRoot(v),v.setExpanded(!0),v.setSelectable(!1),q.setLineHeight(30),k=q.getJqUi(),ua.layoutCtrl(k,0,1,"100%",118),q.addSelectingListener(ha),k.css({top:"31px",background:"white",height:"auto",width:"100%",bottom:"30px",overflow:"hidden auto"}));return k};var ha=function(W,Ta){W=q.searchUiByModel(Ta);W.attr("id","modeler-designer-tablearea-table-selected");W.siblings().removeAttr("id")};
this.scrollNodeToVisibleByName=function(W){for(var Ta,Ca=0;Ca<Y.length;Ca++)Y[Ca].getUserObject().getName()==W&&(Ta=Y[Ca]);if(W=q.searchUiByModel(Ta))W.attr("id","modeler-designer-tablearea-table-selected"),W.siblings().removeAttr("id"),document.querySelector(".sa-ctrl-tree").scrollTop=W.prop("offsetTop")};this.updateExceptionNodeUi=function(W,Ta){for(var Ca=k.children(),ma,x,Na=0;Na<Ca.length;Na++){var ba=Ca.eq(Na),Ea=ba.data("model"),Xa=Ea.getUserObject();if(Ea.isLeafNode()&&Xa.getCommentInfo()==
W){ma=ba;x=Xa;break}}ma&&(W=ma.children().eq(0),Ca=W.children(".modeler-designer-tablearea-table-exception-icon"),ma=0,0<Ca.length&&Ca.remove(),(Ta=D.getModelExceptionTips(Ta))?(Xa.setDisableDrag(!1),ma+=20,W.css("margin-left","20px"),Ca=D.createExceptionIcon(Ta),Ca.addClass("modeler-designer-tablearea-table-exception-icon"),Ca.appendTo(W)):Xa.setDisableDrag(!0),x.setErrorMessage(Ta),W.css("margin-left",ma+"px"))};var S=function(W,Ta){var Ca=function(Ea){var Xa=$("<div>");ua.layoutCtrlWithLRTB(Xa,
"",0,50,0,0,16);var ja=$("<div class='modeler-designer-tablearea-table-name-edit'>");H.backgroundWithHover(ja,"edit");ja.on("click",function(){A&&A(Ta.getUserObject())});var V=$("<div class='modeler-designer-tablearea-table-name-delete'>");H.backgroundWithHover(V,"delete");V.on("click",function(){B&&B(Ta.getUserObject(),V)});x.getErrorMessage()&&(ja.css("right","72px"),V.css("right","34px"));ja.appendTo(Xa);V.appendTo(Xa);Xa.appendTo(Ea);Xa.hide();Ea.on("mouseenter",function(){Xa.show();x.getErrorMessage()?
Na.css("right","90px"):Na.css("right","70px")});Ea.on("mouseleave",function(){Xa.hide();x.getErrorMessage()?Na.css("right","50px"):Na.css("right","30px")})},ma=20*Ta.getLevel();W.css("padding-left","4px");W.css("padding-right","4px");W.css("width","calc(100% - "+ma+"px)");var x=Ta.getUserObject(),Na=$("<div>");Na.addClass("modeler-designer-tablearea-table-name");Na.text(x.getDisplayName());Na.attr("title",x.getDisplayName());Na.appendTo(W);if(Ta.isLeafNode()){ma=$("<div>");ma.addClass("modeler-designer-tablearea-table-icon");
var ba=x.getUserSql()?x.getUserSql().getSqlType():"entity"==x.getType()?"entity-sub":"table";H.background(ma,ba);ma.appendTo(W);W.css("overflow","");x.getErrorMessage()&&(W.css("margin-left","20px"),ma=D.createExceptionIcon(x.getErrorMessage()),ma.addClass("modeler-designer-tablearea-table-exception-icon"),ma.appendTo(W));x.getUserSql()&&(Ca(W),Y.push(Ta))}};this.doSearch=function(W){E&&E.hide();if(""===W)l&&(Ga(),ca(),q.setRoot(v),l=!1);else if(k){W=W.toLowerCase();l&&ca();var Ta=$a(G);Ta.deepFirstVisiting(function(Ca){var ma=
Ca.getUserObject().getDisplayName();if(ma&&-1!=ma.toLowerCase().indexOf(W))for(Ca=Ca.getTreePath(),ma=0;ma<Ca.length;ma++){var x=Ca[ma];!x.isLeafNode()&&Ca[ma+1]&&x.setExpanded(!0);x=x.getUserObject();x.setMatch(!0);p.push(x)}},!1);Ja(Ta);q.setRoot(Ta);0===p.length&&(E=$("<div>"),E.text(fa.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),E.addClass("modeler-designer-tablearea-noresult-tip"),E.appendTo(k));l=!0}};var Ja=function(W){if(W.isExpanded())for(var Ta=
W.getAllChildren(),Ca=0;Ca<Ta.length;Ca++){var ma=Ta[Ca];ma.getUserObject().getMatch()?ma.isLeafNode()||Ja(ma):W.removeChild(ma)}},ca=function(){if(0<p.length)for(var W=0;W<p.length;W++)p[W].setMatch(!1);p=[]},Ga=function(){v.deepFirstVisiting(function(W){W!=v&&(W.isLeafNode()||W.setExpanded(!1))},!1)};this.setUserSqlDeleteListener=function(W){B=W};this.setUserSqlEditListener=function(W){A=W};var $a=function(W){var Ta=new m.BranchNode;Ta.setUserObject(W);if((W=W.getChildren())&&0<W.length)for(var Ca=
0;Ca<W.length;Ca++){var ma=W[Ca];if(ma instanceof N){var x=Ta;ma=ma.getChildren()?$a(ma):oa(ma);x.addChild(ma)}else Ta.addChild(oa(ma))}return Ta},oa=function(W){var Ta=new m.LeafNode;Ta.setUserObject(W);return Ta};this.setSelectedNode=function(){}}function Ma(G){var q,v,k,l,p,E=!1,A=[],B=[],Y;this.setUserSqlDeleteListener=function(Ga){p=Ga};this.setUserSqlEditListener=function(Ga){l=Ga};var ha=function(){var Ga=E?A:G.getChildren();q.getJqUi().empty();q.setItemCount(Ga.length);q.setItemUiCreator(S);
q.repaint()},S=function(Ga){var $a=function(ma){var x=$("<div>");ua.layoutCtrlWithLRTB(x,"",0,50,0,0,16);var Na=$("<div class='modeler-designer-tablearea-table-name-edit'>");H.backgroundWithHover(Na,"edit");Na.on("click",function(){l&&l(oa)});var ba=$("<div class='modeler-designer-tablearea-table-name-delete'>");H.backgroundWithHover(ba,"delete");ba.on("click",function(){p&&p(oa,ba)});oa.getErrorMessage()&&(Na.css("right","72px"),ba.css("right","34px"));Na.appendTo(x);ba.appendTo(x);x.appendTo(ma);
x.hide();ma.on("mouseenter",function(){x.show();oa.getErrorMessage()?Ta.css("right","90px"):Ta.css("right","70px")});ma.on("mouseleave",function(){x.hide();oa.getErrorMessage()?Ta.css("right","50px"):Ta.css("right","30px")})},oa=(E?A:G.getChildren())[Ga],W=$("<div class='modeler-designer-tablearea-dbCenter-item'>");W.css("padding-left","4px");W.css("padding-right","4px");W.css("height","30px");W.css("width","calc(100% - 10px)");W.data("model",oa);W.on("click",function(){Ja(W)});W.on("mouseenter",
function(){W.addClass("modeler-designer-tablearea-dbCenter-table-hover")});W.on("mouseleave",function(){W.removeClass("modeler-designer-tablearea-dbCenter-table-hover")});var Ta=$("<div>");Ta.addClass("modeler-designer-tablearea-dbCenter-table-name");Ta.text(oa.getDisplayName());Ta.attr("title",oa.getDisplayName());Ta.appendTo(W);Ga=$("<div class='modeler-designer-tablearea-dbCenter-table-icon'>");var Ca=oa.getUserSql()?oa.getUserSql().getSqlType():"table";H.background(Ga,Ca);Ga.appendTo(W);W.css("overflow",
"");oa.getErrorMessage()&&(W.css("margin-left","20px"),Ga=D.createExceptionIcon(oa.getErrorMessage()),Ga.addClass("modeler-designer-tablearea-dbCenter-table-exception-icon"),Ga.appendTo(W));oa.getUserSql()&&$a(W);return W},Ja=function(Ga){for(var $a=0;$a<B.length;$a++)B[$a].removeClass("modeler-designer-tablearea-table-selected");B=[Ga];Ga.addClass("modeler-designer-tablearea-table-selected")};this.setSelectedNode=function(Ga){if(Ga){Ga=Ga.getDisplayName();for(var $a=q.getPaintedItems(),oa=0;oa<$a.length;oa++){var W=
$a[oa],Ta=W.data("model");if(Ta&&Ta.getDisplayName()===Ga){Ja(W);break}}}};var ca=function(Ga,$a){for(var oa=0;oa<Ga.length;oa++){var W=Ga[oa];if(W.getDisplayName()===$a)return W}};this.updateExceptionNodeUi=function(Ga,$a){$a=D.getModelExceptionTips($a);for(var oa=q.getPaintedItems(),W,Ta,Ca=0;Ca<oa.length;Ca++){var ma=oa[Ca],x=ma.data("model");if(x&&x.getDisplayName()===Ga){W=ma;Ta=x;break}}W?W&&(Ga=W.children(".modeler-designer-tablearea-dbCenter-table-exception-icon"),oa=0,0<Ga.length&&Ga.remove(),
$a&&(oa+=20,W.css("margin-left","20px"),Ga=D.createExceptionIcon($a),Ga.addClass("modeler-designer-tablearea-dbCenter-table-exception-icon"),Ga.appendTo(W)),Ta.setErrorMessage($a),W.css("margin-left",oa+"px")):(W=G.getChildren(),(Ta=ca(W,Ga))&&Ta.setErrorMessage($a))};this.scrollNodeToVisibleByName=function(Ga){var $a=E?A:G.getChildren(),oa=ca($a,Ga);if(oa)for($a=30*$a.indexOf(oa),q.repaint($a),$a=q.getPaintedItems(),oa=0;oa<$a.length;oa++){var W=$a[oa],Ta=W.data("model");if(Ta&&Ta.getDisplayName()===
Ga){Ja(W);break}}};this.setSearchClearCallBack=function(Ga){Y=Ga};this.doSearch=function(Ga){Ga=$.trim(Ga).toLowerCase();k&&k.hide();var $a=G.getChildren();if(0===Ga.length)E=!1,ha();else{E=!0;A=[];for(var oa=0;oa<$a.length;oa++){var W=$a[oa],Ta=W.getDisplayName();Ta&&-1!==Ta.toLowerCase().indexOf(Ga)&&A.push(W)}ha();0===A.length&&(k=$("<div>"),k.text(fa.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),k.addClass("modeler-designer-tablearea-noresult-tip"),
k.appendTo(v))}};this.getJqUi=function(){v||(q=new z,q.setItemHeight(30),v=q.getJqUi(),ua.layoutCtrlWithLRTB(v,0,0,"100%",0,30,null),v.addClass("modeler-designer-tablearea-dbCenter"),Y&&Y(),ha());return v}}function ya(){var G,q,v=K.SourceConnectStep.getExeSourceChangeCallback(),k=function(){K.SourceConnectStep.clearTableAreaSearchBox();var l=G.data("errorCode");l?v&&v(q,l):K.SourceConnectStep.checkSourceConnectivity(q,G)};this.setJqItem=function(l){G=l};this.getJqItem=function(){return G};this.setSource=
function(l){q=l};this.getSource=function(){return q};this.getFunConnectSource=function(){return k};this.protectedMethod={setFunConnectSource:function(l){k=l},getFunFailCallback:function(){return v}}}function Da(){ya.call(this)}function va(){ya.call(this);var G=this;this.protectedMethod.setFunConnectSource(function(){K.SourceConnectStep.checkModelSetSourceConnect(G.getSource(),G.getJqItem());K.SourceConnectStep.clearTableAreaSearchBox()})}function I(){ya.call(this);var G=this.protectedMethod,q=this;
G.setFunConnectSource(function(){K.SourceConnectStep.clearTableAreaSearchBox();G.getFunFailCallback()(q.getSource(),qa.SOURCE_EXCEPTION_DELETED_ERRORCODE)})}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&
(com.kingdee.bos.qing.modeler.designer={});var K=com.kingdee.bos.qing.modeler.designer;K.SourceArea=qa;K.TableArea=function(){var G,q,v,k,l,p,E,A,B,Y,ha,S,Ja,ca,Ga,$a,oa,W,Ta,Ca,ma,x,Na,ba={};this.getSearchBox=function(){return A};this.getJqTableTree=function(){return Y};this.setTableNodeCreator=function(R){Na=R};this.setGlobal=function(R){p=R};this.setRemoteImpl=function(R){k=R};this.setDragHandler=function(R){l=R};this.updateNodeStatus=function(R,wa){B&&B.updateExceptionNodeUi(R,wa)};this.getJqUi=
function(){if(!G){G=$("<div>");G.addClass("modeler-designer-workarea");G.addClass("modeler-designer-common-border");S=$("<div>");S.addClass("modeler-designer-workarea-title");ha=$("<span>");ha.addClass("modeler-designer-tablearea-title-text");ha.text(fa.get("table","\u8868"));S.append(ha);q=$("<div>");q.addClass("modeler-designer-workarea-container");var R=$("<div>"),wa=$("<div>");wa.text(fa.get("customSQL","\u81ea\u5b9a\u4e49SQL/KSQL"));wa.attr("title",fa.get("customSQL","\u81ea\u5b9a\u4e49SQL/KSQL"));
var Ia=$("<div>");H.backgroundWithHover(Ia,"add");R.append(wa);R.append(Ia);ua.layoutCtrlWithLRTB(R,0,0,null,null,0,25);ua.layoutCtrlWithLRTB(wa,5,null,170,5,0,18);ua.layoutCtrlWithLRTB(Ia,null,0,18,5,0,18);ua.makeTextOmissible(wa);R.css({"border-top":"1px solid #e5e5e5"});Ia.css({cursor:"pointer"});Ia.on("click",Xa);x=R;x.hide();q.append(x);q.appendTo(G);da();G.append(S)}return G};this.setSource=function(R){R&&R!=v&&(v=R);ba[R]=void 0;U()};this.setExceptionSource=function(R,wa){$a=new Date;R&&R!=
v&&(v=R);ba[v]=wa;La();Y&&Y.remove();W&&W.hide();T(R,wa)};var Ea=function(R,wa){Y&&Y.remove();wa?(B=new Ma(R),B.setSearchClearCallBack(function(){A&&A.clear()})):B=new Ya(R);B.setUserSqlDeleteListener(Qa);B.setUserSqlEditListener(V);Y=B.getJqUi();Y.appendTo(q);eb(!1)},Xa=function(){if(ba[v])return ja(ba[v],!1),!0;if(ta()&&!Ta.getSelectPair())p.getMessageCurtain().showPrompt(fa.get("chooseAppWarn","\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u5e94\u7528\u3002"));else{var R=new ra(k,function(Ia){var db=new C;
db.setSourceUid(v.getId());var nb=K.UIDHelper.getUID(K.UIDHelper.NS_TABLE);db.setUid(nb);ta()&&db.setNamespace(Ta.getSelectPair().value);Ia=new Oa(k,!1,Ia);Ia.setModel(db);Ia.setSource(v);Ia.setTableNameChecker(pa);Ia.setPermAndConnChecker(Ka);Ia.addConfirmListener(function(hb,Za){var kb=p.getModelerModel(),pb=new xa;pb.setValue(hb,Za,kb,y);p.getCommandManager().perform(pb);p.getMessageCurtain().showSuccess(fa.get("CreateSQLSuccess","\u65b0\u5efa\u81ea\u5b9a\u4e49SQL\u6210\u529f\u3002"))});Ia.showDialog()},
function(Ia){ja(Ia+"",!1);return!0});if(Ta&&Ta.getSelectPair())var wa=Ta.getSelectPair().value;R.checkKSQLSupport(v.getSourceId(),wa)}},ja=function(R,wa){switch(R){case qa.PUBLIC_SOURCE_IS_DELETED_ERRORCODE:case qa.SOURCE_CONNECT_FAILED_ERRORCODE:case qa.SOURCE_EXCEPTION_DELETED_ERRORCODE:case qa.SOURCE_EXCEPTION_DELETED_ERRORCODE_1:wa?p.getMessageCurtain().showPrompt(fa.get("editSQLWithoutSource","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7f16\u8f91\u81ea\u5b9a\u4e49SQL/KSQL\u3002")):
p.getMessageCurtain().showPrompt(fa.get("createSQLWithoutSource","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u65b0\u5efa\u81ea\u5b9a\u4e49SQL/KSQL\u3002"));break;default:wa?p.getMessageCurtain().showPrompt(fa.get("editWithoutPerm","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u65e0\u6cd5\u7f16\u8f91\u81ea\u5b9a\u4e49SQL/KSQL\u3002")):p.getMessageCurtain().showPrompt(fa.get("createWithoutPerm","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u65e0\u6cd5\u65b0\u5efa\u81ea\u5b9a\u4e49SQL/KSQL\u3002"))}},
V=function(R){if(ba[v]||R.getErrorMessage())return ja(ba[v],!0),!0;var wa=new ra(k,function(db){var nb=new C;nb.setSourceUid(v.getId());nb.setTableName(R.getName());nb.setUserSql(R.getUserSql());ta()&&nb.setNamespace(R.getCommentInfo());nb=p.getModelerModel().getSameTable(nb).clone();db=new Oa(k,!0,db);db.setModel(nb);db.setSource(v);db.setTableNameChecker(pa);db.setPermAndConnChecker(Ka);db.addConfirmListener(function(hb,Za){var kb=p.getModelerModel(),pb=new xa;pb.setValue(hb,Za,kb,y);p.getCommandManager().perform(pb);
p.getMessageCurtain().showSuccess(fa.get("EditSQLSuccess","\u7f16\u8f91\u81ea\u5b9a\u4e49SQL\u6210\u529f\u3002"))});db.showDialog()},function(db){ja(db+"",!0);return!0});if(Ta&&Ta.getSelectPair())var Ia=Ta.getSelectPair().value;wa.checkKSQLSupport(v.getSourceId(),Ia)},Ka=function(R,wa,Ia){var db=fa.get("createWithoutPerm","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u65e0\u6cd5\u65b0\u5efa\u81ea\u5b9a\u4e49SQL/KSQL\u3002");Ia&&(db=fa.get("editWithoutPerm","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u65e0\u6cd5\u7f16\u8f91\u81ea\u5b9a\u4e49SQL/KSQL\u3002"));
(new ra(k,function(nb){nb?R():(wa(),p.getMessageCurtain().showPrompt(db))},function(){wa();p.getMessageCurtain().showPrompt(db);return!0})).checkUserSqlSourcePermission(v.getSourceId())},Qa=function(R,wa){var Ia=new h;Ia.setText(fa.get("ConfirmDeleteSQL","\u786e\u5b9a\u5220\u9664\u8be5\u81ea\u5b9a\u4e49SQL\u5417\uff1f"));Ia.setConfirmedListener(function(db){if(db){db=new C;db.setSourceUid(v.getId());db.setTableName(R.getName());db.setUserSql(R.getUserSql());ta()&&db.setNamespace(R.getCommentInfo());
var nb=p.getModelerModel();if(nb.isUserSqlTableInUse(db))p.getMessageCurtain().showPrompt(fa.get("customSQLUsedInDesign","\u8be5\u81ea\u5b9a\u4e49SQL/KSQL\u5df2\u88ab\u6570\u636e\u8868\u6a21\u578b\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u7a97\u53e3\u5220\u9664\u3002"));else{var hb=new za;hb.setValue(db,nb,y);p.getCommandManager().perform(hb);p.getMessageCurtain().showSuccess(fa.get("DeleteSQLSuccess","\u5220\u9664\u81ea\u5b9a\u4e49SQL\u6210\u529f\u3002"))}}});Ia.show(wa,!1)},ea=function(){W&&
W.hide();E&&E.hide();ca&&ca.hide();Y&&Y.remove();eb(!0);if(Ga)P(),Ga.show();else{Ga=$("<div>");Ga.addClass("modeler-designer-tablearea-notable-view");Ga.appendTo(q);var R=$("<div>");H.background(R,"no_data_cloud");R.addClass("modeler-designer-tablearea-notable-icon");R.appendTo(Ga);Ca=$("<div>");Ca.addClass("modeler-designer-tablearea-notable-text");P();Ca.appendTo(Ga)}},P=function(){switch(v.getSourceType()){case J.SOURCE_TYPE_MODEL_SET_SOURCE:Ca.text(fa.get("noModelTip","\u6682\u65e0\u53ef\u7528\u7684\u6a21\u578b"));
break;default:Ca.text(fa.get("noTableTip","\u6682\u65e0\u53ef\u7528\u7684\u6570\u636e\u8868"))}},da=function(){E||(A=new n,A.setSearchListenerDelay(1E3),A.addSearchListener(function(){B&&B.doSearch($.trim(A.getText()),function(){A.clear()})}),A.setShowSearchIcon(!0),A.setPlaceholder(fa.get("searchTable","\u8bf7\u8f93\u5165\u641c\u7d22\u5185\u5bb9")),E=A.getJqUi(),E.addClass("modeler-designer-tablearea-search-box"),E.find(":input").on("keydown",function(R){13==(R.keyCode||R.which||R.charCode)&&B&&
B.doSearch($.trim(A.getText()))}));E.appendTo(q)},pa=function(R,wa){for(var Ia=Va(),db=[],nb=0;nb<Ia.length;nb++)db.push(Ia[nb].getName());wa&&db.splice(db.indexOf(wa),1);return-1<db.indexOf(R)},Va=function(){for(var R=p.getModelerModel().getUserSqlTables(v.getId()),wa=[],Ia=0;Ia<R.length;Ia++){var db=R[Ia];if(!ta()||Ta.getSelectPair()&&Ta.getSelectPair().value&&db.getNamespace()==Ta.getSelectPair().value){var nb=new X;nb.setName(db.getTableName());nb.setDisplayName(db.getTableName());nb.setUserSql(db.getUserSql());
nb.setCommentInfo(db.getNamespace());wa.push(nb)}}return wa},cb=function(R){for(var wa=Va(),Ia=0;Ia<wa.length;Ia++)R.getChildren().push(wa[Ia])},y=function(R){Y&&Y.remove();var wa=ba[v];if(wa)T(v,wa);else{0<$.trim(A.getText()).length&&A.clear();wa=new N;var Ia=ta();Ia?Ta.getSelectPair()&&Ta.getSelectPair().value&&wa.fromJsonObject(ma,Ta.getSelectPair().value):wa.fromJsonObject(ma);cb(wa);Ea(wa,Ia);l.bindDragUi(Y,Pa);Ia&&Y.css("top","65px");R&&B.scrollNodeToVisibleByName(R.getTableName())}},T=function(R,
wa){for(var Ia=ta(),db=p.getModelerModel().getAllTable(),nb=[],hb=0;hb<db.length;hb++)R.getId()===db[hb].getSourceUid()&&nb.push(db[hb]);if(nb&&0<nb.length){switch(wa){case qa.SOURCE_EXCEPTION_DELETED_ERRORCODE:var Za=fa.get("tableNotExist","\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664");break;case qa.PUBLIC_SOURCE_IS_DELETED_ERRORCODE:case qa.PUBLIC_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:case qa.DATACENTER_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:case qa.SOURCE_CONNECT_FAILED_ERRORCODE:Za=
fa.get("tableCanNotUse","\u8be5\u6570\u636e\u6e90\u4e0b\u7684\u8868\u5747\u65e0\u6cd5\u4f7f\u7528")}R=new N;db=R.getChildren();for(hb=0;hb<nb.length;hb++){var kb=new X;kb.setName(nb[hb].getTableName());kb.setDisplayName(nb[hb].getTableName());kb.setUserSql(nb[hb].getUserSql());Za&&kb.setErrorMessage(Za);db.push(kb)}Ea(R,Ia);Ja&&Ja.remove();switch(wa){case qa.PUBLIC_SOURCE_IS_DELETED_ERRORCODE:case qa.PUBLIC_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:case qa.DATACENTER_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:case qa.SOURCE_CONNECT_FAILED_ERRORCODE:var pb=
fa.get("sourceCanNotUse","\u8be5\u6570\u636e\u6e90\u65e0\u6cd5\u4f7f\u7528\uff0c\u4ec5\u5c55\u793a\u5728\u6a21\u578b\u8bbe\u8ba1\u4e2d\u5df2\u4f7f\u7528\u7684\u8868\u3002");break;case qa.CURRENT_USER_NOPERMISSION_PUBLIC_SOURCE_ERRORCODE:case qa.CURRENT_USER_NOPERMISSION_DATACENTER_ERRORCODE:pb=fa.get("showUsedTable","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u4ec5\u5c55\u793a\u5728\u6a21\u578b\u8bbe\u8ba1\u4e2d\u5df2\u4f7f\u7528\u7684\u8868\u3002")}pb&&(Ja=D.createExceptionIcon(pb),
Ja.addClass("modeler-designer-tablearea-title-exception-icon"),Ja.appendTo(S));E&&E.show()}else switch(Ja&&Ja.remove(),wa){case qa.MODELSET_SOURCE_ALL_MODEL_CANCEL_DEPLOY_ERRORCODE:case qa.SOURCE_EXCEPTION_DELETED_ERRORCODE:case qa.PUBLIC_SOURCE_IS_DELETED_ERRORCODE:case qa.SOURCE_CONNECT_FAILED_ERRORCODE:ea();break;case qa.CURRENT_USER_NOPERMISSION_DATACENTER_ERRORCODE:case qa.CURRENT_USER_NOPERMISSION_PUBLIC_SOURCE_ERRORCODE:case qa.DATACENTER_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:case qa.PUBLIC_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:W&&
W.hide(),E&&E.hide(),Ga&&Ga.hide(),eb(!0),ca?ca.show():(ca=$("<div>"),ca.addClass("modeler-designer-tablearea-nopermission-view"),ca.appendTo(q),wa=$("<div>"),wa.addClass("modeler-designer-tablearea-nopermission-icon"),H.background(wa,"no-permission"),wa.appendTo(ca),wa=$("<div>"),wa.addClass("modeler-designer-tablearea-nopermission-text"),wa.text(fa.get("noPermission","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650")),wa.appendTo(ca))}},U=function(){var R=new Date;$a=R;
if(ta())Y&&Y.remove(),Fa();else{W&&W.hide();var wa=new ra(k,function(Ia){if($a===R){ma=Ia;var db=new N;db.fromJsonObject(Ia);cb(db);0===db.getChildren().length?ea():(Ea(db,!1),l.bindDragUi(Y,Pa))}});wa.setBlockingJqUi(q);v.setModelId(K.ModelSetSourceIntegration.getModelId());wa.loadTables(v)}La();Ja&&Ja.remove();ca&&ca.hide();Ga&&Ga.hide();E.show()},Fa=function(){eb();W?(W.show(),Sa()):(Ta=new (K.ModelSetSourceIntegration.getDataCenterSelector()),W=Ta.getJqUi(),W.appendTo(q),oa=Ta.getTextField(),
Ta.setFunSelectedChangeListener(function(R){(new ra(k,function(wa){var Ia=new N;Ia.fromJsonObject(wa,R);ma=wa;cb(Ia);Ea(Ia,!0);Y.css("top","65px");l.bindDragUi(Y,Pa)})).getDBCenterTables(R)}))},Sa=function(){var R=Ta.getSelectPair();R&&(oa.setText(R.text),Ta.getFunSelectedChangeListener()(R.value))},La=function(){switch(v.getSourceType()){case J.SOURCE_TYPE_MODEL_SET_SOURCE:ha.text(fa.get("model","\u6a21\u578b"));break;case J.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:ha.text(fa.get("entity","\u5b9e\u4f53"));
break;case J.SOURCE_TYPE_MODELSET_FILE_SOURCE:ha.text(fa.get("table","\u8868"));break;default:ha.text(fa.get("table","\u8868"))}},eb=function(R){if(R)x&&x.hide(),Y&&Y.css("bottom","1px");else switch(v.getSourceType()){case J.SOURCE_TYPE_MODEL_SET_SOURCE:case J.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:case J.SOURCE_TYPE_MODELSET_FILE_SOURCE:x.hide();Y&&Y.css("bottom","1px");break;default:x.show(),Y&&Y.css("bottom","30px")}},ta=function(){return v.getSourceType()===J.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE},
Pa=function(R){var wa=R.parent();if(wa&&wa.hasClass("sa-ctrl-tree-nodeline")){var Ia=wa.data("model").getUserObject();Ia instanceof X&&wa.addClass("modeler-designer-tablearea-table-item")}else wa&&wa.hasClass("modeler-designer-tablearea-dbCenter")?(R.addClass("modeler-designer-tablearea-table-item"),(Ia=R.data("model"))&&B.setSelectedNode(Ia)):R.hasClass("modeler-designer-tablearea-table-icon")||R.hasClass("modeler-designer-tablearea-table-name")?(wa=R.parents(".sa-ctrl-tree-nodeline"),Ia=wa.data("model").getUserObject(),
Ia instanceof X&&wa.addClass("modeler-designer-tablearea-table-item")):R.hasClass("modeler-designer-tablearea-dbCenter-table-icon")||R.hasClass("modeler-designer-tablearea-dbCenter-table-name")?(wa=R.parents(".modeler-designer-tablearea-dbCenter-item"),(Ia=wa.data("model"))&&B.setSelectedNode(Ia),wa.addClass("modeler-designer-tablearea-table-item")):R.hasClass("sa-ctrl-tree-nodeline")&&(Ia=R.data("model").getUserObject(),Ia instanceof X&&R.addClass("modeler-designer-tablearea-table-item"));return ua.upwardSearchHasClass(R,
Y,"modeler-designer-tablearea-table-item")?(R=new C,R.setSourceUid(v.getId()),R.setTableName(Ia.getName()),Ia.getCommentInfo()&&R.setNamespace(Ia.getCommentInfo()),Ia.getName()&&R.setTableName(Ia.getName()),Ia.getDisplayName()&&R.setDisplayName(Ia.getDisplayName()),Ia.getUserSql()&&R.setUserSql(Ia.getUserSql()),(wa=p.getModelerModel().getSameTable(R))?(!1!==Ia.getDisableDrag()?wa.setDisableDrag(!0):wa.setDisableDrag(!1),R=wa):(!1!==Ia.getDisableDrag()?R.setDisableDrag(!0):R.setDisableDrag(!1),Ia=
K.UIDHelper.getUID(K.UIDHelper.NS_TABLE),R.setUid(Ia)),Ia=Na(R),wa=new ka,wa.setTableNode(Ia),wa.setTable(R),wa):null}};K.SourceListPanel=ib;var J=K.AbstractModelerSource,X=K.LeafNode,Z=K.DesignTimeSource,ra,N,g,ka,C,ia,M,la,na,xa,za,aa,Aa,ua,fa,u,F,Q,r,w,L,n,t,a,c,m,b,d,h,O,f,e,z;var H=K.Icons;(function(){var G=com.kingdee.bos.qing.framework.common;fa=G.MultilanguageManager.createPackageAccessor(K);u=G.WindowResizeObserver;G=com.kingdee.bos.qing.common;ua=G.DomUtil;a=G.DateFormater;G=com.kingdee.bos.qing.ui.component;
Q=G.AbstractModalDialog;F=G.Button;r=G.RadioButtonGroup;w=G.RadioButton;L=G.List;n=G.SearchBox;c=G.CheckBox;m=G.Tree;b=G.HelpIcon;d=G.MessageDialog;h=G.SimpleConfirmer;O=G.Label;f=G.TextField;e=G.TextArea;z=G.DynamicScroller;G=com.kingdee.bos.qing.common.ui;t=G.TableUtil;ra=K.DesignerFacade;N=K.FolderNode;g=K.ModelerModel;ka=K.DraggingTableNode;C=K.Table;ia=K.UserSQL;M=K.ModelSetDataSource;la=K.ActionRemoveSource;na=K.ActionAddRemoveSource;xa=K.ActionAddUserSqlTable;za=K.ActionRemoveUserSqlTable;
aa=K.UserOperationReporter;Aa=K.AbstractInvalidityCase})();qa.CURRENT_USER_NOPERMISSION_DATACENTER_ERRORCODE="20002101";qa.CURRENT_USER_NOPERMISSION_PUBLIC_SOURCE_ERRORCODE="20002102";qa.PUBLIC_SOURCE_IS_DELETED_ERRORCODE="20002103";qa.PUBLIC_SOURCE_CREATOR_NOPERMISSION_ERRORCODE="20002104";qa.DATACENTER_SOURCE_CREATOR_NOPERMISSION_ERRORCODE="20002105";qa.MODELSET_SOURCE_ALL_MODEL_CANCEL_DEPLOY_ERRORCODE="20002106";qa.SOURCE_CONNECT_FAILED_ERRORCODE="2025008";qa.SOURCE_EXCEPTION_DELETED_ERRORCODE=
"2025009";qa.SOURCE_EXCEPTION_DELETED_ERRORCODE_1="20001004";var D=new function(){var G=this;this.translateSourceType=function(q){switch(q){case J.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:return fa.get("currentEntity","\u91d1\u8776\u4e91\u00b7\u82cd\u7a79-\u4e1a\u52a1\u5b9e\u4f53");case J.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE:return fa.get("currentDataCenter","\u91d1\u8776\u4e91\u00b7\u82cd\u7a79-\u6570\u636e\u4e2d\u5fc3");case J.SOURCE_TYPE_MODELSET_DB_SOURCE:return fa.get("modelSetDBSource","\u6570\u636e\u5e93");
case J.SOURCE_TYPE_PUBLIC_DATA_SOURCE:return fa.get("publicDBSource","\u516c\u5171\u6570\u636e\u6e90-\u6570\u636e\u5e93");case J.SOURCE_TYPE_MODEL_SET_SOURCE:return fa.get("modelSet","\u6a21\u578b\u96c6");case J.SOURCE_TYPE_MODELSET_FILE_SOURCE:return fa.get("modelSetFile","\u6587\u4ef6");case J.SOURCE_TYPE_OPEN_API_SOURCE:return fa.get("openAPI","OpenAPI")}};this.createExceptionIcon=function(q){var v=$("<div>");H.background(v,"qingWarning");v.attr("title",q);return v};this.createSourceNameByType=
function(q){var v;q===J.SOURCE_TYPE_CURRENT_ENTITY_SOURCE?v=fa.get("businessEntity","\u4e1a\u52a1\u5b9e\u4f53"):q===J.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE&&(v=fa.get("dataCenter","\u6570\u636e\u4e2d\u5fc3"));return v};this.getSourceIconName=function(q){switch(q){case J.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:return"entity";case J.SOURCE_TYPE_MODEL_SET_SOURCE:return"modelSet";case J.SOURCE_TYPE_MODELSET_FILE_SOURCE:return"file";case J.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE:return"data-center";case J.SOURCE_TYPE_OPEN_API_SOURCE:return"openapi";
default:return"data"}};this.updateSourceItemStatus=function(q,v,k){var l=q.children(".modeler-designer-sourcearea-exception-icon"),p=q.children(".modeler-designer-sourcearea-icon"),E=q.children(".modeler-designer-sourcearea-name"),A=12,B=34;l&&l.remove();v||(l=G.createExceptionIcon(k),l.addClass("modeler-designer-sourcearea-exception-icon"),l.appendTo(q),A+=22,B+=22);p.css("left",A+"px");E.css("left",B+"px")};this.updateDeletedSourceStatus=function(q){var v=G.createExceptionIcon(fa.get("sourceExceptionDeleted",
"\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002"));v.addClass("modeler-designer-sourcearea-exception-icon");v.appendTo(q);v=q.children(".modeler-designer-sourcearea-icon");v.length?(v.css("left","34px"),v=q.children(".modeler-designer-sourcearea-name"),v.css("left","56px")):(v=$("<div>"),v.addClass("modeler-designer-sourcearea-name"),v.text(fa.get("theSourceIsDeleted","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664")),v.css("left","34px"),v.appendTo(q))};
this.getModelExceptionTips=function(q){if(!q)return null;switch(q){case Aa.TYPE_MODEL_DELETED:return fa.get("modelDeleted","\u8be5\u6a21\u578b\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");case Aa.TYPE_MODEL_NO_DATA_PERMISSION:return fa.get("modelNoPermission","\u60a8\u672a\u88ab\u6388\u6743\u4f7f\u7528\u8be5\u6a21\u578b\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");case Aa.TYPE_MODEL_INCOMPLETE:return fa.get("modelNoComplete","\u8be5\u6a21\u578b\u8bbe\u7f6e\u4e0d\u5b8c\u6574\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");
case Aa.TYPE_MODEL_DAMAGE:return fa.get("modelBad","\u8be5\u6a21\u578b\u5df2\u635f\u574f\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");case Aa.TYPE_MODEL_CYCLE_REFERENCE:return fa.get("modelCycleRef","\u8be5\u6a21\u578b\u4e0e\u5f53\u524d\u6a21\u578b\u5b58\u5728\u5faa\u73af\u5f15\u7528\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");case Aa.TYPE_TABLE_NOT_EXISTS:return fa.get("tableNotExistCantUse","\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002")}}};
K.SourceConnectStep=new function(){var G,q,v;this.setGlobal=function(l){G=l};this.setRemoteImpl=function(l){q=l};this.setSourceArea=function(l){};this.setTableArea=function(l){v=l};this.removeTableTree=function(){var l=v.getJqTableTree();l&&l.remove()};this.clearTableAreaSearchBox=function(){v.getSearchBox().clear()};this.getExeSourceChangeCallback=function(){return v.setExceptionSource};var k=function(l,p,E){var A=G.getIntegration().getMapSourcePermission();p?A&&(A[l]=null):(p={},p.errorMessage=
E,A&&(A[l]=p))};this.checkModelSetSourceConnect=function(l,p){(new ra(q,function(E){var A=E?!1:!0;D.updateSourceItemStatus(p,A,E);v.setSource(l);k(l.getSourceId(),A,E)},function(E){if(20001004===E)return p.data("errorCode",qa.SOURCE_EXCEPTION_DELETED_ERRORCODE),v.setExceptionSource(l,qa.SOURCE_EXCEPTION_DELETED_ERRORCODE),D.updateDeletedSourceStatus(p),!0})).checkModelSetSourceConnect(l.getSourceId())};this.checkSourceConnectivity=function(l,p){(new ra(q,function(E){if(E)v.setSource(l);else{var A=
fa.get("sourceConnectFailed","\u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");v.setExceptionSource(l,qa.SOURCE_CONNECT_FAILED_ERRORCODE)}k(l.getSourceId(),E,A);D.updateSourceItemStatus(p,E,A)},function(E,A){var B=E.toString();if(20001004===E)p.data("errorCode",qa.SOURCE_EXCEPTION_DELETED_ERRORCODE),v.setExceptionSource(l,qa.SOURCE_EXCEPTION_DELETED_ERRORCODE),D.updateDeletedSourceStatus(p);else{var Y="206"==B.substr(0,3)?fa.get("openAPIConnectFailed","OpenAPI\u7684\u8fde\u63a5\u4fe1\u606f\u65e0\u6548\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002"):
-1!=A.indexOf("2030900")?fa.get("xmlParseFailed","xml\u6587\u4ef6\u5904\u7406\u5931\u8d25\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002"):fa.get("sourceConnectFailed","\u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");v.setExceptionSource(l,qa.SOURCE_CONNECT_FAILED_ERRORCODE)}Y&&(k(l.getSourceId(),!1,Y),D.updateSourceItemStatus(p,!1,Y));return!0})).checkConnection(l.getSourceId())}};K.ConnectSourceCreator=new function(){var G;this.getSourceConnector=function(q,
v){if(!G){G={};var k=new va,l=new Da;G[J.SOURCE_TYPE_MODEL_SET_SOURCE]=k;G[J.SOURCE_TYPE_PUBLIC_DATA_SOURCE]=l;G[J.SOURCE_TYPE_MODELSET_DB_SOURCE]=l;G[J.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE]=l;G[J.SOURCE_TYPE_CURRENT_ENTITY_SOURCE]=l;G[J.SOURCE_TYPE_MODELSET_FILE_SOURCE]=l;G[J.SOURCE_TYPE_OPEN_API_SOURCE]=l}k=(k=q.getSourceType())?G[k]:new I;k.setSource(q);k.setJqItem(v);return k}};K.ModelSetSourceIntegration=new function(){var G,q,v,k,l,p;this.setModelId=function(E){p=E};this.getModelId=function(){return p};
this.setDataSourceManageEntrance=function(E){G=E};this.getDataSourceManageEntrance=function(){return G};this.setRemoteImpl=function(E){q=E};this.getRemoteImpl=function(){return q};this.registerDataCenterSelectorConstructor=function(E){v=E};this.getDataCenterSelector=function(){return v};this.registerMetricDataCenterSelector=function(E){k=E};this.getMetricDataCenterSelector=function(){return k};this.setModelSetSourceFacade=function(E){l=E};this.getModelSetSourceFacade=function(){return l}}})();(function(){function qa(){fa.call(this);var n=this,t=this.protectedMethod,a=[],c=[],m=[],b=[],d=[];n.setType(fa.TYPE_METRIC_MODELER);n.setMaterializedConfig(new L);this.protectedIsTableInUse=function(f){return!0};this.isTableReferred=function(f){h();for(var e=0;e<b.length;e++){var z=b[e];if(z instanceof ya&&z.getTableId()==f.getUid())return!0}for(e=0;e<a.length;e++){z=a[e].getFilterItems();for(var H=0;H<z.length;H++){var D=z[H].getField();if(D&&D.getTableId()==f.getUid())return!0}}return!1};this.getAllDimension=
function(){return c};this.setDimensions=function(f){c=f};this.addDimension=function(f,e){isNaN(e)?c.push(f):c.splice(e,0,f);t.firePropertyChangeEvt(qa.KEY_ADD_DIMENSION,f)};this.removeDimension=function(f){for(var e=0;e<c.length;e++)if(c[e].isSame(f))return c.splice(e,1),t.firePropertyChangeEvt(qa.KEY_REMOVE_DIMENSION,[f]),e;return-1};this.updateDimension=function(f,e){if(isNaN(e))return!1;c.splice(e,1);c.splice(e,0,f);t.firePropertyChangeEvt(qa.KEY_UPDATE_DIMENSION,c)};this.updateDimensions=function(f){c=
f;t.firePropertyChangeEvt(qa.KEY_BATCH_UPDATE_DIMENSION,f)};this.getDimensionById=function(f){for(var e=0;e<c.length;e++)if(c[e].getDimensionId()==f)return c[e]};this.getDimensionByName=function(f){for(var e=0;e<c.length;e++)if(c[e].getName()==f)return c[e]};this.getPublicDimensions=function(){return m};this.getPublicDimensionById=function(f){for(var e=0;e<m.length;e++)if(m[e].getId()==f)return m[e]};this.getSamePublicDimension=function(f){for(var e=0;e<m.length;e++){var z=m[e];if(z.isSame(f))return z}};
this.setPublicDimensions=function(f){m=f};this.removePublicDimensionById=function(f){for(var e=0;e<m.length;e++)if(m[e].getId()==f)return m.splice(e,1),e;return-1};this.addPublicDimension=function(f,e){isNaN(e)?m.push(f):m.splice(e,0,f)};this.checkDimensionRef=function(f,e){var z=n.getAllTable();if(e&&2<=z.length)return!0;for(e=0;e<c.length;e++)if(c[e].getPublicDimensionId()==f)return!0;return!1};this.checkTableExist=function(f){for(var e=n.getAllTable(),z=0;z<e.length;z++)if(f==e[z].getUid())return!0;
return!1};this.setMetrics=function(f){if((a=f)&&0<a.length)for(f=0;f<a.length;f++){var e=a[f];e.removePropertyChangeCallback(t.firePropertyChangeEvt);e.addPropertyChangeCallback(t.firePropertyChangeEvt)}};this.addMetric=function(f,e){isNaN(e)?a.push(f):a.splice(e,0,f);f.addPropertyChangeCallback(t.firePropertyChangeEvt);t.firePropertyChangeEvt(qa.KEY_ADD_METRIC,f)};this.removeMetric=function(f){var e=a.indexOf(f);return-1<e?(a.splice(e,1),t.firePropertyChangeEvt(qa.KEY_REMOVE_METRIC,f),f.removePropertyChangeCallback(t.firePropertyChangeEvt),
e):-1};this.updateMetric=function(f){var e=n.getMetric(f.getId());e&&(e.update(f),t.firePropertyChangeEvt(qa.KEY_UPDATE_METRIC,e))};this.getAllMetric=function(){return a};this.getMetric=function(f){for(var e=0;e<a.length;e++){var z=a[e];if(z.getId()==f)return z}};this.setExprReferences=function(f){b=f};this.setUnreferencedRef=function(f){d=f};this.getExprReferences=function(){return b};this.getExprReference=function(f){for(var e=0;e<b.length;e++){var z=b[e];if(f==z.getId())return z}};this.addExprRefIfNotExist=
function(f){for(var e=0;e<b.length;e++){var z=b[e];if(z.equals(f))return z}for(e=0;e<d.length;e++)if(z=d[e],z.equals(f)){f=z;d.splice(e,1);break}b.push(f);return f};this.protectedToJsonObject=function(f){for(var e=[],z=0;z<a.length;z++)e.push(a[z].toJsonObject());f.metrics=e;h();e=[];for(z=0;z<b.length;z++)e.push(b[z].toJsonObject());f.references=e;e=[];for(z=0;z<d.length;z++)e.push(d[z].toJsonObject());f.unreferencedRef=e;e=[];for(z=0;z<c.length;z++)e.push(c[z].toJsonObject());f.dimensions=e;e=[];
for(z=0;z<m.length;z++)m[z].isEmpty()||e.push(m[z].toJsonObject());f.publicDimensions=e;n.getMaterializedConfig()||(z=new L,f.materializedConfig=z.toJsonObject())};this.protectedFromJsonObject=function(f){var e=f.metrics;if(e)for(var z=0;z<e.length;z++){var H=new Ua;H.fromJsonObject(e[z]);H.addPropertyChangeCallback(t.firePropertyChangeEvt);a.push(H)}if(e=f.references)for(z=0;z<e.length;z++){H=e[z];switch(H.type){case Ma.FIELD_TYPE:var D=new ya;break;case Ma.METRIC_TYPE:D=new Da;break;case Ma.DIMENSION_TYPE:D=
new va;break;default:throw Error("unknown type");}D.fromJsonObject(H);b.push(D)}if(e=f.dimensions)for(z=0;z<e.length;z++)H=new Oa,H.fromJsonObject(e[z]),c.push(H);if(f=f.publicDimensions)for(z=0;z<f.length;z++)e=new ib,e.fromJsonObject(f[z]),m.push(e);e=O();z=[];for(f=0;f<e.length;f++)H=e[f],n.getExprReference(H)||z.push(H);for(f=0;f<z.length;f++)for(e=z[f],H=0;H<a.length;H++){D=a[H];var G=D.getExpr();D.setExpr(ua.ExprRefHelper.replaceRefText(G,e,""))}};this.copyMetrics=function(){for(var f=[],e=
0;e<a.length;e++){var z=a[e].clone();f.push(z)}return f};this.copyExprReferences=function(){for(var f=[],e=0;e<b.length;e++){var z=b[e].copy();f.push(z)}return f};this.copy=function(){var f=new qa;t.copy(f);for(var e=[],z=0;z<a.length;z++)e.push(a[z].clone());f.setMetrics(e);e=[];for(z=0;z<c.length;z++)e.push(c[z].copy());f.setDimensions(e);e=[];for(z=0;z<m.length;z++)e.push(m[z].copy());f.setPublicDimensions(e);e=[];for(z=0;z<b.length;z++)e.push(b[z].copy());f.setExprReferences(e);e=[];for(z=0;z<
d.length;z++)e.push(d[z].copy());f.setUnreferencedRef(e);return f};var h=function(){for(var f=O(),e=[],z=[],H=0;H<b.length;H++){var D=b[H];-1<f.indexOf(D.getId())?e.push(D):z.push(D)}b=e;d=z},O=function(){for(var f=[],e=0;e<a.length;e++){var z=a[e].getExpr();(z=ua.ExprRefHelper.getRefTextInExpr(z))&&(f=f.concat(z))}return f}}function Ua(){var n=this,t,a,c,m,b,d="#,##0.00",h=[],O=[];this.addPropertyChangeCallback=function(f){O.push(f)};this.removePropertyChangeCallback=function(f){f=O.indexOf(f);-1<
f&&O.splice(f,1)};this.setNumber=function(f){t=f};this.getNumber=function(){return t};this.setId=function(f){a=f};this.getId=function(){return a};this.setName=function(f){c=f};this.getName=function(){return c};this.setDesc=function(f){m=f};this.getDesc=function(){return m};this.setExpr=function(f){b=f};this.getExpr=function(){return b};this.setFormat=function(f){d=f};this.getFormat=function(){return d};this.setFilterItems=function(f){h=f;f=qa.KEY_SET_METRIC_FILTER;for(var e=0,z=O.length;e<z;e++)O[e](f,
n)};this.getFilterItems=function(){return h};this.update=function(f){t=f.getNumber();b=f.getExpr();c=f.getName();m=f.getDesc();f.getFormat()&&(d=f.getFormat());h=f.getFilterItems()};this.clone=function(){var f=new Ua;f.setNumber(t);f.setId(a);f.setExpr(b);f.setName(c);f.setDesc(m);f.setFormat(d);for(var e=[],z=0;z<h.length;z++){var H=h[z].copy();e.push(H)}f.setFilterItems(e);return f};this.equals=function(f){if(f.getName()!==c||f.getDesc()!==m||f.getExpr()!==b||f.getFormat()!==d||f.getNumber()!==
t||h.length!==f.getFilterItems().length)return!1;f=f.getFilterItems();for(var e=0;e<h.length;e++)if(!h[e].equals(f[e]))return!1;return!0};this.toJsonObject=function(){var f={};f.number=t;f.id=a;f.name=c;f.desc=m;f.expr=b;f.format=d;for(var e=[],z=0;z<h.length;z++)e.push(h[z].toJsonObject());f.filterItems=e;return f};this.fromJsonObject=function(f){a=f.id;t=f.number;c=f.name;m=f.desc;b=f.expr;f.format&&(d=f.format);if(f=f.filterItems)for(var e=0;e<f.length;e++){var z=new w;z.fromJsonObject(f[e]);h.push(z)}}}
function Oa(){var n,t,a,c=!1,m=!1,b,d,h,O,f=this;this.setDimensionId=function(e){n=e};this.getDimensionId=function(){return n};this.setName=function(e){t=e};this.getName=function(){return t};this.setNumber=function(e){a=e};this.getNumber=function(){return a};this.setNumberModified=function(e){c=e};this.isNumberModified=function(){return c};this.setNameModified=function(e){m=e};this.isNameModified=function(){return m};this.setDimensionType=function(e){b=e};this.getDimensionType=function(){return b};
this.setDateFormat=function(e){d=e};this.getDateFormat=function(){return d};this.setRequired=function(e){h=e};this.isRequired=function(){return h};this.getPublicDimensionId=function(){return O};this.setPublicDimensionId=function(e){O=e};this.copy=function(){var e=new Oa;e.setDimensionId(n);e.setName(t);e.setNumber(a);e.setNumberModified(c);e.setNameModified(m);e.setDimensionType(b);d?e.setDateFormat(d):b==Oa.TYPE_DATE&&e.setDateFormat(Oa.VALUE_YYYY);e.setRequired(h);e.setPublicDimensionId(O);return e};
this.isSame=function(e){return e?t==e.getName()&&a==e.getNumber()&&c==e.isNumberModified()&&m==e.isNameModified()&&b==e.getDimensionType()&&n==e.getDimensionId()&&(d==e.getDateFormat()||null==d&&e.getDateFormat()==Oa.VALUE_YYYY)&&O==e.getPublicDimensionId()?!0:!1:!1};this.toJsonObject=function(){var e={};e.id=n;e.name=t;e.number=a;e.isNumberModified=c;e.isNameModified=m;e.dimensionType=b;e.dateFormatType=d;e.required=h;e.publicDimensionId=O;return e};this.fromJsonObject=function(e){n=e.id;t=e.name;
a=e.number;c=e.isNumberModified;m=e.isNameModified;b=e.dimensionType;void 0!=e.dateFormatType&&f.setDateFormat(e.dateFormatType);e.required&&f.setRequired(e.required);O=e.publicDimensionId}}function ib(){var n,t,a=!1,c=[];this.setId=function(b){n=b};this.getId=function(){return n};this.setName=function(b){t=b};this.getName=function(){return t};this.setNameModified=function(b){a=b};this.isNameModified=function(){return a};this.isSame=function(b){if(!b)return!1;b=b.getFields();if(b.length!=c.length)return!1;
for(var d=0;d<c.length;d++)if(!c[d].isSame(b[d]))return!1;return!0};this.getDataType=function(){return 0==c.length?null:c[0].getDataType()};this.setFields=function(b){c=b};this.addField=function(b){c.push(b)};this.insertField=function(b,d){c.splice(b,0,d)};this.getFields=function(){return c};this.getFieldByIndex=function(b){return c[b]};this.getLastField=function(){return c[c.length-1]};this.removeField=function(b){c.splice(b,1)};this.empty=function(b){t=null;b&&(n=null)};this.isEmpty=function(){return!t};
this.updateFields=function(b){for(var d=0;d<c.length;d++){var h=c[d];if(h&&h.getName()){var O=h.getTableId();O=b[O]?b[O]:[];for(var f=!1,e=0;e<O.length;e++)if(O[e]&&O[e].getName()==h.getName()){f=!0;h.update(O[e]);break}f||h.updateWhenNotExist();h.setExist(f)}}};this.isDataTypeConsistent=function(){if(0==c.length)return!1;var b=c[0];if(!b)return!1;for(var d=1;d<c.length;d++){var h=c[d];if(!h||b.getDataType()!=h.getDataType()||!m(b.getField(),h.getField()))return!1}return!0};this.tryGenerateId=function(b){var d=
!0;if(b){b=b.getFields();for(var h=0;h<c.length;h++){var O=b[h].getField().getFullName(),f=c[h].getField().getFullName();if(O==f){d=!1;break}}}else d=!1;if(!n||d)d=com.kingdee.bos.qing.modeler.designer.UIDHelper,n=d.getUID(d.NS_PUBLIC_DIMENSION)};this.tryGenerateName=function(b){if(0!=c.length){var d=c[0];t=a||!d.getAlias()?t:b()}};this.isFieldsCompleted=function(){for(var b=!1,d=0;d<c.length;d++)c[d].getName()&&(b=!0);if(!b&&!t)return!0;for(d=0;d<c.length;d++)if(b=c[d],!b.getName()||!b.isExist())return!1;
return!0};this.copy=function(){var b=new ib;b.setId(n);b.setName(t);for(var d=[],h=0;h<c.length;h++){var O=c[h].copy();d.push(O)}b.setFields(d);b.setNameModified(a);return b};this.toJsonObject=function(){var b={};b.id=n;b.name=t;b.isNameModified=a;for(var d=[],h=0;h<c.length;h++)d.push(c[h].toJsonObject());b.fields=d;return b};this.fromJsonObject=function(b){n=b.id;t=b.name;a=b.isNameModified;if(b=b.fields)for(var d=0;d<b.length;d++){var h=new Ya;h.fromJsonObject(b[d]);c.push(h)}};var m=function(b,
d){b=b?b.getEnumValue():null;d=d?d.getEnumValue():null;if(!b&&!d)return!0;if(!b&&d||b&&!d||Object.keys(d).length!=Object.keys(b).length)return!1;for(var h in d){var O=d[h],f=b[h];if(!f||f!=O)return!1}return!0}}function Ya(){var n=new Q,t=!0;this.getField=function(){return n};this.setField=function(a){n=a};this.setName=function(a){n.setName(a)};this.getName=function(){return n.getName()};this.getTableId=function(){return n.getTableId()};this.setTableId=function(a){n.setTableId(a)};this.getDataType=
function(){return n.getDataType()};this.setDataType=function(a){n.setDataType(a)};this.getAlias=function(){return n.getAlias()};this.setAlias=function(a){n.setAlias(a)};this.setExist=function(a){t=a};this.isExist=function(){return t};this.update=function(a){n=a};this.updateWhenNotExist=function(){var a=new Q;a.setName(n.getName());a.setTableId(n.getTableId());a.setAlias(n.getAlias());n=a};this.copy=function(){var a=new Ya;a.setField(n);a.setExist(t);return a};this.isSame=function(a){return n.getName()==
a.getName()&&n.getTableId()==a.getTableId()?!0:!1};this.toJsonObject=function(){var a={};a.name=n.getName();a.tableId=n.getTableId();a.alias=n.getAlias();return a};this.fromJsonObject=function(a){n.setName(a.name);n.setTableId(a.tableId);n.setAlias(a.alias)}}function Ma(){var n=this,t,a;this.setId=function(c){t=c};this.getId=function(){return t};this.setType=function(c){a=c};this.getType=function(){return a};this.getRefDisplayText=function(c){throw Error("override me");};this.isRightDisplayFormat=
function(c,m){throw Error("override me");};this.fromDisplayText=function(c,m,b){throw Error("override me");};this.equals=function(c){throw Error("override me");};this.fromJsonObject=function(c){t=c.id;a=c.type;n.protectedFromJsonObject(c)};this.toJsonObject=function(){var c={};c.id=t;c.type=a;n.protectedToJsonObject(c);return c};this.protectedFromJsonObject=function(c){};this.protectedToJsonObject=function(c){};this.protectedMethod={copy:function(c){c.setId(t);c.setType(a)}}}function ya(){Ma.call(this);
var n=this,t=this.protectedMethod,a,c,m;n.setType(Ma.FIELD_TYPE);this.setTableId=function(b){a=b};this.getTableId=function(){return a};this.setFieldName=function(b){c=b};this.getFieldName=function(){return c};this.setAlias=function(b){m=b};this.getRefDisplayText=function(b){b=b.getTable(a);var d=m?m:c;return ua.TableNameHelper.getDisplayText(b)+"."+d};this.isRightDisplayFormat=function(b){return-1<b.indexOf(".")};this.fromDisplayText=function(b,d,h){var O=b.split(".")[0];a=O;var f=d.getAllTable();
for(d=0;d<f.length;d++){var e=f[d];if(ua.TableNameHelper.getDisplayText(e)==O){a=e.getUid();break}}c=b=b.substring(O.length+1);h=h?h[a]:[];for(d=0;d<h.length;d++)if(O=h[d],O.getAlias()==b){c=O.getName();m=b;break}};this.equals=function(b){return b.getType()!=n.getType()?!1:b.getTableId()==a&&b.getFieldName()==c?!0:!1};this.copy=function(){var b=new ya;t.copy(b);b.setTableId(a);b.setFieldName(c);b.setAlias(m);return b};this.protectedFromJsonObject=function(b){a=b.tableId;c=b.fieldName;m=b.alias};this.protectedToJsonObject=
function(b){b.tableId=a;b.fieldName=c}}function Da(){Ma.call(this);var n=this,t=this.protectedMethod,a;n.setType(Ma.METRIC_TYPE);this.setMetricId=function(c){a=c};this.getMetricId=function(){return a};this.getRefDisplayText=function(c){return(c=c.getMetric(a))?c.getName():""};this.isRightDisplayFormat=function(c,m){var b=c.match(/^[\u3000\u4E00-\u9FA5a-zA-Z0-9_]{1,}$/),d=!1;if(b){m=m.getAllMetric();for(var h=0;h<m.length;h++)m[h].getName()==c&&(d=!0)}return b&&d};this.fromDisplayText=function(c,m){m=
m.getAllMetric();for(var b=0;b<m.length;b++){var d=m[b];if(d.getName()==c){a=d.getId();break}}if(!a)throw Error("invalid ref");};this.equals=function(c){return c.getType()!=n.getType()?!1:a==c.getMetricId()};this.copy=function(){var c=new Da;t.copy(c);c.setMetricId(a);return c};this.protectedFromJsonObject=function(c){a=c.metricId};this.protectedToJsonObject=function(c){c.metricId=a}}function va(){Ma.call(this);var n=this,t=this.protectedMethod,a,c;n.setType(Ma.DIMENSION_TYPE);this.setDimensionId=
function(m){a=m};this.getDimensionId=function(){return a};this.setDimensionName=function(m){c=m};this.getDimensionName=function(){return c};this.getRefDisplayText=function(m){var b=m.getDimensionById(a);b||(b=m.getDimensionByName(c));return b?b.getName():c};this.isRightDisplayFormat=function(m,b){var d=m.match(/^[\u3000\u4E00-\u9FA5a-zA-Z0-9_()]{1,}$/),h=!1;if(d){b=b.getAllDimension();for(var O=0;O<b.length;O++)b[O].getName()==m&&(h=!0)}return d&&h};this.fromDisplayText=function(m,b){b=b.getAllDimension();
for(var d=0;d<b.length;d++){var h=b[d];if(h.getName()==m){a=h.getDimensionId();c=h.getName();break}}if(!a)throw Error("invalid ref");};this.equals=function(m){return m.getType()!=n.getType()?!1:a==m.getDimensionId()&&c==m.getDimensionName()};this.copy=function(){var m=new va;t.copy(m);m.setDimensionId(a);m.setDimensionName(c);return m};this.protectedFromJsonObject=function(m){a=m.dimensionId;c=m.dimensionName};this.protectedToJsonObject=function(m){m.dimensionId=a;m.dimensionName=c}}function I(){var n,
t,a=[];this.isValid=function(){return n};this.getCases=function(){return a};this.isModelEmpty=function(){return t};this.fromJsonObject=function(c){n=c.valid;t=c.modelIsEmpty;if(c=c.cases){a=[];for(var m=new K,b=0;b<c.length;b++){var d=c[b],h=m.getInvalidityCase(d.type);d&&(h.fromJsonObject(d),a.push(h))}}}}function K(){this.getInvalidityCase=function(n){switch(n){case J.TYPE_NO_METRIC:return new Z;case J.TYPE_INVALID_FIELD_REF:return new ra;case J.TYPE_INVALID_EXPR:return new ka;case J.TYPE_INVALID_FIELD_FILTER_REF:return new N;
case J.TYPE_INVALID_DIMENSION_REF:return new M;case J.TYPE_INVALID_DIMENSION_TYPE:return new la;case J.TYPE_INVALID_PUBLIC_DIMENSION:return new xa;case J.TYPE_INVALID_TABLE:return new Aa;case J.TYPE_INVALID_EXPR_DATA_TYPE:return new C;case J.TYPE_INCOMPLETE_MATERIALIZED_CONFIG:return new za;case J.TYPE_INVALID_DIMENSION_NOT_EXIST:case J.TYPE_INVALID_DIMENSION_GRANULARITY_NOT_MATCH:case J.TYPE_INVALID_DIMENSION_TYPE_NOT_MATCH:return new g}}}function J(){var n,t=this;this.getType=function(){return n};
this.fromJsonObject=function(a){n=a.type;t.protectedFromJsonObject(a)};this.protectedFromJsonObject=function(a){}}function X(){J.call(this);var n=[];this.getMetricIds=function(){return n};this.protectedFromJsonObject=function(t){t&&t.metricIds&&(n=t.metricIds)}}function Z(){J.call(this)}function ra(){X.call(this)}function N(){X.call(this)}function g(){X.call(this)}function ka(){X.call(this);var n;this.getMetricPrompt=function(a){if(!n)return null;for(var c=Object.keys(n),m=0;m<c.length;m++)for(var b=
c[m],d=n[b],h=0;h<d.length;h++)if(a==d[h])return b};var t=this.protectedFromJsonObject;this.protectedFromJsonObject=function(a){t(a);n=a.promptMap}}function C(){X.call(this);var n=this.protectedFromJsonObject;this.protectedFromJsonObject=function(t){n(t)}}function ia(){J.call(this);var n;this.getDimensionIds=function(){return n};this.protectedFromJsonObject=function(t){t.dimensionIds&&(n=t.dimensionIds)}}function M(){ia.call(this)}function la(){ia.call(this)}function na(){J.call(this);var n;this.getPublicDimensionIds=
function(){return n};this.protectedFromJsonObject=function(t){t.publicDimensionIds&&(n=t.publicDimensionIds)}}function xa(){na.call(this)}function za(){J.call(this)}function aa(){J.call(this);var n,t;this.getTableIds=function(){return n};this.getInvalidTableMap=function(){return t};this.protectedFromJsonObject=function(a){a.tableIds&&(n=a.tableIds);a.tableException&&(t=a.tableException)}}function Aa(){aa.call(this)}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});
"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.metricdesigner&&(com.kingdee.bos.qing.modeler.designer.metricdesigner={});var ua=com.kingdee.bos.qing.modeler.designer.metricdesigner;
ua.MetricModeler=qa;ua.Metric=Ua;ua.ExprValidity=function(){var n,t,a;this.isValid=function(){return n};this.getPrompt=function(){return t};this.getExceptionType=function(){return a};this.fromJsonObject=function(c){n=c.valid;t=c.prompt;a=c.exceptionType}};ua.Dimension=Oa;ua.PublicDimension=ib;ua.MappingField=Ya;ua.DimensionFilterItem=function(){var n,t;this.getDimensionKey=function(){return n};this.setDimensionKey=function(a){n=a};this.getValues=function(){return t};this.setValues=function(a){t=a};
this.fromJsonObject=function(a){n=a.dimensionKey;t=a.values};this.toJsonObject=function(){var a={};a.dimensionKey=n;a.values=t;return a}};ua.ModelerValidity=I;ua.MetricModelerInvalidityCase=J;ua.TableFieldMeta=function(){var n={},t;this.getTableFieldMap=function(){return n};this.setTableFieldMap=function(a){n=a};this.getValidity=function(){return t};this.setValidity=function(a){t=a};this.fromJsonObject=function(a){if(a){var c=a.validity;c&&(t=new I,t.fromJsonObject(c));n={};if(a=a.tableFields){c=
Object.keys(a);for(var m=0;m<c.length;m++){var b=c[m],d=n,h=b;b=a[b];for(var O=[],f=0;f<b.length;f++){var e=new Q;e.fromJsonObject(b[f]);O.push(e)}d[h]=O}}}}};ua.DimensionExprReference=va;var fa,u,F,Q,r,w,L;(function(){var n=com.kingdee.bos.qing.modeler.designer;fa=n.ModelerModel;u=n.AbstractModelerModelParser;F=n.ModelerModerParser;Q=n.Field;r=n.UIDHelper;w=n.FilterItem;L=n.MaterializedConfig})();F.registerParser(fa.TYPE_METRIC_MODELER,new function(){u.call(this);this.parseToModel=function(n){var t=
new qa;t.fromJsonObject(n);return t}});qa.KEY_ADD_METRIC="metric_designer_add_metric";qa.KEY_REMOVE_METRIC="metric_designer_remove_metric";qa.KEY_UPDATE_METRIC="metric_designer_update_metric";qa.KEY_ADD_DIMENSION="metric_designer_add_dimension";qa.KEY_REMOVE_DIMENSION="metric_designer_remove_dimension";qa.KEY_UPDATE_DIMENSION="metric_designer_update_dimension";qa.KEY_BATCH_UPDATE_DIMENSION="metric_designer_batch_update_dimension";qa.KEY_SET_METRIC_FILTER="metric_designer_set_metric_filter";Oa.TYPE_DATE=
"DATE";Oa.TYPE_NORMAL="NORMAL";Oa.VALUE_YYYY=0;Oa.VALUE_QUARTER=1;Oa.VALUE_MONTH=2;Oa.VALUE_DAY=3;Oa.VALUE_YEAR_QUARTER=4;Oa.VALUE_YEAR_MONTH=5;Oa.VALUE_YEAR_WEEK=6;Oa.VALUE_WEEK_OF_YEAR=7;Oa.VALUE_DAY_OF_WEEK=8;Oa.VALUE_YEAR_MONTH_DAY=9;ua.TableNameHelper=new function(){var n={};this.removeTableName=function(a){a=a.getUid();n[a]&&(n[a]=null)};this.addTableName=function(a,c){a=a.getUid();n[a]=c};this.getDisplayText=function(a){var c=a.getUid(),m=n[c];if(m)return m;for(a=m=(m=a.getDisplayName())?m:
a.getTableName();-1<a.indexOf(".");)a=a.replace(".","_");a=t(a);return n[c]=a};var t=function(a,c){for(var m=c?a+"_"+c:a,b=!1,d=Object.keys(n),h=0;h<d.length;h++)if(n[d[h]]==m){b=!0;break}return b?t(a,c?c+1:1):m}};ua.ExprRefHelper=new function(){function n(z){m.call(this,z,"#666")}function t(z){m.call(this,z,"#e8893a")}function a(z){m.call(this,z,"#789262")}function c(z){m.call(this,z,"#4071ee")}function m(z,H){this.getText=function(){return z};this.getColor=function(){return H}}var b=this,d,h=[],
O=/\[(.+?)\]/g;this.setGlobal=function(z){d=z};this.translateToExeExpr=function(z,H){for(var D=b.getRefTextInExpr(z),G=0;G<D.length;G++){var q=D[G];a:{var v=q;for(var k=H,l=d.getModelerModel(),p=l.getExprReferences(),E=0;E<p.length;E++){var A=p[E];if(A.getRefDisplayText(l)==v){v=A;break a}}for(E=0;E<h.length;E++)if(p=new h[E],p.isRightDisplayFormat(v,l)){try{p.fromDisplayText(v,l,k)}catch(B){continue}p=l.addExprRefIfNotExist(p);p.getId()||(v=p,k=r.getUID(r.NS_REFERENCE),v.setId(k));v=p;break a}v=
void 0}v&&(z=b.replaceRefText(z,q,v.getId()))}return z};this.translateToTextSegment=function(z){var H=b.getRefTextInExpr(z),D=[],G=d.getModelerModel();f(z,H,function(q,v){q&&0<q.length&&(q=new n(q),D.push(q));v&&(v=G.getExprReference(v),v=v instanceof ya?new c("["+v.getRefDisplayText(G)+"]"):v instanceof Da?new t("["+v.getRefDisplayText(G)+"]"):v instanceof va?new a("["+v.getRefDisplayText(G)+"]"):new n("[]"),D.push(v))});return D};var f=function(z,H,D){for(var G,q,v=0;v<H.length;v++){var k=H[v],
l=z.indexOf("["+k+"]");-1<l&&(void 0==G||G>l)&&(G=l,q=k)}G||0==G?(v=z.substring(0,G),D(v,q,G),z=z.substring(G+("["+q+"]").length),f(z,H,D)):D(z,null,null)};this.translateToDisplayExpr=function(z){for(var H=b.getRefTextInExpr(z),D=d.getModelerModel(),G=0;G<H.length;G++){var q=H[G],v=D.getExprReference(q);v=v instanceof ya?v.getRefDisplayText(D):v instanceof Da?v.getRefDisplayText(D):v instanceof va?v.getRefDisplayText(D):"";z=b.replaceRefText(z,q,v)}return z};this.getRefTextInExpr=function(z){var H=
[];z=z.match(O);if(!z)return H;for(var D=0;D<z.length;D++){var G=z[D];G=G.substring(1,G.length-1);0>H.indexOf(G)&&H.push(G)}return H};this.getRefFullDisplayText=function(z){var H=d.getModelerModel();return"["+z.getRefDisplayText(H)+"]"};this.createFieldReference=function(z,H){var D=new ya;D.setTableId(z);D.setFieldName(H.getName());D.setAlias(H.getAlias());return e(D)};this.createMetricReference=function(z){var H=new Da;H.setMetricId(z);return e(H)};this.registReference=function(z){0<h.indexOf(z)||
h.push(z)};this.getMetricReferredInfo=function(z){var H=[];z=z.getId();for(var D=d.getModelerModel(),G=D.getAllMetric(),q=0;q<G.length;q++){var v=G[q];if(v.getId()!=z)for(var k=b.getRefTextInExpr(v.getExpr()),l=0;l<k.length;l++){var p=D.getExprReference(k[l]);p instanceof Da&&p.getMetricId()==z&&H.push(v)}}return H};this.replaceRefText=function(z,H,D){D="["+D+"]";for(H="["+H+"]";-1<z.indexOf(H);)z=z.replace(H,D);return z};var e=function(z){var H=r.getUID(r.NS_REFERENCE);z.setId(H);return d.getModelerModel().addExprRefIfNotExist(z)}};
Ma.FIELD_TYPE="field";Ma.METRIC_TYPE="metric";Ma.DIMENSION_TYPE="dimension";ua.ExprRefHelper.registReference(ya);ua.ExprRefHelper.registReference(Da);ua.ExprRefHelper.registReference(va);J.TYPE_NO_METRIC="noMetric";J.TYPE_INVALID_FIELD_REF="invalidFieldRef";J.TYPE_INVALID_EXPR="invalidExpr";J.TYPE_INVALID_EXPR_DATA_TYPE="invalidExprDataType";J.TYPE_INVALID_FIELD_FILTER_REF="invalidFieldFilterRef";J.TYPE_INVALID_DIMENSION_REF="invalidDimensionRef";J.TYPE_INVALID_DIMENSION_TYPE="invalidDimensionType";
J.TYPE_INVALID_PUBLIC_DIMENSION="invalidPublicDimension";J.TYPE_INVALID_TABLE="invalidTable";J.TYPE_INVALID_TABLE_FILTER="invalidTableFilter";J.TYPE_DB_CONNECTION_FAIL="dbConnectionFail";J.TYPE_USER_NO_DB_CENTER_PERMISSION="userNoDBCenterPermission";J.TYPE_CREATOR_NO_DB_CENTER_PERMISSION="creatorNoDBCenterPermission";J.TYPE_USER_NO_PUBLIC_SOURCE_PERMISSION="userNoPublicSourcePermission";J.TYPE_CREATOR_NO_PUBLIC_SOURCE_PERMISSION="creatorNoPublicSourcePermission";J.TYPE_USER_NO_ENTITY_PERMISSION="userNoEntityPermission";
J.TYPE_REF_PUBLIC_SOURCE_NOT_EXIST="refPublicSourceNotExist";J.TYPE_TABLE_NOT_EXIST="tableNotExist";J.TYPE_MODEL_NOT_EXIST="modelNotExist";J.TYPE_MODEL_DAMAGE="modelDamage";J.TYPE_MODEL_NO_DATA_PERMISSION="modelNoDataPermission";J.TYPE_MODEL_CYCLE_REFERENCE="modelCycleReference";J.TYPE_INCOMPLETE_MATERIALIZED_CONFIG="incompleteMaterializedConfig";J.TYPE_INVALID_DIMENSION_GRANULARITY_NOT_MATCH="invalidDimensionGranularityNotMatch";J.TYPE_INVALID_DIMENSION_TYPE_NOT_MATCH="invalidDimensionTypeNotMatch";
J.TYPE_INVALID_DIMENSION_NOT_EXIST="invalidDimensionNotExist"})();(function(){"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.metricdesigner&&(com.kingdee.bos.qing.modeler.designer.metricdesigner=
{});var qa=com.kingdee.bos.qing.modeler.designer.metricdesigner,Ua,Oa,ib,Ya,Ma,ya,Da,va,I,K,J,X,Z,ra;(function(){var N=com.kingdee.bos.qing.framework.common;Ua=N.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.modeler.designer);N=com.kingdee.bos.qing.ui.component;Oa=N.HelpIcon;N=com.kingdee.bos.qing.common;ib=N.DomUtil;N=com.kingdee.bos.qing.modeler.designer;Ya=N.Field;Ma=N.DesignerFacade;ya=N.QingModeler;Da=N.ModelSetSourceIntegration;va=N.Icons;I=N.AbstractModelerSource;N=com.kingdee.bos.qing.modeler;
ra=N.SpecialWordChecker;N=com.kingdee.bos.qing.modeler.designer.metricdesigner;K=N.Dimension;J=N.MappingField;X=N.PublicDimension;Z=N.TableFieldMeta})();qa.FieldLoader=new function(){this.loadTableFields=function(N,g,ka,C,ia){var M=N.getModelerModel().copy();C&&M.setTables(C);ia&&M.setSource(ia,!0);C=new ya;C.setModelerModel(M);N=new Ma(N.getRemoteImpl(),function(la){var na=new Z;na.fromJsonObject(la);(la=na.getValidity())&&qa.MetricStateMonitor.setModelValidity(la);na=na.getTableFieldMap();ka&&ka(na)},
function(la){ka&&ka({});return!0});N.setBlockingJqUi(g);N.getTableFieldWithCheckModel(C)}};qa.PublicDimensionUtil=new function(){var N=this;this.addTablesToPublicDimensions=function(ia,M,la,na,xa){var za=la.getModelerModel(),aa=za.getAllTable().concat(M),Aa=za.getAllSource();ia&&(Aa=Aa.concat([ia]));qa.FieldLoader.loadTableFields(la,na,function(ua){for(var fa=za.getPublicDimensions(),u=[],F=0;F<fa.length;F++){var Q=fa[F].copy();Q.updateFields(ua);u.push(Q)}ka(u,aa,M,ua);fa=u=g(la,u);F={};Q=Object.keys(ua);
for(var r=0;r<Q.length;r++){var w=Q[r],L=C(aa,w);if(null!=L){var n=w,t=fa;w=ua[w];for(var a=[],c=0;c<w.length;c++){for(var m=w[c],b=!0,d=0;d<t.length;d++)if(t[d].getFieldByIndex(L).getName()==m.getName()){b=!1;break}b&&a.push(m)}F[n]=a}}ua=[];ka(ua,aa,aa,F);for(F=0;F<ua.length;F++)u.push(ua[F].copy());u=g(la,u);ua=za.getAllDimension();if(1==M.length)for(F=u,fa=0;fa<F.length;fa++)for(Q=F[fa],r=0;r<ua.length;r++)n=ua[r],n.getDimensionType()==K.TYPE_NORMAL&&n.getPublicDimensionId()==Q.getId()&&(Q.setName(n.getName()),
Q.setNameModified(n.isNameModified()));xa&&xa(u)},aa,Aa)};this.loadPublicDimensions=function(ia,M){var la=[];M=M.getModelerModel().getPublicDimensions();for(var na=0;na<M.length;na++){var xa=M[na].copy();xa.updateFields(ia);la.push(xa)}return la};this.deleteTableForPublicDimensions=function(ia,M,la,na){var xa=M.getModelerModel(),za=xa.getAllTable(),aa=xa.getPublicDimensions();qa.FieldLoader.loadTableFields(M,la,function(Aa){for(var ua=C(za,ia),fa=[],u=0;u<aa.length;u++){var F=aa[u].copy();F.updateFields(Aa);
F.removeField(ua);if(2==za.length){if(!xa.checkDimensionRef(F.getId()))continue;F.setNameModified(!1)}fa.push(F)}for(u=0;u<fa.length;u++)F=fa[u],F.isNameModified()||(Aa=N.getUniquePublicDimensionName(M,fa,F,!0),F.setName(Aa));na&&na(fa)})};this.createTipUi=function(){var ia=$("<div>");ib.layoutCtrlWithLRTB(ia,0,0,null,null,null,30);var M=$("<span>");M.text(Ua.get("publicDIMDesc","\u516c\u5171\u7ef4\u5ea6\u529f\u80fd\u8bf4\u660e"));M.css({position:"relative",left:"0px",top:"0px","max-width":"100px",
color:"#666666","font-size":"12px",height:"18px"});ia.append(M);M=$("<span>");M.css({position:"relative",left:"0px",top:"0px","margin-left":"4px",width:"18px",height:"18px"});var la=$("<div>");la.text(Ua.get("publicDIMTips","\u516c\u5171\u7ef4\u5ea6\u9002\u7528\u4e8e\u4ee5\u4e0b\u60c5\u51b5\uff1a\n\u4e00\u662f\u6307\u6807\u7684\u8ba1\u7b97\u516c\u5f0f\u4f9d\u8d56\u591a\u4e2a\u6570\u636e\u8868\u4e2d\u7684\u5b57\u6bb5\uff0c\u4e8c\u662f\u6307\u6807\u7684\u8ba1\u7b97\u516c\u5f0f\u4f9d\u8d56\u4e8e\u591a\u4e2a\u6307\u6807\uff0c\u4e14\u8fd9\u4e9b\u6307\u6807\u6765\u6e90\u4e8e\u4e0d\u540c\u7684\u6570\u636e\u8868\u3002\u6b64\u65f6\u9700\u8981\u8bbe\u7f6e\u516c\u5171\u7ef4\u5ea6\u624d\u80fd\u6b63\u786e\u8ba1\u7b97\u51fa\u76f8\u5173\u6307\u6807\u3002"));
la.css({"line-height":"20px"});var na=new Oa;na.setIconType(Oa.ICON_TYPE_QUESTION);na.setTipsSize(370,105);na.setTipsHtml(la);la=na.getJqUi();M.append(la);ib.layoutCtrl(la,0,0,16,16);ia.append(M);return ia};this.appendResetButton=function(ia,M,la){var na=$("<div>");na.on("mousedown",function(xa){na.hide();la&&la();xa.stopPropagation()});na.css("cursor","pointer");na.attr("title",Ua.get("reset","\u91cd\u7f6e"));na.addClass("metric-designer-dimension-reset");va.background(na,"reset");na.hide();ia.on("mouseenter",
function(){M?na.show():na.hide()});ia.on("mouseleave",function(){na.hide()});na.appendTo(ia);return na};this.getUniquePublicDimensionName=function(ia,M,la,na){var xa=la.getFieldByIndex(0);if(xa){xa=xa.getAlias();if(1==la.getFields().length)return xa;if(!xa)return"";for(var za=[],aa=ia.getModelerModel().getAllDimension(),Aa=ia.getModelerModel().getPublicDimensions(),ua=0;ua<aa.length;ua++){var fa=aa[ua];if(fa.getPublicDimensionId()!=la.getId()){var u;if(!(u=!na)){u=void 0;for(var F=fa,Q=M,r=0;r<Q.length;r++)if(F.getPublicDimensionId()==
Q[r].getId()){u=Q[r];break}u=u&&u.isFieldsCompleted()&&u.isDataTypeConsistent()&&!N.isPdTypeInvalidWhenDateDimension(u,F)&&!N.isPdTypeInvalidWhenNormalDimension(u,F)?!1:!0}(u||N.isDimensionNameModified(fa,M,Aa))&&za.push(fa.getName())}}ia=ia.getModelerModel().getAllMetric();for(ua=0;ua<ia.length;ua++)za.push(ia[ua].getName());for(ua=0;ua<M.length;ua++)ia=M[ua],ia!=la&&(aa=M.indexOf(la),na&&ua>=aa&&!ia.isNameModified()||ia.getName()&&za.push(ia.getName()));xa=xa.replace(/[^\u4E00-\u9FA5a-zA-Z0-9_]/g,
"_");return qa.ValueHandler.fixDuplicateValue(za,xa,50)}};this.isDimensionNameModified=function(ia,M,la){return ia.getDimensionType()==K.TYPE_NORMAL?ia.isNameModified():ia.isNameModified()||!N.isPublicDimensionNameModified(ia,M,la)};this.isPublicDimensionNameModified=function(ia,M,la){ia=ia.getPublicDimensionId();for(var na,xa,za=0;za<M.length;za++)if(ia==M[za].getId()){na=M[za].getName();break}for(za=0;za<la.length;za++)if(ia==la[za].getId()){xa=la[za].getName();break}return xa!=na};this.isPdTypeInvalidWhenDateDimension=
function(ia,M){ia=ia.getFieldByIndex(0);if(!ia)return!0;ia=ia.getDataType()!=Ya.DT_DATE&&ia.getDataType()!=Ya.DT_DATETIME;return M.getDimensionType()==K.TYPE_DATE&&ia};this.isPdTypeInvalidWhenNormalDimension=function(ia,M){var la=ia.getFieldByIndex(0);if(!la)return!0;la=la.getDataType()==Ya.DT_DATE||la.getDataType()==Ya.DT_DATETIME;return 2<=ia.getFields().length&&M.getDimensionType()==K.TYPE_NORMAL&&la};var g=function(ia,M){for(var la=[],na=0;na<M.length;na++){var xa=M[na];xa.isFieldsCompleted()&&
xa.isDataTypeConsistent()&&la.push(xa)}for(na=0;na<la.length;na++){var za=la[na];za.tryGenerateId();za.tryGenerateName(function(){return N.getUniquePublicDimensionName(ia,la,za)})}return la},ka=function(ia,M,la,na){var xa=0;0!=ia.length&&(xa=ia[0].getFields().length);for(var za=0;za<la.length;za++){var aa=la[za].getUid(),Aa=na[aa]?na[aa]:[],ua=C(M,aa);if(null!=ua){for(var fa=[],u=ia,F=ua,Q=aa,r=fa,w=0;w<u.length;w++){var L=u[w],n=new J;n.setTableId(Q);L.insertField(F,n)}for(Q=0;Q<Aa.length;Q++){w=
Aa[Q];a:{L=u;n=w;for(var t=0;t<L.length;t++){var a=L[t],c=a.getFieldByIndex(0);if(c.getAlias()==n.getAlias()&&c.getDataType()==n.getDataType()){L=a;break a}}L=null}L?L.getFieldByIndex(F).update(w):r.push(w)}xa++;if(0==ua)for(u=0;u<fa.length;u++){F=xa;Aa=aa;r=ua;Q=fa[u];w=new X;for(L=0;L<F;L++)n=new J,n.setTableId(Aa),L==r&&n.update(Q),w.addField(n);ia.push(w)}}}},C=function(ia,M){for(var la=null,na=0;na<ia.length;na++)if(ia[na].getUid()==M){la=na;break}return la}};qa.DimensionUtil=new function(){var N=
this,g="0123456789".split("");this.getDateFormatName=function(la,na){return(la=ka(la))?na?"("+la+")":la:null};this.fixDimensionDateType=function(la,na,xa){for(var za={},aa=0;aa<la.length;aa++)if(la[aa].getPublicDimensionId()==xa){var Aa=la[aa].getDateFormat()+"",ua=za[Aa];ua?za[Aa]=++ua:za[Aa]=1}for(aa=0;aa<g.length;aa++)if(la=g[aa],void 0===za[la]){na.setDateFormat(la-0);return}na.setDateFormat(g[g.length-1]-0)};this.getUniqueNumber=function(la,na,xa,za){var aa=la.getModelerModel();za||(za=aa.getPublicDimensionById(na.getPublicDimensionId()));
if(!za||0==za.getFields().length)return"";null==xa&&(xa=qa.ValueHandler.getAllNumber(aa,na.getDimensionId()));aa=null;na.getDimensionType()!=K.TYPE_DATE||!C(la,za)&&na.isNameModified()||(aa=N.getDateFormatName(na.getDateFormat(),!0));var Aa=za.getFieldByIndex(0);la=C(la,za)?Aa.getName():na.isNameModified()?na.getName():za.getName();return N.fixNumber(xa,la,aa)};this.fixNumber=function(la,na,xa){na=M(na);ra.isSpecialWord(na)&&(na+="_");na.match(/^([\u4E00-\u9FA5a-zA-Z_()])/)||(na="_"+na);return qa.ValueHandler.fixDuplicateValue(la,
na,25,xa,!0)};this.fixName=function(la,na,xa){na=M(na);return qa.ValueHandler.fixDuplicateValue(la,na,50,xa)};this.batchFixDimension=function(la,na,xa,za){for(var aa=na.getModelerModel().getPublicDimensions(),Aa=0;Aa<la.length;Aa++){var ua=la[Aa];if(!qa.MetricStateMonitor.checkDimensionInvalid(ua.getDimensionId())){for(var fa,u=0;u<aa.length;u++)if(ua.getPublicDimensionId()==aa[u].getId()){fa=aa[u];break}fa&&(u=fa.getFieldByIndex(0))&&(u=u.getDataType()==Ya.DT_DATE||u.getDataType()==Ya.DT_DATETIME,
za&&ua.getDimensionType()==K.TYPE_NORMAL&&u?(ua.setDimensionType(K.TYPE_DATE),ua.setDateFormat(K.VALUE_YYYY),ua.isNameModified()||ia(la,fa,Aa,na,xa)):za&&ua.isNameModified()||ua.getDimensionType()!=K.TYPE_NORMAL?!ua.isNameModified()&&qa.PublicDimensionUtil.isPublicDimensionNameModified(ua,aa,xa)&&ia(la,fa,Aa,na,xa):ia(la,fa,Aa,na,xa))}}};var ka=function(la){switch(la){case 0:return Ua.get("year","\u5e74");case 1:return Ua.get("quarter","\u5b63\u5ea6");case 2:return Ua.get("month","\u6708");case 3:return Ua.get("day",
"\u65e5");case 4:return Ua.get("yearQuarter","\u5e74\u5b63");case 5:return Ua.get("yearMonth","\u5e74\u6708");case 6:return Ua.get("yearWeek","\u5e74\u5468");case 7:return Ua.get("weeks","\u5468\u6570");case 8:return Ua.get("week","\u661f\u671f");case 9:return Ua.get("yearMonthDay","\u5e74\u6708\u65e5");default:return null}},C=function(la,na){na=na.getFieldByIndex(0).getTableId();la=qa.SourceUtil.getSourceTypeByTableId(la,na);return la==I.SOURCE_TYPE_CURRENT_ENTITY_SOURCE||la==I.SOURCE_TYPE_MODEL_SET_SOURCE?
!0:!1},ia=function(la,na,xa,za,aa){var Aa=za.getModelerModel(),ua=la[xa];ua.getDimensionType()==K.TYPE_NORMAL&&ua.setNameModified(na.isNameModified());var fa=la[xa];var u=[];for(var F=0;F<xa;F++)u.push(la[F].getName());var Q=Aa.getPublicDimensions();for(F=xa+1;F<la.length;F++){var r=la[F];(qa.MetricStateMonitor.checkDimensionInvalid(r.getDimensionId())||qa.PublicDimensionUtil.isDimensionNameModified(r,Q,aa))&&u.push(r.getName())}aa=Aa.getAllMetric();aa=qa.ValueHandler.getAllMetricName(aa);u=u.concat(aa);
aa=Aa.getPublicDimensions();fa=qa.ValueHandler.getAllPublicDimensionName(aa,fa.getPublicDimensionId());u=u.concat(fa);fa=N.getDateFormatName(ua.getDateFormat(),!0);na=N.fixName(u,na.getName(),fa);ua.setName(na);if(!ua.isNumberModified()){na=[];for(u=0;u<xa;u++)na.push(la[u].getNumber());for(u=xa+1;u<la.length;u++)xa=la[u],(qa.MetricStateMonitor.checkDimensionInvalid(xa.getDimensionId())||xa.isNumberModified())&&na.push(xa.getNumber());la=Aa.getAllMetric();la=qa.ValueHandler.getAllMetricNumber(la);
na=na.concat(la);za=N.getUniqueNumber(za,ua,na);ua.setNumber(za)}},M=function(la){return la.replace(/[^\u4E00-\u9FA5a-zA-Z0-9_()]/g,"_")}};qa.ValueHandler=new function(){this.fixDuplicateValue=function(N,g,ka,C,ia){var M=C?C.length:0;var la=C?g+C:g;var na=0;if(ia){for(var xa=[],za=0;za<N.length;za++){var aa=N[za];aa&&xa.push(aa.toLowerCase())}N=xa}la.length>=ka&&(la=g.substr(0,ka-M),C&&(la+=C));for(xa=ia?la.toLowerCase():la;-1<N.indexOf(xa);)na++,xa=na.toString().length,la=C?g+C:g,la.length>=ka&&
(la=g.substr(0,ka-M-xa-1),C&&(la+=C)),la=la+"_"+na,xa=ia?la.toLowerCase():la;return la};this.isValueDuplicate=function(N,g,ka){if(!N||0==N.length)return!1;g=ka?g.toLowerCase():g;for(var C=0;C<N.length;C++)if((ka?N[C].toLowerCase():N[C])==g)return!0;return!1};this.getAllNumber=function(N,g,ka){var C=N.getAllDimension();g=qa.ValueHandler.getAllDimensionNumber(C,g);ka||(N=N.getAllMetric(),N=qa.ValueHandler.getAllMetricNumber(N),g=g.concat(N));return g};this.getAllName=function(N,g,ka){var C=N.getAllDimension(),
ia;g&&(ia=g.getDimensionId());C=qa.ValueHandler.getAllDimensionName(C,ia);ka||(ka=N.getAllMetric(),ka=qa.ValueHandler.getAllMetricName(ka),C=C.concat(ka),N=N.getPublicDimensions(),g=qa.ValueHandler.getAllPublicDimensionName(N,g.getPublicDimensionId()),C=C.concat(g));return C};this.getAllDimensionName=function(N,g){for(var ka=[],C=0;C<N.length;C++){var ia=N[C];g&&g==ia.getDimensionId()||(ia=ia.getName(),ka.push(ia))}return ka};this.getAllDimensionNumber=function(N,g){for(var ka=[],C=0;C<N.length;C++){var ia=
N[C];g&&g==ia.getDimensionId()||(ia=ia.getNumber(),ka.push(ia))}return ka};this.getAllMetricNumber=function(N){for(var g=[],ka=0;ka<N.length;ka++){var C=N[ka].getNumber();g.push(C)}return g};this.getAllMetricName=function(N){for(var g=[],ka=0;ka<N.length;ka++){var C=N[ka].getName();g.push(C)}return g};this.getAllPublicDimensionName=function(N,g,ka){var C=[];if(0==N.length||!ka&&2>N[0].getFields().length)return C;for(ka=0;ka<N.length;ka++){var ia=N[ka];g&&g==ia.getId()||C.push(ia.getName())}return C}};
qa.SourceUtil=new function(){var N=this;this.createExceptionIcon=function(g){var ka=$("<div>");va.background(ka,"qingWarning");ka.attr("title",g);return ka};this.updateTableItemStatus=function(g,ka,C){var ia=g.children(".modeler-designer-sourcearea-exception-icon"),M=g.children(".modeler-designer-sourcearea-icon"),la=g.children(".modeler-designer-sourcearea-name"),na=12,xa=34;ia&&ia.remove();ka||(ia=N.createExceptionIcon(C),ia.addClass("modeler-designer-sourcearea-exception-icon"),ia.appendTo(g),
na+=22,xa+=22);M.css("left",na+"px");la.css("left",xa+"px")};this.getTableSource=function(g,ka){g=g.getModelerModel();ka=ka.getSourceUid();ka=g.getSource(ka);ka.setModelId(Da.getModelId());return ka};this.getSourceTypeByTableId=function(g,ka){ka=g.getModelerModel().getTable(ka);ka=N.getTableSource(g,ka);return(g=g.getIntegration().getMapSourceType())?g[ka.getSourceId()]:null};this.getSourceIconName=function(g){if(!g)return"qingWarning";switch(g){case I.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:return"entity-source-icon";
case I.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE:return"datacenter-source-icon";case I.SOURCE_TYPE_MODEL_SET_SOURCE:return"modelset-source-icon";case I.SOURCE_TYPE_OPEN_API_SOURCE:return"openapi-source-icon";default:return g.toLowerCase()}};this.createSourceNameByType=function(g){var ka;g===I.SOURCE_TYPE_CURRENT_ENTITY_SOURCE?ka=Ua.get("businessEntity","\u4e1a\u52a1\u5b9e\u4f53"):g===I.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE&&(ka=Ua.get("dataCenter","\u6570\u636e\u4e2d\u5fc3"));return ka}}})();(function(){function qa(Da,va){var I;this.store=function(){var K=Oa.ExprRefHelper.getRefTextInExpr(Da.getExpr());if(!I){I=[];for(var J=0;J<K.length;J++)I.push(va.getExprReference(K[J]))}};this.restore=function(){if(I)for(var K=0;K<I.length;K++)va.addExprRefIfNotExist(I[K])}}function Ua(Da,va){var I,K,J,X;this.store=function(){if(!I&&(I=va.getAllMetric(),K=va.getExprReferences(),J=va.copyMetrics(),X=va.copyExprReferences(),Da&&0!=Da.length)){for(var Z=0;Z<X.length;Z++){var ra=X[Z];if(ra instanceof
ya)for(var N=0;N<Da.length;N++){var g=Da[N];if(ra.getDimensionId()===g.getDimensionId()){ra.setDimensionName(g.getName());break}if(ra.getDimensionName()===g.getName()){ra.setDimensionId(g.getDimensionId());break}}}for(Z=X.length-1;0<=Z;Z--)if(g=X[Z],g instanceof ya)for(ra=X.length-1;ra>Z;ra--)if(N=X[ra],g.equals(N)){N=N.getId();g=g.getId();for(var ka=0;ka<J.length;ka++){var C=J[ka],ia=Oa.ExprRefHelper.replaceRefText(C.getExpr(),N,g);C.setExpr(ia)}X.splice(ra,1);break}}va.setMetrics(J);va.setExprReferences(X)};
this.restore=function(){va.setMetrics(I);va.setExprReferences(K)}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.metricdesigner&&
(com.kingdee.bos.qing.modeler.designer.metricdesigner={});var Oa=com.kingdee.bos.qing.modeler.designer.metricdesigner;Oa.AddMetricAction=function(){ib.call(this);var Da,va,I;this.setValue=function(K,J){Da=K;va=J};this.getCaption=function(){return Ya.get("createMetricCaption","\u65b0\u5efa\u6307\u6807\u201c#1\u201d").replace("#1",Da.getName())};this.perform=function(){var K=va.getModelerModel();I&&I.restore();K.addMetric(Da)};this.unperform=function(){var K=va.getModelerModel();I||(I=new qa(Da,K),
I.store());K.removeMetric(Da)}};Oa.EditMetricAction=function(){ib.call(this);var Da,va,I,K,J;this.setValue=function(X,Z,ra){va=X.clone();Da=Z;I=ra};this.getCaption=function(){return Ya.get("editMetricCaption","\u7f16\u8f91\u6307\u6807\u201c#1\u201d").replace("#1",va.getName())};this.perform=function(){var X=I.getModelerModel();K||(K=new qa(va,X),K.store());J&&J.restore();I.getModelerModel().updateMetric(Da)};this.unperform=function(){var X=I.getModelerModel();K&&K.restore();J||(J=new qa(Da,X),J.store());
I.getModelerModel().updateMetric(va)}};Oa.DeleteMetricAction=function(){ib.call(this);var Da,va,I,K;this.setValue=function(J,X){va=J;Da=X};this.getCaption=function(){return Ya.get("deleteMetricCaption","\u5220\u9664\u6307\u6807\u201c#1\u201d").replace("#1",va.getName())};this.perform=function(){var J=Da.getModelerModel();K||(K=new qa(va,J),K.store());I=J.removeMetric(va)};this.unperform=function(){var J=Da.getModelerModel();K&&K.restore();J.addMetric(va,I)}};Oa.RemoveDimensionAction=function(){ib.call(this);
var Da,va,I,K,J=-1,X;this.setValue=function(Z,ra){Da=Z;I=ra.getModelerModel();Z=Da.getPublicDimensionId();K=I.getPublicDimensionById(Z);X=Oa.MetricStateMonitor.getInvalidDimensionPrompt(Da.getDimensionId())};this.getCaption=function(){return"\u5220\u9664\u7ef4\u5ea6"};this.perform=function(){X&&Oa.MetricStateMonitor.removeInvalidDimensionId(Da.getDimensionId());va=I.removeDimension(Da);K&&!I.checkDimensionRef(K.getId(),!0)&&(J=I.removePublicDimensionById(K.getId()))};this.unperform=function(){-1!==
va&&(X&&Oa.MetricStateMonitor.addInvalidDimensionId(Da.getDimensionId(),X),-1!=J&&I.addPublicDimension(K,J),I.addDimension(Da,va))}};Oa.UpdateDimensionAction=function(){ib.call(this);var Da,va,I,K,J;this.setValue=function(Z,ra){Da=ra.getModelerModel();I=Z;Z=Da.getAllDimension();ra=I.getDimensionId();for(var N=0;N<Z.length;N++)if(ra==Z[N].getDimensionId()){J=N;K=Z[N].copy();break}va=new Ua([I],Da)};this.perform=function(){va.store();X(I);Da.updateDimension(I,J)};this.unperform=function(){va.restore();
X(K);Da.updateDimension(K,J)};var X=function(Z){var ra=Da.getAllTable();Z.getDimensionType()==Ma.TYPE_NORMAL&&2<=ra.length&&(ra=Da.getPublicDimensionById(Z.getPublicDimensionId()))&&(ra.setName(Z.getName()),ra.setNameModified(Z.isNameModified()))}};Oa.BatchUpdateDimensionAction=function(){ib.call(this);var Da,va,I=[],K=[],J=[],X=[],Z;this.setValue=function(ra,N,g){Da=g.getModelerModel();var ka=Da.getAllDimension();for(g=0;g<ka.length;g++)K.push(ka[g]);I=ra;ra=Da.getPublicDimensions();for(g=0;g<ra.length;g++)X.push(ra[g]);
J=N;Z=Oa.MetricStateMonitor.copyInvalidDimensionMap();va=new Ua(I,Da)};this.getCaption=function(){return"\u66f4\u65b0\u7ef4\u5ea6"};this.perform=function(){va.store();Da.setPublicDimensions(J);Oa.MetricStateMonitor.copyExistDimensionInvalidStatus(I);Da.updateDimensions(I)};this.unperform=function(){va.restore();Da.setPublicDimensions(X);Oa.MetricStateMonitor.setInvalidDimensionMap(Z);Da.updateDimensions(K)}};Oa.UpdatePublicDimensionAction=function(){ib.call(this);var Da=[],va=[],I,K,J,X=[];this.setValue=
function(Z,ra){I=ra;ra=ra.getModelerModel();for(var N=ra.getPublicDimensions(),g=0;g<N.length;g++)va.push(N[g]);Da=Z;K=Oa.MetricStateMonitor.copyInvalidDimensionMap();J=Oa.MetricStateMonitor.copyInvalidPublicDimensionMap();X=ra.getAllDimension()};this.getCaption=function(){return Ya.get("publicDimensionSetting","\u516c\u5171\u7ef4\u5ea6\u8bbe\u7f6e")};this.perform=function(){var Z=I.getModelerModel();Z.setPublicDimensions(Da);Oa.MetricStateMonitor.updateInvalidDimensionMap(Z);Oa.MetricStateMonitor.setInvalidPublicDimensionMap({});
for(var ra=Z.getAllDimension(),N=[],g=0;g<ra.length;g++)N.push(ra[g].copy());Oa.DimensionUtil.batchFixDimension(N,I,va,!1);Z.updateDimensions(N)};this.unperform=function(){var Z=I.getModelerModel();Oa.MetricStateMonitor.setInvalidDimensionMap(K);Oa.MetricStateMonitor.setInvalidPublicDimensionMap(J);Z.setPublicDimensions(va);Z.updateDimensions(X)}};Oa.DeleteTableAction=function(){ib.call(this);var Da,va,I,K,J=!1,X,Z,ra,N,g,ka;this.setValue=function(C,ia,M,la){va=C;Da=ia;I=M;N=Oa.TableNameHelper.getDisplayText(va);
C=ia.getModelerModel();la&&(X=la,ra=C.getAllDimension(),Z=C.getPublicDimensions(),g=Oa.MetricStateMonitor.copyInvalidDimensionMap(),ka=Oa.MetricStateMonitor.copyInvalidPublicDimensionMap())};this.getCaption=function(){return Ya.get("deleteDataTable","\u5220\u9664\u6570\u636e\u8868\u201c#1\u201d").replace("#1",N)};this.perform=function(){var C=Da.getModelerModel(),ia=C.getAllTable();if(Z)if(1==ia.length)C.setPublicDimensions([]),Oa.MetricStateMonitor.setInvalidDimensionMap({}),Oa.MetricStateMonitor.setInvalidPublicDimensionMap({}),
C.setDimensions([]);else{C.setPublicDimensions(X);Oa.MetricStateMonitor.updateInvalidDIMMapWhenDeleteTable(C);Oa.MetricStateMonitor.updateInvalidPublicDimensionMap(C);for(var M=C.getAllDimension(),la=[],na=0;na<M.length;na++)la.push(M[na].copy());Oa.DimensionUtil.batchFixDimension(la,Da,Z,2==ia.length);C.setDimensions(la)}C=Da.getModelerModel();Oa.TableNameHelper.removeTableName(va);K=C.removeTable(va);C.isSourceUsed(I)||(C.removeSource(I),J=!0)};this.unperform=function(){var C=Da.getModelerModel();
X&&(C.setPublicDimensions(Z),Oa.MetricStateMonitor.setInvalidDimensionMap(g),Oa.MetricStateMonitor.setInvalidPublicDimensionMap(ka),C.setDimensions(ra));Oa.TableNameHelper.addTableName(va,N);J&&(C.batchAddSource([I]),J=!1);C.insertTable(va,K)}};Oa.BatchAddTableAction=function(){ib.call(this);var Da,va,I,K,J,X,Z,ra;this.getCaption=function(){return K};this.setValue=function(N,g,ka,C){Da=ka.getModelerModel();N&&(va=N);N="";for(ka=0;ka<g.length;ka++)N+=Oa.TableNameHelper.getDisplayText(g[ka]),ka<g.length-
1&&(N+="\uff0c");K=Ya.get("addTable","\u6dfb\u52a0\u6570\u636e\u8868")+"\u201d"+N+"\u201c";I=g;C&&(J=C,X=Da.getPublicDimensions(),Z=Oa.MetricStateMonitor.copyInvalidDimensionMap(),ra=Oa.MetricStateMonitor.copyInvalidPublicDimensionMap())};this.perform=function(){J&&(Da.setPublicDimensions(J),Oa.MetricStateMonitor.updateInvalidDimensionMap(Da),Oa.MetricStateMonitor.setInvalidPublicDimensionMap({}));va&&Da.batchAddSource([va]);Da.batchAddTable(I)};this.unperform=function(){X&&(Da.setPublicDimensions(X),
Oa.MetricStateMonitor.setInvalidDimensionMap(Z),Oa.MetricStateMonitor.setInvalidPublicDimensionMap(ra));Da.batchRemoveTable(I);for(var N=0;N<I.length;N++)Oa.TableNameHelper.removeTableName(I[N]);va&&Da.removeSource(va)}};Oa.SelectFieldAction=function(){ib.call(this);var Da,va,I,K,J;this.getCaption=function(){return Oa.TableNameHelper.getDisplayText(Da)+Ya.get("colon","\uff1a")+Ya.get("selectField","\u9009\u62e9\u5b57\u6bb5")};this.setValue=function(X,Z,ra,N,g){Da=X;K=Z;J=ra;I=N;va=g};this.perform=
function(){Da.setSelectedFields(J);va&&Da.setTableName(va)};this.unperform=function(){Da.setSelectedFields(K);I&&Da.setTableName(I)}};Oa.ChangeFilterAction=function(){ib.call(this);var Da,va,I;this.setValue=function(K,J,X){Da=K;va=J;I=X};this.getCaption=function(){return Ya.get("filterCaption","\u8fc7\u6ee4\u6761\u4ef6\u201c#1\u201d").replace("#1",Oa.TableNameHelper.getDisplayText(Da))};this.perform=function(){Da.setFilterItems(I)};this.unperform=function(){Da.setFilterItems(va)}};Oa.UpdateRelationsAction=
function(){ib.call(this);var Da,va,I;this.setValue=function(K,J){Da=K;I=J.getModelerModel();va=I.getRelations()};this.getCaption=function(){return"\u66f4\u65b0\u5173\u7cfb"};this.perform=function(){I.setRelations(Da)};this.unperform=function(){I.setRelations(va)}};Oa.ChangeMetricFilterAction=function(){var Da,va,I;this.setValue=function(K,J,X){Da=K;va=J;I=X};this.getCaption=function(){return Ya.get("filterCaption","\u8fc7\u6ee4\u6761\u4ef6\u201c#1\u201d").replace("#1",Da.getName())};this.perform=
function(){Da.setFilterItems(I)};this.unperform=function(){Da.setFilterItems(va)}};var ib,Ya,Ma,ya;(function(){var Da=com.kingdee.bos.qing.modeler.designer;ib=Da.AbstractAction;Da=com.kingdee.bos.qing.framework.common;Ya=Da.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.modeler.designer);Da=com.kingdee.bos.qing.modeler.designer.metricdesigner;Ma=Da.Dimension;ya=Da.DimensionExprReference})()})();(function(){function qa(){var za=this,aa,Aa;this.setGlobal=function(u){Aa=u;N.MetricStateMonitor.registGlobal(u)};this.init=function(u){aa&&aa.removePropertyChangeCallback(fa);aa=u;aa.addPropertyChangeCallback(fa)};this.backgroundCheck=function(u){var F=new na(Aa.getRemoteImpl(),function(Q){var r=new C;r.fromJsonObject(Q);N.MetricStateMonitor.setModelValidity(r)});F.setShowBlocking(!1);F.checkModelerValid(u)};this.firstBackgroundCheck=function(u){var F=new na(Aa.getRemoteImpl(),function(Q){var r=
new C;r.fromJsonObject(Q);N.MetricStateMonitor.setModelValidity(r);ua(r)});F.setShowBlocking(!1);F.checkModelerValid(u)};this.setGlobalCheckResult=function(u,F,Q){var r=new C;r.fromJsonObject(u);if(r.isValid())F&&(u=g.createFeedbackDialog(),u.setMessage(ka.get("tableModelerValid","\u5f53\u524d\u6570\u636e\u8868\u6a21\u578b\u6821\u9a8c\u901a\u8fc7")),u.setTitle(ka.get("operatingTips","\u64cd\u4f5c\u63d0\u793a")),u.setOptionType(g.OPTION_OK),u.setButtonText(g.RETURN_OK,ka.get("iSee","\u6211\u77e5\u9053\u4e86")),
u.showDialog());else{F=Q?Q:ka.get("tableModelerInvalid","\u5f53\u524d\u6570\u636e\u8868\u6a21\u578b\u6821\u9a8c\u5931\u8d25\uff0c\u65e0\u6cd5\u90e8\u7f72\u6216\u9884\u89c8\u6570\u636e");u=g.createFeedbackDialog();u.setMsgImageType(g.MSG_WARNING);u.setTitle(ka.get("operatingTips","\u64cd\u4f5c\u63d0\u793a"));u.setMessage(F);F=u.setDetail;Q="";if(r.isModelEmpty())Q=ka.get("noModeler","\u5f53\u524d\u6a21\u578b\u672a\u5efa\u6a21");else{for(var w=r.getCases(),L=new Ua,n=[],t=0,a=w.length;t<a;t++){var c=
L.getHandler(w[t],Aa);c&&n.push(c.getDetail())}t=0;for(a=n.length;t<a;t++)Q+=t+1+"\u3001"+n[t],t<a-1?(Q+="\uff1b",Q+="\r\n"):Q+=ka.get("period","\u3002")}F.call(u,Q);u.setOptionType(g.OPTION_OK);u.setButtonText(g.RETURN_OK,ka.get("iSee","\u6211\u77e5\u9053\u4e86"));u.showDialog()}N.MetricStateMonitor.setModelValidity(r);ua(r)};var ua=function(u){u=u.getCases();for(var F=0;F<u.length;F++){var Q=u[F];if(Q.getInvalidTableMap){Aa.getIntegration().setMapTableException(Q.getInvalidTableMap());break}}(u=
N.MetricStateMonitor.getFunUpdateTableArea())&&u()},fa=function(u,F){if(u===xa.KEY_ADD_METRIC||u===xa.KEY_REMOVE_METRIC||u===xa.KEY_UPDATE_METRIC||u===la.KEY_TABLE_SELECT_FIELD||u===la.KEY_TABLE_SET_FILTER||u===xa.KEY_UPDATE_DIMENSION||u===xa.KEY_ADD_DIMENSION||u===xa.KEY_REMOVE_DIMENSION||u===xa.KEY_BATCH_UPDATE_DIMENSION)u=Aa.getModelerModel(),F=new M,F.setModelerModel(u),za.backgroundCheck(F.toJsonObject())}}function Ua(){this.getHandler=function(za,aa){switch(za.getType()){case ia.TYPE_NO_METRIC:var Aa=
new ib;break;case ia.TYPE_INVALID_FIELD_REF:Aa=new Ya;break;case ia.TYPE_INVALID_EXPR:Aa=new ya;break;case ia.TYPE_INVALID_FIELD_FILTER_REF:Aa=new K;break;case ia.TYPE_INVALID_EXPR_DATA_TYPE:Aa=new Ma;break;case ia.TYPE_INVALID_DIMENSION_REF:Aa=new J;break;case ia.TYPE_INVALID_DIMENSION_TYPE:Aa=new X;break;case ia.TYPE_INVALID_PUBLIC_DIMENSION:Aa=new Z;break;case ia.TYPE_INCOMPLETE_MATERIALIZED_CONFIG:Aa=new ra;break;case ia.TYPE_INVALID_DIMENSION_NOT_EXIST:Aa=new Da;break;case ia.TYPE_INVALID_DIMENSION_GRANULARITY_NOT_MATCH:Aa=
new va;break;case ia.TYPE_INVALID_DIMENSION_TYPE_NOT_MATCH:Aa=new I}Aa&&(Aa.setCase(za),Aa.setGlobal(aa));return Aa}}function Oa(){var za,aa;this.setCase=function(Aa){za=Aa};this.setGlobal=function(Aa){aa=Aa};this.getDetail=function(){throw Error("override me");};this.getPrompt=function(Aa){throw Error("override me");};this.protectedMethod={getCase:function(){return za},getGlobal:function(){return aa},getDisplayNameString:function(Aa){for(var ua=aa.getModelerModel(),fa="",u=0;u<Aa.length;u++){var F=
ua.getMetric(Aa[u]).getName();fa+="\u201c"+F+"\u201d";u<Aa.length-1&&(fa+=ka.get("comma","\u3001"))}return fa}}}function ib(){Oa.call(this);this.getDetail=function(){return ka.get("noMetricPrompt","\u6a21\u578b\u4e2d\u672a\u521b\u5efa\u6307\u6807")};this.getPrompt=function(za){return ka.get("noMetricPrompt","\u6a21\u578b\u4e2d\u672a\u521b\u5efa\u6307\u6807")}}function Ya(){Oa.call(this);var za=this.protectedMethod;this.getDetail=function(){var aa=za.getCase().getMetricIds(),Aa=ka.get("invalidFieldRef",
"\u6307\u6807#1\u5f15\u7528\u7684\u5b57\u6bb5\u4e0d\u5b58\u5728");aa=za.getDisplayNameString(aa);return Aa.replace("#1",aa)};this.getPrompt=function(aa){return ka.get("invalidFieldRefPrompt","\u8868\u8fbe\u5f0f\u5f15\u7528\u7684\u5b57\u6bb5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664")}}function Ma(){Oa.call(this);var za=this.protectedMethod;this.getDetail=function(){var aa=za.getCase().getMetricIds(),Aa=ka.get("invalidExprDataType","\u6307\u6807#1\u5f15\u7528\u7684\u5b57\u6bb5\u6570\u636e\u7c7b\u578b\u4e0d\u5339\u914d");
aa=za.getDisplayNameString(aa);return Aa.replace("#1",aa)};this.getPrompt=function(aa){return ka.get("invalidExprDataTypePrompt","\u8868\u8fbe\u5f0f\u5f15\u7528\u7684\u5b57\u6bb5\u6570\u636e\u7c7b\u578b\u4e0d\u5339\u914d")}}function ya(){Oa.call(this);var za=this.protectedMethod;this.getDetail=function(){var aa=za.getCase().getMetricIds(),Aa=ka.get("invalidExprMetric","\u6307\u6807#1\u7684\u8868\u8fbe\u5f0f\u4e0d\u6b63\u786e");aa=za.getDisplayNameString(aa);return Aa.replace("#1",aa)};this.getPrompt=
function(aa){return(aa=za.getCase().getMetricPrompt(aa))?aa:ka.get("invalidExprMetricPrompt","\u6307\u6807\u7684\u8868\u8fbe\u5f0f\u4e0d\u6b63\u786e")}}function Da(){Oa.call(this);var za=this.protectedMethod;this.getDetail=function(){var aa=za.getCase().getMetricIds(),Aa=ka.get("invalidDimensionNotExist","\u6307\u6807#1\u4e2d\u7684\u8868\u8fbe\u5f0f\u5f15\u7528\u7684\u7ef4\u5ea6\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664");aa=za.getDisplayNameString(aa);return Aa.replace("#1",aa)};this.getPrompt=
function(aa){return ka.get("invalidDimensionNotExistPrompt","\u8868\u8fbe\u5f0f\u5f15\u7528\u7684\u7ef4\u5ea6\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664")}}function va(){Oa.call(this);var za=this.protectedMethod;this.getDetail=function(){var aa=za.getCase().getMetricIds(),Aa=ka.get("invalidDimensionGranularityNotMatch","\u6307\u6807#1\u4e2d\u7684\u8868\u8fbe\u5f0f\u5f15\u7528\u7684\u65e5\u671f\u7ef4\u7c92\u5ea6\u4e0d\u5339\u914d");aa=za.getDisplayNameString(aa);return Aa.replace("#1",aa)};this.getPrompt=
function(aa){return ka.get("invalidDimensionGranularityNotMatchPrompt","\u8868\u8fbe\u5f0f\u5f15\u7528\u7684\u65e5\u671f\u7ef4\u7c92\u5ea6\u4e0d\u5339\u914d")}}function I(){Oa.call(this);var za=this.protectedMethod;this.getDetail=function(){var aa=za.getCase().getMetricIds(),Aa=ka.get("invalidDimensionTypeNotMatch","\u6307\u6807#1\u4e2d\u7684\u8868\u8fbe\u5f0f\u5f15\u7528\u7684\u7ef4\u5ea6\u7c7b\u578b\u4e0d\u5339\u914d");aa=za.getDisplayNameString(aa);return Aa.replace("#1",aa)};this.getPrompt=function(aa){return ka.get("invalidDimensionTypeNotMatchPrompt",
"\u8868\u8fbe\u5f0f\u5f15\u7528\u7684\u7ef4\u5ea6\u7c7b\u578b\u4e0d\u5339\u914d")}}function K(){Oa.call(this);var za=this.protectedMethod;this.getDetail=function(){var aa=za.getCase().getMetricIds(),Aa=ka.get("invalidFieldFilterRef","\u6307\u6807#1\u8fc7\u6ee4\u6761\u4ef6\u8bbe\u7f6e\u4e0d\u5b8c\u6574");aa=za.getDisplayNameString(aa);return Aa.replace("#1",aa)};this.getPrompt=function(aa){return ka.get("invalidFieldFilterRefPrompt","\u8fc7\u6ee4\u6761\u4ef6\u8bbe\u7f6e\u4e0d\u5b8c\u6574")}}function J(){Oa.call(this);
var za=this.protectedMethod;this.getDetail=function(){return ka.get("someDimensionInvalid","\u5b58\u5728\u4e0d\u5408\u6cd5\u7684\u7ef4\u5ea6")};this.getPrompt=function(){return 2<=za.getGlobal().getModelerModel().getAllTable().length?ka.get("dimensionInvalid","\u7ef4\u5ea6\u4e0d\u5408\u6cd5"):ka.get("fieldNotFound","\u5b57\u6bb5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664")}}function X(){Oa.call(this);this.getDetail=function(){return ka.get("someDimensionInvalid","\u5b58\u5728\u4e0d\u5408\u6cd5\u7684\u7ef4\u5ea6")};
this.getPrompt=function(){return ka.get("dimensionInvalid","\u7ef4\u5ea6\u4e0d\u5408\u6cd5")}}function Z(){Oa.call(this);this.getDetail=function(){return ka.get("somePublicDimensionInvalid","\u516c\u5171\u7ef4\u5ea6\u8bbe\u7f6e\u4e0d\u5b8c\u6574")};this.getPrompt=function(){return""}}function ra(){Oa.call(this);this.getDetail=function(){return ka.get("incompleteMaterializedConfig","\u7269\u5316\u5b58\u50a8\u8bbe\u7f6e\u4e0d\u5b8c\u6574")};this.getPrompt=function(){return""}}"undefined"==typeof com&&
(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.metricdesigner&&(com.kingdee.bos.qing.modeler.designer.metricdesigner={});
var N=com.kingdee.bos.qing.modeler.designer.metricdesigner;N.ModelerChecker=qa;var g,ka,C,ia,M,la,na,xa;(function(){var za=com.kingdee.bos.qing.ui.component;g=za.MessageDialog;za=com.kingdee.bos.qing.framework.common;ka=za.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.modeler.designer);za=com.kingdee.bos.qing.modeler.designer;na=za.DesignerFacade;M=za.QingModeler;la=za.ModelerModel;C=N.ModelerValidity;ia=N.MetricModelerInvalidityCase;xa=N.MetricModeler})();N.MetricStateMonitor=new function(){var za=
{},aa={},Aa={},ua={},fa=[],u=new Ua,F,Q,r;this.setFunUpdateTableArea=function(n){Q=n};this.setFunUpdateSingleTable=function(n){r=n};this.getFunUpdateTableArea=function(){return Q};this.addStateChangeListener=function(n){fa.push(n)};this.registGlobal=function(n){F=n};this.setModelValidity=function(n){za={};aa={};Aa={};ua={};n=n.getCases();for(var t=0;t<n.length;t++){var a=n[t];if(a.getMetricIds)for(var c=a.getMetricIds(),m=u.getHandler(a,null),b=0;b<c.length;b++){var d=c[b],h=m.getPrompt(d);aa[d]=
h}if(a.getDimensionIds)for(c=a.getDimensionIds(),m=u.getHandler(a,F),h=m.getPrompt(),b=0;b<c.length;b++)Aa[c[b]]=h;if(a.getPublicDimensionIds)for(c=a.getPublicDimensionIds(),m=u.getHandler(a,F),h=m.getPrompt(),b=0;b<c.length;b++)ua[c[b]]=h;a.getInvalidTableMap&&(za=a.getInvalidTableMap())}L()};this.addInvalidMetric=function(n,t){aa[n]=t;L()};this.removeInvalidMetric=function(n){aa[n]=null;L()};this.addInvalidFilterTable=function(n,t){var a=n.getIntegration().getMapTableException();a||(a={});a[t.getUid()]||
(w(n),r&&r(t))};this.removeInvalidFilterTable=function(n,t){var a=n.getIntegration().getMapTableException();a&&(a=a[t.getUid()])&&a.invalidityType==ia.TYPE_INVALID_TABLE_FILTER&&(w(n),r&&r(t))};this.getInvalidTableMap=function(){return za};this.getInvalidPrompt=function(n){return aa[n]};this.getInvalidMetricMap=function(){return aa};this.setInvalidDimensionMap=function(n){Aa=n};this.getInvalidDimensionMap=function(){return Aa};this.setInvalidPublicDimensionMap=function(n){ua=n};this.getInvalidPublicDimensionMap=
function(){return ua};this.removeInvalidDimensionId=function(n){delete Aa[n]};this.addInvalidDimensionId=function(n,t){Aa[n]=t};this.checkDimensionInvalid=function(n){return-1<Object.keys(Aa).indexOf(n)};this.getInvalidDimensionPrompt=function(n){return Aa[n]};this.copyInvalidDimensionMap=function(){for(var n={},t=Object.keys(Aa),a=0;a<t.length;a++){var c=t[a];n[c]=Aa[c]}return n};this.copyInvalidPublicDimensionMap=function(){for(var n={},t=Object.keys(ua),a=0;a<t.length;a++){var c=t[a];n[c]=ua[c]}return n};
this.copyExistDimensionInvalidStatus=function(n){for(var t={},a=[],c=0;c<n.length;c++)a.push(n[c].getDimensionId());n=Object.keys(Aa);for(c=0;c<n.length;c++){var m=n[c];-1!=a.indexOf(m)&&(t[m]=Aa[m])}Aa=t};this.updateInvalidDimensionMap=function(n){var t=n.getAllDimension();Aa={};for(var a=0;a<t.length;a++){var c=t[a],m=c.getDimensionId(),b=n.getPublicDimensionById(c.getPublicDimensionId());b?N.PublicDimensionUtil.isPdTypeInvalidWhenDateDimension(b,c)&&(Aa[m]=ka.get("dimensionInvalid","\u7ef4\u5ea6\u4e0d\u5408\u6cd5")):
Aa[m]=ka.get("dimensionInvalid","\u7ef4\u5ea6\u4e0d\u5408\u6cd5")}};this.updateInvalidDIMMapWhenDeleteTable=function(n){var t=n.getAllDimension();Aa={};for(var a=n.getAllTable(),c=0;c<t.length;c++){var m=t[c],b=m.getDimensionId(),d=n.getPublicDimensionById(m.getPublicDimensionId());if(d){var h=d.getFieldByIndex(0);2!=a.length||h.isExist()?!(2<a.length)||d.isFieldsCompleted()&&d.isDataTypeConsistent()?N.PublicDimensionUtil.isPdTypeInvalidWhenDateDimension(d,m)?Aa[b]=ka.get("dimensionInvalid","\u7ef4\u5ea6\u4e0d\u5408\u6cd5"):
N.PublicDimensionUtil.isPdTypeInvalidWhenNormalDimension(d,m)&&(Aa[b]=ka.get("dimensionInvalid","\u7ef4\u5ea6\u4e0d\u5408\u6cd5")):Aa[b]=ka.get("dimensionInvalid","\u7ef4\u5ea6\u4e0d\u5408\u6cd5"):Aa[b]=ka.get("fieldNotFound","\u5b57\u6bb5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664")}else Aa[b]=2==a.length?ka.get("fieldNotFound","\u5b57\u6bb5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664"):ka.get("dimensionInvalid","\u7ef4\u5ea6\u4e0d\u5408\u6cd5")}};this.updateInvalidPublicDimensionMap=function(n){ua=
{};n=n.getPublicDimensions();for(var t=0;t<n.length;t++){var a=n[t];a.isFieldsCompleted()&&a.isDataTypeConsistent()||(ua[a.getId()]="")}};this.clear=function(){aa={};L()};var w=function(n){var t=new qa;t.setGlobal(n);n=n.getModelerModel();var a=new M;a.setModelerModel(n);t.backgroundCheck(a.toJsonObject())},L=function(){for(var n=0;n<fa.length;n++)fa[n](aa)}}})();(function(){function qa(){var ja=this,V,Ka,Qa,ea,P,da;this.getJqUi=function(){V||(V=$("<div>"),V.addClass("modeler-designer-sourcearea-delete-btn"),na.backgroundWithHover(V,"menu"),V.on("click",cb),ja.updateMenuState(Qa));return V};this.setStatus=function(y){Qa=y};this.setFilterListener=function(y){ea=y};this.setSelectFieldListener=function(y){P=y};this.setDeleteItemListener=function(y){da=y};var pa=function(y){var T=new F,U=Va(g.get("filter","\u8fc7\u6ee4"),ea,!0,null,y);y=Va(g.get("selectField",
"\u9009\u62e9\u5b57\u6bb5"),P,!0,null,y);var Fa=Va(g.get("delete","\u5220\u9664"),da,!1,"delete",!0);T.addItemModel(U);T.addItemModel(y);T.addSeperator();T.addItemModel(Fa);return T};this.updateMenuState=function(y){y=pa(y);Ka=new u;Ka.setModel(y);Ka.setIconSetter(function(T,U){na.background(T,U)})};var Va=function(y,T,U,Fa,Sa){y=u.createActionMenuItem(y+(U?"...":""),T);y.setEnabled(Sa);Fa&&y.setIconName(Fa);return y},cb=function(){if(Ka.isShowing())Ka.hide();else{var y=V.outerHeight(),T=$(document.body),
U=[0,y];U=C.upwardCoordinate(V[0],U,T[0]);Ka.show(T,U[0],U[1],V,!0,[0,-y])}}}function Ua(ja,V){l.call(this);var Ka=this,Qa=this.protectedMethod,ea=ja.getSelectedFields(),P=ja.getTableName(),da;this.showSelectFieldDialog=function(){(new a(V.getRemoteImpl(),function(y){var T=new h;T.fromJsonObject(y);pa(T)})).getMeta(N.SourceUtil.getTableSource(V,ja),ja)};var pa=function(y){Ka.setSize(800,520);Ka.setPosition(window.innerWidth-800>>1,window.innerHeight-520>>1);Qa.setContentPaneCreator(function(){var U=
$("<div>");da=d.createSelectFieldToDialog(y.getSourceType());if(ea){for(var Fa=[],Sa=0;Sa<ea.length;Sa++)Fa.push(ea[Sa].getName());da.setSelectedPropertyName(Fa)}da.setMeta(y);da.setCurrentTableName(P);da.setWidth(800);da.getJqUi().appendTo(U);return U});var T=y.getSourceType()==t.SOURCE_TYPE_CURRENT_ENTITY_SOURCE?g.get("selectEntityAndField","\u9009\u62e9\u6570\u636e\u8868\u53ca\u5b57\u6bb5"):g.get("selectField","\u9009\u62e9\u5b57\u6bb5");Qa.setTitle(T);Qa.setClosingAction(Va);Qa.setClosingChecker(cb);
Ka.showDialog()},Va=function(y){if(y){y=da.getSelectedProperties();var T;da.getIsEntityView()&&(T=da.getSelectedEntityName());var U=new W;U.setValue(ja,ea,y,P,T);V.getCommandManager().perform(U);Ea.occur(Ea.FUNCTION,Ea.SELECT_FIELD)}},cb=function(){var y=da.getSelectedEntityName();if(da.getIsEntityView()){if(!y)return Qa.getMessageCurtain().showPrompt(g.get("needSelectedEntity","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b9e\u4f53\u6216\u8005\u5206\u5f55\u8868\u3002")),!1;da.setCurrentTableName(y)}return(y=
da.getSelectedProperties())&&0==y.length?(Qa.getMessageCurtain().showPrompt(g.get("noSelectedField","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b57\u6bb5\u3002")),!1):!0}}function Oa(){za.AbstractWizardStep.call(this);var ja=this,V,Ka,Qa,ea;this.getSubTitle=function(){return g.get("selectDataSource","\u9009\u62e9\u6570\u636e\u6e90")};this.setGlobal=function(da){ea=da};this.getJqUi=function(da){V||(Ka=da,V=$("<div>"),Qa=new xa,Qa.setRemoteImpl(n.getRemoteImpl()),Qa.setMultiSelect(!1),Qa.setContainer(V),
Qa.loadDataSource());return V};this.updateUi=function(){Qa&&Qa.updateUiByObserver()};this.intoThisStep=function(da,pa){pa&&Qa&&Qa.updateUiByObserver()};this.outThisStep=function(da,pa){if((da=Qa.getSelected())&&0!=da.length){var Va=da[0];da=new (n.getModelSetSourceFacade())(n.getRemoteImpl(),function(cb){for(var y=!1,T=0;T<cb.length;T++)if(cb[T].id==Va.getId()){y=!0;break}y?P(pa,Va):(y=g.get("sourceDeleted","\u201c#1\u201d\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002"),
y=y.replace("#1",Va.getSourceName()),Ka.getMessageCurtain().showPrompt(y),Qa.rePaintSource(cb),pa(ja))});da.setBlockingJqUi(V);da.designerLoadSources()}else Ka.getMessageCurtain().showPrompt(g.get("noSourceSelected","\u8bf7\u9009\u62e9\u53ef\u7528\u7684\u6570\u636e\u6e90\u3002")),pa(ja)};var P=function(da,pa){var Va=g.get("sourceCanNotSelect","\u6570\u636e\u6e90\u8fde\u63a5\u5f02\u5e38\uff0c\u65e0\u6cd5\u9009\u62e9\u3002"),cb=new a(ea.getRemoteImpl(),function(y){y?da(N.ImportTableStepCreator.getSteps(pa,
ea)):(Ka.getMessageCurtain().showPrompt(Va),da(ja))},function(y,T){"206"==y.toString().substr(0,3)?Va=g.get("openAPINotSelect","OpenAPI\u7684\u8fde\u63a5\u4fe1\u606f\u65e0\u6548\uff0c\u65e0\u6cd5\u9009\u62e9\u3002"):-1!=T.indexOf("2030900")&&(Va=g.get("xmlCanNotSelect","xml\u6587\u4ef6\u5904\u7406\u5931\u8d25\uff0c\u65e0\u6cd5\u9009\u62e9\u3002"));Ka.getMessageCurtain().showPrompt(Va);da(ja);return!0});cb.setBlockingJqUi(V);cb.checkConnection(pa.getId())}}function ib(){za.AbstractWizardStep.call(this);
var ja;this.setSource=function(V){ja=V};this.getSource=function(){return ja}}function Ya(){function ja(){function bb(Ab){KTDefaultCellRender.call(this,Ab);var Eb=this,Kb=this.paintCellUI;this.paintCellUI=function(Bb,Jb){var Ob=Eb.getCurrentRowIdx(),yb=Eb.getCurrentRow(),wb=Eb.getCurrentColIdx(),Pb=yb.getUserObject();yb=new M;yb.setFormatString("#,##0.00");Ob<L.getHeadRowCount()?(Kb(Bb,Jb),Bb&&(Bb=$(Bb).children(),Bb.css({"text-align":"left","padding-left":"8px","padding-right":"8px"}),Bb.children()&&
Bb.children().css("right",""))):Pb?(Jb=tb.getField(wb).getOutputDataType(),wb=Pb[wb],null==wb||void 0==wb?wb="":Jb==f.DT_DATE?(yb=new ia,yb.setFormatString("yyyy-MM-dd"),wb=yb.format(wb)):Jb==f.DT_DATETIME?(yb=new ia,yb.setFormatString("yyyy-MM-dd HH:mm:ss"),wb=yb.format(wb)):Jb==f.DT_BOOLEAN?wb=wb?"true":"false":Jb==f.DT_NUMBER&&(wb=yb.format(wb)),yb=$("<div>"),yb.text(wb),yb.attr("title",wb),yb.css({"padding-left":"8px","padding-right":"8px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap",
"text-align":"left","line-height":"28px"}),yb.appendTo(Bb)):(Kb(Bb,Jb),Bb&&(Bb=$(Bb).children())&&Bb.css({overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}))}}var fb=this,ob,gb,mb,tb,vb,Cb,Hb,Fb;this.getJqUi=function(){ob||Wb();return ob};this.updateTableUi=function(){L.refresh(mb)};this.updatePreviewTable=function(Ab,Eb){var Kb=new Date;Hb=Kb;var Bb=rb(Ka.getSource()),Jb=pb(Bb),Ob=new a(U.getRemoteImpl(),function(yb){var wb=new k;wb.fromJsonObject(yb);if(0==wb.getAllField().length)wb=
g.get("tableNoData","\u8be5\u8868\u6ca1\u6709\u6570\u636e\uff0c\u65e0\u6cd5\u88ab\u9009\u4e2d\u3002"),Qa.getMessageCurtain().showPrompt(wb),da.showWaitingTips(wb),Qb(Ab,Eb);else if(Hb==Kb){tb=wb;Fb&&Fb.hide();Cb&&Cb.show();vb.setOutsideVisible(!1);var Pb=L.createHeadRow(mb),Rb=wb.getAllField(),Sb=Math.min(Rb.length,50);for(yb=0;yb<Sb;yb++){var Tb=Rb[yb],Ub=Tb.getOutputDataType(),Xb=Ub==f.DT_INT||Ub==f.DT_NUMBER,Vb=mb.addColumn(Tb.getAlias());Vb.setStyle(L.getColumnStyle(Xb));Vb.setWidth(Yb(Ub));Pb.getCell(yb).setValue(Tb.getAlias())}Pb=
Math.min(wb.getRowCount(),10);for(yb=0;yb<Pb;yb++)Rb=L.createRow(mb),Sb=wb.getOneRow(yb),Rb.setUserObject(Sb);L.refresh(mb);vb.setOutsideVisible(!0);0==tb.getRowCount()?(wb=g.get("noPreviewData","\u6ca1\u6709\u6570\u636e"),Mb(wb,!1)):(wb=10<tb.getRowCount(),yb=50<=tb.getColumnCount(),wb||yb?!wb&&yb?(wb=g.get("totalRowsData","\u603b\u5171#1\u884c\u6570\u636e").replace("#1",tb.getRowCount()),wb+=g.get("previewTipsComma",",")+g.get("dataShownCols","\u4ec5\u9884\u89c8\u524d#1\u5217\u6570\u636e").replace("#1",
50),Mb(wb,!1)):(wb&&!yb?wb=g.get("dataShownRows","\u4ec5\u9884\u89c8\u524d#1\u884c\u6570\u636e").replace("#1",10):(wb=g.get("dataShownRowsAndCols","\u4ec5\u9884\u89c8\u524d#1\u884c\u3001\u524d#2\u5217\u6570\u636e"),wb=wb.replace("#1",10),wb=wb.replace("#2",50)),Zb(wb,Kb)):(wb=g.get("totalRowsData","\u603b\u5171#1\u884c\u6570\u636e").replace("#1",tb.getRowCount()),Mb(wb,!1)))}},function(yb){Cb&&Cb.hide();if(2030800==yb)return Qa.getMessageCurtain().showError(g.get("fileEncodingSelectTips","\u7f16\u7801\u4e0d\u6b63\u786e\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u6587\u4ef6\u7f16\u7801\u3002")),
!0});Ob.setShowBlocking(!1);Ob.getTablePreviewData(Bb,Jb,[],11);fb.showWaitingTips(g.get("loadingPreviewData","\u6b63\u5728\u83b7\u53d6\u9884\u89c8\u6570\u636e\uff0c\u8bf7\u7a0d\u5019\u2026\u2026"))};this.isEnablePreview=function(){return gb.isChecked()};this.showWaitingTips=function(Ab){L.clear(mb);L.refresh(mb);Cb&&Cb.show();Fb||(Fb=$("<div>"),Fb.css({position:"absolute",left:"0","padding-left":"20px","line-height":"30px","white-space":"pre-wrap",color:"#666",top:"10px"}),Fb.appendTo(Cb));Fb.text(Ab);
Fb.show()};var Mb=function(Ab,Eb){Eb?(Eb=mb.getRowsCount()-1,mb.getRow(Eb).getCell(0).setValue(Ab)):(Eb=L.createRow(mb),Eb.getCell(0).setValue(Ab),Ab=new KTStyle,Ab.setBackgroundColor(com.kingdee.bos.qing.common.CommonTableSkin.ODD_ROW_BACKGROUND_COLOR),Eb.setStyle(Ab),Ab=new KTStyle,Ab.setTextAlign("left"),Eb.getCell(0).setStyle(Ab));L.refresh(mb)},Zb=function(Ab,Eb){var Kb=rb(Ka.getSource()),Bb=pb(Kb),Jb=new a(U.getRemoteImpl(),function(Ob){if(Eb==Hb)try{Ab=g.get("totalRowsData","\u603b\u5171#1\u884c\u6570\u636e").replace("#1",
Ob+"")+g.get("previewTipsComma",",")+Ab,Mb(Ab,!0)}catch(yb){L.refresh(mb)}});Jb.setShowBlocking(!1);Jb.getDataRowCount(Kb,Bb,[]);Mb(g.get("loadingTotalRows","\u6b63\u5728\u8ba1\u7b97\u603b\u884c\u6570\uff0c\u8bf7\u7a0d\u5019\u2026\u2026"),!1)},Yb=function(Ab){switch(Ab){case f.DT_INT:case f.DT_NUMBER:return 90;case f.DT_DATE:return 80;case f.DT_DATETIME:return 130;case f.DT_BOOLEAN:return 40;default:return 120}},Wb=function(){ob=$("<div>");var Ab=(new fa(g.get("preview","\u9884\u89c8"))).getJqUi();
Ab.addClass("metric-designer-select-table-preview-label");gb=new ua;gb.setText(g.get("enablePreview","\u542f\u7528\u9884\u89c8"));gb.setChecked(!0);gb.addCheckedListener(function(Kb,Bb){var Jb=Kb.isChecked();Bb&&(Jb?kb(Kb,Bb):Cb&&Cb.hide())});var Eb=gb.getJqUi();Eb.addClass("metric-designer-select-table-preview-checkbox");mb=L.createTable();mb.setColumnFitVisibleWidth(!1);mb.setSyncUIWhenModelChanged(!0);vb=new bb(mb);vb.setOutsideVisible(!1);mb.setCellRender(vb);Cb=$(mb.getUI());Cb.addClass("metric-designer-select-table-preview-table");
Ab.appendTo(ob);Eb.appendTo(ob);Cb.appendTo(ob)}}function V(bb){KTDefaultCellRender.call(this,bb);var fb=this;this.paintCellUI=function(ob,gb){var mb=fb.getCell().getValue(),tb=mb.getDisplayName(),vb=$("<div>");vb.attr("title",tb);vb.addClass("metric-designer-table-item-container");var Cb=$("<div>");Cb.addClass("metric-designer-table-item-text");ob=$(ob);if(mb instanceof c)Cb.text(tb),Cb.css("left","0px"),Cb.css("top","-2px"),vb.append(Cb),ob.css("left","4px"),ob.append(vb);else{var Hb=Pa.isShowEntityMark()?
mb.getName():mb.getNumber();Hb=tb+"("+Hb+")";Cb.text(nb?Hb:tb);Hb=nb?tb:Hb;Cb.data("mark",Hb);vb.css("margin-left","-16px");tb=Db(mb);vb.append(tb.getJqUi());Hb=$("<div>");Hb.addClass("metric-designer-table-item-icon");var Fb=mb.getType(),Mb="entity"==Fb?"entity-sub":"table";mb==wa&&(Mb="entity"==Fb?"entity-sub":"table_selected");na.background(Hb,Mb);Fb=$("<div>");Fb.addClass("metric-designer-table-item");Fb.append(Hb);Fb.append(Cb);vb.append(Fb);vb.on("click",{jqTableItem:Fb,jqIcon:Hb,node:mb,checkBox:tb},
Ib);wa==mb&&Fb.addClass("metric-designer-table-item-container_selected");ob.css("overflow","visible")}gb?(gb=$(gb),gb.css("overflow","visible"),vb.appendTo(gb)):vb.appendTo(ob)}}ib.call(this);var Ka=this,Qa,ea,P,da,pa,Va,cb,y,T,U,Fa=[],Sa=[],La=[],eb={},ta={},Pa,R,wa,Ia=!1,db=!1,nb=!1;this.setSourceUiModel=function(bb){Pa=bb};this.getSubTitle=function(){return Pa.getTitle()};this.setGlobal=function(bb){U=bb};this.getJqUi=function(bb){if(!ea){ea=$("<div>");pa=$("<div>");Za();sa();T=$("<div>");var fb=
Pa.isShowEntityMark()||Pa.isShowModelNumber()?75:25;T.addClass("metric-designer-select-table-button-area");T.css("height",fb+"px");(Pa.isShowEntityMark()||Pa.isShowModelNumber())&&ab();lb();Va.appendTo(pa);T.appendTo(pa);da=new ja;y=da.getJqUi();y.css("border-left","1px solid #CBCBCB");hb();fb=new aa;fb.setHorizontalSplit(!0);fb.setEnabled(!0);fb.setFirstSize(200,185,300);fb.setSecondSize(520,0,-1);fb.setResizeMode(aa.RESIZE_MODE_SECOND_FIXED);fb.setFirstChild(aa.createChildWrapper(pa));fb.setSecondChild(aa.createChildWrapper(y));
ea.append(fb.getJqUi());Qa=bb}return ea};this.intoThisStep=function(bb,fb){fb&&da.updateTableUi()};this.outThisStep=function(bb,fb){if(bb)fb(null);else{var ob=Ka.getSelectedTableNode();if(0==ob.length)Qa.getMessageCurtain().showPrompt(g.get("needSelectedEntity","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u6570\u636e\u8868\u3002"));else{var gb=U.getModelerModel(),mb=Ka.getSource().getId();for(bb=0;bb<ob.length;bb++){var tb=ob[bb].getName();if(gb.isSameTableAndSourceExist(mb,tb)){var vb=vb?vb+"\uff0c":
"";vb+=tb}}if(vb)fb=g.get("tableExist","\u8868#1\u5df2\u5b58\u5728\u3002").replace("#1",vb),Qa.getMessageCurtain().showPrompt(fb);else{for(bb=0;bb<La.length;bb++)if(vb=La[bb].getUid(),!eb[vb]||!ta[vb])return;fb(null)}}}};this.getSelectedTableNode=function(){return La};this.getSelectedMeta=function(){for(var bb={},fb=0;fb<La.length;fb++){var ob=La[fb].getUid();bb[ob]=eb[ob]}return bb};this.getSelectedNode=function(){for(var bb=[],fb=0;fb<La.length;fb++)bb=bb.concat(ta[La[fb].getUid()]);return bb};
var hb=function(){var bb=new ka;bb.setCallbackImmediately(function(){da.updateTableUi()});bb.observe()},Za=function(){P=new Aa;P.setShowSearchIcon(!0);P.setPlaceholder(Pa.getPlaceHolder());P.setSearchListenerDelay(1E3);P.addSearchListener(function(){qb($.trim(P.getText()))});var bb=P.getJqUi();bb.addClass("metric-designer-select-table-search-box");bb.find(":input").on("keydown",function(ob){13==(ob.keyCode||ob.which||ob.charCode)&&qb($.trim(P.getText()))});var fb=Pa.isShowAppUi()?5:0;bb.css("top",
fb+"px");bb.appendTo(pa)},kb=function(bb,fb){wa&&bb.isChecked()&&(bb=new a(U.getRemoteImpl(),function(ob){var gb=new h;gb.fromJsonObject(ob);(ob=gb.getErrorMap())?(gb=Lb(ob.metricInvalidityType),Qa.getMessageCurtain().showPrompt(gb),da.showWaitingTips(gb)):(Gb(gb,wa),da.updatePreviewTable())},function(ob){return 2030800==ob}),fb=new O,fb.setNamespace(wa.getCommentInfo()),fb.setTableName(wa.getName()),fb.setDisplayName(wa.getDisplayName()),bb.getMeta(rb(Ka.getSource()),fb))},pb=function(bb){var fb=
wa.getName(),ob=new O;ob.setSourceUid(bb.getId());bb=e.getUID(e.NS_TABLE);ob.setTableName(fb);ob.setUid(bb);ob.setDisplayName(wa.getDisplayName());wa.getCommentInfo()&&ob.setNamespace(wa.getCommentInfo());return ob},qb=function(bb){if(0!=Fa.length)if(""==bb)Ia&&(Ia=!1,db?(bb=sb(jb()),ub(bb),0==bb.length&&Wa(g.get("noDataTips","\u6682\u65e0\u6570\u636e"))):ub(Fa));else{Ia=!0;var fb=db?jb():Sa;bb=xb(bb,fb);bb=sb(bb);ub(bb);0==bb.length&&Wa(g.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c"))}},
ub=function(bb){cb&&cb.empty();Ba(bb)},sa=function(){Va=$("<div>");cb=$("<div>");var bb=Pa.getTop(),fb=Pa.getHeight();cb.css({position:"relative",top:bb+"px",height:fb+"px",overflow:"auto"});cb.appendTo(Va);Pa.isShowAppUi()?Ra():(new a(U.getRemoteImpl(),function(ob){R=new c;R.fromJsonObject(ob);ob=R.getChildren();if(0===ob.length)Wa(g.get("noDataTable","\u6682\u65e0\u6570\u636e\u8868"));else{for(var gb=0;gb<ob.length;gb++)zb(ob[gb]);Ba(Fa)}},function(ob,gb){if(gb&&-1!=gb.indexOf("2030900"))return Qa.getMessageCurtain().showError("xml\u6587\u4ef6\u5904\u7406\u5931\u8d25"),
!0})).loadTables(rb(Ka.getSource()))},Ra=function(){var bb=new (n.getMetricDataCenterSelector()),fb=bb.getJqUi();pa.prepend(fb);bb.setFunSelectedChangeListener(function(ob){(new a(U.getRemoteImpl(),function(gb){R=new c;R.fromJsonObject(gb,ob);gb=R.getChildren();if(0===gb.length)Wa(g.get("noDataTable","\u6682\u65e0\u6570\u636e\u8868"));else{Fa=[];for(var mb=0;mb<gb.length;mb++)zb(gb[mb]);Ba(Fa)}})).getDBCenterTables(ob)})},Ba=function(bb){if(0!=bb.length){var fb=new KTable,ob=$(fb.getUI());ob.children().css("overflow-x",
"hidden");fb.setCellRender(new V(fb));fb.setSyncUIWhenModelChanged(!1);fb.setLargeDataMode(!0,!1);fb.addColumn().setWidth(300);fb.addTreeExpandListener(function(){var gb=fb.keepScrollStatus();gb.v&&(gb.v+=1);fb.restoreScrollStatus(gb)});Ha(fb,bb);fb.updateUI();ob.appendTo(cb)}},Ha=function(bb,fb){for(var ob=0;ob<fb.length;ob++){var gb=fb[ob],mb=bb.addRow();mb.setHeight(23);var tb=mb.getCell(0);tb.setValue(gb);gb=gb.getSubNodeLevel();var vb=new KTCellTreeModel(gb);vb.setExpanded(Ia||db);!db&&!Ia&&
0<gb&&mb.setHide(!0);tb.setTreeModel(vb)}},Wa=function(bb){bb=new fa(bb);bb.setAlign(fa.ALIGN_CENTER);bb=bb.getJqUi();bb.css({position:"absolute",top:"50%",left:"50%",width:"180px","margin-left":"-95px","margin-top":"-20px"});bb.children().eq(0).css("color","#999999");bb.appendTo(cb)},ab=function(){var bb=new fa,fb=Pa.isShowModelNumber()?g.get("displayModelNumber","\u663e\u793a\u6a21\u578b\u7f16\u7801"):g.get("displayEntityMark","\u663e\u793a\u5b9e\u4f53\u6807\u8bc6");bb.setText(fb);bb=bb.getJqUi();
bb.attr("title",fb);C.layoutCtrlWithLRTB(bb,8,null,105,10,null,23);bb.appendTo(T);fb=new r;fb.setOn(!1);fb.addStateChangeListener(function(ob,gb,mb){ob=(nb=mb)?Pa.getCodePlaceHolder():Pa.getPlaceHolder();P.setPlaceholder(ob);if(gb)for(gb=$(".metric-designer-table-item-text"),ob=0;ob<gb.length;ob++)if(mb=gb.eq(ob),mb.data("mark")){var tb=mb.data("mark"),vb=mb.text();mb.text(tb);mb.parents(".metric-designer-table-item").attr("title",tb);mb.data("mark",vb)}});fb=fb.getJqUi();C.layoutCtrlWithLRTB(fb,
120,null,35,10,null,23);fb.appendTo(T)},lb=function(){var bb=new fa,fb=g.get("showOnlyChecked","\u4ec5\u663e\u793a\u9009\u4e2d\u9879");bb.setText(fb);bb=bb.getJqUi();bb.attr("title",fb);fb=new r;fb.setOn(!1);fb.addStateChangeListener(function(gb,mb,tb){db=tb;mb&&0!=Fa.length&&(db||Ia?(gb=Sa,db&&(gb=jb()),Ia&&(gb=xb(P.getText(),gb)),gb=sb(gb),ub(gb),0==gb.length&&Wa(g.get("noDataTips","\u6682\u65e0\u6570\u636e"))):(gb=Fa,ub(gb)))});fb=fb.getJqUi();var ob=Pa.isShowEntityMark()||Pa.isShowModelNumber()?
40:2;C.layoutCtrlWithLRTB(bb,8,null,105,ob,null,23);C.layoutCtrlWithLRTB(fb,120,null,35,ob,null,23);bb.appendTo(T);fb.appendTo(T)},sb=function(bb){for(var fb=[],ob=[],gb=0;gb<bb.length;gb++){for(var mb=[],tb=bb[gb],vb=tb;vb;){vb=vb.getParentNode();if(vb==R)break;-1==fb.indexOf(vb)&&(mb.unshift(vb),fb.push(vb))}mb.push(tb);ob=0==gb?mb:ob.concat(mb)}return ob},xb=function(bb,fb){bb=bb.toLowerCase();for(var ob=[],gb=0;gb<fb.length;gb++){var mb=fb[gb];nb?(-1!=(Pa.isShowEntityMark()?mb.getName():mb.getNumber()).toLowerCase().indexOf(bb)||
-1!=mb.getDisplayName().toLowerCase().indexOf(bb))&&ob.push(mb):-1!=mb.getDisplayName().toLowerCase().indexOf(bb)&&ob.push(mb)}return ob},jb=function(){return 0==La.length?[]:Sa.filter(function(bb){return-1!=La.indexOf(bb)})},rb=function(bb){var fb=new b;fb.setName(bb.getSourceName());fb.setSourceType(bb.getSourceType());fb.setSourceId(bb.getId());fb.setModelId(n.getModelId());return fb},zb=function(bb){Fa.push(bb);if(bb instanceof m)Sa.push(bb);else if(bb=bb.getChildren())for(var fb=0;fb<bb.length;fb++)zb(bb[fb])},
Db=function(bb){var fb=new ua;fb.setUserObject(bb);for(var ob=0;ob<La.length;ob++)if(La[ob]==bb){fb.setChecked(!0);break}fb.addCheckedListener(function(gb,mb){if(mb)if(gb.isChecked())La.push(bb);else for(gb=0;gb<La.length;gb++)if(La[gb]==bb){La.splice(gb,1);break}});fb.getJqUi().addClass("metric-designer-table-item-checkbox");return fb},Ib=function(bb){var fb=bb.data.node,ob=cb.find(".metric-designer-table-item-container_selected");ob.removeClass("metric-designer-table-item-container_selected");"entity"!=
fb.getType()&&(ob=ob.children().eq(0),na.background(ob,"table"),na.background(bb.data.jqIcon,"table_selected"));bb.data.jqTableItem.addClass("metric-designer-table-item-container_selected");if(wa!=fb){wa=fb;ob=new a(U.getRemoteImpl(),function(mb){var tb=bb.data.checkBox,vb=new h;vb.fromJsonObject(mb);(mb=vb.getErrorMap())?(Qb(tb,fb),tb=Lb(mb.metricInvalidityType),Qa.getMessageCurtain().showPrompt(tb),da.showWaitingTips(tb)):(da.isEnablePreview()&&da.updatePreviewTable(tb,fb),Gb(vb,fb))},function(mb){return 2030800==
mb});var gb=new O;gb.setNamespace(fb.getCommentInfo());gb.setTableName(fb.getName());gb.setDisplayName(fb.getDisplayName());ob.getMeta(rb(Ka.getSource()),gb)}},Gb=function(bb,fb){var ob=(new Date).getTime();fb.setUid(ob);eb[ob]=bb;fb=fb.getCommentInfo();var gb=bb.getTableNode();bb=[];if(gb){var mb=new c;mb.fromJsonObject(gb);mb.setCommentInfo(fb);mb.setUid(ob);mb.getName()&&bb.push(mb);gb=mb.getChildren();if(0<gb.length)for(mb=0;mb<gb.length;mb++)gb[mb].setUid(ob),gb[mb].setCommentInfo(fb),Nb(gb[mb],
bb)}0<bb.length&&(ta[ob]=bb)},Qb=function(bb,fb){bb.setChecked(!1);bb.setEnabled(!1);for(bb=0;bb<La.length;bb++)if(La[bb]==fb){La.splice(bb,1);break}},Lb=function(bb){if(!bb)return g.get("tableNoSelect","\u8be5\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u88ab\u9009\u4e2d\u3002");switch(bb){case x.TYPE_MODEL_CYCLE_REFERENCE:return g.get("modelCycleNoSelect","\u8be5\u6a21\u578b\u5b58\u5728\u5faa\u73af\u5f15\u7528\uff0c\u65e0\u6cd5\u88ab\u9009\u4e2d\u3002");default:return g.get("modelNoSelect",
"\u8be5\u6a21\u578b\u5df2\u635f\u574f\uff0c\u65e0\u6cd5\u88ab\u9009\u4e2d\u3002")}},Nb=function(bb,fb){fb.push(bb);if(bb instanceof c&&(bb=bb.getChildren()))for(var ob=0;ob<bb.length;ob++)Nb(bb[ob],fb)}}function Ma(){za.AbstractWizardStep.call(this);var ja,V,Ka,Qa,ea,P,da=[],pa,Va,cb,y,T;this.getSubTitle=function(){return g.get("selectField","\u9009\u62e9\u5b57\u6bb5")};this.setGlobal=function(ta){V=ta};this.getJqUi=function(ta){Ka||(ja=ta,Ka=$("<div>"),pa=$("<div>"),ta=(new fa(g.get("selected","\u5df2\u9009"))).getJqUi(),
ta.addClass("metric-designer-select-field-label"),pa.append(ta),Va=$("<div>"),Va.addClass("metric-designer-select-field-table-area"),Va.appendTo(pa),cb=$("<div>"),cb.css("border-left","1px solid #CBCBCB"),ta=new aa,ta.setHorizontalSplit(!0),ta.setEnabled(!0),ta.setFirstSize(200,185,300),ta.setSecondSize(520,-1,530),ta.setResizeMode(aa.RESIZE_MODE_SECOND_FIXED),ta.setFirstChild(aa.createChildWrapper(pa)),ta.setSecondChild(aa.createChildWrapper(cb)),ta.getJqUi().appendTo(Ka),U());return Ka};this.intoThisStep=
function(ta,Pa){Qa=ta.getSource();T=ta.getSelectedMeta();ea=ta.getSelectedNode();U()};this.outThisStep=function(ta,Pa){if(!ta)if(Qa.getSourceType()==t.SOURCE_TYPE_CURRENT_ENTITY_SOURCE){for(ta=0;ta<P.length;ta++){var R=P[ta];R.getCheckBox().isChecked()&&!y[R.getIdx()]&&eb(R)}a:{for(ta=0;ta<da.length;ta++)if(da[ta].isChecked()){ta=!0;break a}ta=!1}if(!ta){ja.getMessageCurtain().showPrompt(g.get("needSelectedEntity","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u6570\u636e\u8868\u3002"));return}a:{for(ta=
0;ta<da.length;ta++)if(R=da[ta],R.isChecked()&&(R=R.getSelectedField(y))&&0==R.length){ta=!1;break a}ta=!0}if(!ta){ja.getMessageCurtain().showPrompt(g.get("ensureHasSelectedField","\u8bf7\u786e\u4fdd\u6bcf\u4e2a\u6570\u636e\u8868\u90fd\u6709\u9009\u4e2d\u5b57\u6bb5\u3002"));return}}else{for(ta=0;ta<P.length;ta++)R=P[ta],y[R.getIdx()]||(R=eb(R),R.appendTo(cb),R.hide());R=Object.keys(y);for(ta=0;ta<R.length;ta++){var wa=y[R[ta]].getSelectedProperties();if(wa&&0==wa.length){ja.getMessageCurtain().showPrompt(g.get("ensureHasSelectedField",
"\u8bf7\u786e\u4fdd\u6bcf\u4e2a\u6570\u636e\u8868\u90fd\u6709\u9009\u4e2d\u5b57\u6bb5\u3002"));return}}}Pa(null)};this.isLastStep=function(){return!0};this.over=function(ta){if(ta){ta=V.getModelerModel();for(var Pa=ta.getAllSource(),R,wa=0;wa<Pa.length;wa++){var Ia=Pa[wa];if(Ia.getSourceId()==Qa.getId()){R=Ia;break}}if(!R){R=new b;R.setId(e.getUID(e.NS_SOURCE));R.setSourceId(Qa.getId());R.setName(Qa.getSourceName());var db=R}Pa=Qa.getSpecificType()?Qa.getSpecificType():Qa.getSourceType();(wa=V.getIntegration().getMapSourceType())||
(wa={});wa[Qa.getId()]=Pa;V.getIntegration().setMapSourceType(wa);var nb=Fa(R);0!=nb.length&&(0==ta.getAllTable().length&&1==nb.length?(R=new oa,R.setValue(db,nb,V),V.getCommandManager().perform(R)):N.PublicDimensionUtil.addTablesToPublicDimensions(db,nb,V,Ka,function(hb){var Za=new oa;Za.setValue(db,nb,V,hb);V.getCommandManager().perform(Za)}))}};var U=function(){if(Ka&&(P=[],y={},ea&&Qa))if(Va.empty(),cb.empty(),Qa.getSourceType()==t.SOURCE_TYPE_CURRENT_ENTITY_SOURCE){var ta=new I;da.push(ta);for(var Pa=
0;Pa<ea.length;Pa++){var R=ea[Pa],wa=R.getSubNodeLevel(),Ia=new va(Pa,wa);0==wa&&0!=Pa&&(ta=new I,da.push(ta));ta.pushEntityItem(Ia);Ia.setCheckCallback(ta.getCheckListener());Sa(Ia,R);0==Pa&&Ia.setSelected(!0)}}else{for(ta=0;ta<ea.length;ta++)Pa=ea[ta],R=new Da(ta),Sa(R,Pa);P[0].setSelected(!0)}},Fa=function(ta){var Pa=V.getModelerModel().getAllTable(),R=[];if(Qa.getSourceType()==t.SOURCE_TYPE_CURRENT_ENTITY_SOURCE)for(var wa=0;wa<da.length;wa++){var Ia=da[wa];if(Ia.isChecked()){var db=R,nb=db.push,
hb=ta,Za=new O;Za.setSourceUid(hb.getId());hb=e.getUID(e.NS_TABLE);Za.setSelectedFields(Ia.getSelectedField(y));Za.setTableName(Ia.getTableName());Za.setUid(hb);Za.setDisplayName(Ia.getDisplayName());Za.setNamespace(Ia.getCommentInfo());nb.call(db,Za)}}else for(wa=0;wa<P.length;wa++)nb=P[wa],hb=ta,Ia=nb.getTableNode(),Za=Ia.getName(),db=new O,db.setSourceUid(hb.getId()),hb=e.getUID(e.NS_TABLE),db.setTableName(Za),db.setUid(hb),db.setDisplayName(Ia.getDisplayName()),Ia.getCommentInfo()&&db.setNamespace(Ia.getCommentInfo()),
Ia=y[nb.getIdx()],Ia||(eb(nb),Ia=y[nb.getIdx()]),nb=Ia.getSelectedProperties(),db.setSelectedFields(nb),R.push(db);ta=[];for(wa=0;wa<R.length;wa++){db=R[wa];a:{nb=Pa;Ia=db;for(Za=0;Za<nb.length;Za++)if(Ia.isSame(nb[Za])){nb=!0;break a}nb=!1}nb||ta.push(db)}return ta},Sa=function(ta,Pa){ta.setTableNode(Pa);ta.getJqUi().appendTo(Va);ta.setSelectedCallback(La);P.push(ta)},La=function(ta){if(ta.isSelected()){for(var Pa=0;Pa<P.length;Pa++){var R=P[Pa];R!=ta&&R.setSelected(!1)}Pa=ta.getIdx();R=Object.keys(y);
for(var wa=0;wa<R.length;wa++)y[R[wa]].getJqUi().hide();(Pa=y[Pa])?Pa.getJqUi().show():eb(ta).appendTo(cb)}},eb=function(ta){var Pa=ta.getTableNode(),R=Pa.getName(),wa=Pa.getUid(),Ia=new v;if(0<Pa.getSubNodeLevel()){for(var db=Pa;0!=db.getSubNodeLevel();)db=db.getParentNode();db=db.getUid();Ia.setMeta(T[db])}else Ia.setMeta(T[wa]);Ia.setCurrentTableName(R);Pa=Ia.getJqUi();db&&(db=T[db].getPropertyMap()[R],Ia.setArrProperties(db,R));y[ta.getIdx()]=Ia;return Pa}}function ya(){var ja=this,V,Ka,Qa,ea,
P,da,pa="table",Va="table_selected";this.setTableNode=function(y){Qa=y};this.setSelected=function(y){ea=y;P&&P(ja);y?(V.addClass("metric-designer-select-field-table-item_selected"),na.background(Ka,Va)):(V.removeClass("metric-designer-select-field-table-item_selected"),na.background(Ka,pa))};this.isSelected=function(){return ea};this.getTableNode=function(){return Qa};this.setSelectedCallback=function(y){P=y};this.getIdx=function(){return da};var cb=function(y,T){da=y;V=$("<div>");V.on("click",function(){ea||
ja.setSelected(!0)});var U=Qa.getDisplayName();V.addClass("metric-designer-select-field-table-item");y&&V.css("top",26*y+"px");V.attr("title",U);Ka=$("<div>");Ka.addClass("metric-designer-select-field-table-icon");void 0!=T&&(pa=0<T?"entity-entry":"entity-sub",V.css("margin-left",20*T+25+"px"),Va=pa);na.background(Ka,pa);y=$("<div>");y.addClass("metric-designer-select-field-table-name");y.text(U);Ka.appendTo(V);y.appendTo(V)};this.protectedMethod={getJqUi:function(y,T){V||cb(y,T);return V}}}function Da(ja){ya.call(this);
var V=this.protectedMethod;this.getJqUi=function(){return V.getJqUi(ja)}}function va(ja,V){ya.call(this);var Ka=this,Qa=this.protectedMethod,ea,P,da,pa;this.getJqUi=function(){ea||Va();return ea};this.getIdx=function(){return pa};this.getCheckBox=function(){return P};this.setCheckCallback=function(cb){da=cb};var Va=function(){pa=ja;ea=$("<div>");ea.addClass("metric-designer-select-field-table-item-container");ea.css("top",26*ja+"px");P=new ua;P.setUserObject(Ka.getTableNode());P.addCheckedListener(function(T,
U){U&&da(Ka)});var cb=P.getJqUi();cb.addClass("metric-designer-select-field-table-check-box");cb.css("margin-left",20*V+"px");var y=!1;0==V?y=!0:1<V&&P.setEnabled(!1);P.setChecked(y);y=Qa.getJqUi(null,V);cb.appendTo(ea);y.appendTo(ea)}}function I(){var ja=[],V="",Ka=function(pa){var Va=pa.getTableNode(),cb=pa.getCheckBox().isChecked(),y=Va.getParentNode();pa={};ea(Va,pa);var T={};P(Va,T);var U=!1;for(Sa in T){var Fa=Qa(T[Sa]);if(Fa&&Fa.isChecked()){U=!0;break}}var Sa=U;if(cb){cb=!1;for(La in pa)if((U=
Qa(pa[La]))&&U.isChecked()){cb=!0;break}var La=cb;cb=da(Va);y&&0!=y.getSubNodeLevel()&&(U=Qa(y))&&U.setEnabled(!0);for(U=0;U<ja.length;U++){Fa=ja[U].getTableNode().getName();var eb=ja[U].getCheckBox();Va.getName()==Fa||y&&Fa==y.getName()||La&&pa[Fa]||Sa&&T[Fa]||(cb[Fa]?eb.setEnabled(!0):eb.setEnabled(!1))}}else for(y=da(y),U=0;U<ja.length;U++)Fa=ja[U].getTableNode().getName(),eb=ja[U].getCheckBox(),Va.getName()==Fa||Sa&&T[Fa]||(y[Fa]?eb.setEnabled(!0):(pa[Fa]&&eb.isChecked()&&eb.setChecked(!1),eb.setEnabled(!Sa)))};
this.isChecked=function(){for(var pa=0;pa<ja.length;pa++)if(ja[pa].getCheckBox().isChecked())return!0;return!1};this.getCheckListener=function(){return Ka};this.getSelectedField=function(pa){for(var Va={},cb=[],y=!0,T=0;T<ja.length;T++){var U=ja[T];if(U.getCheckBox().isChecked()){var Fa=pa[U.getIdx()];U=U.getTableNode().getName();Fa=Fa.getTableFieldMap()[U];for(var Sa=0;Sa<Fa.length;Sa++){var La=Fa[Sa],eb=La.getField();Va[eb.getFullName()]||(La.getSelected()?(cb.push(eb),Va[eb.getFullName()]=!0):
y=!1)}V=0==V.length?U:V+(com.kingdee.bos.qing.modeler.designer.ENTITY_SEPARATOR+U)}}return y?null:cb};this.getTableName=function(){return V};this.getDisplayName=function(){return ja[0].getTableNode().getDisplayName()};this.getCommentInfo=function(){return ja[0].getTableNode().getCommentInfo()};this.pushEntityItem=function(pa){ja.push(pa)};var Qa=function(pa){for(var Va=0;Va<ja.length;Va++)if(ja[Va].getTableNode()==pa)return ja[Va].getCheckBox()},ea=function(pa,Va){if((pa=pa.getChildren())&&0<pa.length)for(var cb=
0;cb<pa.length;cb++){var y=pa[cb];Va[y.getName()]=y;ea(y,Va)}},P=function(pa,Va){if(pa=pa.getParentNode())Va[pa.getName()]=pa,P(pa,Va)},da=function(pa){var Va={};if(!pa)return Va;if(pa=pa.getChildren())for(var cb=0;cb<pa.length;cb++){var y=pa[cb];Va[y.getName()]=y}return Va}}function K(ja,V){l.call(this);var Ka=this.protectedMethod,Qa=this,ea;(function(){Qa.setSize(800,600);Ka.setTitle(g.get("filter","\u8fc7\u6ee4"));Ka.setSelectable(!0);Ka.getDialogCtrl().setMinSize(800,600);Ka.getDialogCtrl().setFullScreenEnabled();
Ka.getDialogCtrl().setResizeEnabled();Ka.getDialogCtrl().addResizeListener(function(){ea.resize()});Ka.setContentPaneCreator(function(){ea=new J;ea.setGlobal(ja);ea.setSourceTable(V);return ea.getJqUi()});Ka.setClosingAction(function(P){});Ka.setClosingChecker(function(){var P=ea.checkFilterConditionValid();if(P)return Ka.getMessageCurtain().showPrompt(P),!1;P=ea.getFilterItems();var da=V.getFilterItems()?V.clone().getFilterItems():[],pa;a:if(da&&P&&da.length===P.length){for(pa=0;pa<da.length;pa++)if(!da[pa].equals(P[pa])){pa=
!1;break a}pa=!0}else pa=!1;pa||(pa=new ma,pa.setValue(V,da,P),ja.getCommandManager().perform(pa));V.setFilterItems(P);Ea.occur(Ea.FUNCTION,Ea.SOURCE_TABLE_FILTER);Ka.destroy();return!0})})()}function J(){var ja=this,V,Ka,Qa,ea,P,da,pa;this.getJqUi=function(){Ka||Sa();return Ka};this.setGlobal=function(ta){V=ta};this.setSourceTable=function(ta){da=ta};this.checkFilterConditionValid=function(){return P.checkFilterValid()};this.resize=function(){ea.afterResize();P.afterResize()};this.getFilterItems=
function(){return P.getFilterItems()};this.updateFilterPanel=function(ta){cb(function(Pa){ea.hidePreviewPrompt();var R=[];Pa=Pa[da.getUid()];for(var wa=0;wa<Pa.length;wa++){var Ia=new f;Ia.fromJsonObject(Pa[wa]);R.push(Ia)}if(Pa=da.getSelectedFields()){wa=[];for(Ia=0;Ia<Pa.length;Ia++)for(var db=Pa[Ia],nb=0;nb<R.length;nb++){var hb=R[nb];db.getName()===hb.getName()&&wa.push(hb)}Pa=wa}else Pa=R;wa=Pa;for(Ia=0;Ia<ta.length;Ia++)if(db=wa,nb=ta[Ia],!nb.isEmpty())for(hb=0;hb<db.length;hb++){var Za=db[hb];
if(nb.getField().getName()===Za.getName()){nb.setField(Za);break}}P.setFilterItems(ta);P.setFields(Pa);P.updateUi();a:{if(Pa=da.getSelectedFields())for(wa=0;wa<ta.length;wa++){db=ta[wa];if(Ia=!db.isEmpty()){b:{Ia=Pa;db=db.getField();for(nb=0;nb<Ia.length;nb++)if(db.getName()===Ia[nb].getName()){Ia=!0;break b}Ia=!1}Ia=!Ia}if(Ia){Pa=!1;break a}}Pa=!0}if(Pa)a:{for(Pa=0;Pa<ta.length;Pa++){Ia=ta[Pa];if(wa=!Ia.isEmpty()){b:{wa=R;Ia=Ia.getField();for(db=0;db<wa.length;db++)if(Ia.getName()===wa[db].getName()){wa=
!0;break b}wa=!1}wa=!wa}if(wa){Pa=!1;break a}}Pa=!0}Pa?(R=P.checkFilterValid())?ea.showPreviewPrompt(R):Va(ta):(R=P.checkFilterValid(),ea.showPreviewPrompt(R))},function(Pa,R){ea.showErrorTips(g.get("tableNotExist","\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002"));P.setFilterItems(ta);P.updateUi();P.checkFilterValid()})};var Va=function(ta){y(ta,function(Pa){ea.hidePreviewPrompt();var R=new k;R.fromJsonObject(Pa);ea.setPreviewData(R);ea.setFilterItems(ta);ea.updateUi()})},cb=function(ta,
Pa){var R=N.SourceUtil.getTableSource(V,da),wa=new a(V.getRemoteImpl(),function(Ia){ta&&ta(Ia);ea.showWaitingTips()},function(Ia,db){Pa&&Pa(Ia,db);return!0});wa.setShowBlocking(!1);wa.getTableField([R],[da])},y=function(ta,Pa,R){var wa=V.getModelerModel().getSource(da.getSourceUid()),Ia=new a(V.getRemoteImpl(),function(db){Pa&&Pa(db)},function(){R&&R();return!0});Ia.setShowBlocking(!1);Ia.getTablePreviewData(wa,da,U(ta),11);T();ea.showWaitingTips()},T=function(){var ta=ea.getKTable();L.clear(ta);
L.refresh(ta)},U=function(ta){if(!ta||0===ta.length)return null;for(var Pa=[],R=0;R<ta.length;R++)ta[R].isEmpty()||Pa.push(ta[R].toJsonObject());return Pa},Fa=function(){eb();var ta=ja.getFilterItems();y(ta,function(Pa){ea.hidePreviewPrompt();var R=new k;R.fromJsonObject(Pa);ea.setPreviewData(R);ea.setFilterItems(ta);ea.updateUi()},function(Pa,R){ea.hidePreviewPrompt();ea.showErrorTips(g.get("tableNotExist","\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002"))})},Sa=function(){Ka=$("<div>");
Ka.addClass("metric-data-filter-panel");ea=new X;ea.setGlobal(V);ea.setSourceTable(da);var ta=ea.getJqUi(),Pa=da.getFilterItems()?da.clone().getFilterItems():[];P=new Z;P.setPreviewRefreshRequestListener(La);var R=P.getJqUi();ja.updateFilterPanel(Pa);Qa=new aa;Qa.setHorizontalSplit(!1);Qa.setFirstSize(225,150,300);Qa.setSecondSize(250,150,300);Qa.setFirstChild(aa.createChildWrapper(ta,function(){ea.afterResize()}));Qa.setSecondChild(aa.createChildWrapper(R,function(){P.afterResize()}));Ka.append(Qa.getJqUi())},
La=function(){eb();pa=$("<div>");pa.addClass("metric-data-filter-preview-mask");pa.on("click",function(Pa){Xa&&Fa()});var ta=ea.getJqUi().parent();pa.appendTo(ta);ta=$("<div>");ta.text(g.get("refreshPreviewData","\u7f16\u8f91\u5b8c\u6210\u540e\uff0c\u70b9\u51fb\u6b64\u5904\u5237\u65b0\u9884\u89c8\u6570\u636e\u3002"));ta.addClass("metric-data-filter-mask-text");ta.appendTo(pa)},eb=function(){ja.getJqUi().find(".metric-data-filter-preview-mask").remove()}}function X(){var ja=this,V,Ka,Qa,ea,P,da;this.getJqUi=
function(){if(!V){V=$("<div>");V.addClass("metric-data-filter-preview");var T=g.get("preview","\u9884\u89c8"),U=$("<div class='metric-data-filter-preview-title'>"),Fa=$("<div>");Fa.appendTo(U);C.layoutCtrlWithLRTB(Fa,0,0,null,0,0,null);Fa.css("border-left","3px solid #5582f3");Fa=$("<div>");Fa.text(T);C.layoutCtrl(Fa,10,null,200,null);C.layoutCtrlMiddleAlign(Fa,15);Fa.appendTo(U);Fa.css({"font-weight":"bold",color:"#666"});V.append(U);Ka=L.createTable();T=$(Ka.getUI());T.addClass("metric-data-filter-preview-table");
V.append(T)}return V};this.afterResize=function(){Ka.relayoutViews()};this.setGlobal=function(T){Qa=T};this.setSourceTable=function(T){ea=T};this.setFilterItems=function(T){da=T};this.setPreviewData=function(T){P=T};this.getKTable=function(){return Ka};this.updateUi=function(){L.clear(Ka);for(var T=L.createHeadRow(Ka),U=Math.min(P.getColumnCount(),50),Fa=0;Fa<U;Fa++){var Sa=P.getField(Fa),La=Ka.addColumn(Sa.getAlias()),eb=Sa.getOutputDataType();La.setStyle(L.getColumnStyle(eb===f.DT_INT||eb===f.DT_NUMBER));
La.setWidth(y(eb));T.getCell(Fa).setValue(Sa.getAlias())}T=Math.min(P.getRowCount(),10);for(Fa=0;Fa<T;Fa++){La=L.createRow(Ka);eb=P.getOneRow(Fa);for(var ta=0;ta<U;ta++){Sa=P.getField(ta);var Pa=eb[ta],R=La.getCell(ta),wa=R.setValue;Sa=Sa.getOutputDataType();null==Pa||void 0==Pa?Pa="":Sa===f.DT_DATE?(Sa=new ia,Sa.setFormatString("yyyy-MM-dd"),Pa=Sa.format(Pa)):Sa===f.DT_DATETIME?(Sa=new ia,Sa.setFormatString("yyyy-MM-dd HH:mm:ss"),Pa=Sa.format(Pa)):Sa===f.DT_BOOLEAN?Pa=Pa?"true":"false":Sa===f.DT_NUMBER&&
(Sa=new M,Sa.setFormatString("#,##0.00"),Pa=Sa.format(Pa));wa.call(R,Pa)}}0===P.getRowCount()?(U=g.get("noPreviewData","\u6ca1\u6709\u6570\u636e"),cb(U,!1)):(U=10<P.getRowCount(),Fa=50<=P.getColumnCount(),U||Fa)?U&&!Fa?(U=g.get("dataShownRows","\u4ec5\u9884\u89c8\u524d#1\u884c\u6570\u636e").replace("#1",10),pa(U)):!U&&Fa?(U=g.get("totalRowsData","\u603b\u5171#1\u884c\u6570\u636e").replace("#1",P.getRowCount()),U+=g.get("previewTipsComma",",")+g.get("dataShownCols","\u4ec5\u9884\u89c8\u524d#1\u5217\u6570\u636e").replace("#1",
50),cb(U,!1)):U&&Fa&&(U=g.get("dataShownRowsAndCols","\u4ec5\u9884\u89c8\u524d#1\u884c\u3001\u524d#2\u5217\u6570\u636e"),U=U.replace("#1",10),U=U.replace("#2",50),pa(U)):(U=g.get("totalRows","\u603b\u5171#1\u884c\u6570\u636e").replace("#1",P.getRowCount()),cb(U,!1))};this.showPreviewPrompt=function(T){ja.hidePreviewPrompt();var U=$("<div>");U.addClass("metric-data-filter-preview-waiting");U.text(T);T=$(Ka.getUI());U.appendTo(T)};this.showWaitingTips=function(){ja.showPreviewPrompt(g.get("loadingPreviewData",
"\u6b63\u5728\u83b7\u53d6\u9884\u89c8\u6570\u636e\uff0c\u8bf7\u7a0d\u5019\u2026\u2026"))};this.showErrorTips=function(T){ja.showPreviewPrompt(T)};this.hidePreviewPrompt=function(){ja.getJqUi().find(".metric-data-filter-preview-waiting").remove()};var pa=function(T){var U=new Date,Fa=Qa.getModelerModel().getSource(ea.getSourceUid()),Sa=new a(Qa.getRemoteImpl(),function(La){if(U===U)try{T=g.get("totalRowsData","\u603b\u5171#1\u884c\u6570\u636e").replace("#1",La+"")+g.get("previewTipsComma",",")+T,cb(T,
!0)}catch(eb){L.refresh(Ka)}});Sa.setShowBlocking(!1);Sa.getDataRowCount(Fa,ea,Va(da));cb(g.get("loadingTotalRows","\u6b63\u5728\u8ba1\u7b97\u603b\u884c\u6570\uff0c\u8bf7\u7a0d\u5019\u2026\u2026"),!1)},Va=function(T){if(!T||0===T.length)return null;for(var U=[],Fa=0;Fa<T.length;Fa++)T[Fa].isEmpty()||U.push(T[Fa].toJsonObject());return U},cb=function(T,U){U?(U=Ka.getRowsCount()-1,Ka.getRow(U).getCell(0).setValue(T)):(U=L.createRow(Ka),U.getCell(0).setValue(T),T=new KTStyle,T.setBackgroundColor(com.kingdee.bos.qing.common.CommonTableSkin.ODD_ROW_BACKGROUND_COLOR),
U.setStyle(T),T=new KTStyle,T.setTextAlign("left"),U.getCell(0).setStyle(T));L.refresh(Ka)},y=function(T){switch(T){case f.DT_INT:case f.DT_NUMBER:return 90;case f.DT_DATE:return 80;case f.DT_DATETIME:return 130;case f.DT_BOOLEAN:return 40;default:return 120}}}function Z(){function ja(sa){KTDefaultCellRender.call(this,sa);var Ra=this,Ba=this.paintCellUI;this.paintCellUI=function(Ha,Wa){if(Ra.getCurrentRowIdx()<L.getHeadRowCount()||!Ra.getCell())Ba(Ha,Wa);else{var ab=Ra.getCellWidth(),lb=Ra.getCellHeight(),
sb=Ra.getCurrentRow();if(0===Ra.getCurrentColIdx())sb=Ra.getCell().getValue(),Ha=$(Ha),Ha.find(".modeler-designer-filter-table-prompt").remove(),sb&&(ab=E.createWarning(),ab.addClass("modeler-designer-filter-table-prompt"),ab.attr("title",sb),ab.appendTo(Ha));else if(1===Ra.getCurrentColIdx()||5===Ra.getCurrentColIdx()){Wa=1===Ra.getCurrentColIdx();var xb=Ra.getCell().getValue();pb(Ha,ab,lb,Wa,xb,sb)}else if(2===Ra.getCurrentColIdx())Wa=Ra.getCell().getValue(),Za(Ha,ab,lb,Wa,sb);else if(3===Ra.getCurrentColIdx()){Wa=
Ra.getCell().getValue();var jb=sb.getUserObject().getField();xb=jb?jb.getOutputDataType():null;jb=jb?jb.isEnum():!1;Ha=L.createCtrlInCell(Ha,ab,lb,A);Ha.setSelected(Wa);Ha.setItemModels(xb?B.getSelectableCompares(xb,jb):[]);Ha.setUserObject(sb);Ha.setCustomPainter(Pa);Ha.addSelectedChangedListener(eb)}else 4===Ra.getCurrentColIdx()?(Wa=Ra.getCell().getValue(),R(Ha,ab,lb,Wa,sb)):6===Ra.getCurrentColIdx()?(Wa=Ra.getCell().getValue(),Sa(Ha,ab,lb,Wa,sb)):Ba(Ha,Wa)}}}function V(){l.call(this);var sa=this,
Ra=this.protectedMethod,Ba;this.edit=function(Ha,Wa,ab){Ra.setTitle(g.get("relativeDateRange","\u76f8\u5bf9\u65e5\u671f"));Ba||(sa.setSize(450,430),Ba=new ca,Ba.setContainsTime(Wa),Wa=new Ga,Wa.fromJsonObject(Ha.toJsonObject()),Ba.setModel(Wa),Ra.setContentPaneCreator(function(){return Ba.getJqUi()}),Ra.setClosingAction(function(lb){lb&&(lb=Ba.getModel(),ab(lb))}))}}function Ka(){var sa=[],Ra,Ba,Ha=[],Wa=[],ab;this.setItemModel=function(jb,rb){ab=rb;sa=jb};this.setListItemPainter=function(jb){};this.setSelectedItemModel=
function(jb){Ha=jb;Wa=Ha.slice(0)};this.setLastTimeSelectedModel=function(jb){Wa=jb};this.getSelectedItemModel=function(){return Ha};this.createJqPopup=function(jb,rb,zb,Db){Ra=$("<div>");Ra.appendTo(jb);Ba=$("<div>");Ra.addClass("modeler-designer-field-popup");Ba.addClass("modeler-designer-enum-popup-list-owner");for(jb=0;jb<sa.length;jb++)sb(sa[jb],Ba,rb,!1);rb=new p;rb.setHighlight(!0);rb.setText(g.get("ok","\u786e\u5b9a"));rb=rb.getJqUi();rb.css("z-index",3);rb.css("margin-left",10);C.layoutCtrlWithLRTB(rb,
"50%",null,50,null,8,28);rb.on("click",function(Ib){Wa=Ha.slice(0);zb(Ha)});jb=new p(g.get("cancle","\u53d6\u6d88"));jb.setHighlight(!1);jb=jb.getJqUi();jb.css("z-index",3);jb.css("margin-left",-80);C.layoutCtrlWithLRTB(jb,"50%",null,50,null,8,28);jb.on("click",function(Ib){Ha=Wa.slice(0);Db()});Ba.appendTo(Ra);rb.appendTo(Ra);jb.appendTo(Ra);Ba.css("height","77%");return[-1,260]};var lb=function(jb,rb){rb=jb.getUserObject();jb=jb.isChecked();rb&&jb?(jb=xb(rb),0>jb&&Ha.push(rb)):rb&&!jb&&(jb=xb(rb),
-1<jb&&Ha.splice(jb,1))},sb=function(jb,rb,zb){var Db=xb(jb);zb=$("<div>");zb.addClass("modeler-designer-field-popup-list-item");zb.data("model",jb);var Ib=$("<div>"),Gb=new ua;Gb.setUserObject(jb);Gb.setChecked(-1<Db);Gb.addCheckedListener(lb);Db=Gb.getJqUi();Db.addClass("modeler-designer-field-selection-checkbox-icon");Db.data("model",Gb);Gb=$("<div>");Gb.text(jb.fieldValue);Gb.addClass("modeler-designer-field-selection-checkbox-text");Ib.append(Db);Ib.append(Gb);zb.append(Ib);rb.append(zb)},xb=
function(jb){for(var rb=0;rb<Ha.length;rb++)if(ab(jb,Ha[rb]))return rb;return-1}}function Qa(){l.call(this);var sa=this,Ra=this.protectedMethod,Ba=new fa,Ha=new fa,Wa=new Ca,ab,lb;this.setCaption=function(jb,rb){Ra.setTitle(jb);Ba.setText(rb)};this.setText=function(jb,rb){Wa.setText(jb);var zb=0;jb&&(jb=jb.split("\n").length,zb=1E3<jb?1E3:jb);Ha.setText(zb+"/1000\u9879");lb=function(Db){var Ib=Db?$.trim(Wa.getText()):null;rb(Db,Ib)};Ra.setClosingAction(lb)};this.showDialogLeftAnchorTo=function(jb){jb&&
(sa.setSize(470,450),jb=C.upwardCoordinate(document.body,[0,0],document.body),sa.setPosition(Math.max(0,jb[0]-10),Math.max(6,jb[1]-450+40)));Wa.addEditedListener(xb);Ra.setContentPaneCreator(sb);sa.showDialog();Wa.requestFocus()};this.setClosingChecker=function(jb){jb&&(ab=function(){var rb=jb($.trim(Wa.getText()));rb&&Ra.getMessageCurtain().showPrompt(rb);return rb?!1:!0},Ra.setClosingChecker(ab))};var sb=function(){Ha.setAlign(fa.ALIGN_RIGHT);C.layoutCtrlWithLRTB(Ba.getJqUi(),0,0,null,0,null,23);
C.layoutCtrlWithLRTB(Wa.getJqUi(),0,0,null,30,null,260);C.layoutCtrlWithLRTB(Ha.getJqUi(),290,0,null,287,null,23);var jb=$("<div>");jb.append(Ba.getJqUi());jb.append(Wa.getJqUi());jb.append(Ha.getJqUi());return jb},xb=function(jb){var rb=jb.getText(),zb=[];rb&&(zb=rb.trim().replace(/(\n\s*)+/g,"\n").split("\n"));rb=zb.length;1E3<rb&&(jb.setText(zb.slice(0,1E3).join("\n")),rb=1E3);Ha.setText(rb+"/1000\u9879");Ra.getMessageCurtain().hide()}}var ea=this,P,da,pa=[],Va=[],cb,y;this.getJqUi=function(){if(!P){P=
$("<div>");P.addClass("metric-data-filter-condition");var sa=g.get("filterCondition","\u8fc7\u6ee4\u6761\u4ef6"),Ra=$("<div class='metric-data-filter-condition-title'>"),Ba=$("<div>");Ba.appendTo(Ra);C.layoutCtrlWithLRTB(Ba,0,0,null,0,0,null);Ba.css("border-left","3px solid #5582f3");Ba=$("<div>");Ba.text(sa);C.layoutCtrl(Ba,10,null,200,null);C.layoutCtrlMiddleAlign(Ba,15);Ba.appendTo(Ra);Ba.css({"font-weight":"bold",color:"#666"});P.append(Ra);da=L.createTable();da.setDraggableAdjusting(!0);da.setSyncUIWhenModelChanged(!0);
da.setColumnFitVisibleWidth(!1);da.setAutoAdjustRowHeight(!0);da.setScrollerVisible("hidden","auto");L.bindTextEditor(da,T,U);L.bindTableListenerForCtrl(da,Fa);sa=new ja(da);sa.setOutsideVisible(!1);da.setCellRender(sa);da.addColumns(8);da.getColumn(0).setWidth(23);da.getColumn(1).setWidth(60);da.getColumn(2).setWidth(170);da.getColumn(3).setWidth(95);da.getColumn(4).setWidth(200);da.getColumn(5).setWidth(60);da.getColumn(6).setWidth(60);da.getColumn(7).setWidth(100);sa=L.createHeadRow(da);sa.getCell(1).setValue(g.get("leftBracket",
"\u5de6\u62ec\u53f7"));sa.getCell(2).setValue(g.get("field","\u5b57\u6bb5"));sa.getCell(3).setValue(g.get("compare","\u6bd4\u8f83"));sa.getCell(4).setValue(g.get("value","\u503c"));sa.getCell(5).setValue(g.get("rightBracket","\u53f3\u62ec\u53f7"));sa.getCell(6).setValue(g.get("logic","\u903b\u8f91"));sa=$(da.getUI());sa.addClass("metric-data-filter-condition-table");P.append(sa)}return P};this.getFilterItems=function(){for(var sa=[],Ra=0;Ra<Va.length;Ra++){var Ba=Va[Ra];Ba.isEmpty()||sa.push(Ba)}return sa};
this.setFilterItems=function(sa){Va=sa};this.setFields=function(sa){pa=sa};this.afterResize=function(){da.relayoutViews()};this.setPreviewRefreshRequestListener=function(sa){cb=sa};this.firePreviewRefreshWithOnlyRepaint=function(){cb()};this.updateUi=function(){if(da){for(var sa=Va.length-1;0<=sa;sa--)if(Va[sa].isEmpty())Va.splice(sa,1);else break;L.clearWithoutHead(da);sa=Math.max(6,Va.length+1);for(var Ra=0;Ra<sa;Ra++){var Ba=Va[Ra];Ra>=Va.length&&(Ba=new B,Va.push(Ba));var Ha=L.createRow(da);Ha.setUserObject(Ba);
Ha.getCell(0).setValue("");Ha.getCell(1).setValue(Ba.getLeftBracketCount());Ha.getCell(2).setValue(Ba.getField());Ha.getCell(3).setValue(Ba.getCompareOp());B.isCompareOpRelativeDateRangeValue(Ba.getCompareOp())?Ha.getCell(4).setValue(Ba.getRelativeDateRange()?Ba.getRelativeDateRange():""):Ha.getCell(4).setValue(Ba.getValue()?Ba.getValue():"");Ha.getCell(5).setValue(Ba.getRightBracketCount());Ha.getCell(6).setValue(Ba.getLogicOp()?Ba.getLogicOp():"")}L.refresh(da)}};this.checkFilterValid=function(){var sa=
Ta.checkFilterField(Va,pa);if(sa||(sa=Ta.checkFilterLogical(Va)))return Xa=!1,ea.locateToErrorRow(sa.getFiltersErrorRow(),sa.getPrompt()),sa.getPrompt();Xa=!0;ea.locateToErrorRow(-1);return null};this.locateToErrorRow=function(sa,Ra){for(var Ba=L.getHeadRowCount();Ba<da.getRowsCount();Ba++)da.getRow(Ba).getCell(0).setValue("");-1!==sa&&da.getRow(sa+L.getHeadRowCount()).getCell(0).setValue(Ra)};var T=function(sa,Ra){if(4!==Ra)return!1;sa=da.getRow(sa).getUserObject();Ra=sa.getCompareOp();if(B.isCompareOpWithoutValue(Ra)||
B.isCompareOpWithinOrNotWithinValue(Ra)||!Ta.checkFieldExisted(sa,pa))return!1;sa=sa.getField();return db(sa)},U=function(sa,Ra,Ba,Ha,Wa){sa=sa.getUserObject();sa.getValue()!==Ha&&(sa.setValue(Ha),Ba.setValue(Ha),ea.checkFilterValid(),ea.firePreviewRefreshWithOnlyRepaint());return!0},Fa=function(sa,Ra,Ba,Ha){sa=null;if(Ra){Ra=KTableUIAbstractView.createCellId(da.getRow(Ba),da.getColumn(da.getColumnsCount()-1));sa=ea.getJqUi().find("#"+Ra);var Wa=Ba-L.getHeadRowCount();Ba=$("<div>");Ba.text(g.get("insertRow",
"\u63d2\u5165"));Ba.addClass("modeler-designer-filter-table-op");Ba.css("left","10px");Ba.appendTo(sa);Ba.on("click",function(ab){ab=new B;Va.splice(Wa,0,ab);ea.updateUi();ea.checkFilterValid();ea.firePreviewRefreshWithOnlyRepaint()});Ba=$("<div>");Ba.text(g.get("deleteRow","\u5220\u9664"));Ba.addClass("modeler-designer-filter-table-op");Ba.css("left","52px");Ba.appendTo(sa);Ba.on("click",function(ab){Va.splice(Wa,1);ea.updateUi();ea.checkFilterValid();ea.firePreviewRefreshWithOnlyRepaint()})}else y&&
y.find(".modeler-designer-filter-table-op").remove();y=sa},Sa=function(sa,Ra,Ba,Ha,Wa){sa=L.createCtrlInCell(sa,Ra,Ba,A);sa.setSelected(Ha?Ha:null);sa.setItemModels([null,B.LOGIC_AND,B.LOGIC_OR]);sa.setUserObject(Wa);sa.setCustomPainter(function(ab,lb,sb){ab="";sb===B.LOGIC_AND?ab=g.get("and","\u4e14"):sb===B.LOGIC_OR&&(ab=g.get("or","\u6216"));lb.text(ab)});sa.addSelectedChangedListener(La)},La=function(sa,Ra,Ba){sa=sa.getUserObject();sa.getUserObject().setLogicOp(Ba);sa.getCell(6).setValue(Ba);
ea.checkFilterValid();ea.firePreviewRefreshWithOnlyRepaint()},eb=function(sa,Ra,Ba){sa=sa.getUserObject();var Ha=sa.getUserObject();Ha.setCompareOp(Ba);sa.getCell(3).setValue(Ba);if(B.isCompareOpWithoutValue(Ra)!==B.isCompareOpWithoutValue(Ba)||B.isCompareOpRelativeDateRangeValue(Ra)!==B.isCompareOpRelativeDateRangeValue(Ba)||B.isCompareOpWithinOrNotWithinValue(Ra)!==B.isCompareOpWithinOrNotWithinValue(Ba))Ha.setValue(null),Ha.setRelativeDateRange(null),ta(sa.getCell(4)," ");ea.checkFilterValid();
ea.firePreviewRefreshWithOnlyRepaint()},ta=function(sa,Ra){sa.setValue(""===Ra?" ":"");sa.setValue(Ra)},Pa=function(sa,Ra,Ba){switch(Ba){case B.COMPARE_EQUAL:sa=g.get("equal","\u7b49\u4e8e");break;case B.COMPARE_NOT_EQUAL:sa=g.get("notEqual","\u4e0d\u7b49\u4e8e");break;case B.COMPARE_GREATER:sa=g.get("greater","\u5927\u4e8e");break;case B.COMPARE_GREATER_EQUAL:sa=g.get("equalOrGreater","\u5927\u4e8e\u7b49\u4e8e");break;case B.COMPARE_LESS:sa=g.get("less","\u5c0f\u4e8e");break;case B.COMPARE_LESS_EQUAL:sa=
g.get("equalOrLess","\u5c0f\u4e8e\u7b49\u4e8e");break;case B.COMPARE_INCLUDE:sa=g.get("include","\u5305\u542b");break;case B.COMPARE_NOT_INCLUDE:sa=g.get("notInclude","\u4e0d\u5305\u542b");break;case B.COMPARE_START_WITH:sa=g.get("startWith","\u5f00\u5934\u662f");break;case B.COMPARE_END_WITH:sa=g.get("endWith","\u7ed3\u5c3e\u662f");break;case B.COMPARE_NULL:sa=g.get("compareNull","\u4e3a\u7a7a");break;case B.COMPARE_NOT_NULL:sa=g.get("compareNotNull","\u4e0d\u4e3a\u7a7a");break;case B.COMPARE_IN:sa=
g.get("compareIn","\u5728......\u4e4b\u5185");break;case B.COMPARE_NOT_IN:sa=g.get("compareNotIn","\u4e0d\u5728......\u4e4b\u5185");break;case B.COMPARE_RELATIVE_DATE_RANGE:sa=g.get("relativeDateRange","\u76f8\u5bf9\u65e5\u671f");break;default:sa=""}Ra.text(sa)},R=function(sa,Ra,Ba,Ha,Wa){var ab=Wa.getUserObject(),lb=$(sa);lb.empty();if(Ta.checkFieldExisted(ab,pa)){lb.css("cursor","");var sb=ab.getCompareOp(),xb=ab.getField(),jb=xb?xb.getOutputDataType():"",rb=xb?xb.getEnumValue():null,zb=xb?xb.isEnum():
!1;if(!B.isCompareOpWithoutValue(sb))if(B.isCompareOpWithinOrNotWithinValue(sb))if(zb){var Db=[],Ib;for(Ib in rb)Db.push({fieldValue:rb[Ib],fieldName:Ib});var Gb=[];(Ha=JSON.parse(ab.getValue()))&&Ha.forEach(function(gb){Db.forEach(function(mb){gb===mb.fieldName&&Gb.push({fieldValue:mb.fieldValue,fieldName:mb.fieldName})})});var Qb=new Ka;Qb.setItemModel(Db,function(gb,mb){return gb&&mb&&gb.fieldName===mb.fieldName});Qb.setSelectedItemModel(Gb);sa=L.createCtrlInCell(sa,Ra,Ba,Y);sa.setUserObject(Wa);
sa.setSelectedModel(Gb);sa.setDropdownCreator(function(gb,mb,tb,vb){return Qb.createJqPopup(gb,mb,tb,vb)});sa.addSelectionListener(function(gb){var mb=gb.getSelectedModel();gb=gb.getUserObject().getUserObject();if(null==mb||0===mb.length)gb.setValue(null);else{JSON.parse(gb.getValue());var tb=[],vb;for(vb in mb)tb.push(mb[vb].fieldName);gb.setValue(JSON.stringify(tb))}ea.checkFilterValid();ea.firePreviewRefreshWithOnlyRepaint()});sa.setCustomPainter(function(gb,mb){var tb=[],vb;for(vb in gb)tb.push(gb[vb].fieldValue);
mb.text(tb.join(","))})}else{var Lb=L.createCtrlInCell(sa,Ra,Ba,ha);Lb.setClearable(!0);Lb.setUserObject(Wa);Lb.getJqUi().find(".sa-ctrl-f7selector-text").on("click",function(){nb(ab,Lb)});Lb.addActionListener(function(gb){nb(ab,Lb)});null!=Ha&&""!==Ha&&" "!==Ha&&Ha&&Lb.setModel(JSON.parse(Ha).join(","));Lb.setCustomPainter(function(gb){return gb});Lb.addClearListener(function(gb){hb(gb,ab,null)})}else if(db(xb))sa=$("<div>"),sa.text(Ha),sa.addClass("modeler-designer-common-table-cell-editable"),
sa.appendTo(lb),lb.css("cursor","pointer");else if(jb===f.DT_DATE||jb===f.DT_DATETIME)if(B.isCompareOpRelativeDateRangeValue(sb)){var Nb=jb===f.DT_DATETIME;lb="";var bb=Ha;bb instanceof Ga?lb=ca.modelToDisplayText(bb,Nb):(bb=new Ga,bb.setPeriod(Ga.PERIOD_DAY),bb.setWhichPeriod(0));var fb=L.createCtrlInCell(sa,Ra,Ba,fa);lb&&18<lb.length&&(fb.getJqUi().attr("title",lb),lb=lb.substring(0,18)+"...");fb.setText(lb);fb.setUserObject(Wa);sa=fb.getJqUi();sa.css("line-height","28px");sa.on("click",function(gb){gb=
bb;var mb=ob,tb=new V;tb.edit(gb,Nb,mb);tb.showDialog()});Ra=$("<div>");na.background(Ra,"btn_edit");Ra.addClass("modeler-designer-filter-item-format-icon");Ra.appendTo(sa);var ob=function(gb){ab.setRelativeDateRange(gb);ab.setDisplayValue(ca.modelToDisplayText(gb,Nb));fb.setText(ca.modelToDisplayText(gb,Nb));Wa.getCell(4).setValue(gb);ea.checkFilterValid();ea.firePreviewRefreshWithOnlyRepaint()}}else lb=new Date,Ha=Ha?parseInt(Ha):null,isNaN(Ha)||null==Ha?(ab=Wa.getUserObject(),ab.setValue(lb.getTime())):
lb.setTime(Ha),sa=L.createCtrlInCell(sa,Ra,Ba,jb===f.DT_DATETIME?Ja:S),sa.setDateObject(lb),sa.setUserObject(Wa),sa.addModelChangedListener(wa);else if(jb===f.DT_BOOLEAN)sa=L.createCtrlInCell(sa,Ra,Ba,A),sa.setSelected(Ha),sa.setItemModels([f.BOOLEAN_TRUE,f.BOOLEAN_FALSE]),sa.setUserObject(Wa),sa.setCustomPainter(function(gb,mb,tb){gb=tb===f.BOOLEAN_TRUE?g.get("dataTypeTrue","\u771f"):tb===f.BOOLEAN_FALSE?g.get("dataTypeFalse","\u5047"):"";mb.text(gb)}),sa.addSelectedChangedListener(Ia);else if(zb){Db=
[];for(Ib in rb)Db=Db.concat(Ib);sa=L.createCtrlInCell(sa,Ra,Ba,A);sa.setSelected(Ha);sa.setItemModels(Db);sa.setUserObject(Wa);sa.setCustomPainter(function(gb,mb,tb){mb.text(rb[tb])});sa.addSelectedChangedListener(Ia)}}else sa=$("<div>"),Ra=ab.getDisplayValue(!1),sa.text(Ra),sa.attr("title",Ra),sa.addClass("modeler-designer-common-table-cell-not-editable"),sa.appendTo(lb)},wa=function(sa){var Ra=""+sa.getDateObject().getTime();sa=sa.getUserObject();sa.getUserObject().setValue(Ra);sa.getCell(4).setValue(Ra);
ea.checkFilterValid();ea.firePreviewRefreshWithOnlyRepaint()},Ia=function(sa,Ra,Ba){sa=sa.getUserObject();sa.getUserObject().setValue(Ba);sa.getCell(4).setValue(Ba);ea.checkFilterValid();ea.firePreviewRefreshWithOnlyRepaint()},db=function(sa){var Ra=sa?sa.getOutputDataType():null;return sa&&sa.isMulBaseData()?!0:Ra?(sa=sa?sa.isEnum():!1,(Ra===f.DT_STRING||Ra===f.DT_NUMBER||Ra===f.DT_INT)&&!sa):!1},nb=function(sa,Ra){var Ba=g.get("enterSplit","\u7cbe\u786e\u5339\u914d\u591a\u503c\uff0c\u5404\u9879\u4e4b\u95f4\u4f7f\u7528\u56de\u8f66\u4f5c\u4e3a\u5206\u9694\u7b26"),
Ha=sa.getCompareOp()===B.COMPARE_IN?g.get("compareIn","\u5728......\u4e4b\u5185"):g.get("compareNotIn","\u4e0d\u5728......\u4e4b\u5185"),Wa=JSON.parse(sa.getValue());Wa=Wa?Wa.join("\n"):"";var ab=new Qa;ab.setCaption(Ha,Ba);ab.setClosingChecker(function(lb){if(lb&&5E4<lb.length)return g.get("matchTooLong","\u5339\u914d\u9879\u4e0d\u80fd\u8d85\u8fc750000\u4e2a\u5b57\u7b26")});ab.setText(Wa,function(lb,sb){lb&&hb(Ra,sa,sb)});ab.showDialogLeftAnchorTo(Ra.getJqUi())},hb=function(sa,Ra,Ba){null!=Ba&&sa.setModel(Ba.replace(/(\s*\n\s*)+/g,
","));if(null==Ba||Ra.getValue()!==JSON.stringify(Ba.split("\n"))){sa=sa.getUserObject();if(null!=Ba&&""!==Ba){Ba=JSON.parse(JSON.stringify(Ba.split("\n")));var Ha=[];Ba&&Ba.forEach(function(Wa){""!==Wa.trim()&&Ha.push($.trim(Wa))});Ba=JSON.stringify(Ha);Ra.setValue(Ba);sa.getCell(4).setValue(Ba)}else Ra.setValue(null),sa.getCell(4).setValue(null);ea.checkFilterValid();ea.firePreviewRefreshWithOnlyRepaint()}},Za=function(sa,Ra,Ba,Ha,Wa){var ab=(new ra).createChooseFieldPanel(kb);ab.setItemModel(pa);
sa=L.createCtrlInCell(sa,Ra,Ba,Y);sa.setUserObject(Wa);sa.setSelectedModel(Ha);sa.setDropdownCreator(function(lb,sb,xb){return ab.createJqPopup(lb,sb,xb)});sa.addSelectionListener(function(lb){var sb=lb.getSelectedModel();lb=lb.getUserObject();var xb=lb.getUserObject(),jb=xb.getField(),rb=jb?jb.getOutputDataType():"",zb=sb?sb.getOutputDataType():"";xb.setField(sb);lb.getCell(2).setValue(sb);if(rb!==zb||jb.getEnumValue()!==sb.getEnumValue()){jb=xb.getCompareOp();sb=sb?sb.isEnum():!1;sb=B.getSelectableCompares(zb,
sb);zb=!1;for(rb=0;rb<sb.length;rb++)if(jb===sb[rb]){zb=!0;break}zb||(jb=B.COMPARE_EQUAL);xb.setCompareOp(jb);ta(lb.getCell(3),jb);xb.setValue(null);ta(lb.getCell(4)," ")}ea.checkFilterValid();ea.firePreviewRefreshWithOnlyRepaint()});sa.setCustomPainter(function(lb,sb){sb.text(lb?lb.getAlias():"")})},kb=function(sa,Ra){var Ba=Ra?Ra.getAlias():"",Ha=$("<span>");Ha.text(Ba);Ha.attr("title",Ba);Ha.addClass("modeler-designer-field-popup-list-item-text-alias");Ra=Ra?Ra.getName():"";Ba=$("<span>");Ba.addClass("modeler-designer-field-popup-list-item-text-name");
Ba.text("("+Ra+")");sa.append(Ha);sa.append(Ba)},pb=function(sa,Ra,Ba,Ha,Wa,ab){sa=L.createCtrlInCell(sa,Ra,Ba,A);sa.setSelected(Wa);sa.setItemModels([0,1,2,3,4]);sa.setUserObject(ab);sa.setCustomPainter(function(lb,sb,xb){lb=Ha?"(":")";for(var jb="",rb=0;rb<xb;rb++)jb+=lb;sb.text(jb)});sa.addSelectedChangedListener(Ha?qb:ub)},qb=function(sa,Ra,Ba){sa=sa.getUserObject();sa.getUserObject().setLeftBracketCount(Ba);sa.getCell(1).setValue(Ba);ea.checkFilterValid();ea.firePreviewRefreshWithOnlyRepaint()},
ub=function(sa,Ra,Ba){sa=sa.getUserObject();sa.getUserObject().setRightBracketCount(Ba);sa.getCell(5).setValue(Ba);ea.checkFilterValid();ea.firePreviewRefreshWithOnlyRepaint()}}function ra(){function ja(){var pa=[],Va,cb,y,T,U,Fa=!1,Sa=!0;this.setItemModel=function(La){pa=La};this.setShowFieldNameEnable=function(La){Sa=La};this.setRawTypeSwitchListener=function(La){};this.setSearchListener=function(La){Va=La};this.setListItemPainter=function(La){cb=La};this.setShowFieldNameListener=function(La){y=
La};this.createJqPopup=function(La,eb,ta){T=$("<div>");T.appendTo(La);U=$("<div>");T.addClass("modeler-designer-field-popup");La=g.get("search","\u641c\u7d22");var Pa=new Aa;Pa.setSearchListenerDelay(200);Pa.setPlaceholder(La);Pa.addSearchListener(function(){Va(pa,Pa.getText(),U,eb,cb,Fa)});La=Pa.getJqUi();La.addClass("modeler-designer-field-popup-search");La.appendTo(T);U.addClass("modeler-designer-field-popup-list-owner");U.on("click",function(Ia){var db=$(Ia.currentTarget);Ia=$(Ia.target);if(Ia=
C.upwardSearchHasClass(Ia,db,"modeler-designer-field-popup-list-item"))Ia.addClass("modeler-designer-list-item_selected_enabled"),db=Ia.data("model"),ta(db)});U.appendTo(T);La=T.find(".sa-ctrl-textfield-input");La.css("top","0px");La.css("height","100%");if(0===pa.length)Ka(U,g.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5"));else for(La=0;La<pa.length;La++)cb(pa[La],U,eb);if(Sa){var R=g.get("showFieldName","\u663e\u793a\u539f\u5b57\u6bb5\u540d\u79f0");La=new fa;La.setText(R);La=La.getJqUi();
La.attr("title",R);La.addClass("modeler-designer-field-popup-show-field-name-label");R=new r;R.addStateChangeListener(function(Ia,db,nb){(Fa=nb)?y&&y(U,!0):y&&y(U,!1)});R.setOn(!1);R=R.getJqUi();R.addClass("modeler-designer-field-popup-show-field-name-button");var wa=$("<div>");wa.addClass("modeler-designer-field-popup-show-field-name");R.appendTo(wa);La.appendTo(wa);wa.appendTo(T)}else U.css("bottom","5px")}}var V;this.createChooseFieldPanel=function(pa){V=pa;pa=new ja;pa.setListItemPainter(P);pa.setSearchListener(Qa);
pa.setShowFieldNameListener(ea);return pa};var Ka=function(pa,Va){var cb=new fa;cb.setText(Va);cb.setEnabled(!1);cb.setAlign(fa.ALIGN_CENTER);Va=cb.getJqUi();Va.addClass("modeler-designer-field-popup-no-data");Va.appendTo(pa)},Qa=function(pa,Va,cb,y,T,U){Va=Va.toLowerCase().trim();for(var Fa=[],Sa,La=0;La<pa.length;La++)(Sa=pa[La])&&(Sa=-1!==Sa.getAlias().toLowerCase().indexOf(Va)?!0:U&&-1!==Sa.getName().toLowerCase().indexOf(Va)?!0:!1)&&Fa.push(pa[La]);cb.children().remove();if(0<Fa.length){for(La=
0;La<Fa.length;La++)T(Fa[La],cb,y);Fa.length=0}else""===Va?Ka(cb,g.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5")):Ka(cb,g.get("noSearchResult","\u627e\u4e0d\u5230\u7b26\u5408\u7684\u7ed3\u679c"));ea(cb,U)},ea=function(pa,Va){if(Va)for(pa=pa.find(".modeler-designer-field-popup-list-item-text-name"),Va=0;Va<pa.length;Va++){var cb=pa.eq(Va);cb.css("display","inline-block");var y=cb.prev().text()+cb.text();cb.prev().attr("title",null);cb.parent().attr("title",y)}else for(pa=pa.find(".modeler-designer-field-popup-list-item-text-name"),
Va=0;Va<pa.length;Va++)cb=pa.eq(Va),cb.css("display","none"),cb.parent().attr("title",null),cb.prev().attr("title",cb.prev().text())},P=function(pa,Va,cb){var y=$("<div>");y.addClass("modeler-designer-field-popup-list-item");y.data("model",pa);V(y,pa);Va.append(y);cb&&pa&&cb.getFullName()===pa.getFullName()&&da(Va,y)},da=function(pa,Va){var cb=null;0<pa.height()?(clearTimeout(cb),Va.addClass("modeler-designer-list-item_selected_enabled"),pa.prop("scrollTop",Va.prop("offsetTop"))):cb=setTimeout(function(){da(pa,
Va)},0)}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.metricdesigner&&(com.kingdee.bos.qing.modeler.designer.metricdesigner=
{});var N=com.kingdee.bos.qing.modeler.designer.metricdesigner;N.TableArea=function(){var ja,V,Ka,Qa,ea,P,da,pa,Va,cb;this.getJqUi=function(){if(!ja){ja=$("<div>");ja.addClass("modeler-designer-workarea");ja.addClass("modeler-designer-common-border");V=$("<div>");V.addClass("modeler-designer-workarea-title");var Za=$("<span>");Za.addClass("modeler-designer-workarea-title-text");Za.text(g.get("table","\u8868"));V.append(Za);Za=$("<div>");Za.addClass("modeler-designer-workarea-title-btn");na.backgroundWithHover(Za,
"add");Za.on("click",y);Za.attr("title",g.get("addTable","\u6dfb\u52a0\u6570\u636e\u8868"));Za.appendTo(ja);Ka=$("<div>");Ka.addClass("modeler-designer-workarea-container");Qa=new la;Qa.setBorderVisible(!1);Qa.setToggleSelectingEnabled(!1);Qa.setCustomItemPainter(T);Qa.setCustomSelectedsPainter(eb);Qa.addSelectedChangedListener(ta);ea=Qa.getJqUi();ea.appendTo(Ka);C.layoutCtrlWithLRTB(ea,0,0,null,0,0,null);Ka.appendTo(ja);ja.append(V);N.MetricStateMonitor.setFunUpdateTableArea(nb);N.MetricStateMonitor.setFunUpdateSingleTable(db)}return ja};
this.setGlobal=function(Za){da=Za};this.setModelerModel=function(Za){pa&&pa.removePropertyChangeCallback(Ia);pa=Za;pa.addPropertyChangeCallback(Ia);wa(!0)};this.setTableChangeCallback=function(Za){Va=Za};this.setExceptionTableChangeCallback=function(Za){cb=Za};this.showDialogIfNoTable=function(){var Za=pa.getAllTable(!0);if(!Za||0==Za.length){var kb=y();Za=new ka;Za.setCallbackImmediately(function(){kb.updateUi()});Za.observe()}};var y=function(){var Za=new Oa;Za.setGlobal(da);var kb=new za;kb.setTitle(g.get("addTable",
"\u6dfb\u52a0\u6570\u636e\u8868"));kb.setSteps([Za]);kb.show(760,540);return Za},T=function(Za,kb){var pb=U(kb),qb=0,ub=!0;pb&&(ub=N.SourceUtil.createExceptionIcon(pb.errorMessage),ub.addClass("modeler-designer-sourcearea-exception-icon"),ub.appendTo(Za),qb=22,ub=pb.invalidityType==x.TYPE_INVALID_TABLE_FILTER);Za.css("height","30px");Za.css("cursor","pointer");pb=$("<div>");pb.appendTo(Za);pb.addClass("modeler-designer-sourcearea-icon");pb.css("top","8px");pb.css("left",12+qb+"px");na.background(pb,
"qingTable");pb.appendTo(Za);pb=$("<div>");var sa=N.TableNameHelper.getDisplayText(kb);pb.text(sa);pb.addClass("modeler-designer-sourcearea-name");pb.css("left",34+qb+"px");pb.appendTo(Za);qb=new qa;qb.setStatus(ub);qb.setDeleteItemListener(function(){pa.isTableReferred(kb)?da.getMessageCurtain().showPrompt(g.get("tableIsUsed","\u8be5\u6570\u636e\u8868\u5df2\u88ab\u6307\u6807\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u7a97\u53e3\u5220\u9664\u6307\u6807\uff0c\u518d\u5220\u9664\u6570\u636e\u8868\u3002")):
R(sa).setClosingChecker(function(Ba){Ba==Q.RETURN_OK&&Sa(Za,kb);return!0})});qb.setSelectFieldListener(function(){(new Ua(kb,da)).showSelectFieldDialog()});qb.setFilterListener(function(){(new K(da,kb)).showDialog()});var Ra=qb.getJqUi();Ra.appendTo(Za);Ra.hide();Za.mouseenter(function(){Ra.show()}).mouseleave(function(){Ra.hide()});Za.data("menu",qb);Fa(pb,kb)},U=function(Za){var kb=da.getIntegration().getMapTableException();return kb?kb[Za.getUid()]:null},Fa=function(Za,kb){var pb=new w,qb=$("<div>"),
ub=$("<div>");ub.addClass("metric-designer-table-area-tips-name-container");var sa=$("<span>");sa.text(g.get("nameWithColon","\u540d\u79f0\uff1a"));sa.css("font-weight","bold");sa.appendTo(ub);sa=$("<span>");sa.text(N.TableNameHelper.getDisplayText(kb));sa.appendTo(ub);sa=$("<div>");sa.addClass("metric-designer-table-area-tips-source-container");var Ra=$("<span>");Ra.text(g.get("sourceWithColon","\u6570\u636e\u6e90\uff1a"));Ra.css("font-weight","bold");Ra.appendTo(sa);Ra=$("<span>");kb=N.SourceUtil.getTableSource(da,
kb);var Ba=da.getIntegration().getMapSourceType()[kb.getSourceId()],Ha=N.SourceUtil.getSourceIconName(Ba),Wa=$("<span>");Wa.addClass("metric-designer-table-area-tips-source-name");var ab=kb.getName();ab=ab?ab:N.SourceUtil.createSourceNameByType(kb.getSourceType());Ba?Ra.addClass("modeler-designer-addsource-source-icon"):(ab=g.get("sourceExceptionDeleted","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002"),Ra.addClass("metric-designer-table-area-tips-exception-icon"));
na.background(Ra,Ha);Ra.appendTo(sa);Wa.text(ab);Wa.appendTo(sa);ub.appendTo(qb);sa.appendTo(qb);pb.setSuggestedSize(250,90);pb.setHtml(qb);pb.mounting(Za)},Sa=function(Za,kb){var pb=da.getModelerModel();0==pb.getPublicDimensions().length?La(Za,kb):1==pb.getAllTable().length?La(Za,kb,[]):N.PublicDimensionUtil.deleteTableForPublicDimensions(kb.getUid(),da,ja,function(qb){La(Za,kb,qb)})},La=function(Za,kb,pb){var qb=new $a,ub=N.SourceUtil.getTableSource(da,kb);qb.setValue(kb,da,ub,pb);da.getCommandManager().perform(qb);
Za.remove()},eb=function(Za,kb){kb&&0<kb.length&&(Za&&0<Za.length&&(Za=Za[0],Za.css("background-color",""),Za.css("color","")),kb=kb[0],kb.css("background-color","#eff3fd"),kb.css("color","rgb(130, 130, 130)"))},ta=function(Za,kb,pb){var qb=pb[0];Za=N.SourceUtil.getTableSource(da,qb);var ub=Qa.getItemUiByModel(qb),sa=ub.data("menu");(new a(da.getRemoteImpl(),function(Ra){var Ba=Ra.isValid,Ha=!1;if(Ba)Va&&Va(qb),Ha=Ba;else{cb&&cb(qb,Ra.invalidityType);var Wa=Ra.errorMessage;Ra.invalidityType===x.TYPE_INVALID_TABLE_FILTER&&
(Ha=!0)}N.SourceUtil.updateTableItemStatus(ub,Ba,Wa);sa&&sa.updateMenuState(Ha);Ba=da.getIntegration().getMapTableException();Ba||(Ba={},da.getIntegration().setMapTableException(Ba));Ha=qb.getUid();Ba[Ha]&&!Ra.isValid||!Ba[Ha]&&Ra.isValid||(Ba=new Na,Ba.setGlobal(da),Ha=da.getModelerModel(),Wa=new ba,Wa.setModelerModel(Ha),Ba.backgroundCheck(Wa.toJsonObject()));Pa(qb,Ra)})).checkMetricTableException(Za,qb,n.getModelId())},Pa=function(Za,kb){var pb=da.getIntegration().getMapTableException();if(kb.isValid)var qb=
null;else qb={},qb.invalidityType=kb.invalidityType,qb.errorMessage=kb.errorMessage;pb[Za.getUid()]=qb},R=function(Za){var kb=Q.createFeedbackDialog();kb.setMsgImageType(Q.MSG_DELETE);kb.setOptionType(Q.OPTION_OK_CANCEL);var pb=g.get("confirmDeleteTable","\u786e\u5b9a\u5220\u9664\u8be5\u6570\u636e\u8868\u5417\uff1f");pb=pb.replace("#1",Za);kb.setMessage(pb);kb.showDialog();return kb},wa=function(Za){var kb=pa.getAllTable();Qa.setItemModels(kb);if(kb&&0!=kb.length){if(P&&P.hide(),!Za){Za=!1;var pb=
Qa.getSelecteds();if(pb)for(var qb=0;qb<pb.length;qb++)for(var ub=pb[qb],sa=0;sa<kb.length;sa++){var Ra=kb[sa];if(Ra==ub){Za=!0;1===kb.length&&(pb.push(null),Qa.setSelecteds([Ra]));break}}Za||Qa.setSelecteds([kb[0]]);ea.show()}}else ea.hide(),hb()},Ia=function(Za,kb){Za!==z.KEY_ADD_TABLE&&Za!==z.KEY_REMOVE_TABLE||wa(!1);Za!==z.KEY_TABLE_SELECT_FIELD&&Za!==z.KEY_TABLE_SET_FILTER||db(kb)},db=function(Za){var kb=N.SourceUtil.getTableSource(da,Za),pb=Qa.getItemUiByModel(Za),qb=pb.data("menu");(new a(da.getRemoteImpl(),
function(ub){var sa=ub.isValid,Ra=!1;if(sa)Ra=sa,Va&&Va(Za);else{cb&&cb(Za,ub.invalidityType);var Ba=ub.errorMessage;ub.invalidityType===x.TYPE_INVALID_TABLE_FILTER&&(Ra=!0)}N.SourceUtil.updateTableItemStatus(pb,sa,Ba);qb&&qb.updateMenuState(Ra);Pa(Za,ub)})).checkMetricTableException(kb,Za,n.getModelId())},nb=function(){var Za=pa.getAllTable();Qa.setItemModels(Za);if(Za&&0!=Za.length){P&&P.hide();var kb=!1,pb=Qa.getSelecteds();if(pb)for(var qb=0;qb<pb.length;qb++)for(var ub=pb[qb],sa=0;sa<Za.length;sa++){var Ra=
Za[sa];if(Ra==ub){kb=!0;pb.push(null);Qa.setSelecteds([Ra]);break}}kb||Qa.setSelecteds([Za[0]]);ea.show()}else ea.hide(),hb()},hb=function(){if(!P){P=$("<div>");P.appendTo(ja);P.addClass("modeler-designer-sourcearea-nosource");var Za=$("<div>");Za.appendTo(P);na.background(Za,"no_data_cloud");C.layoutCtrlCenterAlign(Za,138);C.layoutCtrl(Za,null,0,null,80);Za=$("<div>");Za.text(g.get("addTable","\u6dfb\u52a0\u6570\u636e\u8868"));Za.attr("title",g.get("addTable","\u6dfb\u52a0\u6570\u636e\u8868"));Za.on("click",
y);Za.appendTo(P);Za.addClass("modeler-designer-sourcearea-text-add")}P.show()}};N.FieldArea=function(){var ja,V,Ka,Qa,ea,P,da,pa,Va,cb,y,T,U,Fa,Sa=!1,La=[];this.getJqUi=function(){if(!ja){ja=$("<div>");ja.addClass("modeler-designer-workarea");ja.addClass("modeler-designer-common-border");Ka=$("<div>");Ka.addClass("modeler-designer-workarea-title");var hb=$("<div>");hb.addClass("metric-designer-field-area-title-text");hb.text(g.get("field","\u5b57\u6bb5"));Ka.append(hb);V=$("<div>");V.addClass("modeler-designer-workarea-container");
Va=new la;Va.setBorderVisible(!1);Va.setToggleSelectingEnabled(!1);Va.setCustomItemPainter(wa);Va.setCustomSelectedsPainter(Ia);Va.addSelectedChangedListener(db);cb=Va.getJqUi();cb.appendTo(V);C.layoutCtrlWithLRTB(cb,0,0,null,30,0,null);ja.append(Ka);ja.append(V);Pa();Va.setItemModels(La)}return ja};this.setGlobal=function(hb){y=hb};this.setModelerModel=function(hb){U&&U.removePropertyChangeCallback(nb);U=hb;U.addPropertyChangeCallback(nb)};this.setTable=function(hb){T=hb;eb();ta()};this.setExceptionTable=
function(hb,Za){T=hb;eb();switch(Za){case x.TYPE_TABLE_NOT_EXIST:case x.TYPE_MODEL_DAMAGE:case x.TYPE_MODEL_NOT_EXIST:case x.TYPE_MODEL_CYCLE_REFERENCE:case x.TYPE_REF_PUBLIC_SOURCE_NOT_EXIST:cb&&cb.hide();Qa&&Qa.hide();pa?pa.show():(pa=$("<div>"),pa.addClass("metric-designer-field-area-no-data-view"),pa.appendTo(V),hb=$("<div>"),na.background(hb,"no_data_cloud"),hb.addClass("modeler-designer-tablearea-notable-icon"),hb.appendTo(pa),hb=$("<div>"),hb.addClass("metric-designer-field-area-no-data-text"),
hb.text(g.get("noFieldInfo","\u65e0\u6cd5\u83b7\u53d6\u5b57\u6bb5\u4fe1\u606f")),hb.appendTo(pa));break;case x.TYPE_DB_CONNECTION_FAIL:hb=T.getSelectedFields();Va.setItemModels(hb);da?da.show():(da=N.SourceUtil.createExceptionIcon(g.get("showUsedField","\u8be5\u6570\u636e\u8868\u65e0\u6cd5\u4f7f\u7528\uff0c\u4ec5\u5c55\u793a\u5728\u6a21\u578b\u8bbe\u8ba1\u4e2d\u5df2\u4f7f\u7528\u7684\u5b57\u6bb5\u3002")),da.addClass("metric-designer-field-area-title-exception-icon"),da.appendTo(Ka));break;case x.TYPE_INVALID_TABLE_FILTER:ta();
break;default:cb&&cb.hide(),Qa&&Qa.hide(),P?P.show():(P=$("<div>"),P.addClass("metric-designer-field-area-no-permission-view"),P.appendTo(V),hb=$("<div>"),hb.addClass("modeler-designer-tablearea-nopermission-icon"),na.background(hb,"no-permission"),hb.appendTo(P),hb=$("<div>"),hb.addClass("metric-designer-field-area-no-permission-text"),hb.text(g.get("noTablePermission","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u8868\u7684\u6743\u9650")),hb.appendTo(P))}};var eb=function(){P&&P.hide();pa&&pa.hide();Fa&&
Fa.clear();La=[];da&&da.hide()},ta=function(){var hb=N.SourceUtil.getTableSource(y,T),Za=new a(y.getRemoteImpl(),function(kb){var pb=kb[T.getUid()];kb=[];for(var qb=0;qb<pb.length;qb++){var ub=new f;ub.fromJsonObject(pb[qb]);kb.push(ub)}if(pb=T.getSelectedFields())for(La=[],qb=0;qb<pb.length;qb++)for(ub=0;ub<kb.length;ub++){if(pb[qb].getName()==kb[ub].getName()){La.push(kb[ub]);break}}else La=kb;Va.setItemModels(La);cb&&cb.show();Qa&&Qa.show()});Za.setShowBlocking(!1);hb&&T&&Za.getTableField([hb],
[T])},Pa=function(){Fa=new Aa;Fa.setSearchListenerDelay(1E3);Fa.setShowSearchIcon(!0);Fa.setPlaceholder(g.get("searchField","\u8bf7\u8f93\u5165\u5b57\u6bb5\u540d\u79f0"));Fa.addSearchListener(function(){R($.trim(Fa.getText()))});Qa=Fa.getJqUi();Qa.addClass("modeler-designer-tablearea-search-box");Qa.appendTo(V);Qa.find(":input").on("keydown",function(hb){13==(hb.keyCode||hb.which||hb.charCode)&&R($.trim(Fa.getText()))})},R=function(hb){if(0!=La.length)if(ea&&ea.hide(),""===hb)Sa&&(Sa=!1,Va.setItemModels(La));
else{Sa=!0;hb=hb.toLowerCase();for(var Za=[],kb=0;kb<La.length;kb++)-1!=La[kb].getAlias().toLowerCase().indexOf(hb)&&Za.push(La[kb]);0==Za.length&&(ea?ea.show():(ea=$("<div>"),ea.addClass("modeler-designer-tablearea-noresult-tip"),ea.text(g.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),ea.appendTo(cb)));Va.setItemModels(Za)}},wa=function(hb,Za){hb.css("height","23px");hb.css("cursor","pointer");var kb=Za.getAlias();Za=Za.getOutputDataType();var pb=$("<div>");
pb.text(kb);if(Za){var qb=$("<div>");qb.addClass("metric-designer-field-area-icon");na.background(qb,Za);qb.appendTo(hb);pb.addClass("metric-designer-field-area-text")}else pb.css("position","absolute"),pb.css("top","2px");hb.attr("title",kb);pb.appendTo(hb)},Ia=function(hb,Za){Za&&0<Za.length&&(hb&&0<hb.length&&(hb=hb[0],hb.css("background-color",""),hb.css("color","")),Za=Za[0],Za.css("background-color","#eff3fd"),Za.css("color","rgb(130, 130, 130)"))},db=function(){},nb=function(hb,Za){hb==z.KEY_REMOVE_TABLE&&
0==y.getModelerModel().getAllTable(!1).length?(T=null,La=[],Va.setItemModels(La),ea&&ea.hide()):hb==z.KEY_TABLE_SELECT_FIELD&&Za==T&&ea&&ea.hide()}};var g,ka,C,ia,M,la,na,xa,za,aa,Aa,ua,fa,u,F,Q,r,w,L,n,t,a,c,m,b,d,h,O,f,e,z,H,D,G,q,v,k,l,p,E,A,B,Y,ha,S,Ja,ca,Ga,$a,oa,W,Ta,Ca,ma,x,Na,ba,Ea;(function(){var ja=com.kingdee.bos.qing.framework.common;g=ja.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.modeler.designer);ka=ja.WindowResizeObserver;ja=com.kingdee.bos.qing.common;C=ja.DomUtil;
ia=ja.DateFormater;M=ja.NumberFormater;Ga=ja.RelativePeriodModel;ja=com.kingdee.bos.qing.common.ui;L=ja.TableUtil;E=ja.CommonIconUtil;ca=ja.RelativePeriodPanel;ja=com.kingdee.bos.qing.ui.component;la=ja.List;za=ja.WizardDialog;aa=ja.SplitPane;Aa=ja.SearchBox;ua=ja.CheckBox;fa=ja.Label;u=ja.Menu;F=ja.MenuModel;Q=ja.MessageDialog;r=ja.SwitchButton;l=ja.AbstractModalDialog;p=ja.Button;A=ja.ComboBox;Y=ja.DropdownSelector;ha=ja.F7Selector;S=ja.DateSelector;Ja=ja.DateTimeSelector;Ca=ja.TextArea;w=ja.Tips;
ja=com.kingdee.bos.qing.modeler.designer.metricdesigner;$a=ja.DeleteTableAction;oa=ja.BatchAddTableAction;W=ja.SelectFieldAction;ma=ja.ChangeFilterAction;x=ja.MetricModelerInvalidityCase;Na=ja.ModelerChecker;ja=com.kingdee.bos.qing.modeler.designer;na=ja.Icons;xa=ja.SourceListPanel;n=ja.ModelSetSourceIntegration;t=ja.AbstractModelerSource;a=ja.DesignerFacade;c=ja.FolderNode;m=ja.LeafNode;b=ja.DesignTimeSource;d=ja.SelectFieldFactory;h=ja.Meta;O=ja.Table;e=ja.UIDHelper;z=ja.ModelerModel;H=ja.MetricEntitySource;
D=ja.MetricDataCenterSource;G=ja.MetricDefaultSource;q=ja.MetricModelSetSource;v=ja.SelectFieldView;f=ja.Field;k=ja.PreviewData;B=ja.FilterItem;Ta=ja.FilterCheckHelper;ba=ja.QingModeler;Ea=ja.UserOperationReporter})();N.ImportTableStepCreator=new function(){var ja;this.registerCreator=function(V,Ka){ja[V]=Ka};this.getSteps=function(V,Ka){if(!ja){ja={};var Qa=new H,ea=new D,P=new G,da=new q;ja[t.SOURCE_TYPE_PUBLIC_DATA_SOURCE]=P;ja[t.SOURCE_TYPE_CURRENT_ENTITY_SOURCE]=Qa;ja[t.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE]=
ea;ja[t.SOURCE_TYPE_MODELSET_FILE_SOURCE]=P;ja[t.SOURCE_TYPE_MODELSET_DB_SOURCE]=P;ja[t.SOURCE_TYPE_MODEL_SET_SOURCE]=da;ja[t.SOURCE_TYPE_OPEN_API_SOURCE]=P}Qa=V.getSourceType();ea=ja[Qa];Qa=new Ya;Qa.setGlobal(Ka);Qa.setSource(V);Qa.setSourceUiModel(ea);V=new Ma;V.setGlobal(Ka);return[Qa,V]}};var Xa=!1})();(function(){function qa(){fa.call(this);var r=this.protectedMethod,w=ia.get("aggregate","\u805a\u5408"),L=r.createType([ib,Ya,Ma,ya,Da,va]),n=C.get("func_type_business","\u4e1a\u52a1"),t=r.createType([I]),a=C.get("func_type_predefine","\u8de8\u7ef4\u5ea6\u9884\u8ba1\u7b97"),c=r.createType([K,J,X,Z,ra]),m=C.get("func_type_derivative","\u89c6\u56fe\u8ba1\u7b97"),b=r.createType([N,g]),d=[r.Type_All,r.Type_String,r.Type_Date,r.Type_Logic,r.Type_Math,r.Type_Conversion,m,w],h=r.joinTypes([r.Functions_String,
r.Functions_Date,r.Functions_Logic,r.Functions_Math,r.Functions_Conversion,b,L]);this.getTypes=function(){return d};this.getFunctions=function(f){var e=r.getBasicFunctions(f)||O(f);if(!e){if(f==r.Type_All)return h;throw Error("Unknown function type.");}return e};var O=function(f){switch(f){case w:return L;case n:return t;case a:return c;case m:return b;default:return null}}}function Ua(){var r=[],w=[],L;this.add=function(n,t){r.push(n);w.push(t)};this.getCount=function(){return r.length};this.getName=
function(n){return r[n]};this.getDesc=function(n){return w[n]};this.setExtraDesc=function(n){L=n};this.getExtraDesc=function(){return L}}function Oa(){var r,w=this;this.getName=function(){throw Error("Override me.");};this.getDesc=function(){throw Error("Override me.");};this.getSyntax=function(){return null};this.getReturn=function(){return null};this.getExample=function(){return null};this.getParameters=function(){r||null===r||(r=w.protectedCreateParamsImpl());return r};this.protectedCreateParamsImpl=
function(){return null};this.getTyping=function(){return w.getName()+"()"};this.protectedMethod={Tab:"&nbsp;&nbsp;&nbsp;&nbsp;",NextLine:"<br/>",NextLineTab:"<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}}function ib(){Oa.call(this);this.protectedCreateParamsImpl=function(){var r=new Ua;r.add("exp",ia.get("SUM_PARAM","\u6570\u503c\u8868\u8fbe\u5f0f\u3002"));return r};this.getName=function(){return"SUM"};this.getDesc=function(){return ia.get("SUM_DESC","\u8fd4\u56de\u6570\u503c\u8868\u8fbe\u5f0f\u6240\u6709\u503c\u7684\u603b\u8ba1\uff0c\u4e14\u4f1a\u5ffd\u7565null\u503c\u3002")};
this.getSyntax=function(){return"SUM(exp)"};this.getExample=function(){return ia.get("SUM_EXAMPLE",'SUM([\u9500\u552e\u989d])\uff0c\u8fd4\u56de"\u9500\u552e\u989d"\u5b57\u6bb5\u5bf9\u5e94\u7684\u6240\u6709\u975e\u7a7a\u503c\u7684\u603b\u548c\u3002')}}function Ya(){Oa.call(this);this.protectedCreateParamsImpl=function(){var r=new Ua;r.add("exp",ia.get("AVG_PARAM","\u6570\u503c\u8868\u8fbe\u5f0f\u3002"));return r};this.getName=function(){return"AVG"};this.getDesc=function(){return ia.get("AVG_DESC",
"\u8fd4\u56de\u6570\u503c\u8868\u8fbe\u5f0f\u6240\u6709\u503c\u7684\u5e73\u5747\u503c\uff0c\u4e14\u4f1a\u5ffd\u7565null\u503c\u3002")};this.getSyntax=function(){return"AVG(exp)"};this.getExample=function(){return ia.get("AVG_EXAMPLE",'AVG([\u9500\u552e\u989d])\uff0c\u8fd4\u56de"\u9500\u552e\u989d"\u5b57\u6bb5\u5bf9\u5e94\u7684\u6240\u6709\u975e\u7a7a\u503c\u7684\u5e73\u5747\u503c\u3002')}}function Ma(){Oa.call(this);this.protectedCreateParamsImpl=function(){var r=new Ua;r.add("exp",ia.get("COUNT_PARAM",
"\u8868\u8fbe\u5f0f\u3002"));return r};this.getName=function(){return"COUNT"};this.getDesc=function(){return ia.get("COUNT_DESC","\u8fd4\u56de\u6570\u636e\u6761\u76ee\u6570\uff0c\u4e14\u8868\u8fbe\u5f0f\u7684\u503c\u4e3anull\u65f6\u4e0d\u4f1a\u8ba1\u6570\u3002")};this.getSyntax=function(){return"COUNT(exp)"};this.getExample=function(){return ia.get("COUNT_EXAMPLE",'COUNT([\u9500\u552e\u989d]),\u8fd4\u56de"\u9500\u552e\u989d"\u5b57\u6bb5\u5bf9\u5e94\u7684\u6240\u6709\u975e\u7a7a\u503c\u7684\u6570\u636e\u6761\u76ee\u6570\u3002\u5982\u9500\u552e\u989d\u5b57\u6bb5\u67091000\uff0c1000\uff0c500 \u5171\u4e09\u4e2a\u6570\u503c\uff0c\u5219COUNT([\u9500\u552e\u989d])\u7ed3\u679c\u4e3a3\u3002')}}
function ya(){Oa.call(this);this.protectedCreateParamsImpl=function(){var r=new Ua;r.add("exp",ia.get("MAX_PARAM","\u6570\u503c\u8868\u8fbe\u5f0f\u3002"));return r};this.getName=function(){return"MAX"};this.getDesc=function(){return ia.get("MAX_DESC","\u8fd4\u56de\u6570\u503c\u8868\u8fbe\u5f0f\u6240\u6709\u503c\u7684\u6700\u5927\u503c\u3002")};this.getSyntax=function(){return"MAX(exp)"};this.getExample=function(){return ia.get("MAX_EXAMPLE",'MAX([\u9500\u552e\u989d])\uff0c\u8fd4\u56de"\u9500\u552e\u989d"\u5b57\u6bb5\u5bf9\u5e94\u503c\u7684\u6700\u5927\u503c\u3002')}}
function Da(){Oa.call(this);this.protectedCreateParamsImpl=function(){var r=new Ua;r.add("exp",ia.get("MIN_PARAM","\u6570\u503c\u8868\u8fbe\u5f0f\u3002"));return r};this.getName=function(){return"MIN"};this.getDesc=function(){return ia.get("MIN_DESC","\u8fd4\u56de\u6570\u503c\u8868\u8fbe\u5f0f\u6240\u6709\u503c\u7684\u6700\u5c0f\u503c\u3002")};this.getSyntax=function(){return"MIN(exp)"};this.getExample=function(){return ia.get("MIN_EXAMPLE",'MIN([\u9500\u552e\u989d])\uff0c\u8fd4\u56de"\u9500\u552e\u989d"\u5b57\u6bb5\u5bf9\u5e94\u503c\u7684\u6700\u5c0f\u503c\u3002')}}
function va(){Oa.call(this);this.protectedCreateParamsImpl=function(){var r=new Ua;r.add("exp",ia.get("COUNTD_PARAM","\u8868\u8fbe\u5f0f\u3002"));return r};this.getName=function(){return"COUNTD"};this.getDesc=function(){return ia.get("COUNTD_DESC","\u8fd4\u56de\u6307\u5b9a\u5b57\u6bb5\u4e0d\u91cd\u590d\u7684\u503c\u7684\u4e2a\u6570\uff0c\u5f53\u503c\u4e3anull\u65f6\u4e0d\u53c2\u4e0e\u8ba1\u6570\u3002")};this.getSyntax=function(){return"COUNTD(exp)"};this.getExample=function(){return ia.get("COUNTD_EXAMPLE",
'\u5047\u8bbe\u82e5\u5e72\u884c\u6570\u636e\u4e2d\uff0c"\u6027\u522b"\u5b57\u6bb5\u6709"\u7537"\u3001"\u5973"\u4e24\u4e2a\u4e0d\u540c\u7684\u503c\uff0c\u5219COUNTD([\u6027\u522b])\uff0c\u8fd4\u56de2\u3002')}}function I(){Oa.call(this);this.protectedCreateParamsImpl=function(){var r=new Ua;r.add("org",C.get("ACCT_param","\u6838\u7b97\u7ec4\u7ec7\uff1a\u4e0d\u53ef\u4e3a\u7a7a\u3002"));r.add("accountBooksType",C.get("ACCT_param","\u8d26\u7c3f\u7c7b\u578b\uff1a\u53ef\u4e3a\u7a7a\u3002"));r.add("account",
C.get("ACCT_param","\u79d1\u76ee\u53ca\u6838\u7b97\u7ef4\u5ea6\u6210\u5458\uff1a\u4e0d\u53ef\u4e3a\u7a7a\uff0c\u6838\u7b97\u7ef4\u5ea6\u6210\u5458\u652f\u6301@\u901a\u914d\u7b26\uff0c\u9700\u8981\u5728\u5408\u5e76\u62a5\u8868\u7684\u96c6\u6210\u89c4\u5219\u4e2d\u914d\u7f6e\u7ef4\u5ea6\u6620\u5c04\u3002"));r.add("fetchType",C.get("ACCT_param","\u53d6\u6570\u7c7b\u578b\uff1a\u4e0d\u53ef\u4e3a\u7a7a\u3002"));r.add("fy",C.get("ACCT_param","\u4f1a\u8ba1\u5e74\u5ea6\uff1a\u4e0d\u53ef\u4e3a\u7a7a\uff0c\u652f\u6301\u76f8\u5bf9\u503c\uff0c\u5f55\u5165\u56db\u4f4d\u8868\u793a\u7edd\u5bf9\u5e74\u5ea6\uff0c\u5f55\u5165\u5c0f\u4e8e\u56db\u4f4d\u7684\u6574\u6570\u30010\u6216\u8005\u8d1f\u6574\u6570\u8868\u793a\u76f8\u5bf9\u503c\u3002"));
r.add("period",C.get("ACCT_param","\u4f1a\u8ba1\u671f\u95f4\uff1a\u4e0d\u53ef\u4e3a\u7a7a\uff0c\u652f\u6301\u76f8\u5bf9\u503c\uff0c\u5f55\u5165\u5927\u4e8e0\u7684\u6b63\u6574\u6570\u8868\u793a\u7edd\u5bf9\u671f\u95f4\uff0c\u5f55\u51650\u6216\u8005\u8d1f\u6574\u6570\u8868\u793a\u76f8\u5bf9\u503c\u3002"));r.add("currency",C.get("ACCT_param","\u5e01\u522b\uff1a\u53ef\u4e3a\u7a7a\u3002"));r.add("reClassParam",C.get("ACCT_param","\u91cd\u5206\u7c7b\u53c2\u6570\uff1a\u53ef\u4e3a\u7a7a\u3002"));r.add("contraAccount",
C.get("ACCT_param","\u79d1\u76ee\u62b5\u9500\uff1a\u53ef\u4e3a\u7a7a\u3002"));r.add("commonAssist",C.get("ACCT_param","\u516c\u5171\u7ef4\u5ea6\uff1a\u53ef\u4e3a\u7a7a\u3002"));return r};this.getName=function(){return"ACCT"};this.getDesc=function(){return C.get("ACCT_DESC","\u83b7\u53d6\u603b\u8d26\u4f1a\u8ba1\u79d1\u76ee\u6570\u636e\u3002\u53ef\u5728\u5e94\u7528\u5408\u5e76\u62a5\u8868->\u7cfb\u7edf\u914d\u7f6e->\u62a5\u8868\u6a21\u7248\u4e2d\u63d2\u5165\u51fd\u6570\u4e2d\u7f16\u8f91\u597d\u516c\u5f0f\u3002")};
this.getSyntax=function(){return"ACCT(org, accountBooksType, account, fetchType, fy, period, currency, reClassParam, contraAccount, commonAssist)"};this.getExample=function(){return C.get("ACCT_EXAMPLE",'SUM(ACCT([\u6838\u7b97\u7ec4\u7ec7],[\u8d26\u7c3f\u7c7b\u578b],"0316|0001|country:001","LY",[\u4f1a\u8ba1\u5e74\u5ea6],"[\u4f1a\u8ba1\u671f\u95f4]","CNY20783","6","N",""))\uff0c\u8fd4\u56de\u201c\u6838\u7b97\u7ec4\u7ec7\u201d\u3001\u201d\u8d26\u7c3f\u7c7b\u578b\u201c\u3001\u201d\u4f1a\u8ba1\u5e74\u5ea6\u201c\u3001\u201d\u4f1a\u8ba1\u671f\u95f4\u201c\u5b57\u6bb5\u5bf9\u5e94\u7684\u6240\u6709\u603b\u8d26\u4f1a\u8ba1\u6570\u636e\u4e4b\u548c\u3002')}}
function K(){Oa.call(this);this.protectedCreateParamsImpl=function(){};this.getName=function(){return"PREDEFINE"};this.getDesc=function(){};this.getSyntax=function(){};this.getExample=function(){}}function J(){Oa.call(this);this.protectedCreateParamsImpl=function(){};this.getName=function(){return"DIMENSIONS"};this.getDesc=function(){};this.getSyntax=function(){};this.getExample=function(){}}function X(){Oa.call(this);this.protectedCreateParamsImpl=function(){};this.getName=function(){return"MOREDIMENSIONS"};
this.getDesc=function(){};this.getSyntax=function(){};this.getExample=function(){}}function Z(){Oa.call(this);this.protectedCreateParamsImpl=function(){};this.getName=function(){return"LESSDIMENSIONS"};this.getDesc=function(){};this.getSyntax=function(){};this.getExample=function(){}}function ra(){Oa.call(this);this.protectedCreateParamsImpl=function(){};this.getName=function(){return"DATEPART"};this.getDesc=function(){};this.getSyntax=function(){};this.getExample=function(){}}function N(){Oa.call(this);
var r=this.protectedMethod;this.protectedCreateParamsImpl=function(){var w=new Ua;w.add("exp",C.get("SPLY_PARAM1","\u8868\u8fbe\u5f0f\uff0c\u53ef\u4f7f\u7528\u6307\u6807\u6216\u81ea\u5b9a\u4e49\u7684\u805a\u5408\u51fd\u6570\u8868\u8fbe\u5f0f\u3002"));w.add("dateDimension",C.get("SPLY_PARAM2","\u65e5\u671f\u7ef4\u5ea6\u3002"));w.add("type",C.get("SPLY_PARAM3",'\u7f3a\u7701\u76f8\u5f53\u4e8e"ratio"\uff0c\u8868\u793a\u540c\u6bd4\u589e\u957f\u7387\uff1b"value"\u8868\u793a\u53d6\u53bb\u5e74\u540c\u671f\u503c\uff1b"diff"\u8868\u793a\u540c\u6bd4\u5dee\u989d\u3002'));
return w};this.getName=function(){return"SAMEPERIODLASTYEAR"};this.getDesc=function(){return C.get("SPLY_DESC","\u57fa\u4e8e\u6307\u5b9a\u65e5\u671f\u7ef4\u5ea6\u7684\u540c\u6bd4\u8ba1\u7b97\u3002")};this.getSyntax=function(){return"SAMEPERIODLASTYEAR(exp, dateDimension [,type])"};this.getExample=function(){return C.get("SPLY_EXAMPLE","\u4f8b1\uff1aSAMEPERIODLASTYEAR([\u9500\u552e\u989d], [\u8ba2\u5355\u65e5\u671f(\u5e74)]) \u8ba1\u7b97\u9500\u552e\u989d\u6309\u8ba2\u5355\u65e5\u671f(\u5e74)\u7684\u540c\u6bd4\u589e\u957f\u7387\u3002"+
r.NextLineTab+'\u4f8b2\uff1aSAMEPERIODLASTYEAR(SUM([\u91d1\u989d]), [\u8ba2\u5355\u65e5\u671f(\u5e74)], "value") \u8ba1\u7b97\u91d1\u989d\u5408\u8ba1\u503c\u6309\u8ba2\u5355\u65e5\u671f(\u5e74)\u7684\u53bb\u5e74\u540c\u671f\u503c\u3002')}}function g(){Oa.call(this);var r=this.protectedMethod;this.protectedCreateParamsImpl=function(){var w=new Ua;w.add("exp",C.get("LP_PARAM1","\u8868\u8fbe\u5f0f\uff0c\u53ef\u4f7f\u7528\u6307\u6807\u6216\u81ea\u5b9a\u4e49\u7684\u805a\u5408\u51fd\u6570\u8868\u8fbe\u5f0f\u3002"));
w.add("dateDimension",C.get("LP_PARAM2","\u65e5\u671f\u7ef4\u5ea6\u3002"));w.add("type",C.get("LP_PARAM3",'\u7f3a\u7701\u76f8\u5f53\u4e8e"ratio"\uff0c\u8868\u793a\u73af\u6bd4\u589e\u957f\u7387\uff1b"value"\u8868\u793a\u53d6\u4e0a\u671f\u503c\uff1b"diff"\u8868\u793a\u73af\u6bd4\u5dee\u989d\u3002'));return w};this.getName=function(){return"LASTPERIOD"};this.getDesc=function(){return C.get("LP_DESC","\u57fa\u4e8e\u6307\u5b9a\u65e5\u671f\u7ef4\u5ea6\u7684\u73af\u6bd4\u8ba1\u7b97\u3002")};this.getSyntax=
function(){return"LASTPERIOD(exp, dateDimension [,type])"};this.getExample=function(){return C.get("LP_EXAMPLE","\u4f8b1\uff1aLASTPERIOD([\u9500\u552e\u989d], [\u8ba2\u5355\u65e5\u671f(\u5e74)]) \u8ba1\u7b97\u9500\u552e\u989d\u6309\u8ba2\u5355\u65e5\u671f(\u5e74)\u7684\u73af\u6bd4\u3002"+r.NextLineTab+'\u4f8b2\uff1aLASTPERIOD(SUM([\u91d1\u989d]), [\u8ba2\u5355\u65e5\u671f(\u5e74)], "diff") \u8ba1\u7b97\u91d1\u989d\u5408\u8ba1\u503c\u6309\u8ba2\u5355\u65e5\u671f(\u5e74)\u7684\u73af\u6bd4\u5dee\u989d\u3002')}}
"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.metricdesigner&&(com.kingdee.bos.qing.modeler.designer.metricdesigner=
{});var ka=com.kingdee.bos.qing.modeler.designer.metricdesigner;ka.ExprPane=function(){function r(){var q,v,k;this.getJqUi=function(){q||(q=$("<div>"),v=$("<div>"),k=$("<div>"),la.layoutCtrl(k,0,null,16,16),la.layoutCtrlMiddleAlign(k,16),la.layoutCtrlMiddleAlign(v,16),la.makeTextOmissible(v),v.css("max-width","380px"),v.css("left","20px"),k.appendTo(q),v.appendTo(q));return q};this.setValidity=function(l){l.isValid()?(v.text(C.get("formulaValid","\u8868\u8fbe\u5f0f\u5408\u6cd5")),v.attr("title",C.get("formulaValid",
"\u8868\u8fbe\u5f0f\u5408\u6cd5")),v.css("color","#80ba55"),ua.background(k,"tick")):(v.text(l.getPrompt()),v.attr("title",l.getPrompt()),v.css("color","#fd6c6a"),ua.background(k,"cross"))}}var w,L,n,t,a,c,m,b,d=!1;this.getJqUi=function(){if(!w){w=$("<div>");var q=new na(C.get("expression","\u8868\u8fbe\u5f0f"));q.setRequired(!0);q=q.getJqUi();la.layoutCtrl(q,0,0,70,20);t=new xa;t.addEditedListener(H);var v=t.getJqUi();la.layoutCtrlWithLRTB(v,0,0,null,30,270,null);m=new r;var k=m.getJqUi();la.layoutCtrlWithLRTB(k,
70,0,null,0,null,20);var l=(new na(C.get("function","\u51fd\u6570"))).getJqUi();la.layoutCtrlWithLRTB(l,0,null,230,null,240,23);var p=(new na(C.get("functionDescription","\u51fd\u6570\u8bf4\u660e"))).getJqUi();la.layoutCtrlWithLRTB(p,250,0,null,null,240,23);a=$("<div>");a.addClass("sa-common-border");a.css("overflow-y","auto");la.layoutCtrlWithLRTB(a,250,0,null,null,0,233);var E=h();la.layoutCtrlWithLRTB(E,0,null,230,null,0,240);q.appendTo(w);v.appendTo(w);k.appendTo(w);l.appendTo(w);p.appendTo(w);
a.appendTo(w);E.appendTo(w)}return w};this.getExpr=function(){return ka.ExprRefHelper.translateToExeExpr($.trim(t.getText()),b?b():{})};this.setExpr=function(q){q&&(t.setText(ka.ExprRefHelper.translateToDisplayExpr(q)),G(q))};this.setFieldMapGetter=function(q){b=q};this.setGlobal=function(q){L=q};this.setCurrentMetricId=function(q){n=q};this.addExprReference=function(q){q=ka.ExprRefHelper.getRefFullDisplayText(q);e(q)};this.checkValidity=function(){if(0==$.trim(t.getText()).length)return C.get("exprEmpty",
"\u8868\u8fbe\u5f0f\u4e0d\u80fd\u4e3a\u7a7a\u3002");if(d)return C.get("exprChecking","\u8868\u8fbe\u5f0f\u6821\u9a8c\u4e2d\uff0c\u8bf7\u7a0d\u7b49\u3002");if(c&&!c.isValid())return C.get("checkExprFirst","#1\uff0c\u8bf7\u586b\u5199\u6b63\u786e\u7684\u8868\u8fbe\u5f0f\u3002").replace("#1",c.getPrompt())};var h=function(){var q=$("<div>"),v=ka.QingModelerFunctionProvider.getAllTypes(),k=v[v.length-1],l=new Aa;l.setBorderVisible(!1);l.setMultiSelectable(!1);l.setCustomItemPainter(function(Y,ha){Y.text(ha.getName())});
l.addDBLClickListener(function(Y){Y=l.getSelecteds()[0];e(Y.getTyping())});l.addPressedListener(function(Y,ha){Y=l.getSelecteds()[0];O(Y)});var p=ka.QingModelerFunctionProvider.getFunctions(k);l.setItemModels(p);l.setSelecteds([p[0]]);O(p[0]);var E=new za;E.setItemModels(v);E.setSelected(k);E.addSelectedChangedListener(function(Y,ha,S){A.clear();Y=ka.QingModelerFunctionProvider.getFunctions(E.getSelected());l.setItemModels(Y)});var A=new aa;A.setPlaceholder(M.get("searchboxPlaceholder","\u641c\u7d22"));
A.addSearchListener(function(Y){Y=$.trim(A.getText()).toUpperCase();var ha=[],S=ka.QingModelerFunctionProvider.getFunctions(E.getSelected());if(Y)for(var Ja=0;Ja<S.length;Ja++)0<=S[Ja].getName().indexOf(Y)&&ha.push(S[Ja]);else ha=S;l.setItemModels(ha)});v=$("<div>");v.addClass("sa-common-border");k=A.getJqUi();p=l.getJqUi();var B=E.getJqUi();la.layoutCtrlWithLRTB(k,0,0,null,0,null,23);la.layoutCtrlWithLRTB(p,0,0,null,24,0,null);k.appendTo(v);p.appendTo(v);la.layoutCtrlWithLRTB(B,0,0,null,0,null,23);
la.layoutCtrlWithLRTB(v,0,0,null,30,0,null);v.appendTo(q);B.appendTo(q);return q},O=function(q){if(q){var v="<div style=padding:10px;color:#666>";q.getDesc()&&(v+=M.get("descFeature","\u529f\u80fd\uff1a"),v=v+"<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+f(q.getDesc()));q.getSyntax()&&(v=v+"<br/><br/>"+M.get("descGrammar","\u8bed\u6cd5\uff1a"),v=v+"<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+f(q.getSyntax()));var k=q.getParameters();if(k){v=v+"<br/><br/>"+M.get("descParams","\u53c2\u6570\uff1a");
for(var l=0;l<k.getCount();l++)v+="<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",v+=k.getName(l),v+=" ",v+=f(k.getDesc(l));(k=k.getExtraDesc())&&(v=v+"<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+f(k))}k=q.getReturn();l=q.getExample();k&&(v=v+"<br/><br/>"+M.get("descReturn","\u8fd4\u56de\u503c\uff1a"),v=v+"<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+f(q.getReturn()));l&&(v=v+"<br/><br/>"+M.get("descExamples","\u793a\u4f8b\uff1a"),v=v+"<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+
f(q.getExample()));a.html(v+"</div>")}},f=function(q){for(;-1!=q.indexOf("<");)q=q.replace("<","&lt;");for(;-1!=q.indexOf("&lt;br/>");)q=q.replace("&lt;br/>","<br/>");return q},e=function(q){var v=t.getSelectingScope(),k=v[0];v=v[1];var l=t.getText();l=l.substring(0,k)+q+l.substring(v);t.setText(l);k+=q.length;q.match("\\(\\)")&&--k;t.setSelectingScope(k,k);t.requestFocus();H()},z,H=function(){clearTimeout(z);d=!0;z=setTimeout(function(){var q=ka.ExprRefHelper.translateToExeExpr($.trim(t.getText()),
b?b():{});G(q)},1E3)},D,G=function(q){var v=new u(L.getRemoteImpl(),function(p){D==q&&(c=new Q,c.fromJsonObject(p),m.setValidity(c),d=!1)}),k=new F,l=L.getModelerModel();k.setModelerModel(l);v.setShowBlocking(!1);l=b?b():{};D=q;v.checkMetricFormula(q,k,l,n)}};var C,ia,M,la,na,xa,za,aa,Aa,ua,fa,u,F,Q;(function(){var r=com.kingdee.bos.qing.framework.common;C=r.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.modeler.designer);ia=r.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.functions);
M=r.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.common.ui);r=com.kingdee.bos.qing.common;la=r.DomUtil;r=com.kingdee.bos.qing.ui.component;na=r.Label;xa=r.TextArea;za=r.ComboBox;aa=r.SearchBox;Aa=r.List;r=com.kingdee.bos.qing.functions;fa=r.AbstractFunctionProvider;r=com.kingdee.bos.qing.modeler.designer;F=r.QingModeler;u=r.DesignerFacade;ua=r.Icons;Q=ka.ExprValidity})();ka.QingModelerFunctionProvider=new function(){var r;this.getAllTypes=function(){r||(r=new qa);return r.getTypes()};
this.getFunctions=function(w){r||(r=new qa);return r.getFunctions(w)}}})();(function(){function qa(){var r=this,w,L,n,t;this.getJqUi=function(){w||(w=$("<div>"),a(w,c().getJqUi()));return w};var a=function(m,b){var d=new M;d.setText(va.get("search","\u641c\u7d22"));var h=r.createAllSearchImpl();r.changeSearchImpl(h[0],!1);var O=new ia;O.setItemModels(h);O.setSelected(h[0]);O.setCustomPainter(function(f,e,z){z&&e.text(z.getCaption())});O.addSelectedChangedListener(function(f,e,z){r.changeSearchImpl(z,!0)});d=d.getJqUi();O=O.getJqUi();I.layoutCtrlWithLRTB(d,0,null,40,0,null,
23);I.layoutCtrlWithLRTB(O,40,null,80,0,null,23);I.layoutCtrlWithLRTB(b,130,0,null,0,null,23);m.append(d);m.append(O);m.append(b)};this.setSearchingHandler=function(m){t=m};this.isSearching=function(){return r.getSearchText()?!0:!1};this.check=function(m){return!r.getSearchText()||n.check(m.toLowerCase(),r.getSearchText().toLowerCase())};this.clear=function(){L&&L.clear()};this.createAllSearchImpl=function(){return[new Oa(!0),new Oa(!1),new Ya(!0),new Ya(!1),new Ma(!0),new Ma(!1),new ib(!0),new ib(!1)]};
var c=function(){L=new ka;L.setShowSearchIcon(!0);L.setPlaceholder(va.get("searcherTips","\u641c\u7d22\u5185\u5bb9"));L.addSearchListener(function(m){t()});L.setSearchListenerDelay(1E3);return L};this.changeSearchImpl=function(m,b){n=m;b&&t()};this.getSearchText=function(){return L?L.getText():null};this.search=function(m,b){return n.doMatch(m,b)}}function Ua(r){var w=this;this.getCaption=function(){return w.protectedGetCaption(!r)};this.protectedGetCaption=function(L){throw Error("Override");};this.check=
function(L,n){L=w.protectedCheckImpl(L,n);return r?L:!L};this.protectedCheckImpl=function(L,n){throw Error("Override");};this.doMatch=function(L,n){n+="";return r?w.protectedCheckImpl(n,L):!w.protectedCheckImpl(n,L)}}function Oa(r){Ua.call(this,r);this.protectedGetCaption=function(w){return w?va.get("searchNotInclude","\u4e0d\u5305\u542b"):va.get("searchInclude","\u5305\u542b")};this.protectedCheckImpl=function(w,L){return 0<=w.indexOf(L)}}function ib(r){Ua.call(this,r);this.protectedGetCaption=function(w){return w?
va.get("searchNotEqual","\u4e0d\u7b49\u4e8e"):va.get("searchEqual","\u7b49\u4e8e")};this.protectedCheckImpl=function(w,L){return w===L}}function Ya(r){Ua.call(this,r);this.protectedGetCaption=function(w){return w?va.get("searchNotStartOf","\u5f00\u5934\u4e0d\u662f"):va.get("searchStartOf","\u5f00\u5934\u662f")};this.protectedCheckImpl=function(w,L){return 0==w.indexOf(L)}}function Ma(r){Ua.call(this,r);this.protectedGetCaption=function(w){return w?va.get("searchNotEndOf","\u7ed3\u5c3e\u4e0d\u662f"):
va.get("searchEndOf","\u7ed3\u5c3e\u662f")};this.protectedCheckImpl=function(w,L){var n=w.lastIndexOf(L);return 0<=n&&n==w.length-L.length}}function ya(){var r,w=ya.TYPE_TEXT,L=va.get("noDataTips","\u6682\u65e0\u6570\u636e"),n;this.getJqUi=function(){if(!r)switch(r=$("<div>"),r.addClass("modeler-designer-no-data"),w){case ya.TYPE_TEXT:a(L,"modeler-designer-no-data-only-text");break;case ya.TYPE_NO_SOURCE:t("no_source","modeler-designer-no-data-icon");a(L,"modeler-designer-no-data-text");break;case ya.TYPE_NO_SEARCH_RESULT:t("search-no-result",
"modeler-designer-node-selection-icon");a(L,"modeler-designer-node-selection-tip");break;case ya.TYPE_NO_DATA_WITH_CLOUD:t("no_data_cloud","modeler-designer-no-data-cloud-icon");a(L,"modeler-designer-no-data-text");break;default:throw Error("The view type error, please set first.");}return r};this.setType=function(c){w=c};this.setText=function(c){L=c?c:"";n&&n.text(L)};var t=function(c,m){var b=$("<div>");b.addClass(m);za.background(b,c);b.appendTo(r)},a=function(c,m){n=$("<div>");n.addClass(m);n.text(c);
n.appendTo(r)}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.metricdesigner&&(com.kingdee.bos.qing.modeler.designer.metricdesigner=
{});var Da=com.kingdee.bos.qing.modeler.designer.metricdesigner;Da.MetricsCalculateDialog=function(){function r(Ca){KTDefaultCellRender.call(this,Ca);var ma=this,x=this.paintCellUI;this.paintCellUI=function(Na,ba){var Ea=ma.getCurrentRowIdx(),Xa=ma.getCurrentRow(),ja=ma.getCurrentColIdx(),V=Xa.getUserObject();Ea<na.getHeadRowCount()?x(Na,ba):(ba=H.getField(ja),Ea=ba.getOutputDataType(),V=V[ja],null===V||void 0===V?V="":"DATE"===Ea?(Xa=new K,Xa.setFormatString("yyyy-MM-dd"),V=Xa.format(V)):"DATETIME"===
Ea?(Xa=new K,Xa.setFormatString("yyyy-MM-dd HH:mm:ss"),V=Xa.format(V)):"BOOLEAN"===Ea?V=V?"true":"false":"NUMBER"===Ea&&(Ea=new KTStyle,Ea.setTextAlign("right"),Xa.getCell(ja).setStyle(Ea),Xa=ba.getFormat())&&(ja=new J,ja.setFormatString(Xa),V=ja.format(V)),Xa=$("<div class='metric-designer-trial-calculate-table-cell'>"),Xa.text(V),Xa.attr("title",V),Xa.appendTo(Na))}}function w(Ca,ma){function x(Qa,ea,P){function da(){var Ha,Wa,ab;this.setValue=function(lb){Ha=lb};this.getValue=function(){return Ha};
this.setText=function(lb){Wa=lb};this.getText=function(){return Wa};this.setChecked=function(lb){ab=lb};this.isChecked=function(){return ab}}function pa(Ha){var Wa,ab=new C;this.getJqUi=function(){Wa||(ab.setUserObject(Ha.getValue()),ab.setText(Ha.getText()),ab.setChecked(Ha.isChecked()),ab.addCheckedListener(lb),Wa=ab.getJqUi(),Wa.css("position","relative"));return Wa};var lb=function(sb,xb){Ha.setChecked(sb.isChecked());Ra(sb,xb)}}X.call(this);var Va=this,cb=this.protectedMethod,y,T,U=[],Fa=[],
Sa=!1,La,eb,ta,Pa,R=new K,wa;(function(){cb.setTitle(Qa.getDimensionModel().getName());cb.setSelectable(!0);cb.setContentPaneCreator(function(){var Ha=ea.length,Wa=Math.max(60,Math.min(parseInt(.9*$(document.body).innerHeight())-180,420));Ha=Math.min(Wa,Math.max(60,23*Ha));Ha=Math.max(Ha+180,305);Va.setSize(600,Ha);if(!y){y=$("<div>");Ia(y);Ha=y;Wa=$("<div>");I.layoutCtrlWithLRTB(Wa,0,0,null,0,null,55);T=new qa;T.setSearchingHandler(kb);var ab=T.getJqUi();I.layoutCtrlWithLRTB(ab,0,200,null,0,null,
23);ab.appendTo(Wa);ab=new C;ab.setText(va.get("showOnlySelected","\u4ec5\u663e\u793a\u9009\u4e2d\u9879"));ab.setChecked(Sa);ab.addCheckedListener(pb);ab=ab.getJqUi();I.layoutCtrlWithLRTB(ab,null,0,120,4,null,21);ab.appendTo(Wa);La=new C;La.setText(va.get("selectAll","\u5168\u9009"));La.setChecked(0===P.length?!0:P.length===ea.length);La.addCheckedListener(ub);ab=La.getJqUi();I.layoutCtrlWithLRTB(ab,0,null,80,30,null,21);ab.appendTo(Wa);eb=new M;ab=eb.getJqUi();I.layoutCtrlWithLRTB(ab,80,0,null,30,
null,21);ab.appendTo(Wa);Wa.appendTo(Ha);sa()}return y});cb.setClosingChecker(function(){return 0===Za().length?(cb.getMessageCurtain().showPrompt(va.get("noSelectValue","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u7ef4\u5ea6\u503c\u3002"),2E3),!1):!0});cb.setClosingAction(function(Ha){if(Ha){Ha=Za();var Wa=V(Ha);ca(Wa);Qa.updateSelectedDimensionValue(Ha);Q.occur(Q.FUNCTION,Q.TRIAL_CALCULATE_DIMENSION_FILTER)}})})();var Ia=function(Ha){var Wa=$("<div>");I.layoutCtrlWithLRTB(Wa,0,0,null,55,10,null);
nb(ea,Wa);wa=new la;wa.setItemHeight(23);var ab=wa.getJqUi();wa.setItemUiCreator(function(lb){var sb=$("<div>");sb.css("width","100%");lb=new pa(Fa[lb]);sb.append(lb.getJqUi());return sb});I.layoutCtrlWithLRTB(ab,0,0,null,0,0,null);Wa.append(ab);db();Ha.append(Wa)},db=function(){wa.setItemCount(Fa.length);setTimeout(wa.repaint,0)},nb=function(Ha,Wa){Pa=new ya;Pa.setType(ya.TYPE_NO_SEARCH_RESULT);Pa.setText(va.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c"));
var ab=Pa.getJqUi();ab.hide();ab.appendTo(Wa);ta=new ya;ta.setType(ya.TYPE_NO_DATA_WITH_CLOUD);ta.setText(va.get("noDataTips","\u6682\u65e0\u6570\u636e"));ab=ta.getJqUi();ab.appendTo(Wa);ab.hide();if(Ha&&0!==Ha.length){Wa=Qa.getDimensionModel();ab=Wa.getDimensionType();for(var lb=0;lb<Ha.length;lb++){var sb=Ha[lb],xb=0===P.length?!0:-1!==P.indexOf(sb);var jb=sb;if(null===jb||0===jb.length)var rb=va.get("emptyValue","\uff08\u7a7a\uff09");else if(Aa.TYPE_DATE===ab){rb=Wa.getDateFormat();if(0!==$.trim(jb).length)switch(rb){case Aa.VALUE_YEAR_MONTH_DAY:R.setFormatString("yyyy-MM-dd"),
jb=R.format(jb)}rb=jb}else rb=jb;jb=new da;jb.setValue(sb);jb.setChecked(xb);jb.setText(rb);U.push(jb)}Fa=U}else ab.show()},hb=function(Ha,Wa){if(0===Wa.length)Pa.getJqUi().hide(),0===Ha.length?ta.getJqUi().show():ta.getJqUi().hide(),Fa=Ha,La.setChecked(Sa?!0:qb(Ha));else{for(var ab=!0,lb=[],sb=0;sb<Ha.length;sb++){var xb=Ha[sb];T.search(Wa,xb.getText())&&(ab=!1,lb.push(xb))}ab?(La.setChecked(!1),ta.getJqUi().hide(),Pa.getJqUi().show()):(La.setChecked(Sa?!0:qb(lb)),ta.getJqUi().hide(),Pa.getJqUi().hide());
Fa=lb}db()},Za=function(){for(var Ha=[],Wa=0;Wa<U.length;Wa++){var ab=U[Wa];ab.isChecked()&&Ha.push(ab)}return Ha},kb=function(){for(var Ha=[],Wa=$.trim(T.getSearchText()),ab=0;ab<U.length;ab++){var lb=U[ab];Sa&&!lb.isChecked()||Ha.push(lb)}hb(Ha,Wa)},pb=function(Ha,Wa){if(Wa){var ab=[];Sa=Ha.isChecked();U.forEach(function(lb){Sa&&!lb.isChecked()||ab.push(lb)});Ha=$.trim(T.getSearchText());hb(ab,Ha)}},qb=function(Ha){for(var Wa=!0,ab=0;ab<Ha.length;ab++)if(!Ha[ab].isChecked()){Wa=!1;break}return Wa},
ub=function(Ha,Wa){if(Wa){var ab=Ha.isChecked();Ba().forEach(function(lb){lb.setChecked(ab)});sa();wa.keepState();wa.repaint();wa.restoreState()}},sa=function(){var Ha=Za().length;Ha=va.get("selectedCount","\uff08\u5df2\u9009\u62e9#1\u9879\uff09").replace("#1",Ha);eb.setText(Ha)},Ra=function(Ha,Wa){if(Wa){Ha=Ba();var ab=0;Ha.forEach(function(lb){lb.isChecked()&&ab++});La.setChecked(ab===Ha.length)}sa()},Ba=function(){var Ha=$.trim(T.getSearchText());if(0===Ha.length)return U;for(var Wa=[],ab=0;ab<
U.length;ab++){var lb=U[ab];T.search(Ha,lb.getText())&&Wa.push(lb)}return Wa}}var Na=this,ba,Ea,Xa=[];this.getJqUi=function(){ba||ja();return ba};this.getDimensionFilterItem=function(){if(!Xa||0==Xa.length)return null;var Qa=new u;Qa.setDimensionKey(Ca.getDimensionId());for(var ea=[],P=0;P<Xa.length;P++)ea.push(Xa[P]);Qa.setValues(ea);return Qa};this.getDimensionModel=function(){return Ca};var ja=function(){ba=$("<div class='metric-designer-trial-calculate-dimension-item'>");var Qa=$("<div class='metric-designer-trial-calculate-dimension-item-name'>");
Qa.text(Ca.getName());Qa.attr("title",Ca.getName());var ea=$("<div class='metric-designer-trial-calculate-dimension-value-container'>");Ea=$("<div class='metric-designer-trial-calculate-dimension-value-text'>");Ea.text(va.get("allWithBracket","\uff08\u5168\u90e8\uff09"));Ea.attr("title",va.get("allWithBracket","\uff08\u5168\u90e8\uff09"));var P=$("<div class='metric-designer-trial-calculate-dimension-value-btn'>");za.background(P,"btn_edit");P.attr("title",va.get("selectDimensionValue","\u9009\u62e9\u7ef4\u5ea6\u503c"));
P.on("click",function(){Ka(Na)});Ea.appendTo(ea);P.appendTo(ea);ba.append(Qa);ba.append(ea)};this.updateSelectedDimensionValue=function(Qa){var ea=l[Ca.getDimensionId()],P=[],da=[];Qa.forEach(function(pa){P.push(pa.getValue());da.push(pa.getText())});Xa=P.slice();Qa=Qa.length===ea.length?va.get("allWithBracket","\uff08\u5168\u90e8\uff09"):da.join(",");Ea.text(Qa);Ea.attr("title",Qa)};var V=function(Qa){var ea=l[Ca.getDimensionId()];if(!Xa.length)return Qa.length!==ea.length;if(Xa.length!==Qa.length)return!0;
for(ea=0;ea<Qa.length;ea++)if(-1===Xa.indexOf(Qa[ea].getValue()))return!0;return!1},Ka=function(Qa){if(l[Ca.getDimensionId()])(new x(Qa,l[Ca.getDimensionId()],Xa)).showDialog();else{var ea=new ua;ea.setModelerModel(d);var P=new xa(b.getRemoteImpl(),function(da){l[Ca.getDimensionId()]=da;da=new x(Qa,da,Xa);a.is(":visible")&&da.showDialog()},function(da){});P.setBlockingJqUi(a);P.getMetricDimValues(ea.toJsonObject(),Ca.getDimensionId(),ma.getId())}}}function L(){X.call(this);var Ca=this.protectedMethod,
ma=this,x,Na,ba,Ea,Xa=!1,ja;(function(){Ca.setTitle(va.get("previewSet","\u9884\u89c8\u8bbe\u7f6e"));Ca.setSelectable(!0);Ca.setContentPaneCreator(function(){ma.setSize(440,330);return V()});Ca.setFooterPaneCreator(function(ea){var P=new Z(va.get("confirm","\u786e\u5b9a"));P.setHighlight(!0);var da=P.getJqUi();da.addClass("sa-ctrl-dialog-footer-ok");da.appendTo(ea);P.addActionListener(function(pa){pa=x.getValue();var Va=Na.getValue();ja&&ja(Xa,pa,Va);Ca.destroy();return!0});P=new Z(va.get("cancel",
"\u53d6\u6d88"));P.setHighlight(!1);da=P.getJqUi();da.addClass("sa-ctrl-dialog-footer-cancel");da.appendTo(ea);P.addActionListener(function(pa){Ca.destroy();return!0})});Ca.setClosingAction(function(ea){})})();this.setOriginExtractCount=function(ea){ba=ea};this.setOriginPreviewCount=function(ea){Ea=ea};this.setAllData=function(ea){Xa=ea};this.setConfirmCallback=function(ea){ja=ea};var V=function(){var ea=$("<div>"),P=$("<div>");P.text(va.get("extractSet","\u62bd\u53d6\u8bbe\u7f6e"));I.layoutCtrl(P,
30,20,100,24);P.appendTo(ea);P.css({color:"#333333","line-height":"24px","font-size":"14px"});P=Ka("extract",va.get("extract","\u62bd\u53d6\u524d"),ea);var da=P.getJqUi();I.layoutCtrlWithLRTB(da,60,null,300,60,null,null);x=new ra;var pa=x.getJqUi();x.setConstraint(1,1E4,1);x.setValue(ba);I.layoutCtrlWithLRTB(pa,122,null,100,49,null,null);pa.appendTo(ea);pa=$("<div>");pa.text(va.get("rowDataCalculate","\u884c\u6570\u636e\u8ba1\u7b97"));pa.css("color","#666");I.layoutCtrlWithLRTB(pa,170,0);I.layoutCtrlMiddleAlign(pa,
22);pa.appendTo(da);da=Ka("extractAll",va.get("all","\u5168\u91cf"),ea);pa=da.getJqUi();I.layoutCtrlWithLRTB(pa,60,null,300,90,null,null);var Va=$("<div>");za.background(Va,"warning");Va.attr("title",va.get("extractAllWarn","\u62bd\u53d6\u5168\u91cf\u6570\u636e\u8ba1\u7b97\u65f6\uff0c\u4f1a\u589e\u52a0\u6570\u636e\u9884\u89c8\u7684\u65f6\u957f\uff0c\u589e\u52a0\u670d\u52a1\u5668\u538b\u529b\uff0c\n\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\uff0c\u56e0\u6b64\u63a8\u8350\u62bd\u53d6\u90e8\u5206\u6570\u636e\u3002"));
I.layoutCtrlWithLRTB(Va,110,null,20,80,null,20);Va.appendTo(ea);pa=new N;pa.addElement(P);pa.addElement(da);pa.addChangedListener(function(y,T){T&&("extract"==y.getUserObject()?(Xa=!1,x.setEnabled(!0),Va.hide()):(Xa=!0,x.setEnabled(!1),Va.show()))});Xa?(Qa(pa,"extractAll"),x.setEnabled(!1),Va.show()):(Qa(pa,"extract"),x.setEnabled(!0),Va.hide());P=$("<div>");P.text(va.get("dataPreview","\u6570\u636e\u9884\u89c8"));I.layoutCtrl(P,30,115,100,24);P.appendTo(ea);P.css({color:"#333333","line-height":"24px",
"font-size":"14px"});var cb=Ka("dataPreview",va.get("previewResult","\u9884\u89c8\u8ba1\u7b97\u7ed3\u679c\u7684\u524d"),ea);cb.setChecked(!0);cb.addCheckedListener(function(){cb.setChecked(!0)});P=cb.getJqUi();I.layoutCtrlWithLRTB(P,60,null,300,155,null,null);Na=new ra;da=Na.getJqUi();Na.setConstraint(1,1E3,1);Na.setValue(Ea);I.layoutCtrlWithLRTB(da,180,null,100,144,null,null);da.appendTo(ea);da=$("<div>");da.text(va.get("rowData","\u884c\u6570\u636e"));da.css("color","#666");I.layoutCtrlWithLRTB(da,
230,0);I.layoutCtrlMiddleAlign(da,22);da.appendTo(P);return ea},Ka=function(ea,P,da){var pa=new g;pa.setUserObject(ea);pa.setText(P);ea=pa.getJqUi();da.append(ea);return pa},Qa=function(ea,P){ea.toCheckTheElement(function(da){return da.getUserObject()===P})}}X.call(this);var n=this,t=this.protectedMethod,a,c,m,b,d,h,O,f=[],e,z,H,D,G=!1,q=1E3,v=100,k,l=[];(function(){n.setSize(900,675);t.setSelectable(!0);t.getDialogCtrl().setFullScreenEnabled();t.getDialogCtrl().addResizeListener(function(){D&&D.relayoutViews()});
t.setContentPaneCreator(function(){t.setTitle(h);a=$("<div>");e?e(function(Ca){Ca=Ca.modeler;var ma=new ua;ma.fromJsonObject(Ca);var x=new xa(b.getRemoteImpl(),function(Na){var ba=new F;ba.fromJsonObject(Na);ba&&ba.isValid()?(d=ma.getModelerModel(),f=d.getAllDimension(),B(a,!0)):ha(a)});x.setShowBlocking(!0);x.checkModelerValid(Ca)}):B(a,!1);return a});t.setFooterPaneCreator(function(Ca){var ma=new Z(va.get("close","\u5173\u95ed"));ma.setHighlight(!0);var x=ma.getJqUi();x.addClass("sa-ctrl-dialog-footer-ok");
x.appendTo(Ca);I.layoutCtrl(x,"calc(50% - 60px)",null,null,null);ma.addActionListener(function(Na){t.destroy();return!0})});t.setClosingAction(function(Ca){})})();this.setMetric=function(Ca){m=Ca};this.setTitle=function(Ca){h=Ca};this.setGlobal=function(Ca){b=Ca};this.setButtonName=function(Ca){O=Ca};this.setFunLoadModelerInfo=function(Ca){e=Ca};this.setFunEntryDesignerFromMainPage=function(Ca){z=Ca};this.setModeler=function(Ca){d=Ca;f=Ca.getAllDimension()};var p=function(Ca){var ma=$("<div class='metric-designer-trial-calculate-property-title'>"),
x=$("<div>");x.appendTo(ma);I.layoutCtrlWithLRTB(x,0,0,null,2,2,null);x.css("border-left","3px solid #5582f3");x=$("<div>");x.text(Ca);I.layoutCtrl(x,10,null,200,null);I.layoutCtrlMiddleAlign(x,16);x.appendTo(ma);x.css({"font-weight":"bold",color:"#666"});return ma},E=function(Ca){k=[];for(var ma=$(document.createDocumentFragment()),x=0;x<f.length;x++){var Na=new w(f[x],m);Na.getJqUi().appendTo(ma);k.push(Na)}ma.appendTo(Ca)},A=function(){if(!k||0==k.length)return null;for(var Ca=[],ma=0;ma<k.length;ma++){var x=
k[ma].getDimensionFilterItem();x&&Ca.push(x.toJsonObject())}return Ca},B=function(Ca,ma){if(!ma){var x;ma=Da.MetricStateMonitor.getInvalidDimensionMap();var Na=Da.MetricStateMonitor.getInvalidPublicDimensionMap();0!==Object.keys(ma).length?x=va.get("dimensionException","\u7ef4\u5ea6\u5f02\u5e38\uff0c\u65e0\u6cd5\u8fdb\u884c\u6307\u6807\u8bd5\u8ba1\u7b97"):0!==Object.keys(Na).length?x=va.get("publicDimensionException","\u516c\u5171\u7ef4\u5ea6\u8bbe\u7f6e\u4e0d\u5b8c\u6574\uff0c\u65e0\u6cd5\u8fdb\u884c\u8bd5\u8ba1\u7b97"):
Da.MetricStateMonitor.getInvalidPrompt(m.getId())?x=va.get("metricException","\u6307\u6807\u5f02\u5e38\uff0c\u65e0\u6cd5\u8fdb\u884c\u6307\u6807\u8bd5\u8ba1\u7b97"):0<Y().length&&(x=va.get("metricException","\u6307\u6807\u5f02\u5e38\uff0c\u65e0\u6cd5\u8fdb\u884c\u6307\u6807\u8bd5\u8ba1\u7b97"));if(x){ma=new ya;ma.setType(ya.TYPE_NO_DATA_WITH_CLOUD);ma.setText(x);x=ma.getJqUi();Ca.append(x);return}}x=$("<div class='metric-designer-trial-calculate-metric-icon'>");za.background(x,"metric_icon");ma=$("<div class='metric-designer-trial-calculate-metric-info'>");
ma.text(m.getName());x.appendTo(Ca);ma.appendTo(Ca);ma=$("<div class='metric-designer-trial-calculate-dimension-filter-container'>");ma.appendTo(Ca);p(va.get("dimensionFilter","\u7ef4\u5ea6\u8fc7\u6ee4")).appendTo(ma);x=0;f&&0<f.length?(x=Math.min(68*Math.ceil(f.length/3)+44,180),Na=$("<div class='metric-designer-trial-calculate-dimension-list'>"),E(Na),Na.appendTo(ma)):(x=86,Na=$("<div class='metric-designer-trial-calculate-no-dimension-tips'>"),Na.text(va.get("noDimension","\u6682\u672a\u6dfb\u52a0\u7ef4\u5ea6")),
Na.attr("title",va.get("noDimension","\u6682\u672a\u6dfb\u52a0\u7ef4\u5ea6")),Na.appendTo(ma));I.layoutCtrlWithLRTB(ma,0,0,null,47,null,x);ma=$("<div>");I.layoutCtrlWithLRTB(ma,0,0,null,x+32+15+2,0,null);x=$("<div class='metric-designer-trial-calculate-button'>");x.text(O);x.attr("title",O);x.on("click",function(){ca(!1);oa();Q.occur(Q.BUTTON_TYPE,Q.TRIAL_CALCULATE)});x.appendTo(ma);S(ma);ma.appendTo(Ca)},Y=function(){for(var Ca=Da.MetricStateMonitor.getInvalidTableMap(),ma=[],x=Object.keys(Ca),Na=
0;Na<x.length;Na++){var ba=x[Na];Ca[x[Na]]&&ma.push(ba)}return ma},ha=function(Ca){var ma=new ya;ma.setType(ya.TYPE_NO_DATA_WITH_CLOUD);ma.setText(va.get("metricError","\u6307\u6807\u5f02\u5e38\uff0c\u65e0\u6cd5\u67e5\u770b\u6307\u6807\u6570\u636e"));ma=ma.getJqUi();var x=$("<div class='metric-designer-trial-calculate-entry-designer'>");x.text(va.get("enterDesigner","\u8fdb\u5165\u8bbe\u8ba1\u5668"));x.on("click",function(){z&&z()});var Na=$("<span class='metric-designer-trial-calculate-view-exception-reason'>");
Na.text(va.get("viewExceptionReason","\u67e5\u770b\u5f02\u5e38\u539f\u56e0"));x.append(Na);ma.append(x);Ca.append(ma)},S=function(Ca){var ma=p(va.get("resultPreview","\u7ed3\u679c\u9884\u89c8"));ma.css("top","51px");var x=$("<div class='metric-designer-trial-calculate-result-preview-setting'>"),Na=$("<div class='metric-designer-trial-calculate-result-preview-setting-text'>");Ta(Na);var ba=$("<div class='metric-designer-trial-calculate-result-preview-setting-btn'>");ba.attr("title",va.get("previewSet",
"\u9884\u89c8\u8bbe\u7f6e"));ba.on("click",function(){W(Na)});za.backgroundWithHover(ba,"setting");x.append(ba);x.append(Na);Ca.append(ma);Ca.append(x);Ga(Ca);Ja(Ca)},Ja=function(Ca){var ma=$("<div class='metric-data-calculate-preview-mask'>"),x=$("<div>");x.text(va.get("refreshPreviewData","\u7f16\u8f91\u5b8c\u6210\u540e\uff0c\u70b9\u51fb\u6b64\u5904\u5237\u65b0\u9884\u89c8\u6570\u636e\u3002"));x.addClass("metric-data-calculate-mask-text");x.on("click",function(){ca(!1);oa()});ma.hide();x.appendTo(ma);
ma.appendTo(Ca)},ca=function(Ca){if(H){var ma=a.find(".metric-data-calculate-preview-mask");Ca?ma.show():ma.hide()}},Ga=function(Ca){var ma=$("<div class='metric-designer-trial-calculate-result-table'>");D=na.createTable();D.setColumnFitVisibleWidth(!1);D.setAutoAdjustRowHeight(!0);var x=$(D.getUI());I.layoutCtrlWithLRTB(x,0,0,"100%",5,1<Math.ceil(f.length/3)?0:5,null);ma.append(x);Ca.append(ma)},$a=function(){if(H){na.clear(D);var Ca=H.getColumnCount();D.addColumns(Ca);for(var ma=na.createHeadRow(D),
x=0;x<Ca;x++){var Na=ma.getCell(x);D.getColumn(x).setWidth(120);var ba=H.getField(x).getAlias();Na.setValue(ba?ba:H.getField(x).getName())}Ca=H.getRowCount();c&&c.remove();if(0===Ca)na.refresh(D),c=$("<div class='metric-designer-trial-calculate-no-result'>"),c.text(va.get("calculateNoResult","\u6ca1\u6709\u6570\u636e")),$(D.getUI()).append(c);else{x=new r(D);x.setOutsideVisible(!1);D.setCellRender(x);ma=new KTBorderStyle;ma.setBottomBorderWidth(1);ma.setBottomBorderPen("solid");ma.setBottomBorderColor("#e5e5e5");
for(x=0;x<Ca;x++)Na=H.getOneRow(x),ba=na.createRow(D,!1),ba.setBorder(ma),ba.setUserObject(Na);na.refresh(D)}}},oa=function(){var Ca=new aa;G?Ca.setExtractAllDataAndPreviewCount(v):Ca.setExtractPartlyData(q,v);var ma=new ua;ma.setModelerModel(d);var x=new xa(b.getRemoteImpl(),function(Na){H=new fa;H.fromJsonObject(Na);$a()},function(Na){$a()});x.setBlockingJqUi(a);x.previewMetrics(ma.toJsonObject(),A(),Ca.toJsonObject(),m.getId())},W=function(Ca){var ma=new L;ma.setOriginExtractCount(q);ma.setOriginPreviewCount(v);
ma.setAllData(G);ma.setConfirmCallback(function(x,Na,ba){G=x;q=Na;v=ba;Ta(Ca);oa()});ma.showDialog()},Ta=function(Ca){var ma=G?va.get("extractAllData","\u62bd\u53d6\u5168\u91cf\u6570\u636e\u8fdb\u884c\u8ba1\u7b97, "):va.get("onlyExtractSomeRows","\u4ec5\u62bd\u53d6\u524d#1\u884c\u8fdb\u884c\u8ba1\u7b97, ").replace("#1",q);ma+=va.get("previewRows","\u663e\u793a\u8ba1\u7b97\u7ed3\u679c\u7684\u524d#1\u884c\u6570\u636e").replace("#1",v);Ca.text(ma);Ca.attr("title",ma)}};var va,I,K,J,X,Z,ra,N,g,ka,C,ia,
M,la,na,xa,za,aa,Aa,ua,fa,u,F,Q;(function(){var r=com.kingdee.bos.qing.framework.common;va=r.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.modeler.designer);r=com.kingdee.bos.qing.common;I=r.DomUtil;K=r.DateFormater;J=r.NumberFormater;r=com.kingdee.bos.qing.ui.component;X=r.AbstractModalDialog;Z=r.Button;ra=r.Spinner;N=r.RadioButtonGroup;g=r.RadioButton;ka=r.SearchBox;C=r.CheckBox;ia=r.ComboBox;M=r.Label;la=r.DynamicScroller;r=com.kingdee.bos.qing.common.ui;na=r.TableUtil;r=com.kingdee.bos.qing.modeler.designer;
xa=r.DesignerFacade;za=r.Icons;aa=r.PreviewConfig;ua=r.QingModeler;fa=r.PreviewData;Q=r.UserOperationReporter;r=com.kingdee.bos.qing.modeler.designer.metricdesigner;F=r.ModelerValidity;u=r.DimensionFilterItem;Aa=r.Dimension})();ya.TYPE_TEXT="text";ya.TYPE_NO_SOURCE="noSource";ya.TYPE_NO_SEARCH_RESULT="noSearchResult";ya.TYPE_NO_DATA_WITH_CLOUD="noDataWithCloud"})();(function(){function qa(){fa.call(this);var h,O,f,e=[],z=[],H,D;this.setLeftModel=function(q){z=q};this.setRightModel=function(q){e=q};this.setGlobal=function(q){f=q};this.setCreatePublicDIMEntrance=function(q){H=q};this.getDimensions=function(){return e};this.getPublicDimensions=function(){return z};this.setMessageCurtain=function(q){D=q};this.checkDimensionsValid=function(){return 20<=e.length?(D&&D.showPrompt(X.get("moreDimension","\u7ef4\u5ea6\u4e2a\u6570\u4e0d\u80fd\u8d85\u8fc720\u4e2a\u3002")),
!1):!0};this.protectedGetLeftCtrl=function(){h=new Oa;h.setModel(z);h.setGlobal(f);h.setCreatePublicDIMEntrance(H);return h};this.protectedGetRightCtrl=function(){O=new ib;O.setMessageCurtain(D);O.setModel(e);return O};this.protectedSelect=function(q,v){if(q){var k=z;if(!v){if(k=h.getSelected(),0===k.length){D&&D.showPrompt(X.get("atLeastSelectAField","\u81f3\u5c11\u9009\u4e2d\u4e00\u4e2a\u5b57\u6bb5\u3002"));return}}else if(0===k.length){D&&D.showPrompt(X.get("noFieldToAdd","\u6ca1\u6709\u5b57\u6bb5\u53ef\u4ee5\u6dfb\u52a0\u3002"));
return}v=[];q=[];for(var l=0;l<k.length;l++){var p=k[l],E;if(E=p.getDataType()!=ua.DT_DATE&&p.getDataType()!=ua.DT_DATETIME)a:{E=p.getId();for(var A=0;A<e.length;A++)if(e[A].getPublicDimensionId()==E){E=!0;break a}E=!1}E?v.push(p):q.push(p)}for(l=0;l<q.length;l++){p=q[l];k=new w;E=com.kingdee.bos.qing.modeler.designer.UIDHelper;E=E.getUID(E.NS_DIMENSION);k.setDimensionId(E);k.setPublicDimensionId(p.getId());switch(p.getDataType()){case ua.DT_DATE:case ua.DT_DATETIME:k.setDimensionType(w.TYPE_DATE);
k.setDateFormat(w.VALUE_YYYY);J.DimensionUtil.fixDimensionDateType(e,k,p.getId());break;default:k.setDimensionType(w.TYPE_NORMAL),k.setNumberModified(!0),k.setNameModified(p.isNameModified())}A=p.getId();E=J.ValueHandler.getAllDimensionName(e);var B=f.getModelerModel(),Y=B.getAllMetric();Y=J.ValueHandler.getAllMetricName(Y);E=E.concat(Y);B=B.getPublicDimensions();A=J.ValueHandler.getAllPublicDimensionName(B,A);E=E.concat(A);A=J.DimensionUtil.getDateFormatName(k.getDateFormat(),!0);E=J.DimensionUtil.fixName(E,
p.getName(),A);k.setName(E);E=J.ValueHandler.getAllDimensionNumber(e);A=f.getModelerModel().getAllMetric();A=J.ValueHandler.getAllMetricNumber(A);E=E.concat(A);p=J.DimensionUtil.getUniqueNumber(f,k,E,p);k.setNumber(p);e.push(k)}O.updateUI(e);1==v.length&&(q=v[0],q=X.get("oneFieldAbandonSelect","\u4ec5\u201c\u65e5\u671f\u201c\u3001\u201d\u65e5\u671f\u65f6\u95f4\u201c\u7c7b\u578b\u7684\u5b57\u6bb5\u652f\u6301\u91cd\u590d\u9009\u62e9\uff0c\u5df2\u653e\u5f03\u9009\u62e9\u201c#1\u201d\u5b57\u6bb5\u3002").replace("#1",
q.getName()),D&&D.showPrompt(q));2<=v.length&&(q=v[0],l=v[1],q=X.get("moreFieldAbandonSelect","\u4ec5\u201c\u65e5\u671f\u201c\u3001\u201d\u65e5\u671f\u65f6\u95f4\u201c\u7c7b\u578b\u7684\u5b57\u6bb5\u652f\u6301\u91cd\u590d\u9009\u62e9\uff0c\u5df2\u653e\u5f03\u9009\u62e9\u201c#1\u201d\u3001\u201c#2\u201d\u7b49#3\u4e2a\u5b57\u6bb5\u3002").replace("#1",q.getName()).replace("#2",l.getName()).replace("#3",v.length),D&&D.showPrompt(q))}else{k=O.getModel();if(v){if(q=k,0===q.length){D&&D.showPrompt(X.get("noFieldDelete",
"\u6ca1\u6709\u5b57\u6bb5\u53ef\u4ee5\u79fb\u9664\u3002"));return}}else if(q=O.getSelected(),0===q.length){D&&D.showPrompt(X.get("atLeastSelectAField","\u81f3\u5c11\u9009\u4e2d\u4e00\u4e2a\u5b57\u6bb5\u3002"));return}p=[];for(l=0;l<k.length;l++)p.push(k[l].copy());for(l=q.length-1;0<=l;l--)E=k.indexOf(q[l]),k.splice(E,1);v?O.setSelecteds([]):O.setSelecteds(G(q,k,p));O.updateUI(k)}};var G=function(q,v,k){if(0===v.length)return[];for(var l={},p=0;p<k.length;p++){var E=k[p].getDimensionId();l[E]=p}var A=
[];for(p=0;p<q.length;p++)E=q[p].getDimensionId(),A.push(l[E]);p=-1;for(q=0;q<A.length;q++)p<A[q]&&(p=A[q]);l=p;if(0>=l)return[v[0]];q={};for(p=0;p<v.length;p++){var B=v[p];q[B.getDimensionId()]=B}if(l===k.length)return v[v.length-1];if(l<k.length){for(p=l;-1<A.indexOf(p);)--p;if(!B)return[v[0]];v=k[p].getDimensionId();B=q[v];return[B]}}}function Ua(){function h(p){var E,A,B,Y,ha,S,Ja,ca,Ga=p,$a=function(){var ma=$("<div>");ha=Ta();var x=ha.getJqUi();x.find(":input").on("keydown",function(ba){13==
(ba.keyCode||ba.which||ba.charCode)&&console.log("do searching")});ra.layoutCtrlWithLRTB(x,8,0,290,0,null,30);ma.append(x);x=$("<div>");ra.layoutCtrlWithLRTB(x,0,0,null,31,0,null);ma.append(x);if(Ga){Y=W(Ga);var Na=Y.getJqUi();ra.layoutCtrlWithLRTB(Na,0,0,306,0,0,null);x.append(Na)}(B=ca())&&x.append(B);Ga&&0!=Ga.length&&B&&B.hide();A=oa();A.hide();A.appendTo(x);return ma},oa=function(){var ma=new m;ma.setText(X.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c"));
return ma.getJqUi()},W=function(ma){var x=new na;x.setBorderVisible(!1);x.setMultiSelectable(!0);x.setToggleSelectingEnabled(!0);x.setContinuousSelectingEnabled(!0);x.setCustomItemPainter(S);x.setItemModels(ma);x.setCustomSelectedsPainter(Ja);return x};this.setNoDataViewPainter=function(ma){ca=ma};this.setListSelectedsPainter=function(ma){Ja=ma};this.setCustomPainter=function(ma){S=ma};this.setListSelects=function(ma){Y.setSelecteds(ma)};this.getSelectedField=function(){return Y?Y.getSelecteds():
[]};this.updateListContentUI=function(ma){Ga=ma;Ca()};this.getJqUi=function(){E||(E=$a());return E};var Ta=function(){var ma=new za;ma.setShowSearchIcon(!0);ma.setPlaceholder(X.get("searchField","\u8bf7\u8f93\u5165\u5b57\u6bb5\u540d\u79f0"));ma.setSearchListenerDelay(0);ma.addSearchListener(Ca);return ma},Ca=function(ma){if((ma=$.trim(ha.getText()))&&0<ma.length){for(var x=Ga,Na=[],ba=0;ba<x.length;ba++)-1<$.trim(x[ba].getName()).toLowerCase().indexOf(ma.toLowerCase())&&Na.push(x[ba]);0==Na.length?
A.show():A.hide();B&&B.hide();Y.setItemModels(Na)}else 0==Ga.length&&B&&B.show(),A.hide(),Y.setItemModels(Ga)}}var O,f=this,e=[],z,H,D;this.protectGetTitle=function(){throw Error("override me");};this.showSortBtn=function(){throw Error("override me");};this.protectGetNoDataViewJqUi=function(){return null};this.setMessageCurtain=function(p){H=p};this.getMessageCurtain=function(){return H};this.getSelected=function(){return z.getSelectedField()};this.setSelecteds=function(p){z.setListSelects(p)};var G=
function(){var p=v();if(p)H&&H.showPrompt(p);else{p=f.getSelected()[0];var E=e.indexOf(p);0==E?H&&H.showPrompt(X.get("currentFirstRecord","\u5f53\u524d\u8bb0\u5f55\u5df2\u7ecf\u662f\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4e0a\u79fb\u3002")):(e.splice(E,1),e.splice(E-1,0,p),z.updateListContentUI(e))}},q=function(){var p=v();if(p)H&&H.showPrompt(p);else{p=f.getSelected()[0];var E=e.indexOf(p);E==e.length-1?H&&H.showPrompt(X.get("currentLastRecord","\u5f53\u524d\u8bb0\u5f55\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u6761\u8bb0\u5f55\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4e0b\u79fb\u3002")):
(e.splice(E,1),e.splice(E+1,0,p),z.updateListContentUI(e))}};this.protectGetIconName=function(p){throw Error("override me");};this.setGlobal=function(p){D=p};this.getGlobal=function(){return D};var v=function(){if(0==e.length)return X.get("noFieldForSort","\u6ca1\u6709\u201c\u5df2\u9009\u5b57\u6bb5\u201d\u53ef\u4f9b\u6392\u5e8f\u3002");if(0==f.getSelected().length)return X.get("selectNoMappingField","\u672a\u9009\u4e2d\u201c\u5df2\u9009\u5b57\u6bb5\u201d\u3002");if(1<f.getSelected().length)return X.get("selectSingleField",
"\u8bf7\u9009\u62e9\u4e00\u4e2a\u5b57\u6bb5\u8fdb\u884c\u6392\u5e8f\u3002")};this.getJqUi=function(){if(!O){var p=$("<div>"),E=$("<div>");E.text(f.protectGetTitle());ra.layoutCtrlWithLRTB(E,0,40,null,0,0,20);p.append(E);E=new aa;E.setText("\u2191");E.addActionListener(G);E=E.getJqUi();var A=new aa;A.setText("\u2193");A.addActionListener(q);A=A.getJqUi();z=new h(e);z.setCustomPainter(k);z.setNoDataViewPainter(f.protectGetNoDataViewJqUi);z.setListSelectedsPainter(l);var B=z.getJqUi();B.css({position:"absolute",
border:"1px solid #dbdbdb"});ra.layoutCtrl(B,0,20,306,340);ra.layoutCtrl(E,266,0,20,20);ra.layoutCtrl(A,286,0,20,20);p.append(B);f.showSortBtn()&&(p.append(E),p.append(A));O=p}return O};var k=function(p,E){p.css("height","30px");p.css("cursor","pointer");var A=$("<div>"),B=f.protectGetIconName(E);N.background(A,B);A.appendTo(p);A.addClass("modeler-designer-dimension-dialog-item-icon");B=$("<div>");B.text(E.getName());B.attr("title",E.getName());B.addClass("modeler-designer-dimension-dialog-item modeler-designer-dimension-item-noselect");
A.appendTo(p);B.appendTo(p)},l=function(p,E){for(var A=0;A<p.length;A++){var B=p[A],Y=B.data("model");Y=f.protectGetIconName(Y);B=$(B.find(".modeler-designer-dimension-dialog-item-icon"));N.background(B,Y)}for(A=0;A<E.length;A++)p=E[A],B=p.data("model"),B=f.protectGetIconName(B)+"_hover",p=$(p.find(".modeler-designer-dimension-dialog-item-icon")),N.background(p,B)};this.setModel=function(p){e=p};this.getModel=function(){return e};this.updateUI=function(p){e=p;z&&z.updateListContentUI(e)}}function Oa(){Ua.call(this);
var h=this,O;this.protectGetNoDataViewJqUi=function(){var e=h.getGlobal().getModelerModel().getAllTable();return O&&1!=e.length?f():(e=new m,e.setText(X.get("noOptionalField","\u6682\u65e0\u53ef\u9009\u62e9\u7684\u5b57\u6bb5")),e.getJqUi())};this.showSortBtn=function(){return!1};this.setCreatePublicDIMEntrance=function(e){O=e};this.protectGetTitle=function(){return X.get("optionalDimFields","\u53ef\u9009\u5b57\u6bb5")};this.protectGetIconName=function(e){return e.getDataType()};var f=function(){var e=
$("<div>");e.addClass("metric-designer-public-dimension-box");var z=$("<div>");z.addClass("metric-designer-public-dimension-text");z.text(X.get("noCanSelectField","\u6682\u65e0\u53ef\u9009\u62e9\u7684\u5b57\u6bb5\uff0c\u73b0\u5728\u53bb\u8bbe\u7f6e"));var H=$("<div>");H.addClass("metric-designer-public-dimension-text-link");var D=X.get("publicDimension","\u516c\u5171\u7ef4\u5ea6");H.text(D);H.attr("title",D);H.css("cursor","pointer");H.css("color","#0E5FD8");H.on("click",function(G){O&&O()});e.append(z);
e.append(H);return e}}function ib(){Ua.call(this);this.protectGetTitle=function(){return X.get("selectedDimFields","\u5df2\u9009\u5b57\u6bb5")};this.showSortBtn=function(){return!0};this.protectGetIconName=function(h){switch(h.getDimensionType()){case w.TYPE_DATE:return"DATE";case w.TYPE_NORMAL:return"STRING";default:throw Error("unknown dimension type");}}}function Ya(){ia.call(this);var h=this,O=this.protectedMethod,f,e,z;(function(){O.setTitle(X.get("createDimension","\u65b0\u589e\u7ef4\u5ea6"));
h.setSize(720,480);O.setSelectable(!0);O.setContentPaneCreator(function(){for(var D=f.getModelerModel().getAllDimension(),G=[],q=0;q<D.length;q++){var v=D[q];J.MetricStateMonitor.checkDimensionInvalid(v.getDimensionId())||G.push(v.copy())}e=new qa;e.setMessageCurtain(O.getMessageCurtain());e.setLeftModel(z);e.setRightModel(G);e.setGlobal(f);e.setCreatePublicDIMEntrance(H);return e.getJqUi()});O.setClosingChecker2(function(D){if(e.checkDimensionsValid()){var G=f.getModelerModel();D=e.getDimensions();
var q=[];if(2>G.getAllTable().length){q=[];for(G=0;G<D.length;G++){var v=D[G].getPublicDimensionId();-1<q.indexOf(v)||q.push(v)}v=[];for(G=0;G<z.length;G++)-1<q.indexOf(z[G].getId())&&v.push(z[G]);q=v}else for(G=G.getPublicDimensions(),v=0;v<G.length;v++)q.push(G[v].copy());G=new r;G.setValue(D,q,f);f.getCommandManager().perform(G);return!0}});O.setClosingAction(function(D){D&&d.occur(d.FUNCTION,d.ADD_DIMENSION)})})();var H=function(){var D=new Da;D.setGlobal(f);var G=new Aa;G.setSteps([D]);G.show(720,
480);O.destroy()};this.setPublicDimensions=function(D){z=D};this.setGlobal=function(D){f=D};this.showDimensionDialog=function(){h.showDialog();e.relayout()}}function Ma(h){ia.call(this);var O=this,f=this.protectedMethod,e,z=1===h.getModelerModel().getAllTable().length;(function(){f.setTitle(X.get("publicDimensionSetting","\u516c\u5171\u7ef4\u5ea6\u8bbe\u7f6e"));O.setSize(720,480);f.setSelectable(!0);f.setContentPaneCreator(function(){var q=$("<div>");if(z){q.append(J.PublicDimensionUtil.createTipUi());
var v=$("<div>");v.text(X.get("oneTablePromptTips","\u5f53\u524d\u6a21\u578b\u53ea\u9009\u62e9\u4e861\u5f20\u8868\uff0c\u65e0\u9700\u8bbe\u7f6e\u516c\u5171\u7ef4\u5ea6\u3002"));v.css({color:"#C0C0C0","text-align":"center","font-size":"14px"});ra.layoutCtrlCenterAlign(v,400);ra.layoutCtrlMiddleAlign(v,18);ra.makeSelectable(v);q.append(v);return q}D(q);return q});f.setFooterPaneCreator(function(q){H.createPanel(q)});f.setClosingAction(function(q){G()})})();var H=new function(){this.createPanel=function(k){z?
q(k):v(k)};var q=function(k){var l=new M(X.get("close","\u5173\u95ed"));l.setHighlight(!0);var p=l.getJqUi();p.appendTo(k);ra.layoutCtrlCenterAlign(p,70);l.addActionListener(function(){G()})},v=function(k){var l=new M(X.get("confirm","\u786e\u5b9a"));l.setHighlight(!0);var p=l.getJqUi();p.addClass("sa-ctrl-dialog-footer-ok");p.appendTo(k);l.addActionListener(function(E){if(e.checkPublicDimensionValid()){var A=e.getPublicDimensions();E=[];for(var B=0;B<A.length;B++){var Y=A[B],ha=h.getModelerModel().getPublicDimensionById(Y.getId());
Y.tryGenerateId(ha);E.push(Y)}A=new Q;A.setValue(E,h);h.getCommandManager().perform(A);E=!0}else E=void 0;E&&(G(),d.occur(d.FUNCTION,d.PUBLIC_DIMENSION_SETTING))});l=new M(X.get("cancel","\u53d6\u6d88"));l.setHighlight(!1);p=l.getJqUi();p.addClass("sa-ctrl-dialog-footer-cancel");p.appendTo(k);l.addActionListener(function(E){G()})}},D=function(q){J.FieldLoader.loadTableFields(h,q,function(v){var k=J.PublicDimensionUtil.loadPublicDimensions(v,h);e=new va;e.setGlobal(h);e.setPublicDimensions(k);e.setTableFieldMap(v);
e.setMessageCurtain(f.getMessageCurtain());q.append(e.getJqUi());e.setPublicDimensionColVisible()})},G=function(){f.destroy();z||e.destroy()}}function ya(){Aa.AbstractWizardStep.call(this);var h,O=this;this.getJqUi=function(f){h||(h=O.protectedCreateUi(f));return h};this.protectedCreateUi=function(){throw Error("Override me.");};this.protectedMethod={getTopJqUi:function(){return h}}}function Da(){ya.call(this);var h,O,f;this.protectedCreateUi=function(z){f=z.getMessageCurtain();z=$("<div>");e(z);
return z};this.setGlobal=function(z){h=z};this.isLastStep=function(){return!1};this.isReturnable=function(){return!0};this.getSubTitle=function(){return X.get("publicDimensionSetting","\u516c\u5171\u7ef4\u5ea6\u8bbe\u7f6e")};this.outThisStep=function(z,H){if(O.checkPublicDimensionValid()){z=O.getPublicDimensions();var D=new I;D.setGlobal(h);for(var G=[],q=0;q<z.length;q++){var v=z[q],k=h.getModelerModel().getPublicDimensionById(v.getId());v.tryGenerateId(k);G.push(v)}D.setCompletedPublicDimension(G);
H(D);O.unobserveWindow()}};this.intoThisStep=function(z,H){H&&O.observeWindow()};this.over=function(){O.destroy()};var e=function(z){J.FieldLoader.loadTableFields(h,z,function(H){var D=J.PublicDimensionUtil.loadPublicDimensions(H,h);O=new va;O.setMessageCurtain(f);O.setPublicDimensions(D);O.setGlobal(h);O.setTableFieldMap(H);z.append(O.getJqUi());O.setPublicDimensionColVisible()})}}function va(){function h(ba){KTDefaultCellRender.call(this,ba);var Ea=this,Xa=this.paintCellUI,ja=new f,V=new O;this.getTable=
function(){return ba};this.paintCellUI=function(Ka,Qa){var ea=Ea.getCurrentRowIdx(),P=Ea.getCurrentColIdx();ea<ha?P==ba.getColumnsCount()-2?Xa(Ka,Qa):0!=P&&P!=ba.getColumnsCount()-1&&V.paintTableCell(Ea,Ka,Qa,Xa):0==P?ja.paintPromptCell(Ea,Ka):P==ba.getColumnsCount()-2?ja.paintMappingFieldCell(Ea,Ka):P==ba.getColumnsCount()-1?Xa(Ka,Qa):ja.paintChildrenCell(Ea,Ka)}}function O(){this.paintTableCell=function(ba,Ea,Xa,ja){Xa=ba.getCell();ba=ba.getCurrentCol().getUserObject();Xa&&(ba.isTableExist()||(Xa=
ka.createWarning(),Xa.addClass("metric-designer-public-dimension-table-error"),Xa.attr("title",X.get("invalidSourcePrompt","\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664")),$(Ea).append(Xa)),Xa=$("<div>"),N.background(Xa,"table"),Xa.addClass("modeler-designer-table-item-icon"),$(Ea).append(Xa),ba=J.TableNameHelper.getDisplayText(ba.getTable()),Xa=$("<div>"),Xa.addClass("modeler-designer-table-item-name"),Xa.text(ba),Xa.attr("title",ba),$(Ea).append(Xa))}}function f(){this.paintPromptCell=
function(ja,V){ja=ja.getCurrentRow().getUserObject();ja.isFieldsCompleted()&&!ja.isDataTypeConsistent()&&(ja=Xa(X.get("dataTypeNotConsistent","\u5b57\u6bb5\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u4e00\u81f4")),ja.css("left","50%"),ja.css("margin-left","-5px"),ja.appendTo($(V)))};this.paintMappingFieldCell=function(ja,V){var Ka=ja.getCurrentRow().getUserObject(),Qa=ja.getCurrentRow(),ea=ja.getCurrentRowIdx(),P=ja.getCell();ja=Ka.getName();V=$(V);V.empty();var da=$("<div>");da.appendTo(V);da.text(ja);
da.attr("title",ja);da.addClass("metric-designer-dimension-tablecell-editable");ja||ea-ha!=Y&&$a(Ka)?((ea=Ka.getFieldByIndex(0).getName()&&Ka.isNameModified())&&da.css("padding-right","20px"),J.PublicDimensionUtil.appendResetButton(V,ea,function(){var pa=J.PublicDimensionUtil.getUniquePublicDimensionName(k,l,Ka);Ka.setName(pa);Ka.setNameModified(!1);Qa.setUserObject(Ka);P.setValue(pa);g.refresh(G)})):(da.text(X.get("pleaseInputName","\u8bf7\u8f93\u5165\u540d\u79f0")),da.css("color","#C0C0C0"))};this.paintChildrenCell=
function(ja,V){var Ka=ja.getCellWidth(),Qa=ja.getCellHeight(),ea=ja.getCurrentColIdx(),P=ja.getCurrentRowIdx(),da=ja.getCell(),pa=ja.getCurrentCol(),Va=ja.getCurrentRow().getUserObject();ja=da.getUserObject();var cb=pa.getUserObject(),y=(new a).createChooseFieldPanel(ba);pa=v[ja.getTableId()];pa=ma(l,pa?pa:[],ea-1);y.setItemModel(pa?pa:[]);y.setShowFieldNameEnable(!1);y.setSearchBoxPlaceholder(X.get("searchField","\u8bf7\u8f93\u5165\u5b57\u6bb5\u540d\u79f0"));Ka=g.createCtrlInCell($(V),Ka,Qa,xa);
Ka.setUserObject(Va);Ka.getJqUi().attr("data-colIndex",ea);ea=ja.getField();Ka.setSelectedModel(ea);Ka.setDropdownCreator(function(T,U,Fa){return y.createJqPopup(T,U,Fa)});Ka.addSelectionListener(Ca);Ka.setCustomPainter(function(T,U){U.text("");if(T&&T.getName()){var Fa;cb.isTableExist()||(Fa=4);ba(U,T,Fa)}else T=$("<div>"),T.text(X.get("pleaseSelectField","\u8bf7\u9009\u62e9\u5b57\u6bb5")),T.addClass("metric-designer-field-mapping-select-text"),T.css("color","#C0C0C0"),P-ha==Y&&(T.css("padding-left",
"4px"),T.appendTo(U)),$a(Va)||(T.css("padding-left","24px"),Ea($(V),X.get("noFieldSelect","\u672a\u9009\u62e9\u5b57\u6bb5"),8),T.appendTo(U))});cb.isTableExist()&&P-ha!=Y&&(ea=null,ja.isExist()||(ea=X.get("fieldNotFound","\u5b57\u6bb5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664")),ea&&Ea($(V),ea,8))};var ba=function(ja,V,Ka){if(V&&V.getName()){if(V.getDataType()){var Qa=$("<div>"),ea=V.getDataType();N.background(Qa,ea);Qa.addClass("modeler-designer-select-field-dataType-icon");Qa.appendTo(ja)}Qa=
V.getAlias();V.isEnum()&&(Qa+="("+X.get("enumField","\u679a\u4e3e\u5b57\u6bb5")+")");V=$("<div>");V.text(Qa);V.attr("title",Qa);V.addClass("metric-designer-field-mapping-select-text");null==Ka&&void 0==Ka||V.css("padding-left",Ka+"px");V.appendTo(ja)}},Ea=function(ja,V,Ka){V=Xa(V);V.appendTo(ja);V.css("left",Ka+"px")},Xa=function(ja){var V=$("<div>");V.text("!");V.addClass("modeler-designer-field-notmatch-prompt");V.attr("title",ja);return V}}function e(){var ba,Ea;this.setTable=function(Xa){ba=Xa};
this.getTable=function(){return ba};this.setTableExist=function(Xa){Ea=Xa};this.isTableExist=function(){return Ea}}function z(){KTableUIDraggableAdjustingHandler.CustomExpendor.call(this);this.getTailBlankForDragging=function(){return 0}}var H=this,D,G,q,v={},k,l,p,E,A=[],B,Y=0,ha=g.getHeadRowCount();this.getJqUi=function(){if(!D){D=$("<div>");ra.layoutCtrlWithLRTB(D,0,0,null,0,0,null);D.append(J.PublicDimensionUtil.createTipUi());G=g.createTable();g.bindTextEditor(G,x,Na);G.setDraggableAdjusting(!0,
3,0,new z);g.bindTableListenerForCtrl(G,Ta);q=new h(G);q.setOutsideVisible(!1);G.setCellRender(q);var ba=$(G.getUI());ra.layoutCtrlWithLRTB(ba,0,0,null,30,0,null);ba.appendTo(D);ba=k.getModelerModel().getAllTable();for(var Ea=0;Ea<ba.length;Ea++){var Xa=ba[Ea];var ja=Xa;var V=J.MetricStateMonitor.getInvalidTableMap();ja=-1===Object.keys(V).indexOf(ja.getUid());V=new e;V.setTable(Xa);V.setTableExist(ja);A.push(V)}G.addColumns(A.length+3);G.getColumn(A.length+2).setWidth(30);G.getColumn(A.length+1).setWidth(200);
G.getColumn(0).setWidth(30);for(ba=0;ba<A.length;ba++)Xa=A[ba],G.getColumn(ba+1).setWidth(200),G.getColumn(ba+1).setUserObject(Xa);Ea=g.createHeadRow(G);for(ba=0;ba<A.length;ba++)Xa=A[ba],Xa=J.TableNameHelper.getDisplayText(Xa.getTable()),Ea.getCell(ba+1).setValue(Xa);Ea.getCell(A.length+1).setValue(X.get("publicDimensionName","\u516c\u5171\u7ef4\u5ea6\u540d\u79f0"));ba=new KTStyle;ba.setBackgroundColor("#F7D49F");ba.setBold(!0);ba.setTextAlign("center");G.getRow(0).getCell(A.length+1).setStyle(ba);
G.getRow(1).getCell(A.length+1).setStyle(ba);G.getRow(2).getCell(A.length+1).setStyle(ba);G.getRow(0).getCell(A.length+2).setStyle(ba);G.getRow(1).getCell(A.length+2).setStyle(ba);G.getRow(2).getCell(A.length+2).setStyle(ba);Ja();ca();S()}return D};this.setGlobal=function(ba){k=ba};this.setMessageCurtain=function(ba){p=ba};this.setPublicDimensions=function(ba){l=ba};this.getPublicDimensions=function(){for(var ba=[],Ea=0;Ea<l.length;Ea++){var Xa=l[Ea];Xa.isEmpty()||ba.push(Xa)}return ba};this.checkPublicDimensionValid=
function(){for(var ba=[],Ea=0;Ea<A.length;Ea++)A[Ea].isTableExist()||ba.push(A[Ea]);if(1==ba.length)return ba=J.TableNameHelper.getDisplayText(ba[0].getTable()),p.showPrompt(X.get("oneTableNotExist","\u201c#1\u201d\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002").replace("#1",ba)),!1;if(2<=ba.length){Ea=J.TableNameHelper.getDisplayText(ba[0].getTable());var Xa=J.TableNameHelper.getDisplayText(ba[1].getTable());p.showPrompt(X.get("moreTableNotExist","\u201c#1\u201c\u3001\u201d#2\u201c\u7b49#3\u4e2a\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002").replace("#1",
Ea).replace("#2",Xa).replace("#3",ba.length));return!1}for(Ea=0;Ea<l.length;Ea++){ba=l[Ea];if(!ba.isFieldsCompleted())return p.showPrompt(X.get("publicDimensionNotComplete","\u7b2c#1\u884c\u8bbe\u7f6e\u4e0d\u5b8c\u6574\u3002").replace("#1",Ea+1)),!1;if(!ba.isDataTypeConsistent())return p.showPrompt(X.get("publicDimensionDataTypeNotConsistent","\u7b2c#1\u884c\u7684\u5b57\u6bb5\u6570\u636e\u7c7b\u578b\u4e0d\u4e00\u81f4\u3002").replace("#1",Ea+1)),!1}return!0};this.setTableFieldMap=function(ba){for(var Ea=
Object.keys(ba),Xa=0;Xa<Ea.length;Xa++){var ja=Ea[Xa],V=ba[ja].slice();V.unshift(null);v[ja]=V}};this.setPublicDimensionColVisible=function(){2<A.length&&(g.refresh(G),G.scrollCellVisible(0,G.getColumnsCount()-2,!1))};var S=function(){var ba=$("<div>");ba.text(X.get("clearMetricSetting","\u6e05\u7a7a\u8bbe\u7f6e"));ba.css({color:"#5582F3","text-align":"right","font-size":"12px",cursor:"pointer","margin-right":"0px","pointer-events":"auto"});ra.layoutCtrlWithLRTB(ba,null,0,null,0,null,null);ba.on("click",
function(){0!=l.length&&(l.splice(0,l.length),Ja())});ba.appendTo(D)};this.destroy=function(){H.unobserveWindow()};this.unobserveWindow=function(){E.unobserve()};this.observeWindow=function(){E.observe()};var Ja=function(){g.clearWithoutHead(G);for(var ba=l.length-1;0<=ba;ba--){var Ea=l[ba];if($a(Ea))l.splice(ba,1);else break}var Xa=l.length+4;for(ba=0;ba<Xa;ba++){ba>=l.length?(Ea=Ga(),l.push(Ea)):Ea=l[ba];var ja=g.createRow(G);oa(Ea,ja)}W();setTimeout(function(){g.refresh(G)},0)},ca=function(){E=
new Z;E.setCallback(function(){G.relayoutViews()});E.observe()},Ga=function(){for(var ba=k.getModelerModel().getAllTable(),Ea=new L,Xa=0;Xa<ba.length;Xa++){var ja=new n;ja.setTableId(ba[Xa].getUid());Ea.addField(ja)}return Ea},$a=function(ba){if(ba.getName())return!1;ba=ba.getFields();for(var Ea=0;Ea<ba.length;Ea++)if(ba[Ea].getName())return!1;return!0},oa=function(ba,Ea){Ea.setUserObject(ba);for(var Xa=ba.getFields(),ja=0;ja<Xa.length;ja++){var V=Xa[ja];Ea.getCell(ja+1).setUserObject(V);Ea.getCell(ja+
1).setValue(V.getName())}Ea.getCell(Xa.length+1).setValue(ba.getName())},W=function(){for(var ba=Y=0;ba<l.length;ba++){a:{var Ea=l[ba];if(Ea.getName()){Ea=Ea.getFields();for(var Xa=0;Xa<Ea.length;Xa++)if(!Ea[Xa].getName()){Ea=!1;break a}Ea=!0}else Ea=!1}if(Ea)Y++;else break}},Ta=function(ba,Ea,Xa,ja){ba=KTableUIAbstractView.createCellId(G.getRow(Xa),G.getColumn(G.getColumnsCount()-1));ba=H.getJqUi().find("#"+ba);Ea?(Ea=$("<div>"),N.backgroundWithHover(Ea,"delete"),Ea.addClass("modeler-metric-dimension-table-operation"),
Ea.on("click",function(){l.splice(Xa-ha,1);Ja()}),Ea.appendTo(ba),ba.css("text-align","center"),B=ba):B&&B.find(".modeler-metric-dimension-table-operation").remove()},Ca=function(ba,Ea){if(Ea){var Xa=ba.getUserObject();Ea=ba.getSelectedModel();ba=ba.getJqUi().attr("data-colIndex")-1;ba=Xa.getFieldByIndex(ba);Ea&&ba.getName()==Ea.getName()||(ba.update(Ea),ba.setExist(!0),Xa.tryGenerateName(function(){return J.PublicDimensionUtil.getUniquePublicDimensionName(k,l,Xa)}),Ja())}},ma=function(ba,Ea,Xa){for(var ja=
[],V=0;V<Ea.length;V++){var Ka=Ea[V];if(Ka){for(var Qa=!0,ea=0;ea<ba.length;ea++)if(ba[ea].getFieldByIndex(Xa).getName()==Ka.getName()){Qa=!1;break}Qa&&ja.push(Ka)}}return ja},x=function(ba,Ea){return Ea==G.getColumnsCount()-2},Na=function(ba,Ea,Xa,ja){Ea=X.get("publicDimensionName","\u516c\u5171\u7ef4\u5ea6\u540d\u79f0");ba=ba.getUserObject();var V=$.trim(ba.getName()),Ka=/^[\u4E00-\u9FA5a-zA-Z0-9_]{1,}$/;V!=ja&&(V&&0==ja.length?Ea=X.get("valueCanNotBeEmpty","#1\u4e0d\u53ef\u4e3a\u7a7a").replace("#1",
Ea):50<ja.length?Ea=X.get("valueTooLong","#1\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7#2\u4e2a\u5b57\u7b26").replace("#1",Ea).replace("#2",50):0<ja.length&&!ja.match(Ka)?Ea=X.get("invalidDimensionName","#1\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210").replace("#1",Ea):(V=J.ValueHandler.getAllPublicDimensionName(l,ba.getId(),!0),J.ValueHandler.isValueDuplicate(V,ja)?Ea=X.get("duplicateValue","#1\u5df2\u5b58\u5728").replace("#1",Ea):(V=k.getModelerModel(),
Ka=J.ValueHandler.getAllName(V,null,!0),J.ValueHandler.isValueDuplicate(Ka,ja)?Ea=X.get("duplicateDimensionNameInPd","\u516c\u5171\u7ef4\u5ea6\u540d\u79f0\u4e0e\u5df2\u6709\u7ef4\u5ea6\u540d\u79f0\u91cd\u590d"):(V=V.getAllMetric(),V=J.ValueHandler.getAllMetricName(V),Ea=J.ValueHandler.isValueDuplicate(V,ja)?X.get("duplicateDimensionNameInMetric","#1\u4e0e\u6307\u6807\u540d\u79f0\u91cd\u590d").replace("#1",Ea):void 0))),Ea?(Ea=X.get("modifyAbandoned","#1\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002").replace("#1",
Ea),p.showPrompt(Ea)):(ba.setName(ja),ba.setNameModified(!0),Xa.setValue(ja),Ja()))}}function I(){ya.call(this);var h=this.protectedMethod,O,f,e,z;this.protectedCreateUi=function(H){z=H.getMessageCurtain();O=new qa;O.setGlobal(f);O.setMessageCurtain(z);H=[];for(var D=0;D<e.length;D++){var G=e[D].copy();H.push(G)}O.setLeftModel(H);O.setRightModel([]);H=O.getJqUi();H.css({height:"100%"});return H};this.setGlobal=function(H){f=H};this.setCompletedPublicDimension=function(H){e=H};this.getSubTitle=function(){return X.get("createDimension",
"\u65b0\u589e\u7ef4\u5ea6")};this.intoThisStep=function(){O.relayout()};this.isLastStep=function(){return!0};this.isReturnable=function(){return!0};this.outThisStep=function(H,D){if(H)h.getTopJqUi()&&h.getTopJqUi().remove(),D(null);else if(O.checkDimensionsValid()){H=O.getDimensions();var G=O.getPublicDimensions(),q=new r;q.setValue(H,G,f);f.getCommandManager().perform(q);D(null)}}}function K(){var h,O,f,e=[],z=this,H,D=[w.VALUE_YYYY=0,w.VALUE_QUARTER=1,w.VALUE_MONTH=2,w.VALUE_DAY=3,w.VALUE_YEAR_QUARTER=
4,w.VALUE_YEAR_MONTH=5,w.VALUE_YEAR_WEEK=6,w.VALUE_WEEK_OF_YEAR=7,w.VALUE_DAY_OF_WEEK=8,w.VALUE_YEAR_MONTH_DAY=9],G=function(A){KTDefaultCellRender.call(this,A);var B=this,Y=this.paintCellUI;this.paintCellUI=function(ha,S){var Ja=B.getCurrentRow(),ca=Ja.getUserObject(),Ga=B.getCell(),$a=B.getCurrentRowIdx(),oa=B.getCurrentColIdx(),W=B.getCellWidth(),Ta=B.getCellHeight();(new C).setFormatString("yyyy-MM-dd HH:mm:ss");if($a<g.getHeadRowCount())Y(ha,S);else if(0===oa)W=J.MetricStateMonitor.getInvalidDimensionPrompt(ca.getDimensionId()),
Ta=$("<div class='modeler-metric-dimension-error-prompt'>"),Ta.text("!"),W&&Ta.attr("title",W),W&&Ta.appendTo(ha);else if(1===oa)Ta=ca.getNumber(),ha=$(ha),ha.empty(),W=$("<div>"),W.text(Ta),W.attr("title",Ta),W.addClass("metric-designer-dimension-tablecell-editable"),Ta=ca.getDimensionType(),(Ta=ca.isNumberModified()&&Ta==w.TYPE_DATE&&!J.MetricStateMonitor.checkDimensionInvalid(ca.getDimensionId()))&&W.css("padding-right","20px"),ca.isNumberModified()?W.css("color","#333333"):W.css("color","#C0C0C0"),
J.PublicDimensionUtil.appendResetButton(ha,Ta,function(){var Ca=l(ca,!0);k(!0,ca,Ca,!1);ca.setNumberModified(!1);Ja.setUserObject(ca);Ga.setValue(Ca);E(ca)}),W.appendTo(ha);else if(2===oa)W=ca.getName(),ha=$(ha),ha.empty(),S=$("<div>"),S.text(W),S.attr("title",W),S.addClass("metric-designer-dimension-tablecell-editable"),(Ta=ca.isNameModified()&&!J.MetricStateMonitor.checkDimensionInvalid(ca.getDimensionId()))&&S.css("padding-right","20px"),J.PublicDimensionUtil.appendResetButton(ha,Ta,function(){ca.setNameModified(!1);
var Ca=l(ca,!1);k(!1,ca,Ca,!1);Ja.setUserObject(ca);Ga.setValue(Ca);E(ca)}),S.appendTo(ha);else if(3===oa)switch(S=$("<div class='metric-designer-dimension-table-field'>"),oa=ca.getDimensionType(),$a=ca.getDateFormat(),oa){case w.TYPE_DATE:ha=g.createCtrlInCell(ha,W,Ta,la);void 0!==$a?ha.setSelected($a):ha.setSelected(D[0]);ha.setUserObject(Ja);ha.setItemModels(D);ha.showFeature(!0);ha.setCustomPainter(function(Ca,ma,x){x=J.DimensionUtil.getDateFormatName(x);Ca&&(x=X.get("dateDimension","\u65e5\u671f\u7ef4")+
"_"+x);ma.text(x);ma.attr("title",x)});ha.addSelectedChangedListener(function(Ca,ma,x){ca.setDateFormat(x);ca.isNameModified()||(Ca=l(ca,!1),k(!1,ca,Ca,!1));E(ca)});J.MetricStateMonitor.checkDimensionInvalid(ca.getDimensionId())&&ha.setEnabled(!1);break;case w.TYPE_NORMAL:W=$("<div>");Ta=X.get("normalDimension","\u666e\u901a\u7ef4");W.text(Ta);W.attr("title",Ta);W.css({position:"absolute",left:"4px"});W.appendTo(S);S.appendTo(ha);break;default:throw Error("unknown dimension type");}}};this.getJqUi=
function(){if(!O){h=g.createTable();h.setDraggableAdjusting(!1);h.setColumnFitVisibleWidth(!0);g.bindTextEditor(h,q,v);g.bindTableListenerForCtrl(h,p);var A=new G(h);A.setOutsideVisible(!1);h.setCellRender(A);h.setSyncUIWhenModelChanged(!0);h.setScrollerVisible("hidden","auto");O=$("<div class='modeler-metric-dimension-table'>");ra.layoutCtrlWithLRTB(O,10,10,null,70,0,null);O.append($(h.getUI()))}return O};this.setGlobal=function(A){H=A};this.updateTable=function(){var A=h.keepScrollStatus();g.clear(h);
h.addColumns(5);h.getColumn(0).setWidth(25);h.getColumn(1).setWidth(100);h.getColumn(2).setWidth(100);h.getColumn(3).setWidth(100);h.getColumn(4).setWidth(30);var B=g.createHeadRow(h);B.getCell(1).setValue(X.get("dimensionNumber","\u7ef4\u5ea6\u7f16\u7801"));B.getCell(2).setValue(X.get("dimensionName","\u7ef4\u5ea6\u540d\u79f0"));B.getCell(3).setValue(X.get("dimensionType","\u7ef4\u5ea6\u7c7b\u578b"));B=H.getModelerModel().getAllDimension();for(var Y=[],ha=0;ha<B.length;ha++)Y.push(B[ha].copy());
e=Y;for(B=0;B<e.length;B++)Y=e[B],ha=g.createRow(h,!0),ha.setUserObject(Y),ha.getCell(1).setValue(Y.getNumber()),ha.getCell(2).setValue(Y.getName()),ha.setHeight(30);z.refreshTable();h.restoreScrollStatus(A)};var q=function(A,B){if(A<g.getHeadRowCount()||1!==B&&2!==B)return!1;A=h.getRow(A).getUserObject();return!J.MetricStateMonitor.checkDimensionInvalid(A.getDimensionId())},v=function(A,B,Y,ha){ha||(ha="");A=A.getUserObject();var S=(B=1===h.getColumnIndex(B))?A.getNumber():A.getName();S=$.trim(S);
if(ha!=S){S=ha;var Ja=B?X.get("dimensionNumber","\u7ef4\u5ea6\u7f16\u7801"):X.get("dimensionName","\u7ef4\u5ea6\u540d\u79f0"),ca=B?25:50,Ga=/^([\u4E00-\u9FA5a-zA-Z_])[\u4E00-\u9FA5a-zA-Z0-9_]{0,}$/,$a=/^[\u4E00-\u9FA5a-zA-Z0-9_]{1,}$/;0==S.length?ca=X.get("valueCanNotBeEmpty","#1\u4e0d\u53ef\u4e3a\u7a7a").replace("#1",Ja):S.length>ca?ca=X.get("valueTooLong","#1\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7#2\u4e2a\u5b57\u7b26").replace("#1",Ja).replace("#2",ca):B&&!S.match(Ga)?ca=X.get("invalidNumber","#1\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\uff0c\u4e14\u4e0d\u80fd\u4ee5\u6570\u5b57\u5f00\u5934").replace("#1",
Ja):B||S.match($a)?B?(ca=H.getModelerModel(),Ga=J.ValueHandler.getAllNumber(ca,A.getDimensionId(),!0),J.ValueHandler.isValueDuplicate(Ga,S,!0)?ca=X.get("duplicateValue","#1\u5df2\u5b58\u5728").replace("#1",Ja):(ca=ca.getAllMetric(),ca=J.ValueHandler.getAllMetricNumber(ca),ca=J.ValueHandler.isValueDuplicate(ca,S,!0)?X.get("duplicateDimensionNumberInMetric","\u7ef4\u5ea6\u7f16\u7801\u4e0e\u6307\u6807\u7f16\u7801\u91cd\u590d"):void 0)):(ca=H.getModelerModel(),Ga=J.ValueHandler.getAllName(ca,A,!0),J.ValueHandler.isValueDuplicate(Ga,
S)?ca=X.get("duplicateValue","#1\u5df2\u5b58\u5728").replace("#1",Ja):(Ga=ca.getAllMetric(),Ga=J.ValueHandler.getAllMetricName(Ga),J.ValueHandler.isValueDuplicate(Ga,S)?ca=X.get("duplicateDimensionNameInMetric","#1\u4e0e\u6307\u6807\u540d\u79f0\u91cd\u590d").replace("#1",Ja):(ca=ca.getPublicDimensions(),ca=J.ValueHandler.getAllPublicDimensionName(ca,A.getPublicDimensionId()),ca=J.ValueHandler.isValueDuplicate(ca,S)?X.get("duplicatePdNameInDimension","\u7ef4\u5ea6\u540d\u79f0\u4e0e\u5df2\u6709\u516c\u5171\u7ef4\u5ea6\u540d\u79f0\u91cd\u590d"):
void 0))):ca=X.get("invalidDimensionName","#1\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210").replace("#1",Ja);ca?(ca=X.get("modifyAbandoned","#1\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002").replace("#1",ca),H.getMessageCurtain().showPrompt(ca),S=!1):B&&b.isSpecialWord(S)?(ca=X.get("specialWord","\u201c#1\u201d\u4e3a\u7279\u6b8a\u5173\u952e\u5b57\uff0c\u4e0d\u80fd\u4f5c\u4e3a#2\u3002").replace("#1",S).replace("#2",Ja),H.getMessageCurtain().showPrompt(ca),
S=!1):S=!0;S&&(k(B,A,ha,!0),Y.setValue(ha),E(A))}},k=function(A,B,Y,ha){A?(B.setNumber(Y),ha&&B.setNumberModified(!0)):(B.setName(Y),ha&&B.setNameModified(!0),B.getDimensionType()==w.TYPE_NORMAL||B.isNumberModified()||(ha?(A=H.getModelerModel(),A=J.ValueHandler.getAllNumber(A,B.getDimensionId()),Y=J.DimensionUtil.fixNumber(A,Y)):Y=J.DimensionUtil.getUniqueNumber(H,B),B.setNumber(Y)))},l=function(A,B){var Y=H.getModelerModel(),ha=Y.getPublicDimensionById(A.getPublicDimensionId());if(!ha)return"";if(B)return J.DimensionUtil.getUniqueNumber(H,
A);B=J.DimensionUtil.getDateFormatName(A.getDateFormat(),!0);Y=J.ValueHandler.getAllName(Y,A);return A.getDimensionType()==w.TYPE_NORMAL?(A=ha.getFieldByIndex(0),J.DimensionUtil.fixName(Y,A.getAlias(),B)):J.DimensionUtil.fixName(Y,ha.getName(),B)},p=function(A,B,Y,ha){A=KTableUIAbstractView.createCellId(h.getRow(Y),h.getColumn(h.getColumnsCount()-1));A=z.getJqUi().find("#"+A);B?(B=$("<div>"),N.backgroundWithHover(B,"delete"),B.addClass("modeler-metric-dimension-table-operation"),B.on("click",function(){var S=
h.getRow(Y).getUserObject(),Ja=new u;Ja.setValue(S,H);H.getCommandManager().perform(Ja)}),B.appendTo(A),A.css("text-align","center"),f=A):f&&f.find(".modeler-metric-dimension-table-operation").remove()};this.refreshTable=function(){g.refresh(h)};var E=function(A){var B=new F;B.setValue(A,H);H.getCommandManager().perform(B)}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&
(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.metricdesigner&&(com.kingdee.bos.qing.modeler.designer.metricdesigner={});var J=com.kingdee.bos.qing.modeler.designer.metricdesigner;J.PropertyArea=function(){var h,O,f,e,z;this.getJqUi=function(){if(!h){h=$("<div>");h.addClass("modeler-designer-common-border");
var l=$("<div>");l.addClass("modeler-propertyarea-lineitem-title");l.appendTo(h);var p=$("<div>");p.appendTo(l);ra.layoutCtrlWithLRTB(p,5,0,null,2,2,null);p.css("border-left","3px solid #5582f3");p=$("<div>");p.text(X.get("dimension","\u7ef4\u5ea6"));ra.layoutCtrl(p,15,null,200,null);ra.layoutCtrlMiddleAlign(p,16);p.appendTo(l);p.css({"font-weight":"bold",color:"#666"});l=$("<div>");p=v("createDim",X.get("createDimension","\u65b0\u589e\u7ef4\u5ea6"),G);O=v("publicDimension",X.get("publicDimensionSetting",
"\u516c\u5171\u7ef4\u5ea6\u8bbe\u7f6e"),q);l.append(p);l.append(O);l.addClass("modeler-propertyarea-lineitem-title");l.css({"margin-left":"10px"});h.append(l);e=new K;e.setGlobal(z);h.append(e.getJqUi());H()}return h};this.setGlobal=function(l){z=l};var H=function(){J.MetricStateMonitor.addStateChangeListener(function(){e.updateTable()})};this.afterResize=function(){e.updateTable()};this.setModelerModel=function(l){f&&f.removePropertyChangeCallback(k);f=l;f.addPropertyChangeCallback(k);e.updateTable()};
var D=function(l){var p=[],E=z.getModelerModel();$.each(l,function(A,B){for(var Y=0;Y<B.length;Y++){var ha=new L;ha.setName(B[Y].getAlias());var S=new n;S.setTableId(A);S.setName(B[Y].getName());S.setDataType(B[Y].getDataType());S.setAlias(B[Y].getAlias());ha.addField(S);(S=E.getSamePublicDimension(ha))?ha.setId(S.getId()):(S=com.kingdee.bos.qing.modeler.designer.UIDHelper,S=S.getUID(S.NS_PUBLIC_DIMENSION),ha.setId(S));p.push(ha)}});return p},G=function(){var l=f.getAllTable();0===l.length?z.getMessageCurtain().showPrompt(X.get("needSelectedEntity",
"\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u6570\u636e\u8868\u3002")):1===l.length?J.FieldLoader.loadTableFields(z,h,function(p){p=D(p);var E=new Ya;E.setPublicDimensions(p);E.setGlobal(z);E.showDimensionDialog()}):J.FieldLoader.loadTableFields(z,h,function(p){for(var E=f.getPublicDimensions(),A=[],B=0;B<E.length;B++){var Y=E[B].copy();Y.updateFields(p);Y.isFieldsCompleted()&&Y.isDataTypeConsistent()&&A.push(Y)}p=new Ya;p.setPublicDimensions(A);p.setGlobal(z);p.showDimensionDialog()})},q=function(){0==
z.getModelerModel().getAllTable().length?z.getMessageCurtain().showPrompt(X.get("needSelectedEntity","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u6570\u636e\u8868\u3002")):(new Ma(z)).showDialog()},v=function(l,p,E){var A=$("<span>"),B=$("<span>");N.background(B,l);B.css({position:"absolute",width:"16px",height:"16px"});var Y=$("<span>");Y.text(p);Y.css({"margin-left":"18px"});Y.attr("title",p);A.append(B);A.append(Y);A.css({color:"var(--color-main, #5582f3)","font-size":"12px",cursor:"pointer","margin-right":"15px"});
A.on("mouseenter",function(){N.background(B,l+"_hover")});A.on("mouseleave",function(){N.background(B,l)});A.on("click",E);return A},k=function(l,p){l==t.KEY_BATCH_UPDATE_DIMENSION||l==t.KEY_ADD_DIMENSION||l==t.KEY_UPDATE_DIMENSION||l==t.KEY_REMOVE_DIMENSION?e.updateTable():(l==c.KEY_ADD_TABLE||l==c.KEY_REMOVE_TABLE)&&e.updateTable()}};var X,Z,ra,N,g,ka,C,ia,M,la,na,xa,za,aa,Aa,ua,fa,u,F,Q,r,w,L,n,t,a,c,m,b,d;(function(){var h=com.kingdee.bos.qing.framework.common;X=h.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.modeler.designer);
Z=h.WindowResizeObserver;h=com.kingdee.bos.qing.common;ra=h.DomUtil;C=h.DateFormater;h=com.kingdee.bos.qing.modeler;b=h.SpecialWordChecker;h=com.kingdee.bos.qing.ui.component;ia=h.AbstractModalDialog;M=h.Button;za=h.SearchBox;aa=h.WorkButton;la=h.ComboBox;na=h.List;Aa=h.WizardDialog;xa=h.DropdownSelector;h=com.kingdee.bos.qing.common.ui;g=h.TableUtil;ka=h.CommonIconUtil;h=com.kingdee.bos.qing.modeler.designer.metricdesigner;w=h.Dimension;n=h.MappingField;L=h.PublicDimension;t=h.MetricModeler;u=h.RemoveDimensionAction;
F=h.UpdateDimensionAction;Q=h.UpdatePublicDimensionAction;r=h.BatchUpdateDimensionAction;h=com.kingdee.bos.qing.modeler.designer;N=h.Icons;ua=h.Field;c=h.ModelerModel;fa=h.AbstractLeftRightSelector;a=h.ChooseFieldPanelHelper;c=h.ModelerModel;m=h.NoDataView;d=h.UserOperationReporter})()})();(function(){"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.metricdesigner&&(com.kingdee.bos.qing.modeler.designer.metricdesigner=
{});var qa=com.kingdee.bos.qing.modeler.designer.metricdesigner;qa.PreviewDialog=function(){Ua.call(this);var M=this.protectedMethod,la=this,na,xa,za,aa,Aa,ua,fa,u,F,Q,r,w,L=!1,n;(function(){M.setTitle(ib.get("preview","\u9884\u89c8"));var e=$(document.body),z=e.prop("clientWidth");e=e.prop("clientHeight");var H=Math.min(1,Math.max(.8,1.16-2E-4*z));z=parseInt(H*z);e=parseInt(H*e);la.setSize(z,e);M.getDialogCtrl().setMinSize(680,240);M.setSelectable(!0);M.getDialogCtrl().setFullScreenEnabled();M.getDialogCtrl().setResizeEnabled();
M.getDialogCtrl().addResizeListener(function(){fa&&fa.relayoutViews()});M.setFooterPaneCreator(null);M.setClosingAction(function(D){D=new J(xa.getRemoteImpl());D.setShowBlocking(!1);D.deleteResultDataFile(w,r)})})();var t=function(e,z){var H=new g;H.setText(z);H.setType(g.TYPE_NO_DATA_WITH_CLOUD);z=H.getJqUi();z.css("top","calc(50% - 110px)");z.appendTo(e);la.setSize(800,600)},a=function(){var e=$("<div>");t(e,ib.get("modelNoData","\u5f53\u524d\u6a21\u578b\u6ca1\u6709\u53ef\u9884\u89c8\u7684\u6570\u636e"));
return e},c=function(){var e=$("<div>"),z=new J(xa.getRemoteImpl(),function(H){var D=new C;D.fromJsonObject(H);if(D.getModelerValidity())t(e,ib.get("modelInvalid","\u6a21\u578b\u5f02\u5e38\uff0c\u65e0\u6cd5\u9884\u89c8\u6570\u636e")),H=new ia,H.fromJsonObject(D.getModelerValidity()),qa.MetricStateMonitor.setModelValidity(H);else{na=D.getPreviewData();r=D.getJobName();w=D.getJobId();F=D=D.getTotalRowCount();L=1E5<D;D=new KTBorderStyle;D.setBorderWidth(1);D.setBorderPen("solid");D.setBorderColor("#E3E3E3");
H=new KTStyle;H.setVerticalAlign("bottom");fa=new KTable;fa.setBorder(D);fa.setStyle(H);fa.setDraggableAdjusting(!0,1,0);fa.setSyncUIWhenModelChanged(!1);fa.setLargeDataMode(!0);fa.setFrozenRows(1);fa.getCellRender().setOutsideVisible(!1);fa.setColumnFitVisibleWidth(!1);D=na.getColumnCount();fa.addColumns(D);var G=new KTStyle;G.setTextAlign("center");G.setBold(!0);G.setColor("#666");H=fa.addRow();H.setStyle(G);H.setHeight(22);G=new KTStyle;G.setBackgroundColor("#81D3F8");var q=new KTStyle;q.setBackgroundColor("#FACD91");
Q=aa.getAllDimension().length;for(var v=0;v<D;v++){var k=H.getCell(v),l=fa.getColumn(v);k.setStyle(v<Q?G:q);var p=na.getField(v).getAlias();k.setValue(p);l.setWidth(150)}D=$(fa.getUI());D.appendTo(e);ya.layoutCtrlWithLRTB(D,0,0,null,32,0,null);na&&0==na.getRowCount()?(Ma.refresh(fa),H=$("<div class='metric-designer-preview-no-result'>"),H.text(ib.get("calculateNoResult","\u6ca1\u6709\u6570\u636e")),H.appendTo(D)):(f(),fa.updateUI(),fa.setLargeDataMode(!0));m(e);D=$("<div>");D.addClass("modeler-designer-model-preview-rowcount-container");
D.appendTo(Aa);L?(H=ib.get("showRowCount","\u4ec5\u663e\u793a#1\u884c").replace("#1","100000"),G=$("<span>"),G.text(ib.get("getTotalRowCount","\u603b\u884c\u6570")),G.addClass("modeler-designer-model-preview-rowcount-btn"),G.css("cursor","pointer"),h(G),G.appendTo(Aa)):H=ib.get("totalRowCount","\u5171#1\u884c").replace("#1",F+"");ua=$("<span>");ua.text(H);ua.appendTo(D);u=new Oa;u.getJqUi().appendTo(Aa);u.addActionListener(d);b(!1);u.getJqUi().addClass("modeler-designer-model-preview-export-btn")}});
z.setBlockingJqUi(e);z.getFirstPageMetric(za,n);return e};this.showMetricDialog=function(){0==aa.getAllMetric().length?M.setContentPaneCreator(a):M.setContentPaneCreator(c);la.showDialog()};this.setGlobal=function(e){xa=e};this.setJsonQingModeler=function(e){za=e;e=new ra;e.fromJsonObject(za);aa=e.getModelerModel()};this.setTrialExecutionConfig=function(e){n=e};var m=function(e){var z=new N;z.protectedMethod.setTotalSelectedRowAndSelectedAllVisual(!1,!1);z.protectedMethod.setTotalRowVisual(!1);z.protectedMethod.setCurrentPageVisual(!0);
z.protectedMethod.setFirstBtnAndEndBtnVisual(!0);z.setComboBoxItemModelsAndSelectedItem([5,10,20,50,100,500,1E3],4);var H=L?1E5:F;z.setJumpToPageListener(function(D,G,q){q&&q(H);O(D,G)});Aa=z.getJqUi();Aa.appendTo(e);z.resetPaginationAndJumpToFirstPage(H)},b=function(e){e?(u.setText(ib.get("exporting","\u6b63\u5728\u5bfc\u51fa...")),u.setEnabled(!1)):(u.setText(ib.get("exportToExcel","\u5bfc\u51fa\u5230Excel")),u.setEnabled(!0))},d=function(){var e=new J(xa.getRemoteImpl(),function(z){b(!1);var H=
Da.formatDate("yyyyMMdd_HHmmss");Ya.downloadFile("QingModeler-"+H+".xlsx",z)},function(z,H){b(!1);return 20001106==z?(z=new va,z.setOptionType(va.OPTION_OK),z.setMessage(H),z.showDialog(),!0):!1});e.setShowBlocking(!1);b(!0);e.exportMetricData(w,r,L?1E5:F,za);ka.occur(ka.BUTTON_TYPE,ka.MODEL_PREVIEW_EXPORT_TO_EXCEL)},h=function(e){e.on("click",function(){var z=ib.get("showRowCount","\u4ec5\u663e\u793a#1\u884c").replace("#1","100000"),H=ib.get("totalRowCount","\u5171#1\u884c").replace("#1",""+F);ua.text(z+
"/"+H);e.remove()})},O=function(e,z){e=(e-1)*z;var H=new J(xa.getRemoteImpl(),function(D){na=new X;na.fromJsonObject(D);for(D=fa.getRowsCount()-1;0<D;D--)fa.removeRow(D);f();fa.updateUI();fa.setLargeDataMode(!0)});H.setShowBlocking(!1);H.updateMetricByPage(za,w,r,e,z)},f=function(){var e=new KTStyle;e.setTextAlign("left");var z=new KTStyle;z.setTextAlign("right");var H=new KTStyle;H.setColor("#333");H.setBackgroundColor("#F3F3F3");var D=new KTStyle;D.setColor("#333");D.setBackgroundColor("#fff");
for(var G=0;G<na.getRowCount();G++){var q=1==G%2?H:D,v=fa.addRow();v.setHeight(22);v.setStyle(q);for(q=0;q<na.getColumnCount();q++){var k=v.getCell(q);k.setStyle(q<Q?e:z);var l=na.getOneRow(G),p=na.getField(q),E=p.getOutputDataType();l=l[q];null==l||void 0==l?l="":E==Z.DT_DATE?(p=new I,p.setFormatString("yyyy-MM-dd"),l=p.format(l)):E==Z.DT_DATETIME?(p=new I,p.setFormatString("yyyy-MM-dd HH:mm:ss"),l=p.format(l)):E==Z.DT_BOOLEAN?l=void 0===l?"":l?"true":"false":E==Z.DT_NUMBER&&(p=p.getFormat())&&(E=
new K,E.setFormatString(p),l=E.format(l));k.setValue(l)}}}};var Ua,Oa,ib,Ya,Ma,ya,Da,va,I,K,J,X,Z,ra,N,g,ka,C,ia;(function(){var M=com.kingdee.bos.qing.ui.component;Ua=M.AbstractModalDialog;Oa=M.WorkButton;va=M.MessageDialog;M=com.kingdee.bos.qing.framework.common;ib=M.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.modeler.designer);Ya=M.RemoteFramework;M=com.kingdee.bos.qing.common.ui;Ma=M.TableUtil;M=com.kingdee.bos.qing.common;ya=M.DomUtil;I=M.DateFormater;Da=M.Util;K=M.NumberFormater;
M=com.kingdee.bos.qing.biz.common;N=M.ComplexPaginationBar;M=com.kingdee.bos.qing.modeler.designer;J=M.DesignerFacade;X=M.PreviewData;Z=M.Field;ra=M.QingModeler;g=M.NoDataView;ka=M.UserOperationReporter;C=M.PreviewResult;ia=qa.ModelerValidity})()})();(function(){function qa(k){ka.call(this);var l=this.protectedMethod,p=this,E,A;(function(){l.setTitle(K.get("editMetric","\u7f16\u8f91\u6307\u6807"));p.setSize(800,640);l.setSelectable(!0);l.setContentPaneCreator(function(){A=new ib;A.setGlobal(E);A.setMetric(k);A.setExternalMsgCurtain(l.getMessageCurtain());return A.getJqUi()});l.setClosingChecker2(function(B){A.checkValidity(function(Y){if(Y)l.getMessageCurtain().showPrompt(Y),B(!1);else{Y=A.getMetric();if(!Y.equals(k)){var ha=new ua;ha.setValue(k,
Y,E);E.getCommandManager().perform(ha)}B(!0)}})},null,!0);l.setClosingAction(function(B){})})();this.setGlobal=function(B){E=B;A&&A.setGlobal(E)}}function Ua(){ka.call(this);var k=this.protectedMethod,l=this,p,E,A,B;(function(){k.setTitle(K.get("createMetric","\u65b0\u5efa\u6307\u6807"));l.setSize(800,640);k.setSelectable(!0);k.setContentPaneCreator(function(){E=new ib;E.setGlobal(p);E.setExternalMsgCurtain(k.getMessageCurtain());return E.getJqUi()});k.setClosingChecker2(function(Y){E.checkValidity(function(ha){ha?
(k.getMessageCurtain().showPrompt(ha),Y(!1)):(ha=new Aa,ha.setValue(E.getMetric(),p),p.getCommandManager().perform(ha),Y(!0))})},null,!0);k.setClosingAction(function(Y){Y&&(A.hide(),B.show())})})();this.setGlobal=function(Y){p=Y;E&&E.setGlobal(p)};this.setNoDataContainer=function(Y){A=Y};this.setAddMetricBtn=function(Y){B=Y}}function Oa(k){ka.call(this);var l=this.protectedMethod,p=this,E,A;(function(){l.setTitle(K.get("copyMetric","\u590d\u5236\u6307\u6807"));p.setSize(800,640);l.setSelectable(!0);
l.setContentPaneCreator(function(){var B=$("<div>");I.MetricNumberHelper.getNumberByPrefix(k.getNumber(),function(Y){for(var ha=k.getNumber(),S=E.getModelerModel().getAllDimension(),Ja=[],ca=0;ca<S.length;ca++)Y.push(S[ca].getNumber()),Ja.push(S[ca].getName());S=k.getName();var Ga=E.getModelerModel().getAllMetric();for(ca=0;ca<Ga.length;ca++)Y.push(Ga[ca].getNumber()),Ja.push(Ga[ca].getName());if(0<Y.length){ca=!0;for(Ga=1;ca;){var $a=!0;for(ca=0;ca<Y.length;ca++)if(Y[ca]==ha+"_"+Ga){Ga++;$a=!1;break}ca=
!$a}ha=ha+"_"+Ga}else ha+="_1";ca=!0;for(Y=1;ca;){$a=!0;for(ca=0;ca<Ja.length;ca++)if(Ja[ca]==S+"_"+Y){Y++;$a=!1;break}ca=!$a}S=S+"_"+Y;Ja=k.clone();Ja.setId(xa.getUID(xa.NS_METRIC));Ja.setNumber(ha);Ja.setName(S);A=new ib;A.setGlobal(E);A.setCopyMode(!0);A.setMetric(Ja);A.setExternalMsgCurtain(l.getMessageCurtain());A.getJqUi().appendTo(B)});return B});l.setClosingChecker2(function(B){A.checkValidity(function(Y){Y?(l.getMessageCurtain().showPrompt(Y),B(!1)):(Y=new Aa,Y.setValue(A.getMetric(),E),
E.getCommandManager().perform(Y),B(!0))})},null,!0);l.setClosingAction(function(B){})})();this.setGlobal=function(B){E=B;A&&A.setGlobal(E)}}function ib(){var k,l,p,E,A,B,Y,ha,S,Ja=!1,ca;this.getJqUi=function(){if(!k){k=$("<div>");var x=oa();J.layoutCtrlWithLRTB(x,0,null,200,0,0,null);x.appendTo(k);x=Ga();J.layoutCtrlWithLRTB(x,220,0,null,0,0,null);k.append(x);W()}return k};this.setGlobal=function(x){p=x};this.getMetric=function(){if(l)var x=l.clone();else x=new aa,x.setId(xa.getUID(xa.NS_METRIC));
x.setName($.trim(Y.getText()));x.setDesc($.trim(ha.getText()));x.setExpr(S.getExpr());x.setFormat(A.getFormat());x.setNumber(ma());return x};this.setMetric=function(x){l=x;W()};this.setCopyMode=function(x){Ja=x};this.checkValidity=function(x){var Na=Y.getText().trim(),ba=ha.getText().trim(),Ea=ma(),Xa=/^[\u3000\u4E00-\u9FA5a-zA-Z0-9_]{1,}$/;if(0==Na.length)x(K.get("nameIsEmptyPrompt","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a\u3002"));else if(50<Na.length)x(K.get("metricNameTooLong","\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002"));
else if(Na.match(Xa))if(Xa=/^([a-zA-Z_])[a-zA-Z0-9_-]{0,}$/,0==Ea.length)x(K.get("metricNumberIsEmptyPrompt","\u6307\u6807\u7f16\u7801\u4e0d\u53ef\u4e3a\u7a7a\u3002"));else if(25<Ea.length)x(K.get("metricNumberTooLongPrompt","\u6307\u6807\u7f16\u7801\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc725\u4e2a\u5b57\u7b26\u3002"));else if(Ea.match(Xa))if(q.isSpecialWord(Ea))x(K.get("specialWordAsMetricNumber","\u201c#1\u201d\u4e3a\u7279\u6b8a\u5173\u952e\u5b57\uff0c\u4e0d\u80fd\u4f5c\u4e3a\u6307\u6807\u7f16\u7801\u3002").replace("#1",
Ea));else if(500<ba.length)x(K.get("descTooLongPrompt","\u63cf\u8ff0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7500\u4e2a\u5b57\u7b26\u3002"));else{Ea=p.getModelerModel();Xa=Ea.getAllMetric();for(ba=0;ba<Xa.length;ba++){var ja=Xa[ba];if(l!=ja&&Na==ja.getName()){x(K.get("duplicateNameTips","\u540d\u79f0\u91cd\u590d\u3002"));return}}Ea=Ea.getAllDimension();for(ba=0;ba<Ea.length;ba++)if(Ea[ba].getName()==Na){x(K.get("duplicateMetricNameInDimension","\u6307\u6807\u540d\u79f0\u4e0e\u7ef4\u5ea6\u540d\u79f0\u91cd\u590d\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u3002"));
return}(Na=S.checkValidity())?x(Na):Ca(x)}else x(K.get("invalidMetricNumberPrompt","\u6307\u6807\u7f16\u7801\u53ea\u80fd\u7531\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u201c-\u201d\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\uff0c\u4e14\u4e0d\u80fd\u4ee5\u6570\u5b57\u6216\u201c-\u201d\u5f00\u5934\u3002"));else x(K.get("invalidMetricName","\u6307\u6807\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\u3002"))};this.setExternalMsgCurtain=function(x){ca=
x};var Ga=function(){var x=$("<div>"),Na=0,ba=new ra(K.get("metricNumber","\u7f16\u7801"));ba.setRequired(!0);ba=ba.getJqUi();B=new N;B.setPlaceholder(K.get("invalidMetricNumberPrompt","\u6307\u6807\u7f16\u7801\u53ea\u80fd\u7531\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u201d-\u201c\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\uff0c\u4e14\u4e0d\u80fd\u4ee5\u6570\u5b57\u6216\u201c-\u201d\u5f00\u5934\u3002"));B.addEditedListener(function(){Ta=!0});var Ea=B.getJqUi();J.layoutCtrlWithLRTB(Ea,70,0,null,Na,null,23);J.layoutCtrl(ba,
0,Na,70,23);var Xa=new ra(K.get("name","\u540d\u79f0"));Xa.setRequired(!0);Xa=Xa.getJqUi();Y=new N;var ja=Y.getJqUi();J.layoutCtrlWithLRTB(ja,70,0,null,Na+=40,null,23);J.layoutCtrl(Xa,0,Na,70,23);var V=(new ra(K.get("desc","\u63cf\u8ff0"))).getJqUi();ha=new N;var Ka=ha.getJqUi();J.layoutCtrlWithLRTB(Ka,70,0,null,Na+=40,null,23);J.layoutCtrl(V,0,Na,70,23);var Qa=$a();J.layoutCtrlWithLRTB(Qa,0,0,null,Na+=40,0,null);A=new Ya;var ea=A.getJqUi();J.layoutCtrlWithLRTB(ea,null,0,150,Na,null,20);ba.appendTo(x);
Ea.appendTo(x);Xa.appendTo(x);ja.appendTo(x);V.appendTo(x);Ka.appendTo(x);Qa.appendTo(x);ea.appendTo(x);return x},$a=function(){S=new za;S.setGlobal(p);S.setFieldMapGetter(function(){return E.getTableFieldMap()});return S.getJqUi()},oa=function(){E=new Ma;E.setExcludeMetric(l);E.setGlobal(p);E.setIllegalRefAddCallback(function(x){ca&&ca.showPrompt(x)});E.setErrorCallback(function(x){ca&&ca.showError(x)});E.setExprRefCollector(function(x){S&&S.addExprReference(x)});return E.getJqUi()},W=function(){l&&
k&&(Y.setText(l.getName()),ha.setText(l.getDesc()),S.setCurrentMetricId(l.getId()),S.setExpr(l.getExpr()),A.setFormat(l.getFormat()),B.setText(l.getNumber()))},Ta=!1,Ca=function(x){Ta||Ja||x();I.MetricNumberHelper.isImplExist()||x();for(var Na=ma(),ba=l?l.getId():null,Ea=p.getModelerModel().getAllMetric(),Xa=0;Xa<Ea.length;Xa++){var ja=Ea[Xa];if(ja.getNumber().toLowerCase()==Na.toLowerCase()&&ja.getId()!=ba){x(K.get("duplicateMetricNumber","\u6307\u6807\u7f16\u7801\u5df2\u5b58\u5728\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u3002"));
return}}Ea=p.getModelerModel().getAllDimension();for(Xa=0;Xa<Ea.length;Xa++)if(Ea[Xa].getNumber().toLowerCase()==Na.toLowerCase()){x(K.get("duplicateMetricNumberInDimension","\u6307\u6807\u7f16\u7801\u4e0e\u7ef4\u5ea6\u7f16\u7801\u91cd\u590d\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u3002"));return}I.MetricNumberHelper.isNumberExist(ba,Na,function(V){V?x(K.get("duplicateMetricNumber","\u6307\u6807\u7f16\u7801\u5df2\u5b58\u5728\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u3002")):x()},function(){x(K.get("checkMetricNumberFailed",
"\u7f16\u7801\u6821\u9a8c\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\u3002"))})},ma=function(){return B?B.getText().trim():""}}function Ya(){function k(){ka.call(this);var A=this,B=this.protectedMethod,Y;(function(){B.setTitle(K.get("numberFormat","\u6570\u5b57\u683c\u5f0f"));Y||(Y=new X,A.setSize(428,257),B.setContentPaneCreator(function(){var ha=new Z;ha.decode(p?p:"#,##0.00");Y.setModel(ha);return Y.getJqUi()}),B.setClosingChecker(Y.isValidToAccepted),B.setClosingAction(function(ha){ha&&(p=Y.getModel().encode(),
v.occur(v.FUNCTION,v.NUMBER_FOMMAT))}))})()}var l,p="#,##0.00";this.getJqUi=function(){l||E();return l};this.setFormat=function(A){p=A};this.getFormat=function(){return p};var E=function(){l=$("<div>");l.css("cursor","pointer");var A=$("<div>");A.text(K.get("numberFormat","\u6570\u5b57\u683c\u5f0f"));A.appendTo(l);A.css({color:"#5582F3","text-align":"right"});J.layoutCtrlWithLRTB(A,0,18,null,null,null,null);J.layoutCtrlMiddleAlign(A,20);A=$("<div>");A.appendTo(l);na.backgroundWithHover(A,"edit");
J.layoutCtrlWithLRTB(A,null,0,16,null,null,16);J.layoutCtrlMiddleAlign(A,16);l.on("click",function(){(new k).showDialog()})}}function Ma(){function k(){function ha(){function W(ea){var P=!0;this.getTableId=function(){return ea.getUid()};this.setExpand=function(da){P=da};this.isExpand=function(){return P};this.getTableName=function(){return I.TableNameHelper.getDisplayText(ea)}}function Ta(ea,P){this.getField=function(){return P};this.getTableId=function(){return ea.getUid()}}var Ca,ma,x,Na,ba;this.getJqUi=
function(){Ca||Ea();return Ca.getJqUi()};this.setSearchText=function(ea){Na=ea;Qa()};var Ea=function(){Ca=new ia;Ca.setBorderVisible(!1);Ca.setCustomItemPainter(Xa);Ca.setMultiSelectable(!1);Ca.setCustomSelectedsPainter(ja);Ca.addDBLClickListener(function(P){P=P.getSelecteds()[0];P instanceof Ta&&(P=I.ExprRefHelper.createFieldReference(P.getTableId(),P.getField()),A&&A(P))});ba=new n;var ea=ba.getJqUi();S.append(ea);ea.hide()};this.setTables=function(ea){ma=ea;Qa()};this.setTableFieldMap=function(ea){x=
ea;Qa()};var Xa=function(ea,P){if(P instanceof Ta){var da=P.getField();ea.css("margin-left","30px");ea.addClass("metric-designer-field-listitem");var pa=$("<div>");pa.text(da.getAlias());pa.attr("title",da.getAlias());pa.addClass("metric-designer-table-field-text");ea.append(pa);ea.data("model",P);P=da.getOutputDataType();da=$("<div>");da.addClass("metric-designer-table-field-icon");J.layoutCtrl(da,10,3,16,16);na.background(da,P);da.data("myIconName",P);da.appendTo(ea)}else Ka(ea,P)},ja=function(ea,
P){for(var da=0;da<ea.length;da++){var pa=ea[da];V(pa,!1)}for(da=0;da<P.length;da++)pa=P[da],V(pa,!0)},V=function(ea,P){ea=ea.find(".metric-designer-table-field-icon");var da=ea.data("myIconName");na.background(ea,da+(P?"_hover":""))},Ka=function(ea,P){var da=$("<div>");J.layoutCtrl(da,0,2,16,16);na.backgroundWithHover(da,"expanded");da.appendTo(ea);var pa=$("<div>");J.layoutCtrl(pa,20,3,16,16);na.background(pa,"qingTable");pa.data("myIconName","qingTable");pa.addClass("metric-designer-table-field-icon");
pa.appendTo(ea);pa=$("<div>");pa.text(P.getTableName());pa.attr("title",P.getTableName());pa.addClass("metric-designer-table-field-text");pa.css("left","40px");pa.css("font-weight","bold");ea.on("click",function(Va){Va=$(Va.currentTarget).data("model");var cb=!Va.isExpand();Va.setExpand(cb);na.backgroundWithHover(da,cb?"expanded":"expand");cb=Ca.getJqUi().find(".metric-designer-field-listitem");for(var y=Va.isExpand(),T=0;T<cb.length;T++){var U=$(cb[T]);U.data("model").getTableId()==Va.getTableId()&&
U.css("display",y?"":"none")}});ea.data("model",P);ea.append(pa)},Qa=function(){if(Ca&&ma){for(var ea=[],P=0;P<ma.length;P++){var da=ma[P];ea.push(new W(da));if(x){var pa=x[da.getUid()];if(pa)for(var Va=0;Va<pa.length;Va++)ea.push(new Ta(da,pa[Va]))}}if(Na||ea.length!=ma.length){if(P=Na){da=[];for(pa=0;pa<ea.length;pa++)Va=ea[pa],Va instanceof W?(0<da.length&&da[da.length-1]instanceof W&&da.splice(da.length-1),da.push(Va)):-1<Va.getField().getAlias().toUpperCase().indexOf(P)&&da.push(Va);da[da.length-
1]instanceof W&&da.splice(da.length-1);ea=da}Ca.setItemModels(ea);0==ea.length?(ba.setText(K.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),ba.getJqUi().show(),Ca.getJqUi().hide()):(ba.getJqUi().hide(),Ca.getJqUi().show())}else ba.setText(K.get("noOptionalField","\u6682\u65e0\u53ef\u9009\u62e9\u7684\u5b57\u6bb5")),ba.getJqUi().show(),Ca.getJqUi().hide()}}}C.AbstractTabPane.call(this);var S,Ja,ca={},Ga;this.getTitle=function(){return K.get("field","\u5b57\u6bb5")};
this.getTableFieldMap=function(){return ca};this.getJqUi=function(){if(!S){S=$("<div>");Ja=new ha;Ja.setTables(E.getModelerModel().getAllTable());var W=Ja.getJqUi();J.layoutCtrlWithLRTB(W,0,0,null,25,0,null);S.append(W);Ga=new Q;Ga.setShowSearchIcon(!0);Ga.setPlaceholder(K.get("searchField","\u8bf7\u8f93\u5165\u5b57\u6bb5\u540d\u79f0"));Ga.setSearchListenerDelay(800);Ga.addSearchListener(oa);W=Ga.getJqUi();J.layoutCtrlWithLRTB(W,0,0,null,0,null,25);S.append(W);$a()}return S};var $a=function(){I.FieldLoader.loadTableFields(E,
S,function(W){var Ta=Object.keys(W);ca={};for(var Ca=0;Ca<Ta.length;Ca++){for(var ma=Ta[Ca],x=W[ma],Na=[],ba=0;ba<x.length;ba++){var Ea=x[ba],Xa=Ea.getDataType();Xa==la.DT_INT||Xa==la.DT_NUMBER?Na.unshift(Ea):Na.push(Ea)}ca[ma]=Na}Ja.setTableFieldMap(ca)})},oa=function(){var W=$.trim(Ga.getText()).toUpperCase();Ja.setSearchText(W)}}function l(){C.AbstractTabPane.call(this);var ha,S,Ja,ca;this.getTitle=function(){return K.get("metric","\u6307\u6807")};this.getJqUi=function(){if(!ha){ha=$("<div>");
var ma=Ca();0<ma.length?Ga(ma):(ma=$("<div>"),ma.text(K.get("noMetricToRefer","\u6682\u65e0\u53ef\u5f15\u7528\u7684\u6307\u6807")),J.layoutCtrlMiddleAlign(ma,20),ma.css({color:"#999",width:"100%","text-align":"center","font-size":"14px"}),ma.appendTo(ha))}return ha};var Ga=function(ma){S=new ia;S.setBorderVisible(!1);S.setCustomItemPainter(Ta);S.setMultiSelectable(!1);S.addDBLClickListener(function(x){x=x.getSelecteds()[0];x=I.ExprRefHelper.createMetricReference(x.getId());A&&A(x)});S.setCustomSelectedsPainter(oa);
S.setItemModels(ma);ma=S.getJqUi();J.layoutCtrlWithLRTB(ma,0,0,null,25,0,null);ma.appendTo(ha);Ja=new Q;Ja.setShowSearchIcon(!0);Ja.setPlaceholder(K.get("searchMetric","\u8bf7\u8f93\u5165\u6307\u6807\u540d\u79f0"));Ja.setSearchListenerDelay(800);Ja.addSearchListener($a);ma=Ja.getJqUi();J.layoutCtrlWithLRTB(ma,0,0,null,0,null,25);ha.append(ma)},$a=function(){for(var ma=$.trim(Ja.getText()).toUpperCase(),x=Ca(),Na=[],ba=0;ba<x.length;ba++){var Ea=x[ba];-1<Ea.getName().toUpperCase().indexOf(ma)&&Na.push(Ea)}S.setItemModels(Na);
0==Na.length?(ca||(ca=$("<div>"),ca.text(K.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),J.layoutCtrlMiddleAlign(ca,20),ca.css({color:"#999",width:"100%","text-align":"center"}),ca.appendTo(ha)),ca.show(),S.getJqUi().hide()):(ca&&ca.hide(),S.getJqUi().show())},oa=function(ma,x){for(var Na=0;Na<ma.length;Na++){var ba=ma[Na];W(ba,!1)}for(Na=0;Na<x.length;Na++)ba=x[Na],W(ba,!0)},W=function(ma,x){ma.find(".metric-designer-table-field-icon")},Ta=function(ma,
x){var Na=$("<div>");Na.text(x.getName());Na.attr("title",x.getName());Na.addClass("metric-designer-table-field-text");Na.appendTo(ma);var ba=$("<div>");J.layoutCtrl(ba,10,3,16,16);ba.addClass("metric-designer-table-field-icon");na.background(ba,"metric");ba.appendTo(ma);var Ea=I.MetricStateMonitor.getInvalidMetricMap();-1!=Object.keys(Ea).indexOf(x.getId())&&Ea[x.getId()]&&(x=$("<div>"),na.background(x,"qingWarning"),x.css({width:"16px",height:"16px",position:"absolute",top:"3px"}),x.appendTo(ma),
x.attr("title",K.get("metricEditException","\u6307\u6807\u5f02\u5e38")),ba.css("left","20px"),Na.css("left","40px"))},Ca=function(){var ma=E.getModelerModel().getAllMetric();if(!Y)return ma;for(var x=[],Na=0;Na<ma.length;Na++){var ba=ma[Na];ba.getId()!=Y.getId()&&x.push(ba)}return x}}var p,E,A,B,Y;this.getJqUi=function(){if(!p){p=$("<div>");B=new k;var ha=new l,S=new C;S.setTabLevel(C.SECOND_LEVEL);S.addTab(B,!0);S.addTab(ha);p.append(S.getJqUi())}return p};this.setExcludeMetric=function(ha){Y=ha};
this.getTableFieldMap=function(){return B.getTableFieldMap()};this.setExprRefCollector=function(ha){A=ha};this.setErrorCallback=function(ha){};this.setGlobal=function(ha){E=ha};this.setIllegalRefAddCallback=function(ha){}}function ya(){var k=this,l,p,E,A,B,Y,ha,S,Ja,ca,Ga,$a,oa;this.setGlobal=function(V){l=V};this.setMetric=function(V){p=V};this.setNoDataContainer=function(V){ca=V};this.setAddMetricBtn=function(V){Ga=V};this.getMetric=function(){return p};this.getJqUi=function(){if(!E){E=$("<div>");
E.addClass("metric-card-container");A=$("<div>");A.addClass("metric-card-detail-container");var V=$("<div>");V.addClass("metric-card-title-container");var Ka=$("<span>");Ka.addClass("metric-card-icon");na.background(Ka,"metric_icon");V.append(Ka);Ka=$("<span>");Ka.addClass("metric-card-name-container");var Qa="("+p.getNumber()+")",ea=p.getName()+" "+Qa;Y=$("<span>");Y.addClass("metric-card-name");Y.attr("title",ea);Y.text(p.getName());Ka.append(Y);J.makeTextOmissible(Y);var P=$("<span>");J.makeTextOmissible(P);
P.addClass("metric-card-number-container");ha=$("<span>");ha.addClass("metric-card-number");ha.attr("title",ea);ha.text(Qa);P.append(ha);Ka.append(P);V.append(Ka);A.append(V);V=$("<div>");V.addClass("metric-card-desc-container");Ka=$("<span>");Ka.addClass("metric-card-desc-fixed");Ka.text(K.get("metricDescription","\u63cf\u8ff0\uff1a"));S=$("<span>");S.addClass("metric-card-desc");S.attr("title",p.getDesc());S.text(p.getDesc());J.makeTextOmissible(V);V.append(Ka);V.append(S);A.append(V);V=$("<div>");
V.addClass("metric-card-expr-container");Ka=$("<span>");Ka.addClass("metric-card-expr-fixed");Ka.text(K.get("metricExpression","\u8868\u8fbe\u5f0f\uff1a"));Ja=$("<span>");Ja.addClass("metric-card-expr");Ja.attr("title",k.getDisplayExpression());Ja.append(k.getJqExpression());J.makeTextOmissible(V);V.append(Ka);V.append(Ja);A.append(V);E.append(A);B=$("<div>");B.addClass("metric-card-operation-container");V=$("<span>");V.addClass("metric-card-button");V.attr("title",K.get("metricDelete","\u5220\u9664"));
V.css("order",2);na.backgroundWithHover(V,"delete");V.on("click",x);V.appendTo(B);V=$("<span>");V.addClass("metric-card-button");V.attr("title",K.get("copy","\u590d\u5236"));na.backgroundWithHover(V,"metric_copy");V.on("click",Ta);V.appendTo(B);V=$("<span>");V.addClass("metric-card-button");V.attr("title",K.get("metricEdit","\u7f16\u8f91"));V.css("order",1);na.backgroundWithHover(V,"edit");V.on("click",Ca);V.appendTo(B);V=$("<span>");V.addClass("metric-card-button metric-card-button-calc");V.attr("title",
K.get("metricCalculate","\u8bd5\u8ba1\u7b97"));V.css("order",3);na.backgroundWithHover(V,"trial_calc");V.on("click",Na);V.appendTo(B);$a=$("<span>");$a.addClass("metric-card-button metric-card-button-filter");$a.attr("title",K.get("filter","\u8fc7\u6ee4"));W();$a.on("click",ma);$a.appendTo(B);E.append(B);ja()}return E};this.updateUi=function(){Y.attr("title",p.getName());Y.text(p.getName());S.attr("title",p.getDesc());S.text(p.getDesc());Ja.empty();Ja.attr("title",k.getDisplayExpression());Ja.append(k.getJqExpression());
W();ja()};var W=function(){$a&&(0<p.getFilterItems().length?na.background($a,"exist_filter"):na.backgroundWithHover($a,"new_filter"))};this.getDisplayExpression=function(){for(var V="",Ka=I.ExprRefHelper.translateToTextSegment(p.getExpr()),Qa=0;Qa<Ka.length;Qa++)V+=Ka[Qa].getText();return V};this.getJqExpression=function(){for(var V=$("<span>"),Ka=I.ExprRefHelper.translateToTextSegment(p.getExpr()),Qa=0;Qa<Ka.length;Qa++){var ea=Ka[Qa];ea=$("<span>").text(ea.getText()).css("color",ea.getColor());
V.append(ea)}return V};this.setValidPrompt=function(V){oa=V;ja()};var Ta=function(){var V=new Oa(p);V.setGlobal(l);V.showDialog()},Ca=function(){(new G).setGlobal(l);var V=new qa(p);V.setGlobal(l);V.showDialog()},ma=function(){var V=new Da(l);V.setMetric(p);V.showDialog()},x=function(){var V=I.ExprRefHelper.getMetricReferredInfo(p);0!==V.length?ba(p.getName(),V[0].getName(),V.length).setClosingChecker(function(Ka){return!0}):(V=Ea(),V.setClosingChecker(function(Ka){Ka===F.RETURN_OK&&(Ka=new fa,Ka.setValue(p,
l),l.getCommandManager().perform(Ka),v.occur(v.BUTTON_TYPE,v.METRIC_DELETE));return!0}),V.setClosedAction(function(){0===l.getModelerModel().getAllMetric().length&&(ca.show(),Ga.hide())}))},Na=function(){var V=l.getModelerModel(),Ka=new H;Ka.setModelerModel(V);var Qa=new M(l.getRemoteImpl(),function(ea){var P=new D;P.fromJsonObject(ea);I.MetricStateMonitor.setModelValidity(P);ea=new r;ea.setMetric(p);ea.setModeler(V);ea.setTitle(K.get("metricsTrialCalculate","\u6307\u6807\u8bd5\u8ba1\u7b97"));ea.setButtonName(K.get("trialCalculate",
"\u8bd5\u8ba1\u7b97"));ea.setGlobal(l);ea.showDialog()});Qa.setShowBlocking(!0);Qa.checkModelerValid(Ka.toJsonObject())},ba=function(V,Ka,Qa){var ea=F.createFeedbackDialog();ea.setMsgImageType(F.MSG_WARNING);ea.setOptionType(F.OPTION_OK);if(1===Qa){var P=K.get("confirmWarningOneMetric","\u6307\u6807\u201c#1\u201d\u5df2\u88ab\u6307\u6807\u201c#2\u201d\u5f15\u7528\uff0c\u8bf7\u5148\u5220\u9664\u5f15\u7528\u7684\u6307\u6807\u3002");P=P.replace("#1",V);P=P.replace("#2",Ka)}else P=K.get("confirmWarningMetric",
"\u6307\u6807\u201c#1\u201d\u5df2\u88ab\u201c#2\u201d\u7b49#3\u4e2a\u6307\u6807\u5f15\u7528\uff0c\u8bf7\u5148\u5220\u9664\u5f15\u7528\u7684\u6307\u6807\u3002"),P=P.replace("#1",V),P=P.replace("#2",Ka),P=P.replace("#3",Qa);ea.setMessage(P);ea.showDialog();return ea},Ea=function(){var V=F.createFeedbackDialog();V.setMsgImageType(F.MSG_DELETE);V.setOptionType(F.OPTION_OK_CANCEL);var Ka=K.get("confirmDeleteMetric","\u786e\u5b9a\u5220\u9664\u8be5\u6307\u6807\u5417\uff1f");V.setMessage(Ka);V.showDialog();
return V},Xa,ja=function(){if(E)if(Xa&&(Xa.remove(),Xa=null),oa){E.addClass("metric-card-invalid-ui");Xa=$("<div>");J.layoutCtrlWithLRTB(Xa,0,0,null,null,-26,26);var V=$("<div>");V.text(oa);V.css("color","#fd6c6a");J.layoutCtrlMiddleAlign(V,20);J.layoutCtrl(V,20,null,null,null,null);var Ka=$("<div>");na.background(Ka,"qingWarning");J.layoutCtrl(Ka,0,null,16,16);J.layoutCtrlMiddleAlign(Ka,16);V.appendTo(Xa);Ka.appendTo(Xa);Xa.appendTo(E)}else E.removeClass("metric-card-invalid-ui")}}function Da(k){ka.call(this);
var l=this.protectedMethod,p=this,E,A;(function(){p.setSize(800,600);l.setTitle(K.get("metricFilter","\u6307\u6807\u8fc7\u6ee4"));l.setSelectable(!0);l.getDialogCtrl().setMinSize(800,600);l.setContentPaneCreator(function(){var Y=$("<div>");B(Y);return Y});l.setClosingAction(function(Y){});l.setClosingChecker(function(){var Y=A.checkFilterValid();if(Y)return l.getMessageCurtain().showPrompt(Y),!1;Y=A.getFilterItems();var ha=E.getFilterItems()?E.clone().getFilterItems():[],S;a:if(ha&&Y&&ha.length===
Y.length){for(S=0;S<ha.length;S++)if(!ha[S].equals(Y[S])){S=!1;break a}S=!0}else S=!1;S||(S=new z,S.setValue(E,ha,Y),k.getCommandManager().perform(S));E.setFilterItems(Y);v.occur(v.FUNCTION,v.METRIC_FILTER);Y=new G;Y.setGlobal(k);ha=k.getModelerModel();S=new H;S.setModelerModel(ha);Y.backgroundCheck(S.toJsonObject());l.destroy();return!0})})();this.setMetric=function(Y){E=Y};var B=function(Y){I.FieldLoader.loadTableFields(k,Y,function(ha){for(var S=Object.keys(ha),Ja={},ca=[],Ga=0;Ga<S.length;Ga++){for(var $a=
S[Ga],oa=ha[$a],W=[],Ta=0;Ta<oa.length;Ta++){var Ca=oa[Ta];Ca.setFromNode($a);var ma=Ca.getDataType();ma===la.DT_INT||ma===la.DT_NUMBER?W.unshift(Ca):W.push(Ca)}Ja[$a]=W;ca=ca.concat(W)}ha=E.getFilterItems()?E.clone().getFilterItems():[];S=ca;for(Ga=0;Ga<ha.length;Ga++)if($a=S,oa=ha[Ga],!oa.isEmpty())for(W=0;W<$a.length;W++)if(Ta=$a[W],oa.getField().getFullName()===Ta.getFullName()){oa.setField(Ta);break}A=new va;A.setGlobal(k);A.setMessageCurtain(l.getMessageCurtain());A.setFields(ca);A.setFilterItems(ha);
A.setTableFieldMap(Ja);Y.append(A.getJqUi())})}}function va(){function k(y){KTDefaultCellRender.call(this,y);var T=this,U=this.paintCellUI;this.setGlobal=function(Fa){};this.paintCellUI=function(Fa,Sa){if(T.getCurrentRowIdx()<w.getHeadRowCount()||!T.getCell())U(Fa,Sa);else{var La=T.getCellWidth(),eb=T.getCellHeight(),ta=T.getCurrentRow();if(0===T.getCurrentColIdx())ta=T.getCell().getValue(),Fa=$(Fa),Fa.find(".modeler-designer-filter-table-prompt").remove(),ta&&(La=a.createWarning(),La.addClass("modeler-designer-filter-table-prompt"),
La.attr("title",ta),La.appendTo(Fa));else if(1===T.getCurrentColIdx()||5===T.getCurrentColIdx()){Sa=1===T.getCurrentColIdx();var Pa=T.getCell().getValue();pa(Fa,La,eb,Sa,Pa,ta)}else if(2===T.getCurrentColIdx())Sa=T.getCell().getValue(),da(Fa,La,eb,Sa,ta);else if(3===T.getCurrentColIdx()){Sa=T.getCell().getValue();var R=ta.getUserObject().getField();Pa=R?R.getOutputDataType():null;R=R?R.isEnum():!1;Fa=w.createCtrlInCell(Fa,La,eb,c);Fa.setSelected(Sa);Fa.setItemModels(Pa?m.getSelectableCompares(Pa,
R):[]);Fa.setUserObject(ta);Fa.setCustomPainter(Xa);Fa.addSelectedChangedListener(ba)}else 4===T.getCurrentColIdx()?(Sa=T.getCell().getValue(),ja(Fa,La,eb,Sa,ta)):6===T.getCurrentColIdx()?(Sa=T.getCell().getValue(),x(Fa,La,eb,Sa,ta)):U(Fa,Sa)}}}function l(){ka.call(this);var y=this,T=this.protectedMethod,U;this.edit=function(Fa,Sa,La){T.setTitle(K.get("relativeDateRange","\u76f8\u5bf9\u65e5\u671f"));U||(y.setSize(450,430),U=new f,U.setContainsTime(Sa),Sa=new e,Sa.fromJsonObject(Fa.toJsonObject()),
U.setModel(Sa),T.setContentPaneCreator(function(){return U.getJqUi()}),T.setClosingAction(function(eb){eb&&(eb=U.getModel(),La(eb))}))}}function p(){var y=[],T,U,Fa=[],Sa=[],La;this.setItemModel=function(R,wa){La=wa;y=R};this.setListItemPainter=function(R){};this.setSelectedItemModel=function(R){Fa=R;Sa=Fa.slice(0)};this.setLastTimeSelectedModel=function(R){Sa=R};this.getSelectedItemModel=function(){return Fa};this.createJqPopup=function(R,wa,Ia,db){T=$("<div>");T.appendTo(R);U=$("<div>");T.addClass("modeler-designer-field-popup");
U.addClass("modeler-designer-enum-popup-list-owner");for(R=0;R<y.length;R++)ta(y[R],U,wa,!1);wa=new t;wa.setHighlight(!0);wa.setText(K.get("ok","\u786e\u5b9a"));wa=wa.getJqUi();wa.css("z-index",3);wa.css("margin-left",10);J.layoutCtrlWithLRTB(wa,"50%",null,50,null,8,28);wa.on("click",function(nb){Sa=Fa.slice(0);Ia(Fa)});R=new t(K.get("cancle","\u53d6\u6d88"));R.setHighlight(!1);R=R.getJqUi();R.css("z-index",3);R.css("margin-left",-80);J.layoutCtrlWithLRTB(R,"50%",null,50,null,8,28);R.on("click",function(nb){Fa=
Sa.slice(0);db()});U.appendTo(T);wa.appendTo(T);R.appendTo(T);U.css("height","77%");return[-1,260]};var eb=function(R,wa){wa=R.getUserObject();R=R.isChecked();wa&&R?(R=Pa(wa),0>R&&Fa.push(wa)):wa&&!R&&(R=Pa(wa),-1<R&&Fa.splice(R,1))},ta=function(R,wa,Ia){var db=Pa(R);Ia=$("<div>");Ia.addClass("modeler-designer-field-popup-list-item");Ia.data("model",R);var nb=$("<div>"),hb=new CheckBox;hb.setUserObject(R);hb.setChecked(-1<db);hb.addCheckedListener(eb);db=hb.getJqUi();db.addClass("modeler-designer-field-selection-checkbox-icon");
db.data("model",hb);hb=$("<div>");hb.text(R.fieldValue);hb.addClass("modeler-designer-field-selection-checkbox-text");nb.append(db);nb.append(hb);Ia.append(nb);wa.append(Ia)},Pa=function(R){for(var wa=0;wa<Fa.length;wa++)if(La(R,Fa[wa]))return wa;return-1}}function E(){ka.call(this);var y=this,T=this.protectedMethod,U=new ra,Fa=new ra,Sa=new g,La,eb;this.setCaption=function(R,wa){T.setTitle(R);U.setText(wa)};this.setText=function(R,wa){Sa.setText(R);var Ia=0;R&&(R=R.split("\n").length,Ia=1E3<R?1E3:
R);Fa.setText(Ia+"/1000\u9879");eb=function(db){var nb=db?$.trim(Sa.getText()):null;wa(db,nb)};T.setClosingAction(eb)};this.showDialogLeftAnchorTo=function(R){R&&(y.setSize(470,450),R=J.upwardCoordinate(document.body,[0,0],document.body),y.setPosition(Math.max(0,R[0]-10),Math.max(6,R[1]-450+40)));Sa.addEditedListener(Pa);T.setContentPaneCreator(ta);y.showDialog();Sa.requestFocus()};this.setClosingChecker=function(R){R&&(La=function(){var wa=R($.trim(Sa.getText()));wa&&T.getMessageCurtain().showPrompt(wa);
return wa?!1:!0},T.setClosingChecker(La))};var ta=function(){Fa.setAlign(ra.ALIGN_RIGHT);J.layoutCtrlWithLRTB(U.getJqUi(),0,0,null,0,null,23);J.layoutCtrlWithLRTB(Sa.getJqUi(),0,0,null,30,null,260);J.layoutCtrlWithLRTB(Fa.getJqUi(),290,0,null,287,null,23);var R=$("<div>");R.append(U.getJqUi());R.append(Sa.getJqUi());R.append(Fa.getJqUi());return R},Pa=function(R){var wa=R.getText(),Ia=[];wa&&(Ia=wa.trim().replace(/(\n\s*)+/g,"\n").split("\n"));wa=Ia.length;1E3<wa&&(R.setText(Ia.slice(0,1E3).join("\n")),
wa=1E3);Fa.setText(wa+"/1000\u9879");T.getMessageCurtain().hide()}}function A(){function y(){var ta,Pa,R,wa,Ia,db,nb;this.getJqUi=function(){ta||hb();return ta.getJqUi()};this.setSelectedModel=function(Ba){db=Ba};this.setSelectedModelSetter=function(Ba){nb=Ba};this.setSearchText=function(Ba){wa=Ba;sa()};this.setTables=function(Ba){Pa=Ba;sa()};this.setTableFieldMap=function(Ba){R=Ba;sa()};var hb=function(){ta=new ia;ta.setBorderVisible(!0);ta.setCustomItemPainter(Za);ta.setMultiSelectable(!1);ta.setCustomSelectedsPainter(kb);
ta.addPressedListener(function(Ba,Ha){Ba=Ba.getSelecteds()[0];Ba instanceof Y&&nb&&nb(Ba.getField())})},Za=function(Ba,Ha){if(Ha instanceof Y){var Wa=Ha.getField();Ba.css("margin-left","20px");Ba.addClass("metric-filter-field-list-item");Ba.css("cursor","pointer");var ab=$("<div>");ab.text(Wa.getAlias());ab.attr("title",Wa.getAlias());ab.addClass("metric-designer-table-field-text");Ba.append(ab);Ba.data("model",Ha);Wa=Wa.getOutputDataType();ab=$("<div>");ab.addClass("metric-designer-table-field-icon");
J.layoutCtrl(ab,10,3,16,16);na.background(ab,Wa);ab.data("myIconName",Wa);ab.appendTo(Ba);db&&Ha&&db.getFullName()===Ha.getField().getFullName()&&qb(Ba,Ha)}else ub(Ba,Ha)},kb=function(Ba,Ha){for(var Wa=0;Wa<Ba.length;Wa++){var ab=Ba[Wa];pb(ab,!1)}for(Wa=0;Wa<Ha.length;Wa++)ab=Ha[Wa],pb(ab,!0)},pb=function(Ba,Ha){Ba=Ba.find(".metric-designer-table-field-icon");var Wa=Ba.data("myIconName");na.background(Ba,Wa+(Ha?"_hover":""))},qb=function(Ba,Ha){var Wa=null;if(0<Ba.height()){clearTimeout(Wa);Wa=Ba.find(".metric-designer-table-field-icon");
var ab=Wa.data("myIconName");na.background(Wa,ab+"_hover");Ba.css("color","#fff");Ba.css("background-color","#88a7f6");Ba.css("background-color","var(--color-lightish, #88a7f6)");ta.setSelecteds([Ha]);ta.scrollSelectedToVisible(Ha)}else Wa=setTimeout(function(){qb(Ba,Ha)},0)},ub=function(Ba,Ha){var Wa=$("<div>");J.layoutCtrl(Wa,0,2,16,16);na.backgroundWithHover(Wa,"expanded");Wa.appendTo(Ba);var ab=$("<div>");J.layoutCtrl(ab,20,3,16,16);na.background(ab,"qingTable");ab.data("myIconName","qingTable");
ab.addClass("metric-designer-table-field-icon");ab.appendTo(Ba);ab=$("<div>");ab.text(Ha.getTableName());ab.attr("title",Ha.getTableName());ab.addClass("metric-designer-table-field-text");ab.css("left","40px");ab.css("font-weight","bold");Ba.on("click",function(lb){lb=$(lb.currentTarget).data("model");var sb=!lb.isExpand();lb.setExpand(sb);na.backgroundWithHover(Wa,sb?"expanded":"expand");sb=ta.getJqUi().find(".metric-filter-field-list-item");for(var xb=lb.isExpand(),jb=0;jb<sb.length;jb++){var rb=
$(sb[jb]);rb.data("model").getTableId()===lb.getTableId()&&rb.css("display",xb?"":"none")}});Ba.data("model",Ha);Ba.append(ab)},sa=function(){if(ta&&Pa){for(var Ba=[],Ha=0;Ha<Pa.length;Ha++){var Wa=Pa[Ha];Ba.push(new B(Wa));if(R){var ab=R[Wa.getUid()];if(ab)for(var lb=0;lb<ab.length;lb++)Ba.push(new Y(Wa,ab[lb]))}}if(Ha=wa){Wa=[];for(ab=0;ab<Ba.length;ab++)lb=Ba[ab],lb instanceof B?(0<Wa.length&&Wa[Wa.length-1]instanceof B&&Wa.splice(Wa.length-1),Wa.push(lb)):-1<lb.getField().getAlias().toUpperCase().indexOf(Ha)&&
Wa.push(lb);Wa[Wa.length-1]instanceof B&&Wa.splice(Wa.length-1);Ba=Wa}ta.setItemModels(Ba,Ra);0===Ba.length?(Ia||(Ia=$("<div>"),Ia.text(K.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),J.layoutCtrlMiddleAlign(Ia,20),Ia.css({color:"#999",width:"100%","text-align":"center"}),Ia.appendTo(T)),Ia.show(),ta.getJqUi().hide()):(Ia&&Ia.hide(),ta.getJqUi().show())}},Ra=function(Ba,Ha){return Ba instanceof B&&Ha instanceof B||Ba instanceof Y&&Ha instanceof Y?Ba.equals(Ha):
!1}}var T,U,Fa,Sa,La;this.createJqPopup=function(ta,Pa,R){T=$("<div>");T.appendTo(ta);Sa=new Q;Sa.setShowSearchIcon(!0);Sa.setPlaceholder(K.get("searchField","\u8bf7\u8f93\u5165\u5b57\u6bb5\u540d\u79f0"));Sa.setSearchListenerDelay(800);Sa.addSearchListener(eb);ta=Sa.getJqUi();J.layoutCtrlWithLRTB(ta,0,0,null,0,null,25);T.append(ta);La=new y;La.setSelectedModel(Pa);La.setSelectedModelSetter(R);La.setTables(U.getModelerModel().getAllTable());Pa=La.getJqUi();J.layoutCtrlWithLRTB(Pa,0,0,null,25,0,null);
T.append(Pa);La.setTableFieldMap(Fa)};this.setTableFieldMap=function(ta){Fa=ta};this.setGlobal=function(ta){U=ta};var eb=function(){var ta=$.trim(Sa.getText()).toUpperCase();La.setSearchText(ta)}}function B(y){var T=!0;this.getTableId=function(){return y.getUid()};this.setExpand=function(U){T=U};this.isExpand=function(){return T};this.getTableName=function(){return I.TableNameHelper.getDisplayText(y)};this.equals=function(U){return this.getTableId()===U.getTableId()}}function Y(y,T){this.getField=
function(){return T};this.getTableId=function(){return y.getUid()};this.equals=function(U){return this.getTableId()===U.getTableId()&&this.getField().equals(U.getField())}}var ha=this,S,Ja,ca,Ga=[],$a={},oa=[],W;this.getJqUi=function(){if(!Ja){Ja=$("<div>");Ja.addClass("metric-filter-condition");ca=w.createTable();ca.setDraggableAdjusting(!0);ca.setSyncUIWhenModelChanged(!0);ca.setColumnFitVisibleWidth(!1);ca.setAutoAdjustRowHeight(!0);ca.setScrollerVisible("hidden","auto");ca.setFrozenRows(0);w.bindTextEditor(ca,
Ta,Ca);w.bindTableListenerForCtrl(ca,ma);var y=new k(ca);y.setGlobal(S);y.setOutsideVisible(!1);ca.setCellRender(y);ca.addColumns(8);ca.getColumn(0).setWidth(23);ca.getColumn(1).setWidth(60);ca.getColumn(2).setWidth(170);ca.getColumn(3).setWidth(95);ca.getColumn(4).setWidth(200);ca.getColumn(5).setWidth(60);ca.getColumn(6).setWidth(60);ca.getColumn(7).setWidth(100);y=w.createHeadRow(ca);y.getCell(1).setValue(K.get("leftBracket","\u5de6\u62ec\u53f7"));y.getCell(2).setValue(K.get("field","\u5b57\u6bb5"));
y.getCell(3).setValue(K.get("compare","\u6bd4\u8f83"));y.getCell(4).setValue(K.get("value","\u503c"));y.getCell(5).setValue(K.get("rightBracket","\u53f3\u62ec\u53f7"));y.getCell(6).setValue(K.get("logic","\u903b\u8f91"));y=$(ca.getUI());y.addClass("metric-filter-condition-table");Ja.append(y);ha.updateUi();ha.checkFilterValid()}return Ja};this.getFilterItems=function(){for(var y=[],T=0;T<oa.length;T++){var U=oa[T];U.isEmpty()||y.push(U)}return y};this.setFilterItems=function(y){oa=y};this.setFields=
function(y){Ga=y};this.setGlobal=function(y){S=y};this.setMessageCurtain=function(y){};this.setTableFieldMap=function(y){$a=y};this.afterResize=function(){ca.relayoutViews()};this.updateUi=function(){if(ca){for(var y=oa.length-1;0<=y;y--)if(oa[y].isEmpty())oa.splice(y,1);else break;w.clearWithoutHead(ca);y=Math.max(14,oa.length+1);for(var T=0;T<y;T++){var U=oa[T];T>=oa.length&&(U=new m,oa.push(U));var Fa=w.createRow(ca);Fa.setUserObject(U);Fa.getCell(0).setValue("");Fa.getCell(1).setValue(U.getLeftBracketCount());
Fa.getCell(2).setValue(U.getField());Fa.getCell(3).setValue(U.getCompareOp());m.isCompareOpRelativeDateRangeValue(U.getCompareOp())?Fa.getCell(4).setValue(U.getRelativeDateRange()?U.getRelativeDateRange():""):Fa.getCell(4).setValue(U.getValue()?U.getValue():"");Fa.getCell(5).setValue(U.getRightBracketCount());Fa.getCell(6).setValue(U.getLogicOp()?U.getLogicOp():"")}w.refresh(ca)}};this.checkFilterValid=function(){var y=L.checkFilterField(oa,Ga);if(y||(y=ha.checkFieldTableIsJoined(S,oa))||(y=L.checkFilterLogical(oa)))return ha.locateToErrorRow(y.getFiltersErrorRow(),
y.getPrompt()),y.getPrompt();ha.locateToErrorRow(-1);return null};ha.checkFieldTableIsJoined=function(y,T){for(y=0;y<T.length;y++)T[y].isEmpty();return null};this.locateToErrorRow=function(y,T){for(var U=w.getHeadRowCount();U<ca.getRowsCount();U++)ca.getRow(U).getCell(0).setValue("");-1!==y&&ca.getRow(y+w.getHeadRowCount()).getCell(0).setValue(T)};var Ta=function(y,T){if(4!==T)return!1;y=ca.getRow(y).getUserObject();T=y.getCompareOp();if(m.isCompareOpWithoutValue(T)||m.isCompareOpWithinOrNotWithinValue(T)||
!L.checkFieldExisted(y,Ga))return!1;y=y.getField();return Qa(y)},Ca=function(y,T,U,Fa,Sa){y=y.getUserObject();y.getValue()!==Fa&&(y.setValue(Fa),U.setValue(Fa),ha.checkFilterValid());return!0},ma=function(y,T,U,Fa){y=null;if(T){T=KTableUIAbstractView.createCellId(ca.getRow(U),ca.getColumn(ca.getColumnsCount()-1));y=ha.getJqUi().find("#"+T);var Sa=U-w.getHeadRowCount();U=$("<div>");U.text(K.get("insertRow","\u63d2\u5165"));U.addClass("modeler-designer-filter-table-op");U.css("left","10px");U.appendTo(y);
U.on("click",function(La){La=new m;oa.splice(Sa,0,La);ha.updateUi();ha.checkFilterValid()});U=$("<div>");U.text(K.get("deleteRow","\u5220\u9664"));U.addClass("modeler-designer-filter-table-op");U.css("left","52px");U.appendTo(y);U.on("click",function(La){oa.splice(Sa,1);ha.updateUi();ha.checkFilterValid()})}else W&&W.find(".modeler-designer-filter-table-op").remove();W=y},x=function(y,T,U,Fa,Sa){y=w.createCtrlInCell(y,T,U,c);y.setSelected(Fa?Fa:null);y.setItemModels([null,m.LOGIC_AND,m.LOGIC_OR]);
y.setUserObject(Sa);y.setCustomPainter(function(La,eb,ta){La="";ta===m.LOGIC_AND?La=K.get("and","\u4e14"):ta===m.LOGIC_OR&&(La=K.get("or","\u6216"));eb.text(La)});y.addSelectedChangedListener(Na)},Na=function(y,T,U){y=y.getUserObject();y.getUserObject().setLogicOp(U);y.getCell(6).setValue(U);ha.checkFilterValid()},ba=function(y,T,U){y=y.getUserObject();var Fa=y.getUserObject();Fa.setCompareOp(U);y.getCell(3).setValue(U);if(m.isCompareOpWithoutValue(T)!==m.isCompareOpWithoutValue(U)||m.isCompareOpRelativeDateRangeValue(T)!==
m.isCompareOpRelativeDateRangeValue(U)||m.isCompareOpWithinOrNotWithinValue(T)!==m.isCompareOpWithinOrNotWithinValue(U))Fa.setValue(null),Fa.setRelativeDateRange(null),Ea(y.getCell(4)," ");ha.checkFilterValid()},Ea=function(y,T){y.setValue(""===T?" ":"");y.setValue(T)},Xa=function(y,T,U){switch(U){case m.COMPARE_EQUAL:y=K.get("equal","\u7b49\u4e8e");break;case m.COMPARE_NOT_EQUAL:y=K.get("notEqual","\u4e0d\u7b49\u4e8e");break;case m.COMPARE_GREATER:y=K.get("greater","\u5927\u4e8e");break;case m.COMPARE_GREATER_EQUAL:y=
K.get("equalOrGreater","\u5927\u4e8e\u7b49\u4e8e");break;case m.COMPARE_LESS:y=K.get("less","\u5c0f\u4e8e");break;case m.COMPARE_LESS_EQUAL:y=K.get("equalOrLess","\u5c0f\u4e8e\u7b49\u4e8e");break;case m.COMPARE_INCLUDE:y=K.get("include","\u5305\u542b");break;case m.COMPARE_NOT_INCLUDE:y=K.get("notInclude","\u4e0d\u5305\u542b");break;case m.COMPARE_START_WITH:y=K.get("startWith","\u5f00\u5934\u662f");break;case m.COMPARE_END_WITH:y=K.get("endWith","\u7ed3\u5c3e\u662f");break;case m.COMPARE_NULL:y=
K.get("compareNull","\u4e3a\u7a7a");break;case m.COMPARE_NOT_NULL:y=K.get("compareNotNull","\u4e0d\u4e3a\u7a7a");break;case m.COMPARE_IN:y=K.get("compareIn","\u5728......\u4e4b\u5185");break;case m.COMPARE_NOT_IN:y=K.get("compareNotIn","\u4e0d\u5728......\u4e4b\u5185");break;case m.COMPARE_RELATIVE_DATE_RANGE:y=K.get("relativeDateRange","\u76f8\u5bf9\u65e5\u671f");break;default:y=""}T.text(y)},ja=function(y,T,U,Fa,Sa){var La=Sa.getUserObject(),eb=$(y);eb.empty();if(L.checkFieldExisted(La,Ga)){eb.css("cursor",
"");var ta=La.getCompareOp(),Pa=La.getField(),R=Pa?Pa.getOutputDataType():"",wa=Pa?Pa.getEnumValue():null,Ia=Pa?Pa.isEnum():!1;if(!m.isCompareOpWithoutValue(ta))if(m.isCompareOpWithinOrNotWithinValue(ta))if(Ia){var db=[],nb;for(nb in wa)db.push({fieldValue:wa[nb],fieldName:nb});var hb=[];(Fa=JSON.parse(La.getValue()))&&Fa.forEach(function(Ra){db.forEach(function(Ba){Ra===Ba.fieldName&&hb.push({fieldValue:Ba.fieldValue,fieldName:Ba.fieldName})})});var Za=new p;Za.setItemModel(db,function(Ra,Ba){return Ra&&
Ba&&Ra.fieldName===Ba.fieldName});Za.setSelectedItemModel(hb);y=w.createCtrlInCell(y,T,U,b);y.setUserObject(Sa);y.setSelectedModel(hb);y.setDropdownCreator(function(Ra,Ba,Ha,Wa){return Za.createJqPopup(Ra,Ba,Ha,Wa)});y.addSelectionListener(function(Ra){var Ba=Ra.getSelectedModel();Ra=Ra.getUserObject().getUserObject();if(null==Ba||0===Ba.length)Ra.setValue(null);else{JSON.parse(Ra.getValue());var Ha=[],Wa;for(Wa in Ba)Ha.push(Ba[Wa].fieldName);Ra.setValue(JSON.stringify(Ha))}ha.checkFilterValid()});
y.setCustomPainter(function(Ra,Ba){var Ha=[],Wa;for(Wa in Ra)Ha.push(Ra[Wa].fieldValue);Ba.text(Ha.join(","))})}else{var kb=w.createCtrlInCell(y,T,U,d);kb.setClearable(!0);kb.setUserObject(Sa);kb.getJqUi().find(".sa-ctrl-f7selector-text").on("click",function(){ea(La,kb)});kb.addActionListener(function(Ra){ea(La,kb)});null!=Fa&&""!==Fa&&" "!==Fa&&Fa&&kb.setModel(JSON.parse(Fa).join(","));kb.setCustomPainter(function(Ra){return Ra});kb.addClearListener(function(Ra){P(Ra,La,null)})}else if(Qa(Pa))y=
$("<div>"),y.text(Fa),y.addClass("modeler-designer-common-table-cell-editable"),y.appendTo(eb),eb.css("cursor","pointer");else if(R===la.DT_DATE||R===la.DT_DATETIME)if(m.isCompareOpRelativeDateRangeValue(ta)){var pb=R===la.DT_DATETIME;eb="";var qb=Fa;qb instanceof e?eb=f.modelToDisplayText(qb,pb):(qb=new e,qb.setPeriod(e.PERIOD_DAY),qb.setWhichPeriod(0));var ub=w.createCtrlInCell(y,T,U,ra);eb&&18<eb.length&&(ub.getJqUi().attr("title",eb),eb=eb.substring(0,18)+"...");ub.setText(eb);ub.setUserObject(Sa);
y=ub.getJqUi();y.css("line-height","28px");y.on("click",function(Ra){Ra=qb;var Ba=sa,Ha=new l;Ha.edit(Ra,pb,Ba);Ha.showDialog()});T=$("<div>");na.background(T,"btn_edit");T.addClass("modeler-designer-filter-item-format-icon");T.appendTo(y);var sa=function(Ra){La.setRelativeDateRange(Ra);La.setDisplayValue(f.modelToDisplayText(Ra,pb));ub.setText(f.modelToDisplayText(Ra,pb));Sa.getCell(4).setValue(Ra);ha.checkFilterValid()}}else eb=new Date,Fa=Fa?parseInt(Fa):null,isNaN(Fa)||null==Fa?(La=Sa.getUserObject(),
La.setValue(eb.getTime())):eb.setTime(Fa),y=w.createCtrlInCell(y,T,U,R===la.DT_DATETIME?O:h),y.setDateObject(eb),y.setUserObject(Sa),y.addModelChangedListener(V);else if(R===la.DT_BOOLEAN)y=w.createCtrlInCell(y,T,U,c),y.setSelected(Fa),y.setItemModels([la.BOOLEAN_TRUE,la.BOOLEAN_FALSE]),y.setUserObject(Sa),y.setCustomPainter(function(Ra,Ba,Ha){Ra=Ha===la.BOOLEAN_TRUE?K.get("dataTypeTrue","\u771f"):Ha===la.BOOLEAN_FALSE?K.get("dataTypeFalse","\u5047"):"";Ba.text(Ra)}),y.addSelectedChangedListener(Ka);
else if(Ia){db=[];for(nb in wa)db=db.concat(nb);y=w.createCtrlInCell(y,T,U,c);y.setSelected(Fa);y.setItemModels(db);y.setUserObject(Sa);y.setCustomPainter(function(Ra,Ba,Ha){Ba.text(wa[Ha])});y.addSelectedChangedListener(Ka)}}else y=$("<div>"),T=La.getDisplayValue(!1),y.text(T),y.attr("title",T),y.addClass("modeler-designer-common-table-cell-not-editable"),y.appendTo(eb)},V=function(y){var T=""+y.getDateObject().getTime();y=y.getUserObject();y.getUserObject().setValue(T);y.getCell(4).setValue(T);
ha.checkFilterValid()},Ka=function(y,T,U){y=y.getUserObject();y.getUserObject().setValue(U);y.getCell(4).setValue(U);ha.checkFilterValid()},Qa=function(y){var T=y?y.getOutputDataType():null;return y&&y.isMulBaseData()?!0:T?(y=y?y.isEnum():!1,(T===la.DT_STRING||T===la.DT_NUMBER||T===la.DT_INT)&&!y):!1},ea=function(y,T){var U=K.get("enterSplit","\u7cbe\u786e\u5339\u914d\u591a\u503c\uff0c\u5404\u9879\u4e4b\u95f4\u4f7f\u7528\u56de\u8f66\u4f5c\u4e3a\u5206\u9694\u7b26"),Fa=y.getCompareOp()===m.COMPARE_IN?
K.get("compareIn","\u5728......\u4e4b\u5185"):K.get("compareNotIn","\u4e0d\u5728......\u4e4b\u5185"),Sa=JSON.parse(y.getValue());Sa=Sa?Sa.join("\n"):"";var La=new E;La.setCaption(Fa,U);La.setClosingChecker(function(eb){if(eb&&5E4<eb.length)return K.get("matchTooLong","\u5339\u914d\u9879\u4e0d\u80fd\u8d85\u8fc750000\u4e2a\u5b57\u7b26")});La.setText(Sa,function(eb,ta){eb&&P(T,y,ta)});La.showDialogLeftAnchorTo(T.getJqUi())},P=function(y,T,U){null!=U&&y.setModel(U.replace(/(\s*\n\s*)+/g,","));if(null==
U||T.getValue()!==JSON.stringify(U.split("\n"))){y=y.getUserObject();if(null!=U&&""!==U){U=JSON.parse(JSON.stringify(U.split("\n")));var Fa=[];U&&U.forEach(function(Sa){""!==Sa.trim()&&Fa.push($.trim(Sa))});U=JSON.stringify(Fa);T.setValue(U);y.getCell(4).setValue(U)}else T.setValue(null),y.getCell(4).setValue(null);ha.checkFilterValid()}},da=function(y,T,U,Fa,Sa){var La=new A;La.setGlobal(S);La.setTableFieldMap($a);y=w.createCtrlInCell(y,T,U,b);y.setSelectedModel(Fa);y.setUserObject(Sa);y.setDropdownCreator(function(eb,
ta,Pa){return La.createJqPopup(eb,ta,Pa)});y.addSelectionListener(function(eb){var ta=eb.getSelectedModel();if(ta){eb=eb.getUserObject();var Pa=eb.getUserObject(),R=Pa.getField(),wa=R?R.getOutputDataType():"",Ia=ta?ta.getOutputDataType():"";Pa.setField(ta);eb.getCell(2).setValue(ta);if(wa!==Ia||R.getEnumValue()!==ta.getEnumValue()){R=Pa.getCompareOp();ta=ta?ta.isEnum():!1;ta=m.getSelectableCompares(Ia,ta);Ia=!1;for(wa=0;wa<ta.length;wa++)if(R===ta[wa]){Ia=!0;break}Ia||(R=m.COMPARE_EQUAL);Pa.setCompareOp(R);
Ea(eb.getCell(3),R);Pa.setValue(null);Ea(eb.getCell(4)," ")}ha.checkFilterValid()}});y.setCustomPainter(function(eb,ta){if(eb){var Pa=eb.getTableId();Pa=S.getModelerModel().getTable(Pa);eb=I.TableNameHelper.getDisplayText(Pa)+"."+eb.getAlias();ta.text(eb)}})},pa=function(y,T,U,Fa,Sa,La){y=w.createCtrlInCell(y,T,U,c);y.setSelected(Sa);y.setItemModels([0,1,2,3,4]);y.setUserObject(La);y.setCustomPainter(function(eb,ta,Pa){eb=Fa?"(":")";for(var R="",wa=0;wa<Pa;wa++)R+=eb;ta.text(R)});y.addSelectedChangedListener(Fa?
Va:cb)},Va=function(y,T,U){y=y.getUserObject();y.getUserObject().setLeftBracketCount(U);y.getCell(1).setValue(U);ha.checkFilterValid()},cb=function(y,T,U){y=y.getUserObject();y.getUserObject().setRightBracketCount(U);y.getCell(5).setValue(U);ha.checkFilterValid()}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&
(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.metricdesigner&&(com.kingdee.bos.qing.modeler.designer.metricdesigner={});var I=com.kingdee.bos.qing.modeler.designer.metricdesigner;I.MetricCardArea=function(){var k,l,p,E,A,B,Y={};this.getJqUi=function(){if(!k){k=$("<div>");k.addClass("modeler-designer-common-border");k.css("overflow","hidden");var oa=$("<div>");
oa.appendTo(k);J.layoutCtrlWithLRTB(oa,0,0,null,8,null,23);var W=$("<div>");W.appendTo(oa);J.layoutCtrl(W,30,null,null,null);J.layoutCtrlMiddleAlign(W,20);W.css("border-left","3px solid #5582f3");W=$("<div>");W.text(K.get("metric","\u6307\u6807"));J.layoutCtrl(W,40,null,200,null);J.layoutCtrlMiddleAlign(W,16);W.appendTo(oa);W.css({"font-weight":"bold",color:"#666"});S();l=$("<div>");l.addClass("metric-card-area-container");l.appendTo(k);J.layoutCtrlWithLRTB(l,14,0,null,70,0,null);ca();I.MetricStateMonitor.addStateChangeListener(ha)}return k};
this.setGlobal=function(oa){B=oa};this.setModelerModel=function(oa){A&&A.removePropertyChangeCallback($a);A=oa;A.addPropertyChangeCallback($a);E.hide();p.hide();ca()};var ha=function(oa){for(var W=Object.keys(Y),Ta=0;Ta<W.length;Ta++){var Ca=W[Ta];Y[Ca].setValidPrompt(oa[Ca])}},S=function(){E=$("<div>");E.addClass("metric-card-create-metric");var oa=$("<span>"),W=$("<span>");na.background(W,"createDim");W.css({position:"absolute",width:"16px",height:"16px"});var Ta=$("<span>"),Ca=K.get("createMetric",
"\u65b0\u5efa\u6307\u6807");Ta.text(Ca);Ta.css({"margin-left":"18px"});Ta.attr("title",Ca);oa.append(W);oa.append(Ta);oa.css({color:"var(--color-main, #5582f3)","font-size":"12px",cursor:"pointer","margin-right":"15px"});oa.on("mouseenter",function(){na.background(W,"createDim_hover")});oa.on("mouseleave",function(){na.background(W,"createDim")});oa.on("click",Ja);E.append(oa);E.appendTo(k);E.hide()},Ja=function(){var oa=new Ua;oa.setGlobal(B);oa.setNoDataContainer(p);oa.setAddMetricBtn(E);oa.showDialog()},
ca=function(){Y={};l.empty();var oa=B.getModelerModel().getAllMetric();if(0===oa.length){if(!p){p=$("<div>");J.layoutCtrlCenterAlign(p,260);J.layoutCtrlMiddleAlign(p,160);p.css({"line-height":"12px"});oa=$("<div>");J.layoutCtrlCenterAlign(oa,261);J.layoutCtrl(oa,null,0,null,161);na.background(oa,"add_metric");oa.on("click",Ja);var W=$("<div>");W.css({display:"inline-block",width:"12px",height:"12px"});na.background(W,"add_metric_plug_sign");var Ta=$("<div>");J.makeTextOmissible(Ta);Ta.css({display:"inline-block",
color:"#ffffff","font-size":"14px","margin-left":"8px","max-width":"85px"});Ta.text(K.get("addMetric","\u6dfb\u52a0\u6307\u6807"));var Ca=$("<div>");Ca.css({position:"absolute",left:"50%",transform:"translateX(-50%)",top:"120px"});Ca.append(W);Ca.append(Ta);oa.append(Ca);p.append(oa);k.append(p)}p.show()}else{for(W=0;W<oa.length;W++)Ga(oa[W]);E.show()}},Ga=function(oa){var W=new ya;W.setGlobal(B);W.setMetric(oa);W.setNoDataContainer(p);W.setAddMetricBtn(E);W.setValidPrompt(I.MetricStateMonitor.getInvalidPrompt(oa.getId()));
l.prepend(W.getJqUi());Y[oa.getId()]=W},$a=function(oa,W){if(oa===u.KEY_ADD_METRIC)Ga(W);else if(oa===u.KEY_REMOVE_METRIC)(oa=Y[W.getId()])&&oa.getJqUi().remove(),delete Y[W.getId()];else if(oa===u.KEY_UPDATE_METRIC||oa===u.KEY_SET_METRIC_FILTER)oa=Y[W.getId()],oa.setMetric(W),oa&&oa.updateUi();E.hide();p.hide();ca()}};I.AbstractNumberCheck=function(){this.isNumberExist=function(k,l,p,E,A){throw Error("override me");};this.getNumberByPrefix=function(k,l,p,E){throw Error("override me");}};var K,J,
X,Z,ra,N,g,ka,C,ia,M,la,na,xa,za,aa,Aa,ua,fa,u,F,Q,r,w,L,n,t,a,c,m,b,d,h,O,f,e,z,H,D,G,q,v;(function(){var k=com.kingdee.bos.qing.framework.common;K=k.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.modeler.designer);k=com.kingdee.bos.qing.common;J=k.DomUtil;e=k.RelativePeriodModel;k=com.kingdee.bos.qing.common.ui;X=k.NumberFormatSettingPanel;Z=k.NumberFormatModel;w=k.TableUtil;a=k.CommonIconUtil;f=k.RelativePeriodPanel;k=com.kingdee.bos.qing.ui.component;ra=k.Label;N=k.TextField;
g=k.TextArea;ka=k.AbstractModalDialog;C=k.TabContainer;ia=k.List;F=k.MessageDialog;Q=k.SearchBox;t=k.Button;c=k.ComboBox;b=k.DropdownSelector;d=k.F7Selector;h=k.DateSelector;O=k.DateTimeSelector;k=com.kingdee.bos.qing.modeler.designer;M=k.DesignerFacade;la=k.Field;na=k.Icons;xa=k.UIDHelper;m=k.FilterItem;L=k.FilterCheckHelper;n=k.NoDataView;H=k.QingModeler;v=k.UserOperationReporter;k=com.kingdee.bos.qing.modeler.designer.metricdesigner;z=k.ChangeMetricFilterAction;k=com.kingdee.bos.qing.modeler;q=
k.SpecialWordChecker;za=I.ExprPane;aa=I.Metric;Aa=I.AddMetricAction;ua=I.EditMetricAction;fa=I.DeleteMetricAction;u=I.MetricModeler;r=I.MetricsCalculateDialog;D=I.ModelerValidity;G=I.ModelerChecker})();I.MetricNumberHelper=new function(){var k;this.setInstance=function(l){k=l};this.isImplExist=function(){return k?!0:!1};this.isNumberExist=function(l,p,E,A,B){k?k.isNumberExist(l,p,E,A,B):E&&E()};this.getNumberByPrefix=function(l,p,E,A){k?k.getNumberByPrefix(l,p,E,A):p&&p()}}})();(function(){function qa(){var M,la,na,xa,za,aa,Aa,ua,fa,u,F;this.setGlobal=function(a){na=a};this.getJqUi=function(){M||(M=$("<div>"),Q(),aa=new K,aa.setGlobal(na),Aa=new I,Aa.setGlobal(na),r());return M};this.updateModelerModel=function(){M&&(la&&la.removePropertyChangeCallback(t),la=na.getModelerModel(),la.addPropertyChangeCallback(t),Ya.init(la,Ya.METRIC_SCENE),xa.setModelerModel(la),za.setModelerModel(la),Aa.setModelerModel(la),aa.setModelerModel(la),w())};this.resize=function(){n();ua&&ua.resize()};
this.showDialogIfNoTable=function(){xa&&xa.showDialogIfNoTable()};var Q=function(){xa=new Da;xa.setGlobal(na);xa.setTableChangeCallback(function(a){za&&za.setTable(a)});xa.setExceptionTableChangeCallback(function(a,c){za&&za.setExceptionTable(a,c)});za=new va;za.setGlobal(na)},r=function(){fa=new g;fa.setHorizontalSplit(!1);fa.setSplitLineWide(8);fa.setResizeMode(g.RESIZE_MODE_SECOND_FIXED);fa.setSecondSize(-1,60,-1);fa.setFirstChild(g.createChildWrapper(xa.getJqUi()));fa.setSecondChild(g.createChildWrapper(za.getJqUi()));
n();u=new g;u.setHorizontalSplit(!0);u.setSplitLineWide(8);u.setResizeMode(g.RESIZE_MODE_SECOND_FIXED);u.setFirstSize(-1,120,-1);u.setSecondSize(350,280,450);u.setFirstChild(g.createChildWrapper(Aa.getJqUi()));u.setSecondChild(g.createChildWrapper(aa.getJqUi(),function(){aa.afterResize()}));ua=new g;ua.setHorizontalSplit(!0);ua.setSplitLineWide(8);ua.setResizeMode(g.RESIZE_MODE_FIRST_FIXED);ua.setFirstSize(206,100,450);ua.setSecondSize(-1,600,-1);ua.setFirstChild(fa);ua.setSecondChild(u);M=ua.getJqUi();
M.addClass("modeler-designer-main")},w=function(){if(la){var a=la.getAllTable(!0);a=!a||0==a.length;L!=a&&(L=a,n(),fa.collapseSecondHalf(a));if(a){if(!F){F=$("<div>");a=$("<div>");ra.layoutCtrlCenterAlign(a,210);ra.layoutCtrlMiddleAlign(a,170);var c=$("<div>");ra.layoutCtrlCenterAlign(c,212);ra.layoutCtrl(c,null,0,null,172);Z.background(c,"no_metric");a.append(c);a.appendTo(F);F.css({background:"#f7f7f7","z-index":1E3});ra.layoutCtrlWithLRTB(F,0,0,null,0,0,null);F.appendTo(u.getJqUi())}F.show()}else F&&
F.hide()}},L=!1,n=function(){L?(fa.setFirstSize(360,60,-1),fa.setSplitLineWide(0)):(fa.setFirstSize(360,60,Math.max(60,.382*M[0].clientHeight)),fa.setSplitLineWide(8))},t=function(a,c){a!=Ma.KEY_ADD_TABLE&&a!=Ma.KEY_REMOVE_TABLE||w()}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler=
{});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.metricdesigner&&(com.kingdee.bos.qing.modeler.designer.metricdesigner={});var Ua=com.kingdee.bos.qing.modeler.designer.metricdesigner;Ua.Designer=function(){Oa.call(this);var M=this,la=this.protectedMethod,na=new X,xa,za,aa;this.setNumberChecker=function(u){Ua.MetricNumberHelper.setInstance(u)};this.getMetricName=function(u){var F=za.getMetric(u);
return F?F.getName():u};this.protectedInit=function(){xa=new qa;xa.setGlobal(la.getGlobal());xa.getJqUi().appendTo(la.getMainUi());Ua.ExprRefHelper.setGlobal(la.getGlobal());na.setGlobal(la.getGlobal());na.init(la.getGlobal().getModelerModel());la.addUndoRedoBtn();la.addToolbarButton(Aa,"btn_preview",N.get("trialExecution","\u8bd5\u6267\u884c"));la.addMaterializedConfigBtn()};this.protectedResize=function(){xa&&xa.resize()};this.protectedGetModelerModel=function(){za||(za=new ya,na.init(za));return za};
this.protectedUpdateModelerModel=function(u){fa(u)};this.setJsonModel=function(u){if(u){var F=new ib;F.fromJsonObject(u);fa(F.getModelerModel())}else fa(new ya);la.getGlobal().getCommandManager().reset();M.clearDirty();xa.showDialogIfNoTable()};this.setJsonValidity=function(u,F){na&&na.setGlobalCheckResult(u,!1,F)};var Aa=function(){aa||(aa=new ia,aa.setPreviewPartlyDataMode(!1,1E3,100,!1));ua()},ua=function(){var u=new C;u.setTitle(N.get("trialExecution","\u8bd5\u6267\u884c"));u.isCreatePreviewAllBtn(!0);
u.setOriginExtractCount(aa.getExtractCount());u.setOriginPreviewCount(aa.getPreviewCount());u.setAllData(aa.isExtractAllData());u.setAllDataPreview(aa.isPreviewAllData());u.setConfirmCallback(function(F,Q,r,w){aa.setPreviewPartlyDataMode(F,Q,r,w);F=new J;F.setTrialExecutionConfig(aa);F.setJsonQingModeler(M.getJsonModel());F.setGlobal(la.getGlobal());F.showMetricDialog();ka.occur(ka.BUTTON_TYPE,ka.MODEL_PREVIEW)});u.showDialog()},fa=function(u){za&&za.clearPropertyChangeCallback();za=u;xa.updateModelerModel();
na.init(za);u=M.getJsonModel();na&&na.firstBackgroundCheck(u)}};var Oa,ib,Ya,Ma,ya,Da,va,I,K,J,X,Z,ra,N,g,ka,C,ia;(function(){var M=com.kingdee.bos.qing.modeler.designer;Oa=M.AbstractDesigner;ib=M.QingModeler;Ya=M.UIDHelper;Ma=M.ModelerModel;Z=M.Icons;ka=M.UserOperationReporter;C=M.PreviewCountSetDialog;ia=M.PreviewConfig;M=com.kingdee.bos.qing.common;ra=M.DomUtil;ya=Ua.MetricModeler;I=Ua.MetricCardArea;Da=Ua.TableArea;va=Ua.FieldArea;K=Ua.PropertyArea;J=Ua.PreviewDialog;X=Ua.ModelerChecker;M=com.kingdee.bos.qing.framework.common;
N=M.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.modeler.designer);M=com.kingdee.bos.qing.ui.component;g=M.SplitPane})()})();
//qingVersionTag: 20250324