var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(F){var ba=0;return function(){return ba<F.length?{done:!1,value:F[ba++]}:{done:!0}}};$jscomp.arrayIterator=function(F){return{next:$jscomp.arrayIteratorImpl(F)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(F,ba,qa){if(F==Array.prototype||F==Object.prototype)return F;F[ba]=qa.value;return F};$jscomp.getGlobal=function(F){F=["object"==typeof globalThis&&globalThis,F,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var ba=0;ba<F.length;++ba){var qa=F[ba];if(qa&&qa.Math==Math)return qa}throw Error("Cannot find global object");};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(F,ba){var qa=$jscomp.propertyToPolyfillSymbol[ba];if(null==qa)return F[ba];qa=F[qa];return void 0!==qa?qa:F[ba]};
$jscomp.polyfill=function(F,ba,qa,za){ba&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(F,ba,qa,za):$jscomp.polyfillUnisolated(F,ba,qa,za))};$jscomp.polyfillUnisolated=function(F,ba,qa,za){qa=$jscomp.global;F=F.split(".");for(za=0;za<F.length-1;za++){var ha=F[za];if(!(ha in qa))return;qa=qa[ha]}F=F[F.length-1];za=qa[F];ba=ba(za);ba!=za&&null!=ba&&$jscomp.defineProperty(qa,F,{configurable:!0,writable:!0,value:ba})};
$jscomp.polyfillIsolated=function(F,ba,qa,za){var ha=F.split(".");F=1===ha.length;za=ha[0];za=!F&&za in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var Y=0;Y<ha.length-1;Y++){var K=ha[Y];if(!(K in za))return;za=za[K]}ha=ha[ha.length-1];qa=$jscomp.IS_SYMBOL_NATIVE&&"es6"===qa?za[ha]:null;ba=ba(qa);null!=ba&&(F?$jscomp.defineProperty($jscomp.polyfills,ha,{configurable:!0,writable:!0,value:ba}):ba!==qa&&(void 0===$jscomp.propertyToPolyfillSymbol[ha]&&(qa=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[ha]=
$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(ha):$jscomp.POLYFILL_PREFIX+qa+"$"+ha),$jscomp.defineProperty(za,$jscomp.propertyToPolyfillSymbol[ha],{configurable:!0,writable:!0,value:ba})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(F){if(F)return F;var ba=function(Y,K){this.$jscomp$symbol$id_=Y;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:K})};ba.prototype.toString=function(){return this.$jscomp$symbol$id_};var qa="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",za=0,ha=function(Y){if(this instanceof ha)throw new TypeError("Symbol is not a constructor");return new ba(qa+(Y||"")+"_"+za++,Y)};return ha},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(F){if(F)return F;F=Symbol("Symbol.iterator");for(var ba="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),qa=0;qa<ba.length;qa++){var za=$jscomp.global[ba[qa]];"function"===typeof za&&"function"!=typeof za.prototype[F]&&$jscomp.defineProperty(za.prototype,F,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return F},
"es6","es3");$jscomp.iteratorPrototype=function(F){F={next:F};F[Symbol.iterator]=function(){return this};return F};$jscomp.iteratorFromArray=function(F,ba){F instanceof String&&(F+="");var qa=0,za=!1,ha={next:function(){if(!za&&qa<F.length){var Y=qa++;return{value:ba(Y,F[Y]),done:!1}}za=!0;return{done:!0,value:void 0}}};ha[Symbol.iterator]=function(){return ha};return ha};
$jscomp.polyfill("Array.prototype.keys",function(F){return F?F:function(){return $jscomp.iteratorFromArray(this,function(ba){return ba})}},"es6","es3");$jscomp.findInternal=function(F,ba,qa){F instanceof String&&(F=String(F));for(var za=F.length,ha=0;ha<za;ha++){var Y=F[ha];if(ba.call(qa,Y,ha,F))return{i:ha,v:Y}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(F){return F?F:function(ba,qa){return $jscomp.findInternal(this,ba,qa).v}},"es6","es3");
(function(){function F(){var l=this,u,r=[],v=[],h=[],J;this.setType=function(f){u=f};this.getType=function(){return u};this.supportIncrementalMaterialize=function(){return!1};this.protectedIsTableInUse=function(){throw Error("override me");};this.insertSource=function(f,c){for(var a=!1,e=f.getSourceId(),b=0;b<r.length;b++)if(e==r[b].getSourceId()){a=!0;break}a||(r.splice(c,0,f),B(F.KEY_ADD_PREPARED_SOURCE,[f]))};this.batchAddSource=function(f){for(var c=[],a=0;a<f.length;a++){for(var e=!1,b=f[a],
d=b.getSourceId(),g=0;g<r.length;g++)if(d==r[g].getSourceId()){e=!0;break}e||(r.push(b),c.push(b))}B(F.KEY_ADD_PREPARED_SOURCE,c)};this.setSource=function(f,c){r=f;!c&&B(F.KEY_SET_PREPARED_SOURCE,r)};this.removeSource=function(f){var c=r.indexOf(f);return-1<c?(r.splice(c,1),B(F.KEY_REMOVE_PREPARED_SOURCE,[f]),c):-1};this.batchRemoveUserSqlTable=function(f){f=l.getUserSqlTables(f);for(var c=0;c<f.length;c++)l.removeTableIfUseless(f[c])};this.batchRemoveSource=function(f){for(var c=0;c<f.length;c++){var a=
r.indexOf(f[c]);-1<a&&r.splice(a,1)}B(F.KEY_REMOVE_PREPARED_SOURCE,f)};this.getSource=function(f){for(var c=0,a=r.length;c<a;c++)if(r[c].getId()==f)return r[c]};this.getAllSource=function(){return r};this.isSourceUsed=function(f){f=f.getId();for(var c=0,a=v.length;c<a;c++){var e=v[c];if(e.getSourceUid()==f&&l.protectedIsTableInUse(e))return!0}return!1};this.addTable=function(f){for(var c=0,a=v.length;c<a;c++)if(v[c].isSame(f))return;v.push(f);f.addPropertyChangeCallback(B);B(F.KEY_ADD_TABLE,f)};this.updateTable=
function(f,c){for(var a=-1,e=0,b=v.length;e<b;e++)if(v[e].isSame(c)){a=e;break}-1<a&&(v.splice(a,1),v.splice(a,0,f),c.removePropertyChangeCallback(B),f.addPropertyChangeCallback(B))};this.batchAddTable=function(f){for(var c=0;c<f.length;c++)l.addTable(f[c])};this.setTables=function(f){v=f};this.getTable=function(f){for(var c=0,a=v.length;c<a;c++)if(v[c].getUid()==f)return v[c]};this.removeTable=function(f){var c=v.indexOf(f);-1<c&&(v.splice(c,1),f.removePropertyChangeCallback(B),B(F.KEY_REMOVE_TABLE,
f));return c};this.batchRemoveTable=function(f){for(var c=0;c<f.length;c++){var a=f[c];l.removeTable(a);a.removePropertyChangeCallback(B)}};this.insertTable=function(f,c){for(var a=0,e=v.length;a<e;a++)if(v[a].isSame(f))return;v.splice(c,0,f);f.addPropertyChangeCallback(B);B(F.KEY_ADD_TABLE,f)};this.getUserSqlTables=function(f){for(var c=[],a=0,e=v.length;a<e;a++){var b=v[a];b.isUserSql()&&b.getSourceUid()==f&&c.push(b)}return c};this.getAllUserSqlTables=function(){for(var f=[],c=0,a=v.length;c<a;c++)v[c].isUserSql()&&
f.push(v[c]);return f};this.getAllTable=function(f){for(var c=[],a=0,e=v.length;a<e;a++){var b=v[a];f?(l.protectedIsTableInUse(b)||b.isUserSql())&&c.push(b):l.protectedIsTableInUse(b)&&c.push(b)}return c};this.getSameTable=function(f){for(var c=0,a=v.length;c<a;c++)if(v[c].isSame(f))return v[c]};this.isSameTableAndSourceExist=function(f,c,a){for(var e=0;e<v.length;e++){var b=v[e];if(b.getTableName()==c&&b.getNamespace()==a&&l.getSource(b.getSourceUid()).getSourceId()==f)return!0}return!1};this.setMaterializedConfig=
function(f){J=f};this.getMaterializedConfig=function(){return J};this.toJsonObject=function(){var f={};f.type=u;for(var c=[],a=0;a<r.length;a++)c.push(r[a].toJsonObject());f.sources=c;c=[];for(a=0;a<v.length;a++){var e=v[a];(l.protectedIsTableInUse(e)||e.isUserSql())&&c.push(e.toJsonObject())}f.tables=c;J&&(f.materializedConfig=J.toJsonObject());l.protectedToJsonObject(f);return f};this.fromJsonObject=function(f){u=f.type;var c=f.sources;if(c)for(var a=0;a<c.length;a++){var e=c[a],b=new ha;b.fromJsonObject(e);
r.push(b)}if(c=f.tables)for(a=0;a<c.length;a++)e=new qa,e.fromJsonObject(c[a]),e.addPropertyChangeCallback(B),v.push(e);(a=f.materializedConfig)?(J=new D,J.fromJsonObject(a)):J=null;l.protectedFromJsonObject(f)};this.isUserSqlTableInUse=function(f){f=l.getSameTable(f);return l.protectedIsTableInUse(f)};this.protectedToJsonObject=function(f){};this.protectedFromJsonObject=function(f){};this.addPropertyChangeCallback=function(f){h.push(f)};this.removePropertyChangeCallback=function(f){f=h.indexOf(f);
-1<f&&h.splice(f,1)};this.clearPropertyChangeCallback=function(){h=[]};var B=function(f,c){for(var a=0,e=h.length;a<e;a++)h[a](f,c)};this.protectedMethod={firePropertyChangeEvt:B,copy:function(f){f.setType(u);for(var c=[],a=0;a<r.length;a++)c.push(r[a].copy());f.setSource(c,!0);c=[];for(a=0;a<v.length;a++)c.push(v[a].clone());f.setTables(c);J&&f.setMaterializedConfig(J.copy())}}}function ba(){var l=this,u,r,v,h,J,B,f,c,a=[];this.setId=function(b){u=b};this.getId=function(){return u};this.setAlias=
function(b){r=b;h=void 0;e(F.KEY_NODE_CHANGE_ALIAS,l)};this.getAlias=function(){return r};this.setNameIndex=function(b){h=b};this.getNameIndex=function(){return h};this.getX=function(){return J};this.getY=function(){return B};this.getWidth=function(){return f};this.getHeight=function(){return c};this.setPosition=function(b,d){J=b;B=d};this.changePosition=function(b,d){l.setPosition(b,d);e(F.KEY_NODE_CHANGE_POSITION,l)};this.setSize=function(b,d){f=b;c=d};this.setType=function(b){v=b};this.getType=
function(b){return v};this.addPropertyChangeCallback=function(b){a.push(b)};this.removePropertyChangeCallback=function(b){b=a.indexOf(b);-1<b&&a.splice(b,1)};this.toJsonObject=function(){var b={};b.id=u;b.alias=r;b.x=J;b.y=B;b.type=v;h&&(b.nameIndex=h);l.protectedToJson(b);return b};this.fromJsonObject=function(b){u=b.id;r=b.alias;J=b.x;B=b.y;v=b.type;var d=parseInt(b.nameIndex);isNaN(d)||(h=d);l.protectedFromJson(b)};this.protectedToJson=function(b){};this.protectedFromJson=function(b){};var e=function(b,
d){for(var g=0,H=a.length;g<H;g++)a[g](b,d)};this.protectedMethod={firePropertyChangeEvt:function(b){e(b,l)}}}function qa(){var l=this,u,r,v,h,J,B,f,c=[],a=[];this.setUid=function(b){u=b};this.getUid=function(){return u};this.isUserSql=function(){return B?!0:!1};this.getUserSql=function(){return B};this.setUserSql=function(b){B=b};this.setTableName=function(b){r=b};this.getTableName=function(){return r};this.setSourceUid=function(b){v=b};this.getSourceUid=function(){return v};this.setNamespace=function(b){h=
b};this.getNamespace=function(){return h};this.setDisplayName=function(b){J=b};this.getDisplayName=function(){return J};this.setSelectedFields=function(b){f=b;e(F.KEY_TABLE_SELECT_FIELD,l)};this.getSelectedFields=function(){return f};this.setFilterItems=function(b){c=b;e(F.KEY_TABLE_SET_FILTER,l)};this.getFilterItems=function(){return c};this.addPropertyChangeCallback=function(b){a.push(b)};this.removePropertyChangeCallback=function(b){b=a.indexOf(b);-1<b&&a.splice(b,1)};this.isSame=function(b){return v==
b.getSourceUid()&&r==b.getTableName()&&h==b.getNamespace()&&(!l.isUserSql()&&!b.isUserSql()||l.isUserSql()&&b.isUserSql()&&(b=b.getUserSql(),b.getSqlType()==B.getSqlType()&&b.getContent()==B.getContent()))?!0:!1};this.toJsonObject=function(){var b={};b.id=u;b.name=r;b.sourceId=v;b.namespace=h;l.isUserSql()&&(b.userSQL=B.toJsonObject());if(f){for(var d=[],g=0;g<f.length;g++)d.push(f[g].toJsonObject());b.selectedFields=d}if(c){d=[];for(g=0;g<c.length;g++)d.push(c[g].toJsonObject());b.filterItems=d}return b};
this.fromJsonObject=function(b){u=b.id;r=b.name;v=b.sourceId;h=b.namespace;J=b.displayName;b.userSQL&&(B=new za,B.fromJsonObject(b.userSQL));var d=b.selectedFields;if(d){for(var g=[],H=0;H<d.length;H++){var P=new Y;P.fromJsonObject(d[H]);g.push(P)}f=g}if(b=b.filterItems){d=[];for(H=0;H<b.length;H++)g=new m,g.fromJsonObject(b[H]),d.push(g);c=d}};this.clone=function(){var b=new qa;b.setUid(u);b.setTableName(r);b.setNamespace(h);b.setDisplayName(J);b.setSourceUid(v);B&&b.setUserSql(B.copy());var d=[];
if(f){for(var g=0;g<f.length;g++)d.push(f[g].clone());b.setSelectedFields(d)}d=[];for(g=0;g<c.length;g++)d.push(c[g].copy());b.setFilterItems(d);return b};var e=function(b,d){for(var g=0,H=a.length;g<H;g++)a[g](b,d)}}function za(){var l,u;this.getSqlType=function(){return l};this.setSqlType=function(r){l=r};this.setContent=function(r){u=r};this.getContent=function(){return u};this.fromJsonObject=function(r){l=r.type;u=r.content};this.toJsonObject=function(){var r={};r.type=l;r.content=u;return r};
this.copy=function(){var r=new za;r.setSqlType(l);r.setContent(u);return r}}function ha(){var l,u,r,v,h,J;this.setId=function(B){l=B};this.getId=function(){return l};this.getSourceId=function(){return u};this.setSourceId=function(B){u=B};this.setSourceRefId=function(B){r=sId};this.getSourceRefId=function(){return r};this.getName=function(){return v};this.setName=function(B){v=B};this.setSourceType=function(B){h=B};this.getSourceType=function(){return h};this.setModelId=function(B){J=B};this.getModelId=
function(){return J};this.copy=function(){var B=new ha;B.setId(l);B.setSourceId(u);B.setSourceType(h);B.setName(v);B.setSourceType(h);B.setModelId(J);return B};this.toJsonObject=function(){var B={};B.id=l;B.modelSetSourceId=u;B.modelSetSourceRefId=r;B.modelId=J;B.type=h;return B};this.fromJsonObject=function(B){l=B.id;u=B.modelSetSourceId;r=B.modelSetSourceRefId;h=B.type;v=B.name}}function Y(){var l=this,u,r,v,h,J,B,f,c,a,e;this.setTableId=function(d){u=d};this.getTableId=function(){return u};this.setFromNode=
function(d){r=d};this.getSourceNodeId=function(){return r};this.setName=function(d){v=d};this.getName=function(){return v};this.getFullName=function(){return r?r+"_"+v:u+"_"+v};this.setAlias=function(d){h=d};this.getAlias=function(){return h?h:v};this.setDataType=function(d){b(d);J=d};this.getDataType=function(){return J};this.setAppointedDataType=function(d){d&&b(d);B=d==J?null:d};this.getAppointedDataType=function(){return B};this.getOutputDataType=function(){return B?B:J};this.setRoundMode=function(d){c=
d};this.getRoundMode=function(){return c};this.setScale=function(d){f=d};this.getScale=function(){return f};this.getFormat=function(){return a};this.setFormat=function(d){a=d};this.setExtensions=function(d){e=d};this.getEnumValue=function(){return e?e[Y.EXTENSION_BIZ_FIELD_ENUM_KEY]:null};this.isMulBaseData=function(){return e?e[Y.EXTENSION_IS_MUL_BASE_DATA]:!1};this.isPk=function(){return e?e[Y.EXTENSION_IS_PK]:!1};this.isEnum=function(){if(l.isMulBaseData()||l.getOutputDataType()!=Y.DT_STRING)return!1;
var d=l.getEnumValue();return 0==(d?Object.keys(d):[]).length?!1:!0};this.fromJsonObject=function(d){v=d.name;h=d.alias;J=d.dataType;B=d.appointedDataType;r=d.fromNode;void 0!=d.scale&&(f=d.scale);d.roundMode&&(c=d.roundMode);e=d.extensions;d.format&&(a=d.format);d.tableId&&(u=d.tableId)};this.toJsonObject=function(){var d={};d.name=v;d.alias=h;d.dataType=J;d.fromNode=r;B&&(d.appointedDataType=B);void 0!=f&&(d.scale=f);c&&(d.roundMode=c);e&&(d.extensions=e);u&&(d.tableId=u);return d};var b=function(d){if(d!==
Y.DT_STRING&&d!==Y.DT_INT&&d!==Y.DT_NUMBER&&d!==Y.DT_DATE&&d!==Y.DT_DATETIME&&d!==Y.DT_BOOLEAN)throw Error("IllegalArgument: "+d);};this.clone=function(){var d=new Y;d.setName(v);J&&d.setDataType(J);d.setAlias(h);B&&d.setAppointedDataType(B);d.setFromNode(r);void 0!=f&&d.setScale(f);c&&d.setRoundMode(c);d.setExtensions(e);a&&d.setFormat(a);u&&d.setTableId(u);return d};this.equals=function(d){return v==d.getName()&&h==d.getAlias()&&B==d.getAppointedDataType()&&f==d.getScale()&&c==d.getRoundMode()?
!0:!1}}function K(){var l,u,r,v;this.isExtractAllData=function(){return r};this.isPreviewAllData=function(){return v};this.setExtractPartlyData=function(h,J){l=h;u=J};this.setExtractAllDataAndPreviewCount=function(h){l=K.ALL_DATA_NUMBER;u=h};this.getExtractCount=function(){return l};this.setExtractCount=function(h){l=h};this.getPreviewCount=function(){return u};this.setPreviewCount=function(h){u=h};this.setExtractAllData=function(h){r=h};this.setPreviewAllData=function(h){v=h};this.setPreviewPartlyDataMode=
function(h,J,B){l=J;u=B;r=h};this.setPreviewPartlyDataMode=function(h,J,B,f){l=J;u=B;r=h;v=f};this.setPreviewAllDataMode=function(){v=r=!0};this.backup=function(){var h=new K;h.setExtractCount(l);h.setPreviewCount(u);h.setExtractAllData(r);h.setPreviewAllData(v);return h};this.toJsonObject=function(){var h={};h.extractCount=r?K.ALL_DATA_NUMBER:l;h.previewCount=v?K.ALL_DATA_NUMBER:u;return h}}function ja(){var l=this,u,r;this.setId=function(v){u=v};this.getId=function(){return u};this.toJsonObject=
function(){var v={};v.id=u;v.type=r;l.protectedToJson(v);return v};this.protectedToJson=function(v){};this.protectedMethod={setType:function(v){r=v}}}function na(){var l=[],u,r=[];this.isValid=function(){return u};this.getCases=function(){return r};this.getCheckedNodeIds=function(){return l};this.fromJsonObject=function(v){u=v.valid;l=v.nodeIds;if(v=v.cases){r=[];for(var h=new C,J=0;J<v.length;J++){var B=v[J],f=h.getInvalidityCase(B.type);B&&(f.fromJsonObject(B),r.push(f))}}}}function C(){this.getInvalidityCase=
function(l){switch(l){case L.TYPE_MULTI_OUTPUT:return new Z;case L.TYPE_LACK_OUTPUT:return new N;case L.TYPE_INVALID_CONFIG:return new k;case L.TYPE_LACK_INPUT:return new x;case L.TYPE_INVALID_UPWARDNODE:return new q;case L.TYPE_INVALID_SOURCE:return new Q;case L.TYPE_TABLE_NO_FIELD:return new n;case L.TYPE_TABLE_NO_AUTHORITY:return new z}}}function L(){var l,u=this;this.getType=function(){return l};this.fromJsonObject=function(r){l=r.type;u.protectedFromJsonObject(r)};this.protectedFromJsonObject=
function(r){}}function Z(){L.call(this);var l=[];this.protectedFromJsonObject=function(u){l=u.outputNodes};this.getOutputNodeIds=function(){return l}}function N(){L.call(this)}function k(){L.call(this);var l;this.protectedFromJsonObject=function(u){l=u.nodeIds};this.getNodeIds=function(){return l}}function z(){L.call(this);var l;this.protectedFromJsonObject=function(u){l=u.nodeIds};this.getNodeIds=function(){return l}}function x(){L.call(this);var l;this.protectedFromJsonObject=function(u){l=u.nodeIds};
this.getNodeIds=function(){return l}}function q(){L.call(this);var l;this.protectedFromJsonObject=function(u){l=u.nodeIds};this.getNodeIds=function(){return l}}function Q(){L.call(this);var l;this.protectedFromJsonObject=function(u){l=u.nodeIds};this.getNodeIds=function(){return l}}function n(){L.call(this);var l;this.protectedFromJsonObject=function(u){l=u.nodeIds};this.getNodeIds=function(){return l}}function T(){var l,u=[],r=[];this.getField=function(v){return u[v]};this.getAllField=function(){return u};
this.getColumnCount=function(){return u?u.length:0};this.getOneRow=function(v){return r[v]};this.getRowCount=function(){return r?r.length:0};this.getNodeId=function(){return l};this.fromJsonObject=function(v){for(var h=v.fields,J=0;J<h.length;J++){var B=new Y;B.fromJsonObject(h[J]);u.push(B)}r=v.data;l=v.nodeId}}function m(){var l,u,r,v,h=0,J=0,B,f=null;this.setField=function(a){(l=a)&&!a.isMulBaseData()&&u&&r&&(a=a.getOutputDataType(),a!==Y.DT_DATE&&a!==Y.DT_DATETIME||m.REG_DATETIME.test(r)||m.isCompareOpWithinOrNotWithinValue(u)||
(r=(new Date).getTime()));c()};this.updateNotExistFieldByMyself=function(){var a=new Y;a.setFromNode(l.getSourceNodeId());a.setName(l.getName());a.setAlias(l.getAlias());l=a};this.updateNotExistField=function(a){var e=new Y;e.setFromNode(a.getSourceNodeId());e.setName(a.getName());e.setAlias(a.getAlias());l=e};this.getField=function(){return l};this.getTargetFieldFullName=function(){return l?l.getFullName():null};this.setCompareOp=function(a){u=a};this.getCompareOp=function(){return u};this.setValue=
function(a){r=a;c()};this.getValue=function(){return r};this.setDisplayValue=function(a){v=a};this.getDisplayValue=function(a){return v?!a&&m.isCompareOpWithinOrNotWithinValue(u)?JSON.parse(v).join(","):m.isCompareOpRelativeDateRangeValue(u)?(a=l.getOutputDataType()===Y.DT_DATETIME,ca.modelToDisplayText(f,a)):v:""};this.setLeftBracketCount=function(a){h=a};this.getLeftBracketCount=function(){return h};this.setRightBracketCount=function(a){J=a};this.getRightBracketCount=function(){return J};this.setLogicOp=
function(a){B=a};this.getLogicOp=function(){return B};this.setRelativeDateRange=function(a){f=a};this.getRelativeDateRange=function(){return f};this.isEmpty=function(){return 0===h&&0===J&&!l&&!u&&!r&&!B};var c=function(){if(l&&u){var a=l.getOutputDataType();if(r){var e=l.isEnum(),b=l.isMulBaseData(),d=e?l.getEnumValue():null;if(m.isCompareOpWithinOrNotWithinValue(u))if(e){a=JSON.parse(r);e=[];for(b=0;b<a.length;b++){var g=d[a[b]];g&&e.push(g)}v=JSON.stringify(e)}else v=r;else b?v=r:a===Y.DT_DATE||
a===Y.DT_DATETIME?(d=new Date,d.setTime(r),e=new com.kingdee.bos.qing.common.DateFormater,b=e.setFormatString,a=a===Y.DT_DATE?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss",b.call(e,a),v=e.format(d)):a===Y.DT_BOOLEAN?(d=com.kingdee.bos.qing.framework.common.MultilanguageManager.createPackageAccessor(I),v=r===Y.BOOLEAN_TRUE?d.get("dataTypeTrue","\u771f"):r===Y.BOOLEAN_FALSE?d.get("dataTypeFalse","\u5047"):""):v=e?d[r]?d[r]:"":r}else v=m.isCompareOpRelativeDateRangeValue(u)&&null!=f?ca.modelToDisplayText(f,a===
Y.DT_DATETIME):null}};this.copy=function(){var a=new m;a.setField(l);a.setCompareOp(u);a.setValue(r);a.setDisplayValue(v);a.setLeftBracketCount(h);a.setRightBracketCount(J);a.setLogicOp(B);a.setRelativeDateRange(f);return a};this.equals=function(a){if(!a)return!1;var e;if(e=l.equals(a.getField())&&u===a.getCompareOp()&&r===a.getValue()&&h===a.getLeftBracketCount()&&J===a.getRightBracketCount()&&B===a.getLogicOp())e=f||a.getRelativeDateRange()?f&&a.getRelativeDateRange()?JSON.stringify(f.toJsonObject())===
JSON.stringify(a.getRelativeDateRange().toJsonObject()):!1:!0;return e?!0:!1};this.toJsonObject=function(){if(!l)return null;var a={};a.field=l.toJsonObject();a.compareOp=u;a.value=r;a.displayValue=v;a.leftBrackets=h;a.rightBrackets=J;a.logicOp=B;f&&(a.relativeDateRange=f.toJsonObject());return a};this.fromJsonObject=function(a){a&&(l=new Y,l.fromJsonObject(a.field),u=a.compareOp,r=a.value,v=a.displayValue,h=a.leftBrackets,J=a.rightBrackets,B=a.logicOp,a=a.relativeDateRange)&&(f=new aa,f.fromJsonObject(a))}}
function ia(){var l=this,u,r=[];this.getNodeIdInConfig=function(){return[]};this.addPropertyChangeCallback=function(v){r.push(v)};this.toJsonObject=function(){var v={};v.type=u;l.protectedToJsonObject(v);return v};this.fromJsonObject=function(v){u=v.type;l.protectedFromJsonObject(v)};this.protectedToJsonObject=function(v){};this.protectedFromJsonObject=function(v){};this.protectedMethod={firePropertyChangeEvt:function(v){for(var h=0,J=r.length;h<J;h++)r[h](v)},setType:function(v){u=v}}}function X(){ia.call(this);
var l=this,u=this.protectedMethod;u.setType(ia.TYPE_FILTER);var r=[];this.getFilterItems=function(){return r};this.setFilterItems=function(v){r=v};this.copyFilterItems=function(){for(var v=[],h=0;h<r.length;h++)v.push(r[h].copy());return v};this.firePropertyChangeEvt=function(){u.firePropertyChangeEvt(TableModeler.KEY_TRANSFORM_FILTER)};this.getNotEmptyFilterItems=function(){for(var v=[],h=0;h<r.length;h++)r[h].isEmpty()||v.push(r[h]);return v};this.protectedToJsonObject=function(v){for(var h=l.getNotEmptyFilterItems(),
J=[],B=0,f=h.length;B<f;B++)J.push(h[B].toJsonObject());v.filterItems=J};this.protectedFromJsonObject=function(v){if(v){v=v.filterItems;for(var h=0;h<v.length;h++){var J=new m;J.fromJsonObject(v[h]);r.push(J)}}};this.clone=function(){var v=new X;v.setFilterItems(l.getNotEmptyFilterItems());return v}}function D(){var l=D.TYPE_ONCE,u=D.STRATEGY_FULL,r,v;this.setType=function(h){if(h===D.TYPE_ONCE||h===D.TYPE_TIMING)l=h;else throw Error("IllegalArgument: "+h);};this.getType=function(){return l};this.setStrategy=
function(h){if(h===D.STRATEGY_FULL||h===D.STRATEGY_INCREMENTAL)u=h;else throw Error("IllegalArgument: "+h);};this.getStrategy=function(){return u};this.setSchedule=function(h){r=h};this.getSchedule=function(){return r};this.setBasedFields=function(h){v=h};this.getBasedFields=function(){return v};this.copy=function(){var h=new D;h.setType(l);h.setStrategy(u);r&&h.setSchedule(r.copy());if(v){for(var J=[],B=0;B<v.length;B++)J.push(v[B].copy());h.setBasedFields(J)}return h};this.toJsonObject=function(){var h=
{};h.type=l;h.strategy=u;r&&(h.schedule=r.toJsonObject());if(v){for(var J=[],B=0;B<v.length;B++)J.push(v[B].toJsonObject());h.basedFields=J}return h};this.fromJsonObject=function(h){l=h.type;u=h.strategy;h.schedule&&(r=new S,r.fromJsonObject(h.schedule));if(h=h.basedFields){v=[];for(var J=0;J<h.length;J++){var B=new A;B.fromJsonObject(h[J]);v.push(B)}}};this.equals=function(h){if(h instanceof D){if(l!==h.getType()||u!==h.getStrategy())return!1;var J=h.getSchedule();if(r&&!J||!r&&J)return!1;if(r&&
J){var B=r.toJsonObject();J=J.toJsonObject();for(var f in B)if(B[f]!==J[f])return!1}h=h.getBasedFields();if(!v&&!h)return!0;if(!v||!h||v.length!==h.length)return!1;for(B=0;B<v.length;B++)if(!v[B].equals(h[B]))return!1;return!0}return!1}}function A(){var l,u,r,v;this.setTableId=function(h){l=h};this.getTableId=function(){return l};this.setTableName=function(h){u=h};this.getTableName=function(){return u};this.setName=function(h){r=h};this.getName=function(){return r};this.setAlias=function(h){v=h};
this.getAlias=function(){return v};this.copy=function(){var h=new A;h.setTableId(l);h.setTableName(u);h.setName(r);h.setAlias(v);return h};this.toJsonObject=function(){var h={};h.tableId=l;h.tableName=u;h.name=r;h.alias=v;return h};this.fromJsonObject=function(h){l=h.tableId;u=h.tableName;r=h.name;v=h.alias};this.equals=function(h){return h instanceof A?l===h.getTableId()&&u===h.getTableName()&&r===h.getName()&&v===h.getAlias():!1}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&
(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var I=com.kingdee.bos.qing.modeler.designer;I.QingModeler=function(){var l;this.setModelerModel=function(u){l=u};this.getModelerModel=function(){return l};this.toJsonObject=
function(){var u={};u.modelerModel=l.toJsonObject();return u};this.fromJsonObject=function(u){(u=u.modelerModel)&&(l=I.ModelerModerParser.parseToModel(u.type,u))}};I.AbstractModelerModelParser=function(){this.parseToModel=function(l){throw Error("override me");}};I.ModelerModel=F;I.AbstractPage=function(){function l(B,f,c,a){this.getLeftExtension=function(){return B};this.getTopExtension=function(){return f};this.getHorizonExtension=function(){return B+c};this.getVerticalExtension=function(){return f+
a}}var u=this,r=1024,v=768,h=[];this.getWidth=function(){return r};this.getHeight=function(){return v};this.addPropertyChangeCallback=function(B){h.push(B)};this.setExtension=function(B,f,c,a){B=new l(B,f,c,a);r+=B.getHorizonExtension();v+=B.getVerticalExtension();J(F.KEY_PAGE_SIZE,B)};this.toJsonObject=function(){var B={};B.width=r;B.height=v;u.protectedToJsonObject(B);return B};this.fromJsonObject=function(B){r=B.width;v=B.height;u.protectedFromJsonObject(B)};this.protectedToJsonObject=function(B){};
this.protectedFromJsonObject=function(B){};var J=function(B,f){for(var c=0,a=h.length;c<a;c++)h[c](B,f)};this.protectedMethod={firePropertyChangeEvt:J}};I.Node=ba;I.Table=qa;I.DesignTimeSource=ha;I.Field=Y;I.UserSQL=za;I.PreviewConfig=K;I.RuntimeModel=function(){var l,u=[],r=[],v;this.setOutputVertexId=function(h){l=h};this.addEdge=function(h){u.push(h)};this.addVertex=function(h){r.push(h)};this.getVertexes=function(){return r};this.setPreviewConfig=function(h){v=h};this.toJsonObject=function(){for(var h=
{},J=[],B=[],f=0,c=u.length;f<c;f++)J.push(u[f].toJsonObject());f=0;for(c=r.length;f<c;f++)B.push(r[f].toJsonObject());h.edges=J;h.vertexes=B;h.outputVertexId=l;h.previewConfig=v?v.toJsonObject():null;return h}};I.Edge=function(l,u){this.toJsonObject=function(){var r={};r.fromId=l;r.toId=u;return r}};I.SourceVertex=function(){ja.call(this);var l,u,r;this.protectedMethod.setType(ja.TYPE_SOURCE);this.setTable=function(v){l=v};this.setSource=function(v){u=v};this.setSelectedFields=function(v){r=v};this.protectedToJson=
function(v){v.table=l.toJsonObject();v.source=u.toJsonObject();if(r){for(var h=[],J=0;J<r.length;J++)h.push(r[J].toJsonObject());v.selectedFields=h}}};I.ExecuteResult=function(){var l,u=[],r,v;this.getNodeId=function(){return l};this.getValidity=function(){return v};this.getPreviewData=function(){return r};this.getFields=function(){return u};this.fromJsonObject=function(h){l=h.nodeId;var J=h.validity;J&&(v=new na,v.fromJsonObject(J));if(J=h.previewData)r=new T,r.fromJsonObject(J);if(h=h.fields)for(J=
0;J<h.length;J++){var B=h[J],f=new Y;f.fromJsonObject(B);u.push(f)}}};I.PreviewData=T;I.PreviewResult=function(){var l,u,r,v,h;this.getPreviewData=function(){return l};this.getTotalRowCount=function(){return r};this.getJobId=function(){return v};this.getJobName=function(){return h};this.getModelerValidity=function(){return u};this.fromJsonObject=function(J){J.modelerValidity?u=J.modelerValidity:(l=new T,l.fromJsonObject(J.previewData),v=J.jobId,h=J.jobName,r=J.totalRowCount)}};I.FilterItem=m;I.MaterializedConfig=
D;I.BasedField=A;I.FilterConfig=X;var aa,ca,S;(function(){var l=com.kingdee.bos.qing.common;aa=l.RelativePeriodModel;l=com.kingdee.bos.qing.common.ui;ca=l.RelativePeriodPanel;l=com.kingdee.bos.qing.schedule;S=l.QingSchedule})();I.ModelerModerParser=new function(){var l={};this.registerParser=function(u,r){l[u]=r};this.parseToModel=function(u,r){return(u=l[u])&&u.parseToModel(r)}};F.TYPE_TABLE_MODELER="table";F.TYPE_RELATION_MODELER="relation";F.TYPE_METRIC_MODELER="metric";F.KEY_UPDATE_TABLE="update_table";
F.KEY_ADD_TABLE="add_table";F.KEY_REMOVE_TABLE="remove_table";F.KEY_TABLE_SELECT_FIELD="table_select_field";F.KEY_TABLE_SET_FILTER="table_set_filter";F.KEY_PAGE_SIZE="page_change_size";F.KEY_ADD_PREPARED_SOURCE="add_prepared_source";F.KEY_REMOVE_PREPARED_SOURCE="remove_prepared_source";F.KEY_SET_PREPARED_SOURCE="set_prepared_source";F.KEY_NODE_CHANGE_ALIAS="node_change_alias";F.KEY_NODE_CHANGE_POSITION="node_change_position";F.KEY_TABLE_NODE_SELECT_FIELD="table_node_select_field";ba.TYPE_TABLE="table";
ba.TYPE_TRANSFORM="transform";Y.DT_BOOLEAN="BOOLEAN";Y.DT_INT="INT";Y.DT_NUMBER="NUMBER";Y.DT_DATE="DATE";Y.DT_DATETIME="DATETIME";Y.DT_STRING="STRING";Y.ROUND_MODE_UP="ROUND_UP";Y.ROUND_MODE_DOWN="ROUND_DOWN";Y.ROUND_MODE_HALF_UP="ROUND_HALF_UP";Y.BOOLEAN_TRUE="true";Y.BOOLEAN_FALSE="false";Y.EXTENSION_BIZ_FIELD_ENUM_KEY="bizFieldEnumKey";Y.EXTENSION_IS_MUL_BASE_DATA="isMulBaseData";Y.EXTENSION_IS_PK="isPK";I.UIDHelper=new function(){var l,u={};this.init=function(b,d){u={};l=b;d&I.UIDHelper.SUPPORT_TYPE_NODE&&
f();d&I.UIDHelper.SUPPORT_TYPE_SOURCE&&c();d&I.UIDHelper.SUPPORT_TYPE_TABLE&&a();d&I.UIDHelper.SUPPORT_TYPE_LINE&&e();d&I.UIDHelper.SUPPORT_TYPE_DIMENSION&&v();d&I.UIDHelper.SUPPORT_TYPE_PUBLIC_DIMENSION&&h();d&I.UIDHelper.SUPPORT_TYPE_METRIC&&J();d&I.UIDHelper.SUPPORT_TYPE_REFERENCE&&B()};this.getUID=function(b){var d=u[b];d||(d=0);d+=1;u[b]=d;return b+d};var r=function(b,d,g){for(var H=0,P=0;P<d.length;P++)for(var fa=g(d[P]),pa=0;pa<fa.length;pa++){var R=fa[pa];H=Math.max(H,parseInt(R.slice(b.length,
R.length)))}u[b]=H},v=function(){var b=l.getAllDimension();b&&r(I.UIDHelper.NS_DIMENSION,b,function(d){return[d.getDimensionId()]})},h=function(){var b=l.getPublicDimensions();b&&r(I.UIDHelper.NS_PUBLIC_DIMENSION,b,function(d){return[d.getId()]});(b=l.getAllDimension())&&r(I.UIDHelper.NS_PUBLIC_DIMENSION,b,function(d){return[d.getPublicDimensionId()]})},J=function(){var b=l.getAllMetric();b&&r(I.UIDHelper.NS_METRIC,b,function(d){return[d.getId()]})},B=function(){var b=l.getExprReferences();b&&r(I.UIDHelper.NS_REFERENCE,
b,function(d){return[d.getId()]})},f=function(){var b=l.getAllNodes();b&&r(I.UIDHelper.NS_NODE,b,function(d){var g=[];g.push(d.getId());d.getType()==ba.TYPE_TRANSFORM&&(d=d.getNodeIdInConfig(),g=g.concat(d));return g})},c=function(){var b=l.getAllSource();b&&r(I.UIDHelper.NS_SOURCE,b,function(d){return[d.getId()]})},a=function(){var b=l.getAllTable();b&&r(I.UIDHelper.NS_TABLE,b,function(d){return[d.getUid()]})},e=function(){var b=l.getAllLines();b&&r(I.UIDHelper.NS_LINE,b,function(d){return[d.getId()]})}};
I.UIDHelper.NS_NODE="n";I.UIDHelper.NS_LINE="l";I.UIDHelper.NS_TABLE="t";I.UIDHelper.NS_SOURCE="s";I.UIDHelper.NS_DIMENSION="d";I.UIDHelper.NS_PUBLIC_DIMENSION="pd";I.UIDHelper.NS_METRIC="m";I.UIDHelper.NS_REFERENCE="r";I.UIDHelper.SUPPORT_TYPE_NODE=1;I.UIDHelper.SUPPORT_TYPE_LINE=2;I.UIDHelper.SUPPORT_TYPE_TABLE=4;I.UIDHelper.SUPPORT_TYPE_SOURCE=8;I.UIDHelper.SUPPORT_TYPE_DIMENSION=16;I.UIDHelper.SUPPORT_TYPE_PUBLIC_DIMENSION=32;I.UIDHelper.SUPPORT_TYPE_METRIC=64;I.UIDHelper.SUPPORT_TYPE_REFERENCE=
128;I.UIDHelper.METRIC_SCENE=I.UIDHelper.SUPPORT_TYPE_TABLE|I.UIDHelper.SUPPORT_TYPE_SOURCE|I.UIDHelper.SUPPORT_TYPE_DIMENSION|I.UIDHelper.SUPPORT_TYPE_PUBLIC_DIMENSION|I.UIDHelper.SUPPORT_TYPE_METRIC|I.UIDHelper.SUPPORT_TYPE_REFERENCE;K.ALL_DATA_NUMBER=-1;ja.TYPE_SOURCE="source";ja.TYPE_TRANSFORM_FIELD_SELECT="field_select";ja.TYPE_TRANSFORM_FIELD_SETTING="field_setting";ja.TYPE_TRANSFORM_GROUP_BY="group_by";ja.TYPE_TRANSFORM_FILTER="filter";ja.TYPE_TRANSFORM_SORT="sort";ja.TYPE_TRANSFORM_JOIN="join";
L.TYPE_MULTI_OUTPUT="multiOutput";L.TYPE_LACK_OUTPUT="lackOutputNode";L.TYPE_INVALID_CONFIG="invalidConfig";L.TYPE_LACK_INPUT="lackInputNode";L.TYPE_INVALID_UPWARDNODE="invalidUpwardNode";L.TYPE_INVALID_SOURCE="invalidSource";L.TYPE_TABLE_NO_FIELD="tableNoField";L.TYPE_TABLE_NO_AUTHORITY="tableNoAuthority";m.REG_NUMBER=/^-?\d+(\.\d+)?$/;m.REG_DATETIME=/^-?\d+(\.\d+)?$/;m.COMPARE_EQUAL="EQUAL";m.COMPARE_NOT_EQUAL="NOT_EQUAL";m.COMPARE_GREATER="GREATER";m.COMPARE_GREATER_EQUAL="GREATER_EQUAL";m.COMPARE_LESS=
"LESS";m.COMPARE_LESS_EQUAL="LESS_EQUAL";m.COMPARE_INCLUDE="INCLUDE";m.COMPARE_NOT_INCLUDE="NOT_INCLUDE";m.COMPARE_START_WITH="START_WITH";m.COMPARE_END_WITH="END_WITH";m.COMPARE_NULL="NULL";m.COMPARE_NOT_NULL="NOT_NULL";m.COMPARE_IN="IN";m.COMPARE_NOT_IN="NOT_IN";m.COMPARE_RELATIVE_DATE_RANGE="RELATIVE_DATE_RANGE";m.LOGIC_AND="AND";m.LOGIC_OR="OR";m.COMPARES_FOR_STRING=[m.COMPARE_EQUAL,m.COMPARE_NOT_EQUAL,m.COMPARE_INCLUDE,m.COMPARE_NOT_INCLUDE,m.COMPARE_START_WITH,m.COMPARE_END_WITH,m.COMPARE_NULL,
m.COMPARE_NOT_NULL,m.COMPARE_IN,m.COMPARE_NOT_IN];m.COMPARES_FOR_ENUM=[m.COMPARE_EQUAL,m.COMPARE_NOT_EQUAL,m.COMPARE_NULL,m.COMPARE_NOT_NULL,m.COMPARE_IN,m.COMPARE_NOT_IN];m.COMPARES_FOR_NUMBER=[m.COMPARE_EQUAL,m.COMPARE_NOT_EQUAL,m.COMPARE_GREATER,m.COMPARE_GREATER_EQUAL,m.COMPARE_LESS,m.COMPARE_LESS_EQUAL,m.COMPARE_NULL,m.COMPARE_NOT_NULL,m.COMPARE_IN,m.COMPARE_NOT_IN];m.COMPARES_FOR_DATETIME=[m.COMPARE_RELATIVE_DATE_RANGE,m.COMPARE_EQUAL,m.COMPARE_NOT_EQUAL,m.COMPARE_GREATER,m.COMPARE_GREATER_EQUAL,
m.COMPARE_LESS,m.COMPARE_LESS_EQUAL,m.COMPARE_NULL,m.COMPARE_NOT_NULL];m.COMPARES_FOR_BOOLEAN=[m.COMPARE_EQUAL,m.COMPARE_NOT_EQUAL,m.COMPARE_NULL,m.COMPARE_NOT_NULL];m.isCompareOpWithoutValue=function(l){return l===m.COMPARE_NULL||l===m.COMPARE_NOT_NULL};m.isCompareOpWithinOrNotWithinValue=function(l){return l===m.COMPARE_IN||l===m.COMPARE_NOT_IN};m.isCompareOpRelativeDateRangeValue=function(l){return l===m.COMPARE_RELATIVE_DATE_RANGE};m.getSelectableCompares=function(l,u){switch(l){case Y.DT_STRING:return u?
m.COMPARES_FOR_ENUM:m.COMPARES_FOR_STRING;case Y.DT_NUMBER:case Y.DT_INT:return m.COMPARES_FOR_NUMBER;case Y.DT_DATE:case Y.DT_DATETIME:return m.COMPARES_FOR_DATETIME;case Y.DT_BOOLEAN:return m.COMPARES_FOR_BOOLEAN;default:throw Error("Unknown DataType");}};m.FiltersCheckingResult=function(l,u){var r=u;this.getFiltersErrorRow=function(){return l};this.getPrompt=function(){return r};this.setPrompt=function(v){r=v}};ia.TYPE_FIELD_SELECT="field_select";ia.TYPE_FIELD_SETTING="field_setting";ia.TYPE_FILTER=
"filter";ia.TYPE_SORT="sort";ia.TYPE_GROUP_BY="group_by";ia.TYPE_CALCULATED_FIELD="calculated_field";ia.TYPE_CUSTOM_GROUP="custom_group";ia.TYPE_JOIN="join";ia.TYPE_UNION="union";D.TYPE_ONCE="once";D.TYPE_TIMING="timing";D.STRATEGY_FULL="full";D.STRATEGY_INCREMENTAL="incremental";I.ENTITY_SEPARATOR="@#!&@"})();(function(){function F(){var ha,Y,K,ja,na;this.setFromTable=function(C){ha=C};this.getFromTable=function(){return ha};this.setFromProperty=function(C){K=C};this.getFromProperty=function(){return K};this.setToTable=function(C){Y=C};this.getToTable=function(){return Y};this.setToProperty=function(C){ja=C};this.getToProperty=function(){return ja};this.setRelated=function(C){na=C};this.getRelated=function(){return na};this.fromJsonObject=function(C){ha=C.fromModel;Y=C.toModel;K=C.fromField;ja=C.toField;
na=C.related};this.toJsonObject=function(C){C={};C.fromModel=ha;C.toModel=Y;C.fromField=K;C.toField=ja;C.related=na;return C}}function ba(){var ha=this,Y,K,ja;this.setUid=function(na){Y=na};this.getUid=function(){return Y};this.setId=function(na){ja=na};this.getId=function(){return ja};this.getSourceType=function(){return K};this.fromJsonObject=function(na){Y=na.id;K=na.type;ha.protectedFromJsonObject(na)};this.toJsonObject=function(){var na={};na.type=K;na.id=Y;ha.protectedToJsonObject(na);return na};
this.protectedToJsonObject=function(na){};this.protectedFromJsonObject=function(na){};this.protectedMethod={setSourceType:function(na){K=na}}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer=
{});var qa=com.kingdee.bos.qing.modeler.designer;qa.AbstractModelerSource=ba;qa.ModelSetDataSource=function(){var ha,Y,K,ja,na,C,L;this.getErrorMessage=function(){return L};this.getSpecificType=function(){return C};this.getSourceName=function(){return ha};this.setSourceName=function(Z){ha=Z};this.getId=function(){return Y};this.setId=function(Z){Y=Z};this.setCreatorName=function(Z){K=Z};this.getCreatorName=function(){return K};this.setCreateTime=function(Z){ja=Z};this.getCreateTime=function(){return ja};
this.setSourceType=function(Z){na=Z};this.getSourceType=function(){return na};this.fromJsonObject=function(Z){Y=Z.id;ha=Z.sourceName;na=Z.sourceType;ja=Z.createTime;K=Z.creatorName;var N=Z.source;na===ba.SOURCE_TYPE_PUBLIC_DATA_SOURCE&&"DB"===N.sourceType?C=N.publicSourceType:na===ba.SOURCE_TYPE_MODELSET_DB_SOURCE&&N.dbType?C=N.dbType:na===ba.SOURCE_TYPE_MODELSET_FILE_SOURCE&&N.fileType&&(C=N.fileType);Z.errorMessage&&(L=Z.errorMessage)}};qa.Meta=function(){var ha,Y,K,ja,na;this.setTableNode=function(C){ha=
C};this.getTableNode=function(){return ha};this.setPropertyMap=function(C){Y=C};this.getPropertyMap=function(){return Y};this.setSourceType=function(C){K=C};this.getSourceType=function(){return K};this.setRelations=function(C){ja=C};this.getRelations=function(){return ja};this.setErrorMap=function(C){na=C};this.getErrorMap=function(){return na};this.fromJsonObject=function(C){ha=C.tableNode;if(Y=C.propertiesMap)for(var L in Y){var Z=Y[L];if(Z&&0<Z.length){for(var N=[],k=0;k<Z.length;k++){var z=new za,
x=Z[k];z.fromJsonObject(Z[k]);x.number&&z.setName(x.number);N.push(z)}Y[L]=N}}K=C.sourceType;if((L=C.relations)&&0<L.length)for(ja=[],k=0;k<L.length;k++)Z=new F,Z.fromJsonObject(L[k]),ja.push(Z);na=C.errorMap}};var za=qa.Field;F.R_1_1="From1To1";F.R_1_N="From1ToN";F.R_N_1="FromNTo1";F.KFW_FROM=1;F.KFW_TO=2;F.KEY_FROM_ENTITY="fromEntity";F.KEY_FROM_PROPERTY="fromProperty";F.KEY_FROM_PROPERTY_ALIAS_CHANED="fromPropertyAliasChanged";F.KEY_TO_PROPERTY_ALIAS_CHANED="toPropertyAliasChanged";F.KEY_TO_ENTITY=
"toEntity";F.KEY_TO_PROPERTY="toProperty";F.KEY_RELATED="related";ba.SOURCE_TYPE_PUBLIC_DATA_SOURCE="PublicDBSource";ba.SOURCE_TYPE_CURRENT_ENTITY_SOURCE="ERPCloudEntity";ba.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE="ERPCloudDBCenter";ba.SOURCE_TYPE_MODELSET_FILE_SOURCE="FileSource";ba.SOURCE_TYPE_MODELSET_DB_SOURCE="DBSource";ba.SOURCE_TYPE_MODEL_SET_SOURCE="ModelSet";ba.SOURCE_TYPE_OPEN_API_SOURCE="OpenAPI"})();(function(){function F(){var K,ja,na,C=!1,L,Z,N=!1,k;this.setUid=function(z){Z=z};this.getUid=function(){return Z};this.setId=function(z){k=z};this.getId=function(){return k};this.setCommentInfo=function(z){L=z};this.getCommentInfo=function(){return L};this.setMatch=function(z){C=z};this.getMatch=function(){return C};this.setName=function(z){K=z};this.getName=function(){return K};this.setDisplayName=function(z){ja=z};this.getDisplayName=function(){return ja};this.setParentNode=function(z){na=z};this.getParentNode=
function(){return na};this.setChecked=function(z){N=z};this.isChecked=function(){return N};this.check=function(z){};this.getSubNodeLevel=function(){for(var z=-1,x=na;x;)z++,x=x.getParentNode();return z}}function ba(){F.call(this);var K=this,ja=[],na=!0;this.setChildren=function(C){ja=C};this.getChildren=function(){return ja};this.setExpanded=function(C){na=C};this.isExpanded=function(){return na};this.check=function(C,L){var Z=function(k){k.getParentNode()&&(L&&L(k.getParentNode()),1==k.getParentNode().getChildren().length&&
Z(k.getParentNode()))};if(0!==ja.length&&C!==K.isChecked()){K.setChecked(C);for(var N=0;N<ja.length;N++)ja[N].check(C,L);Z(K)}};this.toJsonObject=function(){var C={};C.children=ja;return C};this.fromJsonObject=function(C,L){K.setName(C.name);K.setDisplayName(C.displayName);K.setId(C.id);if(C=C.children)for(var Z=0;Z<C.length;Z++){var N=C[Z];if(N.type){var k=new qa;k.fromJsonObject(N);k.setParentNode(K);ja.push(k);L&&k.setCommentInfo(L)}else k=new ba,k.fromJsonObject(N),k.setParentNode(K),ja.push(k)}}}
function qa(){F.call(this);var K=this,ja,na,C,L,Z;this.setNumber=function(N){na=N};this.getNumber=function(){return na};this.setUserSql=function(N){Z=N};this.getUserSql=function(){return Z};this.setCommentInfo=function(N){C=N};this.getCommentInfo=function(){return C};this.setType=function(N){ja=N};this.getType=function(){return ja};this.setErrorMessage=function(N){L=N};this.getErrorMessage=function(){return L};this.fromJsonObject=function(N){K.setType(N.type);K.setName(N.name);K.setDisplayName(N.displayName);
K.setId(N.id);K.setNumber(N.number);N.commentInfo&&(K.setName(N.name),K.setCommentInfo(N.commentInfo))};this.check=function(N,k){var z=function(x){x.getParentNode()&&(k&&k(x.getParentNode()),1==x.getParentNode().getChildren().length&&z(x.getParentNode()))};N!==K.isChecked()&&(K.setChecked(N),z(K))}}function za(){var K=!1,ja=!1,na=!1,C=Y.get("selectTable","\u9009\u62e9\u8868"),L=Y.get("metricSearchTable","\u641c\u7d22\u6570\u636e\u8868\u540d\u79f0"),Z=Y.get("metricSearchTable","\u641c\u7d22\u6570\u636e\u8868\u540d\u79f0"),
N=10,k=360;this.getCodePlaceHolder=function(){return Z};this.getPlaceHolder=function(){return L};this.isShowAppUi=function(){return K};this.isShowEntityMark=function(){return ja};this.isShowModelNumber=function(){return na};this.getTitle=function(){return C};this.getTop=function(){return N};this.getHeight=function(){return k};this.protectedMethod={setShowAppUi:function(z){K=z},setShowEntityMark:function(z){ja=z},setShowModelNumber:function(z){na=z},setTitle:function(z){C=z},setTop:function(z){N=z},
setHeight:function(z){k=z},setPlaceHolder:function(z){L=z},setCodePlaceHolder:function(z){Z=z}}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var ha=com.kingdee.bos.qing.modeler.designer;
ha.FolderNode=ba;ha.LeafNode=qa;ha.DraggingTableNode=function(){var K,ja;this.setTableNode=function(na){K=na};this.getTableNode=function(){return K};this.setTable=function(na){ja=na};this.getTable=function(){return ja}};ha.NodeStatusMonitor=function(){var K=this,ja,na=[],C=[],L=[],Z={};this.reset=function(){K.setSelected(void 0);K.setInvalidNodes([])};this.addSelectNodeListener=function(k){na.push(k)};this.removeSelectNodeListener=function(k){k=na.indexOf(k);-1<k&&na.splice(k,1)};this.setSelected=
function(k){if(ja!==k){var z=ja;k=ja=k;for(var x=0;x<na.length;x++)(0,na[x])(z,k)}};this.getSelected=function(){return ja};this.setInvalidNodes=function(k,z){C=k;Z={};if(k&&z)for(var x=Math.min(k.length,z.length),q=0;q<x;q++){var Q=k[q];if(Q){var n=z[q];Z[Q.getId()]=n}}N()};this.getInvalidNodes=function(){return C};this.isInvalidNode=function(k){if(!C)return!1;for(var z=0;z<C.length;z++){var x=C[z];if(x&&x.getId()==k)return!0}return!1};this.getInvalidPrompt=function(k){if(k&&(k=Z[k.getId()]))return k.getPrompt()};
this.addInvalidNode=function(k,z){k&&(0>C.indexOf(k)&&C.push(k),z&&(Z[k.getId()]=z),N())};this.removeInvalidNode=function(k){var z=C.indexOf(k);-1<z&&(C.splice(z,1),Z[k.getId()]=null,N())};this.batchUpdateNodeValidity=function(k,z,x){if(k&&z)for(var q=Math.min(k.length,z.length),Q=0;Q<q;Q++){var n=k[Q];if(n){var T=z[Q],m=C.indexOf(n);0>m&&C.push(n);Z[n.getId()]=T}}if(x)for(Q=0;Q<x.length;Q++)n=x[Q],m=C.indexOf(n),-1<m&&(C.splice(m,1),Z[n.getId()]=null);N()};this.addInvalidNodeChangeListener=function(k){L.push(k)};
this.removeInvalidNodeChangeListener=function(k){k=L.indexOf(k);-1<k&&L.splice(k,1)};this.getInvalidState=function(k){return Z[k.getId()]};var N=function(){for(var k=0;k<L.length;k++)(0,L[k])(C)}};ha.MetricEntitySource=function(){za.call(this);var K=this.protectedMethod;K.setShowEntityMark(!0);K.setTitle(Y.get("selectEntity","\u9009\u62e9\u5b9e\u4f53"));K.setHeight(310);K.setPlaceHolder(Y.get("metricSearchEntity","\u641c\u7d22\u5b9e\u4f53\u540d\u79f0"));K.setCodePlaceHolder(Y.get("metricSearchEntityCode",
"\u641c\u7d22\u5b9e\u4f53\u540d\u79f0/\u5b9e\u4f53\u6807\u8bc6"))};ha.MetricDataCenterSource=function(){za.call(this);var K=this.protectedMethod;K.setShowAppUi(!0);K.setTop(15);K.setHeight(330)};ha.MetricDefaultSource=function(){za.call(this)};ha.MetricModelSetSource=function(){za.call(this);var K=this.protectedMethod;K.setShowModelNumber(!0);K.setTitle(Y.get("selectModel","\u9009\u62e9\u6a21\u578b"));K.setHeight(310);K.setPlaceHolder(Y.get("metricSearchModel","\u641c\u7d22\u6a21\u578b\u540d\u79f0"));
K.setCodePlaceHolder(Y.get("metricSearchModelCode","\u641c\u7d22\u6a21\u578b\u540d\u79f0/\u6a21\u578b\u7f16\u7801"))};var Y=com.kingdee.bos.qing.framework.common.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.modeler.designer)})();(function(){function F(){var k=1,z=[];this.zoomIn=function(){var q=F.SUPPORT_SCALES.indexOf(k);q<F.SUPPORT_SCALES.length-1&&(k=F.SUPPORT_SCALES[q+1],x())};this.zoomOut=function(){var q=F.SUPPORT_SCALES.indexOf(k);0<q&&(k=F.SUPPORT_SCALES[q-1],x())};this.isMinScale=function(){return F.SUPPORT_SCALES[0]==k};this.isMaxScale=function(){return F.SUPPORT_SCALES[F.SUPPORT_SCALES.length-1]==k};this.getRatio=function(){return k};this.setCustomRatio=function(q){k=q};this.getScaledSize=function(q){return 1==
k?q:k*q};this.getRawSize=function(q){return 1==k?q:q/k};this.getScaledCoordinate=function(q){return 1==k?q:[k*q[0],k*q[1]]};this.getRawCoordinate=function(q){return 1==k?q:[q[0]/k,q[1]/k]};this.addPropertyChangedListener=function(q){z.push(q)};var x=function(){for(var q=0;q<z.length;q++){var Q=z[q];Q&&Q()}}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing=
{});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var ba=com.kingdee.bos.qing.modeler.designer;ba.Toolbar=function(){var k=new qa,z,x=$("<div>"),q=$("<div>"),Q=$("<div>");this.getJqUi=function(){z||(z=k.getJqUi(),z.addClass("modeler-designer-toolbar"),n(x),n(q),n(Q));return z};this.addButton=function(m,ia,X,D){return T(q,!1,m,ia,X,D)};this.addButtonForHeadCustom=
function(m,ia,X,D){return T(x,!1,m,ia,X,D)};this.addButtonForTailCustom=function(m,ia,X,D){return T(Q,!1,m,ia,X,D)};this.addMenuButton=function(m,ia,X,D){return T(q,!0,m,ia,X,D)};this.addMenuButtonForHeadCustom=function(m,ia,X,D){return T(x,!0,m,ia,X,D)};this.addMenuButtonForTailCustom=function(m,ia,X,D){return T(Q,!0,m,ia,X,D)};this.getAllBtnWidth=function(){return x.width()+q.width()+Q.width()};var n=function(m){m.css({"float":"left",position:"relative",height:"100%"});m.appendTo(z)},T=function(m,
ia,X,D,A,I){m=k.createButton(m,ia,X,A,I);m.setIconSetter(function(aa,ca){ba.Icons.background(aa,ca)});m.setIconName(D);return m}};ba.RemoteImpl=function(){ja.call(this);var k;this.getRemoteUrl=function(){return k};this.setRemoteUrl=function(z){k=z}};ba.Integration=function(){var k,z,x,q,Q,n=!0;this.setMapTableException=function(T){Q=T};this.getMapTableException=function(){return Q};this.setMapSourceType=function(T){q=T};this.getMapSourceType=function(){return q};this.setMapSourcePermission=function(T){x=
T};this.getMapSourcePermission=function(){return x};this.setModelName=function(T){k=T};this.getModelName=function(){return k};this.setModelDesc=function(T){z=T};this.getModelDesc=function(){return z};this.setModelIsValid=function(T){n=T};this.isValidModel=function(){return n}};ba.StatusBar=function(){var k,z,x,q,Q;this.getJqUi=function(){k||(k=$("<div>"),k.addClass("modeler-designer-statusbar"),z=$("<span>"),z.addClass("modeler-designer-statusbar-name"),z.appendTo(k),x=$("<span>"),x.addClass("modeler-designer-statusbar-dirtystate"),
x.appendTo(k),q=$("<span>"),q.addClass("modeler-designer-statusbar-prompt"),q.appendTo(k));return k};this.setCurrentName=function(T){z.text(T)};this.showDirtyState=function(T){x.text(T?"*":"")};this.showShortPrompt=function(T,m,ia){clearTimeout(Q);q.text(T);q.css("color",ia?ia:"");if(m){var X=0,D=function(){if(6<X)n();else{if(0==X%2){q.text(T);var A=650}else q.text(""),A=350;Q=setTimeout(D,A);X++}};D()}else n()};var n=function(){Q=setTimeout(function(){q.text("")},5E3)}};ba.DesignerFacade=function(k,
z,x,q){Y.call(this,k,z,x,q);var Q=this.protectedMethod;this.loadTables=function(n){n={source:JSON.stringify(n.toJsonObject()),needFilterMetric:!0};Q.remote("loadTables",n)};this.getMeta=function(n,T){n={source:JSON.stringify(n.toJsonObject()),table:JSON.stringify(T.toJsonObject())};Q.remote("getMeta",n)};this.getTableField=function(n,T){for(var m=[],ia=[],X=0;X<n.length;X++)m.push(n[X].toJsonObject());for(X=0;X<T.length;X++)ia.push(T[X].toJsonObject());n={sources:JSON.stringify(m),tables:JSON.stringify(ia)};
Q.remote("getTableField",n)};this.getTableFieldWithCheckModel=function(n){n={model:JSON.stringify(n.toJsonObject())};Q.remote("getTableFieldWithCheckModel",n)};this.getDBCenterTables=function(n){Q.remote("getDBCenterTables",{appNumber:n})};this.checkConnection=function(n){Q.remote("checkConnection",{sourceId:n})};this.checkMetricFormula=function(n,T,m,ia){var X={};if(m)for(var D=Object.keys(m),A=0;A<D.length;A++){for(var I=D[A],aa=m[I],ca=[],S=0;S<aa.length;S++)ca.push(aa[S].toJsonObject());X[I]=
ca}n={expr:n,metricId:ia,model:JSON.stringify(T.toJsonObject()),fields:JSON.stringify(X)};Q.remote("checkMetricFormula",n)};this.previewMetrics=function(n,T,m,ia){n={modeler:JSON.stringify(n),filters:JSON.stringify(T),previewConfig:JSON.stringify(m),metricId:ia};Q.remote("previewMetrics",n)};this.getFirstPageMetric=function(n,T){n={model:JSON.stringify(n),previewConfig:JSON.stringify(T.toJsonObject())};Q.remote("getFirstPageMetric",n)};this.updateMetricByPage=function(n,T,m,ia,X){n={model:JSON.stringify(n),
jobId:T,jobName:m,startIndex:ia,pageSize:X};Q.remote("updateMetricByPage",n)};this.exportMetricData=function(n,T,m,ia){n={jobId:n,jobName:T,totalRowCount:m,model:JSON.stringify(ia)};Q.remote("exportMetricData",n)};this.getTotalRowCount=function(n,T){Q.remote("getTotalRowCount",{jobId:n,jobName:T})};this.deleteResultDataFile=function(n,T){Q.remote("deleteResultDataFile",{jobId:n,jobName:T})};this.getMetricDimValues=function(n,T,m){n={modeler:JSON.stringify(n),dimensionId:T,metricId:m};Q.remote("getMetricDimValues",
n)};this.getTablePreviewData=function(n,T,m,ia){n={source:JSON.stringify(n.toJsonObject()),table:JSON.stringify(T.toJsonObject()),filters:JSON.stringify(m),rowCount:ia};Q.remote("getTablePreviewData",n)};this.getDataRowCount=function(n,T,m){n={source:JSON.stringify(n.toJsonObject()),table:JSON.stringify(T.toJsonObject()),filters:JSON.stringify(m)};Q.remote("getDataRowCount",n)};this.cronExpression=function(n){Q.remote("cronExpression",{cron:n})};this.checkDataWarehouseConfig=function(){Q.remote("checkDataWarehouseConfig",
{})};this.checkReferencedModel=function(n,T,m){n={source:JSON.stringify(n.toJsonObject()),table:JSON.stringify(T.toJsonObject()),modelId:m};Q.remote("checkReferencedModel",n)};this.checkModelerValid=function(n){n={model:JSON.stringify(n)};Q.remote("checkModelerValid",n)};this.checkMetricTableException=function(n,T,m){n={source:JSON.stringify(n.toJsonObject()),table:JSON.stringify(T.toJsonObject()),modelId:m};Q.remote("checkMetricTableException",n)}};ba.PageScaleHelper=F;var qa,za,ha,Y,K,ja,na,C,L,
Z;(function(){var k=com.kingdee.bos.qing.ui.component;qa=k.Toolbar;za=k.SimpleConfirmer;na=k.MessageDialog;k=com.kingdee.bos.qing.framework.common;ha=k.AbstractIcons;K=k.MultilanguageManager.createPackageAccessor(ba);ja=k.AbstractRemoteCall;Y=k.AbstractFacade;k=com.kingdee.bos.qing.common;Z=k.RelativePeriodModel;C=ba.FilterItem;L=ba.Field})();ba.Icons=new function(){ha.call(this);var k=this.protectedMethod,z;this.setComboIconImpl=function(Q){z=Q};this.protectedInit=function(Q,n){if(!z)throw Error("qing modeler comboIcon not found.");
z.define(n,"designer");n.setIconSize(16,16);x(0,0,"edit");x(0,1,"delete");x(0,2,"add");x(0,3,"zoomIn");x(0,4,"zoomOut");x(0,5,"layout");x(0,6,"rightArrow");x(0,7,"leftArrow");x(0,8,"upArrow");x(0,9,"downArrow");q(0,10,"qingWarning");q(0,11,"relation");q(0,12,"qingTable");x(0,13,"expanded");x(0,14,"expand");q(0,15,"btn_edit");x(0,17,"trial_calc");q(1,12,"qingTable_hover");x(0,18,"moveUp");q(0,19,"reset");x(0,20,"createDim");x(0,21,"publicDimension");x(0,22,"metric_filter");x(2,21,"metric_copy");x(2,
22,"new_filter");q(4,22,"exist_filter");n.setStartPosition(84,35);q(0,0,"select_field");q(0,1,"field_setting");q(0,2,"join");q(0,3,"union");q(0,4,"filter");q(0,5,"sort");q(0,6,"group_by");q(0,7,"calculate_field");x(0,8,"metric",!0);n.setStartPosition(84,52);q(0,0,"entity-sub");q(0,1,"entity-entry");q(0,2,"unlock");q(0,3,"lock_by_other");q(0,4,"lock_by_me");q(0,5,"tick");q(0,6,"cross");n.setIconSize(20,20);n.setStartPosition(0,35);q(0,0,"leftJoin");q(0,1,"rightJoin");q(0,2,"innerJoin");q(0,3,"fullJoin");
n.setStartPosition(238,35);n.setIconSize(32,32);q(0,0,"metric_icon");n.setStartPosition(288,35);n.setIconSize(16,16);x(0,0,"table_relation_with_hover");q(1,0,"table_relation");q(0,1,"custom_group");n.setStartPosition(0,55);n.setIconSize(20,20);x(0,0,"setting");q(0,1,"warning");n.setIconSize(60,80);n.setStartPosition(0,98);q(0,0,"no_source");n.setIconSize(138,78);n.setStartPosition(240,240);q(0,0,"no_data_cloud");n.setIconSize(253,140);n.setStartPosition(62,71);q(0,0,"drag_node_prompt");n.setIconSize(210,
170);n.setStartPosition(0,211);q(0,0,"no_node_and_source");z.define(n,"source");n.setStartPosition(0,20);n.setIconSize(16,16);q(0,0,"entity");q(0,1,"data");q(0,2,"modelSet");q(0,3,"file");q(0,4,"data-center");q(0,5,"table");q(0,6,"openapi");n.setStartPosition(85,0);n.setIconSize(16,16);q(0,0,"table_selected");n.setStartPosition(101,0);q(0,0,"f7");n.setStartPosition(0,40);n.setIconSize(20,20);n.setGap(0,1);q(0,0,"modelset-source-icon");q(0,1,"mysql");q(0,2,"datacenter-source-icon");q(0,3,"entity-source-icon");
q(0,4,"oracle");q(0,5,"postgresql");q(0,6,"sqlserver");q(0,7,"greenplum");q(0,8,"access");q(0,9,"db2");q(0,10,"odps");q(0,11,"sparksql");q(1,1,"redshift");q(1,2,"apachedrill");q(1,3,"hive");q(1,4,"impala");q(1,5,"kylin");q(1,6,"dm");q(1,7,"gaussdb");q(1,8,"sybaseiq");q(1,9,"sqlite");q(1,10,"sybase");q(2,2,"doris");q(2,3,"hana");n.setGap(0,0);q(1,0,"excel");q(2,0,"txt");q(2,1,"csv");q(1,11,"xml");q(2,4,"kingbase");q(2,5,"tdsql");q(2,6,"gbase");q(2,7,"vastbase");q(2,8,"yashandb");q(2,9,"openapi-source-icon");
q(2,10,"tidb");n.setStartPosition(120,-1);n.setIconSize(16,16);x(0,0,"refresh");n.setStartPosition(180,-1);n.setIconSize(16,16);x(0,0,"menu");n.setStartPosition(0,110);n.setIconSize(120,93);q(0,0,"no-permission");n.setStartPosition(100,100);n.setIconSize(138,84);q(0,0,"search-no-result");z.define(n,"metatree");n.setGap(1);n.setStartPosition(1,1);n.setIconSize(16,16);x(0,0,"DATE",!0);x(0,1,"STRING",!0);x(0,5,"TABLE",!0);x(0,8,"DATETIME",!0);x(0,9,"BOOLEAN",!0);x(0,10,"NUMBER",!0);x(0,11,"INT",!0);
z.define(n,"metric");n.setStartPosition(0,0);n.setIconSize(260,160);q(0,0,"add_metric");n.setStartPosition(0,164);n.setIconSize(210,170);q(0,0,"no_metric");n.setStartPosition(230,165);n.setIconSize(12,12);q(0,0,"add_metric_plug_sign")};var x=function(Q,n,T,m){var ia=T+"_hover";m?(q(Q,n,T),q(Q+1,n,ia)):(q(Q,n,ia),q(Q+1,n,T))},q=function(Q,n,T){k.registIcon(Q,n,T)}};ba.LockHelper=new function(){var k,z,x,q,Q,n,T,m,ia=!1;this.show=function(D){n=$("<div>");n.addClass("modeler-designer-lock-statusbar");
T=$("<div>");m=$("<div>");m.addClass("modeler-designer-lock-text");T.addClass("modeler-designer-lock-icon");n.append(m);n.append(T);n.appendTo(D);n.on("click",X);ia=!0};this.registerLockRequestSender=function(D){q=D};this.setGlobal=function(D){k=D};this.setLockStateChangeListener=function(D){Q=D};this.setLockInfo=function(D,A,I){if(ia){x=A;z=D?ba.LockHelper.STATE_LOCK_BY_ME:A?ba.LockHelper.STATE_LOCK_BY_OTHER:ba.LockHelper.STATE_UNLOCK;Q&&Q(z==ba.LockHelper.STATE_LOCK_BY_ME);if(!I){if(z==ba.LockHelper.STATE_LOCK_BY_OTHER){var aa=
K.get("lockByOtherPrompt","\u5f53\u524d\u6a21\u578b\u5df2\u88ab\u201c#1\u201d\u9501\u5b9a\uff0c\u60a8\u7684\u4fee\u6539\u5c06\u65e0\u6cd5\u4fdd\u5b58\uff0c\u5efa\u8bae\u60a8\u9501\u5b9a\u5f53\u524d\u6a21\u578b\u540e\u518d\u8fdb\u884c\u7f16\u8f91\u3002");aa=aa.replace("#1",x)}else z==ba.LockHelper.STATE_UNLOCK&&(aa=K.get("unlockPrompt","\u5f53\u524d\u6a21\u578b\u672a\u9501\u5b9a\uff0c\u4e0d\u53ef\u7f16\u8f91\uff0c\u8bf7\u9501\u5b9a\u6a21\u578b\u540e\u518d\u8fdb\u884c\u64cd\u4f5c"));aa?k.getMessageCurtain().showPrompt(aa,
-1):z==ba.LockHelper.STATE_LOCK_BY_ME&&k.getMessageCurtain().showSuccess(K.get("lockSuccess","\u60a8\u5df2\u6210\u529f\u9501\u5b9a\u8be5\u6a21\u578b"))}D="lock_by_other";if(z==ba.LockHelper.STATE_UNLOCK){D="unlock";var ca=K.get("unlock","\u672a\u9501\u5b9a")}else z==ba.LockHelper.STATE_LOCK_BY_OTHER?ca=K.get("lockedBy","\u5df2\u88ab\u201c#1\u201d\u9501\u5b9a").replace("#1",x):z==ba.LockHelper.STATE_LOCK_BY_ME&&(ca=K.get("lockedBy","\u5df2\u88ab\u201c#1\u201d\u9501\u5b9a").replace("#1",K.get("me",
"\u6211")),D="lock_by_me");ba.Icons.background(T,D);m.text(ca);m.attr("title",ca)}};this.setMaxWidth=function(D){m&&m.css("max-width",Math.max(0,Math.min(D-50,250))+"px")};var X=function(){if(q){var D=z!=ba.LockHelper.STATE_LOCK_BY_ME;if(D)q(D);else{var A=new za;A.setText(K.get("confirmUnlock","\u786e\u5b9a\u8981\u89e3\u9501\u5f53\u524d\u6a21\u578b\uff1f"));A.setConfirmedListener(function(I){I&&q(D)});A.show(n)}}}};ba.LockHelper.STATE_LOCK_BY_ME="lock_by_me";ba.LockHelper.STATE_LOCK_BY_OTHER="lock_by_other";
ba.LockHelper.STATE_UNLOCK="unlock";ba.DppVersionExceptionHandler=new function(){var k=!1;this.handle=function(z){if(20001101!=z)return!1;k||(k=!0,z=na.createFeedbackDialog(),z.setMsgImageType(na.MSG_WARNING),z.setMessage(K.get("dppVersionException","\u8f7b\u5efa\u6a21\u5ba2\u6237\u7aef\u7248\u672c\u4e0e\u6570\u636e\u5904\u7406\u5f15\u64ce\u7248\u672c\u4e0d\u4e00\u81f4\uff0c\u8bf7\u8054\u7cfb\u8fd0\u7ef4\u4eba\u5458\u5347\u7ea7\u5ba2\u6237\u7aef\u6216\u5f15\u64ce\u3002")),z.setOptionType(na.OPTION_OK),
z.setButtonText(na.RETURN_OK,K.get("iSee","\u6211\u77e5\u9053\u4e86")),z.setClosedAction(function(){k=!1}),z.showDialog());return!0}};ba.PropDataTypeUtil=new function(){this.getDataTypeDesc=function(k){switch(k){case L.DT_STRING:k=K.get("text","\u6587\u672c");break;case L.DT_NUMBER:k=K.get("number","\u6570\u503c");break;case L.DT_INT:k=K.get("integer","\u6574\u6570");break;case L.DT_DATE:k=K.get("dataTypeDate","\u65e5\u671f");break;case L.DT_DATETIME:k=K.get("dateTime","\u65e5\u671f\u65f6\u95f4");
break;case L.DT_BOOLEAN:k=K.get("bool","\u5e03\u5c14");break;default:k=""}return k}};F.SUPPORT_SCALES=[.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5];ba.NodeResultCache=new function(){var k={},z={},x=[];this.cacheOneNodeField=function(q,Q,n){if(n){var T=z[q];if(!T||T<n)for(k[q]=Q,n=0;n<x.length;n++)(T=x[n])&&T(q,Q)}};this.removeNodeCache=function(q){k[q]=void 0;z[q]=void 0};this.getOneNodeField=function(q){return k[q]};this.addCacheChangeListener=function(q){x.push(q)};this.clear=function(){k={};z={}}};ba.FilterCheckHelper=
new function(){this.checkFilterField=function(x,q){if(!q)return x=K.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5"),new C.FiltersCheckingResult(-1,x);for(var Q,n=0;n<x.length;n++){var T=x[n];if(!T.isEmpty()){Q=k(T,n,q);if(!Q)if(Q=n,T=z(T)){var m=K.get("incompleteFilter","\u7b2c#1\u884c\u4e0d\u5b8c\u6574\uff0c");m=m.replace("#1",Q+1);Q=new C.FiltersCheckingResult(Q,m+T)}else Q=null;if(Q)break}}return Q};this.checkFilterLogical=function(x){var q=0,Q=-1,n,T=0;for(n=0;n<x.length;n++)x[n].isEmpty()||
(T=n);n=T;for(T=0;T<x.length;T++){var m=x[T];if(!m.isEmpty()){q+=m.getLeftBracketCount();q-=m.getRightBracketCount();0>Q&&0!=q&&(Q=T);if(0>q)return x=K.get("bracketMismatch","\u5de6\u53f3\u62ec\u53f7\u4e0d\u5339\u914d\u3002"),new C.FiltersCheckingResult(Q,x);if(T!==n&&!m.getLogicOp())return x=K.get("lackLogicalSymbol","\u7b2c#1\u884c\u7f3a\u5c11\u903b\u8f91\u7b26"),x=x.replace("#1",T+1),new C.FiltersCheckingResult(T,x);if(T==n&&m.getLogicOp())return x=K.get("logicalSymbolUnnecessary","\u5b58\u5728\u591a\u4f59\u7684\u903b\u8f91\u3002"),
new C.FiltersCheckingResult(T,x)}}return 0<q?(x=K.get("bracketMismatch","\u5de6\u53f3\u62ec\u53f7\u4e0d\u5339\u914d\u3002"),new C.FiltersCheckingResult(Q,x)):null};this.checkFieldExisted=function(x,q){return k(x,-1,q)?!1:!0};var k=function(x,q,Q){x=x.getField();for(var n=0;n<Q.length;n++)if(x&&Q[n].getFullName()===x.getFullName())return null;Q=K.get("lackField","\u7b2c#1\u884c\u5b57\u6bb5\u4e0d\u5b58\u5728\u3002");Q=Q.replace("#1",q+1);return new C.FiltersCheckingResult(q,Q)},z=function(x){var q=
x.getCompareOp(),Q=x.getField(),n=x.getValue(),T=Q?Q.getOutputDataType():null;Q=Q?Q.isEnum():!1;Q=C.getSelectableCompares(T,Q);x=x.getRelativeDateRange();if(!q)return K.get("lackComparisonOperator","\u7f3a\u5c11\u6bd4\u8f83\u7b26\u3002");for(var m=!1,ia=0;ia<Q.length;ia++)if(q===Q[ia]){m=!0;break}if(!m)return K.get("comparisonMismatch","\u6bd4\u8f83\u7b26\u4e0d\u5339\u914d\u3002");if(!C.isCompareOpWithoutValue(q)){if(!n&&!x)return K.get("lackValue","\u7f3a\u5c11\u503c\u3002");if(T===L.DT_NUMBER||
T===L.DT_INT){if(!C.REG_NUMBER.test(n)&&!C.isCompareOpWithinOrNotWithinValue(q))return K.get("valueMustBeNum","\u503c\u5fc5\u987b\u4e3a\u6570\u5b57\u3002")}else if(T===L.DT_DATE||T===L.DT_DATETIME)if(C.isCompareOpRelativeDateRangeValue(q)){if(!(x instanceof Z))return K.get("invalidRelativeDateValue","\u65e0\u6548\u7684\u76f8\u5bf9\u65e5\u671f\u503c\u3002")}else{if(!C.REG_DATETIME.test(n))return K.get("invalidDateValue","\u65e0\u6548\u7684\u65e5\u671f\u503c\u3002")}else if(T===L.DT_BOOLEAN&&n!==L.BOOLEAN_TRUE&&
n!==L.BOOLEAN_FALSE)return K.get("wrongBoolean","\u9519\u8bef\u7684\u5e03\u5c14\u503c\u3002")}return null}};var N=new function(){var k;this.hookCollector=function(z){k=z};this.occur=function(z,x){try{k&&k(z,x)}catch(q){window.console&&console.warn(q)}}};N.BUTTON_TYPE="button-type";N.FUNCTION="function";N.DATATABLE_MODEL_TRANSFORM_NODE_TYPE="datatable-model-transform-node-type";N.METRIC_MODEL_DIMENSION_TYPE="metric-model-dimension-type";N.ENTER_DATA_AUTH_MANAGE="enter-data-auth-manage";N.SAVE="\u4fdd\u5b58";
N.REFRESH="\u5237\u65b0";N.DEPLOY="\u90e8\u7f72";N.ROLLBACK_CURRENT_DEPLOY="\u56de\u9000\u5230\u6700\u65b0\u90e8\u7f72\u72b6\u6001";N.UNDO="\u64a4\u9500";N.REDO="\u53cd\u64a4\u9500";N.CLEAR="\u6e05\u9664";N.MODEL_CHECK="\u6a21\u578b\u6821\u9a8c";N.MODEL_PREVIEW="\u6a21\u578b\u9884\u89c8";N.MODEL_PROPERTY="\u6a21\u578b\u5c5e\u6027";N.SOURCE_MANAGE="\u6570\u636e\u6e90\u7ba1\u7406";N.MODEL_PREVIEW_EXPORT_TO_EXCEL="\u9884\u89c8-\u5bfc\u51fa\u5230Excel";N.METRIC_DELETE="\u5220\u9664";N.TRIAL_CALCULATE=
"\u8bd5\u8ba1\u7b97";N.TRIAL_CALCULATE_DIMENSION_FILTER="\u8bd5\u8ba1\u7b97-\u7ef4\u5ea6\u8fc7\u6ee4";N.SOURCE_TABLE_FILTER="\u6e90\u8868\u8fc7\u6ee4";N.SELECT_FIELD="\u9009\u62e9\u5b57\u6bb5";N.METRIC_FILTER="\u6307\u6807\u8fc7\u6ee4";N.NUMBER_FOMMAT="\u6570\u5b57\u683c\u5f0f";N.ADD_DIMENSION="\u65b0\u589e\u7ef4\u5ea6";N.PUBLIC_DIMENSION_SETTING="\u516c\u5171\u7ef4\u5ea6\u8bbe\u7f6e";N.ENTER_DATA_AUTH_MANAGE_AFTER_DEPLOY="\u6210\u529f\u90e8\u7f72\u540e\u70b9\u51fb\u8df3\u8f6c\u8fdb\u5165";ba.UserOperationReporter=
N})();(function(){function F(){var ha;this.setCaption=function(Y){ha=Y};this.getCaption=function(){return ha?ha:""};this.perform=function(){throw Error("Override me.");};this.unperform=function(){throw Error("Override me.");}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler=
{});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var ba=com.kingdee.bos.qing.modeler.designer;ba.CommandManager=function(){var ha=[],Y=[],K=new za;this.perform=function(C){C.perform();ja(ha,C);Y.length=0;na(C,!0)};this.addPerformedListener=function(C){K.addListener(C)};this.isCanUndo=function(){return 0<ha.length};this.isCanRedo=function(){return 0<Y.length};this.undo=function(){var C=ha.pop();C&&(C.unperform(),ja(Y,C),na(C,!1,!0))};this.redo=
function(){var C=Y.pop();C&&(C.perform(),ja(ha,C),na(C,!1,!1))};this.reset=function(){ha.length=0;Y.length=0;na(null)};var ja=function(C,L){C.push(L);32<C.length&&C.splice(0,1)},na=function(C,L,Z){K.fireEvent(function(N){N(C,L,Z)})}};ba.AbstractAction=F;ba.ActionSetModel=function(){F.call(this);var ha,Y,K;this.setValue=function(ja,na,C){Y=ja;K=na;ha=C};this.perform=function(){ha(K)};this.unperform=function(){ha(Y)}};ba.ActionChangeModelInfo=function(){F.call(this);var ha,Y,K,ja,na;this.getCaption=
function(){return qa.get("editModelInfo","\u7f16\u8f91\u6a21\u578b\u5c5e\u6027")};this.setValue=function(C,L,Z,N,k){ha=C;Y=L;K=Z;ja=N;na=k};this.perform=function(){ha.setModelName(Y);ha.setModelDesc(ja)};this.unperform=function(){ha.setModelName(K);ha.setModelDesc(na)}};ba.ActionAddRemoveSource=function(){F.call(this);var ha,Y,K,ja;this.getCaption=function(){return ha};this.setValue=function(na,C,L){Y=L.getAllSource();var Z="",N="";K=[];for(var k=0;k<Y.length;k++){var z=Y[k];-1<C.indexOf(z)?(0<N.length&&
(N+="\uff0c"),N+=z.getName()):K.push(z)}for(k=0;k<na.length;k++)C=na[k],K.push(C),0<Z.length&&(Z+="\uff0c"),Z+=C.getName();ha="";0<Z.length&&(ha+=qa.get("actionAddSource","\u6dfb\u52a0\u6570\u636e\u6e90\u201c#1\u201d").replace("#1",Z));0<N.length&&(0<ha.length&&(ha+="\uff1b"),ha+=qa.get("actionRemoveSource","\u5220\u9664\u6570\u636e\u6e90\u201c#1\u201d").replace("#1",N));ja=L};this.perform=function(){ja.setSource(K)};this.unperform=function(){ja.setSource(Y)}};ba.ActionMoveNode=function(){F.call(this);
var ha,Y,K,ja;this.getCaption=function(){if(!ja){var na=ba.DisplayNameHelper.getNodeDisplayName(ha);ja=qa.get("actionMoveNode","\u79fb\u52a8\u8282\u70b9\u201c#1\u201c").replace("#1",na)}return ja};this.setValue=function(na,C){ha=na;Y=C;K=[Y[0]-ha.getX(),Y[1]-ha.getY()]};this.perform=function(){ha.changePosition(Y[0],Y[1])};this.unperform=function(){ha.changePosition(ha.getX()-K[0],ha.getY()-K[1])}};ba.ActionChangeMaterializedConfig=function(){F.call(this);var ha,Y,K;this.getCaption=function(){return qa.get("editMaterializedConfig",
"\u7f16\u8f91\u7269\u5316\u5b58\u50a8\u8bbe\u7f6e")};this.setValue=function(ja,na){ha=ja;K=na};this.perform=function(){Y=ha.getMaterializedConfig();ha.setMaterializedConfig(K)};this.unperform=function(){ha.setMaterializedConfig(Y)}};var qa,za;(function(){var ha=com.kingdee.bos.qing.framework.common;qa=ha.MultilanguageManager.createPackageAccessor(ba);ha=com.kingdee.bos.qing.common;za=ha.EventListenerList})()})();(function(){function F(){function c(R,da,G,y){this.getX1=function(){return R};this.getX2=function(){return G};this.getY1=function(){return da};this.getY2=function(){return y}}var a=!1,e,b,d=[],g,H;this.isPrepared=function(){return a};this.prepare=function(R,da,G){H=G;b=da;R=R.getAllNodes();e=[];for(da=0;da<R.length;da++){var y=R[da];G=y.getX();var E=y.getY(),t=G+y.getWidth();y=E+y.getHeight();e.push(new c(G,E,t,y))}a=!0};this.anchor=function(R){pa();g=R;var da=!1,G=!1;for(R=0;R<e.length;R++){var y=
e[R];if(!da){da=y;var E=g[1]+(g[3]>>1);var t=da.getY1()+da.getY2()>>1;if(10>=Math.abs(t-E)){E=P(da);var p=H.getScaledSize(t);fa(E[0],p,E[1],p);g[1]=t-(g[3]>>1);t=!0}else t=!1;t?da=!0:(E=g[1],t=da.getY1(),10>=Math.abs(t-E)?(E=P(da),p=H.getScaledSize(t),fa(E[0],p,E[1],p),g[1]=t,t=!0):t=!1,t?da=!0:(E=g[1]+g[3],t=da.getY2(),10>=Math.abs(E-t)?(da=P(da),E=H.getScaledSize(t),fa(da[0],E,da[1],E),g[1]=t-g[3],da=!0):da=!1))}G||(G=y,t=g[0],y=G.getX1(),10>=Math.abs(y-t)?(t=P(G,!0),E=H.getScaledSize(y),fa(E,t[0],
E,t[1]),g[0]=y,y=!0):y=!1,y||(t=g[0]+g[2],y=G.getX2(),10>=Math.abs(y-t)?(G=P(G,!0),t=H.getScaledSize(y),fa(t,G[0],t,G[1]),g[0]=y-g[2],y=!0):y=!1),G=y);if(da&&G)break}};this.abort=function(){pa()};var P=function(R,da){if(da){da=g[1];var G=R.getY1();da<G?R=R.getY2():(da=G,R=g[1]+g[3])}else da=g[0],G=R.getX1(),da<G?R=R.getX2():(da=G,R=g[0]+g[2]);return H.getScaledCoordinate([da-15,R+15])},fa=function(R,da,G,y){var E=$("<div>");E.addClass("modeler-designer-auxiliary-line");b.append(E);d.push(E);N.layoutCtrl(E,
R,da,G-R,y-da)},pa=function(){for(var R=0;R<d.length;R++)d[R].remove();d=[]}}function ba(){var c=this;this.createNode=function(a){return document.createElementNS("http://www.w3.org/2000/svg",a)};this.createWithAttrs=function(a,e){a=c.createNode(a);c.setAttributes(a,e);return a};this.setText=function(a,e){$(a).empty();e=document.createTextNode(e);a.appendChild(e)};this.setTitle=function(a,e){var b=a.getElementsByTagName("title");0==b.length?(b=c.createNode("title"),a.appendChild(b)):b=b[0];c.setText(b,
e)};this.addClass=function(a,e){$(a).addClass(e)};this.createPath=function(a,e,b,d){var g=c.createNode("path"),H=c.getPathCoordinate(a,e),P=c.getPathCoordinate(a+b,e);b=c.getPathCoordinate(a+b,e+d);a=c.getPathCoordinate(a,e+d);c.setAttributes(g,{d:"M"+H+" L"+P+" L"+b+" L"+a+" Z"});return g};this.setAttributes=function(a,e){for(var b in e)a.setAttribute(b,e[b])};this.getPathCoordinate=function(a,e){return""+a+" "+e}}function qa(){var c,a,e=0,b={},d={},g,H,P;this.getSelectedEntityName=function(){var t,
p;for(p in b){var w=b[p];w&&w.isChecked()&&(t=t?t+C.ENTITY_SEPARATOR+p:p)}return t};this.setFunUpdateProperties=function(t){c=t};this.setMeta=function(t){H=t};this.setSelectedTableNames=function(t){if(H.getTableNode())for(P=t,t=0;t<P.length;t++){var p=P[t],w=b[p];w&&(w.setChecked(!0),E(w,!0),c(d[p],p))}};this.getJqUi=function(){if(!a){a=$("<div>");a.addClass("modeler-designer-selected-field-entry-panel");if(!H.getTableNode()){var t=new ja;t.setType(ja.TYPE_NO_SOURCE);t.getJqUi().appendTo(a);return a}var p=
new r;p.fromJsonObject(H.getTableNode());var w=new K;w.setLevel(0);w.toFolderLevelNode(p);fa(w,0);p=H.getPropertyMap();for(t in p)d[t]=p[t]}return a};var fa=function(t,p){if(t.getDisplayName()){var w=p,M=$("<div>");M.addClass("modeler-designer-selected-entity-item");var V=new n;V.setUserObject(t);0==w&&t.getName();b[t.getName()]=V;V.addCheckedListener(E);V=V.getJqUi();N.layoutCtrl(V,20*w,30*e,15,20);V.appendTo(M);V=$("<div>");V.addClass("modeler-designer-selected-entity-item-ui");V.attr("entity-name",
t.getName());V.on("click",G);N.layoutCtrlWithLRTB(V,20*w+18,10,null,30*e,0,20);var U=$("<div>");U.addClass("modeler-designer-selected-entity-item-text");U.text(t.getDisplayName());U.attr("title",t.getDisplayName());N.layoutCtrl(U,23,2,null,20);U.appendTo(V);U=$("<span>");U.addClass("modeler-designer-selected-entity-item-icon");u.background(U,"entity-entry");0==w&&u.background(U,"entity-sub");N.layoutCtrl(U,2,2,16,16);U.appendTo(V);V.appendTo(M);M.appendTo(a);e++;++p}if(w=t.getChildren())for(M=0;M<
w.length;M++)V=new K,V.setLevel(p),V.toFolderLevelNode(w[M]),V.setParentNode(t),fa(V,p)},pa=function(t,p){if((t=t.getChildren())&&0<t.length)for(var w=0;w<t.length;w++){var M=t[w];p[M.getName()]=M;pa(M,p)}},R=function(t,p){if(t=t.getParentNode())p[t.getName()]=t,R(t,p)},da=function(t){var p={};if(!t)return p;if(t=t.getChildren())for(var w=0;w<t.length;w++){var M=t[w];p[M.getName()]=M}return p},G=function(t){t=$(t.currentTarget).attr("entity-name");c(d[t],t);g&&y(!1);g=t;y(!0)},y=function(t){var p=
a.find("[entity-name='"+g+"']");p&&(t?p.addClass("modeler-designer-selected-entity-item-ui_selected"):p.removeClass("modeler-designer-selected-entity-item-ui_selected"))},E=function(t,p){if(p){p=t.getUserObject();c(d[p.getName()],p.getName());var w=p.getParentNode(),M=da(p),V={};pa(p,V);var U={};R(p,U);var ma=!1;for(va in V){var oa=b[va];if(oa&&oa.isChecked()){ma=!0;break}}var va=ma;ma=!1;for(Da in U)if((oa=b[Da])&&oa.isChecked()){ma=!0;break}var Da=ma;if(t.isChecked()){g&&y(!1);g=p.getName();y(!0);
w&&(t=b[w.getName()])&&t.setEnabled(!0);for(var Aa in b)t=b[Aa],p.getName()==Aa||w&&Aa==w.getName()||va&&V[Aa]||Da&&U[Aa]||(M[Aa]?t.setEnabled(!0):t.setEnabled(!1))}else for(Aa in g&&y(!1),g=p.getName(),y(!0),w=da(w),b)t=b[Aa],p.getName()==Aa||Da&&U[Aa]||(w[Aa]?t.setEnabled(!0):(V[Aa]&&t.isChecked()&&t.setChecked(!1),t.setEnabled(!Da)))}}}function za(){var c,a,e,b;this.setMeta=function(d){c=d};this.setCurrentTableName=function(d){a=d};this.getCurrentTableName=function(){return a};this.setSelectedPropertyName=
function(d){e=d};this.getSelectedPropertyName=function(){return e};this.getMeta=function(){return c};this.getJqUi=function(){};this.getSelectedProperties=function(){return null};this.getSelectedEntityName=function(){};this.getIsEntityView=function(){return!1};this.setWidth=function(d){b=d};this.getWidth=function(d){return b}}function ha(){za.call(this);var c=this,a,e,b,d,g,H,P={},fa=[];this.setLockPropertyName=function(G){fa=G};this.setArrProperties=function(G,y){g=y;d=G;pa(!0)};this.getTableFieldMap=
function(){return P};var pa=function(G){e&&e.hide();if(d&&0!=d.length){H=[];if(P[g])var y=P[g];else{y=d;for(var E=c.getCurrentTableName().split(C.ENTITY_SEPARATOR),t=0;t<y.length;t++){var p=y[t],w=new na;w.setField(p);w.setDisplayName(p.getAlias());fa&&-1!=fa.indexOf(p.getName())&&(w.setEnabled(!1),w.setShowRelationIcon(!0));w.setSelected(!0);-1!=E.indexOf(g)&&c.getSelectedPropertyName()&&-1==c.getSelectedPropertyName().indexOf(p.getName())&&w.setSelected(!1);H.push(w)}P[g]||(P[g]=H);y=H}b.setArrFieldItems(y,
G)}else e?e.show():(G=new ja,G.setType(ja.TYPE_NO_DATA_WITH_CLOUD),e=G.getJqUi(),b.setJqNoDataUI(e),e.appendTo(a))},R=function(){var G=c.getMeta().getRelations();if(G&&0<G.length){fa=[];for(var y=0;y<G.length;y++){var E=G[y];-1==fa.indexOf(E.getFromProperty())&&fa.push(E.getFromProperty())}}};this.getJqUi=function(){a||da();return a};var da=function(){a=$("<div>");a.addClass("modeler-designer-selected-field-panel");b=new Y;b.setShowAllCheckbox(!0);b.setFunFieldCheckClick(function(y,E){E.setSelected(y)});
var G=b.getJqUi();G.addClass("modeler-designer-selected-field-list-panel");G.appendTo(a);g=c.getCurrentTableName();c.getMeta().getPropertyMap()&&(d=c.getMeta().getPropertyMap()[g]);R();pa()};this.getSelectedProperties=function(){if(!d)return[];var G=[],y={},E=!0,t=P[c.getCurrentTableName()];if(!t)return[];for(var p=0;p<t.length;p++){var w=t[p],M=w.getField();y[M.getFullName()]||(w.getSelected()?(G.push(M),y[M.getFullName()]=!0):E=!1)}return E?null:G}}function Y(){var c=[],a=[],e,b,d,g,H,P=!1,fa=!1,
pa=!0,R=!0,da=!0,G,y,E,t,p,w,M,V;this.getContentPaneCreator=function(){return va};this.show=function(){b.show()};this.hide=function(){b.hide()};this.getJqUi=function(){b||va();return b};this.setJqNoDataUI=function(W){y=W};this.getArrFieldItems=function(){return c};this.setArrFieldItems=function(W,wa){c=[];U(W,wa);sa()};this.setFunFieldCheckClick=function(W){p=W};this.setFunAllCheckboxClick=function(W){w=W};this.setAllCheckboxSelected=function(W){E.setChecked(W)};this.setShowSearchText=function(W){da=
W};var U=function(W,wa){G.empty();W&&0!==W.length?y&&y.hide():y&&y.show();wa&&(P=!1,g&&g.setChecked(!1),d&&d.clear());fa&&(wa=oa(W),G.append(Da(wa==W.length)),Aa(wa));for(wa=0;wa<W.length;wa++){var Ca=W[wa];Ca.setFunFieldCheckClick(ya);c.push(Ca)}a=c;e=new D;e.setItemHeight(31);W=e.getJqUi();e.setItemUiCreator(function(Ea){Ea=a[Ea];Ea.initJqUi();var La=Ea.getJqUi();La.css({width:"100%",position:"relative"});g&&g.isChecked()&&!Ea.getSelected()&&La.hide();return La});V=fa?31:0;N.layoutCtrlWithLRTB(W,
0,0,null,V,0,null);ma();W.appendTo(G)},ma=function(){e.setItemCount(a.length);setTimeout(e.repaint,0)},oa=function(W){for(var wa=0,Ca=0;Ca<W.length;Ca++)W[Ca].getSelected()&&wa++;return wa},va=function(){if(!b){b=$("<div>");if(da){var W=$("<div class='modeler-designer-select-field-search-text'>");W.text(L.get("search","\u641c\u7d22"));W.appendTo(b)}W=b;var wa=W.append;d=new T;d.setShowSearchIcon(!0);d.addSearchListener(sa);d.setSearchListenerDelay(500);d.setPlaceholder(L.get("inputSearchText","\u8f93\u5165\u641c\u7d22\u6587\u672c"));
var Ca=d.getJqUi();Ca.addClass("modeler-designer-select-field-search-box");da?Ca.css("left","10px"):Ca.css("width","90%");wa.call(W,Ca);pa&&b.append(O);G=$("<div class='modeler-designer-select-field-list'>");R&&G.css("overflow","scroll");y&&b.append(y);b.append(G)}return b},Da=function(W){var wa=$("<div>");wa.addClass("modeler-desinger-select-field-lineitem");E=new n;E.setChecked(W);E.addCheckedListener(ea);W=E.getJqUi();W.addClass("modeler-designer-field-item-checkbox");W.appendTo(wa);W=$("<div>");
W.addClass("modeler-designer-field-item-allcheckbox-text");W.text(L.get("selectAll","\u5168\u9009"));W.appendTo(wa);t=$("<div>");t.addClass("modeler-designer-field-item-selected-prompt");t.text(L.get("selectedItemsPrompt","(\u5df2\u9009\u62e9#1\u9879)"));t.appendTo(wa);return wa},Aa=function(W){t&&t.text(L.get("selectedItemsPrompt","(\u5df2\u9009\u62e9#1\u9879)").replace("#1",W))},sa=function(W){H=$.trim(d.getText());Ba(c,H)},Ba=function(W,wa){var Ca=[];if(0==wa.length){M&&M.hide();W&&0!==W.length||
y.show();for(var Ea=0;Ea<W.length;Ea++){var La=W[Ea];if(!P||La.getSelected())La.show(!0),Ca.push(La)}a=Ca;E&&E.setChecked(ta())}else{var Sa=!0;for(Ea=0;Ea<W.length;Ea++)if(La=W[Ea],!P||La.getSelected())-1===La.getDisplayName().toLowerCase().indexOf(wa.toLowerCase())?La.show(!1):(La.show(!0),Sa=!1,Ca.push(La));Sa?(M||(M=$("<div>"),M.addClass("modeler-designer-addsource-noresult-view-container"),W=$("<div>"),W.addClass("modeler-designer-addsource-noresult-view-icon"),u.background(W,"search-no-result"),
W.appendTo(M),W=$("<div>"),W.addClass("modeler-designer-addsource-noresult-view-tip"),W.text(L.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),W.appendTo(M),M.appendTo(b),M.hide()),M.show(),y&&y.hide(),E&&E.setChecked(!1)):(M&&M.hide(),E&&E.setChecked(ta()));a=Ca}ma()};this.updateSelectedItemsPrompt=function(){Aa(oa(c))};var ea=function(W,wa){if(wa){for(var Ca=0;Ca<c.length;Ca++){var Ea=c[Ca];Ea.isShow()&&Ea.getEnabled()&&Ea.setSelected(W.isChecked())}w&&
w(W,wa);W=oa(c);Aa(W);e.keepState();e.repaint();e.restoreState()}},O=function(){g=new n;g.setChecked(P);g.addCheckedListener(la);g.setText(L.get("showOnlyChecked","\u4ec5\u663e\u793a\u9009\u4e2d\u9879"));var W=g.getJqUi();N.layoutCtrl(W,290,5,200,23);return W},la=function(W,wa){wa&&((P=W.isChecked())?c.forEach(function(Ca){Ca.getSelected()||Ca.show(!1)}):c.forEach(function(Ca){Ca.show(!0)}),Ba(c,H))};this.setShowAllCheckbox=function(W){fa=W};this.setShowScroll=function(W){R=W};this.setShowOnlyChecked=
function(W){pa=W};var ya=function(W,wa){p&&p(W,wa);W=oa(c);Aa(W);E&&E.setChecked(ta())},ta=function(){for(var W=!0,wa=0;wa<c.length;wa++){var Ca=c[wa];if(Ca.isShow()&&!Ca.getSelected()){W=!1;break}}return W}}function K(){r.call(this);var c=this,a,e;this.getLevel=function(){return a};this.setLevel=function(b){a=b};this.getParentNode=function(){return e};this.setParentNode=function(b){e=b};this.toFolderLevelNode=function(b){c.setName(b.getName());c.setDisplayName(b.getDisplayName());c.setChildren(b.getChildren());
c.setLevel(a)}}function ja(){var c,a=ja.TYPE_TEXT,e=L.get("noDataTips","\u6682\u65e0\u6570\u636e"),b;this.getJqUi=function(){if(!c)switch(c=$("<div>"),c.addClass("modeler-designer-no-data"),a){case ja.TYPE_TEXT:g(e,"modeler-designer-no-data-only-text");break;case ja.TYPE_NO_SOURCE:d("no_source","modeler-designer-no-data-icon");g(e,"modeler-designer-no-data-text");break;case ja.TYPE_NO_SEARCH_RESULT:d("search-no-result","modeler-designer-node-selection-icon");g(e,"modeler-designer-node-selection-tip");
break;case ja.TYPE_NO_DATA_WITH_CLOUD:d("no_data_cloud","modeler-designer-no-data-cloud-icon");g(e,"modeler-designer-no-data-text");break;default:throw Error("The view type error, please set first.");}return c};this.setType=function(H){a=H};this.setText=function(H){e=H?H:"";b&&b.text(e)};var d=function(H,P){var fa=$("<div>");fa.addClass(P);u.background(fa,H);fa.appendTo(c)},g=function(H,P){b=$("<div>");b.addClass(P);b.text(H);b.appendTo(c)}}function na(){var c=this,a,e=!1,b=!0,d=!0,g,H,P,fa;this.setField=
function(R){a=R};this.getField=function(){return a};this.setDisplayName=function(R){a&&a.setAlias(R)};this.getDisplayName=function(){return a.getAlias()};this.getFieldType=function(){return a.getOutputDataType()};this.setSelected=function(R){e=R;g&&g.setChecked(R)};this.setShowRelationIcon=function(R){P=R};this.show=function(R){R?H&&H.show():H&&H.hide();d=R};this.isShow=function(){return d};this.getSelected=function(){return g?g.isChecked():e};this.setEnabled=function(R){b=R};this.getEnabled=function(){return b};
this.getJqUi=function(){return H};this.setFunFieldCheckClick=function(R){fa=R};this.initJqUi=function(){H=$("<div>");g=new n;g.setUserObject(c);g.setChecked(e);g.setEnabled(c.getEnabled());g.addCheckedListener(function(R,da){da&&fa&&fa(R.isChecked(),c)});pa(c,g);return H};var pa=function(R,da){var G=$("<div>");G.addClass("modeler-desinger-select-field-lineitem");da=da.getJqUi();da.addClass("modeler-designer-field-item-checkbox");da.appendTo(G);da=$("<div>");da.addClass("modeler-designer-field-item-checkbox-text");
da.text(R.getDisplayName());da.attr("title",R.getDisplayName());R=R.getFieldType();var y=$("<div>");y.addClass("modeler-designer-field-item-icon");u.background(y,R);y.appendTo(G);da.appendTo(G);P&&(R=$("<div>"),R.addClass("modeler-designer-field-item-relation-icon"),u.background(R,"relation"),R.appendTo(G));G.appendTo(H)}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&
(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var C=com.kingdee.bos.qing.modeler.designer;C.AbstractDesigner=function(){var c=this,a,e,b=new ca,d=new S,g=new l,H,P,fa,pa,R=!0,da;this.setMessageResize=function(U){da=U};var G=new function(){this.getModelerModel=function(){return c.protectedGetModelerModel()};this.getIntegration=function(){return a};
this.getMessageCurtain=function(){return H};this.getCommandManager=function(){return g};this.getRemoteImpl=function(){return pa}};this.protectedInit=function(){};this.protectedResize=function(){};this.protectedGetModelerModel=function(){throw Error("override me");};this.setJsonModel=function(U){throw Error("override me");};this.protectedUpdateModelerModel=function(U){throw Error("override me");};this.getJsonModel=function(){var U=G.getModelerModel(),ma=new A;ma.setModelerModel(U);return ma.toJsonObject()};
this.setJsonValidity=function(U,ma){throw Error("override me");};this.setUndoAbleJsonModel=function(U,ma){var oa=new A;oa.fromJsonObject(U);U=oa.getModelerModel();oa=new aa;oa.setCaption(ma);oa.setValue(c.protectedGetModelerModel(),U,c.protectedUpdateModelerModel);g.perform(oa)};this.setRemoteImpl=function(U){pa=U};this.setEditable=function(U){R=U};this.isEditable=function(){return R};this.createJqUi=function(){e=$("<div onselectstart='return false'>");e.addClass("modeler-designer");H=new Q;H.getJqUi().appendTo(e);
E();e.append(b.getJqUi());e.append(d.getJqUi());c.protectedInit();R&&(C.LockHelper.setGlobal(G),C.LockHelper.show(e));return e};this.resize=function(){t()};this.setIntegration=function(U){a=U};this.getIntegration=function(){return a};this.setLockInfo=function(U,ma,oa){C.LockHelper.setLockInfo(U,ma,oa)};this.setLockStateChangeListener=function(U){C.LockHelper.setLockStateChangeListener(U)};this.registerLockRequestSender=function(U){C.LockHelper.registerLockRequestSender(U)};this.insertToolbarBtn=function(U,
ma,oa,va){return b.addButtonForHeadCustom(U,ma,oa,va)};this.insertMenuButton=function(U,ma,oa,va){return b.addMenuButtonForHeadCustom(U,ma,oa,va)};this.appendToolbarBtn=function(U,ma,oa,va){return b.addButtonForTailCustom(U,ma,oa,va)};this.getMsgCurtain=function(){return H};this.clearDirty=function(){y(!1)};this.isDirty=function(){return P};this.setDirtyListener=function(U){fa=U};var y=function(U){P=U;d&&d.showDirtyState(P);fa&&fa(P)},E=function(){p();var U=new Z;U.setCallbackImmediately(function(){p()});
U.setDelay(100);U.setCallback(function(){t()});U.observe()},t=function(){C.LockHelper.setMaxWidth(e.width()-b.getAllBtnWidth());c.protectedResize();da&&da()},p=function(){document.body.style.height=document.documentElement.clientHeight+"px"},w=function(){g.isCanUndo()&&g.undo();f.occur(f.BUTTON_TYPE,f.UNDO)},M=function(){g.isCanRedo()&&g.redo();f.occur(f.BUTTON_TYPE,f.REDO)},V=function(){var U=new B;U.setGlobal(G);U.setRemoteImpl(pa);U.showDialog()};this.protectedMethod={addToolbarButton:function(U,
ma,oa,va){return b.addButton(U,ma,oa,va)},getGlobal:function(){return G},getMainUi:function(){return e},addUndoRedoBtn:function(U){var ma=b.addButton(w,"btn_undo",L.get("undo","\u64a4\u6d88")),oa=b.addButton(M,"btn_redo",L.get("redo","\u53cd\u64a4\u6d88"));ma.setEnabled(g.isCanUndo());oa.setEnabled(g.isCanRedo());g.addPerformedListener(function(va,Da,Aa){ma.setEnabled(g.isCanUndo());oa.setEnabled(g.isCanRedo())});g.addPerformedListener(function(va,Da,Aa){y(!0);va&&(Da=Da?"":(Aa?L.get("undo","\u64a4\u6d88"):
L.get("redo","\u53cd\u64a4\u6d88"))+" ",Da+=va.getCaption(),d.showShortPrompt(Da),U&&U(va))})},addMaterializedConfigBtn:function(){b.addButton(V,"btn_materialized_config",L.get("materializedConfig","\u7269\u5316\u5b58\u50a8\u8bbe\u7f6e"))}}};C.ModelInfoDialog=function(){q.call(this);var c=this.protectedMethod,a=this,e,b,d;(function(){c.setTitle(L.get("modelProp","\u6a21\u578b\u5c5e\u6027"));a.setSize(400,300);c.setContentPaneCreator(function(){var g=$("<div>"),H=new k;H.setRequired(!0);H.setText(L.get("name",
"\u540d\u79f0"));H=H.getJqUi();e=new z;var P=e.getJqUi(),fa=d.getIntegration();e.setText(fa.getModelName());var pa=new k;pa.setText(L.get("desc","\u63cf\u8ff0"));pa=pa.getJqUi();b=new x;var R=b.getJqUi();b.setText(fa.getModelDesc());H.appendTo(g);P.appendTo(g);pa.appendTo(g);R.appendTo(g);N.layoutCtrl(H,8,0,70,23);N.layoutCtrl(P,76,0,280,23);N.layoutCtrl(pa,8,48,70,23);N.layoutCtrl(R,76,54,280,120);return g});c.setClosingChecker2(function(g){g=$.trim(e.getText());var H=$.trim(b.getText()),P=d.getIntegration(),
fa=P.getModelName(),pa=P.getModelDesc();if(g==fa&&H==pa)return!0;var R;0==g.length?R=L.get("nameIsEmptyPrompt","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a\u3002"):50<g.length&&(R=L.get("nameTooLongPrompt","\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002"));500<H.length&&(R=L.get("descTooLongPrompt","\u63cf\u8ff0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7500\u4e2a\u5b57\u7b26\u3002"));if(R)return c.getMessageCurtain().showPrompt(R),!1;R=new I;R.setValue(P,g,P.getModelName(),H,P.getModelDesc());
d.getCommandManager().perform(R);return!0});c.setClosingAction(function(g){})})();this.setGlobal=function(g){d=g}};C.NoNodePromptUi=function(){var c,a,e,b,d;this.setNoNode=function(fa){P()};this.setNoSource=function(fa){e=fa;P()};this.show=function(){c&&c.show()};this.hide=function(){c&&c.hide()};this.getJqUi=function(){c||(c=$("<div>"),c.css("background","#f7f7f7"),c.css("z-index",1E3),N.layoutCtrlWithLRTB(c,0,0,null,0,0,null),P());return c};var g=function(){if(!b){b=$("<div>");N.layoutCtrlMiddleAlign(b,
180);N.layoutCtrlCenterAlign(b,260);b.appendTo(c);a=$("<div>");a.addClass("modeler-designer-no-node-prompt");N.layoutCtrl(a,10,0,260,20);a.appendTo(b);a.text(L.get("dragInNode","\u62d6\u5165\u8868\uff0c\u5f00\u59cb\u521b\u5efa\u6a21\u578b"));var fa=$("<div>");N.layoutCtrl(fa,0,40,253,140);u.background(fa,"drag_node_prompt");fa.appendTo(b)}return b},H=function(){d||(d=$("<div>"),N.layoutCtrlMiddleAlign(d,170),N.layoutCtrlCenterAlign(d,210),u.background(d,"no_node_and_source"),d.appendTo(c));return d},
P=function(){e?(g().hide(),H().show()):(g().show(),H().hide())}};C.DragHandler=function(){var c=$(document.body),a,e,b,d,g,H,P,fa,pa,R,da;this.bindDragUi=function(w,M){var V=!1,U=[-1,-1],ma=null,oa=function(){a=V=!1;ma=null;U=[-1,-1]};w.on("mousedown",function(va){V=!0;a=!1;ma=$(va.target);U=[va.screenX,va.screenY]});w.on("mouseup",function(va){oa()});w.on("mouseleave",function(va){V&&oa()});w.on("mousemove",function(va){var Da=!1;V&&(Da=5<Math.abs(va.screenX-U[0])||5<Math.abs(va.screenY-U[1]));Da&&
(V=!1,(d=M(ma))?(H=new F,b=fa(),g=d.getTableNode(),a=!0,c.on("mousemove",G),c.on("mouseup",y),c.on("mouseleave",t)):oa())})};this.bindDropUi=function(w,M,V,U,ma){fa=M;pa=V;R=U;P=ma};var G=function(w){if(a){if(!e){e=$("<div onselectstart='return false'>");e.addClass("modeler-dragdrop-mask");var M=N.getCurrentTargetPosition(w);M=N.upwardCoordinate(w.target,M,c[0]);e.data("target-origin-pos-left",M[0]);e.data("target-origin-pos-top",M[1]);e.appendTo(c)}if(M=pa(w,b,g)){var V=M.getJqPhysicalUi();H.isPrepared()||
H.prepare(M.getModeler(),V,P);da||(da=$("<div>"),N.layoutCtrlWithLRTB(da,0,0,null,0,0,null),da.css("z-index",999999));da.appendTo(V);E();w=[g.getX(),g.getY()];w=P.getScaledCoordinate(w);w=N.upwardCoordinate(V[0],w,c[0]);M=P.getScaledSize(g.getWidth());V=P.getScaledSize(g.getHeight());N.layoutCtrl(e,w[0],w[1],M,V)}else console.log("moving"),e.text(""),M=N.getCurrentTargetPosition(w),M=N.upwardCoordinate(w.target,M,c[0]),N.layoutCtrl(e,M[0]-20,M[1]-15,40,30)}},y=function(w){pa(w,b,g)?(E(),R(d,function(){e.remove();
e=null}),p(!0)):p()},E=function(){var w=[g.getX(),g.getY(),g.getWidth(),g.getHeight()];H.anchor(w);g.setPosition(w[0],w[1])},t=function(){p()},p=function(w){a=!1;!w&&e&&e.animate({left:e.data("target-origin-pos-left"),top:e.data("target-origin-pos-top"),width:4,height:3},function(){e.remove();e=null});c.off("mousemove",G);c.off("mouseup",y);c.off("mouseleave",t);da&&da.remove();H&&H.abort()}};C.NodeDragHelper=function(){var c,a,e,b,d,g,H,P,fa=!1,pa,R;this.setTarget=function(w){e=w};this.setScaleHelper=
function(w){R=w};this.setModelerModel=function(w){pa=w};this.setMovableArea=function(w){c=w};this.startDrag=function(w){console.log("start drag");P=new F;P.prepare(pa,c,R);a=[w.clientX,w.clientY];b=$("<div>");b.css("z-index",999999);b.appendTo($(document.body));N.layoutCtrlWithLRTB(b,0,0,null,0,0,null);b.on("mousemove",da);b.on("mouseup",G);b.on("mouseleave",t)};this.setEndMoveCallback=function(w){g=w};var da=function(w){if(fa)var M=!0;else M=Math.abs(w.clientY-a[1]),M=5<Math.abs(w.clientX-a[0])||
5<M?fa=!0:!1;if(M){if(!d){d=$("<div>");d.addClass("modeler-dragdrop-mask");d.appendTo(c);var V=e.getX(),U=e.getY(),ma=e.getWidth();M=e.getHeight();H=[V,U];V=R.getScaledCoordinate(H);ma=R.getScaledSize(ma);M=R.getScaledSize(M);N.layoutCtrl(d,V[0],V[1],ma,M)}w=E(w);y(w);w=R.getScaledCoordinate(w);N.layoutCtrl(d,w[0],w[1],null,null)}},G=function(w){d&&(w=E(w),y(w),g&&g(w[0],w[1]));p()},y=function(w){if(d){var M=R.getRawSize(d.width()),V=R.getRawSize(d.height()),U=R.getRawCoordinate(w);M=[U[0],U[1],M,
V];P.anchor(M);w[0]=M[0];w[1]=M[1]}},E=function(w){var M=w.clientX-a[0];w=w.clientY-a[1];var V=R.getScaledCoordinate(H);return[V[0]+M,V[1]+w]},t=function(w){p()},p=function(){console.log("destroy");b&&(b.off("mousemove",da),b.off("mouseup",G),b.off("mouseleave",t),b.remove(),b=null);d&&(d&&d.remove(),d=null);P&&P.abort()}};C.PageDragHelper=function(){var c,a,e,b,d,g,H,P;this.startDrag=function(y,E){console.log("start drag page");d=E;a=[y.clientX,y.clientY];e=(y=d.position())?[y.left,y.top]:[0,0];
g=$("<div>");g.css("z-index",999999);g.appendTo($(document.body));g.css("cursor","move");N.layoutCtrlWithLRTB(g,0,0,null,0,0,null);g.on("mousemove",fa);g.on("mouseup",pa);g.on("mouseleave",R)};this.setMovableArea=function(y){b=y};this.setGlobal=function(y){H=y};this.setScaleHelper=function(y){P=y};var fa=function(y){var E=y.clientX-a[0];y=y.clientY-a[1];if(c)var t=!0;else t=Math.abs(y),t=5<Math.abs(E)||5<t?c=!0:!1;t&&d.css({left:G(e[0]+E,!0)+"px",top:G(e[1]+y,!1)+"px"})},pa=function(y){da()},R=function(y){da()},
da=function(){console.log("destroy drag page");g.css("cursor","default");g&&g.remove();g=null},G=function(y,E){if(E){E=9999;var t=d.width();var p=b.width()}else E=9999,t=d.height(),p=b.height();E=P.getScaledSize(E);var w=t>E;E=0<y?w?0:Math.min(y,E-t):w?Math.max(y,p-t):Math.max(y,p-E);E!=y&&H.getMessageCurtain().showPrompt(L.get("svgMaxSize","\u5df2\u8fbe\u5230\u7ed8\u5236\u533a\u57df\u6700\u5927\u5c3a\u5bf8\u3002"));return E}};C.DragInsideCheckResult=function(c,a){this.getJqPhysicalUi=function(){return c};
this.getModeler=function(){return a}};C.FieldSelectDialog=function(c,a,e,b,d){q.call(this);var g=this,H=this.protectedMethod,P,fa,pa=d,R,da;this.showSelectFieldDialog=function(t,p){g.setSize(t,p);g.setPosition(window.innerWidth-t>>1,window.innerHeight-p>>1);H.setTitle(L.get("selectField","\u9009\u62e9\u5b57\u6bb5"));H.setClosingAction(G);H.setClosingChecker(y);H.setContentPaneCreator(E);g.showDialog()};var G=function(t){if(t)if((t=fa.getSelectedProperties())&&e.setSelectedFields(t),fa.getIsEntityView()){var p=
fa.getSelectedEntityName();t=b.clone();var w=e.clone();if(p!=b.getTableName()){var M=pa.getAllTable(),V=!1;t.setTableName(p);for(p=0;p<M.length;p++){var U=M[p];if(t.isSame(U)){V=!0;t.setUid(U.getUid());w.setTableUid(U.getUid());break}}V||(M=C.UIDHelper.getUID(C.UIDHelper.NS_TABLE),t.setUid(M),w.setTableUid(M))}M=R;da(w,t);M&&M()}else t=R,da(e,b),t&&t();else R&&R()},y=function(){if(!fa)return!1;if(fa.getIsEntityView()){var t=fa.getSelectedEntityName();if(!t)return H.getMessageCurtain().showPrompt(L.get("needSelectedEntity",
"\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b9e\u4f53\u6216\u8005\u5206\u5f55\u8868\u3002")),!1;fa.setCurrentTableName(t)}return(t=fa.getSelectedProperties())&&0==t.length?(H.getMessageCurtain().showPrompt(L.get("noSelectedField","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b57\u6bb5\u3002")),!1):!0},E=function(){P=$("<div>");var t=new J(c,function(p){var w=new h;w.fromJsonObject(p);fa=C.SelectFieldFactory.createSelectFieldToDialog(w.getSourceType());fa.setMeta(w);fa.setCurrentTableName(b.getTableName());
fa.setWidth(850);fa.getIsEntityView()&&H.setTitle(L.get("selectEntityAndField","\u9009\u62e9\u6570\u636e\u8868\u53ca\u5b57\u6bb5"));fa.getJqUi().appendTo(P)});t.setBlockingJqUi(P);t.setShowBlocking(!0);t.getMeta(a,b);return P};this.setGlobal=function(t){};this.setModeler=function(t){pa=t};this.setFunFinishCallback=function(t){R=t};this.setAddNodeCallback=function(t){da=t}};C.SelectFieldPanel=Y;C.SvgHelper=ba;C.ChooseFieldPanelHelper=function(){function c(){var P=[],fa,pa,R,da,G,y=!1,E=!0,t;this.setItemModel=
function(p){P=p};this.setShowFieldNameEnable=function(p){E=p};this.setRawTypeSwitchListener=function(p){};this.setSearchListener=function(p){fa=p};this.setListItemPainter=function(p){pa=p};this.setShowFieldNameListener=function(p){R=p};this.setSearchBoxPlaceholder=function(p){t=p};this.createJqPopup=function(p,w,M){da=$("<div>");da.appendTo(p);G=$("<div>");da.addClass("modeler-designer-field-popup");p=t?t:L.get("search","\u641c\u7d22");var V=new T;V.setSearchListenerDelay(200);V.setPlaceholder(p);
V.addSearchListener(function(){fa(P,V.getText(),G,w,pa,y)});p=V.getJqUi();p.addClass("modeler-designer-field-popup-search");p.appendTo(da);G.addClass("modeler-designer-field-popup-list-owner");G.on("click",function(oa){var va=$(oa.currentTarget);oa=$(oa.target);if(oa=N.upwardSearchHasClass(oa,va,"modeler-designer-field-popup-list-item"))oa.addClass("modeler-designer-list-item_selected_enabled"),va=oa.data("model"),M(va)});G.appendTo(da);p=da.find(".sa-ctrl-textfield-input");p.css("top","0px");p.css("height",
"100%");if(0==P.length)e(G,L.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5"));else for(p=0;p<P.length;p++)pa(P[p],G,w);if(E){var U=L.get("showFieldName","\u663e\u793a\u539f\u5b57\u6bb5\u540d\u79f0");p=new k;p.setText(U);p=p.getJqUi();p.attr("title",U);p.addClass("modeler-designer-field-popup-show-field-name-label");U=new m;U.addStateChangeListener(function(oa,va,Da){(y=Da)?R&&R(G,!0):R&&R(G,!1)});U.setOn(!1);U=U.getJqUi();U.addClass("modeler-designer-field-popup-show-field-name-button");var ma=
$("<div>");ma.addClass("modeler-designer-field-popup-show-field-name");U.appendTo(ma);p.appendTo(ma);ma.appendTo(da)}else G.css("bottom","5px")}}var a;this.createChooseFieldPanel=function(P){a=P;P=new c;P.setListItemPainter(g);P.setSearchListener(b);P.setShowFieldNameListener(d);return P};var e=function(P,fa){var pa=new k;pa.setText(fa);pa.setEnabled(!1);pa.setAlign(k.ALIGN_CENTER);fa=pa.getJqUi();fa.addClass("modeler-designer-field-popup-no-data");fa.appendTo(P)},b=function(P,fa,pa,R,da,G){fa=fa.toLowerCase();
for(var y=[],E,t=0;t<P.length;t++)(E=P[t])&&(E=-1!=E.getAlias().toLowerCase().indexOf(fa)?!0:G&&-1!=E.getName().toLowerCase().indexOf(fa)?!0:!1)&&y.push(P[t]);pa.children().remove();if(0<y.length){for(t=0;t<y.length;t++)da(y[t],pa,R);y.length=0}else""==fa?e(pa,L.get("noFieldToSelect","\u65e0\u53ef\u9009\u5b57\u6bb5")):e(pa,L.get("noSearchResult","\u627e\u4e0d\u5230\u7b26\u5408\u7684\u7ed3\u679c"));d(pa,G)},d=function(P,fa){if(fa)for(P=P.find(".modeler-designer-field-popup-list-item-text-name"),fa=
0;fa<P.length;fa++){var pa=P.eq(fa);pa.css("display","inline-block");var R=pa.prev().text()+pa.text();pa.prev().attr("title",null);pa.parent().attr("title",R)}else for(P=P.find(".modeler-designer-field-popup-list-item-text-name"),fa=0;fa<P.length;fa++)pa=P.eq(fa),pa.css("display","none"),pa.parent().attr("title",null),pa.prev().attr("title",pa.prev().text())},g=function(P,fa,pa){var R=$("<div>");R.addClass("modeler-designer-field-popup-list-item");R.data("model",P);a(R,P);fa.append(R);pa&&P&&pa.getFullName()==
P.getFullName()&&H(fa,R)},H=function(P,fa){var pa=null;0<P.height()?(clearTimeout(pa),fa.addClass("modeler-designer-list-item_selected_enabled"),P.prop("scrollTop",fa.prop("offsetTop"))):pa=setTimeout(function(){H(P,fa)},0)}};C.CommonSvgIconHelper=function(){this.makeUrl=function(c){return"../qinganalysis/qingmodeler/designer/svgicon/"+c+".svg"};this.getTableIconColor=function(c){var a="#ffa500";if(c)switch(c.getSourceType()){case v.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:case v.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE:a=
"#A06AE2";break;case v.SOURCE_TYPE_MODEL_SET_SOURCE:a="#40A9FF";break;case v.SOURCE_TYPE_MODELSET_FILE_SOURCE:a="#F67682";break;case v.SOURCE_TYPE_OPEN_API_SOURCE:a="#73D13D"}return a}};C.AbstractDisplayNameHelper=function(){var c=this,a={};this.init=function(b){c.protectedInit(b);b=b.getAllNodes();a={};if(b)for(var d=0;d<b.length;d++)c.getNodeDisplayName(b[d])};this.protectedInit=function(b){};this.protectedGetDefaultName=function(b){throw Error("override me");};this.getNodeDisplayName=function(b){if(!b)return"";
var d=b.getAlias();if(d)return a[b.getId()]=d;d=b.getId();if(d=a[d])return d;var g=c.protectedGetDefaultName(b);d=b.getNameIndex();d=e(g,d);g=d[0];(d=d[1])&&b.setNameIndex(d);return a[b.getId()]=g};this.isDuplicate=function(b,d){for(var g=Object.keys(a),H=!1,P=0,fa=g.length;P<fa;P++)if(a[g[P]]==b&&(!d||d.getId()!=g[P])){H=!0;break}return H};var e=function(b,d){var g=d?b+"_"+d:b;var H=[g,d];c.isDuplicate(g)&&(H=e(b,d?d+1:1));return H};this.protectedMethod={cacheDisplayName:function(b,d){a[b]=d}}};
C.PageSizeHelper=function(){this.adaptSize=function(c){var a=c.getPage();var e=c.getAllNodes(),b=c.getPage();if(1>e.length)var d=[0,0,b.getWidth(),b.getHeight()];else{var g=e[0];b=g.getX();var H=g.getY();d=b+g.getWidth();g=H+g.getHeight();for(var P=1;P<e.length;P++){var fa=e[P];b=Math.min(b,fa.getX());H=Math.min(H,fa.getY());d=Math.max(d,fa.getX()+fa.getWidth());g=Math.max(g,fa.getY()+fa.getHeight())}d=[b-100,H-100,d+100,g+100]}H=a.getWidth();g=a.getHeight();e=-d[0];b=-d[1];H=d[2]-H;d=d[3]-g;if(0!=
e||0!=H||0!=b||0!=d){if(0!=e||0!=b)for(c=c.getAllNodes(),g=0;g<c.length;g++)P=c[g],P.setPosition(P.getX()+e,P.getY()+b);a.setExtension(e,b,H,d);return!0}return!1}};C.SelectFieldView=ha;C.AbstractLeftRightSelector=function(){var c=this,a,e,b,d,g,H,P;this.getJqUi=function(){a||(d=fa(">",!0,!1),g=fa(">>",!0,!0),H=fa("<",!1,!1),P=fa("<<",!1,!0),e=pa(c.protectedCreateLeftJqTitle(),c.protectedGetLeftCtrl()),b=pa(c.protectedCreateRightJqTitle(),c.protectedGetRightCtrl()),a=$("<div>"),a.append(e),a.append(b),
a.append(d.getJqUi()),a.append(H.getJqUi()),a.append(g.getJqUi()),a.append(P.getJqUi()));return a};this.relayout=function(){var R=a.prop("clientWidth"),da=a.prop("clientHeight");N.layoutCtrlWithLRTB(e,0,(R>>1)+36,null,0,0,null);N.layoutCtrlWithLRTB(b,(R>>1)+36,0,null,0,0,null);N.layoutCtrlWithLRTB(d.getJqUi(),null,null,null,null,(da>>1)+8,28);N.layoutCtrlCenterAlign(d.getJqUi(),40);N.layoutCtrlWithLRTB(H.getJqUi(),null,null,null,(da>>1)+8,null,28);N.layoutCtrlCenterAlign(H.getJqUi(),40);N.layoutCtrlWithLRTB(g.getJqUi(),
null,null,null,null,(da>>1)+56,28);N.layoutCtrlCenterAlign(g.getJqUi(),40);N.layoutCtrlWithLRTB(P.getJqUi(),null,null,null,(da>>1)+56,null,28);N.layoutCtrlCenterAlign(P.getJqUi(),40)};var fa=function(R,da,G){R=new ia(R);R.getJqUi().css({border:"1px solid #ddd","font-size":"18px"});R.addActionListener(function(y){c.protectedSelect(da,G)});return R},pa=function(R,da){var G=$("<div>");G.append(da.getJqUi());R?(G.append(R),N.layoutCtrlWithLRTB(R,0,0,null,0,null,20),N.layoutCtrlWithLRTB(da.getJqUi(),0,
0,null,22,0,null)):N.layoutCtrlWithLRTB(da.getJqUi(),0,0,null,0,0,null);return G};this.protectedCreateLeftJqTitle=function(){return null};this.protectedCreateRightJqTitle=function(){return null};this.protectedGetLeftCtrl=function(){throw Error("Implement");};this.protectedGetRightCtrl=function(){throw Error("Implement");};this.protectedSelect=function(R){throw Error("Implement");}};C.NoDataView=ja;var L,Z,N,k,z,x,q,Q,n,T,m,ia,X,D,A,I,aa,ca,S,l,u,r,v,h,J,B,f;(function(){var c=com.kingdee.bos.qing.common;
N=c.DomUtil;c=com.kingdee.bos.qing.framework.common;L=c.MultilanguageManager.createPackageAccessor(C);Z=c.WindowResizeObserver;c=com.kingdee.bos.qing.ui.component;q=c.AbstractModalDialog;k=c.Label;z=c.TextField;x=c.TextArea;Q=c.MessageCurtain;n=c.CheckBox;T=c.SearchBox;m=c.SwitchButton;ia=c.WorkButton;X=c.SplitPane;D=c.DynamicScroller;I=C.ActionChangeModelInfo;aa=C.ActionSetModel;ca=C.Toolbar;S=C.StatusBar;l=C.CommandManager;u=C.Icons;r=C.FolderNode;v=C.AbstractModelerSource;h=C.Meta;J=C.DesignerFacade;
A=C.QingModeler;B=C.MaterializedConfigDialog;f=C.UserOperationReporter})();C.SvgTextTrimer=new function(){var c,a,e;this.init=function(){e=$("<div>");N.layoutCtrl(e,-10,-10,10,10);c=new ba;var d=c.createNode("svg");c.setAttributes(d,{width:10,height:10});a=c.createNode("text");d.appendChild(a);e.append($(d));$(document.body).append(e);e.hide()};this.trim=function(d,g,H){e.show();c.setAttributes(a,{"font-size":g+"px"});g=b(d);for(var P=d,fa=1;g>H&&fa<d.length;)P=d.slice(0,d.length-fa)+"...",g=b(P),
fa++;e.hide();return P};this.measureText=function(d){e.show();d=b(d);e.hide();return d};var b=function(d){c.setText(a,d);return a.getComputedTextLength()}};C.DisplayNameHelper=new function(){var c;this.registerImpl=function(a){c=a};this.isDuplicate=function(a,e){if(!c)throw Error("need register first");return c.isDuplicate(a,e)};this.getNodeDisplayName=function(a){if(!c)throw Error("need register first");return c.getNodeDisplayName(a)}};ja.TYPE_TEXT="text";ja.TYPE_NO_SOURCE="noSource";ja.TYPE_NO_SEARCH_RESULT=
"noSearchResult";ja.TYPE_NO_DATA_WITH_CLOUD="noDataWithCloud";C.SelectFieldFactory=new function(){var c={};this.addSelectFieldToPanel=function(a,e){c[a]=e};this.createSelectFieldToDialog=function(a,e){var b=c[a];a=b?new b(a,e):new ha;return a}};C.SelectFieldFactory.addSelectFieldToPanel(v.SOURCE_TYPE_CURRENT_ENTITY_SOURCE,function(){za.call(this);var c=this,a,e,b;this.getJqUi=function(){if(!a){a=$("<div>");b=new ha;b.setMeta(c.getMeta());b.setCurrentTableName(c.getCurrentTableName());b.setSelectedPropertyName(c.getSelectedPropertyName());
var g=b.getJqUi(),H=new X;H.setHorizontalSplit(!0);H.setSplitLineWide(8);H.setResizeMode(X.RESIZE_MODE_FIRST_FIXED);H.setFirstSize(200,185,300);H.setSecondSize(c.getWidth()-250,350,-1);e=new qa;e.setFunUpdateProperties(d);e.setMeta(c.getMeta());H.setFirstChild(X.createChildWrapper(e.getJqUi()));H.setSecondChild(X.createChildWrapper(g));H.getJqUi().appendTo(a);e.setSelectedTableNames(c.getCurrentTableName().split(C.ENTITY_SEPARATOR))}return a};this.getIsEntityView=function(){return!0};this.getSelectedProperties=
function(){for(var g=[],H={},P=!0,fa=c.getCurrentTableName().split(C.ENTITY_SEPARATOR),pa=0;pa<fa.length;pa++){var R=fa[pa];R=b.getTableFieldMap()[R];for(var da=0;da<R.length;da++){var G=R[da],y=G.getField();H[y.getFullName()]||(G.getSelected()?(g.push(y),H[y.getFullName()]=!0):P=!1)}}return P?null:g};this.getSelectedEntityName=function(){return e.getSelectedEntityName()};var d=function(g,H){b.setArrProperties(g,H)}})})();(function(){function F(){var D=this,A,I,aa,ca,S,l,u,r;this.setCurrentNode=function(B){A=B};this.getCurrentNode=function(){return A};this.setModelerModel=function(B){I=B};this.setNodeStatusMonitor=function(B){aa=B};this.setDirty=function(B){ca=B};this.isDirty=function(){return ca};this.setMask=function(B){S=B};this.getMask=function(){return S};this.setInValidBackgroundPanel=function(B){l=B};this.getInValidBackgroundPanel=function(){return l};this.setModelerChecker=function(B){u=B};this.protectedGetModelerChecker=
function(){return u};this.clear=function(){A=null;D.protectedClear()};this.protectedClear=function(){throw Error("Implement me.");};this.showPreviewContent=function(){A?D instanceof ba?u.focusNodeValidity(A,v):u.focusNodeValidity(A,h):(S.hide(),l.setText(k.get("dataLoading","\u6570\u636e\u52a0\u8f7d\u4e2d")),l.show())};this.protectedGetModeler=function(){return I};var v=function(){D.isCurrentNodeValid()?(l.hide(),D.protectedShowPreviewContent()):(l.setText(J()),l.show())},h=function(){D.isCurrentNodeValid()?
(l.hide(),S.setClickCallback(D.protectedShowPreviewContent),S.show()):(S.hide(),l.setText(J()),l.show())};this.protectedShowPreviewContent=function(){throw Error("Implement me.");};this.afterResize=function(){console.log("preview area resize.....");aa&&aa.getSelected()&&D.protectedAfterResize()};this.protectedAfterResize=function(){throw Error("Implement me.");};this.setRuntimeModelGetter=function(B){r=B};this.getRuntimeModel=function(){if(A&&I)return r(I,A)};this.isCurrentNodeValid=function(){return A?
!aa.isInvalidNode(A.getId()):!0};var J=function(){var B=aa.getInvalidPrompt(A);return B?B:k.get("invalidNodeConfig","\u8282\u70b9#1\u8bbe\u7f6e\u4e0d\u5b8c\u6574").replace("#1",A.getAlias())}}function ba(){function D(u){KTDefaultCellRender.call(this,u);var r=this,v=this.paintCellUI;this.paintCellUI=function(h,J){var B=r.getCurrentRowIdx(),f=r.getCurrentRow(),c=r.getCurrentColIdx();f=f.getUserObject();if(B<z.getHeadRowCount())v(h,J);else if(0==c)J=$("<div>"),f=f.getName(),J.text(f),J.attr("title",
f),J.css("line-height","28px"),J.css("padding-left","2px"),J.css("padding-right","2px"),J.appendTo(h);else if(1==c)J=$("<div>"),f=f.getAlias(),J.text(f),J.attr("title",f),J.css("line-height","28px"),J.css("padding-left","2px"),J.css("padding-right","2px"),J.appendTo(h);else if(2==c){if(f=f.getSourceNodeId(),J=A.protectedGetModeler().getNode(f))f=$("<div>"),J=K.DisplayNameHelper.getNodeDisplayName(J),f.text(J),f.attr("title",J),f.css("line-height","28px"),f.css("padding-left","2px"),f.css("padding-right",
"2px"),f.appendTo(h)}else 3==c&&(J=$("<div>"),f=T.getDataTypeDesc(f.getAppointedDataType()),J.text(f),J.attr("title",f),J.css("line-height","28px"),J.css("padding-left","2px"),J.css("padding-right","2px"),J.appendTo(h))}}ja.AbstractTabPane.call(this);F.call(this);var A=this,I,aa,ca,S;this.getTitle=function(){return k.get("field","\u5b57\u6bb5")};this.getJqUi=function(){if(!I){I=$("<div>");aa&&l();var u=new Y,r=u.getJqUi();A.setMask(u);u.hide();q.layoutCtrlWithLRTB(r,0,0,null,0,0,null);I.append(r);
u=new ha;r=u.getJqUi();u.hide();A.setInValidBackgroundPanel(u);q.layoutCtrlWithLRTB(r,0,0,null,0,0,null);I.append(r)}return I};this.into=function(){!aa||A.isDirty()?(A.showPreviewContent(),A.setDirty(!1)):A.afterResize()};this.protectedAfterResize=function(){ca&&aa&&0!=aa.length&&ca.relayoutViews()};this.setRemoteImpl=function(u){};this.protectedClear=function(){aa=null};this.reload=function(){A.showPreviewContent()};this.protectedShowPreviewContent=function(){K.NodeFieldHelper.asynGetFields(A.getGlobal().getModelerModel(),
A.getCurrentNode(),function(u){aa=u;ca||l();z.clear(ca);ca.addColumns(4);ca.getColumn(0).setWidth(200);ca.getColumn(1).setWidth(200);ca.getColumn(2).setWidth(140);ca.getColumn(3).setWidth(140);u=z.createHeadRow(ca);u.getCell(0).setValue(k.get("fieldName","\u5b57\u6bb5\u540d\u79f0"));u.getCell(1).setValue(k.get("fieldAlias","\u663e\u793a\u540d\u79f0"));u.getCell(2).setValue(k.get("tableSource","\u6765\u6e90\u8868"));u.getCell(3).setValue(k.get("dataType","\u6570\u636e\u7c7b\u578b"));if(aa){u=0;for(var r=
aa.length;u<r;u++)z.createRow(ca).setUserObject(aa[u])}z.refresh(ca)},function(){},I)};var l=function(){ca=z.createTable();ca.setColumnFitVisibleWidth(!0);var u=new D(ca);u.setOutsideVisible(!1);ca.setCellRender(u);ca.setSyncUIWhenModelChanged(!0);S=$(ca.getUI());q.layoutCtrlWithLRTB(S,10,10,null,10,10,null);S.appendTo(I)}}function qa(){function D(c){KTDefaultCellRender.call(this,c);var a=this,e=this.paintCellUI;this.paintCellUI=function(b,d){var g=a.getCurrentRowIdx(),H=a.getCurrentRow(),P=a.getCurrentColIdx();
H=H.getUserObject();if(g<z.getHeadRowCount())e(b,d);else{d=l.getField(P);g=d.getOutputDataType();P=H[P];if(null==P||void 0==P)P="";else if(g==m.DT_DATE)H=new Q,H.setFormatString("yyyy-MM-dd"),P=H.format(P);else if(g==m.DT_DATETIME)H=new Q,H.setFormatString("yyyy-MM-dd HH:mm:ss"),P=H.format(P);else if(g==m.DT_BOOLEAN)P=void 0===P?"":P?"true":"false";else if(g==m.DT_NUMBER&&(H=d.getScale()))for(P+="",d=P.split("."),2>d.length?(P+=".",d=""):d=d[1],H-=d.length,d=0;d<H;d++)P+="0";H=$("<div>");H.text(P);
H.attr("title",P);H.css("line-height","28px");H.css("padding-left","2px");H.css("padding-right","2px");H.appendTo(b)}}}ja.AbstractTabPane.call(this);F.call(this);var A=this,I,aa,ca,S,l,u=1E3,r=100,v=!1,h;this.getTitle=function(){return k.get("preview","\u9884\u89c8")};this.getJqUi=function(){if(!I){I=$("<div>");var c=$("<div>");c.css("cursor","pointer");c.attr("title",k.get("previewSet","\u9884\u89c8\u8bbe\u7f6e"));c.on("click",f);x.backgroundWithHover(c,"setting");q.layoutCtrl(c,10,3,20,20);c.appendTo(I);
h=$("<div>");q.layoutCtrlWithLRTB(h,40,10,null,5,null,20);h.css({"font-size":"14px",color:"#666",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"});h.appendTo(I);B();c=new Y;var a=c.getJqUi();A.setMask(c);c.hide();q.layoutCtrlWithLRTB(a,5,5,null,28,5,null);I.append(a);c=new ha;a=c.getJqUi();A.setInValidBackgroundPanel(c);c.hide();q.layoutCtrlWithLRTB(a,5,5,null,28,5,null);I.append(a);J()}return I};this.setRemoteImpl=function(c){aa=c};this.into=function(){!l||A.isDirty()?(A.showPreviewContent(),
A.setDirty(!1)):A.afterResize()};this.protectedAfterResize=function(){ca&&l&&0!=l.getRowCount()&&ca.relayoutViews()};this.protectedClear=function(){l=null};this.reload=function(){A.showPreviewContent()};this.protectedShowPreviewContent=function(){var c=A.getRuntimeModel();if(c){var a=(new Date).getTime(),e=new n(aa,function(d){var g=A.getCurrentNode(),H=new X;H.fromJsonObject(d);if(d=H.getValidity())A.protectedGetModelerChecker().updateNodeValidity(d,a);else if(d=H.getPreviewData(),g&&H.getNodeId()==
g.getId()&&(l=d,l&&0!=l.getRowCount()||(A.getMask().hide(),A.getInValidBackgroundPanel().setText(k.get("noData","\u5f53\u524d\u9884\u89c8\u89c4\u5219\u4e0b,\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e")),A.getInValidBackgroundPanel().show()),ca||B(),l)){S||(S=$(ca.getUI()),q.layoutCtrlWithLRTB(S,10,10,null,30,10,null),S.appendTo(I));d=l.getColumnCount();g=l.getRowCount();z.clear(ca);if(0!=d&&0!=g){ca.addColumns(d);var P=z.createHeadRow(ca);for(H=0;H<d;H++)ca.getColumn(H).setWidth(150),P.getCell(H).setValue(l.getField(H).getAlias());
for(H=0;H<g;H++)d=l.getOneRow(H),z.createRow(ca).setUserObject(d)}z.refresh(ca)}},function(d,g){return K.DppVersionExceptionHandler.handle(d)}),b=new ia;v?b.setExtractAllDataAndPreviewCount(r):b.setExtractPartlyData(u,r);c.setPreviewConfig(b);e.setBlockingJqUi(I);e.getPreviewData(c)}};var J=function(){var c=v?k.get("extractAllData","\u62bd\u53d6\u5168\u91cf\u6570\u636e\u8fdb\u884c\u8ba1\u7b97, "):k.get("onlyExtractSomeRows","\u4ec5\u62bd\u53d6\u524d#1\u884c\u8fdb\u884c\u8ba1\u7b97, ").replace("#1",
u);c+=k.get("previewRows","\u663e\u793a\u8ba1\u7b97\u7ed3\u679c\u7684\u524d#1\u884c\u6570\u636e").replace("#1",r);h.text(c)},B=function(){ca=z.createTable();ca.setColumnFitVisibleWidth(!1);var c=new D(ca);c.setOutsideVisible(!1);ca.setCellRender(c);ca.setSyncUIWhenModelChanged(!0)},f=function(){var c=new za;c.setTitle(k.get("previewSet","\u9884\u89c8\u8bbe\u7f6e"));c.setOriginExtractCount(u);c.setOriginPreviewCount(r);c.setAllData(v);c.setConfirmCallback(function(a,e,b){v=a;u=e;r=b;A.showPreviewContent();
J()});c.showDialog()}}function za(){Z.call(this);var D=this.protectedMethod,A=this,I,aa,ca,S,l=!1,u=!1,r,v,h;(function(){D.setSelectable(!0);D.setContentPaneCreator(function(){A.setSize(440,330);return J()});D.setFooterPaneCreator(function(a){var e=new N(k.get("confirm","\u786e\u5b9a"));e.setHighlight(!0);var b=e.getJqUi();b.addClass("sa-ctrl-dialog-footer-ok");b.appendTo(a);e.addActionListener(function(d){d=I.getValue();var g=aa.getValue();h&&h(l,d,g,u);D.destroy();return!0});e=new N(k.get("cancel",
"\u53d6\u6d88"));e.setHighlight(!1);b=e.getJqUi();b.addClass("sa-ctrl-dialog-footer-cancel");b.appendTo(a);e.addActionListener(function(d){D.destroy();return!0})});D.setClosingAction(function(a){})})();this.setTitle=function(a){r=a};this.setOriginExtractCount=function(a){ca=a};this.setOriginPreviewCount=function(a){S=a};this.setAllData=function(a){l=a};this.setAllDataPreview=function(a){u=a};this.isCreatePreviewAllBtn=function(a){v=a};this.setConfirmCallback=function(a){h=a};var J=function(){D.setTitle(r);
var a=$("<div>"),e=$("<div>");e.text(k.get("extractSet","\u62bd\u53d6\u8bbe\u7f6e"));q.layoutCtrl(e,30,20,100,24);e.appendTo(a);e.css({color:"#333333","line-height":"24px","font-size":"14px"});e=f("extract",k.get("extract","\u62bd\u53d6\u524d"),a);var b=e.getJqUi();q.layoutCtrlWithLRTB(b,60,null,300,60,null,null);I=new na;var d=I.getJqUi();I.setConstraint(1,1E4,1);I.setValue(ca);q.layoutCtrlWithLRTB(d,120,null,100,49,null,null);d.appendTo(a);d=$("<div>");d.text(k.get("rowDataCalculate","\u884c\u6570\u636e\u8ba1\u7b97"));
d.css("color","#666");q.layoutCtrlWithLRTB(d,170,0);q.layoutCtrlMiddleAlign(d,22);d.appendTo(b);b=f("extractAll",k.get("all","\u5168\u91cf"),a);d=b.getJqUi();q.layoutCtrlWithLRTB(d,60,null,300,90,null,null);var g=$("<div>");x.background(g,"warning");g.attr("title",k.get("extractAllWarn","\u62bd\u53d6\u5168\u91cf\u6570\u636e\u8ba1\u7b97\u65f6\uff0c\u4f1a\u589e\u52a0\u6570\u636e\u9884\u89c8\u7684\u65f6\u957f\uff0c\u589e\u52a0\u670d\u52a1\u5668\u538b\u529b\uff0c\n\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\uff0c\u56e0\u6b64\u63a8\u8350\u62bd\u53d6\u90e8\u5206\u6570\u636e\u3002"));
q.layoutCtrlWithLRTB(g,110,null,20,79,null,20);g.appendTo(a);d=new C;d.addElement(e);d.addElement(b);d.addChangedListener(function(H,P){P&&("extract"==H.getUserObject()?(l=!1,I.setEnabled(!0),g.hide()):(l=!0,I.setEnabled(!1),g.show()))});l?(c(d,"extractAll"),I.setEnabled(!1),g.show()):(c(d,"extract"),I.setEnabled(!0),g.hide());e=$("<div>");e.text(k.get("dataPreview","\u6570\u636e\u9884\u89c8"));q.layoutCtrl(e,30,115,100,24);e.appendTo(a);e.css({color:"#333333","line-height":"24px","font-size":"14px"});
e=f("dataPreview",k.get("previewResult","\u9884\u89c8\u8ba1\u7b97\u7ed3\u679c\u7684\u524d"),a);e.setChecked(!0);b=e.getJqUi();q.layoutCtrlWithLRTB(b,60,null,300,155,null,null);aa=new na;d=aa.getJqUi();aa.setConstraint(1,1E3,1);aa.setValue(S);q.layoutCtrlWithLRTB(d,180,null,100,144,null,null);d.appendTo(a);d=$("<div>");d.text(k.get("rowData","\u884c\u6570\u636e"));d.css("color","#666");q.layoutCtrlWithLRTB(d,230,0);q.layoutCtrlMiddleAlign(d,22);d.appendTo(b);v&&B(a,e);return a},B=function(a,e){var b=
f("PreviewAll",k.get("all","\u5168\u91cf"),a),d=b.getJqUi();q.layoutCtrlWithLRTB(d,60,null,300,185,null,null);var g=$("<div>");x.background(g,"warning");g.attr("title",k.get("PreviewAllWarn","\u9884\u89c8\u5168\u91cf\u6570\u636e\u8ba1\u7b97\u65f6\uff0c\u4f1a\u589e\u52a0\u6570\u636e\u9884\u89c8\u7684\u65f6\u957f\uff0c\u589e\u52a0\u670d\u52a1\u5668\u538b\u529b\uff0c\n\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\uff0c\u56e0\u6b64\u63a8\u8350\u9884\u89c8\u90e8\u5206\u6570\u636e\u3002"));q.layoutCtrlWithLRTB(g,
110,null,20,175,null,20);g.appendTo(a);a=new C;a.addElement(e);a.addElement(b);a.addChangedListener(function(H,P){P&&("dataPreview"===H.getUserObject()?(u=!1,aa.setEnabled(!0),g.hide()):(u=!0,aa.setEnabled(!1),g.show()))});u?(c(a,"PreviewAll"),aa.setEnabled(!1),g.show()):(c(a,"dataPreview"),aa.setEnabled(!0),g.hide())},f=function(a,e,b){var d=new L;d.setUserObject(a);d.setText(e);a=d.getJqUi();b.append(a);return d},c=function(a,e){a.toCheckTheElement(function(b){return b.getUserObject()===e})}}function ha(){var D,
A;this.getJqUi=function(){D||(D=$("<div>"),D.addClass("modeler-designer-preview-no-data-background"),A=$("<div>"),A.addClass("modeler-designer-preview-no-data-text"),A.appendTo(D));return D};this.setText=function(I){A.text(I)};this.hide=function(){D.hide()};this.show=function(){D.show()}}function Y(){var D=this,A,I;this.setClickCallback=function(ca){I=ca};this.getJqUi=function(){A||aa();return A};var aa=function(){A=$("<div>");A.addClass("modeler-designer-preview-mask");var ca=$("<div>");ca.text(k.get("refreshPreviewData",
"\u7f16\u8f91\u5b8c\u6210\u540e\uff0c\u70b9\u51fb\u6b64\u5904\u5237\u65b0\u9884\u89c8\u6570\u636e\u3002"));ca.on("click",function(S){D.hide();I&&I()});ca.addClass("modeler-designer-preview-mask-button");ca.appendTo(A)};this.show=function(){A.show()};this.hide=function(){A.hide()}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==
typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var K=com.kingdee.bos.qing.modeler.designer;K.AbstractPreviewArea=function(){var D=this,A,I,aa,ca,S,l,u,r,v,h,J=!1,B;this.protectedModelerPropChangeListener=function(b,d){};this.protectedGetRuntimeModel=function(b,d){throw Error("override me");};this.getJqUi=function(){S||f();return S};this.setModelerModel=function(b){A&&A.removePropertyChangeCallback(e);
A=b;A.addPropertyChangeCallback(e)};this.setModelerChecker=function(b){v=b};this.setNodeStatusMonitor=function(b){I&&I.removeSelectNodeListener(c);I&&I.removeInvalidNodeChangeListener(a);I=b;I.addSelectNodeListener(c);I.addInvalidNodeChangeListener(a)};this.setGlobal=function(b){aa=b};this.setRemoteImpl=function(b){ca=b};this.setHideListener=function(b){h=b};this.show=function(b){J!=!b&&((J=!b)||l.getCurrentTabPane().into())};var f=function(){S=$("<div>");u=new ba;r=new qa;u.setRemoteImpl(ca);r.setRemoteImpl(ca);
r.setNodeStatusMonitor(I);u.setNodeStatusMonitor(I);r.setModelerChecker(v);u.setModelerChecker(v);r.setRuntimeModelGetter(D.protectedGetRuntimeModel);u.setRuntimeModelGetter(D.protectedGetRuntimeModel);l=new ja;l.setTabLevel(ja.SECOND_LEVEL);l.addTab(u,!0);l.addTab(r);var b=$("<div>");x.background(b,"downArrow");q.layoutCtrlWithLRTB(b,null,5,16,8,null,16);b.css("cursor","pointer");b.on("click",function(){J=!0;h&&h()});b.appendTo(S);S.append(l.getJqUi())},c=function(b,d){r.clear();u.clear();d&&(B=
I.getInvalidState(d),b=aa.getModelerModel(),u.setCurrentNode(d),u.setModelerModel(b),r.setCurrentNode(d),r.setModelerModel(b));J||(d=l.getCurrentTabPane(),(b=d.getJqUi().find(".sa-common-loading-modallayer"))&&b.remove(),d.showPreviewContent())},a=function(b){if(b=l.getCurrentTabPane())if(b=b.getCurrentNode()){b=I.getInvalidState(b);if(B!=b&&!J){var d=l.getCurrentTabPane();d.reload();d==r?u.setDirty(!0):r.setDirty(!0)}B=b}},e=function(b,d){D.protectedModelerPropChangeListener(b,d)};this.afterResize=
function(){l.getCurrentTabPane().afterResize()}};K.PreviewCountSetDialog=za;var ja,na,C,L,Z,N,k,z,x,q,Q,n,T,m,ia,X;(function(){var D=com.kingdee.bos.qing.ui.component;ja=D.TabContainer;na=D.Spinner;C=D.RadioButtonGroup;L=D.RadioButton;Z=D.AbstractModalDialog;N=D.Button;D=com.kingdee.bos.qing.common.ui;z=D.TableUtil;D=com.kingdee.bos.qing.common;q=D.DomUtil;Q=D.DateFormater;D=com.kingdee.bos.qing.framework.common;k=D.MultilanguageManager.createPackageAccessor(K);n=K.DesignerFacade;m=K.Field;T=K.PropDataTypeUtil;
ia=K.PreviewConfig;x=K.Icons;X=K.ExecuteResult})()})();(function(){function F(){var G,y,E,t,p,w,M,V;this.setTableArea=function(ea){};this.setGlobal=function(ea){M=ea};this.getGlobal=function(){return M};this.setRemoteImpl=function(ea){};this.setModelerModel=function(ea){y&&y.removePropertyChangeCallback(oa);y=ea;y.addPropertyChangeCallback(oa);U()};this.getJqUi=function(){if(!G){G=$("<div>");G.addClass("modeler-designer-workarea");G.addClass("modeler-designer-common-border");var ea=$("<div>");ea.addClass("modeler-designer-workarea-title");var O=$("<div>");
O.addClass("modeler-designer-workarea-title-text");O.text(S.get("source","\u6570\u636e\u6e90"));ea.append(O);O=$("<div>");O.addClass("modeler-designer-workarea-title-btn");R.backgroundWithHover(O,"add");O.on("click",ma);O.attr("title",S.get("selectDataSource","\u9009\u62e9\u6570\u636e\u6e90"));O.appendTo(G);E=$("<div>");E.addClass("modeler-designer-workarea-container");t=new J;t.setBorderVisible(!1);t.setToggleSelectingEnabled(!1);t.setCustomItemPainter(Da);t.setCustomSelectedsPainter(Aa);t.addSelectedChangedListener(sa);
p=t.getJqUi();p.appendTo(E);ca.layoutCtrlWithLRTB(p,0,0,null,0,0,null);G.append(ea);G.append(E);U()}return G};this.showDialogIfNoSource=function(){var ea=y.getAllSource();if(!ea||0==ea.length){var O=ma();ea=new l;ea.setCallbackImmediately(function(){O.updateTable()});ea.observe()}};var U=function(){if(y){var ea=y.getAllSource();t.setItemModels(ea);if(ea&&0!=ea.length){w&&w.hide();var O=!1,la=t.getSelecteds();if(la)for(var ya=0;ya<la.length;ya++)for(var ta=la[ya],W=0;W<ea.length;W++){var wa=ea[W];
if(wa==ta){O=!0;1===ea.length&&(la.push(null),t.setSelecteds([wa]));break}}O||t.setSelecteds([ea[0]]);p.show()}else p.hide(),w||(w=$("<div>"),w.appendTo(G),w.addClass("modeler-designer-sourcearea-nosource"),ea=$("<div>"),ea.appendTo(w),R.background(ea,"no_data_cloud"),ca.layoutCtrlCenterAlign(ea,138),ca.layoutCtrl(ea,null,0,null,78),ea=$("<div>"),ea.text(S.get("selectDataSource","\u9009\u62e9\u6570\u636e\u6e90")),ea.attr("title",S.get("selectDataSource","\u9009\u62e9\u6570\u636e\u6e90")),ea.on("click",
ma),ea.appendTo(w),ea.addClass("modeler-designer-sourcearea-text-add")),w.show()}},ma=function(){var ea=new ba;ea.setGlobal(M);ea.setSelectedCallback(va);ea.setModeler(y);ea.showDialog();return ea},oa=function(ea){if(ea==q.KEY_ADD_PREPARED_SOURCE||ea==q.KEY_REMOVE_PREPARED_SOURCE||ea==q.KEY_SET_PREPARED_SOURCE)console.log("update source area ui"),U()},va=function(ea,O){if(ea&&0!=ea.length||O&&0!=O.length){var la=new X;la.setValue(ea,O,y);M.getCommandManager().perform(la)}},Da=function(ea,O){ea.css("height",
"30px");ea.css("cursor","pointer");var la=O.getSourceType();if(la){var ya=O.getName();ya||(ya=da.createSourceNameByType(la),O.setName(ya));ea.attr("name",ya);var ta=0,W=M.getIntegration().getMapSourcePermission();if(W)for(var wa=Object.keys(W),Ca=0;Ca<wa.length;Ca++)if(wa[Ca]===O.getSourceId()){wa=W[wa[Ca]];if(!wa)break;W=wa.errorCode;W!=F.CURRENT_USER_NOPERMISSION_PUBLIC_SOURCE_ERRORCODE&&W!=F.CURRENT_USER_NOPERMISSION_DATACENTER_ERRORCODE&&(ta=da.createExceptionIcon(wa.errorMessage),ta.addClass("modeler-designer-sourcearea-exception-icon"),
ta.appendTo(ea),ta=22);ea.data("errorCode",W);break}W=$("<div>");W.addClass("modeler-designer-sourcearea-icon");W.css("top","9px");R.background(W,da.getSourceIconName(la));W.css("left",12+ta+"px");W.appendTo(ea);W=$("<div>");W.text(ya);W.addClass("modeler-designer-sourcearea-name");W.css("left",34+ta+"px");W.attr("title",S.get("name","\u540d\u79f0")+"\uff1a"+ya+"\n"+S.get("type","\u7c7b\u578b")+"\uff1a"+da.translateSourceType(la));W.appendTo(ea)}else da.updateDeletedSourceStatus(ea);var Ea=$("<div>");
Ea.addClass("modeler-designer-sourcearea-delete-btn");Ea.on("mousedown",function(La){La.stopPropagation();y.isSourceUsed(O)?M.getMessageCurtain().showPrompt(S.get("theSourceIsUsed","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u6570\u636e\u8868\u6a21\u578b\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u7a97\u53e3\u5220\u9664\u8be5\u6570\u636e\u6e90\u4e0b\u7684\u8868\uff0c\u518d\u5220\u9664\u6570\u636e\u6e90\u3002")):Ba().setClosingChecker(function(Sa){Sa==d.RETURN_OK&&(Sa=new ia,Sa.setValue(O,y),M.getCommandManager().perform(Sa),
ea.is(V)&&L.SourceConnectStep.removeTableTree(),ea.remove());return!0})});R.backgroundWithHover(Ea,"delete");Ea.appendTo(ea);Ea.hide();ea.mouseenter(function(){Ea.show()}).mouseleave(function(){Ea.hide()})},Aa=function(ea,O){O&&0<O.length&&(ea&&0<ea.length&&(ea=ea[0],ea.css("background-color",""),ea.css("color","")),O=O[0],O.css("background-color","#eff3fd"),O.css("color","rgb(130, 130, 130)"))},sa=function(ea,O,la){ea=la[0];V=O=t.getItemUiByModel(ea);L.ConnectSourceCreator.getSourceConnector(ea,
O).getFunConnectSource()()},Ba=function(){var ea=d.createFeedbackDialog();ea.setMsgImageType(d.MSG_DELETE);ea.setOptionType(d.OPTION_OK_CANCEL);ea.setMessage(S.get("confirmDeleteSource","\u786e\u5b9a\u5220\u9664\u8be5\u6570\u636e\u6e90\u5417\uff1f"));ea.showDialog();return ea}}function ba(){r.call(this);var G=this,y=this.protectedMethod,E,t,p,w;(function(){y.setTitle(S.get("selectDataSource","\u9009\u62e9\u6570\u636e\u6e90"));G.setSize(791,600);y.setSelectable(!0);y.setContentPaneCreator(function(){E=
new za;E.setRemoteImpl(L.ModelSetSourceIntegration.getRemoteImpl());var V=$("<div>");E.setArrExistsSource(p.getAllSource());E.setContainer(V);E.setMultiSelect(!0);E.loadDataSource();return V});y.setFooterPaneCreator(function(V){var U=new u(S.get("confirm","\u786e\u5b9a"));U.setHighlight(!0);var ma=U.getJqUi();ma.addClass("sa-ctrl-dialog-footer-ok");ma.appendTo(V);U.addActionListener(function(oa){oa=E.getSelected();E.getTable()?M(oa):y.destroy()});U=new u(S.get("cancel","\u53d6\u6d88"));U.setHighlight(!1);
ma=U.getJqUi();ma.addClass("sa-ctrl-dialog-footer-cancel");ma.appendTo(V);U.addActionListener(function(oa){y.destroy();return!0})});y.setClosingAction(function(V){})})();this.setGlobal=function(V){w=V};this.updateTable=function(){var V=$(document.body),U=V.prop("clientWidth");V=V.prop("clientHeight");U=Math.max(0,U-791>>1);V=Math.max(0,V-600>>1);y.getDialogCtrl().setBounds(U,V,791,600);E.updateUiByObserver()};this.setSelectedCallback=function(V){t=V};this.setModeler=function(V){p=V};var M=function(V){(new (L.ModelSetSourceIntegration.getModelSetSourceFacade())(L.ModelSetSourceIntegration.getRemoteImpl(),
function(U){for(var ma,oa=0,va=0;va<V.length;va++){for(var Da=!1,Aa=0;Aa<U.length;Aa++)if(V[va].getId()==U[Aa].id){Da=!0;break}Da||(oa++,1==oa&&(ma=V[va].getSourceName()))}if(0<oa){E.rePaintSource(U);if(1<oa){var sa=S.get("moreSourceDeleted","\u201c#1\u201d\u7b49#N\u4e2a\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");sa=sa.replace("#N",""+oa)}else sa=S.get("sourceDeleted","\u201c#1\u201d\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");
sa=sa.replace("#1",ma);y.getMessageCurtain().showPrompt(sa)}else{oa=0;U=!0;va=!1;ma=[];Da=p.getAllSource();for(Aa=0;Aa<Da.length;Aa++){for(var Ba=Da[Aa],ea=!1,O=V.length-1;0<=O;O--)Ba.getSourceId()===V[O].getId()&&(ea=!0,V.splice(O,1));ea||(p.isSourceUsed(Ba)?(oa++,(Ba=Ba.getName())?U&&(U=!1,sa=Ba):va=!0):ma.push(Ba))}if(0<oa)va?ma=S.get("sourceIsDeleted","\u5f53\u524d\u8bbe\u8ba1\u5668\u4e2d\u5b58\u5728\u5df2\u88ab\u5220\u9664\u7684\u6570\u636e\u6e90\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u5668\u4e2d\u5220\u9664\u8be5\u6570\u636e\u6e90\uff0c\u518d\u91cd\u65b0\u9009\u62e9\u6570\u636e\u6e90\u3002"):
(1<oa?(ma=S.get("moreSourceIsUsed","\u201c#1\u201d\u7b49#N\u4e2a\u6570\u636e\u6e90\u5df2\u88ab\u6570\u636e\u8868\u6a21\u578b\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u7a97\u53e3\u5220\u9664\u6570\u636e\u6e90\u4e0b\u7684\u8868\uff0c\u518d\u53d6\u6d88\u52fe\u9009\u6570\u636e\u6e90\u3002"),ma=ma.replace("#N",""+oa)):ma=S.get("sourceIsUsed","\u201c#1\u201d\u6570\u636e\u6e90\u5df2\u88ab\u6570\u636e\u8868\u6a21\u578b\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u7a97\u53e3\u5220\u9664\u6570\u636e\u6e90\u4e0b\u7684\u8868\uff0c\u518d\u53d6\u6d88\u52fe\u9009\u6570\u636e\u6e90\u3002"),
ma=ma.replace("#1",sa)),y.getMessageCurtain().showPrompt(ma),E.rePaintSource();else{if(w.getIntegration()&&(sa=w.getIntegration().getMapSourcePermission()))for(oa=Object.keys(sa),U=0;U<V.length;U++)for(va=0;va<oa.length;va++)if(oa[va]==V[U].getId()){sa[oa[va]]=null;break}sa=[];for(oa=0;oa<V.length;oa++)U=new k,U.setName(V[oa].getSourceName()),U.setSourceType(V[oa].getSourceType()),U.setId(L.UIDHelper.getUID(L.UIDHelper.NS_SOURCE)),U.setSourceId(V[oa].getId()),U.setModelId(L.ModelSetSourceIntegration.getModelId()),
sa.push(U);t&&t(sa,ma);y.destroy()}}})).designerLoadSources()}}function qa(G,y,E){r.call(this);var t=this,p=this.protectedMethod,w,M,V,U,ma,oa=[],va,Da,Aa,sa;(function(){y?p.setTitle(S.get("EditSQL","\u7f16\u8f91SQL/KSQL")):p.setTitle(S.get("customSQL","\u81ea\u5b9a\u4e49SQL/KSQL"));t.setSize(590,450);p.setSelectable(!0);var Ba=function(){p.destroy()},ea=function(){V.setTableName(w.getText().trim());V.setDisplayName(w.getText());var O=new T,la=va.isChecked()?"SQL":"KSQL";O.setSqlType(la);O.setContent(M.getText());
V.setUserSql(O);(new z(G,function(ya){for(ya=0;ya<oa.length;ya++)(0,oa[ya])(V,U);Ba()},function(ya,ta){p.getMessageCurtain().showError(ta);return!0})).checkUserSqlExecutable(la,M.getText(),ma.getSourceId(),V.getNamespace())};p.setContentPaneCreator(function(){var O=$("<div>"),la=new H;la.setText(S.get("name","\u540d\u79f0"));la=la.getJqUi();w=new P;V.getTableName()&&w.setText(V.getTableName());var ya=w.getJqUi(),ta=new v;va=new h;va.setText("SQL");va.setChecked(!0);Da=new h;Da.setText("KSQL");ta.addElement(va);
ta.addElement(Da);ta=va.getJqUi();var W=Da.getJqUi(),wa=new H;wa.setText(S.get("SQLContent","\u5185\u5bb9"));wa=wa.getJqUi();M=new fa;if(V&&V.getUserSql()){var Ca=V.getUserSql();"KSQL"==Ca.getSqlType()&&Da.setChecked(!0);M.setText(Ca.getContent())}Ca=M.getJqUi();O.append(la);O.append(ya);O.append(ta);E&&O.append(W);O.append(wa);O.append(Ca);var Ea=12;ca.layoutCtrl(la,10,Ea,80,23);ca.layoutCtrl(ya,90,Ea,420,23);ca.layoutCtrl(wa,10,Ea+=50,80,23);ca.layoutCtrl(ta,90,Ea,80,23);ca.layoutCtrl(W,170,Ea,
80,23);ca.layoutCtrl(Ca,90,Ea+50,420,200);return O});p.setFooterPaneCreator(function(O){var la=new u(S.get("confirm","\u786e\u5b9a"));la.setHighlight(!0);var ya=la.getJqUi();ya.addClass("sa-ctrl-dialog-footer-ok");ya.appendTo(O);la.addActionListener(function(ta){ta="";var W=w.getText().trim(),wa=M.getText().toLowerCase();0==W.length?ta=S.get("nameIsEmptyPrompt","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a\u3002"):50<W.length?ta=S.get("nameTooLongPrompt","\u540d\u79f0\u4e0d\u53ef\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002"):
0<W.indexOf(" ")?ta=S.get("nameWithSpace","\u540d\u79f0\u4e0d\u80fd\u643a\u5e26\u7a7a\u683c\u3002"):/^[\u4E00-\u9FA5A-Za-z0-9_]+$/.test(W)?wa&&""!=$.trim(wa)?0!=wa.trim().toLowerCase().indexOf("select")?ta=S.get("onlyAllowSelection","\u53ea\u5141\u8bb8\u67e5\u8be2\u64cd\u4f5c\u3002"):-1==wa.indexOf("from")&&-1==wa.indexOf("FROM")&&(ta=S.get("sqlError","sql\u6267\u884c\u51fa\u9519\uff0c\u8bf7\u68c0\u67e5sql\u8bed\u53e5\u3002")):ta=S.get("noQuery","\u8bf7\u8f93\u5165\u67e5\u8be2\u8bed\u53e5\u3002"):
ta=S.get("invalidName","\u540d\u79f0\u53ea\u80fd\u4f7f\u7528\u4e2d\u6587\u3001\u6570\u5b57\u3001\u5b57\u6bcd\u6216\u4e0b\u5212\u7ebf\u3002");0<ta.length?p.getMessageCurtain().showPrompt(ta):(ta=w.getText().trim(),y?(W=U.getTableName(),ta=Aa(ta,W)):ta=Aa(ta,void 0),ta?p.getMessageCurtain().showPrompt(S.get("duplicateNameTips","\u540d\u79f0\u91cd\u590d\u3002")):sa&&sa(ea,Ba,y))});la=new u(S.get("cancel","\u53d6\u6d88"));la.setHighlight(!1);ya=la.getJqUi();ya.addClass("sa-ctrl-dialog-footer-cancel");
ya.appendTo(O);la.addActionListener(function(ta){p.destroy();return!0})});p.setClosingAction(function(O){})})();this.setModel=function(Ba){V=Ba;y&&(U=Ba.clone())};this.getModel=function(){return V};this.setSource=function(Ba){ma=Ba};this.addConfirmListener=function(Ba){oa.push(Ba)};this.setTableNameChecker=function(Ba){Aa=Ba};this.setPermAndConnChecker=function(Ba){sa=Ba}}function za(){function G(ra){KTDefaultCellRender.call(this,ra);var Ha=this,Ka=this.paintCellUI;this.paintCellUI=function(Ja,Ia){var Qa=
Ha.getCurrentRowIdx(),Ga=Ha.getCurrentRow(),Oa=Ha.getCurrentColIdx();Ga=Ga.getUserObject();var Ma=new c;Ma.setFormatString("yyyy-MM-dd HH:mm:ss");Ha.setPaddingHV(8,1);if(Qa<f.getHeadRowCount()){if(Ka(Ja,Ia),0===Oa&&1===Qa){if(!O)return;Ga=Da&&Da.isChecked();Da=new a;Da.setChecked(Ga);Da.addCheckedListener(function(ka,ua){if(ua){ua=Object.keys(Aa);for(var xa=0;xa<ua.length;xa++)Aa[ua[xa]].setChecked(ka.isChecked())}});Ga=Da.getJqUi();ca.layoutCtrl(Ga,12,0,14,18);Ga.appendTo(Ja)}}else if(0===Oa)Ga=
O?Va(Ga):Wa(Ga),ca.layoutCtrl(Ga,12,4,14,18),Ga.appendTo(Ja);else if(1===Oa){Ma=$("<div class='modeler-designer-addsource-name-info'>");Qa=$("<span class='modeler-designer-addsource-cell-item-name'>");Oa=Ga.getSourceName();var Pa=Ga.getErrorMessage(),Ta=Ra(Ga);Pa&&(Pa=da.createExceptionIcon(Pa),ca.layoutCtrlWithLRTB(Pa,5,null,16,8,null,16),Pa.appendTo(Ma),Ta.css("margin-left","23px"));Ta.appendTo(Ma);Oa||(Oa=Ga.getSourceType(),Oa=da.createSourceNameByType(Oa),Ga.setSourceName(Oa));ea&&""!=$.trim(va.getText())?
ab(Qa,Oa,$.trim(va.getText())):Qa.text(Oa);Qa.attr("title",Oa);Qa.appendTo(Ma);Ma.appendTo(Ja)}else 2===Oa?(Ma=$("<div class='modeler-designer-addsource-cell-item'>"),Oa=da.translateSourceType(Ga.getSourceType()),ea&&""!=$.trim(va.getText())?ab(Ma,Oa,va.getText()):Ma.text(Oa),Ma.attr("title",Oa),Ma.appendTo(Ja)):3===Oa?(Ma=$("<div class='modeler-designer-addsource-cell-item'>"),Ga=Ga.getCreatorName(),ea&&""!=$.trim(va.getText())?ab(Ma,Ga,va.getText()):Ma.text(Ga),Ma.attr("title",Ga),Ma.appendTo(Ja)):
4===Oa&&(Qa=$("<div class='modeler-designer-addsource-cell-item'>"),Ga=Ga.getCreateTime(),Ga=Ma.format(Ga),Qa.text(Ga),Qa.attr("title",Ga),Qa.appendTo(Ja));Ka(Ja,Ia)};var Ra=function(Ja){var Ia=$("<span>");Ia.addClass("modeler-designer-addsource-source-icon");switch(Ja.getSourceType()){case Z.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:Ja="entity-source-icon";break;case Z.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE:Ja="datacenter-source-icon";break;case Z.SOURCE_TYPE_MODEL_SET_SOURCE:Ja="modelset-source-icon";break;
case Z.SOURCE_TYPE_OPEN_API_SOURCE:Ja="openapi-source-icon";break;default:if(Ja.getSpecificType())Ja=Ja.getSpecificType().toLowerCase();else throw Error("unknown type");}R.background(Ia,Ja);return Ia},Va=function(Ja){var Ia=Ja.getErrorMessage(),Qa=Ja.getId(),Ga=new a,Oa=!1,Ma=Ga.getJqUi(),Pa=!1;if(0<Ba.length)for(var Ta=Ba.length-1;0<=Ta;Ta--)if(Qa===Ba[Ta].getSourceId()){Pa=Oa=!0;break}if(!Pa&&Ia)return Ga.setEnabled(!1),Ga.setChecked(Oa),Ma;Ia=Object.keys(Aa);for(Pa=0;Pa<Ia.length;Pa++)if(Qa===
Ia[Pa]){Oa=Aa[Ia[Pa]].isChecked();break}Aa[Qa]=Ga;Ga.setChecked(Oa);Ga.setUserObject(Ja);Ga.addCheckedListener(function(ka){ka=ka.isChecked();var ua=Object.keys(Aa);if(ka)for(var xa=0;xa<ua.length;xa++)if(!Aa[ua[xa]].isChecked())return;Da.setChecked(ka)});return Ma},Wa=function(Ja){var Ia=new h,Qa=!1,Ga=Ia.getJqUi();if(Ja.getErrorMessage())Ia.setEnabled(!1),Ga.children().eq(0).css("background-color","#ddd");else{for(var Oa=Ja.getId(),Ma=Object.keys(Aa),Pa=0;Pa<Ma.length;Pa++)Oa===Ma[Pa]&&(Qa=Aa[Ma[Pa]].isChecked());
Aa[Oa]=Ia;Ia.addCheckedListener(function(Ta,ka){if(ka&&Ta.isChecked())for(Ta=0;Ta<Ma.length;Ta++)Oa!=Ma[Ta]&&Aa[Ma[Ta]].setChecked(!1)})}Ia.setChecked(Qa);Ia.setUserObject(Ja);return Ga}}var y,E,t,p,w,M,V,U,ma,oa,va,Da,Aa={},sa=[],Ba,ea=!1,O,la=!1;this.setMultiSelect=function(ra){O=ra};this.setContainer=function(ra){U=ra};this.setArrExistsSource=function(ra){Ba=ra};this.getJqUi=function(){y||cb();return y};this.setRemoteImpl=function(ra){ma=ra};this.getTable=function(){return oa};this.getSelected=
function(){for(var ra=Object.keys(Aa),Ha=[],Ka=0;Ka<ra.length;Ka++){var Ra=Aa[ra[Ka]];if(Ra.isChecked()&&(Ha.push(Ra.getUserObject()),!O))break}return Ha};this.updateUiByObserver=function(){la&&(0===sa.length?Xa():Ea(sa))};this.rePaintSource=function(ra){ra?ya(ra):(Ea(sa),O&&bb())};var ya=function(ra){if(0==ra.length)Aa={},sa=[],p&&p.css("right","15px"),M&&(M.hide(),va.clear()),y&&y.remove(),Xa();else{t&&t.hide();M&&M.show();va&&va.clear();p&&p.css("right","205px");sa=[];Aa={};for(var Ha=0;Ha<ra.length;Ha++){var Ka=
new m;Ka.fromJsonObject(ra[Ha]);sa.push(Ka)}Ea(sa);O&&bb()}},ta=function(){p=$("<div>");p.attr("title",S.get("refresh","\u5237\u65b0"));R.backgroundWithHover(p,"refresh");p.addClass("modeler-designer-addsource-btn-refresh");p.on("click",W);p.appendTo(U)},W=function(){(new (L.ModelSetSourceIntegration.getModelSetSourceFacade())(ma,function(ra){ya(ra)})).designerLoadSources()},wa=function(){M=$("<div>");M.css("display","flex");var ra=$("<div class = 'modeler-designer-addsource-modelset-source-link'>");
ra.text(S.get("modelSetSourceManage","\u6570\u636e\u6e90\u7ba1\u7406"));ra.attr("title",S.get("modelSetSourceManage","\u6570\u636e\u6e90\u7ba1\u7406"));ra.on("click",function(){I&&I.occur(I.BUTTON_TYPE,I.SOURCE_MANAGE);L.ModelSetSourceIntegration.getDataSourceManageEntrance()()});ra.appendTo(M);ra=new b;ra.setIconType(b.ICON_TYPE_QUESTION);ra.setTipsSize(380,54);var Ha=ra.getJqUi();Ha.css("position","relative");var Ka="<span>"+S.get("sourceHelpTip","\u4ee5\u4e0b\u6570\u636e\u6e90\u662f\u5728\u5f53\u524d\u6a21\u578b\u96c6\u7684\u201c\u6570\u636e\u6e90\u7ba1\u7406\u201d\u4e2d\u5b9a\u4e49\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u5982\u679c\u9700\u8981\u5176\u4ed6\u7684\u6570\u636e\u6e90\uff0c\u8bf7\u5728\u201c\u6570\u636e\u6e90\u7ba1\u7406\u201d\u6dfb\u52a0\u3002")+
"</span>";ra.setTipsHtml(Ka);Ha.appendTo(M);La();M.appendTo(U)},Ca=function(ra){if(""===ra)ea&&(ea=!1,Ea(sa));else{ea=!0;ra=ra.toLowerCase();for(var Ha=[],Ka=0;Ka<sa.length;Ka++){var Ra=sa[Ka],Va=Ra.getSourceName(),Wa=Ra.getSourceType(),Ja=da.translateSourceType(Wa),Ia=Ra.getCreatorName();Va||(Va=da.createSourceNameByType(Wa));-1==Va.toLowerCase().indexOf(ra)&&-1==Ja.toLowerCase().indexOf(ra)&&-1==Ia.toLowerCase().indexOf(ra)||Ha.push(Ra)}Ea(Ha)}},Ea=function(ra){E&&E.remove();cb();if(ra&&0<ra.length){for(var Ha=
0;Ha<ra.length;Ha++)Sa(ra[Ha]);w&&w.hide()}else w?w.show():(w=$("<div>"),w.addClass("modeler-designer-addsource-noresult-view-container"),ra=$("<div>"),ra.addClass("modeler-designer-addsource-noresult-view-icon"),R.background(ra,"search-no-result"),ra.appendTo(w),ra=$("<div>"),ra.addClass("modeler-designer-addsource-noresult-view-tip"),ra.text(S.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),ra.appendTo(w),w.appendTo(U));y.appendTo(U);f.refresh(oa)},La=
function(){V||(va=new B,va.setShowSearchIcon(!0),va.setPlaceholder(S.get("searchContent","\u8bf7\u8f93\u5165\u540d\u79f0/\u7c7b\u578b/\u521b\u5efa\u4eba")),va.setSearchListenerDelay(1E3),va.addSearchListener(function(){Ca($.trim(va.getText()))}),V=va.getJqUi(),V.find(":input").on("keydown",function(ra){13==(ra.keyCode||ra.which||ra.charCode)&&Ca($.trim(va.getText()))}),V.addClass("modeler-designer-addsource-search-box"));V.appendTo(M)},Sa=function(ra){if(ra){var Ha=f.createRow(oa,!1),Ka=new KTBorderStyle;
Ka.setBottomBorderWidth(1);Ka.setBottomBorderPen("solid");Ka.setBottomBorderColor("#e5e5e5");Ha.setBorder(Ka);Ha.setUserObject(ra)}},Xa=function(){if(t)t.show();else{t=$("<div>");t.addClass("modeler-designer-addsource-nodata-view-container");var ra=$("<div>");ra.addClass("modeler-designer-addsource-nodata-view-icon");R.background(ra,"no_data_cloud");ra.appendTo(t);ra=$("<div>");ra.addClass("modeler-designer-addsource-nodata-view-tip");ra.text(S.get("pleaseCreateSource","\u8bf7\u5148\u5728\u201c\u6570\u636e\u6e90\u7ba1\u7406\u201d\u4e2d\u521b\u5efa\u6570\u636e\u6e90\u8fde\u63a5\u4fe1\u606f"));
ra.appendTo(t);ra=$("<a>");ra.addClass("modeler-designer-addsource-nodata-view-text");ra.text(S.get("modelSetSourceManage","\u6570\u636e\u6e90\u7ba1\u7406"));ra.attr("title",S.get("modelSetSourceManage","\u6570\u636e\u6e90\u7ba1\u7406"));ra.on("click",function(){L.ModelSetSourceIntegration.getDataSourceManageEntrance()()});ra.appendTo(t);t.appendTo(U);p||ta();p.css("right","15px")}},bb=function(){for(var ra=Object.keys(Aa),Ha=0;Ha<ra.length;Ha++)if(!Aa[ra[Ha]].isChecked()){Da.setChecked(!1);return}Da.setChecked(!0)};
this.loadDataSource=function(){(new (L.ModelSetSourceIntegration.getModelSetSourceFacade())(ma,function(ra){la||(la=!0);if(0===ra.length)Xa();else{cb();for(var Ha=0;Ha<ra.length;Ha++){var Ka=new m;Ka.fromJsonObject(ra[Ha]);sa.push(Ka);Sa(Ka)}f.refresh(oa);O&&bb()}})).designerLoadSources()};var cb=function(){y=$("<div class='modeler-designer-addsource-list-table'>");oa=f.createTable();oa.setColumnFitVisibleWidth(!0);oa.addColumns(5);oa.getColumn(0).setWidth(40);oa.getColumn(1).setWidth(190);oa.getColumn(2).setWidth(190);
oa.getColumn(3).setWidth(95);oa.getColumn(4).setWidth(215);oa.setScrollerVisible("hidden");var ra=f.createHeadRow(oa);ra.getCell(1).setValue(S.get("name","\u540d\u79f0"));ra.getCell(2).setValue(S.get("type","\u7c7b\u578b"));ra.getCell(3).setValue(S.get("creator","\u521b\u5efa\u4eba"));ra.getCell(4).setValue(S.get("createTime","\u521b\u5efa\u65f6\u95f4"));ra=new G(oa);ra.setOutsideVisible(!1);oa.setCellRender(ra);oa.setSyncUIWhenModelChanged(!0);E=$(oa.getUI());E.appendTo(y);y.appendTo(U);M||wa();
p||ta();p.css("right","255px")},ab=function(ra,Ha,Ka){if(ra&&Ha&&Ka){Ka=Ka.toUpperCase();for(var Ra=Ha.toUpperCase(),Va=Ra.split(Ka),Wa=Ka.length,Ja=0;Ja<Va.length;Ja++){var Ia=Ra.indexOf(Va[Ja]),Qa=Ha.substr(0,Va[Ja].length);Ia+=Va[Ja].length;var Ga=Ra.length-Ia;Ra=Ra.substr(Ia,Ga);Ha=Ha.substr(Ia,Ga);Ia=$("<span>");Ia.text(Qa);Ia.appendTo(ra);Ja!=Va.length-1&&1<Va.length&&(Ia=Ra.indexOf(Ka),Qa=Ha.substr(Ia,Wa),Ia+=Wa,Ga=Ra.length-Ia,Ra=Ra.substr(Ia,Ga),Ha=Ha.substr(Ia,Ga),Ia=$("<span>"),Ia.text(Qa),
Ia.css("color","red"),Ia.clone().appendTo(ra))}}}}function ha(G){var y,E,t,p=!1,w=[],M,V,U,ma=[];this.getJqUi=function(){t||(y=new e,y.setRootVisible(!1),y.setNodePainter(va),E=Ba(G),y.setRoot(E),E.setExpanded(!0),E.setSelectable(!1),y.setLineHeight(30),t=y.getJqUi(),ca.layoutCtrl(t,0,1,"100%",118),y.addSelectingListener(oa),t.css({top:"31px",background:"white",height:"auto",width:"100%",bottom:"30px",overflow:"hidden auto"}));return t};var oa=function(O,la){O=y.searchUiByModel(la);O.attr("id","modeler-designer-tablearea-table-selected");
O.siblings().removeAttr("id")};this.scrollNodeToVisibleByName=function(O){for(var la,ya=0;ya<ma.length;ya++)ma[ya].getUserObject().getName()==O&&(la=ma[ya]);if(O=y.searchUiByModel(la))O.attr("id","modeler-designer-tablearea-table-selected"),O.siblings().removeAttr("id"),document.querySelector(".sa-ctrl-tree").scrollTop=O.prop("offsetTop")};this.updateExceptionNodeUi=function(O,la){for(var ya=t.children(),ta,W,wa=0;wa<ya.length;wa++){var Ca=ya.eq(wa),Ea=Ca.data("model"),La=Ea.getUserObject();if(Ea.isLeafNode()&&
La.getCommentInfo()==O){ta=Ca;W=La;break}}ta&&(O=ta.children().eq(0),ya=O.children(".modeler-designer-tablearea-table-exception-icon"),ta=0,0<ya.length&&ya.remove(),(la=da.getModelExceptionTips(la))?(La.setDisableDrag(!1),ta+=20,O.css("margin-left","20px"),ya=da.createExceptionIcon(la),ya.addClass("modeler-designer-tablearea-table-exception-icon"),ya.appendTo(O)):La.setDisableDrag(!0),W.setErrorMessage(la),O.css("margin-left",ta+"px"))};var va=function(O,la){var ya=function(Ea){var La=$("<div>");
ca.layoutCtrlWithLRTB(La,"",0,50,0,0,16);var Sa=$("<div class='modeler-designer-tablearea-table-name-edit'>");R.backgroundWithHover(Sa,"edit");Sa.on("click",function(){V&&V(la.getUserObject())});var Xa=$("<div class='modeler-designer-tablearea-table-name-delete'>");R.backgroundWithHover(Xa,"delete");Xa.on("click",function(){U&&U(la.getUserObject(),Xa)});W.getErrorMessage()&&(Sa.css("right","72px"),Xa.css("right","34px"));Sa.appendTo(La);Xa.appendTo(La);La.appendTo(Ea);La.hide();Ea.on("mouseenter",
function(){La.show();W.getErrorMessage()?wa.css("right","90px"):wa.css("right","70px")});Ea.on("mouseleave",function(){La.hide();W.getErrorMessage()?wa.css("right","50px"):wa.css("right","30px")})},ta=20*la.getLevel();O.css("padding-left","4px");O.css("padding-right","4px");O.css("width","calc(100% - "+ta+"px)");var W=la.getUserObject(),wa=$("<div>");wa.addClass("modeler-designer-tablearea-table-name");wa.text(W.getDisplayName());wa.attr("title",W.getDisplayName());wa.appendTo(O);if(la.isLeafNode()){ta=
$("<div>");ta.addClass("modeler-designer-tablearea-table-icon");var Ca=W.getUserSql()?W.getUserSql().getSqlType():"entity"==W.getType()?"entity-sub":"table";R.background(ta,Ca);ta.appendTo(O);O.css("overflow","");W.getErrorMessage()&&(O.css("margin-left","20px"),ta=da.createExceptionIcon(W.getErrorMessage()),ta.addClass("modeler-designer-tablearea-table-exception-icon"),ta.appendTo(O));W.getUserSql()&&(ya(O),ma.push(la))}};this.doSearch=function(O){M&&M.hide();if(""===O)p&&(sa(),Aa(),y.setRoot(E),
p=!1);else if(t){O=O.toLowerCase();p&&Aa();var la=Ba(G);la.deepFirstVisiting(function(ya){var ta=ya.getUserObject().getDisplayName();if(ta&&-1!=ta.toLowerCase().indexOf(O))for(ya=ya.getTreePath(),ta=0;ta<ya.length;ta++){var W=ya[ta];!W.isLeafNode()&&ya[ta+1]&&W.setExpanded(!0);W=W.getUserObject();W.setMatch(!0);w.push(W)}},!1);Da(la);y.setRoot(la);0===w.length&&(M=$("<div>"),M.text(S.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),M.addClass("modeler-designer-tablearea-noresult-tip"),
M.appendTo(t));p=!0}};var Da=function(O){if(O.isExpanded())for(var la=O.getAllChildren(),ya=0;ya<la.length;ya++){var ta=la[ya];ta.getUserObject().getMatch()?ta.isLeafNode()||Da(ta):O.removeChild(ta)}},Aa=function(){if(0<w.length)for(var O=0;O<w.length;O++)w[O].setMatch(!1);w=[]},sa=function(){E.deepFirstVisiting(function(O){O!=E&&(O.isLeafNode()||O.setExpanded(!1))},!1)};this.setUserSqlDeleteListener=function(O){U=O};this.setUserSqlEditListener=function(O){V=O};var Ba=function(O){var la=new e.BranchNode;
la.setUserObject(O);if((O=O.getChildren())&&0<O.length)for(var ya=0;ya<O.length;ya++){var ta=O[ya];if(ta instanceof x){var W=la;ta=ta.getChildren()?Ba(ta):ea(ta);W.addChild(ta)}else la.addChild(ea(ta))}return la},ea=function(O){var la=new e.LeafNode;la.setUserObject(O);return la};this.setSelectedNode=function(){}}function Y(G){var y,E,t,p,w,M=!1,V=[],U=[],ma;this.setUserSqlDeleteListener=function(sa){w=sa};this.setUserSqlEditListener=function(sa){p=sa};var oa=function(){var sa=M?V:G.getChildren();
y.getJqUi().empty();y.setItemCount(sa.length);y.setItemUiCreator(va);y.repaint()},va=function(sa){var Ba=function(ta){var W=$("<div>");ca.layoutCtrlWithLRTB(W,"",0,50,0,0,16);var wa=$("<div class='modeler-designer-tablearea-table-name-edit'>");R.backgroundWithHover(wa,"edit");wa.on("click",function(){p&&p(ea)});var Ca=$("<div class='modeler-designer-tablearea-table-name-delete'>");R.backgroundWithHover(Ca,"delete");Ca.on("click",function(){w&&w(ea,Ca)});ea.getErrorMessage()&&(wa.css("right","72px"),
Ca.css("right","34px"));wa.appendTo(W);Ca.appendTo(W);W.appendTo(ta);W.hide();ta.on("mouseenter",function(){W.show();ea.getErrorMessage()?la.css("right","90px"):la.css("right","70px")});ta.on("mouseleave",function(){W.hide();ea.getErrorMessage()?la.css("right","50px"):la.css("right","30px")})},ea=(M?V:G.getChildren())[sa],O=$("<div class='modeler-designer-tablearea-dbCenter-item'>");O.css("padding-left","4px");O.css("padding-right","4px");O.css("height","30px");O.css("width","calc(100% - 10px)");
O.data("model",ea);O.on("click",function(){Da(O)});O.on("mouseenter",function(){O.addClass("modeler-designer-tablearea-dbCenter-table-hover")});O.on("mouseleave",function(){O.removeClass("modeler-designer-tablearea-dbCenter-table-hover")});var la=$("<div>");la.addClass("modeler-designer-tablearea-dbCenter-table-name");la.text(ea.getDisplayName());la.attr("title",ea.getDisplayName());la.appendTo(O);sa=$("<div class='modeler-designer-tablearea-dbCenter-table-icon'>");var ya=ea.getUserSql()?ea.getUserSql().getSqlType():
"table";R.background(sa,ya);sa.appendTo(O);O.css("overflow","");ea.getErrorMessage()&&(O.css("margin-left","20px"),sa=da.createExceptionIcon(ea.getErrorMessage()),sa.addClass("modeler-designer-tablearea-dbCenter-table-exception-icon"),sa.appendTo(O));ea.getUserSql()&&Ba(O);return O},Da=function(sa){for(var Ba=0;Ba<U.length;Ba++)U[Ba].removeClass("modeler-designer-tablearea-table-selected");U=[sa];sa.addClass("modeler-designer-tablearea-table-selected")};this.setSelectedNode=function(sa){if(sa){sa=
sa.getDisplayName();for(var Ba=y.getPaintedItems(),ea=0;ea<Ba.length;ea++){var O=Ba[ea],la=O.data("model");if(la&&la.getDisplayName()===sa){Da(O);break}}}};var Aa=function(sa,Ba){for(var ea=0;ea<sa.length;ea++){var O=sa[ea];if(O.getDisplayName()===Ba)return O}};this.updateExceptionNodeUi=function(sa,Ba){Ba=da.getModelExceptionTips(Ba);for(var ea=y.getPaintedItems(),O,la,ya=0;ya<ea.length;ya++){var ta=ea[ya],W=ta.data("model");if(W&&W.getDisplayName()===sa){O=ta;la=W;break}}O?O&&(sa=O.children(".modeler-designer-tablearea-dbCenter-table-exception-icon"),
ea=0,0<sa.length&&sa.remove(),Ba&&(ea+=20,O.css("margin-left","20px"),sa=da.createExceptionIcon(Ba),sa.addClass("modeler-designer-tablearea-dbCenter-table-exception-icon"),sa.appendTo(O)),la.setErrorMessage(Ba),O.css("margin-left",ea+"px")):(O=G.getChildren(),(la=Aa(O,sa))&&la.setErrorMessage(Ba))};this.scrollNodeToVisibleByName=function(sa){var Ba=M?V:G.getChildren(),ea=Aa(Ba,sa);if(ea)for(Ba=30*Ba.indexOf(ea),y.repaint(Ba),Ba=y.getPaintedItems(),ea=0;ea<Ba.length;ea++){var O=Ba[ea],la=O.data("model");
if(la&&la.getDisplayName()===sa){Da(O);break}}};this.setSearchClearCallBack=function(sa){ma=sa};this.doSearch=function(sa){sa=$.trim(sa).toLowerCase();t&&t.hide();var Ba=G.getChildren();if(0===sa.length)M=!1,oa();else{M=!0;V=[];for(var ea=0;ea<Ba.length;ea++){var O=Ba[ea],la=O.getDisplayName();la&&-1!==la.toLowerCase().indexOf(sa)&&V.push(O)}oa();0===V.length&&(t=$("<div>"),t.text(S.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),t.addClass("modeler-designer-tablearea-noresult-tip"),
t.appendTo(E))}};this.getJqUi=function(){E||(y=new pa,y.setItemHeight(30),E=y.getJqUi(),ca.layoutCtrlWithLRTB(E,0,0,"100%",0,30,null),E.addClass("modeler-designer-tablearea-dbCenter"),ma&&ma(),oa());return E}}function K(){var G,y,E=L.SourceConnectStep.getExeSourceChangeCallback(),t=function(){L.SourceConnectStep.clearTableAreaSearchBox();var p=G.data("errorCode");p?E&&E(y,p):L.SourceConnectStep.checkSourceConnectivity(y,G)};this.setJqItem=function(p){G=p};this.getJqItem=function(){return G};this.setSource=
function(p){y=p};this.getSource=function(){return y};this.getFunConnectSource=function(){return t};this.protectedMethod={setFunConnectSource:function(p){t=p},getFunFailCallback:function(){return E}}}function ja(){K.call(this)}function na(){K.call(this);var G=this;this.protectedMethod.setFunConnectSource(function(){L.SourceConnectStep.checkModelSetSourceConnect(G.getSource(),G.getJqItem());L.SourceConnectStep.clearTableAreaSearchBox()})}function C(){K.call(this);var G=this.protectedMethod,y=this;G.setFunConnectSource(function(){L.SourceConnectStep.clearTableAreaSearchBox();
G.getFunFailCallback()(y.getSource(),F.SOURCE_EXCEPTION_DELETED_ERRORCODE)})}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});var L=com.kingdee.bos.qing.modeler.designer;
L.SourceArea=F;L.TableArea=function(){var G,y,E,t,p,w,M,V,U,ma,oa,va,Da,Aa,sa,Ba,ea,O,la,ya,ta,W,wa,Ca={};this.getSearchBox=function(){return V};this.getJqTableTree=function(){return ma};this.setTableNodeCreator=function(ka){wa=ka};this.setGlobal=function(ka){w=ka};this.setRemoteImpl=function(ka){t=ka};this.setDragHandler=function(ka){p=ka};this.updateNodeStatus=function(ka,ua){U&&U.updateExceptionNodeUi(ka,ua)};this.getJqUi=function(){if(!G){G=$("<div>");G.addClass("modeler-designer-workarea");G.addClass("modeler-designer-common-border");
va=$("<div>");va.addClass("modeler-designer-workarea-title");oa=$("<span>");oa.addClass("modeler-designer-tablearea-title-text");oa.text(S.get("table","\u8868"));va.append(oa);y=$("<div>");y.addClass("modeler-designer-workarea-container");var ka=$("<div>"),ua=$("<div>");ua.text(S.get("customSQL","\u81ea\u5b9a\u4e49SQL/KSQL"));ua.attr("title",S.get("customSQL","\u81ea\u5b9a\u4e49SQL/KSQL"));var xa=$("<div>");R.backgroundWithHover(xa,"add");ka.append(ua);ka.append(xa);ca.layoutCtrlWithLRTB(ka,0,0,null,
null,0,25);ca.layoutCtrlWithLRTB(ua,5,null,170,5,0,18);ca.layoutCtrlWithLRTB(xa,null,0,18,5,0,18);ca.makeTextOmissible(ua);ka.css({"border-top":"1px solid #e5e5e5"});xa.css({cursor:"pointer"});xa.on("click",La);W=ka;W.hide();y.append(W);y.appendTo(G);Ha();G.append(va)}return G};this.setSource=function(ka){ka&&ka!=E&&(E=ka);Ca[ka]=void 0;Ia()};this.setExceptionSource=function(ka,ua){Ba=new Date;ka&&ka!=E&&(E=ka);Ca[E]=ua;Oa();ma&&ma.remove();O&&O.hide();Ja(ka,ua)};var Ea=function(ka,ua){ma&&ma.remove();
ua?(U=new Y(ka),U.setSearchClearCallBack(function(){V&&V.clear()})):U=new ha(ka);U.setUserSqlDeleteListener(cb);U.setUserSqlEditListener(Xa);ma=U.getJqUi();ma.appendTo(y);Ma(!1)},La=function(){if(Ca[E])return Sa(Ca[E],!1),!0;if(Pa()&&!la.getSelectPair())w.getMessageCurtain().showPrompt(S.get("chooseAppWarn","\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u5e94\u7528\u3002"));else{var ka=new z(t,function(xa){var Fa=new n;Fa.setSourceUid(E.getId());var Na=L.UIDHelper.getUID(L.UIDHelper.NS_TABLE);Fa.setUid(Na);
Pa()&&Fa.setNamespace(la.getSelectPair().value);xa=new qa(t,!1,xa);xa.setModel(Fa);xa.setSource(E);xa.setTableNameChecker(Ka);xa.setPermAndConnChecker(bb);xa.addConfirmListener(function(Ua,$a){var Ya=w.getModelerModel(),Za=new D;Za.setValue(Ua,$a,Ya,Wa);w.getCommandManager().perform(Za);w.getMessageCurtain().showSuccess(S.get("CreateSQLSuccess","\u65b0\u5efa\u81ea\u5b9a\u4e49SQL\u6210\u529f\u3002"))});xa.showDialog()},function(xa){Sa(xa+"",!1);return!0});if(la&&la.getSelectPair())var ua=la.getSelectPair().value;
ka.checkKSQLSupport(E.getSourceId(),ua)}},Sa=function(ka,ua){switch(ka){case F.PUBLIC_SOURCE_IS_DELETED_ERRORCODE:case F.SOURCE_CONNECT_FAILED_ERRORCODE:case F.SOURCE_EXCEPTION_DELETED_ERRORCODE:case F.SOURCE_EXCEPTION_DELETED_ERRORCODE_1:ua?w.getMessageCurtain().showPrompt(S.get("editSQLWithoutSource","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7f16\u8f91\u81ea\u5b9a\u4e49SQL/KSQL\u3002")):w.getMessageCurtain().showPrompt(S.get("createSQLWithoutSource","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u65b0\u5efa\u81ea\u5b9a\u4e49SQL/KSQL\u3002"));
break;default:ua?w.getMessageCurtain().showPrompt(S.get("editWithoutPerm","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u65e0\u6cd5\u7f16\u8f91\u81ea\u5b9a\u4e49SQL/KSQL\u3002")):w.getMessageCurtain().showPrompt(S.get("createWithoutPerm","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u65e0\u6cd5\u65b0\u5efa\u81ea\u5b9a\u4e49SQL/KSQL\u3002"))}},Xa=function(ka){if(Ca[E]||ka.getErrorMessage())return Sa(Ca[E],!0),!0;var ua=new z(t,function(Fa){var Na=
new n;Na.setSourceUid(E.getId());Na.setTableName(ka.getName());Na.setUserSql(ka.getUserSql());Pa()&&Na.setNamespace(ka.getCommentInfo());Na=w.getModelerModel().getSameTable(Na).clone();Fa=new qa(t,!0,Fa);Fa.setModel(Na);Fa.setSource(E);Fa.setTableNameChecker(Ka);Fa.setPermAndConnChecker(bb);Fa.addConfirmListener(function(Ua,$a){var Ya=w.getModelerModel(),Za=new D;Za.setValue(Ua,$a,Ya,Wa);w.getCommandManager().perform(Za);w.getMessageCurtain().showSuccess(S.get("EditSQLSuccess","\u7f16\u8f91\u81ea\u5b9a\u4e49SQL\u6210\u529f\u3002"))});
Fa.showDialog()},function(Fa){Sa(Fa+"",!0);return!0});if(la&&la.getSelectPair())var xa=la.getSelectPair().value;ua.checkKSQLSupport(E.getSourceId(),xa)},bb=function(ka,ua,xa){var Fa=S.get("createWithoutPerm","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u65e0\u6cd5\u65b0\u5efa\u81ea\u5b9a\u4e49SQL/KSQL\u3002");xa&&(Fa=S.get("editWithoutPerm","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u65e0\u6cd5\u7f16\u8f91\u81ea\u5b9a\u4e49SQL/KSQL\u3002"));
(new z(t,function(Na){Na?ka():(ua(),w.getMessageCurtain().showPrompt(Fa))},function(){ua();w.getMessageCurtain().showPrompt(Fa);return!0})).checkUserSqlSourcePermission(E.getSourceId())},cb=function(ka,ua){var xa=new g;xa.setText(S.get("ConfirmDeleteSQL","\u786e\u5b9a\u5220\u9664\u8be5\u81ea\u5b9a\u4e49SQL\u5417\uff1f"));xa.setConfirmedListener(function(Fa){if(Fa){Fa=new n;Fa.setSourceUid(E.getId());Fa.setTableName(ka.getName());Fa.setUserSql(ka.getUserSql());Pa()&&Fa.setNamespace(ka.getCommentInfo());
var Na=w.getModelerModel();if(Na.isUserSqlTableInUse(Fa))w.getMessageCurtain().showPrompt(S.get("customSQLUsedInDesign","\u8be5\u81ea\u5b9a\u4e49SQL/KSQL\u5df2\u88ab\u6570\u636e\u8868\u6a21\u578b\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u8bbe\u8ba1\u7a97\u53e3\u5220\u9664\u3002"));else{var Ua=new A;Ua.setValue(Fa,Na,Wa);w.getCommandManager().perform(Ua);w.getMessageCurtain().showSuccess(S.get("DeleteSQLSuccess","\u5220\u9664\u81ea\u5b9a\u4e49SQL\u6210\u529f\u3002"))}}});xa.show(ua,!1)},ab=function(){O&&
O.hide();M&&M.hide();Aa&&Aa.hide();ma&&ma.remove();Ma(!0);if(sa)ra(),sa.show();else{sa=$("<div>");sa.addClass("modeler-designer-tablearea-notable-view");sa.appendTo(y);var ka=$("<div>");R.background(ka,"no_data_cloud");ka.addClass("modeler-designer-tablearea-notable-icon");ka.appendTo(sa);ya=$("<div>");ya.addClass("modeler-designer-tablearea-notable-text");ra();ya.appendTo(sa)}},ra=function(){switch(E.getSourceType()){case Z.SOURCE_TYPE_MODEL_SET_SOURCE:ya.text(S.get("noModelTip","\u6682\u65e0\u53ef\u7528\u7684\u6a21\u578b"));
break;default:ya.text(S.get("noTableTip","\u6682\u65e0\u53ef\u7528\u7684\u6570\u636e\u8868"))}},Ha=function(){M||(V=new B,V.setSearchListenerDelay(1E3),V.addSearchListener(function(){U&&U.doSearch($.trim(V.getText()),function(){V.clear()})}),V.setShowSearchIcon(!0),V.setPlaceholder(S.get("searchTable","\u8bf7\u8f93\u5165\u641c\u7d22\u5185\u5bb9")),M=V.getJqUi(),M.addClass("modeler-designer-tablearea-search-box"),M.find(":input").on("keydown",function(ka){13==(ka.keyCode||ka.which||ka.charCode)&&U&&
U.doSearch($.trim(V.getText()))}));M.appendTo(y)},Ka=function(ka,ua){for(var xa=Ra(),Fa=[],Na=0;Na<xa.length;Na++)Fa.push(xa[Na].getName());ua&&Fa.splice(Fa.indexOf(ua),1);return-1<Fa.indexOf(ka)},Ra=function(){for(var ka=w.getModelerModel().getUserSqlTables(E.getId()),ua=[],xa=0;xa<ka.length;xa++){var Fa=ka[xa];if(!Pa()||la.getSelectPair()&&la.getSelectPair().value&&Fa.getNamespace()==la.getSelectPair().value){var Na=new N;Na.setName(Fa.getTableName());Na.setDisplayName(Fa.getTableName());Na.setUserSql(Fa.getUserSql());
Na.setCommentInfo(Fa.getNamespace());ua.push(Na)}}return ua},Va=function(ka){for(var ua=Ra(),xa=0;xa<ua.length;xa++)ka.getChildren().push(ua[xa])},Wa=function(ka){ma&&ma.remove();var ua=Ca[E];if(ua)Ja(E,ua);else{0<$.trim(V.getText()).length&&V.clear();ua=new x;var xa=Pa();xa?la.getSelectPair()&&la.getSelectPair().value&&ua.fromJsonObject(ta,la.getSelectPair().value):ua.fromJsonObject(ta);Va(ua);Ea(ua,xa);p.bindDragUi(ma,Ta);xa&&ma.css("top","65px");ka&&U.scrollNodeToVisibleByName(ka.getTableName())}},
Ja=function(ka,ua){for(var xa=Pa(),Fa=w.getModelerModel().getAllTable(),Na=[],Ua=0;Ua<Fa.length;Ua++)ka.getId()===Fa[Ua].getSourceUid()&&Na.push(Fa[Ua]);if(Na&&0<Na.length){switch(ua){case F.SOURCE_EXCEPTION_DELETED_ERRORCODE:var $a=S.get("tableNotExist","\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664");break;case F.PUBLIC_SOURCE_IS_DELETED_ERRORCODE:case F.PUBLIC_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:case F.DATACENTER_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:case F.SOURCE_CONNECT_FAILED_ERRORCODE:$a=
S.get("tableCanNotUse","\u8be5\u6570\u636e\u6e90\u4e0b\u7684\u8868\u5747\u65e0\u6cd5\u4f7f\u7528")}ka=new x;Fa=ka.getChildren();for(Ua=0;Ua<Na.length;Ua++){var Ya=new N;Ya.setName(Na[Ua].getTableName());Ya.setDisplayName(Na[Ua].getTableName());Ya.setUserSql(Na[Ua].getUserSql());$a&&Ya.setErrorMessage($a);Fa.push(Ya)}Ea(ka,xa);Da&&Da.remove();switch(ua){case F.PUBLIC_SOURCE_IS_DELETED_ERRORCODE:case F.PUBLIC_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:case F.DATACENTER_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:case F.SOURCE_CONNECT_FAILED_ERRORCODE:var Za=
S.get("sourceCanNotUse","\u8be5\u6570\u636e\u6e90\u65e0\u6cd5\u4f7f\u7528\uff0c\u4ec5\u5c55\u793a\u5728\u6a21\u578b\u8bbe\u8ba1\u4e2d\u5df2\u4f7f\u7528\u7684\u8868\u3002");break;case F.CURRENT_USER_NOPERMISSION_PUBLIC_SOURCE_ERRORCODE:case F.CURRENT_USER_NOPERMISSION_DATACENTER_ERRORCODE:Za=S.get("showUsedTable","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650\uff0c\u4ec5\u5c55\u793a\u5728\u6a21\u578b\u8bbe\u8ba1\u4e2d\u5df2\u4f7f\u7528\u7684\u8868\u3002")}Za&&(Da=da.createExceptionIcon(Za),
Da.addClass("modeler-designer-tablearea-title-exception-icon"),Da.appendTo(va));M&&M.show()}else switch(Da&&Da.remove(),ua){case F.MODELSET_SOURCE_ALL_MODEL_CANCEL_DEPLOY_ERRORCODE:case F.SOURCE_EXCEPTION_DELETED_ERRORCODE:case F.PUBLIC_SOURCE_IS_DELETED_ERRORCODE:case F.SOURCE_CONNECT_FAILED_ERRORCODE:ab();break;case F.CURRENT_USER_NOPERMISSION_DATACENTER_ERRORCODE:case F.CURRENT_USER_NOPERMISSION_PUBLIC_SOURCE_ERRORCODE:case F.DATACENTER_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:case F.PUBLIC_SOURCE_CREATOR_NOPERMISSION_ERRORCODE:O&&
O.hide(),M&&M.hide(),sa&&sa.hide(),Ma(!0),Aa?Aa.show():(Aa=$("<div>"),Aa.addClass("modeler-designer-tablearea-nopermission-view"),Aa.appendTo(y),ua=$("<div>"),ua.addClass("modeler-designer-tablearea-nopermission-icon"),R.background(ua,"no-permission"),ua.appendTo(Aa),ua=$("<div>"),ua.addClass("modeler-designer-tablearea-nopermission-text"),ua.text(S.get("noPermission","\u60a8\u6ca1\u6709\u8be5\u6570\u636e\u6e90\u7684\u8fde\u63a5\u6743\u9650")),ua.appendTo(Aa))}},Ia=function(){var ka=new Date;Ba=ka;
if(Pa())ma&&ma.remove(),Qa();else{O&&O.hide();var ua=new z(t,function(xa){if(Ba===ka){ta=xa;var Fa=new x;Fa.fromJsonObject(xa);Va(Fa);0===Fa.getChildren().length?ab():(Ea(Fa,!1),p.bindDragUi(ma,Ta))}});ua.setBlockingJqUi(y);E.setModelId(L.ModelSetSourceIntegration.getModelId());ua.loadTables(E)}Oa();Da&&Da.remove();Aa&&Aa.hide();sa&&sa.hide();M.show()},Qa=function(){Ma();O?(O.show(),Ga()):(la=new (L.ModelSetSourceIntegration.getDataCenterSelector()),O=la.getJqUi(),O.appendTo(y),ea=la.getTextField(),
la.setFunSelectedChangeListener(function(ka){(new z(t,function(ua){var xa=new x;xa.fromJsonObject(ua,ka);ta=ua;Va(xa);Ea(xa,!0);ma.css("top","65px");p.bindDragUi(ma,Ta)})).getDBCenterTables(ka)}))},Ga=function(){var ka=la.getSelectPair();ka&&(ea.setText(ka.text),la.getFunSelectedChangeListener()(ka.value))},Oa=function(){switch(E.getSourceType()){case Z.SOURCE_TYPE_MODEL_SET_SOURCE:oa.text(S.get("model","\u6a21\u578b"));break;case Z.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:oa.text(S.get("entity","\u5b9e\u4f53"));
break;case Z.SOURCE_TYPE_MODELSET_FILE_SOURCE:oa.text(S.get("table","\u8868"));break;default:oa.text(S.get("table","\u8868"))}},Ma=function(ka){if(ka)W&&W.hide(),ma&&ma.css("bottom","1px");else switch(E.getSourceType()){case Z.SOURCE_TYPE_MODEL_SET_SOURCE:case Z.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:case Z.SOURCE_TYPE_MODELSET_FILE_SOURCE:W.hide();ma&&ma.css("bottom","1px");break;default:W.show(),ma&&ma.css("bottom","30px")}},Pa=function(){return E.getSourceType()===Z.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE},
Ta=function(ka){var ua=ka.parent();if(ua&&ua.hasClass("sa-ctrl-tree-nodeline")){var xa=ua.data("model").getUserObject();xa instanceof N&&ua.addClass("modeler-designer-tablearea-table-item")}else ua&&ua.hasClass("modeler-designer-tablearea-dbCenter")?(ka.addClass("modeler-designer-tablearea-table-item"),(xa=ka.data("model"))&&U.setSelectedNode(xa)):ka.hasClass("modeler-designer-tablearea-table-icon")||ka.hasClass("modeler-designer-tablearea-table-name")?(ua=ka.parents(".sa-ctrl-tree-nodeline"),xa=
ua.data("model").getUserObject(),xa instanceof N&&ua.addClass("modeler-designer-tablearea-table-item")):ka.hasClass("modeler-designer-tablearea-dbCenter-table-icon")||ka.hasClass("modeler-designer-tablearea-dbCenter-table-name")?(ua=ka.parents(".modeler-designer-tablearea-dbCenter-item"),(xa=ua.data("model"))&&U.setSelectedNode(xa),ua.addClass("modeler-designer-tablearea-table-item")):ka.hasClass("sa-ctrl-tree-nodeline")&&(xa=ka.data("model").getUserObject(),xa instanceof N&&ka.addClass("modeler-designer-tablearea-table-item"));
return ca.upwardSearchHasClass(ka,ma,"modeler-designer-tablearea-table-item")?(ka=new n,ka.setSourceUid(E.getId()),ka.setTableName(xa.getName()),xa.getCommentInfo()&&ka.setNamespace(xa.getCommentInfo()),xa.getName()&&ka.setTableName(xa.getName()),xa.getDisplayName()&&ka.setDisplayName(xa.getDisplayName()),xa.getUserSql()&&ka.setUserSql(xa.getUserSql()),(ua=w.getModelerModel().getSameTable(ka))?(!1!==xa.getDisableDrag()?ua.setDisableDrag(!0):ua.setDisableDrag(!1),ka=ua):(!1!==xa.getDisableDrag()?ka.setDisableDrag(!0):
ka.setDisableDrag(!1),xa=L.UIDHelper.getUID(L.UIDHelper.NS_TABLE),ka.setUid(xa)),xa=wa(ka),ua=new Q,ua.setTableNode(xa),ua.setTable(ka),ua):null}};L.SourceListPanel=za;var Z=L.AbstractModelerSource,N=L.LeafNode,k=L.DesignTimeSource,z,x,q,Q,n,T,m,ia,X,D,A,I,aa,ca,S,l,u,r,v,h,J,B,f,c,a,e,b,d,g,H,P,fa,pa;var R=L.Icons;(function(){var G=com.kingdee.bos.qing.framework.common;S=G.MultilanguageManager.createPackageAccessor(L);l=G.WindowResizeObserver;G=com.kingdee.bos.qing.common;ca=G.DomUtil;c=G.DateFormater;
G=com.kingdee.bos.qing.ui.component;r=G.AbstractModalDialog;u=G.Button;v=G.RadioButtonGroup;h=G.RadioButton;J=G.List;B=G.SearchBox;a=G.CheckBox;e=G.Tree;b=G.HelpIcon;d=G.MessageDialog;g=G.SimpleConfirmer;H=G.Label;P=G.TextField;fa=G.TextArea;pa=G.DynamicScroller;G=com.kingdee.bos.qing.common.ui;f=G.TableUtil;z=L.DesignerFacade;x=L.FolderNode;q=L.ModelerModel;Q=L.DraggingTableNode;n=L.Table;T=L.UserSQL;m=L.ModelSetDataSource;ia=L.ActionRemoveSource;X=L.ActionAddRemoveSource;D=L.ActionAddUserSqlTable;
A=L.ActionRemoveUserSqlTable;I=L.UserOperationReporter;aa=L.AbstractInvalidityCase})();F.CURRENT_USER_NOPERMISSION_DATACENTER_ERRORCODE="20002101";F.CURRENT_USER_NOPERMISSION_PUBLIC_SOURCE_ERRORCODE="20002102";F.PUBLIC_SOURCE_IS_DELETED_ERRORCODE="20002103";F.PUBLIC_SOURCE_CREATOR_NOPERMISSION_ERRORCODE="20002104";F.DATACENTER_SOURCE_CREATOR_NOPERMISSION_ERRORCODE="20002105";F.MODELSET_SOURCE_ALL_MODEL_CANCEL_DEPLOY_ERRORCODE="20002106";F.SOURCE_CONNECT_FAILED_ERRORCODE="2025008";F.SOURCE_EXCEPTION_DELETED_ERRORCODE=
"2025009";F.SOURCE_EXCEPTION_DELETED_ERRORCODE_1="20001004";var da=new function(){var G=this;this.translateSourceType=function(y){switch(y){case Z.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:return S.get("currentEntity","\u91d1\u8776\u4e91\u00b7\u82cd\u7a79-\u4e1a\u52a1\u5b9e\u4f53");case Z.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE:return S.get("currentDataCenter","\u91d1\u8776\u4e91\u00b7\u82cd\u7a79-\u6570\u636e\u4e2d\u5fc3");case Z.SOURCE_TYPE_MODELSET_DB_SOURCE:return S.get("modelSetDBSource","\u6570\u636e\u5e93");
case Z.SOURCE_TYPE_PUBLIC_DATA_SOURCE:return S.get("publicDBSource","\u516c\u5171\u6570\u636e\u6e90-\u6570\u636e\u5e93");case Z.SOURCE_TYPE_MODEL_SET_SOURCE:return S.get("modelSet","\u6a21\u578b\u96c6");case Z.SOURCE_TYPE_MODELSET_FILE_SOURCE:return S.get("modelSetFile","\u6587\u4ef6");case Z.SOURCE_TYPE_OPEN_API_SOURCE:return S.get("openAPI","OpenAPI")}};this.createExceptionIcon=function(y){var E=$("<div>");R.background(E,"qingWarning");E.attr("title",y);return E};this.createSourceNameByType=function(y){var E;
y===Z.SOURCE_TYPE_CURRENT_ENTITY_SOURCE?E=S.get("businessEntity","\u4e1a\u52a1\u5b9e\u4f53"):y===Z.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE&&(E=S.get("dataCenter","\u6570\u636e\u4e2d\u5fc3"));return E};this.getSourceIconName=function(y){switch(y){case Z.SOURCE_TYPE_CURRENT_ENTITY_SOURCE:return"entity";case Z.SOURCE_TYPE_MODEL_SET_SOURCE:return"modelSet";case Z.SOURCE_TYPE_MODELSET_FILE_SOURCE:return"file";case Z.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE:return"data-center";case Z.SOURCE_TYPE_OPEN_API_SOURCE:return"openapi";
default:return"data"}};this.updateSourceItemStatus=function(y,E,t){var p=y.children(".modeler-designer-sourcearea-exception-icon"),w=y.children(".modeler-designer-sourcearea-icon"),M=y.children(".modeler-designer-sourcearea-name"),V=12,U=34;p&&p.remove();E||(p=G.createExceptionIcon(t),p.addClass("modeler-designer-sourcearea-exception-icon"),p.appendTo(y),V+=22,U+=22);w.css("left",V+"px");M.css("left",U+"px")};this.updateDeletedSourceStatus=function(y){var E=G.createExceptionIcon(S.get("sourceExceptionDeleted",
"\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002"));E.addClass("modeler-designer-sourcearea-exception-icon");E.appendTo(y);E=y.children(".modeler-designer-sourcearea-icon");E.length?(E.css("left","34px"),E=y.children(".modeler-designer-sourcearea-name"),E.css("left","56px")):(E=$("<div>"),E.addClass("modeler-designer-sourcearea-name"),E.text(S.get("theSourceIsDeleted","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664")),E.css("left","34px"),E.appendTo(y))};
this.getModelExceptionTips=function(y){if(!y)return null;switch(y){case aa.TYPE_MODEL_DELETED:return S.get("modelDeleted","\u8be5\u6a21\u578b\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");case aa.TYPE_MODEL_NO_DATA_PERMISSION:return S.get("modelNoPermission","\u60a8\u672a\u88ab\u6388\u6743\u4f7f\u7528\u8be5\u6a21\u578b\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");case aa.TYPE_MODEL_INCOMPLETE:return S.get("modelNoComplete","\u8be5\u6a21\u578b\u8bbe\u7f6e\u4e0d\u5b8c\u6574\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");
case aa.TYPE_MODEL_DAMAGE:return S.get("modelBad","\u8be5\u6a21\u578b\u5df2\u635f\u574f\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");case aa.TYPE_MODEL_CYCLE_REFERENCE:return S.get("modelCycleRef","\u8be5\u6a21\u578b\u4e0e\u5f53\u524d\u6a21\u578b\u5b58\u5728\u5faa\u73af\u5f15\u7528\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");case aa.TYPE_TABLE_NOT_EXISTS:return S.get("tableNotExistCantUse","\u8868\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002")}}};
L.SourceConnectStep=new function(){var G,y,E;this.setGlobal=function(p){G=p};this.setRemoteImpl=function(p){y=p};this.setSourceArea=function(p){};this.setTableArea=function(p){E=p};this.removeTableTree=function(){var p=E.getJqTableTree();p&&p.remove()};this.clearTableAreaSearchBox=function(){E.getSearchBox().clear()};this.getExeSourceChangeCallback=function(){return E.setExceptionSource};var t=function(p,w,M){var V=G.getIntegration().getMapSourcePermission();w?V&&(V[p]=null):(w={},w.errorMessage=
M,V&&(V[p]=w))};this.checkModelSetSourceConnect=function(p,w){(new z(y,function(M){var V=M?!1:!0;da.updateSourceItemStatus(w,V,M);E.setSource(p);t(p.getSourceId(),V,M)},function(M){if(20001004===M)return w.data("errorCode",F.SOURCE_EXCEPTION_DELETED_ERRORCODE),E.setExceptionSource(p,F.SOURCE_EXCEPTION_DELETED_ERRORCODE),da.updateDeletedSourceStatus(w),!0})).checkModelSetSourceConnect(p.getSourceId())};this.checkSourceConnectivity=function(p,w){(new z(y,function(M){if(M)E.setSource(p);else{var V=S.get("sourceConnectFailed",
"\u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");E.setExceptionSource(p,F.SOURCE_CONNECT_FAILED_ERRORCODE)}t(p.getSourceId(),M,V);da.updateSourceItemStatus(w,M,V)},function(M,V){var U=M.toString();if(20001004===M)w.data("errorCode",F.SOURCE_EXCEPTION_DELETED_ERRORCODE),E.setExceptionSource(p,F.SOURCE_EXCEPTION_DELETED_ERRORCODE),da.updateDeletedSourceStatus(w);else{var ma="206"==U.substr(0,3)?S.get("openAPIConnectFailed","OpenAPI\u7684\u8fde\u63a5\u4fe1\u606f\u65e0\u6548\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002"):
-1!=V.indexOf("2030900")?S.get("xmlParseFailed","xml\u6587\u4ef6\u5904\u7406\u5931\u8d25\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002"):S.get("sourceConnectFailed","\u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");E.setExceptionSource(p,F.SOURCE_CONNECT_FAILED_ERRORCODE)}ma&&(t(p.getSourceId(),!1,ma),da.updateSourceItemStatus(w,!1,ma));return!0})).checkConnection(p.getSourceId())}};L.ConnectSourceCreator=new function(){var G;this.getSourceConnector=function(y,
E){if(!G){G={};var t=new na,p=new ja;G[Z.SOURCE_TYPE_MODEL_SET_SOURCE]=t;G[Z.SOURCE_TYPE_PUBLIC_DATA_SOURCE]=p;G[Z.SOURCE_TYPE_MODELSET_DB_SOURCE]=p;G[Z.SOURCE_TYPE_CURRENT_DATACENTER_SOURCE]=p;G[Z.SOURCE_TYPE_CURRENT_ENTITY_SOURCE]=p;G[Z.SOURCE_TYPE_MODELSET_FILE_SOURCE]=p;G[Z.SOURCE_TYPE_OPEN_API_SOURCE]=p}t=(t=y.getSourceType())?G[t]:new C;t.setSource(y);t.setJqItem(E);return t}};L.ModelSetSourceIntegration=new function(){var G,y,E,t,p,w;this.setModelId=function(M){w=M};this.getModelId=function(){return w};
this.setDataSourceManageEntrance=function(M){G=M};this.getDataSourceManageEntrance=function(){return G};this.setRemoteImpl=function(M){y=M};this.getRemoteImpl=function(){return y};this.registerDataCenterSelectorConstructor=function(M){E=M};this.getDataCenterSelector=function(){return E};this.registerMetricDataCenterSelector=function(M){t=M};this.getMetricDataCenterSelector=function(){return t};this.setModelSetSourceFacade=function(M){p=M};this.getModelSetSourceFacade=function(){return p}}})();(function(){function F(){this.convertToRuntimeModel=function(Z,N){if(N){var k=new C,z=k.addVertex,x=new L;x.setId(N.getId());var q=N.getTableUid();q=Z.getTable(q);var Q=q.getSourceUid();Z=Z.getSource(Q);x.setTable(q);x.setSource(Z);x.setSelectedFields(N.getSelectedFields());z.call(k,x);k.setOutputVertexId(N.getId())}}}function ba(){Y.call(this);var Z=this,N=Z.protectedMethod,k;Z.setType(Y.TYPE_RELATION_MODELER);this.getPage=function(){k||(k=new qa,k.addPropertyChangeCallback(N.firePropertyChangeEvt));
return k};this.protectedIsTableInUse=function(){return!1};this.getNode=function(z){if(k)return k.getNode(z)};this.getAllNodes=function(){return Z.getPage().getAllNodes()};this.getNodeSource=function(z){if(z instanceof za&&(z=Z.getTable(z.getTableUid())))return Z.getSource(z.getSourceUid())}}function qa(){K.call(this);var Z=this.protectedMethod,N=[];this.addNode=function(z){z.addPropertyChangeCallback(k);N.push(z);k(ba.KEY_ADD_NODE,z)};this.removeNode=function(z,x){var q=N.indexOf(z);z.removePropertyChangeCallback(k);
-1<q&&(N.splice(q,1),k(ba.KEY_REMOVE_NODE,x))};this.getNode=function(z){for(var x=0,q=N.length;x<q;x++){var Q=N[x];if(Q.getId()==z)return Q}};this.getAllNodes=function(){return N};var k=function(z,x){Z.firePropertyChangeEvt(z,x)}}function za(){ja.call(this);var Z=this,N=this.protectedMethod,k,z;Z.setSize(200,150);Z.setType(ja.TYPE_TABLE);this.setTableUid=function(x){k=x};this.getTableUid=function(){return k};this.setSelectedFields=function(x,q){if(x)for(var Q=0;Q<x.length;Q++)x[Q].setFromNode(Z.getId());
z=x;q&&N.firePropertyChangeEvt(Y.KEY_TABLE_NODE_SELECT_FIELD)};this.getSelectedFields=function(){return z};this.protectedToJson=function(x){x.tableId=k;if(z){for(var q=[],Q=0;Q<z.length;Q++)q.push(z[Q].toJsonObject());x.selectedFields=q}};this.protectedFromJson=function(x){k=x.tableId;if(x=x.selectedFields){for(var q=[],Q=0;Q<x.length;Q++){var n=new na;n.fromJsonObject(x[Q]);q.push(n)}z=q}};this.clone=function(){var x=new za;x.setId(Z.getId());x.setAlias(Z.getAlias());x.setType(Z.getType());x.setPosition(Z.getX(),
Z.getY());x.setSize(Z.getWidth(),Z.getHeight());x.setTableUid(k);x.setSelectedFields(z);return x}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});"undefined"==
typeof com.kingdee.bos.qing.modeler.designer.relationdesigner&&(com.kingdee.bos.qing.modeler.designer.relationdesigner={});var ha=com.kingdee.bos.qing.modeler.designer.relationdesigner;ha.RelationModeler=ba;ha.RelationTableNode=za;ha.ModelConverter=F;var Y,K,ja,na,C,L;(function(){var Z=com.kingdee.bos.qing.modeler.designer;Y=Z.ModelerModel;K=Z.AbstractPage;ja=Z.Node;na=Z.Field;L=Z.SourceVertex})();ha.ModelConverter=new F;ba.KEY_NODE_CHANGE_ALIAS="relation_designer_change_alias";ba.KEY_ADD_NODE="relation_designer_add_node";
ba.KEY_REMOVE_NODE="relation_designer_remove_node"})();(function(){function F(k){var z,x,q,Q=new qa,n,T,m=new Y,ia;this.setScaleHelper=function(A){n=A};this.setGlobal=function(A){T=A};this.changePosition=function(A,I){z&&(A=[A,I],A=n?n.getScaledCoordinate(A):A,Q.setAttributes(z,{transform:"translate("+A[0]+","+A[1]+")"}))};this.getSvgElement=function(){if(!z){z=Q.createNode("g");Q.setAttributes(z,{transform:"translate("+X(k.getX())+","+X(k.getY())+")"});var A=Q.createNode("rect");Q.setAttributes(A,{width:X(k.getWidth()),height:X(k.getHeight()),x:0,y:0,
rx:X(2),fill:"#fafafa","stroke-width":X(1),stroke:"#999"});z.appendChild(A);A=Q.createNode("rect");var I=Q.setAttributes,aa=X(k.getWidth()-2),ca=X(30),S=X(2),l=X(1),u=X(1);var r=T.getModelerModel().getNodeSource(k);r=m.getTableIconColor(r);I.call(Q,A,{width:aa,height:ca,rx:S,x:l,y:u,fill:r});I=Q.createNode("image");Q.setAttributes(I,{width:X(20),height:X(20),x:X(10),y:X(10)>>1,href:m.makeUrl("table")});x=Q.createNode("text");$(x).addClass(F.NODE_NAME_UI_CLASS);Q.setAttributes(x,{fill:"#fff",x:X(40),
y:X(20),"font-size":X(14)});aa=ja.getNodeDisplayName(k);ca=K.trim(aa,X(11),X(100));Q.setText(x,ca);Q.setTitle(z,aa);z.appendChild(A);z.appendChild(I);z.appendChild(x);D()}return z};this.remove=function(){z&&z.remove();z=null};this.setSelected=function(A){ia=A;D()};this.isSelected=function(){return ia};var X=function(A){return n?n.getScaledSize(A):A},D=function(){if(z)if(ia){q=Q.createNode("rect");var A=Math.max(1,X(1));Q.setAttributes(q,{width:X(k.getWidth())+A,height:X(k.getHeight())+A,x:-(A>>1),
y:-(A>>1),rx:X(1),fill:"none","stroke-width":A,stroke:"#276ff5"});z.appendChild(q)}else q&&q.remove(),q=null}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer=
{});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.relationdesigner&&(com.kingdee.bos.qing.modeler.designer.relationdesigner={});var ba=com.kingdee.bos.qing.modeler.designer.relationdesigner;ba.RelationTableNodeUi=F;ba.RelationModelerDisplayNameHelper=function(){za.call(this);var k;this.protectedInit=function(x){k&&k.removePropertyChangeCallback(z);k=x;k.addPropertyChangeCallback(z)};this.protectedGetDefaultName=function(x){x=x.getTableUid();x=k.getTable(x);return x.getDisplayName()?x.getDisplayName():
x.getTableName()};var z=function(x,q){x==ha.KEY_NODE_CHANGE_ALIAS?_super.cacheDisplayName(q.getId(),q.getAlias()):x==ha.KEY_REMOVE_NODE&&(x=q.getRemovedNode(),_super.cacheDisplayName(x.getId(),void 0))}};var qa,za,ha,Y,K,ja,na,C,L,Z,N;(function(){var k=com.kingdee.bos.qing.modeler.designer;qa=k.SvgHelper;Y=k.CommonSvgIconHelper;za=k.AbstractDisplayNameHelper;K=k.SvgTextTrimer;ja=k.DisplayNameHelper;na=k.Meta;C=k.DesignerFacade;L=k.NodeResultCache;Z=k.ExecuteResult;N=k.DppVersionExceptionHandler;k=
ba;ha=k.RelationModeler})();F.NODE_UI_CLASS="relation-designer-node";F.NODE_NAME_UI_CLASS="relation-designer-node-name";ba.NodeFieldHelper=new function(){var k,z,x;this.init=function(n){k=n};this.setNodeStatusMonitor=function(n){z=n};this.setRemoteImpl=function(n){x=n};this.asynGetFields=function(n,T,m,ia,X){if(T){var D=L.getOneNodeField(T.getId());D?m(D):q(n,T,m,ia,X)}else m([])};this.getMeta=function(n,T){if(z.isInvalidNode(n.getId()))T(new na);else{n=k.getTable(n.getTableUid());var m=k.getSource(n.getSourceUid());
(new C(x,function(ia){var X=new na;X.fromJsonObject(ia);T(X)})).getMeta(m,n)}};var q=function(n,T,m,ia,X){n=ba.ModelConverter.convertToRuntimeModel(n,T);if(Q(n))m([]);else{var D=(new Date).getTime(),A=new C(x,function(I){var aa=new Z;aa.fromJsonObject(I);aa.getValidity()?m([]):(I=aa.getFields(),m(I),L.cacheOneNodeField(T.getId(),I,D))},function(I,aa){if(N.handle(I))return!0;ia&&ia();return!1});X?A.setBlockingJqUi(X):A.setShowBlocking(!1);A.getFieldInfo(n)}},Q=function(n){n=n.getVertexes();for(var T=
0;T<n.length;T++)if(z.isInvalidNode(n[T].getId()))return!0;return!1}}})();(function(){function F(){var m,ia,X,D,A,I,aa,ca,S,l,u;this.getJqUi=function(){if(!m){m=$("<div>");var a=$("<div>");a.addClass("modeler-propertyarea-lineitem-title");a.appendTo(m);var e=$("<div>");e.appendTo(a);ja.layoutCtrlWithLRTB(e,5,0,null,2,2,null);e.css("border-left","3px solid #5582f3");e=$("<div>");e.text(K.get("tableProp","\u8868"));ja.layoutCtrl(e,15,null,200,null);ja.layoutCtrlMiddleAlign(e,16);e.appendTo(a);e.css({"font-weight":"bold",color:"#666"});I=new L;I.setEnabled(!1);J(K.get("source",
"\u6570\u636e\u6e90"),I).appendTo(m);aa=new L;aa.setEnabled(!1);J(K.get("tableName","\u8868\u540d"),aa).appendTo(m);v();S=new ba;S.setModeler(X.getModelerModel());S.setRemoteImpl(D);S.setNodeStatusMonitor(A);S.setSelectFieldCallback(c);J(K.get("field","\u5b57\u6bb5"),S).appendTo(m);h();r()}return m};this.setNode=function(a){ia=a;r()};this.setGlobal=function(a){X=a};this.setNodeStatusMonitor=function(a){A=a};this.setRemoteImpl=function(a){D=a};var r=function(){if(ia&&m){var a=X.getModelerModel(),e=
a.getNodeSource(ia).getName();I.setText(e?e:K.get("theSourceIsDeleted","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664"));a=a.getTable(ia.getTableUid());aa.setText(a.getTableName());a=q.getNodeDisplayName(ia);ca.setText(a);S.setNode(ia)}},v=function(){ca=new L;var a=J(K.get("alias","\u522b\u540d"),ca);ca.addBlurListener(f);ca.addAcceptableListener(function(e,b){f(e)});a.appendTo(m)},h=function(){var a=(new C(K.get("relation","\u5173\u8054\u5173\u7cfb"))).getJqUi();a.addClass("modeler-propertyarea-lineitem-caption");
var e=B();e.append(a);e.appendTo(m);l=$("<div>");l.appendTo(m);l.css({position:"relative",overflow:"auto"});a=new N;e="+"+K.get("addRelation","\u65b0\u5efa\u5173\u7cfb");a.setText(e);u=a.getJqUi();a.addActionListener(function(b){b=new za;b.setGlobal(X);b.setNode(ia);b.showDialog()});u.addClass("relation-modeler-designer-add-btn");l.append(u)},J=function(a,e){a=(new C(a)).getJqUi();a.addClass("modeler-propertyarea-lineitem-caption");e=e.getJqUi();e.addClass("modeler-propertyarea-lineitem-ctrl");var b=
B();b.append(a);b.append(e);return b},B=function(){var a=$("<div>");a.addClass("modeler-propertyarea-lineitem");return a},f=function(a){a=a.getText();var e;a=$.trim(a);var b=/^[\u3000\u4E00-\u9FA5a-zA-Z0-9_]{1,}$/;0==a.length?e=K.get("nameIsEmpty","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a"):50<$.trim(a).length?e=K.get("nameTooLong","\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26"):q.isDuplicate(a,ia)?e=K.get("duplicateName","\u540d\u79f0\u91cd\u590d"):a.match(b)||(e=K.get("invalidNodeName",
"\u8282\u70b9\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210"));e&&(e=K.get("modifyAbandoned","#1\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002").replace("#1",e),X.getMessageCurtain().showPrompt(e),ca.setText(q.getNodeDisplayName(ia)))},c=function(a,e,b,d){a?S.setSelectedFieldCount(a.length):S.setSelectedFieldCount(0);d&&(d=X.getModelerModel(),e&&ia.setTableUid(e),d.getTable(e).setTableName(b));ia.setSelectedFields(a,!0)}}function ba(){var m=
this,ia,X,D,A,I,aa,ca,S=0,l,u;this.setNode=function(f){X=f;f=0;var c=X.getSelectedFields();c&&(f=c.length);m.setSelectedFieldCount(f)};this.setModeler=function(f){D=f};this.setSelectFieldCallback=function(f){ca=f};this.setNodeStatusMonitor=function(f){};this.setRemoteImpl=function(f){};this.getJqUi=function(){if(!A){A=$("<div>");A.addClass("modeler-propertyarea-tablenode-property-ui");I=$("<div>");I.addClass("modeler-propertyarea-tablenode-property-text");ja.layoutCtrlWithLRTB(I,4,4,null,4,0,null);
I.appendTo(A);var f=$("<div>");f.addClass("modeler-propertyarea-tablenode-property-icon");na.backgroundWithHover(f,"edit");f.on("click",r);ja.layoutCtrlWithLRTB(f,null,0,16,4,0,16);f.appendTo(A);m.setSelectedFieldCount(S)}return A};this.setSelectedFieldCount=function(f){S=f;var c=K.get("selectedFields","\u5df2\u9009\u62e9#1\u4e2a\u5b57\u6bb5").replace("#1",S);0==f&&(c=K.get("selectedAllFields","\u5df2\u9009\u62e9\u6240\u6709\u5b57\u6bb5"));I&&I.text(c)};var r=function(){v(D,X,function(f){ia=new qa;
ia.setFunContentPaneCreator(function(){var c=$("<div>");aa=n.createSelectFieldToDialog(f.getSourceType());var a=X.getSelectedFields();if(a&&0!=a.length){for(var e=[],b=0;b<a.length;b++)e.push(a[b].getName());aa.setSelectedPropertyName(e)}a=D.getTable(X.getTableUid()).getTableName();aa.setMeta(f);aa.setCurrentTableName(a);aa.setWidth(800);aa.getJqUi().appendTo(c);return c});ia.setFunClosingChecker(h);ia.setFunConfirmClose(J);ia.showSelectFieldDialog(800,520)})},v=function(f,c,a){Y.NodeFieldHelper.getMeta(c,
a)},h=function(){u=aa.getSelectedEntityName();if(aa.getIsEntityView()){if(!u)return ia.showPrompt(K.get("needSelectedEntity","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b9e\u4f53\u6216\u8005\u5206\u5f55\u8868\u3002")),!1;aa.setCurrentTableName(u)}return(l=aa.getSelectedProperties())&&0==l.length?(ia.showPrompt(K.get("noSelectedField","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b57\u6bb5\u3002")),!1):!0},J=function(f){if(f){f=D.getTable(X.getTableUid()).getTableName();var c=aa.getIsEntityView()&&
u!=f;if(c)ca(l,B(),u,aa.getIsEntityView());else{var a=X.getSelectedFields();if(a){if(c=!l||a.length!=l.length,!c){for(var e={},b=0;b<a.length;b++){var d=a[b];e[d.getFullName()]=d}for(b=0;b<l.length;b++)if(d=l[b],!e[d.getFullName()]){c=!0;break}}}else c=null!=l;c&&ca(l,X.getTableUid(),f,aa.getIsEntityView())}}},B=function(){var f=D.getTable(X.getTableUid()),c=f.getTableName();f=f.clone();if(u!=c){f.setTableName(u);c=D.getAllTable();for(var a=0;a<c.length;a++){var e=c[a];if(f.isSame(e))return e.getUid()}c=
Y.UIDHelper.getUID(Y.UIDHelper.NS_TABLE);f.setUid(c);X.setTableUid(c);D.addTable(f);return c}return X.getTableUid()}}function qa(){Z.call(this);var m=this,ia=this.protectedMethod,X,D,A,I;this.setGlobal=function(aa){};this.setFunConfirmClose=function(aa){D=aa};this.setFunClosingChecker=function(aa){A=aa};this.showPrompt=function(aa){ia.getMessageCurtain().showPrompt(aa)};this.setFunContentPaneCreator=function(aa){I=aa};this.showSelectFieldDialog=function(aa,ca){m.setSize(aa,ca);m.setPosition(window.innerWidth-
aa>>1,window.innerHeight-ca>>1);ia.setTitle(K.get("selectField","\u9009\u62e9\u5b57\u6bb5"));ia.setClosingAction(D);ia.setClosingChecker(A);I?ia.setContentPaneCreator(I):(X=new Q,X.setShowAllCheckbox(!0),ia.setContentPaneCreator(X.getContentPaneCreator()));m.showDialog()}}function za(){Z.call(this);var m=this.protectedMethod,ia=this,X,D,A,I;(function(){m.setTitle(K.get("addRelation","\u65b0\u5efa\u5173\u7cfb"));ia.setSize(640,360);m.setContentPaneCreator(function(){if(!X){X=$("<div>");A=new ha;A.setModeler(D.getModelerModel());
A.setNode(I,!0);var aa=A.getJqUi();aa.appendTo(X);ja.layoutCtrlWithLRTB(aa,0,0,null,0,0,null)}return X});m.setClosingChecker2(function(aa){return!0});m.setClosingAction(function(aa){})})();this.setGlobal=function(aa){D=aa};this.setNode=function(aa){I=aa}}function ha(){function m(){var e,b,d;this.getJqUi=function(){if(!e){e=$("<div>");e.css({position:"relative",width:"100%",height:"25px"});b=new ia;d=new ia;var g=b.getJqUi(),H=d.getJqUi();ja.layoutCtrl(g,0,0,"40%",23);ja.layoutCtrlWithLRTB(H,null,
0,"40%",0,null,23);g.appendTo(e);H.appendTo(e)}return e};this.setLeftFields=function(g){b&&b.setFields(g)};this.setRightFields=function(g){d&&d.setFields(g)}}function ia(){var e,b=[],d,g;this.setFields=function(fa){b=fa;d&&d.setItemModel(b)};this.getJqUi=function(){e||H();return e};var H=function(){e=$("<div>");d=(new T).createChooseFieldPanel(P);g=new x;g.setDropdownCreator(function(pa,R,da){return d.createJqPopup(pa,R,da)});g.addSelectionListener(function(pa,R){R&&pa.getSelectedModel()});g.setCustomPainter(function(pa,
R){pa?(R.text(pa.getAlias()),R.attr("title",pa.getAlias())):R.text("")});var fa=g.getJqUi();e.append(fa)},P=function(fa,pa){var R=$("<div>");R.addClass("modeler-designer-field-popup-list-item-icon");na.background(R,pa.getOutputDataType());var da=$("<div>");da.addClass("modeler-designer-field-popup-list-item-text");var G=pa?pa.getAlias():"",y=$("<span>");y.text(G);y.attr("title",G);y.addClass("modeler-designer-field-popup-list-item-text-alias");pa=pa?pa.getName():"";G=$("<span>");G.addClass("modeler-designer-field-popup-list-item-text-name");
G.text("("+pa+")");da.append(y);da.append(G);fa.append(da);fa.append(R)}}var X,D,A,I,aa=new z,ca=new z,S=new k,l=new k,u=[],r,v;this.setNode=function(e,b){A=e;I=b;a()};this.setModeler=function(e){D=e};this.getJqUi=function(){X||h();return X};this.setRelation=function(e){a()};var h=function(){X=$("<div>");aa.setCustomPainter(J);aa.addSelectedChangedListener(function(d,g,H){B(H,!0)});ca.setCustomPainter(J);ca.addSelectedChangedListener(function(d,g,H){B(H)});var e=aa.getJqUi(),b=ca.getJqUi();e.appendTo(X);
b.appendTo(X);ja.layoutCtrl(e,0,0,"40%",23);ja.layoutCtrlWithLRTB(b,null,0,"40%",0,null,23);r=$("<div>");ja.layoutCtrlWithLRTB(r,0,0,null,35,0,null);r.appendTo(X);c();f();a()},J=function(e,b,d){d&&D.getNode(d.getId())&&(e=$("<div>"),e.addClass("modeler-propertyarea-join-relation-node-icon"),na.background(e,"TABLE"),e.appendTo(b),d=q.getNodeDisplayName(d),e=$("<div>"),e.addClass("modeler-propertyarea-join-relation-node-text"),e.text(d),e.attr("title",d),e.appendTo(b))},B=function(e,b){Y.NodeFieldHelper.getMeta(e,
function(d){for(var g=0,H=u.length;g<H;g++){var P=u[g];b?P.setLeftFields(d):P.setRightFields(d)}})},f=function(){var e=$("<div>"),b=K.get("keepIrrelevantRow","\u4fdd\u7559\u65e0\u6cd5\u5173\u8054\u7684\u884c");S.setText(b);l.setText(b);b=S.getJqUi();var d=l.getJqUi();ja.layoutCtrl(b,0,0,"40%",23);ja.layoutCtrlWithLRTB(d,null,0,"40%",0,null,23);e.css({position:"relative",width:"100%",height:"25px","margin-top":"10px"});e.append(b);e.append(d);e.appendTo(r)},c=function(){v=$("<div>");v.css({position:"relative",
overflow:"auto"});v.appendTo(r);var e=new m;v.append(e.getJqUi())},a=function(){A&&(I?(aa.setEnabled(!1),aa.setSelected(A)):(ca.setEnabled(!1),ca.setSelected(A)))}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&
(com.kingdee.bos.qing.modeler.designer={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.relationdesigner&&(com.kingdee.bos.qing.modeler.designer.relationdesigner={});var Y=com.kingdee.bos.qing.modeler.designer.relationdesigner;Y.PropertyArea=function(){var m,ia,X,D,A,I,aa,ca=!1,S;this.setHideListener=function(h){A=h};this.setNodeStatusMonitor=function(h){X&&X.removeSelectNodeListener(v);X=h;X.addSelectNodeListener(v)};this.setGlobal=function(h){I=h};this.setRemoteImpl=function(h){D=h};
this.setModelerModel=function(h){aa&&aa.removePropertyChangeCallback(r);aa=h;aa.addPropertyChangeCallback(r)};this.show=function(h){ca!=!h&&(ca=!h)};this.getJqUi=function(){m||l();return m};this.afterResize=function(){};var l=function(){m=$("<div>");m.addClass("modeler-designer-workarea");m.addClass("modeler-designer-common-border");var h=$("<div>");h.addClass("modeler-designer-workarea-title");var J=$("<div>");J.addClass("modeler-designer-workarea-title-text");J.text(K.get("properties","\u5c5e\u6027"));
h.append(J);ia=$("<div>");ia.addClass("modeler-designer-workarea-container");J=$("<div>");na.backgroundWithHover(J,"rightArrow");ja.layoutCtrlWithLRTB(J,null,5,16,5,null,16);J.on("click",function(){ca=!0;A&&A()});J.css("cursor","pointer");J.appendTo(h);m.append(h);m.append(ia);u()},u=function(){S=new F;S.setGlobal(I);S.setRemoteImpl(D);S.setNodeStatusMonitor(X);var h=S.getJqUi();ja.layoutCtrlWithLRTB(h,0,0,null,0,0,null);h.appendTo(ia)},r=function(h,J){},v=function(h,J){S.setNode(J)}};var K,ja,na,
C,L,Z,N,k,z,x,q,Q,n,T;(function(){var m=com.kingdee.bos.qing.common;ja=m.DomUtil;m=com.kingdee.bos.qing.ui.component;C=m.Label;L=m.TextField;Z=m.AbstractModalDialog;N=m.WorkButton;k=m.CheckBox;z=m.ComboBox;x=m.DropdownSelector;m=com.kingdee.bos.qing.modeler.designer;na=m.Icons;q=m.DisplayNameHelper;Q=m.SelectFieldPanel;n=m.SelectFieldFactory;T=m.ChooseFieldPanelHelper;m=com.kingdee.bos.qing.framework.common;K=m.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.modeler.designer)})()})();(function(){"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.relationdesigner&&(com.kingdee.bos.qing.modeler.designer.relationdesigner=
{});com.kingdee.bos.qing.modeler.designer.relationdesigner.PreviewArea=function(){F.call(this);this.protectedModelerPropChangeListener=function(ba,qa){};this.protectedGetRuntimeModel=function(){}};var F=com.kingdee.bos.qing.modeler.designer.AbstractPreviewArea})();(function(){function F(){var x=this,q=new na,Q,n,T,m,ia={};this.create=function(D,A){Q=A;n||(n=q.createNode("svg"),A=T.getScaledSize(D.getWidth()),D=T.getScaledSize(D.getHeight()),q.setAttributes(n,{width:A,height:D}),Q[0].appendChild(n))};this.setScaleHelper=function(D){T=D};this.setGlobal=function(D){m=D};this.clear=function(){n&&n.remove();n=null};this.addNodeUi=function(D){if(n){var A=new N(D);A.setScaleHelper(T);A.setGlobal(m);var I=D.getId();X(D,A);ia[I]=A}};this.getNodeUiMark=function(){return N.NODE_UI_CLASS};
this.changeNodePosition=function(D){var A=D.getId();(A=ia[A])&&A.changePosition(D.getX(),D.getY())};this.getNodeIdFromUi=function(D){return D.attr("id")};this.setInvalidNodeUi=function(D,A){D=D.getId();(D=ia[D])&&D.setInvalid(!0,A)};this.cleanInvalidNodeUi=function(){for(var D=Object.keys(ia),A=0,I=D.length;A<I;A++){var aa=ia[D[A]];aa&&aa.setInvalid(!1)}};this.addSelectedNodeUi=function(D){var A=D.getId();if(A=ia[A])A.setSelected(!0),A.remove(),X(D,A)};this.cleanSelectedUi=function(){for(var D=Object.keys(ia),
A=0,I=D.length;A<I;A++){var aa=ia[D[A]];aa&&aa.setSelected(!1)}};var X=function(D,A){A=A.getSvgElement();q.addClass(A,x.getNodeUiMark());D=D.getId();A.setAttribute("id",D);n.appendChild(A)}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&
(com.kingdee.bos.qing.modeler.designer={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.relationdesigner&&(com.kingdee.bos.qing.modeler.designer.relationdesigner={});var ba=com.kingdee.bos.qing.modeler.designer.relationdesigner;ba.PageArea=function(){var x,q,Q,n,T,m,ia=new z,X,D,A;this.getJqUi=function(){x||(x=$("<div>"),x.on("mousedown",u),x.addClass("modeler-designer-page"),C.init(),I(),X=new F,X.setScaleHelper(m),X.setGlobal(q),A=$("<div>"),A.appendTo(x),qa.layoutCtrlWithLRTB(A,0,
0,null,0,0,null),T.bindDropUi(A,r,v,h,m),Q&&l());return x};this.setDragHandler=function(f){T=f};this.setModelerModel=function(f){Q&&Q.removePropertyChangeCallback(B);Q=f;Q.addPropertyChangeCallback(B);aa()};this.setGlobal=function(f){q=f};this.setRemoteImpl=function(f){n=f};this.setNodeStatusMonitor=function(f){D&&(D.removeSelectNodeListener(ca),D.removeInvalidNodeChangeListener(S));D=f;D.addSelectNodeListener(ca);D.addInvalidNodeChangeListener(S)};var I=function(){m=new Y;m.addPropertyChangedListener(function(){var f=
A.width(),c=A.height();aa();var a=A.width(),e=A.height(),b=A.position();qa.layoutCtrl(A,b.left+(f-a>>1),b.top+(c-e>>1),null,null)})},aa=function(){X&&X.clear();l();for(var f=Q.getAllNodes(),c=0;c<f.length;c++)X.addNodeUi(f[c]);(f=D.getSelected())&&Q.getNode(f.getId())&&X.addSelectedNodeUi(f)},ca=function(f,c){X.cleanSelectedUi();c&&Q.getNode(c.getId())&&X.addSelectedNodeUi(c)},S=function(f){X.cleanInvalidNodeUi();for(var c=0;c<f.length;c++){var a=f[c];X.setInvalidNodeUi(a,D.getInvalidPrompt(a))}},
l=function(){var f=Q.getPage(),c=m.getScaledSize(f.getWidth()),a=m.getScaledSize(f.getHeight());qa.layoutCtrl(A,null,null,c,a);X.create(f,A)},u=function(f){var c=$(f.target);if(c=qa.upwardSearchHasClass(c,x,X.getNodeUiMark())){c=X.getNodeIdFromUi(c);var a=Q.getNode(c);D.setSelected(a);c=new L;c.setTarget(a);c.setEndMoveCallback(function(e,b){var d=new k;d.setValue(a,[e,b]);q.getCommandManager().perform(d)});c.setMovableArea(A);c.setScaleHelper(m);c.setModelerModel(Q);c.startDrag(f)}else c=new Z,c.setMovableArea(x),
c.setGlobal(q),c.setScaleHelper(m),c.startDrag(f,A)},r=function(){var f=[0,0];f=qa.upwardCoordinate(x[0],f,document.body);var c=[x.prop("clientWidth"),x.prop("clientHeight")];c=qa.upwardCoordinate(x[0],c,document.body);return new function(a,e,b,d){this.getLeft=function(){return a};this.getRight=function(){return e};this.getTop=function(){return b};this.getBottom=function(){return d}}(f[0],c[0],f[1],c[1])},v=function(f,c,a){var e=qa.getCurrentTargetPosition(f);e=qa.upwardCoordinate(f.target,e,document.body);
f=e[0];e=e[1];if(f<c.getLeft()||f>c.getRight()||e<c.getTop()||e>c.getBottom())return null;c=[0,0];c=qa.upwardCoordinate(A[0],c,document.body);f-=c[0];c=e-c[1];f-=parseInt(m.getScaledSize(a.getWidth())>>1);c-=parseInt(m.getScaledSize(a.getHeight())>>1);c=m.getRawCoordinate([f,c]);a.setPosition(c[0],c[1]);return new ha(A,Q)},h=function(f,c){var a=f.getTableNode();f=f.getTable();var e=f.getSourceUid();e=Q.getSource(e);a=new K(n,e,a,f,Q);a.setGlobal(q);a.setFunFinishCallback(c);a.setAddNodeCallback(J);
a.showSelectFieldDialog(850,520)},J=function(f,c){Q.addTable(c);Q.getPage().addNode(f)},B=function(f,c){if(f==ja.KEY_ADD_NODE)(f=ia.adaptSize(Q))||X.addNodeUi(c);else if(f==za.KEY_NODE_CHANGE_POSITION)(f=ia.adaptSize(Q))||X.changeNodePosition(c);else if(f==za.KEY_PAGE_SIZE){aa();f=A.position();var a=m.getScaledSize(c.getLeftExtension());c=m.getScaledSize(c.getTopExtension());qa.layoutCtrl(A,f.left-a,f.top-c,null,null)}}};var qa,za,ha,Y,K,ja,na,C,L,Z,N,k,z;(function(){var x=com.kingdee.bos.qing.common;
qa=x.DomUtil;x=com.kingdee.bos.qing.modeler.designer;za=x.ModelerModel;ha=x.DragInsideCheckResult;Y=x.PageScaleHelper;K=x.FieldSelectDialog;na=x.SvgHelper;C=x.SvgTextTrimer;L=x.NodeDragHelper;k=x.ActionMoveNode;z=x.PageSizeHelper;Z=x.PageDragHelper;x=ba;ja=x.RelationModeler;N=x.RelationTableNodeUi})()})();(function(){function F(){var T=this,m,ia,X,D,A,I,aa,ca,S,l,u,r,v,h,J,B,f,c;this.setGlobal=function(p){D=p};this.setRemoteImpl=function(p){ia=p};this.updateModelerModel=function(){if(v){var p=D.getModelerModel();A&&A.removePropertyChangeCallback(t);A=p;A.addPropertyChangeCallback(t);p=A;var w=new q;w.init(p);com.kingdee.bos.qing.modeler.designer.DisplayNameHelper.registerImpl(w);v.setModelerModel(A);u.setModelerModel(A);J.setModelerModel(A);h.setModelerModel(A);fa()}};this.setNodeStatusMonitor=function(p){I&&
I.removeSelectNodeListener(g);I=p;I.addSelectNodeListener(g);ba.NodeFieldHelper.setNodeStatusMonitor(I)};this.getJqUi=function(){m||a();return m};this.resize=function(){aa&&aa.resize()};var a=function(){m=$("<div>");m.addClass("modeler-designer-main");X=new L;e();h=new z;h.setGlobal(D);h.setRemoteImpl(ia);h.setNodeStatusMonitor(I);h.setHideListener(function(){d=!0;P(!0);ca.collapseSecondHalf(!0);h.show(!1)});v=new x;v.setDragHandler(X);v.setGlobal(D);v.setNodeStatusMonitor(I);v.setRemoteImpl(ia);
J=new K;J.setRemoteImpl(ia);J.setGlobal(D);J.setHideListener(function(){R=!0;G(!0);E(!0);J.show(!1)});b();T.updateModelerModel()},e=function(){u=new ha;u.setGlobal(D);u.setRemoteImpl(ia);u.setSourceChangeCallback(function(p){r&&r.setSource(p)});u.setExceptionSourceChangeCallback(function(p,w){r&&r.setExceptionSource(p,w)});r=new Y;r.setGlobal(D);r.setRemoteImpl(ia);r.setDragHandler(X);r.setTableNodeCreator(function(p){var w=new k,M=com.kingdee.bos.qing.modeler.designer.UIDHelper;w.setId(M.getUID(M.NS_NODE));
w.setTableUid(p.getUid());return w});u.setTableArea(r)},b=function(){S=new n;S.setHorizontalSplit(!1);S.setSplitLineWide(8);S.setResizeMode(n.RESIZE_MODE_FIRST_FIXED);S.setFirstSize(360,60,400);S.setSecondSize(-1,60,-1);S.setFirstChild(n.createChildWrapper(u.getJqUi()));S.setSecondChild(n.createChildWrapper(r.getJqUi()));l=new n;l.setHorizontalSplit(!1);l.setSplitLineWide(8);l.setResizeMode(n.RESIZE_MODE_SECOND_FIXED);l.setFirstSize(-1,120,-1);l.setSecondSize(240,210,350);l.setFirstChild(n.createChildWrapper(v.getJqUi()));
l.setSecondChild(n.createChildWrapper(J.getJqUi(),function(){J.afterResize()}));ca=new n;ca.setHorizontalSplit(!0);ca.setSplitLineWide(8);ca.setResizeMode(n.RESIZE_MODE_SECOND_FIXED);ca.setFirstSize(-1,120,-1);ca.setSecondSize(280,210,450);ca.setFirstChild(l);ca.setSecondChild(n.createChildWrapper(h.getJqUi(),function(){h.afterResize()}));aa=new n;aa.setHorizontalSplit(!0);aa.setSplitLineWide(8);aa.setResizeMode(n.RESIZE_MODE_FIRST_FIXED);aa.setFirstSize(206,100,450);aa.setSecondSize(-1,600,-1);aa.setFirstChild(S);
aa.setSecondChild(ca);m=aa.getJqUi();m.addClass("modeler-designer-main");P(!0);ca.collapseSecondHalf(!0);h.show(!1)},d=!1,g=function(){d||H()},H=function(){P(!1);ca.collapseSecondHalf(!1);h.show(!0)},P=function(p){if(!B){B=$("<div>");B.addClass("modeler-designer-property-show-btn");B.on("click",H);var w=$("<div>");w.appendTo(B);ja.backgroundWithHover(w,"leftArrow");var M=$("<div>");M.text(Q.get("properties","\u5c5e\u6027"));M.appendTo(B);qa.layoutCtrlCenterAlign(M,20);qa.layoutCtrlWithLRTB(M,null,
null,null,25,0,null);qa.layoutCtrlCenterAlign(w,16);qa.layoutCtrlWithLRTB(w,null,null,null,5,null,16);B.appendTo(m)}p?(B.show(),ca.setSplitLineWide(33)):(B.hide(),ca.setSplitLineWide(8))},fa=function(){if(A){var p=A.getAllSource();p=!p||0==p.length;pa!=p&&(p?S.setFirstSize(360,60,-1):S.setFirstSize(360,60,400),S.collapseSecondHalf(p),pa=p);var w=A.getAllNodes();w=!w||0==w.length;R||(w?(G(!0),E(!0),J.show(!1)):da());w?(c||(c=new C,c.getJqUi().appendTo(ca.getJqUi())),c.setNoNode(w),c.setNoSource(p),
c.show(),B&&B.css("z-index",0)):(c&&c.hide(),B&&B.css("z-index",100))}},pa=!1,R=!1,da=function(){G(!1);E(!1);J.show(!0)},G=function(p){if(!f){f=$("<div>");f.on("click",da);f.addClass("modeler-designer-preview-show-btn");var w=$("<div>");w.appendTo(f);ja.backgroundWithHover(w,"upArrow");var M=$("<div>");M.text(Q.get("fieldAndPreviewData","\u5b57\u6bb5/\u9884\u89c8"));M.appendTo(f);qa.layoutCtrlMiddleAlign(M,20);qa.layoutCtrlMiddleAlign(w,16);qa.layoutCtrlWithLRTB(M,5,null,120,null,null,null);qa.layoutCtrlWithLRTB(w,
null,5,16,null,null,16);f.appendTo(l.getJqUi())}p?(f.show(),l.setSplitLineWide(33)):(f.hide(),l.setSplitLineWide(8))},y=!1,E=function(p){y!=p&&(l.collapseSecondHalf(p),y=p)},t=function(p,w){if(p==na.KEY_ADD_PREPARED_SOURCE||p==na.KEY_REMOVE_PREPARED_SOURCE||p==na.KEY_SET_PREPARED_SOURCE||p==N.KEY_ADD_NODE||p==N.KEY_REMOVE_NODE)console.log("update main ui"),fa()}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos=
{});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.modeler&&(com.kingdee.bos.qing.modeler={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer&&(com.kingdee.bos.qing.modeler.designer={});"undefined"==typeof com.kingdee.bos.qing.modeler.designer.relationdesigner&&(com.kingdee.bos.qing.modeler.designer.relationdesigner={});var ba=com.kingdee.bos.qing.modeler.designer.relationdesigner;ba.Designer=function(){za.call(this);var T=this.protectedMethod,
m,ia=new Z,X,D;this.setRemoteImpl=function(I){D=I;X&&X.setRemoteImpl(D);ba.NodeFieldHelper.setRemoteImpl(D)};this.protectedInit=function(){X=new F;X.setGlobal(T.getGlobal());X.setRemoteImpl(D);X.setNodeStatusMonitor(ia);X.getJqUi().appendTo(T.getMainUi());T.addToolbarButton(A,"btn_check",Q.get("checkModeler","\u6a21\u578b\u6821\u9a8c"))};this.protectedResize=function(){X&&X.resize()};this.protectedGetModelerModel=function(){m||(m=new N,ba.NodeFieldHelper.init(m));return m};this.setJsonModel=function(I){};
this.setJsonValidity=function(I,aa){};this.setUndoAbleJsonModel=function(I,aa){};var A=function(){}};var qa,za,ha,Y,K,ja,na,C,L,Z,N,k,z,x,q,Q,n;(function(){var T=com.kingdee.bos.qing.modeler.designer;za=T.AbstractDesigner;ha=T.SourceArea;Y=T.TableArea;ja=T.Icons;na=T.ModelerModel;C=T.NoNodePromptUi;L=T.DragHandler;Z=T.NodeStatusMonitor;T=com.kingdee.bos.qing.common;qa=T.DomUtil;T=com.kingdee.bos.qing.modeler.designer.relationdesigner;N=T.RelationModeler;k=T.RelationTableNode;z=T.PropertyArea;x=T.PageArea;
K=T.PreviewArea;q=T.RelationModelerDisplayNameHelper;T=com.kingdee.bos.qing.ui.component;n=T.SplitPane;T=com.kingdee.bos.qing.framework.common;Q=T.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.modeler.designer)})()})();
//qingVersionTag: 20250324