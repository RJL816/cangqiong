var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(U,ha,ja){U instanceof String&&(U=String(U));for(var oa=U.length,ra=0;ra<oa;ra++){var wa=U[ra];if(ha.call(ja,wa,ra,U))return{i:ra,v:wa}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(U,ha,ja){if(U==Array.prototype||U==Object.prototype)return U;U[ha]=ja.value;return U};$jscomp.getGlobal=function(U){U=["object"==typeof globalThis&&globalThis,U,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var ha=0;ha<U.length;++ha){var ja=U[ha];if(ja&&ja.Math==Math)return ja}throw Error("Cannot find global object");};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(U,ha){var ja=$jscomp.propertyToPolyfillSymbol[ha];if(null==ja)return U[ha];ja=U[ja];return void 0!==ja?ja:U[ha]};
$jscomp.polyfill=function(U,ha,ja,oa){ha&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(U,ha,ja,oa):$jscomp.polyfillUnisolated(U,ha,ja,oa))};$jscomp.polyfillUnisolated=function(U,ha,ja,oa){ja=$jscomp.global;U=U.split(".");for(oa=0;oa<U.length-1;oa++){var ra=U[oa];if(!(ra in ja))return;ja=ja[ra]}U=U[U.length-1];oa=ja[U];ha=ha(oa);ha!=oa&&null!=ha&&$jscomp.defineProperty(ja,U,{configurable:!0,writable:!0,value:ha})};
$jscomp.polyfillIsolated=function(U,ha,ja,oa){var ra=U.split(".");U=1===ra.length;oa=ra[0];oa=!U&&oa in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var wa=0;wa<ra.length-1;wa++){var sa=ra[wa];if(!(sa in oa))return;oa=oa[sa]}ra=ra[ra.length-1];ja=$jscomp.IS_SYMBOL_NATIVE&&"es6"===ja?oa[ra]:null;ha=ha(ja);null!=ha&&(U?$jscomp.defineProperty($jscomp.polyfills,ra,{configurable:!0,writable:!0,value:ha}):ha!==ja&&(void 0===$jscomp.propertyToPolyfillSymbol[ra]&&(ja=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[ra]=
$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(ra):$jscomp.POLYFILL_PREFIX+ja+"$"+ra),$jscomp.defineProperty(oa,$jscomp.propertyToPolyfillSymbol[ra],{configurable:!0,writable:!0,value:ha})))};$jscomp.polyfill("Array.prototype.find",function(U){return U?U:function(ha,ja){return $jscomp.findInternal(this,ha,ja).v}},"es6","es3");
(function(){function U(ca,qa,ya,O){ra.call(this,ca,qa,ya,O);var R=this.protectedMethod,S=xa.getAppId(),q=function(d){d.appId=S;return d};this.checkPermission=function(){R.remote("checkPermission",q({}))};this.checkPublicPermission=function(){R.remote("checkPublicPermission",q({}))};this.saveImageInfo=function(d,D){d={model:JSON.stringify(d),isPublic:D};q(d);R.remote("saveImageInfo",d)};this.moveImage=function(d,D){d={model:JSON.stringify(d),groupId:D};q(d);R.remote("moveImage",d)};this.renameImage=
function(d,D){d={imageModel:JSON.stringify(d),imageName:D};q(d);R.remote("renameImage",d)};this.deleteImage=function(d){d={model:JSON.stringify(d)};q(d);R.remote("deleteImage",d)};this.getAllImage=function(){R.remote("getAllImage",{})};this.getAllImageOfCategory=function(d,D){R.remote("getAllImageOfCategory",{categoryId:d,isPreset:D})};this.getAllCategory=function(){R.remote("getAllCategory",q({}))};this.getAllCategoryAndImage=function(){R.remote("getAllCategoryAndImage",{})};this.saveOrUpdateCategory=
function(d){d={model:JSON.stringify(d)};q(d);R.remote("saveOrUpdateCategory",d)};this.saveOrderCategory=function(d,D){d={categories:JSON.stringify({imageCategories:d}),isPublic:D};q(d);R.remote("saveOrderCategory",d)};this.deleteCategory=function(d,D,aa){d={categoryId:d,categoryName:D,isPublic:aa};q(d);R.remote("deleteCategory",d)};this.getRefTimeOfImage=function(d){R.remote("getRefTimeOfImage",{imageFileName:d})};this.getImageModelByImageFileName=function(d){R.remote("getImageModelByImageFileName",
{imageFileName:d})};this.loadImageModelByImagePath=function(d){R.remote("loadImageModelByImagePath",{imagePath:d})};this.exportImages=function(d){d={images:JSON.stringify({images:d})};R.remote("exportSelectedImages",d)};this.parseFileToImages=function(d){d={fileName:d};q(d);R.remote("parseFileToImages",d)};this.importSelectedImages=function(d,D){d={images:JSON.stringify({images:d}),cacheFileName:D};q(d);R.remote("importSelectedImages",d)};this.conflictHanding=function(d,D){d={images:JSON.stringify({images:d}),
cacheFileName:D};q(d);R.remote("conflictHanding",d)};this.checkImageExist=function(d){R.remote("checkImageExist",{imageFileName:d})};this.importGalleryImages=function(d){var D=com.kingdee.bos.qing.behavior.BehaviorManager;D.interestInBehavior(D.CLOUD_GALLERY_DOWNLOAD,1);d={fileName:d};q(d);R.remote("importGalleryImages",d)};this.uploadGalleryTmpFile=function(d){d={tmpFile:d};q(d);R.remote("uploadGalleryTmpFile",d)};this.splitJointGalleryTmpFile=function(d){d={uploadBuffer:JSON.stringify(d)};q(d);
R.remote("splitJointGalleryTmpFile",d)}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.imagelib&&(com.kingdee.bos.qing.imagelib={});"undefined"==typeof com.kingdee.bos.qing.imagelib.common&&(com.kingdee.bos.qing.imagelib.common={});var ha=com.kingdee.bos.qing.imagelib.common;ha.ImagelibFacade=U;ha.ImageLibRemoteImpl=
function(){wa.call(this);var ca;this.getRemoteUrl=function(){return ca};this.setRemoteUrl=function(qa){ca=qa}};var ja,oa,ra,wa,sa;(function(){var ca=com.kingdee.bos.qing.common;ja=ca.Util;ca=com.kingdee.bos.qing.framework.common;oa=ca.MultilanguageManager.createPackageAccessor(ha);ra=ca.AbstractFacade;wa=ca.AbstractRemoteCall;sa=ca.RemoteFramework})();var xa=ha.ImageLibUtil=new function(){var ca=this,qa=!1,ya,O,R;(function(){var S=com.kingdee.bos.qing.common.Util.decodeParamFromUrl(window.location.search,
"path");S=(S?S:"/ierp")+"/qing/imagelib.do";var q=new com.kingdee.bos.qing.imagelib.common.ImageLibRemoteImpl;q.setRemoteUrl(S);ya=q})();this.setHasPublicPermission=function(S){qa=!!S};this.hasPublicPermission=function(){return qa};this.setAppId=function(S){R=S};this.getAppId=function(){return R};this.setMessageCurtain=function(S){O=S};this.getMessageCurtain=function(){return O};this.checkPermission=function(S){xa.createFacade(function(q){S(q)},function(){return!1}).checkPermission()};this.checkPublicPermission=
function(S){xa.createFacade(function(q){S(q)},function(){return!1}).checkPublicPermission()};this.createFacade=function(S,q,d){return new U(ya,S,function(D,aa){return q(D,aa)?!0:1100010===D?(ca.getMessageCurtain().showPrompt(oa.get("noPublicCategoryPermission","\u6ca1\u6709\u64cd\u4f5c\u516c\u5171\u76ee\u5f55\u7684\u6743\u9650\u3002")),!0):!1},d)};this.downloadExportFile=function(S){var q=ja.formatDate("yyyyMMdd_HHmmss");sa.downloadFile("Qing-"+q+".qing-pic",S)};this.highlightKeyWords=function(S,
q,d){if(q&&d){q=q.toUpperCase();var D=d.toUpperCase(),aa=D.split(q),ia=q.length,K;for(K in aa){var da=D.indexOf(aa[K]),V=d.substr(ta,aa[K].length);da+=aa[K].length;var ea=D.length-da;D=D.substr(da,ea);d=d.substr(da,ea);da=$("<span>");da.text(V);da.appendTo(S);if(K!==aa.length-1&&1<aa.length){var ta=D.indexOf(q);V=d.substr(ta,ia);da=ta+ia;ea=D.length-da;D=D.substr(da,ea);d=d.substr(da,ea);da=$("<span>");da.text(V);da.css("color","red");da.clone().appendTo(S)}}}else S.text(d)}}})();(function(){function U(){}function ha(){var O=this,R,S,q,d,D=!1,aa=!1,ia=!1;this.setId=function(K){R=K};this.getId=function(){return R};this.setName=function(K){S=K};this.getName=function(){return S};this.setOrder=function(K){q=K};this.getOrder=function(){return q};this.setPreset=function(K){D=K};this.isPreset=function(){return D};this.setPublic=function(K){aa=K};this.isPublic=function(){return aa};this.setGallery=function(K){ia=K};this.isGallery=function(){return ia};this.setParentId=function(K){d=
K};this.getParentId=function(){return d};this.getFullPath=function(){var K=aa?ca.PERSISTENT_NAMESPACE_COMMON:ca.PERSISTENT_NAMESPACE_USER;K=D?ca.PERSISTENT_NAMESPACE_SYSTEM:K;return K+O.getName()};this.getNameSpace=function(){var K=aa?ia?ca.PERSISTENT_NAMESPACE_GALLERY_COMMON:ca.PERSISTENT_NAMESPACE_COMMON:ia?ca.PERSISTENT_NAMESPACE_GALLERY_USER:ca.PERSISTENT_NAMESPACE_USER;return K=D?ca.PERSISTENT_NAMESPACE_SYSTEM:K};this.shallowCopy=function(){var K=new ha;K.fromJsonObject(O.toJsonObject());return K};
this.fromJsonObject=function(K){O.setId(K.id);O.setName(K.name);O.setOrder(K.order);O.setParentId(K.parentId);D=K.isPreset;aa=K.isPublic;ia=K.isGallery};this.toJsonObject=function(){var K={};K.id=O.getId();K.name=O.getName();K.order=O.getOrder();K.parentId=O.getParentId();K.isPublic=O.isPublic();K.isPreset=O.isPreset();K.isGallery=O.isGallery();return K}}function ja(){sa.call(this);var O=this,R;this.setCardType=function(S){R=S};this.getCardType=function(){return R};this.isNameDuplicate=function(S){return S===
O.getName()}}function oa(){var O=this,R,S,q,d,D,aa,ia,K,da;this.setId=function(V){R=V};this.getId=function(){return R};this.setName=function(V){S=V};this.getName=function(){return S};this.setType=function(V){q=V};this.getType=function(){return q};this.setWidth=function(V){d=V};this.getWidth=function(){return d};this.setHeight=function(V){D=V};this.getHeight=function(){return D};this.setFileName=function(V){aa=V};this.getFileName=function(){return aa};this.setHasContent=function(V){K=V};this.hasContent=
function(){return K};this.setCategoryId=function(V){ia=V};this.getCategoryId=function(){return ia};this.getThumbnailFileName=function(){return da};this.setNameAndType=function(V){O.setName(V.substring(0,V.lastIndexOf(".")));q=V.substring(V.lastIndexOf(".")+1)};this.getFullName=function(){return O.getName()+"."+q};this.getAspectRatio=function(){return d/D};this.getWidthAtSameRatio=function(V){var ea=O.getAspectRatio();return Math.floor(ea*V)};this.getHeightAtSameRatio=function(V){var ea=O.getAspectRatio();
return Math.floor(V/ea)};this.isSameType=function(V){return V===U.ALL?!0:-1<V.indexOf(q)};this.getThumbnailUrl=function(){return ya.getLoadImgUrl(da,oa.FILE_TYPE)+"&contentType=image/"+q};this.getImageUrl=function(){return ya.getLoadImgUrl(aa,oa.FILE_TYPE)+"&contentType=image/"+q};this.getFullPath=function(){return O.getParent().getName()+"/"+O.getName()+"."+O.getType()};this.shallowCopy=function(){var V=new oa;V.fromJsonObject(this.toJsonObject());return V};this.fromJsonObject=function(V){R=V.fId;
var ea=V.imageName;O.setName(ea.substring(0,ea.lastIndexOf(".")));q=ea.substring(ea.lastIndexOf(".")+1);ia=V.categoryId;d=V.imageWidth;D=V.imageHeight;aa=V.imageFileName;K=V.hasContent;da=V.thumbnailFileName};this.toJsonObject=function(){var V={};V.fId=O.getId();V.categoryId=O.getCategoryId();V.imageName=O.getFullName();V.imageWidth=d;V.imageHeight=D;V.imageFileName=aa;V.thumbnailFileName=da;return V}}function ra(){var O=this,R,S=!1,q=!0,d=!1,D=!1,aa;this.getId=function(){return aa&&aa.getId()};this.getName=
function(){return aa&&aa.getName()};this.setUserObject=function(K){aa=K};this.getUserObject=function(){return aa};this.setParent=function(K){R=K};this.getParent=function(){return R};this.setVisible=function(K,da,V){if(K!==O.isVisible()){q=K;if(V&&O.getChildren&&(V=O.getChildren())&&0<V.length)for(var ea=0;ea<V.length;ea++)V[ea].setVisible(K,!1,!0);if(da&&(da=O.getParent()))if(K)da.setVisible(K,!0,!1),ia(da);else{V=K=!1;ea=!0;var ta=da.getChildren();if(ta&&0<ta.length)for(var ma=0;ma<ta.length;ma++){var va=
ta[ma],ba=va.isVisible();va.isVisible()&&(K=!0,ea=ea&&va.isChecked());V=V||ba}K&&da.setChecked(ea,!0,!1);da.setVisible(V,!0,!1)}}};this.isVisible=function(){return q};this.setChecked=function(K,da,V){if(K!==O.isChecked()){d=K;if(V&&O.getChildren&&(V=O.getChildren())&&0<V.length)for(var ea=0;ea<V.length;ea++){var ta=V[ea];ta.isGrey()||ta.isVisible()&&ta.setChecked(K,!1,!0)}da&&(K=O.getParent())&&ia(K)}};this.isChecked=function(){return d};this.setVisited=function(K){D=K};this.isVisited=function(){return D};
this.setGrey=function(K){S=K};this.isGrey=function(){return S};this.equals=function(K){return K&&K.equals?O.getId()===K.getId():!1};this.isHide=function(){var K=!1;if(q)for(var da=O.getParent();da;){if(!da.isExpanded()){K=!0;break}da=da.getParent()}else K=!0;return K};var ia=function(K){var da=!0,V=!1,ea=K.getChildren();if(ea&&0<ea.length)for(var ta=0;ta<ea.length;ta++){var ma=ea[ta];!ma.isGrey()&&ma.isVisible()&&(V=!0,da=da&&ma.isChecked())}V&&K.setChecked(da,!0,!1)};this.getSubNodeLevel=function(){for(var K=
0,da=O.getParent();da;)K++,da=da.getParent();return K}}function wa(){ra.call(this);var O=this,R=!0,S=[],q=[];this.shallowCopy=function(){var d=this.getUserObject().shallowCopy(),D=new wa;D.setUserObject(d);D.setVisited(O.isVisited());return D};this.isDuplicate=function(d,D){for(var aa=0;aa<S.length;aa++)if(D(d)===D(S[aa]))return!0;return!1};this.setExpanded=function(d){O.isExpanded()!==d&&(R=d)};this.isExpanded=function(){return R};this.setChildren=function(d){if(!d)throw Error("Parameter 'arrChildren' must not be undefined.");
S=d};this.getChildren=function(){return S};this.setDirChildren=function(d){q=d};this.getDirChildren=function(){return q};this.addDirChildren=function(d){d&&q.push(d)};this.addDirTo=function(d,D){d&&q.splice(D,0,d)};this.deleteDirChildren=function(d){if(d)for(var D=0;D<q.length;D++)if(d.equals(q[D])){q.splice(D,1);break}};this.check=function(d,D){if(d!==O.isChecked()){O.setChecked(d);var aa,ia=O.getChildren();if(ia&&0<ia.length)for(aa=0;aa<ia.length;aa++)ia[aa].check(d);D&&D(O.getParent())}};this.add=
function(d){d&&S.push(d)};this.addTo=function(d,D){d&&S.splice(D,0,d)};this.deleteByEquals=function(d){if(d)for(var D=0;D<S.length;D++)if(d.equals(S[D])){S.splice(D,1);break}};this.deleteFrom=function(d){0>d||d>S.length-1||S.splice(d,1)};this.fromJsonObject=function(d){if(d=d.children)for(var D=0;D<d.length;D++){var aa=d[D],ia=new wa,K=new ha;K.fromJsonObject(aa);ia.fromJsonObject(aa);ia.setParent(O);ia.setUserObject(K);q.push(ia)}};this.fromJsonObjectForExport=function(d){if(d=d.children)for(var D=
0;D<d.length;D++){var aa=d[D],ia=new wa,K=new ha;K.fromJsonObject(aa);ia.fromJsonObjectForExport(aa);ia.setParent(O);ia.setUserObject(K);ia.setExpanded(!1);S.push(ia)}}}function sa(){ra.call(this);var O=this,R;this.setParent=function(S){R=S};this.getParent=function(){return R};this.shallowCopy=function(){var S=this.getUserObject().shallowCopy(),q=new sa;q.setUserObject(S);return q};this.check=function(S,q){S!==O.isChecked()&&(O.setChecked(S),q&&q(O.getParent()))}}function xa(){var O,R,S,q,d=xa.CONFLICT_STRATEGY_IGNORE;
this.isPublic=function(){return ca.PERSISTENT_NAMESPACE_COMMON===O||ca.PERSISTENT_NAMESPACE_GALLERY_COMMON===O};this.isGallery=function(){return ca.PERSISTENT_NAMESPACE_GALLERY_COMMON===O||ca.PERSISTENT_NAMESPACE_GALLERY_USER===O};this.isPreset=function(){return ca.PERSISTENT_NAMESPACE_SYSTEM===O};this.setNameSpace=function(D){O=D};this.getNameSpace=function(){return O};this.getImageName=function(){return R};this.getImageFileName=function(){return q};this.getCategoryName=function(){return S};this.setConflictStrategy=
function(D){d=D};this.getConflictStrategy=function(){return d};this.fromJsonObject=function(D){O=D.nameSpace;R=D.imageName;S=D.categoryName;q=D.imageFileName};this.toJsonObject=function(){var D={};D.nameSpace=O;D.imageName=R;D.categoryName=S;D.imageFileName=q;D.conflictStrategy=d;return D}}function ca(){var O,R,S;this.getNameSpace=function(){return O};this.setNameSpace=function(q){O=q};this.getCategoryName=function(){return R};this.setCategoryName=function(q){R=q};this.getName=function(){return S};
this.setName=function(q){S=q};this.getImageFullPath=function(){return O+ca.SEPERATOR+R+ca.SEPERATOR+S};this.fromJsonObject=function(q){O=q.nameSpace;R=q.groupName;S=q.name};this.toJsonObject=function(){var q={};q.nameSpace=O;q.groupName=R;q.name=S;return q};this.getPathString=function(){var q;O&&R&&S&&(q=O+ca.SEPERATOR+R+ca.SEPERATOR+S);return q}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==
typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.imagelib&&(com.kingdee.bos.qing.imagelib={});"undefined"==typeof com.kingdee.bos.qing.imagelib.model&&(com.kingdee.bos.qing.imagelib.model={});var qa=com.kingdee.bos.qing.imagelib.model;qa.ImageCategory=ha;qa.Image=oa;qa.ImageType=U;qa.UploadOpModel=function(){ja.call(this);this.setVisible(!1);this.setCardType(ja.UPLOAD_CARD);this.setVisible=function(O){};this.isSameType=function(){return!0};this.isNameDuplicate=
function(O){return!1};this.copy=function(){return new this}};qa.FolderNode=wa;qa.ImportImage=xa;qa.ImportResult=function(){var O,R=[],S=[];this.setAllSuccess=function(q){O=q};this.isAllSuccess=function(){return O};this.setSuccessIds=function(q){R=q};this.getSuccessIds=function(){return R};this.setConflictImages=function(q){S=q};this.getConflictImages=function(){return S};this.getSuccessCount=function(){return R.length};this.fromJsonObject=function(q){var d=[],D=q.conflictImages;R=q.successfulIds;
O=q.allSuccess;for(q=0;q<D.length;q++){var aa=new xa;aa.fromJsonObject(D[q]);d.push(aa)}S=d}};qa.LeafNode=sa;qa.PathModel=ca;qa.ThumbnailUrlModel=function(){var O,R,S,q,d=this;this.setImageFileName=function(D){O=D};this.getImageFileName=function(){return O};this.setQingFileType=function(D){R=D};this.getQingFileType=function(){return R};this.setImageType=function(D){S=D};this.getImageType=function(){return S};this.setImageFullPathModel=function(D){q=D};this.getImageFullPathModel=function(){return q};
this.fromJsonObject=function(D){O=D.imageFileName;R=D.qingFileType;S=D.imageType;if(D=D.imageFullPathModel)q=new ca,q.fromJsonObject(D)};this.toJsonObject=function(){var D={};D.imageFileName=O;D.qingFileType=R;D.imageType=S;q&&(D.imageFullPathModel=q.toJsonObject());return D};this.getImagePathFromJson=function(D){if(D){if(D=JSON.parse(D),d.fromJsonObject(D),O){var aa=com.kingdee.bos.qing.framework.common.RemoteFramework.getLoadImgUrl(O,R);aa=aa+"&contentType=image/"+S}}else aa=com.kingdee.bos.qing.CodeLoader.getIconUrl("lightapp/common",
"icon_dashboard_building.png");return aa};this.getImagePathFromUrl=function(D){D||(D=com.kingdee.bos.qing.CodeLoader.getIconUrl("lightapp/common","icon_dashboard_building.png"));return D};this.getJsonImagePath=function(){return O||q?JSON.stringify(d.toJsonObject()):null};this.checkHasImage=function(D,aa){if(D){var ia=document.createElement("img");ia.crossOrigin="anonymous";ia.setAttribute("crossOrigin","Anonymous");ia.onerror=function(){aa(!1)};ia.onload=function(){0<ia.fileSize||0<ia.width||0<ia.height?
aa(!0):aa(!1)};ia.src=D}else aa(!1)}};var ya=com.kingdee.bos.qing.framework.common.RemoteFramework;U.PNG="png";U.JPG="jpg";U.JPEG="jpeg";U.BMP="bmp";U.GIF="gif";U.ALL="all";qa.ImageLibModelUtil=new function(){var O=[],R=[];O.push(U.ALL);O.push(U.PNG);O.push(U.JPG);O.push(U.BMP);O.push(U.GIF);R.push(U.ALL);R.push(U.PNG);R.push(U.JPG+"/"+U.JPEG);R.push(U.BMP);R.push(U.GIF);this.getAllTypeWithSeparator=function(S){var q=R.concat();q.splice(0,1);var d,D="";for(d=0;d<q.length;d++)D+=q[d],d!==q.length-
1&&(D+=S);return D};this.getAllType=function(){return R}};ha.GROUP_NAME_MAX_LENGTH=50;ha.GROUP_TYPE_PRIVATE=0;ha.GROUP_TYPE_PUBLIC=1;ha.GROUP_TYPE_PRESET=2;ja.IMAGE_CARD="image";ja.UPLOAD_CARD="upload";oa.FILE_TYPE="image-library";xa.CONFLICT_STRATEGY_IGNORE=0;xa.CONFLICT_STRATEGY_OVERWRITE=1;xa.CONFLICT_STRATEGY_RENAME=2;ca.SEPERATOR="/";ca.NAMESPACE_SYSTEM="system";ca.PERSISTENT_NAMESPACE_SYSTEM="$system$";ca.NAMESPACE_COMMON="common";ca.PERSISTENT_NAMESPACE_COMMON="$common$";ca.NAMESPACE_USER=
"user";ca.PERSISTENT_NAMESPACE_USER="$user$";ca.NAMESPACE_GALLERY_USER="gallery_user";ca.PERSISTENT_NAMESPACE_GALLERY_USER="$gallery_user$";ca.NAMESPACE_GALLERY_COMMON="gallery_common";ca.PERSISTENT_NAMESPACE_GALLERY_COMMON="$gallery_common$"})();(function(){function U(){S||(S=com.kingdee.bos.qing.imagelib.MyIcons);return S}function ha(k){var g=this,b,a,c,r,h,e,f=!1,l=[],t=[],G=k,B=k,m=G[1],u=[],I,X=function(){b=$("<div>");b.addClass("manage-card-list");y(G);var p=$("<div>");p.addClass("img-lib-mange-lists-dir");p.addClass("img-lib-mange-lists-dir-head");p.data("oNode",u[0]);p.css("cursor","pointer");var v=$("<div>"),F=P.get("userUploadFile","\u4e0a\u4f20\u7684\u56fe\u7247");v.text(F);v.addClass("img-lib-mange-lists-dir-text");v.css("margin-right",
"74px");v.css("color","#666666");p.append(v);var L=$("<div>");L.addClass("select-tree-menu-head-icon");L.css("position","absolute");ba.background(L,"arrow-down");p.append(L);c=C();c.setItemModels(l,Y);var H=c.getJqUi();H.addClass("img-lib-mange-lists-dir-imglist");H.appendTo(b);p.on("click",function(la){e(!1)});var ka=$("<div>");ka.addClass("img-lib-mange-lists-dir");ka.addClass("img-lib-mange-lists-dir-head-gallery");ka.data("oNode",u[1]);ka.css("cursor","pointer");v=$("<div>");F=P.get("downloadGallery",
"\u6765\u81ea\u4e91\u7d20\u6750");v.text(F);v.addClass("img-lib-mange-lists-dir-text");v.css("color","#666666");ka.append(v);var Q=$("<div>");Q.addClass("select-tree-menu-head-icon");Q.css("position","absolute");ba.background(Q,"arrow-up");Q.addClass("select-tree-menu-head-icon-transform");ka.append(Q);r=C();r.setItemModels(t,Y);var fa=r.getJqUi();fa.addClass("img-lib-mange-lists-dir-gallery");fa.hide();fa.appendTo(b);ka.on("click",function(la){e(!0)});p.appendTo(b);u[1]?ka.appendTo(b):H.css("bottom",
"0px");a=c;G=l;g.setFunOpenOrCloseList(function(la){la?"none"==fa.css("display")?(H.hide(),fa.show(),ba.background(L,"arrow-up"),L.addClass("select-tree-menu-head-icon-transform"),ba.background(Q,"arrow-down"),Q.removeClass("select-tree-menu-head-icon-transform"),ka.css("position","relative"),a=r,f=!0,G=t,g.refreshList(G)):(fa.hide(),ba.background(Q,"arrow-up"),Q.addClass("select-tree-menu-head-icon-transform"),"block"==H.css("display")&&ka.css("position","absolute")):"none"==H.css("display")?(H.show(),
fa.hide(),ba.background(L,"arrow-down"),ba.background(Q,"arrow-up"),Q.addClass("select-tree-menu-head-icon-transform"),L.removeClass("select-tree-menu-head-icon-transform"),ka.css("position","absolute"),a=c,f=!1,G=l,g.refreshList(G)):(H.hide(),ba.background(L,"arrow-up"),L.addClass("select-tree-menu-head-icon-transform"),ka.css("position","relative"))})},Y=function(p,v){p=p.getUserObject();v=v.getUserObject();return p.getId()==v.getId()},y=function(p){var v;B=p;u=[];t=[];l=[];for(v=0;v<p.length;v++)p[v].getParent()||
u.push(p[v]),p[v].getUserObject().isGallery()?t.push(p[v]):l.push(p[v])},C=function(){var p=new pa;p.setCustomItemPainter(g.listItemPainter);p.setBorderVisible(!1);p.addSelectedChangedListener(function(v,F,L){L&&0<L.length&&(v=L[0],v.getParent()&&((f?c:r).setSelecteds(u),g.itemClick(v),m=v))});return p};this.setFunOpenOrCloseList=function(p){e=p};this.setSelected=function(p){f!=p.getUserObject().isGallery()&&(p.getUserObject().isGallery()&&0< !t.length?p=l[1]:e&&e(p.getUserObject().isGallery()));
var v=[];v.push(p);a.setSelecteds(v)};this.getSelected=function(){var p=a.getSelecteds();return 0===p.length?null:p[0]};this.addModel=function(p){G.push(p);g.updateUi()};this.setModels=function(p){y(p);G=l;g.updateUi()};this.getList=function(){return a};this.deleteByModel=function(p){if(!p)throw Error("Model is null.");for(var v,F=0;F<G.length;F++)if(G[F].equals(p)){a:{v=p;var L=v.getParent(),H=L.getDirChildren();if(1==H.length)v=L;else{for(L=0;L<H.length;L++)if(H[L].equals(v)){v=L+1>=H.length?H[L-
1]:H[L+1];break a}v=void 0}}G.splice(F,1);p.equals(g.getCurrent())&&(a.setItemModels(G,Y),g.setSelected(v));break}p.getParent()&&p.getParent().deleteDirChildren(p);B=g.getAllModels();g.updateUi()};this.updateListAndUi=function(){y(B);G=f?t:l;g.updateUi()};this.updateUi=function(){if(G&&0!==G.length||h)if(G&&0!==G.length){if(h&&h.hide(),a.setItemModels(G,Y),0==document.body.clientHeight||0==document.body.clientWidth)I=new Z,I.setDelay(250),I.setCallbackImmediately(function(){I&&I.unobserve();a.scrollSelectedToVisible()}),
I.observe()}else h&&h.show();else h=w(),h.appendTo(b)};this.getJqUi=function(){b||X();return b};this.getModels=function(){return G};this.getAllModels=function(){var p,v=[];for(p=0;p<l.length;p++)v.push(l[p]);for(p=0;p<t.length;p++)v.push(t[p]);return v};this.getCurrent=function(){return m};this.getHeight=function(){return k.length*ha.ITEM_HEIGHT};this.bindChildrenIntoCategories=function(p){if(p&&0!==p.length){var v=g.getAllModels(),F,L;for(F=0;F<v.length;F++){var H=[],ka=v[F];for(L=0;L<p.length;L++){var Q=
p[L];Q.getUserObject().getCategoryId()===ka.getId()&&(H.push(Q),Q.setParent(ka))}ka.setChildren(H);ka.setVisited(!0)}}};this.updateCurrent=function(p){m=p};var w=function(){var p=$("<div>");p.css({position:"absolute",top:"0",left:"0",right:"0",bottom:"0","z-index":"2",color:"rgb(102, 102, 102)"});var v=$("<div>");v.text(g.getNoDataPrompt());q.layoutCtrlCenterAlign(v,500);v.css({height:"20px","line-height":"20px","text-align":"center","font-size":"16px",color:"#BBBBBB",top:"50%","margin-top":"33.5px"});
v.appendTo(p);v=$("<div>");U().background(v,"no-data");q.layoutCtrlCenterAlign(v,187);v.css({"background-size":"contain",top:"50%",height:"187px","margin-top":"-178.5px"});v.appendTo(p);return p};this.getNoDataPrompt=function(){throw Error("Override me!");};this.itemClick=function(p){throw Error("Override me!");};this.refreshList=function(p){throw Error("Override me!");};this.listItemPainter=function(p,v){throw Error("Override me!");};this.abstractProtectMethod={getIndex:function(p){if(!p)throw Error("Model is null.");
for(var v=0;v<G.length&&!G[v].equals(p);v++);return v},funItemModelEqualsChecker:Y}}function ja(){var k=this,g,b,a,c,r,h,e,f;this.setFunJumpToImage=function(B){e=B};this.setFunWidthChangedCallback=function(B){f=B};this.updateUi=function(B,m){k.emptyList();var u=0;if(0===B.length)r||l(a),r.show();else{r&&r.hide();var I;for(I=0;I<B.length;I++){var X=B[I],Y=(new oa(X,m)).getJqUi();Y.data("oModel",X);Y.on("click",function(y){y=$(y.currentTarget).data("oModel");e&&e(y.getParent(),y)});Y.css("margin","2px");
Y.appendTo(a);u++}}t(u)};var l=function(){r=$("<div>");r.addClass("image-lib-search-panel-no-data");h=$("<div>");h.text(P.get("noSearchedResults","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c"));q.layoutCtrlCenterAlign(h,500);h.addClass("image-lib-search-panel-no-data-prompt");h.css({height:"20px","line-height":"20px","margin-top":"98.5px"});h.appendTo(r);var B=$("<div>");U().background(B,"no-data");q.layoutCtrlCenterAlign(B,187);B.addClass("image-lib-search-panel-no-data-icon");
B.css({height:"187px","margin-top":"-113.5px"});B.appendTo(r);g.append(r)};this.showOrHide=function(B){B?g.show():g.hide()};this.emptyList=function(){a.empty()};this.getWidth=function(){return 314};this.isHidden=function(){return g.is(":hidden")};this.getJqUi=function(){return g};this.init=function(){g=$("<div>");g.addClass("manage-search");q.layoutCtrlWithLRTB(g,null,0,314,0,null,null);g.css("z-index","1");g.height("100%");var B=g,m=$("<div>");m.addClass("manage-search-header");q.layoutCtrlWithLRTB(m,
0,0,null,0,null,36);m.appendTo(B);b=$("<div>");b.addClass("manage-search-header-hits-prompt");b.appendTo(m);B=g;a=$("<div>");q.layoutCtrlWithLRTB(a,0,0,null,36,40,null);a.width(291);a.addClass("manage-search-list");a.appendTo(B);G(g)};var t=function(B){b.text(P.get("allHitsNumberPrompt","\u5171\u641c\u7d22\u5230 \u201c#1\u201d \u4e2a\u7ed3\u679c").replace("#1",B))},G=function(B){var m=$("<div>");m.addClass("manage-search-footer");q.layoutCtrlWithLRTB(m,0,0,null,null,0,40);m.appendTo(B);c=new va;c.setText(P.get("close",
"\u5173\u95ed"));c.setHighlight(!0);c.addActionListener(function(){k.showOrHide(!1);f()});B=c.getJqUi();B.addClass("manage-search-footer-btn");B.appendTo(m)}}function oa(k,g){var b,a;this.getJqUi=function(){b||c();return b};var c=function(){b=$("<div>");b.addClass("manage-search-result-item");b.width(135);b.height(158);b.on("mousedown",function(f){$(f.currentTarget).css("background-color","var(--color-main, #5582f3)");a.css("color","#fff")});b.on("mouseup",function(f){$(f.currentTarget).css("background-color",
"");a.css("color","")});r(b);h(b);e(b)},r=function(f){for(var l=k.getParent(),t=l.getUserObject(),G=l.getName();l.getParent();)l=l.getParent(),G=l.getName()+"/"+G;l=G;t=(t.isPublic()?P.get("public","\u516c\u5171"):P.get("private","\u4e2a\u4eba"))+"/"+l;a=$("<div>");a.addClass("image-lib-search-item-category");a.text(t);a.attr("title",t);a.appendTo(f)},h=function(f){var l=k.getUserObject(),t=l.getName(),G=l.getThumbnailUrl(),B=135/113;if(l.hasContent()){var m=$("<img>");m.addClass("image-lib-search-item-image");
m.css({"max-width":135,"max-height":113});m.attr("src",G);m.attr("alt",t);B<l.getAspectRatio()?(m.css("width",135),l=l.getHeightAtSameRatio(135),m.css("top",Math.floor((113-l)/2))):(m.css("height",113),l=l.getWidthAtSameRatio(113),m.css("left",Math.floor((135-l)/2)))}else m=$("<div>"),m.addClass("image-lib-choose-no-image"),m.css({width:135,height:113}),l=$("<div>"),l.addClass("image-lib-choose-no-image-icon"),U().background(l,"icon-no-image"),l.appendTo(m),l=$("<div>"),l.addClass("image-lib-choose-no-image-text"),
t=P.get("imageCanNotBeFind","\u627e\u4e0d\u5230\u5bf9\u5e94\u7684\u56fe\u7247"),l.attr("title",t),l.text(t),l.appendTo(m);l=$("<div>");q.layoutCtrlWithLRTB(l,0,0,null,20,25,null);m.appendTo(l);k.getParent().getUserObject().isPreset()&&(m=$("<div>"),m.addClass("image-lib-transform_-35"),U().background(m,"icon-preset"),t=$("<div>"),t.addClass("manage-search-result-item-preset-icon"),t.text(P.get("preset","\u9884\u7f6e")),q.layoutCtrlWithLRTB(m,null,0,39,0,null,40),m.css("z-index","1"),t.appendTo(m),
m.appendTo(l));l.appendTo(f)},e=function(f){var l=k.getName(),t=$("<div>");t.addClass("image-lib-search-item-title");x.highlightKeyWords(t,g,l);t.attr("title",l);t.appendTo(f)}}function ra(){var k=this,g,b,a,c;this.preview=function(h){if(!h)throw Error("Do not know which picture to preview.");g||r();c&&c.hide();a.show();var e=h.getName(),f=h.getImageUrl(),l=h.getName(),t=h.getWidth();h=h.getHeight();b.text(l+"\u00a0\u00a0\u00a0\u00a0"+t+" * "+h);a.attr("src",f);a.attr("alt",e);g.show()};var r=function(){g=
$("<div>");g.addClass("image-preview-modallayer");var h=$("<div>");q.layoutCtrlWithLRTB(h,10,100,null,10,10);h.appendTo(g);b=$("<div>");b.addClass("image-preview-title");b.appendTo(h);var e=$("<div>");q.layoutCtrlWithLRTB(e,5,5,null,35,5);e.appendTo(h);c=$("<div>");c.addClass("image-lib-align_margin_auto");c.css("width","100px");c.css("height","60px");h=$("<div>");q.layoutCtrlWithLRTB(h,"50%",0,36,0,0,36);q.layoutCtrlCenterAlign(h,36);U().background(h,"icon-no-image");h.appendTo(c);h=$("<div>");q.layoutCtrl(h,
0,40,"100%",20);h.css("text-align","center");h.css("font-size","14px");h.text(P.get("previewImageFail","\u56fe\u7247\u9884\u89c8\u5931\u8d25"));h.appendTo(c);c.appendTo(e);a=$("<img>");a.addClass("image-lib-align_margin_auto image-lib-max-size_top");a.on("error",function(f){(f=$(f.target))&&f.hide();c.show()});a.appendTo(e);e=$("<div>");e.addClass("image-preview-close-btn");e.attr("title",P.get("exit","\u9000\u51fa"));e.on("click",function(){k.hideOrRemove(!1)});e.appendTo(g);h=$("<div>");h.addClass("image-preview-close-btn-icon");
h.appendTo(e);g.appendTo(document.body)};this.hideOrRemove=function(h){a.attr("src",null);h?g&&g.remove():g&&g.hide()}}function wa(){var k=this,g,b,a,c,r=250,h=250,e=36,f=!1,l;this.getJqUi=function(){return g};this.setFooterHeight=function(t){e=t};this.setModel=function(t){l=t};this.getModel=function(){return l};this.getContentWidth=function(){return r-10-2};this.getContentHeight=function(){return h-10-e-2};this.setClickable=function(t){f=t};this.setHasHoverStyle=function(t){};this.updateUi=function(){throw Error("Override me!");
};this.doClick=function(){throw Error("Override me!");};this.protectedMethod={init:function(){g=$("<div>");g.addClass("manage-card");g.css({"border-width":"1px","border-style":"solid","border-radius":"1px"});g.width(r);g.height(h);f&&(g.css("cursor","pointer"),g.on("click",k.doClick));var t=g;b=$("<div>");b.addClass("manage-card-content");b.css("bottom",e+"px");b.css("padding","5px");b.appendTo(t);t=g;a=$("<div>");a.addClass("manage-card-footer");a.css({height:e+"px","line-height":e+"px"});a.appendTo(t);
c=$("<div>");c.addClass("manage-card-footer-tail");c.appendTo(a)},rename:function(t){t=t.trim();l.setName(t)},remove:function(){l=null;g&&g.remove()},doCopy:function(t){var G=document.createElement("textarea");G.value=t;G.setAttribute("readonly","");G.style.position="absolute";G.style.left="-9999px";document.body.appendChild(G);G.select();document.execCommand("copy");document.body.removeChild(G)},setSize:function(t,G){r=t;h=G},addCustomJq2Content:function(t){t.css({"max-width":k.getContentWidth()+
"px","max-height":k.getContentHeight()+"px"});t.appendTo(b)},addOpIcon2FooterTail:function(t){t.addClass("manage-card-op-common");t.appendTo(c)},addCustomJq2FooterHead:function(t){t.css("float","left");t.css("max-width",r-78-2-10+"px");t.prependTo(a)},addCustomJq2FooterTail:function(t){t.appendTo(c)},setPresetIconBack:function(){var t=$("<div>");t.addClass("image-lib-transform_-35");U().background(t,"icon-preset-big");var G=$("<div>");G.addClass("image-card-preset-icon-text");G.text(P.get("preset",
"\u9884\u7f6e"));G.attr("title",P.get("preset","\u9884\u7f6e"));G.css({overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"});q.layoutCtrlWithLRTB(t,null,0,54,0,null,54);G.appendTo(t);t.appendTo(g)}}}function sa(){d.call(this);var k=this,g=this.protectedMethod,b,a,c,r,h,e,f,l=!1;this.setFunClosingCallBack=function(m){r=m};this.getInputCtrlTop=function(){return 50};this.getMessageCurtain=function(){return g.getMessageCurtain()};this.init=function(){$("<div>");k.setSize(400,300);g.setSelectable(!0);
g.setTitle(h);g.setContentPaneCreator(t);g.setClosingChecker(B,!0);g.setClosingAction(G)};this.setLabelRequired=function(m){l=m};var t=function(){a=$("<div>");b=new ea;b.setRequired(l);b.setText(e);var m=b.getJqUi();q.layoutCtrlWithLRTB(m,null,null,null,k.getInputCtrlTop(),null,null);m.css({"float":"left","margin-left":"25px"});a.append(m);k.inputCtrlCreator(a);c=$("<div>");c.addClass("manage-op-message-tip");c.appendTo(a);return a};this.inputCtrlCreator=function(m){throw Error("Override me!");};
this.getCtrlText=function(){throw Error("Override me!");};this.closingChecker=function(){throw Error("Override me!");};this.getSelectedCtrl=function(){throw Error("Override me!");};this.showMessageTip=function(m){c.text(m);f&&clearTimeout(f);f=setTimeout(function(){c.text("")},5E3)};var G=function(m){m&&r(k.getCtrlText())},B=function(m){if(null==k.getSelectedCtrl())return k.getMessageCurtain().showPrompt(P.get("selectPathTips","\u8bf7\u9009\u62e9\u76ee\u5f55\u3002")),m(!1),!1;var u=k.getCtrlText();
if(!u)return k.getMessageCurtain().showPrompt(P.get("inputImageNameFirst","\u8bf7\u8f93\u5165\u56fe\u7247\u540d\u79f0\u3002")),m(!1),!1;m(k.closingChecker(u))};this.protectedMethod={setTitle:function(m){h=m},setInputPrompt:function(m){e=m}}}function xa(k){sa.call(this);var g=this.protectedMethod,b=this,a,c,r;b.setLabelRequired(!0);g.setInputPrompt(k);g.setTitle(P.get("renameImageName","\u4fee\u6539\u56fe\u7247\u540d\u79f0"));this.setModel=function(h){c=h};this.setFolderNode=function(h){r=h};this.requestFocus=
function(){a.requestFocus()};this.inputCtrlCreator=function(h){a=new ta;a.setText(c.getName());var e=a.getJqUi();q.layoutCtrlWithLRTB(e,110,null,240,b.getInputCtrlTop(),null,null);e.css({"margin-right":"35px",height:"22px"});e.appendTo(h)};this.getCtrlText=function(){return a.getText().trim()};this.getSelectedCtrl=function(){return a.getText()};this.closingChecker=function(h){var e=h+"."+c.getType(),f=new n,l=new E;l.setNameAndType(e);f.setUserObject(l);e=r.isDuplicate(f,function(t){t=t.getUserObject();
return t.getFullName&&t.getFullName()});return 50<h.length?(b.getMessageCurtain().showPrompt(P.get("imageNameToLong","\u56fe\u7247\u540d\u79f0\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002")),!1):e?(c.getName()===h?b.getMessageCurtain().showPrompt(P.get("imageNameNoChange","\u56fe\u7247\u540d\u79f0\u672a\u4fee\u6539\u3002")):b.getMessageCurtain().showPrompt(P.get("imageNameExist","\u56fe\u7247\u540d\u79f0\u5df2\u5b58\u5728\u3002")),!1):-1!=h.indexOf("/")?(b.getMessageCurtain().showPrompt(P.get("imageNameRule",
'\u56fe\u7247\u540d\u79f0\u4e0d\u80fd\u5305\u542b"/"\u3002')),!1):!0}}function ca(k){sa.call(this);var g=this.protectedMethod,b=this,a,c,r,h;g.setInputPrompt(k);g.setTitle(P.get("moveTo","\u79fb\u52a8\u5230"));this.getSelectedModel=function(){a:{var e=a.getSelectedTreePath().getValue();for(var f=0;f<r.length;f++)if(r[f].getId()===e){e=r[f];break a}e=void 0}return e};this.setTargetModels=function(e){var f;h=[];for(f=0;f<e.length;f++)e[f].getParent()||h.push(e[f]);r=e};this.setModel=function(e){c=e};
this.inputCtrlCreator=function(e){a=new ya;a.setPlaceholder(P.get("selectPath","\u8bf7\u9009\u62e9\u76ee\u5f55"));a.setMaxHeight(118);a.setArrFolderNode(h);a.getJqUi().css("background","white");var f=a.getJqUi();f.css("background","white");q.layoutCtrl(f,100,50,215,23);f.appendTo(e)};this.getCtrlText=function(){return a.getSelectedTreePath().getText()};this.getSelectedCtrl=function(){return a.getSelectedTreePath()};this.closingChecker=function(){if(c.getCategoryId()==b.getSelectedModel().getId())return!0;
var e=c.getFullName(),f=new n,l=new E;l.setNameAndType(e);f.setUserObject(l);return b.getSelectedModel().isDuplicate(f,function(t){t=t.getUserObject();return t.getFullName&&t.getFullName()})?(b.getMessageCurtain().showPrompt(P.get("imageNameExist","\u56fe\u7247\u540d\u79f0\u5df2\u5b58\u5728\u3002")),!1):!0}}function qa(){var k=this,g,b,a,c,r,h=!0,e;this.setEnable=function(m){h=m};this.getDropDownContent=function(m){throw Error("orrive me");};this.getPopupHeight=function(){throw Error("orrive me");
};this.showRefreshBtn=function(){return!1};this.getJqUi=function(){g||f();return g};this.setPlaceholder=function(m){f();"placeholder"in b[0]?(b.attr("placeholder",m),b.css("font-size","12px")):(r&&r.remove(),r=$("<div>"),r.text(m),r.css("color","#ccc"),r.css("font-size","12px"),r.on("mousedown",function(u){b.focus()}),r.appendTo(k.getJqUi()),q.layoutCtrlWithLRTB(r,4,4,null,2,2,null),B())};var f=function(){if(!g){g=$("<div>");g.addClass("sa-ctrl-combobox");if(h)g.on("click",t);g.css("border-bottom",
"1px solid #ccc");b=$("<input readonly=readonly>");b.addClass("sa-ctrl-textfield-input");b.css("max-width","200px");b.css("color","#666");b.appendTo(g);a=$("<div>");a.addClass("sa-ctrl-combobox-arrow sa-ctrl-combobox-arrow_enabled");a.appendTo(g);a.on("mouseenter",function(m){l(!0)});a.on("mouseleave",function(m){l(!1)});l(!1)}},l=function(m){var u=c?"arrow-up":"arrow-down";m&&(u+="_hover");ba.background(a,u)},t=function(){if(h){if(c)$(document.body).off("mousedown",G),c.detach(),c=null;else{var m=
$(document.body),u=c=$("<div>"),I=$("<div>");I.addClass("sa-ctrl-common-border");I.appendTo(u);c.addClass("sa-qing-publish-dropdown-selector");e=k.getDropDownContent(!1);e.appendTo(c);var X=k.getPopupHeight();c.css("z-index",999999);c.appendTo(m);var Y=m.prop("clientHeight"),y=g.outerHeight();u=g.outerWidth();var C=[0,y-1];C=q.upwardCoordinate(g[0],C,m[0]);I=C[0];var w=C[1];X=0>X?Math.max(0,(Y>>1)-y):X;w+X>Y&&(C=[0,0],C=q.upwardCoordinate(g[0],C,m[0]),m=C[1]-X+1,0<=m&&(w=m));q.layoutCtrl(c,I,w,u,
X);$(document.body).on("mousedown",G)}l(!1)}},G=function(m){for(var u=$(document.body),I=$(m.target);I[0]!=u[0];){if(I[0]==g[0])return;I=I.parent()}for(I=$(m.target);I[0]!=u[0];){if(I[0]==c[0])return;I=I.parent()}t()},B=function(){r&&setTimeout(function(){r.css("display",b.val()?"none":"")},0)};this.protectedMethod={updateText:function(m){f();b.val(m?m:"");m&&b.attr("title",m);"placeholder"in b[0]||B()},doDropdown:t}}function ya(){qa.call(this);var k=this,g=this.protectedMethod,b,a=[],c;this.getDropDownContent=
function(m){k.initTreeSelector();return b.getJqUi()};this.setSelectedTreePath=function(m){c=m;g.updateText(c?c.getText():"")};this.getSelectedTreePath=function(){return c};this.initTreeSelector=function(){if(a){b=new na;b.setRootVisible(!1);b.setNodePainter(t);var m=b,u=m.setRoot,I=a,X=new z;X=r(X);e(X,I);X.getChild(0).setExpanded(!0);u.call(m,X);b.hookLoadingHandler(l);b.addSelectingListener(G);b.getRoot().setExpanded(!0);b.getRoot().setSelectable(!1);b.setLineHeight(30);q.layoutCtrl(b.getJqUi(),
0,1,"100%",118);b.getJqUi().css("border","1px solid rgba(138, 153, 170, 0.4)");b.getJqUi().css("background","white");b.getJqUi().appendTo($(document.body))}else return null};this.setArrFolderNode=function(m){a=m};this.getArrFolderNode=function(){return a};var r=function(m){var u=new na.BranchNode;u.setUserObject(m);""==m.getId()&&u.setSelectable(!1);return u},h=function(m){var u=new na.LeafNode;u.setUserObject(m);return u},e=function(m,u){if(u&&0<u.length)for(var I=0;I<u.length;I++){var X=u[I];0<
X.getDirChildren().length?f(m,X):m.addChild(h(X.getUserObject()))}},f=function(m,u){if(0<u.getDirChildren().length)var I=r(u.getUserObject());else{if(u.getUserObject().isPreset())return;I=h(u.getUserObject())}m.addChild(I);m=u.getDirChildren();if(0!=m.length)for(u=0;u<m.length;u++)m[u].getChildren()?f(I,m[u]):I.addChild(h(m[u]).getUserObject())},l=function(m,u){setTimeout(function(){e(m);u()},500)},t=function(m,u){m.css("padding-left","4px");m.css("padding-right","4px");m.text(u.getUserObject().getName())},
G=function(m,u){if(u.isSelectable()){u=u.getTreePath();for(var I=m="",X=1;X<u.length;X++)1<X&&(m+="/"),I=u[X],m+=I.getUserObject().getName(),I=I.getUserObject().getId();u=new O;u.setValue(I);u.setText(m);c=u;g.updateText(c?c.getText():"");g.doDropdown()}},B=200;this.setMaxHeight=function(m){B=m};this.getPopupHeight=function(){return null==a||0==a.length?22:Math.min(30*a.length+2,B+2)}}function O(){var k=this,g,b,a,c,r;this.getIsShow=function(){return r};this.setIsShow=function(h){r=h};this.getValue=
function(){return g};this.setValue=function(h){g=h};this.getText=function(){return b};this.setText=function(h){b=h};this.getUserObject=function(){return a};this.setUserObject=function(h){a=h};this.isPreset=function(){return c};this.setIsPreset=function(h){c=h};this.toJsonObject=function(){var h={};h.value=g;h.text=b;return h};this.fromJsonObject=function(h){h&&(h.value&&k.setValue(h.value),h.text&&k.setText(h.text),h.isPreset&&k.setIsPreset(h.isPreset))}}"undefined"==typeof com&&(com={});"undefined"==
typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.imagelib&&(com.kingdee.bos.qing.imagelib={});"undefined"==typeof com.kingdee.bos.qing.imagelib.common&&(com.kingdee.bos.qing.imagelib.common={});"undefined"==typeof com.kingdee.bos.qing.imagelib.common.ui&&(com.kingdee.bos.qing.imagelib.common.ui={});var R=com.kingdee.bos.qing.imagelib.common.ui;
R.AbstractManagePanel=function(){var k=this,g,b,a,c,r,h,e,f,l,t=!1,G=[];this.getJqUi=function(){return g};this.setCategoryAndCardContainer=function(v,F){e=v;f=F;f.setDeleteCategory(e.setDeleteCategory);f.setRefreshSearchPanel(function(){c.getJqUi().is(":visible")&&C()})};var B=function(v){b=new D;var F=b.getJqUi();F.addClass("manage-toolbar");b.createButton(F,!1,function(){h.click()},P.get("import","\u5bfc\u5165"));b.createButton(F,!1,k.exportImage,P.get("export","\u5bfc\u51fa"));"qing"==x.getAppId()&&
b.createButton(F,!1,k.galleryCloud,P.get("gallery","\u4e91\u7d20\u6750"));b.createButton(F,!1,k.refresh,P.get("refresh","\u5237\u65b0"));b.createButton(F,!1,function(){M.closeCurrentTab()},P.get("exit","\u9000\u51fa"));$("<div>").addClass("manage-toolbar-search-bar");F.appendTo(v)},m=function(v){h=$("<input type='file' id='uploadBtn'>");h.addClass("import-image-file");h.on("change",function(F){k.importImage(F);h.val("")});h.appendTo(v)},u=function(v){var F=$("<div>");F.addClass("manage-managed-container");
F.appendTo(v);if(!f||!e)throw Error("Card container or list container is not be set.");var L=e.getJqUi(),H=f.getJqUi();r=new V;r.setHorizontalSplit(!0);r.setEnabled(!0);r.setSplitLineWide(8);r.setResizeMode(V.RESIZE_MODE_FIRST_FIXED);r.setFirstSize(230,200,640);r.setSecondSize($(document).width()-230,0,-1);e.setFunItemClick(f.setModelAndUpdateUi);e.setLoadImages(f.loadModels);e.updateListUi();f.setFunCategoriesProvider(e.provideCategories);f.setFunGetDynamicWidth(I);f.setSelectCategory(e.setSelected);
v=r.getJqUi();r.setFirstChild(V.createChildWrapper(L,function(){L&&L.css({width:r.getNonemptyFirstWide()+"px"})}));r.setSecondChild(V.createChildWrapper(H,function(){f.updateWidth();H&&H.css({width:document.documentElement.clientWidth-r.getNonemptyFirstWide()+"px"})}));var ka=new Z;ka.setCallbackImmediately(function(){r.resize()});ka.setDelay(500);ka.observe();v.children(".sa-ctrl-splitpane-part").css("z-index","auto");v.appendTo(F)},I=function(){var v=document.body.clientWidth,F=0;if(l&&!l.isHidden()){var L=
4;F=l.getWidth()}else L=19;return v-e.getJqUi().width()-F-L},X=function(v){a=new ma;var F=J.getAllType();a.setItemModels(F);a.setSelected(F[0]);a.addSelectedChangedListener(function(H,ka,Q){f.updateUi(Q)});a.setCustomPainter(function(H,ka,Q){H=Q===T.ALL?P.get("allType","\u5168\u90e8\u7c7b\u578b"):Q;ka.text(H)});f.setFunGetCurrentType(a.getSelected);F=a.getJqUi();F.addClass("manage-search-combo-box");F.appendTo(v);c=new da;c.setSearchListenerDelay(1E3);c.addSearchListener(C);c.addCloseListener(function(){l&&
(l.showOrHide(!1),f.updateWidth())});c.setAlwaysShowCleanIcon(!0);c.setShowSearchIcon(!0);c.setPlaceholder(P.get("searchImageName","\u641c\u7d22\u56fe\u7247\u540d\u79f0"));var L=c.getJqUi();L.addClass("manage-search-box");L.find(":input").on("keydown",function(H){13===(H.keyCode||H.which||H.charCode)&&C()});L.hide();L.appendTo(v);F=$("<div>");F.addClass("manage-search-icon");U().background(F,"icon-search");F.appendTo(v);F.on("mouseenter",function(){L.show();c.setFoucs()});b.getJqUi().on("mousedown",
function(H){H=$(H.target);L.find(H)[0]||Y()});e.getJqUi().on("click",Y)},Y=function(){c.getJqUi().hide();l&&(l.emptyList(),l.showOrHide(!1),f.updateWidth())},y=function(){l=new ja;l.init();l.setFunJumpToImage(p);l.setFunWidthChangedCallback(function(){f.updateWidth()});l.getJqUi().appendTo(f.getJqUi())},C=function(){t&&!l?(y(),w()):t||l?t?w():k.getAllModels(function(){w()}):k.getAllModels(function(){y();w()})},w=function(){var v=c.getText();if(v){G=e.getAllChildren();var F=v,L,H=[];F=F&&F.trim();
var ka=a.getSelected();ka=ka?ka:T.ALL;if(F)for(F=F.toUpperCase(),L=0;L<G.length;L++){var Q=G[L],fa=Q.getUserObject();-1<k.getFunGetSearchValue(fa).indexOf(F)&&fa.isSameType(ka)&&H.push(Q)}l.updateUi(H,v);l.showOrHide(!0);e.updateListAndUi()}else l.showOrHide(!1);f.updateWidth()},p=function(v,F){e.setSelected(v);f.setModelAndUpdateUi(v);f.selectTargetCard(F)};this.jumpToImageByImageModel=function(v){f.setTargetId(v.getId());e.setSelectedId(v.getCategoryId())};this.appendToolBarButton=function(v,F,
L,H){b.addButton(v,F,L,H)};this.refresh=function(v){t=!1};this.importImage=function(v){throw Error("Override me!");};this.exportImage=function(){throw Error("Override me!");};this.galleryCloud=function(){throw Error("Override me!");};this.getFunGetSearchValue=function(v){throw Error("Override me!");};this.getAllModels=function(){t=!0};this.protectedMethod={init:function(){g=$("<div>");g.addClass("manage-main");m(g);B(g);u(g);X(b.getJqUi())},getUploadBtn:function(){return h},hasAllChildren:function(){return t},
getCategoryContainer:function(){return e}}};R.ManagedSearchPanel=ja;R.AbstractCard=wa;R.AbstractTextOpDialog=sa;R.AbstractCategoryList=ha;R.AbstractCategoryContainer=function(){var k=this,g,b,a,c,r,h,e,f=!1,l=[],t;this.getJqUi=function(){return g};this.setFunItemClick=function(w){h=w};this.afterCreateList=function(w,p){throw Error("Override me!");};this.updateListUi=function(w){c&&r&&!w?C(function(p){p.updateUi();p.getSelected()&&p.getSelected().equals(p.getCurrent())||!p.getCurrent()?h&&h(p.getCurrent()):
p.setSelected(p.getCurrent());e&&(p=e,e=null,p())}):(b&&b.empty(),m())};this.setRefreshCallBack=function(w){e=w};this.bindImagesIntoCategories=function(w){c&&c.bindChildrenIntoCategories(w);r&&r.bindChildrenIntoCategories(w)};this.getAllModels=function(){var w=c?c.getAllModels().concat():[];return[r?r.getAllModels().concat():[],w]};this.getAllChildren=function(){var w=c?c.getAllModels():[],p=c?c.getAllModels():[];return B(w).concat(B(p))};this.updateListAndUi=function(){r.updateListAndUi();c.updateListAndUi()};
this.setSelectedByFullPath=function(w){a:{var p=w.split(A.SEPERATOR)[0],v=p===A.PERSISTENT_NAMESPACE_SYSTEM;p=p===A.PERSISTENT_NAMESPACE_COMMON||p===A.PERSISTENT_NAMESPACE_GALLERY_COMMON||v?r.getAllModels():c.getAllModels();for(v=0;v<p.length;v++){for(var F=p[v],L=F.getUserObject().getNameSpace()+"/",H=F,ka=H.getUserObject().getName();H.getParent()&&H.getParent().isVisible();)H=H.getParent(),ka=H.getUserObject().getName()+"/"+ka;if(w===L+ka){w=F;break a}}w=p[0]}k.setSelected(w)};this.setSelected=
function(w){var p=w.getUserObject();f=p.isPublic();p.isPublic()||p.isPreset()?r.updateCurrent(w):c.updateCurrent(w);y();k.updateListUi(!1)};this.setSelectedId=function(w){t=w;G()};var G=function(){if(!c||!r||!t)return!1;var w=t;var p=c.getAllModels(),v=r.getAllModels();p=p.concat(v);v=null;for(var F=0;F<p.length;F++){var L=p[F];if(L.getId()===w){v=L;break}}(w=v)&&k.setSelected(w);t=null;return!!w};this.setDeleteCategory=function(w){var p=w.getUserObject();p.isPublic()||p.isPreset()?r.deleteByModel(w):
c.deleteByModel(w);y();k.updateListUi(!1)};var B=function(w){for(var p=[],v=0;v<w.length;v++)for(var F=w[v].getChildren(),L=0;L<F.length;L++){var H=F[L];H instanceof E&&p.push(H)}return p},m=function(){x.createFacade(function(w){var p=0,v=[],F=[],L=[],H=[],ka=[],Q=u(P.get("userUploadFile","\u4e0a\u4f20\u7684\u56fe\u7247"),"",!1,!1);L.push(Q);var fa=u(P.get("userUploadFile","\u4e0a\u4f20\u7684\u56fe\u7247"),"",!0,!1);v.push(fa);var la=u(P.get("downloadGallery","\u6765\u81ea\u4e91\u7d20\u6750"),"",
!1,!0);H.push(la);var Ba=u(P.get("downloadGallery","\u6765\u81ea\u4e91\u7d20\u6750"),"",!0,!0);F.push(Ba);for(p=0;p<w.length;p++){var za=new z,Aa=new N;Aa.fromJsonObject(w[p]);za.setUserObject(Aa);za.fromJsonObject(w[p]);Aa.isPreset()?(ka.push(za),za.setParent(fa)):Aa.isPublic()?Aa.isGallery()?(Ba.addDirChildren(za),za.setParent(Ba)):(fa.addDirChildren(za),za.setParent(fa)):Aa.isGallery()?(la.addDirChildren(za),za.setParent(la)):(Q.addDirChildren(za),za.setParent(Q))}for(p=0;p<ka.length;p++)fa.addDirTo(ka[p],
0);if(0<Ba.getDirChildren().length)for(p=0;p<F.length;p++)v.push(F[p]);if(0<la.getDirChildren().length)for(p=0;p<H.length;p++)L.push(H[p]);var Da=C(function(Ca){return Ca&&Ca.getCurrent()});Da&&Da.setVisited(!1);w=[];p=[];I(w,L);I(p,v);c=new l[0](w);c.setFunItemClick(h);r=new l[1](p);r.setFunItemClick(h);Da&&C(function(Ca){Ca.updateCurrent(Da)});c.getJqUi().appendTo(b);r.getJqUi().appendTo(b);k.afterCreateList(c,r);t&&G()||(y(),k.updateListUi())},function(){return!1}).getAllCategory()},u=function(w,
p,v,F){var L=new z,H=new N;H.setId(p);H.setName(w);H.setPublic(v);H.setGallery(F);L.setUserObject(H);L.setVisible(!1,!0,!1);return L},I=function(w,p){if(null!=p)if(Array.isArray(p))for(var v=0;v<p.length;v++)p[v].getParent()&&p[v].setExpanded(!1),w.push(p[v]),I(w,p[v].getDirChildren());else w.push(p),I(w,p.getDirChildren())},X=function(w,p,v){var F=$("<div>");F.addClass("image-lib-group-tab");F.text(p);F.attr("title",p);F.on("click",Y);F.data("index",v);0===v&&F.addClass("image-lib-group-tab-active");
F.appendTo(w)},Y=function(w){f=$(w.target).data("index")===N.GROUP_TYPE_PUBLIC;y();k.switchTabCallback();k.updateListUi()},y=function(){var w=a.find(".image-lib-group-tab");w.each(function(F){var L=w.eq(F);L.removeClass("image-lib-group-tab-active");(f&&1===F||!f&&0===F)&&L.addClass("image-lib-group-tab-active")});var p=r.getJqUi(),v=c.getJqUi();f?(v.hide(),p.show()):(p.hide(),v.show())};this.switchTabCallback=function(){};var C=function(w){return f?w(r):w(c)};this.protectedMethod={init:function(){g=
$("<div>");g.addClass("image-lib-group-container");a=$("<div>");a.addClass("image-lib-group-tab-container");X(a,P.get("private","\u4e2a\u4eba"),0);X(a,P.get("public","\u516c\u5171"),1);a.appendTo(g);b=$("<div>");b.addClass("image-lib-group-list");b.appendTo(g)},setPublic:function(w){f=w},isPublic:function(){return f},getJqCategoryList:function(){return b},operateCategoryList:C,setCategoryListClass:function(w,p){l=[];l.push(w);p?l.push(p):l.push(w)},getPrivateCategoryList:function(){return c},getPublicCategoryList:function(){return r}}};
R.AbstractCardContainer=function(){var k=this,g,b,a,c,r,h,e,f,l;this.setFunGetCurrentType=function(B){r=B;k.protectedMethod.getCurrentType=B};this.getJqUi=function(){g||(g=$("<div>"),g.addClass("manage-card-container"),a=$("<div>"),a.addClass("manage-card-list"),a.appendTo(g));return g};this.setSearchKey=function(B){h=B?B.toUpperCase():""};this.previewImage=function(B){c||(c=new ra);c.preview(B)};this.setModelAndUpdateUi=function(B){B&&!B.isVisited()?k.loadModels(B,!0):(e=B?B.getChildren():[],k.updateUi(r&&
r()))};this.createNoDataUi=function(B){throw Error("Override me!");};this.updateUi=function(B){a&&a.empty();B=B?B:T.ALL;B=t(B);for(var m=[],u=0;B&&u<B.length;u++){var I=B[u];h?-1<I.getName().toUpperCase().indexOf(h)&&m.push(I):m.push(I)}(B=m)&&0!==B.length||b?B&&0!==B.length?(b&&b.hide(),a.show()):(b&&b.show(),a.hide()):(b=k.createNoDataUi(),b.appendTo(g),a.hide());for(m=0;m<B.length;m++)k.addCard(B[m]);if(e&&!(0>=e.length)&&f){B=f;m=null;for(u=0;u<e.length;u++)if(I=e[u].getUserObject(),I.getId()==
B){m=I;break}(B=m)&&k.selectTargetCard(B);f=null}};var t=function(B){var m=[],u;for(u=0;u<e.length;u++){var I=e[u];I.getUserObject().isSameType(B)&&m.push(I)}return m};this.selectTargetCard=function(B){B&&(0==document.body.clientHeight||0==document.body.clientWidth?(l=new Z,l.setDelay(250),l.setCallbackImmediately(function(){G(B)}),l.observe()):G(B))};var G=function(B){l&&l.unobserve();B=a.find("#"+B.getId());a[0].scrollTop=B[0].offsetTop;k.selectedUIFeedback(B)};this.setTargetId=function(B){f=B};
this.selectedUIFeedback=function(B){throw Error("Override me!");};this.addCard=function(B){throw Error("Override me!");};this.loadModels=function(B,m,u){throw Error("Override me!");};this.protectedMethod={getModelsByType:t,setModels:function(B){B||(B=[]);e=B},getModels:function(){return e},isNameDuplicate:function(B){var m;for(m=0;m<e.length;m++)if(e[m].getName()===B)return!0;return!1},getCardList:function(){return a},getSearchKey:function(){return h}}};R.PreviewPanel=ra;R.ImageCard=function(k,g,
b){wa.call(this);var a=this.protectedMethod,c=this,r,h,e,f,l,t,G,B=!1,m=!1,u=!1,I="";(function(){var Q=b.getUserObject();B=Q.isPreset();if(g)m=!1;else{var fa=x.hasPublicPermission(),la=Q.isPublic();u=Q.isGallery();m=B?!1:la?fa:!0}})();this.setFunDuplicateNameChecker=function(Q){};this.setCategoriesProvider=function(Q){t=Q};this.setFunCardOpCallBack=function(Q){G=Q};this.setFunPreview=function(Q){l=Q};this.setSearchKey=function(Q){I=Q?Q.toUpperCase():"";c.updateUi()};this.init=function(){c.setModel(k);
g&&a.setSize(200,200);a.init();B&&a.setPresetIconBack();var Q=c.getModel(),fa=Q.getName(),la=Q.getFullName(),Ba=Q.getThumbnailUrl(),za=c.getContentWidth()/c.getContentHeight();c.getJqUi().attr("id",Q.getId());if(c.getModel().hasContent()){var Aa=$("<img>");Aa.addClass("image-card-image");Aa.attr("src",Ba);Aa.attr("alt",fa);za<Q.getAspectRatio()?(Aa.css("width",c.getContentWidth()),Q=Q.getHeightAtSameRatio(c.getContentWidth()),Aa.css("top",Math.floor((c.getContentHeight()-Q)/2))):(Aa.css("height",
c.getContentHeight()),Q=Q.getWidthAtSameRatio(c.getContentHeight()),Aa.css("left",Math.floor((c.getContentWidth()-Q)/2)))}else Aa=X();a.addCustomJq2Content(Aa);h=$("<div>");h.addClass("image-card-title");h.text(la);h.attr("title",la);a.addCustomJq2FooterHead(h);la=$("<div>");la.on("click",function(){l(c.getModel())});la.attr("title",P.get("preview","\u9884\u89c8"));U().backgroundWithHover(la,"icon-preview");a.addOpIcon2FooterTail(la);!m||g||u?m&&u&&y():Y()};var X=function(){var Q=$("<div>");Q.addClass("image-lib-choose-no-image");
var fa=$("<div>");fa.addClass("image-lib-choose-no-image-icon");U().background(fa,"icon-no-image");fa.appendTo(Q);fa=$("<div>");fa.addClass("image-lib-choose-no-image-text");var la=P.get("imageCanNotBeFind","\u627e\u4e0d\u5230\u5bf9\u5e94\u7684\u56fe\u7247");fa.attr("title",la);fa.text(la);fa.appendTo(Q);return Q},Y=function(){var Q=$("<div>");U().backgroundWithHover(Q,"icon-more");Q.attr("title",P.get("moreOp","\u66f4\u591a\u64cd\u4f5c"));r=new ua;r.setIconSetter(U().backgroundWithHover);var fa=
new aa;C(fa,P.get("rename","\u91cd\u547d\u540d"),w);C(fa,P.get("moveTo","\u79fb\u52a8\u5230"),v);C(fa,P.get("remove","\u5220\u9664"),L,"icon-small-delete");r.setModel(fa);Q.on("click",function(){r.show(Q.parent(),10,30,null,null)});a.addOpIcon2FooterTail(Q)},y=function(){var Q=$("<div>");U().backgroundWithHover(Q,"icon-small-delete");Q.attr("title",P.get("remove","\u5220\u9664"));Q.on("click",function(){L()});a.addOpIcon2FooterTail(Q)},C=function(Q,fa,la,Ba){la=new ia(la);Ba&&la.setIconName(Ba);la.setText(fa);
Q.addItemModel(la)};this.updateUi=function(){h&&h.empty();var Q=c.getModel(),fa=Q.getFullName(),la=Q.getName();Q=Q.getType();x.highlightKeyWords(h,I,la);la=$("<span>");la.text("."+Q);h.append(la);h.attr("title",fa)};var w=function(){e=new xa(P.get("imageName","\u56fe\u7247\u540d\u79f0"));e.setFunClosingCallBack(p);e.init();e.setFolderNode(b);e.setModel(c.getModel());e.showDialog();e.requestFocus()},p=function(Q){var fa=c.getModel();x.createFacade(function(la){!0===la&&(a.rename(Q),c.updateUi(),x.getMessageCurtain().showSuccess(P.get("renameImageName",
"\u4fee\u6539\u56fe\u7247\u540d\u79f0")+P.get("success","\u6210\u529f")+P.get("fullPoint","\u3002")))},function(la,Ba){return 1100042===la?(x.getMessageCurtain().showPrompt(P.get("imageNameExist","\u56fe\u7247\u540d\u79f0\u5df2\u5b58\u5728\u3002")),!0):1100041===la?(x.getMessageCurtain().showPrompt(P.get("imageNotExist","\u56fe\u7247\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002")),!0):!1}).renameImage(fa.toJsonObject(),Q+"."+fa.getType());return!0},v=function(){var Q=t();Q&&0!==Q.length?
(f=new ca(P.get("category","\u76ee\u5f55")),f.setModel(c.getModel()),f.setTargetModels(Q),f.setFunClosingCallBack(F),f.init(),f.showDialog()):x.getMessageCurtain().showPrompt(P.get("noCategoriesToMove","\u6ca1\u6709\u53ef\u4f9b\u79fb\u52a8\u7684\u5206\u7ec4\u3002"))},F=function(){var Q=c.getModel(),fa=f.getSelectedModel(),la=fa.getUserObject();if(Q.getCategoryId()==la.getId())return!0;var Ba=new n;Ba.setUserObject(Q);Ba.setParent(fa);fa.addTo(Ba,1);b.setVisited(!1);x.createFacade(function(za){!0===
za&&(Q.setCategoryId(la.getId()),c.updateUi(),x.getMessageCurtain().showSuccess(P.get("move","\u79fb\u52a8")+P.get("success","\u6210\u529f")+P.get("fullPoint","\u3002")));G(b,!0)},function(za,Aa){fa.deleteFrom(1);return 1100042===za?(x.getMessageCurtain().showPrompt(P.get("imageNameExist","\u56fe\u7247\u540d\u79f0\u5df2\u5b58\u5728\u3002")),!0):1100041===za?(x.getMessageCurtain().showPrompt(P.get("imageNotExist","\u56fe\u7247\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002")),!0):!1}).moveImage(Q.toJsonObject(),
la.getId());return!0},L=function(Q){x.createFacade(function(fa){H(fa)},function(){return!1}).getRefTimeOfImage(c.getModel().getFileName())},H=function(Q){Q=0<Q?P.get("confirmDeleteImageHasRef","\u8be5\u56fe\u7247\u88ab\u5f15\u7528\u4e86#1\u6b21\uff0c\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f").replace("#1",Q):P.get("confirmDeleteImage","\u786e\u5b9a\u8981\u5220\u9664\u8be5\u56fe\u7247\u5417\uff1f");var fa=K.createFeedbackDialog();fa.setOptionType(K.OPTION_OK_CANCEL);fa.setMsgImageType(K.MSG_DELETE);
fa.setMessage(Q);fa.setClosingChecker(function(la){la===K.RETURN_OK&&ka(c.getModel());return!0});fa.showDialog()},ka=function(){x.createFacade(function(){x.getMessageCurtain().showSuccess(P.get("deleteImageSuccess","\u5220\u9664\u56fe\u7247\u6210\u529f\u3002"));G(b,!0)},function(Q,fa){return 1100041===Q?(x.getMessageCurtain().showPrompt(P.get("imageNotExist","\u56fe\u7247\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002")),!0):!1}).deleteImage(c.getModel().toJsonObject())}};var S,q,d,D,aa,ia,
K,da,V,ea,ta,ma,va,ba,pa,ua,na,P,Z,M,W,J,T,N,z,n,E,A,x;(function(){var k=com.kingdee.bos.qing.common;q=k.DomUtil;k=com.kingdee.bos.qing.ui.component;d=k.AbstractModalDialog;ea=k.Label;aa=k.MenuModel;ia=k.MenuItemModel;K=k.MessageDialog;da=k.SearchBox;D=k.Toolbar;V=k.SplitPane;ta=k.TextField;ma=k.ComboBox;va=k.Button;ba=k.Icons;pa=k.List;ua=k.Menu;na=k.Tree;k=com.kingdee.bos.qing.framework.common;Z=k.WindowResizeObserver;M=k.TabbedUiUtil;W=k.MultilanguageManager;k=com.kingdee.bos.qing.imagelib.model;
J=k.ImageLibModelUtil;T=k.ImageType;z=k.FolderNode;N=k.ImageCategory;n=k.LeafNode;E=k.Image;A=k.PathModel;k=com.kingdee.bos.qing.imagelib.common;P=W.createPackageAccessor(k);x=k.ImageLibUtil})()})();(function(){function U(){ia||(ia=com.kingdee.bos.qing.imagelib.MyIcons);return ia}function ha(M,W){ya.call(this);var J=this,T=J.protectedMethod,N,z,n,E,A,x,k,g,b=!1,a=!1;this.selectImage=function(m,u){if(u)try{var I=JSON.parse(u),X=I.nameSpace;var Y=X===ma.PERSISTENT_NAMESPACE_SYSTEM?d.get("preset","\u9884\u7f6e")+"/":X===ma.PERSISTENT_NAMESPACE_COMMON?d.get("public","\u516c\u5171")+"/"+d.get("userUploadFile","\u4e0a\u4f20\u7684\u56fe\u7247")+"/":X===ma.PERSISTENT_NAMESPACE_GALLERY_USER?d.get("private",
"\u4e2a\u4eba")+"/"+d.get("downloadGallery","\u6765\u81ea\u4e91\u7d20\u6750")+"/":X===ma.PERSISTENT_NAMESPACE_GALLERY_COMMON?d.get("public","\u516c\u5171")+"/"+d.get("downloadGallery","\u6765\u81ea\u4e91\u7d20\u6750")+"/":d.get("private","\u4e2a\u4eba")+"/"+d.get("userUploadFile","\u4e0a\u4f20\u7684\u56fe\u7247")+"/";Y+=I.groupName+"/"+I.name}catch(y){Y=void 0,console.error("JSON.parse() error:"+y)}void 0===M?(m(),Y&&T.getMessageCurtain().showPrompt(d.get("imageNotExistWithPath","\u56fe\u7247\u201c#1\u201d\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002").replace("#1",
Y))):M?P.createFacade(function(y){if(y){var C=new K;C.fromJsonObject(y);g=C}else Y?T.getMessageCurtain().showPrompt(d.get("imageNotExistWithPath","\u56fe\u7247\u201c#1\u201d\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002").replace("#1",Y)):T.getMessageCurtain().showPrompt(d.get("imageNotExist","\u56fe\u7247\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002"));m()},function(){return!1}).getImageModelByImageFileName(M):(m(),Y&&T.getMessageCurtain().showPrompt(d.get("imageNotExistWithPath",
"\u56fe\u7247\u201c#1\u201d\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002").replace("#1",Y)))};this.setHasOnlyClose=function(m){a=m};this.setSelectedImage=function(m){g=m};this.show=function(){N||h();J.showDialog()};this.setFunSelected=function(m){x=m};this.setFunClosedCallback=function(m){k=m};var c=function(m){P.createFacade(function(u){var I,X=[];for(I=0;I<u.length;I++){var Y=u[I],y=new ea,C=new K;C.fromJsonObject(Y);y.setUserObject(C);X.push(y)}A.bindImagesIntoCategories(X);m&&m();b=!0},
function(u,I){return!1}).getAllImage()},r=function(){var m=z.getText().trim();b?A.searchKey(m):c(function(){A.searchKey(m)})},h=function(){P.setAppId("qing");P.setMessageCurtain(T.getMessageCurtain());T.setTitle(a?d.get("imageManagement","\u56fe\u7247\u7ba1\u7406"):d.get("chooseImage","\u9009\u62e9\u56fe\u7247"));J.setSize(902,606);T.setFooterClosingOnly(a);T.setContentPaneCreator(f);T.setClosingChecker2(function(m){var u=E.getSelected();u?(u=u.getUserObject().getFileName(),P.createFacade(function(I){I||
T.getMessageCurtain().showPrompt(d.get("imageNotExistReSelect","\u56fe\u7247\u4e0d\u5b58\u5728\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u56fe\u7247\u3002"));m(I)},function(I,X){T.getMessageCurtain().showPrompt(d.get("imageNotExistReSelect","\u56fe\u7247\u4e0d\u5b58\u5728\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u56fe\u7247\u3002"));m(!1);return!0}).checkImageExist(u)):m(!1)},function(m){m(!0)},!0);T.setClosingAction(e)},e=function(m){if(m){var u=E.getSelected();m=u.getUserObject();u=u.getParent();var I=u.getUserObject().isPublic()?
ma.PERSISTENT_NAMESPACE_COMMON:ma.PERSISTENT_NAMESPACE_USER;I=u.getUserObject().isPreset()?ma.PERSISTENT_NAMESPACE_SYSTEM:I;u=I+ma.SEPERATOR+u.getName()+ma.SEPERATOR+m.getFullName();x&&x(m,u)}else k&&k()},f=function(){N=$("<div>");N.addClass("image-lib-choose-container");ca.layoutCtrlWithLRTB(N,0,0,null,0,null,null);var m=$("<div>");m.addClass("image-lib-choose-content");m.css("border","1px solid #f1f1f1");ca.layoutCtrlWithLRTB(m,0,0,null,40,0,null);B(m);var u=$("<div>");u.addClass("image-lib-choose-header");
u.appendTo(N);l(u);z=new O;z.setShowSearchIcon(!0);z.addSearchListener(r);z.setSearchListenerDelay(500);z.setPlaceholder(d.get("searchImageName","\u641c\u7d22\u56fe\u7247\u540d\u79f0"));var I=z.getJqUi();I.addClass("image-lib-choose-search-box");I.appendTo(u);t(u);A.setFunItemClick(E.setModelAndUpdateUi);A.updateListUi();m.appendTo(N);return N},l=function(m){n=new R;var u=V.getAllType();n.setItemModels(u);n.setSelected(u[0]);n.addSelectedChangedListener(function(I,X,Y){A.searchKey(z.getText())});
n.setCustomPainter(function(I,X,Y){I=Y===da.ALL?d.get("allType","\u5168\u90e8\u7c7b\u578b"):Y;X.text(I)});E.setFunGetCurrentType(n.getSelected);A.setFunGetCurrentType(n.getSelected);u=n.getJqUi();u.addClass("image-lib-choose-combo-box");u.appendTo(m)},t=function(m){var u=$("<div>");u.on("click",function(X){A.updateListUi(!0);r()});u.addClass("image-lib-choose-btn-image-library");var I=$("<div>");I.addClass("image-lib-choose-btn-image-library-icon");I.css("margin-top","5px");U().background(I,"refresh");
I.appendTo(u);I=$("<div>");I.addClass("image-lib-choose-btn-image-library-text");I.text(d.get("refresh","\u5237\u65b0"));I.appendTo(u);u.appendTo(m);u=$("<div>");u.on("click",function(X){X=d.get("imageLibrary","\u56fe\u7247\u5e93");var Y=qa.decodeParamFromUrl(location.search,"pageId");Y&&0<=Y.indexOf("qing_workbench")?D.openNewTabInAppId(X,G(),"1535516017197902848",D.QING_ANALYSIS):D.openNewTab(X,G(),"1535516017197902848")});u.addClass("image-lib-choose-btn-image-library");I=$("<div>");I.addClass("image-lib-choose-btn-image-library-icon");
U().background(I,"icon-image-library");I.appendTo(u);I=$("<div>");I.addClass("image-lib-choose-btn-image-library-text");I.text(d.get("imageLibrary","\u56fe\u7247\u5e93"));I.appendTo(u);u.appendTo(m)},G=function(){var m=qa.decodeParamFromUrl(location.search,"path");return(m?m:"/ierp")+"/qing/imageLibEntrance.do"},B=function(m){var u=new S;u.setHorizontalSplit(!0);u.setEnabled(!0);u.setSplitLineWide(1);u.setResizeMode(S.RESIZE_MODE_FIRST_FIXED);u.setFirstSize(200,200,640);u.setSecondSize(702,0,-1);
A=new ja;A.init();g&&A.setSelectedCategoryId(g.getCategoryId());var I=A.getJqUi();E=new ra;!1===W&&E.setSupportGif(W);a&&E.setSelectedCardBlank(a);g&&E.setSelectedImage(g);var X=E.getJqUi();A.setFunSetKeyToCardContainer(E.setSearchKey);var Y=u.getJqUi();u.getJqSplitLine().css("background-color","#e3e3e3");u.setFirstChild(S.createChildWrapper(I,function(){I&&I.css({width:u.getNonemptyFirstWide()+"px"})}));u.setSecondChild(S.createChildWrapper(X,function(){X&&X.css({width:902-u.getNonemptyFirstWide()+
"px"})}));Y.appendTo(m)}}function ja(){pa.call(this);var M=this,W=M.protectedMethod,J,T,N;this.setSelectedCategoryId=function(z){N=z};this.setFunGetCurrentType=function(z){J=z};this.setFunSetKeyToCardContainer=function(z){T=z};this.init=function(){W.setCategoryListClass(oa);W.init();W.getJqCategoryList().css("top","45px");M.getJqUi().find(".image-lib-group-tab-container").css("background-color","#ffffff")};this.afterCreateList=function(z,n){z.setFunGetCurrentType(J);n.setFunGetCurrentType(J);if(N){var E=
z.getAllModels(),A=n.getAllModels();E=E.concat(A);for(A=0;A<E.length;A++){var x=E[A];if(x.getId()===N){var k=x;break}}k&&k.getUserObject().isPublic()?(W.setPublic(!0),n.updateCurrent(k)):!k&&E[1]?z.updateCurrent(E[1]):z.updateCurrent(k)}};this.searchKey=function(z){W.getPrivateCategoryList().setKeyWord(z);W.getPublicCategoryList().setKeyWord(z);T(z);W.operateCategoryList(function(n){n.updateUi();n.itemClick(n.getCurrent())})}}function oa(M){ba.call(this,M);var W=this,J;this.setFunGetCurrentType=function(n){};
this.setFunItemClick=function(n){J=n};this.itemClick=function(n){var E,A=W.getJqUi().find(".img-lib-mange-lists-dir"),x=n.getUserObject().isPreset(),k=W.getList().getJqUi().find(".img-lib-mange-lists-dir-preset_selected");k&&k.removeClass("img-lib-mange-lists-dir-preset_selected");A.each(function(g){g=$(A[g]);var b=g.data("oNode");if(b&&b.equals(n)&&n.getParent()){for(b=b.getParent();b&&!b.isExpanded();)T(b),b=b.getParent();E=g}});x&&(x=E.find(".img-lib-mange-lists-dir-preset"))&&x.addClass("img-lib-mange-lists-dir-preset_selected");
E&&E.addClass("sa-ctrl-list-item_selected_enabled");W.updateCurrent(n);J&&J(n)};this.setKeyWord=function(n){n&&n.toUpperCase()};this.getNoDataPrompt=function(){return d.get("noImage","\u6682\u65e0\u56fe\u7247")};this.listItemPainter=function(n,E){n.addClass("img-lib-mange-lists-dir");n.data("oNode",E);var A=$("<div>"),x=E.getUserObject(),k=x.getName();A.text(k);A.addClass("img-lib-mange-lists-dir-text");A.css("margin-left",14*E.getSubNodeLevel()+"px");A.css("margin-right","23px");n.attr("title",k);
n.addClass("image-lib-manage-list-item-across");var g=$("<div>");g.addClass("select-tree-menu-icon-click");g.css("margin-left",14*E.getSubNodeLevel()+"px");g.data("oItemModel",E);var b=$("<div>");b.addClass("select-tree-menu-icon");b.css("cursor","pointer");g.append(b);E.isHide()?n.hide():E.getParent()?(n.show(),g.on("mousedown",function(c){c.stopPropagation();c=$(c.currentTarget).data("oItemModel");T(c)})):n.show();var a=E.isExpanded();(k=E.getDirChildren())&&0<k.length&&E.getParent()&&(z(a,b),n.append(g));
n.append(A);g=$("<div>");x.isPreset()?(g=$("<div>"),g.text(d.get("preset","\u9884\u7f6e")),g.addClass("img-lib-mange-lists-dir-preset"),g.css("margin-left",14*E.getSubNodeLevel()+24+"px"),"preset"==g.text()?A.css("margin-left",14*E.getSubNodeLevel()+45+"px"):A.css("margin-left",14*E.getSubNodeLevel()+33+"px"),n.append(g)):x.isGallery()&&0<k.length&&(n.removeClass("sa-ctrl-list-item"),n.removeClass("image-lib-manage-list-item-across"));E.equals(W.getCurrent())&&E.getParent()?(n.addClass("sa-ctrl-list-item_selected_enabled"),
g&&g.addClass("img-lib-mange-lists-dir-preset_selected")):(n.on("mouseenter",function(c){W.getCurrent()}),n.on("mouseleave",function(c){W.getCurrent()}))};var T=function(n){if(n){if(n.getDirChildren()&&0<n.getDirChildren().length){var E=n.isExpanded();n.setExpanded(!E)}else n.setExpanded(!0);N(n);W.refreshList(W.getModels())}},N=function(n){if(n=n instanceof ta&&n.getDirChildren())for(var E=0;E<n.length;E++)n[E].getParent().isExpanded(),N(n[E])},z=function(n,E){n?(E.addClass("lower-triangle"),E.removeClass("select-tree-menu-icon"),
E.css({top:"7px",left:"4px"})):(E.addClass("right-triangle"),E.removeClass("lower-triangle"),E.css({top:"3px",left:"7px"}))};this.refreshList=function(n){var E=n[0].getUserObject().isGallery()?W.getJqUi().find(".img-lib-mange-lists-dir-gallery"):W.getJqUi().find(".img-lib-mange-lists-dir-imglist");E=E.find(".sa-ctrl-list-owner");E.empty();for(var A=$(document.createDocumentFragment()),x=W.listItemPainter,k=0;k<n.length;k++){var g=$("<div>"),b=n[k];g.addClass("sa-ctrl-list-item");g.addClass("sa-ctrl-list-item_enabled");
g.addClass("sa-ctrl-list-item-defaultlayout");b.equals(W.getCurrent())&&g.addClass("sa-ctrl-list-item_selected_enabled");g.data("model",b);x(g,b);A.append(g)}E.append(A)}}function ra(){ua.call(this);var M=this,W=M.protectedMethod,J,T,N=!0,z=!1;this.setSelectedImage=function(A){T=A};this.setSupportGif=function(A){N=A};this.setSelectedCardBlank=function(A){z=A};var n=M.setSearchKey;this.setSearchKey=function(A){n(A);E()};var E=function(){var A=W.getSearchKey()?d.get("noSearchData","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c"):
d.get("noImage","\u6682\u65e0\u56fe\u7247");J&&J.text(A)};this.getSelected=function(){var A=W.getCardList().find(".image-lib-image-card-selected"),x=A.data("oModel");if(0===A.length)return P.getMessageCurtain().showPrompt(d.get("noImageSelected","\u672a\u9009\u4e2d\u4efb\u4f55\u56fe\u7247\u3002")),null;A=x.getUserObject();return N||A.getType()!==da.GIF?x:(P.getMessageCurtain().showPrompt(d.get("thumbnailNotSupportGif","\u7f29\u7565\u56fe\u4e0d\u652f\u6301 gif \u56fe\u7247\u683c\u5f0f\u3002")),null)};
this.createNoDataUi=function(){var A=$("<div>");A.css({position:"absolute",top:"26px",left:"0",right:"0",bottom:"0","z-index":"2",color:"rgb(102, 102, 102)"});J=$("<div>");E();ca.layoutCtrlCenterAlign(J,500);J.css({height:"20px","line-height":"20px","text-align":"center","font-size":"16px",color:"#BBBBBB",top:"50%","margin-top":"98.5px"});J.appendTo(A);var x=$("<div>");U().background(x,"no-data");ca.layoutCtrlCenterAlign(x,187);x.css({"background-size":"contain",top:"50%",height:"187px","margin-top":"-113.5px"});
x.appendTo(A);return A};this.selectedUIFeedback=function(A){A.addClass("image-lib-image-card-selected");z&&(A.addClass("image-lib-choose-card-blink"),setTimeout(function(){A.removeClass("image-lib-choose-card-blink")},2E3))};this.loadModels=function(A,x,k){var g=A.getUserObject();P.createFacade(function(b){for(var a=[],c=0;c<b.length;c++){var r=new ea,h=new K;h.fromJsonObject(b[c]);r.setUserObject(h);r.setParent(A);a.push(r)}A.setChildren(a);A.setVisited(!0);x&&(W.setModels(a),x&&M.updateUi(W.getCurrentType()));
k&&k();T&&g.getId()===T.getCategoryId()&&(M.selectTargetCard(T),T=null)},function(){return!1}).getAllImageOfCategory(g.getId(),g.isPreset())};this.addCard=function(A){var x=A.getUserObject(),k=W.getCardList();x=new na(x,!0,A.getParent());x.setFunPreview(M.previewImage);x.init();x.setSearchKey(W.getSearchKey());var g=x.getJqUi();g.on("click",function(b){b.stopPropagation();k.find(".image-lib-image-card-selected").removeClass("image-lib-image-card-selected");g.addClass("image-lib-image-card-selected")});
g.data("oModel",A);g.appendTo(k)}}function wa(){var M,W,J,T,N=new va,z,n,E,A=!1,x;this.setImageFileName=function(e){N.setImageFileName(e)};this.init=function(e){n=!!e;e&&(E=0==e.indexOf("./"));z=e?e:N.getImagePathFromUrl();M=$("<div class='sa-publish-thumbnailcut'>");M.on("mouseenter",g);M.on("mouseleave",b);M.css("cursor","pointer");T=$("<img class='image-lib-choose-dashboard-publish-thumbnail-img'>");k(z,function(f){f?(T.attr("src",z),T&&T.show(),M.find(".image-lib-choose-thumbnail-error").remove()):
(T&&T.hide(),N.getImageFullPathModel()?h(N.getImageFullPathModel().getImageFullPath()):h())});T.appendTo(M);return M};this.setFunCurrentFileNameGetter=function(e){};var k=function(e,f){if(e){var l=document.createElement("img");l.crossOrigin="anonymous";l.setAttribute("crossOrigin","Anonymous");l.onerror=function(){f(!1)};l.onload=function(){0<l.fileSize||0<l.width||0<l.height?f(!0):f(!1)};l.src=e}else f(!1)},g=function(e){b();e=$(e.currentTarget);J=$("<div>");J.addClass("image-lib-choose-hover-btns");
var f=a(d.get("choosePicture","\u9009\u62e9\u56fe\u7247"),r,"icon-round-edit");J.append(f);if(n&&!E){var l=a(d.get("deletePicture","\u5220\u9664\u56fe\u7247"),c,"icon-round-delete");J.append(l);f.css("left","0");l.css("left","80px")}else f.css("left","40px");J.appendTo(e);T.css("opacity","0.5");f=e.width();W=$("<div>");W.addClass("image-lib-choose-edit-detail");l=$("<div>");l.addClass("image-lib-choose-edit-detail-tip");l.text(d.get("uploadImageTips","\u5efa\u8bae\u9009\u62e9\u957f\u5bbd\u6bd42 : 1\u7684\u56fe\u7247"));
l.appendTo(W);W.css("width",f-8+"px");W.appendTo(e)},b=function(e){T.css("opacity","1");W&&W.remove();W=null;J&&J.remove();J=null},a=function(e,f,l){var t=$("<div>");t.on("click",f);t.attr("title",e);t.addClass("image-lib-choose-hover-btn");U().backgroundWithHover(t,l);return t},c=function(){var e=q.createFeedbackDialog();e.setOptionType(q.OPTION_OK_CANCEL);e.setMsgImageType(q.MSG_DELETE);e.setMessage(d.get("deleteThumbnailConfirm","\u5220\u9664\u7f29\u7565\u56fe\u540e\u5c06\u6062\u590d\u4f7f\u7528\u7cfb\u7edf\u9884\u7f6e\u7f29\u7565\u56fe\uff0c\u786e\u5b9a\u8981\u5220\u9664\u8be5\u7f29\u7565\u56fe\u5417\uff1f"));
e.setClosingChecker(function(f){f===q.RETURN_OK&&(T.attr("src",com.kingdee.bos.qing.CodeLoader.getIconUrl("lightapp/common","icon_dashboard_building.png")),T&&T.show(),M.find(".image-lib-choose-thumbnail-error").remove(),N.setImageFileName(),N.setQingFileType(),N.setImageType(),N.setImageFullPathModel(),A=!0,n=!1,x&&x());return!0});e.showDialog()},r=function(){var e=new ha(N.getImageFileName(),!1);e.setFunClosedCallback(function(){});e.setFunSelected(function(f,l){var t=f.getType(),G=f.getFileName(),
B=f.getImageUrl();k(f.getImageUrl(),function(m){m?(T.attr("src",B),T&&T.show(),M.find(".image-lib-choose-thumbnail-error").remove(),x&&x()):(T&&T.hide(),h(l));N.setImageFileName(G);N.setQingFileType(K.FILE_TYPE);N.setImageType(t);N.setImageFullPathModel();n=A=!0;E=!1})});e.selectImage(function(){e.show()})};this.setDsbThumbnailDeleteCallBack=function(e){};this.setRemoveImgNotExistIconCallBack=function(e){x=e};this.getThumbnailUrlModel=function(){return N};this.isImageChange=function(){return A};this.getDashboardThumbnailUrl=
function(){return N?N.getJsonImagePath():null};var h=function(e){M.find(".image-lib-choose-thumbnail-error").remove();var f=$("<div>");f.addClass("image-lib-choose-thumbnail-error");var l=$("<div>");l.text(d.get("imageCanNotBeFind","\u627e\u4e0d\u5230\u5bf9\u5e94\u7684\u56fe\u7247"));var t=$("<div>");t.css("fontSize","12px");if(e){var G=e.split(ma.SEPERATOR);e=G[0];G=(e===ma.PERSISTENT_NAMESPACE_USER?d.get("private","\u4e2a\u4eba"):d.get("public","\u516c\u5171"))+ma.SEPERATOR+G[1]+ma.SEPERATOR+G[2];
e=e===ma.PERSISTENT_NAMESPACE_SYSTEM;t.text(G);t.attr("title",G);e&&(e=$("<span>"),e.addClass("image-lib-choose-preset-icon"),e.text(d.get("preset","\u9884\u7f6e")),e.prependTo(t))}l.appendTo(f);t.appendTo(f);f.appendTo(M)}}function sa(){this.changeToBase64=function(M,W,J,T,N){var z,n=document.createElement("img");n.crossOrigin="anonymous";n.setAttribute("crossOrigin","Anonymous");n.src=M;var E=document.createElement("canvas"),A,x;n.onload=function(){A=n.width;x=n.height;T&&(A=T);N&&(x=N);var k=1;
window.devicePixelRatio&&0<window.devicePixelRatio&&(k=window.devicePixelRatio);var g=A*k;k*=x;Z.createContext2d(E,g,k).drawImage(n,0,0,n.width,n.height,0,0,g,k);W="png";z=E.toDataURL("image/"+W);J(z)}};this.compareBsae64Image=function(M,W,J){var T=-1<M.indexOf("data:image"),N=-1<W.indexOf("data:image");if(M===W)J(!0);else if(T&&N)J(!1);else{var z=0,n=function(){0>=z&&(M===W?J(!0):J(!1))};T||(z++,T=M.lastIndexOf("."),T=M.substring(T+1),this.changeToBase64(M,T,function(E){M=E;z--;n()}));N||(z++,T=
W.lastIndexOf("."),T=W.substring(T+1),this.changeToBase64(W,T,function(E){W=E;z--;n()}))}}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.imagelib&&(com.kingdee.bos.qing.imagelib={});"undefined"==typeof com.kingdee.bos.qing.imagelib.choose&&(com.kingdee.bos.qing.imagelib.choose={});"undefined"==typeof com.kingdee.bos.qing.imagelib.choose.ui&&
(com.kingdee.bos.qing.imagelib.choose.ui={});var xa=com.kingdee.bos.qing.imagelib.choose.ui;xa.ChooseImagePanel=ha;xa.ChooseThumbnailPane=wa;xa.ChooseThumbnailDialog=function(M,W,J){ya.call(this);var T=this.protectedMethod,N=this,z=new wa,n=M,E=W,A=new sa;this.show=function(){N.setSize(440,340);T.setTitle(d.get("setThumbnail","\u8bbe\u7f6e\u7f29\u7565\u56fe"));T.setSelectable(!0);T.setContentPaneCreator(k);T.setClosingAction(function(g){if(g){var b=z.getThumbnailUrlModel(),a=z.isImageChange();if(a)if(b.getImageFileName()){E=
b.getJsonImagePath();g=b.getImageFileName();var c=b.getQingFileType();b=b.getImageType();n=com.kingdee.bos.qing.framework.common.RemoteFramework.getLoadImgUrl(g,c);n=n+"&contentType=image/"+b;A.changeToBase64(n,b,function(r){J(r,E,a)},800,400)}else J("","",a);else J(M,W,a)}});T.setClosingChecker(function(g){x()?(T.getMessageCurtain().showPrompt(d.get("reSetThumbnailBecauseOfDeleted","\u8be5\u56fe\u7247\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u7f29\u7565\u56fe\u3002")),g(!1)):g(!0)},
!0);N.showDialog()};var x=function(){var g=z.getDashboardThumbnailUrl(),b=new va;b.getImagePathFromJson(g);g=b.getImageFileName();b=b.getImageFullPathModel();return!g&&b?!0:!1},k=function(){var g=function(){var h=CommonIconUtil.createWarning();h.addClass("dm-entity-list-item-notexist");h.attr("title",d.get("reSetThumbnailBecauseOfDeleted","\u8be5\u56fe\u7247\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u7f29\u7565\u56fe"));ca.layoutCtrl(h,25,45);h.appendTo(b)},b=$("<div>"),a=z.getThumbnailUrlModel();
a.getImagePathFromJson(E);n=a.getImagePathFromUrl(n);z.setDsbThumbnailDeleteCallBack(function(h,e,f){a.getImageFileName()===h&&g();var l=new va;l.getImagePathFromJson(E);l.getImageFileName()===h&&(h=new ma,h.setNameSpace("$user$"),h.setCategoryName(e),h.setName(f),l.setImageFullPathModel(h),l.setImageFileName(""),E=l.getJsonImagePath(),J(null,E,!1))});z.setRemoveImgNotExistIconCallBack(function(){b.find(".dm-entity-list-item-notexist").remove()});if(x()){var c=z.init(E);g()}else c=z.init(n);ca.layoutCtrl(c,
45,45,318,160);var r=$("<span>");r.addClass("set-dashboard-image-dialog");r.text(d.get("setThumbnailTipsForYourDsb","\u8bf7\u4e3a\u60a8\u7684\u4eea\u8868\u677f\u8bbe\u7f6e\u7f29\u7565\u56fe\uff08\u5982\u672a\u8bbe\u7f6e\uff0c\u5219\u4f7f\u7528\u7cfb\u7edf\u9884\u7f6e\u7f29\u7565\u56fe\uff09\uff1a"));c.appendTo(b);r.appendTo(b);return b}};xa.ImageBase64Tool=sa;var ca,qa,ya,O,R,S,q,d,D,aa,ia,K,da,V,ea,ta,ma,va,ba,pa,ua,na,P,Z;(function(){var M=com.kingdee.bos.qing.common;ca=M.DomUtil;qa=M.Util;Z=M.CanvasUtil;
M=com.kingdee.bos.qing.ui.component;ya=M.AbstractModalDialog;O=M.SearchBox;R=M.ComboBox;S=M.SplitPane;q=M.MessageDialog;M=com.kingdee.bos.qing.framework.common;d=M.MultilanguageManager.createPackageAccessor(xa);D=M.TabbedUiUtil;aa=M.MultilanguageManager;M=com.kingdee.bos.qing.imagelib.model;K=M.Image;ta=M.FolderNode;da=M.ImageType;ea=M.LeafNode;ma=M.PathModel;va=M.ThumbnailUrlModel;V=M.ImageLibModelUtil;M=com.kingdee.bos.qing.imagelib.common.ui;ba=M.AbstractCategoryList;pa=M.AbstractCategoryContainer;
ua=M.AbstractCardContainer;na=M.ImageCard;M=com.kingdee.bos.qing.imagelib.common;d=aa.createPackageAccessor(M);P=M.ImageLibUtil})()})();(function(){function U(){aa||(aa=com.kingdee.bos.qing.imagelib.MyIcons);return aa}function ha(ba){function pa(){KTDefaultCellRender.call(this,P);var b=this;this.paintCellUI=function(a,c){var r=b.getCurrentRow().getUserObject(),h=r.getUserObject(),e=r.getId(),f=new S,l=f.getJqUi(),t=$("<div>"),G=$(a);a=$("<div>");var B=r.isGrey();a.addClass("image-lib-im-export-item");sa.layoutCtrlWithLRTB(l,7,null,20,null,null,20);l.css("line-height","23px");l.appendTo(a);f.setEnabled(!B);f.setChecked(r.isChecked());
f.setUserObject(r);f.addCheckedListener(g);h.isPreset&&h.isPreset()?(f=a.append,l=$("<span>"),l.addClass("image-lib-im-export-item-text-preset"),l.text(d.get("preset","\u9884\u7f6e")),f.call(a,l),t.css("margin-left","10px")):t.css("margin-left","30px");r=h instanceof K?h.getFullName():r.getName();t.addClass("image-lib-im-export-item-text");if(J&&r){h=J.toUpperCase();f=r.toUpperCase();l=f.split(h);var m=h.length;for(y in l){var u=f.indexOf(l[y]),I=r.substr(Y,l[y].length);u+=l[y].length;var X=f.length-
u;f=f.substr(u,X);r=r.substr(u,X);u=$("<span>");u.text(I);u.appendTo(t);if(y!=l.length-1&&1<l.length){var Y=f.indexOf(h);I=r.substr(Y,m);u=Y+m;X=f.length-u;f=f.substr(u,X);r=r.substr(u,X);u=$("<span>");u.text(I);u.css("color","red");u.clone().appendTo(t)}}}else t.text(r);B&&t.css("color","#b2b2b2");a.append(t);if("public_id"===e&&!va.hasPublicPermission()&&A){e=a.append;t=$("<div>");t.css("color","#f9c43a");sa.layoutCtrlWithLRTB(t,60,0,null,0,null,20);var y=$("<div>");sa.layoutCtrlWithLRTB(y,0,null,
16,4,0,16);U().background(y,"icon-error-tips");y.appendTo(t);y=$("<div>");sa.layoutCtrlWithLRTB(y,20,0,null,0,0,20);y.text(d.get("importNoPermPrompt","\u6ca1\u6709\u516c\u5171\u76ee\u5f55\u7f16\u8f91\u6743\u9650\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u5206\u914d\u6743\u9650\u3002"));y.appendTo(t);e.call(a,t)}c?(c=$(c),c.css("overflow","visible"),a.appendTo(c)):a.appendTo(G);sa.layoutCtrlWithLRTB(a,0,0,null,0,0,null)}}var ua=this,na,P,Z,M,W,J,T=[],N=[],z=!1,n=!1,E=!1,A=!1;(function(){var b=function(a){T.push(a);
if(a instanceof da)N.push(a);else{var c=a.getChildren();for(a=0;a<c.length;a++)b(c[a])}};b(ba)})();this.getSelectedLeafs=function(b){for(var a=[],c=0;c<N.length;c++){var r=N[c];r.isChecked()&&(r=b?b(r):r,a.push(r))}return a};this.setRootDisplay=function(b){z=b};this.setShowOnlyChecked=function(b){E=b};this.setOperatePublic=function(b){A=b};this.getJqUi=function(){return na};this.init=function(){na=$("<div>");na.addClass("image-lib-tree-selection-container");var b=na;W=$("<div>");sa.layoutCtrlWithLRTB(W,
0,null,200,0,null,23);W.prependTo(b);P=new KTable;b=new pa;P.setCellRender(b);P.setSyncUIWhenModelChanged(!1);P.addTreeExpandListener(x);P.addColumn().setWidth(500);b=$(P.getUI());sa.layoutCtrlWithLRTB(b,0,0,null,23,0,null);na.append(b);ua.updateUi();k()};var x=function(b,a){(b=P.getRow(a.getRowIdx()).getUserObject())&&b.setExpanded(a.isExpanded())},k=function(){for(var b=0,a=0;a<N.length;a++){var c=N[a];c instanceof da&&c.isChecked()&&b++}b=d.get("hitsNumberPrompt","(\u5df2\u9009\u62e9 #1 \u9879)").replace("#1",
b);W.text(b)};this.searchKey=function(b){J=b;n=!!J;for(b=0;b<N.length;b++){var a=N[b];var c=a.isChecked();if(J){var r=-1<a.getName().toUpperCase().indexOf(J.toUpperCase());c=E?r&&c:r}else c=E?a.isChecked():!0;a.setVisible(c,!0,!0)}ua.updateUi()};this.updateUi=function(){qa.clear(P);P.addColumn().setWidth(500);for(var b=!1,a=0;a<N.length;a++)b=b||N[a].isVisible();if(b)for(Z&&Z.hide(),b=0;b<T.length;b++){a=T[b];var c=a.getId();if(a.isVisible()&&(z||"root_id"!==c)){c=qa.createRow(P,!1);c.setHeight(23);
c.setUserObject(a);var r=c.getCell(0),h=a.getSubNodeLevel();h=z?h:h-1;h=new KTCellTreeModel(h);if(a.getChildren){var e=n?!0:a.isExpanded();h.setExpanded(e)}a.getParent()&&(a=n?!1:a.isHide(),c.setHide(a));r.setTreeModel(h)}}else Z||(Z=$("<div>"),Z.addClass("image-lib-im-export-no-data"),M=$("<div>"),M.text(d.get("noQualifiedResults","\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c")),sa.layoutCtrlCenterAlign(M,500),M.addClass("image-lib-im-export-no-data-prompt"),M.css({height:"20px","line-height":"20px",
"margin-top":"98.5px"}),M.appendTo(Z),b=$("<div>"),U().background(b,"no-data"),sa.layoutCtrlCenterAlign(b,187),b.addClass("image-lib-im-export-no-data-icon"),b.css({height:"187px","margin-top":"-113.5px"}),b.appendTo(Z),na.append(Z)),Z.show();qa.refresh(P)};var g=function(b,a){a&&(b.getUserObject().setChecked(b.isChecked(),!0,!0),ua.updateUi(),k())}}function ja(ba){ya.call(this);var pa=this,ua=this.protectedMethod,na,P,Z,M=!1;this.show=function(){ca.setCallback(function(){pa.setSize(640,480);pa.setPosition(window.innerWidth-
640>>1,window.innerHeight-480>>1);ua.setContentPaneCreator(W);ua.setClosingChecker(pa.isValidToAccepted,!0);ua.setClosingAction(N);pa.showDialog()});ca.loadJs("common/qing-table.js")};var W=function(){var z=$("<div>");z.css("color","#666");var n=$("<div>");sa.layoutCtrlWithLRTB(n,0,0,null,0,0,null);n.appendTo(z);na=new O;na.addSearchListener(J);na.setSearchListenerDelay(400);na.setPlaceholder(d.get("searchImageName","\u641c\u7d22\u56fe\u7247\u540d\u79f0"));na.setShowSearchIcon(!0);var E=na.getJqUi();
E.addClass("image-lib-im-export-search-box");E.appendTo(n);E=d.get("showOnlyChecked","\u4ec5\u663e\u793a\u9009\u4e2d\u9879");var A=new S;A.setChecked(!1);A.addCheckedListener(T);A.setText(E);A=A.getJqUi();A.attr("title",E);sa.layoutCtrl(A,250,2,350,23);A.appendTo(n);Z=new ha(ba);Z.setOperatePublic(M);Z.setRootDisplay(!1);Z.init();E=Z.getJqUi();n.append(E);return z},J=function(){P=na.getText().trim();Z.searchKey(P)},T=function(z,n){n&&(Z.setShowOnlyChecked(z.isChecked()),Z.searchKey(P))};this.isValidToAccepted=
function(z){throw Error("Override me!");};var N=function(z){z&&pa.confirm()};this.confirm=function(){throw Error("Override me!");};this.protectedMethod={setTitle:ua.setTitle,getSelectedLeafs:function(z){return Z.getSelectedLeafs(z)},getMessageCurtain:ua.getMessageCurtain,setOperatePublic:function(z){M=z}}}function oa(ba){ja.call(this,ba);var pa=this.protectedMethod,ua,na;pa.setTitle(d.get("importImage","\u5bfc\u5165\u56fe\u7247"));pa.setOperatePublic(!0);this.setFunImportSuccess=function(Z){ua=Z};
this.setCacheFileName=function(Z){na=Z};this.initHeader=function(Z){if(!va.hasPublicPermission()){var M=$("<div>");M.css("color","#f9c43a");sa.layoutCtrlWithLRTB(M,0,0,null,0,null,20);var W=$("<div>");sa.layoutCtrlWithLRTB(W,0,null,20,0,0,20);W.appendTo(M);W=$("<div>");sa.layoutCtrlWithLRTB(W,30,0,null,0,0,20);W.text(d.get("importNoPermPrompt","\u8bf7\u4e3a\u60a8\u7684\u8d26\u6237\u5206\u914d\u8f7b\u5206\u6790\u7ba1\u7406\u5458\u89d2\u8272\uff0c\u4ee5\u4fbf\u5bfc\u5165\u516c\u5171\u7684\u76ee\u5f55\u53ca\u56fe\u7247\u3002"));
W.appendTo(M);M.appendTo(Z);return M}return null};this.isValidToAccepted=function(Z){var M=pa.getSelectedLeafs();if(0===M.length)pa.getMessageCurtain().showPrompt(d.get("notSelectImages","\u672a\u9009\u4e2d\u56fe\u7247\u3002")),Z(!1);else{for(var W=!1,J=0;J<M.length;J++){var T=M[J].getParent().getUserObject();T=T.isPublic()||T.isPreset();W=W||T}W?va.checkPublicPermission(function(N){N?Z(!0):(pa.getMessageCurtain().showPrompt(d.get("importNoPermPrompt","\u6ca1\u6709\u516c\u5171\u76ee\u5f55\u7f16\u8f91\u6743\u9650\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u5206\u914d\u6743\u9650\u3002")),
Z(!1))}):Z(!0)}};this.confirm=function(){for(var Z,M=pa.getSelectedLeafs(),W=[],J=0;J<M.length;J++){var T=M[J],N=T.getUserObject(),z=T.getParent().getUserObject();N=N.toJsonObject();N.categoryName=P(T.getParent());T=z.getNameSpace();N.nameSpace=T;W.push(N);0===J&&(Z=T+ma.SEPERATOR+z.getName())}va.createFacade(function(n){var E=n.cacheFileName,A=new ta;A.fromJsonObject(n.importResult);A.isAllSuccess()?ua(Z):(n=new ra,n.setImportSuccess(ua),n.setCacheFileName(E),n.setImportResult(A),n.show())},function(n,
E){return 1100021===n?(va.getMessageCurtain().showPrompt(E,5E3),!0):!1}).importSelectedImages(W,na)};var P=function(Z){for(var M=Z.getUserObject().getName();!Z.getParent().isVisited();)Z=Z.getParent(),M=Z.getUserObject().getName()+"/"+M;return M}}function ra(){function ba(x){KTDefaultCellRender.call(this,x);var k=this,g=this.paintCellUI;this.paintCellUI=function(a,c){var r=k.getCurrentRowIdx(),h=k.getCurrentRow(),e=k.getCurrentColIdx(),f=h.getUserObject();r<qa.getHeadRowCount()?g(a,c):0===e?(c=$("<div>"),
r=f.isPublic()?d.get("public","\u516c\u5171"):d.get("private","\u4e2a\u4eba"),r=r+"-"+(f.isGallery()?d.get("downloadGallery","\u6765\u81ea\u4e91\u7d20\u6750"):d.get("userUploadFile","\u4e0a\u4f20\u7684\u56fe\u7247")),b(c,r),c.appendTo(a)):1===e?(c=$("<div>"),b(c,f.getCategoryName()),c.appendTo(a)):2===e?(c=$("<div>"),b(c,f.getImageName()),c.appendTo(a)):3===e&&(c=r-qa.getHeadRowCount(),a=qa.createCtrlInCell(a,k.getCellWidth(),k.getCellHeight(),R),a.setItemModels(f.isGallery()?[ea.CONFLICT_STRATEGY_IGNORE,
ea.CONFLICT_STRATEGY_OVERWRITE]:[ea.CONFLICT_STRATEGY_IGNORE,ea.CONFLICT_STRATEGY_OVERWRITE,ea.CONFLICT_STRATEGY_RENAME]),a.setSelected(f.getConflictStrategy()),a.setUserObject(f),a.setCustomPainter(function(l,t,G){switch(G){case ea.CONFLICT_STRATEGY_IGNORE:var B=d.get("ignore","\u5ffd\u7565");break;case ea.CONFLICT_STRATEGY_OVERWRITE:B=d.get("overwrite","\u8986\u76d6");break;case ea.CONFLICT_STRATEGY_RENAME:f.isGallery()||(B=d.get("rename","\u91cd\u547d\u540d"));break;default:B=""}l=$("<div>");l.text(B);
l.appendTo(t)}),a.addSelectedChangedListener(function(l,t,G){l.getUserObject().setConflictStrategy(G)}),W[c]=a)};var b=function(a,c){a.text(c);a.attr("title",c);a.addClass("image-lib-import-conflict-handing-cell")}}function pa(){this.isRowDraggable=function(x,k){return!0};this.isColumnDraggable=function(x,k){return!0};this.getMinRowHeightLimited=function(x,k){return 3};this.getMinColumnWidthLimited=function(x,k){return 4};this.rowDraggedAction=function(x,k,g){var b=x.isSyncUIWhenModelChanged();x.setSyncUIWhenModelChanged(!0);
k=x.getRow(k);k.setHeight(k.getHeight()+g);x.setSyncUIWhenModelChanged(b)};this.columnDraggedAction=function(x,k,g){var b=x.isSyncUIWhenModelChanged();x.setSyncUIWhenModelChanged(!0);k=x.getColumn(k);k.setWidth(k.getWidth()+g);x.setSyncUIWhenModelChanged(b)};this.getTailBlankForDragging=function(){return 0}}ya.call(this);var ua=this,na=this.protectedMethod,P,Z,M,W=[],J,T,N;ua.setSize(640,480);na.setTitle(d.get("importImage","\u5bfc\u5165\u56fe\u7247"));this.show=function(){na.setContentPaneCreator(ua.getJqUi);
na.setClosingChecker(ua.isValidToAccepted,!0);na.setClosingAction(z);ua.showDialog();ua.updateUi()};this.getJqUi=function(){if(!P){P=$("<div>");P.css("color","#666");M=new q;E(P);var x=P;Z=new KTable;Z.setFrozenRows(3);Z.setColumnFitVisibleWidth(!0);Z.setSyncUIWhenModelChanged(!1);Z.setDraggableAdjusting(!0,2,0,new pa);qa.bindTableListenerForCtrl(Z);var k=new ba(Z);k.setOutsideVisible(!1);Z.setCellRender(k);k=$(Z.getUI());sa.layoutCtrlWithLRTB(k,0,0,null,64,0,null);k.appendTo(x)}return P};this.setImportSuccess=
function(x){J=x};this.setCacheFileName=function(x){T=x};this.setImportResult=function(x){N=x};this.isValidToAccepted=function(x){x(!0)};var z=function(x){if(x){x=[];for(var k,g=N.getConflictImages(),b=0;b<g.length;b++){var a=g[b];x.push(a.toJsonObject());0===b&&(k=a.getNameSpace()+ma.SEPERATOR+a.getCategoryName())}va.createFacade(function(c){c&&J(k)},function(c,r){return 1100021===c?(va.getMessageCurtain().showPrompt(r,5E3),!0):!1}).conflictHanding(x,T)}},n=function(x,k,g){var b=$("<div>");b.text(x);
b.addClass("image-import-conflict-all-operate");b.on("click",g);k&&(x=$("<div>"),x.addClass("image-import-conflict-btn-split-line"),x.appendTo(b));return b},E=function(x){var k=function(r,h,e,f,l){e=n(e,h!==ea.CONFLICT_STRATEGY_RENAME,function(){for(var t=!1,G=N.getConflictImages(),B=0,m=G.length;B<m;B++)G[B].isGallery()&&h==ea.CONFLICT_STRATEGY_RENAME?t=!0:G[B].setConflictStrategy(h);t&&na.getMessageCurtain().showPrompt(d.get("downloadGalleryNotAllowedRename","\u6765\u81ea\u4e91\u7d20\u6750\u7684\u56fe\u7247\u4e0d\u5141\u8bb8\u91cd\u547d\u540d\u3002"),
2E3);t=N.getConflictImages();for(G=0;G<W.length;G++)t[G].isGallery()&&h==ea.CONFLICT_STRATEGY_RENAME||W[G].setSelected(h)});sa.layoutCtrl(e,l,30,f,23);e.appendTo(r)},g=new xa;g.setFontSize(12);var b=0,a=d.get("allIgnore","\u5168\u90e8\u5ffd\u7565"),c=g.measureWidth(a)+10;k(x,ea.CONFLICT_STRATEGY_IGNORE,a,c,b);b+=c+10;a=d.get("allOverwrite","\u5168\u90e8\u8986\u76d6");c=g.measureWidth(a)+10;k(x,ea.CONFLICT_STRATEGY_OVERWRITE,a,c,b);A()&&(b+=c+10,a=d.get("allRename","\u5168\u90e8\u91cd\u547d\u540d"),
c=g.measureWidth(a)+10,k(x,ea.CONFLICT_STRATEGY_RENAME,a,c,b))},A=function(){for(var x=N.getConflictImages(),k=0,g=x.length;k<g;k++)if(!x[k].isGallery())return!0;return!1};this.updateUi=function(){if(N){var x=M.getJqUi();sa.layoutCtrl(x,0,0,400,20);x.appendTo(P);x=d.get("conflictHandingPrompt","\u6210\u529f\u5bfc\u5165#1\u5f20\u56fe\u7247\u3002\u4ee5\u4e0b\u56fe\u7247\u8def\u5f84\u51b2\u7a81\uff0c\u8bf7\u5904\u7406\u3002").replace("#1",N.getSuccessCount());M.setText(x);qa.clear(Z);Z.addColumns(4);
Z.getColumn(0).setWidth(80);Z.getColumn(1).setWidth(130);Z.getColumn(2).setWidth(130);Z.getColumn(3).setWidth(50);x=qa.createHeadRow(Z);x.getCell(0).setValue(d.get("categoryType","\u76ee\u5f55\u7c7b\u578b"));x.getCell(1).setValue(d.get("categoryName","\u76ee\u5f55\u540d\u79f0"));x.getCell(2).setValue(d.get("imageName","\u56fe\u7247\u540d\u79f0"));x.getCell(3).setValue(d.get("handleStrategy","\u5904\u7406\u7b56\u7565"));x=N.getConflictImages();for(var k=0;k<x.length;k++){var g=x[k];qa.createRow(Z).setUserObject(g)}qa.refresh(Z)}}}
"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.imagelib&&(com.kingdee.bos.qing.imagelib={});"undefined"==typeof com.kingdee.bos.qing.imagelib.imexport&&(com.kingdee.bos.qing.imagelib.imexport={});"undefined"==typeof com.kingdee.bos.qing.imagelib.imexport.ui&&(com.kingdee.bos.qing.imagelib.imexport.ui=
{});var wa=com.kingdee.bos.qing.imagelib.imexport.ui;wa.UploadPane=function(){var ba,pa,ua,na;this.createJqUi=function(N,z){ba=z;z=$("<div>");z.addClass("image-lib-import-upload-main");var n=$(document.body),E=$("<div class='image-lib-import-upload-modallayer'>");E.appendTo(n);pa=$("<progress value='0' max='100'>");pa.addClass("image-lib-import-upload-progress");var A=$("<div>");A.addClass("image-lib-import-uploading-prompt");A.text(d.get("uploading","\u6b63\u5728\u4e0a\u4f20\u4e2d\uff0c\u8bf7\u7a0d\u5019"));
z.append(pa);z.append(A);n.append(z);P(N,z,E)};this.setUploadSuccessCallback=function(N){ua=N};this.setUploadFailedCallback=function(N){na=N};var P=function(N,z,n){var E=new FormData;E.append("filename",N);N=new XMLHttpRequest;N.upload.addEventListener("progress",Z,!1);N.addEventListener("error",M,!1);var A=com.kingdee.bos.qing.framework.common.RemoteFrameworkRegister.getUploadUrl();N.open("post",A,!0);N.onload=function(x){200===this.status&&(x=JSON.parse(this.response),"number"==typeof x.errorCode&&
3099003===x.errorCode?ba.showError(x.errorMessage):W(x.data),z.remove(),n.remove())};N.send(E)},Z=function(N){var z=pa.get(0);N.lengthComputable&&(z.max=N.total,z.value=N.loaded)},M=function(N){na&&na(d.get("uploadFail","\u4e0a\u4f20\u5931\u8d25"))},W=function(N){va.createFacade(function(z){var n=z.pictures;if(0===n.length)ba.showPrompt(d.get("noImportableImages","\u672a\u627e\u5230\u53ef\u5bfc\u5165\u7684\u56fe\u7247\u3002"));else{var E=T("root_id",d.get("catalogue","\u76ee\u5f55")),A=T("private_id",
d.get("private","\u4e2a\u4eba"),E),x=T("public_id",d.get("public","\u516c\u5171"),E),k=T("private_user_id",d.get("userUploadFile","\u4e0a\u4f20\u7684\u56fe\u7247"),A),g=T("public_user_id",d.get("userUploadFile","\u4e0a\u4f20\u7684\u56fe\u7247"),x),b=T("private_gallery_id",d.get("downloadGallery","\u6765\u81ea\u4e91\u7d20\u6750"),A),a=T("public_gallery_id",d.get("downloadGallery","\u6765\u81ea\u4e91\u7d20\u6750"),x);J(x,!0);J(g,!0);J(a,!0);var c={},r={},h;for(h=0;h<n.length;h++){var e=[],f=!1,l=n[h],
t=l.nameSpace,G=l.categoryName.split("/"),B=G.length,m=t===ma.PERSISTENT_NAMESPACE_SYSTEM,u=t===ma.PERSISTENT_NAMESPACE_COMMON||m||t===ma.PERSISTENT_NAMESPACE_GALLERY_COMMON,I=t===ma.PERSISTENT_NAMESPACE_GALLERY_USER||t===ma.PERSISTENT_NAMESPACE_GALLERY_COMMON,X=t+G[B-1]+(B-1)+I;var Y=u?r[X]:c[X];if(!Y){for(Y=0;Y<B;Y++){X=t+G[Y]+Y+I;if(!c[X]&&!r[X]){e[Y]=new V;var y=new ia;y.setId("group_id_"+Y);y.setName(G[Y]);y.setPreset(m);y.setPublic(u);y.setGallery(I);e[Y].setUserObject(y);J(e[Y],u);0<Y&&(e[Y].setParent(e[Y-
1]),e[Y-1].add(e[Y]))}u?r[X]?(f=!0,e[Y]=r[X]):r[X]=e[Y]:c[X]?(f=!0,e[Y]=c[X]):c[X]=e[Y]}Y=e[B-1];f||(u?I?(e[0].setParent(a),a.add(e[0])):(e[0].setParent(g),g.add(e[0])):I?(e[0].setParent(b),b.add(e[0])):(e[0].setParent(k),k.add(e[0])))}e=new da;f=new K;f.setId(l.id?l.id:h);f.setNameAndType(l.imageName);f.setFileName(l.id);e.setUserObject(f);e.setParent(Y);Y.addTo(e,0);J(e,u)}0<k.getChildren().length&&A.add(k);0<g.getChildren().length&&x.add(g);0<a.getChildren().length&&x.add(a);0<b.getChildren().length&&
A.add(b);0<x.getChildren().length&&E.add(x);0<A.getChildren().length&&E.add(A);n=new oa(E);n.setFunImportSuccess(ua);n.setCacheFileName(z.cacheFileName);n.show()}},function(){return!1}).parseFileToImages(N)},J=function(N,z){z&&(va.hasPublicPermission()?N.setGrey(!1):N.setGrey(!0))},T=function(N,z,n){var E=new V;E.setVisited(!0);"public_id"!==N||va.hasPublicPermission()||E.setExpanded(!1);var A=new ia;N&&A.setId(N);z&&A.setName(z);n&&E.setParent(n);E.setUserObject(A);return E}};wa.ExportDialog=function(ba){ja.call(this,
ba);var pa=this.protectedMethod;pa.setTitle(d.get("exportImage","\u5bfc\u51fa\u56fe\u7247"));this.isValidToAccepted=function(ua){0===pa.getSelectedLeafs().length?(pa.getMessageCurtain().showPrompt(d.get("notSelectImages","\u672a\u9009\u4e2d\u56fe\u7247\u3002")),ua(!1)):ua(!0)};this.confirm=function(){var ua=pa.getSelectedLeafs(function(na){return na.getUserObject().toJsonObject()});va.createFacade(function(na){va.downloadExportFile(na)},function(){return!1}).exportImages(ua)}};var sa,xa,ca,qa,ya,
O,R,S,q,d,D,aa,ia,K,da,V,ea,ta,ma,va;(function(){var ba=com.kingdee.bos.qing.common;sa=ba.DomUtil;xa=ba.TextMeasurer;ba=com.kingdee.bos.qing;ca=ba.CodeLoader;ba=com.kingdee.bos.qing.common.ui;qa=ba.TableUtil;ba=com.kingdee.bos.qing.ui.component;ya=ba.AbstractModalDialog;O=ba.SearchBox;R=ba.ComboBox;S=ba.CheckBox;q=ba.Label;ba=com.kingdee.bos.qing.framework.common;D=ba.MultilanguageManager;ba=com.kingdee.bos.qing.imagelib.model;K=ba.Image;ia=ba.ImageCategory;da=ba.LeafNode;V=ba.FolderNode;ea=ba.ImportImage;
ta=ba.ImportResult;ma=ba.PathModel;ba=com.kingdee.bos.qing.imagelib.common;va=ba.ImageLibUtil;d=D.createPackageAccessor(ba)})()})();(function(){function U(){K||(K=com.kingdee.bos.qing.imagelib.MyIcons);return K}function ha(){ua.call(this);var z=this,n=z.protectedMethod,E,A={},x,k;this.init=function(){var f=new ja;f.init();var l=new wa;z.setCategoryAndCardContainer(f,l);n.init();n.getUploadBtn().attr("accept",[".qing-pic"]);k&&z.jumpToImageByImageModel(k);x=!0};this.setSelectedImage=function(f){k=f;x&&z.jumpToImageByImageModel(k)};this.getFunGetSearchValue=function(f){return f.getName().toUpperCase()};var g=z.getAllModels;this.getAllModels=
function(f){g(f);J.createFacade(function(l){var t,G=[];for(t=0;t<l.length;t++){var B=l[t],m=new pa,u=new ta;u.fromJsonObject(B);m.setUserObject(u);G.push(m)}n.getCategoryContainer().bindImagesIntoCategories(G);f&&f()},function(l,t){return!1}).getAllImage()};var b=function(f){E=new N(f);E.show()},a=function(f){A={};J.createFacade(function(l){var t,G=l.images,B=l.categories;l=c(q.get("public","\u516c\u5171"),"public_id",!0,!0);var m=c(q.get("private","\u4e2a\u4eba"),"private_id",!1,!0),u=c(q.get("userUploadFile",
"\u4e0a\u4f20\u7684\u56fe\u7247"),"",!1,!1),I=c(q.get("userUploadFile","\u4e0a\u4f20\u7684\u56fe\u7247"),"",!0,!1),X=c(q.get("downloadGallery","\u6765\u81ea\u4e91\u7d20\u6750"),"",!1,!1),Y=c(q.get("downloadGallery","\u6765\u81ea\u4e91\u7d20\u6750"),"",!0,!1);for(t=0;t<B.length;t++){var y=new ba,C=new ea;C.fromJsonObject(B[t]);y.setExpanded(!1);y.setUserObject(C);y.fromJsonObjectForExport(B[t]);C.isPreset()?(I.addTo(y,0),y.setParent(I),y.setGrey(!0)):C.isPublic()?C.isGallery()?(Y.add(y),y.setParent(Y)):
(I.add(y),y.setParent(I)):C.isGallery()?(X.add(y),y.setParent(X)):(u.add(y),y.setParent(u))}I.setParent(l);u.setParent(m);l.setChildren([I]);m.setChildren([u]);0<Y.getChildren().length&&(Y.setParent(l),l.add(Y));0<X.getChildren().length&&(X.setParent(m),m.add(X));r(l);r(m);for(t=0;t<G.length;t++)if(u=G[t],B=new pa,I=new ta,I.fromJsonObject(u),B.setUserObject(I),u=A[I.getCategoryId()])u.add(B),B.setParent(u),u.getUserObject().isPreset()&&B.setGrey(!0);G=new ba;t=new ea;t.setId("root_id");t.setName(q.get("catalogue",
"\u76ee\u5f55"));G.setUserObject(t);G.setChildren([l,m]);l.setParent(G);m.setParent(G);h(G);f&&f(G)},function(){return!1}).getAllCategoryAndImage()},c=function(f,l,t,G){var B=new ba,m=new ea;m.setId(l);m.setName(f);m.setPublic(t);B.setUserObject(m);B.setExpanded(G);return B},r=function(f){A[f.getId()]=f;var l=f.getChildren();for(f=0;f<l.length;f++)r(l[f])},h=function(f){var l,t=!1,G=f.getChildren();if(null==G||0===G.length)return!1;for(l=0;l<G.length;l++)if(G[l].getUserObject()instanceof ta){t=!0;
break}var B=[];for(l=0;l<G.length;l++){var m=G[l];m instanceof ba&&(h(m)?t=!0:B.push(m))}for(l=0;l<B.length;l++)f.deleteByEquals(B[l]);return t};this.importImage=function(){var f=n.getUploadBtn(),l=f.get(0).files[0];if(l){var t=l.name,G=l.size,B=t.lastIndexOf(".");t=t.substring(B+1,t.length).toLowerCase();f.val("");"qing-pic"!==t?J.getMessageCurtain().showPrompt(q.get("fileTypeIncorrect","\u6587\u4ef6\u7c7b\u578b\u4e0d\u6b63\u786e\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u3002"),2E3):0===G?J.getMessageCurtain().showPrompt(q.get("uploadFileIsNull",
"\u4e0a\u4f20\u7684\u6587\u4ef6\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u3002"),2E3):104857600<=G?J.getMessageCurtain().showPrompt(q.get("fileTooLarge","\u6587\u4ef6\u592a\u5927\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u3002"),2E3):(f=new T,f.createJqUi(l,J.getMessageCurtain()),f.setUploadSuccessCallback(function(m){z.refresh(null,function(){n.getCategoryContainer().setSelectedByFullPath(m)})}))}};this.exportImage=function(){a(b)};this.galleryCloud=function(){var f=com.kingdee.bos.qing.common.Util.decodeParamFromUrl(location.search,
"path");f=f?f:"/ierp";var l=q.get("gallery","\u4e91\u7d20\u6750");d.openNewTab(l,f+"/qing/galleryEntrance.do?isEntrance=true")};var e=z.refresh;this.refresh=function(f,l){e();J.checkPublicPermission(function(t){J.setHasPublicPermission(t);var G=n.getCategoryContainer();G.setPublicPermission(t);G&&G.updateListUi(!0);l&&G.setRefreshCallBack(l)})}}function ja(){Z.call(this);var z=this,n=z.protectedMethod,E,A=J.hasPublicPermission();this.setLoadImages=function(k){E=k};this.bindImagesIntoCategories=function(k){var g=
n.getPrivateCategoryList(),b=n.getPublicCategoryList();g&&g.bindChildrenIntoCategories(k);b&&b.bindChildrenIntoCategories(k)};this.provideCategories=function(){var k=[],g=[];n.operateCategoryList(function(c){k=c.getModels();c.getCurrent()});for(var b=0;b<k.length;b++){var a=k[b];a.getUserObject().isGallery()||a.getUserObject().isPreset()||g.push(a)}return g};this.getAllChildren=function(){var k=n.getPrivateCategoryList();k=k?k.getAllModels():[];var g=n.getPublicCategoryList();g=g?g.getAllModels():
[];return x(k).concat(x(g))};var x=function(k){for(var g=[],b=0;b<k.length;b++)for(var a=k[b].getChildren(),c=0;c<a.length;c++){var r=a[c];r.getUserObject()instanceof ta&&g.push(r)}return g};this.afterCreateList=function(k,g){k.setFunLoadImages&&k.setFunLoadImages(E);g.setFunLoadImages&&g.setFunLoadImages(E)};this.setPublicPermission=function(k){z.setCategoryListClass(k);A=k;z.switchTabCallback()};this.setCategoryListClass=function(k){k?n.setCategoryListClass(ra):n.setCategoryListClass(ra,oa)};this.init=
function(){z.setCategoryListClass(A);n.init();n.getJqCategoryList().css("top","45px")}}function oa(z){P.call(this,z);var n=this,E=n.abstractProtectMethod,A;this.setFunItemClick=function(b){A=b};this.getHeight=function(){var b=n.getModels();return b?b.length*oa.ITEM_HEIGHT:0};this.getNoDataPrompt=function(){return q.get("noCategory","\u6ca1\u6709\u76ee\u5f55")};this.listItemPainter=function(b,a){b.addClass("img-lib-mange-lists-dir");b.data("oNode",a);var c=$("<div>"),r=a.getUserObject(),h=r.getName();
c.text(h);c.addClass("img-lib-mange-lists-dir-text");c.css("margin-left",14*a.getSubNodeLevel()+"px");b.attr("title",h);b.addClass("image-lib-manage-list-item-across");var e=$("<div>");e.addClass("select-tree-menu-icon-click");e.css("margin-left",14*a.getSubNodeLevel()+"px");e.data("oItemModel",a);var f=$("<div>");f.addClass("select-tree-menu-icon");f.css("cursor","pointer");e.append(f);a.isHide()?b.hide():a.getParent()?(b.show(),e.on("mousedown",function(t){t.stopPropagation();t=$(t.currentTarget).data("oItemModel");
x(t)})):b.show();var l=a.isExpanded();(h=a.getDirChildren())&&0<h.length&&a.getParent()&&(g(l,f),b.append(e));b.append(c);e=$("<div>");r.isPreset()?(e=$("<div>"),e.text(q.get("preset","\u9884\u7f6e")),e.css({overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap",width:"25px"}),e.attr("title",q.get("preset","\u9884\u7f6e")),e.addClass("img-lib-mange-lists-dir-preset"),e.css("margin-left",14*a.getSubNodeLevel()+24+"px"),"preset"==e.text()?c.css("margin-left",14*a.getSubNodeLevel()+45+"px"):
c.css("margin-left",14*a.getSubNodeLevel()+33+"px"),b.append(e)):r.isGallery()&&0<h.length?(b.removeClass("sa-ctrl-list-item"),b.removeClass("image-lib-manage-list-item-across")):r.isGallery()||c.css("margin-right","74px");E.funItemModelEqualsChecker(a,n.getCurrent())&&a.getParent()?(b.addClass("sa-ctrl-list-item_selected_enabled"),e&&e.addClass("img-lib-mange-lists-dir-preset_selected")):(b.on("mouseenter",function(t){n.getCurrent()}),b.on("mouseleave",function(t){n.getCurrent()}))};var x=function(b){if(b){if(b.getDirChildren()&&
0<b.getDirChildren().length){var a=b.isExpanded();b.setExpanded(!a)}else b.setExpanded(!0);k(b);n.refreshList(n.getModels())}},k=function(b){if(b=b instanceof ba&&b.getDirChildren())for(var a=0;a<b.length;a++)b[a].getParent().isExpanded(),k(b[a])},g=function(b,a){b?(a.addClass("lower-triangle"),a.removeClass("select-tree-menu-icon"),a.css({top:"7px",left:"4px"})):(a.addClass("right-triangle"),a.removeClass("lower-triangle"),a.css({top:"3px",left:"7px"}))};this.refreshList=function(b){var a=b[0].getUserObject().isGallery()?
n.getJqUi().find(".img-lib-mange-lists-dir-gallery"):n.getJqUi().find(".img-lib-mange-lists-dir-imglist");a=a.find(".sa-ctrl-list-owner");a.empty();for(var c=$(document.createDocumentFragment()),r=n.listItemPainter,h=0;h<b.length;h++){var e=$("<div>"),f=b[h];e.addClass("sa-ctrl-list-item");e.addClass("sa-ctrl-list-item_enabled");e.addClass("sa-ctrl-list-item-defaultlayout");f.equals(n.getCurrent())&&e.addClass("sa-ctrl-list-item_selected_enabled");e.data("model",f);r(e,f);c.append(e)}a.append(c)};
this.itemClick=function(b){var a,c=n.getJqUi().find(".img-lib-mange-lists-dir"),r=b.getUserObject().isPreset(),h=n.getList().getJqUi().find(".img-lib-mange-lists-dir-preset_selected");h&&h.removeClass("img-lib-mange-lists-dir-preset_selected");c.each(function(e){e=$(c[e]);var f=e.data("oNode");if(f&&f.equals(b)&&b.getParent()){for(f=f.getParent();f&&!f.isExpanded();)x(f),f=f.getParent();a=e}});r&&(r=a.find(".img-lib-mange-lists-dir-preset"))&&r.addClass("img-lib-mange-lists-dir-preset_selected");
a&&a.addClass("sa-ctrl-list-item_selected_enabled");n.updateCurrent(b);A&&A(b)};this.protectedMethod={listItemPainter:n.listItemPainter}}function ra(z){oa.call(this,z);var n=this,E=n.abstractProtectMethod,A=n.protectedMethod,x;this.bindChildrenIntoCategories=function(y){if(y&&0!==y.length){var C=n.getAllModels(),w;for(w=0;w<C.length;w++){var p=[],v=C[w],F=v.getUserObject();var L=F.isPreset();F=F.isGallery();if(!L&&!F){L=p;F=v;var H=new pa;H.setUserObject(new ma);H.setParent(F);L.push(H)}for(L=0;L<
y.length;L++)F=y[L],F.getUserObject().getCategoryId()===v.getId()&&(p.push(F),F.setParent(v));v.setChildren(p);v.setVisited(!0)}}};this.getNoDataPrompt=function(){return q.get("noCategoryAndAdd","\u6ca1\u6709\u76ee\u5f55\uff0c\u8bf7\u5148\u65b0\u5efa\u76ee\u5f55")};this.listItemPainter=function(y,C){A.listItemPainter(y,C);C.getUserObject().isPreset()||C.getUserObject().isGallery()||!C.getParent()||k(E.getIndex(C),y)};this.setFunLoadImages=function(y){x=y};var k=function(y,C){var w=n.getModels(),p=
0!==y,v=$("<div>"),F=p&&w[y-1],L=w[y].getParent()?w[y].getParent().getDirChildren():null;p=p&&!F.getUserObject().isPreset()&&w[y]!=L[0];v.addClass("image-lib-manage-list-item-op-group");var H=$("<div>");H.addClass("image-lib-manage-list-item-op-menu");H.css("top","-1px");H.attr("title",q.get("moreOp","\u66f4\u591a\u64cd\u4f5c"));H.on("mousedown",function(Q){g(Q,C)});U().background(H,"menu");H.appendTo(v);if(p){var ka=$("<div>");ka.addClass("image-lib-manage-list-item-op-order");ka.attr("title",q.get("orderUp",
"\u4e0a\u79fb"));ka.on("mousedown",function(Q){e(Q,C)});U().background(ka,"icon-order-up");ka.appendTo(v)}C.on("mouseenter",function(){v.show();n.getCurrent().equals(w[y])?(U().background(H,"menu_hover"),p&&U().background(ka,"icon-order-up_hover")):(U().background(H,"menu"),p&&U().background(ka,"icon-order-up"))});C.on("mouseleave",function(){v.hide()});C.on("click",function(){var Q=C.data("oNode");n.itemClick(Q);U().background(H,"menu_hover");p&&U().background(ka,"icon-order-up_hover")});v.hide();
v.appendTo(C)},g=function(y,C){var w=$(y.currentTarget);if((y=w.data("menu"))&&y.isShowing())w.data("menu",null),y.hide();else{C=new V;C.addItemModel(da.createActionMenuItem(q.get("addBroCategory","\u65b0\u5efa\u540c\u7ea7\u76ee\u5f55"),b));C.addItemModel(da.createActionMenuItem(q.get("addChildCategory","\u65b0\u5efa\u5b50\u7ea7\u76ee\u5f55"),a));C.addItemModel(da.createActionMenuItem(q.get("edit","\u7f16\u8f91")+q.get("type","\u76ee\u5f55"),l));C.addItemModel(da.createActionMenuItem(q.get("remove",
"\u5220\u9664"),G));y=new da;y.setModel(C);y.setHideListener(function(){w.data("menu",null)});w.data("menu",y);C=w.outerHeight();var p=n.getJqUi(),v=[0,C];v=ca.upwardCoordinate(w[0],v,p[0]);y.show(p,v[0],v[1],w,!0,[0,-C])}},b=function(){var y=function(H){w.getParent().addDirChildren(H);C.splice(p+1,0,H);n.setModels(C);n.setSelected(H);n.updateUi()},C=n.getAllModels(),w=n.getSelected();if(w){var p=c(w,"ADD_CURRENT"),v=n.getList().getItemUiByModel(C[p]);if(v&&0<v.length){var F=new S,L=F.getJqUi();L.show();
F.setEnabled(!0);L.addClass("img-lib-manager-dir-editing");L.children().css("position","relative");L.children().css("padding-left",14*w.getSubNodeLevel()+25+"px");L.insertAfter(v);F.requestFocus();F.addBlurListener(function(){var H=F.getText();H&&(H=H.trim(),F.getJqUi().attr("title",H));F.getJqUi().remove();X(H)&&(H=new ba,H.setParent(w.getParent()),Y(!0,F,h,y,H))});L.on("keydown",function(H){if(13==(H.keyCode||H.which||H.charCode)){if(H=F.getText())H=H.trim(),F.getJqUi().attr("title",H);F.getJqUi().remove();
X(H)&&(H=new ba,H.setParent(w.getParent()),Y(!0,F,h,y,H))}})}else J.getMessageCurtain().showPrompt(q.get("selectedOneDirectory","\u8bf7\u5148\u9009\u4e2d\u5177\u4f53\u76ee\u5f55\u3002"),2E3)}else 0<C.length&&J.getMessageCurtain().showPrompt(q.get("selectedOneDirectory","\u8bf7\u5148\u9009\u4e2d\u5177\u4f53\u76ee\u5f55\u3002"),2E3)},a=function(){var y=function(H){w.addDirChildren(H);C.splice(p+1,0,H);n.setModels(C);n.setSelected(H);n.updateUi()},C=n.getAllModels(),w=n.getSelected();if(w){var p=c(w,
"ADD_SUB"),v=n.getList().getItemUiByModel(C[p]);if(v&&0<v.length)if(4<=w.getSubNodeLevel())J.getMessageCurtain().showPrompt(q.get("theMaxDirenctoryLevel","\u6700\u591a\u53ef\u652f\u63014\u7ea7\u76ee\u5f55\uff0c\u5f53\u524d\u76ee\u5f55\u4e3a\u7b2c4\u7ea7\u76ee\u5f55\uff0c\u65e0\u6cd5\u65b0\u589e\u4e0b\u7ea7\u76ee\u5f55\u3002"),2E3);else{var F=new S,L=F.getJqUi();L.show();F.setEnabled(!0);L.addClass("img-lib-manager-dir-editing");L.children().css("position","relative");L.children().css("padding-left",
14*w.getSubNodeLevel()+40+"px");L.insertAfter(v);F.requestFocus();F.addBlurListener(function(){var H=F.getText();H&&(H=H.trim(),F.getJqUi().attr("title",H));F.getJqUi().remove();X(H)&&(H=new ba,H.setParent(w),Y(!0,F,h,y,H))});L.on("keydown",function(H){if(13==(H.keyCode||H.which||H.charCode)){if(H=F.getText())H=H.trim(),F.getJqUi().attr("title",H);F.getJqUi().remove();X(H)&&(H=new ba,H.setParent(w),Y(!0,F,h,y,H))}})}else J.getMessageCurtain().showPrompt(q.get("selectedOneDirectory","\u8bf7\u5148\u9009\u4e2d\u5177\u4f53\u76ee\u5f55\u3002"),
2E3)}else J.getMessageCurtain().showPrompt(q.get("selectedOneDirectory","\u8bf7\u5148\u9009\u4e2d\u5177\u4f53\u76ee\u5f55\u3002"),2E3)},c=function(y,C){var w=n.getModels().length-1;if("ADD_CURRENT"==C)return y.getParent()&&(C=E.getIndex(y.getParent()),w=[],w=r(w,y.getParent()),w=parseInt(C)+w.length-1),w;if("ADD_SUB"==C)return y.getDirChildren()&&0<y.getDirChildren().length?(C=E.getIndex(y),w=[],w=r(w,y),w=parseInt(C)+w.length-1):C=E.getIndex(y)},r=function(y,C){y.push(C);if((C=C.getDirChildren())&&
0<C.length)for(var w=0;w<C.length;w++)C[w].getDirChildren()&&0<C[w].getDirChildren().length?r(y,C[w]):y.push(C[w]);return y},h=function(y,C,w){var p=w.getParent(),v=p.getUserObject(),F=v.isPublic();p=p.getParent()?v.getId():null;var L=new ea;L.setPublic(F);L.setName(y);L.setParentId(p);J.createFacade(function(H){H&&(J.getMessageCurtain().showSuccess(q.get("saveCategorySuccess","\u65b0\u589e\u76ee\u5f55\u6210\u529f\u3002")),L.setId(H),w.setVisited(!0),H=new pa,H.setUserObject(new ma),H.setParent(w),
w.setUserObject(L),w.addTo(H,0),C(w))},function(H,ka){return 1100008===H?(J.getMessageCurtain().showPrompt(q.get("groupNameExist","\u76ee\u5f55\u540d\u79f0\u5df2\u5b58\u5728\u3002")),!0):!1}).saveOrUpdateCategory(L.toJsonObject())},e=function(y,C){var w=C.data("oNode"),p=n.getAllModels(),v=[];y=w.getParent().getDirChildren();for(C=0;C<p.length;C++)p[C].getParent()||v.push(p[C]);for(C=0;C<y.length;C++)if(w.equals(y[C])&&0!==C){w=y[C];y[C]=y[C-1];y[C-1]=w;break}w=1;p=[];for(C=y.length-1;0<=C;C--){var F=
y[C].getUserObject();F.isPreset()||(F.setOrder(w),p.push(F.toJsonObject()),w++)}J.createFacade(function(L){L&&(L=[],f(L,v),n.setModels(L))},function(){return!1}).saveOrderCategory(p,y[0].getUserObject().isPublic())},f=function(y,C){if(null!=C)if(Array.isArray(C))for(var w=0;w<C.length;w++)y.push(C[w]),f(y,C[w].getDirChildren());else y.push(C),f(y,C.getDirChildren())},l=function(y){var C=function(){v&&v.remove()},w=n.getCurrent();y=n.getList().getItemUiByModel(w);var p=new S;p.setEnabled(!0);p.addBlurListener(function(){Y(!0,
p,t,C,w)});p.addAcceptableListener(function(F,L){Y(L,p,t,C,w)});p.setText(w.getName());var v=p.getJqUi();v.addClass("img-lib-manager-dir-editing");v.css("width","101%");v.css("left","-4px");v.children().css("position","relative");v.children().css("padding-left",14*w.getSubNodeLevel()+25+"px");v.on("click",function(F){F.stopPropagation()});v.appendTo(y);p.requestFocus()},t=function(y,C,w){var p=w.getUserObject();if(!X(y)||I(p))C();else if(p.getName()===y)C();else{var v=p.getName();p.setName(y);J.createFacade(function(){J.getMessageCurtain().showSuccess(q.get("editCategory",
"\u4fee\u6539\u76ee\u5f55")+q.get("success","\u6210\u529f")+q.get("fullPoint","\u3002"));n.updateUi()},function(F,L){p.setName(v);C();return 1100008===F?(J.getMessageCurtain().showPrompt(q.get("groupNameExist","\u76ee\u5f55\u540d\u79f0\u5df2\u5b58\u5728\u3002")),!0):!1}).saveOrUpdateCategory(p.toJsonObject())}},G=function(y){var C=n.getCurrent();y=C.getUserObject();I(y)||(C.isVisited()?B(C):x(C,!1,function(){B(C)}))},B=function(y){var C=y.getUserObject(),w=y.getDirChildren();w&&0<w.length?J.getMessageCurtain().showPrompt(q.get("deleteCategoryFirst",
"\u8bf7\u5148\u5220\u9664\u76ee\u5f55\u4e0b\u7684\u5b50\u76ee\u5f55\u518d\u5220\u9664\u76ee\u5f55\u3002")):(w=y.getChildren())&&1<w.length?J.getMessageCurtain().showPrompt(q.get("deleteImageFirst","\u8bf7\u5148\u5220\u9664\u76ee\u5f55\u4e0b\u7684\u56fe\u7247\u518d\u5220\u9664\u76ee\u5f55\u3002")):(w=R.createFeedbackDialog(),w.setOptionType(R.OPTION_OK_CANCEL),w.setMsgImageType(R.MSG_DELETE),w.setMessage(q.get("confirmDeleteCategory","\u5220\u9664\u76ee\u5f55\u201c#1\u201d\u540e\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u786e\u5b9a\u5220\u9664\u8be5\u76ee\u5f55\u5417\uff1f").replace("#1",
C.getName())),w.setClosingChecker(function(p){p===R.RETURN_OK&&m(y);return!0}),w.showDialog())},m=function(y){u(y)?J.getMessageCurtain().showPrompt(q.get("deleteLastCategory","\u81f3\u5c11\u9700\u8981\u4fdd\u7559\u4e00\u4e2a\u7528\u6237\u76ee\u5f55\u3002")):J.createFacade(function(C){C&&(J.getMessageCurtain().showSuccess(q.get("deleteCategory","\u5220\u9664\u76ee\u5f55")+q.get("success","\u6210\u529f")+q.get("fullPoint","\u3002")),n.deleteByModel(y))},function(C,w){return 1100009===C?(J.getMessageCurtain().showPrompt(q.get("deleteImageFirst",
"\u8bf7\u5148\u5220\u9664\u76ee\u5f55\u4e0b\u7684\u56fe\u7247\u518d\u5220\u9664\u76ee\u5f55\u3002")),!0):!1}).deleteCategory(y.getId(),y.getName(),y.getUserObject().isPublic())},u=function(y){var C=n.getModels();if(y.getUserObject().isPublic()){y=[];for(var w=0;w<C.length;w++){var p=C[w].getUserObject();p.isPreset()||y.push(p)}if(2>=y.length)return!0}else if(2>=C.length)return!0;return!1},I=function(y){return y&&y.getId()?!1:(J.getMessageCurtain().showError(q.get("groupModelIsNull","\u5f53\u524d\u5206\u7ec4\u4e0d\u5b58\u5728\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5\u3002")),
!0)},X=function(y){var C=/^[\s\u3000\u4E00-\u9FA5a-zA-Z0-9_]{1,}$/;if(y.length>ea.GROUP_NAME_MAX_LENGTH)return J.getMessageCurtain().showPrompt(q.get("nameExceeded","\u540d\u79f0\u4e0d\u80fd\u8d85\u8fc7#1\u4e2a\u5b57\u7b26\u3002").replace("#1",ea.GROUP_NAME_MAX_LENGTH)),!1;if(y){if(0<y.indexOf(" "))return J.getMessageCurtain().showPrompt(q.get("nameWithSpace","\u540d\u79f0\u4e0d\u80fd\u643a\u5e26\u7a7a\u683c\u3002")),!1;if(!y.match(C))return J.getMessageCurtain().showPrompt(q.get("groupNameRule",
"\u540d\u79f0\u53ea\u80fd\u4f7f\u7528\u4e2d\u6587\u3001\u6570\u5b57\u3001\u5b57\u6bcd\u6216\u4e0b\u5212\u7ebf\u3002")),!1}else return!1;return!0},Y=function(y,C,w,p,v){C=C.getText().trim();y&&C?w(C,p,v):p()}}function wa(){M.call(this);var z=this,n=z.protectedMethod,E,A,x,k,g,b;this.setFunGetDynamicWidth=function(a){E=a};this.setFunCategoriesProvider=function(a){A=a};this.setSelectCategory=function(a){x=a};this.setDeleteCategory=function(a){k=a};this.setRefreshSearchPanel=function(a){g=a};this.selectedUIFeedback=
function(a){a.addClass("image-lib-image-card-selected");(function(c){var r=0;b&&clearInterval(b);var h=function(){c.addClass("manage-card-twinkle");r++;2===r&&clearInterval(b);setTimeout(function(){c.removeClass("manage-card-twinkle")},200)};b=setInterval(function(){h()},500)})(a)};this.updateWidth=function(){var a=n.getCardList();a&&a.css({width:E()+"px"})};this.loadModels=function(a,c,r){var h=a.getUserObject();J.createFacade(function(e){for(var f=[],l,t=0;t<e.length;t++){l=new pa;var G=new ta;
G.fromJsonObject(e[t]);l.setUserObject(G);l.setParent(a);f.push(l)}h.isPublic()&&(!h.isPublic()||h.isPreset()||!J.hasPublicPermission())||h.isGallery()||(l=new pa,l.setUserObject(new ma),l.setParent(a),f.splice(0,0,l));a.setChildren(f);a.setVisited(!0);c&&(n.setModels(f),c&&z.updateUi(n.getCurrentType()),g&&g());r&&r();h.isGallery()&&0==a.getChildren().length&&0==a.getDirChildren().length&&k&&k(a)},function(){return!1}).getAllImageOfCategory(a.getId(),h.isPreset())};this.createNoDataUi=function(){var a=
$("<div>");a.addClass("image-lib-manage-list-no-data");var c=$("<div>");U().background(c,"no-data");c.css({height:"220px",marginTop:"210px",backgroundSize:"contain",backgroundPosition:"center"});var r=$("<div>");r.css({marginTop:"21px",fontSize:"16px"});var h=q.get("noImagesExist","\u6682\u65e0\u56fe\u7247");r.text(h);a.append(c);a.append(r);return a};this.addCard=function(a){var c=a.getUserObject(),r=n.getCardList();if(c instanceof ta){a=new W(c,!1,a.getParent());a.init();a.setFunPreview(z.previewImage);
a.setFunDuplicateNameChecker(function(e){return n.isNameDuplicate(e)});a.setCategoriesProvider(A);a.setFunCardOpCallBack(function(e,f){z.loadModels(e,f,function(){x(e)})});var h=a.getJqUi();h.on("click",function(e){e.stopPropagation();r.find(".image-lib-image-card-selected").removeClass("image-lib-image-card-selected");h.addClass("image-lib-image-card-selected")});h.appendTo(r)}else c instanceof ma&&(a=new sa(c,a.getParent()),a.init(),a.setFunCardListUpdateUi(z.setModelAndUpdateUi),a.getJqUi().appendTo(r))}}
function sa(z,n){na.call(this);var E=this.protectedMethod,A=this,x;this.setFunCardListUpdateUi=function(a){x=a};this.init=function(){A.setClickable(!0);A.setFooterHeight(0);E.init();var a=$("<div>");a.css("position","relative");a.width(A.getContentWidth());a.height(A.getContentHeight());var c=$("<div>");c.addClass("upload-card-icon");ca.layoutCtrlWithLRTB(c,0,0,null,50,null);c.appendTo(a);c=$("<div>");c.addClass("upload-card-title");c.text(q.get("uploadImage","\u4e0a\u4f20\u56fe\u7247"));c.attr("title",
q.get("uploadImage","\u4e0a\u4f20\u56fe\u7247"));c.css({overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"});ca.layoutCtrlWithLRTB(c,0,0,null,140,null);c.appendTo(a);c=$("<div>");c.addClass("upload-card-prompt");ca.layoutCtrlWithLRTB(c,0,0,null,185,null);var r=va.getAllTypeWithSeparator(q.get("stopSign","\u3001")),h=q.get("uploadCardPrompt","\u56fe\u7247\u683c\u5f0f\u652f\u6301#1\uff0c\u6700\u5927\u4e0d\u8d85\u8fc7#2M\u3002");h=h.replace("#1",r);h=h.replace("#2",(20).toString());
c.text(h);c.appendTo(a);E.addCustomJq2Content(a)};this.doClick=function(a){a=A.getJqUi();var c=new ya;c.appendInvislbelUiTo(a.parent());c.selectFile(k,".jpg, .jpeg, .png, .bmp, .gif",function(r){return 0===r.indexOf("image/")})};var k=function(a){var c=a.getFile();c&&(a.isSizeLargeThan(20971520)?J.getMessageCurtain().showPrompt(q.get("imageOverSize","\u56fe\u7247\u5927\u5c0f\u4e0d\u80fd\u5927\u4e8e#1M\u3002").replace("#1",(20).toString())):a.isTypeMatched()?(a=a.getFileName(),50<a.substring(0,a.lastIndexOf(".")).length?
J.getMessageCurtain().showPrompt(q.get("imageNameToLong\u3002","\u56fe\u7247\u540d\u79f0\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26")):g(c,b)):J.getMessageCurtain().showPrompt(q.get("notImage","\u8be5\u6587\u4ef6\u7c7b\u578b\u4e0d\u662f\u56fe\u7247\u3002")))},g=function(a,c){var r=new D;r.setShowBlocking(!0);r.setText(q.get("uploadingImage","\u6b63\u5728\u4e0a\u4f20\u56fe\u7247"));r.setRequestPreparer(function(e){e.append("filename",a)});r.setFinishedHandler(function(e){e&&J.getMessageCurtain().showPrompt(q.get("failToUploadImg",
"\u4e0a\u4f20\u56fe\u7247\u5931\u8d25\u3002"))});r.setSuccessHandler(function(e){e=e.data;var f=a.name,l=new ta;l.setNameAndType(f);l.setCategoryId(n.getId());l.setFileName(e);c(l)});var h=aa.getUploadUrl();r.uploadTo(h)},b=function(a){var c=J.createFacade(function(h){var e=new pa,f=new ta;f.fromJsonObject(h);f.setHasContent(!0);e.setUserObject(f);e.setParent(n);n.addTo(e,1);J.getMessageCurtain().showSuccess(q.get("uploadImgSuccess","\u4e0a\u4f20\u56fe\u7247\u6210\u529f\u3002"));x(n)},function(h,
e){if(1100022===h)return J.getMessageCurtain().showError(q.get("nullImageType","\u65e0\u6cd5\u8bc6\u522b\u56fe\u7247\u7684\u7c7b\u578b\u3002")),!0;if(1100042===h)return J.getMessageCurtain().showPrompt(q.get("imageNameExist","\u56fe\u7247\u540d\u79f0\u5df2\u5b58\u5728\u3002")),!0;if(1100021===h)return h=new R,h.setOptionType(R.OPTION_OK),h.setButtonText(R.OPTION_OK,"\u786e\u5b9a"),h.setMessage(q.get("qingStorageFileSizeLimit","\u60a8\u7684\u8f7b\u5b58\u50a8\u7a7a\u95f4\u4e0d\u8db3\uff0c\u65e0\u6cd5\u5b8c\u6210\u8be5\u64cd\u4f5c\u3002")),
h.showDialog(),!0}),r=n.getUserObject().isPublic();c.saveImageInfo(a.toJsonObject(),r)}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.imagelib&&(com.kingdee.bos.qing.imagelib={});"undefined"==typeof com.kingdee.bos.qing.imagelib.ui&&(com.kingdee.bos.qing.imagelib.ui={});var xa=com.kingdee.bos.qing.imagelib.ui,
ca,qa,ya,O,R,S,q,d,D,aa,ia,K,da,V,ea,ta,ma,va,ba,pa,ua,na,P,Z,M,W,J,T,N;(function(){var z=com.kingdee.bos.qing;qa=z.Seer;z=com.kingdee.bos.qing.common;ca=z.DomUtil;z=com.kingdee.bos.qing.common.ui;ya=z.LocalFileSelector;z=com.kingdee.bos.qing.ui.component;O=z.MessageCurtain;R=z.MessageDialog;S=z.TextField;da=z.Menu;V=z.MenuModel;z=com.kingdee.bos.qing.framework.common;D=z.FileUploader;d=z.TabbedUiUtil;aa=z.RemoteFrameworkRegister;ia=z.MultilanguageManager;z=com.kingdee.bos.qing.imagelib.model;ta=
z.Image;ea=z.ImageCategory;ba=z.FolderNode;ma=z.UploadOpModel;pa=z.LeafNode;va=z.ImageLibModelUtil;z=com.kingdee.bos.qing.imagelib.common.ui;ua=z.AbstractManagePanel;na=z.AbstractCard;P=z.AbstractCategoryList;Z=z.AbstractCategoryContainer;M=z.AbstractCardContainer;W=z.ImageCard;z=com.kingdee.bos.qing.imagelib.common;q=ia.createPackageAccessor(z);J=z.ImageLibUtil;z=com.kingdee.bos.qing.imagelib.imexport.ui;T=z.UploadPane;N=z.ExportDialog})();xa.Main=function(z){var n;this.getJqUi=function(){var A=
n.getJqUi();if(!A)throw Error("Main is not start!");return A};this.start=function(){J.setAppId(qa.getUrlParamValue("appID"));var A=new O;A.getJqUi().appendTo($("body"));J.setMessageCurtain(A);J.checkPublicPermission(function(x){J.setHasPublicPermission(x);n=new ha;n.setSelectedImage(E());n.init();n.getJqUi().appendTo($(document.body))});A=com.kingdee.bos.qing.behavior.BehaviorManager;A.interestInBehaviorEntrance(A.ENTRANCE_IMAGELIB);window.addEventListener("storage",function(){var x=E();x&&n.setSelectedImage(x)})};
var E=function(){var A=sessionStorage.getItem("selectImage");if(!A)return null;sessionStorage.removeItem("selectImage");A=JSON.parse(A);var x=new ta;x.setId(A.id);x.setCategoryId(A.categoryId);return x}};oa.ITEM_HEIGHT=48})();
//qingVersionTag: 20250324