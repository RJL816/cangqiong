/* generated @ 2018-10-31 15:11:58 */
!(function(i){var a={};function s(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.m=i,s.c=a,s.i=function(e){return e},s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/imsdk/imcloud/",s(s.s=33)}([function(e,t,i){"use strict";t.a=function(e){var a=$.Deferred();return $.ajax({url:s.a.IMSDK_API_HOST+"/imsdk/auth.do",type:"post",crossDomain:!0,data:{eid:s.a.eid,data:s.a.key},dataType:"json",success:function(e){var t=e.success,i=e.data;t?(s.a.ticket=i,n({type:"get",url:"/imsdk/user/getPerson.do",success:function(e){e.success?(s.a.userInfo=e.data,a.resolve(e.data)):a.reject(e)}})):a.reject()},error:function(){a.reject()}}),a.promise()},t.b=n;var s=i(2);function n(e){return e.url=""+s.a.IMSDK_API_HOST+e.url+"?ticket="+s.a.ticket,e.crossDomain=!0,$.ajax(e)}},function(e,t,i){"use strict";var a={_debug:!0,_log:function(){!0===this._debug&&Array.prototype.unshift.call(arguments,"[SMQ]")},_handlers:{},_topics:function(e){return-1==e.indexOf(",")?[e]:e.replace(/\s/g,function(){return""}).split(",")},_topicExists:function(e){return!(!this._handlers.hasOwnProperty(e)||0==this._handlers[e].length)},_each:function(e,t){var i,a=e.length;for(i=0;i<a;i++)t(e[i],i)},pub:function(e,i){var a,s=this;this._log("Publish topics: ["+e+"], data: ",i),this._log("Handlers: ",this._handlers),this._each(this._topics(e),function(t){s._topicExists(t)?(a=s._handlers[t],s._each(a,function(e){e({topic:t,data:i})})):s._log("The topic *"+t+"* is not subscribed yet")})},sub:function(e,t){var i=this;this._log("Subscribe topics: "+e),this._each(this._topics(e),function(e){i._handlers.hasOwnProperty(e)?i._handlers[e].push(t):i._handlers[e]=[t]}),this._log("Handlers: ",this._handlers)},unsub:function(e,i){var t=this,a=-1;this._log("Unsubscribe topics: "+e),this._each(this._topics(e),function(e){t._topicExists(e)?(t._each(t._handlers[e],function(e,t){e==i&&(a=t)}),-1!==a&&(t._handlers[e].splice(a,1),t._log("Handler found and removed"))):t._log("The topic *"+e+"* doesnot exist, cannot unsubscribed")}),this._log("Handlers: ",this._handlers)},hasSub:function(e){return this._topicExists(e)}};t.a=a},function(e,t,i){"use strict";t.a={IMSDK_CSS_PATH:window.IMSDK_CSS_PATH,IMSDK_API_HOST:window.IMSDK_API_HOST||"https://www.yunzhijia.com",IMSDK_RESOURCE_HOST:window.IMSDK_RESOURCE_HOST||"https://static.yunzhijia.com",ticket:null,userInfo:null}},function(e,t,i){"use strict";t.a=function(e){var t=$(".im-errormsg-wrap");$(".im-errormsg-wrap").show().find(".im-errormsg-text").html(e),setTimeout(function(){t.hide()},2500)}},function(e,t,i){"use strict";i.d(t,"a",function(){return f});var a,l,c=i(2),s=i(0),n=i(3),r=i(1),o=i(29),d=i.n(o),u={},p=1;r.a.sub("init",function(){a=$(".im-chat-friend"),r.a.sub("panleChange",function(e){3==p&&f(),m(e)}),r.a.sub("changeParticipant",function(e){m(e)}),r.a.sub("newAddPerson",function(e){var t=e.data;for(var i in t)-1==l.ids.indexOf(i)&&(l.plist.push({id:t[i].id,username:t[i].name,avatar:t[i].photoUrl||"//yunzhijia.com/space/c/photo/load",status:t[i].status,isManager:!1}),l.ids.push(i));v()})});var m=function(e){var t,i=["id","username","avatar","status","dept","level"],a=[];if(e.data.participant){var s=JSON.parse(e.data.participant);if(s.length<=0)return!1;t=new Array(s[0].length),a=s[0];for(var n=0;n<t.length;n++){for(var r={},o=0;o<i.length;o++)r[i[o]]=s[o][n];r.isManager=-1<$.inArray(s[0][n],e.data.managerIds),t[n]=r}}else{t=new Array;var d=e.data;a.push(d.userId),t[0]={id:d.userId,username:d.groupName,avatar:d.headerUrl||"//static.yunzhijia.com/space/c/photo/load",isManager:!1}}t.unshift({id:c.a.userInfo.id,username:c.a.userInfo.name,avatar:c.a.userInfo.photoUrl,isManager:-1<$.inArray(c.a.userInfo.id,e.data.managerIds),status:0,dept:"",level:"",isSelf:!0}),l={groupId:e.data.groupId,type:e.data.type,userId:e.data.userId||"",groupName:e.data.groupName,isManager:-1<$.inArray(c.a.userInfo.id,e.data.managerIds),plist:t,ids:a},v(),p=3},f=function(){a.hide(),p=4},h=function(){f(),p=1,l={},a.find(".im-panel-wrap").remove(),p=5},g=function(){return d()(l)},v=function(){1==p||5==p?a.append(g()):a.html(g()),b()},b=function(){a.find(".im-add-item").on("click",function(e){T()}),a.find(".im-return-btn").on("click",function(e){$("#im-chat-container").find(".im-operate-btn:first").click()}),a.find(".im-close-btn").on("click",function(e){h()}),a.find(".group-name").on({focus:function(e){u.oldGroupName=l.groupName},blur:function(e){y(this)}}),l.isManager&&a.find(".exit-group").on("click",function(e){var t=$(this).parent(),i=t.data("ind");t.animate({opacity:0},600,"linear",function(){t.remove(),I(l.plist[i]),l.plist.splice(i,1)})})},y=function(t){var i=$.trim($(t).val());if(i){var e={groupId:l.groupId,name:i};s.b({type:"post",headers:{"Content-Type":"text/plain"},xhrFields:{withCredentials:!0},url:"/imsdk/group/updateName.do",data:JSON.stringify(e),dataType:"json",success:function(e){l.groupName=i,e&&e.success?(r.a.pub("changeGroupName",l.groupName),$(t).val(l.groupName)):n.a(e.error)}})}else $(t).val(u.oldGroupName),u.oldGroupName=""},I=function(t){var e={groupId:l.groupId,userIds:[t.id]};s.b({type:"post",headers:{"Content-Type":"text/plain"},xhrFields:{withCredentials:!0},url:"/imsdk/group/deleteUser.do",data:JSON.stringify(e),dataType:"json",success:function(e){e&&e.success?(r.a.pub("updateList",""),l.ids.splice(l.ids.indexOf(t.id),1)):n.a(e.error)}})},T=function(){var e=l.groupId,t={isAdd:!0,groupId:e,title:"添加用户"};if(e){if(1==l.type){var i=l.groupId.split("-"),a=i[0==i.indexOf(c.a.userInfo.id)?1:0];t.isAdd=!1,t.groupId="",t.userId=a}}else t.isAdd=!1,t.groupId="",t.userId=l.userId;r.a.pub("createOrAddGroup",t)}},function(e,t,i){"use strict";t.a=[{type:"default",content:[["呵呵","hehe.gif"],["嘻嘻","xixi.gif"],["哈哈","haha.gif"],["可爱","keai.gif"],["爱你","aini.gif"],["亲亲","qinqin.gif"],["太开心","taikaixin.gif"],["鼓掌","guzhang.gif"],["偷笑","touxiao.gif"],["做鬼脸","zuoguilian.gif"],["害羞","haixiu.gif"],["酷","ku.gif"],["花心","huaxin.gif"],["钱","qian.gif"],["奋斗","fendou.gif"],["吃惊","chijing.gif"],["馋嘴","chanzui.gif"],["懒得理你","landelini.gif"],["思考","sikao.gif"],["嘘","xu.gif"],["疑问","yiwen.gif"],["汗","han.gif"],["困","kun.gif"],["打哈气","dahaqi.gif"],["睡觉","shuijiao.gif"],["哼","heng.gif"],["闭嘴","bizui.gif"],["鄙视","bishi.gif"],["顶","ding.gif"],["委屈","weiqu.gif"],["挖鼻屎","wabishi.gif"],["生病","shengbing.gif"],["晕","yun.gif"],["吐","tu.gif"],["失望","shiwang.gif"],["可怜","kelian.gif"],["泪","lei.gif"],["衰","shuai.gif"],["骷颅头","kulutou.gif"],["抓狂","zhuakuang.gif"],["怒骂","numa.gif"],["怒","nu.gif"],["左哼哼","zuohengheng.gif"],["右哼哼","youhengheng.gif"],["赞","zan.gif"],["弱","ruo.gif"],["来","lai.gif"],["ok","ok.gif"],["不要","buyao.gif"],["耶","ye.gif"],["握手","woshou.gif"],["爱你哟","ainiyo.gif"],["差劲","chajin.gif"],["抱拳","baoquan.gif"],["拳头","quantou.gif"],["玫瑰","rose.gif"],["凋谢","diaoxie.gif"],["心","xin.gif"],["伤心","shangxin.gif"],["钟","zhong.gif"],["太阳","taiyang.gif"],["月亮","yueliang.gif"],["蛋糕","dangao.gif"],["礼物","liwu.gif"],["干杯","ganbei.gif"],["咖啡","kafei.gif"],["猪头","zhutou.gif"],["话筒","huatong.gif"],["蜡烛","lazhu.gif"],["闪电","shandian.gif"],["拥抱","yongbao.gif"],["吃饭","chifan.gif"],["足球","zuqiu.gif"],["雨伞","yusan.gif"],["棒棒糖","bangbangtang.gif"],["气球","qiqiu.gif"],["沙发","shafa.gif"],["飞机","feiji.gif"]]},{type:"xl",content:[["53faa7b224ac5a01da0304e9","xiaoluo_baosanwei.gif","报三围"],["53faa7b224ac5a01da0304ed","xiaoluo_hi.gif","打招呼"],["53faa7b224ac5a01da0304e5","xiaoluo_fazhaopian.gif","发图片"],["53faa7b224ac5a01da0304eb","xiaoluo_huanying.gif","欢迎"],["53faa7b224ac5a01da0304f1","xiaoluo_laladui.gif","加油"],["53faaa9624ac5a01da030fcc","xiaoluo_sahua.gif","开心"],["53faaa9624ac5a01da030fc8","xiaoluo_paomeiyan.gif","你好棒"],["53faaa9624ac5a01da030fc4","xiaoluo_niupigu.gif","扭屁股"],["53faaa9624ac5a01da030fc6","xiaoluo_paishou.gif","拍手"],["53faaa9624ac5a01da030fc2","xiaoluo_maimeng.gif","期待"],["53faa7b224ac5a01da0304e7","xiaoluo_fangbianpao.gif","庆祝"],["53faaa9624ac5a01da030fca","xiaoluo_woshou.gif","握手"],["53faaa9624ac5a01da030fce","xiaoluo_se.gif","羡慕"],["53faaa9724ac5a01da030fd0","xiaoluo_xianhua.gif","献花"],["53faa7b224ac5a01da0304ef","xiaoluo_feiwen.gif","谢谢"],["53faa7b224ac5a01da0304e3","xiaoluo_baobao.gif","求抱抱"]]},{type:"xiaoyun",content:[["577f5d71e4b0ae780b8825d2","xiaoyun_hello.gif","hello"],["577f5c7ee4b0ae780b86ed4f","xiaoyun_good.gif","good"],["577f5e0fe4b0ae780b88f073","xiaoyun_ok.gif","ok"],["577f5e0fe4b0cabd1edc14e8","xiaoyun_yeah.gif","yeah"],["577f5c7ee4b0ae780b86ed77","xiaoyun_daxiao.gif","大笑"],["577f5e0fe4b0cabd1edc1492","xiaoyun_ku.gif","哭"],["577f5c7fe4b0ae780b86ed8b","xiaoyun_baibai.gif","拜拜"],["577f5c7fe4b0cabd1eda03c8","xiaoyun_baituo.gif","拜托"],["577f5c7fe4b0cabd1eda0392","xiaoyun_buhaoyisi.gif","不好意思"],["577f5c7ee4b0cabd1eda0364","xiaoyun_fahongbao.gif","发红包"],["577f5d71e4b0ae780b882501","xiaoyun_haixiu.gif","害羞"],["577f5d71e4b0cabd1edb348b","xiaoyun_haoqi.gif","好奇"],["577f5d71e4b0cabd1edb3479","xiaoyun_hezuoyukuai.gif","合作愉快"],["577f5d71e4b0ae780b882531","xiaoyun_jiayou.gif","加油"],["577f5d71e4b0ae780b8825e8","xiaoyun_jingxia.gif","惊吓"],["577f5e0fe4b0ae780b88f08e","xiaoyun_qingduozhijiao.gif","请多指教"]]},{type:"yuki",content:[["55b5ab9824acee5607dc8c5d","yuki_dazhaohu.png","打招呼"],["55b5abb524acee5607dc9460","yuki_jingxia1.png","惊吓"],["55b5ab9824acee5607dc8c57","yuki_duibuqi.png","对不起"],["55b5abb524acee5607dc9474","yuki_shengqi.png","生气"],["55b5ab9824acee5607dc8c51","yuki_bukaixin.png","不开心"],["55b5ab9824acee5607dc8c63","yuki_daku.png","大哭"],["55b5ab9924acee5607dc8ca5","yuki_haobang.png","好棒"],["55b5abb524acee5607dc946a","yuki_wuyu1.png","无语"],["55b5ab9824acee5607dc8c4b","yuki_baituoma.png","拜托嘛"],["55b5abb524acee5607dc94c1","yuki_xiuse.png","羞涩"],["55b5abb524acee5607dc9456","yuki_memeda.png","么么哒"],["55b5ab9824acee5607dc8c69","yuki_daxiao.png","大笑"],["55b5abb524acee5607dc94d7","yuki_yihuo.png","疑惑"],["55b5ab9924acee5607dc8cab","yuki_fankun.png","犯困"],["55b5abb524acee5607dc9488","yuki_qingzhu.png","庆祝"],["55b5abb524acee5607dc945e","yuki_haochi.png","好吃"]]}]},,function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(2),s=i(8),n=(i.n(s),i(9)),r=i(31);i.n(r);jQuery.support.cors=!0;var o=a.a.IMSDK_CSS_PATH;void 0===o&&(o="./yzj-web/skin/ierp/imcloud.css"),o&&$("head").append('<link rel="stylesheet" href="'+o+'"/>'),window.imCloud=window.ImCloud=n.a},function(e,t){Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var i=this.length>>>0;for((t=(t=Number(t)||0)<0?Math.ceil(t):Math.floor(t))<0&&(t+=i);t<i;t++)if(t in this&&this[t]===e)return t;return-1})},function(e,t,i){"use strict";var a=i(2),s=i(0),n=i(12),r=i(13),o=i(14),d=(i(15),i(4),i(22),i(1)),l=i(11),c=i(10),u=i(27),p=i.n(u),m=function(e){e&&e.eid&&e.data&&"string"==typeof e.eid&&"string"==typeof e.data&&(a.a.key=e.data,a.a.eid=e.eid);var t=document.createElement("div");t.className="im-wrap",document.body.appendChild(t),s.a().then(function(){var e,t;e=$(".im-wrap"),t=$('<div class="im-tray"><div class="im-logo im-icon"></div><span class="im-logo-text">云之家</span><i class="im-totle-unread" style="display:none;"></i></div>').appendTo(e),$('<div class="im-errormsg-wrap"><p class="im-errormsg-text">错误信息</p></div>').appendTo(e),t.on("click",function(){n.a.toggleClass("im-listAppear"),$(".im-chat-container").is(":visible")&&(o.a.hide(),d.a.pub("closeChat","")),$(".ot-layer").is(":visible")&&r.a()}),e.append(p()()),d.a.pub("init")})};function f(){$("#im-session-left").hasClass("im-listAppear")||$(".im-tray").click()}m.prototype.share=l.a,m.prototype.openChat=c.a,m.prototype.show=f,m.prototype.refreshSessionList=function(){n.b()},d.a.sub("show",f),t.a=m},function(e,t,i){"use strict";var a=i(0),r=i(1);t.a=function(e){if(e.groupId||!e.oid){var t=$("#"+e.groupId);0!=t.length&&(r.a.pub("show"),t.click())}else a.b({url:"/imsdk/user/getPersonIdByOid.do",dataType:"json",type:"POST",data:{oid:e.oid},success:function(e){var t=e.success,i=e.data;if(t){var a=i.personId,s=i.photoUrl,n=i.name;r.a.pub("show"),r.a.pub("panleChange",{groupId:"",userId:a,type:1,groupName:n,managerIds:[],updateFlag:"",isExist:!0,headerUrl:s,waterMark:!1,onlyManagerAdd:!1}),r.a.pub("switchHistoryGroup",a)}}})}},function(e,t,i){"use strict";var o=i(0),a=i(19),d=i(1);t.a=function(s){var n=new a.a,r=this;n.afterSlelect=function(e){var i=$.Deferred(),t=e.userIds||[],a=e.groupIds||[];if(0<a.length||0==a.length&&1==t.length)i.resolve({groupId:a,userId:t});else{if(0==t.length)return;o.b({type:"post",headers:{"Content-Type":"text/plain"},xhrFields:{withCredentials:!0},url:"/imsdk/group/create.do",data:JSON.stringify({userIds:t,groupName:""}),dataType:"json"}).then(function(t){t.success&&(d.a.pub("updateList"),setTimeout(function(){var e=$("#"+t.data.groupId);0!=e.length&&($("#im-session-left").hasClass("im-listAppear")||$(".im-tray").click(),e.click())},800),i.resolve({groupId:[t.data.groupId],userId:[]}))})}i.then(function(t){var e=$.extend({unreadMonitor:1,openNewPage:s.openNewPage||!1,appName:"分享到云之家",content:s.content||"外部分享",title:s.title||"外部分享",thumbUrl:s.thumbUrl||"https://static.yunzhijia.com/microblog/filesvr/5699eb83e4b00fb2b9b448a3",webpageUrl:s.webpageUrl},s.param),i=JSON.stringify({content:s.title||"外部分享",msgLen:s.title&&s.title.length||0,msgType:7,param:e,groupId:t.groupId,userId:t.userId});o.b({type:"post",headers:{"Content-Type":"text/plain"},url:"/imsdk/message/multiSend.do",data:i,dataType:"json",success:function(e){e&&e.success?(n.$root.remove(),n.callback(t)):r.$error.html("操作失败"+(e?"，"+e.error:"")).show()}})})},n.show(s)}},function(e,t,i){"use strict";i.d(t,"a",function(){return b}),t.b=function(){x(m)};var s,d,l,n,r,a=i(2),o=i(0),c=i(1);c.a.sub("init",function(){(function(e){var t=document.createElement("div");t.className="im-session-left",t.id="im-session-left";var i='<div class="im-sidebar-title"><div class="im-chat-avatar"><img src="'+e.photoUrl+'"/></div><div class="im-chat-name">'+e.name+'</div><div class="im-join-item"><a href="javascript:;" title="发起群聊" class="im-create-session im-icon">发起群聊</a></div></div><div class="im-sidebar-search"><input class="im-input" placeholder="搜索同事" /></div><div class="im-sidebar-search-result" data-count="0"></div><div class="im-sidebar-main im-clearfix"><ul class="im-session-list"></ul></div>';t.innerHTML=i,$(".im-wrap").append(t),b=$(t),l=b.find(".im-session-list")})(a.a.userInfo),s=$(".im-sidebar-search .im-input"),d=$(".im-sidebar-search-result"),l.on("click",".im-session-item",function(e){if(e.currentTarget.id!=h.groupId){var t=g[e.currentTarget.id];c.a.pub("panleChange",t),$("#"+h.groupId).removeClass("session-item-hover"),$(e.currentTarget).addClass("session-item-hover").find(".session-item-unread").hide(),h=t}}),b.find(".im-create-session").click(function(){c.a.pub("createOrAddGroup",{isAdd:!1,title:"发起群聊"})}),d.on("click",".tree-leaf",function(e){var t=$(this).data("userid"),i=$(this).data("name"),a=$(this).data("photourl");c.a.pub("panleChange",{groupId:"",userId:t,type:1,groupName:i,managerIds:[],updateFlag:"",isExist:!0,headerUrl:a,waterMark:!1,onlyManagerAdd:!1}),c.a.pub("switchHistoryGroup",t)}),s.on("input paste",function(){var e=$(this).val().trim();""!==e?E(e,0,!0):d.html("").hide()}),_({more:!0,offset:0,count:50}),c.a.sub("switchHistoryGroup",function(e){!function(e){var t=e,i="";if(g[t])i=t;else for(var a in g){var s=g[a];if(1==s.type&&s.participantIds[0]==t){i=s.groupId;break}}i&&l.find("#"+i).click()}(e.data)}),c.a.sub("switchNewGroup",function(e){n=e.data}),c.a.sub("updateList",function(){_(m)}),c.a.sub("closeChat",function(){$("#"+h.groupId).removeClass("session-item-hover"),h={}})});var u=!1,p=0,m="",f="",h={},g={},v=0,b=null,y=5e3;function I(e){var t={};t.direction=e.direction,t.groupId=e.groupId,t.type=e.type,t.mention=e.mention,t.groupName=k(e.groupName)||"",t.lastMsgContent=k(e.lastMsgContent),t.lastMsgSendTime=e.lastMsgSendTime,t.lastMsgId=e.lastMsgId,t.unreadCount=e.unreadCount,t.participant=JSON.stringify(e.participant),t.participants=e.participant[1],t.participantIds=e.participant[0],t.fromUserId=e.fromUserId,t.lastMsgType=e.lastMsgType,t.managerIds=e.managerIds,t.updateFlag=e.updateFlag,t.isExist=e.isExist,t.headerUrl=e.headerUrl;var i=e.status.toString(2);return t.waterMark=!(i.length<6||"0"==i.substr(i.length-6,1)),t.onlyManagerAdd=!(i.length<7||"0"==i.substr(i.length-7,1)),g[t.groupId]?v+=t.unreadCount-g[t.groupId].unreadCount:v+=t.unreadCount,0<v?$(".im-totle-unread").html(v).show():$(".im-totle-unread").hide(),t}function T(e){var t="";return e&&(t+='<li class="im-session-item" id="'+(g[e.groupId]=e).groupId+'"><div class="session-item-portrait"><img class="session-alone-portrait" src="'+e.headerUrl+'" /></div><div class="session-item-main"><p class="session-item-name"><span class="name-list im-ellipsis">'+e.groupName+'</span></p></div><i class="session-item-unread '+(e.unreadCount?"":"im-none")+'">'+(99<e.unreadCount?"99+":e.unreadCount)+"</i></li>"),t}function w(e,t){var i="";if(t)l.prepend(T(e)),n==e.groupId&&($("#"+n).click(),n=null);else{for(var a=0,s=e.length;a<s;a++)i+=T(I(e[a]));l.append(i)}}function _(s){var e;e=s&&s.more?JSON.stringify({offset:p,count:s.count}):JSON.stringify({lastUpdateTime:m}),o.b({type:"post",headers:{"Content-Type":"text/plain"},xhrFields:{withCredentials:!0},url:"/imsdk/group/list.do",data:e,dataType:"json",success:function(e){if(u){if(m=e.updateTime,e.list&&0<e.list.length){var t=S(e.list);0<t.length&&function(e){for(var t=0,i=e.length;t<i;t++){var a=I(e[t]);if(a){var s=g[a.groupId],n=$("#"+a.groupId);if(s&&n){if(s.headerUrl!=a.headerUrl&&(n.find(".session-alone-portrait")[0].src=a.headerUrl,h.groupId==a.groupId&&c.a.pub("changeHeaderUrl",a.headerUrl)),s.groupName!=a.groupName&&(n.find(".name-list").html(a.groupName),h.groupId==a.groupId&&c.a.pub("changeGroupName",a.groupName)),s.unreadCount!=a.unreadCount){var r=n.find(".session-item-unread");r.html(99<a.unreadCount?"99+":a.unreadCount),0<a.unreadCount&&a.groupId!=h.groupId?r.show():r.hide()}if(s.lastMsgSendTime!=a.lastMsgSendTime){var o=l.find(".im-session-item:first");o&&o.attr("id")!=a.groupId&&n.insertBefore(o)}h.groupId==a.groupId&&(s.waterMark!=a.waterMark&&c.a.pub("changeWaterMark",a.waterMark),s.onlyManagerAdd!=a.onlyManagerAdd&&c.a.pub("changeOnlyManagerAdd",a.onlyManagerAdd),s.isExist!=a.isExist&&c.a.pub("changeIsExist",a.isExist),s.participant==a.participant&&JSON.stringify(s.managerIds)==JSON.stringify(a.managerIds)||c.a.pub("changeParticipant",a),s.updateFlag!=a.updateFlag&&c.a.pub("newMsg",a.updateFlag)),g[a.groupId]=a}else w(a,!0)}}}(t)}f=setTimeout(function(){x(e.updateTime)},y)}if(e.more){if(e.list&&0<e.list.length){var i=S(e.list);0<i.length&&w(C(i,0)),p+=e.list.length}_({more:!0,offset:p,count:300})}if(!e.more&&s.more){if(m=e.updateTime,u=!0,e.list&&0<e.list.length){var a=S(e.list);0<a.length&&w(C(a,0)),p+=e.list.length}f=setTimeout(function(){x(e.updateTime)},y)}},error:function(){f=setTimeout(function(){x(m)},y)}})}function x(t){clearTimeout(f),o.b({type:"post",headers:{"Content-Type":"text/plain"},xhrFields:{withCredentials:!0},url:"/imsdk/group/needUpdate.do",data:JSON.stringify({updateTime:t}),dataType:"json",success:function(e){e.data&&e.data.flag?_(t):f=setTimeout(function(){x(t)},y)},error:function(){f=setTimeout(function(){x(t)},y)}})}function k(e){return void 0===e?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function S(e){for(var t=[],i=0,a=e.length;i<a;i++)e[i]&&(1!=e[i].type&&2!=e[i].type||!e[i].lastMsgSendTime||t.push(e[i]));return t}function C(e,t){for(var i=t||1,a=t?e.length-t:e.length;i<a;++i){for(var s=e[i],n=+new Date(s.lastMsgSendTime.replace("-","/")),r=t,o=i-1;r<=o;){var d=Math.floor((r+o)/2);n>+new Date(e[d].lastMsgSendTime.replace("-","/"))?o=d-1:r=d+1}for(var l=i-1;o+1<=l;--l)e[l+1]=e[l];e[o+1]=s}return e}function E(t,e,i){var a=$.Deferred();clearInterval(r),r=setTimeout(function(){o.b({url:"/imsdk/org/searchPersons.do",type:"post",headers:{"Content-Type":"text/plain"},data:JSON.stringify({word:t,begin:e||0,count:10}),dataType:"json",success:function(e){e.success&&(i&&d.data("count",0),s.val().trim()==t&&function(e,t){var i=d.data("count");if(0<t.list.length){for(var a="",s=t.list,n=s.length,r=0;r<n;r++)a+='<div class="tree-leaf" data-userid="'+s[r].id+'" data-name="'+s[r].name+'" data-photourl="'+s[r].photoUrl+'" data-status="'+s[r].status+'"><img src="'+(s[r].photoUrl||"http://kdweibo.com/space/c/photo/load?id=579b2169e4b0b35fa3e61aa6")+'"><span>'+s[r].name+"</span></div>";if(0==i?d.html(a):d.append(a),t.hasMore){var o=$('<div class="ot-next-page">查看更多</div>');d.append(o),o.on("click",function(){E(e,i+1+n),$(this).remove()})}d.show().data("count",i+n)}else 0==i&&d.show().html('<div class="search-none">找不到符合的结果，<br/>请换个关键词试试吧</div>')}(t,e.data),a.resolve("done"))}})},200)}},function(e,t,i){"use strict";t.a=I;var s,n,m,r,d,f=i(2),o=i(0),l=i(3),c=i(1),u=[],p={},h=null;function g(l,e,c,u,p){return u=u||1,(t=e,i=$.Deferred(),a=JSON.stringify({eid:f.a.eid,orgId:t,count:0,begin:0}),o.b({type:"post",headers:{"Content-Type":"text/plain"},xhrFields:{withCredentials:!0},url:"/imsdk/org/getPersons.do",data:a,dataType:"json",success:function(e){e&&e.success?i.resolve(e.data):i.reject("请求部门树失败")}}),i.promise()).then(function(e){var t=c||m;if(t.empty(),p&&p.data("loaded",!0),l){var i='<li data-loaded="1" data-level="0" id="'+e.id+'" class="tree-node tree-root"><span title="'+e.name+'" class="tree-node-name"><b class="tree-space"></b>'+e.name+"</span></li>",a=$(i+"");t.append(a)}if(e._level=u+1,t.append(function(e){for(var t=e.unallotPersonCount||0,i="",a=e._level,s=0,n=e.person.length;s<n;s++){var r=e.person[s];i+='<li class="tree-leaf" data-userid="'+r.id+'" data-status="'+r.status+'">',i+=new Array(a).join('<b class="tree-space"></b>'),i+='<img src="'+(r.photoUrl||"/space/c/photo/load")+'">',i+="<span>"+r.name+"</span>",i+="</li>"}for(var o=0,d=e.children.length;o<d;o++){var l=e.children[o];i+='<li data-level="'+(a||0)+'" id="'+l.id+'" class="tree-node">',i+='<span class="tree-node-name" title="'+l.name+'"><i class="tree-node-icon">&gt;</i>',i+=new Array(a+1).join('<b class="tree-space"></b>'),i+=l.name+"</span>",i+="</li>"}e.person.length||e.children.length||(i+='<li class="tree-empty">无数据</li>');0<t&&(i+='<li data-level="'+(a||0)+'" class="tree-node" data-unallot = "true"><span class="tree-node-name" title="未分配部门的成员"><i class="tree-node-icon">&gt;</i>',i+=new Array(a+1).join('<b class="tree-space"></b>'),i+="未分配部门的成员</span></li>");return i}(e)),0===e.children.length&&0<e.person.length){for(var s=$('<input type="checkbox" class="im-select-org-members" />'),n=[],r=e.person,o=0;o<r.length;++o){var d=r[o];n.push({id:d.id,photoUrl:d.photoUrl,name:d.name,status:d.status})}s.data("info",n),t.before(s).parent().find(".tree-node-icon").remove()}});var t,i,a}function v(t,e,i){var a=$.Deferred();clearInterval(h),h=setTimeout(function(){o.b({url:"/imsdk/org/searchPersons.do",type:"post",headers:{"Content-Type":"text/plain"},data:JSON.stringify({word:t,begin:e||0,count:10}),dataType:"json",success:function(e){e.success&&(i&&d.data("count",0),s.val().trim()==t&&function(e,t){var i=d.data("count");if(0<t.list.length){for(var a="",s=t.list,n=s.length,r=0;r<n;r++)a+='<div class="tree-leaf" data-userid="'+s[r].id+'" data-status="'+s[r].status+'"><img src="'+(s[r].photoUrl||"http://kdweibo.com/space/c/photo/load?id=579b2169e4b0b35fa3e61aa6")+'"><span>'+s[r].name+"</span></div>";if(0==i?d.html(a):d.append(a),t.hasMore){var o=$('<div class="ot-next-page">查看更多</div>');d.append(o),o.on("click",function(){v(e,i+1+n),$(this).remove()})}d.show().data("count",i+n)}else 0==i&&d.show().html('<div class="search-none">找不到符合的结果，<br/>请换个关键词试试吧</div>')}(t,e.data),a.resolve("done"))}})},200)}function b(e){var t=u;t.splice(t.indexOf(e),1),r.find("[data-id ="+e+"]").remove();var i=$(p[e].srcElement),a=i.parent().siblings(".im-select-org-members")[0];i.hasClass("selected")&&(i.removeClass("selected"),a&&a.checked&&(a.checked=!1))}function y(e){if(-1==u.indexOf(e.id)){u.push(e.id);var t='<li data-id="'+(p[e.id]=e).id+'"><img src="'+e.photoUrl+'" title="'+e.name+'" alt="'+e.name+'"><div class="ot-selected-name">'+e.name+'</div><span class="ot-del-person">-</span></li>';r.append(t)}}function I(){n.hide(),m.html(""),r.html(""),u=[],p={}}c.a.sub("init",function(){(function(){if($("#ot-layer").length)n=$("#ot-layer"),m=n.find(".ot-tree"),r=n.find(".ot-selected-list");else{var e=document.createElement("div");e.id="ot-layer",e.className="ot-layer",e.style.display="none",e.innerHTML='<div class="ot-shade"></div><div class="ot-window"><div class="ot-head"><span class="ot-head-title">发起聊天</span><span class="ot-head-close ot-close">×</span></div><div class="ot-main"><div class="left-panel"><div class="search-layer"><input placeholder="搜索同事" class="search-inp" /></div><div class="search-list" data-count="0"></div><ul class="ot-tree"></ul></div><div class="ot-selected-panle"><div class="ot-tip">已选人员<span class="ot-errormsg"></span></div><ul class="ot-selected-list"></ul><div class="ot-btn-bar"><a href="javascript:;" class="ot-cancle-btn ot-close">取消</a><a href="javascript:;" class="ot-sure-btn">确定</a></div></div></div></div></div>',$(".im-wrap").append(e),n=$("#ot-layer"),m=n.find(".ot-tree"),r=n.find(".ot-selected-list"),d=$(".search-list"),s=$(".search-layer > .search-inp"),n.find(".ot-close").click(function(){I()}),n.find(".ot-sure-btn").click(function(){!function(){if(0==u.length)return l.a("请选择人员");var e,t;if(n.data("isadd"))e="/imsdk/group/addUser.do",t=JSON.stringify({groupId:n.data("groupid"),userIds:u});else if(e="/imsdk/group/create.do",t=JSON.stringify({userIds:u,groupName:""}),n.data("userid")&&""==n.data("groupid"))u.push(n.data("userid")),t=JSON.stringify({userIds:u,groupName:""});else if(1==u.length){var i=p[u[0]];return c.a.pub("panleChange",{groupId:"",userId:i.id,type:1,groupName:i.name,managerIds:[],updateFlag:"",isExist:!0,headerUrl:i.photoUrl,waterMark:!1,onlyManagerAdd:!1}),c.a.pub("switchHistoryGroup",i.id),I()}o.b({type:"post",headers:{"Content-Type":"text/plain"},xhrFields:{withCredentials:!0},url:e,data:t,dataType:"json",success:function(e){if(e&&e.success){if(n.data("isadd")){var t=t,i={};for(var a in t)i[a]={name:t[a].name,photoUrl:t[a].photoUrl,id:t[a].id,status:t[a].status};c.a.pub("newAddPerson",i)}else c.a.pub("switchNewGroup",e.data.groupId);I(),c.a.pub("updateList","")}else l.a("创建群聊失败")}})}()}),n.on("click",".tree-leaf",function(e){e.stopPropagation(),function(e,t){var i=(e=$(e)).attr("data-userid"),a=e.parent().siblings(".im-select-org-members")[0];if(i!=f.a.userInfo.id)if(e.hasClass("selected"))e.removeClass("selected"),(a=e.parent().siblings(".im-select-org-members")[0])&&a.checked&&(a.checked=!1),b(i);else{var s=e.find("span").text(),n=e.find("img").attr("src"),r=e.data("status");if(t||y({name:s,photoUrl:n,id:i,status:r,srcElement:e[0]}),e.addClass("selected"),a&&!a.checked){var o=e.parent().find(".tree-leaf"),d=o.filter(".selected").length,l=o.length;d===l&&(a.checked=!0)}}}(e.currentTarget)}),m.on("click",".tree-node-name",function(e){e.stopPropagation(),function(e){var t=$(e).closest("li.tree-node"),i=t.data("loaded"),a="true"===t.attr("data-unallot")?"unallotPersons":t[0].id,s=t.find(" > .list-wrapper");if(!i){s.length||(s=$('<ul class="list-wrapper im-none"><li><div class="im-tree-loading"></div></li></ul>'),t.append(s));var n=t.data("level");g(!1,a,s,n,t)}s.length&&(s.hasClass("im-none")?(s.removeClass("im-none"),t.addClass("tree-node-expanded")):(s.addClass("im-none"),t.removeClass("tree-node-expanded")))}(e.currentTarget)}),m.on("click",".im-select-org-members",function(e){e.stopPropagation(),function(e){var t=(e=$(e)).data("info");if(t&&t.length){var i=e.prop("checked"),a=e.find(" ~ .list-wrapper > .tree-leaf"),s=0;if(i)for(a.addClass("selected"),s=t.length-1;0<=s;--s){var n=t[s],r=n.photoUrl,o=n.id,d=n.status,l=n.name;y({photoUrl:r,id:o,name:l,status:d,srcElement:a[s]})}else for(a.removeClass("selected");s<t.length;++s)b(o=t[s].id)}}(e.currentTarget)}),r.on("mouseenter","li",function(){$(this).find(".ot-del-person").show()}),r.on("mouseleave","li",function(){$(this).find(".ot-del-person").hide()}),r.on("click",".ot-del-person",function(e){b($(e.currentTarget.parentNode).data("id"))}),s.on("input paste",function(){var e=$(this).val().trim();""!==e?v(e,0,!0):d.html("").hide()})}})(),c.a.sub("createOrAddGroup",function(e){var t,i=e.data;t=i,n&&"none"==n.css("display")&&(s.val(""),d.empty().hide().data("count",0),n.data({isadd:t.isAdd||!1,groupid:t.groupId||"",userid:t.userId||""}),n.find(".ot-head-title").html(t.title||"发起聊天"),n.show(),g(!0,""))})})},function(e,t,i){"use strict";i.d(t,"a",function(){return n});var a=i(1),s=i(4);a.a.sub("init",function(){n=$("#im-chat-container"),n.find(".im-operate-btn").on("click",function(){var e=$(this).index();$(this).addClass("im-btn-checked").siblings().removeClass("im-btn-checked"),n.find(".im-chat-main-wrapper").children().hide().eq(e).show(),0==e&&s.a()}),n.find(".im-close-chat").on("click",function(){n.hide(),a.a.pub("closeChat","")}),a.a.sub("panleChange",function(e){a.a.pub("openMainPanel",e),function(e){if(!e)return;n.show(),n.data("groupid",e.groupId||""),n.data("userid",e.userId||""),n.find(".im-operate-btn:first").click(),n.find(".im-chat-avatar img").attr("src",e.headerUrl),n.find(".im-chat-name").html(e.groupName),e.isExist?(n.find(".im-message-sendbox").show(),n.find(".im-chat-pannel").css("height","243px")):(n.find(".im-message-sendbox").hide(),n.find(".im-chat-pannel").css("height","384px")),e.waterMark?n.find(".im-chat-pannel").addClass("waterMark"):n.find(".im-chat-pannel").removeClass("waterMark")}(e.data)}),a.a.sub("changeGroupName",function(e){n.find(".im-chat-name").html(e.data)}),a.a.sub("changeWaterMark",function(e){e.data?n.find(".im-chat-pannel").addClass("waterMark"):n.find(".im-chat-pannel").removeClass("waterMark")}),a.a.sub("changeIsExist",function(e){e.data?(n.find(".im-message-sendbox").show(),n.find(".im-chat-pannel").css("height","243px")):(n.find(".im-message-sendbox").hide(),n.find(".im-chat-pannel").css("height","384px"))})});var n=null},function(e,t,i){"use strict";var a,s=i(0),n=i(1),r=i(18),o=i(17);n.a.sub("init",function(){r.a.bindEvt(),n.a.sub("imgPreview",$.proxy(r.a,"initImgPreview")),$("body").on("click",".im-send-content-img",function(e){var t=$(this).attr("id"),i=$(this).closest(".msg").attr("data-msgid");a=setTimeout(function(){n.a.pub("imgPreview",{groupId:$(".im-chat-content").data("groupId"),id:t,fromMsgId:i}),clearTimeout(a),a=null},300)}),$("body").on("click",".im-app-share",function(e){var t=$(e.currentTarget),i=t.attr("appid"),a=t.attr("webpageurl");/clouhub/gi.test("url")||("undefined"!=i?s.b({method:"get",url:"/imsdk/app/getTicketInfo.do",xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json",data:{appId:i}}).always(function(e){if(e.success&&e.data){var t=e.data.url.split("?")[1].match(/ticket=([^&]+)/)[1];a+=/\?/.test(a)?"&ticket="+t:"?ticket="+t,window.open(a,"_blank")}else window.open(a,"_blank")}):window.open(a,"_blank"))}),o.a()})},function(e,t,i){"use strict";var l=i(2),a={fileTypeConfig:{jpg:"img",jpeg:"img",png:"img",gif:"img",bmp:"img",docx:"word",doc:"word",xlsx:"excel",xls:"excel",pptx:"point",ppt:"point",pptm:"point",pdf:"pdf",zip:"zip",rar:"zip",mp3:"music",wmv:"video",asf:"video",rm:"video",rmvb:"video",mov:"video",avi:"video",dat:"video",mpg:"video",mpeg:"video",mp4:"video",txt:"txt"},scrollIsBottom:function(){var e=$("#im-msg-list");return e.scrollTop()>=e[0].scrollHeight-e.height()-25},scrollBottom:function(){var e=document.getElementById("im-msg-list"),t=$(".im-chat-content").height(),i=e.scrollHeight-e.clientHeight;t>e.clientHeight&&(e.scrollTop=i)},htmlToString:function(e){for(var t,i=["&lt;","&gt;","&amp;","&quot;"],a=["<",">","&",'"'],s=i.length,n=0;n<s;n++)t=new RegExp(i[n],"g"),e=e.replace(t,a[n]);return e},htmlEntities:function(e){return void 0===e?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},buildWaterMark:function(){var e=document.createElement("canvas");try{for(var t=l.a.userInfo.name,i=10*Math.PI/180,a=0,s=0;s<t.length;s++)/[^\x00-\xFF]/.test(t[s])?a++:a+=.5;e.width=24*a+60+20,e.height=60+16*(a+3)*Math.sin(i)+40;var n=e.getContext("2d");n.fillStyle="#f5f5f5",n.font="12px/12px microsoft yahei",n.rotate(-i),n.translate(20,16*a*Math.sin(i)+16),n.fillText("云之家",0,0),n.translate(60,60),n.fillText(t,0,0);var r=e.toDataURL(),o=document.createElement("style");o.innerHTML=".waterMark{background-image:url("+r+")}",document.getElementsByTagName("head")[0].appendChild(o)}catch(d){console.error(d)}},fileSize:function(e){return isNaN(e)?"0":1024<=e&&e<1048576?(e/1024).toFixed(2).toString()+"K":1048576<=e?(e/1048576).toFixed(2).toString()+"M":e.toString()+"B"},matchFileType:function(e){var t=e.lastIndexOf("."),i=e.substring(t+1,e.length).toLowerCase(),a=this.fileTypeConfig;return a.hasOwnProperty(i)?a[i]:"default"},_parseDate:function(e){return e.substring(5,16)},SimpleTemplate:function(){this.parts=[],this._pushAll(arguments)}};a.SimpleTemplate.prototype={_:function(){return this._pushAll(arguments),this},toString:function(){return this.parts.join("")},_pushAll:function(e){var t,i=e.length;for(t=0;t<i;t++)this.parts.push(e[t])}},t.a=a},function(e,t,i){"use strict";t.a=function(){s.init()};var m=i(2),a=i(1),d=i(0),v=i(16),b=i(5),y="https://static.yunzhijia.com",r="",l={},c="/imsdk/message/list.do",f=m.a.IMSDK_API_HOST+"/imsdk/file/download.do?fileId=",s={init:function(){var t=this;v.a.buildWaterMark(),a.a.sub("openMainPanel",$.proxy(this,"openMainPanel")),a.a.sub("getChatList",$.proxy(this,"getChatList")),a.a.sub("upload-select",$.proxy(this,"uploadFileSelect")),a.a.sub("upload-progress",$.proxy(this,"uploadFileProcess")),a.a.sub("upload-success",$.proxy(this,"uploadFileSuccess")),a.a.sub("upload-failed",$.proxy(this,"uploadFileFail")),a.a.sub("newMsg",$.proxy(this,"newMsg")),a.a.sub("sendTxt",$.proxy(this,"getTxt")),t.msgTypeConfig={0:function(e){return t.msgTxt(e)},2:function(e){return t.msgTxt(e)},7:function(e){return t.msgShare(e)},8:function(e){return t.msgAttachment(e)}},t.smileyHashTable={},this.bindEvt()},initData:function(e){var t=JSON.parse(e),i={};l.usersNum=t[0].length;for(var a=0;a<t[0].length;a++)i[t[0][a]]={n:t[1][a],p:t[2][a]};return i},openMainPanel:function(e){var t=e.data.data;if(t.participant&&(r=this.initData(t.participant)),t){var i=t.groupId||"";$(".im-chat-content").data("groupId",i).data("fromUserId",t.fromUserId),l.groupId=i,l.groupType=t.type,l.lastMsgId=t.lastMsgId,""==i?$(".im-chat-content").html(""):this.getChatList({groupId:i,type:"new",count:10,lastMsgId:null,msgType:"OPEN"})}},getChatList:function(i){var a=this,s=i.groupId,n=i.type,e=i.count,t=i.lastMsgId,r=i.msgType;if(s){"ADD"!=r&&a.loading(r);var o=$.Deferred();return d.b({type:"POST",xhrFields:{withCredentials:!0},url:c,contentType:"text/plain",data:JSON.stringify({groupId:s,type:n,count:e,msgId:t}),dataType:"JSON",success:function(e){if(0<$("#get-chat-tips").length&&$("#get-chat-tips").remove(),s==l.groupId)if(e.success){if($("#im-msg-loading").remove(),"new"==n){var t=e.data.list.length;t&&(l.lastUpdate=e.data.list[t-1].sendTime,l.lastMsgId=e.data.list[t-1].msgId)}a.chatList(e.data.list,r,e.data.more).then(function(){o.resolve(e)})}else a.getChatAgainTpl(i),o.reject();else o.reject()},error:function(e){s==l.groupId&&(0<$("#get-chat-tips").length&&$("#get-chat-tips").remove(),a.getChatAgainTpl(i)),o.reject()}}),o.promise()}},chatList:function(t,i,e){var a=v.a.scrollIsBottom(),s=$.Deferred();return"MORE"==i?(this.scrollPos(t,i,e),s.resolve()):this.tpl(t,i,e).then(function(e){e&&(1===t.length&&t[0].uploading?$(".im-chat-content").append(v.a.htmlToString(e)):$(".im-chat-content").append(e),"ADD"==i?a&&v.a.scrollBottom():"OPEN"==i&&v.a.scrollBottom()),s.resolve()}),s.promise()},tpl:function(d,e,t){var l,c=new v.a.SimpleTemplate,u=this,p="",m="",f=$.Deferred(),h=0;return"ADD"!==e&&$("#im-msg-more").remove(),t&&c._('<div id="im-msg-more" class="im-msg-more"><a href="javascript:;">查看更多<i class="im-icon"></i></a></div>'),"OPEN"==e&&$(".im-chat-content").html(""),d.length&&function o(){l=d[h];u.fromUserInfo(l.fromUserId,l.msgType).then(function(e){if(0<$('div.im-msg[data-msgid="'+l.msgId+'"]').length&&""!=l.msgId)h<d.length-1?(h++,o()):f.resolve(c.toString());else{if(l.param&&l.param.emojiType?(p='style="background:none;border:none;"',m="im-none"):m=p="",9===l.msgType){if("withdrawMsg"==l.param.type){var t=$("[data-msgid="+l.param.withdrawMsgId+"]").closest(".im-chat-item ");t.length&&t.replaceWith('<div class="im-chat-item im-sys"><div class="im-msg" data-msgid="'+l.msgId+'">'+l.content+"</div></div>");var i=$("[data-frommsgid="+l.param.withdrawMsgId+"]");i.length&&i.hide()}}else if(0===l.msgType)c._('<div class="im-chat-item im-sys"><div class="im-msg" data-msgid="'+l.msgId+'">'+v.a.htmlEntities(l.content)+"</div></div>");else if(2===l.msgType||7===l.msgType||8===l.msgType){var a=e.isMe||1==l.direction?"im-me":"",s="";if(8===l.msgType||2===l.msgType&&l.isUploadFile){var n=l.param||{ext:"",name:""};s="im-file-wrap",-1<"JPG|JPEG|PNG|GIF|BMP|".indexOf(n.name.substring(n.name.lastIndexOf(".")+1).toUpperCase()+"|")&&""!=n.ext&&n&&(s="im-img-wrap-content")}c._('<div class="im-chat-item '+a+'">')._('<div class="im-chat-item-content">')._('<div class="im-itme-img"><img class="im-avatar" src="'+(e.photo||"https://static.yunzhijia.com/space/c/photo/load")+'" title="'+e.name+'" data-fid="'+l.fromUserId+'" /></div>')._('<div class="im-msg" data-msgid="'+l.msgId+'">')._('<div class="im-msg-wrap">')._('<div class="im-send-info">')._('<span class="im-send-user">'+(e.name||"")+'</span><span class="im-send-time">'+v.a._parseDate(l.sendTime)+"</span>")._("</div>")._('<div class="im-send-body im-left '+s+'" '+p+" data-isme="+(l.direction||e.isMe)+'" data-fid="'+l.fromUserId+'" data-msgtype="'+(l.uploading?8:l.msgType)+'" data-sendtime="'+l.sendTime+'" data-msgid="'+l.msgId+'">')._('<div class="im-send-content">')._("<pre>"+(l.fileLoading?v.a.htmlToString(u.msgDetail(l.msgType,{msgId:l.msgId,content:l.content,fromUserId:l.fromUserId,param:l.param})):u.msgDetail(l.msgType,{msgId:l.msgId,content:l.content,fromUserId:l.fromUserId,param:l.param}))+"</pre>")._("</div>")._("</div>")._('<div class="im-arrow im-icon '+m+'"></div>')._("</div>")._("</div>")._("</div>")._("</div>")}else{var r=e.isMe||1==l.direction?"im-me":"";c._('<div class="im-chat-item '+r+'">')._('<div class="im-chat-item-content">')._('<div class="im-itme-img"><img class="im-avatar" src="'+(e.photo||"https://static.yunzhijia.com/space/c/photo/load")+'" title="'+e.name+'" data-fid="'+l.fromUserId+'" /></div>')._('<div class="im-msg" data-msgid="'+l.msgId+'">')._('<div class="im-msg-wrap">')._('<div class="im-send-info">')._('<span class="im-send-user">'+(e.name||"")+'</span><span class="im-send-time">'+v.a._parseDate(l.sendTime)+"</span>")._("</div>")._('<div class="im-send-body im-left " '+p+" data-isme="+(l.direction||e.isMe)+'" data-fid="'+l.fromUserId+'" data-msgtype="'+(l.uploading?8:l.msgType)+'" data-sendtime="'+l.sendTime+'" data-msgid="'+l.msgId+'">')._('<div class="im-send-content">')._("<pre>【"+l.content+"】\n暂不支持此类消息，请到云之家上查看</pre>")._("</div>")._("</div>")._('<div class="im-arrow im-icon '+m+'"></div>')._("</div>")._("</div>")._("</div>")._("</div>")}h<d.length-1?(h++,o()):f.resolve(c.toString())}})}(),0==d.length&&f.resolve(),f},fromUserInfo:function(e,t){var i=r,a=m.a.userInfo.id,s={},n=$.Deferred();return 0==t?n.resolve("system"):(s=e==a?{name:m.a.userInfo.name,photo:m.a.userInfo.photoUrl,isMe:!0}:{name:i[e]?i[e].n:"",photo:i[e]?i[e].p:"//static.yunzhijia.com/space/c/photo/load",isMe:!1},n.resolve(s)),n},msgDetail:function(e,t){if(t.msgType=t.msgType||e,this.msgTypeConfig[e])return this.msgTypeConfig[e](t)},msgTxt:function(e){var t=e.content,r=this;return t=(t=(t=v.a.htmlEntities(t)).replace(/(http|https|ftp)\:\/\/[\.\-\_\/a-zA-Z0-9\~\?\%\#\=\@\:\&\;\*\+\!\(\)\{\}]+\b[\?\#\/\*\=]*/g,'<a target="_blank" href=" $& ">$&</a>')).replace(/\[([^\[\]]+)\]/g,function(e,t){var i=b.a[0].content;if(r.smileyHashTable[t])return r.smileyHashTable[t];for(var a=0,s=i.length;a<s;a++){var n=i[a];if(t===n[0])return r.smileyHashTable[t]='<img src="https://static.yunzhijia.com/dores/images/smiley/'+n[1]+'" title="'+n[0].replace("xl:","")+'" alt="['+n[0]+']" class="im-default-emoji"/>'}return e})},msgShare:function(e){var t="",i=e.param;if(i&&i.webpageUrl){var a=i?i.title||e.content:e.content||"",s=i?i.content:"",n=i?i.thumbUrl:"",r=i?i.webpageUrl:"";return t+='<div class="im-app-share" appid="'+(i?i.lightAppId||i.appId:"")+'" webpageUrl="'+r+'" openNewPage="'+(i&&i.openNewPage||!1)+'">',t+='<h5 class="im-app-share-title">'+a+"</h5>",t+='<div class="im-app-share-msg clearfix">',t+='<img class="im-app-share-img" src="'+n+'">',t+='<p class="im-app-share-content">',t+='<span class="im-app-share-content-inner">'+s+"</span>",t+="</p>",t+="</div>",(t+="</div>")+""}},msgAttachment:function(e){var t=e.param||{ext:"",name:""},i=this,a="";if(t.emojiType){var s=b.a[1].content,n=b.a[2].content,r=b.a[3].content,o=t.file_id;if(i.smileyHashTable[o])return i.smileyHashTable[o];for(var d=0,l=s.length;d<l;d++){var c=s[d];if(o===c[0])return i.smileyHashTable[o]='<div class="im-emoji-wrap"><img src="'+y+"/dores/images/smiley/"+c[1]+'" title="'+e.content+' "alt="'+e.content+'" /></div>'}for(var u=0,p=r.length;u<p;u++){var m=r[u];if(o===m[0])return i.smileyHashTable[o]='<div class="im-emoji-wrap"><img src="'+y+"/dores/images/smiley/"+m[1]+'" title="'+e.content+' "alt="'+e.content+'" /></div>'}for(var f=0,h=n.length;f<h;f++){var g=n[f];if(o===g[0])return i.smileyHashTable[o]='<div class="im-emoji-wrap"><img src="'+y+"/dores/images/smiley/"+g[1]+'" title="'+e.content+' "alt="'+e.content+'" /></div>'}return i.smileyHashTable[o]='<div class="im-emoji-wrap"><img src="'+y+"/microblog/filesvr/"+o+'?thumbnail" id="'+o+'" /></div>'}return t.ext&&"png"==t.ext.toLowerCase()&&(a='style="background:#fff;"'),-1<"JPG|JPEG|PNG|GIF|BMP|".indexOf(t.name.substring(t.name.lastIndexOf(".")+1).toUpperCase()+"|")&&""!=t.ext&&t?'<div class="im-img-wrap"><img src="'+y+"/microblog/filesvr/"+t.file_id+'?thumbnail" id="'+t.file_id+'"  class="im-send-content-img" '+a+" /></div>":this.fileTpl(t.file_id,v.a.matchFileType(t.name),t.name,v.a.fileSize(t.size),!1)},fileTpl:function(e,t,i,a,s,n,r){var o=new v.a.SimpleTemplate,d="",l=f+e+"&ticket="+m.a.ticket,c='<a href="'+l+'" class="im-file-handle im-msg-file-dl" title="下载">下载</a>',u=v.a.htmlEntities(i),p="";return"",'data-preview="false"',c='<a href="'+l+'" class="im-file-handle im-msg-file-dl" title="下载">下载</a>',s&&(p=" no-cursor",d='data-uploaderId="'+n+'"',l='javascript:;"',c='<div class="im-file-loading"><div class="im-loading-ing" style="width:'+(r&&r.data&&r.data.comp?r.data.comp:0)+'px;"></div></div><a href="javascript:;" class="im-file-ing-close'+(r&&r.cancel?' cancel">已取消':'">取消')+"</a>"),o._('<div class="im-file-mod'+p+'" id="'+e+'" '+d+' data-preview="false">')._('<a href="'+l+'" class="im-file-img  im-icon-'+t+'" title="点击下载"></a>')._('<div class="im-file-r">')._('<a href="'+l+'" class="im-file-name  im-ellipsis" title="点击下载">'+u+"</a>")._('<span class="im-file-size">'+a+"</span>"),o._(c),o._("</div>")._("</div>"),o.toString()},getTxt:function(e){0<$("div.msg[data-msgid="+e.data.msgId+"]").length||(e.data.msgType=2,this.chatList([e.data],"ADD"),v.a.scrollBottom())},scrollPos:function(e,t,i){var a=$(".im-chat-content"),s=a.height();this.tpl(e,t,i).then(function(e){a.prepend(e);var t=a.height()-s;$(".im-chat-pannel").scrollTop(t-29)})},newMsg:function(e){this.getChatList({groupId:l.groupId,type:"new",count:1e3,lastMsgId:l.lastMsgId,msgType:"ADD"})},loading:function(e){$("#im-msg-more").remove(),this.checkMsgType(e,'<div id="im-msg-loading"></div>')},getChatAgainTpl:function(e){var t='<div id="get-chat-tips">获取消息内容失败，请<a href="javascript:;" data-groupid="'+e.groupId+'" data-type="'+e.type+'" data-count="'+e.count+'" data-lastmsgid="'+e.lastMsgId+'" data-msgtype="'+e.msgType+'" class="im-get-chat-again">重试</a></div>';$("#im-msg-loading").remove(),this.checkMsgType(e.msgType,t)},checkMsgType:function(e,t){var i=$(".im-chat-content");"OPEN"==e?(i.html(""),i.html(t)):"MORE"==e?i.prepend(t):"ADD"==e&&i.append(t)},bindEvt:function(){$("body").on("click",".im-msg-more",$.proxy(this,"_onMsgMoreClick")).on("click",".im-file-ing-close",$.proxy(this,"_onFileIngClose")).on("click",".im-get-chat-again",$.proxy(this,"_onGetChatAgainClick")),$(".im-chat-pannel").on("scroll",this._onImChatPannelScroll)},_onMsgMoreClick:function(){this.getChatList({groupId:l.groupId,type:"old",count:10,lastMsgId:$(".im-msg:first").attr("data-msgid"),msgType:"MORE"})},_onImChatPannelScroll:function(i){var e=this.timer;e&&window.clearTimeout(e),this.timer=window.setTimeout(function(){var e=i.target.scrollTop,t=$("#im-msg-more");e<=10&&0<t.length&&t.click()},150)},_onGetChatAgainClick:function(e){var t=$(e.target),i="null"==t.attr("data-lastmsgid")?null:t.attr("data-lastmsgid");this.getChatList({groupId:t.attr("data-groupid"),type:t.attr("data-type"),count:t.attr("data-count"),lastMsgId:i,msgType:t.attr("data-msgtype")})},_onFileIngClose:function(e){var t=$(e.target);a.a.pub("upload-cancel",{uploaderId:t.closest(".im-file-mod").attr("data-uploaderid"),id:t.closest(".im-file-mod").attr("id")}),t.addClass("im-upload-cancel").html("已取消")},uploadFileSelect:function(e){var t=e.data,i=v.a.fileSize(t.size),a=v.a.matchFileType(t.name),s={content:this.fileTpl(t.id,a,t.name,i,!0,t.uploaderId),msgId:t.id,sendTime:"",msgType:2,fromUserId:m.a.userInfo.id,uploading:!0,uploaderId:t.uploaderId,isUploadFile:!0};this.chatList([s],"ADD"),v.a.scrollBottom()},uploadFileProcess:function(e){var t=e.data,i=Math.ceil(120*t.percentage),a="#"+t.id+" .im-loading-ing";$(a).css({width:i+"px"})},uploadFileSuccess:function(e){if(!(0<$("div.im-msg[data-msgid="+e.data.msgId+"]").length)){var t=e.data,i=$("#"+t.id),a=i.parent(),s=i.closest(".im-msg"),n=t.serverFileId,r="";s.attr("data-msgid",t.msgId),s.find(".im-send-time").html(v.a._parseDate(t.sendTime)),s.find(".im-send-body").data("sendtime",t.sendTime),s.find(".im-send-body").data("msgid",t.msgId);var o=i.find(".im-file-name").text().lastIndexOf(".");"png"==i.find(".im-file-name").text().substring(o+1,i.find(".im-file-name").text().length).toLowerCase()&&(r='style="background:#fff;"'),"img"==v.a.matchFileType(i.find(".im-file-name").text())?(i.remove(),a.append('<div class="im-img-wrap"><img src="'+y+"/microblog/filesvr/"+n+'?thumbnail" id="'+n+'" class="im-send-content-img" '+r+" /></div>")):(s.find(".im-file-mod").attr("id",n),s.find(".im-file-loading").remove(),s.find(".im-file-ing-close").remove(),s.find(".im-file-mod").removeClass("no-cursor"),s.find(".im-file-name").attr("href",f+n),s.find(".im-file-img").attr("href",f+n),s.find(".im-file-size").after('<a href="'+f+n+'" class="im-file-handle im-msg-file-dl" title="下载">下载</a>'))}},uploadFileFail:function(){}}},function(e,t,i){"use strict";var a,s,n,r=i(0),o="//www.yunzhijia.com",d={previewIns:!1,width:680,height:500,prevId:"",nextId:"",groupId:"",currentId:"",bindEvt:function(){var e=this;$("body").on("click",".im-preview-img-container",$.proxy(e,"_onRootClick")).on("click",".im-preview-close",$.proxy(e,"_onCloseClick")).on("click",".im-preview-prev",$.proxy(e,"_onPrevClick")).on("click",".im-preview-next",$.proxy(e,"_onNextClick")).on("mouseover",".im-preview-operate a",$.proxy(e,"_onViewDetailMouseover"))},initImgPreview:function(e){var t=e.data;if(this.previewIns)this._reset(t).show();else{var i=this.tpl(t);$(".im-wrap").append(i),this.previewIns=!0,this._loadImg()}},tpl:function(e){return'<div class="im-preview-img-container" data-clickId="'+e.id+'" data-groupId="'+e.groupId+'" data-frommsgid="'+e.formMsgId+'"><a class="im-preview-close">X</a><div class="im-preview-mask"></div><div class="im-preview-main"><div class="left-preview"><a class="im-preview-prev"><</a></div><div class="im-preview-content"><p class="im-preview-photo"><img id="im-preview-photo" src="" /><i class="im-preview-loading"></i></p><p class="im-preview-operate"><a target="_blank">查看原图</a></p></div><div class="right-preview"><a class="im-preview-next">></a></div></div></div>'},hide:function(){$(".im-preview-img-container").hide()},show:function(){$(".im-preview-img-container").show(),this._loadImg()},_reset:function(e){return $(".im-preview-img-container").data("clickid",e.id),$(".im-preview-img-container").data("groupid",e.groupId),$(".im-preview-img-container").data("frommsgid",e.fromMsgId),this},_prevSwitch:function(e){e?$(".im-preview-prev").show():$(".im-preview-prev").hide()},_nextSwitch:function(e){e?$(".im-preview-next").show():$(".im-preview-next").hide()},_getData:function(){var e=$(".im-preview-img-container");return{clickId:e.data("clickid"),groupId:e.data("groupid"),fromMsgId:e.data("frommsgid")}},_loadImg:function(e){var t,i,a=this;e?(t=o+"/microblog/filesvr/"+e+"?big",a.currentId=e,a.imgReady(t,a._imgReady(),a._imgError(),a._imgLoad()),this._getLoopData({clickId:e,groupId:a.groupId})):($("#im-preview-photo").attr("src",""),i=this._getData(),t=o+"/microblog/filesvr/"+i.clickId+"?big",a.groupId=i.groupId,a.currentId=i.clickId,a.imgReady(t,a._imgReady(),a._imgError(),a._imgLoad()),this._getLoopData(i))},_getLoopData:function(e){this._imgSwitch(undefined,e)},_onRootClick:(n=null,function(e){if(!n){var t=this;n=setTimeout(function(){t.hide(),clearTimeout(n),n=null},300)}}),_onCloseClick:function(){this.hide()},_onViewDetailMouseover:function(e){$(e.target).closest("a").attr("href",o+"/microblog/filesvr/"+this.currentId+"?original")},_onPrevClick:function(e){e.stopPropagation(),this._imgSwitch("prev")},_onNextClick:function(e){e.stopPropagation(),this._imgSwitch("next")},_imgSwitch:function(e,t){var i=this;t?(a=t.clickId,s=t.groupId):(a="prev"==e?i.prevId:i.nextId,s=i.groupId),r.b({url:"/imsdk/file/view.do",type:"get",dataType:"json",xhrFields:{withCredentials:!0},contentType:"application/x-www-form-urlencoded",data:{threadId:s,fileId:a}}).done(function(e){i.prevId=e.data.preFileId,i.nextId=e.data.nextFileId,t||i._loadImg(a),i._prevSwitch(e.data.preFileId),i._nextSwitch(e.data.nextFileId)})},_imgReady:function(){var e=this,t=$("#im-preview-photo"),i=$(".im-preview-loading");return function(){i.show(),t.on("load",function(){t.height()>=e.height?t.css("marginTop","-"+(t.height()-e.height)/2):t.css("marginTop",(e.height-t.height())/2)})}},_imgError:function(){return function(){}},_imgLoad:function(){return function(){var e=this.src,t=$("#im-preview-photo");$(".im-preview-loading").hide(),t.attr("src",e)}},imgReady:function(e,t,i,a){var s=$(".im-preview-loading"),n=new Image;s.show(),n.src=e,n.onerror=function(){i&&i.call(n),r.end=!0,n=n.onload=n.onerror=null};var r=function(){t.call(n)};n.onload=function(){!r.end&&r(),a&&a.call(n),n=n.onload=n.onerror=null}},ready:function(){this._loadImg();var t=this;$(document).on("keyup",function(e){27===e.keyCode&&t.hide()})}};t.a=d},function(e,t,i){"use strict";var n=i(0),a=i(28),s=i.n(a);function r(e){this.sGroup=[],this.sPerson=[],this.selectedInfo={},this.allGroup={},this.groupOffset=0}r.prototype={tpl:function(e){var t=document.createElement("div");t.className="ims-layer",t.style.display="none",t.innerHTML=s()({title:e.title}),$(".im-wrap").append(t),this.$root=$(t)},bindEvent:function(){var i=this;this.$root.find(".ims-tab-item").click(function(){var e=$(this).index();$(this).addClass("ims-tab-cur").siblings().removeClass("ims-tab-cur"),i.$root.find(".ims-tab-panle").hide().eq(e).show()}),this.$root.find(".ims-close").click(function(){i.close()}),this.$root.find(".ims-sure-btn").click(function(){var e={};e.userIds=i.sPerson,i.$group.data("selectgroup")&&(e.groupIds=i.sGroup),i.close(),i.afterSlelect(e)}),this.$group.on("click",".ims-group-detail",function(e){e.stopPropagation(),i._onGroupClick(e.currentTarget)}),this.$group.on("click",".ims-group-more",function(e){e.stopPropagation(),i.requestGroup(i.groupOffset,100),$(this).remove()}),this.$root.on("click",".tree-leaf",function(e){e.stopPropagation(),i._onLeafClick(e.currentTarget)}),this.$tree.on("click",".tree-node-name",function(e){e.stopPropagation(),i._onNodeClick(e.currentTarget)}),this.$tree.on("click",".im-select-org-members",function(e){e.stopPropagation(),i._onSelectOrgMemberClick(e.currentTarget)}),this.$selectedList.on("click",".ims-del-person",function(e){var t=$(e.currentTarget.parentNode);i.delSelected(t.data("id"),t.data("isgroup"))}),this.$input.on("input paste",function(){var e=$(this).val().trim();""!==e?(i.searchPerson(e),i.$clearInput.show(),i.$searchList.data("count",0)):(i.$clearInput.hide(),i.$searchList.html("").hide())}),this.$clearInput.on("click",function(e){i.$input.val("").trigger("input")})},_onGroupClick:function(e){var t=(e=$(e)).attr("data-groupid");if(this.$group.data("selectgroup"))if(e.hasClass("selected"))this.delSelected(t,!0);else{var i=e.find(".ims-group-name").text(),a=e.find(".ims-group-avatar img").attr("src");this.addSelected({id:t,name:i,photoUrl:a,srcElement:e[0],isGroup:!0}),e.addClass("selected")}else for(var s=this.allGroup[t].participant,n=0,r=s[0].length;n<r;n++)this.addSelected({id:s[0][n],name:s[1][n],photoUrl:s[2][n],srcElement:null,isGroup:!1})},_onLeafClick:function(e,t){var i=(e=$(e)).attr("data-userid"),a=e.parent().siblings(".im-select-org-members")[0];if(e.hasClass("selected")){e.removeClass("selected");var s=e.parent().siblings(".im-select-org-members")[0];s&&s.checked&&(s.checked=!1),this.delSelected(i,!1)}else{var n=e.find("span").text(),r=e.find("img").attr("src"),o=e.data("status");if(t||this.addSelected({name:n,photoUrl:r,id:i,status:o,srcElement:e[0],isGroup:!1}),e.addClass("selected"),a&&!a.checked){var d=e.parent().find(".tree-leaf");d.filter(".selected").length===d.length&&(a.checked=!0)}}},_onNodeClick:function(e){var t=$(e).closest("li.tree-node"),i=t.data("loaded"),a="true"===t.attr("data-unallot")?"unallotPersons":t[0].id,s=t.find(" > .list-wrapper");if(!i){s.length||(s=$('<ul class="list-wrapper none"><li><div class="im-tree-loading"></div></li></ul>'),t.append(s));var n=t.data("level");this.createTree(!1,a,s,n,t)}s.length&&(s.hasClass("none")?(s.removeClass("none"),t.addClass("tree-node-expanded")):(s.addClass("none"),t.removeClass("tree-node-expanded")))},_onSelectOrgMemberClick:function(e){var t=(e=$(e)).data("info");if(t&&t.length){var i,a=e.prop("checked"),s=e.find(" ~ .list-wrapper > .tree-leaf"),n=0;if(a)for(s.addClass("selected"),n=t.length-1;0<=n;--n){var r=t[n],o=r.photoUrl,d=r.id,l=r.status,c=r.name;this.addSelected({photoUrl:o,id:d,name:c,status:l,srcElement:s[n],isGroup:!1})}else for(s.removeClass("selected");n<t.length;++n)i=t[n].id,this.delSelected(i,!1)}},requestSubTree:function(e){var t=$.Deferred(),i=JSON.stringify({eid:this.eid,orgId:e,count:0,begin:0});return n.b({type:"post",headers:{"Content-Type":"text/plain"},url:"/imsdk/org/getPersons.do",data:i,dataType:"json",success:function(e){e&&e.success?t.resolve(e.data):t.reject("请求部门树失败")}}),t.promise()},requestGroup:function(e,t){var i=this,a=$('<div class="ims-loading"></div>');this.$group.append(a);var s=JSON.stringify({offset:e,count:t});n.b({type:"post",headers:{"Content-Type":"text/plain"},url:"/imsdk/group/list.do",data:s,dataType:"json"}).then(function(e){e&&(a.remove(),i.groupOffset+=e.list.length,i.initGroup(e.list,e.more))})},initGroup:function(e,t){if(e.length){for(var i=document.createDocumentFragment(),a=0,s=e.length;a<s;a++){var n=e[a].status.toString(2),r="1"==n.substr(n.length-1,1);if(this.selectGroup&&1==e[a].type||2==e[a].type&&r){var o='<div class="ims-group-detail" data-groupid="'+e[a].groupId+'"><span class="ims-group-avatar"><img src="'+e[a].headerUrl+'"></span><span class="ims-group-name ellipsis ">'+e[a].groupName+"</span></div>";i.appendChild($(o)[0]),this.allGroup[e[a].groupId]=e[a]}}this.$group[0].appendChild(i)}t&&this.$group.append('<div class="ims-group-more">更多会话组</div>')},createTree:function(l,e,c,u,p){var m=this;return u=u||1,this.requestSubTree(e).then(function(e){var t=c||m.$tree;if(t.empty(),p&&p.data("loaded",!0),l){var i='<li data-loaded="1" data-level="0" id="'+e.id+'" class="tree-node tree-root"><span title="'+e.name+'" class="tree-node-name"><b class="tree-space"></b>'+e.name+"</span></li>",a=$(i+"");t.append(a)}if(e._level=u+1,t.append(m._itemTpl(e)),!l&&0===e.children.length&&0<e.person.length){for(var s=$('<input type="checkbox" class="im-select-org-members" />'),n=[],r=e.person,o=0;o<r.length;++o){var d=r[o];n.push({id:d.id,photoUrl:d.photoUrl,name:d.name,status:d.status})}s.data("info",n),t.before(s).parent().find(".tree-node-icon").remove()}})},_itemTpl:function(e){for(var t=e.unallotPersonCount||0,i="",a=e._level,s=0,n=e.person.length;s<n;s++){var r=e.person[s];i+='<li class="tree-leaf" data-userid="'+r.id+'" data-status="'+r.status+'">',i+=new Array(a).join('<b class="tree-space"></b>'),i+='<img src="'+(r.photoUrl||"https://static.yunzhijia.com/space/c/photo/load")+'">',i+="<span>"+r.name+"</span>",i+="</li>"}for(var o=0,d=e.children.length;o<d;o++){var l=e.children[o];i+='<li data-level="'+(a||0)+'" id="'+l.id+'" class="tree-node">',i+='<span class="tree-node-name" title="'+l.name+'"><i class="tree-node-icon">&gt;</i>',i+=new Array(a+1).join('<b class="tree-space"></b>'),i+=l.name+"</span>",i+="</li>"}return e.person.length||e.children.length||(i+='<li class="tree-empty">无数据</li>'),0<t&&(i+='<li data-level="'+(a||0)+'" class="tree-node" data-unallot = "true"><span class="tree-node-name" title="未分配部门的成员"><i class="tree-node-icon">&gt;</i>',i+=new Array(a+1).join('<b class="tree-space"></b>'),i+="未分配部门的成员</span></li>"),i},delSelected:function(e,t){var i,a,s=this;t?-1!=(a=s.sGroup.indexOf(e))&&s.sGroup.splice(a,1):-1!=(i=s.sPerson.indexOf(e))&&s.sPerson.splice(i,1),this.$selectedList.find("[data-id ="+e+"]").remove();var n=$(this.selectedInfo[e].srcElement),r=n.parent().siblings(".im-select-org-members")[0];n&&n.hasClass("selected")&&(n.removeClass("selected"),r&&r.checked&&(r.checked=!1))},addSelected:function(e){if(-1==this.sGroup.indexOf(e.id)&&-1==this.sPerson.indexOf(e.id)){e.isGroup?this.sGroup.push(e.id):this.sPerson.push(e.id);var t='<li data-id="'+(this.selectedInfo[e.id]=e).id+'" data-isgroup="'+e.isGroup+'"><img src="'+e.photoUrl+'" title="'+e.name+'" alt="'+e.name+'"><div class="ims-selected-name">'+e.name+'</div><span class="ims-del-person">-</span></li>';this.$selectedList.append(t)}},searchPerson:function(t,e){var i=this,a=$.Deferred();clearInterval(i.searchTimer),this.searchTimer=setTimeout(function(){n.b({url:"/imsdk/org/searchPersons.do",type:"post",headers:{"Content-Type":"text/plain"},data:JSON.stringify({word:t,begin:e||0,count:10}),dataType:"json",success:function(e){e.success&&(i.searchTpl(t,e.data),a.resolve("done"))}})},200)},searchTpl:function(e,t){var i=this;if(0<t.list.length){for(var a="",s=t.list,n=s.length,r=0;r<n;r++)a+='<div class="tree-leaf" data-userid="'+s[r].id+'" data-status="'+s[r].status+'"><img src="'+(s[r].photoUrl||"http://static.yunzhijia.com/space/c/photo/load?id=579b2169e4b0b35fa3e61aa6")+'"><span>'+s[r].name+"</span></div>";var o=i.$searchList.data("count");if(0==o?i.$searchList.html(a):i.$searchList.append(a),t.hasMore){var d=$('<div class="ot-next-page">查看更多</div>');i.$searchList.append(d),d.on("click",function(){i.searchPerson(e,o+n),$(this).remove()})}i.$searchList.show().data("count",o+n)}else i.$searchList.show().html('<div class="search-none">找不到符合的结果，<br/>请换个关键词试试吧</div>')},close:function(){this.$root.remove()},show:function(e){var t=this;this.tpl(e),this.callback=e.callback||$.noop,this.selectGroup=e.selectGroup,t.$group=t.$root.find(".ims-group"),t.$tree=t.$root.find(".ims-tree"),t.$selectedList=t.$root.find(".ims-selected-list"),t.$error=t.$root.find(".ims-errormsg"),t.$input=t.$root.find(".ot-search-input"),t.$clearInput=t.$root.find(".ot-clear-input"),t.$searchList=t.$root.find(".ot-search-list"),t.bindEvent(),this.$group.data("selectgroup",!!this.selectGroup),this.$root.css("display","block"),this.requestGroup(0,50),this.createTree(!0,"")}},t.a=r},function(e,t,i){"use strict";i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n}),i.d(t,"c",function(){return r});var a=i(0),s=function(e){var t=$.Deferred();return a.b({method:"post",url:"/imsdk/file/info.do",xhrFields:{withCredentials:!0},dataType:"json",data:e}).then(function(e){e&&e.success?t.resolve(e):t.reject(e&&e.error||"网络不稳定，请稍后重试")},function(){t.reject("网络不稳定，请稍后重试")}),t.promise()},n=function(e){var t=$.Deferred();return a.b({method:"post",url:"/imsdk/file/sendMessage.do",xhrFields:{withCredentials:!0},contentType:"application/json",dataType:"json",data:JSON.stringify(e)}).then(function(e){e&&e.success?t.resolve(e):t.reject(e&&e.error||"发送附件消息失败")},function(){t.reject("网络不稳定，请稍后重试")}),t.promise()},r=function(e){var t=$.Deferred();return a.b({method:"post",url:"/imsdk/file/save.do",xhrFields:{withCredentials:!0},dataType:"json",data:e}).then(function(e){e&&e.success?t.resolve(e):t.reject(e&&e.error||"上传文件失败")},function(){t.reject("上传文件失败")}),t.promise()}},function(e,t,i){"use strict";var o=i(26),s=function(e){if($.extend(this,e),!(this.$uploadBtn&&this.$uploadBtn instanceof jQuery))return console.error("Html5Uploader need a $uploadBtn param, and it must be jQuery object.")};s.prototype={constructor:s,bindEvent:function(){var t=this;this.$uploadBtn.on("click",function(){t.$html5uploader.find("input").eq(0)[0].click()}),this.$html5uploader[0].addEventListener("change",function(e){m.call(t,e,t.uploadEvent,t.postUrl)},!1)},cancelUploadFile:function(e){var t=d[e.id];t&&t.abort()}};var a,d={},n=o.a.FileTypes,r=[n.DOC,n.IMG],l=/^.*(.jpg|.gif|.png|.jpeg|.bmp)$/,c=/^.*$/,u=0,p=(a=0,function(){return"html5uploader"+ ++a}),m=function(e,t,i){e.stopPropagation(),e.preventDefault();for(var a=e.target.files||e.dataTransfer.files,s=0;s<a.length;s++){var n=a[s],r=h.call(this,n);r.status==o.a.STATUS.FILE_EXCEEDS_SIZE_LIMIT?t.oversize(r):r.status==o.a.STATUS.ZERO_BYTE_FILE?t.zerofile(r):r.status==o.a.STATUS.INVALID_FILETYPE?t.invalidtype(r):r.status==o.a.STATUS.IN_PROGRESS&&(t.select(r,e),g(n,r,t,i))}e.target.value=""},f=function(e,t,i){return e&&function(e){for(var t=r,i=0;i<t.length;i++)if(t[i]==e)return!0;return!1}(e)?function(e,t){if(e)return e==n.DOC&&104857600<t||e==n.IMG&&20971520<t}(e,t)?o.a.STATUS.FILE_EXCEEDS_SIZE_LIMIT:0==t?o.a.STATUS.ZERO_BYTE_FILE:o.a.STATUS.IN_PROGRESS:o.a.STATUS.INVALID_FILETYPE},h=function(e){var t,i=(t=e,l.test(t.name.toLowerCase())?n.IMG:c.test(t.name.toLowerCase())?n.DOC:undefined),a=f(i,e.size),s=new o.a({id:"html5uploadFile"+u,name:e.name,type:i,size:e.size,uploaderId:this.$html5uploader.attr("id"),status:a,percentage:0});return u++,s},g=function(e,s,n,t){var i=new FormData,a=(new Date).getTime();i.append("name","Html 5 File API/FormData"),i.append("fileToUpload",e,e.name);var r=new XMLHttpRequest;r.upload.addEventListener("progress",function(e){s.setStatus(o.a.STATUS.IN_PROGRESS),s.setPercentage(parseInt(e.loaded/e.total)),n.progress(s,e)},!1),r.addEventListener("load",function(e){var t,i=e.target,a=i.responseText;if(4==i.readyState&&200<=i.status&&i.status<=304){try{t=JSON.parse(a)}catch(e){t={success:!1}}t.success?(s.setStatus(o.a.STATUS.COMPLETE),s.setServerFileId(t.data),n.complete(s,e)):(s.setStatus(o.a.STATUS.UPLOAD_FAILED),n.failed(s,e))}else s.setStatus(o.a.STATUS.UPLOAD_FAILED),n.failed(s,e)},!1),r.addEventListener("error",function(e){s.setStatus(o.a.STATUS.UPLOAD_FAILED),n.failed(s,e)},!1),r.addEventListener("abort",function(e){s.setStatus(o.a.STATUS.CANCELLED),n.canceled(s,e)},!1),r.open("POST",-1<t.indexOf("?")?t+"&t="+a:t+"?t="+a),r.send(i),d[s.getId()]=r};t.a=function(e){var t,i,a=new s(e);return a.$html5uploader=(t=p(),(i=$('<div class="html5uploader" style="width:0;height:0;position: absolute;left: -1555px;top: -1555px;" id="'+t+'" ><input style="width:0;height:0;" class="h5uploaderbtn" type="file" multiple /></div>').prependTo("body")).click(function(e){e.stopPropagation()}),i),a.bindEvent(),a}},function(e,t,i){"use strict";var o=i(3),d=i(0),l=i(2),c=i(1),s=i(25),u=i(24),p=i(20),m=i(21),f=i(23);c.a.sub("init",function(){var n="",r="";c.a.sub("panleChange",function(e){n=e.data.groupId,r=e.data.userId});var a=i.i(s.a)($("#im-msbc-box")[0]);i.i(u.a)({$showEle:$(".im-msb-smiley"),$smileyTab:$(".im-smiley-tab-content"),$smileyTabBtn:$(".im-tab-title"),delegate:"img",selectFun:function(e){var t=$(e.target),i="["+t.attr("title")+"]";a.insert(i)}});var e={select:function(e){c.a.pub("upload-select",e)},progress:function(e,t,i){c.a.pub("upload-progress",e)},failed:function(e,t){c.a.pub("upload-failed",e),o.a("[上传失败] "+e.name)},oversize:function(e){console.log("文件过大"),o.a("文件过大")},zerofile:function(e){console.log("zerofile")},invalidtype:function(e){console.log("invalidtype"),o.a("不支持该文件类型")},canceled:function(e){console.log("cancel",e)},complete:function(s){p.a({fileId:s.getServerFileId()}).then(function(e){var t=e.data&&e.data.fileInfo,i=t.fileName,a=i.lastIndexOf(".");return p.b({groupId:n,toUserId:"",msgType:8,content:"[文件]:"+i,param:{file_id:t.id,name:i,uploadDate:t.uploadDate,size:t.length,ext:0<=a?i.substring(a+1):"",isEncrypted:!1}}).then(function(e){return e=e.data,s.msgId=e.msgId,s.sendTime=e.sendTime,c.a.pub("updateList",s),c.a.pub("upload-success",s),p.c({threadId:e.groupId,fileId:s.getServerFileId(),isEncrypted:!1,uploadFileMode:1}).then(function(e){},function(e){o.a(e)})},function(e){o.a(e)})},function(e){o.a(e)})}};if(window.FileReader){var t=i.i(m.a)({$uploadBtn:$(".attachbtndoc"),postUrl:l.a.IMSDK_API_HOST+"/imsdk/file/upload.do?ticket="+l.a.ticket,uploadEvent:e});c.a.sub("upload-cancel",function(e){t.cancelUploadFile(e.data)})}else $(".attachbtndoc").hide();f.a({postUrl:l.a.IMSDK_API_HOST+"/imsdk/message/send.do",$sendBtn:$(".im-msbc-btn"),$textarea:$("#im-msbc-box"),clickSend:function(){var i=this,e=this.$textarea.val(),a=f.b(e),s={groupId:n,toUserId:n?"":r,msgType:2,content:e,msgLen:a,param:{notifyType:1,notifyTo:[],notifyToAll:!1}};""!=$.trim(e)?d.b({contentType:"text/plain",url:"/imsdk/message/send.do",xhrFields:{withCredentials:!0},crossDomain:!0,type:"post",data:JSON.stringify(s),success:function(e){if(e.success){i.$textarea.val("");var t={content:s.content,direction:1,fromClientId:null,fromUserId:l.a.userInfo.id,msgId:e.data.msgId,msgLen:a,msgType:2,nickname:null,param:null,sendTime:e.data.sendTime,sourceMsgId:null,status:1};c.a.pub("sendTxt",t),r&&(c.a.pub("updateList",""),c.a.pub("switchNewGroup",e.data.groupId))}else o.a(e.error)},error:function(e){o.a("网络不稳定，请稍后重试")}}):o.a("请输入内容")}})})},function(e,t,i){"use strict";i.d(t,"b",function(){return n}),i.d(t,"a",function(){return o});var a,s,n=function(e){for(var t=new RegExp("(http[s]?://[a-zA-Z0-9!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~]*)(s)*","gi"),i=e.match(t)||[],a=0,s=e,n=0;n<i.length;n++)s=s.replace(i[n],""),a+=22;return a+=r(s)},r=function(e){return(e||"").replace(/[^\x00-\xff]/g,"**").length},o=function(e){var t;a=e.$textarea,s=e.$sendBtn,a&&s||console.error("sendMsg module: arguments lost;"),t=e,s.on("click",function(e){t.clickSend()})}},function(e,t,i){"use strict";var n=i(2),o=i(5),a=function(){return!1},s=function(e){this.loaded=[!1,!1,!1],this.$smileyComp=function(){var e=[o.a[0]],t="",i=document.createElement("div");i.className="im-layer-shim im-mb-smiley-layer",i.style.display="none",t='<div class="im-layer-main"><span class="im-layer-arrow im-p9 im-arrow-highlight"></span><div class="im-layer-bd"><div class="im-smiley-container"><div class="im-tab-container">';for(var a=0,s=e.length;a<s;a++){t+='<ul id="smiley-tabContent'+a+'" class="im-smiley-tab-content">';for(var n=e[a].content.length,r=0;r<n;r++)t+="<li></li>";t+="</ul>"}return t+='</div><div class="im-smiley-tab"><span data-tabbody="smiley-tabContent0" class="im-tab-title im-moren" title="默认"></span></div></div>',t+="</div></div></div></div>",i.innerHTML=t,$(".im-chat-container").append(i),$(i)}(),this.$showEle=e.$showEle,this.$selectEle=this.$smileyComp.find(".im-smiley-container"),this.delegate=e.delegate,this.beforeshowFun=e.beforeshowFun,this.selectFun=e.selectFun,this.$smileyTab=e.$smileyTab,this.$smileyTabBtn=e.$smileyTabBtn,this.showCompFun=function(){var t=this;return function(e){return t.beforeshowFun&&t.beforeshowFun(e),t.show(0),!1}}.call(this),this.smileyTabFun=function(){var i=this;return function(e){var t=i.$smileyTabBtn.index($(this));i.$smileyTabBtn.removeClass("curr").eq(t).addClass("curr"),i.$smileyTab.hide().eq(t).show()}}.call(this),this.selectEventFun=function(){var t=this;return function(e){t.selectFun&&t.selectFun(e),t.hide()}}.call(this),this.hideFun=function(){var t=this;return function(e){t.$smileyComp.hide()}}.call(this)};s.prototype={constructor:s,show:function(e){var t,i,a,s;this.loaded[e]||(t=e,a=o.a[t],s=n.a.IMSDK_API_HOST+"/imsdk/images/smiley",$("#smiley-tabContent"+t).show().siblings().hide().end().find("li").each(function(e){i=a.content[e],"default"===a.type?$(this).html('<img src="'+s+"/"+i[1]+'" title="'+i[0]+'" alt="'+i[0]+'" />'):$(this).html('<img src="'+s+"/"+i[1]+'" data-id="'+i[0]+'" alt="'+i[2]+'"title="'+i[2]+'" name="'+i[2]+'" />')}),this.loaded[e]=!0),this.$smileyComp.show()},hide:function(){this.$smileyComp.hide()},bindEvent:function(){this.$smileyTabBtn.on("click",this.smileyTabFun),this.$showEle.on("click",this.showCompFun),this.delegate?this.$selectEle.on("click",this.delegate,this.selectEventFun):this.$selectEle.on("click",this.selectEventFun),this.$smileyComp.on("click",{show:!0},a),$("body").on("click",this.hideFun)},destroy:function(){}},t.a=function(e){var t=new s(e);return t.bindEvent(),t}},function(e,t,i){"use strict";var a=function(e){return e?(this.textarea=$(e)[0],this.rangeData={text:"",start:0,end:0},this.textarea?void 0:console.error("TAHelper: ele can not be find.")):console.error("TAHelper need a ele param.")};a.prototype={constructor:a,getCaret:function(){var e=this.rangeData,t=this.textarea;if(t.setSelectionRange)e.start=t.selectionStart,e.end=t.selectionEnd,e.text=e.start!=e.end?t.value.substring(e.start,e.end):"";else if(document.selection)try{var i,a=document.selection.createRange(),s=document.body.createTextRange();for(s.moveToElementText(t),e.text=a.text,i=0;s.compareEndPoints("StartToStart",a)<0&&0!==a.moveStart("character",-1);i++)"\r"==t.value.charAt(i)&&i++;e.start=i,e.end=e.text.length+e.start}catch(n){console.error(n)}return this.rangeData=e},refreshCaret:function(){return this.getCaret(),this},setCaret:function(e){var t,i=this.textarea;e||console.error("[K.TextareaHelper.setCaret] You must get cursor position first."),i.focus();try{i.setSelectionRange?i.setSelectionRange(e.start,e.end):i.createTextRange&&((t=i.createTextRange()).collapse(!0),t.moveStart("character",e.start),t.moveEnd("character",e.end-e.start),t.select()),this.textarea=i}catch(a){console.error(a)}},insert:function(e){var t,i,a,s,n,r,o=this.textarea,d=this.rangeData;return this.setCaret(d),o.setSelectionRange?(i=(t=o.value).substring(0,d.start)+e+t.substring(d.end),s=n=d.start+e.length,r=o.scrollTop,o.value=i,o.scrollTop!=r&&(o.scrollTop=r),o.setSelectionRange(s,n)):o.createTextRange&&((a=document.selection.createRange()).text=e,a.setEndPoint("StartToEnd",a),a.select()),this},caretOffset:function(e){if("string"==typeof e){var t=this.$,i=this.textarea,a=this.rangeData;if(i.setSelectionRange){var s=t(i),n=t("#"+e);if(0==n.length){var r=s.css("padding-top"),o=s.css("padding-right"),d=s.css("padding-bottom"),l=s.css("padding-left"),c=s.css("font-family"),u=s.css("font-size"),p=s.css("font-weight"),m=s.css("line-height"),f=s.css("width"),h=s.css("height");n=t("<div />").attr("id",e).css({visibility:"hidden",position:"absolute",left:0,top:0,"text-align":"left","word-wrap":"break-word","overflow-y":"auto","overflow-x":"hidden","padding-top":r,"padding-right":o,"padding-bottom":d,"padding-left":l,"font-family":c,"font-size":u,"font-weight":p,"line-height":m,width:f,height:h}).appendTo("body")}var g=s.val(),v=g.substring(0,a.start),b=g.substring(a.end);v=(v=(v=v.replace(/ /g,"&nbsp;")).replace(/<|>/g,"=")).replace(/\n/g,"<br />"),b=(b=(b=b.replace(/ /g,"&nbsp;")).replace(/<|>/g,"=")).replace(/\n/g,"<br />"),n.html(v+'<span class="proxy-caret"></span>'+b);var y=n.find(".proxy-caret").offset();return{left:y.left,top:y.top-s.scrollTop()}}if(document.selection){var I=document.selection.createRange(),T=t(window),w=t(i).offset();return{left:I.offsetLeft+T.scrollLeft()-w.left,top:I.offsetTop+T.scrollTop()-w.top}}}}},t.a=function(e){var t=new a(e);return $(e).on("blur",function(){t.refreshCaret()}),t}},function(e,t,i){"use strict";var a=function(e){this.id=e.id,this.name=e.name,this.type=e.type,this.size=e.size,this.status=e.status,this.uploaderId=e.uploaderId};a.prototype={getId:function(){return this.id},setName:function(e){this.name=e},getName:function(){return this.name},setType:function(e){this.type=e},getType:function(){return this.type},setSize:function(e){this.size=e},getSize:function(e){return void 0===e?this._getSizeAuto():this._getSize(e)},_getSize:function(e){switch(e){case"KB":return(this.size/1024).toFixed(2)+"KB";case"MB":return(this.size/1048576).toFixed(2)+"MB";case"B":default:return this.size+"B"}},_getSizeAuto:function(){if(!this.size)return"";var e=this.size;return e<1024?this._getSize("B"):e<1048576?this._getSize("KB"):this._getSize("MB")},setStatus:function(e){this.status=e},getStatus:function(){return this.status},isStatus:function(e){return this.status==e},setServerFileId:function(e){this.serverFileId=e},getServerFileId:function(){return this.serverFileId},setPercentage:function(e){this.percentage=e},getPercentage:function(){return this.percentage},isError:function(){return this.status<0},isRestorableError:function(){return this.status==a.STATUCANCELLED||this.status==a.STATUUPLOAD_FAILED},isDone:function(){return!this.isStatus(a.STATUQUEUED)&&!this.isStatus(a.STATUIN_PROGRESS)},setUploaderId:function(e){this.uploaderId=e},getUploaderId:function(){return this.uploaderId}},a.STATUS={QUEUED:1,IN_PROGRESS:2,COMPLETE:3,CANCELLED:-1,FILE_EXCEEDS_SIZE_LIMIT:-2,ZERO_BYTE_FILE:-3,INVALID_FILETYPE:-4,UPLOAD_FAILED:-5,RESOURCE_QUOTA_EXCEEDED:-10},a.FileTypes={DOC:"*.*;",DOC_DESC:"所有文件",IMG:"*.png;*.jpg;*.jpeg;*.gif;*.bmp",IMG_DESC:"图片 最大20M"},t.a=a},function(e,t){e.exports=function(e){return'<div id="im-chat-container" class="im-chat-container"> <div class="im-chat-title"> <div class="im-chat-name im-ellipsis"></div> <span class=im-char-usersnum></span> <input class="im-chat-name-input" value=""/> <div class="im-chat-operation"> <a href="javascript:;" title="群组" class="im-operate-btn im-icon im-group-icon im-btn-checked">群组</a> <a href="javascript:;" title="参与人" class="im-operate-btn im-icon im-open-person-panel">参与人</a> <a href="javascript:;" title="关闭" class="im-operate-btn im-icon im-close-chat">关闭</a> </div> </div> <div class="im-chat-main-wrapper"> <div class="im-chat-p-ms"> \x3c!-- 消息内容 --\x3e <div class="im-chat-pannel" id="im-msg-list"> <div class="im-chat-content"></div> <div class="im-at-tips"></div> </div> \x3c!-- 消息发送区域 --\x3e <div class="im-message-sendbox"> <ul class="im-msb-operation im-clearfix"> <li><a class="im-msb-smiley im-icon" href="javascript:;" title="表情"><i></i>表情</a></li> <li><a class="im-msb-upload im-icon attachbtn attachbtndoc" href="javascript:;" title="文件上传"><i></i>文件上传</a></li> </ul> \x3c!-- 消息内容区 --\x3e <div class="im-msb-content"> <textarea id="im-msbc-box" class="h5uploadercontainer"></textarea> <div class="im-msbc-footer"> <span class="send-t">快捷键：换行(Shift+回车), 发送(Ctrl+回车或回车)</span> <a class="im-msbc-btn" href="javascript:;" title="发送">发送</a> <a class="im-mscl-btn" href="javascript:;" title="取消">取消</a> </div> </div> </div> </div> \x3c!-- 成员列表 --\x3e <div class="im-chat-friend im-none"></div> </div></div>'}},function(e,t){e.exports=function(e){var t,i;return'<div class="ims-shade"></div><div class="ims-window"><div class="ims-head"><span class="ims-head-title">'+("undefined"!=typeof _encodeHTML?_encodeHTML:(t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g,function(e){return e?e.toString().replace(i,function(e){return t[e]||e}):""}))(e.title||"云之家")+'</span><span class="ims-head-close ims-close">×</span></div><div class="ims-main"><div class="ims-group-tree"><div class="ot-search"><input type="text" class="ot-search-input" placeholder="搜索通讯录"/><i class="ot-clear-input">×</i><div class="ot-search-list" data-count="0"></div></div><div class="ims-tab"><ul><li class="ims-tab-item ims-tab-cur"><span>已有会话</span></li><li class="ims-tab-item "><span>组织架构</span></li></ul></div><div class="ims-tab-panle ims-group"></div><div class="ims-tab-panle" style="display:none;"><ul class="ims-tree"></ul></div></div><div class="ims-selected-panle"><div class="ims-tip">已选组或人员<span class="ims-errormsg"></span></div><ul class="ims-selected-list"></ul><div class="ims-btn-bar"><a href="javascript:;" class="ims-cancle-btn ims-close">取消</a><a href="javascript:;" class="ims-sure-btn">确定</a></div></div></div></div></div>'}},function(e,t){e.exports=function(e){var t,i,a="undefined"!=typeof _encodeHTML?_encodeHTML:(t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g,function(e){return e?e.toString().replace(i,function(e){return t[e]||e}):""}),s='<div class="im-person-panel im-panel-wrap"style="display:block;"> ';2==e.type&&(s+=' <div class="im-header"> <span class="header-label">群组名称</span> <input type="text"name="groupName"class="group-name"value="'+a(e.groupName)+'"> </div> '),s+=' <ul class="im-list"> <li> <a href="javascript:;"class="im-add-item">+</a> </li> ';var n=e.plist;if(n)for(var r,o=-1,d=n.length-1;o<d;)s+=' <li class="'+((r=n[o+=1]).isManager?"im-manager":"")+'"data-ind="'+o+'"> <a href="javascript:;"class=""> <img src="'+(r.avatar||"https://static.yunzhijia.com/space/c/photo/load")+'"/> ',r.isManager&&(s+="<span>管理员</span>"),s+=' </a> <p class="im-name">'+a(r.username)+"</p> ",e.isManager&&!r.isSelf&&(s+='<span class="exit-group"></span>'),s+=" </li> ";return s+=' </ul> <div class="im-footer"> <a href="javascript:;"class="im-return-btn">返回群组</a> </div></div>'}},,function(e,t){},,function(e,t,i){e.exports=i(7)}]));
