var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(y,F,O){y instanceof String&&(y=String(y));for(var Q=y.length,p=0;p<Q;p++){var ta=y[p];if(F.call(O,ta,p,y))return{i:p,v:ta}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(y,F,O){if(y==Array.prototype||y==Object.prototype)return y;y[F]=O.value;return y};$jscomp.getGlobal=function(y){y=["object"==typeof globalThis&&globalThis,y,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var F=0;F<y.length;++F){var O=y[F];if(O&&O.Math==Math)return O}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(y,F){var O=$jscomp.propertyToPolyfillSymbol[F];if(null==O)return y[F];O=y[O];return void 0!==O?O:y[F]};
$jscomp.polyfill=function(y,F,O,Q){F&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(y,F,O,Q):$jscomp.polyfillUnisolated(y,F,O,Q))};$jscomp.polyfillUnisolated=function(y,F,O,Q){O=$jscomp.global;y=y.split(".");for(Q=0;Q<y.length-1;Q++){var p=y[Q];if(!(p in O))return;O=O[p]}y=y[y.length-1];Q=O[y];F=F(Q);F!=Q&&null!=F&&$jscomp.defineProperty(O,y,{configurable:!0,writable:!0,value:F})};
$jscomp.polyfillIsolated=function(y,F,O,Q){var p=y.split(".");y=1===p.length;Q=p[0];Q=!y&&Q in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var ta=0;ta<p.length-1;ta++){var E=p[ta];if(!(E in Q))return;Q=Q[E]}p=p[p.length-1];O=$jscomp.IS_SYMBOL_NATIVE&&"es6"===O?Q[p]:null;F=F(O);null!=F&&(y?$jscomp.defineProperty($jscomp.polyfills,p,{configurable:!0,writable:!0,value:F}):F!==O&&(void 0===$jscomp.propertyToPolyfillSymbol[p]&&(O=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[p]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(p):$jscomp.POLYFILL_PREFIX+O+"$"+p),$jscomp.defineProperty(Q,$jscomp.propertyToPolyfillSymbol[p],{configurable:!0,writable:!0,value:F})))};$jscomp.polyfill("Array.prototype.find",function(y){return y?y:function(F,O){return $jscomp.findInternal(this,F,O).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(y){var F=0;return function(){return F<y.length?{done:!1,value:y[F++]}:{done:!0}}};$jscomp.arrayIterator=function(y){return{next:$jscomp.arrayIteratorImpl(y)}};
$jscomp.initSymbol=function(){};$jscomp.polyfill("Symbol",function(y){if(y)return y;var F=function(ta,E){this.$jscomp$symbol$id_=ta;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:E})};F.prototype.toString=function(){return this.$jscomp$symbol$id_};var O="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",Q=0,p=function(ta){if(this instanceof p)throw new TypeError("Symbol is not a constructor");return new F(O+(ta||"")+"_"+Q++,ta)};return p},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(y){if(y)return y;y=Symbol("Symbol.iterator");for(var F="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),O=0;O<F.length;O++){var Q=$jscomp.global[F[O]];"function"===typeof Q&&"function"!=typeof Q.prototype[y]&&$jscomp.defineProperty(Q.prototype,y,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return y},"es6",
"es3");$jscomp.iteratorPrototype=function(y){y={next:y};y[Symbol.iterator]=function(){return this};return y};$jscomp.iteratorFromArray=function(y,F){y instanceof String&&(y+="");var O=0,Q=!1,p={next:function(){if(!Q&&O<y.length){var ta=O++;return{value:F(ta,y[ta]),done:!1}}Q=!0;return{done:!0,value:void 0}}};p[Symbol.iterator]=function(){return p};return p};
$jscomp.polyfill("Array.prototype.keys",function(y){return y?y:function(){return $jscomp.iteratorFromArray(this,function(F){return F})}},"es6","es3");
(function(){"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.macro&&(com.kingdee.bos.qing.macro={});"undefined"==typeof com.kingdee.bos.qing.macro.model&&(com.kingdee.bos.qing.macro.model={});var y=com.kingdee.bos.qing.macro.model;y.ImportResult=function(){var F=!1,O=[],Q=[];this.getSuccessUids=function(){return O};
this.getSuccessCount=function(){return O.length};this.getConflictUids=function(){return Q};this.isAllSuccess=function(){return F};this.fromJsonObject=function(p){O=p.successUids;Q=p.conflictUids;F=p.allSuccess?!0:!1}};y.AbstractMacroTypeItem=function(F,O){this.getTypeName=function(){return O};this.getMacroType=function(){return F};this.showCreateDialog=function(Q){throw Error("override me");};this.showEditDialog=function(Q){throw Error("override me");}}})();(function(){function y(){F.Macro.call(this,ta);var E=this,oa,R,pa,fa,f,ea,v=!0,B=!0;this.isAuthorizedDBCenter=function(){return v};this.setDbCenterAuthorized=function(g){v=g};this.isAuthorizedSchema=function(){return ea};this.setSchemaAuthorized=function(g){ea=g};this.isConnAuthorized=function(){return f};this.setConnAuthorized=function(g){f=g};this.getSQLType=function(){return oa};this.setSQLType=function(g){oa=g};this.getDBInfo=function(){return R};this.setDBInfo=function(g){R=g};this.getContent=
function(){return pa};this.setContent=function(g){pa=g};this.getRefDBHashCode=function(){return fa};this.setRefDBHashCode=function(g){fa=g};this.getUiDisplay=function(){return B};this.setUiDisplay=function(g){B=g};this.getTypeText=function(){return p.get("sqlMacro","SQL\u5b8f")};this.getContentText=function(){var g=M(!1)+"; SQL: ";pa&&Q.getImpl(Q.SYS_VAR_HELPER).switchSQLToDisplayMode(pa,function(Y){g+=Y});return g};this.getTipsText=function(){var g=M(!0)+"\r\nSQL:\r\n    ";pa&&Q.getImpl(Q.SYS_VAR_HELPER).switchSQLToDisplayMode(pa,
function(Y){var ha=g;var w="";Y=Y?Y.trim():"";if(0!=Y.length){for(var ia=0,d=0,ma="";d<Y.length&&ia<F.SQLMacroConstant.SQL_LINE_MAX_NUM;){var la=Y[d];if("\r\n"==la||"\r"==la||"\n"==la)0<ma.length&&(w+=ma+"\r\n    ",ia++,ma="");else{la=la.trim();for(var G="";0!=la.length;){G+=la;if(++d>=Y.length)break;la=Y[d].trim()}0<G.length&&(ma+=G+" ");ma.length-1>=F.SQLMacroConstant.LINE_SQL_CHAR_MAX_NUM&&(w+=ma+"\r\n    ",ia++,ma="")}d++}ma=ma.trim();d<Y.length?w=w.trim()+" ...":0<ma.length&&(w+=ma)}g=ha+w});
return g};this.validateModelForType=function(){if(!R)return p.get("noDBConnection","\u8bf7\u9009\u62e9\u6570\u636e\u5e93\u8fde\u63a5\u3002");if(pa&&""!=$.trim(pa)){if(0!=pa.trim().toLowerCase().indexOf("select"))return p.get("onlyAllowSelection","\u53ea\u5141\u8bb8\u67e5\u8be2\u64cd\u4f5c\u3002");if(-1==pa.indexOf("from")&&-1==pa.indexOf("FROM"))return p.get("sqlError","sql\u6267\u884c\u51fa\u9519\uff0c\u8bf7\u68c0\u67e5sql\u8bed\u53e5\u3002")}else return p.get("noQuery","\u8bf7\u8f93\u5165\u67e5\u8be2\u8bed\u53e5\u3002")};
this.getStatusWarning=function(){switch(E.getMacroStatus()){case F.MacroStatusEnum.DB_NOT_EXIST:var g=p.get("macroDeletedTips","\u516c\u5171\u6570\u636e\u6e90\u4e2d\u7684\u6570\u636e\u5e93\u8fde\u63a5\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002");break;case F.MacroStatusEnum.WITHOUT_DB_PERMISSION:g=p.get("macroNoPermissionTips",'\u516c\u5171\u6570\u636e\u6e90\u4e2d\u7684\u6570\u636e\u5e93\u8fde\u63a5\u5df2\u53d6\u6d88\u6388\u6743\u7ed9\u5b8f\u53d8\u91cf\u7684\u6700\u540e\u4fee\u6539\u4eba"#1"\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002').replace("#1",
E.getModifierName());break;case F.MacroStatusEnum.WITHOUT_DB_CENTER_PERMISSION:g=p.get("macroNoDBCenterPermissionTips",'\u5b8f\u53d8\u91cf\u7684\u6700\u540e\u4fee\u6539\u4eba"#1"\u6ca1\u6709\u6570\u636e\u4e2d\u5fc3\u6743\u9650\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002').replace("#1",E.getModifierName());break;case F.MacroStatusEnum.WITHOUT_SCHEMA_PERMISSION:g=p.get("macroNoSchemaTips",'\u8be5\u53d8\u91cf\u4f7f\u7528\u7684\u8d85\u7ea7\u67e5\u8be2\u6a21\u5f0f\u5df2\u88ab\u5220\u9664\u6216\u53d6\u6d88\u6388\u6743\u7ed9\u6700\u540e\u4fee\u6539\u4eba"#1"\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002').replace("#1",
E.getModifierName());break;case F.MacroStatusEnum.DB_CENTER_NO_APP_METADATA:g=p.get("macroNoAppMetadataTips",'\u8be5\u53d8\u91cf\u4f7f\u7528\u7684\u5e94\u7528"#1"\u5143\u6570\u636e\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002').replace("#1",D);break;case F.MacroStatusEnum.DB_CENTER_APP_CLOUD_DISABLED:g=p.get("macroCloudDisabledTips",'\u8be5\u53d8\u91cf\u4f7f\u7528\u7684\u5e94\u7528"#1"\u6240\u5728\u4e91\u88ab\u7981\u7528\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002').replace("#1",
D);break;case F.MacroStatusEnum.DB_CENTER_APP_DISABLED:g=p.get("macroAppDisabledTips",'\u8be5\u53d8\u91cf\u4f7f\u7528\u7684\u5e94\u7528"#1"\u88ab\u7981\u7528\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002').replace("#1",D);break;case F.MacroStatusEnum.DB_CENTER_NO_APP:g=p.get("macroNoAppTips",'\u8be5\u53d8\u91cf\u4f7f\u7528\u7684\u5e94\u7528"#1"\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002').replace("#1",D)}return g};var D=function(){var g="",Y=
R?R.getDBSource():null;Y&&Y.getAppNumber&&(g=Y.getAppNumber());return g},C=E.toJsonObject;this.toJsonObject=function(){var g=C();g.sqlType=oa;R&&(g.dbInfo=R.toJsonObject());g.content=pa;g.refDBHashCode=fa;g.bConnAuthorized=f;g.schemaAuthorized=ea;g.dbCenterAuthorized=v;return g};var U=E.fromJsonObject;this.fromJsonObject=function(g){U(g);oa=g.sqlType;if(g.dbInfo){R=new O;R.fromJsonObject(g.dbInfo);var Y=E.getMacroStatus();R.setAuthError(Y==F.MacroStatusEnum.WITHOUT_DB_PERMISSION||Y==F.MacroStatusEnum.WITHOUT_DB_CENTER_PERMISSION||
Y==F.MacroStatusEnum.WITHOUT_SCHEMA_PERMISSION)}ea=g.schemaAuthorized;f=g.bConnAuthorized;pa=g.content;fa=g.refDBHashCode;v=g.dbCenterAuthorized};this.copy=function(){var g=new y;g.setUid(E.getUid());g.setFid(E.getFid());g.setName(E.getName());g.setDesc(E.getDesc());g.setMultiValued(E.isMultiValued());g.setType(E.getType());g.setMacroStatus(E.getMacroStatus());g.setCreatorId(E.getCreatorId());g.setCreatorName(E.getCreatorName());g.setCreateTime(E.getCreateTime());g.setModifierId(E.getModifierId());
g.setModifyTime(E.getModifyTime());g.setModifierName(E.getModifierName());g.setSQLType(oa);g.setDBInfo(R);g.setContent(pa);g.setRefDBHashCode(fa);g.setConnAuthorized(E.isConnAuthorized());g.setSchemaAuthorized(E.isAuthorizedSchema());g.setDbCenterAuthorized(E.isAuthorizedDBCenter());g.setUiDisplay(B);var Y=E.getReference();Y&&g.setReference(Y.copy());return g};var M=function(g){var Y=p.get("dataBase","\u6570\u636e\u5e93")+": ";g&&(Y+="\r\n    ");return Y=E.getMacroStatus()!=F.MacroStatusEnum.AVAILABLE?
Y+p.get("dbConnectionUnset","\u672a\u8bbe\u7f6e\u6570\u636e\u5e93\u8fde\u63a5"):Y+R.getName()}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.macro&&(com.kingdee.bos.qing.macro={});"undefined"==typeof com.kingdee.bos.qing.macro.model&&(com.kingdee.bos.qing.macro.model={});var F=com.kingdee.bos.qing.macro.model;
F.SQLMacro=y;var O,Q,p;(function(){var E=com.kingdee.bos.qing.data;Q=E.VariateHelperFactory;E=com.kingdee.bos.qing.dbmanage;O=E.DBConnection;E=com.kingdee.bos.qing.framework.common;p=E.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.macro)})();var ta="SQL";F.DataCenterAuthChecker=new function(){var E=!1;this.setAuthority=function(oa){E=oa};this.hasAuthority=function(){return E}};F.SQLMacroConstant={LINE_SQL_CHAR_MAX_NUM:100,SQL_LINE_MAX_NUM:7};F.SqlTypeEnum={SQL_TYPE_KSQL:"KSQL",SQL_TYPE_SQL:"SQL"}})();(function(){function y(){pa.call(this);var f=this,ea,v,B,D,C,U,M,g,Y=!0;this.setType(oa);this.setEntityNumber=function(d){g=d};this.getEntityNumber=function(){return g};this.setMasterAppId=function(d){M=d};this.getMasterAppId=function(){return M};this.getNoPermPropertyNames=function(){return U};this.setNoPermPropertyNames=function(d){U=d};this.getNotExistPropertyNames=function(){return C};this.setNotExistPropertyNames=function(d){C=d};this.setSelectedProperties=function(d){B=d};this.getSelectedProperties=
function(){return B};this.getSelectedPropertyNames=function(){return D};this.setSelectedPropertyNames=function(d){D=d};this.getEntityFullName=function(){return v};this.setEntityFullName=function(d){v=d};this.getEntityPath=function(){return ea};this.setEntityPath=function(d){ea=d};this.getUiDisplay=function(){return Y};this.setUiDisplay=function(d){Y=d};this.getTypeText=function(){return fa.get("entityMacro","\u57fa\u7840\u6570\u636e\u5b8f")};this.getContentText=function(){var d=fa.get("entity","\u57fa\u7840\u8d44\u6599")+
": ";d+=(v?v:fa.get("entityNotSet","\u672a\u8bbe\u7f6e\u57fa\u7840\u8d44\u6599"))+"; ";d+=fa.get("returnProperty","\u8fd4\u56de\u5b57\u6bb5")+": ";return d=D&&0<D.length?d+ia(D,B,3,!1):d+fa.get("propertyNotSet","\u672a\u9009\u62e9\u5b57\u6bb5")};this.getTipsText=function(){var d=fa.get("entity","\u57fa\u7840\u8d44\u6599")+":\r\n    ";d=v?d+(v+"("+g+")"):d+fa.get("entityNotSet","\u672a\u8bbe\u7f6e\u57fa\u7840\u8d44\u6599");d+="\r\n"+fa.get("returnProperty","\u8fd4\u56de\u5b57\u6bb5")+":\r\n    ";return d=
D&&0<D.length?3<D.length?d+ia(D,B,-1,!0):d+ia(D,B,3,!1):d+fa.get("propertyNotSet","\u672a\u9009\u62e9\u5b57\u6bb5")};this.validateModelForType=function(){if(!ea)return fa.get("noEntity","\u8bf7\u9009\u62e9\u57fa\u7840\u8d44\u6599\u3002");if(!D||0==D.length)return fa.get("noReturnProperty","\u8bf7\u9009\u62e9\u8fd4\u56de\u5b57\u6bb5\u3002")};this.getStatusWarning=function(){switch(this.getMacroStatus()){case R.ENTITY_NOT_EXIST:var d=fa.get("macroEntityNotExist",'\u57fa\u7840\u8d44\u6599"#1"\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u7ee7\u7eed\u4f7f\u7528\u3002').replace("#1",
v);break;case R.PROPERTY_ABNORMAL:d=C;var ma=d?d.length:0;if(0<ma&&3>=ma)var la=fa.get("macroFieldDeleteTips",'\u5b8f\u53d8\u91cf\u4f7f\u7528\u7684"#1" \u5b57\u6bb5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002').replace("#1",d.join("\u3001"));else if(3<ma){la=fa.get("manyMacroFieldDeleteTips","\u4ee5\u4e0b\u5b57\u6bb5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");for(var G=0;G<ma;G++)0==G%3&&(la+="\n"),la+=
d[G]+"\u3001";la=la.substring(0,la.length-1)}d=la}return d};this.copy=function(){var d=new y;d.setUid(f.getUid());d.setFid(f.getFid());d.setName(f.getName());d.setDesc(f.getDesc());d.setMultiValued(f.isMultiValued());d.setType(f.getType());d.setMacroStatus(f.getMacroStatus());d.setCreatorId(f.getCreatorId());d.setCreatorName(f.getCreatorName());d.setCreateTime(f.getCreateTime());d.setModifierId(f.getModifierId());d.setModifyTime(f.getModifyTime());d.setModifierName(f.getModifierName());d.setMasterAppId(f.getMasterAppId());
d.setSelectedProperties(f.getSelectedProperties());d.setSelectedPropertyNames(f.getSelectedPropertyNames());d.setEntityPath(f.getEntityPath());d.setEntityFullName(f.getEntityFullName());d.setNotExistPropertyNames(f.getNotExistPropertyNames());d.setNoPermPropertyNames(f.getNoPermPropertyNames());d.setEntityNumber(f.getEntityNumber());d.setUiDisplay(Y);var ma=f.getReference();ma&&d.setReference(ma.copy());return d};var ha=f.toJsonObject;this.toJsonObject=function(){var d=ha();d.masterAppId=M;d.entityPath=
ea;d.entityFullName=v;d.notExistPropertyNames=C;d.selectedProperties=B;d.selectedPropertyNames=D;d.noPermPropertyNames=U;d.entityNumber=g;return d};var w=f.fromJsonObject;this.fromJsonObject=function(d){w(d);M=d.masterAppId;ea=d.entityPath;v=d.entityFullName;C=d.notExistPropertyNames;D=d.selectedPropertyNames;U=d.noPermPropertyNames;g=d.entityNumber;d=d.selectedProperties;B=[];if(d)for(var ma in d){var la=new F;la.fromJsonObject(d[ma]);B.push(la)}};var ia=function(d,ma,la,G){if(!d||0==d.length)return"";
for(var Na={},S=0;S<ma.length;S++)Na[ma[S].getName()]=ma[S];var da=0<la?Math.min(la,d.length):d.length,Z="";for(S=0;S<da;S++){G&&5<=S&&0==S%5&&(Z+="\r\n    ");var r=Na[d[S]];r=r?r.getAlias():d[S];Z+=r+fa.get("commaChar","\u3001")}Z=Z.substring(0,Z.length-1);0<la&&ma.length>la&&(Z+=fa.get("moreReturnProperty","\u7b49#1\u4e2a\u5b57\u6bb5").replace("#1",d.length));return Z}}function F(){var f,ea;this.getName=function(){return f};this.setName=function(v){f=v};this.getAlias=function(){return ea};this.setAlias=
function(v){ea=v};this.copy=function(){var v=new F;v.setName(_this.getName());v.setAlias(_this.getAlias());return v};this.toJsonObject=function(){var v={};v.name=f;v.alias=ea;return v};this.fromJsonObject=function(v){f=v.name;ea=v.alias}}function O(){var f,ea,v,B,D;this.setName=function(C){f=C};this.getName=function(){return f};this.setDisplayName=function(C){ea=C};this.getDisplayName=function(){return ea};this.setCommentInfo=function(C){v=C};this.getCommentInfo=function(){return v};this.setModelId=
function(C){B=C};this.getModelId=function(){return B};this.setParentNode=function(C){D=C};this.getParentNode=function(){return D};this.getSubNodeLevel=function(){for(var C=-1,U=D;U;)C++,U=U.getParentNode();return C}}function Q(){O.call(this);var f=this,ea=[];this.setChildren=function(v){ea=v};this.getChildren=function(){return ea};this.fromJsonObject=function(v){f.setName(v.name);f.setDisplayName(v.displayName);f.setCommentInfo(v.commentInfo);if(v=v.children)for(var B=0;B<v.length;B++){var D=v[B];
if("app"===D.type){var C=new p;C.fromJsonObject(D);C.setParentNode(f);ea.push(C)}else C=new Q,C.fromJsonObject(D),C.setParentNode(f),ea.push(C)}}}function p(){O.call(this);var f=this,ea,v=[];this.setType=function(B){ea=B};this.getType=function(){return ea};this.getEntities=function(){return v};this.setEntities=function(B){v=B};this.fromJsonObject=function(B){f.setType(B.type);f.setName(B.name);f.setDisplayName(B.displayName);f.setCommentInfo(B.commentInfo);f.setModelId(B.id);var D=[];B=B.entities;
if(D)for(var C=0;C<B.length;C++){var U=B[C],M=new ta;M.fromJsonObject(U);D.push(M)}f.setEntities(D)}}function ta(){var f=this,ea,v,B,D;this.getName=function(){return ea};this.setName=function(C){ea=C};this.getNumber=function(){return v};this.setNumber=function(C){v=C};this.getAppId=function(){return B};this.setAppId=function(C){B=C};this.getCloudId=function(){return D};this.setCloudId=function(C){D=C};this.fromJsonObject=function(C){f.setName(C.name);f.setNumber(C.number);f.setCloudId(C.cloudId);
f.setAppId(C.appId)}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.macro&&(com.kingdee.bos.qing.macro={});"undefined"==typeof com.kingdee.bos.qing.macro.model&&(com.kingdee.bos.qing.macro.model={});var E=com.kingdee.bos.qing.macro.model;E.EntityMacro=y;E.EntityAssociate=function(){var f,ea,v,B,D,
C;this.getEntityPath=function(){return f};this.setEntityPath=function(U){f=U};this.setCloudId=function(U){ea=U};this.getCloudId=function(){return ea};this.setAppId=function(U){v=U};this.getAppId=function(){return v};this.setEntityNumber=function(U){B=U};this.getEntityNumber=function(){return B};this.setEntityFullName=function(U){D=U};this.getEntityFullName=function(){return D};this.setMasterAppId=function(U){C=U};this.getMasterAppId=function(){return C}};E.DesignTimeEntity=function(){var f,ea;this.setProperties=
function(v){f=v};this.getProperties=function(){return f};this.setPkName=function(v){ea=v};this.getPkName=function(){return ea};this.fromJsonObject=function(v){ea=v.pkName;v=v.properties;f=[];if(v)for(var B in v){var D=new F;D.fromJsonObject(v[B]);f.push(D)}}};E.AbstractNode=O;E.FolderNode=Q;E.AppLeafNode=p;var oa="ENTITY",R=E.MacroStatusEnum,pa=E.Macro;var fa=com.kingdee.bos.qing.framework.common.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.macro)})();(function(){"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.macro&&(com.kingdee.bos.qing.macro={});var y=com.kingdee.bos.qing.macro;y.Toolbar=function(){var E,oa=$("<div>"),R=$("<div>"),pa=$("<div>");this.getJqUi=function(){E||(E=$("<div>"),E.addClass("macro-toolbar"),oa.addClass("macro-toolbar-sub"),
oa.appendTo(E),R.addClass("macro-toolbar-sub"),R.appendTo(E),pa.addClass("macro-toolbar-sub"),pa.appendTo(E));return E};this.addSeperator=function(){fa(R)};this.addSeperatorForHeadCustom=function(){fa(oa)};this.addButton=function(v,B,D,C){return f(R,!1,v,B,D,C)};this.addButtonForHeadCustom=function(v,B,D,C){return f(oa,!1,v,B,D,C)};this.addButtonForTailCustom=function(v,B,D,C){return f(pa,!1,v,B,D,C)};this.addMenuButton=function(v,B,D,C){return f(R,!0,v,B,D,C)};this.addMenuButtonForHeadCustom=function(v,
B,D,C){return f(oa,!0,v,B,D,C)};this.addMenuButtonForTailCustom=function(v,B,D,C){return f(pa,!0,v,B,D,C)};var fa=function(v){var B=$("<div>");B.addClass("macro-toolbar-seperator");B.appendTo(v)},f=function(v,B,D,C,U,M){var g=new O;g.setIconSetter(function(Y,ha){y.Icons.background(Y,ha)});g.setIconName(C);g.setText(U);g.setTooltips(M);B&&g.setShowDropdownArrow(!0);g.addActionListener(function(Y,ha){B?ea(Y.getJqUi(),ha,D,v):D(Y)});g.getJqUi().appendTo(v);return g},ea=function(v,B,D,C){var U=v.data("menu");
if(U&&U.isShowing())v.data("menu",null),U.hide();else{U=new F;U.setModel(D());U.setHideListener(function(){v.data("menu",null)});v.data("menu",U);D=null==C?R:C;C=v.prop("offsetLeft");var M=v.prop("offsetHeight")+v.prop("offsetTop");U.show(D,C,M,B,!0)}}};y.MacroFacade=function(E,oa,R,pa){p.call(this,E,oa,R,pa);var fa=this.protectedMethod;this.checkMacroPermission=function(){var f={};ta(f);fa.remote("checkMacroPermission",f)};this.getDesignTimeEntity=function(f){f={entityPath:f};ta(f);fa.remote("getDesignTimeEntity",
f)};this.saveMacro=function(f,ea){f={model:JSON.stringify(f.toJsonObject()),macroType:ea};ta(f);fa.remote("saveMacro",f)};this.checkPermissionBeforeEdit=function(f,ea){f={model:JSON.stringify(f.toJsonObject()),macroType:ea};ta(f);fa.remote("checkPermissionBeforeEdit",f)};this.updateMacro=function(f,ea){f={model:JSON.stringify(f.toJsonObject()),macroType:ea};ta(f);fa.remote("updateMacro",f)};this.loadMacros=function(f,ea,v){fa.remote("loadMacros",{targetPage:f,pageSize:ea,searchText:v})};this.checkMacroPermissionBeforePreview=
function(f,ea){fa.remote("checkMacroPermissionBeforePreview",{macroType:f,macroUid:ea})};this.loadAllMacroIds=function(f){fa.remote("loadAllMacroIds",{searchText:f})};this.loadMacrosRefTimeByFIds=function(f){f={macroIds:JSON.stringify(f)};fa.remote("loadMacrosRefTimeByFIds",f)};this.checkDataCenterPermission=function(f){fa.remote("checkDataCenterPermission",{macroType:f})};this.loadMacro=function(f,ea){fa.remote("loadMacro",{macroId:f,macroType:ea})};this.loadSharedMacros=function(f){fa.remote("loadSharedMacros",
{macroType:f})};this.deleteMacros=function(f){f={macroIds:JSON.stringify(f)};ta(f);fa.remote("deleteMacros",f)};this.exportMacros=function(f){f={macroIds:JSON.stringify(f)};ta(f);fa.remote("exportMacros",f)};this.loadDBConnections=function(){fa.remote("loadDBConnections",{})};this.getSupportedSystemVarType=function(){fa.remote("getSupportedSystemVarType",{})};this.getOptionalImportMacro=function(f){f={filePath:f};ta(f);fa.remote("getOptionalImportMacro",f)};this.importMacros=function(f,ea){for(var v=
[],B=0,D=f.length;B<D;B++)v.push(JSON.stringify(f[B].toJsonObject()));f={models:JSON.stringify(v),strategy:ea};ta(f);fa.remote("importMacros",f)}};var F,O,Q,p=y.MacroRuntimeFacade;(function(){var E=com.kingdee.bos.qing.ui.component;O=E.ToolbarButton;F=E.Menu;E=com.kingdee.bos.qing;Q=E.Seer})();var ta=function(E){var oa=y.MacroAppendSceneParams.getFunAppendMoreParams();oa&&oa(E);E.appID=Q.getUrlParamValue("appID")};y.DataCenterInfoHelper=new function(){var E;this.registerInfoGetter=function(oa){E=
oa};this.loadDataCenterDBType=function(oa,R,pa){E.loadDataCenterDBType(oa,R,pa)}};y.MacroAppendSceneParams=new function(){var E;this.addFunAppendMoreParams=function(oa){E=oa};this.getFunAppendMoreParams=function(){return E}};y.MacroFactory=new function(){var E={};this.registerConstructor=function(oa,R){E[oa]=R};this.getMacroInstance=function(oa){return new E[oa]}};y.DraggableAdjustingCustomExpandor=function(){KTableUIDraggableAdjustingHandler.CustomExpendor.call(this);this.getTailBlankForDragging=
function(){return 0}}})();(function(){"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.macro&&(com.kingdee.bos.qing.macro={});var y=com.kingdee.bos.qing.macro;y.MacroEntityFacade=function(p,ta,E,oa){F.call(this,p,ta,E,oa);var R=this.protectedMethod;this.getUsableEntities=function(pa,fa){pa={cloudOrAppSearchText:pa,entitySearchText:fa};
(fa=y.MacroAppendSceneParams.getFunAppendMoreParams())&&fa(pa);R.remote("getUsableEntities",pa)};this.getDesignTimeEntity=function(pa){pa={entityPath:pa};var fa=y.MacroAppendSceneParams.getFunAppendMoreParams();fa&&fa(pa);R.remote("getDesignTimeEntity",pa)}};var F,O=y.RemoteImpl,Q;(function(){var p=com.kingdee.bos.qing.framework.common;F=p.AbstractFacade;p=com.kingdee.bos.qing.macro.model;Q=p.EntityAssociate})();y.MacroRemoteHelper=new function(){this.getMacroEntityRemote=function(){var p=com.kingdee.bos.qing.common.Util.decodeParamFromUrl(window.location.search,
"path");p=(p?p:"/ierp")+"/qing/macroEntity.do";var ta=new O;ta.setRemoteUrl(p);return ta}};y.EntityHelper=new function(){this.getEntityNumber=function(p){if(p&&(p=p.split("\u0001"),3<=p.length))return p[2]};this.appendEntityPath=function(p,ta){return p?ta?p+"\u0001"+ta:p:ta};this.buildEntityAssociate=function(p,ta,E){if(p){var oa=p.split("\u0001");if(3<=oa.length){var R=new Q;R.setEntityPath(p);R.setCloudId(oa[0]);R.setAppId(oa[1]);R.setEntityNumber(oa[2]);R.setEntityFullName(ta);R.setMasterAppId(E);
return R}}}}})();(function(){function y(x){oa.call(this);var m=this,H=this.protectedMethod,I,J,A,c;(function(){H.setTitle(G.get("createSQLMacro","\u65b0\u5efaSQL\u5b8f"));m.setSize(450,590);H.setSelectable(!0);H.setContentPaneCreator(function(){I||(I=new O(x),I.setOuterMessageCurtain(H.getMessageCurtain()),I.registerDataCenterSelectorConstructor(A),I.registerSuperQuerySelectorConstructor(c));return I.createJqUi()});H.setClosingChecker2(function(n){var l=I.getModel();if(n=l.validateModel())return H.getMessageCurtain().showPrompt(n),
!1;(new M(x,function(k){l.fromJsonObject(k);l.setConnAuthorized(!0);J&&J(l);H.destroy();return!0},function(k,a){return"1200001"==k?(H.getMessageCurtain().showPrompt(G.get("duplicateName","\u540d\u79f0\u91cd\u590d\u3002")),!0):"1200002"==k?(k=new R,k.setDetail(a),k.setOptionType(R.OPTION_OK),k.setTitle(G.get("macroCreateFailed","\u65b0\u5efa\u5931\u8d25")),k.setMessage(G.get("macroCannotExe","\u8be5\u5b8f\u65e0\u6cd5\u6b63\u5e38\u6267\u884c\uff0c\u8bf7\u68c0\u67e5SQL\u8bed\u53e5\u662f\u5426\u6b63\u786e\u3001\u6570\u636e\u5e93\u8fde\u63a5\u662f\u5426\u6b63\u5e38\u3002")),
k.showDialog(),!0):"1200005"==k?(H.getMessageCurtain().showPrompt(G.get("duplicateUid","\u7f16\u7801\u91cd\u590d\u3002")),!0):"1200009"==k?(H.getMessageCurtain().showPrompt(G.get("noMenuPermission","\u60a8\u6ca1\u6709\u5f53\u524d\u83dc\u5355\u6743\u9650\u3002")),!0):"1200004"==k?(H.getMessageCurtain().showPrompt(G.get("macroNoDbConnPermission","\u60a8\u6ca1\u6709\u9009\u62e9\u7684\u6570\u636e\u5e93\u8fde\u63a5\u7684\u6743\u9650\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002")),!0):"1200010"==k?(H.getMessageCurtain().showPrompt(G.get("macroDbConnDeleted",
"\u9009\u62e9\u7684\u6570\u636e\u5e93\u8fde\u63a5\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002")),!0):!1})).saveMacro(l,E)},function(n){H.destroy();return!0});H.setClosingAction(function(n){})})();this.setCreateSuccessCallback=function(n){J=n};this.registerDataCenterSelectorConstructor=function(n){A=n;I&&I.registerDataCenterSelectorConstructor(A)};this.registerSuperQuerySelectorConstructor=function(n){c=n;I&&I.registerSuperQuerySelectorConstructor(c)}}function F(x,m){oa.call(this);
var H=this,I=this.protectedMethod,J,A,c,n;(function(){I.setTitle(G.get("editMacro","\u7f16\u8f91SQL\u5b8f"));H.setSize(450,590);I.setSelectable(!0);I.setContentPaneCreator(function(){J||(J=new O(x),J.setUpdateMode(!0),J.setModel(m),J.setOuterMessageCurtain(I.getMessageCurtain()),J.registerDataCenterSelectorConstructor(c),J.registerSuperQuerySelectorConstructor(n));return J.createJqUi()});I.setClosingChecker2(function(k){k=J.getModel();var a=k.validateModel();if(a)return I.getMessageCurtain().showPrompt(a),
!1;l(k)},function(k){I.destroy();return!0});I.setClosingAction(function(k){})})();this.setUpdateSuccessCallback=function(k){A=k};this.registerDataCenterSelectorConstructor=function(k){c=k;J&&J.registerDataCenterSelectorConstructor(c)};this.registerSuperQuerySelectorConstructor=function(k){n=k;J&&J.registerSuperQuerySelectorConstructor(n)};var l=function(k){(new M(x,function(a){A&&A();I.destroy()},function(a,b){return"1200001"==a?(I.getMessageCurtain().showPrompt(G.get("duplicateName","\u540d\u79f0\u91cd\u590d\u3002")),
!0):"1200002"==a?(a=new R,a.setDetail(b),a.setOptionType(R.OPTION_OK),a.setTitle(G.get("macroUpdateFailed","\u7f16\u8f91\u5931\u8d25")),a.setMessage(G.get("macroCannotExe","\u8be5\u5b8f\u65e0\u6cd5\u6b63\u5e38\u6267\u884c\uff0c\u8bf7\u68c0\u67e5SQL\u8bed\u53e5\u662f\u5426\u6b63\u786e\u3001\u6570\u636e\u5e93\u8fde\u63a5\u662f\u5426\u6b63\u5e38\u3002")),a.showDialog(),!0):"1200003"==a?(I.getMessageCurtain().showPrompt(G.get("macroNotFound","\u5b8f\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002")),
!0):"1200009"==a?(I.getMessageCurtain().showPrompt(G.get("noMenuPermission","\u60a8\u6ca1\u6709\u5f53\u524d\u83dc\u5355\u6743\u9650\u3002")),!0):"1200004"==a?(I.getMessageCurtain().showPrompt(G.get("macroNoDbConnPermission","\u60a8\u6ca1\u6709\u9009\u62e9\u7684\u6570\u636e\u5e93\u8fde\u63a5\u7684\u6743\u9650\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002")),!0):"1200010"==a?(I.getMessageCurtain().showPrompt(G.get("macroDbConnDeleted","\u9009\u62e9\u7684\u6570\u636e\u5e93\u8fde\u63a5\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002")),
!0):!1})).updateMacro(k,E)}}function O(x){var m,H,I,J,A,c,n,l,k,a,b,u,t,K,X,Aa,ra=!1,Ea=!0,Ba=!1,Ca=!0;this.setUpdateMode=function(e){ra=e};this.createJqUi=function(){var e=$("<div>");I||Ma();var h=new pa(G.get("code","\u7f16\u7801"));h.setRequired(!0);h=h.getJqUi();var ba=H.getJqUi(),L=new pa,T=L.getJqUi();L.setRequired(!0);L.setText(G.get("name","\u540d\u79f0"));L=I.getJqUi();var na=new pa,wa=na.getJqUi();na.setText(G.get("desc","\u63cf\u8ff0"));na=J.getJqUi();var sa=new pa,Da=sa.getJqUi();sa.setRequired(!0);
var Fa=G.get("returnValueType","\u8fd4\u56de\u503c");sa.setText(Fa);Da.attr("title",Fa);sa=A.getJqUi();var La=new pa,Oa=La.getJqUi();La.setRequired(!0);Fa=G.get("DBConnection","\u6570\u636e\u5e93\u8fde\u63a5");La.setText(Fa);Oa.attr("title",Fa);Fa=c.getJqUi();var ya=new pa;La=ya.getJqUi();ya.setRequired(!0);ya.setText(G.get("content","\u5185\u5bb9"));u=$("<textarea spellcheck='false'>");u.addClass("macro-sql-text-area");ya=Z.getImpl(Z.SYS_VAR_HELPER);m&&ya.switchSQLToDisplayMode(m.getContent(),function(Xa){u.text(Xa)});
if(Na.isIEBrowser())u.on("beforedeactivate",function(){t=u[0].selectionStart});b=n.getJqUi();ya=l.getJqUi();var Ra=k.getJqUi(),za=8,Ha=0;S.layoutCtrl(h,za,Ha,80,23);S.layoutCtrl(T,za,Ha+=43,80,23);S.layoutCtrl(wa,za,Ha+=43,80,23);S.layoutCtrl(Da,za,Ha+=43,80,23);S.layoutCtrl(Oa,za,Ha+=43,80,23);S.layoutCtrl(La,za,Ha+=43,80,23);S.layoutCtrl(a,za,Ha+=224,60,23);a.css("line-height","23px");za+=90;Ha=0;S.layoutCtrl(ba,za,Ha,300-(ra?0:23),23);S.layoutCtrl(L,za,Ha+=43,300,23);S.layoutCtrl(na,za,Ha+=43,
300,23);S.layoutCtrl(sa,za,Ha+=43,300,23);S.layoutCtrl(Fa,za,Ha+=43,300,23);S.layoutCtrl(ya,za,Ha+=43,114,23);S.layoutCtrl(b,za+114+10,Ha,114,23);S.layoutCtrl(u,za,Ha+=43,300,138);S.layoutCtrlWithLRTB(Ra,null,14,"auto",Ha+=148,null,23);Ra.addClass("macro-system-var-selector");h.appendTo(e);T.appendTo(e);wa.appendTo(e);Da.appendTo(e);Oa.appendTo(e);La.appendTo(e);ba.appendTo(e);L.appendTo(e);na.appendTo(e);sa.appendTo(e);Fa.appendTo(e);u.appendTo(e);b.appendTo(e);ya.appendTo(e);Ra.appendTo(e);a.appendTo(e);
Ea?b.show():(b.hide(),n.setChecked(!1));ra||(h=new fa,h.setIconType(fa.ICON_TYPE_QUESTION),h.setTipsText(G.get("uidTips","\u7f16\u7801\u5fc5\u987b\u7531\u5c0f\u5199\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\uff0c\u4e14\u521b\u5efa\u540e\u65e0\u6cd5\u66f4\u6539\uff01")),h=h.getJqUi(),S.layoutCtrlWithLRTB(h,null,10,16,2,null,16),h.appendTo(e));return e};this.setOuterMessageCurtain=function(e){K=e};this.setModel=function(e){m=e;Ia()};this.getModel=function(){return Pa()};this.registerDataCenterSelectorConstructor=
function(e){X=e};this.registerSuperQuerySelectorConstructor=function(e){Aa=e};var Ma=function(){H=new f;ra&&H.setEnabled(!1);I=new f;J=new f;A=new ea;A.setItemModels([!0,!1]);A.setSelected(!0);A.setCustomPainter(function(h,ba,L){h=L?G.get("multiValued","\u591a\u503c"):G.get("singleValued","\u5355\u503c");ba.text(h)});c=new p;c.addActionListener(Ja);c.setCustomPainter(function(h){if(h){var ba=$("<div>");ba.addClass("sa-ctrl-f7selector-text");ba.addClass("macro-db-f7selector-text");ba.text(h.getName());
if(h.isAuthError()){var L=h.getAbstractSource();var T=L.getConnectionType();L=T!=V.DBCONNECTION_TYPE_SUPERQUERY||L.getDbAddress()?T==V.DBCONNECTION_TYPE_DBCENTER?G.get("abnormalDbCenterAuth","\u5f53\u524d\u6570\u636e\u4e2d\u5fc3\u6743\u9650\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u6570\u636e\u5e93\u8fde\u63a5\u3002"):T==V.DBCONNECTION_TYPE_DB||T==V.DBCONNECTION_TYPE_SUPERQUERY&&L.getDbAddress()?G.get("abnormalSource","\u516c\u5171\u6570\u636e\u6e90\u201c#1\u201d\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u6570\u636e\u5e93\u8fde\u63a5\u3002").replace("#1",
h.getName()):void 0:G.get("abnormalSchema","\u8d85\u7ea7\u67e5\u8be2\u6a21\u5f0f\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u6570\u636e\u5e93\u8fde\u63a5\u3002")}else{if(h=Ca)h=!1,m&&(h=m.getMacroStatus(),h=h==d.DB_CENTER_NO_APP_METADATA||h==d.DB_CENTER_APP_CLOUD_DISABLED||h==d.DB_CENTER_APP_DISABLED||h==d.DB_CENTER_NO_APP);h&&(L=G.get("abnormalDbCenter","\u5f53\u524d\u6570\u636e\u4e2d\u5fc3\u8fde\u63a5\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u6570\u636e\u5e93\u8fde\u63a5\u3002"))}Ca=
!1;return L?(ba.css({color:"red"}),h=v.createWarning(),h.attr("title",L),L=$("<div>"),S.layoutCtrl(h,0,3,12,12),L.append(h),S.layoutCtrl(ba,20,10,240,20),L.append(ba),L):ba}return Ba?(ba=$("<div>"),L=v.createWarning(),L.attr("title",G.get("sourceDeleted","\u516c\u5171\u6570\u636e\u6e90\u8fde\u63a5\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u6570\u636e\u5e93\u8fde\u63a5\u3002")),S.layoutCtrl(L,0,3,12,12),ba.append(L),ba):$("<div>")});var e=new D;n=new B;n.setText(w.SQL_TYPE_KSQL);n.setUserObject(w.SQL_TYPE_KSQL);
e.addElement(n);l=new B;l.setText(w.SQL_TYPE_SQL);l.setUserObject(w.SQL_TYPE_SQL);e.addElement(l);l.setChecked(!0);k=new N;k.setText(G.get("insertSystemVar","\u63d2\u5165\u7cfb\u7edf\u53d8\u91cf"));k.setItemModels(r.SUPPORTED_VAR_TYPE);k.setItemsWidth(285);k.addPressedListener(Qa);k.setCustomPainter(function(h,ba,L){h?(h=$("<div>"),h.text(L)):(L=da.get(L.getI18nKey(),L.getDefaultDesc()),ba.attr("title",L),h=$("<div>"),h.text(L));h.appendTo(ba)});a=$("<div>");a.text(G.get("preview","\u9884\u89c8"));
a.addClass("macro-preview-btn");a.on("click",function(){var h=Pa(),ba;h.getDBInfo()||(ba=G.get("noDBConnection","\u8bf7\u9009\u62e9\u6570\u636e\u5e93\u8fde\u63a5\u3002"));var L=h.getContent();L&&""!=$.trim(L)?0!=L.trim().toLowerCase().indexOf("select")?ba=G.get("onlyAllowSelection","\u53ea\u5141\u8bb8\u67e5\u8be2\u64cd\u4f5c\u3002"):-1==L.indexOf("from")&&-1==L.indexOf("FROM")&&(ba=G.get("sqlError","sql\u6267\u884c\u51fa\u9519\uff0c\u8bf7\u68c0\u67e5sql\u8bed\u53e5\u3002")):ba=G.get("noQuery","\u8bf7\u8f93\u5165\u67e5\u8be2\u8bed\u53e5\u3002");
ba?K.showPrompt(ba):(h=new ma(x,h),h.setEditMacro(!0),h.showDialog())})},Qa=function(e,h,ba){e=Z.getImpl(Z.SYS_VAR_HELPER).getFormatText(h);var L=u[0];h=L.value;if(Na.isIEBrowser())L.value=h.substring(0,t)+e+h.substring(t,h.length),t+=e.length,L.setSelectionRange(t,t),L.focus();else{if("number"===typeof L.selectionStart&&"number"===typeof L.selectionEnd){ba=L.selectionStart;var T=L.selectionEnd;var na=ba;L.value=h.substring(0,ba)+e+h.substring(T,h.length);na+=e.length}else L.value+=e;setTimeout(function(){na&&
L.setSelectionRange(na,na);L.focus()},100)}},Ja=function(e){(new M(x,function(h){Y.setAuthority(!!h);h=new Q(x,!!h);h.registerDataCenterSelectorConstructor(X);h.registerSuperQuerySelectorConstructor(Aa);h.setDBSelectedCallback(function(L){c.setModel(L);var T=L.getDBSource();T&&(L.getDBSourceType()==z.SOURCE_TYPE_BIZMETA?T.getConnectionType()==V.DBCONNECTION_TYPE_DBCENTER?la.loadDataCenterDBType(T,function(na){(Ea=W.isNeedShowKSql(na))?b&&b.show():(b&&b.hide(),n.setChecked(!1))},function(na,wa){return!0}):
T.getConnectionType()==V.DBCONNECTION_TYPE_SUPERQUERY&&(Ea=!1,b&&b.hide(),n.setChecked(!1)):(Ea=W.isNeedShowKSql(T.getTypeName()))?b&&b.show():(b&&b.hide(),n.setChecked(!1)))});var ba=c.getModel();ba&&h.setModel(ba);h.setConnectionDeleted(Ba);m&&h.setMacroStatus(m.getMacroStatus());h.showDialog()})).checkDataCenterPermission(E)},Ia=function(){I||Ma();H.setText(m.getUid());I.setText(m.getName());J.setText(m.getDesc());A.setSelected(m.isMultiValued());m.getSQLType()==w.SQL_TYPE_KSQL?n.setChecked(!0):
l.setChecked(!0);Z.getImpl(Z.SYS_VAR_HELPER).switchSQLToDisplayMode(m.getContent(),function(L){u&&u.text(L)});var e=m.getDBInfo();if(e){var h=e.getDBSource();if(h)if(e.getDBSourceType()==z.SOURCE_TYPE_BIZMETA)if(h.getConnectionType()==V.DBCONNECTION_TYPE_DBCENTER){var ba=m.getMacroStatus();ba!=d.DB_CENTER_NO_APP_METADATA&&ba!=d.DB_CENTER_APP_CLOUD_DISABLED&&ba!=d.DB_CENTER_APP_DISABLED&&ba!=d.DB_CENTER_NO_APP&&la.loadDataCenterDBType(h,function(L){(Ea=W.isNeedShowKSql(L))?b&&b.show():(b&&b.hide(),
n.setChecked(!1))},function(L,T){return!0})}else h.getConnectionType()==V.DBCONNECTION_TYPE_SUPERQUERY&&(Ea=!1,b&&b.hide(),n.setChecked(!1));else(Ea=W.isNeedShowKSql(h.getTypeName()))?b&&b.show():(b&&b.hide(),n.setChecked(!1))}else Ba=!0;c.setModel(e)},Pa=function(){var e=m?m.copy():new g;var h=$.trim(H.getText());h=h.toLowerCase();var ba=$.trim(J.getText()),L=u.val();L=Z.getImpl(Z.SYS_VAR_HELPER).switchSQLToPersistentMode(L);var T=c.getModel();e.setUid(h);e.setName($.trim(I.getText()));e.setDesc(ba);
e.setMultiValued(A.getSelected());e.setContent(L);e.setDBInfo(T);h=l.isChecked()?l.getUserObject():n.getUserObject();e.setSQLType(h);return e}}function Q(x,m){oa.call(this);var H=this,I=this.protectedMethod,J,A,c,n,l,k=!1,a;(function(){I.setTitle(G.get("selectDBConnection","\u9009\u62e9\u6570\u636e\u5e93\u8fde\u63a5"));H.setSize(800,590);I.setSelectable(!0);I.setContentPaneCreator(function(){J||(J=new ta(x,m),n&&J.registerDataCenterSelectorConstructor(n),l&&J.registerSuperQuerySelectorConstructor(l),
c&&J.setModel(c),J.setConnectionDeleted(k),J.setMsgCurtain(I.getMessageCurtain()),J.setMacroStatus(a));return J.getJqUi()});I.setClosingChecker2(function(b){b=J.getSelectedDBConnection();var u=Y.hasAuthority();if(!b)return I.getMessageCurtain().showPrompt(G.get("noDBConnection","\u8bf7\u9009\u62e9\u6570\u636e\u5e93\u8fde\u63a5\u3002")),!1;var t=b.getDBSource();if(u||t.getConnectionType()!=V.DBCONNECTION_TYPE_DBCENTER)return A(b),I.destroy(),!0;I.getMessageCurtain().showPrompt(G.get("noDBCenterPermission",
"\u6ca1\u6709\u6570\u636e\u4e2d\u5fc3\u6743\u9650\uff0c\u8bf7\u5148\u8054\u7cfb\u7ba1\u7406\u5458\u5206\u914d\u6743\u9650\u3002"));return!1},function(b){I.destroy();return!0});I.setClosingAction(function(b){})})();this.setDBSelectedCallback=function(b){A=b};this.setModel=function(b){c=b;J&&J.setModel(b)};this.setMacroStatus=function(b){a=b};this.setConnectionDeleted=function(b){k=b};this.registerDataCenterSelectorConstructor=function(b){n=b;J&&J.registerDataCenterSelectorConstructor(n)};this.registerSuperQuerySelectorConstructor=
function(b){l=b;J&&J.registerSuperQuerySelectorConstructor(l)}}function p(){var x=this,m,H,I,J,A=[];this.setModel=function(k){I=k;l()};this.getModel=function(){return I};this.setCustomPainter=function(k){J=k;l()};this.addActionListener=function(k){A.push(k)};this.getJqUi=function(){if(!m){H=$("<div>");H.addClass("sa-ctrl-f7selector-textcontainer");var k=$("<div>");k.addClass("sa-ctrl-f7selector-btn");k.addClass("sa-ctrl-f7selector-btn_enabled");k.addClass("sa-ctrl-f7selector-btnedit");k.on("click",
c);U.background(k,"editor");m=$("<div>");m.addClass("sa-ctrl-f7selector");m.addClass("sa-ctrl-common-singlelineborder");m.append(H);m.append(k);l()}return m};var c=function(){for(var k=A.length,a=0;a<k;a++)(0,A[a])(x)},n=function(k){return $("<div>")},l=function(){if(H){var k=(J?J:n)(I);H.empty();k&&k.appendTo(H)}}}function ta(x,m){function H(){var P=[];this.addElement=function(va){P.push(va);va.addCheckedListener(aa)};var aa=function(va,qa){if(va.isChecked())for(qa=0;qa<P.length;qa++){var xa=P[qa];
xa!=va&&xa.setChecked(!1)}else if(qa){xa=!0;for(qa=0;qa<P.length;qa++)if(P[qa].isChecked()){xa=!1;break}xa&&va.setChecked(!0)}}}function I(P){KTDefaultCellRender.call(this,P);var aa=this,va=this.paintCellUI;this.paintCellUI=function(qa,xa){var Ga=aa.getCurrentRow(),Ta=aa.getCurrentColIdx();Ga=Ga.getUserObject();if(aa.getCurrentRowIdx()<C.getHeadRowCount())va(qa,xa);else if(0==Ta){var Va=new B;A&&A.getId()==Ga.getId()&&(c=Va,Va.setChecked(!0));Va.setUserObject(Ga);Va.addCheckedListener(function(db,
cb){cb&&(Ca&&Ca.setChecked(!0),c=Va,t&&t.hide())});Ga=Va.getJqUi();S.layoutCtrl(Ga,22,4,23,23);Ga.appendTo(qa);n[aa.getCurrentRowIdx()]=Va}else 1==Ta?(xa=$("<div>"),xa.text(Ga.getName()),xa.attr("title",Ga.getName()),xa.css("line-height","28px"),xa.css("padding-left","2px"),xa.css("padding-right","2px"),xa.appendTo(qa)):2==Ta?(xa=$("<div>"),Ga=Ga.getDBSource(),xa.text(Ga.getTypeName()),xa.attr("title",Ga.getTypeName()),Ga.getConnectionType()==V.DBCONNECTION_TYPE_SUPERQUERY&&(xa.text(Ga.getShortDisplay()),
xa.attr("title",Ga.getShortDisplay())),xa.css("line-height","28px"),xa.css("padding-left","2px"),xa.css("padding-right","2px"),xa.appendTo(qa)):3==Ta?(xa=$("<div>"),Ga=Ga.getDBSource(),Ta=Ga.getShortDisplay(),Ga.getConnectionType()==V.DBCONNECTION_TYPE_SUPERQUERY&&(Ta=Ga.getDbAddress()+" "+Ga.getDbName()),xa.text(Ta),xa.attr("title",Ta),xa.css("line-height","28px"),xa.css("padding-left","2px"),xa.css("padding-right","2px"),xa.appendTo(qa)):4==Ta&&(xa=$("<div>"),Ga=Ga.getDBSource(),Ga=Ga.getUserName(),
xa.text(Ga),xa.attr("title",Ga),xa.css("line-height","28px"),xa.css("padding-left","2px"),xa.css("padding-right","2px"),xa.appendTo(qa))}}var J,A,c,n,l,k,a,b,u,t,K,X,Aa,ra,Ea,Ba,Ca,Ma,Qa,Ja,Ia=[],Pa,e=[],h,ba,L,T,na=!!m,wa=!1,sa=!1,Da=!1,Fa;this.setMacroStatus=function(P){Fa=P};this.getJqUi=function(){J||(J=$("<div>"),Ha(La));return J};this.getSelectedDBConnection=function(){if(na&&Ma.isChecked()){var P=L.getSource();if(P){var aa=new z;aa.setDBSource(P);aa.setDBSourceType(z.SOURCE_TYPE_BIZMETA);aa.setName("");
return aa}}else if(Qa.isChecked()){if(P=T.getSource())return aa=new z,aa.setDBSource(P),aa.setDBSourceType(z.SOURCE_TYPE_BIZMETA),aa.setName(""),aa}else for(aa=0;aa<e.length;aa++)if(P=e[aa],P.isChecked())return P.getUserObject()};this.setModel=function(P){A=P};this.setConnectionDeleted=function(P){sa=P};this.setMsgCurtain=function(P){Aa=P};this.registerDataCenterSelectorConstructor=function(P){h=P};this.registerSuperQuerySelectorConstructor=function(P){ba=P};var La=function(){var P=0,aa=new D;aa.addChangedListener(function(qa,
xa){if(qa!==Ca){if(e)for(qa=0;qa<e.length;qa++)e[qa].setChecked(!1);t&&t.hide()}});Ma=new B;var va=G.get("dataCenter","\u5f53\u524d\u6570\u636e\u4e2d\u5fc3");na||(va+=G.get("dataCenterNoPermission","\uff08\u6ca1\u6709\u5f53\u524d\u6570\u636e\u4e2d\u5fc3\u6743\u9650\uff09"));Ma.setText(va);va=Ma.getJqUi();Ma.setCustomStyle("position","relative");va.addClass("macro-radio-button");k=$("<div>");va.appendTo(k);S.layoutCtrl(k,0,P,500,23);k.appendTo(J);aa.addElement(Ma);h&&(L=new h,L.setFunSelectedChangeListener(function(qa){if(A){var xa=
A.getDBSource();xa=xa?xa.getAppNumber():"";if(qa.value==xa)return}K&&K.hide()}),Ea=L.getJqUi(),S.layoutCtrl(Ea,0,P+=43,300,23),Ea.appendTo(J),A&&A.getDBSourceType()==z.SOURCE_TYPE_BIZMETA&&(va=A.getDBSource())&&va.getConnectionType()==V.DBCONNECTION_TYPE_DBCENTER&&L.setSource(va),na?Ea.css("pointer-events","auto"):Ea.css("pointer-events","none"));Qa=new B;Qa.setText(G.get("superQuery","\u8d85\u7ea7\u67e5\u8be2"));va=Qa.getJqUi();Qa.setCustomStyle("position","relative");va.addClass("macro-radio-button");
a=$("<div>");va.appendTo(a);S.layoutCtrl(a,0,P+=43,500,23);a.appendTo(J);aa.addElement(Qa);ba&&(T=new ba,Ba=T.getJqUi(),S.layoutCtrl(Ba,0,P+=43,300,23),Ba.appendTo(J),A&&A.getDBSourceType()==z.SOURCE_TYPE_BIZMETA&&(va=A.getDBSource())&&va.getConnectionType()==V.DBCONNECTION_TYPE_SUPERQUERY&&!va.getDbAddress()&&T.setSource(va),Ba.css("pointer-events","auto"));Qa.addCheckedListener(Xa);Ca=new B;Ca.setText(G.get("publicDBConnection","\u516c\u5171\u6570\u636e\u6e90"));va=Ca.getJqUi();Ca.setCustomStyle("position",
"relative");va.addClass("macro-radio-button");b=$("<div>");va.appendTo(b);S.layoutCtrl(b,0,P+=43,500,23);b.appendTo(J);aa.addElement(Ca);Ca.addCheckedListener(Ya);A&&A.isAuthError()?ya():A?Ra(A):sa&&(aa=G.get("publicSourceDeleted","\u8be5\u5b8f\u53d8\u91cf\u6700\u540e\u4fee\u6539\u4eba\u9009\u62e9\u7684\u516c\u5171\u6570\u636e\u6e90\u5df2\u88ab\u5220\u9664\u3002"),za(aa));l&&(S.layoutCtrl(l,0,P+=43,765,258),l.appendTo(J),X&&eb());Ma.setEnabled(na);Oa(A)},Oa=function(P){if(!P)return sa?Ca.setChecked(!0):
na?Ma.setChecked(!0):Qa.setChecked(!0),!0;P=P.getAbstractSource();var aa=P.getConnectionType();aa!=V.DBCONNECTION_TYPE_SUPERQUERY||P.getDbAddress()?aa==V.DBCONNECTION_TYPE_DBCENTER?Ma.setChecked(!0):(aa==V.DBCONNECTION_TYPE_DB||aa==V.DBCONNECTION_TYPE_SUPERQUERY&&P.getDbAddress())&&Ca.setChecked(!0):Qa.setChecked(!0)},ya=function(){var P=A.getAbstractSource(),aa=P.getConnectionType();if(aa==V.DBCONNECTION_TYPE_SUPERQUERY&&!P.getDbAddress())aa=v.createWarning(),aa.addClass("macro-radio-button-warning"),
aa.attr("title",G.get("modifierUnauthorizedSchema","\u6a21\u5f0f\u201c#1\u201d\u5df2\u88ab\u5220\u9664\u6216\u53d6\u6d88\u6388\u6743\u7ed9\u8be5\u5b8f\u53d8\u91cf\u7684\u6700\u540e\u4fee\u6539\u4eba\u3002").replace("#1",P.getSchemaName())),aa.appendTo(a),u=aa;else if(aa==V.DBCONNECTION_TYPE_DBCENTER)aa=v.createWarning(),aa.addClass("macro-radio-button-warning"),aa.attr("title",G.get("modifierUnauthorizedDbCenter","\u5f53\u524d\u6570\u636e\u4e2d\u5fc3\u5df2\u53d6\u6d88\u6388\u6743\u7ed9\u8be5\u5b8f\u53d8\u91cf\u7684\u6700\u540e\u4fee\u6539\u4eba\u3002")),
aa.appendTo(k);else if(aa==V.DBCONNECTION_TYPE_DB||aa==V.DBCONNECTION_TYPE_SUPERQUERY&&P.getDbAddress())P=G.get("modifierUnauthorizedSource","\u516c\u5171\u6570\u636e\u6e90\u201c#1\u201d\u5df2\u53d6\u6d88\u6388\u6743\u7ed9\u8be5\u5b8f\u53d8\u91cf\u7684\u6700\u540e\u4fee\u6539\u4eba\u3002").replace("#1",A.getName()),za(P)},Ra=function(P){var aa=P.getAbstractSource(),va=aa.getConnectionType(),qa=aa.getAppNumber?aa.getAppNumber():"";if(va==V.DBCONNECTION_TYPE_DBCENTER)if(na){switch(Fa){case d.DB_CENTER_NO_APP_METADATA:qa=
G.get("appMetadataNotExist",'\u5e94\u7528"#1"\u5143\u6570\u636e\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002').replace("#1",qa);break;case d.DB_CENTER_APP_CLOUD_DISABLED:qa=G.get("appCloudDisabled",'\u5e94\u7528"#1"\u6240\u5728\u4e91\u88ab\u7981\u7528\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002').replace("#1",qa);break;case d.DB_CENTER_APP_DISABLED:qa=G.get("appDisabled",'\u5e94\u7528"#1"\u88ab\u7981\u7528\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002').replace("#1",
qa);break;case d.DB_CENTER_NO_APP:qa=G.get("appNotExist",'\u5e94\u7528"#1"\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002').replace("#1",qa);break;default:qa=""}K=v.createWarning();K.addClass("macro-radio-button-warning");K.attr("title",qa);qa?K.show():K.hide();K.appendTo(k)}else P=v.createWarning(),P.addClass("macro-radio-button-warning"),P.attr("title",G.get("userUnauthorizedDbCenter","\u5b8f\u7684\u6700\u540e\u4fee\u6539\u4eba\u9009\u62e9\u7684\u662f\u201c#1\u201d\u5e94\u7528\u3002\n\u7531\u4e8e\u60a8\u6ca1\u6709\u5f53\u524d\u6570\u636e\u4e2d\u5fc3\u7684\u6743\u9650\uff0c\u6240\u4ee5\u4e0d\u80fd\u4fee\u6539\u5e94\u7528\u3002").replace("#1",
qa)),P.appendTo(k);else(va==V.DBCONNECTION_TYPE_DB||va==V.DBCONNECTION_TYPE_SUPERQUERY&&aa.getDbAddress())&&!Da&&(qa=G.get("userUnauthorizedSource","\u5b8f\u7684\u6700\u540e\u4fee\u6539\u4eba\u9009\u62e9\u7684\u662f\u201c#1\u201d\u6570\u636e\u6e90\u3002\n\u7531\u4e8e\u60a8\u6ca1\u6709\u8be5\u516c\u5171\u6570\u636e\u6e90\u7684\u6743\u9650\uff0c\u6240\u4ee5\u516c\u5171\u6570\u636e\u6e90\u5217\u8868\u4e2d\u6ca1\u6709\u663e\u793a\u6b64\u6570\u636e\u6e90\u3002").replace("#1",P.getName()),za(qa))},za=function(P){t||
(t=v.createWarning(),t.addClass("macro-radio-button-warning"),b.append(t));t.show();t.attr("title",P)},Ha=function(P){(new M(x,function(aa){l=$("<div>");l.css("border","1px solid #ccc");Ja=[];if(aa&&0!=aa.length){for(var va=0;va<aa.length;va++){var qa=new z;qa.fromJsonObject(aa[va]);Ja.push(qa);A&&A.getId()==qa.getId()&&(Da=!0)}Za();ra.appendTo(l)}else aa=$("<div>"),aa.addClass("macro-no-db-prompt"),aa.text(G.get("neverCreateDB","\u6682\u672a\u521b\u5efa\u6570\u636e\u5e93\u8fde\u63a5")),aa.appendTo(l);
P()},function(aa,va){Aa.showPrompt(va);return!0})).loadDBConnections()},Xa=function(){Ia&&0!=Ia.length||wa||!ba||(wa=!0,ba.loadUsableSchemas(function(P){Ia=P;T.setSchemas(Ia);if(A){var aa=A.getAbstractSource();if(aa.getConnectionType()==V.DBCONNECTION_TYPE_SUPERQUERY&&!aa.getDbAddress()){var va=!1;aa=aa.getSchemaName();for(var qa=0;qa<P.length;qa++)if(P[qa].getName()==aa){va=!0;break}va||(u&&u.remove(),P=v.createWarning(),P.addClass("macro-radio-button-warning"),P.attr("title",G.get("userUnauthorizedSchema",
"\u5b8f\u7684\u6700\u540e\u4fee\u6539\u4eba\u9009\u62e9\u7684\u662f\u201c#1\u201d\u6a21\u5f0f\u3002\n\u7531\u4e8e\u60a8\u6ca1\u6709\u8be5\u6a21\u5f0f\u7684\u6743\u9650\uff0c\u6240\u4ee5\u201c\u6a21\u5f0f\u201d\u4e0b\u62c9\u5217\u8868\u4e2d\u4e0d\u4f1a\u663e\u793a\u6b64\u6a21\u5f0f\u3002").replace("#1",aa)),P.appendTo(a))}}},Aa))},Ya=function(P,aa){aa&&(e&&0<e.length&&(c||(c=e[0]),c.setChecked(!0)),t&&t.hide())},Za=function(){X=C.createTable();X.setColumnFitVisibleWidth(!0);var P=new I(X);P.setOutsideVisible(!0);
X.setCellRender(P);X.setSyncUIWhenModelChanged(!0);ra=$(X.getUI());S.layoutCtrlWithLRTB(ra,0,0,null,0,0,null)},eb=function(){X||Za();C.clear(X);n={};X.addColumns(5);X.getColumn(0).setWidth(50);X.getColumn(1).setWidth(140);X.getColumn(2).setWidth(120);X.getColumn(3).setWidth(220);X.getColumn(4).setWidth(160);var P=C.createHeadRow(X);P.getCell(1).setValue(G.get("name","\u540d\u79f0"));P.getCell(2).setValue(G.get("type","\u7c7b\u578b"));P.getCell(3).setValue(G.get("dbAddress","\u5730\u5740"));P.getCell(4).setValue(G.get("user",
"\u7528\u6237"));P=0;for(var aa=Ja.length;P<aa;P++){var va=Ja[P];C.createRow(X).setUserObject(va)}C.refresh(X);Pa||(Pa=new H);for(var qa in n)P=n[qa],Pa.addElement(P),e.push(P);n={}}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.macro&&(com.kingdee.bos.qing.macro={});"undefined"==typeof com.kingdee.bos.qing.macro.sql&&
(com.kingdee.bos.qing.macro.sql={});com.kingdee.bos.qing.macro.sql.SQLMacroTypeItem=function(){ia.call(this,E,G.get("sqlMacro","SQL\u5b8f"));var x,m,H;this.setRemoteImpl=function(I){x=I};this.setDataCenterSelector=function(I){m=I};this.setSuperQuerySelector=function(I){H=I};this.showCreateDialog=function(I){var J=new y(x);J.registerDataCenterSelectorConstructor(m);J.registerSuperQuerySelectorConstructor(H);J.setCreateSuccessCallback(I);J.showDialog()};this.showEditDialog=function(I,J){J=new F(x,J);
J.registerDataCenterSelectorConstructor(m);J.registerSuperQuerySelectorConstructor(H);J.setUpdateSuccessCallback(I);J.showDialog()}};var E="SQL",oa,R,pa,fa,f,ea,v,B,D,C,U,M,g,Y,ha,w,ia,d,ma,la,G,Na,S,da,Z,r,N,W,V,z;(function(){var x=com.kingdee.bos.qing.macro;ma=x.PreviewDialog;la=x.DataCenterInfoHelper;M=x.MacroFacade;ha=x.MacroFactory;x=com.kingdee.bos.qing.macro.model;g=x.SQLMacro;Y=x.DataCenterAuthChecker;w=x.SqlTypeEnum;ia=x.AbstractMacroTypeItem;d=x.MacroStatusEnum;x=com.kingdee.bos.qing.framework.common;
G=x.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.macro);da=x.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.data);x=com.kingdee.bos.qing.ui.component;oa=x.AbstractModalDialog;R=x.MessageDialog;pa=x.Label;fa=x.HelpIcon;f=x.TextField;ea=x.ComboBox;B=x.RadioButton;D=x.RadioButtonGroup;U=x.Icons;x=com.kingdee.bos.qing.common;Na=x.Util;S=x.DomUtil;x=com.kingdee.bos.qing.data;Z=x.VariateHelperFactory;r=x.SystemVarType;N=x.DropdownItemListPane;W=x.DBSource;V=x.AbstractSource;
x=com.kingdee.bos.qing.common.ui;v=x.CommonIconUtil;C=x.TableUtil;x=com.kingdee.bos.qing.dbmanage;z=x.DBConnection})();ha.registerConstructor(E,g)})();(function(){function y(c){d.call(this);var n=this,l=this.protectedMethod,k=this.showDialog,a,b;(function(){l.setTitle(w.get("createEntityMacro","\u65b0\u5efa\u57fa\u7840\u6570\u636e\u5b8f"));n.setSize(450,400);l.setSelectable(!0);l.setContentPaneCreator(function(){a=new O(c);a.setOuterMessageCurtain(l.getMessageCurtain());return a.createJqUi()});l.setClosingChecker2(function(u){var t=a.getModel();if(u=t.validateModel())return l.getMessageCurtain().showPrompt(u),!1;(new f(c,function(K){t.fromJsonObject(K);
b&&b(t);l.destroy();return!0},function(K,X){return"1200001"==K?(l.getMessageCurtain().showPrompt(w.get("duplicateName","\u540d\u79f0\u91cd\u590d\u3002")),!0):"1200002"==K?(K=new ma,K.setDetail(X),K.setOptionType(ma.OPTION_OK),K.setTitle(w.get("macroCreateFailed","\u65b0\u5efa\u5931\u8d25")),K.setMessage(w.get("macroCannotExe","\u8be5\u5b8f\u65e0\u6cd5\u6b63\u5e38\u6267\u884c\uff0c\u8bf7\u68c0\u67e5\u5b8f\u4fe1\u606f\u662f\u5426\u6b63\u786e\u3002")),K.showDialog(),!0):"1200005"==K?(l.getMessageCurtain().showPrompt(w.get("duplicateUid",
"\u7f16\u7801\u91cd\u590d\u3002")),!0):"1200009"==K?(l.getMessageCurtain().showPrompt(w.get("noMenuPermission","\u60a8\u6ca1\u6709\u5f53\u524d\u83dc\u5355\u6743\u9650\u3002")),!0):!1})).saveMacro(t,oa)},function(u){l.destroy();return!0});l.setClosingAction(function(u){})})();this.setCreateSuccessCallback=function(u){b=u};this.showDialog=function(){k();J()}}function F(c,n,l){d.call(this);var k=this,a=this.protectedMethod,b=this.showDialog,u,t;(function(){a.setTitle(w.get("editEntityMacro","\u7f16\u8f91\u57fa\u7840\u6570\u636e\u5b8f"));
k.setSize(450,400);a.setSelectable(!0);a.setContentPaneCreator(function(){u=new O(c);u.setUpdateMode(!0);u.setModel(n);u.setOuterMessageCurtain(a.getMessageCurtain());u.setDesignTimeEntity(l);return u.createJqUi()});a.setClosingChecker2(function(X){X=u.getModel();var Aa=X.validateModel();if(Aa)return a.getMessageCurtain().showPrompt(Aa),!1;K(X)},function(X){a.destroy();return!0});a.setClosingAction(function(X){})})();this.setUpdateSuccessCallback=function(X){t=X};this.showDialog=function(){b();J()};
var K=function(X){(new f(c,function(Aa){t&&t();a.destroy()},function(Aa,ra){return"1200001"==Aa?(a.getMessageCurtain().showPrompt(w.get("duplicateName","\u540d\u79f0\u91cd\u590d\u3002")),!0):"1200002"==Aa?(Aa=new ma,Aa.setDetail(ra),Aa.setOptionType(ma.OPTION_OK),Aa.setTitle(w.get("macroUpdateFailed","\u7f16\u8f91\u5931\u8d25")),Aa.setMessage(w.get("macroCannotExe","\u8be5\u5b8f\u65e0\u6cd5\u6b63\u5e38\u6267\u884c\uff0c\u8bf7\u68c0\u67e5\u5b8f\u4fe1\u606f\u662f\u5426\u6b63\u786e\u3002")),Aa.showDialog(),
!0):"1200003"==Aa?(a.getMessageCurtain().showPrompt(w.get("macroNotFound","\u5b8f\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002")),!0):"1200009"==Aa?(a.getMessageCurtain().showPrompt(w.get("noMenuPermission","\u60a8\u6ca1\u6709\u5f53\u524d\u83dc\u5355\u6743\u9650\u3002")),!0):!1})).updateMacro(X,oa)}}function O(c){var n,l,k,a,b,u,t,K,X,Aa,ra,Ea,Ba,Ca;this.setUpdateMode=function(e){Aa=e};this.createJqUi=function(){var e=$("<div>");l||Qa();var h=new la(w.get("code","\u7f16\u7801"));h.setRequired(!0);
h=h.getJqUi();var ba=n.getJqUi(),L=new la,T=L.getJqUi();L.setRequired(!0);L.setText(w.get("name","\u540d\u79f0"));L=l.getJqUi();var na=new la,wa=na.getJqUi();na.setText(w.get("desc","\u63cf\u8ff0"));na=k.getJqUi();var sa=new la,Da=sa.getJqUi(),Fa=w.get("returnValueType","\u8fd4\u56de\u503c");sa.setText(Fa);Da.attr("title",Fa);sa=a.getJqUi();var La=new la,Oa=La.getJqUi();Fa=w.get("entity","\u57fa\u7840\u8d44\u6599");La.setText(Fa);Oa.attr("title",Fa);La=b.getJqUi();var ya=new la,Ra=ya.getJqUi();Fa=
w.get("returnProperty","\u8fd4\u56de\u5b57\u6bb5");ya.setText(Fa);Ra.attr("title",Fa);Fa=u.getJqUi();ya=8;var za=0;m.layoutCtrl(h,ya,za,80,23);m.layoutCtrl(T,ya,za+=43,80,23);m.layoutCtrl(wa,ya,za+=43,80,23);m.layoutCtrl(Da,ya,za+=43,80,23);m.layoutCtrl(Oa,ya,za+=43,80,23);m.layoutCtrl(Ra,ya,za+=43,80,23);m.layoutCtrl(X,ya,za+43,60,23);X.css("line-height","23px");ya+=90;za=0;m.layoutCtrl(ba,ya,za,300,23);m.layoutCtrl(L,ya,za+=43,300,23);m.layoutCtrl(na,ya,za+=43,300,23);m.layoutCtrl(sa,ya,za+=43,
300,23);m.layoutCtrl(La,ya,za+=43,300,23);t&&(m.layoutCtrl(t,ya-12-3,za,12,12),t.appendTo(e));m.layoutCtrl(Fa,ya,za+=43,300,23);K&&(m.layoutCtrl(K,ya-12-3,za,12,12),K.appendTo(e));h.appendTo(e);T.appendTo(e);wa.appendTo(e);Da.appendTo(e);Oa.appendTo(e);Ra.appendTo(e);ba.appendTo(e);L.appendTo(e);na.appendTo(e);sa.appendTo(e);La.appendTo(e);Fa.appendTo(e);X.appendTo(e);Aa||(h=new G,h.setIconType(G.ICON_TYPE_QUESTION),h.setTipsText(w.get("uidTips","\u7f16\u7801\u5fc5\u987b\u7531\u5c0f\u5199\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\uff0c\u4e14\u521b\u5efa\u540e\u65e0\u6cd5\u66f4\u6539\uff01")),
h=h.getJqUi(),m.layoutCtrlWithLRTB(h,null,10,16,2,null,16),h.appendTo(e));return e};this.setOuterMessageCurtain=function(e){ra=e};this.setDesignTimeEntity=function(e){Ba=e};this.setModel=function(e){Ea=e;Ca=e.getNotExistPropertyNames();l||Qa();n.setText(Ea.getUid());l.setText(Ea.getName());k.setText(Ea.getDesc());a.setSelected(Ea.isMultiValued());var h=v.buildEntityAssociate(e.getEntityPath(),e.getEntityFullName(),e.getMasterAppId());b.setModel(h);e=e.getSelectedPropertyNames();u.setModel(e);e=Ea.getMacroStatus();
h=Ea.getStatusWarning();e==U.ENTITY_NOT_EXIST?(t=Pa(h),K=Pa(h)):e==U.PROPERTY_ABNORMAL&&h&&(K=Pa(h))};this.getModel=function(){return Ma()};var Ma=function(){var e=Ea?Ea.copy():new D;e.setUid($.trim(n.getText()).toLowerCase());e.setName($.trim(l.getText()));e.setDesc($.trim(k.getText()));e.setMultiValued(a.getSelected());var h=b.getModel();h=h?h.getEntityPath():null;e.setEntityPath(h);h=u.getModel();e.setSelectedPropertyNames(h);return e},Qa=function(){n=new Na;Aa&&n.setEnabled(!1);l=new Na;k=new Na;
a=new S;a.setItemModels([!0,!1]);a.setSelected(!0);a.setCustomPainter(function(e,h,ba){e=ba?w.get("multiValued","\u591a\u503c"):w.get("singleValued","\u5355\u503c");h.text(e)});a.setEnabled(!1);b=new da;b.addActionListener(Ia);b.setCustomPainter(function(e){e&&e.getEntityFullName()?(e=e.getEntityFullName()+"("+e.getEntityNumber()+")",b.setTooltips(e)):e=w.get("selectEntityF7Tips","\u8bf7\u9009\u62e9\u57fa\u7840\u8d44\u6599");return e});u=new da;u.addActionListener(Ja);u.setCustomPainter(function(e){return e&&
0<e.length?(e=w.get("selectedPropertyNum","\u5df2\u9009\u62e9#1\u4e2a\u5b57\u6bb5").replace("#1",e.length),Ca&&0<Ca.length&&(e+=w.get("deletedPropertyNum","\uff0c\u5176\u4e2d#1\u4e2a\u5b57\u6bb5\u4e0d\u5b58\u5728").replace("#1",Ca.length)),e):w.get("selectPropertyF7Tips","\u8bf7\u9009\u62e9\u8fd4\u56de\u5b57\u6bb5")});X=$("<div>");X.text(w.get("preview","\u9884\u89c8"));X.addClass("macro-preview-btn");X.on("click",function(){var e=Ma(),h;!t&&e&&e.getEntityPath()?e.getSelectedPropertyNames()&&0!=e.getSelectedPropertyNames().length||
(h=w.get("noReturnProperty","\u8bf7\u9009\u62e9\u8fd4\u56de\u5b57\u6bb5\u3002")):h=w.get("noEntity","\u8bf7\u9009\u62e9\u57fa\u7840\u8d44\u6599\u3002");h?ra.showPrompt(h):(e=new pa(c,e),e.setEditMacro(!0),e.showDialog())})},Ja=function(){if(Ba){var e=new Q(c,Ba),h=[],ba=u.getModel();if(ba&&0<ba.length)for(var L in ba)Ca&&-1!=Ca.indexOf(ba[L])||h.push(ba[L]);e.setSelectedPropertyName(h);e.setPropertySelectedCallback(function(T){Ca=null;u.setModel(T);K&&(K.remove(),K=null)});e.showDialog();return!0}e=
w.get("noEntity","\u8bf7\u9009\u62e9\u57fa\u7840\u8d44\u6599\u3002");ra.showPrompt(e)},Ia=function(){var e=new p(c),h=b.getModel();h&&!t&&e.setEntityAssociate(h);e.setEntitySelectedCallback(function(ba,L){ba&&h&&ba.getEntityPath()==h.getEntityPath()||(Ba=L,b.setModel(ba),u.setModel(null),Ca=null,t&&(t.remove(),t=null),K&&(K.remove(),K=null))});e.showDialog()},Pa=function(e){var h=$("<span class='macro-db-connection-warning'>");h.text("!");h.attr("title",e);return h}}function Q(c,n){d.call(this);var l=
this,k=this.protectedMethod,a,b,u;(function(){k.setTitle(w.get("selectProperty","\u9009\u62e9\u5b57\u6bb5"));l.setSize(600,550);k.setSelectable(!0);k.setContentPaneCreator(function(){a=new E(c);a.setSelectedFieldName(u);a.setDesignTimeEntity(n);return a.getJqUi()});k.setClosingChecker2(function(t){if((t=a.getSelectedField())&&20<t.length)return t=w.get("overMaxPropertyNum","\u5b57\u6bb5\u4e2a\u6570\u4e0d\u80fd\u8d85\u8fc7#1\u4e2a\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002").replace("#1",20),k.getMessageCurtain().showPrompt(t),
!1;b(t);k.destroy();return!0},function(t){k.destroy();return!0});k.setClosingAction(function(t){})})();this.setPropertySelectedCallback=function(t){b=t};this.setSelectedPropertyName=function(t){u=t}}function p(c){d.call(this);var n=this,l=this.protectedMethod,k,a,b;(function(){l.setTitle(w.get("selectEntity","\u9009\u62e9\u57fa\u7840\u8d44\u6599"));n.setSize(750,550);l.setSelectable(!0);l.setContentPaneCreator(function(){k||(k=new ta(c),k.setMessageCurtain(l.getMessageCurtain()),b&&k.setEntityAssociate(b));
return k.getJqUi()});l.setClosingChecker2(function(u){var t=k.getEntityAssociate();if(t)(new fa(ea.getMacroEntityRemote(),function(K){if(K){var X=new C;X.fromJsonObject(K);a(t,X);l.destroy();return!0}K=w.get("noDesignTimeEntity","\u60a8\u9009\u62e9\u7684\u57fa\u7840\u8d44\u6599\u7684\u5143\u6570\u636e\u4e0d\u5b8c\u6574\uff0c\u65e0\u6cd5\u4f7f\u7528\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");l.getMessageCurtain().showPrompt(K);return!1},function(K,X){K=new ma;K.setOptionType(ma.RETURN_OK);K.setTitle(w.get("noDesignTimeEntity",
"\u60a8\u9009\u62e9\u7684\u57fa\u7840\u8d44\u6599\u7684\u5143\u6570\u636e\u4e0d\u5b8c\u6574\uff0c\u65e0\u6cd5\u4f7f\u7528\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002"));K.setClosedAction(function(){l.destroy()});K.setMessage(X);K.showDialog();return!1})).getDesignTimeEntity(t.getEntityPath());else return u=w.get("selectEntityTips","\u8bf7\u9009\u62e9\u4e00\u4e2a\u57fa\u7840\u8d44\u6599\u3002\u5207\u6362\u76ee\u5f55\u3001\u9875\u7801\uff0c\u66f4\u6539\u641c\u7d22\u6761\u4ef6\u4f1a\u6e05\u9664\u57fa\u7840\u8d44\u6599\u7684\u9009\u62e9\u72b6\u6001\u3002"),
l.getMessageCurtain().showPrompt(u),!1},function(u){l.destroy();return!0});l.setClosingAction(function(u){})})();this.setEntitySelectedCallback=function(u){a=u};this.setEntityAssociate=function(u){b=u}}function ta(c){function n(q){KTDefaultCellRender.call(this,q);var ja=this,ca=this.paintCellUI;this.paintCellUI=function(ka,ua){var Ka=ja.getCurrentRow(),Sa=ja.getCurrentColIdx(),Ua=ja.getCurrentRowIdx();Ka=Ka.getUserObject();var Wa=I.getHeadRowCount();Ua<Wa?ca(ka,ua):0==Sa?(ua=new N,ua.setUserObject(Ka),
wa&&wa.getNumber()==Ka.getNumber()&&ua.setChecked(!0),ua.addCheckedListener(Va),Ka=ua.getJqUi(),m.layoutCtrl(Ka,12,2,23,23),Ka.appendTo(ka),za.addElement(ua)):1==Sa?(ua=Ua-Wa+1,Ka=$("<div>"),Ka.text(ua),Ka.attr("title",ua),Ka.addClass("macro-tabel-cell-content"),ua=$(ka).width()/2-7.5,Ka.css("padding-left",4<ua?ua+"px":"4px"),Ka.appendTo(ka)):2==Sa?(ua=$("<div>"),ua.attr("title",Ka.getName()),ua.addClass("macro-tabel-cell-content"),A(ua,X,Ka.getName()),ua.appendTo(ka)):3==Sa&&(ua=$("<div>"),ua.attr("title",
Ka.getNumber()),ua.addClass("macro-tabel-cell-content"),A(ua,X,Ka.getNumber()),ua.appendTo(ka))}}function l(q){KTDefaultCellRender.call(this,q);var ja=this;this.paintCellUI=function(ca,ka){var ua=ja.getCell().getValue(),Ka=ua.getName(),Sa=ua.getDisplayName();$(ca).css("width","100%");ca=$("<div>");ca.addClass("macro-entity-app-list-item");ca.attr("app-id",H.encode(Ka));ca.attr("title",Sa);var Ua=$("<div>");Ua.addClass("macro-entity-app-list-item-text");A(Ua,ra,Sa);ca.append(Ua);ka=$(ka);ka.addClass("macro-app-tree-text-area");
ka.append(ca);ua instanceof g&&(X&&(ka=ua.getEntities())&&0<ka.length&&(ka="("+ka.length+")",Sa=$("<span>"),Sa.addClass("macro-app-tree-entity-count"),Sa.text(ka),ca.append(Sa),Ua.css("width","calc(100% - 50px)")),ca.on("click",{cellNode:ua},jb),sa&&sa.getName()==Ka&&ca.addClass("macro-entity-app-list-item_selected"))}}function k(q){KTDefaultTreeHandlerRender.call(this,q);var ja=this;this.create=function(ca,ka,ua,Ka,Sa,Ua,Wa){var bb=17*ca.getLevel();var $a=bb+14;var ab=null;if(ja.protectedMethod.isTreeNodeHasChildren(ca,
ka,ua)||ca.isHaveHandlerAlways())ab=ja.protectedMethod.createAbsoluteHtmlElement("div",bb,Sa,14,Wa),ab.style.cursor="pointer",ka=$(ab),ka.css("width","100%"),ua=$("<div>"),ka.append(ua),ca.isExpanded()?(ua.addClass("lower-triangle"),ua.removeClass("right-triangle")):(ua.addClass("right-triangle"),ua.removeClass("lower-triangle"));ka=[ab,$a,Sa,null];ca=ka[0];$a=ka[1];ab=ka[2];ka=ka[3];Ka=ja.protectedMethod.createAbsoluteHtmlElement("span",$a,ab,Ka+Ua-$a,Sa+Wa-ab);return[ca,Ka,ka]}}var a,b,u,t,K,X,
Aa,ra,Ea,Ba,Ca,Ma,Qa,Ja,Ia,Pa,e,h,ba=new x,L,T,na,wa,sa,Da=[],Fa={},La={},Oa=0,ya=0,Ra,za,Ha,Xa={},Ya=!1,Za;this.getJqUi=function(){a||eb();return a};this.setMessageCurtain=function(q){na=q};this.setEntityAssociate=function(q){L=q};this.getEntityAssociate=function(){if(wa){for(var q=wa.getNumber(),ja=wa.getName(),ca=sa;ca&&-1!=ca.getSubNodeLevel();)ja=ca.getDisplayName()+"/"+ja,q=v.appendEntityPath(ca.getName(),q),ca=ca.getParentNode();return v.buildEntityAssociate(q,ja,sa.getName())}};var eb=function(){a=
$("<div>");a.css("top","6px");b=$("<div>");P();u=$("<div>");u.addClass("macro-entity-content-panel");Ca=$("<div>");Ca.addClass("macro-entity-tabel-panel");kb();Ma=$("<div>");Ca.append(Ma);u.append(Ca);Ea=$("<div>");aa();Ba=$("<div>");Ea.append(Ba);u.append(Ea);qa();T&&T.unobserve();T=new ia;T.setDelay(50);T.setCallback(function(){Da&&0<Da.length&&cb();Ha&&0<Ha.length&&Ta()});T.observe();xa()},P=function(){t=new z;t.setPlaceholder(w.get("entitySearchBoxPlaceholder","\u641c\u7d22\u57fa\u7840\u8d44\u6599\u540d\u79f0/\u7f16\u7801"));
t.setShowSearchIcon(!0);var q=t.getJqUi();q.addClass("macro-entity-search-box");t.addEnterEventListener(function(){va()});t.addClearIconListener(function(){va()});b.append(q)},aa=function(){K=new z;K.setPlaceholder(w.get("appSearchBoxPlaceholder","\u641c\u7d22\u4e91/\u5e94\u7528\u540d\u79f0"));K.setShowSearchIcon(!0);Qa=K.getJqUi();Qa.find("input");Qa.addClass("macro-app-search-box");K.addEnterEventListener(function(){ra=K.getText().trim();Aa&&Aa===ra?(ya>=Ra.length&&(ya=0),Ga(),db(),fb()):va()});
K.addClearIconListener(function(){K.hideText();va()});Ea.append(Qa)},va=function(){ra=K.getText().trim();X=t.getText().trim();xa()},qa=function(){var q=new r;q.setHorizontalSplit(!0);q.setEnabled(!0);q.setFirstSize(180,140,250);q.setSecondSize(530,-1,-1);q.setResizeMode(r.RESIZE_MODE_FIRST_FIXED);q.setFirstChild(r.createChildWrapper(Ea,function(){setTimeout(function(){Da&&0<Da.length&&Ia&&Ia.updateUI();Ha&&0<Ha.length&&Ja&&Ja.updateUI()},500)}));q.setSecondChild(r.createChildWrapper(Ca));u.append(q.getJqUi());
q=new r;q.setHorizontalSplit(!1);q.setEnabled(!1);q.setFirstSize(25,-1,-1);q.setSecondSize(475,0,-1);q.setResizeMode(r.RESIZE_MODE_FIRST_FIXED);q.setFirstChild(r.createChildWrapper(b));q.setSecondChild(r.createChildWrapper(u));a.append(q.getJqUi())},xa=function(){h&&h.hide();Pa&&Pa.hide();Ba&&lb(w.get("loading","\u52a0\u8f7d\u4e2d..."),Ba,30);(new fa(ea.getMacroEntityRemote(),function(q){Ba&&gb(Ba);Da=[];Ra=[];ya=0;Fa={};Oa=0;Xa={};Aa=ra;var ja=new M;ja.fromJsonObject(q);q=ja.getChildren();for(ja=
0;ja<q.length;ja++)hb(q[ja]);Ga();db();fb()},function(q,ja){Ba&&gb(Ba);q=w.get("appLoadFailTips","\u52a0\u8f7d\u5e94\u7528\u5217\u8868\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002");na.showPrompt(q)})).getUsableEntities(ra,X)},Ga=function(){if(!Da||0>=Da.length)wa=sa=null;else if(ra){var q=Ra[ya++];if(q instanceof g)sa=q;else{var ja=Ra.length>ya?Ra[ya]:null;if(ja instanceof g&&ja.getParentNode().getName()==q.getName())sa=ja,ya++;else if((q=q?q.getChildren():[])&&0<q.length){for(q=q[0];q instanceof
M;)q=q.getChildren()[0];sa=q}}}else if(L&&!Ya){a:{q=Da;ja=L.getMasterAppId();if(q&&0<q.length)for(var ca=0;ca<q.length;ca++)if(q[ca]instanceof g&&q[ca].getName()==ja){sa=q[ca];break a}sa=void 0}if((q=sa?sa.getEntities():null)&&0<q.length)for(ja=L.getEntityNumber(),ca=0;ca<q.length;ca++)if(ja==q[ca].getNumber()){wa=q[ca];break}}else for(ca=0;ca<Da.length;ca++)if(Da[ca]instanceof g){sa=Da[ca];break}},Ta=function(){Ma.empty();za=new W;if(Ha&&0<Ha.length){if(!Ja){Ja=I.createTable();Ja.setColumnFitVisibleWidth(!0);
var q=new n(Ja);q.setOutsideVisible(!1);Ja.setCellRender(q);Ja.setSyncUIWhenModelChanged(!1);Ja.setDraggableAdjusting(!0,I.getHeadRowCount(),0,new B);Ja.addColumns(4);Ja.getColumn(0).setWidth(35);Ja.getColumn(1).setWidth(35);Ja.getColumn(2).setWidth(175);Ja.getColumn(3).setWidth(175);q=I.createHeadRow(Ja);q.getCell(1).setValue("#");q.getCell(2).setValue(w.get("name","\u540d\u79f0"));q.getCell(3).setValue(w.get("code","\u7f16\u7801"))}if(0!=document.body.clientHeight||0!=document.body.clientWidth){q=
$(Ja.getUI());m.layoutCtrlWithLRTB(q,0,0,null,33,0,null);q.appendTo(Ma);I.clearWithoutHead(Ja);for(var ja in Ha)I.createRow(Ja).setUserObject(Ha[ja]);I.refresh(Ja)}}else{ja=X||ra?new la(w.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")):new la(w.get("emptyEntity","\u6682\u65e0\u57fa\u7840\u8d44\u6599"));ja.setAlign(la.ALIGN_CENTER);ja=ja.getJqUi();ja.addClass("macro-entity-no-data-text");q=$("<div>");Y.background(q,"nodata");q.addClass("macro-entity-no-data-icon");
var ca=$("<div>");ca.css("padding-top","50px");ca.append(q);ca.append(ja);Ma.append(ca)}},Va=function(q,ja){ja&&q.isChecked()&&(wa=q.getUserObject())},db=function(){if(Da&&0<Da.length)h&&h.hide(),Pa&&Pa.show(),cb(),ra?0>=Oa||K.appendText("("+ya+"/"+Oa+")"):K.hideText();else{K.hideText();Pa&&Pa.hide();h&&h.show();var q=X||ra?w.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c"):w.get("emptyApp","\u6682\u65e0\u5e94\u7528");e?e.setText(q):(e=new la(q),e.setAlign(la.ALIGN_CENTER),
h=e.getJqUi(),h.addClass("macro-app-no-data"),Ba.append(h))}},cb=function(){Ia||(Ia=new KTable,Ia.setColumnFitVisibleWidth(!0),Ia.setCellRender(new l(Ia)),Ia.setTreeHandlerRender(new k(Ia)),Ia.setSyncUIWhenModelChanged(!1),Ia.addColumns(1),Pa=$(Ia.getUI()),Pa.addClass("macro-app-tree-tabel"),Ba.append(Pa));if(0!=document.body.clientHeight||0!=document.body.clientWidth){Ia.removeAllRows();Xa={};var q=X||ra;if(Da){var ja=sa.getParentNode(),ca=[];if(sa)for(var ka=ja.getChildren(),ua=0;ua<ka.length;ua++)ca.push(ka[ua].getName());
for(ua=0;ua<Da.length;ua++){ka=Da[ua];var Ka=Ia.addRow();Ka.setHeight(23);var Sa=Ka.getCell(0);Sa.setValue(ka);var Ua=ka.getSubNodeLevel(),Wa=new KTCellTreeModel(Ua);Wa.setExpanded(!1);var bb=q||0==Ua||-1<ca.indexOf(ka.getName()),$a=q||ja&&ja.getName()==ka.getName();ra&&!X&&(0==Ua?$a=ja.getName()==ka.getName()||0<La[ka.getName()]:bb=-1<ca.indexOf(ka.getName())||0<La[ka.getParentNode().getName()]);Ka.setHide(!bb);Wa.setExpanded($a);Sa.setTreeModel(Wa);Xa[ka.getName()]=Ka}}Ia.updateUI();sa&&(q=Xa[sa.getName()],
Ia.scrollCellVisible(Ia.getRowIndex(q),0,!1),q=Ia.keepScrollStatus(),q.h=0,Ia.restoreScrollStatus(q))}},jb=function(q){var ja=$(q.currentTarget);q=q.data.cellNode;if(!sa||sa.getName()!=q.getName()){ra&&(ya=Fa[q.getName()],K.appendText("("+ya+"/"+Oa+")"));sa=q;q=$(".macro-entity-app-list-item_selected");for(var ca in q)q.eq(ca).removeClass("macro-entity-app-list-item_selected");ja.addClass("macro-entity-app-list-item_selected");fb()}},hb=function(q){ra&&(-1!=q.getDisplayName().toUpperCase().indexOf(ra.toUpperCase())&&
(Oa++,Ra.push(q)),Fa[q.getName()]=Oa);Da.push(q);if(q instanceof M){for(var ja=Oa,ca=q.getChildren(),ka=0;ka<ca.length;ka++)hb(ca[ka]);La[q.getName()]=Oa-ja}},lb=function(q,ja,ca){gb(ja);var ka=$("<div>");ka.text(q);ka.addClass("macro-entity-app-selection-waiting");ka.css("top",ca);ka.appendTo(ja);return(new Date).getTime()},gb=function(q){q.find(".macro-entity-app-selection-waiting").remove()},kb=function(){ba.protectedMethod.setTotalSelectedRowAndSelectedAllVisual(!1,!1);ba.setJumpToPageListener(function(ja,
ca,ka){if(Ya){L=wa=null;var ua=sa?sa.getEntities():[];Za=ua?ua.length:0;Ha=ib(ja,ca,ua);Ta()}ka?ka(Za):ba.refreshPagination()});ba.setComboBoxItemModelsAndSelectedItem([5,10,20,50,100,500,1E3],2);var q=ba.getJqUi();q.css("display","block");Ca.append(q)},fb=function(){Ya&&(L=wa=null);var q=sa?sa.getEntities():[];Za=q?q.length:0;ba.resetPaginationAndJumpToFirstPage(Za);var ja=1,ca=ba.getPageSize();if(!Ya&&wa){for(var ka=0;ka<Za;ka++)if(q[ka].getNumber()==wa.getNumber()){ka+=1;ja=parseInt(ka/ca);0!=
ka%ca&&ja++;break}1!=ja&&ba.jumpToPage(ja)}Ha=ib(ja,ca,q);Ta();Ya||(Ya=!0)},ib=function(q,ja,ca){return ca&&0<ca.length?(q=(q-1)*ja,q+ja>=ca.length?ca.slice(q,ca.length):ca.slice(q,q+ja)):null}}function E(c){var n,l,k,a,b,u,t,K,X,Aa,ra=[],Ea,Ba,Ca,Ma=!1;this.setSelectedFieldName=function(T){T&&0<T.length&&(ra=T)};this.setDesignTimeEntity=function(T){T&&(Aa=T.getProperties(),Ca=T.getPkName())};this.getSelectedField=function(){return ra};this.getJqUi=function(){if(!n){n=$("<div>");u=new Z;u.addSearchListener(L);
u.setPlaceholder(w.get("fieldSearchBoxPlaceholder","\u641c\u7d22\u5b57\u6bb5\u540d\u79f0/\u5b57\u6bb5\u6807\u8bc6"));u.setShowSearchIcon(!0);b=u.getJqUi();b.css("width","230px");n.append(b);m.layoutCtrlWithLRTB(b,17,0,null,0,null,23);var T=new V;T.setText(w.get("showOnlySelected","\u4ec5\u663e\u793a\u9009\u4e2d\u9879"));T.addCheckedListener(ba);T=T.getJqUi();n.append(T);m.layoutCtrlWithLRTB(T,325,null,140,0,null,23);t=new V;t.setText(w.get("selectAll","\u5168\u9009"));t.addCheckedListener(h);K=t.getJqUi();
m.layoutCtrlWithLRTB(K,17,0,null,33,0,23);n.append(K);k=new la;a=k.getJqUi();n.append(a);m.layoutCtrlWithLRTB(a,90,0,null,33,null,21);l=$("<div>");n.append(l);0>ra.indexOf(Ca)&&ra.push(Ca);e();Qa()}return n};var Qa=function(){l.empty();l.css("overflow","scroll");m.layoutCtrlWithLRTB(l,17,0,null,57,0,385);Ba=u.getText().trim()?Ea:Aa;Ma&&(Ba=Ba.filter(function(za){return-1<ra.indexOf(za.getName())}));var T=!1;if(Ba&&0==Ba.length)l.append(Ja());else{T=0;for(var na in Ba){var wa=Ba[na],sa=wa.getAlias(),
Da=wa.getName(),Fa=$("<div>");Fa.addClass("macro-entity-field-checkbox");var La=new V;La.setUserObject(wa);wa=La.getJqUi();wa.addClass("macro-entity-field-checkbox-icon");wa.attr("field-name-checkbox",H.encode(Da));wa.data("model",La);Da==Ca?La.setEnabled(!1):(La.setEnabled(!0),La.addCheckedListener(Ia));var Oa=$("<div>"),ya=$("<span>");ya.text(sa);sa="("+Da+")";var Ra=$("<span>");Ra.addClass("macro-entity-field-code-text");Ra.text(sa);Oa.append(ya);Oa.append(Ra);Oa.addClass("macro-entity-field-checkbox-text");
Fa.append(wa);Fa.append(Oa);Da==Ca&&(wa=new G,wa.setIconType(G.ICON_TYPE_QUESTION),wa.setTipsText(w.get("pkTips","PK\u4e3a\u57fa\u7840\u6570\u636e\u5b8f\u7684\u53d6\u503c\u5b57\u6bb5\uff0c\u5fc5\u987b\u52fe\u9009\u3002")),wa=wa.getJqUi(),wa.addClass("macro-value-field-icon"),Fa.append(wa));ra&&0<=ra.indexOf(Da)&&(La.setChecked(!0),T++);l.append(Fa)}T=T==Ba.length}t.setChecked(T)},Ja=function(){if(!X){var T=(new la(w.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c"))).getJqUi();
T.addClass("macro-property-no-data");var na=$("<div>");Y.background(na,"nodata");na.addClass("macro-entity-no-data-icon");X=$("<div>");X.append(na);X.append(T)}return X},Ia=function(T,na){if(na){na=T.getUserObject();if(T.isChecked())ra||(ra=[]),ra.push(na.getName());else for(var wa in ra)ra[wa]==na.getName()&&ra.splice(wa,1);if(T=T.isChecked())for(var sa in Ba)if(!Pa(Ba[sa]).isChecked()){T=!1;break}t.setChecked(T);e()}},Pa=function(T){return n.find("[field-name-checkbox='"+H.encode(T.getName())+"']").data("model")},
e=function(){var T=ra?ra.length:0;T=w.get("selectedCount","(\u5df2\u9009\u62e9 #1 \u9879)").replace("#1",T);k.setText(T)},h=function(T,na){if(na){for(var wa in Ba)if(na=Ba[wa],na.getName()!=Ca){Pa(na).setChecked(T.isChecked());na=na.getName();var sa=0<=ra.indexOf(na);T.isChecked()&&!sa?ra.push(na):!T.isChecked()&&sa&&ra.splice(ra.indexOf(na),1)}e()}},ba=function(T,na){Ma=T.isChecked();na&&Qa()},L=function(T){T=u.getText().trim();Ea=[];if(T)for(var na in Aa){var wa=Aa[na];(-1<wa.getAlias().toUpperCase().indexOf(T.toUpperCase())||
-1<wa.getName().toUpperCase().indexOf(T.toUpperCase()))&&Ea.push(Aa[na])}Qa()}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.macro&&(com.kingdee.bos.qing.macro={});"undefined"==typeof com.kingdee.bos.qing.macro.entity&&(com.kingdee.bos.qing.macro.entity={});com.kingdee.bos.qing.macro.entity.EntityMacroTypeItem=
function(){R.call(this,oa,w.get("entityMacro","\u57fa\u7840\u6570\u636e\u5b8f"));var c;this.setRemoteImpl=function(n){c=n};this.showCreateDialog=function(n){var l=new y(c);l.setCreateSuccessCallback(n);l.showDialog()};this.showEditDialog=function(n,l){var k=function(a){a=new F(c,l,a);a.setUpdateSuccessCallback(n);a.showDialog()};(new fa(ea.getMacroEntityRemote(),function(a){if(a){var b=new C;b.fromJsonObject(a)}k(b);return!0},function(a,b){k(null);return!1})).getDesignTimeEntity(l.getEntityPath())}};
var oa="ENTITY",R,pa,fa,f,ea,v,B,D,C,U,M,g,Y,ha,w,ia,d,ma,la,G,Na,S,da,Z,r,N,W,V,z,x,m,H,I;(function(){var c=com.kingdee.bos.qing.macro;pa=c.PreviewDialog;f=c.MacroFacade;fa=c.MacroEntityFacade;ea=c.MacroRemoteHelper;Y=c.Icons;ha=c.MacroFactory;v=c.EntityHelper;B=c.DraggableAdjustingCustomExpandor;c=com.kingdee.bos.qing.macro.model;D=c.EntityMacro;C=c.DesignTimeEntity;U=c.MacroStatusEnum;M=c.FolderNode;g=c.AppLeafNode;R=c.AbstractMacroTypeItem;c=com.kingdee.bos.qing.framework.common;w=c.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.macro);
ia=c.WindowResizeObserver;c=com.kingdee.bos.qing.ui.component;d=c.AbstractModalDialog;ma=c.MessageDialog;la=c.Label;G=c.HelpIcon;Na=c.TextField;S=c.ComboBox;da=c.F7Selector;Z=c.SearchBox;r=c.SplitPane;N=c.RadioButton;W=c.RadioButtonGroup;V=c.CheckBox;c=com.kingdee.bos.qing.common;m=c.DomUtil;H=c.Base32Util;c=com.kingdee.bos.qing.biz.common;x=c.ComplexPaginationBar;z=c.KeyBoardSearchBox;c=com.kingdee.bos.qing.common.ui;I=c.TableUtil})();ha.registerConstructor(oa,D);var J=function(){var c=new G;c.setIconType(G.ICON_TYPE_QUESTION);
c.setTipsText(w.get("entityMacroTips","\u4f7f\u7528\u4e00\u4e2a\u57fa\u7840\u8d44\u6599\u4f5c\u4e3a\u57fa\u7840\u6570\u636e\u5b8f\u7684\u6570\u636e\u6765\u6e90\u3002\n\u57fa\u7840\u6570\u636e\u5b8f\u7684\u6570\u636e\u67e5\u8be2\u8303\u56f4\u53d7\u5b57\u6bb5\u6743\u9650\u3001\u6570\u636e\u89c4\u5219\u3001\u7279\u6b8a\u6570\u636e\u6743\u9650\u3001\u57fa\u7840\u6570\u636e\u7ba1\u63a7\u7b56\u7565\u5171\u540c\u63a7\u5236\u3002"));c=c.getJqUi();c.addClass("macro-entity-tips-icon");$(".sa-ctrl-dialog-title:first").append(c)},
A=function(c,n,l){if(n&&l){n=n.toUpperCase();var k=l.toUpperCase(),a=k.split(n),b=n.length,u;for(u in a){var t=k.indexOf(a[u]),K=l.substr(Aa,a[u].length);t+=a[u].length;var X=k.length-t;k=k.substr(t,X);l=l.substr(t,X);t=$("<span>");t.text(K);t.appendTo(c);if(u!=a.length-1&&1<a.length){var Aa=k.indexOf(n);K=l.substr(Aa,b);t=Aa+b;X=k.length-t;k=k.substr(t,X);l=l.substr(t,X);t=$("<span>");t.text(K);t.css("color","red");t.clone().appendTo(c)}}}else c.text(l)}})();(function(){"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.macro&&(com.kingdee.bos.qing.macro={});var y=com.kingdee.bos.qing.macro;y.MacroInfoPanel=function(){function B(r){KTDefaultCellRender.call(this,r);var N=this;f.getImpl(f.SYS_VAR_HELPER);var W=this.paintCellUI;this.paintCellUI=function(V,z){var x=
N.getCurrentRowIdx(),m=N.getCurrentRow(),H=N.getCurrentColIdx();m=m.getUserObject();if(x<Q.getHeadRowCount())W(V,z),0==H&&1==x&&(H=w&&w.isChecked()?!0:!1,w=new R,w.setChecked(H),w.addCheckedListener(function(A,c){if(c){if(c=A.isChecked())for(var n in ia)d[n]=1,ia[n].setChecked(c);else for(n in ia)delete d[n],ia[n].setChecked(c);Z(A)}}),w.addCheckedListener(Z),m=w.getJqUi(),O.layoutCtrl(m,12,2,23,23),m.appendTo(V));else if(0==H){z=m.getFid();x=new R;H=!1;if(da)for(var I=Object.keys(d),J=0;J<I.length;J++){if(z===
I[J]){H=!0;break}}else H=(H=ia[z])&&H.isChecked();x.setChecked(H);x.setUserObject(m);x.addCheckedListener(Z);x.addCheckedListener(function(A,c){if(c){c=A.isChecked();var n=A.getUserObject().getFid();ia[n].setChecked(c);if(c){d[n]=1;Z(A);for(var l in ia)if(!ia[l].isChecked())return}else delete d[n],Z(A);w.setChecked(c)}});ia[z]=x;m=x.getJqUi();O.layoutCtrl(m,12,4,23,23);m.appendTo(V)}else 1==H?(x=$("<div>"),x.addClass("macro-tabel-cell-content"),H=$("<span class='macro-db-connection-warning'>"),H.text("!"),
z=m.getStatusWarning(),H.attr("title",z),I=$("<span>"),m=m.getUid(),I.attr("title",m),v(I,ha,m),z&&x.append(H),x.append(I),x.appendTo(V)):2==H?(z=$("<div>"),m=m.getName(),z.attr("title",m),z.addClass("macro-tabel-cell-content"),v(z,ha,m),z.appendTo(V)):3==H?(z=$("<div>"),z.text(m.getTypeText()),z.addClass("macro-tabel-cell-content"),z.appendTo(V)):5==H?(z=$("<div>"),m=m.getDesc()?m.getDesc():p.get("noDesc","\u6682\u65e0\u63cf\u8ff0"),z.attr("title",m),z.addClass("macro-tabel-cell-content"),v(z,ha,
m),z.appendTo(V)):4==H?(z=$("<div>"),x=m.isMultiValued()?p.get("multiValued","\u591a\u503c"):p.get("singleValued","\u5355\u503c"),z.text(x),z.attr("title",x),z.addClass("macro-tabel-cell-content"),z.appendTo(V)):6==H?(H=$("<div>"),x=m.getContentText(),z=m.getTipsText(),H.text(x),H.attr("title",z),H.addClass("macro-tabel-cell-content"),H.appendTo(V)):7==H?(z=$("<div>"),m=m.getCreatorName(),z.text(m),z.attr("title",m),z.addClass("macro-tabel-cell-content"),z.appendTo(V)):8==H?(z=$("<div>"),x=m.getCreateFormatTime(),
z.text(x),z.attr("title",x),z.addClass("macro-tabel-cell-content"),z.appendTo(V)):9==H?(z=$("<div>"),m=m.getModifierName(),z.text(m),z.attr("title",m),z.addClass("macro-tabel-cell-content"),z.appendTo(V)):10==H&&(z=$("<div>"),x=m.getModifyFormatTime(),z.text(x),z.attr("title",x),z.addClass("macro-tabel-cell-content"),z.appendTo(V))}}var D=this,C,U,M,g=[],Y,ha,w,ia={},d={},ma,la;this.setItemCheckedCallback=function(r){la=r};this.setSelectedMacroId=function(r){d={};if(void 0!==r&&null!==r&&0<r.length)for(var N=
0;N<r.length;N++)d[r[N]]=1;D.updateUi()};this.getJqUi=function(){C||(C=$("<div>"),O.layoutCtrlWithLRTB(C,0,0,null,32,0,null),G()?S():Na());return C};this.resize=function(){U&&D.updateUi()};this.updateUi=function(){if(G()){M&&M.show();U||S();if(0!=document.body.clientHeight&&0!=document.body.clientWidth){da=!0;ia={};Q.clearWithoutHead(U);W=0;for(len=g.length;W<len;W++){var r=g[W];r.getUiDisplay()&&Q.createRow(U).setUserObject(r)}Q.refresh(U);r=0;for(var N=Object.keys(ia),W=0;W<N.length;W++)ia[N[W]].isChecked()&&
r++;W=0<r&&r===Object.keys(ia).length;N=Object.keys(d).length;la&&la(r,N);w&&w.setChecked(W);da=!1}Y&&Y.hide()}else Y||Na(),r=("undefined"===typeof ha||null===ha||0===ha.length?g&&0<g.length:1)?p.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c"):p.get("neverCreateMacro","\u6682\u672a\u521b\u5efa\u5b8f\uff0c\u8bf7\u70b9\u51fb\u65b0\u5efa\u6309\u94ae\u8fdb\u884c\u521b\u5efa\u3002"),ma.text(r),Y.show(),M&&M.hide()};this.setRemoteImpl=function(r){};this.setMacroModels=
function(r){g=r;D.updateUi()};this.removeMacroModel=function(r){for(var N=[],W=0;W<g.length;W++){for(var V=!1,z=g[W],x=0;x<r.length;x++)if(z.getFid()==r[x].getFid()){V=!0;break}V||N.push(z)}g=N;D.updateUi()};this.addMacroModel=function(r){g.unshift(r);D.updateUi()};this.getSelectedMacroIds=function(){return Object.keys(d)};this.getSelectedMacrosOnCurrentPage=function(){for(var r=[],N=Object.keys(ia),W=0,V=N.length;W<V;W++){var z=N[W];if(ia[z].isChecked())for(var x=0;x<g.length;x++){var m=g[x];z===
m.getFid()&&r.push(m)}}return r};this.unsetDBConnection=function(r){r=r.getId();for(var N=0;N<g.length;N++){var W=g[N],V=W.getDBInfo();V&&V.getId()===r&&W.setDBInfo(null)}D.updateUi()};var G=function(){for(var r=0;r<g.length;r++)if(g[r].getUiDisplay())return!0;return!1},Na=function(){Y=$("<div>");ma=$("<div>");ma.text(p.get("neverCreateMacro","\u6682\u672a\u521b\u5efa\u5b8f\uff0c\u8bf7\u70b9\u51fb\u65b0\u5efa\u6309\u94ae\u8fdb\u884c\u521b\u5efa\u3002"));ma.appendTo(Y);O.layoutCtrlCenterAlign(ma,500);
ma.addClass("macro-no-data-prompt");var r=$("<div>");y.Icons.background(r,"nodata");r.appendTo(Y);O.layoutCtrlCenterAlign(r,220);r.addClass("macro-no-data-icon");Y.appendTo(C)};this.searchKeyAndUpdateUi=function(r){ha=r};var S=function(){if(C){U=Q.createTable();U.setColumnFitVisibleWidth(!0);U.setDraggableAdjusting(!0,Q.getHeadRowCount(),0,new F);var r=new B(U);r.setOutsideVisible(!1);U.setCellRender(r);U.setSyncUIWhenModelChanged(!0);U.addColumns(11);U.getColumn(0).setWidth(40);U.getColumn(1).setWidth(60);
U.getColumn(2).setWidth(100);U.getColumn(5).setWidth(150);U.getColumn(4).setWidth(60);U.getColumn(6).setWidth(360);U.getColumn(7).setWidth(60);U.getColumn(8).setWidth(120);U.getColumn(9).setWidth(60);U.getColumn(10).setWidth(120);U.getColumn(3).setWidth(60);r=Q.createHeadRow(U);r.getCell(1).setValue(p.get("code","\u7f16\u7801"));r.getCell(2).setValue(p.get("name","\u540d\u79f0"));r.getCell(5).setValue(p.get("desc","\u63cf\u8ff0"));r.getCell(4).setValue(p.get("returnValueType","\u8fd4\u56de\u503c"));
r.getCell(6).setValue(p.get("content","\u5185\u5bb9"));r.getCell(7).setValue(p.get("creator","\u521b\u5efa\u4eba"));r.getCell(8).setValue(p.get("createtime","\u521b\u5efa\u65f6\u95f4"));r.getCell(9).setValue(p.get("modifier","\u6700\u540e\u4fee\u6539\u4eba"));r.getCell(10).setValue(p.get("modifytime","\u6700\u540e\u4fee\u6539\u65f6\u95f4"));r.getCell(3).setValue(p.get("type","\u7c7b\u578b"));M=$(U.getUI());O.layoutCtrlWithLRTB(M,0,0,null,0,0,null);M.appendTo(C)}},da=!1,Z=function(r){r=0;for(var N=
Object.keys(ia),W=0;W<N.length;W++)if(ia[N[W]].isChecked()){r++;break}N=Object.keys(d).length;la&&la(r,N)}};y.UploadPane=function(B){function D(S){pa.call(this);var da=this,Z=this.protectedMethod,r,N,W,V;(function(){Z.setTitle(p.get("importMacro","\u5bfc\u5165\u5b8f"));da.setSize(640,480);Z.setContentPaneCreator(function(){r||(r=new C,N&&r.setModel(N),W&&r.setImportResult(W));return r.getJqUi()});Z.setClosingChecker2(function(z){(z=r.getOverwriteMacro())&&0<z.length&&(new ea(S,function(x){V()},function(x,
m){return"1200009"==x?(g.showPrompt(p.get("noMenuPermission","\u60a8\u6ca1\u6709\u5f53\u524d\u83dc\u5355\u6743\u9650\u3002")),!0):!1})).importMacros(z,"overwrite");Z.destroy();return!0},function(z){Z.destroy();return!0});Z.setClosingAction(function(z){})})();this.setModel=function(z){N=z;r&&r.setModel(z)};this.setImportResult=function(z){W=z;r&&r.setImportResult(W)};this.setImportSuccessCallback=function(z){V=z};this.resize=function(){r&&r.resize()}}function C(){function S(A){KTDefaultCellRender.call(this,
A);var c=this,n=this.paintCellUI;this.paintCellUI=function(l,k){var a=c.getCurrentRowIdx(),b=c.getCurrentRow(),u=c.getCurrentColIdx();b=b.getUserObject();a<Q.getHeadRowCount()?n(l,k):0==u?(k=$("<div>"),b=b.getUid(),k.text(b),k.attr("title",b),k.addClass("macro-tabel-cell-content"),k.appendTo(l)):1==u?(k=$("<div>"),k.text(b.getName()),k.attr("title",b.getName()),k.addClass("macro-tabel-cell-content"),k.appendTo(l)):2==u?(k=$("<div>"),b=b.getDesc()?b.getDesc():p.get("noDesc","\u6682\u65e0\u63cf\u8ff0"),
k.text(b),k.attr("title",b),k.addClass("macro-tabel-cell-content"),k.appendTo(l)):3==u&&(k=a-Q.getHeadRowCount(),a=z[k],l=Q.createCtrlInCell(l,c.getCellWidth(),c.getCellHeight(),oa),l.setItemModels(["ignore","overwrite"]),a?l.setSelected(a.getSelected()):l.setSelected("ignore"),l.setUserObject(b),l.setCustomPainter(function(t,K,X){switch(X){case "ignore":t=p.get("ignore","\u5ffd\u7565");break;case "overwrite":t=p.get("overwrite","\u8986\u76d6");break;default:t=""}X=$("<div>");X.text(t);X.appendTo(K)}),
z[k]=l)}}var da,Z,r,N,W,V,z=[];this.getJqUi=function(){da||m();return da};this.setModel=function(A){r=A;H()};this.setImportResult=function(A){N=A};this.getOverwriteMacro=function(){for(var A=[],c=0,n=z.length;c<n;c++){var l=z[c];"overwrite"==l.getSelected()&&A.push(l.getUserObject())}return A};this.resize=function(){I()};var x=function(A,c,n){var l=$("<div>");l.text(A);l.attr("title",A);l.addClass("macro-import-conflict-all-operate");l.on("click",n);c&&(A=$("<div>"),A.addClass("macro-import-conflict-btn-split-line"),
A.appendTo(l));return l},m=function(){da=$("<div>");V=new E;var A=x(p.get("allIgnore","\u5168\u90e8\u5ffd\u7565"),!0,function(){for(var c=0,n=z.length;c<n;c++)z[c].setSelected("ignore")});O.layoutCtrl(A,0,30,50,23);A.appendTo(da);A=x(p.get("allOverwrite","\u5168\u90e8\u8986\u76d6"),!1,function(){for(var c=0,n=z.length;c<n;c++)z[c].setSelected("overwrite")});O.layoutCtrl(A,80,30,50,23);A.appendTo(da);Z||J();H()},H=function(){if(r&&N){var A=V.getJqUi();O.layoutCtrl(A,0,0,400,20);A.appendTo(da);A=p.get("conflictHandlePrompt",
"\u6210\u529f\u5bfc\u5165#1\u4e2a\u5b8f\u3002\u4ee5\u4e0b\u5b8f\u7f16\u7801\u51b2\u7a81\uff0c\u8bf7\u5904\u7406\u3002").replace("#1",N.getSuccessCount());V.setText(A);I()}},I=function(){W||J();if(0!=document.body.clientHeight&&0!=document.body.clientWidth){Q.clearWithoutHead(W);for(var A=0,c=r.length;A<c;A++){var n=r[A];Q.createRow(W).setUserObject(n)}Q.refresh(W)}},J=function(){W=Q.createTable();Q.bindTableListenerForCtrl(W);W.setColumnFitVisibleWidth(!1);W.setDraggableAdjusting(!0,Q.getHeadRowCount(),
0,new F);var A=new S(W);A.setOutsideVisible(!1);W.setCellRender(A);W.setSyncUIWhenModelChanged(!0);W.addColumns(4);W.getColumn(0).setWidth(110);W.getColumn(1).setWidth(140);W.getColumn(2).setWidth(250);W.getColumn(3).setWidth(100);A=Q.createHeadRow(W);A.getCell(0).setValue(p.get("code","\u7f16\u7801"));A.getCell(1).setValue(p.get("name","\u540d\u79f0"));A.getCell(2).setValue(p.get("desc","\u63cf\u8ff0"));A.getCell(3).setValue(p.get("handleStrategy","\u5904\u7406\u7b56\u7565"));Z=$(W.getUI());O.layoutCtrlWithLRTB(Z,
0,0,null,64,0,null);Z.appendTo(da)}}function U(S){pa.call(this);var da=this,Z=this.protectedMethod,r,N,W,V;(function(){Z.setTitle(p.get("importMacro","\u5bfc\u5165\u5b8f"));da.setSize(640,480);Z.setContentPaneCreator(function(){r||(r=new M,N&&r.setModel(N));return r.getJqUi()});Z.setClosingChecker2(function(z){z=r.getSelectedModel();0==z.length?Z.getMessageCurtain().showPrompt(p.get("noImportMacroSelected","\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b8f\u3002")):(new ea(S,function(x){var m=new fa;
m.fromJsonObject(x);if(m.isAllSuccess())W();else{x=m.getConflictUids();for(var H=[],I=0,J=x.length;I<J;I++)for(var A=x[I],c=0,n=N.length;c<n;c++){var l=N[c];l.getUid()==A&&H.push(l)}V=new D(S);V.setImportResult(m);V.showDialog();V.setModel(H);V.setImportSuccessCallback(W)}Z.destroy();return!0},function(x,m){return"1200009"==x?(g.showPrompt(p.get("noMenuPermission","\u60a8\u6ca1\u6709\u5f53\u524d\u83dc\u5355\u6743\u9650\u3002")),!0):!1})).importMacros(z)},function(z){Z.destroy();return!0});Z.setClosingAction(function(z){})})();
this.setModel=function(z){N=z;r&&r.setModel(z)};this.setOuterMessageCurtain=function(z){};this.setImportSuccessCallback=function(z){W=z};this.resize=function(){r&&r.resize();V&&V.resize()}}function M(){function S(m){KTDefaultCellRender.call(this,m);var H=this;f.getImpl(f.SYS_VAR_HELPER);var I=this.paintCellUI;this.paintCellUI=function(J,A){var c=H.getCurrentRowIdx(),n=H.getCurrentRow(),l=H.getCurrentColIdx();n=n.getUserObject();c<Q.getHeadRowCount()?(I(J,A),0==l&&1==c&&(l=V&&V.isChecked()?!0:!1,V=
new R,V.setChecked(l),V.addCheckedListener(function(k,a){if(a){a=0;for(var b=W.length;a<b;a++)W[a].setChecked(k.isChecked())}}),n=V.getJqUi(),O.layoutCtrl(n,12,2,23,23),n.appendTo(J))):0==l?(A=new R,c-=Q.getHeadRowCount(),l=(l=W[c])&&l.isChecked(),W[c]=A,A.setChecked(l),A.setUserObject(n),A.addCheckedListener(function(k,a){if(a)if(k.isChecked()){k=0;for(a=W.length;k<a;k++)if(!W[k].isChecked())return;V.setChecked(!0)}else V.setChecked(!1)}),n=A.getJqUi(),O.layoutCtrl(n,12,4,23,23),n.appendTo(J)):1==
l?(c=$("<div>"),n=n.getUid(),c.text(n),c.attr("title",n),c.addClass("macro-tabel-cell-content"),c.appendTo(J)):2==l?(c=$("<div>"),c.text(n.getName()),c.attr("title",n.getName()),c.addClass("macro-tabel-cell-content"),c.appendTo(J)):4==l?(c=$("<div>"),n=n.getDesc()?n.getDesc():p.get("noDesc","\u6682\u65e0\u63cf\u8ff0"),c.text(n),c.attr("title",n),c.addClass("macro-tabel-cell-content"),c.appendTo(J)):5==l?(c=$("<div>"),n=n.isMultiValued()?p.get("multiValued","\u591a\u503c"):p.get("singleValued","\u5355\u503c"),
c.text(n),c.attr("title",n),c.addClass("macro-tabel-cell-content"),c.appendTo(J)):3==l&&(c=$("<div>"),n=n.getTypeText(),c.text(n),c.addClass("macro-tabel-cell-content"),c.appendTo(J))}}var da,Z,r,N,W=[],V;this.getJqUi=function(){da||(da=$("<div>"),Z||x(),Z.appendTo(da));return da};this.setModel=function(m){r=m;z()};this.getSelectedModel=function(){for(var m=[],H=0,I=W.length;H<I;H++){var J=W[H];J.isChecked()&&m.push(J.getUserObject())}return m};this.resize=function(){z()};var z=function(){N||x();
if(0!=document.body.clientHeight&&0!=document.body.clientWidth){Q.clearWithoutHead(N);for(var m=0,H=r.length;m<H;m++){var I=r[m];Q.createRow(N).setUserObject(I)}Q.refresh(N)}},x=function(){N=Q.createTable();N.setColumnFitVisibleWidth(!0);N.setDraggableAdjusting(!0,Q.getHeadRowCount(),0,new F);var m=new S(N);m.setOutsideVisible(!1);N.setCellRender(m);N.setSyncUIWhenModelChanged(!0);N.addColumns(6);N.getColumn(0).setWidth(40);N.getColumn(1).setWidth(60);N.getColumn(2).setWidth(80);N.getColumn(4).setWidth(120);
N.getColumn(5).setWidth(80);N.getColumn(3).setWidth(80);m=Q.createHeadRow(N);m.getCell(1).setValue(p.get("code","\u7f16\u7801"));m.getCell(2).setValue(p.get("name","\u540d\u79f0"));m.getCell(4).setValue(p.get("desc","\u63cf\u8ff0"));m.getCell(5).setValue(p.get("returnValueType","\u8fd4\u56de\u503c"));m.getCell(3).setValue(p.get("type","\u7c7b\u578b"));Z=$(N.getUI());O.layoutCtrlWithLRTB(Z,0,0,null,0,0,null);Z.appendTo(da)}}var g,Y,ha,w,ia,d;this.createJqUi=function(S,da){g=da;da=$("<div>");da.addClass("macro-importing-exporting-main");
var Z=$(document.body),r=$("<div class='sa-ctrl-modallayer'>");r.appendTo(Z);Y=$("<progress value='0' max='100'>");Y.addClass("macro-importing-upload-progress");var N=$("<div>");N.addClass("macro-importing-exporting-text");N.text(p.get("uploading","\u6b63\u5728\u4e0a\u4f20\u4e2d\uff0c\u8bf7\u7a0d\u5019"));da.append(Y);da.append(N);Z.append(da);d&&d.unobserve();d=new ta;d.setDelay(50);d.setCallback(function(){ia&&ia.resize()});d.observe();ma(S,da,r)};this.setUploadSuccessCallback=function(S){ha=S};
this.setUploadFailedCallback=function(S){w=S};var ma=function(S,da,Z){var r=new FormData;r.append("filename",S);S=new XMLHttpRequest;S.upload.addEventListener("progress",la,!1);S.addEventListener("error",G,!1);var N=com.kingdee.bos.qing.framework.common.RemoteFrameworkRegister.getUploadUrl();S.open("post",N,!0);S.onload=function(W){200==this.status&&(W=JSON.parse(this.response),"number"==typeof W.errorCode&&3099003==W.errorCode?g.showError(W.errorMessage):Na(W.data),da.remove(),Z.remove())};S.send(r)},
la=function(S){var da=Y.get(0);S.lengthComputable&&(da.max=S.total,da.value=S.loaded)},G=function(S){w&&w(p.get("uploadFail","\u4e0a\u4f20\u5931\u8d25"))},Na=function(S){var da=new ea(B,function(Z){for(var r=[],N=0,W=Z.length;N<W;N++){var V=y.MacroFactory.getMacroInstance(Z[N].type);V.fromJsonObject(Z[N]);r.push(V)}0==r.length?g.showPrompt(p.get("noOptionalMacro","\u672a\u627e\u5230\u53ef\u5bfc\u5165\u5b8f\u3002")):(ia=new U(B),ia.showDialog(),ia.setModel(r),ia.setImportSuccessCallback(ha))},function(Z,
r){return 1200009==Z?(g.showPrompt(p.get("noMenuPermission","\u60a8\u6ca1\u6709\u5f53\u524d\u83dc\u5355\u6743\u9650\u3002")),!0):!1});da.setShowBlocking(!0);da.getOptionalImportMacro(S)}};var F=y.DraggableAdjustingCustomExpandor,O,Q,p,ta,E,oa,R,pa,fa,f,ea;(function(){var B=com.kingdee.bos.qing.common;O=B.DomUtil;B=com.kingdee.bos.qing.ui.component;E=B.Label;R=B.CheckBox;oa=B.ComboBox;pa=B.AbstractModalDialog;B=com.kingdee.bos.qing.framework.common;p=B.MultilanguageManager.createPackageAccessor(y);
ta=B.WindowResizeObserver;B=com.kingdee.bos.qing.common.ui;Q=B.TableUtil;B=com.kingdee.bos.qing.macro.model;fa=B.ImportResult;B=com.kingdee.bos.qing.data;f=B.VariateHelperFactory;B=com.kingdee.bos.qing.macro;ea=B.MacroFacade})();var v=function(B,D,C){if(D&&C){D=D.toUpperCase();var U=C.toUpperCase(),M=U.split(D),g=D.length,Y;for(Y in M){var ha=U.indexOf(M[Y]),w=C.substr(d,M[Y].length);ha+=M[Y].length;var ia=U.length-ha;U=U.substr(ha,ia);C=C.substr(ha,ia);ha=$("<span>");ha.text(w);ha.appendTo(B);if(Y!=
M.length-1&&1<M.length){var d=U.indexOf(D);w=C.substr(d,g);ha=d+g;ia=U.length-ha;U=U.substr(ha,ia);C=C.substr(ha,ia);ha=$("<span>");ha.text(w);ha.css("color","red");ha.clone().appendTo(B)}}}else B.text(C)}})();(function(){function y(M){var g,Y,ha,w=new ta,ia=new B,d,ma,la,G,Na,S,da=new U,Z=[];this.createJqUi=function(){g=$("<div class='macro-main'>");ia.addMenuButton(m,"btn_create",R.get("create","\u65b0\u5efa"));G=ia.addButton(J,"btn_edit",R.get("edit","\u7f16\u8f91"));Na=ia.addButton(A,"btn_preview",R.get("preview","\u9884\u89c8"));la=ia.addButton(I,"btn_delete",R.get("del","\u5220\u9664"));ia.addButton(n,"btn_import",R.get("import","\u5bfc\u5165"));S=ia.addButton(c,"btn_export",R.get("export","\u5bfc\u51fa"));
ia.addButton(H,"btn_refresh",R.get("refresh","\u5237\u65b0"));la.setEnabled(!1);G.setEnabled(!1);Na.setEnabled(!1);S.setEnabled(!1);W();g.append(ia.getJqUi());Y=$("<div class='macro-main-panel'>");g.append(Y);r();z();x();w.getJqUi().appendTo(g);return g};this.registerDataCenterSelectorConstructor=function(a){};this.registerSuperQuerySelectorConstructor=function(a){};this.registerMacroTypeItem=function(a){Z.push(a)};this.resize=function(){ha&&ha.resize()};this.addToolbarButton=function(a,b,u){return ia.addButtonForTailCustom(a,
b,u)};var r=function(){da.setJumpToPageListener(function(a,b,u){(new D(M,function(t){N(t,u)})).loadMacros(a,b,ma)});da.setSelectedAllOrNotListener(function(a,b){a?(new D(M,function(u){ha.setSelectedMacroId(u);b(u.length)})).loadAllMacroIds(ma):ha.setSelectedMacroId(null)});da.setComboBoxItemModelsAndSelectedItem([5,10,20,50,100,500,1E3],2);Y.append(da.getJqUi())},N=function(a,b){ha.getJqUi().appendTo(Y);b?b(a.totalRow):da.refreshPagination();a=a.macros;b=da.getJqUi();a&&0<a.length?b.show():b.hide();
b=[];for(var u=0,t=a.length;u<t;u++){var K=F.MacroFactory.getMacroInstance(a[u].type);K.fromJsonObject(a[u]);b.push(K)}ha.setMacroModels(b)},W=function(a){d=new oa;d.addSearchListener(V);d.setSearchListenerDelay(1E3);d.setPlaceholder(R.get("searchBoxPlaceholder","\u641c\u7d22\u7f16\u7801/\u540d\u79f0/\u63cf\u8ff0"));d.setShowSearchIcon(!0);var b=d.getJqUi();b.addClass("macro-search-box");a=b.find(":input");a.focus(function(){b.css({width:"360px"})});a.blur(function(){b.css({width:"180px"})});b.appendTo(ia.getJqUi())},
V=function(a){a=new D(M,function(b){ha.setSelectedMacroId(null);da.refreshSelectedRowTotal(0);N(b,da.resetPaginationAndJumpToFirstPage)});ma=d.getText().trim();ha.searchKeyAndUpdateUi(ma);a.loadMacros(1,da.getPageSize(),ma)},z=function(){ha=new v;ha.setItemCheckedCallback(function(a,b){da.refreshSelectedRowTotal(b);la&&G&&Na&&S&&(0>=a&&0>=b?(la.setEnabled(!1),S.setEnabled(!1),G.setEnabled(!1),Na.setEnabled(!1)):1===a&&1===b?(la.setEnabled(!0),S.setEnabled(!0),G.setEnabled(!0),Na.setEnabled(!0)):(la.setEnabled(!0),
S.setEnabled(!0),G.setEnabled(!1),Na.setEnabled(!1)))});(new D(M,function(a){N(a,da.resetPaginationAndJumpToFirstPage)})).loadMacros(1,da.getPageSize())},x=function(){0==f.SUPPORTED_VAR_TYPE.length&&(new D(M,function(a){0<a.length&&f.VARIANTTYPEENUM.forEach(function(b){a.forEach(function(u){b.getTypeID()==u&&f.SUPPORTED_VAR_TYPE.push(b)})})})).getSupportedSystemVarType()},m=function(){var a=new Q,b=function(){(new D(M,function(K){N(K,da.resetPaginationAndJumpToFirstPage)})).loadMacros(1,da.getPageSize());
w.showSuccess(R.get("saveSuccess","\u4fdd\u5b58\u6210\u529f\u3002"))};if(Z&&0<Z.length)for(var u=0;u<Z.length;u++){var t=new p(function(K){var X=K.getUserObject();k(function(){X.showCreateDialog(b)})});t.setText(Z[u].getTypeName());t.setUserObject(Z[u]);a.addItemModel(t)}return a},H=function(){(new D(M,function(a){ha.setSelectedMacroId(null);da.refreshSelectedRowTotal(0);N(a)})).loadMacros(da.getCurrentPage(),da.getPageSize(),ma)},I=function(){var a=ha.getSelectedMacroIds();a&&0!=a.length&&(new D(M,
function(b){var u=R.get("confirmDelMacro","\u6240\u9009\u5b8f\u5220\u9664\u540e\u65e0\u6cd5\u6062\u590d\uff0c\u786e\u5b9a\u5220\u9664\uff1f");0<b&&(u+=R.get("selectedMacroReferred","\u6240\u9009\u5b8f\u5df2\u88ab\u5f15\u7528#1\u6b21\u3002").replace("#1",b));b=E.createFeedbackDialog();b.setOptionType(E.OPTION_OK_CANCEL);b.setMsgImageType(E.MSG_DELETE);b.setMessage(u);b.setClosingChecker(function(t){t==E.RETURN_OK&&(new D(M,function(){w.showSuccess(R.get("deleteSuccess","\u5220\u9664\u6210\u529f\u3002"));
(new D(M,function(K){ha.setSelectedMacroId(null);da.refreshSelectedRowTotal(0);N(K,da.resetPaginationAndJumpToFirstPage)})).loadMacros(1,da.getPageSize(),ma)},function(K,X){return"1200009"===K?(w.showPrompt(R.get("noMenuPermission","\u60a8\u6ca1\u6709\u5f53\u524d\u83dc\u5355\u6743\u9650\u3002")),!0):!1})).deleteMacros(a);return!0});b.showDialog()})).loadMacrosRefTimeByFIds(a)},J=function(){k(function(a){var b=ha.getSelectedMacrosOnCurrentPage();if(b&&0!=b.length)if(1<b.length)w.showPrompt(R.get("singleRowAllowed",
"\u8bf7\u9009\u62e9\u5355\u4e2a\u5b8f\u8fdb\u884c#1\u3002").replace("#1",R.get("edit","\u7f16\u8f91")));else{var u=function(){w.showSuccess(R.get("editSuccess","\u7f16\u8f91\u6210\u529f\u3002"));H()};a=new D(M,function(t){var K=F.MacroFactory.getMacroInstance(t.type);K.fromJsonObject(t);a:{t=K.getType();if(Z&&0<Z.length)for(var X=0;X<Z.length;X++)if(t===Z[X].getMacroType()){t=Z[X];break a}t=void 0}t.showEditDialog(u,K)});b=b[0];a.checkPermissionBeforeEdit(b,b.getType())}})},A=function(){var a=ha.getSelectedMacrosOnCurrentPage();
a&&0!=a.length&&(1<a.length?w.showPrompt(R.get("singleRowAllowed","\u8bf7\u9009\u62e9\u5355\u4e2a\u5b8f\u8fdb\u884c#1\u3002").replace("#1",R.get("preview","\u9884\u89c8"))):(a=a[0])&&a.isUsable()?(new ea(M,a)).showDialog():(a=new E,a.setTitle(R.get("previewFailed","\u9884\u89c8\u5931\u8d25")),a.setOptionType(E.RETURN_OK),a.setMessage(R.get("macroCannotExe","\u8be5\u5b8f\u65e0\u6cd5\u6b63\u5e38\u6267\u884c\uff0c\u8bf7\u68c0\u67e5\u5b8f\u4fe1\u606f\u662f\u5426\u6b63\u786e\u3002")),a.showDialog()))},
c=function(){var a=ha.getSelectedMacroIds();a&&0!==a.length&&(new D(M,function(b){var u="Qing-"+(new Date).getTime()+".qing-macro";fa.downloadFile(u,b)},function(b){return"1200003"==b?(w.showPrompt(R.get("macroNotFound","\u5b8f\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002")),H(),!0):"1200009"==b?(w.showPrompt(R.get("noMenuPermission","\u60a8\u6ca1\u6709\u5f53\u524d\u83dc\u5355\u6743\u9650\u3002")),!0):!1})).exportMacros(a)},n=function(){var a=$("<input type='file' id='uploadBtn'>");a.addClass("import-theme-file");
a.attr("accept",[".qing-macro"]);a.on("change",function(b){if(b=b.currentTarget.files[0]){var u=b.name,t=b.size,K=u.lastIndexOf(".");u=u.substring(K+1,u.length).toLowerCase();g.find("#uploadBtn").val("");"qing-macro"!==u?w.showPrompt(R.get("fileTypeIncorrect","\u6587\u4ef6\u7c7b\u578b\u4e0d\u6b63\u786e\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u3002"),2E3):0===t?w.showPrompt(R.get("uploadFileIsNull","\u4e0a\u4f20\u7684\u6587\u4ef6\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u3002"),2E3):104857600<=
t?w.showPrompt(R.get("fileTooLarge","\u6587\u4ef6\u592a\u5927\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u3002"),2E3):(t=new C(M),t.createJqUi(b,w),t.setUploadSuccessCallback(l))}a.val("")});a.click()},l=function(){w.showSuccess(R.get("importSuccess","\u5bfc\u5165\u6210\u529f\u3002"));(new D(M,function(a){ma="";ha.setSelectedMacroId(null);da.refreshSelectedRowTotal(0);N(a,da.resetPaginationAndJumpToFirstPage)})).loadMacros(1,da.getPageSize())};this.insertToolbarButton=function(a,b,u,t){return ia.addButtonForHeadCustom(a,
b,u,t)};this.appendToolbarButton=function(a,b,u,t){return ia.addButtonForTailCustom(a,b,u,t)};var k=function(a){(new D(M,function(b){1==b&&a();0==b&&w.showPrompt(R.get("noMenuPermission","\u60a8\u6ca1\u6709\u5f53\u524d\u83dc\u5355\u6743\u9650\u3002"))},function(b,u){return!1})).checkMacroPermission()}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing=
{});"undefined"==typeof com.kingdee.bos.qing.macro&&(com.kingdee.bos.qing.macro={});var F=com.kingdee.bos.qing.macro;F.MacroDesigner=y;F.AbstractModalMacroDesignerScene=function(){var M=this,g,Y,ha;this.show=function(){g||(g=new y(M.protectedGetRemoteImpl()),g.registerDataCenterSelectorConstructor(M.protectedGetDataCenterSelectorConstructor()),g.registerSuperQuerySelectorConstructor(M.protectedGetSuperQuerySelectorConstructor()));Y=$("<div>");Y.css("z-index",256);Y.css("background-color","rgba(0,0,0,0.4");
Y.appendTo($(document.body));O.layoutCtrlWithLRTB(Y,0,0,null,0,0,null);var w=$("<div>");w.css("border-radius","4px");w.css("overflow","hidden");w.appendTo(Y);O.layoutCtrlWithLRTB(w,20,20,null,20,20,null);var ia=R.get("macro","\u5b8f"),d=$("<div>");d.text(ia);d.addClass("sa-ctrl-dialog-title");d.css("z-index",1);d.appendTo(w);ia=$("<div>");ia.css("z-index",1);ia.appendTo(w);O.layoutCtrlWithLRTB(ia,0,0,null,d.outerHeight(),0,null);d=$("<div>");d.css("z-index",2);d.addClass("sa-ctrl-dialog-close");d.text("\u00d7");
d.appendTo(w);d.on("click",function(ma){M.hide()});g.createJqUi().appendTo(ia);ha=new pa;ha.setDelay(250);ha.setCallback(function(){g.resize()});ha.observe()};this.hide=function(){ha.unobserve();Y.remove()};this.protectedGetRemoteImpl=function(){throw Error("override me");};this.protectedGetDataCenterSelectorConstructor=function(){throw Error("override me");};this.protectedGetSuperQuerySelectorConstructor=function(){throw Error("override me");}};var O,Q,p,ta,E,oa,R,pa,fa,f,ea,v,B,D,C,U;(function(){var M=
com.kingdee.bos.qing.common;O=M.DomUtil;M=com.kingdee.bos.qing.ui.component;Q=M.MenuModel;p=M.MenuItemModel;ta=M.MessageCurtain;E=M.MessageDialog;oa=M.SearchBox;M=com.kingdee.bos.qing.framework.common;R=M.MultilanguageManager.createPackageAccessor(F);pa=M.WindowResizeObserver;fa=M.RemoteFramework;M=com.kingdee.bos.qing.data;f=M.SystemVarType;M=com.kingdee.bos.qing.macro;B=M.Toolbar;D=M.MacroFacade;ea=M.PreviewDialog;v=M.MacroInfoPanel;C=M.UploadPane;M=com.kingdee.bos.qing.biz.common;U=M.ComplexPaginationBar})()})();
//qingVersionTag: 20250324