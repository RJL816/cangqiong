var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(Ha,Kb,jc){Ha instanceof String&&(Ha=String(Ha));for(var Cb=Ha.length,oc=0;oc<Cb;oc++){var rc=Ha[oc];if(Kb.call(jc,rc,oc,Ha))return{i:oc,v:rc}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(Ha,Kb,jc){if(Ha==Array.prototype||Ha==Object.prototype)return Ha;Ha[Kb]=jc.value;return Ha};$jscomp.getGlobal=function(Ha){Ha=["object"==typeof globalThis&&globalThis,Ha,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var Kb=0;Kb<Ha.length;++Kb){var jc=Ha[Kb];if(jc&&jc.Math==Math)return jc}throw Error("Cannot find global object");};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(Ha,Kb){var jc=$jscomp.propertyToPolyfillSymbol[Kb];if(null==jc)return Ha[Kb];jc=Ha[jc];return void 0!==jc?jc:Ha[Kb]};
$jscomp.polyfill=function(Ha,Kb,jc,Cb){Kb&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(Ha,Kb,jc,Cb):$jscomp.polyfillUnisolated(Ha,Kb,jc,Cb))};$jscomp.polyfillUnisolated=function(Ha,Kb,jc,Cb){jc=$jscomp.global;Ha=Ha.split(".");for(Cb=0;Cb<Ha.length-1;Cb++){var oc=Ha[Cb];if(!(oc in jc))return;jc=jc[oc]}Ha=Ha[Ha.length-1];Cb=jc[Ha];Kb=Kb(Cb);Kb!=Cb&&null!=Kb&&$jscomp.defineProperty(jc,Ha,{configurable:!0,writable:!0,value:Kb})};
$jscomp.polyfillIsolated=function(Ha,Kb,jc,Cb){var oc=Ha.split(".");Ha=1===oc.length;Cb=oc[0];Cb=!Ha&&Cb in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var rc=0;rc<oc.length-1;rc++){var Kc=oc[rc];if(!(Kc in Cb))return;Cb=Cb[Kc]}oc=oc[oc.length-1];jc=$jscomp.IS_SYMBOL_NATIVE&&"es6"===jc?Cb[oc]:null;Kb=Kb(jc);null!=Kb&&(Ha?$jscomp.defineProperty($jscomp.polyfills,oc,{configurable:!0,writable:!0,value:Kb}):Kb!==jc&&(void 0===$jscomp.propertyToPolyfillSymbol[oc]&&(jc=1E9*Math.random()>>>0,
$jscomp.propertyToPolyfillSymbol[oc]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(oc):$jscomp.POLYFILL_PREFIX+jc+"$"+oc),$jscomp.defineProperty(Cb,$jscomp.propertyToPolyfillSymbol[oc],{configurable:!0,writable:!0,value:Kb})))};$jscomp.polyfill("Array.prototype.find",function(Ha){return Ha?Ha:function(Kb,jc){return $jscomp.findInternal(this,Kb,jc).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(Ha){var Kb=0;return function(){return Kb<Ha.length?{done:!1,value:Ha[Kb++]}:{done:!0}}};
$jscomp.arrayIterator=function(Ha){return{next:$jscomp.arrayIteratorImpl(Ha)}};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(Ha){if(Ha)return Ha;var Kb=function(rc,Kc){this.$jscomp$symbol$id_=rc;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:Kc})};Kb.prototype.toString=function(){return this.$jscomp$symbol$id_};var jc="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",Cb=0,oc=function(rc){if(this instanceof oc)throw new TypeError("Symbol is not a constructor");return new Kb(jc+(rc||"")+"_"+Cb++,rc)};return oc},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(Ha){if(Ha)return Ha;Ha=Symbol("Symbol.iterator");for(var Kb="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),jc=0;jc<Kb.length;jc++){var Cb=$jscomp.global[Kb[jc]];"function"===typeof Cb&&"function"!=typeof Cb.prototype[Ha]&&$jscomp.defineProperty(Cb.prototype,Ha,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return Ha},
"es6","es3");$jscomp.iteratorPrototype=function(Ha){Ha={next:Ha};Ha[Symbol.iterator]=function(){return this};return Ha};$jscomp.iteratorFromArray=function(Ha,Kb){Ha instanceof String&&(Ha+="");var jc=0,Cb=!1,oc={next:function(){if(!Cb&&jc<Ha.length){var rc=jc++;return{value:Kb(rc,Ha[rc]),done:!1}}Cb=!0;return{done:!0,value:void 0}}};oc[Symbol.iterator]=function(){return oc};return oc};
$jscomp.polyfill("Array.prototype.keys",function(Ha){return Ha?Ha:function(){return $jscomp.iteratorFromArray(this,function(Kb){return Kb})}},"es6","es3");$jscomp.polyfill("Object.is",function(Ha){return Ha?Ha:function(Kb,jc){return Kb===jc?0!==Kb||1/Kb===1/jc:Kb!==Kb&&jc!==jc}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(Ha){return Ha?Ha:function(Kb,jc){var Cb=this;Cb instanceof String&&(Cb=String(Cb));var oc=Cb.length;jc=jc||0;for(0>jc&&(jc=Math.max(jc+oc,0));jc<oc;jc++){var rc=Cb[jc];if(rc===Kb||Object.is(rc,Kb))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(Ha,Kb,jc){if(null==Ha)throw new TypeError("The 'this' value for String.prototype."+jc+" must not be null or undefined");if(Kb instanceof RegExp)throw new TypeError("First argument to String.prototype."+jc+" must not be a regular expression");return Ha+""};$jscomp.polyfill("String.prototype.includes",function(Ha){return Ha?Ha:function(Kb,jc){return-1!==$jscomp.checkStringArgs(this,Kb,"includes").indexOf(Kb,jc||0)}},"es6","es3");
(function(){function Ha(){var Kc=this,Bc=[],uc=[],Wb;this.setChangedListener=function(La){Wb=La};this.isTableIdExist=function(La){return null!=Kc.getTableById(La)};this.addTable=function(La){tc(La);Wb&&Wb(Ha.KEY_ADD_TABLE,La)};var tc=function(La){La.setChangedListener(function(Eb){Wb&&Wb(Eb,La)});Bc.push(La)};this.refreshTable=function(La){La=Kc.getTableById(La);Wb&&Wb(Ha.KEY_REFRESH_TABLE,La)};this.removeTable=function(La){for(var Eb=0;Eb<Bc.length;Eb++)if(Bc[Eb]==La){La.setChangedListener(null);
Bc.splice(Eb,1);Wb&&Wb(Ha.KEY_REMOVE_TABLE,La);La=Kc.searchRelationByTableId(La.getId());for(Eb=La.length-1;0<=Eb;Eb--)Kc.removeRelation(La[Eb]);break}};this.getTableCount=function(){return Bc.length};this.getTable=function(La){return Bc[La]};this.getTableById=function(La){for(var Eb=0;Eb<Bc.length;Eb++){var xb=Bc[Eb];if(xb.getId()==La)return xb}return null};this.addRelation=function(La){uc.push(La);Wb&&Wb(Ha.KEY_ADD_RELATION,La)};this.removeRelation=function(La){for(var Eb=0;Eb<uc.length;Eb++)if(uc[Eb]==
La){uc.splice(Eb,1);Wb&&Wb(Ha.KEY_REMOVE_RELATION,La);break}};this.getRelationCount=function(){return uc.length};this.getRelation=function(La){return uc[La]};this.getRelationByTableId=function(La,Eb){for(var xb=0;xb<uc.length;xb++){var ab=uc[xb];if(ab.getFromTableId()==La&&ab.getToTableId()==Eb)return ab}return null};this.searchRelationByTableId=function(La){for(var Eb=[],xb=0;xb<uc.length;xb++){var ab=uc[xb];ab.getFromTableId()!=La&&ab.getToTableId()!=La||Eb.push(ab)}return Eb}}function Kb(){var Kc,
Bc,uc,Wb=[],tc;this.setChangedListener=function(La){Kc=La};this.setId=function(La){Bc=La};this.getId=function(){return Bc};this.refreshSubEntityDisplayName=function(La){for(var Eb in Wb){var xb=Wb[Eb].getSubNodeEntity();if(xb&&xb.getName()==La.getName()){Kc&&Kc(Kb.KEY_SUBENTITY_DISPLAYNAME);break}}};this.setDisplayName=function(La){uc=La;Kc&&Kc(Kb.KEY_DISPLAYNAME)};this.getDisplayName=function(){return uc};this.setFields=function(La){Wb=La;Kc&&Kc(Kb.KEY_FIELDS)};this.getFieldCount=function(){return Wb.length};
this.getField=function(La){return Wb[La]};this.setRect=function(La){tc=La;Kc&&Kc(Kb.KEY_RECT)};this.getRect=function(){return tc}}function jc(){var Kc,Bc,uc,Wb,tc;this.setFromTableId=function(La){Kc=La};this.getFromTableId=function(){return Kc};this.setFromFieldId=function(La){uc=La};this.getFromFieldId=function(){return uc};this.setToTableId=function(La){Bc=La};this.getToTableId=function(){return Bc};this.setToFieldId=function(La){Wb=La};this.getToFieldId=function(){return Wb};this.setRelated=function(La){tc=
La};this.isRelatedFromN=function(){return tc==jc.R_N1};this.isRelatedToN=function(){return tc==jc.R_1N}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.data&&(com.kingdee.bos.qing.data={});"undefined"==typeof com.kingdee.bos.qing.data.rview&&(com.kingdee.bos.qing.data.rview={});var Cb=com.kingdee.bos.qing.data.rview;
Cb.RelationView=function(){var Kc="RelationView"+rc++,Bc,uc,Wb,tc=[120,160],La=[40,30],Eb,xb,ab,$b,Ib=!1,Vb=!0,Xa=!0,ma,Lb,hc=100,Mb=0,mb,vc,Ob;this.getDataModel=function(){return Bc};this.setDataModel=function(l){Bc&&Bc.setChangedListener(null);(Bc=l)&&Bc.setChangedListener(Dc);uc&&bd()};this.getJqUi=function(){uc||(uc=$("<div>"),uc.css("overflow","auto"),uc.on("mousedown",ea),Wb=$("<div>"),Wb.addClass("dmrv-placeholder"),Wb.appendTo(uc),Bc&&bd());return uc};this.updateViewBounds=function(){Eb=[uc.innerWidth(),
uc.innerHeight()]};this.setDefaultTableSize=function(l,B){tc=[l,B]};this.setTableSelectable=function(l){Ib=l?!0:!1;ad(null)};this.setRelationSelectable=function(l){Vb=l?!0:!1;ad(null)};this.setDeselectable=function(l){Xa=l?!0:!1;ad(null)};this.setSelectedListener=function(l){Lb=l};this.getSelectedTable=function(){return ma instanceof Kb?ma:null};this.setSelectedTable=function(l){ad(l,!1)};this.getSelectedRelation=function(){return ma instanceof jc?ma:null};this.setSelectedRelation=function(l){ad(l,
!1)};this.setTableIconSetter=function(l){xb=l};this.setFieldIconSetter=function(l){ab=l};this.setNoFieldPrompt=function(l){$b=l};var Dc=function(l,B){switch(l){case Ha.KEY_REFRESH_TABLE:l=Uc(B).find(".dmrv-table-title-icon");xb&&xb(l,B);break;case Ha.KEY_ADD_TABLE:cc(B,!0);Wa();break;case Ha.KEY_REMOVE_TABLE:Da(B);break;case Ha.KEY_ADD_RELATION:Cc(B);break;case Ha.KEY_REMOVE_RELATION:B==ma&&ad(null);Xb(B).remove();break;case Kb.KEY_DISPLAYNAME:Uc(B).find(".dmrv-table-title").text(B.getDisplayName());
break;case Kb.KEY_FIELDS:case Kb.KEY_SUBENTITY_DISPLAYNAME:Ya(B);break;case Kb.KEY_RECT:l=Uc(B);eb(B,l);B=Bc.searchRelationByTableId(B.getId());for(l=B.length-1;0<=l;l--)kd(B[l]);Wa()}},bd=function(){uc.children(":not(.dmrv-placeholder)").remove();for(var l=0,B=Bc.getTableCount();l<B;l++){var J=Bc.getTable(l);cc(J)}l=0;for(B=Bc.getRelationCount();l<B;l++)J=Bc.getRelation(l),Cc(J);Wa()},Uc=function(l){l=Kc+"_"+oc.encode(l.getId());return uc.find("#"+l)},Qc=function(l){return Kc+"_R_"+oc.encode(l.getFromTableId())+
"_I_"+oc.encode(l.getToTableId())},Xb=function(l){l=Qc(l);return $("#"+l)},cc=function(l,B){var J=l.getRect();J||(J=Gc(l),l.setRect(J));var v=oa(l);B?zc(J,function(F){v.children().fadeIn("slow")}):v.children().css("display","block")},Da=function(l){var B=Uc(l);B.attr("invalid","true");zc(l.getRect(),function(J){l==ma&&ad(null);B.fadeOut(function(){B.remove();Wa()})})},oa=function(l){var B=$("<div>");B.attr("id",Kc+"_"+oc.encode(l.getId()));B.addClass("dmrv-table");eb(l,B);var J=$("<div>");J.addClass("dmrv-table-content");
J.css("display","none");J.appendTo(B);var v=$("<div>");v.addClass("dmrv-table-title");v.text(l.getDisplayName());v.appendTo(J);v=$("<div>");v.addClass("dmrv-table-title-icon");v.appendTo(J);xb&&xb(v,l);v=$("<div>");v.addClass("dmrv-table-fieldlist");v.appendTo(J);Ya(l,v);l=$("<div>");l.addClass("dmrv-table-footer");l.appendTo(J);l=$("<div>");l.addClass("dmrv-table-resizer");l.appendTo(J);B.appendTo(uc);return B},Ya=function(l,B){B||(B=Uc(l).find(".dmrv-table-fieldlist"));B.empty();var J=l.getFieldCount();
if(0==J)l=$("<div>"),l.addClass("dmrv-table-fieldlist-nofieldprompt"),l.text($b?$b:""),l.appendTo(B);else for(var v=0;v<J;v++){var F=l.getField(v),T=$("<div>");T.addClass("dmrv-table-field");T.attr("my-field-id",oc.encode(F.getId()));T.appendTo(B);var I=$("<div>");I.addClass("dmrv-table-field-icon");ab&&ab(I,l,F);I.appendTo(T);I=$("<div>");I.addClass("dmrv-table-field-text");I.text(F.getDisplayName());I.appendTo(T)}},eb=function(l,B){l=l.getRect();B.css({left:l[0],top:l[1],width:l[2],height:l[3]})},
Wa=function(){for(var l=0,B=0,J=Bc.getTableCount()-1;0<=J;J--){var v=Bc.getTable(J).getRect();if(v){var F=v[1]+v[3];l=Math.max(l,v[0]+v[2]);B=Math.max(B,F)}}Wb.css({left:l+100,top:B+80})},ea=function(l){for(var B=$(l.target);B[0]!=uc[0];){if(B.hasClass("dmrv-table")){var J=B.attr("id");J=oc.decode(J.substring(Kc.length+1));J=Bc.getTableById(J);var v=B.find(".dmrv-table-title"),F=B.find(".dmrv-table-title-icon"),T=B.find(".dmrv-table-resizer");F=l.target==v[0]||l.target==F[0];var I=l.target==T[0];
if(Mb=F?16:I?3:0)uc.css("cursor",(F?v:T).css("cursor")),uc.on("mousemove",da),uc.on("mouseup",zb),uc.on("mouseleave",U),mb=[l.screenX,l.screenY],vc=[parseInt(B.css("left")),parseInt(B.css("top")),parseInt(B.css("width")),parseInt(B.css("height")),J];ad(J);return}if(B.hasClass("dmrv-relation")){B=B.attr("id").substring((Kc+"_R_").length).split("_I_");l=oc.decode(B[0]);B=oc.decode(B[1]);l=Bc.getRelationByTableId(l,B);ad(l);return}B=B.parent()}B=$(l.target);l.offsetY>B.prop("clientHeight")||l.offsetX>
B.prop("clientWidth")||Xa&&ad(null)},da=function(l){Ob||(Ob=$("<div>"),Ob.addClass("dmrv-table-standin"),Ob.css("left",vc[0]),Ob.css("top",vc[1]),Ob.css("width",vc[2]),Ob.css("height",vc[3]),Ob.appendTo(uc));var B=l.screenX-mb[0];l=l.screenY-mb[1];16==Mb?Ob.css({left:Math.max(0,vc[0]+B),top:Math.max(0,vc[1]+l)}):3==Mb&&Ob.css({width:Math.max(La[0],vc[2]+B),height:Math.max(La[1],vc[3]+l)})},zb=function(l){wc()},U=function(l){wc()},wc=function(){uc.off("mousemove",da);uc.off("mouseup",zb);uc.off("mouseleave",
U);uc.css("cursor","default");if(Ob){var l=[parseInt(Ob.css("left")),parseInt(Ob.css("top")),parseInt(Ob.css("width")),parseInt(Ob.css("height"))];vc[4].setRect(l);Ob.remove();mb=vc=Ob=null;Mb=0}},zc=function(l,B){var J=l[0]-10,v=l[0]+l[2]+10,F=l[1]-10;l=l[1]+l[3]+10;var T=uc.prop("scrollLeft"),I=uc.prop("scrollTop"),S=uc.prop("clientWidth"),cb=uc.prop("clientHeight"),ub=T,Ea=I,qb=!0;J<T&&(ub=J,qb=!1);F<I&&(Ea=F,qb=!1);v>T+S&&(ub=v-S,qb=!1);l>I+cb&&(Ea=l-cb,qb=!1);qb?B&&B(qb):uc.animate({scrollLeft:ub,
scrollTop:Ea},"fast",B)},Gc=function(l){var B=Eb?Eb[0]:parseInt(uc.innerWidth());B=isNaN(B)||0==B?1280:B;for(var J=tc[0],v=tc[1],F=10,T=10,I=!1;!I;){I=F;for(var S=T,cb=F+J,ub=T+v,Ea=!1,qb=0,xc=Bc.getTableCount();qb<xc;qb++){var Hc=Bc.getTable(qb),Nc=Hc.getRect();if(Hc!=l&&Nc){Hc=Nc[1]-20;var Za=Nc[0]+Nc[2]+20,ec=Nc[1]+Nc[3]+20;if(!(cb<Nc[0]-20||I>Za||ub<Hc||S>ec)){Ea=!0;break}}}I=!Ea;Ea&&(F+=60,F>B&&(F=10,T+=30))}return[F,T,J,v]},ad=function(l,B){var J=!0,v=null;if(l instanceof Kb)v=Uc(l),J=Ib;else if(l instanceof
jc){v=Xb(l);J=Vb;var F=Uc(Bc.getTableById(l.getFromTableId())),T=Uc(Bc.getTableById(l.getToTableId()));F.css("z-index",hc+1);T.css("z-index",hc+1)}v&&v.css("z-index",hc++);J&&ma!=l&&(B=void 0===B?!0:B,ma&&(lc(!1),B&&Lb&&Lb(!1,ma)),ma=l)&&(lc(!0),B&&Lb&&Lb(!0,ma))},lc=function(l){if(ma instanceof Kb){var B=Uc(ma).find(".dmrv-table-content");l?B.addClass("dmrv-table-content_selected"):B.removeClass("dmrv-table-content_selected")}else if(ma instanceof jc){B=Xb(ma);var J=B.find(".dmrv-relation-line");
l?(B.addClass("dmrv-relation_selected"),J.addClass("dmrv-relation-line_selected")):(B.removeClass("dmrv-relation_selected"),J.removeClass("dmrv-relation-line_selected"));yc(ma,l)}},yc=function(l,B){var J=Bc.getTableById(l.getFromTableId());J&&Sc(J,l.getFromFieldId(),B);var v=Bc.getTableById(l.getToTableId());v&&Sc(v,l.getToFieldId(),B);B&&zc(J.getRect(),function(F){setTimeout(function(){zc(v.getRect())},F?0:500)})},Sc=function(l,B,J){l=Uc(l).find("[my-field-id='"+oc.encode(B)+"']");if(J){l.addClass("dmrv-relation-field_selected");
J=l.parent();B=J.prop("scrollTop");var v=J.prop("clientHeight"),F=l.prop("offsetTop");l=l.prop("offsetHeight");(F<B||F+l>B+v)&&J.prop("scrollTop",F)}else l.removeClass("dmrv-relation-field_selected")},Cc=function(l){var B=$("<div>");B.attr("id",Qc(l));B.addClass("dmrv-relation");var J=$("<div>");J.addClass("dmrv-relation-line");J.appendTo(B);J=$("<div>");J.addClass("dmrv-relation-tips-from");J.appendTo(B);J=$("<div>");J.addClass("dmrv-relation-tips-to");J.appendTo(B);kd(l,B);B.appendTo(uc)},kd=function(l,
B){B||(B=Xb(l));var J=Bc.getTableById(l.getFromTableId()),v=Bc.getTableById(l.getToTableId());if(v.getRect())a:{var F=J.getRect(),T=v.getRect();J=F[2];v=F[3];var I=F[0],S=I+J,cb=F[1],ub=cb+v;F=T[2];var Ea=T[3],qb=T[0],xc=qb+F,Hc=T[1],Nc=Hc+Ea;if(qb>S)var Za=Hc-ub>qb-S?"ud":cb-Nc>qb-S?"du":"lr";else if(xc<I)Za=Hc-ub>I-xc?"ud":cb-Nc>I-xc?"du":"rl";else if(Hc>ub)Za="ud";else if(Nc<cb)Za="du";else{var ec=null;break a}J>>=1;F>>=1;T=v>>1;Ea>>=1;var Db=cb+T,n=I+J,V=Hc+Ea,Ga=qb+F;v=!1;switch(Za){case "lr":ec=
S-4;var ha=Db;var ib=qb+4;var p=V;v=!0;var ic=ha>p?!1:!0;break;case "rl":ec=I+4;ha=Db;ib=xc-4;p=V;v=!0;ic=ha>p?!0:!1;break;case "ud":ec=n;ha=ub-4;ib=Ga;p=Hc+4;ic=ec>ib?!0:!1;break;case "du":ec=n,ha=cb+4,ib=Ga,p=Nc-4,ic=ec>ib?!1:!0}ec==ib||"ud"!=Za&&"du"!=Za?ha==p||"lr"!=Za&&"rl"!=Za||(I=Math.abs((p-ha)/(ib-ec)),I=Math.max(-5,Math.min(5,Math.log(I))),I=(I+5)/10,F=Math.abs(p-ha),F>T+Ea?(J=T,S=Ea):(J=F*T/(T+Ea),S=F*Ea/(T+Ea)),F=p>ha?1:-1,ha+=parseInt(J*I)*F,p+=parseInt(S*I)*-F):(I=Math.abs((ib-ec)/(p-
ha)),I=Math.max(-5,Math.min(5,Math.log(I))),I=(I+5)/10,T=Math.abs(ib-ec),T>J+F?(S=J,iAdjustableWidth2=F):(S=T*J/(J+F),iAdjustableWidth2=T*F/(J+F)),F=ib>ec?1:-1,ec+=parseInt(S*I)*F,ib+=parseInt(iAdjustableWidth2*I)*-F);ec=[ec,ha,ib,p,v,ic]}else ec=null;v=ec;null==v?B.css("display","none"):(p=v[0],ic=v[1],ec=v[2]-p,ha=v[3]-ic,ib=v[4],v=v[5],0==ec?(J=0<ha?90:-90,F=Math.abs(ha)):(I=!1,0>ec&&(I=!0,ec=-ec),F=Math.atan(ha/ec),J=parseInt(180*F/Math.PI),F=parseInt(ec/Math.cos(F)),I&&(J=180-J)),I="rotate("+
J+"deg)",B.css({display:"block",transform:I,"-webkit-transform":I,"-ms-transform":I,"-moz-transform":I,"-o-transform":I,left:p,top:ic-4,width:F}),p=Math.abs(ib?ha:ec),28>Math.abs(ib?ec:ha)&&36>p?ed(B):ed(B,l,J,v))},ed=function(l,B,J,v){var F=l.find(".dmrv-relation-tips-from");l=l.find(".dmrv-relation-tips-to");B?(Ec(F,B.isRelatedFromN(),J,v),Ec(l,B.isRelatedToN(),J,!v)):(F.css("display","none"),l.css("display","none"))},Ec=function(l,B,J,v){l.text(B?"*":"1");l.removeClass("dmrv-relation-tips-"+(v?
"underline":"aboveline"));l.addClass("dmrv-relation-tips-"+(v?"aboveline":"underline"));B="rotate("+-J+"deg)";l.css({display:"block",transform:B,"-webkit-transform":B,"-ms-transform":B,"-moz-transform":B,"-o-transform":B})}};Cb.DataModel=Ha;Cb.Table=Kb;Cb.Field=function(){var Kc,Bc,uc,Wb;this.setSubNodeEntity=function(tc){Wb=tc};this.getSubNodeEntity=function(){return Wb};this.setId=function(tc){Kc=tc};this.getId=function(){return Kc};this.setDisplayName=function(tc){Bc=tc};this.getDisplayName=function(){return Wb?
Wb.getAlias()+"."+Bc:Bc};this.setUserObject=function(tc){uc=tc};this.getUserObject=function(){return uc}};Cb.Relation=jc;var oc=com.kingdee.bos.qing.common.Base32Util;Ha.KEY_ADD_TABLE="addTable";Ha.KEY_REFRESH_TABLE="refreshTable";Ha.KEY_REMOVE_TABLE="removeTable";Ha.KEY_ADD_RELATION="addRelation";Ha.KEY_REMOVE_RELATION="removeRelation";Kb.KEY_FIELDS="fields";Kb.KEY_RECT="rect";Kb.KEY_DISPLAYNAME="displayname";Kb.KEY_SUBENTITY_DISPLAYNAME="subentity_displayname";jc.R_11="11";jc.R_N1="n1";jc.R_1N=
"1n";var rc=1})();(function(){function Ha(){var l=this,B=[],J,v=[],F=[],T=[],I=new kd,S;this.addChangedListener=function(n){B.push(n)};this.getAllEntity=function(){return v};this.removeChangedListener=function(n){for(var V=B.length-1;0<=V;V--)B[V]==n&&B.splice(V,1)};this.replaceOrAddUnionInnerEntityRelation=function(n){var V=[],Ga=!1;T.forEach(function(ha){ha.getRootUnionEntityName()!=n.getRootUnionEntityName()?V.push(ha):(V.push(n),Ga=!0)});Ga||V.push(n);T=V};this.addUnionInnerEntityRelation=function(n){T.push(n)};
this.findUnionInnerEntityRelation=function(n){for(var V=0;V<T.length;V++)if(T[V].getRootUnionEntityName()==n)return T[V];V=new Lb;V.setRootUnionEntityName(n);return V};var cb=function(n,V,Ga){for(var ha=n.getName(),ib=1;V[ha];)ha=n.getName()+"_"+ib,ib++;n.setName(ha);V[ha]=n;ib=1;for(V=n.getAlias();Ga[V];)V=n.getAlias()+"_"+ib,ib++;n.setAlias(V);Ga[V]=n},ub=function(n,V){for(var Ga=0;Ga<B.length;Ga++)(0,B[Ga])(n,V)};this.isTooModern=function(){return J};this.getSources=function(){for(var n={},V=0;V<
v.length;V++)v[V].collectSources(n);V=[];for(var Ga in n)V.push(n[Ga]);return V};this.batchInsertEntity=function(n,V){var Ga={},ha={};v.forEach(function(hb){Ga[hb.getName()]=hb;ha[hb.getAlias()]=hb});for(var ib=0;ib<n.length;ib++){var p=n[ib],ic=p.getName();cb(p,Ga,ha);var sc=p.getName();sc!=ic&&V&&V(ic,sc,p);xc(p)}ub(Ha.KEY_ADD_ENTITIES,n)};this.addEntitiesByIndex=function(n,V){if(!(0>V))if(V>=v.length)l.addEntities(n);else{var Ga={},ha={};v.forEach(function(hb){Ga[hb.getName()]=hb;ha[hb.getAlias()]=
hb});for(var ib=[],p=0;p<v.length;p++){if(V==p)for(var ic=0;ic<n.length;ic++){var sc=n[ic];cb(sc,Ga,ha);Ga[sc.getName()]=sc;ha[sc.getAlias()]=sc;sc.mergeSource(l.getSources());Ea(sc);ib.push(sc)}ib.push(v[p])}v=ib;ub(Ha.KEY_ADD_ENTITIES,n)}};var Ea=function(n){n.setChangedListener(function(V){ub(V,n)})};this.addEntities=function(n){var V={},Ga={};v.forEach(function(hb){V[hb.getName()]=hb;Ga[hb.getAlias()]=hb});for(var ha=0;ha<n.length;ha++){for(var ib=n[ha],p=ib.getName(),ic=p,sc=1;V[ic];)ic=p+"_"+
sc++;ib.setName(ic);V[ic]=ib;ic=p=ib.getAlias();for(sc=1;Ga[ic];)ic=p+"_"+sc++;ib.setAlias(ic);Ga[ic]=ib;ib.mergeSource(l.getSources());Hc(ib)}ub(Ha.KEY_ADD_ENTITIES,n)};this.refreshEntity=function(n){l.refreshEntities([n])};this.replaceEntity=function(n,V,Ga){var ha={},ib={},p=n.getAllOldEntity();v.forEach(function(tb){-1==p.indexOf(tb)&&(ha[tb.getName()]=tb,ib[tb.getAlias()]=tb)});for(var ic=[],sc=!1,hb=null,hd=[],ba=0;ba<v.length;ba++){var Ra=v[ba],Sb=n.getNewEntity(Ra.getName());if(Sb){sc=!0;
ic.push(Sb);hb||(hb=Sb);var Ub=Sb.getName();cb(Sb,ha,ib);var Gb=Sb.getName();Gb!=Ub&&Ga&&Ga(Ub,Gb,Sb);Sb.mergeSource(l.getSources());Ea(Sb);hd.push([Ra,Sb])}else(Sb=Ra.getParentEntity())&&sc&&(Sb=n.getNewEntity(Sb.getName()))&&Ra.setParentEntity(Sb),ic.push(Ra)}qb(hd);v=ic;V&&hb&&(ub(Ha.KEY_REFRESH_ENTITY,hb),ub(rc.KEY_CHANGE_ENTITYALIAS,hb))};var qb=function(n){for(var V=[],Ga=0;Ga<F.length;Ga++){for(var ha=F[Ga],ib=!1,p=!1,ic=0;ic<n.length;ic++){var sc=n[ic],hb=sc[0];sc=sc[1];ha.getFromEntity()==
hb&&(ha.setFromEntity(sc),ib=!0);ha.getToEntity()==hb&&(ha.setToEntity(sc),p=!0)}ib&&((ib=ha.getFromEntity().searchProperty(ha.getFromProperty()))?ha.setFromProperty(ib):V.push(ha));p&&((p=ha.getToEntity().searchProperty(ha.getToProperty()))?ha.setToProperty(p):V.push(ha))}V.forEach(function(hd){l.removeRelation(hd)})};this.fireEntityRefresh=function(n){n=l.getEntityByName(n);ub(Ha.KEY_REFRESH_ENTITY,n)};this.fireRefreshEntity=function(n){ub(Ha.KEY_REFRESH_ENTITY,n)};this.refreshEntities=function(n){if(0!=
n.length){for(var V={},Ga={},ha=0;ha<n.length;ha++){var ib=n[ha];V[ib.getName()]=ib;Ga[ib.getName()]=ib}ib=[];var p=[];for(ha in v){var ic=v[ha],sc=ic.getName(),hb=V[sc];if(hb)delete Ga[sc],ib.push(hb),hb.setChangedListener(function(ba){ub(ba,hb)}),p.push([ic,hb]);else{ib.push(ic);var hd=ic.getParentEntity();hd&&(hd=V[hd.getName()])&&ic.setParentEntity(hd)}}qb(p);v=ib;V=[];for(sc in Ga)V.push(Ga[sc]),xc(Ga[sc]);0<V.length&&ub(Ha.KEY_ADD_ENTITIES,V);ub(Ha.KEY_REFRESH_ENTITY,n[0])}};var xc=function(n){var V=
n.getParentEntity();if(V){var Ga=v.indexOf(V);if(0<=Ga){var ha=-1;V=V.getName();for(Ga+=1;Ga<v.length;Ga++)if(!v[Ga].findParentEntityByName(V)){ha=Ga;break}n.setChangedListener(function(ib){ub(ib,n)});-1<ha?v.splice(ha,0,n):v.push(n)}}else n.setChangedListener(function(ib){ub(ib,n)}),v.push(n)};this.insertEntityByLocation=function(n,V){var Ga={},ha={};v.forEach(function(sc){Ga[sc.getName()]=sc;ha[sc.getAlias()]=sc});for(var ib=n.getName(),p=ib,ic=1;Ga[p];)p=ib+"_"+ic++;n.setName(p);p=ib=n.getAlias();
for(ic=1;ha[p];)p=ib+"_"+ic++;n.setAlias(p);-1<V?v.splice(V,0,n):v.push(n)};this.refreshUploadTypeSourceUrl=function(n){for(var V=l.getSources(),Ga=0;Ga<V.length;Ga++)for(var ha=V[Ga],ib=0;ib<n.length;ib++){var p=n[ib];if(p.getName()==ha.getName()){ha.fireChangeUrl(p);break}}};var Hc=function(n){n.setChangedListener(function(V){ub(V,n)});v.push(n)};this.removeEntityByName=function(n){for(var V=0;V<v.length;V++){var Ga=v[V];if(Ga.getName()==n){Ga.setChangedListener(null);Ga.fission();v.splice(V,1);
ub(Ha.KEY_REMOVE_ENTITY,Ga);n=l.searchRelationsByEntityName(n);for(V=n.length-1;0<=V;V--)l.removeRelation(n[V]);Ga instanceof Wb&&Ga.getUnionType()==Wb.BIZ_UNION&&(Ga.getParentEntity()?(n=Ga.getTopParentEntity(),l.removeBizUnionInnerEntityRelations(n.getName(),Ga.getChildren())):l.removeBizUnionInnerEntityRelations(Ga.getName()));break}}};this.removeEntity=function(n){for(var V=0;V<v.length;V++)if(v[V]==n){n.setChangedListener(null);n.fission();v.splice(V,1);ub(Ha.KEY_REMOVE_ENTITY,n);V=l.searchRelationsByEntityName(n.getName());
for(var Ga=V.length-1;0<=Ga;Ga--)l.removeRelation(V[Ga]);n instanceof Wb&&n.getUnionType()==Wb.BIZ_UNION&&(n.getParentEntity()?(V=n.getTopParentEntity(),l.removeBizUnionInnerEntityRelations(V.getName(),n.getChildren())):l.removeBizUnionInnerEntityRelations(n.getName()));break}};this.getEntityCount=function(){return v.length};this.getEntityIndex=function(n){for(var V=0;V<v.length;V++)if(n.getName()==v[V].getName())return V;return-1};this.getEntityByIndex=function(n){return 0>n?null:n<v.length?v[n]:
null};this.getEntityByName=function(n){for(var V=0;V<v.length;V++){var Ga=v[V];if(Ga.getName()==n)return Ga}return null};this.getEntityByAlias=function(n){for(var V=0;V<v.length;V++){var Ga=v[V];if(Ga.getAlias()==n)return Ga}return null};this.copyEntityArray=function(){return v.slice(0)};this.onlyPushEntity=function(n){v.push(n)};this.isEntityNameExist=function(n){return null!=l.getEntityByName(n)};this.isEntityAliasExist=function(n){return null!=l.getEntityByAlias(n)};this.getEntityWithSubNodes=
function(n){return l.getEntityWithSubNodesUtil(n,v)};this.getEntityWithSubNodesUtil=function(n,V){var Ga=function(ib,p){for(var ic=0;ic<V.length;ic++){var sc=V[ic];sc.isSubNodeAtView()&&sc.getParentEntity().getName()==ib&&(p.push(sc),Ga(sc.getName(),p))}},ha=[n];Ga(n.getName(),ha);return ha};this.isEntityWithSubNodes=function(n){for(var V=0;V<v.length;V++){var Ga=v[V];if(Ga.isSubNodeAtView()&&Ga.getParentEntity().getName()==n.getName())return!0}return!1};this.isRelationInsideSubSystem=function(n){if(n.getFromEntity().getTopParentEntity()!=
n.getToEntity().getTopParentEntity())return!1;var V=n.getFromEntity().isSubNodeAtView(),Ga=n.getToEntity().isSubNodeAtView();return V&&Ga?!0:V||Ga?V?l.isEntityWithSubNodes(n.getToEntity()):l.isEntityWithSubNodes(n.getFromEntity()):!1};this.isRelationExist=function(n,V){for(var Ga=0;Ga<F.length;Ga++){var ha=F[Ga];if(ha.getFromEntity().getName()==n&&ha.getToEntity().getName()==V||ha.getFromEntity().getName()==V&&ha.getToEntity().getName()==n)return!0}return!1};this.isNewRelationCreatable=function(n,
V){var Ga={};Ga[n]=!0;return Nc(Ga,{},V)};var Nc=function(n,V,Ga){n[Ga]=!0;for(var ha=l.searchRelationsByEntityName(Ga),ib=0;ib<ha.length;ib++){var p=ha[ib],ic=p.getFromEntity().getName();p=p.getToEntity().getName();if(!V[ic+"_|_"+p]&&(V[ic+"_|_"+p]=!0,ic!=Ga&&(n[ic]||!Nc(n,V,ic))||p!=Ga&&(n[p]||!Nc(n,V,p))))return!1}return!0};this.addRelation=function(n){Za(n);ub(Ha.KEY_ADD_RELATION,n)};var Za=function(n){n.setChangedListener(function(V,Ga,ha){Ga=new jc(n,Ga,ha);ub(V,Ga)});n.isInnerRelation()?F.splice(0,
0,n):F.push(n)};this.fireRelationPropChanged=function(n,V){var Ga=l.searchRelationsByEntityName(n);Ga&&0!=Ga.length&&Ga.forEach(function(ha){ha.getFromEntity().getName()==n&&ha.getFromProperty().getName()==V?ub(ma.KEY_FROM_PROPERTY_ALIAS_CHANED,ha):ha.getToEntity().getName()==n&&ha.getToProperty().getName()==V&&ub(ma.KEY_TO_PROPERTY_ALIAS_CHANED,ha)})};this.refreshRelationEntity=function(n){l.searchRelationsByEntityName(n.getName()).forEach(function(V){V.getFromEntity().getName()==n.getName()?V.setFromEntity(n):
V.getToEntity().getName()==n.getName()&&V.setToEntity(n);ub(Ha.KEY_REFRESH_RELATION,V)})};this.removeRelation=function(n){for(var V=0;V<F.length;V++)if(F[V]==n){n.setChangedListener(null);F.splice(V,1);ub(Ha.KEY_REMOVE_RELATION,n);break}};this.swapRelation=function(n,V){var Ga=F[n];F[n]=F[V];F[V]=Ga};this.replaceRelation=function(n,V){F[n]=V};var ec=function(n,V){if(V)for(n+=1;n<F.length;n++){if(!l.isRelationInsideSubSystem(F[n]))return n}else for(--n;0<=n;n--)if(!l.isRelationInsideSubSystem(F[n]))return n;
return-1};this.moveUpRelation=function(n){for(var V=0;V<F.length;V++)if(F[V]==n){var Ga=ec(V,!1);if(-1<Ga){l.swapRelation(V,Ga);ub(Ha.KEY_MOVE_UP_RELATION,n);break}}};this.moveDownRelation=function(n){for(var V=0;V<F.length;V++)if(F[V]==n){var Ga=ec(V,!0);if(-1<Ga){l.swapRelation(V,Ga);ub(Ha.KEY_MOVE_DOWN_RELATION,n);break}}};this.getRelationCount=function(){return F.length};this.getRelationByIndex=function(n){return F[n]};this.getRelationByEntitiesName=function(n,V){for(var Ga=0;Ga<F.length;Ga++){var ha=
F[Ga];if(ha.getFromEntity().getName()==n&&ha.getToEntity().getName()==V)return ha}return null};this.removeRelationByProperty=function(n,V){for(var Ga=[],ha=[],ib=0;ib<F.length;ib++)if(F[ib].getFromEntity().getName()==n){var p=F[ib].getFromProperty();var ic=null;p&&(ic=(ic=p.getParent())?ic.getName():p.getName());ic==V?Ga.push(F[ib]):ha.push(F[ib])}else F[ib].getToEntity().getName()==n?(p=F[ib].getToProperty(),ic=null,p&&(ic=(ic=p.getParent())?ic.getName():p.getName()),ic==V?Ga.push(F[ib]):ha.push(F[ib])):
ha.push(F[ib]);F=ha;for(ib=0;ib<Ga.length;ib++)Ga[ib].setChangedListener(null),ub(Ha.KEY_REMOVE_RELATION,Ga[ib])};this.searchInnerRelationPropNames=function(n){for(var V=[],Ga=0;Ga<F.length;Ga++){var ha=F[Ga];if(ha.isInnerRelation()){if(ha.getFromEntity().getName()==n){var ib=ha.getFromProperty().getName();0>V.indexOf(ib)&&V.push(ib)}ha.getToEntity().getName()==n&&(ib=ha.getToProperty().getName(),0>V.indexOf(ib)&&V.push(ib))}}return V};this.getLockedPropNames=function(n){var V=l.searchInnerRelationPropNames(n.getName());
n=n.getColumnToRowProperties();if(null!=n&&0<n.length)for(var Ga in n)for(var ha=n[Ga].getColumnToRowPropertyItems(),ib=0;ib<ha.length;ib++){var p=ha[ib];if(p){p=p.getPropertyValues();for(var ic in p){var sc=p[ic];0>V.indexOf(sc)&&V.push(sc)}}}return V};this.searchAllRelationPropNames=function(n){for(var V=[],Ga=0;Ga<F.length;Ga++){var ha=F[Ga];ha.getFromEntity().getName()==n&&ha.getFromProperty()&&(ha.getFromProperty().getParent()&&V.push(ha.getFromProperty().getParent().getName()),V.push(ha.getFromProperty().getName()));
ha.getToEntity().getName()==n&&ha.getToProperty()&&(ha.getToProperty().getParent()&&V.push(ha.getToProperty().getParent().getName()),V.push(ha.getToProperty().getName()))}return V};this.searchRelationsByEntityName=function(n){for(var V=[],Ga=0;Ga<F.length;Ga++){var ha=F[Ga];ha.getFromEntity().getName()!=n&&ha.getToEntity().getName()!=n||V.push(ha)}return V};this.removeEntityInnerRelation=function(n,V){for(var Ga,ha=0;ha<T.length&&(Ga=T[ha],Ga.getRootUnionEntityName()!=n);ha++);Ga&&Ga.removeRelation(V)};
this.getBizUnionInnerEntityRelations=function(n){for(var V,Ga=0;Ga<T.length;Ga++){var ha=T[Ga];if(ha.getRootUnionEntityName()==n){V=ha;break}}return V?V.getRelations():[]};this.removeBizUnionInnerEntityRelations=function(n,V){if(V){for(ha=0;ha<T.length;ha++)if(ib=T[ha],ib.getRootUnionEntityName()==n){var Ga=ib;break}if(Ga)for(ha=0;ha<V.length;ha++)Ga.removeRelation(V[ha])}else{V=[];for(var ha=0;ha<T.length;ha++){var ib=T[ha];ib.getRootUnionEntityName()!=n&&V.push(ib)}T=V}};this.removeInnerRelationByFromAndToEntityName=
function(n,V){for(var Ga=[],ha=[],ib=0;ib<F.length;ib++){var p=F[ib];p.isInnerRelation()?n==p.getFromEntity().getName()&&V==p.getToEntity().getName()?Ga.push(p):ha.push(p):ha.push(p)}F=ha;return Ga};this.removeInnerRelationByEntityName=function(n){for(var V=[],Ga=[],ha=0;ha<F.length;ha++){var ib=F[ha];ib.isInnerRelation()?n[ib.getFromEntity().getName()]||n[ib.getToEntity().getName()]?V.push(ib):Ga.push(ib):Ga.push(ib)}F=Ga;return V};this.buildToEntityRelationsMap=function(){for(var n={},V=0;V<F.length;V++){var Ga=
F[V];Ga.isInnerRelation()&&(n[Ga.getToEntity().getName()]=Ga)}return n};this.getExtractSchedule=function(){return I};this.getExtractConfig=function(){return S};this.setExtractConfig=function(n){S=n};this.checkSchedule=function(){if(I.getPeriod())for(var n=0;n<v.length;n++){var V=v[n];if(V.hasDirectModel())return new Kb("Unsupport schedule setting",0,"["+V.getAlias()+"]"+Cc.get("dataTableUnsupportScheduleSetting","\u6570\u636e\u8868\u4e0d\u652f\u6301\u5b9a\u65f6\u9884\u63d0\u53d6"))}if("Custom"==I.getPeriod()){n=
I.getCron();if("undefined"==typeof n||""==n)return n=new Kb("Cron warning",0,Cc.get("cronErrorMessage","\u8bf7\u8f93\u5165\u8868\u8fbe\u5f0f\u3002")),n.setPromptLevel(Kb.LEVEL_WARNING),n;if(n=I.getCronMsg())return new Kb("Cron error",0,n)}return null};this.toJsonObject=function(){for(var n={},V=l.getSources(),Ga=[],ha=0;ha<V.length;ha++)Ga.push(V[ha].toJsonObject());n.sources=Ga;V=[];for(ha=0;ha<v.length;ha++)V.push(v[ha].toJsonObject());n.entities=V;V=[];for(ha=0;ha<F.length;ha++)V.push(F[ha].toJsonObject());
n.relations=V;V=[];for(ha=0;ha<T.length;ha++)V.push(T[ha].toJsonObject());n.bizUnionInnerEntityRelations=V;n.schedule=I.toJsonObject();S&&(n.extractConfig=S.toJsonObject());return n};this.fromJsonObject=function(n){J=n.tooMordern;for(var V=l.getSourcesMap(n.sources),Ga={},ha={},ib=n.entities,p=0;p<ib.length;p++){var ic=ib[p];var sc=ic.children;var hb=!1;"undefined"!=typeof sc&&0<sc.length?(sc=new Wb,hb=!0):sc=new rc;sc.fromJsonObject(ic,V,Ga);Hc(sc);Ga[sc.getName()]=sc;hb&&Db(sc,ha)}V=n.relations;
for(p=0;p<V.length;p++)ib=V[p],ic=new ma,ic.fromJsonObject(ib,Ga),Za(ic);if(Ga=n.bizUnionInnerEntityRelations)for(p=0;p<Ga.length;p++)V=Ga[p],ib=new Lb,ib.fromJsonObject(V,ha),T.push(ib);ha=n.schedule;I=new kd;I.fromJsonObject(ha);if(n=n.extractConfig)S=new Gc,S.fromJsonObject(n)};var Db=function(n,V){if(n.isUnion()&&n.getUnionType()==Wb.BIZ_UNION){var Ga=n.getTopParentEntity(),ha=V[Ga.getName()];ha||(ha={},V[Ga.getName()]=ha);n=n.getChildren();for(V=0;V<n.length;V++)ha[n[V].getName()]=n[V]}};this.cloneMe=
function(){var n=new Ha,V={},Ga={},ha;for(ha in v){var ib=v[ha],p=ib.getParentEntity();p=p?V[p.getName()]:null;ib=ib.cloneMe(p);V[ib.getName()]=ib;n.onlyPushEntity(ib);Db(ib,Ga)}for(ha in F)ib=F[ha].toJsonObject(),p=new ma,p.fromJsonObject(ib,V),n.addRelation(p);for(ha in T)V=new Lb,V.fromJsonObject(T[ha].toJsonObject(),Ga),n.addUnionInnerEntityRelation(V);return n};this.getSourcesMap=function(n){for(var V={},Ga=0;Ga<n.length;Ga++){var ha=l.getSource(n[Ga]);V[ha.getName()]=ha}return V};this.getSourcesArr=
function(n){for(var V=[],Ga=0;Ga<n.length;Ga++){var ha=l.getSource(n[Ga]);V.push(ha)}return V};this.getSource=function(n){if(n.dbType)var V=new mb;else if(n.fileType)V=n.fileType!=Qc.TYPE_EXCEL?new Da:new Xb;else if(n.openAPIType)V=new oa,"RESTFUL_DATA_SET"==n.openAPIType?V.setOpenAPIType("RESTFUL_DATA_SET"):V.setOpenAPIType("PROGRAM_DATA_SET");else if(V=n.bizMetaType)V=lc.SourceType.createBizMetaSource(V);else throw Error("Modify here when new type of source appended.");V.fromJsonObject(n);return V};
this.funClearUserSqlsAndStoredProcedures=function(n){for(var V=l.copyEntityArray(),Ga=[],ha=0;ha<V.length;ha++){var ib=V[ha];ib instanceof rc?Ga.push(ib):ib instanceof Wb&&(Ga=Ga.concat(ib.getChildren()))}var p=n.getAllUserSqlName();if(p)for(V=0;V<p.length;V++){ha=!0;for(var ic=p[V],sc=0;sc<Ga.length;sc++){ib=Ga[sc];var hb=ib.getSource();if(n.getName()==hb.getName()&&ic==ib.getName()){ha=!1;break}}ha&&n.removeUserSql(ic)}if(p=n.getAllStoredProcedureName())for(V=0;V<p.length;V++){ha=!0;ic=p[V];for(sc=
0;sc<Ga.length;sc++)if(ib=Ga[sc],hb=ib.getSource(),n.getName()==hb.getName()&&ic==ib.getName()){ha=!1;break}ha&&n.removeStoredProcedure(ic)}}}function Kb(l,B,J){var v=J,F=Kb.LEVEL_ERROR,T=2E3;this.showMessageCurtain=function(I){switch(F){case Kb.LEVEL_SUCCESS:I.showSuccess(J,T);break;case Kb.LEVEL_WARNING:I.showPrompt(J,T);break;default:I.showError(J,T)}};this.setPromptLevel=function(I){switch(I){case Kb.LEVEL_SUCCESS:F=Kb.LEVEL_SUCCESS;break;case Kb.LEVEL_WARNING:F=Kb.LEVEL_WARNING;break;default:F=
Kb.LEVEL_ERROR}};this.setDelayToClose=function(I){T=I};this.getEntityName=function(){return l};this.getFiltersErrorRow=function(){return B};this.getPrompt=function(){return v};this.setPrompt=function(I){v=I}}function jc(l,B,J){this.getRelation=function(){return l};this.getOldValue=function(){return B};this.getNewValue=function(){return J}}function Cb(){var l=this,B,J,v,F,T,I,S=[],cb=[],ub=[],Ea,qb,xc=[],Hc,Nc,Za,ec=!1,Db,n;this.isUnion=function(){throw Error("Override me.");};this.getTreeRootProps=
function(){return cb};this.getErrorDesc=function(){return n?n.getErrorDesc():""};this.setErrorInfo=function(ba){n=ba};this.getTreeRootProp=function(ba){for(var Ra=0;Ra<cb.length;Ra++)if(ba.getName()==cb[Ra].getName())return cb[Ra];return null};this.setTreeRootProps=function(ba){cb=ba};this.collectSources=function(ba){throw Error("Override me.");};this.collectJsonSource=function(){throw Error("Override me.");};this.getErrorState=function(){return n?n.getErrorState():null};this.isErrorExist=function(){return n?
!0:!1};this.mergeSource=function(ba){throw Error("Override me.");};this.setFieldVisible=function(ba){ec=ba};this.getFieldVisible=function(){return ec};this.setChangedListener=function(ba){B=ba};var V=function(ba){B&&B(ba)};this.setName=function(ba){J=ba};this.getName=function(){return J};this.setAlias=function(ba){v=ba;V(rc.KEY_CHANGE_ENTITYALIAS)};this.getAlias=function(){return v};this.getPropertyChildren=function(ba){for(var Ra=0;Ra<cb.length;Ra++)if(ba==cb[Ra].getName())return cb[Ra].getChildren();
return null};this.setAssociateName=function(ba){T=ba};this.getAssociateName=function(){return T};this.setCommentInfo=function(ba){I=ba};this.getCommentInfo=function(){return I};this.setColumnToRowProperties=function(ba){Db=ba};this.getColumnToRowProperties=function(){return Db};this.syncPropertyFrom=function(ba){for(var Ra={},Sb=0;Sb<ba.length;Sb++){var Ub=ba[Sb];Ra[Ub.getAssociateName()]=Ub}for(Sb=0;Sb<S.length;Sb++)if(ba=Ra[S[Sb].getAssociateName()])ba.setPrecision(S[Sb].getPrecision()),S[Sb]=ba};
this.refreshNotExistedProperty=function(ba){var Ra={};ba.forEach(function(Ub){Ra[Ub]=Ub});for(ba=0;ba<S.length;ba++){var Sb=S[ba];Sb.setNotExisted(null!=Ra[Sb.getName()])}};this.setProperties=function(ba,Ra){S=ba;if(xc&&S){if(!Ra)for(Ra={},ba=0;ba<S.length;ba++){var Sb=S[ba];Ra[Sb.getName()]=Sb}for(ba=0;ba<xc.length;ba++)xc[ba].updateProperty(Ra)}};this.getProperties=function(){return S};this.getFilteredProperties=function(ba){for(var Ra=[],Sb=0;Sb<S.length;Sb++)ba(S[Sb])&&Ra.push(S[Sb]);return Ra};
this.getParild=function(){return ub};this.setParild=function(ba){ub=ba};this.getArrEntitySubView=function(){return Ea};this.getArrViewItem=function(){return qb};this.setFilters=function(ba){xc=ba};this.getFilters=function(){return xc};this.hasDirectModel=function(){return Hc};this.setDirectModel=function(ba){Hc=ba};this.setDesign=function(ba){Nc=ba};this.getDesign=function(ba){!Nc&&ba&&(Nc=new oc);return Nc};this.setParentEntity=function(ba){Za=ba};this.getParentEntity=function(){return Za};this.findParentEntityByName=
function(ba){for(var Ra=l;Ra.getParentEntity();)if(Ra=Ra.getParentEntity(),Ra.getName()==ba)return Ra;return null};this.getTopParentEntity=function(){for(var ba=l;ba.getParentEntity();)ba=ba.getParentEntity();return ba};this.isSubNodeAtView=function(){return Za?!0:!1};this.fission=function(){};this.getSubNodeLevel=function(){for(var ba=0,Ra=Za;Ra;)ba++,Ra=Ra.getParentEntity();return ba};this.searchProperty=function(ba){var Ra=ba.getParent();ba=ba.getName();if(Ra){for(var Sb=0;Sb<cb.length;Sb++)if(Ra.getName()==
cb[Sb].getName()){var Ub=cb[Sb].findProperty(ba);if(Ub)return Ub}return null}for(Ra=0;Ra<S.length;Ra++)if(S[Ra].getName()==ba)return S[Ra];return l.findPropertyFromColumnToRowProperty(ba)};this.findProperty=function(ba){for(var Ra=0;Ra<S.length;Ra++)if(S[Ra].getName()==ba)return S[Ra];for(Ra=0;Ra<cb.length;Ra++){var Sb=cb[Ra].findProperty(ba);if(Sb)return Sb}return l.findPropertyFromColumnToRowProperty(ba)};this.findPropertyFromColumnToRowProperty=function(ba){var Ra=l.getColumnToRowProperties();
if(null!=Ra&&0<Ra.length)for(var Sb in Ra){var Ub=Ra[Sb],Gb=Ub.getFieldNameProperty();if(ba==Gb.getName())return Gb;var tb=Ub.getFieldValueProperties();for(Y in tb)if(Gb=tb[Y],ba==Gb.getName()){ba=void 0;Ra=Gb;Ub=Ub.getColumnToRowPropertyItems();if(S&&0<S.length){Sb={};for(ba in S){var Y=S[ba];Gb=Y.getName();Sb[Gb]=Y}Gb=Y=0;for(ba in Ub)for(Ja in tb=Ub[ba].getPropertyValues(),tb)Y++,Sb[tb[Ja]]&&Gb++;var Ja=Gb==Y?Ra:null}else Ja=void 0;return Ja}}return null};this.checkFilters=function(ba){var Ra=
0;ba=-1;for(var Sb=null,Ub=0;Ub<xc.length;Ub++){var Gb=xc[Ub];if(!Gb.isEmpty()&&(Sb=Gb,Ra+=Gb.getLeftBracketCount(),Ra-=Gb.getRightBracketCount(),0>ba&&0!=Ra&&(ba=Ub),0>Ra))return Ra=Cc.get("bracketMismatch","\u5de6\u53f3\u62ec\u53f7\u4e0d\u5339\u914d\u3002"),new Kb(J,ba,Ra)}if(0<Ra)return Ra=Cc.get("bracketMismatch","\u5de6\u53f3\u62ec\u53f7\u4e0d\u5339\u914d\u3002"),new Kb(J,ba,Ra);for(Ub=0;Ub<xc.length;Ub++)if(Gb=xc[Ub],!Gb.isEmpty()&&Gb!=Sb&&!Gb.getLogicOp())return Ra=Cc.get("lackLogicalSymbol",
"\u7b2c#1\u884c\u7f3a\u5c11\u903b\u8f91\u7b26"),Ra=Ra.replace("#1",Ub+1),new Kb(J,Ub,Ra);return null};this.toExecuteJsonArr=function(ba){ba.push(l.toExecutableJsonObject());Za&&Za.toExecuteJsonArr(ba)};this.toExecutableJsonObject=function(){var ba={};ba.name=J;ba.alias=v;ba.associateName=T;Za&&(ba.parentName=Za.getName());Ga(ba);ha(ba);ib(ba);p(ba);l.protectedToJsonObject(ba);return ba};this.toPropertiesJsonObject=function(ba){var Ra={};Ga(Ra,ba);return Ra.properties};this.toOutputPropertiesJsonObject=
function(ba){for(var Ra={},Sb=[],Ub=l.getOutputProperties(S),Gb=0;Gb<Ub.length;Gb++)if(!ba||!ba(Ub[Gb])){var tb=Ub[Gb].toJsonObject();Sb.push(tb)}Ra.properties=Sb;return Ra.properties};var Ga=function(ba,Ra){for(var Sb=[],Ub=0;Ub<S.length;Ub++)if(!Ra||!Ra(S[Ub])){var Gb=S[Ub].toJsonObject();Sb.push(Gb)}ba.properties=Sb},ha=function(ba){for(var Ra=[],Sb=0;Sb<ub.length;Sb++){var Ub=ub[Sb].toJsonObject();Ra.push(Ub)}ba.parilds=Ra},ib=function(ba){for(var Ra=[],Sb=0;Sb<xc.length;Sb++){var Ub=xc[Sb];Ub.isEmpty()||
(Ub=Ub.toJsonObject(),Ra.push(Ub))}ba.filters=Ra};this.toJsonObject=function(){var ba={};ba.name=J;ba.alias=v;ba.associateName=T;ba.directModel=Hc;Nc&&(ba.design=Nc.toJsonObject());Za&&(ba.parentName=Za.getName());Ga(ba);ha(ba);if(Ea){for(var Ra=[],Sb=0;Sb<Ea.length;Sb++){var Ub=Ea[Sb].toJsonObject();Ra.push(Ub)}ba.subViews=Ra}if(qb){Ra=[];for(Sb=0;Sb<qb.length;Sb++)Ra.push(qb[Sb].toJsonObject());ba.viewItems=Ra}ib(ba);p(ba);l.protectedToJsonObject(ba);return ba};var p=function(ba){if(Db){var Ra=
[],Sb;for(Sb in Db)Ra.push(Db[Sb].toJsonObject());ba.columnToRowProperties=Ra}};this.cloneMe=function(){throw Error("override me");};this.getErrorInfo=function(){return n};this.setTitle=function(ba){F=ba};this.getTitle=function(){return F};this.fromJsonObject=function(ba,Ra,Sb){J=ba.name;v=ba.alias;F=ba.title;T=ba.associateName;I=ba.commentInfo;Hc=ba.directModel;var Ub=ba.design,Gb=ba.errorInfo;Gb&&(n=new zc,n.fromJsonObject(Gb));Ub&&(Nc=new oc,Nc.fromJsonObject(Ub));Za=(Ub=ba.parentName)?Sb[Ub]:
null;Ub={};var tb=ba.properties;if(tb)for(Gb=0;Gb<tb.length;Gb++){var Y=tb[Gb],Ja=new ab;Ja.fromJsonObject(Y);S.push(Ja);Ub[Ja.getName()]=Ja}if(tb=ba.treeNodeProperties)for(Gb=0;Gb<tb.length;Gb++)Y=new uc,Y.fromJsonObject(tb[Gb]),Ja=Ub[Y.getName()],Y.bindProperty(Ja),cb.push(Y);if(Gb=ba.parilds)for(tb=0;tb<Gb.length;tb++)Y=Gb[tb],Ja=new $b,Ja.fromJsonObject(Y,Ub),ub.push(Ja);if(Gb=ba.subViews)for(Ea=[],tb=0;tb<Gb.length;tb++)Y=Gb[tb],Ja=new tc(l),Ja.fromJsonObject(Y,Ub),Ea.push(Ja);if(Gb=ba.viewItems)for(qb=
[],tb=0;tb<Gb.length;tb++)Y=Gb[tb],Ja="undefined"!=typeof Y.alias?new La:new Eb,Ja.fromJsonObject(Y,Ub),qb.push(Ja);if(Gb=ba.columnToRowProperties){Db=[];for(var W in Gb){tb=new Kc;tb.fromJsonObject(Gb[W]);Y=tb.getFieldNameProperty();Ub[Y.getName()]=Y;Y=tb.getFieldValueProperties();if(null!=Y&&0<Y.length)for(var X in Y)Ja=Y[X],Ub[Ja.getName()]=Ja;Db.push(tb)}}if(W=ba.filters)for(X=0;X<W.length;X++)Gb=W[X],tb=new Xa,tb.fromJsonObject(Gb,Ub),xc.push(tb);l.protectedFromJsonObject(ba,Ra,Sb)};this.protectedToJsonObject=
function(ba){throw Error("Override me.");};this.protectedFromJsonObject=function(ba,Ra,Sb){throw Error("Override me.");};this.getChooseRelationProperties=function(){return ic(S,!0,!0)};this.getOutputProperties=function(ba){return ic(ba,!0,!0)};var ic=function(ba,Ra,Sb){var Ub=l.getColumnToRowProperties();if(null==Ub||0==Ub.length||!Ra&&!Sb)return ba;var Gb=[],tb=[],Y=[],Ja;for(Ja in Ub){var W=Ub[Ja];Y.push(W.getFieldNameProperty());Y=Y.concat(W.getFieldValueProperties());W=W.getColumnToRowPropertyItems();
for(var X in W)tb=tb.concat(W[X].getPropertyValues())}if(Ra&&null!=tb&&0<tb.length)for(X=0;X<ba.length;X++)-1==tb.indexOf(ba[X].getName())&&Gb.push(ba[X]);if(Sb&&null!=Y&&0<Y.length)for(X in Y)Gb.push(Y[X]);return Gb};this.getPropertyViewNodes=function(){var ba=[],Ra=l.getProperties(),Sb=l.getParild();sc(ba,Ra,Sb);Ra=l.getColumnToRowProperties();if(null!=Ra&&0!=Ra.length){Sb=[];var Ub=[],Gb;for(Gb in Ra){var tb=Ra[Gb];Ub.push(tb.getFieldNameProperty());Ub=Ub.concat(tb.getFieldValueProperties());tb=
tb.getColumnToRowPropertyItems();for(var Y in tb)Sb=Sb.concat(tb[Y].getPropertyValues())}if(null!=Sb&&0<Sb.length)for(Y=0;Y<ba.length;Y++)-1!=Sb.indexOf(ba[Y].getUniqueName())&&(ba.splice(Y,1),Y--);null!=Ub&&0<Ub.length&&sc(ba,Ub,[])}return ba};this.isSupportChangeFieldType=function(){return!0};this.isSupportCreateRelation=function(){return!0};this.isSupportExtractData=function(){return!0};var sc=function(ba,Ra,Sb){for(var Ub={},Gb=0;Gb<Ra.length;Gb++){var tb=Ra[Gb];Ub[tb.getName()]=tb}var Y={};for(Gb=
0;Gb<Sb.length;Gb++)tb=Sb[Gb],Y[tb.getName()]=tb;hb(l,0,ba,Ub,Y);for(Gb=0;Gb<Ra.length;Gb++)tb=Ra[Gb],Ub[tb.getName()]&&hd(tb,0,ba,Ub,Y)},hb=function(ba,Ra,Sb,Ub,Gb){var tb=ba.getArrEntitySubView();if(tb)for(var Y=0;Y<tb.length;Y++){var Ja=tb[Y],W=new Ya(Ja,Ra);Sb.push(W);hb(Ja,Ra+1,Sb,Ub,Gb)}if(ba=ba.getArrViewItem())for(Y=0;Y<ba.length;Y++){var X=ba[Y];if(X instanceof La){var ia=X;tb=Ra;Ja=Sb;W=Ub;X=new Ya(ia,tb);Ja.push(X);if(X=ia.getItems())for(var ka=0;ka<X.length;ka++){ia=X[ka];var Aa=tb+1,
sa=Ja,ya=W;ia=ia.getProperty();hd(ia,Aa,sa,ya,void 0)}}else X instanceof Eb&&(tb=Ra,Ja=Sb,W=Ub,ia=Gb,X=X.getProperty(),hd(X,tb,Ja,W,ia))}},hd=function(ba,Ra,Sb,Ub,Gb){if(ba.getGroupName()){var tb=Gb[ba.getGroupName()];if(tb){var Y=new Ya(tb,Ra);Sb.push(Y);delete Gb[tb.getName()]}Ra+=1}Y=new Ya(ba,Ra);Sb.push(Y);delete Ub[ba.getName()]};this.protectedMethod={fireChangedEvent:V}}function oc(){var l,B,J,v;this.setRectangle=function(F){l=F[0];B=F[1];J=F[2];v=F[3]};this.getRectangle=function(){return[l,
B,J,v]};this.toJsonObject=function(){var F={};F.x=l;F.y=B;F.width=J;F.height=v;return F};this.fromJsonObject=function(F){l=F.x;B=F.y;J=F.width;v=F.height}}function rc(){Cb.call(this);var l=this,B=this.protectedMethod,J,v,F=-1,T;this.cloneMe=function(I){var S=new rc;S.setName(l.getName());S.setAssociateName(l.getAssociateName());S.setAlias(l.getAlias());S.setUnionLocation(F);S.setUnionUnit(v);S.setERPCloudEntityType(T);S.setFieldVisible(l.getFieldVisible());S.setErrorInfo(l.getErrorInfo());S.setSource(J);
S.setParentEntity(I);S.setCommentInfo(l.getCommentInfo());S.setTitle(l.getTitle());var cb=l.getProperties(),ub=[];I={};for(var Ea in cb){var qb=cb[Ea].cloneMe();ub.push(qb);I[qb.getName()]=qb}S.setProperties(ub);cb=S.getTreeRootProps();ub=l.getTreeRootProps();for(Ea in ub){qb=ub[Ea];var xc=I[qb.getName()];xc&&cb.push(qb.cloneMe(xc))}cb=l.getFilters();ub=S.getFilters();for(Ea in cb)cb[Ea].isEmpty()||(qb=cb[Ea].cloneMe(I),ub.push(qb));cb=l.getArrEntitySubView();ub=S.getArrEntitySubView();for(Ea in cb)qb=
cb[Ea].toJsonObject(),xc=new tc,xc.fromJsonObject(qb,I),ub.push(xc);cb=l.getArrViewItem();ub=S.getArrViewItem();for(Ea in cb)qb=cb[Ea].toJsonObject(),xc="undefined"!=typeof qb.alias?new La:new Eb,xc.fromJsonObject(qb,I),ub.push(xc);cb=l.getParild();ub=S.getParild();for(Ea in cb)qb=new $b,qb.fromJsonObject(cb[Ea].toJsonObject(),I),ub.push(qb);return S};this.isUnion=function(){return!1};this.collectSources=function(I){I[J.getName()]=J};this.collectJsonSource=function(I){I.push(J.toJsonObject())};this.getUnionLocation=
function(){return F};this.setUnionLocation=function(I){F=I};this.getERPCloudEntityType=function(){return T};this.setERPCloudEntityType=function(I){T=I};this.fission=function(){J.fissionFor(l)};this.mergeSource=function(I){for(var S=0;S<I.length;S++){var cb=I[S];if(J.isTheSame(cb)){I=J;J=cb;J.mergeFrom(I);J.mergeFromSourceAndEntity(I,l);break}}};this.setSource=function(I){J=I;B.fireChangedEvent(rc.KEY_CHANGE_SOURCE)};this.getSource=function(){return J};this.setUnionUnit=function(I){v=I};this.protectedToJsonObject=
function(I){I.source=J.getName();v&&(I.isUnionUnit=v);I.unionLocation=F;I.erpCloudEntityType=T};this.protectedFromJsonObject=function(I,S,cb){J=S[I.source];I.isUnionUnit&&(v=I.isUnionUnit);F=I.unionLocation;T=I.erpCloudEntityType};this.isSupportChangeFieldType=function(){return J.isSupportChangeFieldType(l.getAssociateName())};this.isSupportCreateRelation=function(){return J.isSupportCreateRelation(l.getAssociateName())};this.isSupportExtractData=function(){return J.isSupportExtractData(l.getAssociateName())}}
function Kc(){var l,B=[],J=[];this.setFieldNameProperty=function(v){l=v};this.getFieldName=function(){return l?l.getName():""};this.getFieldNameProperty=function(){return l};this.getFieldValueProperties=function(){return B};this.getUsedColumnToRowPropertyNames=function(){var v=[];if(J&&0<J.length)for(var F in J){var T=J[F].getPropertyValues(),I=void 0,S=v;if(T&&0<T.length)for(I in S=S?S:[],T)S.push(T[I])}return v};this.getFieldValueNames=function(){var v=[],F;for(F in B)v.push(B[F].getName());return v};
this.getFieldValueName=function(v){return this.getFieldValueNames()[v]};this.setFieldValueProperties=function(v){B=v};this.addFieldNameProperty=function(v){l=new ab;l.setName(v);l.setAssociateName(v);l.setAlias(v);l.setDataType(ab.DT_STRING);l.setAppointedDataType(ab.DT_STRING)};this.setFieldName=function(v){l?(l.setName(v),l.setAlias(v),l.setAssociateName(v)):this.addFieldNameProperty(v)};this.addFieldValueProperty=function(v,F){var T=new ab;T.setName(F);T.setAssociateName(F);T.setAlias(F);T.setDataType(ab.DT_STRING);
T.setAppointedDataType(ab.DT_STRING);B[v]=T};this.addFieldValueName=function(v,F){var T=B[v];T?(T.setName(F),T.setAlias(F),T.setAssociateName(F)):this.addFieldValueProperty(v,F)};this.deleteFieldValueProperty=function(v){if(J&&0<J.length)for(var F=0;F<J.length;F++){var T=J[F];T&&T.getPropertyValues().splice(v,1)}B.splice(v,1)};this.getFieldValueProperty=function(v){return B[v]};this.setColumnToRowPropertyItems=function(v){J=v};this.addColumnToRowPropertyItem=function(v,F){J[v]=F};this.deleteColumnToRowPropertyItem=
function(v){J.splice(v,1)};this.getColumnToRowPropertyItem=function(v){return J[v]};this.getColumnToRowPropertyItems=function(){return J};this.toJsonObject=function(){var v={};v.fieldNameProperty=l.toJsonObject();var F=[],T;for(T in B)F.push(B[T].toJsonObject());v.fieldValueProperties=F;F=[];if(J){for(T=0;T<J.length;T++)F.push(J[T].toJsonObject());v.columnToRowPropertyItems=F}return v};this.fromJsonObject=function(v){l=new ab;l.fromJsonObject(v.fieldNameProperty);var F=v.columnToRowPropertyItems,
T=[];if(F)for(var I=0;I<F.length;I++){var S=new Bc;S.fromJsonObject(F[I]);T.push(S)}J=T;if(v=v.fieldValueProperties)for(I=0;I<v.length;I++)F=v[I],T=new ab,T.fromJsonObject(F),B.push(T)}}function Bc(){var l,B=[];this.setFieldName=function(J){l=J};this.getFieldName=function(){return l};this.setPropertyValues=function(J){B=J};this.getPropertyValues=function(){return B};this.toJsonObject=function(){var J={};J.fieldName=l;J.propertyValues=B.slice(0);return J};this.fromJsonObject=function(J){J.fieldName&&
(l=J.fieldName);J.propertyValues&&(B=J.propertyValues)}}function uc(){var l,B=[],J,v,F={};this.cloneMe=function(T){var I=new uc;I.setVisibleInRelation(J);I.setTreeType(v);var S=I.getChildren();B.forEach(function(Ea){Ea=Ea.cloneMe();S.push(Ea)});var cb={},ub;for(ub in F)cb[ub]=F[ub];I.setPropNameToFlexFieldKeyMap(cb);I.bindProperty(T);return I};this.getRefProp=function(){return l};this.setPropNameToFlexFieldKeyMap=function(T){F=T};this.getFlexFieldKey=function(T){return F[T]};this.setVisibleInRelation=
function(T){J=T};this.setTreeType=function(T){v=T};this.fromJsonObject=function(T){l=new ab;l.fromJsonObject(T.me);J=T.visibleInRelation;v=T.treeType;F=T.propNameToFlexFieldKeyMap;if(T=T.children)for(var I=0;I<T.length;I++){var S=new ab;S.setParent(l);S.fromJsonObject(T[I]);B.push(S)}};this.getTreeType=function(){return v};this.findProperty=function(T){for(var I=0;I<B.length;I++)if(B[I].getName()==T)return B[I];return null};this.getChildren=function(){return B};this.getName=function(){return l.getName()};
this.bindProperty=function(T){l=T;l.setHasChild(!0);l.setTreeType(v);for(T=0;T<B.length;T++)B[T].setParent(l)};this.mergeFrom=function(T){if(T&&T.getTreeType()==v){var I={};for(cb in F){var S=F[cb];I[S]=S}var cb=T.getChildren();for(var ub=0;ub<cb.length;ub++){var Ea=cb[ub],qb=Ea.getName();F[qb]||(S=T.getFlexFieldKey(qb))&&!I[S]&&(I[S]=S,F[qb]=S,S=Ea.cloneMe(),S.setParent(l),B.push(S))}}};this.getAssociateName=function(){return l.getAssociateName()};this.isVisibleInRelation=function(){return J}}function Wb(){Cb.call(this);
var l=[],B=this,J=Wb.NOT_BIZ_UNION;this.getEntityChild=function(v){for(var F=0;F<l.length;F++)if(l[F].getName()==v)return l[F];return null};this.cloneMe=function(v){var F=new Wb;F.setName(B.getName());F.setAssociateName(B.getAssociateName());F.setAlias(B.getAlias());F.setUnionType(B.getUnionType());F.setParentEntity(v);l.forEach(function(qb){var xc;if(v){var Hc=qb.getUnionLocation(),Nc=v.getChildren(),Za;for(Za in Nc)Nc[Za].getUnionLocation()==Hc&&(xc=Nc[Za])}F.getChildren().push(qb.cloneMe(xc))});
var T={};B.getProperties().forEach(function(qb){qb=qb.cloneMe();F.getProperties().push(qb);T[qb.getName()]=qb});var I=F.getTreeRootProps(),S=B.getTreeRootProps(),cb;for(cb in S){var ub=S[cb],Ea=T[ub.getName()];Ea&&I.push(ub.cloneMe(Ea))}I=B.getFilters();S=F.getFilters();for(cb in I)I[cb].isEmpty()||(ub=I[cb].cloneMe(T),S.push(ub));return F};this.isSupportColumnToRow=function(){var v=!0;if(l)for(var F in l)if(!l[F].getSource().isSupportColumnToRow()){v=!1;break}return v};this.hasDirectModel=function(){for(var v=
0;v<l.length;v++)if(l[v].hasDirectModel())return!0;return!1};this.setDirectModel=function(v){};this.isUnion=function(){return!0};this.getChildren=function(){return l};this.fission=function(){for(var v=0;v<l.length;v++)l[v].fission()};this.collectSources=function(v){for(var F=0;F<l.length;F++){var T=l[F].getSource();v[T.getName()]=T}};this.collectJsonSource=function(v){for(var F=0;F<l.length;F++){var T=l[F].getSource();v.push(T.toJsonObject())}};this.mergeSource=function(v){for(var F=0;F<l.length;F++)for(var T=
l[F],I=T.getSource(),S=0;S<v.length;S++){var cb=v[S];if(I.isTheSame(cb)){cb.mergeFrom(I);T.setSource(cb);break}}};this.protectedToJsonObject=function(v){for(var F=[],T=0;T<l.length;T++){var I=l[T].toJsonObject();F.push(I)}v.children=F;v.unionType=J};this.getUnionType=function(){return J};this.setUnionType=function(v){J=v};this.protectedFromJsonObject=function(v,F,T){var I=v.children;v.unionType&&(J=v.unionType);if(J==Wb.NOT_BIZ_UNION)for(v=0;v<I.length;v++){var S=I[v],cb=new rc;cb.setUnionUnit(!0);
cb.fromJsonObject(S,F,T);l.push(cb)}else if(J==Wb.BIZ_UNION){T=B.getParentEntity();var ub={};T&&T.getChildren().forEach(function(Ea){ub[Ea.getName()]=Ea});for(v=0;v<I.length;v++)S=I[v],cb=new rc,cb.setUnionUnit(!0),cb.fromJsonObject(S,F,ub),l.push(cb)}else throw Error("current union entity type is illegal");};this.removeChild=function(v){for(var F=[],T=0;T<l.length;T++)l[T].getName()!=v.getName()&&F.push(l[T]);l=F};this.resetEntityChildren=function(v){l=v};this.indexOfEntity=function(v){for(var F=
0;F<l.length;F++)if(l[F].getName()==v.getName())return F;return-1};this.supportRefreshEntity=function(){var v=!1;if(l)for(var F in l)if(v=l[F].getSource().supportRefreshEntity()){v=!0;break}return v}}function tc(l){var B=this,J,v,F,T;this.getName=function(){return J};this.getAlias=function(){return v};this.getArrEntitySubView=function(){return F};this.getArrViewItem=function(){return T};this.toJsonObject=function(){var I={};I.name=J;I.alias=v;if(F){for(var S=[],cb=0;cb<F.length;cb++){var ub=F[cb].toJsonObject();
S.push(ub)}I.subViews=S}if(T){S=[];for(cb=0;cb<T.length;cb++)S.push(T[cb].toJsonObject());I.viewItems=S}return I};this.fromJsonObject=function(I,S){J=I.name;v=I.alias;var cb=I.subViews;if(cb){F=[];for(var ub=0;ub<cb.length;ub++){var Ea=cb[ub],qb=new tc(B);qb.fromJsonObject(Ea,S);F.push(qb)}}if(I=I.viewItems)for(T=[],cb=0;cb<I.length;cb++)ub=I[cb],Ea="undefined"!=typeof ub.alias?new La:new Eb,Ea.fromJsonObject(ub,S),T.push(Ea)}}function La(){var l,B,J;this.getName=function(){return l};this.getAlias=
function(){return B};this.getItems=function(){return J};this.toJsonObject=function(){var v={};v.name=l;v.alias=B;if(J){for(var F=[],T=0;T<J.length;T++)F.push(J[T].toJsonObject());v.items=F}return v};this.fromJsonObject=function(v,F){l=v.name;B=v.alias;if(v=v.items){J=[];for(var T=0;T<v.length;T++){var I=v[T],S=new Eb;S.fromJsonObject(I,F);J.push(S)}}}}function Eb(){var l,B;this.getName=function(){return l};this.getAlias=function(){return B.getAlias()};this.setAlias=function(J){B.setAlias(J)};this.getProperty=
function(){return B};this.toJsonObject=function(){var J={};J.name=l;return J};this.fromJsonObject=function(J,v){l=J.name;v[l]&&(B=v[l])}}function xb(){var l,B,J;this.getEntityAssociateName=function(){return l};this.getPkPropertyName=function(){return B};this.getDisplayPropertyName=function(){return J};this.toJsonObject=function(){var v={};v.entityAssociateName=l;v.pkPropertyName=B;v.displayPropertyName=J;return v};this.fromJsonObject=function(v){l=v.entityAssociateName;B=v.pkPropertyName;J=v.displayPropertyName}}
function ab(){var l=this,B,J,v,F,T,I,S,cb,ub,Ea,qb,xc,Hc=!1,Nc,Za=!1,ec,Db=!1,n=!1,V=!1,Ga,ha,ib=-1,p=!1,ic=!1;this.isNotExisted=function(){return V};this.setNotExisted=function(hb){V=hb};this.setParent=function(hb){ha=hb};this.setTreeType=function(hb){ib=hb};this.getTreeType=function(){return ib};this.getParent=function(){return ha};this.setFieldVisible=function(hb){Db=hb};this.getFieldVisible=function(){return Db};this.getGroupName=function(){return B};this.setGroupName=function(hb){B=hb};this.setName=
function(hb){J=hb};this.getName=function(){return J};this.setRelatedBaseProp=function(hb){ec=hb};this.getRelatedBaseProp=function(){return ec};this.setAssociateName=function(hb){v=hb};this.getAssociateName=function(){return v};this.setAlias=function(hb){F=hb};this.getAlias=function(){return F};this.setCommentInfo=function(hb){T=hb};this.getCommentInfo=function(){return T};this.hasChild=function(){return Ga};this.setHasChild=function(hb){Ga=hb};this.setDataType=function(hb){sc(hb);I=hb};this.getDataType=
function(){return I};var sc=function(hb){if(hb!==ab.DT_STRING&&hb!==ab.DT_INT&&hb!==ab.DT_NUMBER&&hb!==ab.DT_DATE&&hb!==ab.DT_DATETIME&&hb!==ab.DT_BOOLEAN)throw Error("IllegalArgument: "+hb);};this.setAppointedDataType=function(hb){hb&&sc(hb);S=hb==I?null:hb};this.getAppointedDataType=function(){return S};this.setPrecision=function(hb){cb=hb};this.getPrecision=function(){return cb};this.getOutputDataType=function(){return S?S:I};this.setEnumValue=function(hb){Ea=hb};this.getEnumValue=function(){return Ea};
this.isEnum=function(){return qb?!1:Ea?!0:!1};this.isVoidEnumProp=function(){return qb};this.setForeignKey=function(hb){ub=hb};this.getForeignKey=function(){return ub};this.setFormatString=function(hb){xc=hb};this.getFormatString=function(){return xc};this.setHide=function(hb){Hc=hb?!0:!1};this.isHide=function(){return Hc};this.setHideInDataModeling=function(hb){n=hb};this.isHideInDataModeling=function(){return n};this.setFormula=function(hb){Nc=hb};this.getFormula=function(){return Nc};this.isCalculatingField=
function(){return Nc?!0:!1};this.setCalculatingFieldInvalid=function(hb){Za=hb};this.isCalculatingFieldInvalid=function(){return Za};this.setColumnToRowFieldInvalid=function(hb){ic=hb};this.isColumnToRowFieldInvalid=function(){return ic};this.setColumnToRowField=function(hb){p=hb};this.isColumnToRowField=function(){return p};this.toJsonObject=function(){var hb={};hb.group=B;hb.name=J;hb.associateName=v;hb.alias=F;hb.dataType=I;S&&(hb.appointedDataType=S);xc&&(hb.format=xc);Hc&&(hb.hide=Hc);Nc&&(hb.formula=
Nc);ub&&(hb.foreignKey=ub.toJsonObject());Ea&&(hb.enumValue=Ea);ec&&(hb.relatedBaseProperty=ec);n&&(hb.hideInDataModeling=n);cb&&(hb.precision=cb);return hb};this.fromJsonObject=function(hb){B=hb.group;J=hb.name;v=hb.associateName;F=hb.alias;T=hb.commentInfo;I=hb.dataType;S=hb.appointedDataType;xc=hb.format;Hc=hb.hide?!0:!1;n=hb.hideInDataModeling?hb.hideInDataModeling:!1;Nc=hb.formula;Za=hb.isFormulaInvalid?!0:!1;Ga=hb.hasChild?hb.hasChild:!1;V=hb.isNotExisted?hb.isNotExisted:!1;hb.foreignKey&&(ub=
new xb,ub.fromJsonObject(hb.foreignKey));Ea=hb.enumValue;qb=hb.isVoidEnumProp;hb.relatedBaseProperty&&(ec=hb.relatedBaseProperty);hb.precision&&(cb=hb.precision)};this.cloneMe=function(){var hb=new ab;hb.fromJsonObject(l.toJsonObject());hb.setColumnToRowField(p);hb.setColumnToRowFieldInvalid(ic);hb.setHasChild(Ga);hb.setCalculatingFieldInvalid(Za);hb.setNotExisted(V);hb.setTreeType(ib);hb.setCommentInfo(T);return hb}}function $b(){var l,B,J,v,F,T,I,S,cb,ub;this.setName=function(Ea){l=Ea};this.getName=
function(){return l};this.getAssociateName=function(){return B};this.setAssociateName=function(Ea){B=Ea};this.setAlias=function(Ea){J=Ea};this.getAlias=function(){return J};this.getNecessary=function(){return S};this.setNecessary=function(Ea){S=Ea};this.setIdFieldName=function(Ea){v=Ea};this.getIdFieldName=function(){return v};this.getIdField=function(){return cb};this.setParentIdFieldName=function(Ea){F=Ea};this.getParentIdFieldName=function(){return F};this.getParentIdField=function(){return ub};
this.setDefaultDisplayFieldName=function(Ea){T=Ea};this.getDefaultDisplayFieldName=function(){return T};this.setSortAccordingFieldName=function(Ea){I=Ea};this.getSortAccordingFieldName=function(){return I};this.toJsonObject=function(){var Ea={};Ea.name=l;Ea.associateName=B;Ea.alias=J;Ea.necessary=S;Ea.idField=v;Ea.parentIdField=F;T&&(Ea.defaultDisplayField=T);I&&(Ea.sortAccordingField=I);return Ea};this.fromJsonObject=function(Ea,qb){l=Ea.name;B=Ea.associateName;J=Ea.alias;S=Ea.necessary;v=Ea.idField;
F=Ea.parentIdField;Ea.defaultDisplayField&&(T=Ea.defaultDisplayField);Ea.sortAccordingField&&(I=Ea.sortAccordingField);cb=qb[v];ub=qb[F]}}function Ib(l,B,J){this.getTypeID=function(){return l};this.getI18nKey=function(){return B};this.getDefaultDesc=function(){return J}}function Vb(){this.getId=function(){throw new Exception("override me");};this.getDisplayName=function(){throw new Exception("override me");};this.getTextInUserSQL=function(){throw new Exception("override me");};this.getFilterMode=
function(){throw new Exception("override me");};this.getVariateType=function(){throw new Exception("override me");}}function Xa(){var l=this,B,J,v,F=null,T=0,I=0,S=null,cb=null,ub=Xa.COMPARE_WITH_APPOINTED;this.setProperty=function(Ea){B=Ea};this.getProperty=function(){return B};this.updateProperty=function(Ea){B&&(Ea=Ea[B.getName()])&&(B=Ea)};this.setCompareType=function(Ea){ub=Ea};this.setCompareOp=function(Ea){if(Ea===Xa.COMPARE_EQUAL||Ea===Xa.COMPARE_NOT_EQUAL||Ea===Xa.COMPARE_GREATER||Ea===Xa.COMPARE_GREATER_EQUAL||
Ea===Xa.COMPARE_LESS||Ea===Xa.COMPARE_LESS_EQUAL||Ea===Xa.COMPARE_INCLUDE||Ea===Xa.COMPARE_NOT_INCLUDE||Ea===Xa.COMPARE_START_WITH||Ea===Xa.COMPARE_END_WITH||Ea===Xa.COMPARE_NULL||Ea===Xa.COMPARE_NOT_NULL||Ea===Xa.COMPARE_RELATIVE_DATE_RANGE||Ea===Xa.COMPARE_VARIABLE||Ea===Xa.COMPARE_IN||Ea===Xa.COMPARE_NOT_IN)J=Ea;else throw Error("IllegalArgument: "+Ea);};this.getCompareOp=function(){return J};this.setValue=function(Ea){v=Ea};this.getValue=function(){return v};this.setValueMode=function(Ea){if(Ea===
Xa.MODE_CONST||Ea===Xa.MODE_SYS_VAR||Ea===Xa.MODE_MACRO_VAR)F=Ea;else throw Error("IllegalArgument: "+Ea);};this.isSystemVariant=function(){return F==Xa.MODE_SYS_VAR?!0:!1};this.isMacroVar=function(){return F==Xa.MODE_MACRO_VAR?!0:!1};this.setLeftBracketCount=function(Ea){T=Ea};this.getLeftBracketCount=function(){return T};this.setRightBracketCount=function(Ea){I=Ea};this.getRightBracketCount=function(){return I};this.setLogicOp=function(Ea){if(null===Ea||Ea===Xa.LOGIC_AND||Ea===Xa.LOGIC_OR)S=Ea;
else throw Error("IllegalArgument: "+Ea);};this.getLogicOp=function(){return S};this.setRelativeDateRange=function(Ea){cb=Ea};this.getRelativeDateRange=function(){return cb};this.isEmpty=function(){return B?!1:!0};this.getComparedType=function(){return ub};this.getComparedDataType=function(){return B?ub?ub==Xa.COMPARE_WITH_RAW?B.getDataType():B.getOutputDataType():B.isCalculatingField()?B.getOutputDataType():B.getDataType():null};this.checkCompletion=function(){if(!J)return Cc.get("lackComparisonOperator",
"\u7f3a\u5c11\u6bd4\u8f83\u7b26\u3002");for(var Ea=l.getComparedDataType(),qb=Xa.getSelectableCompares(Ea,B.isEnum()),xc=!1,Hc=0;Hc<qb.length;Hc++)if(J==qb[Hc]){xc=!0;break}if(!xc&&J!=Xa.COMPARE_CUSTOM_VARIABALE)return Cc.get("comparisionMismatch","\u6bd4\u8f83\u7b26\u4e0d\u5339\u914d\u3002");if(!Xa.isCompareOpWithoutValue(J)){if(!v&&!cb)return Cc.get("lackValue","\u7f3a\u5c11\u503c\u3002");if(Ea==ab.DT_NUMBER||Ea==ab.DT_INT){if(!Xa.REG_NUMBER.test(v)&&F!=Xa.MODE_SYS_VAR&&F!=Xa.MODE_MACRO_VAR&&J!=
Xa.COMPARE_IN&&J!=Xa.COMPARE_NOT_IN)return Cc.get("valueMustBeNum","\u503c\u5fc5\u987b\u4e3a\u6570\u5b57\u3002")}else if(Ea==ab.DT_DATE||Ea==ab.DT_DATETIME)if(Xa.isCompareOpRelativeDateRangeValue(J)){if(!(cb instanceof Sc))return Cc.get("invalidRelativeDateValue","\u65e0\u6548\u7684\u76f8\u5bf9\u65e5\u671f\u503c\u3002")}else{if(!Xa.REG_DATETIME.test(v))return Cc.get("invalidDateValue","\u65e0\u6548\u7684\u65e5\u671f\u503c\u3002")}else if(Ea==ab.DT_BOOLEAN&&v!=ab.BOOLEAN_TRUE&&v!=ab.BOOLEAN_FALSE)return Cc.get("wrongBoolean",
"\u9519\u8bef\u7684\u5e03\u5c14\u503c\u3002")}return null};this.toJsonObject=function(){var Ea={};Ea.property=B.getName();Ea.compare=J;Ea.value=v;F&&(Ea.mode=F);0<T&&(Ea.leftBrackets=T);0<I&&(Ea.rightBrackets=I);S&&(Ea.logic=S);cb&&(Ea.relativeDateRange=cb.toJsonObject());ub&&(Ea.compareType=ub);return Ea};this.fromJsonObject=function(Ea,qb){B=qb[Ea.property];J=Ea.compare;v=Ea.value;F=Ea.mode;T=Ea.leftBrackets;I=Ea.rightBrackets;S=Ea.logic;if(qb=Ea.relativeDateRange)cb=new Sc,cb.fromJsonObject(qb);
ub=Ea.compareType};this.cloneMe=function(Ea){var qb=new Xa;qb.setCompareOp(J);qb.setCompareType(ub);qb.setLeftBracketCount(T);qb.setRightBracketCount(I);B&&(Ea=Ea[B.getName()],qb.setProperty(Ea?Ea:B));qb.setLogicOp(S?S:null);qb.setValue(v);F&&qb.setValueMode(F);qb.setRelativeDateRange(cb);return qb}}function ma(){var l,B,J,v,F,T,I=0;this.setChangedListener=function(S){l=S};this.setFromEntity=function(S){var cb=B;B=S;l&&l(ma.KEY_FROM_ENTITY,cb,B)};this.getFromEntity=function(){return B};this.isInnerRelation=
function(){var S=J.getParentEntity();return S&&S==B?!0:!1};this.setToEntity=function(S){var cb=J;J=S;l&&l(ma.KEY_TO_ENTITY,cb,J)};this.getToEntity=function(){return J};this.setFromProperty=function(S){var cb=v;v=S;l&&l(ma.KEY_FROM_PROPERTY,cb,v)};this.getFromProperty=function(){return v};this.setToProperty=function(S){var cb=F;F=S;l&&l(ma.KEY_TO_PROPERTY,cb,F)};this.getToProperty=function(){return F};this.setRelated=function(S){if(S===ma.R_1_1||S===ma.R_1_N||S===ma.R_N_1){var cb=T;T=S;l&&l(ma.KEY_RELATED,
cb,T)}else throw Error("IllegalArgument: "+S);};this.getRelated=function(){return T};this.setFromPointKeepFifthWheel=function(S){I=S?I|ma.KFW_FROM:I&~ma.KFW_FROM};this.isFromPointKeepFifthWheel=function(){return(I&ma.KFW_FROM)==ma.KFW_FROM};this.setToPointKeepFifthWheel=function(S){I=S?I|ma.KFW_TO:I&~ma.KFW_TO};this.isToPointKeepFifthWheel=function(){return(I&ma.KFW_TO)==ma.KFW_TO};this.clone=function(){var S=new ma;S.setFromEntity(B);S.setToEntity(J);S.setFromProperty(v);S.setToProperty(F);S.setRelated(T);
S.setFromPointKeepFifthWheel(this.isFromPointKeepFifthWheel());S.setToPointKeepFifthWheel(this.isToPointKeepFifthWheel());return S};this.toJsonObject=function(){var S={};S.fromEntity=B.getName();S.toEntity=J.getName();S.fromProperty=v.getName();S.toProperty=F.getName();S.related=T;S.keepFifthWheel=I;return S};this.fromJsonObject=function(S,cb){var ub=S.fromEntity,Ea=S.toEntity,qb=S.fromProperty,xc=S.toProperty;T=S.related;I=S.keepFifthWheel;B=cb[ub];J=cb[Ea];v=B?B.findProperty(qb):null;F=J?J.findProperty(xc):
null}}function Lb(){var l,B=[];this.removeRelation=function(J){var v=[];B.forEach(function(F){F.getFromEntity()!=J&&F.getToEntity()!=J&&v.push(F)});B=v};this.addRelation=function(J){B.push(J)};this.getRelations=function(){return B};this.setRootUnionEntityName=function(J){l=J};this.getRootUnionEntityName=function(){return l};this.fromJsonObject=function(J,v){l=J.rootUnionEntityName;J=J.relations;v=v[l];for(var F=0;F<J.length;F++){var T=J[F],I=new ma;I.fromJsonObject(T,v);B.push(I)}};this.toJsonObject=
function(){var J={};J.rootUnionEntityName=l;for(var v=[],F=0;F<B.length;F++)v.push(B[F].toJsonObject());J.relations=v;return J}}function hc(){var l=this;this.getName=function(){throw Error("Override me.");};this.getTypeName=function(){throw Error("Override me.");};this.getShortDisplay=function(){throw Error("Override me.");};this.isTheSame=function(B){throw Error("Override me.");};this.mergeFrom=function(B){};this.mergeFromSourceAndEntity=function(B,J){};this.isModifiable=function(){throw Error("Override me.");
};this.fissionFor=function(B){};this.clone=function(){throw Error("Override me.");};this.toJsonObject=function(){throw Error("Override me.");};this.fromJsonObject=function(B){throw Error("Override me.");};this.fireChangeUrl=function(B){};this.isUserSql=function(B){return!1};this.isStoredProcedure=function(B){return!1};this.supportStoredProcedure=function(){return!1};this.getMergeType=function(){return null};this.supportMergeTable=function(){return!1};this.isSupportSelectField=function(){return!0};
this.isSupportFlexModel=function(){return!1};this.isSupportCustomField=function(){return!0};this.isSupportColumnToRow=function(){return!1};this.getEntityIconName=function(B){return l.isUserSql(B)?"custom-sql":l.isStoredProcedure(B)?"stored-procedure":"table"};this.hasUserSql=function(){return!1};this.hasStoredProcedure=function(){return!1};this.isShowChangeSourceTypeButtonInMenu=function(){return!1};this.isBasedOnDB=function(){return!1};this.supportRefreshEntity=function(){return!0};this.isShowEntityMark=
function(){return!1};this.getConnectionType=function(){return hc.DBCONNECTION_TYPE_UNKNOWN};this.isSupportChangeFieldType=function(B){return!0};this.isSupportCreateRelation=function(B){return!0};this.isSupportExtractData=function(B){return!0};this.getDisplayName=function(B){return""}}function Mb(){var l,B,J;this.setTimezone=function(v){l=v};this.getTimezone=function(){return l};this.setCharset=function(v){B=v};this.getCharset=function(){return B};this.getOtherSetting=function(){return J};this.setOtherSetting=
function(v){J=v};this.fromJsonObject=function(v){l=v.timezone;B=v.charset;J=v.otherSetting};this.toJsonObject=function(){var v={};v.timezone=l;v.charset=B;v.otherSetting=J;return v}}function mb(){hc.call(this);var l=this,B,J,v,F,T,I,S,cb,ub,Ea,qb={},xc={},Hc=!0,Nc=new Mb;this.setName=function(Za){B=Za};this.getName=function(){return B};this.getAdvanceSetting=function(){return Nc};this.setAdvanceSetting=function(Za){Nc=Za};this.getTypeName=function(){return l.getDbType()};this.getDBAddress=function(){return v};
this.getShortDisplay=function(){return v+":"+F+" "+T};this.fireChangeUrl=function(Za){J!=mb.TYPE_ACCESS&&J!=mb.TYPE_SQLITE||l.setDbAddress(Za.getDbAddress())};this.isSupportColumnToRow=function(){return!0};this.getMergeType=function(){return hc.COMMON_MERGE};this.isTheSame=function(Za){return l.getTypeName()==Za.getTypeName()&&l.getDbType()==Za.getDbType()&&l.getDbAddress()==Za.getDbAddress()&&l.getDbPort()==Za.getDbPort()&&l.getDbName()==Za.getDbName()&&l.getUserName()==Za.getUserName()&&l.getPassword()==
Za.getPassword()&&l.getSchema()==Za.getSchema()&&l.getDbVersion()==Za.getDbVersion()&&l.getConnectType()==Za.getConnectType()};this.mergeFrom=function(Za){for(var ec=Za.getAllUserSqlName(),Db=0;Db<ec.length;Db++){var n=ec[Db];Za.isUserSql(n)&&(n=Za.getUserSql(n),l.addUserSql(n))}ec=Za.getAllStoredProcedureName();for(Db=0;Db<ec.length;Db++)n=ec[Db],Za.isStoredProcedure(n)&&(n=Za.getStoredProcedure(n),l.addStoredProcedure(n))};this.isBasedOnDB=function(){return!0};this.isModifiable=function(){return!0};
this.supportMergeTable=function(){return!0};this.fissionFor=function(Za){var ec=new mb;ec.setDbType(J);ec.setDbAddress(v);ec.setDbPort(F);ec.setDbName(T);ec.setUserName(I);ec.setPassword(S);ec.setSchema(cb);ec.setDbVersion(ub);ec.setConnectType(Ea);Za=Za.getName();if(l.isUserSql(Za)){var Db=l.getUserSql(Za);ec.addUserSql(Db);l.removeUserSql(Za)}l.isStoredProcedure(Za)&&(Db=l.getStoredProcedure(Za),ec.addStoredProcedure(Db),l.removeStoredProcedure(Za));return ec};this.clone=function(){var Za=new mb;
Za.setName("s"+(new Date).getTime());Za.setDbType(J);Za.setDbAddress(v);Za.setDbPort(F);Za.setDbName(T);Za.setUserName(I);Za.setPassword(S);Za.setSchema(cb);Za.setDbVersion(ub);Za.setConnectType(Ea);var ec={},Db;for(Db in qb)ec[Db]=qb[Db];Za.setAllUserSql(ec);ec={};for(var n in xc)ec[n]=xc[n];Za.setAllStoredProcedure(ec);return Za};this.setDbType=function(Za){J=Za};this.getDbType=function(){return J};this.setDbAddress=function(Za){v=Za};this.getDbAddress=function(){return v};this.setDbPort=function(Za){F=
Za};this.getDbPort=function(){return F};this.setDbName=function(Za){T=Za};this.getDbName=function(){return T};this.setUserName=function(Za){I=Za};this.getUserName=function(){return I};this.setPassword=function(Za){S=Za};this.getPassword=function(){return S};this.setIsPasswordUpdated=function(Za){Hc=Za};this.isPasswordUpdated=function(){return Hc};this.setSchema=function(Za){cb=Za};this.getSchema=function(){return cb};this.setDbVersion=function(Za){ub=Za};this.getDbVersion=function(){return ub};this.setConnectType=
function(Za){Ea=Za};this.getConnectType=function(){return Ea};this.setAllUserSql=function(Za){qb=Za};this.getAllUserSql=function(){return qb};this.addUserSql=function(Za){var ec=Za.getName();qb[ec]=Za};this.removeUserSql=function(Za){delete qb[Za]};this.getUserSql=function(Za){return qb[Za]};this.getAllUserSqlName=function(){var Za=[],ec;for(ec in qb)Za.push(ec);return Za};this.isUserSql=function(Za){return qb[Za]?!0:!1};this.hasUserSql=function(){return qb&&"{}"!==JSON.stringify(qb)?!0:!1};this.hasStoredProcedure=
function(){return xc&&"{}"!==JSON.stringify(xc)?!0:!1};this.setAllStoredProcedure=function(Za){xc=Za};this.getAllStoredProcedure=function(){return xc};this.addStoredProcedure=function(Za){var ec=Za.getName();xc[ec]=Za};this.removeStoredProcedure=function(Za){delete xc[Za]};this.getStoredProcedure=function(Za){return xc[Za]};this.getAllStoredProcedureName=function(){var Za=[],ec;for(ec in xc)Za.push(ec);return Za};this.isStoredProcedure=function(Za){return xc[Za]?!0:!1};this.supportStoredProcedure=
function(){return mb.PRECEDURE_SUPPORT.some(function(Za){return J==Za})};this.fromJsonObject=function(Za){B=Za.name;J=Za.dbType;v=Za.dbAddress;F=Za.dbPort;T=Za.dbName;I=Za.userName;S=yc.decode(Za.password);Za.schema&&(cb=Za.schema);Za.dbVersion&&(ub=Za.dbVersion);Za.connectType&&(Ea=Za.connectType);var ec=Za.userSqls;if(ec)for(var Db=0;Db<ec.length;Db++){var n=ec[Db],V=new vc;V.fromJsonObject(n);l.addUserSql(V)}Za.advanceSetting&&Nc.fromJsonObject(Za.advanceSetting);if(Za=Za.storedProcedures)for(Db=
0;Db<Za.length;Db++)ec=Za[Db],n=new bd,n.fromJsonObject(ec),l.addStoredProcedure(n)};this.toJsonObject=function(){var Za={};Za.name=B;Za.dbType=J;Za.dbAddress=v;Za.dbPort=F;Za.dbName=T;Za.userName=I;Za.password=yc.encode(S);cb&&(Za.schema=cb);ub&&(Za.dbVersion=ub);Ea&&(Za.connectType=Ea);for(var ec=[],Db=l.getAllUserSqlName(),n=0;n<Db.length;n++){var V=Db[n];l.isUserSql(V)&&(V=l.getUserSql(V),ec.push(V.toJsonObject()))}Za.userSqls=ec;ec=[];Db=l.getAllStoredProcedureName();for(n=0;n<Db.length;n++)V=
Db[n],l.isStoredProcedure(V)&&(V=l.getStoredProcedure(V),ec.push(V.toJsonObject()));Za.storedProcedures=ec;Za.advanceSetting=Nc.toJsonObject();return Za};this.supportRefreshEntity=function(){return!0};this.getConnectionType=function(){return hc.DBCONNECTION_TYPE_DB}}function vc(){var l,B,J;this.setName=function(v){l=v};this.getName=function(){return l};this.setContent=function(v){B=v};this.getContent=function(){return B};this.setSqlType=function(v){J=v};this.getSqlType=function(){return J};this.fromJsonObject=
function(v){l=v.name;B=v.content;J=v.sqlType};this.toJsonObject=function(){var v={};v.name=l;v.content=B;v.sqlType=J;return v}}function Ob(){var l,B,J,v;this.getName=function(){return l};this.setName=function(F){l=F};this.getValueMode=function(){return B};this.setValueMode=function(F){B=F};this.getDataType=function(){return J};this.setDataType=function(F){J=F};this.getValue=function(){return v};this.setValue=function(F){v=F};this.fromJsonObject=function(F){l=F.name;B=F.valueMode;J=F.dataType;v=F.value};
this.toJsonObject=function(){var F={};F.name=l;F.valueMode=B;F.dataType=J;F.value=v;return F};this.getDataTypeText=function(){switch(J){case Ob.DATA_STRING:var F=Cc.get("text","\u6587\u672c");break;case Ob.DATA_NUMBER:F=Cc.get("number","\u6570\u503c");break;case Ob.DATA_INT:F=Cc.get("integer","\u6574\u6570");break;case Ob.DATA_DATE:F=Cc.get("dataTypeDate","\u65e5\u671f");break;case Ob.DATA_DATETIME:F=Cc.get("dateTime","\u65e5\u671f\u65f6\u95f4");break;case Ob.DATA_BOOLEAN:F=Cc.get("bool","\u5e03\u5c14");
break;case Ob.DATA_CURSOR:F=Cc.get("cursor","\u6e38\u6807");break;default:F=""}return F}}function Dc(){Ob.call(this);var l=this,B;this.getIoType=function(){return B};this.setIoType=function(J){B=J};this.fromJsonObject=function(J){l.setName(J.name);l.setValueMode(J.valueMode);l.setDataType(J.dataType);l.setValue(J.value);l.setIoType(J.ioType)};this.toJsonObject=function(){var J={};J.name=l.getName();J.valueMode=l.getValueMode();J.dataType=l.getDataType();J.value=l.getValue();J.ioType=l.getIoType();
return J};this.getIoTypeText=function(){var J;B==Dc.PROCEDUREIOTYPE_IN?J=Cc.get("inParameter","\u8f93\u5165\u53c2\u6570"):B==Dc.PROCEDUREIOTYPE_OUT?J=Cc.get("outParameter","\u8f93\u51fa\u53c2\u6570"):B==Dc.PROCEDUREIOTYPE_INOUT&&(J=Cc.get("inOutParameter","\u8f93\u5165\u8f93\u51fa\u53c2\u6570"));return J}}function bd(){var l,B,J,v,F=[],T=!1;this.getAssociateName=function(){return l};this.setAssociateName=function(I){l=I};this.getName=function(){return B};this.setName=function(I){B=I};this.getOutResultIdx=
function(){return J};this.setOutResultIdx=function(I){J=I};this.getCursorFieldName=function(){return v};this.setCursorFieldName=function(I){v=I};this.getParameters=function(){return F};this.setParameters=function(I){F=I};this.getIsChange=function(){return T};this.setIsChange=function(I){T=I};this.fromJsonObject=function(I){l=I.associateName;B=I.name;J=I.outResultIdx;v=I.cursorFieldName;I=I.parameters;for(var S=0;S<I.length;S++){var cb=new Dc;cb.fromJsonObject(I[S]);F.push(cb)}};this.toJsonObject=
function(){var I={};I.associateName=l;I.name=B;I.outResultIdx=J;I.cursorFieldName=v;for(var S=[],cb=0;cb<F.length;cb++)S.push(F[cb].toJsonObject());I.parameters=S;return I};this.doCheckParameters=function(){for(var I=0;I<F.length;I++){var S=F[I],cb=S.getValue();if(cb){a:{var ub=void 0;var Ea=cb;for(ub in Ib.VARIANTTYPEENUM){var qb="'@"+Ib.VARIANTTYPEENUM[ub].getTypeID()+"'";if(Ea==qb){ub=!0;break a}}ub=!1}if(ub)break;if(S.getDataType()==ab.DT_NUMBER||S.getDataType()==ab.DT_INT){if(!Xa.REG_NUMBER.test(cb))return S=
Cc.get("parametersPrompt","\u5b58\u50a8\u8fc7\u7a0b#1\uff0c\u53c2\u6570\u503c"),S=S.replace("#1",l),S+=Cc.get("incompleteFilter","\u7b2c#1\u884c\u4e0d\u5b8c\u6574\uff0c"),S=S.replace("#1",I+1),S+=Cc.get("valueMustBeNum","\u503c\u5fc5\u987b\u4e3a\u6570\u5b57\u3002"),new Uc(l,I,S)}else if(S.getDataType()==ab.DT_DATE||S.getDataType()==ab.DT_DATETIME){if(!Xa.REG_DATETIME.test(cb))return S=Cc.get("parametersPrompt","\u5b58\u50a8\u8fc7\u7a0b#1\uff0c\u53c2\u6570\u503c"),S=S.replace("#1",l),S+=Cc.get("incompleteFilter",
"\u7b2c#1\u884c\u4e0d\u5b8c\u6574\uff0c"),S=S.replace("#1",I+1),S+=Cc.get("invalidDateValue","\u65e0\u6548\u7684\u65e5\u671f\u503c\u3002"),new Uc(l,I,S)}else if(S.getDataType()==ab.DT_BOOLEAN&&cb!=ab.BOOLEAN_TRUE&&cb!=ab.BOOLEAN_FALSE)return S=Cc.get("parametersPrompt","\u5b58\u50a8\u8fc7\u7a0b#1\uff0c\u53c2\u6570\u503c"),S=S.replace("#1",l),S+=Cc.get("incompleteFilter","\u7b2c#1\u884c\u4e0d\u5b8c\u6574\uff0c"),S=S.replace("#1",I+1),S+=Cc.get("wrongBoolean","\u9519\u8bef\u7684\u5e03\u5c14\u503c\u3002"),
new Uc(l,I,S)}}return null}}function Uc(l,B,J){this.getStoredProcedureName=function(){return l};this.getErrorRow=function(){return B};this.getPrompt=function(){return J}}function Qc(){hc.call(this);var l=this,B,J,v,F,T,I;this.setName=function(S){B=S};this.getName=function(){return B};this.setFileName=function(S){J=S};this.getFileName=function(){return J};this.setFileType=function(S){v=S};this.getFileType=function(){return v};this.setFileUrl=function(S){F=S};this.getFileUrl=function(){return F};this.getTypeName=
function(){return v};this.getShortDisplay=function(){return J};this.setCharacterSet=function(S){T=S};this.getCharacterSet=function(){return T};this.setDefineTypeRowCount=function(S){I=S};this.getDefineTypeRowCount=function(){return I};this.fireChangeUrl=function(S){l.setFileUrl(S.getFileUrl())};this.isSupportColumnToRow=function(){return!0};this.isTheSame=function(S){return l.getName()==S.getName()&&l.getFileType()==S.getFileType()&&l.getFileName()==S.getFileName()&&l.getFileUrl()==S.getFileUrl()};
this.isModifiable=function(){return!0};this.supportMergeTable=function(){return!0};this.getMergeType=function(){return hc.COMMON_MERGE};this.clone=function(){var S=new Qc;S.setName("s"+(new Date).getTime());S.setFileType(v);S.setFileName(J);S.setFileUrl(F);return S};this.toJsonObject=function(){var S={};S.name=B;S.fileType=v;S.fileName=J;S.fileUrl=F;S.characterSet=T;S.defineTypeRowCount=I;l.protectedToJsonObject(S);return S};this.fromJsonObject=function(S){B=S.name;v=S.fileType;J=S.fileName;F=S.fileUrl;
T=S.characterSet;I=S.defineTypeRowCount;l.protectedFromJsonObject(S)};this.protectedToJsonObject=function(S){throw Error("Override me.");};this.protectedFromJsonObject=function(S){throw Error("Override me.");};this.supportRefreshEntity=function(){return!1}}function Xb(){Qc.call(this);var l=this;this.clone=function(){var B=new Xb;B.setName("s"+(new Date).getTime());B.setFileType(l.getFileType());B.setFileName(l.getFileName());B.setFileUrl(l.getFileUrl());B.setCharacterSet(l.getCharacterSet());B.setDefineTypeRowCount(l.getDefineTypeRowCount());
return B};this.protectedToJsonObject=function(B){};this.protectedFromJsonObject=function(B){}}function cc(){Qc.call(this);var l=this;this.clone=function(){var B=new cc;B.setName("s"+(new Date).getTime());B.setFileType(l.getFileType());B.setFileName(l.getFileName());B.setFileUrl(l.getFileUrl());B.setCharacterSet(l.getCharacterSet());B.setDefineTypeRowCount(l.getDefineTypeRowCount());return B};this.protectedToJsonObject=function(B){};this.protectedFromJsonObject=function(B){}}function Da(){Qc.call(this);
var l=this,B,J;this.setSplitSign=function(v){B=v};this.getSplitSign=function(){return B};this.setTextLimitSign=function(v){J=v};this.getTextLimitSign=function(){return J};this.clone=function(){var v=new Da;v.setName("s"+(new Date).getTime());v.setFileType(l.getFileType());v.setFileName(l.getFileName());v.setFileUrl(l.getFileUrl());v.setCharacterSet(l.getCharacterSet());v.setDefineTypeRowCount(l.getDefineTypeRowCount());v.setSplitSign(B);v.setTextLimitSign(J);return v};this.protectedToJsonObject=function(v){v.splitSign=
B;v.textLimitSign=J};this.protectedFromJsonObject=function(v){B=v.splitSign;J=v.textLimitSign}}function oa(){hc.call(this);var l=this,B,J,v,F;this.setName=function(I){B=I};this.getName=function(){return B};this.isSupportColumnToRow=function(){return!0};this.setUrl=function(I){J=I};this.getUrl=function(){return J};this.setAuthModel=function(I){F=I};this.getAuthModel=function(){return F};this.setOpenAPIType=function(I){v=I};this.getOpenAPIType=function(){return v};this.getTypeName=function(){return l.getOpenAPIType()};
this.getShortDisplay=function(){return J};this.toJsonObject=function(){var I={};I.name=B;I.url=J;I.openAPIType=v;F&&(I.authModel=F);return I};this.fromJsonObject=function(I){B=I.name;J=I.url;v=I.openAPIType;F=I.authModel};this.clone=function(){var I=new oa;I.setName("s"+(new Date).getTime());I.setUrl(J);I.setOpenAPIType(v);I.setAuthModel(F);return I};this.isTheSame=function(I){return l.getTypeName()==I.getTypeName()&&l.getUrl()==I.getUrl()&&l.getOpenAPIType()==I.getOpenAPIType()&&T(I.getAuthModel())};
var T=function(I){var S=l.getAuthModel();if(null==S&&null==I)return!0;if(null!=S&&null!=I){if(S.authType!==I.authType)return!1;var cb=Object.keys(S),ub=Object.keys(I);if(cb.length!==ub.length)return!1;for(var Ea=0;Ea<cb.length;Ea++){var qb=cb[Ea];if(!ub.includes(qb)||S[qb]!==I[qb])return!1}return!0}return!1};this.isModifiable=function(){return!0};this.supportMergeTable=function(){return!0};this.getMergeType=function(){return hc.COMMON_MERGE};this.supportRefreshEntity=function(){return!0}}function Ya(l,
B){this.getUniqueName=function(){return l.getName()};this.getDisplayName=function(){return l instanceof $b?"("+l.getAlias()+Cc.get("parentChildDimensionFieldDisplayName","\u7236\u5b50\u7ef4")+")":l instanceof La?"("+l.getAlias()+Cc.get("groupingPropertyFieldDisplayName","\u5c5e\u6027\u5206\u7ec4")+")":l instanceof tc?"("+l.getAlias()+Cc.get("subViweFieldDisplayName","\u5c5e\u6027\u5206\u8868")+")":l instanceof ab&&l.isCalculatingField()?"("+Cc.get("customFieldDisplayName","\u8ba1\u7b97\u5b57\u6bb5")+
")":l.getName()};this.getAlias=function(){return l.getAlias()};this.setAlias=function(J){l.setAlias(J)};this.getTreeLevel=function(){return B};this.getModel=function(){return l};this.isProperty=function(){return l instanceof ab}}function eb(){var l,B,J,v;this.setId=function(F){l=F};this.getId=function(){return l};this.setName=function(F){B=F};this.getName=function(){return B};this.getMacroCheckResult=function(){return J};this.setMacroCheckResult=function(F){J=F};this.setType=function(F){v=F};this.getType=
function(){return v};this.fromJsonObject=function(F){l=F.id;B=F.name;v=F.type;F=F.macroCheckResult;J=new Wa;J.fromJsonObject(F)}}function Wa(){var l,B,J=[],v=[],F;this.getMacroId=function(){return l};this.setMacroId=function(T){l=T};this.getMacroStatus=function(){return B};this.setMacroStatus=function(T){B=T};this.getNoPermPropertyNames=function(){return J};this.setNoPermPropertyNames=function(T){J=T};this.addNoPermPropertyName=function(T){J.push(T)};this.getNotExistPropertyNames=function(){return v};
this.setNoPermPropertyNames=function(T){v=T};this.addNoPermPropertyName=function(T){v.push(T)};this.getAppNumber=function(){return F};this.setAppNumber=function(T){F=T};this.fromJsonObject=function(T){T&&(l=T.macroId,B=T.macroStatus,J=T.noPermPropertyNames,v=T.notExistPropertyNames,F=T.appNumber)};this.toJsonObject=function(){var T={};T.macroId=l;T.macroStatus=B;T.noPermPropertyNames=J;T.notExistPropertyNames=v;T.appNumber=F;return T}}function ea(){var l;this.getAuthType=function(){return l};this.setAuthType=
function(B){l=B};this.protectedToJsonObject=function(){throw Error("Override me.");};this.protectedFromJsonObject=function(B){throw Error("Override me.");}}function da(){ea.call(this);var l=this,B,J;this.getUserName=function(){return B};this.setUserName=function(v){B=v};this.getPassword=function(){return J};this.setPassword=function(v){J=v};this.protectedToJsonObject=function(){var v={};v.userName=B;v.psw=J;v.authType=Ec.BASIC;return v};this.protectedFromJsonObject=function(v){B=v.userName;J=v.psw;
l.setAuthType(v.authType)}}function zb(){ea.call(this);var l=this,B,J,v,F;this.getClientId=function(){return B};this.setClientId=function(T){B=T};this.getClientSecret=function(){return J};this.setClientSecret=function(T){J=T};this.getScope=function(){return v};this.setScope=function(T){v=T};this.getAuthURL=function(){return F};this.setAuthURL=function(T){F=T};this.protectedToJsonObject=function(){var T={};T.clientId=B;T.clientSecret=J;v&&(T.scope=v);T.authURL=F;T.authType=Ec.BEARER;return T};this.protectedFromJsonObject=
function(T){B=T.clientId;J=T.clientSecret;v=T.scope;F=T.authURL;l.setAuthType(T.authType)}}function U(){ea.call(this);var l=this,B,J;this.getUserName=function(){return B};this.setUserName=function(v){B=v};this.getPassword=function(){return J};this.setPassword=function(v){J=v};this.protectedToJsonObject=function(){var v={};v.userName=B;v.psw=J;v.authType=Ec.DIGEST;return v};this.protectedFromJsonObject=function(v){B=v.userName;J=v.psw;l.setAuthType(v.authType)}}function wc(){ea.call(this);var l=this,
B,J,v,F,T,I,S,cb,ub,Ea;this.getTokenEnhanced=function(){return B};this.setTokenEnhanced=function(qb){B=qb};this.getAppId=function(){return J};this.setAppId=function(qb){J=qb};this.getAppSecret=function(){return v};this.setAppSecret=function(qb){v=qb};this.getUserType=function(){return F};this.setUserType=function(qb){F=qb};this.getUserTypeValue=function(){return T};this.setUserTypeValue=function(qb){T=qb};this.getProxyUser=function(){return I};this.setProxyUser=function(qb){I=qb};this.getCosmicType=
function(){return S};this.setCosmicType=function(qb){S=qb};this.getAccountId=function(){return ub};this.setAccountId=function(qb){ub=qb};this.getTenantId=function(){return Ea};this.setTenantId=function(qb){Ea=qb};this.getCosmicServerAddress=function(){return cb};this.setCosmicServerAddress=function(qb){cb=qb};this.protectedToJsonObject=function(){var qb={};qb.appId=J;qb.appSecret=v;qb.userType=F;qb.userTypeValue=T;qb.proxyUser=I;qb.cosmicType=S;cb&&(qb.accountId=ub,qb.tenantId=Ea,qb.cosmicServerAddress=
cb);qb.authType=Ec.COSMIC;qb.tokenEnhanced=B;return qb};this.protectedFromJsonObject=function(qb){B=qb.tokenEnhanced;J=qb.appId;v=qb.appSecret;F=qb.userType;T=qb.userTypeValue;I=qb.proxyUser;S=qb.cosmicType;ub=qb.accountId;Ea=qb.tenantId;cb=qb.cosmicServerAddress;l.setAuthType(qb.authType)}}function zc(){var l,B,J,v;this.setErrorState=function(F){l=F};this.getErrorState=function(){return l};this.getErrorDesc=function(){return B};this.getEntityName=function(){return J};this.getCustomInfo=function(F){return v?
v[F]:null};this.fromJsonObject=function(F){l=F.errorState;B=F.errorDesc;J=F.entityName;v=F.customInfo}}function Gc(){var l=[],B;this.getExtractUsers=function(){return l};this.setExtractUsers=function(J){l=J};this.getDefaultPolicy=function(){return B};this.setDefaultPolicy=function(J){B=J};this.toJsonObject=function(){for(var J={},v=[],F=0;F<l.length;F++)v.push(l[F].toJsonObject());J.extractUsers=v;J.defaultPolicy=B;return J};this.fromJsonObject=function(J){var v=J.extractUsers;if(v){l=[];for(var F=
0;F<v.length;F++){var T=new ed;T.fromJsonObject(v[F]);l.push(T)}}B=J.defaultPolicy}}function ad(){}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.data&&(com.kingdee.bos.qing.data={});var lc=com.kingdee.bos.qing.data;lc.Box=Ha;lc.AbstractEntity=Cb;lc.Entity=rc;lc.EntitySubView=tc;lc.GroupView=La;lc.GroupItemView=
Eb;lc.UnionEntity=Wb;lc.Property=ab;lc.Parild=$b;lc.ForeignKey=xb;lc.FilterItem=Xa;lc.Relation=ma;lc.DBSource=mb;lc.DBAdvanceSetting=Mb;lc.BizUnionInnerEntityRelations=Lb;lc.AbstractBizMetaSource=function(){hc.call(this);var l=this,B,J;this.setName=function(v){B=v};this.getName=function(){return B};this.getTypeName=function(){return J};this.setTypeName=function(v){J=v};this.getShortDisplay=function(){return J};this.isTheSame=function(v){return l.getTypeName()==v.getTypeName()&&l.protectedIsTheSame(v)};
this.protectedIsTheSame=function(v){throw Error("Override me.");};this.mergeFrom=function(v){};this.isModifiable=function(){return!1};this.fissionFor=function(v){};this.clone=function(){};this.toJsonObject=function(){var v={};v.name=B;v.bizMetaType=J;l.protectedToJsonObject(v);return v};this.fromJsonObject=function(v){B=v.name;J=v.bizMetaType;l.protectedFromJsonObject(v)};this.protectedToJsonObject=function(v){throw Error("Override me.");};this.protectedFromJsonObject=function(v){throw Error("Override me.");
};this.supportRefreshEntity=function(){return!0};this.isPublic=function(){return!1}};lc.AbstractSource=hc;lc.FileSource=Qc;lc.ExcelSource=Xb;lc.TextSource=Da;lc.XMLSource=cc;lc.SystemVarType=Ib;lc.SysVarAdapter=function(l){Vb.call(this);var B,J;this.getId=function(){return l.getTypeID()};this.getDisplayName=function(){return B?B(l):l.getI18nKey()};this.getTextInUserSQL=function(){return J?J(l):l.getI18nKey()};this.getFilterMode=function(){return Xa.MODE_SYS_VAR};this.getVariateType=function(){return Vb.VAR_TYPE_SYS};
this.setDisplayNameFormater=function(v){B=v};this.setUserSQLFormater=function(v){J=v}};lc.AbstractVariateAdapter=Vb;lc.UserSqlObj=vc;lc.ParameterModel=Ob;lc.StoredProcedureParameterModel=Dc;lc.StoredProcedureModel=bd;lc.OpenAPISource=oa;lc.FiltersCheckingResult=Kb;lc.DesigntimeMacro=eb;lc.MacroCheckResult=Wa;lc.EntityErrorInfo=zc;lc.SchemaInfo=function(){var l,B,J;this.setName=function(v){l=v};this.getName=function(){return l};this.setAlias=function(v){B=v};this.getAlias=function(){return B};this.setType=
function(v){J=v};this.getType=function(){return J}};lc.ExtractConfig=Gc;lc.ExtractPolicy=ad;lc.PropertyViewNode=Ya;lc.TreeProperty=uc;lc.ColumnToRowProperty=Kc;lc.ColumnToRowPropertyItem=Bc;lc.BasicAuthModel=da;lc.BearerAuthModel=zb;lc.DigestAuthModel=U;lc.CosmicAuthModel=wc;var yc,Sc,Cc,kd,ed;(function(){var l=com.kingdee.bos.qing.common;yc=l.Base64Util;Sc=l.RelativePeriodModel;l=com.kingdee.bos.qing.framework.common;Cc=l.MultilanguageManager.createPackageAccessor(lc);l=com.kingdee.bos.qing.schedule;
kd=l.QingSchedule;l=com.kingdee.bos.qing.biz.common;ed=l.ValueTextPair})();Ha.KEY_ADD_ENTITIES="addEntities";Ha.KEY_REMOVE_ENTITY="removeEntity";Ha.KEY_ADD_RELATION="addRelation";Ha.KEY_REMOVE_RELATION="removeRelation";Ha.KEY_MOVE_UP_RELATION="moveUpRelation";Ha.KEY_MOVE_DOWN_RELATION="moveDownRelation";Ha.KEY_REFRESH_ENTITY="refreshEntity";Ha.KEY_REFRESH_RELATION="refreshRelation";Kb.LEVEL_SUCCESS=0;Kb.LEVEL_WARNING=1;Kb.LEVEL_ERROR=2;Cb.ERROR_STATE_TABLENOTEXIST="TABLENOTEXIST";Cb.ERROR_STATE_MACROERROR=
"MACROERROR";Cb.ERROR_STATE_DB_CONN_FAILED="DB_CONNECT_FAILED";Cb.ERROR_STATE_FILENOTEXIST="FILENOTEXIST";Cb.ERROR_STATE_OPENAPINOTEXIST="OPENAPINOTEXIST";Cb.ERROR_STATE_NOTEXISTUSERAUTHORITY="NOTEXISTUSERAUTHORITY";Cb.ERROR_STATE_BIZMETANOTSUPPORT="BIZMETANOTSUPPORT";Cb.ERROR_STATE_NO_DB_CENTER_PERMISSION="NO_DBCENTER_PERMISSION";Cb.ERROR_STATE_NO_DPP_PERMISSION="NO_DPP_PERMISSION";Cb.ERROR_STATE_NO_DPP_ENTITY_PERMISSION="NO_DPP_ENTITY_PERMISSION";Cb.ERROR_STATE_DAMAGED_DPP_ENTITY="DAMAGED_DPP_ENTITY";
Cb.ERROR_STATE_MACRO_NOT_FOUND="MACROERROR_NOTFOUND";Cb.ERROR_STATE_MACRO_DB_UNSET="MACROERROR_DBUNSET";Cb.ERROR_STATE_KSQL_NOT_SUPPORT="KSQL_NOT_SUPPORT";Cb.ERROR_STATE_STORED_PROCEDURE_NOT_SUPPORT="STORED_PROCEDURE_NOT_SUPPORT";Cb.ERROR_STATE_UNIONENTITY_CHILDTABLE_HAVE_PROBLEM="UNIONENTITY_CHILDTABLE_HAVE_PROBLEM";Cb.ERROR_STATE_SQL_EXECUTE_EXCEPTION="SQL_EXECUTE_EXCEPTION";Cb.ERROR_STATE_kSQL_EXECUTE_EXCEPTION="KSQL_EXECUTE_EXCEPTION";Cb.ERROR_STATE_SP_EXECUTE_EXCEPTION="SP_EXECUTE_EXCEPTION";
Cb.NO_QING_MODELER_LICENSE="NO_QING_MODELER_LICENSE";Cb.ENTITY_PARSE_EXCEPTION="ENTITY_PARSE_EXCEPTION";Cb.DATA_CENTER_APP_ERROR="DATA_CENTER_APP_ERROR";Cb.DB_CENTER_MACRO_UNAVAILABLE="DB_CENTER_MACRO_UNAVAILABLE";uc.TREE_TYPE_FLEX=0;uc.TREE_TYPE_CUSTOM=1;rc.KEY_CHANGE_ENTITYALIAS="changeEntityAlias";rc.KEY_CHANGE_SOURCE="changeEntitySource";Wb.BIZ_UNION="BIZ";Wb.NOT_BIZ_UNION="NOT_BIZ";ab.DT_BOOLEAN="BOOLEAN";ab.DT_INT="INT";ab.DT_NUMBER="NUMBER";ab.DT_DATE="DATE";ab.DT_DATETIME="DATETIME";ab.DT_STRING=
"STRING";ab.BOOLEAN_TRUE="true";ab.BOOLEAN_FALSE="false";ab.CUSTOM_BIZ_ENTITY_NAME_FIELD="custom_biz_entity_name";ab.confirmDefaultFormatString=function(l){switch(l.getOutputDataType()){case ab.DT_INT:l.setFormatString("#,##0");break;case ab.DT_NUMBER:l.setFormatString("#,##0.00");break;case ab.DT_STRING:case ab.DT_DATE:case ab.DT_DATETIME:case ab.DT_BOOLEAN:l.setFormatString("");break;default:throw Error("Unsure DataType");}};$b.Necessary={};$b.Necessary.Indispensable="Indispensable";$b.Necessary.RootRepresented=
"RootRepresented";Ib.VARIANTTYPEENUM=[new Ib("USER_ID","currentUserId","\u5f53\u524d\u7528\u6237ID"),new Ib("USER_NAME","currentUserName","\u5f53\u524d\u7528\u6237\u540d\u79f0"),new Ib("ORG_ID","currentGroupID","\u5f53\u524d\u7ec4\u7ec7ID"),new Ib("ORG_NAME","currentGroupNAME","\u5f53\u524d\u7ec4\u7ec7\u540d\u79f0"),new Ib("ORG_RANGE_ID","currentGroupRangeID","\u5f53\u524d\u7528\u6237\u4e1a\u52a1\u7ec4\u7ec7\u8303\u56f4(ID)"),new Ib("DEPARTMENT_IDS","currentDepartmentIds","\u5f53\u524d\u7528\u6237\u6240\u5c5e\u90e8\u95e8(ID)"),
new Ib("DEPARTMENT_AND_SUBORDINATE_IDS","currentDeptAndSubIds","\u5f53\u524d\u7528\u6237\u6240\u5c5e\u90e8\u95e8\u53ca\u4e0b\u7ea7(ID)"),new Ib("CHARGE_DEPARTMENT_IDS","currentChargeDeptId","\u5f53\u524d\u7528\u6237\u8d1f\u8d23\u7684\u90e8\u95e8(ID)"),new Ib("CHARGE_DEPARTMENT_AND_SUBORDINATE_IDS","currentChargeDeptAndSubIds","\u5f53\u524d\u7528\u6237\u8d1f\u8d23\u7684\u90e8\u95e8\u53ca\u4e0b\u7ea7(ID)"),new Ib("BIZ_UNIT_ORGRANG_ID","currentBizUnitOrgRangeIds","\u5f53\u524d\u7528\u6237\u4e1a\u52a1\u5355\u5143\u8303\u56f4(ID)"),
new Ib("ADMIN_ORG_RANGE_ID","currentAdminGroupRangeID","\u5f53\u524d\u4e1a\u52a1\u884c\u653f\u7ec4\u7ec7\u8303\u56f4(ID)"),new Ib("I18N","currentSystemLanguage","\u5f53\u524d\u7cfb\u7edf\u8bed\u8a00")];Ib.SUPPORTED_VAR_TYPE=[];Vb.VAR_TYPE_SYS="sys_var";Vb.VAR_TYPE_MACRO="macro_var";Xa.REG_NUMBER=/^-?\d+(\.\d+)?$/;Xa.REG_DATETIME=/^-?\d+(\.\d+)?$/;Xa.COMPARE_WITH_RAW="RAW";Xa.COMPARE_WITH_APPOINTED="APPOINTED";Xa.MODE_CONST="Const";Xa.MODE_SYS_VAR="SystemVar";Xa.MODE_MACRO_VAR="MacroVar";Xa.LOGIC_AND=
"AND";Xa.LOGIC_OR="OR";Xa.COMPARE_EQUAL="EQUAL";Xa.COMPARE_NOT_EQUAL="NOT_EQUAL";Xa.COMPARE_GREATER="GREATER";Xa.COMPARE_GREATER_EQUAL="GREATER_EQUAL";Xa.COMPARE_LESS="LESS";Xa.COMPARE_LESS_EQUAL="LESS_EQUAL";Xa.COMPARE_INCLUDE="INCLUDE";Xa.COMPARE_NOT_INCLUDE="NOT_INCLUDE";Xa.COMPARE_START_WITH="START_WITH";Xa.COMPARE_END_WITH="END_WITH";Xa.COMPARE_NULL="NULL";Xa.COMPARE_NOT_NULL="NOT_NULL";Xa.COMPARE_RELATIVE_DATE_RANGE="RELATIVE_DATE_RANGE";Xa.COMPARE_VARIABLE="VARIABALE_MATCH";Xa.COMPARE_CUSTOM_VARIABALE=
"CUSTOM_VARIABALE_MATCH";Xa.COMPARE_IN="IN";Xa.COMPARE_NOT_IN="NOT_IN";Xa.COMPARES_FOR_STRING=[Xa.COMPARE_VARIABLE,Xa.COMPARE_EQUAL,Xa.COMPARE_NOT_EQUAL,Xa.COMPARE_INCLUDE,Xa.COMPARE_NOT_INCLUDE,Xa.COMPARE_START_WITH,Xa.COMPARE_END_WITH,Xa.COMPARE_NULL,Xa.COMPARE_NOT_NULL,Xa.COMPARE_IN,Xa.COMPARE_NOT_IN];Xa.COMPARES_FOR_ENUM=[Xa.COMPARE_EQUAL,Xa.COMPARE_NOT_EQUAL,Xa.COMPARE_NULL,Xa.COMPARE_NOT_NULL,Xa.COMPARE_IN,Xa.COMPARE_NOT_IN];Xa.COMPARES_FOR_NUMBER=[Xa.COMPARE_VARIABLE,Xa.COMPARE_EQUAL,Xa.COMPARE_NOT_EQUAL,
Xa.COMPARE_GREATER,Xa.COMPARE_GREATER_EQUAL,Xa.COMPARE_LESS,Xa.COMPARE_LESS_EQUAL,Xa.COMPARE_NULL,Xa.COMPARE_NOT_NULL,Xa.COMPARE_IN,Xa.COMPARE_NOT_IN];Xa.COMPARES_FOR_DATETIME=[Xa.COMPARE_RELATIVE_DATE_RANGE,Xa.COMPARE_EQUAL,Xa.COMPARE_NOT_EQUAL,Xa.COMPARE_GREATER,Xa.COMPARE_GREATER_EQUAL,Xa.COMPARE_LESS,Xa.COMPARE_LESS_EQUAL,Xa.COMPARE_NULL,Xa.COMPARE_NOT_NULL];Xa.COMPARES_FOR_BOOLEAN=[Xa.COMPARE_EQUAL,Xa.COMPARE_NOT_EQUAL,Xa.COMPARE_NULL,Xa.COMPARE_NOT_NULL];Xa.getSelectableCompares=function(l,
B){switch(l){case ab.DT_STRING:return B?Xa.COMPARES_FOR_ENUM:Xa.COMPARES_FOR_STRING;case ab.DT_NUMBER:case ab.DT_INT:return Xa.COMPARES_FOR_NUMBER;case ab.DT_DATE:case ab.DT_DATETIME:return Xa.COMPARES_FOR_DATETIME;case ab.DT_BOOLEAN:return Xa.COMPARES_FOR_BOOLEAN;default:throw Error("Unknown DataType");}};Xa.isCompareOpWithoutValue=function(l){return l==Xa.COMPARE_NULL||l==Xa.COMPARE_NOT_NULL};Xa.isCompareOpRelativeDateRangeValue=function(l){return l==Xa.COMPARE_RELATIVE_DATE_RANGE};Xa.isCompareOpWithinOrNotWithinValue=
function(l){return l==Xa.COMPARE_IN||l==Xa.COMPARE_NOT_IN};ma.R_1_1="From1To1";ma.R_1_N="From1ToN";ma.R_N_1="FromNTo1";ma.KFW_FROM=1;ma.KFW_TO=2;ma.KEY_FROM_ENTITY="fromEntity";ma.KEY_FROM_PROPERTY="fromProperty";ma.KEY_FROM_PROPERTY_ALIAS_CHANED="fromPropertyAliasChanged";ma.KEY_TO_PROPERTY_ALIAS_CHANED="toPropertyAliasChanged";ma.KEY_TO_ENTITY="toEntity";ma.KEY_TO_PROPERTY="toProperty";ma.KEY_RELATED="related";hc.DBCONNECTION_TYPE_DB="DB";hc.DBCONNECTION_TYPE_DBCENTER="DBCenter";hc.DBCONNECTION_TYPE_SUPERQUERY=
"SuperQuery";hc.DBCONNECTION_TYPE_UNKNOWN="UnKnown";hc.BIZ_MERGE="BIZ_MERGE";hc.COMMON_MERGE="COMMON_MERGE";Mb.TIME_ZONE="timezone";Mb.CHARSET="charset";Mb.OTHER_SETTING="otherSetting";Mb.PREFIX="prefix";mb.TYPE_MYSQL="MYSQL";mb.TYPE_SQLSERVER="SQLSERVER";mb.TYPE_ORACLE="ORACLE";mb.TYPE_POSTGRESQL="POSTGRESQL";mb.TYPE_DB2="DB2";mb.TYPE_ACCESS="ACCESS";mb.TYPE_SQLITE="SQLITE";mb.TYPE_HIVE="HIVE";mb.TYPE_HANA="HANA";mb.TYPE_ODPS="ODPS";mb.TYPE_REDSHIFT="REDSHIFT";mb.TYPE_SYBASE="SYBASE";mb.TYPE_TIDB=
"TIDB";mb.TYPE_DM="DM";mb.TYPE_GREENPLUM="GREENPLUM";mb.TYPE_GAUSSDB="GAUSSDB";mb.TYPE_APACHEDRILL="APACHEDRILL";mb.TYPE_SPARKSQL="SPARKSQL";mb.TYPE_SYBASEIQ="SYBASEIQ";mb.TYPE_IMPALA="IMPALA";mb.TYPE_KYLIN="KYLIN";mb.TYPE_KINGBASE="KINGBASE";mb.TYPE_TDSQL="TDSQL";mb.TYPE_GBASE="GBASE";mb.TYPE_VASTBASE="VASTBASE";mb.TYPE_DORIS="DORIS";mb.TYPE_YASHANDB="YASHANDB";mb.TYPE_OCEANBASE_ORACLE="OCEANBASE_ORACLE";mb.SQLTYPE_SQL="SQL";mb.SQLTYPE_KSQL="KSQL";mb.KSQL_SUPPORT=[mb.TYPE_MYSQL,mb.TYPE_SQLSERVER,
mb.TYPE_ORACLE,mb.TYPE_POSTGRESQL,mb.TYPE_DB2,mb.TYPE_SYBASE,mb.TYPE_DM,mb.TYPE_GREENPLUM,mb.TYPE_KINGBASE,mb.TYPE_TDSQL,mb.TYPE_SYBASEIQ,mb.TYPE_GBASE,mb.TYPE_TIDB,mb.TYPE_VASTBASE,mb.TYPE_YASHANDB,mb.TYPE_GAUSSDB,mb.TYPE_OCEANBASE_ORACLE];mb.PRECEDURE_SUPPORT=[mb.TYPE_MYSQL,mb.TYPE_SQLSERVER,mb.TYPE_ORACLE,mb.TYPE_POSTGRESQL,mb.TYPE_DB2,mb.TYPE_SYBASE,mb.TYPE_DM,mb.TYPE_GREENPLUM,mb.TYPE_GAUSSDB,mb.TYPE_KINGBASE,mb.TYPE_SYBASEIQ,mb.TYPE_GBASE,mb.TYPE_VASTBASE,mb.TYPE_YASHANDB];mb.isNeedShowKSql=
function(l){return mb.KSQL_SUPPORT.some(function(B){return l==B})};mb.isNeedShowPrecedure=function(l){return mb.PRECEDURE_SUPPORT.some(function(B){return l==B})};Ob.DATA_BOOLEAN="BOOLEAN";Ob.DATA_INT="INT";Ob.DATA_NUMBER="NUMBER";Ob.DATA_DATE="DATE";Ob.DATA_DATETIME="DATETIME";Ob.DATA_STRING="STRING";Ob.DATA_CURSOR="CURSOR";Dc.PROCEDUREIOTYPE_IN="IN";Dc.PROCEDUREIOTYPE_OUT="OUT";Dc.PROCEDUREIOTYPE_INOUT="INOUT";Qc.TYPE_EXCEL="EXCEL";Qc.TYPE_CSV="CSV";Qc.TYPE_TXT="TXT";Qc.TYPE_XML="XML";oa.TYPE_RESTFUL_DATA_SET=
"RESTFUL_DATA_SET";oa.TYPE_PROGRAM_DATA_SET="PROGRAM_DATA_SET";oa.TYPE_OPENAPI="OpenAPI";lc.DesigntimeMacroCache=new function(){var l={};this.put=function(B,J){l[B]=J};this.get=function(B){return l[B]};this.clear=function(){l={}};this.convertToDesigntimeModel=function(B){if(B){var J=B.getRawModel(),v=new eb;v.setId(B.getId());v.setName(B.getDisplayName());v.setType(J.getType());var F=new Wa;F.setMacroId(B.getId());F.setMacroStatus(J.getMacroStatus());v.setMacroCheckResult(F);return v}}};lc.AuthModelFactory=
new function(){var l={};this.getImpl=function(B){if(B=l[B])return new B};this.registImpl=function(B,J){l[B]=J}};var Ec=lc.AuthModelFactory;Ec.BASIC="BASIC";Ec.BEARER="BEARER";Ec.DIGEST="DIGEST";Ec.COSMIC="COSMIC";Ec.registImpl(Ec.BASIC,da);Ec.registImpl(Ec.BEARER,zb);Ec.registImpl(Ec.DIGEST,U);Ec.registImpl(Ec.COSMIC,wc);ad.REAL_TIME=0;ad.USE_THEME_CREATOR=1})();(function(){function Ha(){var Wb,tc={},La={},Eb=[],xb,ab=[];this.getName=function(){return Wb};this.setName=function($b){Wb=$b};this.getEntityAssociateNameMap=function(){return tc};this.getEntityByAssociateName=function($b){return tc[$b]};this.getFisrtEntity=function(){return xb?xb:ab[0]};this.getEntityMap=function(){return La};this.getRelations=function(){return Eb};this.getEntities=function(){return ab};this.toJsonObject=function(){var $b={};$b.name=Wb;for(var Ib=[],Vb=0;Vb<ab.length;Vb++)Ib.push(ab[Vb].toJsonObject());
$b.entities=Ib;Ib=[];for(Vb=0;Vb<Eb.length;Vb++)Ib.push(Eb[Vb].toJsonObject());$b.relations=Ib;return $b};this.cloneMe=function(){var $b=new Ha;$b.setName(Wb);for(var Ib=$b.getEntities(),Vb=$b.getEntityMap(),Xa=$b.getEntityAssociateNameMap(),ma=0;ma<ab.length;ma++){var Lb=ab[ma];if(Lb.getParentEntity()){var hc=Vb[Lb.getParentEntity().getName()];Lb=Lb.cloneMe(hc)}else Lb=Lb.cloneMe(null);Ib.push(Lb);Vb[Lb.getName()]=Lb;Xa[Lb.getAssociateName()]=Lb}Ib=$b.getRelations();for(ma=0;ma<Eb.length;ma++){Xa=
Eb[ma];Lb=Xa.clone();hc=Vb[Xa.getFromEntity().getName()];var Mb=Vb[Xa.getToEntity().getName()];Lb.setFromEntity(hc);Lb.setToEntity(Mb);Lb.setFromProperty(hc.findProperty(Xa.getFromProperty().getName()));Lb.setToProperty(Mb.findProperty(Xa.getToProperty().getName()));Ib.push(Lb)}return $b};this.fromJsonObject=function($b,Ib){Wb=$b.name;tc={};La={};Eb=[];ab=[];for(var Vb=$b.entities,Xa=0;Xa<Vb.length;Xa++){var ma=Vb[Xa];var Lb=ma.children?new Kc:new Bc;Lb.fromJsonObject(ma,Ib,La);xb||(xb=Lb);tc[Lb.getAssociateName()]=
Lb;La[Lb.getName()]=Lb;ab.push(Lb)}$b=$b.relations;for(Xa=0;Xa<$b.length;Xa++)Ib=$b[Xa],Vb=new rc,Vb.fromJsonObject(Ib,La),Eb.push(Vb)}}function Kb(){var Wb,tc,La,Eb,xb;this.setName=function(ab){Wb=ab};this.getName=function(){return Wb};this.setDisplayName=function(ab){tc=ab};this.getDisplayName=function(){return tc};this.setCommentInfo=function(ab){La=ab};this.getCommentInfo=function(){return La};this.setModelId=function(ab){Eb=ab};this.getModelId=function(){return Eb};this.setAssociateName=function(ab){Eb=
ab};this.getAssociateName=function(){return Eb};this.setParentNode=function(ab){xb=ab};this.getParentNode=function(){return xb};this.getSubNodeLevel=function(){for(var ab=-1,$b=xb;$b;)ab++,$b=$b.getParentNode();return ab}}function jc(){Kb.call(this);var Wb=this,tc=[];this.setChildren=function(La){tc=La};this.getChildren=function(){return tc};this.toJsonObject=function(){var La={};La.children=tc;return La};this.fromJsonObject=function(La){Wb.setName(La.name);Wb.setDisplayName(La.displayName);Wb.setCommentInfo(La.commentInfo);
if(La=La.children)for(var Eb=0;Eb<La.length;Eb++){var xb=La[Eb];if(xb.type){var ab=new Cb;ab.fromJsonObject(xb);ab.setParentNode(Wb);tc.push(ab)}else ab=new jc,ab.fromJsonObject(xb),ab.setParentNode(Wb),tc.push(ab)}}}function Cb(){Kb.call(this);var Wb=this,tc;this.setType=function(La){tc=La};this.getType=function(){return tc};this.fromJsonObject=function(La){Wb.setType(La.type);Wb.setName(La.name);Wb.setDisplayName(La.displayName);Wb.setCommentInfo(La.commentInfo);Wb.setAssociateName(La.id)}}"undefined"==
typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.data&&(com.kingdee.bos.qing.data={});var oc=com.kingdee.bos.qing.data;oc.NameVO=function(){var Wb,tc;this.getName=function(){return Wb};this.getDisplayName=function(){return tc};this.fromJson=function(La){Wb=La.name;tc=La.displayName}};oc.PreviewDataModel=function(){var Wb,
tc,La,Eb,xb,ab=[],$b,Ib;this.getErrorEntityName=function(){return Ib?Ib.getEntityName():null};this.getErrorState=function(){return Ib?Ib.getErrorState():null};this.getErrorPreviewInfo=function(){return Ib?Ib.getErrorDesc():null};this.getErrorInfo=function(){return Ib};this.getSqlContent=function(){return Eb};this.getUnPushdownFilterContent=function(){return xb};this.getData=function(){return Wb};this.getWarmingMessage=function(){return tc};this.getRemovedClumns=function(){return La};this.getNotExistedPropNames=
function(){return ab};this.getCalcFieldCheckInfo=function(){return $b?$b.map:null};this.fromJsonObject=function(Vb){Wb=Vb.data;tc=Vb.warmingMessage;La=Vb.notExistedColumns;Eb=Vb.sqlContent;xb=Vb.unPushdownFilterContent;ab=Vb.notExistedPropNames;Vb.calcFieldCheckResponse&&($b=Vb.calcFieldCheckResponse);if(Vb=Vb.entityErrorInfo)Ib=new uc,Ib.fromJsonObject(Vb)}};oc.DesigntimeDataObject=Ha;oc.FolderNode=jc;oc.LeafNode=Cb;oc.SystemVarModel=function(){var Wb,tc;this.setName=function(La){Wb=La};this.setValue=
function(La){tc=La};this.getName=function(){return Wb};this.getValue=function(){return tc}};var rc=oc.Relation,Kc=oc.UnionEntity,Bc=oc.Entity,uc=oc.EntityErrorInfo})();(function(){function Ha(){var Eb=!1,xb=!1,ab=!1,$b=!1,Ib=!1;this.setEntityLocationChange=function(Vb){$b=Vb};this.setChildEntityChanged=function(Vb){Ib=Vb};this.isEntityLocationChanged=function(){return $b};this.setPropCheckChanged=function(Vb){Eb=Vb};this.setPropMapChanged=function(Vb){xb=Vb};this.setEntityMapChanged=function(Vb){ab=Vb};this.isUnionChanged=function(){return Eb||xb||ab||Ib}}function Kb(Eb,xb){var ab=this,$b=[],Ib,Vb=Eb,Xa,ma=[],Lb,hc,Mb,mb,vc=[null,null],Ob,Dc,bd=new Ha;this.getUnionChangeState=
function(){return bd};this.setRelationFromProp=function(Xb){vc[0]=Xb};this.setRelationToProp=function(Xb){vc[1]=Xb};this.getInnerRelationProps=function(){return vc};this.isNeedRebuildUnion=function(){return bd.isUnionChanged()};this.setRowRemoveListener=function(Xb){Dc=Xb};this.setEntityMergeChangeListener=function(Xb){Ob=Xb};this.getEntityChangeListener=function(){return Ob};this.setFinalUnionEntity=function(Xb){hc=Xb};this.getFinalUnionEntity=function(){return hc};this.getCurrentUnionEntity=function(){return mb};
this.setOriginalUnionEntity=function(Xb){Mb=Xb};this.setCurrentUnionEntity=function(Xb){mb=Xb};this.getOriginalUnionEntity=function(){return Mb};this.setPropertyMapModels=function(Xb){Lb=Xb};this.getPropMapModels=function(){return Lb};this.getUnSelectedMapModels=function(){for(var Xb=[],cc=0;cc<Lb.length;cc++){var Da=Lb[cc];Da.isSelected()||Xb.push(Da)}return Xb};this.getChildrenRows=function(){return ma};this.setParentRowModel=function(Xb){Xa=Xb};this.getParentRowModel=function(){return Xa};this.removeEntityCell=
function(Xb){$b.splice(Xb,1);for(var cc=0;cc<$b.length;cc++)cc<Xb||($b[cc].moveForward(),$b[cc].isNotEmptyCellNode()&&bd.setEntityLocationChange(!0));Vb--};this.findSameAliasRowModel=function(Xb,cc){if(0==ma.length)return null;for(var Da=0;Da<ma.length;Da++){var oa=ma[Da],Ya=cc?oa.getFirstNotEmptyNode().getEntity():oa.getEntityCellNode(0).getEntity();Ya=Ya?Ya.getAlias():"";if(Ya==Xb.getAlias())return oa;Ya=Ya.split("_");var eb=Xb.getAlias().split("_");if(1<Ya.length&&1<eb.length){if(Ya[0]==eb[0]&&
Uc(Ya[1])&&Uc(eb[1]))return oa}else if(1<Ya.length&&1==eb.length){if(Ya[0]==eb[0]&&Uc(Ya[1]))return oa}else if(1==Ya.length&&1<eb.length&&Ya[0]==eb[0]&&Uc(eb[1]))return oa}return null};var Uc=function(Xb){return/^[0-9]+.?[0-9]*$/.test(Xb)};this.isEmptyRow=function(){for(var Xb=0;Xb<$b.length;Xb++)if($b[Xb].isNotEmptyCellNode())return!1;return!0};this.getChildRowLocation=function(Xb){for(var cc=0;cc<ma.length;cc++)if(Xb.getRowNum()==ma[cc].getRowNum())return cc;return-1};this.recalcRowNum=function(Xb){this.setRowNum(Xb.getIndex());
console.info("row num:"+Ib);for(var cc=0;cc<ma.length;cc++)ma[cc].recalcRowNum(Xb.increatment())};this.insertChildRowModel=function(Xb,cc){ma.splice(cc,0,Xb);for(var Da=0;Da<Vb;Da++){var oa=$b[Da],Ya=Xb.getEntityCellNode(Da);oa.insertChildNode(cc,Ya);Ya.setParentCellNode(oa)}};this.addChildrenRowModel=function(Xb){ma.push(Xb);for(var cc=0;cc<Vb;cc++){var Da=$b[cc],oa=Xb.getEntityCellNode(cc);Da.addChildNode(oa);oa.setParentCellNode(Da)}};this.getChildMaxRowNum=function(){var Xb=ma.length;return 0==
Xb?Ib:ma[Xb-1].getChildMaxRowNum()};this.deepVisitRow=function(Xb){if(Xb){Xb(this);for(var cc=0;cc<ma.length;cc++)ma[cc].deepVisitRow(Xb)}};this.makeLocalCopy=function(Xb,cc,Da){if(Da=$b[cc].getEntity()){var oa=new Kb(Vb,xb);oa.initCellNode();oa.setEntityMergeChangeListener(Ob);oa.getEntityCellNode(cc).setEntity(Da,!0);Xb.addChildrenRowModel(oa);oa.setParentRowModel(Xb)}for(Xb=0;Xb<ma.length;Xb++)ma[Xb].makeLocalCopy(oa,cc,!1)};this.getLastChildrenRow=function(){var Xb=ma.length;return 0==Xb?null:
ma[Xb-1]};this.hasChildren=function(){return 0<ma.length};this.initCellNode=function(){for(var Xb=0;Xb<Vb;Xb++){var cc=new jc(null,this,Xb,xb);cc.setCellNodeDataChangedListener(Qc);$b.push(cc)}};var Qc=function(Xb,cc,Da){cc!=Da&&(bd.setEntityMapChanged(!0),Xa&&Xa.getUnionChangeState().setChildEntityChanged(!0),Ob&&Ob(ab,Xb,cc,Da))};this.findEntityNode=function(Xb){for(var cc=0;cc<Vb;cc++)if($b[cc].getEntity()==Xb)return $b[cc];return null};this.getColSize=function(){return Vb};this.getEntityCellNode=
function(Xb){return $b[Xb]};this.deepFindRowByEntity=function(Xb,cc,Da){if(!cc||Xb>=$b.length)return null;var oa=$b[Xb].getEntity();if(oa==cc||oa&&(Da&&oa.getAssociateName()==cc.getAssociateName()||!Da&&oa.getName()==cc.getName()))return this;if(0==ma.length)return null;for(Da=0;Da<ma.length;Da++)if(oa=ma[Da].deepFindRowByEntity(Xb,cc))return oa;return null};this.getFirstNotEmptyNode=function(){for(var Xb=0;Xb<$b.length;Xb++){var cc=$b[Xb];if(cc.isNotEmptyCellNode())return cc}return null};this.getRowNum=
function(){return Ib};this.removeEmptyChildRow=function(){for(var Xb=[],cc=0;cc<ma.length;cc++){var Da=ma[cc];if(Da.isEmptyRow()){for(var oa=0;oa<Vb;oa++)$b[oa].removeNode(Da.getEntityCellNode(oa));Dc&&Dc(Da)}else Xb.push(Da);Da.removeEmptyChildRow()}ma=Xb};this.setRowNum=function(Xb){Ib=Xb};this.getRowLevel=function(){return xb};this.makeFlat=function(Xb){Xb.push(ab);for(var cc=0;cc<ma.length;cc++)ma[cc].makeFlat(Xb);return Xb}}function jc(Eb,xb,ab,$b){var Ib=Eb,Vb=ab,Xa,ma=[],Lb,hc;this.setErrorDesc=
function(Mb){hc=Mb};this.getErrorDesc=function(){return hc};this.setCellNodeDataChangedListener=function(Mb){Lb=Mb};this.getRowIndex=function(){return xb.getRowNum()};this.removeNode=function(Mb){for(var mb=[],vc=0;vc<ma.length;vc++)Mb!=ma[vc]&&mb.push(ma[vc]);ma=mb};this.collectEntity=function(Mb){if(Ib){Mb.push(Ib);for(var mb=0;mb<ma.length;mb++)ma[mb].collectEntity(Mb)}};this.getCellNodeLevel=function(){return $b};this.getLastChild=function(){return 0==ma.length?null:ma[ma.length-1]};this.getEndEntityNodeInTree=
function(){var Mb=ma.length;if(0==Mb&&Ib)return this;--Mb;for(var mb;0<=Mb;){var vc=ma[Mb];if(vc.isNotEmptyCellNode()){mb=vc;break}Mb--}return mb?mb.getEndEntityNodeInTree():Ib?this:null};this.getLastNotEmptyChild=function(){if(0==ma.length)return null;for(var Mb=ma.length-1;0<=Mb;){var mb=ma[Mb];if(mb.isNotEmptyCellNode())return mb;Mb--}return null};this.clearChildCellNodeDataIncludeMe=function(){var Mb=Ib;Ib=null;Lb&&Lb(Vb,Mb,null);for(Mb=0;Mb<ma.length;Mb++)ma[Mb].clearChildCellNodeDataIncludeMe()};
this.isLastNotEmptyCellNode=function(Mb){if(0==ma.length)return!1;for(var mb=ma.length-1;0<=mb;){var vc=ma[mb];if(vc.isNotEmptyCellNode())return vc==Mb;mb--}return!1};this.setParentCellNode=function(Mb){Xa=Mb};this.getParentCellNode=function(){return Xa};this.addChildNode=function(Mb){ma.push(Mb)};this.insertChildNode=function(Mb,mb){ma.splice(Mb,0,mb)};this.hasChildren=function(){return 0<ma.length};this.collectNotEmptyCellNode=function(Mb){for(var mb=0;mb<ma.length;mb++)ma[mb].isNotEmptyCellNode()&&
Mb.push(ma[mb]);return Mb};this.hasNotEmptyChild=function(){if(0==ma.length)return!1;for(var Mb=0;Mb<ma.length;Mb++)if(ma[Mb].isNotEmptyCellNode())return!0;return!1};this.setEntity=function(Mb,mb){var vc=Ib;Ib=Mb;mb&&Lb&&Lb(Vb,vc,Ib)};this.getEntity=function(){return Ib};this.isNotEmptyCellNode=function(){return null!=Ib};this.moveForward=function(){Vb--;Ib&&Ib.setUnionLocation(Vb)};this.getCol=function(){return Vb}}function Cb(){var Eb,xb,ab,$b=!0;this.cloneMe=function(){var Ib=new Cb;xb&&Ib.setProperty(xb.cloneMe());
Ib.setIndex(Eb);Ib.setError(ab);Ib.setSelectable($b);return Ib};this.setSelectable=function(Ib){$b=Ib};this.isSelectable=function(){return $b&&0!=Eb};this.setProperty=function(Ib){xb=Ib};this.getProperty=function(){return xb};this.setError=function(Ib){ab=Ib};this.getError=function(){return ab};this.setIndex=function(Ib){Eb=Ib};this.getIndex=function(){return Eb};this.hasProperty=function(){return null!=xb}}function oc(){var Eb=this,xb=[],ab,$b=!0,Ib=!0,Vb=!1,Xa=!0;this.init=function(ma){if(!(0>=
ma))for(var Lb=0;Lb<ma;Lb++){var hc=new Cb;hc.setIndex(Lb);xb.push(hc)}};this.cloneMe=function(){for(var ma=new oc,Lb=[],hc=0;hc<xb.length;hc++)Lb.push(xb[hc].cloneMe());ma.setPropCells(Lb);ma.setSelected($b);ma.setEditable(Ib);ma.setLocked(Vb);ma.setFieldSelectable(Xa);ma.setUnionBaseProp(ab.cloneMe());return ma};this.getPropCellSize=function(){return xb.length};this.getPropCell=function(ma){return xb[ma]};this.setPropCells=function(ma){xb=ma};this.isEmpty=function(){for(var ma=0;ma<xb.length;ma++)if(xb[ma].hasProperty())return!1;
return!0};this.setPrompt=function(ma,Lb){xb[ma].setError(Lb)};this.setProperty=function(ma,Lb,hc){xb[ma].setProperty(Lb);hc&&(ab=Lb.cloneMe(),ab.setRelatedBaseProp(""),Lb.setRelatedBaseProp(ab.getName()))};this.setPropCellSelectable=function(ma,Lb){xb[ma].setSelectable(Lb)};this.spliceNewLocation=function(ma){var Lb=new Cb;Lb.setIndex(ma);xb.splice(ma,0,Lb);for(ma+=1;ma<xb.length;ma++)xb[ma].setIndex(ma)};this.deleteProperty=function(ma){var Lb=Eb.findFirstNotNullPropCell();Lb=Lb?Lb.getIndex()==ma:
!1;var hc=[],Mb;for(Mb in xb)Mb<ma&&hc.push(xb[Mb]),Mb>ma&&(xb[Mb].setIndex(Mb-1),hc.push(xb[Mb]));xb=hc;Lb&&(ma=Eb.findFirstNotNullPropCell())&&(ab=ma.getProperty().cloneMe(),ab.setRelatedBaseProp(""),xb.forEach(function(mb){(mb=mb.getProperty())&&mb.setRelatedBaseProp(ab.getName())}))};this.findFirstNotNullPropCell=function(){for(var ma=0;ma<xb.length;ma++)if(xb[ma].hasProperty())return xb[ma];return null};this.resetProperty=function(ma,Lb){var hc=Eb.findFirstNotNullPropCell();xb[ma].setProperty(Lb);
if(Lb)ma<=hc.getIndex()?(ab=Lb.cloneMe(),ab.setRelatedBaseProp(""),xb.forEach(function(Mb){(Mb=Mb.getProperty())&&Mb.setRelatedBaseProp(ab.getName())})):Lb.setRelatedBaseProp(ab.getName());else if(ma==hc.getIndex()&&(hc=Eb.findFirstNotNullPropCell()))for(ab=hc.getProperty().cloneMe(),ab.setRelatedBaseProp(""),ma=hc.getIndex();ma<xb.length;ma++)(Lb=xb[ma].getProperty())&&Lb.setRelatedBaseProp(ab.getName())};this.setUnionBaseProp=function(ma){ab=ma};this.setFieldSelectable=function(ma){Xa=ma};this.isFieldSelectable=
function(){return Xa};this.setLocked=function(ma){Vb=ma};this.isLocked=function(){return Vb};this.setEditable=function(ma){Ib=ma};this.isEditable=function(){return Ib};this.setSelected=function(ma){$b=ma};this.isSelected=function(){return $b};this.getUnAcceptedError=function(){for(var ma in xb){var Lb=xb[ma].getError();if(Lb&&!Lb.isAcceptable())return Lb}return null};this.getPrompt=function(){for(var ma=0;ma<xb.length;ma++){var Lb=xb[ma].getError();if(Lb)return Lb.getErrorDesc()}return""};this.getBaseFieldProp=
function(){return ab};this.getPropCells=function(){return xb};this.getFieldPropByIndex=function(ma){return xb[ma].getProperty()};this.changeBasePropName=function(ma){ab.setName(ma);for(var Lb=0;Lb<xb.length;Lb++){var hc=xb[Lb].getProperty();hc&&hc.setRelatedBaseProp(ma)}}}function rc(){var Eb=this,xb,ab=[],$b={},Ib,Vb,Xa={},ma={},Lb={},hc={},Mb={},mb,vc={},Ob={},Dc={},bd={},Uc={},Qc={};this.getArrSourceEntity=function(){return ab};this.isSourceUnionEntity=function(){return Ib};this.addEntityCompareModel=
function(da,zb){Dc[da]=zb};this.getEntityCompareModel=function(da){return da?Dc[da]:null};this.isAppendNewEntity=function(){return"APPEND"==xb};this.getSourceEntityRelationProps=function(da){return da?ma[da.getName()]:null};this.getEntityRelationProperties=function(da,zb){switch(zb){case rc.SOURCE_ENTITY:return ma[da];case rc.TARGET_ENTITY:return Mb[da];case rc.UNION_ENTITY_UNIT:return Lb[da]}return[null,null]};this.getEntityRelationFromProp=function(da,zb){return(da=Eb.getEntityRelationProperties(da,
zb))?da[0]:null};this.getEntityRelationToProp=function(da,zb){return(da=Eb.getEntityRelationProperties(da,zb))?da[1]:null};this.isRelationProperty=function(da,zb,U){if(U=Eb.getEntityRelationProperties(da,U))if(da=U[0],U=U[1],da&&da.getName()==zb.getName()||U&&U.getName()==zb.getName())return!0;return!1};this.isSourceEntityFromProperty=function(da,zb){return(da=ma[da])?(da=da[0])?da.getName()==zb.getName():!1:!1};this.isSourceEntityToProperty=function(da,zb){return(da=ma[da])?(da=da[1])?da.getName()==
zb.getName():!1:!1};this.getSourceUnionEntityOriginalCalcRelatedProps=function(da){return da?Xa[da.getName()]:null};this.getTargetEntityRelationProps=function(da){return da?Mb[da.getName()]:null};this.findTargetEntityRelationFromProp=function(da){return(da=Mb[da])?da[0]:null};this.findTargetEntityRelationToProperty=function(da){return(da=Mb[da])?da[1]:null};this.replaceTargetEntityRelationPropMapKey=function(da,zb){var U=Mb[da];delete Mb[da];Mb[zb]=U;U=$b[da];delete $b[da];$b[zb]=U};this.getInnerRelationByToEntityName=
function(da){return hc[da]};this.getEntityUnitPropAssociateNameMap=function(da){return bd[da]};this.replaceEntityPropAssociateNameMap=function(da,zb){bd[da]=zb};this.initForModifyMerge=function(da,zb,U){xb="MODIFY";ab=da.getEntityWithSubNodes(zb);Ib=!0;ea();cc();oa(zb,U);eb(da);da.getBizUnionInnerEntityRelations(zb.getName()).forEach(function(wc){var zc=wc.getToEntity().getName();hc[zc]=wc});Eb.initEntityCompareModel(U)};var Xb=function(da){da=da.copyEntityArray();for(var zb in da)Uc[da[zb].getName()]=
da[zb],Qc[da[zb].getAlias()]=da[zb]};this.getBoxEntityAliasMap=function(){return Qc};this.getBoxEntityNameMap=function(){return Uc};var cc=function(){if(Ib)for(var da in ab){var zb=ab[da].getChildren(),U;for(U in zb){var wc=zb[U],zc={};wc.getProperties().forEach(function(Gc){zc[Gc.getAssociateName()]=Gc});bd[wc.getName()]=zc}}else for(da in ab)wc=ab[da],zc={},wc.getProperties().forEach(function(Gc){zc[Gc.getAssociateName()]=Gc}),bd[wc.getName()]=zc};this.initEntityCompareModel=function(da){if(Eb.isSourceUnionEntity())for(var zb=
Eb.getArrSourceEntity(),U=0;U<zb.length;U++){var wc=zb[U],zc=wc.getChildren(),Gc={};for(yc=0;yc<zc.length;yc++){var ad=zc[yc];Sc=ad.getTopParentEntity().getAssociateName();lc=da[Sc];Gc[ad.getAssociateName()]=lc.getEntityByAssociateName(ad.getAssociateName())}lc=new Bc(wc,Gc);lc.compareAndSync();Eb.addEntityCompareModel(wc.getName(),lc)}else{zb=Eb.getArrSourceEntity();for(var lc=da[zb[0].getAssociateName()],yc=0;yc<zb.length;yc++){da=zb[yc];var Sc=da.getAssociateName();U=lc.getEntityByAssociateName(Sc);
da=new Kc(da,U);da.compareAndSync();Eb.addEntityCompareModel(Sc,da)}}};this.initForNewMerge=function(da,zb,U,wc,zc){xb="APPEND";ab=da.getEntityWithSubNodes(zb);Vb=(Ib=zb instanceof tc)?zb.getChildren().length:1;wc.forEach(function(Gc){$b[Gc.getToEntity().getName()]=Gc});mb=da.buildToEntityRelationsMap();ea();cc();Wa(zb,zc);eb(da);Da(wc);Xb(da);Eb.initEntityCompareModel(zc)};this.getRelationByToEntityName=function(da,zb){switch(zb){case rc.SOURCE_ENTITY:return mb[da];case rc.TARGET_ENTITY:return $b[da];
case rc.UNION_ENTITY_UNIT:return hc[da]}return null};this.getSourceEntityToRelation=function(da){return mb[da]};this.getTargetEntityToRelation=function(da){return $b[da]};this.getNewMergeEntityLocation=function(){return Vb};var Da=function(da){for(var zb=0;zb<da.length;zb++){var U=da[zb],wc=U.getFromEntity(),zc=U.getToEntity(),Gc=Mb[wc.getName()];Gc?Gc[0]||(Gc[0]=U.getFromProperty()):(Gc=[U.getFromProperty(),null],Mb[wc.getName()]=Gc);(wc=Mb[zc.getName()])?wc[1]||(wc[1]=U.getToProperty()):(wc=[null,
U.getToProperty()],Mb[zc.getName()]=wc)}},oa=function(da,zb){for(da=0;da<ab.length;da++)for(var U=ab[da].getChildren(),wc=0;wc<U.length;wc++){var zc=U[wc],Gc=zb[zc.getTopParentEntity().getAssociateName()];Gc&&(Gc=Ya(Gc.getRelations(),zc),Lb[zc.getName()]=Gc)}},Ya=function(da,zb){var U=[null,null],wc=zb.getAssociateName();zb=bd[zb.getName()];for(var zc in da){var Gc=da[zc];Gc.getFromEntity().getAssociateName()==wc&&(U[0]=zb[Gc.getFromProperty().getAssociateName()]);Gc.getToEntity().getAssociateName()==
wc&&(U[1]=zb[Gc.getToProperty().getAssociateName()])}return U},eb=function(da){if(Ib)for(var zb=0;zb<ab.length;zb++){var U=ab[zb],wc=U.getName();Xa[wc]||(Xa[wc]=[null,null]);if(U=U.getParentEntity()){U=U.getName();var zc=da.getRelationByEntitiesName(U,wc);zc&&(Xa[U][0]=zc.getFromProperty(),Xa[wc][1]=zc.getToProperty())}}},Wa=function(da,zb){if(Ib)for(da=0;da<ab.length;da++){for(var U=[null,null],wc=ab[da],zc=wc.getChildren(),Gc=!1,ad=!1,lc=0;lc<zc.length;lc++){var yc=zc[lc],Sc=yc.getTopParentEntity();
Sc=zb[Sc.getAssociateName()];Sc=Ya(Sc.getRelations(),yc);Lb[yc.getName()]=Sc;!ad&&Sc[0]&&(ad=!0,U[0]=wc.findProperty(Sc[0].getRelatedBaseProp()));!Gc&&Sc[1]&&(Gc=!0,U[1]=wc.findProperty(Sc[1].getRelatedBaseProp()))}ma[wc.getName()]=U}else for(Sc=ab[0],Sc=zb[Sc.getAssociateName()],da=0;da<ab.length;da++)zb=ab[da].getName(),U=Ya(Sc.getRelations(),ab[da]),ma[zb]=U};this.removeInnerEntityUnit=function(da){var zb=da.getName();vc[zb]=null;Ob[da.getAlias()]=null;bd[zb]=null;Lb[zb]=null;hc[zb]=null};this.addNewInnerEntityUnit=
function(da,zb){var U=da.getName();vc[U]=da;Ob[da.getAlias()]=da;var wc={};da.getProperties().forEach(function(Gc){wc[Gc.getAssociateName()]=Gc});bd[U]=wc;var zc=[null,null];zb.forEach(function(Gc){Gc.getToEntity()==da&&(hc[U]=Gc,zc[1]=Gc.getToProperty());Gc.getFromEntity()==da&&(zc[0]=Gc.getFromProperty())});Lb[U]=zc};this.getSourceInnerEntityNameMap=function(){return vc};this.getSourceInnerEntityAliasMap=function(){return Ob};var ea=function(){vc={};Ob={};if(Ib)for(var da=0;da<ab.length;da++)ab[da].getChildren().forEach(function(zb){vc[zb.getName()]=
zb;Ob[zb.getAlias()]=zb});else ab.forEach(function(zb){vc[zb.getName()]=zb;Ob[zb.getAlias()]=zb})}}function Kc(Eb,xb){var ab=[],$b={},Ib=[];this.setUnionProperties=function(Mb){Ib=Mb};this.getEntity=function(){return Eb};this.compareAndSync=function(){if(xb)Eb.setErrorInfo(xb.getErrorInfo()),ma(Eb),Vb(),hc();else{var Mb=new Wb.EntityErrorInfo;Mb.setErrorState(Wb.AbstractEntity.ERROR_STATE_TABLENOTEXIST);Eb.setErrorInfo(Mb)}};this.getUnSelectedProperty=function(){return ab};this.isUnSelectedProperty=
function(Mb){return null!=$b[Mb.getName()]};var Vb=function(){var Mb={};xb.getProperties().forEach(function(Ob){Mb[Ob.getName()]=Ob});var mb=[],vc=Xa(Eb);Eb.getProperties().forEach(function(Ob){var Dc=Mb[Ob.getName()],bd=-1<vc.indexOf(Ob.getName())?!0:!1;if(Ob.isCalculatingField()||Dc||Ob.getName()==La.CUSTOM_BIZ_ENTITY_NAME_FIELD||bd)Dc&&Ob.setHide(Dc.isHide()),mb.push(Ob)});Eb.setProperties(mb)},Xa=function(Mb){var mb=[];if((Mb=Mb.getColumnToRowProperties())&&0<Mb.length)for(var vc in Mb){var Ob=
Mb[vc],Dc=Ob.getFieldName();Ob=Ob.getFieldValueNames();mb=mb.concat(Dc,Ob)}return mb},ma=function(Mb){var mb=Mb.getColumnToRowProperties();if(mb&&0<mb.length){var vc={};if(Ib&&0<Ib.length){Ib.forEach(function(bd){vc[bd.getName()]=bd});Mb=Mb.getProperties();for(var Ob in mb){var Dc=mb[Ob];Dc&&Lb(vc,Mb,Dc)}}}},Lb=function(Mb,mb,vc){var Ob={};mb.forEach(function(Qc){Ob[Qc.getName()]=Qc});var Dc=vc.getFieldName();vc=vc.getFieldValueNames();vc.push(Dc);for(var bd in vc){Dc=vc[bd];var Uc=Mb[Dc];Uc&&(Uc.setRelatedBaseProp(Dc),
Ob[Dc]||mb.push(Uc))}},hc=function(){var Mb={};Eb.getProperties().forEach(function(mb){Mb[mb.getName()]=mb});xb.getProperties().forEach(function(mb){mb.isHide()||Mb[mb.getName()]||(ab.push(mb),$b[mb.getName()]=mb)})}}function Bc(Eb,xb){uc.call(this,Eb,xb);this.protectedGetRemoteEntityMapKey=function(ab){return ab.getAssociateName()}}function uc(Eb,xb){var ab=this,$b=[],Ib={};this.getEntityRelatedPropMap=function(Lb){return Ib[Lb]};this.compareAndSync=function(){ma();Vb();Xa()};var Vb=function(){for(var Lb=
Eb.getChildren(),hc=0;hc<Lb.length;hc++){var Mb=Lb[hc],mb={};Mb.getProperties().forEach(function(vc){mb[vc.getRelatedBaseProp()]=vc});Ib[Mb.getName()]=mb}};this.isUnSelectedProperty=function(Lb){for(var hc=0;hc<$b.length;hc++)if($b[hc].isUnSelectedProperty(Lb))return!0;return!1};this.getUnSelectedProperty=function(Lb){for(var hc=0;hc<$b.length;hc++){var Mb=$b[hc];if(Mb.getEntity().getName()==Lb)return Mb.getUnSelectedProperty()}return null};var Xa=function(){for(var Lb=Eb.getProperties(),hc=[],Mb=
0;Mb<Lb.length;Mb++){var mb=Lb[Mb];mb.isCalculatingField()?hc.push(mb):mb.getName()==La.CUSTOM_BIZ_ENTITY_NAME_FIELD?hc.push(mb):Eb.getChildren().some(function(vc){var Ob=mb;return null!=Ib[vc.getName()][Ob.getName()]})&&hc.push(mb)}Eb.setProperties(hc)},ma=function(){Eb.getChildren().forEach(function(Lb){var hc=ab.protectedGetRemoteEntityMapKey(Lb);Lb=new Kc(Lb,xb[hc]);Lb.setUnionProperties(Eb.getProperties());Lb.compareAndSync();$b.push(Lb)})};this.protectedGetRemoteEntityMapKey=function(Lb){return Lb.getName()}}
"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.data&&(com.kingdee.bos.qing.data={});var Wb=com.kingdee.bos.qing.data;Wb.EntityMergeModel=Kb;Wb.EntityCellNode=jc;Wb.PropRelationMapModel=oc;Wb.BizEntityMergeCtx=rc;Wb.RowNum=function(Eb){var xb=Eb;this.increatment=function(){xb++;return this};this.getIndex=
function(){return xb}};Wb.SingleEntityCompareModel=Kc;Wb.UnionEntityCompareModel=uc;Wb.EntityChangeStatus=function(Eb,xb){this.getChangedIndex=function(){return Eb};this.getOldEntity=function(){return xb}};Wb.UnionChangeState=Ha;Wb.PropertyMapError=function(Eb,xb){this.isAcceptable=function(){return Eb};this.getErrorDesc=function(){return xb}};Wb.EntitySourceChangeSqlModel=function(){var Eb,xb;this.setEntity=function(ab){Eb=ab};this.getEntity=function(){return Eb};this.setUserSql=function(ab){xb=
ab};this.getUserSql=function(){return xb}};var tc=Wb.UnionEntity,La=Wb.Property;rc.SOURCE_ENTITY=0;rc.TARGET_ENTITY=1;rc.UNION_ENTITY_UNIT=3})();(function(){function Ha(Da,oa,Ya,eb){Wb.call(this,Da,oa,Ya,eb);var Wa=this.protectedMethod;this.checkConnection=function(ea){ea={source:JSON.stringify(ea)};Wa.remote("checkConnection",ea)};this.guessFileEncoding=function(ea){Wa.remote("guessFileEncoding",{filePath:ea})};this.scanAllEntity=function(ea){ea={source:JSON.stringify(ea)};Wa.remote("scanAllEntity",ea)};this.getUsableEntities=function(ea){ea={source:JSON.stringify(ea)};Wa.remote("getUsableEntities",ea)};this.getUsableSchemas=function(ea){ea=
{source:JSON.stringify(ea)};Wa.remote("getUsableSchemas",ea)};this.getUsableEntitiesFromMultiFile=function(ea){ea={sources:JSON.stringify({sources:ea})};Wa.remote("getUsableEntitiesFromMultiFile",ea)};this.previewData=function(ea,da,zb){ea={entities:JSON.stringify({entities:ea}),sources:JSON.stringify({sources:da}),topRows:zb};Wa.remote("getPreviewData",ea)};this.getEntityTitle=function(ea){ea={entity:JSON.stringify(ea.toJsonObject()),source:JSON.stringify(ea.getSource().toJsonObject())};Wa.remote("getEntityTitle",
ea)};this.getStoredProcedures=function(ea){ea={source:JSON.stringify(ea)};Wa.remote("getStoredProcedures",ea)};this.getStoredProcedureParameters=function(ea,da){ea={source:JSON.stringify(ea),storedProcedureName:da};Wa.remote("getStoredProcedureParameters",ea)};this.getUnionDesigntimeDataObject=function(ea,da,zb){ea={entities:JSON.stringify({entities:ea}),sources:JSON.stringify({sources:da}),isBizUnion:zb};Wa.remote("getUnionDesigntimeDataObject",ea)};this.getDataCount=function(ea,da){ea={entities:JSON.stringify({entities:ea}),
sources:JSON.stringify({sources:da})};Wa.remote("getDataCount",ea)};this.isDataFieldUnique=function(ea,da,zb){ea={entities:JSON.stringify({entities:ea}),sources:JSON.stringify({sources:da}),fieldName:zb};Wa.remote("isDataFieldUnique",ea)};this.importEntity=function(ea,da){ea={source:JSON.stringify(ea),associateNames:da};Wa.remote("importEntity",ea)};this.getCatlog=function(ea){ea={source:JSON.stringify(ea)};Wa.remote("getCatlog",ea)};this.getDatabaseNameList=function(ea){ea={source:JSON.stringify(ea)};
Wa.remote("getDatabaseNameList",ea)};this.getDesigntimeDataObject=function(ea,da){ea={source:JSON.stringify(ea),associateName:da};Wa.remote("getDesigntimeDataObject",ea)};this.checkFormula=function(ea,da,zb){ea={checking:JSON.stringify({name:ea,formula:da,properties:zb})};Wa.remote("checkFormula",ea)};this.checkAllFormula=function(ea){ea={checking:JSON.stringify({properties:ea})};Wa.remote("checkAllFormula",ea)};this.cronExpression=function(ea){Wa.remote("cronExpression",{cron:ea})};this.loadModel=
function(ea){Wa.remote("loadModel",{themeID:ea})};this.loadUserRecentUsedSourceList=function(ea,da){ea={needexcludeSources:JSON.stringify({sources:ea}),needShowMoreFlag:da};Wa.remote("loadUserRecentUsedSourceList",ea)};this.saveModel=function(ea,da){ea={model:JSON.stringify(da),themeID:ea};Wa.remote("saveModel",ea)};this.getExportedData=function(ea,da){da="Qing-"+(new Date).getTime()+da;da=encodeURI(encodeURI(da));uc.downloadFile(da,ea)};this.uploadFile=function(ea){var da=com.kingdee.bos.qing.framework.common.RemoteFrameworkRegister.getUploadUrl();
ea.open("post",da,!0)};this.getFileSize=function(ea){Wa.remote("getFileSize",{fileUrl:ea})};this.downloadFile=function(ea){Wa.remote("downloadFile",{fileUrl:ea})};this.getDownloadFileData=function(ea,da){var zb=com.kingdee.bos.qing.common.Util,U=zb.appendParamToUrl(com.kingdee.bos.qing.framework.common.RemoteFrameworkRegister.getDownloadUrl(),"isExport","true");U=zb.appendParamToUrl(U,"exportUuid",ea);ea="Qing-"+(new Date).getTime()+da;ea=encodeURI(encodeURI(ea));U=zb.appendParamToUrl(U,"fileName",
ea);window.open(U,"_self")};this.openAPIInitialCheck=function(ea){ea={source:JSON.stringify(ea)};Wa.remote("openAPIInitialCheck",ea)};this.getPreviewDataSysVars=function(ea,da,zb){Wa.remote("getPreviewDataSysVars",{})};this.previewRuntimeUserSQL=function(ea){Wa.remote("previewRuntimeUserSQL",{sql:ea})};this.getExtractUserLimit=function(){Wa.remote("getExtractUserLimit",{})};this.getSelectableMaxFieldNum=function(){Wa.remote("getSelectableMaxFieldNum",{})}}function Kb(){Eb.call(this);var Da;this.getRemoteUrl=
function(oa){return Da};this.setRemoteUrl=function(oa){Da=oa}}function jc(){this.switchSQLToDisplayMode=function(Da,oa){throw new Exception("override me");};this.switchSQLToPersistentMode=function(Da,oa){throw new Exception("override me");};this.loadVarModelAdapter=function(Da,oa){throw new Exception("override me");}}function Cb(Da,oa,Ya,eb){this.getDefaultErrDesc=function(){return La.get(oa,Ya)};this.getFormattedError=function(Wa){var ea=La.get(oa,Ya);if(!eb)return ea;Wa=Wa.getErrorInfo();return eb(Wa,
ea)}}function oc(Da){var oa=this,Ya;this.getJqUi=function(){Ya=$("<div>");eb(Ya);oa.protectedInitUi(Ya);Da&&oa.protectedUpdateModelToUI(Da);return Ya};this.protectedInitUi=function(){throw Error("Override me");};this.protectedUpdateModelToUI=function(Wa){throw Error("Override me");};this.protectedGetModelFromUI=function(){throw Error("Override me");};this.protectedCheckParams=function(){throw Error("Override me");};var eb=function(Wa){var ea=$("<div>");ea.css({"border-bottom":"1px solid #CCCCCC"});
Ob.layoutCtrl(ea,10,0,570,23);var da=(new Dc(La.get("authSettings","\u8ba4\u8bc1\u8bbe\u7f6e"))).getJqUi();da.appendTo(ea);da.addClass("openApi-auth-settings");Ob.layoutCtrl(da,0,0,80,23);Wa.append(ea)};this.protectedMethod={addAuthSettingsJq:eb}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.data&&
(com.kingdee.bos.qing.data={});var rc=com.kingdee.bos.qing.data;rc.Facade=Ha;rc.AbstractVariateHelper=jc;var Kc,Bc,uc,Wb,tc,La,Eb,xb,ab,$b,Ib=rc.Property,Vb,Xa,ma,Lb=rc.AuthModelFactory,hc,Mb,mb,vc,Ob,Dc,bd,Uc,Qc,Xb;(function(){var Da=com.kingdee.bos.qing.common;Kc=Da.NumberFormater;Bc=Da.DateFormater;Ob=Da.DomUtil;Uc=Da.Base64Util;Xb=Da.Util;Da=com.kingdee.bos.qing.framework.common;Wb=Da.AbstractFacade;tc=Da.AbstractIcons;uc=Da.RemoteFramework;La=Da.MultilanguageManager.createPackageAccessor(rc);
Eb=Da.AbstractRemoteCall;Da=com.kingdee.bos.qing.ui.component;xb=Da.TextField;ab=Da.PasswordField;bd=Da.ComboBox;Dc=Da.Label;Qc=Da.HelpIcon;$b=Da.CheckBox;Da=com.kingdee.bos.qing.data;Vb=Da.SystemVarType;Xa=Da.SysVarAdapter;ma=Da.AbstractEntity;hc=Da.BasicAuthModel;Mb=Da.BearerAuthModel;mb=Da.DigestAuthModel;vc=Da.CosmicAuthModel})();rc.Icons=new function(){tc.call(this);var Da=this.protectedMethod;this.protectedInit=function(Wa,ea){Wa=com.kingdee.bos.qing.data.ComboIcon;if(!Wa)throw Error("com.kingdee.bos.qing.data.ComboIcon not found.");
Wa.define(ea,"dm");Ya(0,0,"btn_add-entity");Ya(0,1,"btn_add-union");Ya(0,2,"btn_add-relation");Ya(0,3,"btn_view-sysvar");eb(3,0,"table");eb(3,1,"union");eb(3,2,"custom-sql");eb(3,3,"stored-procedure");eb(3,15,"relation");eb(0,9,"elastic-dm");eb(0,10,"string");eb(0,11,"int");eb(0,12,"number");eb(0,13,"date");eb(0,14,"datetime");eb(0,15,"boolean");eb(6,0,"menu");eb(6,1,"delete");eb(6,3,"arrow-down");eb(6,4,"arrow-up");eb(8,0,"checked");Ya(6,14,"btn_delete");Ya(6,15,"btn_edit");eb(3,0,"excel");eb(3,
0,"csv");eb(3,0,"txt");eb(3,0,"xml");eb(6,7,"upload_error");eb(6,13,"upload_success");eb(6,12,"upload_running");eb(6,11,"upload_fail");eb(6,10,"upload_pause");eb(6,9,"upload_again");eb(6,8,"refresh");eb(6,2,"upload_icon");eb(7,3,"download_icon");eb(8,14,"up_move");eb(8,15,"down_move");Wa.define(ea,"source");oa(0,0,"source_mysql");oa(1,0,"source_sqlserver");oa(2,0,"source_oracle");oa(3,0,"source_pg");oa(4,0,"source_db2");oa(5,0,"source_access");oa(6,0,"source_sqlite");oa(3,1,"source_hive");oa(4,1,
"source_hana");oa(5,1,"source_odps");oa(6,1,"source_unsupported");oa(0,1,"source_excel");oa(1,1,"source_csv");oa(2,1,"source_txt");oa(0,2,"source_sybase");oa(1,2,"source_redshift");oa(2,2,"source_tidb");oa(3,2,"source_dm");oa(4,2,"source_openAPI");oa(5,2,"source_greenplum");oa(6,2,"source_gaussdb");oa(0,3,"source_apachedrill");oa(1,3,"source_sparksql");oa(2,3,"source_sybaseiq");oa(3,3,"source_impala");oa(4,3,"source_kylin");oa(5,3,"source_xml");oa(6,3,"source_kingbase");oa(5,4,"source_tdsql");oa(6,
4,"source_gbase");oa(6,1,"source_vastbase");oa(7,0,"source_yashandb");oa(7,1,"source_doris");Wa.define(ea,"file");oa(0,0,"file_txt_middle");oa(0,1,"file_access");oa(0,2,"file_sqlite");oa(0,3,"file_excel_middle");oa(0,4,"file_csv_middle");oa(0,5,"file_xml_middle");ea.setStartPosition(1,37);ea.setIconSize(15,18);oa(0,0,"file_csv");oa(0,1,"file_excel");oa(0,2,"file_txt");oa(0,3,"file_xml")};var oa=function(Wa,ea,da){Da.registIcon(Wa,ea,da)},Ya=function(Wa,ea,da){oa(Wa,ea,da);oa(Wa+1,ea,da+"_hover");
oa(Wa+2,ea,da+"_disabled")},eb=function(Wa,ea,da){oa(Wa,ea,da);oa(Wa+1,ea,da+"_selected")}};rc.PropDataTypeUtil=new function(){var Da=this;this.getDataTypeDesc=function(oa){switch(oa){case Ib.DT_STRING:oa=La.get("text","\u6587\u672c");break;case Ib.DT_NUMBER:oa=La.get("number","\u6570\u503c");break;case Ib.DT_INT:oa=La.get("integer","\u6574\u6570");break;case Ib.DT_DATE:oa=La.get("dataTypeDate","\u65e5\u671f");break;case Ib.DT_DATETIME:oa=La.get("dateTime","\u65e5\u671f\u65f6\u95f4");break;case Ib.DT_BOOLEAN:oa=
La.get("bool","\u5e03\u5c14");break;default:oa=""}return oa};this.buildDataTypeInConsistantPrompt=function(oa,Ya){var eb=La.get("dataTypeNotMatch","\u5b57\u6bb5\u201c#1\u201d\u7684\u6570\u636e\u7c7b\u578b\u4e3a#2\uff0c\u4e0e\u5b57\u6bb5\u201c#3\u201d\u7684#4\u6570\u636e\u7c7b\u578b\u4e0d\u4e00\u81f4");eb=eb.replace("#1",oa.getAlias());eb=eb.replace("#2",Da.getDataTypeDesc(oa.getOutputDataType()));eb=eb.replace("#3",Ya.getAlias);return eb=eb.replace("#4",Da.getDataTypeDesc(Ya.getOutputDataType()))}};
rc.FormatUtil=new function(){this.createFormater=function(Da,oa){switch(Da){case Ib.DT_BOOLEAN:Da=function(Wa){return null==Wa||void 0==Wa?"":Wa?"true":"false"};break;case Ib.DT_NUMBER:case Ib.DT_INT:var Ya=null;oa&&(Ya=new Kc,Ya.setFormatString(oa));Da=function(Wa){return null==Wa||void 0==Wa?"":Ya?Ya.format(Wa):Wa};break;case Ib.DT_DATE:var eb=new Bc;eb.setFormatString("yyyy-MM-dd");Da=function(Wa){return null==Wa||void 0==Wa?"":eb.format(Wa)};break;case Ib.DT_DATETIME:eb=new Bc;eb.setFormatString("yyyy-MM-dd HH:mm:ss");
Da=function(Wa){return null==Wa||void 0==Wa?"":eb.format(Wa)};break;default:Da=function(Wa){return null==Wa||void 0==Wa?"":Wa}}return Da}};rc.Integration=new function(){var Da={};this.addWindowResizeListener=function(oa,Ya){Da[oa]=Ya};this.removeWindowResizeListener=function(oa){delete Da[oa]};this.fireWindowResizeListener=function(){for(var oa in Da){var Ya=Da[oa];Ya&&Ya()}}};rc.CheckFieldNumUtil=new function(){var Da,oa;this.checkFieldNum=function(Wa,ea,da,zb){if(null!=oa)Ya(Wa,ea,da,zb);else{var U=
new Ha(eb(),function(wc){oa=wc;Ya(Wa,ea,da,zb)},function(wc,zc){da(!1);return!1});U.setShowBlocking(!1);U.getSelectableMaxFieldNum()}};var Ya=function(Wa,ea,da,zb){Wa=Wa<=oa;Wa||(zb=null!=zb?zb:La.get("moreThanMaxFieldNum","\u6bcf\u5f20\u6570\u636e\u8868\u6700\u591a\u5141\u8bb8\u9009\u62e9#1\u4e2a\u5b57\u6bb5\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u5b57\u6bb5\u3002"),ea.showPrompt(zb.replace("#1",oa)));da(Wa)},eb=function(){if(null==Da){Da=new Kb;var Wa=Xb.decodeParamFromUrl(window.location.search,"path");
Da.setRemoteUrl((Wa?Wa:"/ierp")+"/qing/dataModeling.do")}return Da}};var cc=new function(){var Da;this.hookCollector=function(oa){Da=oa};this.occur=function(oa,Ya,eb){try{Da&&Da(oa,Ya,eb)}catch(Wa){window.console&&console.warn(Wa)}}};cc.DM_SOURCE_TYPE="dm-source-type";cc.DM_IMPORT_TYPE="dm-import-type";cc.DM_CREATE_RELATION="dm-create-relation";cc.DM_DATA_EXTRACT_TYPE="dm-data-extract-type";cc.DM_DATA_TIMING_EXTRACT="\u5b9a\u65f6\u9884\u63d0\u53d6";cc.DM_DATA_DISPOSABLE_EXTRACT="\u5b9e\u65f6\u63d0\u53d6";
cc.DM_IMPORT_TYPE_TABLE="TABLE";cc.DM_IMPORT_TYPE_STORED_PROCEDURE="STORED_PROCEDURE";cc.DM_OPERATING_MERGE_TABLE="dm-operating-merge-table";cc.DM_OPERATING_NEW_FIELD="dm-operating-new-field";rc.UserOperationReporter=cc;rc.VariateHelperFactory=new function(){var Da={};this.getImpl=function(oa){return Da[oa]};this.getAllImpl=function(){var oa=[],Ya;for(Ya in Da)oa.push(Da[Ya]);return oa};this.registImpl=function(oa,Ya){Da[oa]=Ya}};rc.VariateHelperFactory.SYS_VAR_HELPER="sysVar";rc.VariateHelperFactory.MACRO_VAR_HELPER=
"macroVar";rc.EntityErrorStatesUtil=new function(){var Da={},oa=this;(function(){Da[ma.ERROR_STATE_FILENOTEXIST]=new Cb(ma.ERROR_STATE_FILENOTEXIST,"fileNotFound","\u6587\u4ef6\u672a\u627e\u5230");Da[ma.ERROR_STATE_TABLENOTEXIST]=new Cb(ma.ERROR_STATE_TABLENOTEXIST,"entityNotExist","\u6570\u636e\u8868\u4e0d\u5b58\u5728");Da[ma.ERROR_STATE_DB_CONN_FAILED]=new Cb(ma.ERROR_STATE_DB_CONN_FAILED,"DBConnectionInfo","\u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25");Da[ma.ERROR_STATE_OPENAPINOTEXIST]=new Cb(ma.ERROR_STATE_OPENAPINOTEXIST,
"OpenAPIInfo","OpenAPI\u7684URL\u65e0\u6548");Da[ma.ERROR_STATE_NOTEXISTUSERAUTHORITY]=new Cb(ma.ERROR_STATE_NOTEXISTUSERAUTHORITY,"SelectAuthorityInfo","\u6ca1\u6709\u8be5\u4e1a\u52a1\u5b9e\u4f53\u7684\u67e5\u770b\u6743\u9650");Da[ma.ERROR_STATE_BIZMETANOTSUPPORT]=new Cb(ma.ERROR_STATE_BIZMETANOTSUPPORT,"SupportLightAnalysisInfo","\u8be5\u5b9e\u4f53\u672a\u5f00\u542f\u201c\u652f\u6301\u8f7b\u5206\u6790\u201d\u8bbe\u7f6e\u9879");Da[ma.ERROR_STATE_NO_DB_CENTER_PERMISSION]=new Cb(ma.ERROR_STATE_NO_DB_CENTER_PERMISSION,
"noDBCenterPermission","\u6ca1\u6709\u6570\u636e\u4e2d\u5fc3\u6743\u9650\uff0c\u8bf7\u5148\u8054\u7cfb\u7ba1\u7406\u5458\u5206\u914d\u6743\u9650\u3002");Da[ma.ERROR_STATE_KSQL_NOT_SUPPORT]=new Cb(ma.ERROR_STATE_KSQL_NOT_SUPPORT,"ksqlNotSupport","\u5f53\u524d\u6570\u636e\u6e90\u4e0d\u652f\u6301\u201c\u81ea\u5b9a\u4e49KSQL\u201d\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u6570\u636e\u6e90\u3002");Da[ma.ERROR_STATE_STORED_PROCEDURE_NOT_SUPPORT]=new Cb(ma.ERROR_STATE_STORED_PROCEDURE_NOT_SUPPORT,"storedProcedureNotSupport",
"\u5f53\u524d\u6570\u636e\u6e90\u4e0d\u652f\u6301\u201c\u5b58\u50a8\u8fc7\u7a0b\u201d\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u6570\u636e\u6e90\u3002");Da[ma.ERROR_STATE_UNIONENTITY_CHILDTABLE_HAVE_PROBLEM]=new Cb(ma.ERROR_STATE_UNIONENTITY_CHILDTABLE_HAVE_PROBLEM,"childEntityHaveProblem","\u6784\u6210\u8be5\u6570\u636e\u8868\u7684\u5b50\u8868\u5b58\u5728\u5f02\u5e38\u3002");Da[ma.ERROR_STATE_SQL_EXECUTE_EXCEPTION]=new Cb(ma.ERROR_STATE_SQL_EXECUTE_EXCEPTION,"sqlExeException","\u81ea\u5b9a\u4e49SQL\u6267\u884c\u5f02\u5e38\u3002");
Da[ma.ERROR_STATE_kSQL_EXECUTE_EXCEPTION]=new Cb(ma.ERROR_STATE_kSQL_EXECUTE_EXCEPTION,"ksqlExeException","\u81ea\u5b9a\u4e49KSQL\u6267\u884c\u5f02\u5e38\u3002");Da[ma.ERROR_STATE_SP_EXECUTE_EXCEPTION]=new Cb(ma.ERROR_STATE_SP_EXECUTE_EXCEPTION,"spExeException","\u5b58\u50a8\u8fc7\u7a0b\u4e0d\u5b58\u5728\u6216\u6267\u884c\u5f02\u5e38\u3002");Da[ma.NO_QING_MODELER_LICENSE]=new Cb(ma.NO_QING_MODELER_LICENSE,"noModelerLicense","\u5f53\u524d\u7cfb\u7edf\u6ca1\u6709\u3010\u8f7b\u5efa\u6a21\u3011\u6a21\u5757\u7684\u4f7f\u7528\u8bb8\u53ef\uff0c\u8bf7\u4e0e\u7cfb\u7edf\u7ba1\u7406\u5458\u8054\u7cfb\u3002");
Da[ma.ERROR_STATE_MACRO_NOT_FOUND]=new Cb(ma.ERROR_STATE_MACRO_NOT_FOUND,"macroNotFound","\u5f53\u524d\u5b9e\u4f53\u5f15\u7528\u7684\u5b8f\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u5b8fid\u4e3a\uff1a#1\u3002",function(eb,Wa){return Wa.replace("#1",eb.getCustomInfo("MacroId"))});Da[ma.ERROR_STATE_MACRO_DB_UNSET]=new Cb(ma.ERROR_STATE_MACRO_DB_UNSET,"macroNotFound","\u5f53\u524d\u5b9e\u4f53\u5f15\u7528\u7684\u5b8f\u672a\u8bbe\u7f6e\u6570\u636e\u5e93\u8fde\u63a5\uff0c\u5b8f\u540d\u79f0\u4e3a\uff1a#1\u3002",
function(eb,Wa){return Wa.replace("#1",eb.getCustomInfo("MacroName"))});var Ya=function(eb,Wa){return Wa.replace("#1",eb.getCustomInfo("modelType"))};Da[ma.ERROR_STATE_NO_DPP_PERMISSION]=new Cb(ma.ERROR_STATE_NO_DPP_PERMISSION,"noModelerPermission","\u60a8\u6ca1\u6709\u8be5#1\u7684\u8fd0\u884c\u6743\u9650\u3002",Ya);Da[ma.ERROR_STATE_NO_DPP_ENTITY_PERMISSION]=new Cb(ma.ERROR_STATE_NO_DPP_ENTITY_PERMISSION,"noModelerEntityPermission","\u8be5#1\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u4f7f\u7528\u3002",
Ya);Da[ma.ERROR_STATE_DAMAGED_DPP_ENTITY]=new Cb(ma.ERROR_STATE_DAMAGED_DPP_ENTITY,"damagedDppEntity","\u8be5#1\u5df2\u635f\u574f\uff0c\u65e0\u6cd5\u4f7f\u7528\u3002",Ya);Ya=function(eb,Wa){return La.get("dbTableExecuteError","\u6570\u636e\u8868\u6267\u884c\u5f02\u5e38")};Da[ma.ENTITY_PARSE_EXCEPTION]=new Cb(ma.ENTITY_PARSE_EXCEPTION,"","",Ya);Da[ma.DATA_CENTER_APP_ERROR]=new Cb(ma.DATA_CENTER_APP_ERROR,"","",Ya);Da[ma.DB_CENTER_MACRO_UNAVAILABLE]=new Cb(ma.DB_CENTER_MACRO_UNAVAILABLE,"","",Ya)})();
this.getDefaultErrorDesc=function(Ya){var eb=Ya.getErrorState(),Wa=Da[eb];if(Wa)return Wa.getFormattedError(Ya);Ya=La.get("undefinePreviewError","\u9519\u8bef\u7c7b\u578b:#1,\u9519\u8bef\u63cf\u8ff0:\u672a\u5b9a\u4e49");return Ya=Ya.replace("#1",eb)};this.getDefaultErrorDescForTips=function(Ya){return!Ya.isUnion()&&Ya.getSource().isBasedOnDB()?La.get("dbTableExecuteError","\u6570\u636e\u8868\u6267\u884c\u5f02\u5e38"):oa.getDefaultErrorDesc(Ya)};this.getErrorDesc=function(Ya,eb){var Wa=Ya.getErrorState(),
ea=Da[Wa];if(ea)return eb?eb(Ya,ea.getDefaultErrDesc()):ea.getFormattedError(Ya);Ya=La.get("undefinePreviewError","\u9519\u8bef\u7c7b\u578b:#1,\u9519\u8bef\u63cf\u8ff0:\u672a\u5b9a\u4e49");return Ya=Ya.replace("#1",Wa)}};rc.VariateHelperFactory.registImpl(rc.VariateHelperFactory.SYS_VAR_HELPER,new function(){jc.call(this);var Da=this;this.switchSQLToDisplayMode=function(Ya,eb){Ya=oa(Ya,!0);if(eb)eb(Ya);else return Ya};this.switchSQLToPersistentMode=function(Ya,eb){Ya=oa(Ya,!1);if(eb)eb(Ya);else return Ya};
this.getFormatText=function(Ya){return"'"+"@%s".replace("%s",La.get(Ya.getI18nKey(),Ya.getDefaultDesc()))+"'"};this.loadVarModelAdapter=function(Ya,eb){for(var Wa,ea=0;ea<Vb.SUPPORTED_VAR_TYPE.length;ea++){var da=Vb.SUPPORTED_VAR_TYPE[ea];if(da.getTypeID()==Ya){Wa=Da.createSysVarAdapter(da);break}}if(eb)eb(Wa);else return Wa};this.createSysVarAdapter=function(Ya){Ya=new Xa(Ya);Ya.setDisplayNameFormater(function(eb){return La.get(eb.getI18nKey(),eb.getDefaultDesc())});Ya.setUserSQLFormater(function(eb){return Da.getFormatText(eb)});
return Ya};this.createSysVarAdapters=function(Ya){for(var eb=[],Wa=0,ea=Ya.length;Wa<ea;Wa++){var da=Da.createSysVarAdapter(Ya[Wa]);eb.push(da)}return eb};var oa=function(Ya,eb){if(Ya){for(var Wa=0;Wa<Vb.SUPPORTED_VAR_TYPE.length;Wa++){var ea=Vb.SUPPORTED_VAR_TYPE[Wa],da=La.get(ea.getI18nKey(),ea.getDefaultDesc()),zb=ea.getTypeID();ea="@%s".replace("%s",eb?zb:da);da="@%s".replace("%s",eb?da:zb);ea=new RegExp(ea.replace("(","\\(").replace(")","\\)"),"g");Ya=Ya.replace(ea,da)}return Ya}}});rc.ProductLineEnvironment=
new function(){var Da;this.getEnvironment=function(){return Da};this.setEnvironment=function(oa){Da=oa};this.checkEnvironment=function(oa){return oa&&Da&&Da==oa?!0:!1}};rc.ProductLineEnvironment.COSMIC="COSMIC";rc.OpenAPIAuthFactory=new function(){var Da={};this.getImpl=function(oa,Ya){if(oa=Da[oa])return new oa(Ya)};this.registImpl=function(oa,Ya){Da[oa]=Ya}};cc=rc.OpenAPIAuthFactory;cc.registImpl(Lb.BASIC,function(Da){oc.call(this,Da);var oa,Ya,eb=/^[a-zA-Z0-9_]{1,}$/;this.protectedInitUi=function(Wa){var ea=
(new Dc(La.get("userName","\u7528\u6237\u540d"))).getJqUi();Ob.layoutCtrl(ea,34,33,80,23);ea.appendTo(Wa);oa=new xb;oa.setTabindex(1);ea=oa.getJqUi();Ob.layoutCtrl(ea,100,33,170,23);ea.appendTo(Wa);ea=(new Dc(La.get("password","\u5bc6\u7801"))).getJqUi();Ob.layoutCtrl(ea,34,66,80,23);ea.appendTo(Wa);Ya=new ab;Ya.setTabindex(2);ea=Ya.getJqUi();Ob.layoutCtrl(ea,100,66,170,23);ea.appendTo(Wa)};this.protectedUpdateModelToUI=function(){oa.setText(Da.getUserName());Ya.setPassword(Uc.decode(Da.getPassword()))};
this.protectedGetModelFromUI=function(){var Wa=new hc;Wa.setUserName($.trim(oa.getText()));Wa.setPassword(Uc.encode($.trim(Ya.getPassword())));return Wa};this.protectedCheckParams=function(){return $.trim(oa.getText())?$.trim(Ya.getPassword())?$.trim(oa.getText()).match(eb)?50<$.trim(oa.getText()).length?La.get("userNameTooLong","\u7528\u6237\u540d\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002"):100<$.trim(Ya.getPassword()).length?La.get("passwordTooLong","\u5bc6\u7801\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7100\u4e2a\u5b57\u7b26\u3002"):
null:La.get("userNameNotSpecial","\u7528\u6237\u540d\u53ea\u80fd\u7531\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\u3002"):La.get("passwordNotNull","\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\u3002"):La.get("userNameNotNull","\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a\u3002")}});cc.registImpl(Lb.BEARER,function(Da){oc.call(this,Da);var oa,Ya,eb,Wa;this.protectedInitUi=function(ea){var da=new Dc(La.get("clientId","\u5ba2\u6237\u7aef\u7f16\u7801"));da.setRequired(!0);da=da.getJqUi();
da.attr("title",La.get("clientId","\u5ba2\u6237\u7aef\u7f16\u7801"));Ob.layoutCtrl(da,34,33,68,23);da.appendTo(ea);da=new Qc;da.setIconType(Qc.ICON_TYPE_QUESTION);da.setTipsText("client_id");da=da.getJqUi();da.addClass("dm-notice-icon");Ob.layoutCtrl(da,102,37,16,16);da.appendTo(ea);oa=new xb;oa.setTabindex(1);da=oa.getJqUi();Ob.layoutCtrl(da,124,33,170,23);da.appendTo(ea);da=new Dc(La.get("clientSecret","\u5ba2\u6237\u7aef\u5bc6\u94a5"));da.setRequired(!0);da=da.getJqUi();da.attr("title",La.get("clientSecret",
"\u5ba2\u6237\u7aef\u5bc6\u94a5"));Ob.layoutCtrl(da,34,66,68,23);da.appendTo(ea);da=new Qc;da.setIconType(Qc.ICON_TYPE_QUESTION);da.setTipsText("client_secret");da=da.getJqUi();da.addClass("dm-notice-icon");Ob.layoutCtrl(da,102,70,16,16);da.appendTo(ea);Ya=new ab;Ya.setTabindex(2);da=Ya.getJqUi();Ob.layoutCtrl(da,124,66,170,23);da.appendTo(ea);da=(new Dc(La.get("scope","\u6743\u9650\u8303\u56f4"))).getJqUi();da.attr("title",La.get("scope","\u6743\u9650\u8303\u56f4"));Ob.layoutCtrl(da,34,99,54,23);
da.appendTo(ea);da=new Qc;da.setIconType(Qc.ICON_TYPE_QUESTION);da.setTipsText("scope");da=da.getJqUi();da.addClass("dm-notice-icon");Ob.layoutCtrl(da,88,103,16,16);da.appendTo(ea);eb=new xb;oa.setTabindex(3);da=eb.getJqUi();Ob.layoutCtrl(da,124,99,170,23);da.appendTo(ea);da=new Dc(La.get("authURL","\u8ba4\u8bc1URL"));da.setRequired(!0);da=da.getJqUi();da.attr("title",La.get("authURL","\u8ba4\u8bc1URL"));Ob.layoutCtrl(da,34,132,57,23);da.appendTo(ea);da=new Qc;da.setIconType(Qc.ICON_TYPE_QUESTION);
da.setTipsText(La.get("tokenURL","\u83b7\u53d6access_token\u7684API\u5730\u5740"));da=da.getJqUi();da.addClass("dm-notice-icon");Ob.layoutCtrl(da,91,136,16,16);da.appendTo(ea);Wa=new xb;Wa.setTabindex(4);da=Wa.getJqUi();Ob.layoutCtrl(da,124,132,456,23);da.appendTo(ea)};this.protectedUpdateModelToUI=function(ea){oa.setText(Da.getClientId());Ya.setPassword(Uc.decode(Da.getClientSecret()));eb.setText(Da.getScope());Wa.setText(Da.getAuthURL())};this.protectedGetModelFromUI=function(){var ea=new Mb;ea.setClientId($.trim(oa.getText()));
ea.setClientSecret(Uc.encode($.trim(Ya.getPassword())));$.trim(eb.getText())&&ea.setScope($.trim(eb.getText()));ea.setAuthURL($.trim(Wa.getText()));return ea};this.protectedCheckParams=function(){return $.trim(oa.getText())?$.trim(Ya.getPassword())?$.trim(Wa.getText())?50<$.trim(oa.getText()).length?La.get("clientIdTooLong","\u5ba2\u6237\u7aef\u7f16\u7801\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002"):100<$.trim(Ya.getPassword()).length?La.get("clientSecretTooLong","\u5ba2\u6237\u7aef\u5bc6\u94a5\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7100\u4e2a\u5b57\u7b26\u3002"):
50<$.trim(eb.getText()).length?La.get("scopeTooLong","\u6743\u9650\u8303\u56f4\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002"):100<$.trim(Wa.getText()).length?La.get("authURLTooLong","\u8ba4\u8bc1URL\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7100\u4e2a\u5b57\u7b26\u3002"):null:La.get("authURLNotNull","\u8ba4\u8bc1URL\u4e0d\u80fd\u4e3a\u7a7a\u3002"):La.get("clientSecretNotNull","\u5ba2\u6237\u7aef\u5bc6\u94a5\u4e0d\u80fd\u4e3a\u7a7a\u3002"):La.get("clientIdNotNull","\u5ba2\u6237\u7aef\u7f16\u7801\u4e0d\u80fd\u4e3a\u7a7a\u3002")}});
cc.registImpl(Lb.DIGEST,function(Da){oc.call(this,Da);var oa,Ya,eb=/^[a-zA-Z0-9_]{1,}$/;this.protectedInitUi=function(Wa){var ea=(new Dc(La.get("userName","\u7528\u6237\u540d"))).getJqUi();Ob.layoutCtrl(ea,34,33,80,23);ea.appendTo(Wa);oa=new xb;oa.setTabindex(1);ea=oa.getJqUi();Ob.layoutCtrl(ea,100,33,170,23);ea.appendTo(Wa);ea=(new Dc(La.get("password","\u5bc6\u7801"))).getJqUi();Ob.layoutCtrl(ea,34,66,80,23);ea.appendTo(Wa);Ya=new ab;Ya.setTabindex(2);ea=Ya.getJqUi();Ob.layoutCtrl(ea,100,66,170,
23);ea.appendTo(Wa)};this.protectedUpdateModelToUI=function(){oa.setText(Da.getUserName());Ya.setPassword(Uc.decode(Da.getPassword()))};this.protectedGetModelFromUI=function(){var Wa=new mb;Wa.setUserName($.trim(oa.getText()));Wa.setPassword(Uc.encode($.trim(Ya.getPassword())));return Wa};this.protectedCheckParams=function(){return $.trim(oa.getText())?$.trim(Ya.getPassword())?50<$.trim(oa.getText()).length?La.get("userNameTooLong","\u7528\u6237\u540d\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002"):
$.trim(oa.getText()).match(eb)?100<$.trim(Ya.getPassword()).length?La.get("passwordTooLong","\u5bc6\u7801\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7100\u4e2a\u5b57\u7b26\u3002"):null:La.get("userNameNotSpecial","\u7528\u6237\u540d\u53ea\u80fd\u7531\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\u3002"):La.get("passwordNotNull","\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\u3002"):La.get("userNameNotNull","\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a\u3002")}});cc.registImpl(Lb.COSMIC,function(Da){function oa(T,
I){this.getTypeName=function(){return T};this.getTypeCode=function(){return I}}oc.call(this,Da);var Ya=this.protectedMethod,eb=this,Wa=Da,ea=Wa&&Wa.getTokenEnhanced(),da=rc.ProductLineEnvironment.checkEnvironment(rc.ProductLineEnvironment.COSMIC),zb,U,wc,zc,Gc,ad,lc,yc,Sc,Cc,kd=["Local","Other"],ed=["Mobile","Email","UserName"],Ec=[new oa(La.get("local","\u5f53\u524d\u7cfb\u7edf"),kd[0]),new oa(La.get("other","\u5176\u4ed6\u7cfb\u7edf"),kd[1])],l=[new oa(La.get("mobile","\u624b\u673a\u53f7"),ed[0]),
new oa(La.get("email","\u90ae\u7bb1"),ed[1]),new oa(La.get("userName","\u7528\u6237\u540d"),ed[2])];this.protectedInitUi=function(T){yc=new $b;var I=yc.getJqUi();Ob.layoutCtrl(I,34,38,23,23);I.appendTo(T);I=(new Dc(La.get("tokenEnhanced","\u589e\u5f3a\u578bToken\u8ba4\u8bc1"))).getJqUi();I.attr("title",La.get("tokenEnhanced","\u589e\u5f3a\u578bToken\u8ba4\u8bc1"));Ob.layoutCtrl(I,54,40,220,16);I.appendTo(T);yc.addCheckedListener(function(){ea!=yc.isChecked()&&(ea=yc.isChecked(),Wa=eb.protectedGetModelFromUI(),
T.empty(),Ya.addAuthSettingsJq(T),eb.protectedInitUi(T),eb.protectedUpdateModelToUI(Da))});I=new Dc(La.get("appId","\u7cfb\u7edf\u7f16\u7801"));I.setRequired(!0);I=I.getJqUi();I.attr("title",La.get("appId","\u7cfb\u7edf\u7f16\u7801"));Ob.layoutCtrl(I,34,71,57,23);I.appendTo(T);I=new Qc;I.setIconType(Qc.ICON_TYPE_QUESTION);I.setTipsText("appId");I=I.getJqUi();I.addClass("dm-notice-icon");Ob.layoutCtrl(I,91,75,16,16);I.appendTo(T);zb=new xb;zb.setTabindex(1);I=zb.getJqUi();Ob.layoutCtrl(I,124,71,170,
23);I.appendTo(T);I=new Dc(La.get("appSecret","\u8ba4\u8bc1\u5bc6\u94a5"));I.setRequired(!0);I=I.getJqUi();I.attr("title",La.get("appSecret","\u8ba4\u8bc1\u5bc6\u94a5"));Ob.layoutCtrl(I,320,71,57,23);I.appendTo(T);I=new Qc;I.setIconType(Qc.ICON_TYPE_QUESTION);I.setTipsText("appSecret");I=I.getJqUi();I.addClass("dm-notice-icon");Ob.layoutCtrl(I,377,75,16,16);I.appendTo(T);U=new ab;U.setTabindex(2);I=U.getJqUi();Ob.layoutCtrl(I,410,71,170,23);I.appendTo(T);I=B();I.appendTo(T);var S=J();S.appendTo(T);
ea?S.hide():I.hide();da?v().appendTo(T):F().appendTo(T)};var B=function(){var T=$("<div>"),I=new Dc(La.get("proxyUser","\u4ee3\u7406\u7528\u6237\u540d"));I.setRequired(!0);I=I.getJqUi();Ob.layoutCtrl(I,34,104,90,23);I.appendTo(T);Gc=new xb;I=Gc.getJqUi();Ob.layoutCtrl(I,124,104,170,23);I.appendTo(T);return T},J=function(){var T=$("<div>"),I=(new Dc(La.get("usertype","\u7528\u6237\u7c7b\u578b"))).getJqUi();I.attr("title",La.get("usertype","\u7528\u6237\u7c7b\u578b"));Ob.layoutCtrl(I,34,104,80,23);
I.appendTo(T);I=new bd;I.setItemModels(l);if(Wa&&Wa.getUserType()){var S=ed.indexOf(Wa.getUserType());I.setSelected(l[S]);Cc=Wa.getUserType()}else Cc=ed[0],I.setSelected(l[0]);I.setCustomPainter(function(cb,ub,Ea){ub.text(Ea.getTypeName())});I.addSelectedChangedListener(function(cb,ub,Ea){Cc=Ea.getTypeCode();wc.setText(Ea.getTypeName());zc.setText()});I=I.getJqUi();Ob.layoutCtrl(I,124,104,170,23);I.appendTo(T);wc=new Dc(La.get("mobile","\u624b\u673a\u53f7"));wc.setRequired(!0);I=wc.getJqUi();Ob.layoutCtrl(I,
320,104,90,23);I.appendTo(T);zc=new xb;I=zc.getJqUi();Ob.layoutCtrl(I,410,104,170,23);I.appendTo(T);return T},v=function(){var T=$("<div>"),I=(new Dc(La.get("cosmicType","\u8ba4\u8bc1\u670d\u52a1\u5668"))).getJqUi();Ob.layoutCtrl(I,34,137,80,23);I.appendTo(T);I=new bd;I.setItemModels(Ec);if(!Wa||Wa.getCosmicType()&&Wa.getCosmicType()!=kd[1])Sc=kd[0],I.setSelected(Ec[0]);else{Sc=kd[1];I.setSelected(Ec[1]);var S=F();S.appendTo(T)}I.setCustomPainter(function(cb,ub,Ea){ub.text(Ea.getTypeName())});I.addSelectedChangedListener(function(cb,
ub,Ea){Sc=Ea.getTypeCode();Sc===kd[0]?S.empty():(S=F(),S.appendTo(T))});I=I.getJqUi();Ob.layoutCtrl(I,124,137,170,23);I.appendTo(T);return T},F=function(){var T=$("<div>");var I=da?33:0;var S=(new Dc(La.get("accountid","\u6570\u636e\u4e2d\u5fc3id"))).getJqUi();S.attr("title",La.get("accountid","\u6570\u636e\u4e2d\u5fc3id"));Ob.layoutCtrl(S,34,I+137,68,23);S.appendTo(T);S=new Qc;S.setIconType(Qc.ICON_TYPE_QUESTION);S.setTipsText("accountid");S=S.getJqUi();S.addClass("dm-notice-icon");Ob.layoutCtrl(S,
102,I+141,16,16);S.appendTo(T);ad=new xb;ad.setTabindex(1);S=ad.getJqUi();Ob.layoutCtrl(S,124,I+137,170,23);S.appendTo(T);S=new Dc(La.get("serverAddress","\u670d\u52a1\u5668\u5730\u5740"));S.setRequired(!0);S=S.getJqUi();S.attr("title",La.get("serverAddress","\u670d\u52a1\u5668\u5730\u5740"));Ob.layoutCtrl(S,34,I+170,68,23);S.appendTo(T);S=new Qc;S.setIconType(Qc.ICON_TYPE_QUESTION);var cb=La.get("forExample","\u4f8b\u5982\uff1a")+"http://127.0.0.1:8080/ierp/";S.setTipsText(cb);S=S.getJqUi();S.addClass("dm-notice-icon");
Ob.layoutCtrl(S,102,I+174,16,16);S.appendTo(T);lc=new xb;S=lc.getJqUi();Ob.layoutCtrl(S,124,I+170,456,23);S.appendTo(T);return T};this.protectedUpdateModelToUI=function(){yc.setChecked(Wa.getTokenEnhanced());zb.setText(Wa.getAppId());U.setPassword(Uc.decode(Wa.getAppSecret()));lc&&(lc.setText(Wa.getCosmicServerAddress()),ad.setText(Wa.getAccountId()));if(Wa.getUserType()){for(var T=0;T<l.length;T++)if(l[T].getTypeCode()==Wa.getUserType()){wc.setText(l[T].getTypeName());break}zc.setText(Wa.getUserTypeValue())}Gc.setText(Wa.getProxyUser())};
this.protectedGetModelFromUI=function(){var T=new vc;T.setTokenEnhanced(yc.isChecked());T.setAppId($.trim(zb.getText()));T.setAppSecret(Uc.encode($.trim(U.getPassword())));T.setUserType(Cc);T.setUserTypeValue($.trim(zc.getText()));T.setProxyUser($.trim(Gc.getText()));T.setCosmicType(Sc);da&&Sc!=kd[1]||(T.setCosmicServerAddress($.trim(lc.getText())),T.setAccountId($.trim(ad.getText())));return T};this.protectedCheckParams=function(){if(!$.trim(zb.getText()))return La.get("appIdNotNull","\u7cfb\u7edf\u7f16\u7801\u4e0d\u80fd\u4e3a\u7a7a\u3002");
if(!$.trim(U.getPassword()))return La.get("appSecretNotNull","\u8ba4\u8bc1\u5bc6\u94a5\u4e0d\u80fd\u4e3a\u7a7a\u3002");if(ea&&!$.trim(Gc.getText())||!ea&&!$.trim(zc.getText()))return La.get("userInfoNotNull","\u7528\u6237\u4fe1\u606f\u4e0d\u80fd\u4e3a\u7a7a\u3002");if(!(da&&Sc!=kd[1]||$.trim(lc.getText())))return La.get("serverAddressNotNull","\u670d\u52a1\u5668\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a\u3002");if(50<$.trim(zb.getText()).length)return La.get("appIdTooLong","\u7cfb\u7edf\u7f16\u7801\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002");
if(100<$.trim(U.getPassword()).length)return La.get("appSecretTooLong","\u8ba4\u8bc1\u5bc6\u94a5\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7100\u4e2a\u5b57\u7b26\u3002");if(ea&&50<$.trim(Gc.getText()).length||!ea&&50<$.trim(zc.getText()).length)return La.get("userInfoTooLong","\u7528\u6237\u4fe1\u606f\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002");if(!da||Sc==kd[1]){if(50<$.trim(ad.getText()).length)return La.get("accountIdTooLong","\u6570\u636e\u4e2d\u5fc3id\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u3002");
if(100<$.trim(lc.getText()).length)return La.get("serverAddressTooLong","\u670d\u52a1\u5668\u5730\u5740\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7100\u4e2a\u5b57\u7b26\u3002")}return null}})})();(function(){function Ha(e,h,g,a,c){rd[e]=g;a&&(la[e]=a);var k=!0;0==c&&(k=c);var d;this.setExistSource=function(f){d=f};this.getExistSource=function(){return d};this.getName=function(){return e};this.getText=function(){return h};this.getIconName=function(){return g};this.isVisible=function(){return k}}function Kb(){ic.AbstractWizardStep.call(this);var e=this,h,g,a,c;this.setSource=function(d){h=d};this.getSource=function(){return h};this.setCtxApi=function(d){g=d};this.getCtxApi=function(){return g};
this.getJqUi=function(d){a||(c=d,a=e.protectedCreateUi());return a};this.protectedCreateUi=function(){throw Error("Override me.");};var k=function(){return c.getMessageCurtain()};this.protectedMethod={getTopJqUi:function(){return a},getMessageCurtain:k,checkConnection:function(d,f){d=d.toJsonObject();g.createFacade(function(b){f(!0)},function(b,r){f(!1);b=b.toString();return"20"==b.substr(0,2)&&7==b.length?(k().showPrompt(r),!0):!1}).checkConnection(d)},refreshDesigntimeDataObject:function(d,f){var b=
{};b[f.getName()]=f;var r=g.createFacade(function(m){var t=new nb;t.fromJsonObject(m,b);m=d.getAssociateName();null==t.getEntityByAssociateName(m)?(t=new ra,t.setErrorState(Db.AbstractEntity.ERROR_STATE_TABLENOTEXIST),d.setErrorInfo(t)):d.setErrorInfo(null);e.getCtxApi().finish(d.getName())},function(m,t){var A=Db.AbstractEntity.ERROR_STATE_TABLENOTEXIST;2020401==m?A=Db.AbstractEntity.ERROR_STATE_KSQL_NOT_SUPPORT:2020503==m?A=Db.AbstractEntity.ERROR_STATE_STORED_PROCEDURE_NOT_SUPPORT:2020501==m&&
(A=Db.AbstractEntity.ERROR_STATE_SP_EXECUTE_EXCEPTION);var E=new ra;E.setErrorState(A);d.setErrorInfo(E);e.getCtxApi().finish(d.getName());m=m.toString();return"20"==m.substr(0,2)&&7==m.length?(k().showError(t),!0):!1});r.setShowBlocking(!1);r.getDesigntimeDataObject(f.toJsonObject(),d.getAssociateName())}}}function jc(){Kb.call(this);var e=this,h=this.protectedMethod,g=Db.BizSourceTypeContext,a=[],c,k,d=[],f,b,r,m,t,A,E,M,z,H=!1,x=!1,q=!0,D=!0,G=!0,ca,y,P=!1,aa=!1,jb;this.setIsPublicSource=function(w){x=
w};this.setIsLoadUserRecentUsedSourceList=function(w){q=w};this.setIsShowFileSource=function(w){D=w};this.setIsShowOpenAPISource=function(w){G=w};this.setCustomSupportDBSource=function(w){ca=w};this.setCustomNextDbConnectStepCreator=function(w){y=w};this.setChangeSourceType=function(w){aa=w};this.setOldEntity=function(w){jb=w};this.getSubTitle=function(){return p.get("selectDataSource","\u9009\u62e9\u6570\u636e\u6e90")};this.setDataSourceDisabled=function(w){P=w};this.protectedCreateUi=function(){var w=
$("<div>");w.addClass("dm-source-type-main");q||w.addClass("dm-source-type-main-without-recent");var N=g.getSourceTypes();if(x){if(N&&0<N.length){for(var qa=[],Ma=0;Ma<N.length;Ma++){var Hb=N[Ma],Rb=Hb.getName();Rb=Ha.createBizMetaSource(Rb);Rb.isPublic()&&qa.push(Hb)}qa&&0<qa.length&&a.push(C(qa,g.getTitle(),w))}}else if(N&&0<N.length)if(e.isUsedForMerge()||aa)if(e.isUsedForMerge()){qa=[];for(Ma=0;Ma<N.length;Ma++)Hb=N[Ma],Rb=Hb.getName(),(Rb=Ha.createBizMetaSource(Rb))&&Rb.supportMergeTable()&&
Rb.getMergeType()==Ta.COMMON_MERGE&&qa.push(Hb);qa&&0<qa.length&&a.push(C(qa,g.getTitle(),w))}else{qa=[];for(Ma=0;Ma<N.length;Ma++)Hb=N[Ma],Rb=Hb.getName(),"SuperQuery"!=Rb&&(Rb=Ha.createBizMetaSource(Rb),jb.getSource().isModifiable()&&Rb&&(Rb.isModifiable()||Rb.isShowChangeSourceTypeButtonInMenu())&&qa.push(Hb));qa&&0<qa.length&&a.push(C(qa,g.getTitle(),w))}else a.push(C(N,g.getTitle(),w));N=ca?ca.length:Ha.DB_SOURCES.length;N=(q?88*Math.ceil(N/5)+26:88*Math.ceil(N/7)+26)+"px";Ma=ca?ca:Ha.DB_SOURCES;
P?(D&&a.push(C(Ha.FILE_SOURCES,p.get("file","\u6587\u4ef6"),w,!1,"114px")),a.push(C(Ma,p.get("database","\u6570\u636e\u5e93"),w,!1,N,!0)),G&&a.push(C(Ha.OPENAPI_SOURCES,p.get("OpenAPI","OpenAPI"),w,!1,"114px",!0))):(a.push(C(Ma,p.get("database","\u6570\u636e\u5e93"),w,!1,N)),D&&a.push(C(Ha.FILE_SOURCES,p.get("file","\u6587\u4ef6"),w)),G&&a.push(C(Ha.OPENAPI_SOURCES,p.get("OpenAPI","OpenAPI"),w)));N=$("<div>");N.append(w);if(q){E=$("<div>");E.addClass("dm-source-type-exist");Ma=db(d);w=[];if(jb&&!jb.getSource().isModifiable())for(var Ic in Ma)Ma[Ic].getExistSource().isModifiable()&&
w.push(Ma[Ic]);else w=Ma;0<w.length&&(Ic=86*w.length+40+"px",a.push(C(w,p.get("currentUsed","\u5f53\u524d\u4f7f\u7528"),E,!1,Ic)));N.append(E);Qb()}return N};var Qb=function(){var w=za(),N=A(function(qa){var Ma=new ac;e.setUserRecentUsedSources(Ma.getSourcesArr(qa.sources));Ma=db(f);var Hb=[];if(jb&&!jb.getSource().isModifiable())for(var Rb in Ma)Ma[Rb].getExistSource().isModifiable()&&Hb.push(Ma[Rb]);else Hb=Ma;if(0<Hb.length){var Ic=86*Hb.length+40+"px";a.push(C(Hb,p.get("recentlyUsed","\u6700\u8fd1\u4f7f\u7528"),
E,!1,Ic))}else 0==d.length?a.push(C(null,p.get("currentUsed","\u5f53\u524d\u4f7f\u7528"),E,!1,40)):0==Hb.length&&a.push(C(null,p.get("recentlyUsed","\u6700\u8fd1\u4f7f\u7528"),E,!1,40));qa.showMoreFlag&&4<=Hb.length&&(qa=new Gb,qa.setText(p.get("showMore","\u5c55\u793a\u66f4\u591a")),qa.addActionListener(wa),z=qa.getJqUi(),n.layoutCtrlWithLRTB(z,null,0,80,Ic+40,null,23),z.appendTo(E))},function(qa,Ma){return!1});N.setShowBlocking(!1);N.loadUserRecentUsedSourceList(w,!1)},za=function(){var w=[],N=
db(d);Na(w,N);N=db(f);Na(w,N);return w},Na=function(w,N){for(var qa=0;qa<N.length;qa++){var Ma=N[qa].getExistSource().toJsonObject();w.push(Ma)}},wa=function(){z.hide();if(void 0==b){var w=za(),N=A(function(qa){var Ma=new ac;Ma=db(Ma.getSourcesArr(qa.sources));e.setMoreUserRecentUsedSources(Ma);qa=86*Ma.length+40+"px";M=$("<div>");M.css("margin-top","-40px");a.push(C(Ma,null,M,!1,qa));Ma=new Gb;Ma.setText(p.get("collapseHierachy","\u6536\u8d77"));Ma.addActionListener(Ca);Ma=Ma.getJqUi();n.layoutCtrlWithLRTB(Ma,
null,0,80,qa+30,null,23);Ma.appendTo(M);M.appendTo(E)},function(qa,Ma){return!1});N.setShowBlocking(!1);N.loadUserRecentUsedSourceList(w,!0)}else M.show()},Ca=function(){M.hide();z.show()},db=function(w){w=w?w:[];for(var N=[],qa=0;qa<w.length;qa++){var Ma=w[qa];if(!aa||Ma.isModifiable())if(!e.isUsedForMerge()||Ma.supportMergeTable()&&Ma.getMergeType()==Ta.COMMON_MERGE){var Hb=Ma.getTypeName(),Rb=Ma.getShortDisplay();Ma instanceof ja&&(Ma.getDbType()==ja.TYPE_SQLITE||Ma.getDbType()==ja.TYPE_ACCESS)&&
(Rb=Ma.getDbName());Ma instanceof bc&&(Hb="OpenAPI",Rb=Ga.decode(Rb));var Ic=Ha.getIconName(Hb);Hb=new Ha(Hb,Rb,Ic);Hb.setExistSource(Ma);N.push(Hb)}}return N};this.prepareStep=function(w){for(var N=0;N<w.length;N++)w[N].setCtxApi(e.getCtxApi())};this.intoThisStep=function(w,N){N||e.setCtxApi({createFacade:A,isEntityNameExist:m,isEntityAliasExist:t,finish:r,isFinished:u,refreshFinishFlag:na})};var na=function(){H=!0},u=function(){return H},L=function(){if(x&&y){var w=c.getName(),N=Ha.createBizMetaSource(w);
N.setTypeName(w);return y(N)}return g.getStepProvider()(c,h.getMessageCurtain(),e.isUsedForMerge(),aa,jb,k)};this.outThisStep=function(w,N){if(c){if(aa&&jb&&(w=Ka())){h.getMessageCurtain().showPrompt(w);N(e);return}w=g.getMutexChecker();var qa=!1;!x&&w&&(qa=w(k,c,h.getMessageCurtain()));qa?N(e):g.getSourceTypes()&&K(g.getSourceTypes())?(w=g.getPermissionChecker())?w(c.getName(),h.getMessageCurtain(),function(){var Ma=L();Ma?(e.prepareStep(Ma),N(Ma)):N(e)},function(){N(e)}):(w=L())?(e.prepareStep(w),
N(w)):N(e):K(Ha.DB_SOURCES)?(w=c.getExistSource(),w||(w=new ja,w.setName("s"+(new Date).getTime()),w.setDbType(c.getName())),w=e.createNextDbConnectStep(w,jb),N([w])):K(Ha.FILE_SOURCES)?(w=c.getExistSource())?aa?(w=e.createNextFileConnectStep(w,jb),N([w])):(w=e.createNextSelectTableSteps(w),N(w)):(w=c.getName()==gb.TYPE_EXCEL?new vb:c.getName()==gb.TYPE_XML?new Zb:new rb,w.setName("s"+(new Date).getTime()),w.setFileType(c.getName()),w=e.createNextFileConnectStep(w,jb),N([w])):xa(Ha.OPENAPI_SOURCES)&&
((w=c.getExistSource())?aa?(w=e.createNextOpenAPIConnectStep(w,jb),N([w])):(w=e.createNextSelectTableSteps(w),N(w)):(w=new bc,w.setName("s"+(new Date).getTime()),w=e.createNextOpenAPIConnectStep(w,jb),N([w])))}else h.getMessageCurtain().showPrompt(p.get("selectADataSource","\u8bf7\u9009\u4e2d\u4e00\u9879\u6570\u636e\u6e90\u3002")),N(e)};this.createNextFileConnectStep=function(w,N){var qa=new ed;qa.setSource(w);qa.setCtxApi(e.getCtxApi());qa.setChangeSourceType(aa);qa.setOldEntity(N);qa.setDModel(k);
return qa};this.createNextOpenAPIConnectStep=function(w,N){var qa=new Ec;qa.setSource(w);qa.setCtxApi(e.getCtxApi());qa.setChangeSourceType(aa);qa.setOldEntity(N);qa.setDModel(k);return qa};this.createNextSelectTableSteps=function(w){var N=new zb;N.setCtxApi(e.getCtxApi());N.setSource(w);var qa=new zc;qa.setCtxApi(e.getCtxApi());qa.setSource(w);return[N,qa]};this.createNextDbConnectStep=function(w,N){if(x&&y)return y(w);var qa=new da;qa.setSource(w);qa.setCtxApi(e.getCtxApi());qa.setChangeSourceType(aa);
qa.setOldEntity(N);qa.setDModel(k);return qa};this.isUsedForMerge=function(){return!1};this.setDModel=function(w){k=w;d=w.getSources()};this.setUserRecentUsedSources=function(w){f=w};this.setMoreUserRecentUsedSources=function(w){b=w};this.setFinishedCallback=function(w){r=w};this.setEntityExistChecker=function(w,N){m=w;t=N};this.setFacadeCreator=function(w){A=w};var C=function(w,N,qa,Ma,Hb,Rb){Ma?Ma=qa:(Ma=$("<div>"),Ma.addClass("dm-source-type-typelist"),Hb&&Ma.css("height",Hb),Ma.appendTo(qa));
if(null!=N){qa=$("<div>");qa.addClass("dm-source-type-typelist-title");qa.text(N);if(Rb){N=$("<div>");var Ic=x?p.get("modelerDisabledTypeList","\uff08\u5f53\u524d\u8f7b\u5efa\u6a21\u8bb8\u53ef\u6a21\u5f0f\u4e0b\uff0c\u4ee5\u4e0b\u6570\u636e\u6e90\u7c7b\u578b\u4e0d\u53ef\u7528\uff09"):p.get("disabledTypeList","\uff08\u5f53\u524d\u8f7b\u5206\u6790\u8bb8\u53ef\u6a21\u5f0f\u4e0b\uff0c\u4ee5\u4e0b\u6570\u636e\u6e90\u7c7b\u578b\u4e0d\u53ef\u7528\uff09");N.text(Ic);N.addClass("dm-source-type-typelist-title-prompt");
N.appendTo(qa)}qa.appendTo(Ma)}N=new sc;N.setItemModels(w);N.setBorderVisible(!1);N.setCustomItemPainter(Q);N.setCustomSelectedsPainter(fa);w=N.getJqUi();w.addClass("dm-source-type-typelist-list");w.appendTo(Ma);Rb&&(Rb=$("<div>"),x&&Rb.css("width","100%"),Rb.addClass("dm-source-type-typelist-list-disabled"),Rb.css("height",parseInt(Hb)-26-8),Rb.appendTo(w));N.addPressedListener(R);return N},Q=function(w,N){N.isVisible()||w.hide();w.attr("title",N.getText());w.addClass("dm-source-type-typelist-item");
var qa=$("<div>");qa.addClass("dm-source-type-typelist-item-icon");Bb.background(qa,N.getIconName());qa.appendTo(w);qa=$("<div>");qa.addClass("dm-source-type-typelist-item-text");qa.text(N.getText());qa.appendTo(w)},fa=function(w,N){for(var qa=0;qa<w.length;qa++){var Ma=w[qa];Ma.removeClass("dm-source-type-typelist-item_selected");Ma.find(".dm-source-type-typelist-item_selected-mark").remove();Ma.find(".dm-source-type-typelist-item_selected-icon").remove()}for(qa=0;qa<N.length;qa++)Ma=N[qa],Ma.addClass("dm-source-type-typelist-item_selected"),
w=$("<div>"),w.addClass("dm-source-type-typelist-item_selected-mark"),w.appendTo(Ma),w=$("<div>"),Bb.background(w,"checked"),w.addClass("dm-source-type-typelist-item_selected-icon"),w.appendTo(Ma)},R=function(w,N){for(N=0;N<a.length;N++)a[N]!=w&&a[N].setSelecteds([]);w=w.getSelecteds();c=0<w.length?w[0]:null},K=function(w){for(var N=0;N<w.length;N++)if(c.getName()==w[N].getName())return!0;return!1},xa=function(w){for(var N=0;N<w.length;N++)if(c.getName()==w[N].getName()||"RESTFUL_DATA_SET"==c.getName()||
"PROGRAM_DATA_SET"==c.getName())return!0;return!1},Ka=function(){if(jb&&!jb.isUnion()){var w=c.getName();w=(new Nc).getSupportState(jb,w);if(!w.isSupport()){var N=p.get("selectedSourceDoNotSupport","\u5f53\u524d\u9009\u62e9\u7684\u6570\u636e\u6e90\u4e0d\u652f\u6301\u201c#1\u201d\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");switch(w.getUnsupportedType()){case Za.UNSUPPORTED_TYPE_SQL:var qa=p.get("customSql","\u81ea\u5b9a\u4e49")+ja.SQLTYPE_SQL;break;case Za.UNSUPPORTED_TYPE_KSQL:qa=p.get("customSql",
"\u81ea\u5b9a\u4e49")+ja.SQLTYPE_KSQL;break;case Za.UNSUPPORTED_TYPE_STOREPROCEDURE:qa=p.get("storedProcedure","\u5b58\u50a8\u8fc7\u7a0b")}if(qa)return N.replace("#1",qa)}}}}function Cb(){var e=this,h,g,a,c,k,d,f=0,b=36,r,m=0,t=3,A=[],E=[];this.getJqUi=function(y){h||(h=$("<div>"),x(h,y),e.protectedInitExtendUi(h),a.setText(g.getUserName()),c.setPassword(g.getPassword()),q());return h};this.setSource=function(y){g=y};this.getSource=function(){return g};this.collectSource=function(){var y=$.trim(a.getText()),
P=$.trim(c.getPassword());g.setUserName(y);g.setPassword(P);g.setDbName("");e.protectedCollectExtendSource(g);return g};this.setDownOffset=function(y){f=y};this.getDownOffset=function(){return f};this.setDbConfigRowCount=function(y){t=y};this.getDbConfigRowCount=function(){return t};this.getCurrentHight=function(){return m};this.setDownSpace=function(y){b=y};this.getDownSpace=function(){return b};this.setCtxApi=function(y){d=y};this.getCtxApi=function(){return d};this.getDbNameList=function(){return r};
this.addSuccessCallbackListener=function(y){A.push(y)};var M=function(y){for(var P=0;P<A.length;P++)(0,A[P])(y)};this.addErrorCallbackListener=function(y){E.push(y)};var z=function(y){for(var P=0;P<E.length;P++)(0,E[P])(y)};this.protectedCollectExtendSource=function(y){throw Error("Override me.");};this.protectedInitExtendUi=function(){throw Error("Override me.");};this.protectedIsTextFieldNotNull=function(){throw Error("Override me.");};this.checkTextFields=function(){return null};this.protectedConnectDb=
function(){throw Error("Override me.");};var H=function(y){return Ha.DB_SOURCES.concat(Ha.FILE_SOURCES).filter(function(P){if(P.getName()==y)return P})[0]},x=function(y,P){y.addClass("dm-source-db-table-connection");var aa=new ba;aa.setText(H(g.getDbType()).getText());var jb=new ba(p.get("loginInfo","\u670d\u52a1\u5668\u767b\u5f55\u4fe1\u606f\uff1a")),Qb=new ba(p.get("userName","\u7528\u6237\u540d"));a=new Ra;a.setTabindex(4);var za=new ba(p.get("password","\u5bc6\u7801"));c=new Sb;c.setTabindex(5);
aa=aa.getJqUi();aa.css("font-size","14px");jb=jb.getJqUi();jb.attr("title",p.get("loginInfo","\u670d\u52a1\u5668\u767b\u5f55\u4fe1\u606f\uff1a"));Qb=Qb.getJqUi();Qb.attr("title",p.get("userName","\u7528\u6237\u540d"));var Na=a.getJqUi();za=za.getJqUi();var wa=c.getJqUi(),Ca=new ib;Ca.setFontSize(12,"Microsoft YaHei");Ca=Ca.measureWidth(p.get("connecting","\u8fde\u63a5\u4e2d..."));k=$("<div>");k.text(p.get("connect","\u8fde\u63a5"));k.addClass("dm-source-db-table-connection-btn");k.css("line-height",
"23px");n.layoutCtrl(aa,0,0,200,23);n.layoutCtrl(jb,20,b*t+f,300,23);n.layoutCtrl(Qb,20,b*(t+1)+f,70,23);n.layoutCtrl(Na,105,b*(t+1)+f,200,23);n.layoutCtrl(za,20,b*(t+2)+f,70,23);n.layoutCtrl(wa,105,b*(t+2)+f,200,23);n.layoutCtrl(k,20,b*(t+3)+f,Ca+10,23);m=b*(t+3)+f;y.append(aa);P||(y.append(jb),y.append(Qb),y.append(Na),y.append(za),y.append(wa),y.append(k));Na.on("input",function(db){q()})},q=function(){var y=e.protectedIsTextFieldNotNull();if(a){var P=$.trim(a.getText());y=-1==y?y:P&&y}D(y)},D=
function(y){k.off("mousedown",G);y?(k.addClass("dm-source-db-table-connection-btn-enable"),k.on("mousedown",G)):k.removeClass("dm-source-db-table-connection-btn-enable")},G=function(){e.collectSource();e.protectedConnectDb()},ca=function(y,P){var aa=(new Date).getTime();setTimeout(P,1E3>aa-y?1E3:0)};this.protectedMethod={getDatabaseNameList:function(){if(0<g.getDbAddress().indexOf(" "))z(p.get("IPAddressError","\u670d\u52a1\u5668\u5730\u5740\u4e0d\u6b63\u786e\u3002"));else{D(!1);k.text(p.get("connecting",
"\u8fde\u63a5\u4e2d..."));var y=(new Date).getTime(),P=g.toJsonObject();d.createFacade(function(aa){r=aa;ca(y,function(){M(p.get("connectionSuccessful","\u8fde\u63a5\u6210\u529f\u3002"));D(!0);k.text(p.get("connect","\u8fde\u63a5"))})},function(aa,jb){2020105==aa&&(jb=p.get("unsupportedJDKVersion","\u5f53\u524dJDB\u7248\u672c\u4e0d\u652f\u6301\uff0c\u8bf7\u5347\u7ea7\u5230JDK1.8\u7248\u672c\u3002"));ca(y,function(){z(jb);D(!0);k.text(p.get("connect","\u8fde\u63a5"))});aa=aa.toString();return"20"==
aa.substr(0,2)&&7==aa.length}).getDatabaseNameList(P)}},checkConnection:function(){if(0<g.getDbAddress().indexOf(" "))z(p.get("IPAddressError","\u670d\u52a1\u5668\u5730\u5740\u4e0d\u6b63\u786e\u3002"));else{D(!1);k.text(p.get("connecting","\u8fde\u63a5\u4e2d..."));var y=(new Date).getTime(),P=g.toJsonObject();d.createFacade(function(aa){ca(y,function(){aa&&M(p.get("connectionSuccessful","\u8fde\u63a5\u6210\u529f\u3002"));!aa&&z();D(!0);k.text(p.get("connect","\u8fde\u63a5"))})},function(aa,jb){2020105==
aa&&(jb=p.get("unsupportedJDKVersion","\u5f53\u524dJDB\u7248\u672c\u4e0d\u652f\u6301\uff0c\u8bf7\u5347\u7ea7\u5230JDK1.8\u7248\u672c\u3002"));ca(y,function(){z(jb);D(!0);k.text(p.get("connect","\u8fde\u63a5"))});aa=aa.toString();return"20"==aa.substr(0,2)&&7==aa.length}).checkConnection(P)}},checkTextFieldInput:q,fireSuccessCallbackEvent:M,fireErrorCallbackEvent:z}}function oc(){Cb.call(this);var e=this.protectedMethod,h=this,g,a;this.protectedGetDefaultPort=function(){return"3306"};this.protectedInitExtendUi=
function(c){var k=h.getDownSpace(),d=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));g=new Ra;g.setTabindex(1);var f=new ba(p.get("port","\u7aef\u53e3"));a=new Ra;a.setTabindex(2);var b=h.getSource().getDbPort();a.setText(b?b:h.protectedGetDefaultPort());g.setText(h.getSource().getDbAddress());d=d.getJqUi();b=g.getJqUi();f=f.getJqUi();var r=a.getJqUi();n.layoutCtrl(d,20,k,70,23);n.layoutCtrl(b,105,k,200,23);n.layoutCtrl(f,20,2*k,70,23);n.layoutCtrl(r,105,2*k,200,23);c.append(d);c.append(b);c.append(f);
c.append(r);b.on("input",function(m){e.checkTextFieldInput()});r.on("input",function(m){e.checkTextFieldInput()})};this.protectedCollectExtendSource=function(c){var k=$.trim(g.getText()),d=$.trim(a.getText());c.setDbAddress(k);c.setDbPort(d)};this.protectedConnectDb=function(){e.getDatabaseNameList()};this.protectedIsTextFieldNotNull=function(){return $.trim(g.getText())&&$.trim(a.getText())}}function rc(){Cb.call(this);var e=this.protectedMethod,h=this,g,a;this.protectedInitExtendUi=function(c){var k=
h.getDownSpace(),d=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));g=new Ra;g.setTabindex(1);var f=new ba(p.get("ProjectName","\u9879\u76ee\u540d\u79f0"));a=new Ra;a.setTabindex(2);var b=h.getSource().getDbName();a.setText(b?b:"");b=h.getSource().getDbAddress();g.setText(b?b:"https://service.odps.aliyun.com/api");d=d.getJqUi();b=g.getJqUi();f=f.getJqUi();var r=a.getJqUi();n.layoutCtrl(d,20,k,70,23);n.layoutCtrl(b,105,k,200,23);n.layoutCtrl(f,20,2*k,80,23);n.layoutCtrl(r,105,2*k,200,23);c.append(d);
c.append(b);c.append(f);c.append(r);b.on("input",function(m){e.checkTextFieldInput()});r.on("input",function(m){e.checkTextFieldInput()})};this.protectedCollectExtendSource=function(c){var k=$.trim(g.getText()),d=$.trim(a.getText());c.setDbAddress(k);c.setDbName(d)};this.protectedConnectDb=function(){e.checkConnection()};this.protectedIsTextFieldNotNull=function(){return $.trim(g.getText())&&$.trim(a.getText())}}function Kc(){Cb.call(this);this.setDbConfigRowCount(3);var e=this.protectedMethod,h=
this,g,a,c,k;this.protectedInitExtendUi=function(d){var f=h.getDownSpace(),b=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));g=new Ra;g.setTabindex(1);var r=new ba(p.get("port","\u7aef\u53e3"));c=new Ra;c.setTabindex(2);k=new ba(p.get("database","\u6570\u636e\u5e93"));a=new Ra;a.setTabindex(3);g.setText(h.getSource().getDbAddress());var m=h.getSource().getDbPort();c.setText(m?m:"1688");a.setText(h.getSource().getDbName());b=b.getJqUi();m=g.getJqUi();r=r.getJqUi();var t=c.getJqUi(),A=k.getJqUi(),E=
a.getJqUi();n.layoutCtrl(b,20,f,70,23);n.layoutCtrl(m,105,f,200,23);n.layoutCtrl(r,20,2*f,70,23);n.layoutCtrl(t,105,2*f,200,23);n.layoutCtrl(A,20,3*f,80,23);n.layoutCtrl(E,105,3*f,200,23);d.append(b);d.append(m);d.append(r);d.append(t);d.append(A);d.append(E);m.on("input",function(M){e.checkTextFieldInput()});t.on("input",function(M){e.checkTextFieldInput()});E.on("input",function(M){e.checkTextFieldInput()})};this.protectedCollectExtendSource=function(d){var f=$.trim(g.getText()),b=$.trim(c.getText()),
r=$.trim(a.getText());d.setDbAddress(f);d.setDbPort(b);d.setDbName(r)};this.protectedConnectDb=function(){e.checkConnection()};this.protectedIsTextFieldNotNull=function(){return $.trim(g.getText())&&$.trim(c.getText())&&$.trim(a.getText())}}function Bc(){Cb.call(this);this.setDbConfigRowCount(4);var e=this.protectedMethod,h=this,g,a,c,k,d;this.protectedInitExtendUi=function(f){var b=h.getDownSpace(),r=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));g=new Ra;g.setTabindex(1);var m=new ba(p.get("port",
"\u7aef\u53e3"));c=new Ra;c.setTabindex(2);var t=new ba(p.get("connectType","\u8fde\u63a5\u7c7b\u578b"));k=new tb;k.setItemModels(["SID","Server Name"]);k.addSelectedChangedListener(this.modeSelectEvent);h.getSource().getConnectType()?(k.setSelected("Server Name"),d=new ba(p.get("serverName","\u5b9e\u4f8b\u540d"))):(k.setSelected("SID"),d=new ba("SID"));a=new Ra;a.setTabindex(3);g.setText(h.getSource().getDbAddress());var A=h.getSource().getDbPort(),E=h.getSource().getDbName();c.setText(A?A:"1521");
a.setText(E?E:"ORCL");r=r.getJqUi();A=g.getJqUi();m=m.getJqUi();E=c.getJqUi();t=t.getJqUi();t.attr("title",p.get("connectType","\u8fde\u63a5\u7c7b\u578b"));var M=k.getJqUi(),z=d.getJqUi(),H=a.getJqUi();n.layoutCtrl(r,20,b,70,23);n.layoutCtrl(A,105,b,200,23);n.layoutCtrl(m,20,2*b,70,23);n.layoutCtrl(E,105,2*b,200,23);n.layoutCtrl(t,20,3*b,70,23);n.layoutCtrl(M,105,3*b,200,23);n.layoutCtrl(z,20,4*b,80,23);n.layoutCtrl(H,105,4*b,200,23);f.append(r);f.append(A);f.append(m);f.append(E);f.append(t);f.append(M);
f.append(z);f.append(H);A.on("input",function(x){e.checkTextFieldInput()});E.on("input",function(x){e.checkTextFieldInput()});H.on("input",function(x){e.checkTextFieldInput()})};this.modeSelectEvent=function(f,b,r){0==r.localeCompare("Server Name")?d.setText(p.get("serverName","\u5b9e\u4f8b\u540d")):d.setText("SID")};this.protectedCollectExtendSource=function(f){var b=$.trim(g.getText()),r=$.trim(c.getText()),m=$.trim(a.getText()),t=k.getSelected();f.setDbAddress(b);f.setDbPort(r);f.setDbName(m);
f.setConnectType(t)};this.protectedConnectDb=function(){e.checkConnection()};this.protectedIsTextFieldNotNull=function(){return $.trim(g.getText())&&$.trim(c.getText())&&$.trim(a.getText())}}function uc(){Cb.call(this);var e=this.protectedMethod,h=this,g,a;this.protectedInitExtendUi=function(c){var k=h.getDownSpace(),d=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));g=new Ra;g.setTabindex(1);var f=new ba(p.get("port","\u7aef\u53e3"));a=new Ra;a.setTabindex(2);g.setText(h.getSource().getDbAddress());
var b=h.getSource().getDbPort();a.setText(b?b:"1433");d=d.getJqUi();b=g.getJqUi();f=f.getJqUi();var r=a.getJqUi();n.layoutCtrl(d,20,k,70,23);n.layoutCtrl(b,105,k,200,23);n.layoutCtrl(f,20,2*k,70,23);n.layoutCtrl(r,105,2*k,200,23);c.append(d);c.append(b);c.append(f);c.append(r);b.on("input",function(m){e.checkTextFieldInput()});r.on("input",function(m){e.checkTextFieldInput()})};this.protectedCollectExtendSource=function(c){var k=$.trim(g.getText()),d=$.trim(a.getText());c.setDbAddress(k);c.setDbPort(d)};
this.protectedConnectDb=function(){e.getDatabaseNameList()};this.protectedIsTextFieldNotNull=function(){return $.trim(g.getText())&&$.trim(a.getText())};this.checkTextFields=function(){var c=$.trim(g.getText()),k=$.trim(a.getText());if(""===c)return p.get("dbAddress","\u670d\u52a1\u5668\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a");if(""===k)return p.get("dbPortNotNull","\u7aef\u53e3\u4e0d\u80fd\u4e3a\u7a7a")}}function Wb(){La.call(this);this.getDefaultPort=function(){return 5E3}}function tc(){La.call(this);
this.getDefaultPort=function(){return 2638}}function La(){Cb.call(this);var e=this.protectedMethod,h=this,g,a;this.getDefaultPort=function(){throw new error("override me");};this.protectedInitExtendUi=function(c){var k=h.getDownSpace(),d=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));g=new Ra;g.setTabindex(1);var f=new ba(p.get("port","\u7aef\u53e3"));a=new Ra;a.setTabindex(2);g.setText(h.getSource().getDbAddress());var b=h.getSource().getDbPort();a.setText(b?b:h.getDefaultPort());d=d.getJqUi();
b=g.getJqUi();f=f.getJqUi();var r=a.getJqUi();n.layoutCtrl(d,20,k,70,23);n.layoutCtrl(b,105,k,200,23);n.layoutCtrl(f,20,2*k,70,23);n.layoutCtrl(r,105,2*k,200,23);c.append(d);c.append(b);c.append(f);c.append(r);b.on("input",function(m){e.checkTextFieldInput()});r.on("input",function(m){e.checkTextFieldInput()})};this.protectedCollectExtendSource=function(c){var k=$.trim(g.getText()),d=$.trim(a.getText());c.setDbAddress(k);c.setDbPort(d)};this.protectedConnectDb=function(){e.getDatabaseNameList()};
this.protectedIsTextFieldNotNull=function(){return $.trim(g.getText())&&$.trim(a.getText())}}function Eb(){Cb.call(this);var e=this.protectedMethod,h=this,g,a;this.protectedInitExtendUi=function(c){var k=h.getDownSpace(),d=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));g=new Ra;g.setTabindex(1);var f=new ba(p.get("port","\u7aef\u53e3"));a=new Ra;a.setTabindex(2);var b=new ba(p.get("database","\u6570\u636e\u5e93"));_oInitDbNameTextField=new Ra;_oInitDbNameTextField.setTabindex(3);g.setText(h.getSource().getDbAddress());
var r=h.getSource().getDbPort(),m=h.getSource().getDbName();a.setText(r?r:"5439");_oInitDbNameTextField.setText(m?m:"");d=d.getJqUi();r=g.getJqUi();f=f.getJqUi();m=a.getJqUi();b=b.getJqUi();var t=_oInitDbNameTextField.getJqUi();n.layoutCtrl(d,20,k,70,23);n.layoutCtrl(r,105,k,200,23);n.layoutCtrl(f,20,2*k,70,23);n.layoutCtrl(m,105,2*k,200,23);n.layoutCtrl(b,20,3*k,80,23);n.layoutCtrl(t,105,3*k,200,23);c.append(d);c.append(r);c.append(f);c.append(m);c.append(b);c.append(t);r.on("input",function(A){e.checkTextFieldInput()});
m.on("input",function(A){e.checkTextFieldInput()});t.on("input",function(A){e.checkTextFieldInput()})};this.protectedCollectExtendSource=function(c){var k=$.trim(g.getText()),d=$.trim(a.getText()),f=$.trim(_oInitDbNameTextField.getText());c.setDbAddress(k);c.setDbPort(d);c.setDbName(f)};this.protectedConnectDb=function(){e.getDatabaseNameList()};this.protectedIsTextFieldNotNull=function(){return $.trim(g.getText())&&$.trim(a.getText())&&$.trim(_oInitDbNameTextField.getText())};this.checkTextFields=
function(){var c=$.trim(g.getText()),k=$.trim(a.getText());if(""===c)return p.get("dbAddress","\u670d\u52a1\u5668\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a");if(""===k)return p.get("dbPortNotNull","\u7aef\u53e3\u4e0d\u80fd\u4e3a\u7a7a")}}function xb(){Cb.call(this);var e=this.protectedMethod,h=this,g,a;this.protectedInitExtendUi=function(c){var k=h.getDownSpace(),d=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));g=new Ra;g.setTabindex(1);var f=new ba(p.get("port","\u7aef\u53e3"));a=new Ra;a.setTabindex(2);
var b=h.getSource().getDbPort();a.setText(b?b:"4000");g.setText(h.getSource().getDbAddress());d=d.getJqUi();b=g.getJqUi();f=f.getJqUi();var r=a.getJqUi();n.layoutCtrl(d,20,k,70,23);n.layoutCtrl(b,105,k,200,23);n.layoutCtrl(f,20,2*k,70,23);n.layoutCtrl(r,105,2*k,200,23);c.append(d);c.append(b);c.append(f);c.append(r);b.on("input",function(m){e.checkTextFieldInput()});r.on("input",function(m){e.checkTextFieldInput()})};this.protectedCollectExtendSource=function(c){var k=$.trim(g.getText()),d=$.trim(a.getText());
c.setDbAddress(k);c.setDbPort(d)};this.protectedConnectDb=function(){e.getDatabaseNameList()};this.protectedIsTextFieldNotNull=function(){return $.trim(g.getText())&&$.trim(a.getText())}}function ab(){Cb.call(this);var e=this.protectedMethod,h=this,g,a;this.protectedInitExtendUi=function(c){var k=h.getDownSpace(),d=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));g=new Ra;g.setTabindex(1);var f=new ba(p.get("port","\u7aef\u53e3"));a=new Ra;a.setTabindex(2);var b=h.getSource().getDbPort();a.setText(b?
b:"5236");g.setText(h.getSource().getDbAddress());d=d.getJqUi();b=g.getJqUi();f=f.getJqUi();var r=a.getJqUi();n.layoutCtrl(d,20,k,70,23);n.layoutCtrl(b,105,k,200,23);n.layoutCtrl(f,20,2*k,70,23);n.layoutCtrl(r,105,2*k,200,23);c.append(d);c.append(b);c.append(f);c.append(r);b.on("input",function(m){e.checkTextFieldInput()});r.on("input",function(m){e.checkTextFieldInput()})};this.protectedCollectExtendSource=function(c){var k=$.trim(g.getText()),d=$.trim(a.getText());c.setDbAddress(k);c.setDbPort(d)};
this.protectedConnectDb=function(){e.getDatabaseNameList()};this.protectedIsTextFieldNotNull=function(){return $.trim(g.getText())&&$.trim(a.getText())}}function $b(){hc.call(this)}function Ib(){hc.call(this)}function Vb(){hc.call(this)}function Xa(){hc.call(this)}function ma(){hc.call(this);this.protectedGetDefaultPort=function(){return"54321"}}function Lb(){oc.call(this);this.protectedGetDefaultPort=function(){return"15023"}}function hc(){Cb.call(this);var e=this.protectedMethod,h=this,g,a,c;this.protectedGetDefaultPort=
function(){return"5432"};this.protectedGetDefaultDB=function(){return"template1"};this.protectedInitExtendUi=function(k){var d=h.getDownSpace(),f=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));g=new Ra;g.setTabindex(1);var b=new ba(p.get("port","\u7aef\u53e3"));a=new Ra;a.setTabindex(2);var r=new ba(p.get("initDbName","\u6570\u636e\u5e93"));c=new Ra;c.setTabindex(3);g.setText(h.getSource().getDbAddress());var m=h.getSource().getDbPort(),t=h.getSource().getDbName();a.setText(m?m:h.protectedGetDefaultPort());
c.setText(t?t:h.protectedGetDefaultDB());f=f.getJqUi();m=g.getJqUi();b=b.getJqUi();t=a.getJqUi();r=r.getJqUi();var A=c.getJqUi();n.layoutCtrl(f,20,d,70,23);n.layoutCtrl(m,105,d,200,23);n.layoutCtrl(b,20,2*d,70,23);n.layoutCtrl(t,105,2*d,200,23);n.layoutCtrl(r,20,3*d,80,23);n.layoutCtrl(A,105,3*d,200,23);k.append(f);k.append(m);k.append(b);k.append(t);k.append(r);k.append(A);m.on("input",function(E){e.checkTextFieldInput()});t.on("input",function(E){e.checkTextFieldInput()});A.on("input",function(E){e.checkTextFieldInput()})};
this.protectedCollectExtendSource=function(k){var d=$.trim(g.getText()),f=$.trim(a.getText()),b=$.trim(c.getText());k.setDbAddress(d);k.setDbPort(f);k.setDbName(b)};this.protectedConnectDb=function(){e.getDatabaseNameList()};this.protectedIsTextFieldNotNull=function(){return $.trim(g.getText())&&$.trim(a.getText())&&$.trim(c.getText())}}function Mb(){Cb.call(this);var e=this.protectedMethod,h=this,g=["GaussDB100","GaussDB200","GaussDB300"],a,c,k,d;this.protectedInitExtendUi=function(b){var r=new ba(p.get("dbVersion",
"\u6570\u636e\u5e93\u7248\u672c"));a=new tb;a.setItemModels(g);a.addSelectedChangedListener(f);var m=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));c=new Ra;c.setTabindex(1);var t=new ba(p.get("port","\u7aef\u53e3"));k=new Ra;k.setTabindex(2);var A=new ba(p.get("initDbName","\u6570\u636e\u5e93"));d=new Ra;d.setTabindex(3);var E=h.getSource().getDbVersion();a.setSelected(E?E:g[0]);E=h.getSource().getDbAddress();c.setText(E);E=h.getSource().getDbPort();k.setText(E?E:"1888");E=h.getSource().getDbName();
d.setText(E?E:"");r=r.getJqUi();r.attr("title",p.get("dbVersion","\u6570\u636e\u5e93\u7248\u672c"));E=a.getJqUi();m=m.getJqUi();var M=c.getJqUi();t=t.getJqUi();var z=k.getJqUi();A=A.getJqUi();var H=d.getJqUi(),x=h.getDownSpace();n.layoutCtrl(r,20,x,70,23);n.layoutCtrl(E,105,x,200,23);n.layoutCtrl(m,20,2*x,70,23);n.layoutCtrl(M,105,2*x,200,23);n.layoutCtrl(t,20,3*x,70,23);n.layoutCtrl(z,105,3*x,200,23);n.layoutCtrl(A,20,4*x,80,23);n.layoutCtrl(H,105,4*x,200,23);b.append(r);b.append(E);b.append(m);
b.append(M);b.append(t);b.append(z);b.append(A);b.append(H);M.on("input",function(q){e.checkTextFieldInput()});z.on("input",function(q){e.checkTextFieldInput()});H.on("input",function(q){e.checkTextFieldInput()})};this.protectedCollectExtendSource=function(b){var r=$.trim(c.getText()),m=$.trim(k.getText()),t=$.trim(d.getText()),A=a.getSelected();b.setDbAddress(r);b.setDbPort(m);b.setDbName(t);b.setDbVersion(A)};this.protectedConnectDb=function(){e.getDatabaseNameList()};this.protectedIsTextFieldNotNull=
function(){return $.trim(c.getText())&&$.trim(k.getText())&&$.trim(d.getText())};var f=function(b,r,m){0==m.localeCompare(g[0])?(b=h.getSource().getDbName(),d.setText(b?b:""),b=h.getSource().getDbPort(),k.setText(b?b:"1888")):(b=h.getSource().getDbName(),d.setText(b?b:"template1"),b=h.getSource().getDbPort(),k.setText(b?b:"25308"));e.checkTextFieldInput()}}function mb(){Cb.call(this);var e=this.protectedMethod,h=this,g=[{type:"Direct",displayName:p.get("direct","\u76f4\u8fde")},{type:"ZooKeeper",
displayName:"ZooKeeper"}],a,c,k,d,f;this.protectedInitExtendUi=function(r){var m=new ba(p.get("connectType","\u8fde\u63a5\u7c7b\u578b"));a=new tb;a.setItemModels(g);a.addSelectedChangedListener(b);c=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));k=new Ra;k.setTabindex(1);d=new ba(p.get("port","\u7aef\u53e3"));f=new Ra;f.setTabindex(2);var t=h.getSource().getConnectType(),A=g[0];if(t)for(var E=0;E<g.length;E++)if(t==g[E].type){A=g[E];break}a.setSelected(A);a.setCustomPainter(function(x,q,D){q.text(D?
D.displayName:"")});t=h.getSource().getDbAddress();k.setText(t);t=h.getSource().getDbPort();f.setText(t?t:"31010");m=m.getJqUi();m.attr("title",p.get("connectType","\u8fde\u63a5\u7c7b\u578b"));t=a.getJqUi();A=c.getJqUi();E=k.getJqUi();var M=d.getJqUi(),z=f.getJqUi(),H=h.getDownSpace();n.layoutCtrl(m,20,H,70,23);n.layoutCtrl(t,105,H,200,23);n.layoutCtrl(A,20,2*H,70,23);n.layoutCtrl(E,105,2*H,200,23);n.layoutCtrl(M,20,3*H,70,23);n.layoutCtrl(z,105,3*H,200,23);r.append(m);r.append(t);r.append(A);r.append(E);
r.append(M);r.append(z);E.on("input",function(x){e.checkTextFieldInput()});z.on("input",function(x){e.checkTextFieldInput()})};this.protectedCollectExtendSource=function(r){var m=$.trim(k.getText()),t=$.trim(f.getText()),A=a.getSelected();r.setDbAddress(m);r.setDbPort(t);r.setConnectType(A.type)};this.protectedConnectDb=function(){e.getDatabaseNameList()};this.protectedIsTextFieldNotNull=function(){return $.trim(k.getText())&&$.trim(f.getText())};var b=function(r,m,t){r=h.getSource().getConnectType();
t.type==g[0].type?(c.setText(p.get("IPAddress","\u670d\u52a1\u5668")),d.setText(p.get("port","\u7aef\u53e3")),r==g[0].type?(t=h.getSource().getDbAddress(),k.setText(t),t=h.getSource().getDbPort(),f.setText(t?t:"31010")):(k.setText(""),f.setText("31010"))):(c.setText(p.get("quorum","\u6cd5\u5b9a\u6570\u91cf")),d.setText(p.get("clusterId","\u7fa4\u96c6ID")),r==g[1].type?(t=h.getSource().getDbAddress(),k.setText(t),t=h.getSource().getDbPort(),f.setText(t)):(k.setText(""),f.setText("")));e.checkTextFieldInput()}}
function vc(){Cb.call(this);var e=this.protectedMethod,h=this,g,a;this.protectedInitExtendUi=function(c){var k=h.getDownSpace(),d=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));g=new Ra;g.setTabindex(1);var f=new ba(p.get("port","\u7aef\u53e3"));a=new Ra;a.setTabindex(2);var b=new ba(p.get("initDbName","\u6570\u636e\u5e93"));_oInitDbNameTextField=new Ra;_oInitDbNameTextField.setTabindex(3);g.setText(h.getSource().getDbAddress());var r=h.getSource().getDbPort(),m=h.getSource().getDbName();a.setText(r?
r:"50000");_oInitDbNameTextField.setText(m?m:"sample");d=d.getJqUi();r=g.getJqUi();f=f.getJqUi();m=a.getJqUi();b=b.getJqUi();var t=_oInitDbNameTextField.getJqUi();n.layoutCtrl(d,20,k,70,23);n.layoutCtrl(r,105,k,200,23);n.layoutCtrl(f,20,2*k,70,23);n.layoutCtrl(m,105,2*k,200,23);n.layoutCtrl(b,20,3*k,80,23);n.layoutCtrl(t,105,3*k,200,23);c.append(d);c.append(r);c.append(f);c.append(m);c.append(b);c.append(t);r.on("input",function(A){e.checkTextFieldInput()});m.on("input",function(A){e.checkTextFieldInput()});
t.on("input",function(A){e.checkTextFieldInput()})};this.protectedCollectExtendSource=function(c){var k=$.trim(g.getText()),d=$.trim(a.getText()),f=$.trim(_oInitDbNameTextField.getText());c.setDbAddress(k);c.setDbPort(d);c.setDbName(f)};this.protectedConnectDb=function(){e.getDatabaseNameList()};this.protectedIsTextFieldNotNull=function(){return $.trim(g.getText())&&$.trim(a.getText())&&$.trim(_oInitDbNameTextField.getText())}}function Ob(){Cb.call(this);var e=this.protectedMethod,h=this,g,a;this.protectedInitExtendUi=
function(c){var k=h.getDownSpace(),d=h.getDownOffset();g=new Wa;g.setSource(h.getSource().clone());g.setExt([".accdb",".mdb"]);g.setSize(100);g.setCtxApi(h.getCtxApi());g.setFunErrorCallbackEvent(e.fireErrorCallbackEvent);g.addSuccessCallbackEvent(e.fireSuccessCallbackEvent);var f=new ba(p.get("loginInfo","\u670d\u52a1\u5668\u767b\u5f55\u4fe1\u606f\uff1a")),b=new ba(p.get("password","\u5bc6\u7801"));a=new Sb;a.setTabindex(5);h.getSource().getPassword()&&a.setPassword(h.getSource().getPassword());
f=f.getJqUi();b=b.getJqUi();var r=a.getJqUi();n.layoutCtrl(f,20,4*k+d,200,23);n.layoutCtrl(b,20,5*k+d,70,23);n.layoutCtrl(r,105,5*k+d,200,23);c.append(g.getJqUi());c.append(f);c.append(b);c.append(r)};this.protectedCollectExtendSource=function(c){c.setDbAddress(g.getSource().getDbAddress());c.setDbName(g.getSource().getDbName());c.setPassword(a.getPassword())};this.protectedConnectDb=function(){e.checkConnection()};this.protectedIsTextFieldNotNull=function(){return g.getSource().getDbAddress()?-1:
!1};this.getHasUploadFile=function(){return g.getSource().getDbAddress()}}function Dc(){Cb.call(this);var e=this.protectedMethod,h=this,g,a,c,k,d;this.protectedInitExtendUi=function(f){var b=h.getDownSpace(),r=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));g=new Ra;g.setTabindex(1);var m=new ba(p.get("port","\u7aef\u53e3"));a=new Ra;a.setTabindex(2);var t=new ba(p.get("mode","\u6a21\u5f0f"));c=new tb;c.setItemModels([p.get("singleContainer"),p.get("multiContainer")]);c.addSelectedChangedListener(this.modeSelectEvent);
d=new ba(p.get("initDbName","\u6570\u636e\u5e93"));k=new Ra;k.setTabindex(3);g.setText(h.getSource().getDbAddress());var A=h.getSource().getDbPort(),E=h.getSource().getDbName();a.setText(A?A:"39015");k.setText(E?E:"");E?(c.setSelected(p.get("multiContainer")),k.getJqUi().show(),d.getJqUi().show(),k.setEnabled(!0)):(c.setSelected(p.get("singleContainer")),k.setEnabled(!1),k.getJqUi().hide(),d.getJqUi().hide());r=r.getJqUi();A=g.getJqUi();m=m.getJqUi();E=a.getJqUi();t=t.getJqUi();var M=c.getJqUi(),
z=d.getJqUi(),H=k.getJqUi();n.layoutCtrl(r,20,b,70,23);n.layoutCtrl(A,105,b,200,23);n.layoutCtrl(m,20,2*b,70,23);n.layoutCtrl(E,105,2*b,200,23);n.layoutCtrl(t,20,3*b,70,23);n.layoutCtrl(M,105,3*b,200,23);n.layoutCtrl(z,20,4*b,80,23);n.layoutCtrl(H,105,4*b,200,23);f.append(r);f.append(A);f.append(m);f.append(E);f.append(t);f.append(M);f.append(z);f.append(H);A.on("input",function(x){e.checkTextFieldInput()});E.on("input",function(x){e.checkTextFieldInput()});H.on("input",function(x){e.checkTextFieldInput()})};
this.modeSelectEvent=function(f,b,r){0==r.localeCompare(p.get("singleContainer"))?(k.setText(""),k.setEnabled(!1),k.getJqUi().hide(),d.getJqUi().hide()):(k.setEnabled(!0),k.getJqUi().show(),d.getJqUi().show());e.checkTextFieldInput()};this.protectedCollectExtendSource=function(f){var b=$.trim(g.getText()),r=$.trim(a.getText()),m=$.trim(k.getText());f.setDbAddress(b);f.setDbPort(r);f.setDbName(m)};this.protectedConnectDb=function(){e.getDatabaseNameList()};this.protectedIsTextFieldNotNull=function(){return 0==
c.getSelected().localeCompare(p.get("multiContainer"))?$.trim(g.getText())&&$.trim(k.getText())&&$.trim(a.getText()):$.trim(g.getText())&&$.trim(a.getText())}}function bd(){Cb.call(this);var e=this.protectedMethod,h=this,g;this.protectedInitExtendUi=function(a){g=new Wa;g.setSource(h.getSource().clone());g.setExt(".db");g.setSize(100);g.setCtxApi(h.getCtxApi());g.setFunErrorCallbackEvent(e.fireErrorCallbackEvent);g.addSuccessCallbackEvent(e.fireSuccessCallbackEvent);g.addSuccessCallbackEvent(e.checkTextFieldInput);
a.append(g.getJqUi())};this.protectedCollectExtendSource=function(a){a.setDbAddress(g.getSource().getDbAddress());a.setDbName(g.getSource().getDbName())};this.protectedConnectDb=function(){e.getDatabaseNameList()};this.protectedIsTextFieldNotNull=function(){return g.getSource().getDbAddress()?-1:!1};this.getHasUploadFile=function(){return g.getSource().getDbAddress()}}function Uc(){Xb.call(this);this.getDefaultPort=function(){return 1E4}}function Qc(){Xb.call(this);this.getDefaultPort=function(){return 10016}}
function Xb(){Cb.call(this);var e=this.protectedMethod,h=this,g,a;this.getDefaultPort=function(){throw new error("override me");};this.protectedInitExtendUi=function(c){var k=h.getDownSpace(),d=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));g=new Ra;g.setTabindex(1);var f=new ba(p.get("port","\u7aef\u53e3"));a=new Ra;a.setTabindex(2);var b=new ba(p.get("initDbName","\u6570\u636e\u5e93"));_oInitDbNameTextField=new Ra;_oInitDbNameTextField.setTabindex(3);g.setText(h.getSource().getDbAddress());var r=
h.getSource().getDbPort(),m=h.getSource().getDbName();a.setText(r?r:h.getDefaultPort());_oInitDbNameTextField.setText(m?m:"default");d=d.getJqUi();r=g.getJqUi();f=f.getJqUi();m=a.getJqUi();b=b.getJqUi();var t=_oInitDbNameTextField.getJqUi();n.layoutCtrl(d,20,k,70,23);n.layoutCtrl(r,105,k,200,23);n.layoutCtrl(f,20,2*k,70,23);n.layoutCtrl(m,105,2*k,200,23);n.layoutCtrl(b,20,3*k,80,23);n.layoutCtrl(t,105,3*k,200,23);c.append(d);c.append(r);c.append(f);c.append(m);c.append(b);c.append(t);r.on("input",
function(A){e.checkTextFieldInput()});m.on("input",function(A){e.checkTextFieldInput()});t.on("input",function(A){e.checkTextFieldInput()})};this.protectedCollectExtendSource=function(c){var k=$.trim(g.getText()),d=$.trim(a.getText()),f=$.trim(_oInitDbNameTextField.getText());c.setDbAddress(k);c.setDbPort(d);c.setDbName(f)};this.protectedConnectDb=function(){e.getDatabaseNameList()};this.protectedIsTextFieldNotNull=function(){return $.trim(g.getText())?-1:!1}}function cc(){Da.call(this);this.getDefaultPort=
function(){return 21050}}function Da(){Cb.call(this);var e=this.protectedMethod,h=this,g,a;this.getDefaultPort=function(){throw new error("override me");};this.protectedInitExtendUi=function(c){var k=h.getDownSpace(),d=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));g=new Ra;g.setTabindex(1);var f=new ba(p.get("port","\u7aef\u53e3"));a=new Ra;a.setTabindex(2);var b=new ba(p.get("initDbName","\u6570\u636e\u5e93"));_oInitDbNameTextField=new Ra;_oInitDbNameTextField.setTabindex(3);g.setText(h.getSource().getDbAddress());
var r=h.getSource().getDbPort(),m=h.getSource().getDbName();a.setText(r?r:h.getDefaultPort());_oInitDbNameTextField.setText(m?m:"default");d=d.getJqUi();r=g.getJqUi();f=f.getJqUi();m=a.getJqUi();b=b.getJqUi();var t=_oInitDbNameTextField.getJqUi();n.layoutCtrl(d,20,k,70,23);n.layoutCtrl(r,105,k,200,23);n.layoutCtrl(f,20,2*k,70,23);n.layoutCtrl(m,105,2*k,200,23);n.layoutCtrl(b,20,3*k,80,23);n.layoutCtrl(t,105,3*k,200,23);c.append(d);c.append(r);c.append(f);c.append(m);c.append(b);c.append(t);r.on("input",
function(A){e.checkTextFieldInput()});m.on("input",function(A){e.checkTextFieldInput()});t.on("input",function(A){e.checkTextFieldInput()})};this.checkTextFields=function(){var c=$.trim(g.getText()),k=$.trim(a.getText()),d=$.trim(_oInitDbNameTextField.getText());if(""===c)return p.get("dbAddress","\u670d\u52a1\u5668\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a");if(""===k)return p.get("dbPortNotNull","\u7aef\u53e3\u4e0d\u80fd\u4e3a\u7a7a");if(""===d)return p.get("dbNameNotNull","\u6570\u636e\u5e93\u4e0d\u80fd\u4e3a\u7a7a")};
this.protectedCollectExtendSource=function(c){var k=$.trim(g.getText()),d=$.trim(a.getText()),f=$.trim(_oInitDbNameTextField.getText());c.setDbAddress(k);c.setDbPort(d);c.setDbName(f)};this.protectedConnectDb=function(){e.getDatabaseNameList()};this.protectedIsTextFieldNotNull=function(){return $.trim(g.getText())?-1:!1}}function oa(){Ya.call(this);this.getDefaultPort=function(){return 7070}}function Ya(){Cb.call(this);var e=this.protectedMethod,h=this,g,a,c;this.getDefaultPort=function(){throw new error("override me");
};this.protectedInitExtendUi=function(k){var d=h.getDownSpace(),f=new ba(p.get("IPAddress","\u670d\u52a1\u5668"));g=new Ra;g.setTabindex(1);var b=new ba(p.get("port","\u7aef\u53e3"));a=new Ra;a.setTabindex(2);var r=new ba(p.get("ProjectName","\u9879\u76ee\u540d\u79f0"));c=new Ra;c.setTabindex(3);g.setText(h.getSource().getDbAddress());var m=h.getSource().getDbPort(),t=h.getSource().getDbName();a.setText(m?m:h.getDefaultPort());c.setText(t?t:"default_project");f=f.getJqUi();m=g.getJqUi();b=b.getJqUi();
t=a.getJqUi();r=r.getJqUi();var A=c.getJqUi();n.layoutCtrl(f,20,d,70,23);n.layoutCtrl(m,105,d,200,23);n.layoutCtrl(b,20,2*d,70,23);n.layoutCtrl(t,105,2*d,200,23);n.layoutCtrl(r,20,3*d,80,23);n.layoutCtrl(A,105,3*d,200,23);k.append(f);k.append(m);k.append(b);k.append(t);k.append(r);k.append(A);m.on("input",function(E){e.checkTextFieldInput()});t.on("input",function(E){e.checkTextFieldInput()});A.on("input",function(E){e.checkTextFieldInput()})};this.checkTextFields=function(){var k=$.trim(g.getText()),
d=$.trim(a.getText()),f=$.trim(c.getText());if(""===k)return p.get("dbAddress","\u670d\u52a1\u5668\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a");if(""===d)return p.get("dbPortNotNull","\u7aef\u53e3\u4e0d\u80fd\u4e3a\u7a7a");if(""===f)return p.get("projectNotNull","\u9879\u76ee\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a")};this.protectedCollectExtendSource=function(k){var d=$.trim(g.getText()),f=$.trim(a.getText()),b=$.trim(c.getText());k.setDbAddress(d);k.setDbPort(f);k.setDbName(b)};this.protectedConnectDb=function(){e.getDatabaseNameList()};
this.protectedIsTextFieldNotNull=function(){return $.trim(g.getText())?-1:!1}}function eb(){oc.call(this);this.protectedGetDefaultPort=function(){return"9030"}}function Wa(){var e,h=this,g,a,c,k=[],d=1,f;this.getJqUi=function(){e||(e=$("<div>"),h.protectedInitUi());return e};this.protectedInitUi=function(){var E=$("<div style='text-align:center'>");$("<input>");var M=$("<div type='button'>");M.on("click",function(){z.click()});if("placeholder"in $("<input>")[0]){var z=$("<input type='file' id='fileToUpload' style='width:0;height:0;position:absolute;left:-100px'>");
z.attr("accept",f);z.change(function(aa){var jb;aa=e.find("#fileToUpload");null!=aa&&null!=aa.get(0)&&null!=aa.get(0).files&&(jb=aa.get(0).files[0]);if(jb)if(0!=jb.size){aa=jb.name;var Qb=jb.size,za=aa.lastIndexOf(".");za=aa.substring(za,aa.length).toLowerCase();if(Qb>1048576*d)c&&c(p.get("fileTooLarge","\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7\u6700\u5927\u9650\u5236\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u6587\u4ef6\u3002"));else if(f&&0>f.indexOf(za))c&&c(p.get("fileTypeIncorrect","\u6587\u4ef6\u7c7b\u578b\u4e0d\u6b63\u786e"));
else{za=e.find("#fileIcon");var Na=e.find("#fileName"),wa=e.find("#fileSize"),Ca;1048576>Qb?Ca=(Qb/1024).toFixed(2)+"KB":1048576<=Qb&&(Ca=(Qb/1048576).toFixed(2)+"M");Bb.background(za,"file_"+g.getDbType().toLowerCase());Na.text(aa);wa.text("("+Ca+")");Na.attr("title",aa);wa.attr("title",Ca);za.show();Na.show();wa.show();r(jb)}}else e.find("#fileToUpload").val(""),c(p.get("uploadFileIsNull","\u4e0a\u4f20\u7684\u6587\u4ef6\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u3002"))});E.append(z)}else{var H=
$("<form id='uploadForm' method='post' enctype='multipart/form-data' target='targetIframeA'>");z=$("<input name='filename' type='file' style='width:0;height:0;position:absolute;left:-100px' onchange='submit()' multiple/>");var x=$("<iframe name='targetIframeA' id='targetIframeA' style='height: 0;width: 0'>");H.attr("action","/qing/uploadFileForIE9.do?type="+f);H.append(z);E.append(H);E.append(x);x.on("load",function(aa){aa=$(window.frames.targetIframeA.document).find("body");if(aa.html())try{var jb=
JSON.parse(aa.html().toString()),Qb=jb.fileName,za=jb.fileSize,Na=jb.errorCode;if("IE9001"==Na)c&&c(p.get("fileTypeIncorrect","\u6587\u4ef6\u7c7b\u578b\u4e0d\u6b63\u786e"));else if("IE9002"==Na)c&&c(p.get("fileTooLarge","\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7\u6700\u5927\u9650\u5236\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u6587\u4ef6\u3002"));else if("IE9003"==Na)c&&c(p.get("uploadFileIsNull","\u4e0a\u4f20\u7684\u6587\u4ef6\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u3002"));else{var wa=e.find("#fileIcon"),
Ca=e.find("#fileName"),db=e.find("#fileSize"),na;1048576>za?na=(za/1024).toFixed(2)+"KB":1048576<=za&&(na=(za/1048576).toFixed(2)+"M");Bb.background(wa,"file_"+g.getDbType().toLowerCase());Ca.text(Qb);db.text("("+na+")");Ca.attr("title",Qb);db.attr("title",na);wa.show();Ca.show();db.show();b(p.get("uploadSuccess","\u4e0a\u4f20\u6210\u529f"));g.setDbName(Qb);g.setDbAddress(jb.data)}}catch(u){console&&console.log(u),c&&c(p.get("fileTooLarge","\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7\u6700\u5927\u9650\u5236\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u6587\u4ef6\u3002"))}})}M.addClass("dm-source-db-file-upload-btn");
H=$("<div>");H.css("text-align","center");x=$("<div>");x.addClass("dm-source-db-file-upload-btn-text");x.text(p.get("uploadFile","\u4e0a\u4f20\u6587\u4ef6"));var q=$("<div>");q.addClass("dm-source-db-file-upload-btn-icon");Bb.background(q,"upload_icon_selected");var D=$("<span>");D.addClass("dm-source-db-file-upload-prompt");D.text(p.get("acceptDBFile","\u652f\u6301#1\u6587\u4ef6\uff0c\u4e14\u6587\u4ef6\u4e0d\u5927\u4e8e100M").replace("#1",f));var G=$("<div id='fileIcon'>");G.addClass("dm-source-db-file-upload-fileIcon");
var ca=$("<div id='fileName'>");ca.addClass("dm-source-db-file-upload-filedetail");var y=$("<div id='fileSize'>");y.addClass("dm-source-db-file-upload-filedetail");y.css("top","129px");var P=$("<progress value='0' max='100'>");P.addClass("dm-source-db-file-upload-progress");g.getDbName()?(ca.text(g.getDbName()),ca.attr("title",g.getDbName()),Bb.background(G,"file_"+g.getDbType().toLowerCase()),G.show()):(ca.hide(),y.hide(),G.hide());P.hide();H.append(q);H.append(x);M.append(H);E.append(M);e.append(E);
e.append(D);e.append(G);e.append(ca);e.append(y);e.append(P)};this.setSource=function(E){g=E};this.getSource=function(){return g};this.setSize=function(E){d=E};this.setExt=function(E){f=E};this.setCtxApi=function(E){a=E};this.setFunErrorCallbackEvent=function(E){c=E};this.addSuccessCallbackEvent=function(E){k.push(E)};var b=function(E){for(var M=0;M<k.length;M++)(0,k[M])(E)},r=function(E){e.find(".dm-source-db-file-upload-progress").show();var M=E.name,z=new FormData;z.append("filename",E);E=new XMLHttpRequest;
E.upload.addEventListener("progress",m,!1);E.addEventListener("load",t,!1);E.addEventListener("error",A,!1);var H=E.addEventListener;E.abort();H.call(E,"abort",void 0,!1);a.createFacade().uploadFile(E);E.onload=function(x){if(200==this.status){x=this.response;var q=null;try{q=JSON.parse(x)}catch(D){c(p.get("uploadFail","\u4e0a\u4f20\u5931\u8d25"));return}if(q&&q.data){e.find(".dm-source-db-file-upload-progress").hide();b(p.get("uploadSuccess","\u4e0a\u4f20\u6210\u529f"));g.setDbName(M);g.setDbAddress(q.data);
return}if(q&&"4001002"==q.errorCode){c(p.get("uploadFileNoAccess","\u65e0\u4e0a\u4f20\u6587\u4ef6\u6743\u9650"));return}if(q&&3099003==q.errorCode){c(q.errorMessage);return}if(q&&q.errorMessage){c(q.errorMessage);return}}c(p.get("uploadFail","\u4e0a\u4f20\u5931\u8d25"))};E.send(z)},m=function(E){var M=e.find(".dm-source-db-file-upload-progress").get(0);E.lengthComputable&&(M.max=E.total,M.value=E.loaded)},t=function(E){},A=function(E){c&&c(p.get("uploadFail","\u4e0a\u4f20\u5931\u8d25"))}}function ea(e,
h,g,a,c,k,d){this.isNeedSelectDb=function(){return k};this.isSchemaSupported=function(){return d};this.getDbType=function(){return e};this.getDownOffset=function(){return h};this.getConfigRowCount=function(){return g};this.isNotShowAll=function(){return a};this.getConnectionPane=function(){return c}}function da(){Kb.call(this);var e=this,h=this.protectedMethod,g,a,c,k,d,f,b,r=!1,m=[new ea(ja.TYPE_HANA,40,4,!1,new Dc,!0,!0),new ea(ja.TYPE_MYSQL,-1,-1,!1,new oc,!0,!1),new ea(ja.TYPE_SQLSERVER,-1,-1,
!1,new uc,!0,!1),new ea(ja.TYPE_SYBASE,-1,-1,!1,new Wb,!0,!1),new ea(ja.TYPE_ORACLE,40,-1,!1,new Bc,!1,!1),new ea(ja.TYPE_ODPS,40,-1,!1,new rc,!1,!1),new ea(ja.TYPE_POSTGRESQL,40,-1,!1,new $b,!0,!0),new ea(ja.TYPE_DB2,40,-1,!1,new vc,!0,!0),new ea(ja.TYPE_ACCESS,40,-1,!0,new Ob,!1,!1),new ea(ja.TYPE_SQLITE,40,-1,!0,new bd,!1,!1),new ea(ja.TYPE_HIVE,40,-1,!1,new Uc,!1,!1),new ea(ja.TYPE_REDSHIFT,40,-1,!1,new Eb,!0,!0),new ea(ja.TYPE_TIDB,-1,-1,!1,new xb,!0,!1),new ea(ja.TYPE_DM,-1,-1,!1,new ab,!0,
!1),new ea(ja.TYPE_GREENPLUM,40,-1,!1,new Xa,!0,!0),new ea(ja.TYPE_GAUSSDB,40,4,!1,new Mb,!0,!1),new ea(ja.TYPE_APACHEDRILL,40,-1,!1,new mb,!0,!1),new ea(ja.TYPE_SPARKSQL,40,-1,!1,new Qc,!1,!1),new ea(ja.TYPE_SYBASEIQ,-1,-1,!1,new tc,!0,!1),new ea(ja.TYPE_IMPALA,40,-1,!1,new cc,!1,!1),new ea(ja.TYPE_KYLIN,40,-1,!1,new oa,!0,!0),new ea(ja.TYPE_KINGBASE,40,-1,!1,new ma,!0,!0),new ea(ja.TYPE_TDSQL,-1,-1,!1,new Lb,!0,!1),new ea(ja.TYPE_GBASE,40,-1,!1,new Ib,!0,!0),new ea(ja.TYPE_VASTBASE,40,-1,!1,new Vb,
!0,!0),new ea(ja.TYPE_DORIS,-1,-1,!1,new eb,!0,!1),new ea(ja.TYPE_YASHANDB,40,-1,!1,new Kc,!1,!0)],t,A=!1,E,M;this.setChangeSourceType=function(G){A=G};this.setOldEntity=function(G){t=G};this.setDModel=function(G){E=G};this.getSubTitle=function(){return p.get("connectDbServer","\u8fde\u63a5\u6570\u636e\u5e93\u670d\u52a1\u5668")};var z=function(){var G=m.filter(function(ca){return ca.getDbType()==b.getDbType()});return G&&1==G.length?G[0]:null};this.protectedCreateUi=function(){var G=$("<div>");b=
e.getSource().clone();var ca=z();if(ca){var y=G.append;g=ca.getConnectionPane();-1!=ca.getDownOffset()&&g.setDownOffset(ca.getDownOffset());-1!=ca.getConfigRowCount()&&g.setDbConfigRowCount(ca.getConfigRowCount());ca.isNeedSelectDb()&&g.addSuccessCallbackListener(H);g.setSource(b);g.setCtxApi(e.getCtxApi());g.addSuccessCallbackListener(x);g.addErrorCallbackListener(q);var P=g.getJqUi(ca.isNotShowAll());y.call(G,P)}if(A)ca.isNeedSelectDb()&&(a=new tb,ca.isSchemaSupported()?(ca=new ba(p.get("dbschema",
"\u6a21\u5f0f")),a.setSelected(b.getSchema())):(ca=new ba(p.get("database","\u6570\u636e\u5e93")),a.setSelected(b.getDbName())),ca=ca.getJqUi(),y=a.getJqUi(),n.layoutCtrl(ca,20,g.getCurrentHight()+40,70,23),n.layoutCtrl(y,105,g.getCurrentHight()+40,200,23),G.append(ca),G.append(y)),M=new Ja,M.setText(p.get("actOnTheSameDatabase","\u540c\u65f6\u4fee\u6539\u5f53\u524d\u4e3b\u9898\u4e2d\u5176\u4ed6\u540c\u6e90\u6570\u636e\u8868")),M.setChecked(!1),ca=M.getJqUi(),n.layoutCtrl(ca,20,g.getCurrentHight()+
80,250,23),G.append(ca);else{y=G.append;P=$("<div>");P.addClass("dm-source-db-table-dbname");var aa=0;if(ca.isNeedSelectDb()){a=new tb;if(ca.isSchemaSupported()){var jb=new ba(p.get("dbschema","\u6a21\u5f0f"));a.setSelected(b.getSchema())}else jb=new ba(p.get("database","\u6570\u636e\u5e93")),a.setSelected(b.getDbName());jb=jb.getJqUi();var Qb=a.getJqUi();aa+=40;n.layoutCtrl(jb,36,aa,70,23);n.layoutCtrl(Qb,121,aa,200,23);P.append(jb);P.append(Qb)}jb=(new ba(p.get("type","\u7c7b\u578b"))).getJqUi();
aa+=40;n.layoutCtrl(jb,36,aa,70,23);P.append(jb);c=new hb;c.setText(p.get("table","\u8868"));Qb=c.getJqUi();Qb.attr("title",p.get("table","\u8868"));k=new hb;k.setText(p.get("customSql","\u81ea\u5b9a\u4e49")+ja.SQLTYPE_SQL);var za=k.getJqUi();za.attr("title",p.get("customSql","\u81ea\u5b9a\u4e49")+ja.SQLTYPE_SQL);jb=new hd;jb.addElement(c);jb.addElement(k);n.layoutCtrl(Qb,120,aa,300,23);aa+=40;n.layoutCtrl(za,120,aa,300,23);P.append(Qb);P.append(za);ja.isNeedShowKSql(ca.getDbType())&&(d=new hb,d.setText(p.get("customSql",
"\u81ea\u5b9a\u4e49")+ja.SQLTYPE_KSQL),jb.addElement(d),Qb=d.getJqUi(),Qb.attr("title",p.get("customSql","\u81ea\u5b9a\u4e49")+ja.SQLTYPE_KSQL),aa+=40,n.layoutCtrl(Qb,120,aa,300,23),P.append(Qb));ja.isNeedShowPrecedure(ca.getDbType())&&(f=new hb,f.setText(p.get("storedProcedure","\u5b58\u50a8\u8fc7\u7a0b")),jb.addElement(f),ca=f.getJqUi(),ca.attr("title",p.get("storedProcedure","\u5b58\u50a8\u8fc7\u7a0b")),n.layoutCtrl(ca,120,aa+40,300,23),P.append(ca));c.setChecked(!0);y.call(G,P)}return G};this.createNextTableSteps=
function(){var G=new zb;G.setCtxApi(e.getCtxApi());G.setSource(e.getSource());var ca=new zc;ca.setCtxApi(e.getCtxApi());ca.setSource(e.getSource());return[G,ca]};this.creatNextCustomSqlStep=function(){var G=new lc;G.setSqlType(ja.SQLTYPE_SQL);G.setCtxApi(e.getCtxApi());G.setSource(e.getSource());return G};this.creatNextCustomKSqlStep=function(){var G=new lc;G.setSqlType(ja.SQLTYPE_KSQL);G.setCtxApi(e.getCtxApi());G.setSource(e.getSource());return G};this.creatNextStoredProcedureStep=function(){var G=
new ad;G.setCtxApi(e.getCtxApi());G.setSource(e.getSource());return G};this.intoThisStep=function(G,ca){r=!1};this.outThisStep=function(G,ca){var y=g.collectSource(),P=z();P.isNeedSelectDb()&&(P.isSchemaSupported()?(P=a.getSelected(),b.setSchema(P)):(P=a.getSelected(),b.setDbName(P)));G?(h.getTopJqUi()&&h.getTopJqUi().remove(),ca(null)):(G=function(){if(A)r&&ca(null);else if(r)if(c.isChecked()){var aa=e.createNextTableSteps();ca(aa)}else k.isChecked()?(aa=e.creatNextCustomSqlStep(),ca(aa)):d&&d.isChecked()?
(aa=e.creatNextCustomKSqlStep(),ca(aa)):f&&f.isChecked()&&(aa=e.creatNextStoredProcedureStep(),ca(aa))},b.getDbType()==ja.TYPE_SQLITE?g.getHasUploadFile()?(y.setName(e.getSource().getName()),e.setSource(y),r=!0,G()):h.getMessageCurtain().showPrompt(p.get("pleaseUploadFile","\u8bf7\u5148\u4e0a\u4f20\u6587\u4ef6\u3002")):b.getDbType()==ja.TYPE_ACCESS?g.getHasUploadFile()?D(y,G):h.getMessageCurtain().showPrompt(p.get("pleaseUploadFile","\u8bf7\u5148\u4e0a\u4f20\u6587\u4ef6\u3002")):r?G():D(y,G))};this.isLastStep=
function(){return A?!0:!1};this.over=function(G,ca){if(t&&A&&G){ca=!M.isChecked();G=t.getSource();var y=g.collectSource(),P=z(y);P.isNeedSelectDb()&&(P.isSchemaSupported()?y.setSchema(a.getSelected()):y.setDbName(a.getSelected()));ca?(y.isTheSame(G)||(ca=t.getName(),G.isUserSql(ca)?(ca=G.getUserSql(ca),y.addUserSql(ca)):G.isStoredProcedure(ca)&&(ca=G.getStoredProcedure(ca),y.addStoredProcedure(ca)),ca=E.getSources(),t.setSource(y),t.mergeSource(ca),(G.hasUserSql()||G.hasStoredProcedure())&&E.funClearUserSqlsAndStoredProcedures(G)),
h.refreshDesigntimeDataObject(t,y)):(G=t.getSource(),G.hasUserSql&&G.hasUserSql()&&y.setAllUserSql(G.getAllUserSql()),G.hasStoredProcedure()&&y.setAllStoredProcedure(G.getAllStoredProcedure()),(new Hc).updateSameSource(E,G,y,function(aa){aa.setSource(y);aa.mergeSource(E.getSources());h.refreshDesigntimeDataObject(aa,y)},t))}};var H=function(){var G=g.getDbNameList();a.setItemModels(G);G&&!e.getSource().getDbName()&&a.setSelected(G[0])},x=function(G){h.getMessageCurtain().showSuccess(G)},q=function(G){h.getMessageCurtain().showPrompt(G)},
D=function(G,ca){var y=g.checkTextFields();y?h.getMessageCurtain().showPrompt(y):h.checkConnection(G,function(P){P?(b.isTheSame(e.getSource())||e.setSource(b),r=!0):r=!1;ca()})}}function zb(){function e(Ba,fb){KTDefaultCellRender.call(this,Ba);var Nb=this;this.paintCellUI=function(Tb,gc){var pc=Nb.getCell().getValue(),Rc=pc.getName(),Lc=pc.getDisplayName(),Xc=Lc+"("+pc.getCommentInfo()+")",id=b.find(".sa-ctrl-switcher-thumb").parent();if(pc instanceof Pa){var $c=$("<div>");$c.addClass("dm-source-db-table-list-item");
$c.attr("table-name",V.encode(Rc));$c.attr("title",Lc);var md=$("<div>");md.addClass("dm-source-db-table-list-item-text");md.css("left","0px");md.css("top","-2px");md.text(Lc);$c.append(md);Tb=$(Tb);Tb.css("left","4px");Tb.append($c)}else{$c=$("<div>");$c.addClass("dm-source-db-table-list-item");$c.css("margin-left","-16px");$c.attr("table-name",V.encode(Rc));$c.attr("parent-name",V.encode(pc.getParentNode().getName()));$c.attr("associateName",V.encode(pc.getAssociateName()));$c.attr("table-type",
V.encode(pc.getType()));id.hasClass("sa-ctrl-switcher_on")?$c.attr("title",Xc):$c.attr("title",Lc);$c.on("mousedown",fa);var nd=a.isMultiSelectable()?a.newTableItemComponent(pc):a.newTableItemComponentWithRadio(pc);var td=$("<div>");n.layoutCtrl(td,25,0,300,23);td.addClass("dm-source-db-table-item");var vd=$("<div>");vd.addClass("dm-source-db-table-list-item-icon");var wd=pc.getType();Bb.background(vd,wd);md=$("<div>");md.addClass("dm-source-db-table-list-item-text");id.hasClass("sa-ctrl-switcher_on")?
(md.text(Xc),md.attr("entity-coding",Lc)):(md.text(Lc),md.attr("entity-coding",Xc));"xml"==wd&&md.attr("title",Xc);Lc=nd.getJqUi();$c.append(Lc);td.append(vd);td.append(md);$c.append(td);for(var yd in x)pc==x[yd]&&nd.setChecked(!0);""!=q&&q==Rc&&(td.addClass("dm-source-db-table-list-item_selected"),Bb.background(vd,wd+"_selected"));Tb=$(Tb);Tb.css("overflow","visible")}gc?(gc=$(gc),gc.css("overflow","visible"),$c.appendTo(gc)):$c.appendTo(Tb);n.layoutCtrlWithLRTB($c,0,0,null,0,0,null)}}function h(Ba,
fb){for(var Nb=0;Nb<P.length;Nb++){var Tb=P[Nb].getFileName();Tb=Tb.substring(0,Tb.lastIndexOf("."));if(a.getSource().getFileType()==gb.TYPE_TXT||a.getSource().getFileType()==gb.TYPE_CSV){if(Tb===Ba)return P[Nb]}else if(Tb===fb)return P[Nb]}}function g(Ba,fb,Nb){var Tb=Ka(q);Tb&&(Tb=Tb.getFisrtEntity())&&Tb.getName()==Ba.getName()&&(fb=p.get("totalRows","\u603b\u5171#1\u884c\u6570\u636e").replace("#1",Nb)+p.get("previewTipsComma",",")+fb,Ac(fb,Nb))}Kb.call(this);var a=this,c=this.protectedMethod,
k,d,f,b,r,m,t,A,E,M,z=[],H,x=[],q,D={},G=0,ca,y={},P,aa={},jb={},Qb={};this.setArrSource=function(Ba){P=Ba};this.getSubTitle=function(){return p.get("selectTable","\u9009\u62e9\u8868")};this.isMultiSelectable=function(){return!0};this.addDataObjectNode=function(Ba){z.push(Ba)};this.setCustomHandler=function(Ba){ca=Ba};this.getDataObject=function(Ba){return Ka(Ba)};this.protectedGetPreviewTableImpl=function(){var Ba=new wc;Ba.setEnablePreviewFunction(na);return Ba};this.protectedCreateUi=function(){k=
$("<div>");b=$("<div>");d=$("<div>");b.append(d);E=a.protectedGetPreviewTableImpl();E.setSelectedDataObjectName(q);f=E.getJqUi();r=$("<div>");r.addClass("dm-source-db-table-selection-right");A=new ba;A.setText(p.get("selectedTable","\u5df2\u9009\u8868")+"("+x.length+")");A.getJqUi().addClass("dm-source-db-table-selection-selectedtablelabel");var Ba=(new ba(p.get("clearAll","\u6e05\u7a7a"))).getJqUi();Ba.addClass("dm-source-db-table-selection-clearalllabel");Ba.addClass("dm-source-db-table-selection-clearalllabel-color");
Ba.on("mousedown",u);m=$("<div>");m.addClass("dm-source-db-table-selected-table-area");r.append(A.getJqUi());r.append(Ba);r.append(m);ud(!0);return k};var za=function(){if(a.isMultiSelectable()){var Ba=new X;Ba.setHorizontalSplit(!0);Ba.setEnabled(!0);Ba.setFirstSize(200,185,300);Ba.setSecondSize(520,0,-1);Ba.setResizeMode(X.RESIZE_MODE_FIRST_FIXED);Ba.setFirstChild(X.createChildWrapper(b));Ba.setSecondChild(X.createChildWrapper(f,function(){E.relayoutViews()}));var fb=new X;fb.setHorizontalSplit(!0);
fb.setEnabled(!0);fb.setFirstSize(728,-1,-1);fb.setSecondSize(200,185,300);fb.setResizeMode(X.RESIZE_MODE_SECOND_FIXED);fb.setFirstChild(Ba);fb.setSecondChild(X.createChildWrapper(r));return fb}r.remove();Ba=new X;Ba.setHorizontalSplit(!0);Ba.setEnabled(!0);Ba.setFirstSize(200,185,300);Ba.setSecondSize(720,0,-1);Ba.setResizeMode(X.RESIZE_MODE_FIRST_FIXED);Ba.setFirstChild(X.createChildWrapper(b));Ba.setSecondChild(X.createChildWrapper(f,function(){E.relayoutViews()}));return Ba},Na=function(){var Ba=
a.getSource().toJsonObject();a.getCtxApi().createFacade(function(fb){a.getCtxApi().createFacade().getExportedData(fb,".xlsx")},function(fb,Nb){return!0}).scanAllEntity(Ba)};this.refreshPreviewTable=function(){E&&E.getPreviewTable()&&Ab.refresh(E.getPreviewTable())};this.over=function(Ba){ud(!1)};this.intoThisStep=function(Ba,fb){fb?Ab.refresh(E.getPreviewTable()):(z=[],q="",x=[],fd(),a.loadLeftNodes())};this.outThisStep=function(Ba,fb){if("dpp"===a.getSource().getTypeName())for(var Nb=Object.keys(y),
Tb=0;Tb<Nb.length;Tb++){var gc=y[Nb[Tb]];a.getSource().addModelType(Nb[Tb],gc)}if(Ba)fb(null);else if(0==x.length)c.getMessageCurtain().showPrompt(p.get("selectATable","\u8bf7\u81f3\u5c11\u9009\u4e2d\u4e00\u4e2a\u6570\u636e\u8868\u3002")),fb(a);else if(a.protectedOutThisStep()){Ba=!0;for(var pc in x)if(Nb=x[pc].getName(),void 0==Ka(Nb)){fb(a);Ba=!1;break}Ba&&fb(null)}else c.getMessageCurtain().showPrompt(a.protectedOutThisStepPrompt())};this.protectedOutThisStep=function(){return!0};this.protectedOutThisStepPrompt=
function(){return""};this.loadLeftNodes=function(){var Ba=za();k.append(Ba.getJqUi());wa()};this.getTableSearchBoxPlaceholder=function(Ba){if("dpp"===a.getSource().getTypeName()){var fb=p.get("enterSearchModel","\u641c\u7d22\u6a21\u578b\u540d\u79f0");Ba&&(fb=fb+"/"+p.get("enterSearchModerMark","\u6a21\u578b\u7f16\u7801"))}else la.ERPCloudEntity&&a.getSource()instanceof la.ERPCloudEntity||la.SuperQuery&&a.getSource()instanceof la.SuperQuery?(fb=p.get("enterSearchText","\u641c\u7d22\u5b9e\u4f53\u540d\u79f0"),
Ba&&(fb=fb+"/"+p.get("enterSearchTextMark","\u5b9e\u4f53\u6807\u8bc6"))):fb=p.get("enterSearchTable","\u641c\u7d22\u6570\u636e\u8868\u540d\u79f0");return fb};this.setTableSearchBoxPlaceholder=function(Ba){t&&t.setPlaceholder(a.getTableSearchBoxPlaceholder(Ba))};this.protectedCreateNoTableTipUi=function(){var Ba=new ba(p.get("nothingTable","\u6682\u65e0\u6570\u636e\u8868"));Ba.setAlign(ba.ALIGN_CENTER);return Ba.getJqUi()};var wa=function(){d.empty();var Ba=sd(p.get("loadingData","\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019\u2026\u2026"),
d,20);G=Ba;var fb=a.getSource().toJsonObject(),Nb=a.getCtxApi().createFacade(function(gc){var pc=new Pa;pc.fromJsonObject(gc);gc=pc.getChildren();for(pc=0;pc<gc.length;pc++){var Rc=gc[pc];a.getTreeNodeParser()?a.getTreeNodeParser()(Rc):L(Rc)}H=z;0<z.length&&(Ba>=G&&qd(d),Hb(null,null),t&&t.getJqUi().remove(),t=new Y,t.addSearchListener(db),t.setPlaceholder(a.getTableSearchBoxPlaceholder(!1)),t.setShowSearchIcon(!0),gc=t.getJqUi(),gc.addClass("dm-source-db-table-selection-searchbox"),b.prepend(gc));
db(!0);a.getSource().isShowEntityMark()&&0<z.length&&(gc=new xc,gc.setJqLeftPane(b),pc=p.get("displayEntityMark","\u663e\u793a\u5b9e\u4f53\u6807\u8bc6"),"dpp"===a.getSource().getTypeName()&&(pc=p.get("displayModelCode","\u663e\u793a\u6a21\u578b\u7f16\u7801")),gc.displayEntityCodingPane(".dm-source-db-table-list-item-text",".dm-source-db-table-selected-list-item-name",pc,".dm-source-db-table-list-item",a.setTableSearchBoxPlaceholder))},function(gc,pc){if(382011002==gc)return c.getMessageCurtain().showPrompt(p.get("noDmoPermission",
"\u6ca1\u6709\u6570\u636e\u5f00\u53d1\u5e73\u53f0\u6570\u636e\u8868\u6743\u9650\uff0c\u8bf7\u5148\u8054\u7cfb\u7ba1\u7406\u5458\u5206\u914d\u6743\u9650\u3002"),2E3),!0;if(2030100==gc)return c.getMessageCurtain().showError(p.get("entityFileNotFound","\u6570\u636e\u8868\u6587\u4ef6\u4e0d\u5b58\u5728\u3002")),!0;gc=gc.toString();if("20"==gc.substr(0,2)&&7==gc.length){if("20612"==gc.substr(0,5)||"20622"==gc.substr(0,5))return!1;c.getMessageCurtain().showError(pc);return!0}return!1});if(null!=P){fb=[];
for(var Tb=0;Tb<P.length;Tb++)fb.push(P[Tb].toJsonObject());Nb.getUsableEntitiesFromMultiFile(fb)}else Nb.getUsableEntities(fb)};this.getTreeNodeParser=function(){return null};var Ca=function(Ba,fb){var Nb=[];if(Ba instanceof ua){var Tb=$(".sa-ctrl-switcher-thumb").parent();0<=Ba.getDisplayName().toUpperCase().indexOf(fb.toUpperCase())?Nb.push(Ba):Tb.hasClass("sa-ctrl-switcher_on")&&0<=Ba.getCommentInfo().toUpperCase().indexOf(fb.toUpperCase())&&Nb.push(Ba)}else{Tb=!0;var gc=Ba.getChildren(),pc;for(pc in gc){var Rc=
Ca(gc[pc],fb);Rc&&0<Rc.length&&(Tb&&(Nb.push(Ba),Tb=!1),Nb=Nb.concat(Rc))}}return Nb},db=function(Ba){H=[];var fb;t&&(fb=t.getText().trim());if(fb)for(var Nb in z){var Tb=z[Nb];0==Tb.getSubNodeLevel()&&(H=H.concat(Ca(Tb,fb)))}else H=z;d.empty();0==H.length?(qd(d),Nb=new ba(p.get("nothingSearched","\u627e\u4e0d\u5230\u7b26\u5408\u7684\u7ed3\u679c")),Nb.setAlign(ba.ALIGN_CENTER),Nb=Nb.getJqUi(),fb||(Nb=a.protectedCreateNoTableTipUi()),Nb.addClass("dm-source-db-table-selection-table-area-prompt"),d.append(Nb)):
(Nb=$("<div>"),Nb.addClass("dm-source-db-table-selection-table-area"),Tb=C(fb?!0:!1),Nb.append(Tb),d.append(Nb));if(1==z.length&&Ba){Ba=z[0];Nb=Ba.getName();if(Tb=$(t.getJqUi()).parent().find("[table-name='"+V.encode(Nb)+"']").find(".dm-source-db-table-list-item-component").data("model"))Tb.setChecked(!0),a.defaultSelectTableWhenInit(Ba),fd();R(Nb)}"scanAllEntity"==fb&&Na()};this.defaultSelectTableWhenInit=function(Ba){0==x.length&&x.push(Ba)};this.setArrSelectedDataObjectNode=function(Ba){x=Ba};
this.getSelectedDataObjectMap=function(){var Ba={},fb;for(fb in x){var Nb=x[fb].getName();Ba[Nb]=Ka(Nb)}return Ba};var na=function(){if(E.getCheckBoxIsChecked()){$(E.getPreviewTable().getUI()).show();var Ba=Ka(q);if(Ba){if(null!=P&&0<P.length){var fb=q.indexOf("/");var Nb=q.substring(fb+1,q.length);fb=q.substring(0,fb);fb=h(Nb,fb)}Ba=Ba.getFisrtEntity();Ma(Ba,fb,Nb)}}else $(E.getPreviewTable().getUI()).hide()},u=function(){for(var Ba in x)pd(x[Ba].getName());x=[];fd()},L=function(Ba){z.push(Ba);if(Ba instanceof
Pa&&(Ba=Ba.getChildren()))for(var fb=0;fb<Ba.length;fb++)L(Ba[fb])},C=function(Ba){var fb=new KTable,Nb=$(fb.getUI());a.isMultiSelectable()||(M=new hd,M.addChangedListener(Zc));Nb.children().css("overflow-x","hidden");fb.setCellRender(new e(fb,a.isMultiSelectable()));fb.setSyncUIWhenModelChanged(!1);fb.setLargeDataMode(!0,!1);fb.addColumn().setWidth(300);fb.addTreeExpandListener(function(){var Tb=fb.keepScrollStatus();Tb.v&&(Tb.v+=1);fb.restoreScrollStatus(Tb)});Q(fb,Ba);fb.updateUI();return Nb},
Q=function(Ba,fb){null!=P&&0<P.length&&(fb=!0);var Nb=H;if(0==Nb.length)return!1;for(var Tb=0;Tb<Nb.length;Tb++){var gc=Nb[Tb],pc=Ba.addRow();pc.setHeight(23);var Rc=pc.getCell(0);Rc.setValue(gc);gc=gc.getSubNodeLevel();var Lc=new KTCellTreeModel(gc);Lc.setExpanded(fb);!fb&&0<gc&&pc.setHide(!0);Rc.setTreeModel(Lc)}};this.newTableItemComponent=function(Ba){var fb=new Ja,Nb=fb.getJqUi();Nb.attr("table-name-component",V.encode(Ba.getName()));Nb.addClass("dm-source-db-table-list-item-component");Nb.data("object",
Ba);Nb.data("model",fb);fb.addCheckedListener(ld);return fb};this.newTableItemComponentWithRadio=function(Ba){var fb=new hb,Nb=fb.getJqUi();Nb.attr("table-name-component",V.encode(Ba.getName()));Nb.addClass("dm-source-db-table-list-item-component");Nb.data("object",Ba);Nb.data("model",fb);M.addElement(fb);return fb};var fa=function(Ba){Ba=$(Ba.currentTarget);var fb=V.decode(Ba.attr("table-name")),Nb=V.decode(Ba.attr("parent-name"));if("dpp"===a.getSource().getTypeName()){var Tb=V.decode(Ba.attr("table-type")),
gc=V.decode(Ba.attr("associateName"));a.getSource().setModelId(gc);a.getSource().setModelType(Tb);y[gc]=Tb}q!=fb&&(R(fb,Nb),a.doCheckBox(Ba))};this.doCheckBox=function(){};var R=function(Ba,fb){q&&K(!1);(q=Ba)&&K(!0);E.refreshPreviewSetting(Ba,function(){var Nb;null!=P&&0<P.length&&(Nb=h(Ba,fb));var Tb=Ka(Ba);Tb?(Tb=Tb.getFisrtEntity(),w(Tb,Ba)||Ma(Tb,Nb,Ba)):xa(Ba,fb)})},K=function(Ba){var fb=$(t.getJqUi()).parent().find("[table-name='"+V.encode(q)+"']"),Nb=fb.find(".dm-source-db-table-list-item-component"),
Tb=fb.find(".dm-source-db-table-item"),gc=Nb.data("object");gc&&(gc=gc.getType(),fb=fb.find(".dm-source-db-table-list-item-icon"),Ba?(Tb.addClass("dm-source-db-table-list-item_selected"),Bb.background(fb,gc+"_selected")):Ba||(a.unCheckBox(Nb),Tb.removeClass("dm-source-db-table-list-item_selected"),Bb.background(fb,gc)))};this.unCheckBox=function(Ba){};var xa=function(Ba,fb){E.getCheckBoxIsChecked()&&(Hb(null,null),sd(p.get("loadingPreviewData","\u6b63\u5728\u83b7\u53d6\u9884\u89c8\u6570\u636e\uff0c\u8bf7\u7a0d\u5019\u2026\u2026"),
f.find(".dm-source-db-table-selection-datapreviewarea"),10));var Nb=a.getSource();null!=P&&0<P.length&&(Nb=h(Ba,fb));var Tb={};Tb[Nb.getName()]=Nb;var gc=la.SuperQuery&&Nb instanceof la.SuperQuery;gc&&Nb.setQueryEntries(!0);fb=a.getCtxApi().createFacade(function(pc){var Rc=new nb;Rc.fromJsonObject(pc,Tb);if(gc){Nb.setQueryEntries(!1);pc=null;for(var Lc=0;Lc<z.length;Lc++){var Xc=z[Lc];if(Xc.getName()==Ba){pc=Xc.getDisplayName();break}}if(pc&&(Lc=Rc.getFisrtEntity(),Lc.setAlias(pc),Xc=Rc.getEntities(),
null!=Xc))for(var id=1;id<Xc.length;id++){Lc=Xc[id];var $c=pc+"_"+Lc.getAlias();Lc.setAlias($c)}}ca&&ca(Rc);pc=Rc.getFisrtEntity();w(pc,Ba)||(Lc=a.protectedGetHasSelectedDataObjectCacheKey(Ba),D[Lc]=Rc,Ma(pc,Nb,Ba))},function(pc,Rc){gc&&Nb.setQueryEntries(!1);var Lc=pc.toString();if("20"==Lc.substr(0,2)&&7==Lc.length&&209E4!=pc){if("20612"==Lc.substr(0,5)||"20622"==Lc.substr(0,5))return!1;qd(f.find(".dm-source-db-table-selection-datapreviewarea"));c.getMessageCurtain().showError(Rc);return!0}if("31"==
Lc.substr(0,2)){if(3101018==pc)return N(Ba,p.get("modelDestroyedUnableToSelect","\u8be5\u6a21\u578b\u5df2\u635f\u574f\uff0c\u65e0\u6cd5\u88ab\u9009\u4e2d\u3002")),!0;if(3101022==pc)return N(Ba,p.get("modelNotExisted","\u8be5\u6a21\u578b\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u65e0\u6cd5\u88ab\u9009\u4e2d\u3002")),!0}else return!1});fb.setShowBlocking(!1);fb.getDesigntimeDataObject(Nb.toJsonObject(),Ba)},Ka=function(Ba){Ba=a.protectedGetHasSelectedDataObjectCacheKey(Ba);return D[Ba]};
this.protectedGetHasSelectedDataObjectCacheKey=function(Ba){return Ba};var w=function(Ba,fb){return 0==Ba.getProperties().length?(N(fb,p.get("noDataAndUnableToSelect","\u8be5\u8868\u6ca1\u6709\u6570\u636e\uff0c\u65e0\u6cd5\u88ab\u9009\u4e2d\u3002")),!0):!1},N=function(Ba,fb){c.getMessageCurtain().showPrompt(fb);Ba=d.find("[table-name='"+V.encode(Ba)+"']");var Nb=Ba.find(".dm-source-db-table-list-item-component"),Tb=Nb.data("model");Tb&&(Tb.setChecked(!1),Tb.setEnabled(!1));Ba.find(".dm-source-db-table-list-item-text").css("color",
"#c0c0c0");Ba=Nb.data("object");for(var gc in x)Ba==x[gc]&&x.splice(gc,1);fd();Hb(null,null);sd(fb,f.find(".dm-source-db-table-selection-datapreviewarea"),10)},qa=function(Ba,fb,Nb,Tb){c.getMessageCurtain().hide(!0);Ba>=G&&(qd(f.find(".dm-source-db-table-selection-datapreviewarea")),Ba=new pb,fb&&Ba.fromJsonObject(fb),Ba&&Ba.getWarmingMessage()&&c.getMessageCurtain().showPrompt(Ba.getWarmingMessage(),-1),E.getCheckBoxIsChecked()&&Hb(Nb,Ba.getData(),Tb))},Ma=function(Ba,fb,Nb){if(E.getCheckBoxIsChecked()){Hb(null,
null);var Tb=sd(p.get("loadingPreviewData","\u6b63\u5728\u83b7\u53d6\u9884\u89c8\u6570\u636e\uff0c\u8bf7\u7a0d\u5019\u2026\u2026"),f.find(".dm-source-db-table-selection-datapreviewarea"),10);G=Tb;var gc=Rb(Ba),pc=jb[Ba.getName()];if(pc)setTimeout(function(){qa(Tb,pc,gc,fb)},100);else{var Rc=fb?fb.toJsonObject():a.getSource().toJsonObject(),Lc=a.getCtxApi().createFacade(function(Xc){jb[Ba.getName()]=Xc;qa(Tb,Xc,gc,fb,Nb)},function(Xc,id,$c){qd(f.find(".dm-source-db-table-selection-datapreviewarea"));
$c=Xc.toString();if("20"==$c.substr(0,2)&&7==$c.length){if("20612"==$c.substr(0,5)||"20622"==$c.substr(0,5))return!1;if(2020106==Xc)return c.getMessageCurtain().showPrompt(p.get("noDBCenterPermission","\u6ca1\u6709\u6570\u636e\u4e2d\u5fc3\u6743\u9650\uff0c\u8bf7\u5148\u8054\u7cfb\u7ba1\u7406\u5458\u5206\u914d\u6743\u9650\u3002")),!0;if(2040004==Xc&&-1<id.indexOf("Too many tables; MySQL can only use 61 tables in a join"))return c.getMessageCurtain().showPrompt(p.get("tooManyTablesCanNotPreviewError",
"\u5f53\u524d\u5b9e\u4f53\u5173\u8054\u7684\u6570\u636e\u8868\u8fc7\u591a\uff0c\u4e0d\u80fd\u6b63\u5e38\u9884\u89c8\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u8fdb\u5165\u201c\u4e0b\u4e00\u6b65\u201d\u51cf\u5c11\u6570\u636e\u8868\u7684\u5173\u8054\u6570\u91cf\u3002")),!0}else if("21"==$c.substr(0,2)){if(2101019==Xc)return N(Nb,p.get("modelUnAvailable","\u6ca1\u6709\u8be5\u6a21\u578b\u7684\u8fd0\u884c\u6743\u9650\uff0c\u65e0\u6cd5\u88ab\u9009\u4e2d\u3002")),!0}else if("31"==$c.substr(0,2)){if(3101018==Xc)return N(Nb,
p.get("modelDestroyedUnableToSelect","\u8be5\u6a21\u578b\u5df2\u635f\u574f\uff0c\u65e0\u6cd5\u88ab\u9009\u4e2d\u3002")),!0}else return!1});Lc.setShowBlocking(!1);Lc.previewData([gc.toJsonObject()],[Rc],11)}}},Hb=function(Ba,fb,Nb,Tb){qd(f.find(".dm-source-db-table-selection-datapreviewarea"));Tb=E.getPreviewTable();if(!a.getCtxApi().isFinished()){Ab.clear(Tb);if(Ba){for(var gc=Ab.createHeadRow(Tb),pc=Ba.getProperties(),Rc=pc.length,Lc=[],Xc=0;Xc<Rc;Xc++){var id=pc[Xc],$c=id.getOutputDataType(),md=
$c==Jb.DT_INT||$c==Jb.DT_NUMBER,nd=Tb.addColumn(id.getName());nd.setStyle(Ab.getColumnStyle(md));nd.setWidth(Ic($c));gc.getCell(Xc).setValue(id.getAlias());Lc[Xc]=Yb.createFormater($c,id.getFormatString())}gc=fb.length;Xc=0;for(Rc=Math.min(gc,10);Xc<Rc;Xc++)for($c=fb[Xc],md=Ab.createRow(Tb),nd=0;nd<$c.length;nd++){var td=(0,Lc[nd])($c[nd]);id=pc[nd];id.getEnumValue()&&(id=id.getEnumValue(),id[td]&&(td=id[td]));md.getCell(nd).setValue(td)}fb=10<gc;pc=pc.length>=zb.PREVIEW_LIMITED_COLS;0==gc?(fb=p.get("noData",
"\u6ca1\u6709\u6570\u636e"),Ac(fb)):fb||pc?!fb&&pc?(fb=p.get("totalRows","\u603b\u5171#1\u884c\u6570\u636e").replace("#1",gc),fb+=p.get("previewTipsComma",",")+p.get("dataShownCols","\u4ec5\u9884\u89c8\u524d#1\u5217\u6570\u636e").replace("#1",zb.PREVIEW_LIMITED_COLS),Ac(fb,gc)):(fb&&!pc?(Ac(p.get("loadingTotalRows","\u6b63\u5728\u8ba1\u7b97\u603b\u884c\u6570\uff0c\u8bf7\u7a0d\u5019....")),fb=p.get("dataShownRows","\u4ec5\u9884\u89c8\u524d#1\u884c\u6570\u636e").replace("#1",10)):(Ac(p.get("loadingTotalRows",
"\u6b63\u5728\u8ba1\u7b97\u603b\u884c\u6570\uff0c\u8bf7\u7a0d\u5019....")),fb=p.get("dataShownRowsAndCols","\u4ec5\u9884\u89c8\u524d#1\u884c\u3001\u524d#2\u5217\u6570\u636e"),fb=fb.replace("#1",10),fb=fb.replace("#2",zb.PREVIEW_LIMITED_COLS)),Yc(Ba,fb,Nb)):(fb=p.get("totalRows","\u603b\u5171#1\u884c\u6570\u636e").replace("#1",gc),Ac(fb,gc))}Ab.refresh(Tb)}},Rb=function(Ba){Ba=Ba.cloneMe();var fb=Ba.getProperties();fb.length>zb.PREVIEW_LIMITED_COLS&&fb.splice(zb.PREVIEW_LIMITED_COLS);return Ba},Ic=
function(Ba){switch(Ba){case Jb.DT_INT:case Jb.DT_NUMBER:return 90;case Jb.DT_DATE:return 80;case Jb.DT_DATETIME:return 130;case Jb.DT_BOOLEAN:return 40;default:return 120}},Yc=function(Ba,fb,Nb){var Tb=Qb[Ba.getName()];Tb?g(Ba,fb,Tb):(Nb=Nb?Nb.toJsonObject():a.getSource().toJsonObject(),Tb=a.getCtxApi().createFacade(function(gc){Qb[Ba.getName()]=gc;g(Ba,fb,gc)},function(gc,pc){var Rc=gc.toString();if("20"==Rc.substr(0,2)&&7==Rc.length&&209E4!=gc){if("20612"==Rc.substr(0,5)||"20622"==Rc.substr(0,
5))return!1;2040005==gc?Ac(pc):(fb=p.get("loadingTotalRowsError","\u83b7\u53d6\u603b\u884c\u6570\u5931\u8d25"),Ac(fb));return!0}return!1}),Tb.setShowBlocking(!1),Tb.getDataCount([Ba.toJsonObject()],[Nb]))},Ac=function(Ba,fb){aa.sTips=Ba;aa.iDataCount=fb;var Nb=E.getPreviewTable(),Tb=10;fb&&10>fb&&(Tb=fb);Nb.getRowsCount()-Ab.getHeadRowCount()==Tb||0==Nb.getRowsCount()-Ab.getHeadRowCount()?(fb=Ab.createRow(Nb),fb.getCell(0).setValue(Ba),Ba=new KTStyle,Ba.setBackgroundColor(com.kingdee.bos.qing.common.CommonTableSkin.ODD_ROW_BACKGROUND_COLOR),
fb.setStyle(Ba),Ba=new KTStyle,Ba.setTextAlign("left"),fb.getCell(0).setStyle(Ba),Ab.refresh(Nb)):Nb.getRowsCount()-Ab.getHeadRowCount()==Tb+1&&(fb=Nb.getRowsCount()-1,Nb.getRow(fb).getCell(0).setValue(Ba),Ab.refresh(Nb))},Zc=function(Ba,fb){Ba=Ba.getJqUi().data("object");fb&&(x=[Ba])},ld=function(Ba,fb){var Nb=Ba.getJqUi().data("object");if(fb)if(Ba.isChecked())(null==x||0>x.indexOf(Nb))&&x.push(Nb);else for(var Tb in x)Nb==x[Tb]&&x.splice(Tb,1);fd()},fd=function(){m.empty();if(0<x.length){var Ba=
$(document.createDocumentFragment()),fb;for(fb in x){var Nb=Ba,Tb=Nb.append,gc=x[fb],pc=$("<div>"),Rc=gc.getDisplayName(),Lc=gc.getCommentInfo(),Xc=Rc+"("+Lc+")",id=b.find(".sa-ctrl-switcher-thumb").parent();pc.addClass("dm-source-db-table-selected-list-item");pc.attr("table-name",V.encode(gc.getName()));pc.data("object",gc);pc.on("mouseenter",nc);pc.on("mouseleave",Oc);pc.css("margin-left",20);Lc=$("<div>");id.hasClass("sa-ctrl-switcher_on")?(pc.attr("title",Xc),Lc.text(Xc),Lc.attr("entity-coding",
Rc)):(pc.attr("title",Rc),id=gc.getName().indexOf("/"),null!=P&&0<P.length&&0<id?(gc=gc.getName().substring(0,id)+"_"+Rc,Lc.text(gc),pc.attr("title",gc)):Lc.text(Rc),Lc.attr("entity-coding",Xc));Lc.addClass("dm-source-db-table-selected-list-item-name");Lc.css("max-width","80%");gc=$("<div>");gc.addClass("dm-source-db-table-selected-list-item-icon");Bb.background(gc,"btn_delete");gc.on("click",jd);pc.append(gc);pc.append(Lc);Tb.call(Nb,pc)}m.append(Ba)}A.setText(p.get("selectedTable","\u5df2\u9009\u8868")+
"("+x.length+")");100<=x.length&&A.getJqUi().attr("title",p.get("selectedTable","\u5df2\u9009\u8868")+"("+x.length+")")},nc=function(Ba){$(Ba.currentTarget).find(".dm-source-db-table-selected-list-item-icon").css("display","block")},Oc=function(Ba){$(Ba.currentTarget).find(".dm-source-db-table-selected-list-item-icon").css("display","none")},jd=function(Ba){Ba=$(Ba.currentTarget).parent().data("object");for(var fb in x)Ba==x[fb]&&x.splice(fb,1);pd(Ba.getName());fd()},pd=function(Ba){(Ba=d.find("[table-name-component='"+
V.encode(Ba)+"']").data("model"))&&Ba.setChecked(!1)},qd=function(Ba){Ba.find(".dm-source-db-table-selection-waiting").remove()},sd=function(Ba,fb,Nb){qd(fb);var Tb=$("<div>");Tb.text(Ba);Tb.addClass("dm-source-db-table-selection-waiting");Tb.css("top",Nb);Tb.appendTo(fb);return(new Date).getTime()},ud=function(Ba){Ba?Oa.addWindowResizeListener("updatePreviewTableHandler",function(){E&&Ab.refresh(E.getPreviewTable());aa&&aa.sTips&&aa.iDataCount&&Ac(aa.sTips,aa.iDataCount)}):Oa.removeWindowResizeListener("updatePreviewTableHandler")}}
function U(){var e=this,h,g,a;this.getJqUi=function(){if(!h){h=$("<div>");h.addClass("dm-source-db-table-selection-center");e.protectedCustomPriviewSetting(h);a=Ab.createTable();var c=$(a.getUI());c.addClass("dm-source-db-table-selection-datapreviewarea");h.append(c)}return h};this.setSelectedDataObjectName=function(c){g=c};this.getSelectedDataObjectName=function(){return g};this.getPreviewTable=function(){return a};this.relayoutViews=function(){a.relayoutViews()};this.refreshPreviewSetting=function(c,
k){k()};this.getCheckBoxIsChecked=function(){throw Error("Override me");};this.protectedCustomPriviewSetting=function(c){throw Error("Override me");}}function wc(){U.call(this);var e,h;this.setEnablePreviewFunction=function(g){h=g};this.protectedCustomPriviewSetting=function(g){var a=p.get("priview","\u9884\u89c8"),c=(new ba(a)).getJqUi();c.attr("title",a);c.addClass("dm-source-db-table-selection-priviewlabel");a=p.get("enablePriview","\u542f\u7528\u9884\u89c8");e=new Ja;e.setText(a);e.setChecked(!0);
e.addCheckedListener(h);var k=e.getJqUi();k.attr("title",a);k.addClass("dm-source-db-table-selection-priviewcheckbox");g.append(c);g.append(k)};this.getCheckBoxIsChecked=function(){return e.isChecked()}}function zc(){Kb.call(this);var e=this,h=this.protectedMethod,g=0,a,c,k,d,f=[],b,r={},m={},t={},A=[],E={},M=[],z,H,x,q,D,G=Db.BizSourceTypeContext,ca;this.setRelationPropName=function(u){ca=u};this.getSubTitle=function(){return p.get("selectField","\u9009\u62e9\u5b57\u6bb5")};this.setFieldSelectChangeListener=
function(u){q=u};this.setDefaultCheckEntityMap=function(u){H=u};this.setAllFieldSearchBoxPlaceholder=function(u){for(var L in E)E.hasOwnProperty(L)&&E[L].setFieldSearchBoxPlaceholder(u)};this.protectedCreateUi=function(){z=$("<div>");c=$("<div>");var u=(new ba(p.get("selected","\u5df2\u9009"))).getJqUi();u.addClass("dm-source-db-field-selection-tablelabel");c.append(u);a=new W;a.setItemHeight(26);u=a.getJqUi();u.addClass("dm-source-db-field-selection-table-area");c.append(u);e.getSource().isShowEntityMark()&&
"dpp"!==e.getSource().getTypeName()&&(u=new xc,u.setJqLeftPane(c),u.displayEntityCodingPane(".dm-source-db-field-table-list-item-text",".dm-fieldselection-checkbox-text",p.get("displayFieldMark","\u663e\u793a\u5b9e\u4f53/\u5b57\u6bb5\u6807\u8bc6"),".dm-source-db-field-table-list-item",e.setAllFieldSearchBoxPlaceholder),D=u);Ia=c;k=$("<div>");k.addClass("dm-source-db-field-selection-right");x=$("<div>");x.addClass("dm-source-db-field-selection-field-area");k.append(x);u=new X;u.setHorizontalSplit(!0);
u.setEnabled(!0);u.setFirstSize(200,185,300);u.setSecondSize(700,-1,-1);u.setResizeMode(X.RESIZE_MODE_SECOND_FIXED);u.setFirstChild(X.createChildWrapper(c));u.setSecondChild(X.createChildWrapper(k));z.append(u.getJqUi());return z};this.intoThisStep=function(u,L){if(!L){d="";f=[];r={};A=[];E={};b=u.getSelectedDataObjectMap();for(var C in b)if(L=b[C]){u=L.getEntityMap();if(L=L.getRelations())for(var Q in L)A.push(L[Q]);for(var fa in u){L=u[fa];f.push(L);var R=L.getAssociateName();r[R]=L;m[R]=y(L)}}a.getJqUi().empty();
a.setItemCount(f.length);a.setItemUiCreator(Qb);a.repaint();Ca(f[0].getAssociateName())}};var y=function(u){var L=u.getAssociateName();return H?null!=H[L]:la.SuperQuery&&e.getSource()instanceof la.SuperQuery?null==u.findProperty("_pid"):!u.isSubNodeAtView()};this.checkEntityAndField=function(u){var L=[],C;for(C in f){var Q=f[C].getAssociateName();m[Q]&&L.push(f[C])}0===L.length?(u(!1),h.getMessageCurtain().showPrompt(p.get("selectATable","\u8bf7\u81f3\u5c11\u9009\u4e2d\u4e00\u4e2a\u6570\u636e\u8868\u3002"))):
P(L,0,u)};var P=function(u,L,C){if(L>=u.length)C(!0);else{var Q=u[L],fa=Q.getAssociateName(),R=E[fa];if(R){R=R.getSelectedFieldName();var K=[];for(Ka in A){var xa=A[Ka];xa.getFromEntity().getAssociateName()==fa?(xa=xa.getFromProperty().getName(),0>K.indexOf(xa)&&K.push(xa)):xa.getToEntity().getAssociateName()==fa&&(xa=xa.getToProperty().getName(),0>K.indexOf(xa)&&K.push(xa))}var Ka=!1;for(var w in R)if(0>K.indexOf(R[w])){Ka=!0;break}if(!Ka){0==K.length?1==u.length?h.getMessageCurtain().showPrompt(p.get("atLeastSelectAField",
"\u81f3\u5c11\u9009\u4e2d\u4e00\u4e2a\u5b57\u6bb5\u3002")):h.getMessageCurtain().showPrompt(p.get("ensureHasSelectedField","\u8bf7\u786e\u4fdd\u6bcf\u4e2a\u6570\u636e\u8868\u90fd\u6709\u9009\u4e2d\u5b57\u6bb5\u3002")):h.getMessageCurtain().showPrompt(p.get("ensureHasSelectedFieldWithLock","\u8bf7\u786e\u4fdd\u6bcf\u4e2a\u6570\u636e\u8868\u9664\u9501\u5b9a\u7684\u5173\u8054\u5b57\u6bb5\u5916\uff0c\u81f3\u5c11\u6709\u4e00\u4e2a\u9009\u4e2d\u5b57\u6bb5\u3002"));C(!1);d!=fa&&Ca(fa);return}}else if(!H||
!H[fa]){1==u.length?h.getMessageCurtain().showPrompt(p.get("atLeastSelectAField","\u81f3\u5c11\u9009\u4e2d\u4e00\u4e2a\u5b57\u6bb5\u3002")):h.getMessageCurtain().showPrompt(p.get("ensureHasSelectedField","\u8bf7\u786e\u4fdd\u6bcf\u4e2a\u6570\u636e\u8868\u90fd\u6709\u9009\u4e2d\u5b57\u6bb5\u3002"));C(!1);d!=fa&&Ca(fa);return}Q=aa(Q);w=0;if(null!=Q)for(R=0;R<Q.length;R++)Q[R].isCalculatingField()||w++;Vc.checkFieldNum(w,h.getMessageCurtain(),function(N){N?P(u,L+1,C):(C(!1),d!=fa&&Ca(fa))})}};this.outThisStep=
function(u,L){u?(g=0,L&&L(null)):e.checkEntityAndField(function(C){C&&"relationDiff"!=e.protectedGetNextStep()&&L&&L(e.protectedGetNextStep())})};this.protectedGetNextStep=function(){return null};this.isLastStep=function(){return!0};this.getCheckedCloneEntities=function(){var u=[],L={},C;for(C in f){var Q=f[C];if(m[Q.getAssociateName()]){var fa=Q.getParentEntity();fa?(fa=L[fa.getName()],Q=Q.cloneMe(fa)):Q=Q.cloneMe(null);L[Q.getName()]=Q;fa=aa(Q);Q.setProperties(fa);u.push(Q)}}return u};this.getCheckedEntities=
function(){var u=[],L;for(L in f){var C=f[L];if(m[C.getAssociateName()]){u.push(C);var Q=aa(C);C.setProperties(Q)}}e.protectedHandleEntities(u);return u};this.protectedHandleEntities=function(u){};this.getAllInnerRelations=function(){return A};this.getValidRelation4CheckedEntity=function(){var u=[],L;for(L in A){var C=A[L],Q=C.getFromEntity(),fa=C.getToEntity();m[Q.getAssociateName()]&&m[fa.getAssociateName()]&&u.push(C)}return u};this.over=function(u){if(u&&0==g){g=1;for(u=0;u<M.length;u++){var L=
M[u];e.getSource().addStoredProcedure(L)}e.getCtxApi().finish(e.getCheckedEntities(),e.getValidRelation4CheckedEntity());e.getCtxApi().refreshFinishFlag()}};this.setStoredProcedureModels=function(u){M=u};var aa=function(u){var L=u.getAssociateName(),C=[],Q=E[L];L=H?H[L]:null;if(Q){Q=Q.getSelectedFieldName();u=u.getProperties();for(var fa=u.length,R=0;R<fa;R++)0<=Q.indexOf(u[R].getName())&&C.push(u[R]);ca&&null!=L&&L.getProperties().forEach(function(K){K.isCalculatingField()&&C.push(K)})}else C=null!=
L?L.getProperties():u.getProperties();return C},jb=function(u,L){L=u.getJqUi().data("index");L=f[L];m[L.getAssociateName()]=u.isChecked();if(u.isChecked())for(u=L.getParentEntity();null!=u;){L=u.getAssociateName();var C=t[L];if(C.isChecked())break;else C.setChecked(!0),m[L]=!0}else for(u=(new ac).getEntityWithSubNodesUtil(L,f),u.splice(0,1),L=0;L<u.length;L++)C=u[L].getAssociateName(),m[C]=!1,t[C].setChecked(!1)},Qb=function(u){var L=f[u],C=L.getAssociateName(),Q=L.getAlias(),fa=L.getSubNodeLevel(),
R=c.find(".sa-ctrl-switcher-thumb").parent(),K=L.getCommentInfo();K=Q+"("+K+")";var xa=G.isBizSourceType(L.getSource().getTypeName()),Ka=$("<div>");Ka.addClass("dm-source-db-field-table-list-item");Ka.data("object",L);Ka.attr("table-name",V.encode(C));Ka.attr("title",Q);Ka.on("mousedown",wa);Ka.on("mouseenter",za);Ka.on("mouseleave",Na);var w=$("<div>"),N=dd.entity2IconName(L),qa=$("<div>");if(xa&&"dpp"!==e.getSource().getTypeName())return xa=$("<div>"),xa.addClass("dm-source-db-field-entity-table-list-item"),
e.newTableItemComponent(u,L,fa,xa,Ka),w.addClass("dm-source-db-field-table-list-item-icon"),Bb.background(w,N),qa.addClass("dm-source-db-field-table-list-item-text"),R.hasClass("sa-ctrl-switcher_on")?(Ka.attr("title",K),qa.text(K),qa.attr("entity-coding",Q)):(Ka.attr("title",Q),qa.text(Q),qa.attr("entity-coding",K)),Ka.append(w),Ka.append(qa),xa.append(Ka),""!=d&&d==C&&Ka.addClass("dm-source-db-field-table-list-item_selected"),xa;w.addClass("dm-source-db-field-table-list-item-icon");Bb.background(w,
N);qa.addClass("dm-source-db-field-table-list-item-text");R.hasClass("sa-ctrl-switcher_on")?(Ka.attr("title",K),qa.text(K),qa.attr("entity-coding",Q)):(Ka.attr("title",Q),qa.text(Q),qa.attr("entity-coding",K));Ka.append(w);Ka.append(qa);""!=d&&d==C&&Ka.addClass("dm-source-db-field-table-list-item_selected");return Ka};this.newTableItemComponent=function(u,L,C,Q,fa){var R=L.isSubNodeAtView(),K=new Ja;K.setUserObject(L);var xa=K.getJqUi();xa.data("model",K);xa.data("index",u);xa.addClass("dm-source-db-table-entity-list-item-checkbox");
K.setEnabled(R);la.SuperQuery&&e.getSource()instanceof la.SuperQuery&&K.setEnabled(!0);K.setChecked(y(L));K.addCheckedListener(jb);t[L.getAssociateName()]=K;R?(xa.css("margin-left",20*C),fa.css("margin-left",20*C+25)):fa.css("margin-left",25);Q.append(xa)};var za=function(u){$(u.currentTarget).find(".dm-source-db-field-table-list-item-menu").css("display","block")},Na=function(u){$(u.currentTarget).find(".dm-source-db-field-table-list-item-menu").css("display","none")},wa=function(u){u=$(u.currentTarget);
var L=V.decode(u.attr("table-name"));d!=L&&Ca(L);e.doSelectItem(u)};this.doSelectItem=function(u){};var Ca=function(u){d&&db(!1);(d=u)&&db(!0);x.detach();na(u)},db=function(u){var L=a.getJqUi().find("[table-name='"+V.encode(d)+"']"),C=L.data("object");if(C){var Q=L.find(".dm-source-db-field-table-list-item-icon"),fa=L.find(".dm-source-db-field-table-list-item-menu");C=dd.entity2IconName(C);u?(L.addClass("dm-source-db-field-table-list-item_selected"),Bb.background(Q,C+"_selected"),Bb.background(fa,
"delete_selected")):(L.removeClass("dm-source-db-field-table-list-item_selected"),Bb.background(Q,C),Bb.background(fa,"delete"))}},na=function(u){var L=r[u],C=L.getProperties();if(E[u])L=E[u],L.setAllField(C);else{var Q=[],fa=[],R;for(R in A){var K=A[R];K.getFromEntity().getAssociateName()==u?(K=K.getFromProperty().getName(),0>Q.indexOf(K)&&Q.push(K),0>fa.indexOf(K)&&fa.push(K)):K.getToEntity().getAssociateName()==u&&(K=K.getToProperty().getName(),0>Q.indexOf(K)&&Q.push(K),0>fa.indexOf(K)&&fa.push(K))}var xa=
[];if(R=H?H[u]:null){var Ka={};R.getProperties().forEach(function(N){N.getName()===Jb.CUSTOM_BIZ_ENTITY_NAME_FIELD||N.isCalculatingField()||(xa.push(N.getName()),Ka[N.getAssociateName()]=N)});if(ca){L.setName(R.getName());L.setAlias(R.getAlias());for(L=0;L<C.length;L++){K=C[L];var w=Ka[C[L].getAssociateName()];w&&(K.setAlias(w.getAlias()),K.setAppointedDataType(w.getAppointedDataType()),K.setFieldVisible(w.getFieldVisible()),K.setFormatString(w.getFormatString()))}ca[R.getName()].forEach(function(N){0>
fa.indexOf(N)&&fa.push(N)})}}else xa=Q.slice();L=new Gc;L.setAllField(C);L.setEntityAssociateName(u);L.setLockSelectedFieldNames(Q);L.setAllRelationPropNames(fa);L.setSelectedFieldName(xa);L.addFieldSelectChangeListener(function(N,qa,Ma){Ma&&(N=t[N])&&!N.isChecked()&&N.setChecked(!0)});q&&L.addFieldSelectChangeListener(q);E[u]=L}u=D?D.getSwitchButtonStatus():!1;L.setSwitchButtonStatus(u);k.empty();k.append(L.getJqUi())};h.doPressTableItem=wa;h.selectTable=Ca}function Gc(){var e=this,h,g,a,c=[],k=
[],d,f,b=[],r,m,t,A,E,M,z,H=[],x=!1,q,D,G,ca,y,P;this.getJqUi=function(){h=$("<div>");t=new Y;t.addSearchListener(Qb);t.setPlaceholder(e.getFieldSearchBoxPlaceholder(P));t.setShowSearchIcon(!0);m=t.getJqUi();m.addClass("dm-source-db-table-selection-searchbox");m.css("width","230px");h.append(m);n.layoutCtrlWithLRTB(m,17,0,null,0,null,23);var u=new Ja;u.setText(p.get("showOnlySelected","\u4ec5\u663e\u793a\u9009\u4e2d\u9879"));u.addCheckedListener(jb);u=u.getJqUi();h.append(u);n.layoutCtrlWithLRTB(u,
325,null,250,0,null,23);G=$("<div>");h.append(G);a=e.getSelectedFieldName();E=new ba;M=E.getJqUi();h.append(M);n.layoutCtrlWithLRTB(M,90,0,null,33,null,21);za();H=z=g;aa();h.append(A);return h};this.setChoiceField=function(u){ca=u};this.addFieldSelectChangeListener=function(u){b.push(u)};this.setEntityAssociateName=function(u){y=u};this.setSwitchButtonStatus=function(u){P=u};this.setFieldSearchBoxPlaceholder=function(u){t.setPlaceholder(e.getFieldSearchBoxPlaceholder(u))};this.getFieldSearchBoxPlaceholder=
function(u){return u?p.get("enterSearchField","\u641c\u7d22\u5b57\u6bb5\u540d\u79f0")+"/"+p.get("enterSearchFieldMark","\u5b57\u6bb5\u6807\u8bc6"):p.get("enterSearchField","\u641c\u7d22\u5b57\u6bb5\u540d\u79f0")};var aa=function(){G.empty();var u=!0,L=!1;q=x||t.getText().trim()?z.filter(function(qa){return-1<H.indexOf(qa)}):g;A?A.empty():A=$("<div>");var C=p.get("selectAll","\u5168\u9009");d=new Ja;d.setText(C);d.addCheckedListener(Na);f=d.getJqUi();f.addClass("dm-fieldselection-checkboxall");f.attr("title",
C);r=$("<div>");r.addClass("dm-fieldselection-checkbox-area");n.layoutCtrlWithLRTB(A,18,0,null,33,0,null);A.append(f);A.append(r);for(C=0;C<q.length;C++){var Q=q[C],fa=Q.getAlias(),R=Q.getName(),K=Q.getCommentInfo(),xa=fa+"("+K+")";K=$("<div>");K.addClass("dm-fieldselection-checkbox");K.attr("field-name",V.encode(R));var Ka=new Ja;Ka.setUserObject(Q);var w=Ka.getJqUi();w.addClass("dm-fieldselection-checkbox-icon");w.attr("field-name-checkbox",V.encode(R));w.data("model",Ka);c&&0<=c.indexOf(R)?Ka.setEnabled(!1):
(Ka.setEnabled(!0),Ka.addCheckedListener(wa));var N=$("<div>");null==Ia||ca?(N.text(fa),N.attr("entity-coding",xa)):Ia.find(".sa-ctrl-switcher-thumb").parent().hasClass("sa-ctrl-switcher_on")?(N.text(xa),N.attr("entity-coding",fa)):(N.text(fa),N.attr("entity-coding",xa));N.addClass("dm-fieldselection-checkbox-text");fa=$("<div>");fa.addClass("dm-fieldselection-checkbox-pic");Bb.background(fa,"relation");K.append(w);K.append(N);0<=k.indexOf(Q.getName())&&(K.append(fa),Q=$("<div>"),Q.addClass("dm-fieldselection-checkbox-warning"),
Q.text(p.get("theRalationWillBeDeletedWhenDeleteTheField","\u5220\u9664\u8be5\u5b57\u6bb5\u7684\u540c\u65f6\u4f1a\u5220\u9664\u5173\u7cfb")),K.append(Q),Q.hide());a&&0<=a.indexOf(R)?(L=!0,Ka.setChecked(!0)):u=!1;r.append(K)}d.setChecked(u&&L);0==q.length&&(u=new ba(p.get("nothingSearched","\u627e\u4e0d\u5230\u7b26\u5408\u7684\u7ed3\u679c")),u.setEnabled(!1),D=u.getJqUi(),n.layoutCtrlWithLRTB(D,18,0,null,60,null,16),G.append(D))},jb=function(u,L){x=u.isChecked();H=[];if(L){if(u.isChecked())for(H=[],
u=0;u<g.length;u++)0<=a.indexOf(g[u].getName())&&H.push(g[u]);else H=g;aa()}},Qb=function(u){var L=u.getJqUi();u=t.getText().trim();L=L.parents(".sa-ctrl-splitpane-part").siblings(".sa-ctrl-splitpane-part").find("#dm-field-popup-show-field-comment").find(".sa-ctrl-switcher-thumb").parent();z=[];if(u)for(var C in g){var Q=g[C];0<=Q.getAlias().toUpperCase().indexOf(u.toUpperCase())?z.push(g[C]):L.hasClass("sa-ctrl-switcher_on")&&0<=Q.getCommentInfo().toUpperCase().indexOf(u.toUpperCase())&&z.push(g[C])}else M&&
M.show(),z=g;aa()},za=function(){var u=a.length;u=p.get("selectedCount","(\u5df2\u9009\u62e9 #1 \u9879)").replace("#1",u);E.setText(u)};this.setAllField=function(u){g=u};this.getAllField=function(){return g};this.setSelectedFieldName=function(u){a=u};this.getSelectedFieldName=function(){return a};this.setLockSelectedFieldNames=function(u){c=u};this.setAllRelationPropNames=function(u){k=u};var Na=function(u,L){if(L){for(var C in q){L=q[C];var Q=!1;if(0>c.indexOf(L.getName())){var fa=db(L);fa.setChecked(u.isChecked());
var R=L.getName(),K=0<=a.indexOf(R);u.isChecked()&&!K?(a.push(R),Q=!0):!u.isChecked()&&K&&(a.splice(a.indexOf(R),1),Q=!0);na(fa)}Q&&Ca(y,L,u.isChecked())}za()}},wa=function(u,L){if(L){L=!0;var C=u.getUserObject();if(u.isChecked())a.push(C.getName());else for(var Q in a)a[Q]==C.getName()&&a.splice(Q,1);na(u);if(u.isChecked())for(var fa in q){if(!db(q[fa]).isChecked()){L=!1;break}}else L=!1;Ca(y,u.getUserObject(),u.isChecked());d.setChecked(L);za()}},Ca=function(u,L,C){for(var Q=0;Q<b.length;Q++)(0,b[Q])(u,
L,C)},db=function(u){return h.find("[field-name-checkbox='"+V.encode(u.getName())+"']").data("model")},na=function(u){var L=u.getUserObject().getName(),C=h.find("[field-name='"+V.encode(L)+"']").find(".dm-fieldselection-checkbox-warning");u.isChecked()?C.hide():0<=k.indexOf(L)?C.show():C.hide()}}function ad(){function e(R,K){KTDefaultCellRender.call(this,R);var xa=this;this.paintCellUI=function(Ka,w){var N=xa.getCell().getValue(),qa=N.getName(),Ma=N.getDisplayName();if(N instanceof Pa){var Hb=$("<div>");
Hb.addClass("dm-source-db-table-list-item");Hb.attr("table-name",V.encode(qa));Hb.attr("title",Ma);Hb.css("margin-left",20*N.getSubNodeLevel());var Rb=$("<div>");Rb.addClass("dm-source-db-table-list-item-text");Rb.css("left","16px");Rb.css("top","-2px");Rb.text(Ma);Hb.append(Rb);Ka=$(Ka);Ka.css("left","4px");Ka.append(Hb)}else{Hb=$("<div>");Hb.addClass("dm-source-db-table-list-item");Hb.css("margin-left","-16px");Hb.attr("table-name",V.encode(qa));Hb.attr("title",Ma);Hb.on("mousedown",Qb);var Ic=
h.newTableItemComponent(N),Yc=$("<div>");n.layoutCtrl(Yc,25,0,300,23);Yc.addClass("dm-source-db-table-item");var Ac=$("<div>");Ac.addClass("dm-source-db-table-list-item-icon");Bb.background(Ac,"stored-procedure");Rb=$("<div>");Rb.addClass("dm-source-db-table-list-item-text");Rb.text(Ma);Hb.append(Ic.getJqUi());Yc.append(Ac);Yc.append(Rb);Hb.append(Yc);for(var Zc in M)N==M[Zc]&&Ic.setChecked(!0);""!=z&&z==qa&&(Yc.addClass("dm-source-db-table-list-item_selected"),Bb.background(Ac,"stored-procedure_selected"));
Ka=$(Ka);Ka.css("overflow","visible");w?(w=$(w),w.css("overflow","visible"),Hb.appendTo(w)):Hb.appendTo(Ka)}n.layoutCtrlWithLRTB(Hb,0,0,null,0,0,null)}}Kb.call(this);var h=this,g=this.protectedMethod,a,c,k,d,f,b,r,m,t,A=[],E,M=[],z,H={},x={},q=!0;this.getSubTitle=function(){return p.get("selectStoredProcedure","\u9009\u62e9\u5b58\u50a8\u8fc7\u7a0b")};this.addDataObjectNode=function(R){A.push(R)};this.isMultiSelectable=function(){return!0};this.getDataObject=function(R){return x[R]};this.setArrSelectedDataObjectNode=
function(R){M=R};this.protectedCreateUi=function(){var R=$("<div>");a=$("<div>");d=$("<div>");a.append(d);f=$("<div>");f.addClass("dm-source-db-table-selection-right");var K=$("<div>");K.text(p.get("selectAStoredProcedure","\u8bf7\u9009\u4e2d\u4e00\u4e2a\u5b58\u50a8\u8fc7\u7a0b"));K.addClass("dm-source-db-table-selection-tips");K.appendTo(f);c=$("<div>");c.addClass("dm-source-db-table-selection-right");r=new ba;K=p.get("selectedStoredProcedure","\u5df2\u9009\u5b58\u50a8\u8fc7\u7a0b")+"("+M.length+
")";r.setText(K);r.getJqUi().addClass("dm-source-db-table-selection-selectedtablelabel");r.getJqUi().attr("title",K);K=(new ba(p.get("clearAll","\u6e05\u7a7a"))).getJqUi();K.addClass("dm-source-db-table-selection-clearalllabel");K.addClass("dm-source-db-table-selection-clearalllabel-color");K.on("mousedown",aa);b=$("<div>");b.addClass("dm-source-db-table-selected-table-area");c.append(r.getJqUi());c.append(K);c.append(b);K=D();R.append(K.getJqUi());return R};var D=function(){if(h.isMultiSelectable()){var R=
new X;R.setHorizontalSplit(!0);R.setEnabled(!0);R.setFirstSize(200,185,300);R.setSecondSize(520,0,-1);R.setResizeMode(X.RESIZE_MODE_FIRST_FIXED);R.setFirstChild(X.createChildWrapper(a,function(){t&&t.relayoutViews()}));R.setSecondChild(X.createChildWrapper(f,function(){t&&t.relayoutViews()}));var K=new X;K.setHorizontalSplit(!0);K.setEnabled(!0);K.setFirstSize(728,-1,-1);K.setSecondSize(200,185,300);K.setResizeMode(X.RESIZE_MODE_SECOND_FIXED);K.setFirstChild(R);K.setSecondChild(X.createChildWrapper(c,
function(){t&&t.relayoutViews()}));return K}R=new X;R.setHorizontalSplit(!0);R.setEnabled(!0);R.setFirstSize(200,185,300);R.setSecondSize(720,0,-1);R.setResizeMode(X.RESIZE_MODE_FIRST_FIXED);R.setFirstChild(X.createChildWrapper(a,function(){t&&t.relayoutViews()}));R.setSecondChild(X.createChildWrapper(f,function(){t&&t.relayoutViews()}));return R};this.intoThisStep=function(R,K){K||y()};this.outThisStep=function(R,K){q&&(R?K(null):0==M.length?(g.getMessageCurtain().showPrompt(p.get("selectAStoredProcedure",
"\u8bf7\u9009\u4e2d\u4e00\u4e2a\u5b58\u50a8\u8fc7\u7a0b\u3002")),K(h)):G(K))};this.isLastStep=function(){return!1};this.getNextStep=function(R){var K=new zc;K.setCtxApi(h.getCtxApi());K.setSource(h.getSource());K.setStoredProcedureModels(R);return K};var G=function(R){var K=!0,xa;for(xa in M)if(K){var Ka=M[xa].getName();if(void 0==x[Ka]){K=!1;var w=H[Ka],N=w.doCheckParameters();if(N){K=N.getPrompt();g.getMessageCurtain().showPrompt(K);za(Ka);return}N="dm"+(new Date).getTime();w.setName(N);var qa=
h.getSource().clone();qa.setName(h.getSource().getName());qa.addStoredProcedure(w);w=h.getCtxApi().createFacade(function(Ma){q=!0;var Hb={};Hb[qa.getName()]=qa;var Rb=new nb;Rb.fromJsonObject(Ma,Hb);x[Ka]=Rb;G(R)},function(Ma,Hb,Rb){q=!0;Rb=Ma.toString();return"20"==Rb.substr(0,2)&&7==Rb.length&&209E4!=Ma?(2020501==Ma&&(Hb=-1==Hb?p.get("notFindResult","\u6ca1\u6709\u83b7\u53d6\u5230\u5b58\u50a8\u8fc7\u7a0b#1\u7684\u7ed3\u679c\u96c6\u3002").replace("#1",Ka):p.get("notFindIdxResult","\u6ca1\u6709\u83b7\u53d6\u5230\u5b58\u50a8\u8fc7\u7a0b#1\u7b2c#2\u4e2a\u7684\u7ed3\u679c\u96c6\u3002").replace("#1",
Ka).replace("#2",Hb)),R(h),g.getMessageCurtain().showPrompt(Hb),!0):!1});w.setShowBlocking(!1);w.getDesigntimeDataObject(qa.toJsonObject(),N);q=!1}}K&&(K=ca(),R(h.getNextStep(K)))},ca=function(){for(var R=[],K=0;K<M.length;K++){var xa=M[K].getName(),Ka=x[xa],w=H[xa],N=Ka.getName();Ka=Ka.getFisrtEntity();for(var qa=xa,Ma=1;h.getCtxApi().isEntityAliasExist(qa);)qa=xa+"_"+Ma++;Ka.setAlias(qa);w.setName(N);R.push(w)}return R},y=function(){d.empty();fa(p.get("loadingData","\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019\u2026\u2026"),
d,20,30);var R=h.getSource().toJsonObject();h.getCtxApi().createFacade(function(K){var xa=new Pa;xa.fromJsonObject(K);K=xa.getChildren();for(xa=0;xa<K.length;xa++)jb(K[xa]);E=A;0<A.length&&(k=new Y,k.addSearchListener(P),k.setPlaceholder(p.get("enterSearchText","\u641c\u7d22\u5b9e\u4f53\u540d\u79f0")),k.setShowSearchIcon(!0),K=k.getJqUi(),K.addClass("dm-source-db-table-selection-searchbox"),a.prepend(K));P(!0)},function(K,xa){var Ka=K.toString();if("20"==Ka.substr(0,2)&&7==Ka.length&&209E4!=K){if(2020502==
K){var w=p.get("dbStoredProcedureNameRepeat","\u68c0\u6d4b\u5230\u5b58\u5728\u91cd\u590d\u7684\u5b58\u50a8\u8fc7\u7a0b\u540d\u79f0\uff0c\u8bf7\u786e\u4fdd\u5b58\u50a8\u8fc7\u7a0b\u540d\u79f0\u4e0d\u91cd\u590d\u3002");fa(w,d,20,0);setTimeout(function(){g.getMessageCurtain().showError(w)},100)}else g.getMessageCurtain().showError(xa);return!0}return!1}).getStoredProcedures(R)},P=function(R){E=[];var K,xa=$(".sa-ctrl-switcher-thumb").parent();k&&(K=k.getText().trim());if(K)for(var Ka in A){var w=A[Ka];
w instanceof ua&&0<=w.getDisplayName().toUpperCase().indexOf(K.toUpperCase())?E.push(A[Ka]):xa.hasClass("sa-ctrl-switcher_on")&&0<=w.getCommentInfo().toUpperCase().indexOf(K.toUpperCase())&&E.push(A[Ka])}else E=A;d.empty();if(0==E.length)m&&m.remove(),R=new ba(p.get("nothingSearched","\u627e\u4e0d\u5230\u7b26\u5408\u7684\u7ed3\u679c")),R.setAlign(ba.ALIGN_CENTER),R=R.getJqUi(),R.addClass("dm-source-db-table-selection-table-area-prompt"),d.append(R);else{xa=$("<div>");xa.addClass("dm-source-db-table-selection-table-area");
K=K?!0:!1;Ka=new KTable;w=$(Ka.getUI());w.children().css("overflow-x","hidden");Ka.setCellRender(new e(Ka,!0));Ka.setSyncUIWhenModelChanged(!1);Ka.addColumn().setWidth(300);var N=E;if(0!=N.length)for(var qa=0;qa<N.length;qa++){var Ma=N[qa],Hb=Ka.addRow();Hb.setHeight(23);var Rb=Hb.getCell(0);Rb.setValue(Ma);Ma=K?0:Ma.getSubNodeLevel();Ma=new KTCellTreeModel(Ma);Ma.setExpanded(!1);0<Ma.getLevel()&&Hb.setHide(!0);Rb.setTreeModel(Ma)}Ka.updateUI();xa.append(w);d.append(xa);if(1==A.length&&1==R){R=A[0];
xa=R.getName();if(K=$(k.getJqUi()).parent().find("[table-name='"+V.encode(xa)+"']").find(".dm-source-db-table-list-item-component").data("model"))K.setChecked(!0),h.defaultSelectTableWhenInit(R),na();za(xa)}}};this.defaultSelectTableWhenInit=function(R){0==M.length&&M.push(R)};this.getSelectedDataObjectMap=function(){var R={},K;for(K in M){var xa=M[K].getName();R[xa]=x[xa]}return R};var aa=function(){for(var R in M)Q(M[R].getName());M=[];na()},jb=function(R){A.push(R);if(R instanceof Pa&&(R=R.getChildren()))for(var K=
0;K<R.length;K++)jb(R[K])};this.newTableItemComponent=function(R){var K=new Ja,xa=K.getJqUi();xa.attr("table-name-component",V.encode(R.getName()));xa.addClass("dm-source-db-table-list-item-component");xa.data("object",R);xa.data("model",K);K.addCheckedListener(db);return K};var Qb=function(R){R=$(R.currentTarget);var K=V.decode(R.attr("table-name"));za(K);h.doCheckBox(R)};this.doCheckBox=function(){};var za=function(R){z!=R&&(z&&Na(!1),(z=R)&&Na(!0),f.empty(),wa(R))},Na=function(R){var K=$(k.getJqUi()).parent().find("[table-name='"+
V.encode(z)+"']"),xa=K.find(".dm-source-db-table-list-item-component"),Ka=K.find(".dm-source-db-table-item");xa.data("object")&&(K=K.find(".dm-source-db-table-list-item-icon"),R?(Ka.addClass("dm-source-db-table-list-item_selected"),Bb.background(K,"stored-procedure_selected")):(Ka.removeClass("dm-source-db-table-list-item_selected"),Bb.background(K,"stored-procedure")))},wa=function(R){fa(p.get("loadingPreviewData","\u6b63\u5728\u83b7\u53d6\u9884\u89c8\u6570\u636e\uff0c\u8bf7\u7a0d\u5019\u2026\u2026"),
f,-4,0);var K=H[R];K?(t=new S,t.setInitValue(K,h.getSource(),h.getCtxApi().createFacade,g.getMessageCurtain()),t.setCallbackDesignTimeDataObject(Ca),f.empty(),f.append(t.getJqUi()),t.refreshTable()):(K=h.getCtxApi().createFacade(function(xa){for(var Ka=[],w=0;w<xa.length;w++){var N=new Fb;N.fromJsonObject(xa[w]);Ka.push(N)}xa=new Ua;xa.setAssociateName(R);xa.setParameters(Ka);Ka="dm"+(new Date).getTime();xa.setName(Ka);H[R]=xa;t=new S;t.setInitValue(xa,h.getSource(),h.getCtxApi().createFacade,g.getMessageCurtain());
t.setCallbackDesignTimeDataObject(Ca);f.empty();f.append(t.getJqUi());t.refreshTable()},function(xa,Ka){var w=xa.toString();return"20"==w.substr(0,2)&&7==w.length&&209E4!=xa?(m&&m.remove(),g.getMessageCurtain().showError(Ka),!0):!1}),K.setShowBlocking(!1),K.getStoredProcedureParameters(h.getSource().toJsonObject(),R))},Ca=function(R,K){x[R]=K},db=function(R,K){var xa=R.getJqUi().data("object");if(K)if(R.isChecked())(null==M||0>M.indexOf(xa))&&M.push(xa);else for(var Ka in M)xa==M[Ka]&&M.splice(Ka,
1);na()},na=function(){b.empty();if(0<M.length){var R=$(document.createDocumentFragment()),K;for(K in M){var xa=R,Ka=xa.append,w=M[K],N=$("<div>"),qa=w.getName(),Ma=w.getDisplayName();qa=qa+"("+Ma+")";var Hb=a.find(".sa-ctrl-switcher-thumb").parent();N.addClass("dm-source-db-table-selected-list-item");N.attr("table-name",V.encode(w.getName()));N.data("object",w);N.on("mouseenter",u);N.on("mouseleave",L);N.css("margin-left",20);w=$("<div>");Hb.hasClass("sa-ctrl-switcher_on")?(N.attr("title",qa),w.text(qa),
w.attr("entity-coding",Ma)):(N.attr("title",Ma),w.text(Ma),w.attr("entity-coding",qa));w.addClass("dm-source-db-table-selected-list-item-name");Ma=$("<div>");Ma.addClass("dm-source-db-table-selected-list-item-icon");Bb.background(Ma,"btn_delete");Ma.on("click",C);N.append(Ma);N.append(w);Ka.call(xa,N)}b.append(R)}r.setText(p.get("selectedStoredProcedure","\u5df2\u9009\u5b58\u50a8\u8fc7\u7a0b")+"("+M.length+")");100<=M.length&&r.getJqUi().attr("title",p.get("selectedStoredProcedure","\u5df2\u9009\u5b58\u50a8\u8fc7\u7a0b")+
"("+M.length+")")},u=function(R){$(R.currentTarget).find(".dm-source-db-table-selected-list-item-icon").css("display","block")},L=function(R){$(R.currentTarget).find(".dm-source-db-table-selected-list-item-icon").css("display","none")},C=function(R){R=$(R.currentTarget).parent().data("object");for(var K in M)R==M[K]&&M.splice(K,1);Q(R.getName());na()},Q=function(R){(R=d.find("[table-name-component='"+V.encode(R)+"']").data("model"))&&R.setChecked(!1)},fa=function(R,K,xa,Ka){m&&m.remove();m=$("<div>");
m.text(R);m.addClass("dm-source-db-table-selection-waiting");m.css("top",xa);m.css("left",Ka);m.appendTo(K)}}function lc(){Kb.call(this);var e=this,h=this.protectedMethod,g,a,c,k,d,f=!1;this.setSqlType=function(b){a=b};this.setAlias=function(b){d=b};this.setIsShowTips=function(b){f=b};this.setUserSqlObj=function(b){k=b};this.getSubTitle=function(){return p.get("customSql","\u81ea\u5b9a\u4e49")+a};this.protectedCreateUi=function(){c=new yc;if(void 0==k){var b=new Tc;b.setSqlType(a)}else b=k,e.setSqlType(k.getSqlType()),
c.setAlias(d),c.setReadonly(!0);c.setIsShowTips(f);c.setUserSqlObjModel(b);c.setFacadeCreator(e.getCtxApi().createFacade);c.setMessageCurtain(h.getMessageCurtain());return c.getJqUi()};this.getNextStep=function(b){return null};this.intoThisStep=function(b,r){};this.outThisStep=function(b,r){if(b)h.getTopJqUi()&&h.getTopJqUi().remove(),r(null);else if(b=c.check())h.getMessageCurtain().showPrompt(b);else{var m=e.getSource().clone();m.setName(e.getSource().getName());c.asynGetUserSqlObjModel(function(t){m.addUserSql(t);
c.getDesigntimeDataObject(m,t.getName(),h.getMessageCurtain(),e.getCtxApi().createFacade,function(A,E){for(var M=E,z=1;e.getCtxApi().isEntityAliasExist(M);)M=E+"_"+z++;E={};E[e.getSource().getName()]=e.getSource();z=new nb;z.fromJsonObject(A,E);A=z.getFisrtEntity();A.setAlias(M);g=[A];e.isLastStep()&&e.getSource().addUserSql(t);r(e.getNextStep(t))})})}};this.isLastStep=function(){return!0};this.getArrEntity=function(){return g};this.over=function(b){b&&e.getCtxApi().finish(g,[])}}function yc(){var e,
h,g,a,c,k=!1,d,f,b=!1,r,m,t;this.getJqUi=function(){e||A();return e};this.setMessageCurtain=function(z){t=z};this.asynGetUserSqlObjModel=function(z){var H=new Tc;H.setSqlType(f.getSqlType());if(f.getName())H.setName(f.getName());else{var x="dm"+(new Date).getTime();H.setName(x)}var q=dc.getAllImpl(),D=c.val(),G=0,ca=q.length,y=function(P){D=P;G++;G<ca?q[G].switchSQLToPersistentMode(D,y):(H.setContent(D),z(H))};q[G].switchSQLToPersistentMode(D,y)};this.setFacadeCreator=function(z){m=z};this.setUserSqlObjModel=
function(z){f=z};this.setIsShowTips=function(z){b=z};this.setAlias=function(z){d=z};this.check=function(){if(""==h.getText())return p.get("inputNameNotNull","\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\u3002");var z=c.val();for(var H="",x=!1,q=!1,D=0;D<z.length;D++){var G=z.charAt(D);x?"\n"===G&&(x=!1):q?"*"===G&&D+1<z.length&&"/"===z.charAt(D+1)&&(q=!1,D++):"-"===G&&D+1<z.length&&"-"===z.charAt(D+1)?(x=!0,D++):"/"===G&&D+1<z.length&&"*"===z.charAt(D+1)?(q=!0,D++):H+=G}z=H;return""==z?f.getSqlType()+p.get("inputSqlNotNull",
"\u4e0d\u80fd\u4e3a\u7a7a\u3002"):0!=z.trim().toLowerCase().indexOf("select")?p.get("onlyAllowSelection","\u53ea\u5141\u8bb8\u67e5\u8be2\u64cd\u4f5c"):null};this.getDesigntimeDataObject=function(z,H,x,q,D,G){q(function(ca){var y=h.getText(),P={};P[z.getName()]=z;var aa=new nb;aa.fromJsonObject(ca,P);P=aa.getFisrtEntity().getProperties().length;aa=p.get("sqlMoreThanMaxFieldNum","\u6bcf\u5f20\u6570\u636e\u8868\u6700\u591a\u5141\u8bb8\u67e5\u8be2#1\u4e2a\u5b57\u6bb5\uff0c\u8bf7\u91cd\u65b0\u7f16\u8f91SQL\u3002");
Vc.checkFieldNum(P,x,function(jb){jb?D&&D(ca,y):G&&G()},aa)},function(ca,y){G&&G();var P=ca.toString();"20"==P.substr(0,2)&&7==P.length?(2020400==ca&&"kSQLTranUnknError"==y?y=p.get("kSQLTranUnknError","KSQL\u8f6c\u6362\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u672a\u77e5\u9519\u8bef\uff0c\u8bf7\u68c0\u67e5\u8bed\u6cd5\u662f\u5426\u6b63\u786e\u3002"):2020400==ca?y=p.get("kSQLTranFail","KSQL\u8f6c\u6362\u5931\u8d25\uff0c\u5931\u8d25\u4fe1\u606f\uff1a")+y:2013002==ca?y=p.get("macroNotFound","\u5f53\u524d\u5b9e\u4f53\u5f15\u7528\u7684\u5b8f\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u5b8fid\u4e3a\uff1a#1\u3002").replace("#1",
y):2013003==ca?y=p.get("macroNoAuthority","\u5f53\u524d\u5b9e\u4f53\u5f15\u7528\u4e86\u6ca1\u6709\u6743\u9650\u67e5\u770b\u7684\u5b8f\uff0c\u5b8f\u540d\u79f0\u4e3a\uff1a#1\u3002").replace("#1",y):2013004==ca?y=p.get("macroDBUnset","\u5f53\u524d\u5b9e\u4f53\u5f15\u7528\u7684\u5b8f\u672a\u8bbe\u7f6e\u6570\u636e\u5e93\u8fde\u63a5\uff0c\u5b8f\u540d\u79f0\u4e3a\uff1a#1\u3002").replace("#1",y):2013005==ca?y=p.get("superQueryMacroNoPerm",'\u5b8f\u53d8\u91cf"#1"\u4f7f\u7528\u7684\u8d85\u7ea7\u67e5\u8be2\u8fde\u63a5\u5df2\u88ab\u53d6\u6d88\u6388\u6743\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u3002').replace("#1",
y):2013006==ca&&(y=p.get("macroNoFoundEntity","\u5f53\u524d\u5b9e\u4f53\u5f15\u7528\u7684\u5b8f\uff0c\u5176\u4f7f\u7528\u7684\u57fa\u7840\u8d44\u6599\u4e0d\u5b58\u5728\uff0c\u5b8f\u540d\u79f0\u4e3a\uff1a#1\u3002").replace("#1",y)),x.showPrompt(y),ca=!0):ca=!1;return ca}).getDesigntimeDataObject(z.toJsonObject(),H)};this.setReadonly=function(z){k=z};var A=function(){e=$("<div>");var z=new ba(p.get("customSqlName","\u540d\u79f0"));h=new Ra;g=h.getJqUi();k&&(h.setEnabled(!1),g.attr("title",d));a=new ba("");
var H=$("<div>"),x=$("<span>");x.text(p.get("needWhereTips","\u4e3a\u4e86\u9632\u6b62\u67e5\u8be2\u7684\u6570\u636e\u91cf\u8fc7\u591a\u9020\u6210\u6027\u80fd\u95ee\u9898\uff0c\u8bf7\u5728SQL\u8bed\u53e5\u4e2d\u4f7f\u7528where/limit\u5b50\u53e5"));x.appendTo(H);x=new sa;x.setIconType(sa.ICON_TYPE_QUESTION);x.setTipsSize(255,60);x.setTipsHtml(H[0]);H=x.getJqUi();c=$("<textarea spellcheck='false'>");c.addClass("dm-source-db-selection-sql-textarea");if(ha.isIEBrowser())c.on("beforedeactivate",function(){r=
c[0].selectionStart});x=new ib;x.setFontSize(12,"Microsoft YaHei");var q=new cb;q.setSelectedCallback(E);q=q.getJqUi();var D=new qb(m,function(){return c.val()});D.setMessageCurtain(t,f.getSqlType());D=D.getJqUi();n.layoutCtrl(z.getJqUi(),0,0,50,23);n.layoutCtrl(g,50,0,184,23);n.layoutCtrlWithLRTB(q,null,0,x.measureWidth(q.text())+10,0,null,23);n.layoutCtrl(a.getJqUi(),0,35,50,23);n.layoutCtrl(H,28,40,16,16);n.layoutCtrl(c,50,40,870,338);n.layoutCtrlWithLRTB(D,null,0,x.measureWidth(D.text())+10,390,
null,23);e.append(z.getJqUi());e.append(g);e.append(q);e.append(a.getJqUi());b&&e.append(H);e.append(c);e.append(D);M()},E=function(z){z=z.getTextInUserSQL();var H=c[0],x=H.value;if(ha.isIEBrowser())H.value=x.substring(0,r)+z+x.substring(r,x.length),r+=z.length,H.setSelectionRange(r,r),H.focus();else{if("number"===typeof H.selectionStart&&"number"===typeof H.selectionEnd){var q=H.selectionStart,D=H.selectionEnd;var G=q;H.value=x.substring(0,q)+z+x.substring(D,x.length);G+=z.length}else H.value+=z;
setTimeout(function(){G&&H.setSelectionRange(G,G);H.focus()},100)}},M=function(){h.setText(d);a.setText(f.getSqlType());var z=f.getContent(),H=dc.getAllImpl(),x=0,q=H.length,D=function(G){z=G;c.text(z);x++;x>=q||H[x].switchSQLToDisplayMode(z,D)};H[x].switchSQLToDisplayMode(z,D)}}function Sc(){var e=this,h=[],g,a,c,k=[],d,f,b;this.setItemModels=function(z){h=z;f=null};this.setItemsWidth=function(z){a=z};this.setText=function(z){g=z;d&&d.text(g?g:"")};this.setCustomPainter=function(z){c=z;f&&A()};this.addPressedListener=
function(z){k.push(z)};this.getJqUi=function(){d||(d=$("<div>"),d.text(g?g:""),d.addClass("dm-source-dropdownitemlistpane-text"),d.on("click",r));return d};var r=function(){if(b)m();else{f||t();var z=$(document.body),H=d.outerHeight(),x=a?a:d.outerWidth(),q=[0,H];q=n.upwardCoordinate(d[0],q,z[0]);H=q[0];var D=q[1];q=z.prop("clientHeight");var G=Math.min(20*Math.max(1,Math.min(h.length,10))+2,(q>>1)-10);D+G>q&&(q=[0,0],q=n.upwardCoordinate(d[0],q,z[0]),q=q[1]-G,0<=q&&(D=q));b=$("<div>");b.addClass("dm-dropdownitemlist-popup");
b.css("position","absolute");b.css("left",H+"px");b.css("top",D+"px");b.css("width",x+"px");b.css("height",G+"px");b.css("box-shadow","0 0 2px 0 #ccc");b.css("z-index","999999");b.appendTo(z);x=f.getJqUi();x.appendTo(b);x.css("position","absolute");x.css("left","0px");x.css("top","0px");x.css("width","100%");x.css("height","100%");f.scrollSelectedToVisible();z.on("mousedown",M);z.on("mousewheel",E)}},m=function(){if(b){var z=$(document.body);z.off("mousedown",M);z.off("mousewheel",E);b.detach();b=
null}},t=function(){f=new sc;f.setItemModels(h);f.addPressedListener(function(z,H){m();for(var x=0;x<k.length;x++)(0,k[x])(e,z.getSelecteds()[0],H);(z=z.getJqUi().find(".sa-ctrl-list-item_selected_enabled"))&&z.removeClass("sa-ctrl-list-item_selected_enabled")});A()},A=function(){c?f.setCustomItemPainter(function(z,H){c(!1,z,H)}):f.setCustomItemPainter(null)},E=function(z){return n.isDescendent(z.target,f.getJqUi()[0])?!0:!1},M=function(z){d.is(":visible")&&(n.isDescendent(z.target,d[0])||n.isDescendent(z.target,
b[0]))||m()}}function Cc(){var e=this,h,g,a,c=!1,k,d,f,b,r,m;this.setClosingAction=function(z){r=z};this.setChangeDataSourceParameter=function(z,H,x,q){k=z;d=H;f=x;b=q};this.setCloseCallerDialogCallback=function(z){m=z};var t=function(){var z=new jc;z.setChangeSourceType(!0);z.setDModel(k);z.setOldEntity(d);z.setFacadeCreator(f.createFacade);z.setEntityExistChecker(A,E);z.setFinishedCallback(function(x){r&&r(x)});z.setDataSourceDisabled(b);var H=new ic;H.setTitle(p.get("changeDataSource","\u66f4\u6362\u6570\u636e\u6e90"));
H.setSteps([z]);H.show(960,540);m&&m()},A=function(z){return e.getDmModel().isEntityNameExist(z)},E=function(z){return e.getDmModel().isEntityAliasExist(z)},M=function(){c?(a.removeClass(),a.addClass("advanced-setting-text-on"),a.text(p.get("advancedSetting","\u9ad8\u7ea7")+"..."),g.hide(),c=!1):(a.removeClass(),a.addClass("advanced-setting-text"),a.text(p.get("advancedSetting","\u9ad8\u7ea7")+"\uff1a"),g.show(),c=!0)};this.getJqUi=function(){if(!h){h=$("<div>");a=$("<div>");a.addClass("advanced-setting-text-on");
a.text(p.get("advancedSetting","\u9ad8\u7ea7")+"...");a.on("click",M);a.appendTo(h);n.layoutCtrl(a,0,0,50,16);g=$("<div>");n.layoutCtrl(g,20,31,300,23);var z=$("<div>");z.addClass("advanced-change-text");z.text(p.get("changeDataSource","\u66f4\u6362\u6570\u636e\u6e90"));z.on("click",t);z.appendTo(g);z=new sa;z.setIconType(sa.ICON_TYPE_QUESTION);z.setTipsSize(230,52);z.setTipsText(p.get("changeDataSourceTips","\u53ef\u66f4\u6362\u5f53\u524d\u6570\u636e\u6e90\u7684\u7c7b\u578b\uff0c\u4f8b\u5982\u5c06Excel\u6570\u636e\u6e90\u66f4\u6362\u4e3aMySQL\u6570\u636e\u6e90"));
z=z.getJqUi();z.addClass("advanced-change-icon");z.appendTo(g);g.appendTo(h);g.hide()}return h}}function kd(){ia.call(this);var e=this,h=this.protectedMethod,g,a,c;this.edit=function(k,d,f,b,r){e.setSize(640,540);h.setTitle(p.get("modifyConnection","\u6570\u636e\u6e90"));a=k;c=b;h.setContentPaneCreator(function(){return e.propectedCreateJqUi(k,d,f,b,r)});h.setClosingChecker(e.protectedIsValidToAccepted,!0);h.setClosingAction(function(m){m&&e.protectedAccepted(d,f)});e.showDialog()};this.propectedCreateJqUi=
function(k,d,f,b,r){c=b;throw Error("Override me.");};this.protectedIsValidToAccepted=function(k){k(!0)};this.protectedAccepted=function(k,d){throw Error("Override me.");};this.refreshDesigntimeDataObject=function(k,d,f){var b={};b[d.getName()]=d;f=f.createFacade(function(r){var m=new nb;m.fromJsonObject(r,b);r=k.getAssociateName();null==m.getEntityByAssociateName(r)?(m=new ra,m.setErrorState(Db.AbstractEntity.ERROR_STATE_TABLENOTEXIST),k.setErrorInfo(m)):k.setErrorInfo(null);g(k.getName())},function(r,
m){var t=Db.AbstractEntity.ERROR_STATE_TABLENOTEXIST;2020401==r?t=Db.AbstractEntity.ERROR_STATE_KSQL_NOT_SUPPORT:2020503==r&&(t=Db.AbstractEntity.ERROR_STATE_STORED_PROCEDURE_NOT_SUPPORT);var A=new ra;A.setErrorState(t);k.setErrorInfo(A);g(k.getName());r=r.toString();return"20"==r.substr(0,2)&&7==r.length?(h.getMessageCurtain().showError(m),!0):!1});f.setShowBlocking(!1);f.getDesigntimeDataObject(d.toJsonObject(),k.getAssociateName())};this.setConfirmListener=function(k){g=k};this.getConfirmListener=
function(){return g};this.protectedMethod.updateSameSource=function(k,d){var f=new Hc,b=k.getSource();f.updateSameSource(a,d,b,function(r){r.setSource(b);e.refreshDesigntimeDataObject(r,b,c)},k)}}function ed(){Kb.call(this);var e=this,h=this.protectedMethod,g,a,c=!1,k,d,f=!1;this.setChangeSourceType=function(t){c=t};this.setOldEntity=function(t){a=t};this.setDModel=function(t){k=t};this.getSubTitle=function(){return p.get("selectFile","\u9009\u62e9\u6587\u4ef6")};this.setIsUsedForMerge=function(t){f=
t};this.protectedCreateUi=function(){g=new T;g.setCtxApi(e.getCtxApi());var t=lb.getUrlParamValue("flatFileSize");g.setFileSize(t?t:100);g.setSource(e.getSource().clone());g.setMessageCurtain(h.getMessageCurtain());g.setChangeSourceType(c);g.setIsUsedForMerge(f);return g.getJqUi()};this.intoThisStep=function(t,A){};this.createNextTableSteps=function(){var t=new zb;t.setCtxApi(e.getCtxApi());t.setSource(e.getSource());t.setArrSource(d);var A=new zc;A.setCtxApi(e.getCtxApi());A.setSource(e.getSource());
return[t,A]};this.outThisStep=function(t,A){if(t)h.getTopJqUi()&&h.getTopJqUi().remove(),A(null);else{var E=function(){c?A(null):A(e.createNextTableSteps())};if(g.isUploading())h.getMessageCurtain().showPrompt(p.get("theFileIsUploading","\u6587\u4ef6\u6b63\u5728\u4e0a\u4f20\u4e2d\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002"));else if(g.hasUploadFile()){t=e.getSource();d=g.getArrSource();var M=g.getArrSource()[0],z=M.getFileName();t.setFileUrl(M.getFileUrl());t.setFileName(z);t.setDefineTypeRowCount(M.getDefineTypeRowCount());
t.setCharacterSet(M.getCharacterSet());t.getFileType()==gb.TYPE_TXT||t.getFileType()==gb.TYPE_CSV?(z=M.getSplitSign())?(t.setSplitSign(z),t.setTextLimitSign(M.getTextLimitSign()),E()):h.getMessageCurtain().showPrompt(p.get("customSplitSignShouldNotNull","\u81ea\u5b9a\u4e49\u5206\u9694\u7b26\u4e0d\u80fd\u4e3a\u7a7a\u3002")):t.getFileType()==gb.TYPE_EXCEL?c&&a?b(M,function(H){H&&E()}):E():t.getFileType()==gb.TYPE_XML&&(c&&a?r(M,function(H){H&&E()}):E())}else h.getMessageCurtain().showPrompt(p.get("pleaseUploadFile",
"\u8bf7\u5148\u4e0a\u4f20\u6587\u4ef6\u3002"))}};var b=function(t,A){var E=[],M=a.getSource(),z=a.getName(),H=a.getAssociateName().substring(a.getAssociateName().indexOf("/")+1);M.isUserSql(z)&&(H=a.getAlias());M.isStoredProcedure(z)&&M.supportStoredProcedure()&&(H=M.getStoredProcedure(z).getAssociateName());var x=function(q){E.push(q.getName().substring(q.getName().indexOf("/")+1));if(q instanceof Pa&&(q=q.getChildren()))for(var D=0;D<q.length;D++)x(q[D])};M=e.getCtxApi().createFacade(function(q){var D=
new Pa;D.fromJsonObject(q);q=D.getChildren();for(D=0;D<q.length;D++)x(q[D]);0<=E.indexOf(H)?A(!0):(h.getMessageCurtain().showPrompt(p.get("noCorrespondingSheetInThisFile","\u4e0a\u4f20\u7684\u6587\u4ef6\u4e2d\u6ca1\u6709\u540d\u79f0\u4e3a\u201c#1\u201d\u7684\u5de5\u4f5c\u8868\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u3002").replace("#1",H)),A(!1))},function(q,D){q=q.toString();"20"==q.substr(0,2)&&7==q.length&&h.getMessageCurtain().showPrompt(D);A(!1)});t=t.toJsonObject();M.getUsableEntities(t)},r=function(t,
A){var E=[],M=a.getSource(),z=a.getName(),H=a.getAssociateName().substring(a.getAssociateName().indexOf("/")+1);M.isUserSql(z)&&(H=a.getAlias());M.isStoredProcedure(z)&&M.supportStoredProcedure()&&(H=M.getStoredProcedure(z).getAssociateName());var x=function(q){E.push(q.getName().substring(q.getName().indexOf("/")+1));if(q instanceof Pa&&(q=q.getChildren()))for(var D=0;D<q.length;D++)x(q[D])};M=e.getCtxApi().createFacade(function(q){var D=new Pa;D.fromJsonObject(q);q=D.getChildren();for(D=0;D<q.length;D++)x(q[D]);
0<=E.indexOf(H)?A(!0):(h.getMessageCurtain().showPrompt(p.get("noCorrespondingXmlNodeInThisFile","\u4e0a\u4f20\u7684\u6587\u4ef6\u4e2d\u6ca1\u6709\u201c#1\u201d\u8282\u70b9\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u3002").replace("#1",H)),A(!1))},function(q,D){q=q.toString();"20"==q.substr(0,2)&&7==q.length&&h.getMessageCurtain().showPrompt(D);A(!1)});t=t.toJsonObject();M.getUsableEntities(t)};this.isLastStep=function(){return c?!0:!1};var m=function(t){return t.substring(0,t.lastIndexOf("."))};this.over=
function(t,A){if(t&&c&&a){t=a.getSource();var E=g.getSource();A=!g.getCheckBoxState();if(E.getFileType()==gb.TYPE_XML&&0<a.getAssociateName().indexOf("/")){var M=m(E.getFileName()),z=m(t.getFileName());M+=a.getAssociateName().replace(z,"");a.setAssociateName(M)}A?(A=a.getName(),t.isUserSql(A)&&a.setAssociateName(a.getAlias()),t.isStoredProcedure(A)&&t.supportStoredProcedure()&&(A=t.getStoredProcedure(A),a.setAssociateName(A.getAssociateName())),E.isTheSame(t)||(a.setSource(E),a.mergeSource(k.getSources())),
h.refreshDesigntimeDataObject(a,a.getSource(),e.getCtxApi())):(new Hc).updateSameSource(k,t,E,function(H){H.setSource(E);H.mergeSource(k.getSources());h.refreshDesigntimeDataObject(H,E)})}}}function Ec(){Kb.call(this);var e=this,h=this.protectedMethod,g,a,c,k,d,f,b,r=!1,m,t,A;this.setChangeSourceType=function(x){r=x};this.setOldEntity=function(x){b=x};this.setDModel=function(x){t=x};this.getCloneSource=function(){return k};this.protectedCreateUi=function(){g||(k=e.getSource().clone(),r?E():M());return g};
var E=function(){g=$("<div>");var x=$("<div>"),q=$("<div>");a=new ba("URL");var D=a.getJqUi();D.appendTo(q);n.layoutCtrl(D,0,13,40,23);c=new Ra;c.setPlaceholder(p.get("RESTfulDataSetUrlPlaceholder","\u8bf7\u8f93\u5165URL\u5168\u8def\u5f84"));k.getUrl()&&c.setText(Ga.decode(k.getUrl()));D=c.getJqUi();n.layoutCtrl(D,90,13,480,23);D.appendTo(q);A=new l(!1);k.getAuthModel()&&A.setModel(k.getAuthModel());D=A.initUi();n.layoutCtrl(D,-10,56,580,270);q.append(D);m=new Ja;m.setText(p.get("actOnTheSameDatabase",
"\u540c\u65f6\u4fee\u6539\u5f53\u524d\u4e3b\u9898\u4e2d\u5176\u4ed6\u540c\u6e90\u6570\u636e\u8868"));m.setChecked(!1);D=m.getJqUi();D.css("z-index",1);n.layoutCtrl(D,35,396,250,23);D.appendTo(g);f=new yb;f.setBottomLineVisible(!1);f.addItem("RESTFUL_DATA_SET",150,q,p.get("RESTfulDataSet","RESTful\u6570\u636e\u96c6"));f.addItem("PROGRAM_DATA_SET",150,x,p.get("programDataSet","\u7a0b\u5e8f\u6570\u636e\u96c6"));x=f.getJqUi();n.layoutCtrlWithLRTB(x,15,15,null,10,0,null);g.append(x);f.setSelectedChangedListener(function(G,
ca,y){"RESTFUL_DATA_SET"==ca?(c.setPlaceholder(p.get("RESTfulDataSetUrlPlaceholder","\u8bf7\u8f93\u5165URL\u5168\u8def\u5f84")),a.setText("URL")):(c.setPlaceholder(p.get("programDataSetPlaceholder","\u8bf7\u8f93\u5165Java\u7c7b\u7684\u5168\u8def\u5f84")),a.setText(p.get("classPath","\u7c7b\u8def\u5f84")));a.getJqUi().appendTo(y);c.getJqUi().appendTo(y);k.setOpenAPIType(ca)});k.getOpenAPIType()||k.setOpenAPIType("RESTFUL_DATA_SET");f.setSelected(k.getOpenAPIType())},M=function(){var x=$("<div>");x.addClass("openApi-left-side");
d=new hb;d.setText(p.get("RESTfulDataSet","RESTful\u6570\u636e\u96c6"));var q=d.getJqUi();q.attr("title",p.get("RESTfulDataSet","RESTful\u6570\u636e\u96c6"));d.setChecked(!0);var D=new hb;D.setText(p.get("programDataSet","\u7a0b\u5e8f\u6570\u636e\u96c6"));var G=D.getJqUi();G.attr("title",p.get("programDataSet","\u7a0b\u5e8f\u6570\u636e\u96c6"));q.appendTo(x);G.appendTo(x);var ca=$("<div>");ca.addClass("openApi-right-side");var y=0;if(e.getAppendComponentUi()){y=50;var P=e.getAppendComponentUi();ca.append(P)}var aa=
new ba("URL");P=aa.getJqUi();P.appendTo(ca);c=new Ra;c.setPlaceholder(p.get("RESTfulDataSetUrlPlaceholder","\u8bf7\u8f93\u5165ULR\u5168\u8def\u5f84"));var jb=c.getJqUi();jb.appendTo(ca);A=new l(!1);var Qb=A.initUi();n.layoutCtrl(Qb,30,57+y,580,270);ca.append(Qb);var za=new hd;za.addElement(d);za.addElement(D);za.addChangedListener(function(){d.isChecked()?(aa.setText("URL"),c.setPlaceholder(p.get("RESTfulDataSetUrlPlaceholder","\u8bf7\u8f93\u5165URL\u5168\u8def\u5f84")),k.setOpenAPIType("RESTFUL_DATA_SET"),
Qb.empty()&&(Qb=A.initUi(),n.layoutCtrl(Qb,30,57+y,580,270),ca.append(Qb))):D.isChecked()&&(aa.setText(p.get("classPath","\u7c7b\u8def\u5f84")),c.setPlaceholder(p.get("programDataSetPlaceholder","\u8bf7\u8f93\u5165Java\u7c7b\u7684\u5168\u8def\u5f84")),k.setOpenAPIType("PROGRAM_DATA_SET"),Qb.empty());c.setText()});k.getOpenAPIType()?(k.setOpenAPIType(k.getOpenAPIType()),"RESTFUL_DATA_SET"!=k.getOpenAPIType()&&D.setChecked(!0)):k.setOpenAPIType("RESTFUL_DATA_SET");n.layoutCtrl(q,20,20,250,20);n.layoutCtrl(G,
20,60,250,20);n.layoutCtrl(P,40,14+y,80,23);n.layoutCtrl(jb,100,14+y,510,23);g=$("<div>");x.appendTo(g);ca.appendTo(g)};this.intoThisStep=function(x,q){};this.getFacadeCreator=function(){};this.getAppendComponentUi=function(x){};this.getNameInput=function(){};this.getConnectionModel=function(){};this.getConnectionSuccessCallBack=function(){};this.outThisStep=function(x,q){if(x)q(null);else if(e.getNameInput()&&!$.trim(e.getNameInput().getText()))h.getMessageCurtain().showPrompt("\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\u3002");
else if($.trim(c.getText())){x=Ga.encode($.trim(c.getText()));k.setUrl(x);x=A.getAbstractOpenAPIAuth();if(z()&&x){if(null!=x.protectedCheckParams()){h.getMessageCurtain().showPrompt(x.protectedCheckParams());return}x=x.protectedGetModelFromUI();k.setAuthModel(x.protectedToJsonObject())}else k.setAuthModel(null);x=function(ca){if(b&&r)H(G,function(P){P&&q(null)});else if(e.getFacadeCreator()){ca=e.getConnectionModel();var y=$.trim(e.getNameInput().getText());ca.setDBSource(k);ca.setName(y);e.getFacadeCreator()(function(P){q(null);
var aa=e.getConnectionSuccessCallBack();aa&&aa(P)},function(P,aa){return"1300001"==P?(h.getMessageCurtain().showPrompt(p.get("duplicateName","\u540d\u79f0\u91cd\u590d\u3002")),!0):"1300002"==P?(h.getMessageCurtain().showPrompt("\u5df2\u5b58\u5728\u76f8\u540c\u8fde\u63a5\u7684\u6570\u636e\u5e93\u3002"),!0):"1300003"==P?(h.getMessageCurtain().showPrompt(p.get("dbInfoNotFound","\u6570\u636e\u5e93\u8fde\u63a5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002")),!0):"1300004"==P?(h.getMessageCurtain().showPrompt(p.get("noDbManagePerm",
"\u60a8\u6ca1\u6709\u5f53\u524d\u83dc\u5355\u6743\u9650\u3002")),!0):!1}).saveDBConnection(ca)}else q(e.createNextTableSteps())};var D=function(ca,y){ca=ca.toString();if("20"==ca.substr(0,2)&&7==ca.length){if("20612"==ca.substr(0,5)||"20622"==ca.substr(0,5))return!1;if(2061100==ca)return h.getMessageCurtain().showError(p.get("error2061100",": \u8bf7\u586b\u5199\u6b63\u786e\u7684url\uff0c\u5982\u679c\u662f\u6839\u8def\u5f84\uff0c\u5fc5\u987b\u4ee5.QData\u7ed3\u5c3e\u3002")),!0;if(2061103==ca)return h.getMessageCurtain().showError(p.get("error2061103",
": pageSize\u7684\u503c\u5fc5\u987b\u57282000\u81f320000\u4e4b\u95f4\u3002")),!0;if(2061104==ca)return h.getMessageCurtain().showError(p.get("error2061104",": \u53c2\u6570\u5f02\u5e38,pageNo\uff0cselectedFields\u4e3a\u7cfb\u7edf\u53c2\u6570\u3002")),!0;if(2062100==ca)return h.getMessageCurtain().showError(p.get("error2062100",": \u6ca1\u6709\u5b9e\u73b0\u63a5\u53e3ITableDataProvider\u3002")),!0;if(2061301==ca)return h.getMessageCurtain().showError(p.get("error2061301",": \u8bf7\u586b\u5199\u6b63\u786e\u7684\u8ba4\u8bc1\u4fe1\u606f\u3002")),
!0;if(2061302==ca)return h.getMessageCurtain().showPrompt(p.get("error2061302",": \u8bf7\u586b\u5199\u5b8c\u6574\u7684\u8ba4\u8bc1\u4fe1\u606f\u3002")),!0;if(2061303==ca)return h.getMessageCurtain().showPrompt(p.get("error2061303",": \u6458\u8981\u8ba4\u8bc1\u670d\u52a1\u5668\u8d28\u8be2\u5934\u53c2\u6570\u5f02\u5e38\u3002")),!0;h.getMessageCurtain().showError(y);return!0}return!1},G=k.toJsonObject();(e.getFacadeCreator()?e.getFacadeCreator()(x,D):e.getCtxApi().createFacade(x,D)).openAPIInitialCheck(G)}else z()?
h.getMessageCurtain().showPrompt(p.get("urlNotNull","URL\u4e0d\u80fd\u4e3a\u7a7a\u3002")):h.getMessageCurtain().showPrompt(p.get("classNameNotNull","Java\u7c7b\u7684\u5168\u8def\u5f84\u4e0d\u80fd\u4e3a\u7a7a\u3002"))};var z=function(){return r?"RESTFUL_DATA_SET"==f.getSelected():d.isChecked()},H=function(x,q){var D=[],G=b.getSource(),ca=b.getName(),y=b.getAssociateName();G.isUserSql(ca)&&(y=b.getAlias());G.isStoredProcedure(ca)&&G.supportStoredProcedure()&&(y=G.getStoredProcedure(ca).getAssociateName());
var P=function(aa){D.push(aa.getName());if(aa instanceof Pa&&(aa=aa.getChildren()))for(var jb=0;jb<aa.length;jb++)P(aa[jb])};e.getCtxApi().createFacade(function(aa){var jb=new Pa;jb.fromJsonObject(aa);aa=jb.getChildren();for(jb=0;jb<aa.length;jb++)P(aa[jb]);0<=D.indexOf(y)?q(!0):(h.getMessageCurtain().showPrompt(p.get("noCorrespondingTable","\u6ca1\u6709\u5bf9\u5e94\u7684\u8868,\u8bf7\u91cd\u65b0\u586b\u5199URL\u3002")),q(!1))},function(aa,jb){aa=aa.toString();return"20"==aa.substr(0,2)&&7==aa.length?
(h.getMessageCurtain().showPrompt(jb),!0):!1}).getUsableEntities(x)};this.over=function(x,q){if(b&&r&&x){var D=!m.isChecked();x=b.getSource();q=b;q.setSource(x);D?(D=b.getName(),x.isUserSql(D)&&b.setAssociateName(b.getAlias()),x.isStoredProcedure(D)&&x.supportStoredProcedure()&&(D=x.getStoredProcedure(D),b.setAssociateName(D.getAssociateName())),k.setUrl(Ga.encode($.trim(c.getText()))),x.isTheSame(k)||(q.setSource(k),q.mergeSource(x)),h.refreshDesigntimeDataObject(q,q.getSource())):(k.setUrl(Ga.encode($.trim(c.getText()))),
(new Hc).updateSameSource(t,x,k,function(G){G.setSource(k);G.mergeSource(t.getSources());h.refreshDesigntimeDataObject(G,k)},b))}};this.isLastStep=function(){return r?!0:!1};this.getSubTitle=function(){return p.get("OpenAPI","OpenAPI")};this.createNextTableSteps=function(){var x=e.getSource();e.getSource().isTheSame(k)||(x=k);var q=new zb;q.setCtxApi(e.getCtxApi());q.setSource(x);var D=new zc;D.setCtxApi(e.getCtxApi());D.setSource(x);return[q,D]};this.protectedIsTextFieldNotNull=function(){return $.trim(_oUrlTextArea.getText())}}
function l(e){function h(m,t){this.getTypeName=function(){return m};this.getTypeCode=function(){return t}}var g,a,c,k,d,f=e?38:43,b=[new h(p.get("noAuth","\u65e0"),null),new h("Basic",cd.BASIC),new h("Bearer",cd.BEARER),new h("Digest",cd.DIGEST),new h(p.get("cosmicAuth","\u82cd\u7a79\u8ba4\u8bc1"),cd.COSMIC)];this.setAbstractOpenAPIAuth=function(m){k=m};this.getAbstractOpenAPIAuth=function(){return k};this.initUi=function(){g=$("<div>");var m=(new ba(p.get("authType","\u8ba4\u8bc1\u65b9\u5f0f"))).getJqUi();
m.attr("title",p.get("authType","\u8ba4\u8bc1\u65b9\u5f0f"));n.layoutCtrl(m,10,0,54,23);m.appendTo(g);m=$("<div>");var t=$("<span>");t.text(p.get("httpAuthHelpIconTips","\u63d0\u4f9b\u5e38\u89c1HTTP\u8eab\u4efd\u8ba4\u8bc1\uff0c\u53ef\u4ee5\u6307\u5b9a\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\u9274\u6743  "));t.appendTo(m);t=Wc.getRESTfulAuthUrl();t=$("<a onclick='javascript:window.open(\""+t+"\");' href='#'>");t.text(p.get("viewDetails","\u67e5\u770b\u5e2e\u52a9\u6587\u6863"));
t.css("cursor","pointer");t.css("color","#5582f3");t.appendTo(m);t=new sa;t.setIconType(sa.ICON_TYPE_QUESTION);t.setTipsSize(200,70);t.setTipsHtml(m[0]);m=t.getJqUi();m.addClass("dm-notice-icon");n.layoutCtrl(m,64,4,16,16);m.appendTo(g);a=new tb;a.setItemModels(b);a.setSelected(b[0]);a.setCustomPainter(function(A,E,M){E.text(M.getTypeName())});a.addSelectedChangedListener(function(A,E,M){A=M.getTypeCode();null==A?(k=null,d&&d.hide()):(d&&d.empty(),k=c&&A==c.getAuthType()?Pc.getImpl(A,c):Pc.getImpl(A,
null),d=k.getJqUi(),n.layoutCtrl(d,0,f,580,227),d.appendTo(g),d.show())});m=a.getJqUi();m.appendTo(g);n.layoutCtrl(m,100,0,170,23);r();g.addClass("sa-ctrl-common-foreground_enabled");return g};this.setModel=function(m){c=cd.getImpl(m.authType);c.protectedFromJsonObject(m)};var r=function(){if(c){for(var m=1;m<b.length;m++)if(b[m].getTypeCode()===c.getAuthType()){a.setSelected(b[m]);break}k=Pc.getImpl(c.getAuthType(),c);d=k.getJqUi();n.layoutCtrl(d,0,f,580,227);d.appendTo(g)}}}function B(){function e(){var A=
[],E,M,z;this.setItemModel=function(H){A=H};this.setSearchListener=function(H){};this.setListItemPainter=function(H){E=H};this.createJqPopup=function(H,x,q){M=$("<div>");M.addClass("dm-field-popup");M.appendTo(H);z=$("<div>");z.addClass("dm-field-popup-list-owner");z.css({top:"0px",bottom:"0px"});z.appendTo(M);z.on("click",function(D){var G=$(D.currentTarget);D=$(D.target);if(D=n.upwardSearchHasClass(D,G,"dm-field-popup-list-item"))D.addClass("dm-list-item_selected_enabled"),q(D.data("model"))});
for(H=0;H<A.length;H++)E(A[H],z,x);x=[];H=Math.max(20*Math.min(A.length,10),20);x[0]=-1;x[1]=H;return x}}var h,g,a,c,k=!1,d,f;this.setSchemas=function(A){h=A;d&&d.setItemModel(h)};this.setSelectedSchema=function(A){g=A;f&&f.setSelectedModel(g)};this.setFunSelectCallBack=function(A){a=A};this.setFunAfterOpenDropdown=function(A){c=A};this.setShowTips=function(A){k=A};this.getJqUi=function(){return b()};var b=function(){d=new e;d.setItemModel(h);d.setListItemPainter(m);d.setSearchListener(r);f=new $a;
f.setSelectedModel(g);f.setDropdownCreator(function(A,E,M,z,H){c&&H(c);return d.createJqPopup(A,E,M)});f.setCustomPainter(function(A,E){A?(E.text(A.getName()),E.attr("title",A.getName()),g=A,a(A)):k&&E.text(p.get("selectSchemaTips","\u8bf7\u9009\u62e9\u4e00\u4e2a\u6a21\u5f0f"))});return f.getJqUi()},r=function(A,E,M,z,H){E=E.trim().toLowerCase();for(var x=[],q,D=0;D<A.length;D++){var G=A[D];q=G.getName().trim().toLowerCase();var ca=G.getAlias().trim().toLowerCase();(q=-1<q.indexOf(E)||-1<ca.indexOf(E))&&
x.push(G)}M.children().remove();if(0<x.length)for(A=0;A<x.length;A++)H(x[A],M,z);else z=new ba,z.setText(p.get("nothingSearched","\u627e\u4e0d\u5230\u7b26\u5408\u7684\u7ed3\u679c")),z.setEnabled(!1),z.setAlign(ba.ALIGN_CENTER),z=z.getJqUi(),z.addClass("dm-field-popup-search-result"),z.appendTo(M)},m=function(A,E,M){var z=$("<div>");z.addClass("dm-field-popup-list-item");z.css("padding-left","4px");z.data("model",A);var H=A?A.getAlias():"",x=$("<span>");x.addClass("dm-field-popup-list-item-text");
x.text(H);var q=A?A.getName():"",D=$("<span>");D.addClass("dm-field-popup-list-item-field-name");D.text("("+q+")");D.css("display","inline-block");z.append(x);z.append(D);z.attr("title",H+"("+q+")");E.append(z);M&&M.getName()===A.getName()&&t(E,z)},t=function(A,E){var M=null;0<A.height()?(clearTimeout(M),E.addClass("dm-list-item_selected_enabled"),A.prop("scrollTop",E.prop("offsetTop"))):M=setTimeout(function(){t(A,E)},0)}}function J(){var e,h,g,a,c=[],k=0;this.setOffset=function(f){k=f};this.setTitle=
function(f){g&&g.setText(f)};this.setSchemas=function(f){c=f};this.setSelectedSchema=function(f){a=f};this.getType=function(){return"currentSystem"};this.getSchema=function(){return a};this.isChecked=function(){return h.isChecked()};this.getErrorMessage=function(){return a?null:p.get("selectOneSchema","\u8bf7\u9009\u62e9\u4e00\u4e2a\u6a21\u5f0f\u3002")};this.getJqUi=function(){e||(e=$("<div>"),d());return e};var d=function(){var f=k;g=new ba(p.get("superQuery","\u8d85\u7ea7\u67e5\u8be2"));var b=g.getJqUi();
n.layoutCtrl(b,0,f,120,23);e.append(b);f+=36;b=(new ba(p.get("schemas","\u6a21\u5f0f"))).getJqUi();n.layoutCtrl(b,15,f,60,23);e.append(b);b=new B;b.setSchemas(c);b.setSelectedSchema(a);b.setFunSelectCallBack(function(r){a=r});b=b.getJqUi();n.layoutCtrl(b,75,f,200,23);e.append(b);f+=36;h=new Ja;h.setText(p.get("actOnTheSameDatabase","\u540c\u65f6\u4fee\u6539\u5f53\u524d\u4e3b\u9898\u4e2d\u5176\u4ed6\u540c\u6e90\u6570\u636e\u8868"));h.setChecked(!0);b=h.getJqUi();n.layoutCtrl(b,15,f,250,23);b.css("z-index",
1);e.append(b)}}function v(e,h,g){var a=this,c,k,d,f,b,r,m,t,A,E,M,z,H,x,q=100,D={LOADING:0,FAIL:1,SUCCESS:2},G=D.LOADING,ca={CSV:["csv"],TXT:["txt"],EXCEL:["xls","xlsx"],XML:["xml"]};this.setFunAddSuccessNum=function(K){z=K};this.setFunFinalPrompt=function(K){H=K};this.setFunCharacterSetComboBoxCallBack=function(K){x=K};this.getUploadState=function(){return G};this.setSource=function(K){E=K};this.getSource=function(){return E};this.setFile=function(K){c=K};this.getFile=function(){return c};this.setSourceDealType=
function(K){M=K};var y;this.setFileSize=function(K){y=K};this.setMaxFileSize=function(K){q=K};this.createUi=function(K,xa){k=K;r=xa;b=$("<div id='fileDetailProgress'>");b.hide();d=$("<div>");f=$("<div>");if(v.CHANGE_SAME_SOURCE_TYPE==M){b.addClass("dm-source-file-upload-detail");d.addClass("dm-source-file-upload-filename");P(E.getFileName());f.addClass("dm-source-file-upload-filesize");aa();var Ka=$("<div>");Ka.addClass("dm-source-file-upload-fileicon");Bb.background(Ka,"file_"+E.getFileType().toLowerCase());
var w=$("<div id='download'>");w.on("click",function(){jb(E)});w.addClass("dm-source-file-download-operation");Bb.background(w,"download_icon");w.attr("title",p.get("download","\u4e0b\u8f7d"));var N=$("<progress id='progressBar' value='0' max='100'>");N.addClass("dm-source-file-upload-progress");N.hide();G=D.SUCCESS}else v.CHANGE_SOURCE_TYPE==M?(b.addClass("dm-source-db-file-upload-detail-new"),d.addClass("dm-source-file-upload-filename_new"),f.addClass("dm-source-file-upload-filesize_new"),t=$("<div>"),
t.addClass("dm-source-file-upload-state"),P(E.getFileName()),C()):(b.addClass("dm-source-db-file-upload-detail-new"),d.addClass("dm-source-file-upload-filename_new"),f.addClass("dm-source-file-upload-filesize_new"),t=$("<div>"),t.addClass("dm-source-file-upload-state"),Bb.background(t,"upload_running"),A=$("<div>"),A.addClass("dm-source-file-upload-operation"));Ka&&b.append(Ka);b.append(d);b.append(f);w&&b.append(w);N&&b.append(N);t&&b.prepend(t);A&&b.append(A);r.append(b)};this.showFileDetailProgressBar=
function(){b&&b.show()};this.hideFileDetailProgressBar=function(){b&&b.hide()};var P=function(K){d.text(K);d.attr("title",K)},aa=function(){var K;1048576>y?K=(y/1024).toFixed(2)+"KB":1048576<=y&&(K=(y/1048576).toFixed(2)+"M");f.text("("+K+")");f.attr("title",K)},jb=function(K){e.createFacade(function(xa){var Ka="";"EXCEL"===K.getFileType()?Ka=".xlsx":"CSV"===K.getFileType()?Ka=".csv":"XML"===K.getFileType()?Ka=".xml":"TXT"===K.getFileType()&&(Ka=".txt");e.createFacade().getDownloadFileData(xa,Ka)},
function(xa,Ka){return!1}).downloadFile(K.getFileUrl())};this.changeFile=function(K){c=K;a.uploadAcceptFile()};this.uploadAcceptFile=function(){P(c.name);y=c.size;aa();if(0!=c.size)if(c.size>1048576*q)Qb(p.get("fileTooLarge","\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7\u6700\u5927\u9650\u5236\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u6587\u4ef6\u3002"));else{var K=c.name,xa=E.getFileType(),Ka=!0,w=K.lastIndexOf(".");K=K.substring(w+1,K.length).toLowerCase();0>ca[xa].indexOf(K)&&(Ka=!1);Ka?Na():Qb(p.get("fileTypeIncorrect",
"\u6587\u4ef6\u7c7b\u578b\u4e0d\u6b63\u786e\u3002"))}else Qb(p.get("uploadFileIsNull","\u4e0a\u4f20\u7684\u6587\u4ef6\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u3002"))};var Qb=function(K){v.CREATE_NEW_SOURCE_TYPE==M?Q(K,!1):h.showPrompt(K)},za=function(K){v.CREATE_NEW_SOURCE_TYPE==M?Q(K,!0):h.showError(K)},Na=function(){var K=new FormData;K.append("filename",c);m=new XMLHttpRequest;m.upload.addEventListener("progress",db,!1);e.createFacade().uploadFile(m);m.onload=function(xa){if(200==this.status){xa=
this.response;var Ka=null;try{Ka=JSON.parse(xa)}catch(w){za(p.get("uploadFail","\u4e0a\u4f20\u5931\u8d25"));return}if(Ka&&Ka.data){wa(c,Ka.data);return}if(Ka&&"4001002"==Ka.errorCode){za(p.get("uploadFileNoAccess","\u65e0\u4e0a\u4f20\u6587\u4ef6\u6743\u9650"));return}if(Ka&&3099003==Ka.errorCode){za(Ka.errorMessage);return}if(Ka&&Ka.errorMessage){za(Ka.errorMessage);return}}za(p.get("networkError","\u7f51\u7edc\u8fde\u63a5\u5f02\u5e38\u3002"))};m.send(K)},wa=function(K,xa){var Ka=e.createFacade(function(w){w&&
(E.setCharacterSet(w),x&&x(w));w=K.name;E.setName("s"+(new Date).getTime()+Math.floor(1E4*Math.random())+1);E.setFileUrl(xa);E.setFileName(w);k.find(".dm-source-file-upload-setting").show();E.getFileType()==gb.TYPE_XML?Ca(E):C()},function(w,N){Q(null,!0);w=w.toString();return"20"==w.substr(0,2)&&7==w.length?(b.attr("title",p.get("uploadFail","\u4e0a\u4f20\u5931\u8d25")),!0):!1});Ka.setShowBlocking(!1);Ka.guessFileEncoding(xa)},Ca=function(K){K.setDefineTypeRowCount(-1);var xa=e.createFacade(function(Ka){C();
return!0},function(Ka,w){Ka=Ka.toString();return"20"==Ka.substr(0,2)&&7==Ka.length?(Q(w,!0),!0):!1});K=K.toJsonObject();xa.setShowBlocking(!1);xa.getUsableEntities(K)},db=function(K){if(v.CHANGE_SAME_SOURCE_TYPE==M){var xa=k.find("#progressBar");xa.show();xa=k.find("#progressBar").get(0);K.lengthComputable&&(xa.max=K.total,xa.value=K.loaded)}else v.CHANGE_SOURCE_TYPE!=M&&(k.find(".dm-source-file-upload-area").find("#uploadAreaText"),Bb.background(A,"upload_pause"),na(A,"pause"),K.lengthComputable&&
(1048576<=K.total?(xa=(K.loaded/1048576).toFixed(2)+"M",K=(K.total/1048576).toFixed(2)+"M"):(xa=(K.loaded/1024).toFixed(2)+"KB",K=(K.total/1024).toFixed(2)+"KB"),f.text("("+xa+" of "+K+")"),xa==K&&f.text("("+K+")")))},na=function(K,xa){K.off();if("delete"==xa)K.on("mousedown",u);else if("uploadAgain"==xa)K.on("mousedown",uploadAgain);else if("pause"==xa)K.on("mousedown",L)},u=function(){b.hide();var K=g.indexOf(a);if(1==g.length&&(k.find(".dm-source-file-upload-setting").hide(),k.find(".dm-source-file-detail-progress").hide(),
k.find(".dm-source-file-upload-area").find("#uploadAreaText").show(),k.find("#fileToUpload").val(""),1<=window.navigator.userAgent.indexOf("MSIE"))){var xa=k.find("#fileToUpload"),Ka=document.createElement("form"),w=xa.nextSibling,N=xa.parentNode;Ka.appendChild(xa);Ka.reset();N.insertBefore(xa,w)}g.splice(K,1)},L=function(){m.abort();G=D.FAIL;var K=p.get("upladCanceled","\u6682\u505c\u4e0a\u4f20\u6587\u4ef6\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u3002");b.attr("title",K);b.on("mouseenter",fa);b.on("mouseleave",
R);Bb.background(A,"btn_delete");A.css("display","none");na(A,"delete");H&&H(K)},C=function(){G=D.SUCCESS;z&&z();v.CHANGE_SAME_SOURCE_TYPE==M?(k.find("#progressBar").hide(),h.showSuccess(p.get("uploadSuccess","\u4e0a\u4f20\u6210\u529f\u3002"))):v.CHANGE_SOURCE_TYPE==M?(Bb.background(t,"upload_success"),b.on("mouseenter",fa),b.on("mouseleave",R)):(Bb.background(t,"upload_success"),b.on("mouseenter",fa),b.on("mouseleave",R),Bb.background(A,"btn_delete"),A.css("display","none"),na(A,"delete"));H&&H()},
Q=function(K,xa){G=D.FAIL;v.CHANGE_SAME_SOURCE_TYPE==M?(k.find("#progressBar").hide(),K&&h.showError(K)):v.CHANGE_SOURCE_TYPE==M?(K&&b.attr("title",K),Bb.background(t,"upload_error"),b.on("mouseenter",fa),b.on("mouseleave",R)):(K&&b.attr("title",K),Bb.background(t,"upload_error"),b.on("mouseenter",fa),b.on("mouseleave",R),Bb.background(A,"btn_delete"),A.css("display","none"),na(A,"delete"),K&&h.showError(p.get("uploadFail","\u4e0a\u4f20\u5931\u8d25")+K))},fa=function(K){$(K.currentTarget).find(".dm-source-file-upload-operation").css("display",
"inline-block")},R=function(K){$(K.currentTarget).find(".dm-source-file-upload-operation").css("display","none")}}function F(){function e(w,N){this.toString=function(){return N};this.getName=function(){return w}}var h=this,g,a,c,k=1,d=0,f,b,r,m,t,A,E,M;p.get("uploadFile","\u4e0a\u4f20\u6587\u4ef6");var z=!1,H=[],x,q,D,G,ca=!1,y=!1,P={CSV:["csv"],TXT:["txt"],EXCEL:["xls","xlsx"],XML:["xml"]},aa={XML:"text/xml",CSV:".csv",TXT:"text/plain",EXCEL:"application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},
jb=["CSV","TXT"],Qb=["CSV","TXT"],za=[new e(",",p.get("comma","\u9017\u53f7")),new e(";",p.get("semicolon","\u5206\u53f7")),new e(" ",p.get("space","\u7a7a\u683c")),new e("\t",p.get("tabs","\u5236\u8868\u7b26")),new e("\u81ea\u5b9a\u4e49",p.get("custom","\u81ea\u5b9a\u4e49"))],Na=[new e("UTF-8","UTF-8"),new e("UTF-16BE","UTF-16BE"),new e("UTF-16LE","UTF-16LE"),new e("GB2312","GB2312"),new e("GB18030","GB18030"),new e("GBK","GBK")],wa=[new e('"',p.get("doubleQuotationMark","\u53cc\u5f15\u53f7")),new e("'",
p.get("singleQuotationMark","\u5355\u5f15\u53f7"))],Ca=[new e("50",p.get("checkFirstFiftyLines","\u4ec5\u68c0\u6d4b\u524d50\u884c")),new e("100",p.get("checkFirstOneHundredLines","\u4ec5\u68c0\u6d4b\u524d100\u884c")),new e("-1",p.get("checkWholeFile","\u68c0\u6d4b\u6574\u4e2a\u6587\u4ef6"))],db=!1;this.getFileDetailProgress=function(){return H};this.setChangeSourceType=function(w){db=w};this.isChangeSourceType=function(){return db};this.isUsedForMerge=function(){return y};this.setIsUsedForMerge=function(w){y=
w};this.protectedDefaultActOnOtherSource=function(){return!1};this.setCtxApi=function(w){g=w};this.getCtxApi=function(){return g};this.getJqUi=function(){a||(a=$("<div>"),b&&b.getFileName()?K(function(){h.protectedInitUi(a)}):h.protectedInitUi(a));return a};this.protectedInitUi=function(){var w=b.getFileType(),N=$("<div style='text-align:center'>");var qa=db||b&&b.getFileName()||y?$("<input type='file' id='fileToUpload' style='width:0;height:0;position:absolute;left:-100px'>"):$("<input type='file' id='fileToUpload' style='width:0;height:0;position:absolute;left:-100px' multiple>");
qa.attr("accept",aa[w]);var Ma=$("<div type='button'>");Ma.on("click",function(){qa.click()});Ma.addClass("dm-source-file-upload-btn");var Hb=$("<div>");Hb.css("text-align","center");var Rb=$("<div>");Rb.addClass("dm-source-file-upload-btn-text");Rb.text(p.get("uploadFile","\u4e0a\u4f20\u6587\u4ef6"));var Ic=$("<div>");Ic.addClass("dm-source-file-upload-btn-icon");Bb.background(Ic,"upload_icon_selected");var Yc=$("<span>");Yc.addClass("dm-source-file-upload-prompt");Yc.text(p.get("acceptFile","\u652f\u6301#1\u6587\u4ef6\uff0c\u4e14\u6587\u4ef6\u4e0d\u5927\u4e8e#2M").replace("#1",
P[w]).replace("#2",k));var Ac=$("<div>");Ac.addClass("dm-source-file-upload-setting");c=$("<div>");c.addClass("dm-source-file-detail-progress-pane");if(0<=jb.indexOf(w)){var Zc=new ba(p.get("splitSign","\u5206\u9694\u7b26"));r=new tb;r.setItemModels(za);r.setSelected(za[0]);m=new Ra;var ld=new ba(p.get("characterSet","\u7f16\u7801"));t=new tb;t.setItemModels(Na);t.setSelected(Na[0]);var fd=new ba(p.get("textLimitSign","\u6587\u672c\u9650\u5b9a\u7b26"));A=new tb;A.setItemModels(wa);A.setSelected(wa[0]);
var nc=new ba(p.get("defineTypeRowCount","\u6570\u636e\u7c7b\u578b\u68c0\u6d4b"));E=new tb;E.setItemModels(Ca);E.setSelected(Ca[0]);var Oc=Zc.getJqUi();n.layoutCtrl(Oc,20,15,70,23);var jd=r.getJqUi();n.layoutCtrl(jd,105,15,120,23);Zc=m.getJqUi();n.layoutCtrl(Zc,230,15,120,23);ld=ld.getJqUi();n.layoutCtrl(ld,20,50,70,23);var pd=t.getJqUi();n.layoutCtrl(pd,105,50,120,23);fd=fd.getJqUi();n.layoutCtrl(fd,20,85,70,23);var qd=A.getJqUi();n.layoutCtrl(qd,105,85,120,23);nc=nc.getJqUi();nc.attr("title",p.get("defineTypeRowCount",
"\u6570\u636e\u7c7b\u578b\u68c0\u6d4b"));n.layoutCtrl(nc,20,120,72,23);var sd=E.getJqUi();n.layoutCtrl(sd,105,120,180,23);Ac.append(Oc);Ac.append(jd);Ac.append(Zc);Ac.append(ld);Ac.append(pd);Ac.append(fd);Ac.append(qd);Ac.append(nc);Ac.append(sd);r.addSelectedChangedListener(na);Zc.hide()}else nc=new ba(p.get("defineTypeRowCount","\u6570\u636e\u7c7b\u578b\u68c0\u6d4b")),E=new tb,E.setItemModels(Ca),E.setSelected(Ca[0]),nc=nc.getJqUi(),nc.attr("title",p.get("defineTypeRowCount","\u6570\u636e\u7c7b\u578b\u68c0\u6d4b")),
n.layoutCtrl(nc,20,20,72,23),sd=E.getJqUi(),n.layoutCtrl(sd,105,20,180,23),Ac.append(nc),Ac.append(sd);Ac.hide();db?(b&&b.getFileName()&&(0<=jb.indexOf(w)&&b.getSplitSign()&&(Oc=b.getSplitSign(),jd=xa(Oc,za),0>za.indexOf(jd)?(r.setSelected(za[za.length-1]),m.setText(Oc),Zc.show()):r.setSelected(xa(b.getSplitSign(),za)),t.setSelected(xa(b.getCharacterSet(),Na)),A.setSelected(xa(b.getTextLimitSign(),wa))),E.setSelected(xa(b.getDefineTypeRowCount(),Ca)),Ac.show(),z=!0),0<=Qb.indexOf(w)||(M=new Ja,M.setText(p.get("actOnTheSameDatabase",
"\u540c\u65f6\u4fee\u6539\u5f53\u524d\u4e3b\u9898\u4e2d\u5176\u4ed6\u540c\u6e90\u6570\u636e\u8868")),M.setChecked(h.protectedDefaultActOnOtherSource()),Zc=M.getJqUi(),n.layoutCtrl(Zc,0,400,250,23),Zc.css("z-index",1),a.append(Zc))):b&&b.getFileName()&&(Oc=new v(g,f,H),Oc.setSource(b),Oc.setSourceDealType(v.CHANGE_SAME_SOURCE_TYPE),Oc.setFileSize(d),Oc.setMaxFileSize(k),Oc.setFunCharacterSetComboBoxCallBack(h.funCharacterSetComboBoxCallBack),c.css("overflow-y","visible"),Oc.createUi(a,c),Oc.showFileDetailProgressBar(),
H.push(Oc),Ac.removeClass("dm-source-file-upload-setting"),Ac.addClass("dm-source-file-upload-setting-reload"),0<=jb.indexOf(w)&&b.getSplitSign()?(Oc=b.getSplitSign(),jd=xa(Oc,za),0>za.indexOf(jd)?(r.setSelected(za[za.length-1]),m.setText(Oc),Zc.show()):r.setSelected(xa(b.getSplitSign(),za)),t.setSelected(xa(b.getCharacterSet(),Na)),A.setSelected(xa(b.getTextLimitSign(),wa)),E.setSelected(xa(b.getDefineTypeRowCount(),Ca)),Ac.show()):(E.setSelected(xa(b.getDefineTypeRowCount(),Ca)),Ac.show(),M=new Ja,
M.setText(p.get("actOnTheSameDatabase","\u540c\u65f6\u4fee\u6539\u5f53\u524d\u4e3b\u9898\u4e2d\u5176\u4ed6\u540c\u6e90\u6570\u636e\u8868")),M.setChecked(h.protectedDefaultActOnOtherSource()),Zc=M.getJqUi(),n.layoutCtrl(Zc,20,175,250,23),Zc.css("z-index",1),a.append(Zc)));"placeholder"in $("<input>")[0]?(qa.change(function(ud){u()}),Hb.append(Ic),Hb.append(Rb),Ma.append(Hb),N.append(qa),N.append(Ma),a.append(N)):(N=$("<form id='uploadForm' method='post' enctype='multipart/form-data' target='targetIframeC'>"),
qa=$("<input name='filename' type='file' id='fileToUpload' style='width:0;height:0;position:absolute;left:-100px' onchange='submit()' multiple/>"),Zc=$("<iframe name='targetIframeC' id='targetIframeC' style='height: 0;width: 0'>"),N.attr("action","/qing/uploadFileForIE9.do?type="+P[w]),Hb.append(Ic),Hb.append(Rb),Ma.append(Hb),N.append(qa),a.append(N),a.append(Zc),a.append(Ma),Zc.on("load",function(ud){try{var Ba=$(window.self.frames.targetIframeC.document).find("body");if(Ba.html()){var fb=JSON.parse(Ba.html().toString()),
Nb=fb.fileName,Tb=fb.fileSize;ud={};ud.name=Nb;var gc=fb.errorCode;if("IE9001"==gc)f.showPrompt(p.get("fileTypeIncorrect","\u6587\u4ef6\u7c7b\u578b\u4e0d\u6b63\u786e\u3002"));else if("IE9002"==gc)f.showPrompt(p.get("fileTooLarge","\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7\u6700\u5927\u9650\u5236\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u6587\u4ef6\u3002"));else if("IE9003"==gc)f.showPrompt(p.get("uploadFileIsNull","\u4e0a\u4f20\u7684\u6587\u4ef6\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u3002"));else{var pc=
a.find(".dm-source-file-upload-filename_new"),Rc=a.find(".dm-source-file-upload-filesize_new"),Lc=(Tb/1048576).toFixed(2)+"M";pc.text(Nb);Rc.text("("+Lc+")");pc.attr("title",Nb);Rc.attr("title",Lc);var Xc=a.find(".dm-source-file-upload-fileicon");pc=a.find(".dm-source-file-upload-filename");Rc=a.find(".dm-source-file-upload-filesize");1048576>Tb?Lc=(Tb/1024).toFixed(2)+"KB":1048576<=Tb&&(Lc=(Tb/1048576).toFixed(2)+"M");Bb.background(Xc,"file_"+w.toLowerCase());pc.text(Nb);Rc.text("("+Lc+")");pc.attr("title",
Nb);Rc.attr("title",Lc);jqFileDetailProgressDiv.show();Ka().find("#uploadAreaText").hide();console&&console.log(fb);guessFileEncoding(ud,fb.data)}}}catch(id){console&&console.log(id),f.showError(p.get("uploadFail","\u4e0a\u4f20\u5931\u8d25\u3002"))}}));a.append(Yc);h.initExtraUi(a,c,Ac,qa)};this.initExtraUi=function(){throw Error("Override me.");};this.setText=function(w){};this.setSource=function(w){b=w};this.getSource=function(){0<=jb.indexOf(b.getFileType())&&(r.getSelected()==za[za.length-1]?
b.setSplitSign($.trim(m.getText())):b.setSplitSign(r.getSelected().getName()),b.setCharacterSet(t.getSelected().getName()),b.setTextLimitSign(A.getSelected().getName()));b.setDefineTypeRowCount(E.getSelected().getName());if(db||y){var w=H[0].getSource();b.setName(w.getName());b.setFileName(w.getFileName());b.setFileUrl(w.getFileUrl());0>jb.indexOf(b.getFileType())&&b.setCharacterSet(w.getCharacterSet())}return b};this.getArrSource=function(){x=[];for(var w=0;w<H.length;w++)if(2==H[w].getUploadState()){var N=
h.getSource().clone(),qa=H[w].getSource();N.setName(qa.getName());N.setFileName(qa.getFileName());N.setFileUrl(qa.getFileUrl());null!=qa.getCharacterSet()&&null==N.getCharacterSet()&&N.setCharacterSet(qa.getCharacterSet());x.push(N)}return x};this.getOnlySource=function(){return b};this.setFileSize=function(w){k=w};this.getFileSize=function(){return k};this.setMessageCurtain=function(w){f=w};this.getMessageCurtain=function(){return f};this.isUploading=function(){for(var w=!1,N=0;N<H.length;N++)if(0==
H[N].getUploadState()){w=!0;break}return w};this.hasUploadFile=function(){z=!1;for(var w=0;w<H.length;w++)if(2==H[w].getUploadState()){z=!0;break}return z};this.getCheckBoxState=function(){return M&&M.isChecked()};var na=function(){r.getSelected()==za[za.length-1]?m.getJqUi().show():m.getJqUi().hide()},u=function(w){w=a.find("#fileToUpload");if(null!=w&&null!=w.get(0)&&null!=w.get(0).files)var N=w.get(0).files;""!=w.val()&&L(N);w.val("")},L=function(w){if((b&&b.getFileName()||db||y)&&0<H.length)w=
w[0],R(w.name)?f.showError(p.get("fileTypeIncorrect","\u6587\u4ef6\u7c7b\u578b\u4e0d\u6b63\u786e\u3002")):C(w)||H[0].changeFile(w);else a:if(h.isUploading())f.showPrompt(p.get("theFileIsUploading","\u6587\u4ef6\u6b63\u5728\u4e0a\u4f20\u4e2d\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002"));else{for(var N=w.length,qa=0,Ma=0;Ma<H.length;Ma++)2==H[Ma].getUploadState()&&qa++;if(10<qa+N)f.showPrompt(p.get("fileNumberExceeds","\u6700\u591a\u4e0a\u4f20#1\u4e2a\u6587\u4ef6\u3002").replace("#1",10));else{G=D=q=
0;ca=!1;if(1==w.length&&(ca=!0,C(w[0])))break a;N=Ka().find("#uploadAreaText");N.hide();c.show();for(qa=0;qa<w.length;qa++){Ma=w[qa].name;var Hb=!1;if(0!==H.length)for(var Rb=0;Rb<H.length;Rb++)if(H[Rb].getFile().name===Ma){Hb=!0;break}Ma=Hb;Ma?D+=1:R(w[qa].name)?q+=1:(Ma=new v(g,f,H),Ma.setSource(h.getOnlySource().clone()),Ma.setSourceDealType(v.CREATE_NEW_SOURCE_TYPE),Ma.createUi(a,c),Ma.setFile(w[qa]),Ma.setMaxFileSize(k),Ma.setFunFinalPrompt(Q),Ma.setFunAddSuccessNum(fa),Ma.setFunCharacterSetComboBoxCallBack(h.funCharacterSetComboBoxCallBack),
Ma.showFileDetailProgressBar(),H.push(Ma),Ma.uploadAcceptFile())}0==H.length&&N.show();Q()}}},C=function(w){var N=!1;w.size>1048576*k&&(f.showPrompt(p.get("fileTooLarge","\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7\u6700\u5927\u9650\u5236\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u6587\u4ef6\u3002")),N=!0);return N},Q=function(w){if(!h.isUploading()&&!w){ca?w=0<D?p.get("duplicateFileExists","\u5b58\u5728\u91cd\u540d\u6587\u4ef6\uff0c"):0<q?p.get("fileTypeIncorrectError","\u6587\u4ef6\u7c7b\u578b\u9519\u8bef\uff0c"):
p.get("uploadSuccess","\u4e0a\u4f20\u6210\u529f"):(w=p.get("uploadSuccessFileNum","\u6210\u529f\u4e0a\u4f20#1\u4e2a\u6587\u4ef6\u3002").replace("#1",G),0<D&&(w+=p.get("duplicateFileExistsNum","#1\u4e2a\u6587\u4ef6\u5b58\u5728\u91cd\u540d\u6587\u4ef6\uff0c").replace("#1",D)),0<q&&(w+=p.get("fileTypeIncorrectNum","#1\u4e2a\u6587\u4ef6\u7c7b\u578b\u9519\u8bef\uff0c").replace("#1",q)));if(0<D||0<q)w+=p.get("uploadFail","\u4e0a\u4f20\u5931\u8d25\u3002");h.isUploading()||null==w||(0<D||0<q?f.showPrompt(w):
f.showSuccess(w))}},fa=function(){G++};this.funCharacterSetComboBoxCallBack=function(w){t&&t.setSelected(xa(w,Na))};var R=function(w){var N=w.lastIndexOf(".");w=w.substring(N+1,w.length).toLowerCase();return 0>P[h.getOnlySource().getFileType()].indexOf(w)?!0:!1},K=function(w){var N=g.createFacade(function(Ma){d=Ma;w()},function(Ma,Hb){return!1}),qa=b.getFileUrl();N.getFileSize(qa)},xa=function(w,N){for(var qa in N)if(N[qa].getName()==w)return N[qa]},Ka=function(){return a.find(".dm-source-file-upload-area")};
this.protectedMethod={doSelectFile:u,supportActOnSameSource:function(w){return!(0<=Qb.indexOf(w))},doUpladFiles:L}}function T(){F.call(this);var e=this,h=this.protectedMethod,g,a;this.initExtraUi=function(r,m,t,A){g=r;a=m;a.css("height","160px");a.css("top","10px");m=$("<div>");m.addClass("dm-source-file-upload-area");var E=$("<div id='uploadAreaText'>");E.addClass("dm-source-file-upload-areatext");E.css("z-index","9999");m.append(A);m.append(a);m.append(t);m.append(E);m.on("dragenter",k);m.on("dragenter",
d);m.on("dragover",k);m.on("dragleave",k);m.on("dragleave",f);m.on("drop",b);if(e.isChangeSourceType()&&(t=e.getOnlySource())&&(h.supportActOnSameSource(t.getTypeName())&&m.css("height",340),t.getFileName())){E.hide();var M=new v(e.getCtxApi(),e.getMessageCurtain(),e.getFileDetailProgress());M.setSource(t);M.setSourceDealType(v.CHANGE_SOURCE_TYPE);M.setMaxFileSize(e.getFileSize());M.setFunCharacterSetComboBoxCallBack(e.funCharacterSetComboBoxCallBack);M.createUi(g,a);M.showFileDetailProgressBar();
e.getFileDetailProgress().push(M)}"placeholder"in $("<input>")[0]?(E.on("click",function(){g.find("#fileToUpload").click()}),E.change(function(z){doSelectFile()}),E.text(p.get("clickOrDrag","\u70b9\u51fb\u6216\u5c06\u6587\u4ef6\u62d6\u62fd\u5230\u8fd9\u91cc\u4e0a\u4f20"))):(E.text(p.get("clickForUploadFile","\u70b9\u51fb\u8fd9\u91cc\u4e0a\u4f20\u6587\u4ef6")),t=r.find("#uploadForm"),t.append(A),m.append(t),E.on("click",function(){A.click()}));r.append(m)};this.changeStyleWhenDragEnter=function(){c().removeClass("dm-source-file-upload-area_enter")};
var c=function(){return g.find(".dm-source-file-upload-area")},k=function(r){r.originalEvent.stopPropagation();r.originalEvent.preventDefault()},d=function(r){c().addClass("dm-source-file-upload-area_enter")},f=function(r){c().removeClass("dm-source-file-upload-area_enter")},b=function(r){k(r);c().removeClass("dm-source-file-upload-area_enter");r=r.originalEvent.dataTransfer.files;if(e.isChangeSourceType()||e.isUsedForMerge()){var m=r[0];r=[];r.push(m)}h.doUpladFiles(r)}}function I(){F.call(this);
this.protectedDefaultActOnOtherSource=function(){return!0};this.initExtraUi=function(e,h,g,a){e.append(h);e.append(g)}}function S(){function e(wa){KTDefaultCellRender.call(this,wa);var Ca=this,db=this.paintCellUI;this.paintCellUI=function(na,u){if(Ca.getCurrentRowIdx()<Ab.getHeadRowCount())db(na,u);else if(4==Ca.getCurrentColIdx())u=Ca.getCurrentRow().getUserObject(),u.getIoType()==Fb.PROCEDUREIOTYPE_IN||u.getIoType()==Fb.PROCEDUREIOTYPE_INOUT?(u=Ca.getCell().getValue(),aa(na,Ca.getCellWidth(),Ca.getCellHeight(),
u,Ca.getCurrentRow())):u.getIoType()==Fb.PROCEDUREIOTYPE_OUT&&(na=$(na),na.empty(),u=$("<div>"),u.text(p.get("outParameterNotNeedSet","\u8f93\u51fa\u53c2\u6570\u65e0\u9700\u8bbe\u7f6e")),u.addClass("dm-source-db-tablecell-unable-edit"),u.appendTo(na));else if(0==Ca.getCurrentColIdx()){if(u=Ca.getCell().getValue(),na=$(na),na.find(".dm-entity-filtertable-prompt").remove(),u){var L=wb.createWarning();L.addClass("dm-entity-filtertable-prompt");L.attr("title",u);L.appendTo(na)}}else db(na,u)}}var h,g,
a,c,k,d,f,b,r,m;this.getJqUi=function(){if(!h){h=$("<div>");h.addClass("dm-source-db-storedprocedure-panel");var wa=new sa;wa.setIconType(sa.ICON_TYPE_QUESTION);wa.setTipsSize(400,140);wa.setTipsHtml(p.get("tipsHtml","\u5b58\u50a8\u8fc7\u7a0b\u64cd\u4f5c\u8bf4\u660e\uff1a<br/>1\u3001\u754c\u9762\u4e2d\u8bbe\u7f6e\u7684\u5b58\u50a8\u8fc7\u7a0b\u7684\u8f93\u5165\u8f93\u51fa\u53c2\u6570\uff0c\u987a\u5e8f\u5fc5\u987b\u548c\u5b58\u50a8\u8fc7\u7a0b\u5b9a\u4e49\u7684\u53c2\u6570\u987a\u5e8f\u4e00\u81f4\uff1b<br/>2\u3001\u5982\u679c\u8f93\u5165\u53c2\u6570\u6ca1\u6709\u9ed8\u8ba4\u503c\uff0c\u5219\u9700\u8981\u8bbe\u7f6e\u53c2\u6570\u503c\uff0c\u5426\u5219\u53ef\u80fd\u51fa\u73b0\u6267\u884c\u51fa\u9519\uff1b<br/>3\u3001\u5982\u679c\u8f93\u51fa\u53c2\u6570\u4e0d\u662f\u7ed3\u679c\u96c6\uff0c\u5219\u63d0\u793a\u627e\u4e0d\u5230\u5bf9\u5e94\u7684\u7ed3\u679c\u96c6\uff1b<br/>4\u3001\u53ea\u80fd\u9009\u62e9\u4e00\u4e2a\u7ed3\u679c\u96c6\u4f5c\u4e3a\u8f93\u51fa\u5b57\u6bb5\u3002"));
wa=wa.getJqUi();wa.addClass("dm-source-db-storedprocedure-panel-helptips");wa.appendTo(h);wa=(new ba(p.get("storedProceParameter","\u5b58\u50a8\u8fc7\u7a0b\u53c2\u6570"))).getJqUi();wa.addClass("dm-source-db-storedprocedure-panel-label");wa.appendTo(h);a=Ab.createTable();Ab.bindTextEditor(a,y,P);Ab.bindTableListenerForCtrl(a);a.setSyncUIWhenModelChanged(!0);wa=$(a.getUI());wa.css("width","100%");wa.children().css("overflow-x","hidden");n.layoutCtrl(wa,0,23,495,110);wa.appendTo(h);wa=[];for(var Ca=
d.getParameters(),db=0;db<Ca.length;db++){var na=Ca[db];na.getDataType()==Sa.DATA_CURSOR&&wa.push(na.getName())}0<wa.length?(Ca=(new ba(p.get("cursorResult","\u6e38\u6807\u7ed3\u679c\u96c6\u5b57\u6bb5\uff1a"))).getJqUi(),db=d.getCursorFieldName()?d.getCursorFieldName():wa[0],d&&d.setCursorFieldName(db),na=new tb,na.setSelected(db),na.setItemModels(wa),na.addSelectedChangedListener(E),wa=na.getJqUi(),n.layoutCtrl(Ca,0,140,100,23),n.layoutCtrl(wa,100,140,150,23),Ca.appendTo(h),wa.appendTo(h)):(Ca=d.getOutResultIdx()?
d.getOutResultIdx():1,wa=$("<div>"),wa.text(p.get("outSetResultBefore","\u4f7f\u7528\u7b2c")),wa.addClass("dm-source-db-storedprocedure-panel-outsetresultbeforelabel"),k=new ya,k.setConstraint(1,1024,1),k.setValue(Ca),k.addValueChangedListener(A),d&&d.setOutResultIdx(Ca),Ca=k.getJqUi(),Ca.addClass("dm-source-db-storedprocedure-panel-spinner"),db=$("<div>"),db.text(p.get("outSetResultAfter","\u4e2a\u7ed3\u679c\u96c6")),db.addClass("dm-source-db-storedprocedure-panel-outsetresultafterlabel"),wa.appendTo(h),
Ca.appendTo(h),db.appendTo(h));wa=new Gb;wa.setText(p.get("previewResultSet","\u9884\u89c8\u7ed3\u679c\u96c6"));wa.addActionListener(t);wa=wa.getJqUi();g=Ab.createTable();Ca=$(g.getUI());Ca.css("width","100%");Ca.css("overflow","auto");n.layoutCtrlWithLRTB(wa,null,0,120,140,null,23);n.layoutCtrl(Ca,0,169,510,255);wa.appendTo(h);Ca.appendTo(h)}Ab.clear(a);a.addColumns(5);a.getColumn(0).setWidth(20);a.getColumn(1).setWidth(110);a.getColumn(2).setWidth(110);a.getColumn(3).setWidth(60);a.getColumn(4).setWidth(120);
wa=Ab.createHeadRow(a);wa.getCell(1).setValue(p.get("parameterName","\u53c2\u6570\u540d\u79f0"));wa.getCell(2).setValue(p.get("direction","\u4f20\u8f93\u65b9\u5411"));wa.getCell(3).setValue(p.get("dataType","\u6570\u636e\u7c7b\u578b"));wa.getCell(4).setValue(p.get("parameterValue","\u53c2\u6570\u503c"));wa=d.getParameters();Ca=wa.length;if(0==Ca)wa=p.get("noData","\u6ca1\u6709\u6570\u636e"),db=Ab.createRow(a),db.getCell(1).setValue(wa);else for(db=new e(a),db.setOutsideVisible(!1),a.setCellRender(db),
na=0;na<Ca;na++){var u=wa[na];db=Ab.createRow(a);db.setUserObject(u);db.getCell(0).setValue("");db.getCell(1).setValue(u.getName());var L=u.getIoTypeText();db.getCell(2).setValue(L);L=u.getDataTypeText();db.getCell(3).setValue(L);db.getCell(4).setValue(null==u.getValue()?"":u.getValue())}Ab.refresh(a);z();return h};this.setInitValue=function(wa,Ca,db,na){d=wa;f=Ca.clone();f.setName(Ca.getName());r=db;b=na};this.getStoredProcedureModel=function(){return d};this.refreshTable=function(){a&&Ab.refresh(a);
g&&Ab.refresh(g)};this.relayoutViews=function(){a&&a.relayoutViews();g&&g.relayoutViews()};this.setCallbackDesignTimeDataObject=function(wa){m=wa};var t=function(){var wa=d.doCheckParameters();if(wa){var Ca=wa.getPrompt();Na(Ca,h,"red");setTimeout(function(){M(wa.getErrorRow(),Ca)},500)}else $(g.getUI()).show(),H()},A=function(){d&&d.setOutResultIdx(k.getValue());d&&d.setIsChange(!0);q(null,null);m&&m(d.getAssociateName(),null)},E=function(wa,Ca,db){Ca!=db&&(d&&d.setCursorFieldName(db),d&&d.setIsChange(!0),
q(null,null),m&&m(d.getAssociateName(),null))},M=function(wa,Ca){for(var db=Ab.getHeadRowCount();db<a.getRowsCount();db++)a.getRow(db).getCell(0).setValue("");0<=wa&&a.getRow(wa+Ab.getHeadRowCount()).getCell(0).setValue(Ca)},z=function(){var wa=d.doCheckParameters();wa?M(wa.getErrorRow(),wa.getPrompt()):(za(),M(-1))},H=function(){var wa=d.getAssociateName();f.removeStoredProcedure(d.getName());f.addStoredProcedure(d);var Ca=r(function(db){var na={};na[f.getName()]=f;var u=new nb;u.fromJsonObject(db,
na);m&&m(d.getAssociateName(),u);db=u.getFisrtEntity();x(db)},function(db,na){var u=db.toString();return"20"==u.substr(0,2)&&7==u.length&&209E4!=db?(2020501==db&&(na=-1==na?p.get("notFindResult","\u6ca1\u6709\u83b7\u53d6\u5230\u5b58\u50a8\u8fc7\u7a0b#1\u7684\u7ed3\u679c\u96c6\u3002").replace("#1",wa):p.get("notFindIdxResult","\u6ca1\u6709\u83b7\u53d6\u5230\u5b58\u50a8\u8fc7\u7a0b#1\u7b2c#2\u4e2a\u7684\u7ed3\u679c\u96c6\u3002").replace("#1",wa).replace("#2",na)),b.showPrompt(na),!0):!1});Ca.setShowBlocking(!1);
Ca.getDesigntimeDataObject(f.toJsonObject(),d.getName())},x=function(wa){q(null,null);Na(p.get("loadingPreviewData","\u6b63\u5728\u83b7\u53d6\u9884\u89c8\u6570\u636e\uff0c\u8bf7\u7a0d\u5019\u2026\u2026"),h,"#666");var Ca=f.toJsonObject(),db=r(function(na){za();var u=new pb;na&&u.fromJsonObject(na);u&&u.getWarmingMessage()&&b.showPrompt(u.getWarmingMessage());q(wa,u.getData())},function(na,u){var L=na.toString();return"20"==L.substr(0,2)&&7==L.length&&209E4!=na?(za(),b.showError(u),!0):!1});db.setShowBlocking(!1);
db.previewData([wa.toJsonObject()],[Ca],101)},q=function(wa,Ca){Ab.clear(g);if(wa){for(var db=Ab.createHeadRow(g),na=wa.getProperties(),u=na.length,L=[],C=0;C<u;C++){var Q=na[C],fa=Q.getOutputDataType(),R=fa==Jb.DT_INT||fa==Jb.DT_NUMBER,K=g.addColumn(Q.getName());K.setStyle(Ab.getColumnStyle(R));K.setWidth(D(fa));db.getCell(C).setValue(Q.getAlias());L[C]=Yb.createFormater(fa,Q.getFormatString())}db=Ca.length;C=0;for(u=Math.min(db,100);C<u;C++)for(fa=Ca[C],R=Ab.createRow(g),K=0;K<fa.length;K++){var xa=
(0,L[K])(fa[K]);Q=na[K];Q.getEnumValue()&&(Q=Q.getEnumValue(),Q[xa]&&(xa=Q[xa]));R.getCell(K).setValue(xa)}Ca="";0==db?(Ca=p.get("noData","\u6ca1\u6709\u6570\u636e"),ca(Ca)):100>=db?(Ca=p.get("totalRows","\u603b\u5171#1\u884c\u6570\u636e").replace("#1",db),ca(Ca,db)):(ca(p.get("loadingTotalRows","\u6b63\u5728\u8ba1\u7b97\u603b\u884c\u6570\uff0c\u8bf7\u7a0d\u5019....")),100<db&&(Ca=p.get("dataShownRows","\u4ec5\u9884\u89c8\u524d#1\u884c\u6570\u636e").replace("#1",100)),G(wa,Ca))}Ab.refresh(g)},D=function(wa){switch(wa){case Jb.DT_INT:case Jb.DT_NUMBER:return 90;
case Jb.DT_DATE:return 80;case Jb.DT_DATETIME:return 130;case Jb.DT_BOOLEAN:return 40;default:return 120}},G=function(wa,Ca){var db=f.toJsonObject(),na=r(function(u){0<=u&&(Ca=p.get("totalRows","\u603b\u5171#1\u884c\u6570\u636e").replace("#1",u)+p.get("previewTipsComma",",")+Ca);ca(Ca,u)},function(u,L){L=u.toString();return"20"==L.substr(0,2)&&7==L.length&&209E4!=u?(Ca=p.get("loadingTotalRowsError","\u83b7\u53d6\u603b\u884c\u6570\u5931\u8d25"),ca(Ca),!0):!1});na.setShowBlocking(!1);na.getDataCount([wa.toJsonObject()],
[db])},ca=function(wa,Ca){var db=100;Ca&&100>Ca&&(db=Ca);g.getRowsCount()-Ab.getHeadRowCount()==db||0==g.getRowsCount()-Ab.getHeadRowCount()?(Ca=Ab.createRow(g),Ca.getCell(0).setValue(wa),wa=new KTStyle,wa.setBackgroundColor(com.kingdee.bos.qing.common.CommonTableSkin.ODD_ROW_BACKGROUND_COLOR),Ca.setStyle(wa),wa=new KTStyle,wa.setTextAlign("left"),Ca.getCell(0).setStyle(wa),Ab.refresh(g)):g.getRowsCount()-Ab.getHeadRowCount()==db+1&&(Ca=g.getRowsCount()-1,g.getRow(Ca).getCell(0).setValue(wa),Ab.refresh(g))},
y=function(wa,Ca){if(4!=Ca||(wa=a.getRow(wa).getUserObject())&&wa.getIoType()==Fb.PROCEDUREIOTYPE_OUT)return!1;wa=wa?wa.getDataType():null;return wa==Sa.DATA_STRING||wa==Sa.DATA_NUMBER||wa==Sa.DATA_INT},P=function(wa,Ca,db,na,u){(wa=wa.getUserObject())&&wa.getValue()!==na&&(wa.setValue(na),db.setValue(na),q(null,null),d.setIsChange(!0),m&&m(d.getAssociateName(),null),z());return!0},aa=function(wa,Ca,db,na,u){var L=$(wa);L.empty();L.css("cursor","pointer");var C=u.getUserObject(),Q=C?C.getDataType():
null;Q==Sa.DATA_DATE||Q==Sa.DATA_DATETIME?(L=new Date,na=na?parseInt(na):null,isNaN(na)||null==na?C.setValue(L.getTime()):L.setTime(na),na=Ab.createCtrlInCell(wa,Ca,db,Q==Sa.DATA_DATETIME?Aa:ka),na.setDateObject(L),na.setUserObject(u),na.addModelChangedListener(jb)):Q==Sa.DATA_BOOLEAN?(wa=Ab.createCtrlInCell(wa,Ca,db,tb),wa.setSelected(na),wa.setItemModels([Jb.BOOLEAN_TRUE,Jb.BOOLEAN_FALSE]),wa.setUserObject(u),wa.setCustomPainter(function(fa,R,K){fa=K==Jb.BOOLEAN_TRUE?p.get("dataTypeTrue","\u771f"):
K==Jb.BOOLEAN_FALSE?p.get("dataTypeFalse","\u5047"):"";R.text(fa)}),wa.addSelectedChangedListener(Qb)):(u=$("<div>"),u.text(na),u.addClass("dm-common-tablecell-editable"),u.appendTo(L))},jb=function(wa){var Ca=""+wa.getDateObject().getTime();wa=wa.getUserObject();wa.getUserObject().setValue(Ca);d.setIsChange(!0);wa.getCell(4).setValue(Ca)},Qb=function(wa,Ca,db){wa=wa.getUserObject();wa.getUserObject().setValue(db);d.setIsChange(!0);wa.getCell(4).setValue(db)},za=function(){c&&c.remove()},Na=function(wa,
Ca,db){za();c=$("<div>");c.text(wa);c.addClass("dm-source-db-table-selection-waiting");c.css("top","165px");c.css("left","auto");c.css("right",0);c.css("color",db);c.appendTo(Ca)}}function cb(){var e,h,g;this.getJqUi=function(){e||a();return e};this.setSelectedCallback=function(d){h=d;g&&g.setSelectedCallback(h)};var a=function(){if(Db.MacroVariateSelectorRegister.isRegisterComplete()){var d=new Gb(p.get("insertVariate","\u63d2\u5165\u53d8\u91cf"));d.addActionListener(c);e=d.getJqUi()}else{d=new Sc;
d.setText(p.get("insertSystemVar","\u63d2\u5165\u7cfb\u7edf\u53d8\u91cf"));var f=dc.getImpl(dc.SYS_VAR_HELPER).createSysVarAdapters(fc.SUPPORTED_VAR_TYPE);d.setItemModels(f);d.setItemsWidth(285);d.setCustomPainter(k);d.addPressedListener(function(b,r){b=r.getTextInUserSQL();h(b)});e=d.getJqUi()}},c=function(){g=new ub;g.setSelectedCallback(h);g.showDialog()},k=function(d,f,b){d?(d=$("<div>"),d.text(b)):(b=b.getDisplayName(),f.attr("title",b),d=$("<div>"),d.text(b));d.appendTo(f)}}function ub(){ia.call(this);
var e=this,h=this.protectedMethod,g,a,c;(function(){h.setTitle(p.get("selectVariate","\u9009\u62e9\u53d8\u91cf"));e.setSize(500,540);h.setSelectable(!0);h.setContentPaneCreator(function(){g||(g=new Ea,g.setSelected(c));return g.getJqUi()});h.setClosingChecker2(function(k){if(k=g.getSelectedModel())return a(k),h.destroy(),!0;h.getMessageCurtain().showPrompt(p.get("noVarSelected","\u8bf7\u9009\u62e9\u4e00\u4e2a\u53d8\u91cf\u3002"));return!1},function(k){h.destroy();return!0});h.setClosingAction(function(k){})})();
this.setSelectedCallback=function(k){a=k};this.setSelected=function(k){c=k;g&&g.setSelected(c)}}function Ea(){var e,h,g,a,c,k,d,f;this.getJqUi=function(){e||(r(),b());return e};this.setSelected=function(m){h=m;e&&b()};this.getSelectedModel=function(){return g.isChecked()?c.getSelected():f.getSelectedModel()};var b=function(){if(h){var m=h.getVariateType();m==Db.AbstractVariateAdapter.VAR_TYPE_SYS?(g.setChecked(!0),c.setSelected(h)):m==Db.AbstractVariateAdapter.VAR_TYPE_MACRO&&(a.setChecked(!0),f&&
f.setSelected(h))}},r=function(){e=$("<div>");var m=0,t=new hd;g=new hb;g.setChecked(!0);g.setText(p.get("systemVar","\u7cfb\u7edf\u53d8\u91cf"));var A=g.getJqUi();A.appendTo(e);n.layoutCtrl(A,0,m,200,23);t.addElement(g);g.addCheckedListener(function(){d&&d.hide();c.setEnabled(!0)});c=new tb;A=dc.getImpl(dc.SYS_VAR_HELPER).createSysVarAdapters(fc.SUPPORTED_VAR_TYPE);c.setItemModels(A);c.setSelected(A[0]);c.setCustomPainter(function(E,M,z){E=z.getDisplayName();M.attr("title",E);z=$("<div>");z.text(E);
z.appendTo(M)});k=c.getJqUi();n.layoutCtrl(k,0,m+=43,200,23);k.appendTo(e);a=new hb;a.setText(p.get("macroVar","\u5b8f\u53d8\u91cf"));A=a.getJqUi();A.appendTo(e);n.layoutCtrl(A,0,m+=43,200,23);t.addElement(a);a.addCheckedListener(function(){c.setEnabled(!1);f?d&&d.show():(f=Db.MacroVariateSelectorRegister.createSelector(),h&&f.setSelected(h),d=f.getJqUi(),n.layoutCtrl(d,0,m+=33,465,290),d.appendTo(e))})}}function qb(e,h){function g(f){ia.call(this);var b=this,r=this.protectedMethod;(function(){r.setTitle(p.get("previewRuntimeSQL",
"\u67e5\u770b\u6267\u884c\u671fSQL"));b.setSize(960,540);r.setSelectable(!0);r.setContentPaneCreator(function(){var m=$("<div>"),t=new Ub;t.setText(f);t.setEnabled(!1);t=t.getJqUi();t.appendTo(m);n.layoutCtrlWithLRTB(t,0,0,null,0,0,null);return m});r.setFooterClosingOnly(!0);r.setClosingChecker2(null,function(m){r.destroy();return!0});r.setClosingAction(function(m){})})()}var a,c,k;this.getJqUi=function(){a||d();return a};this.setMessageCurtain=function(f,b){c=b;k=f};var d=function(){var f=new Gb(p.get("previewRuntimeSQL",
"\u67e5\u770b\u6267\u884c\u671fSQL"));f.addActionListener(function(){var b=dc.getAllImpl(),r=h();if(null==r||0>=r.trim().length)k.showPrompt(c+p.get("inputSqlNotNull","\u4e0d\u80fd\u4e3a\u7a7a\u3002"));else{var m=0,t=b.length,A=function(E){r=E;m++;m<t?b[m].switchSQLToPersistentMode(r,A):e(function(M){var z=r;M&&(z=M);(new g(z)).showDialog()},function(){(new g(r)).showDialog();return!0}).previewRuntimeUserSQL(r)};b[m].switchSQLToPersistentMode(r,A)}});a=f.getJqUi()}}function xc(){var e,h;this.setJqLeftPane=
function(a){e=a};this.getSwitchButtonStatus=function(){return h.isOn()};this.displayEntityCodingPane=function(a,c,k,d,f){var b=new ba;b.setText(k);b=b.getJqUi();b.attr("title",k);n.layoutCtrlWithLRTB(b,8,null,105,2,10,23);h=new Qa;h.setOn(!1);h.addStateChangeListener(function(){var m=$(a),t=$(c);g(m,d);g(t,".dm-source-db-table-selected-list-item");f(h.isOn())});k=h.getJqUi();n.layoutCtrlWithLRTB(k,120,null,35,2,10,23);var r=$("<div>");r.addClass("dm-field-popup-show-field-name");r.attr("id","dm-field-popup-show-field-comment");
r.css("margin-bottom","-3px");k.appendTo(r);b.appendTo(r);r.appendTo(e);e.parents(".sa-ctrl-dialog-padding").css("overflow","visible")};var g=function(a,c){for(var k=0;k<a.length;k++){var d=a.eq(k);if(d.attr("entity-coding")){var f=d.attr("entity-coding"),b=d.text();d.text(f);d.parents(c).attr("title",f);d.attr("entity-coding",b)}}}}function Hc(){this.updateSameSource=function(h,g,a,c,k){var d=h.getAllEntity();h=[];var f=new Nc,b=0;k&&(b++,e(k,a,f,h,c));for(var r in d){var m=d[r];if(!(m.isUnion()||
k&&k==m)){var t=m.getSource();g.isTheSame(t)&&(b++,e(m,a,f,h,c))}}g=b;(new ec).showResult(g,h)};var e=function(h,g,a,c,k){h.isUnion()||(a=a.getSupportState(h,g.getTypeName()),a.isSupport()?(c=h.getSource(),a=h.getName(),c.isUserSql(a)?(c=c.getUserSql(a),g.addUserSql&&g.addUserSql(c)):c.isStoredProcedure(a)&&(c=c.getStoredProcedure(a),g.addStoredProcedure&&g.addStoredProcedure(c)),k(h)):(a.setEntityAlias(h.getAlias()),c.push(a)))}}function Nc(){this.getSupportState=function(e,h){var g=new Za(!0),a=
e.getSource();if(a.isUserSql(e.getName())){e=a.getUserSql(e.getName()).getSqlType();var c=Za.UNSUPPORTED_TYPE_SQL;a=Db.BizSourceTypeContext.getSourceTypes();for(var k=0;k<a.length;k++)if(h==a[k].getName()){var d=Ha.createBizMetaSource(h);if(d.isBasedOnDB())return g}if(e==ja.SQLTYPE_KSQL){if(c=Za.UNSUPPORTED_TYPE_KSQL,ja.isNeedShowKSql(h))return g}else{a:{e=Ha.DB_SOURCES;for(a=0;a<e.length;a++)if(h==e[a].getName()){h=!0;break a}h=!1}if(h)return g}}else if(a.isStoredProcedure(e.getName())){c=Za.UNSUPPORTED_TYPE_STOREPROCEDURE;
if(ja.isNeedShowPrecedure(h))return g;a=Db.BizSourceTypeContext.getSourceTypes();for(k=0;k<a.length;k++)if(h==a[k].getName()&&(d=Ha.createBizMetaSource(h),d.supportStoredProcedure()))return g}if(!c)return g;g.setSupport(!1);g.setUnsupportedType(c);return g}}function Za(e,h){var g=e,a=h,c;this.isSupport=function(){return g};this.setSupport=function(k){g=k};this.getUnsupportedType=function(){return a};this.setUnsupportedType=function(k){a=k};this.setEntityAlias=function(k){c=k};this.getEntityAlias=
function(){return c}}function ec(){this.showResult=function(g,a){if(a&&0!=a.length){var c=a.length;g-=c;c=p.get("changeSourceResult","\u66f4\u65b0\u6210\u529f\u6570\u636e\u8868#1\u5f20\uff0c\u5931\u8d25#2\u5f20").replace("#1",g).replace("#2",c);g=ob.createFeedbackDialog();g.setMsgImageType(ob.MSG_WARNING);g.setExtendPainter(function(k,d){var f=$("<div>");f.addClass("sa-ctrl-feedback-dialog-text");f.css({left:"75px",right:"75px"});f.text(d);f.attr("title",d);f.appendTo(k);d=new sa;d.setIconType(sa.ICON_TYPE_QUESTION);
d.setTipsSize(265,70);f=d.setTipsText;for(var b=p.get("unsupportedSourceTips","\u540c\u4e00\u6570\u636e\u6e90\u7684\u5176\u4ed6\u6570\u636e\u8868\u4e2d\uff0c\u5b58\u5728\u4f7f\u7528#1\u53d6\u6570\u7684\u6570\u636e\u8868\uff0c\u66f4\u6362\u7684\u6570\u636e\u6e90\u4e0d\u652f\u6301\u8fd9#2\u79cd\u53d6\u6570\u7c7b\u578b\u3002"),r="",m=0,t=0;t<a.length;t++){var A=h(a[t].getUnsupportedType());0>r.indexOf(A)&&(0<m&&(r+=p.get("splitMark","\u3001")),r+=p.get("quotationMark","\u201c#1\u201d").replace("#1",
A),m++)}m=1==m?"":m+"";b=b.replace("#1",r).replace("#2",m);f.call(d,b);d=d.getJqUi();d.css({position:"absolute",right:"60px",top:"3px"});d.appendTo(k)});g.setOptionType(ob.OPTION_OK);g.setButtonText(ob.RETURN_OK,p.get("iSee","\u6211\u77e5\u9053\u4e86"));g.setMessage(c);g.setDetail(e(a));g.showDialog()}};var e=function(g){for(var a=p.get("followingEntityChangeSourceFailed","\u4ee5\u4e0b\u6570\u636e\u8868\u66f4\u6362\u6570\u636e\u6e90\u5931\u8d25\uff1a")+"\r\n",c=0;c<g.length;c++){var k=g[c],d="  ",
f=k.getEntityAlias();k=k.getUnsupportedType();k=h(k);d=d+f+"(";d+=k;d+=");\r\n";a+=d}return a},h=function(g){switch(g){case Za.UNSUPPORTED_TYPE_SQL:var a=p.get("customSql","\u81ea\u5b9a\u4e49")+ja.SQLTYPE_SQL;break;case Za.UNSUPPORTED_TYPE_KSQL:a=p.get("customSql","\u81ea\u5b9a\u4e49")+ja.SQLTYPE_KSQL;break;case Za.UNSUPPORTED_TYPE_STOREPROCEDURE:a=p.get("storedProcedure","\u5b58\u50a8\u8fc7\u7a0b")}return a}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==
typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.data&&(com.kingdee.bos.qing.data={});var Db=com.kingdee.bos.qing.data;Db.SourceType=Ha;Db.AbstractImportEntityStep=Kb;Db.SourceTypeStep=jc;Db.DbConnectionStep=da;Db.SelectFieldPane=Gc;Db.AbstractSourceModifyingEditor=kd;Db.DbConnectionModifyingEditor=function(){kd.call(this);var e=this,h=this.protectedMethod,g,a,c,k,d,f,b,r,m=[new ea(ja.TYPE_HANA,
30,4,!1,new Dc,!0,!0),new ea(ja.TYPE_MYSQL,-1,-1,!1,new oc,!0,!1),new ea(ja.TYPE_SQLSERVER,-1,-1,!1,new uc,!0,!1),new ea(ja.TYPE_SYBASE,-1,-1,!1,new Wb,!0,!1),new ea(ja.TYPE_ORACLE,30,-1,!1,new Bc,!1,!1),new ea(ja.TYPE_ODPS,30,-1,!1,new rc,!1,!1),new ea(ja.TYPE_POSTGRESQL,30,-1,!1,new $b,!0,!0),new ea(ja.TYPE_DB2,30,-1,!1,new vc,!0,!0),new ea(ja.TYPE_ACCESS,30,-1,!0,new Ob,!1,!1),new ea(ja.TYPE_SQLITE,30,-1,!0,new bd,!1,!1),new ea(ja.TYPE_HIVE,30,-1,!1,new Uc,!1,!1),new ea(ja.TYPE_REDSHIFT,30,-1,
!0,new Eb,!0,!0),new ea(ja.TYPE_TIDB,-1,-1,!1,new xb,!0,!1),new ea(ja.TYPE_DM,-1,-1,!1,new ab,!0,!1),new ea(ja.TYPE_GREENPLUM,30,-1,!1,new Xa,!0,!0),new ea(ja.TYPE_GAUSSDB,30,4,!1,new Mb,!0,!1),new ea(ja.TYPE_APACHEDRILL,30,-1,!1,new mb,!0,!1),new ea(ja.TYPE_SPARKSQL,30,-1,!1,new Qc,!1,!1),new ea(ja.TYPE_SYBASEIQ,-1,-1,!1,new tc,!0,!1),new ea(ja.TYPE_IMPALA,30,-1,!1,new cc,!1,!1),new ea(ja.TYPE_KYLIN,30,-1,!1,new oa,!0,!0),new ea(ja.TYPE_KINGBASE,30,-1,!1,new ma,!0,!0),new ea(ja.TYPE_TDSQL,-1,-1,
!1,new Lb,!0,!1),new ea(ja.TYPE_GBASE,30,-1,!1,new Ib,!0,!0),new ea(ja.TYPE_VASTBASE,30,-1,!1,new Vb,!0,!0),new ea(ja.TYPE_DORIS,-1,-1,!1,new eb,!0,!1),new ea(ja.TYPE_YASHANDB,30,-1,!1,new Kc,!1,!0)],t=function(x){var q=m.filter(function(D){return D.getDbType()==x.getDbType()});return q&&1==q.length?q[0]:null},A=function(x,q){b=x.getConnectionPane();-1!=x.getDownOffset()&&b.setDownOffset(x.getDownOffset());-1!=x.getConfigRowCount()&&b.setDbConfigRowCount(x.getConfigRowCount());x.isNeedSelectDb()&&
b.addSuccessCallbackListener(M);b.setSource(q);b.setCtxApi(k);b.addSuccessCallbackListener(z);b.addErrorCallbackListener(H);b.setDownSpace(30);return b.getJqUi(x.isNotShowAll())};this.propectedCreateJqUi=function(x,q,D,G,ca){g=x;a=q;c=D;k=G;r=ca;x=c.clone();q=a.getAssociateName();D.isUserSql(q)?(D=c.getUserSql(q),x.addUserSql(D)):D.isStoredProcedure(q)&&(D=c.getStoredProcedure(q),x.addStoredProcedure(D));D=$("<div>");q=t(x);D.append(A(q,x));q.isNeedSelectDb()&&(f=new tb,q.isSchemaSupported()?(x=new ba(p.get("dbschema",
"\u6a21\u5f0f")),f.setSelected(c.getSchema())):(x=new ba(p.get("database","\u6570\u636e\u5e93")),f.setSelected(c.getDbName())),x=x.getJqUi(),q=f.getJqUi(),n.layoutCtrl(x,20,b.getCurrentHight()+30,70,23),n.layoutCtrl(q,105,b.getCurrentHight()+30,200,23),D.append(x),D.append(q));d=new Ja;d.setText(p.get("actOnTheSameDatabase","\u540c\u65f6\u4fee\u6539\u5f53\u524d\u4e3b\u9898\u4e2d\u5176\u4ed6\u540c\u6e90\u6570\u636e\u8868"));d.setChecked(!0);x=d.getJqUi();n.layoutCtrl(x,20,b.getCurrentHight()+60,250,
23);D.append(x);x=new Cc;var y=e.getConfirmListener();x.setClosingAction(function(P){y&&y(P)});x.setCloseCallerDialogCallback(function(){h.destroy()});x.setChangeDataSourceParameter(g,a,k,r,c);x=x.getJqUi();n.layoutCtrl(x,0,b.getCurrentHight()+90,120,60);D.append(x);return D};this.protectedIsValidToAccepted=function(x){var q=b.collectSource(),D=t(q);D.isNeedSelectDb()&&(D.isSchemaSupported()?q.setSchema(f.getSelected()):q.setDbName(f.getSelected()));q.getDbType()==ja.TYPE_SQLITE?b.getHasUploadFile()?
x(!0):h.getMessageCurtain().showPrompt(p.get("pleaseUploadFile","\u8bf7\u5148\u4e0a\u4f20\u6587\u4ef6\u3002")):q.getDbType()==ja.TYPE_ACCESS?b.getHasUploadFile()?E(q,x):h.getMessageCurtain().showPrompt(p.get("pleaseUploadFile","\u8bf7\u5148\u4e0a\u4f20\u6587\u4ef6\u3002")):E(q,x)};this.protectedAccepted=function(x,q){var D=!d.isChecked(),G=b.collectSource(),ca=t(G);ca.isNeedSelectDb()&&(ca.isSchemaSupported()?G.setSchema(f.getSelected()):G.setDbName(f.getSelected()));if(D){if(!G.isTheSame(q))for(D=
g.getSources(),x.setSource(G),x.mergeSource(D),D=g.getSources(),G=0,x=D.length;G<x;G++)g.funClearUserSqlsAndStoredProcedures(D[G]);e.refreshDesigntimeDataObject(a,a.getSource(),k)}else{q.setDbAddress(G.getDbAddress());q.setDbPort(G.getDbPort());q.setDbName(G.getDbName());q.setUserName(G.getUserName());q.setPassword(G.getPassword());ca.isSchemaSupported()&&q.setSchema(G.getSchema());D=g.getSources();for(G=0;G<D.length;G++)if(ca=D[G],q.isTheSame(ca)&&q!=ca){D=q;q=ca;q.mergeFrom(D);break}D=x.getSource();
x.setSource(q);h.updateSameSource(x,D)}};var E=function(x,q){var D=b.checkTextFields();D?h.getMessageCurtain().showPrompt(D):(x=x.toJsonObject(),k.createFacade(function(G){q(!0)},function(G,ca){q(!1);G=G.toString();return"20"==G.substr(0,2)&&7==G.length?(h.getMessageCurtain().showPrompt(ca),!0):!1}).checkConnection(x))},M=function(){f.setItemModels(b.getDbNameList())},z=function(){h.getMessageCurtain().showSuccess(p.get("connectionSuccessful","\u8fde\u63a5\u6210\u529f\u3002"))},H=function(x){h.getMessageCurtain().showPrompt(x)}};
Db.FileConnectionModifyingEditor=function(){kd.call(this);var e=this,h=this.protectedMethod,g,a,c,k,d,f;this.propectedCreateJqUi=function(m,t,A,E,M){a=m;c=t;k=A;d=E;m=A.clone();g=new I;g.setCtxApi(d);g.setText(p.get("reupload","\u91cd\u65b0\u4e0a\u4f20"));t=lb.getUrlParamValue("flatFileSize");g.setFileSize(t?t:100);g.setSource(m);g.setMessageCurtain(h.getMessageCurtain());m=$("<div>");t=g.getJqUi();A=new Cc;var z=e.getConfirmListener();A.setChangeDataSourceParameter(a,c,d,M,k);A.setClosingAction(function(H){z&&
z(H)});A.setCloseCallerDialogCallback(function(){h.destroy()});M=A.getJqUi();k.getFileType()==gb.TYPE_EXCEL?n.layoutCtrl(M,0,240,120,60):n.layoutCtrl(M,0,300,120,60);m.append(t);m.append(M);return m};this.protectedIsValidToAccepted=function(m){if(g.hasUploadFile()){f=[];var t=g.getSource(),A=t.toJsonObject();k.getFileType()==gb.TYPE_TXT||k.getFileType()==gb.TYPE_CSV?t.getSplitSign()?m(!0):(h.getMessageCurtain().showPrompt(p.get("customSplitSignShouldNotNull","\u81ea\u5b9a\u4e49\u5206\u9694\u7b26\u4e0d\u80fd\u4e3a\u7a7a\u3002")),
m(!1)):k.getFileType()!=gb.TYPE_EXCEL&&k.getFileType()!=gb.TYPE_XML||d.createFacade(function(E){var M=new Pa;M.fromJsonObject(E);E=M.getChildren();for(M=0;M<E.length;M++)r(E[M]);E=c.getAssociateName().substring(c.getAssociateName().indexOf("/")+1);0<=f.indexOf(E)&&m(!0);0<=f.indexOf(E)||k.getFileType()!=gb.TYPE_EXCEL||(h.getMessageCurtain().showPrompt(p.get("noCorrespondingSheetInThisFile","\u4e0a\u4f20\u7684\u6587\u4ef6\u4e2d\u6ca1\u6709\u540d\u79f0\u4e3a\u201c#1\u201d\u7684\u5de5\u4f5c\u8868\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u3002").replace("#1",
E)),m(!1));0<=f.indexOf(E)||k.getFileType()!=gb.TYPE_XML||(h.getMessageCurtain().showPrompt(p.get("noCorrespondingXmlNodeInThisFile","\u4e0a\u4f20\u7684\u6587\u4ef6\u4e2d\u6ca1\u6709\u201c#1\u201d\u8282\u70b9\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u3002").replace("#1",E)),m(!1))},function(E,M){E=E.toString();return"20"==E.substr(0,2)&&7==E.length?(h.getMessageCurtain().showPrompt(M),k.getFileType()==gb.TYPE_XML&&m(!1),!0):!1}).getUsableEntities(A)}else h.getMessageCurtain().showPrompt(p.get("pleaseUploadFile",
"\u8bf7\u5148\u4e0a\u4f20\u6587\u4ef6\u3002")),m(!1)};this.protectedAccepted=function(m,t){var A=g.getSource(),E=!g.getCheckBoxState();if(A.getFileType()==gb.TYPE_XML&&0<m.getAssociateName().indexOf("/")){var M=b(A.getFileName()),z=b(t.getFileName());M+=m.getAssociateName().replace(z,"");m.setAssociateName(M)}if(E)A.isTheSame(t)||(m.setSource(A),m.mergeSource(a.getSources())),e.refreshDesigntimeDataObject(c,c.getSource(),d);else{if(A.getFileType()!=gb.TYPE_EXCEL&&A.getFileType()!=gb.TYPE_XML){if(!sSplitSign){h.getMessageCurtain().showPrompt(p.get("customSplitSignShouldNotNull",
"\u81ea\u5b9a\u4e49\u5206\u9694\u7b26\u4e0d\u80fd\u4e3a\u7a7a\u3002"));funCallback(e);return}t.setSplitSign(sSplitSign);t.setTextLimitSign(A.getTextLimitSign())}t.setCharacterSet(A.getCharacterSet());t.setDefineTypeRowCount(A.getDefineTypeRowCount());t.setFileUrl(A.getFileUrl());t.setFileName(A.getFileName());A=m.getSource();m.setSource(t);h.updateSameSource(m,A)}};var b=function(m){return m.substring(0,m.lastIndexOf("."))},r=function(m){f.push(m.getName().substring(m.getName().indexOf("/")+1));if(m instanceof
Pa&&(m=m.getChildren()))for(var t=0;t<m.length;t++)r(m[t])}};Db.OpenAPIConnectionModifyingEditor=function(){kd.call(this);var e=this,h=this.protectedMethod,g,a,c,k,d,f,b,r,m,t,A;this.propectedCreateJqUi=function(H,x,q,D,G){g=H;a=x;c=D;b=q;t=G;k||E();return k};var E=function(){k=$("<div>");r=new ba(p.get("RESTfulDataSet","RESTful\u6570\u636e\u96c6"));var H=b.clone();d=new Ra;d.setPlaceholder(p.get("RESTfulDataSetUrlPlaceholder","\u8bf7\u8f93\u5165URL\u5168\u8def\u5f84"));var x="URL";"PROGRAM_DATA_SET"==
H.getOpenAPIType()&&(d.setPlaceholder(p.get("programDataSetPlaceholder","\u8bf7\u8f93\u5165Java\u7c7b\u7684\u5168\u8def\u5f84")),r=new ba(p.get("programDataSet","\u7a0b\u5e8f\u6570\u636e\u96c6\uff1a")),x=p.get("classPath","\u7c7b\u8def\u5f84"));d.setText(Ga.decode(H.getUrl()));var q=d.getJqUi();x=(new ba(x)).getJqUi();x.appendTo(k);n.layoutCtrl(x,20,35,80,23);n.layoutCtrl(q,80,35,510,23);q.appendTo(k);q=r.getJqUi();q.css("font-size","14px");n.layoutCtrl(q,0,0,200,23);q.appendTo(k);f=new Ja;f.setText(p.get("actOnTheSameDatabase",
"\u540c\u65f6\u4fee\u6539\u5f53\u524d\u4e3b\u9898\u4e2d\u5176\u4ed6\u540c\u6e90\u6570\u636e\u8868"));f.setChecked(!0);q=f.getJqUi();k.append(q);x=new Cc;var D=e.getConfirmListener();x.setClosingAction(function(G){D&&D(G)});x.setCloseCallerDialogCallback(function(){h.destroy()});x.setChangeDataSourceParameter(g,a,c,t,b);x=x.getJqUi();k.append(x);"RESTFUL_DATA_SET"==H.getOpenAPIType()?(A=new l(!0),b.getAuthModel()&&A.setModel(b.getAuthModel()),H=A.initUi(),n.layoutCtrl(H,10,73,580,265),k.append(H),
n.layoutCtrl(q,20,348,250,23),n.layoutCtrl(x,0,378,120,60)):(n.layoutCtrl(q,20,80,250,23),n.layoutCtrl(x,0,120,120,60))};this.protectedAccepted=function(H,x){var q=b.clone(),D=null;if("RESTFUL_DATA_SET"==q.getOpenAPIType()){var G=A.getAbstractOpenAPIAuth();G&&(G=G.protectedGetModelFromUI())&&(D=G.protectedToJsonObject())}f&&f.isChecked()?(x.setUrl(Ga.encode($.trim(d.getText()))),x.setAuthModel(D),H.mergeSource(q),q=H.getSource(),H.setSource(x),h.updateSameSource(H,q)):(q.setAuthModel(D),q.setUrl(Ga.encode($.trim(d.getText()))),
q.isTheSame(x)||(H.setSource(q),H.mergeSource(g.getSources())),e.refreshDesigntimeDataObject(a,a.getSource(),c))};this.protectedIsValidToAccepted=function(H){var x=b.clone();m=[];if($.trim(d.getText())){x.setUrl(Ga.encode($.trim(d.getText())));if("RESTFUL_DATA_SET"==x.getOpenAPIType()){var q=A.getAbstractOpenAPIAuth();if(q){var D=q.protectedGetModelFromUI();if(null!=q.protectedCheckParams()){H(!1);h.getMessageCurtain().showPrompt(q.protectedCheckParams());return}x.setAuthModel(D.protectedToJsonObject())}}var G=
x.toJsonObject();c.createFacade(function(ca){M(G,H)},function(ca,y){H(!1);ca=ca.toString();if("20"==ca.substr(0,2)&&7==ca.length){if("20612"==ca.substr(0,5)||"20622"==ca.substr(0,5))return!1;2061100==ca?h.getMessageCurtain().showError(p.get("error2061100","\u8bf7\u586b\u5199\u6b63\u786e\u7684url\uff0c\u5982\u679c\u662f\u6839\u8def\u5f84\uff0c\u5fc5\u987b\u4ee5.QData\u7ed3\u5c3e\u3002")):2061103==ca?h.getMessageCurtain().showError(p.get("error2061103","pageSize\u7684\u503c\u5fc5\u987b\u57282000\u81f320000\u4e4b\u95f4\u3002")):
2061104==ca?h.getMessageCurtain().showError(p.get("error2061104","\u53c2\u6570\u5f02\u5e38,pageNo\uff0cselectedFields\u4e3a\u7cfb\u7edf\u53c2\u6570\u3002")):2062100==ca?h.getMessageCurtain().showError(p.get("error2062100","\u6ca1\u6709\u5b9e\u73b0\u63a5\u53e3ITableDataProvider\u3002")):2061301==ca?h.getMessageCurtain().showError(p.get("error2061301","\u8bf7\u586b\u5199\u6b63\u786e\u7684\u8ba4\u8bc1\u4fe1\u606f\u3002")):2061302==ca?h.getMessageCurtain().showPrompt(p.get("error2061302","\u8bf7\u586b\u5199\u5b8c\u6574\u7684\u8ba4\u8bc1\u4fe1\u606f\u3002")):
2061303==ca?h.getMessageCurtain().showPrompt(p.get("error2061303","\u6458\u8981\u8ba4\u8bc1\u670d\u52a1\u5668\u8d28\u8be2\u5934\u53c2\u6570\u5f02\u5e38\u3002")):h.getMessageCurtain().showError(y);return!0}return!1}).openAPIInitialCheck(G)}else H(!1),"RESTFUL_DATA_SET"==x.getOpenAPIType()?h.getMessageCurtain().showPrompt(p.get("urlNotNull","URL\u4e0d\u80fd\u4e3a\u7a7a\u3002")):h.getMessageCurtain().showPrompt(p.get("classNameNotNull","Java\u7c7b\u7684\u5168\u8def\u5f84\u4e0d\u80fd\u4e3a\u7a7a\u3002"))};
var M=function(H,x){c.createFacade(function(q){var D=new Pa;D.fromJsonObject(q);q=D.getChildren();for(D=0;D<q.length;D++)z(q[D]);0<=m.indexOf(a.getAssociateName())?x(!0):(h.getMessageCurtain().showPrompt(p.get("noCorrespondingTable","\u6ca1\u6709\u5bf9\u5e94\u7684\u8868,\u8bf7\u91cd\u65b0\u586b\u5199URL\u3002")),x(!1))},function(q,D){q=q.toString();return"20"==q.substr(0,2)&&7==q.length?(h.getMessageCurtain().showPrompt(D),!0):!1}).getUsableEntities(H)},z=function(H){m.push(H.getName());if(H instanceof
Pa&&(H=H.getChildren()))for(var x=0;x<H.length;x++)z(H[x])}};Db.DbSelectTableStep=zb;Db.DbSelectFieldStep=zc;Db.StoredProcedurePreviewPanel=S;Db.MetaDBConnectionStep=function(){Kb.call(this);var e=this,h=this.protectedMethod,g,a,c,k,d,f,b,r,m,t,A=!1,E=!1,M=!1,z,H=!1,x,q;this.setChangeSourceType=function(y){H=y};this.getChangeSourceType=function(){return H};this.setOldEntity=function(y){z=y};this.getOldEntity=function(){return z};this.setDModel=function(y){q=y};this.getDModel=function(){return q};
this.isShowDataBase=function(y){A=y};this.setDbChecker=function(y){m=y};this.setDataBaseJqUiCreator=function(y){t=y};this.getSubTitle=function(){return p.get("connectDbCenter","\u6570\u636e\u4e2d\u5fc3")};this.setSource=function(y){r=y};this.getSource=function(){return r};this.setSupportStoredProcedure=function(y){M=y};this.protectedCreateUi=function(){var y=$("<div>");b=$("<div>");y.append(b);return y};this.intoThisStep=function(y,P){A?(E=!0,H?ca():G()):(E=!1,h.checkConnection(r,function(aa){aa?
(E=!0,H?ca():G()):E=!1}))};this.outThisStep=function(y,P){y?P(null):(y=Db.BizSourceTypeContext.getPermissionChecker())?y(r.getTypeName(),h.getMessageCurtain(),function(){z&&H&&A?m(r,h.getMessageCurtain())&&D(P):D(P)},function(){}):D(P)};this.isLastStep=function(){return H?!0:!1};this.over=function(y,P){z&&H&&y&&(P=!x.isChecked(),y=z.getSource(),P?(r.isTheSame(y)||(P=z.getName(),y.isUserSql(P)?(P=y.getUserSql(P),r.addUserSql(P)):y.isStoredProcedure(P)&&(P=y.getStoredProcedure(P),r.addStoredProcedure(P)),
P=q.getSources(),z.setSource(r),z.mergeSource(P),(y.hasUserSql()||y.hasStoredProcedure())&&q.funClearUserSqlsAndStoredProcedures(y)),h.refreshDesigntimeDataObject(z,r)):(y.hasUserSql()&&r.setAllUserSql(y.getAllUserSql()),y.hasStoredProcedure()&&r.setAllStoredProcedure(y.getAllStoredProcedure()),(new Hc).updateSameSource(q,y,r,function(aa){aa.setSource(r);aa.mergeSource(q.getSources());h.refreshDesigntimeDataObject(aa,r)},z)))};this.createNextTableSteps=function(){var y=new zb;y.setCtxApi(e.getCtxApi());
y.setSource(r);var P=new zc;P.setCtxApi(e.getCtxApi());P.setSource(r);return[y,P]};this.creatNextCustomSqlStep=function(){var y=new lc;y.setSqlType(ja.SQLTYPE_SQL);y.setCtxApi(e.getCtxApi());y.setSource(r);return y};this.creatNextCustomKSqlStep=function(){var y=new lc;y.setSqlType(ja.SQLTYPE_KSQL);y.setCtxApi(e.getCtxApi());y.setSource(r);return y};this.creatNextStoredProcedureStep=function(){var y=new ad;y.setCtxApi(e.getCtxApi());y.setSource(r);return y};this.changeDBType=function(y){if(!H){g.setChecked(!0);
var P=ja.isNeedShowKSql(y);d.css("display",P?"block":"none");f.css("display",ja.isNeedShowPrecedure(y)?"block":"none");P?f.css("top",160):f.css("top",120)}};var D=function(y){if(H)y(null);else if(E){if(!A||m(r,h.getMessageCurtain()))if(g.isChecked()){var P=e.createNextTableSteps();y(P)}else a.isChecked()?(P=e.creatNextCustomSqlStep(),y(P)):c&&c.isChecked()?(P=e.creatNextCustomKSqlStep(),y(P)):k&&k.isChecked()&&(P=e.creatNextStoredProcedureStep(),y(P))}else y(e)},G=function(){b.detach();b=$("<div>");
var y=0;if(A){var P=t(h.getMessageCurtain());b.append(P);y+=40}P=(new ba(p.get("type","\u7c7b\u578b"))).getJqUi();n.layoutCtrl(P,15,y,70,23);b.append(P);P=new hd;g=new hb;g.setChecked(!0);g.setText(p.get("table","\u8868"));var aa=g.getJqUi();aa.attr("title",p.get("table","\u8868"));n.layoutCtrl(aa,60,y,300,23);b.append(aa);P.addElement(g);a=new hb;a.setText(p.get("customSql","\u81ea\u5b9a\u4e49")+ja.SQLTYPE_SQL);aa=a.getJqUi();aa.attr("title",p.get("customSql","\u81ea\u5b9a\u4e49")+ja.SQLTYPE_SQL);
y+=40;n.layoutCtrl(aa,60,y,300,23);b.append(aa);P.addElement(a);c=new hb;c.setText(p.get("customSql","\u81ea\u5b9a\u4e49")+ja.SQLTYPE_KSQL);d=c.getJqUi();d.attr("title",p.get("customSql","\u81ea\u5b9a\u4e49")+ja.SQLTYPE_KSQL);y+=40;n.layoutCtrl(d,60,y,300,23);b.append(d);P.addElement(c);k=new hb;k.setText(p.get("storedProcedure","\u5b58\u50a8\u8fc7\u7a0b"));f=k.getJqUi();f.attr("title",p.get("storedProcedure","\u5b58\u50a8\u8fc7\u7a0b"));n.layoutCtrl(f,60,y+40,300,23);M&&b.append(f);P.addElement(k);
e.getJqUi().append(b)},ca=function(){b.detach();b=$("<div>");var y=0,P=(new ba(p.get("dataCenter","\u5f53\u524d\u6570\u636e\u4e2d\u5fc3"))).getJqUi();n.layoutCtrl(P,0,y,120,23);b.append(P);y+=40;A&&(P=t(h.getMessageCurtain()),n.layoutCtrl(P,5,y,120,23),b.append(P),y+=40);x=new Ja;x.setText(p.get("actOnTheSameDatabase","\u540c\u65f6\u4fee\u6539\u5f53\u524d\u4e3b\u9898\u4e2d\u5176\u4ed6\u540c\u6e90\u6570\u636e\u8868"));x.setChecked(!1);P=x.getJqUi();n.layoutCtrl(P,20,y,250,23);P.css("z-index",1);b.append(P);
e.getJqUi().append(b)}};Db.DbCustomSqlPanel=yc;Db.DropdownItemListPane=Sc;Db.VarSelectDialog=ub;Db.UploadDbFilePane=Wa;Db.FileConnectionStep=ed;Db.DbCustomSqlStep=lc;Db.DBStoredProcedureStep=ad;Db.OpenAPIConnectionStep=Ec;Db.TableAndFieldSelectDialog=function(e,h,g,a){function c(){this.getSelectedDataObjectMap=function(){var G={};G[r.getAssociateName()]=m;return G}}function k(){var G=0,ca={};this.init=function(y){y.getProperties().forEach(function(P){ca[P.getAssociateName()]=P})};this.changeField=
function(y,P){y=y.getAssociateName();ca[y]?P?G--:G++:P?G++:G--};this.getFieldChangeCount=function(){return G}}ia.call(this);var d=this,f=this.protectedMethod,b,r=e,m=g,t=new zc,A={},E,M={},z;this.setRelationPropName=function(G){z=G};this.setSelectConfirmHandler=function(G){E=G};var H=function(){var G={getMessageCurtain:f.getMessageCurtain};b=$("<div>");t.setDefaultCheckEntityMap(A);t.setSource(a);t.setFieldSelectChangeListener(x);t.setRelationPropName(z);b.append(t.getJqUi(G));h.forEach(function(ca){A[ca.getAssociateName()]=
ca;var y=new k;y.init(ca);M[ca.getAssociateName()]=y});t.intoThisStep(new c,!1)},x=function(G,ca,y){var P=M[G];P||(P=new k,M[G]=P);P.changeField(ca,y)};this.initUi=function(){f.setTitle(p.get("selectTableAndField","\u9009\u62e9\u6570\u636e\u8868\u53ca\u5b57\u6bb5"));d.setSize(960,550);f.setContentPaneCreator(function(){H();return b});f.setClosingChecker(q,!0);f.setClosingAction(D)};var q=function(G){t.checkEntityAndField(function(ca){if(ca){var y=t.getCheckedEntities(),P=[],aa=[],jb=[],Qb={},za=t.getAllInnerRelations(),
Na=[];y.forEach(function(wa){var Ca=wa.getAssociateName();Qb[Ca]=wa;A[Ca]?(Ca=M[Ca])&&0<Ca.getFieldChangeCount()&&jb.push(wa):(aa.push(wa),(Ca=wa.getParentEntity())&&A[Ca.getAssociateName()]&&(wa.setParentEntity(A[Ca.getAssociateName()]),za.forEach(function(db){db.getToEntity()==wa&&(db.setFromEntity(wa.getParentEntity()),Na.push(db))})),A[wa.getAssociateName()]=wa)});h.forEach(function(wa){Qb[wa.getAssociateName()]||P.push(wa)});z?E&&E(y[0],P,aa,jb,Na):E&&E(r,P,aa,jb,Na)}G(ca)})},D=function(G){}};
Db.AdvancedSettingPane=Cc;Db.ChoosePropertyPane=function(){var e=[],h,g,a,c,k,d=!1,f=!0;this.setItemModel=function(b){e=b};this.setShowFieldNameEnable=function(b){f=b};this.setRawTypeSwitchListener=function(b){};this.setSearchListener=function(b){h=b};this.setListItemPainter=function(b){g=b};this.setShowFieldNameListener=function(b){a=b};this.createJqPopup=function(b,r,m){c=$("<div>");c.appendTo(b);k=$("<div>");c.addClass("dm-field-popup");b=p.get("search","\u641c\u7d22");var t=new Y;t.setSearchListenerDelay(200);
t.setPlaceholder(b);t.addSearchListener(function(){h(e,t.getText(),k,r,g,d)});b=t.getJqUi();b.addClass("dm-field-popup-search");b.appendTo(c);k.addClass("dm-field-popup-list-owner");k.on("click",function(M){var z=$(M.currentTarget);M=$(M.target);if(M=n.upwardSearchHasClass(M,z,"dm-field-popup-list-item"))M.addClass("dm-list-item_selected_enabled"),z=M.data("model"),m(z)});k.appendTo(c);b=c.find(".sa-ctrl-textfield-input");b.css("top","0px");b.css("height","100%");for(b=0;b<e.length;b++)g(e[b],k,r,
!1);if(f){b=new ba;var A=p.get("showFieldName","\u663e\u793a\u539f\u5b57\u6bb5\u540d\u79f0");b.setText(A);b=b.getJqUi();b.attr("title",A);n.layoutCtrlWithLRTB(b,8,null,100,2,10,23);A=new Qa;A.addStateChangeListener(function(M,z,H){(d=H)?a&&a(k,!0):a&&a(k,!1)});A.setOn(!1);A=A.getJqUi();n.layoutCtrlWithLRTB(A,110,null,35,2,10,23);var E=$("<div>");E.addClass("dm-field-popup-show-field-name");A.appendTo(E);b.appendTo(E);E.appendTo(c)}else k.css("bottom","5px")}};Db.SourceChangeHelper=Hc;Db.OpenAPIAuthTypeUI=
l;Db.AbstractPreviewTablePanel=U;Db.SuperQueryConnectionStep=function(){function e(){var x,q,D,G;this.getType=function(){return"currentSystem"};this.getSchema=function(){return G};this.isTable=function(){return q.isChecked()};this.isCustomSql=function(){return D.isChecked()};this.getErrorMessage=function(){return G?null:p.get("selectOneSchema","\u8bf7\u9009\u62e9\u4e00\u4e2a\u6a21\u5f0f\u3002")};this.getJqUi=function(){x||(x=$("<div>"),ca());return x};var ca=function(){var y=0,P=(new ba(p.get("schemas",
"\u6a21\u5f0f"))).getJqUi();n.layoutCtrl(P,15,y,60,23);x.append(P);P=new B;P.setSchemas(b);P.setSelectedSchema(r);P.setFunSelectCallBack(function(jb){G=jb});P=P.getJqUi();n.layoutCtrl(P,60,y,200,23);x.append(P);y+=40;P=(new ba(p.get("type","\u7c7b\u578b"))).getJqUi();n.layoutCtrl(P,15,y,60,23);x.append(P);P=new hd;q=new hb;q.setChecked(!0);q.setText(p.get("table","\u8868"));var aa=q.getJqUi();n.layoutCtrl(aa,60,y,120,23);x.append(aa);P.addElement(q);y+=40;D=new hb;D.setText(p.get("customSql","\u81ea\u5b9a\u4e49")+
ja.SQLTYPE_SQL);aa=D.getJqUi();n.layoutCtrl(aa,60,y,120,23);x.append(aa);P.addElement(D)}}Kb.call(this);var h=this,g=this.protectedMethod,a,c,k,d,f=!1,b=[],r,m,t;this.getSubTitle=function(){return p.get("superQuery","\u8d85\u7ea7\u67e5\u8be2")};this.setMessageCurtain=function(x){};this.setChangeSourceType=function(x){f=x};this.getChangeSourceType=function(){return f};this.setDModel=function(x){d=x};this.getDModel=function(){return d};this.setSource=function(x){t=x};this.getSource=function(){return t};
this.setOldEntity=function(x){m=x};this.getOldEntity=function(){return m};this.protectedCreateUi=function(){var x=$("<div>");c=$("<div>");x.append(c);return x};this.intoThisStep=function(x,q){if(0<c.children().length)return!0;E()};var A=function(){c.detach();c=$("<div>");k=new J;k.setSchemas(b);k.setSelectedSchema(r);k.setOffset(0);c.append(k.getJqUi());a=k;h.getJqUi().append(c)},E=function(){var x=t.clone();x.clear();h.getCtxApi().createFacade(function(q){b=[];for(var D=Object.keys(q),G=0;G<D.length;G++){var ca=
new bb;ca.setName(D[G]);ca.setAlias(q[D[G]]);b.push(ca)}r=b[0];0==b.length&&(q=p.get("noAuthentication","\u6ca1\u6709\u53ef\u7528\u7684\u6a21\u5f0f\uff0c\u8bf7\u5148\u8054\u7cfb\u7ba1\u7406\u5458\u6388\u6743\u6a21\u5f0f\u3002"),g.getMessageCurtain().showPrompt(q));f?A():M();return!0},function(q,D){b=[];f?A():M();3201007==q&&(D=p.get("SQNotDeploy","\u5f53\u524d\u73af\u5883\u672a\u90e8\u7f72\u8d85\u7ea7\u67e5\u8be2\u670d\u52a1\u6216\u670d\u52a1\u672a\u542f\u52a8\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u68c0\u67e5\u8d85\u7ea7\u67e5\u8be2\u90e8\u7f72\u60c5\u51b5\u3002"));
g.getMessageCurtain().showPrompt(D);return!0}).getUsableSchemas(x.toJsonObject())},M=function(){c.detach();c=$("<div>");var x=new e;c.append(x.getJqUi());a=x;h.getJqUi().append(c)};this.outThisStep=function(x,q){x?q(null):(x=Db.BizSourceTypeContext.getPermissionChecker())?x(t.getTypeName(),g.getMessageCurtain(),function(){z(q)},function(){q(null)}):z(q)};var z=function(x){var q=a.getErrorMessage();if(q)return g.getMessageCurtain().showPrompt(q),!1;q=a.getSchema();if("currentSystem"==a.getType())t.clear(),
t.setSchemaName(q.getName()),H(x);else{var D=q.getName(),G=a.getCloneSource();G.setSchemaName(D);h.getCtxApi().createFacade(function(ca){t.setSchemaName(D);t.setDbAddress(G.getDbAddress());t.setDbName(G.getDbName());t.setUserName(G.getUserName());t.setPassword(G.getPassword());H(x);return!0},function(ca,y){g.getMessageCurtain().showPrompt(y);return!0}).getUsableSchemas(G.toJsonObject())}},H=function(x){if(f)x(null);else if(a.isTable()){var q=h.createNextTableSteps();x(q)}else a.isCustomSql()&&(q=
h.creatNextCustomSqlStep(),x(q))};this.isLastStep=function(){return f};this.over=function(x,q){if(!m||!f||!x)return!0;x=m.getSource();a.isChecked()?(t.setAllUserSql(x.getAllUserSql()),(new Hc).updateSameSource(d,x,t,function(D){D.setSource(t);D.mergeSource(d.getSources());g.refreshDesigntimeDataObject(D,t)},m)):(t.isTheSame(x)||(q=m.getName(),x.isUserSql(q)&&(q=x.getUserSql(q),t.addUserSql(q)),m.setSource(t),q=d.getSources(),m.mergeSource(q),d.funClearUserSqlsAndStoredProcedures(x)),g.refreshDesigntimeDataObject(m,
t))};this.createNextTableSteps=function(){var x=new zb;x.setCtxApi(h.getCtxApi());x.setSource(t);var q=new zc;q.setCtxApi(h.getCtxApi());q.setSource(t);return[x,q]};this.creatNextCustomSqlStep=function(){var x=new lc;x.setSqlType(ja.SQLTYPE_SQL);x.setCtxApi(h.getCtxApi());x.setSource(t);x.setIsShowTips(!0);return x}};Db.SuperQuerySchemaSelector=B;Db.ModifyDirectConnPanel=J;Db.ModifySqlConnPanel=function(){var e,h,g,a,c,k,d,f,b,r,m=[],t,A=0,E,M,z;this.setOffset=function(y){A=y};this.setTitle=function(y){b&&
b.setText(y)};this.setCtxApi=function(y){z=y};this.setMessageCurtain=function(y){M=y};this.setSchemas=function(y){m=y};this.setSelectedSchema=function(y){t=y};this.setSource=function(y){r=y};this.getType=function(){return"otherSystem"};this.getSchema=function(){return t};this.getCloneSource=function(){ca();return E};this.isChecked=function(){return f.isChecked()};this.getErrorMessage=function(){return $.trim(h.getText())?$.trim(g.getText())?t?null:p.get("selectOneSchema","\u8bf7\u9009\u62e9\u4e00\u4e2a\u6a21\u5f0f\u3002"):
p.get("dbNameNotNull","\u6570\u636e\u5e93\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\u3002"):p.get("dbAddress","\u670d\u52a1\u5668\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a\u3002")};this.getJqUi=function(){if(!e){e=$("<div>");var y=H();e.append(y)}return e};var H=function(){var y=$("<div>");y.addClass("dm-source-db-table-connection");var P=A;b=new ba;b.setText(p.get("superQuery","\u8d85\u7ea7\u67e5\u8be2"));var aa=b.getJqUi();n.layoutCtrl(aa,0,P,200,23);aa.css("font-size","14px");y.append(aa);P+=36;aa=(new ba(p.get("IPAddress",
"\u670d\u52a1\u5668"))).getJqUi();n.layoutCtrl(aa,20,P,70,23);y.append(aa);h=new Ra;h.setText(r.getDbAddress());h.setTabindex(1);aa=h.getJqUi();aa.on("input",function(jb){x()});n.layoutCtrl(aa,100,P,200,23);y.append(aa);P+=36;aa=(new ba(p.get("database","\u6570\u636e\u5e93"))).getJqUi();n.layoutCtrl(aa,20,P,70,23);y.append(aa);g=new Ra;g.setText("cosmic_db");null!=r.getDbName()&&g.setText(r.getDbName());g.setTabindex(2);aa=g.getJqUi();aa.on("input",function(jb){x()});n.layoutCtrl(aa,100,P,200,23);
y.append(aa);P+=36;aa=(new ba(p.get("loginInfo","\u670d\u52a1\u5668\u767b\u5f55\u4fe1\u606f\uff1a"))).getJqUi();n.layoutCtrl(aa,20,P,200,23);y.append(aa);P+=36;aa=(new ba(p.get("userName","\u7528\u6237\u540d"))).getJqUi();n.layoutCtrl(aa,20,P,70,23);y.append(aa);a=new Ra;a.setText(r.getUserName());a.setTabindex(3);aa=a.getJqUi();aa.on("input",function(jb){x()});n.layoutCtrl(aa,100,P,200,23);y.append(aa);P+=36;aa=(new ba(p.get("password","\u5bc6\u7801"))).getJqUi();n.layoutCtrl(aa,20,P,70,23);y.append(aa);
c=new Sb;c.setPassword(r.getPassword());c.setTabindex(4);aa=c.getJqUi();aa.on("input",function(jb){x()});n.layoutCtrl(aa,100,P,200,23);y.append(aa);P+=36;k=$("<div>");k.text(p.get("connect","\u8fde\u63a5"));k.addClass("dm-source-db-table-connection-btn");k.css("line-height","23px");n.layoutCtrl(k,20,P,50,23);y.append(k);P+=36;aa=(new ba(p.get("schemas","\u6a21\u5f0f"))).getJqUi();n.layoutCtrl(aa,20,P,60,23);y.append(aa);d=new B;d.setSchemas(m);d.setSelectedSchema(t);d.setFunSelectCallBack(function(jb){t=
jb});aa=d.getJqUi();n.layoutCtrl(aa,100,P,120,23);y.append(aa);P+=36;f=new Ja;f.setText(p.get("actOnTheSameDatabase","\u540c\u65f6\u4fee\u6539\u5f53\u524d\u4e3b\u9898\u4e2d\u5176\u4ed6\u540c\u6e90\u6570\u636e\u8868"));f.setChecked(!1);aa=f.getJqUi();n.layoutCtrl(aa,20,P,250,23);aa.css("z-index",1);y.append(aa);x();return y},x=function(){var y=$.trim(h.getText())&&$.trim(g.getText())&&$.trim(a.getText())&&$.trim(c.getPassword());q(y)},q=function(y){k.off("mousedown",D);k.removeClass("dm-source-db-table-connection-btn-enable");
y&&(k.on("mousedown",D),k.addClass("dm-source-db-table-connection-btn-enable"))},D=function(){ca();E.setSchemaName(null);if(0<E.getDbAddress().indexOf(" "))return M.showPrompt(p.get("IPAddressError","\u670d\u52a1\u5668\u5730\u5740\u4e0d\u6b63\u786e\u3002")),!1;q(!1);k.text(p.get("connecting","\u8fde\u63a5\u4e2d..."));var y=(new Date).getTime();z.createFacade(function(P){for(var aa=[],jb=Object.keys(P),Qb=0;Qb<jb.length;Qb++){var za=new bb;za.setName(jb[Qb]);za.setAlias(P[jb[Qb]]);aa.push(za)}d.setSchemas(aa);
d.setSelectedSchema(aa[0]);M.showSuccess(p.get("connectionSuccessful","\u8fde\u63a5\u6210\u529f\u3002"));G(y);return!0},function(P,aa){G(y);M.showPrompt(aa);return!0}).getUsableSchemas(E.toJsonObject())},G=function(y){var P=(new Date).getTime();setTimeout(function(){k.text(p.get("connect","\u8fde\u63a5"));q(!0)},1E3>P-y?1E3:0)},ca=function(){E=r.clone();E.setDbAddress($.trim(h.getText()));E.setDbName($.trim(g.getText()));E.setUserName($.trim(a.getText()));E.setPassword($.trim(c.getPassword()))}};
var n,V,Ga,ha,ib,p,ic,sc,hb,hd,ba,Ra,Sb,Ub,Gb,tb,Y,Ja,W,X,ia,ka,Aa,sa,ya,Qa,Ia,lb,ob,$a,Ab,wb,yb,ac=Db.Box,kb=Db.UnionEntity,Jb=Db.Property,ja=Db.DBSource,gb=Db.FileSource,vb=Db.ExcelSource,rb=Db.TextSource,Zb=Db.XMLSource,bc=Db.OpenAPISource,fc=Db.SystemVarType,Tc=Db.UserSqlObj,Sa=Db.ParameterModel,Fb=Db.StoredProcedureParameterModel,Ua=Db.StoredProcedureModel,Ta=Db.AbstractSource,ra=Db.EntityErrorInfo,bb=Db.SchemaInfo,Oa=Db.Integration,Pa=Db.FolderNode,ua=Db.LeafNode,nb=Db.DesigntimeDataObject,
pb=Db.PreviewDataModel,Bb=Db.Icons,Yb=Db.FormatUtil,dc=Db.VariateHelperFactory,Pc=Db.OpenAPIAuthFactory,cd=Db.AuthModelFactory,Wc,Vc=Db.CheckFieldNumUtil;(function(){var e=com.kingdee.bos.qing.common;n=e.DomUtil;V=e.Base32Util;Ga=e.Base64Util;ha=e.Util;ib=e.TextMeasurer;e=com.kingdee.bos.qing.framework.common;p=e.MultilanguageManager.createPackageAccessor(Db);Wc=e.OfficialArticleUtil;e=com.kingdee.bos.qing.ui.component;ic=e.WizardDialog;sc=e.List;hb=e.RadioButton;hd=e.RadioButtonGroup;ba=e.Label;
Ra=e.TextField;Sb=e.PasswordField;Ub=e.TextArea;Gb=e.WorkButton;tb=e.ComboBox;Y=e.SearchBox;Ja=e.CheckBox;W=e.DynamicScroller;X=e.SplitPane;ia=e.AbstractModalDialog;ka=e.DateSelector;Aa=e.DateTimeSelector;sa=e.HelpIcon;ya=e.Spinner;Qa=e.SwitchButton;ob=e.MessageDialog;$a=e.DropdownSelector;e=com.kingdee.bos.qing.common.ui;Ab=e.TableUtil;wb=e.CommonIconUtil;yb=e.RadioButtonGroupWithTabbedPane;e=com.kingdee.bos.qing;lb=e.Seer})();var dd=new function(){var e;this.dataType2IconName=function(h){e||(e=
{},e[Jb.DT_BOOLEAN]="boolean",e[Jb.DT_INT]="int",e[Jb.DT_NUMBER]="number",e[Jb.DT_DATE]="date",e[Jb.DT_DATETIME]="datetime",e[Jb.DT_STRING]="string");return e[h]};this.getTreePropIconName=function(){return"elastic-dm"};this.entity2IconName=function(h){return h.isUnion()?h.getUnionType()==kb.BIZ_UNION?h.getParentEntity()?"entry-biz-union":"head-biz-union":"union":h.getERPCloudEntityType()?h.isSubNodeAtView()?h.getERPCloudEntityType().toLowerCase()+"-sub":h.getERPCloudEntityType().toLowerCase():h.isSubNodeAtView()?
"entity-sub":h.getSource().getEntityIconName(h.getName())}};Db.IconUtil=dd;Db.BizSourceTypeContext=new function(){var e,h,g,a,c;this.setTitle=function(k){e=k};this.getTitle=function(){return e};this.setSourceTypes=function(k){h=k};this.getSourceTypes=function(){return h};this.isBizSourceType=function(k){for(var d=0;d<h.length;d++)if(k==h[d].getName())return!0;return!1};this.setPermissionChecker=function(k){a=k};this.getPermissionChecker=function(){return a};this.setStepProvider=function(k){g=k};this.getStepProvider=
function(){return g};this.setMutexChecker=function(k){c=k};this.getMutexChecker=function(){return c};this.addSourceModifyingEditor=function(k,d){Z[k]=d};this.addSourceFilterUIRender=function(k,d){ta[k]=d}};var rd={};Ha.getIconName=function(e){return rd[e]};var la={};Ha.createBizMetaSource=function(e){return(e=la[e])?new e:null};var Z={};Ha.createBizMetaSourceEditor=function(e){return new Z[e]};var ta={};Ha.createFilterUIRender=function(e){return(e=ta[e])?new e:null};Ha.DB_SOURCES=[new Ha(ja.TYPE_SQLSERVER,
"SQL Server","source_sqlserver"),new Ha(ja.TYPE_ORACLE,"ORACLE","source_oracle"),new Ha(ja.TYPE_MYSQL,"MySQL","source_mysql"),new Ha(ja.TYPE_POSTGRESQL,"Postgre SQL","source_pg"),new Ha(ja.TYPE_DB2,"DB2","source_db2"),new Ha(ja.TYPE_ACCESS,"Access","source_access"),new Ha(ja.TYPE_SQLITE,"SQLite","source_sqlite"),new Ha(ja.TYPE_HIVE,"Apache Hive","source_hive"),new Ha(ja.TYPE_HANA,"HANA","source_hana"),new Ha(ja.TYPE_ODPS,"ODPS","source_odps"),new Ha(ja.TYPE_REDSHIFT,"Amazon Redshift","source_redshift"),
new Ha(ja.TYPE_SYBASE,"SYBASE","source_sybase"),new Ha(ja.TYPE_TIDB,"TiDB","source_tidb"),new Ha(ja.TYPE_DM,"DM","source_dm"),new Ha(ja.TYPE_GREENPLUM,"Greenplum","source_greenplum"),new Ha(ja.TYPE_GAUSSDB,"GaussDB","source_gaussdb"),new Ha(ja.TYPE_APACHEDRILL,"Apache Drill","source_apachedrill"),new Ha(ja.TYPE_SPARKSQL,"Spark SQL","source_sparksql"),new Ha(ja.TYPE_SYBASEIQ,"Sybase IQ","source_sybaseiq"),new Ha(ja.TYPE_IMPALA,"Apache Impala","source_impala"),new Ha(ja.TYPE_KYLIN,"Apache Kylin","source_kylin"),
new Ha(ja.TYPE_DORIS,"Apache Doris","source_doris"),new Ha(ja.TYPE_KINGBASE,"KingBase","source_kingbase"),new Ha(ja.TYPE_TDSQL,"TDSQL","source_tdsql"),new Ha(ja.TYPE_GBASE,"GBase","source_gbase"),new Ha(ja.TYPE_VASTBASE,"Vastbase","source_vastbase"),new Ha(ja.TYPE_YASHANDB,"YashanDB","source_yashandb")];Ha.FILE_SOURCES=[new Ha(gb.TYPE_EXCEL,"Excel","source_excel"),new Ha(gb.TYPE_CSV,"CSV","source_csv"),new Ha(gb.TYPE_TXT,"TXT","source_txt"),new Ha(gb.TYPE_XML,"XML","source_xml")];Ha.OPENAPI_SOURCES=
[new Ha(bc.TYPE_OPENAPI,"OpenAPI","source_openAPI")];zb.PREVIEW_LIMITED_COLS=50;v.CHANGE_SOURCE_TYPE="changeSource";v.CHANGE_SAME_SOURCE_TYPE="changeSameSource";v.CREATE_NEW_SOURCE_TYPE="createNewSource";Db.MacroVariateSelectorRegister=new function(){var e;this.registerConstructor=function(h){e=h};this.createSelector=function(){return new e};this.isRegisterComplete=function(){return void 0!=e}};Za.UNSUPPORTED_TYPE_SQL="customSQLUnsupported";Za.UNSUPPORTED_TYPE_KSQL="customKSQLUnsupported";Za.UNSUPPORTED_TYPE_STOREPROCEDURE=
"spUnsupported"})();(function(){function Ha(Y,Ja,W,X,ia,ka,Aa){this.getEntityLocation=function(){return ia};this.getUserObject=function(){return X};this.getName=function(){return Ja};this.getWidth=function(){return W};this.getBodyCellPainter=function(){return ka};this.getHeadCellPainter=function(){return Aa};this.getColIndex=function(){return Y}}function Kb(){sc.call(this);var Y=this,Ja=this.protectedMethod,W,X,ia,ka,Aa,sa=[],ya,Qa=new Ob,Ia,lb,ob=!1,$a=!1,Ab=0,wb;this.setIndex=function(Sa){lb=Sa};this.setRefreshMergedTable=
function(Sa){Ia=Sa};this.setIsChangeSql=function(){$a=!0};this.getSubTitle=function(){return eb.get("setFieldRelation","\u5b57\u6bb5\u5339\u914d")};this.protectedCreateUi=function(){var Sa=$("<div>");ia=$("<div>");Sa.append(ia);return Sa};this.setSelectEntity=function(Sa){W=Sa};this.isLastStep=function(){return!0};this.over=function(Sa){if(W){var Fb=null;if(W instanceof Cc){var Ua=W.getChildren();Ua&&0<Ua.length&&(Fb=Ua[0])}else Fb=W;Fb&&ac(Fb)}Sa&&(void 0!==Ia?Y.refreshMergedTable():Y.getCtxApi().finish(Aa))};
this.refreshMergedTable=function(){ob=!0;if(null!=lb){var Sa=Aa.getChildren(),Fb=Sa.pop();Sa.splice(lb,0,Fb);Fb={};for(var Ua in Sa){var Ta=Sa[Ua].getProperties(),ra;for(ra in Ta){var bb=Ta[ra].getRelatedBaseProp(),Oa=Fb[bb];Oa||(Oa=[],Fb[bb]=Oa);Oa.push(Ta[ra])}}Sa=Aa.getProperties();for(Ua in Sa){var Pa=Sa[Ua];if(Ta=Fb[Pa.getName()]){bb=!1;for(ra in Ta)if(Ta[ra].getName()==Pa.getName()){bb=!0;break}bb&&(Pa=Ta[0].cloneMe(),Pa.setRelatedBaseProp(""),void 0===Pa.getFormatString()&&Ec.confirmDefaultFormatString(Pa),
Sa[Ua]=Pa,Ta.forEach(function(ua){ua&&ua.setRelatedBaseProp(Pa.getName())}))}}}Tc(function(ua){var nb={};Aa.collectSources(nb);var pb=new Za;pb.fromJsonObject(ua,nb);ua=fc(pb);ua.compareAndSync();Ia(Aa,ua,lb)})};this.outThisStep=function(Sa,Fb){Sa?Fb(null):ka&&yb(function(Ua){if(Ua){for(Ua=0;Ua<sa.length;Ua++){var Ta=sa[Ua];Y.getSource().addStoredProcedure(Ta)}ya&&Y.getSource().addUserSql(ya);Aa=W instanceof Cc?W:Qa.convertEntityToUnion(W);X.setUnionUnit(!0);Jb();ja();Aa.getChildren().push(X);Qa.setUnionEntityProperties(Aa,
ka.getPropertyMapModels());Ua=Aa.getChildren();for(Ta=0;Ta<Ua.length;Ta++){var ra=Ua[Ta];ra.setProperties(gb(ra,Ta))}Fb(null);$a&&Y.over(!0)}})};var yb=function(Sa){kb()?(Ja.getMessageCurtain().showPrompt(eb.get("atLeastSelectAField","\u81f3\u5c11\u9009\u4e2d\u4e00\u4e2a\u5b57\u6bb5\u3002")),Sa(!1)):$a?Sa(!0):tb.checkFieldNum(Ab,Ja.getMessageCurtain(),Sa)};this.setStoredProcedureModels=function(Sa){sa=Sa};this.setUserSqlModel=function(Sa){ya=Sa};var ac=function(Sa){var Fb=Sa.getProperties();if((Sa=
Sa.getColumnToRowProperties())&&0<Sa.length){var Ua={};Fb.forEach(function(Ta){var ra=Ta.getRelatedBaseProp()?Ta.getRelatedBaseProp():Ta.getName();Ua[ra]=Ta});vb(Ua,Fb,Sa)}},kb=function(){return ka.getPropertyMapModels().every(function(Sa){return!Sa.isSelected()})},Jb=function(){var Sa={};Aa.getChildren().forEach(function(Fb){Sa[Fb.getName()]=Fb});Qa.resetIndexNameIfExist(X,Sa)},ja=function(){var Sa={};Aa.getChildren().forEach(function(Fb){Sa[Fb.getAlias()]=Fb});Qa.resetIndexAliasIfExist(X,Sa)},gb=
function(Sa,Fb){for(var Ua=Aa.getProperties(),Ta=ka.getPropertyMapModels(),ra=[],bb=0;bb<Ta.length;bb++){var Oa=Ta[bb];Oa.isSelected()||ra.push(Oa)}var Pa={};for(Ta=0;Ta<ra.length;Ta++)bb=ra[Ta].getPropCell(Fb),(bb=null==bb?null:bb.getProperty())&&(Pa[bb.getName()]=bb);var ua={},nb=[];Sa.getProperties().forEach(function(pb){if(null==Pa[pb.getName()]){var Bb=pb.getRelatedBaseProp()?pb.getRelatedBaseProp():pb.getName();ua[Bb]=pb}});Ua.forEach(function(pb){var Bb=ua[pb.getName()];Bb&&(Bb.setRelatedBaseProp(pb.getName()),
nb.push(Bb))});(Sa=Sa.getColumnToRowProperties())&&0<Sa.length&&vb(ua,nb,Sa);return nb},vb=function(Sa,Fb,Ua){for(var Ta in Ua){var ra=Ua[Ta];if(ra){var bb=void 0,Oa=Fb,Pa=ra,ua=[],nb=Pa.getFieldNameProperty();Pa=Pa.getFieldValueProperties();ua.push(nb);ua=ua.concat(Pa);for(bb in ua){Pa=ua[bb];nb=Pa.getName();Pa.setRelatedBaseProp(nb);for(var pb in Oa)if(Oa[pb].getName()==nb){Oa.splice(pb,1);break}}rb(Sa,Fb,ra)}}},rb=function(Sa,Fb,Ua){var Ta={};Fb.forEach(function(Pa){var ua=Pa.getRelatedBaseProp()?
Pa.getRelatedBaseProp():Pa.getName();Ta[ua]=Pa});Ua=Ua.getUsedColumnToRowPropertyNames();for(var ra in Ua){var bb=Ua[ra],Oa=Sa[bb];Oa&&((bb=Ta[bb])&&bb.setRelatedBaseProp(""),bb||(Oa.setRelatedBaseProp(""),Fb.push(Oa)))}},Zb=function(Sa){ka=new cc;ka.setEntityCompareModel(Sa);ka.setFieldSelectChangeListener(function(Fb){bc(Fb)});ia.detach();ia=$("<div>");ia.addClass("dm-entity-fieldtable");wb=$("<div>");wb.addClass("dm-entity-field-match-label-title-field-num");wb.css({left:"10px",top:"-10px"});ia.append(wb);
ia.append(ka.getJqUi());!$a&&Y.getJqUi().append(ia);ka.loadData(W,X);Sa=ka.getSelectedFieldNum();bc(Sa);$a&&Y.outThisStep(!1,function(){})},bc=function(Sa){Ab=Sa;Sa=eb.get("selectedFieldNum","\u5df2\u9009\u62e9#1\u4e2a\u5b57\u6bb5");Sa=Sa.replace("#1",Ab);wb.text(Sa)},fc=function(Sa){var Fb=1==ob?Aa:W;return Fb instanceof Cc?new qb(Fb,Sa.getEntityMap()):new Ea(Fb,Sa.getFisrtEntity())},Tc=function(Sa){Sa=Y.getCtxApi().createFacade(Sa);Sa.setBlockingJqUi(Y.getJqUi());Sa.setShowBlocking(!0);var Fb=1==
ob?Aa:W;if(Fb instanceof kd)Sa.getDesigntimeDataObject(Fb.getSource().toJsonObject(),Fb.getAssociateName());else{var Ua=Sa.getUnionDesigntimeDataObject,Ta=[Fb.toJsonObject()],ra={};Fb.collectSources(ra);Fb=[];for(var bb in ra){var Oa=ra[bb].toJsonObject();Fb.push(Oa)}Ua.call(Sa,Ta,Fb)}};this.intoThisStep=function(Sa,Fb){X=Sa.getNewMergedEntity().cloneMe(null);Tc(function(Ua){var Ta={};W.collectSources(Ta);var ra=new Za;ra.fromJsonObject(Ua,Ta);Ua=fc(ra);Ua.compareAndSync();Zb(Ua)})}}function jc(Y,
Ja){var W,X=Y instanceof Cc,ia,ka,Aa,sa,ya,Qa=[],Ia,lb={},ob,$a=new Ob;this.setDesigntimeObjDataMap=function(ja){lb=ja};this.setFunRowSelectChangeCallBack=function(ja){ob=ja};this.setFunOpenRelationDialog=function(ja){ya=ja};this.setGlobal=function(ja){Ia=ja};this.setBox=function(ja){ia=ja};this.getRootMergeModel=function(){return ka};this.getBizEntityMergeCtx=function(){return Aa};this.setEntityRelations=function(ja){Qa=ja};this.getJqUi=function(){if(!W){W=$("<div>");W.addClass("dm-biz-entity-merge-table-container");
Aa=new ub;Aa.initForNewMerge(ia,Y,Ja,Qa,lb);var ja=new I(2,0);ja.setRowNum(0);ja.initCellNode();ja.getEntityCellNode(0).setEntity(Y);var gb=Aa.getArrSourceEntity();if(1!=gb.length)for(var vb=1;vb<gb.length;vb++){var rb=gb[vb],Zb=rb.getParentEntity();Zb=ja.deepFindRowByEntity(0,Zb);if(null!=Zb){var bc=new I(2,Zb.getRowLevel()+1);bc.setEntityMergeChangeListener(wb);bc.setParentRowModel(Zb);bc.setRowNum(vb);bc.initCellNode();bc.getEntityCellNode(0).setEntity(rb);Zb.addChildrenRowModel(bc)}}gb=ja.getColSize()-
1;for(vb=0;vb<Ja.length;vb++){rb=Ja[vb];Zb=0;for(bc=rb;null!=bc.getParentEntity();)Zb+=1,bc=bc.getParentEntity();bc=Zb;if(0==bc)ja.getEntityCellNode(gb).setEntity(rb);else{Zb=ja.deepFindRowByEntity(gb,rb.getParentEntity());var fc=Zb.findSameAliasRowModel(rb,!1);fc?fc.getEntityCellNode(gb).setEntity(rb):(bc=new I(gb+1,bc),bc.setEntityMergeChangeListener(wb),bc.initCellNode(),bc.getEntityCellNode(gb).setEntity(rb),Zb.addChildrenRowModel(bc),bc.setParentRowModel(Zb))}}ja.recalcRowNum(new xc(0));ka=ja;
sa=new Cb;sa.setBizEntityMergeCtx(Aa);sa.setEntityMergeModel(ka);sa.setPropMapDataRowCreator(ac);sa.setHeadCellPainter(kb);sa.setTableSelectChangeHandler(Jb);sa.initMergeTable();ja=$(sa.getInnerTable().getUI());ja.addClass("dm-entity-merge-table");ja.appendTo(W)}return W};this.mergeBizEntity=function(){var ja=[];ka.deepVisitRow(function(gb){var vb=gb.getColSize();for(var rb=0;rb<vb;rb++){var Zb=gb.getEntityCellNode(rb).getEntity();if(Zb&&!(Zb instanceof Cc)){var bc=$a.createBizUnionEntityNameField();
bc.setRelatedBaseProp(Ec.CUSTOM_BIZ_ENTITY_NAME_FIELD);Zb.getProperties().splice(0,0,bc)}}rb=gb.getEntityCellNode(0).getEntity();if(Zb=gb.getEntityCellNode(1).getEntity())Zb.setUnionUnit(!0),Zb.setUnionLocation(Aa.getNewMergeEntityLocation()),vb=Zb.getName(),$a.resetIndexNameIfExist(Zb,Aa.getSourceInnerEntityNameMap()),$a.resetIndexAliasIfExist(Zb,Aa.getSourceInnerEntityAliasMap()),bc=Zb.getName(),bc!=vb&&Aa.replaceTargetEntityRelationPropMapKey(vb,bc);rb?(vb=X?rb:$a.convertEntityToUnion(rb),!X&&
rb.setUnionLocation(0),Zb&&vb.getChildren().push(Zb)):(vb=$a.convertEntityToUnion(Zb),$a.resetIndexNameIfExist(vb,Aa.getBoxEntityNameMap()),$a.resetIndexAliasIfExist(vb,Aa.getBoxEntityAliasMap()));$a.setUnionEntityProperties(vb,gb.getPropMapModels());$a.mergeUnionTreeProp4NewEntityMerge(vb,gb);rb=vb;a:if(0!=gb.getChildrenRows().length){bc=gb.getEntityCellNode(0).getEntity();Zb=gb.getEntityCellNode(1).getEntity();if(bc){if(Aa.isSourceUnionEntity()){if((bc=Aa.getSourceUnionEntityOriginalCalcRelatedProps(bc))&&
bc[0]){gb.setRelationFromProp(bc[0]);break a}}else var fc=Aa.getEntityRelationFromProp(bc.getName(),ub.SOURCE_ENTITY);fc||(fc=Aa.getEntityRelationFromProp(Zb.getName(),ub.TARGET_ENTITY))}else fc=Aa.getEntityRelationFromProp(Zb.getName(),ub.TARGET_ENTITY);fc=rb.findProperty(fc.getRelatedBaseProp());fc=$a.createSpecialCalcProp4Relation(rb,fc);rb.getProperties().push(fc);gb.setRelationFromProp(fc)}a:if(gb.getParentRowModel()){fc=gb.getEntityCellNode(0).getEntity();Zb=gb.getEntityCellNode(1).getEntity();
Zb=fc?fc:Zb;bc=fc?ub.SOURCE_ENTITY:ub.TARGET_ENTITY;if(fc&&Aa.isSourceUnionEntity()&&(fc=Aa.getSourceUnionEntityOriginalCalcRelatedProps(fc))&&fc[1]){gb.setRelationToProp(fc[1]);break a}if(fc=Aa.getEntityRelationToProp(Zb.getName(),bc))fc=rb.findProperty(fc.getRelatedBaseProp()),fc=$a.createSpecialCalcProp4Relation(rb,fc),rb.getProperties().push(fc),gb.setRelationToProp(fc)}rb=gb.getUnSelectedMapModels();fc=vb.getChildren();for(Zb=0;Zb<fc.length;Zb++){bc=fc[Zb];for(var Tc={},Sa=0;Sa<rb.length;Sa++){var Fb=
rb[Sa].getPropCell(Zb);(Fb=null==Fb?null:Fb.getProperty())&&(Tc[Fb.getName()]=Fb)}bc.setProperties($a.rebuildInnerEntityProperty(vb,bc,Tc))}vb.setUnionType(Cc.BIZ_UNION);ja.push(vb);gb.setFinalUnionEntity(vb);if(gb=gb.getParentRowModel())gb=gb.getFinalUnionEntity(),vb.setParentEntity(gb)});ia.refreshEntities(ja);Ab();ka.deepVisitRow(function(gb){var vb=gb.getParentRowModel();if(vb){var rb=vb.getInnerRelationProps()[0],Zb=gb.getInnerRelationProps()[1];vb=vb.getFinalUnionEntity();var bc=gb.getFinalUnionEntity(),
fc=ia.getRelationByEntitiesName(vb.getName(),bc.getName());if(!fc||fc.getFromProperty().getName()!=rb.getName()||fc.getToProperty().getName()!=Zb.getName()){fc=gb.getEntityCellNode(0).getEntity();gb=gb.getEntityCellNode(1).getEntity();var Tc=fc?ub.SOURCE_ENTITY:ub.TARGET_ENTITY;gb=Aa.getRelationByToEntityName((fc?fc:gb).getName(),Tc).clone();gb.setFromProperty(rb);gb.setFromEntity(vb);gb.setToProperty(Zb);gb.setToEntity(bc);ia.addRelation(gb)}}})};var Ab=function(){var ja=ia.findUnionInnerEntityRelation(Y.getName());
ja||(ja=new T,ja.setRootUnionEntityName(Y.getName()));X||ia.removeInnerRelationByEntityName(Aa.getSourceInnerEntityNameMap()).forEach(function(vb){ja.addRelation(vb)});var gb={};Ja.forEach(function(vb){gb[vb.getName()]=vb});Qa.forEach(function(vb){gb[vb.getFromEntity().getName()]&&gb[vb.getToEntity().getName()]&&ja.addRelation(vb)});0<ja.getRelations().length&&ia.replaceOrAddUnionInnerEntityRelation(ja)},wb=function(ja){ja.setPropertyMapModels(null)};this.selectRow=function(ja){sa.getInnerTable().getSelectionModel().setSelected(new KTSelectionModel.Target(ja,
0,0,1))};var yb=function(ja){if(ja==ka.getColSize()-1){var gb=new ed;gb.addEntities(Ja);var vb={};Ja.forEach(function(rb){vb[rb.getName()]=rb});Qa.forEach(function(rb){var Zb=rb.getFromEntity().getName(),bc=rb.getToEntity().getName();(vb[Zb]||vb[bc])&&gb.addRelation(rb)});ya&&ya(gb,Ja[0],Ia)}else ja=ka.getEntityCellNode(ja).getEntity(),ya&&ya(ia,ja,Ia)},ac=function(ja,gb){var vb=ja.getEntityCellNode(0).getEntity(),rb=ja.getEntityCellNode(1).getEntity();rb=new Qc(vb,rb);vb&&(vb=gb.isSourceUnionEntity()?
vb.getName():vb.getAssociateName(),rb.setEntityCompareModel(gb.getEntityCompareModel(vb)));rb.setEntityMergeCtx(gb);ja.setPropertyMapModels(rb.createPropRelationMapData())},kb=function(ja,gb,vb){var rb=ja.getCurrentRow().getUserObject(),Zb=ja.getCurrentColIdx();vb=rb.getEntityCellNode(Zb).getEntity();(rb=rb.getEntityCellNode(Zb).getEndEntityNodeInTree())&&rb.getEntity()!=vb&&(vb=$("<div>"),vb.addClass("dm-biz-entity-merge-table-root-relation-icon"),Ra.background(vb,"relation"),$(gb).append(vb),Zb=
ja.getCurrentColIdx(),vb.attr("title",eb.get("checkInnerRelation","\u67e5\u770b\u5185\u90e8\u5173\u7cfb")),vb.on("click",function(){yb(Zb)}))},Jb=function(ja){if(KTSelectionModel.CHANGE_ADD==ja){ja=sa.getInnerTable();var gb=ja.getSelectionModel().getSelected().getRowIdx();ja=ja.getRow(gb).getUserObject();ob&&ob(ja)}};this.refresh=function(){sa.getInnerTable().updateUI()};this.resize=function(){sa.getInnerTable().relayoutViews()}}function Cb(){function Y($a){KTDefaultTreeHandlerRender.call(this,$a);
var Ab=this,wb={};this.prepareBefore=function(){for(var yb=0;yb<ia.getColSize();yb++){var ac=ia.getEntityCellNode(yb).getEndEntityNodeInTree();wb[yb]=ac}};this.create=function(yb,ac,kb,Jb,ja,gb,vb){var rb=$a.getRow(ac).getUserObject();yb=17*yb.getLevel();gb=Ab.protectedMethod.createAbsoluteHtmlElement("span",yb,ja,Jb+gb-yb,ja+vb-ja);yb=null;var Zb=rb.hasChildren();if(!rb.getParentRowModel()&&!Zb)return[null,gb,null];if($a.isMultiTreeSupported()&&(yb=document.createDocumentFragment(),ac<=wb[kb].getRowIndex())){ac=
yb;Zb=Jb+2+4+2;var bc=rb.getEntityCellNode(kb);if(bc.hasNotEmptyChild()&&bc.isNotEmptyCellNode()){var fc=Zb+17*bc.getCellNodeLevel();fc=Ab.protectedMethod.createAbsoluteHtmlElement("div",fc,ja+(vb/2+6),0,vb/2-5);ac.appendChild(fc);fc.style.borderLeft="1px dotted #8A9EBF"}for(var Tc=bc.getParentCellNode(),Sa=bc;Tc;){fc=Zb+17*Tc.getCellNodeLevel();var Fb=ja;if(Tc.isNotEmptyCellNode()){var Ua=Tc.getLastNotEmptyChild();if(Sa.isNotEmptyCellNode()){var Ta=vb;Ua==Sa?bc==Sa&&(Ta=vb/2,fc=Ab.protectedMethod.createAbsoluteHtmlElement("div",
fc,Fb,0,Ta),ac.appendChild(fc),fc.style.borderLeft="1px dotted #8A9EBF"):(fc=Ab.protectedMethod.createAbsoluteHtmlElement("div",fc,Fb,0,Ta),ac.appendChild(fc),fc.style.borderLeft="1px dotted #8A9EBF")}else Ua&&Sa.getRowIndex()<Ua.getRowIndex()&&(fc=Ab.protectedMethod.createAbsoluteHtmlElement("div",fc,Fb,0,vb),ac.appendChild(fc),fc.style.borderLeft="1px dotted #8A9EBF")}Sa=Tc;Tc=Sa.getParentCellNode()}ac=yb;kb=rb.getEntityCellNode(kb);(rb=kb.getParentCellNode())&&kb.isNotEmptyCellNode()&&(Jb=Jb+2+
4+2+17*rb.getCellNodeLevel()+1,ja=Ab.protectedMethod.createAbsoluteHtmlElement("div",Jb,ja+vb/2,10,0),ac.appendChild(ja),ja.style.borderTop="1px dotted #8A9EBF")}return[null,gb,yb]}}function Ja($a){KTDefaultCellRender.call(this,$a);var Ab=this,wb;this.setHeadCellPainter=function(ja){wb=ja};this.paintCellUI=function(ja,gb){var vb=Ab.getCurrentRowIdx(),rb=Ab.getCurrentColIdx(),Zb=Ab.getCurrentRow().getUserObject(),bc=17*Zb.getRowLevel(),fc=Ab.getCellHeight();1>vb&&(wb&&wb(Ab,ja,gb),0<rb&&(bc=Ab.createIconDivHtmlElement(bc,
.2*fc/2,1,.8*fc),$(bc).css("border-left-style","solid"),$(bc).css("border-left-color","#E5E5E5"),$(bc).css("border-left-width","1px"),$(ja).append(bc)));if((bc=Zb.getEntityCellNode(rb).getEntity())&&(0==rb||1>vb)){var Tc=$("<div>");Tc.addClass("dm-biz-entity-merge-table-entity-icon");Tc.css("left","2px");var Sa=J.entity2IconName(bc);Ra.background(Tc,Sa);$(gb).append($(Tc));Tc=$("<div>");Tc.addClass("dm-biz-entity-combo-text");Tc.text(bc.getAlias());Tc.attr("title",bc.getAlias());Tc.css("margin-top",
"-8px");Tc.css("top","50%");Tc.css("left","20px");$(gb).append(Tc)}1<=vb&&0<rb&&(Tc=Zb.getEntityCellNode(rb),fc=Tc.getParentCellNode(),fc.isNotEmptyCellNode()&&(Sa=[],Sa.push(new S(null,vb,rb,Zb.getRowLevel())),fc.collectNotEmptyCellNode(Sa),1<Sa.length&&(vb=$(gb).width(),fc=Ab.getCellHeight(),vb=yc.createCtrlInCell(gb,vb,fc,zb),$(ja).data("my-ctrl",vb),vb.setSelected(Tc),vb.setItemModels(Sa),vb.setCustomPainter(function(Fb,Ua,Ta){if(Fb=Ta.getEntity()){if(X.isAppendNewEntity()){var ra=Zb.getEntityCellNode(0).getEntity();
var bb=ra?ra.getName():"";var Oa=X.getTargetEntityToRelation(Fb.getName());bb=X.getSourceEntityToRelation(bb)}else{var Pa=Zb.getFirstNotEmptyNode().getEntity();Pa!=Fb&&(bb=X.getInnerRelationByToEntityName(Pa.getName()),Oa=X.getInnerRelationByToEntityName(Fb.getName()))}bb&&Oa&&bb.getRelated()!=Oa.getRelated()?(Pa=eb.get("relationDiffErrMsg","\u5f53\u524d\u6570\u636e\u8868#1\u4e0e#2\u4e4b\u95f4\u7684\u5185\u90e8\u5173\u7cfb\u7c7b\u578b\u4e3a#3\uff0c\u4e0e\u5de6\u4fa7\u6570\u636e\u8868#4\u4e0e#5\u4e4b\u95f4\u7684\u5185\u90e8\u5173\u7cfb\u7c7b\u578b#6\u4e0d\u4e00\u81f4\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9"),
Pa=Pa.replace("#1",Fb.getAlias()),Pa=Pa.replace("#2",Fb.getParentEntity().getAlias()),Pa=Pa.replace("#3",Jb(Oa.getRelated())),Pa=Pa.replace("#4",ra.getAlias()),Pa=Pa.replace("#5",ra.getParentEntity().getAlias()),Oa=Pa=Pa.replace("#6",Jb(bb.getRelated()))):Oa=null;Oa&&!Fb.getErrorState()?(ra=Sc.createWarning(),ra.attr("title",Oa),ra.addClass("dm-biz-merge-diff-entity-error-icon"),Ua.parent().append(ra),Ta.setErrorDesc(Oa)):Ta.setErrorDesc(null);Ta=$("<div>");Ta.addClass("dm-biz-entity-merge-table-entity-icon");
Ta.css("left","0px");Oa=J.entity2IconName(Fb);Ra.background(Ta,Oa);Ua.append($(Ta));Ta=$("<div>");Ta.addClass("dm-biz-entity-combo-text");Ta.text(Fb.getAlias());Ta.attr("title",Fb.getAlias());Ua.append(Ta)}else Ua.text(""),Ta.setErrorDesc(null)}),vb.setUserObject(Zb),vb.addSelectedChangedListener(ac))));bc&&bc.getErrorState()&&yb($(gb),bc)};var yb=function(ja,gb){var vb=Sc.createWarning();vb.attr("title",Gb.getDefaultErrorDesc(gb));vb.addClass("dm-biz-merge-diff-entity-error-icon");ja.append(vb)};
this.createIconDivHtmlElement=function(ja,gb,vb,rb){var Zb=document.createElement("div");Zb.style.overflow="hidden";Zb.style.position="absolute";Zb.style.left=ja+"px";Zb.style.top=gb+"px";Zb.style.width=(0>vb?0:vb)+"px";Zb.style.height=(0>rb?0:rb)+"px";return Zb};var ac=function(ja,gb,vb){ja=ja.getUserObject();var rb=gb.getEntity(),Zb=vb.getEntity();if(null==Zb&&null!=rb)ja.makeLocalCopy(ja.getParentRowModel(),gb.getCol(),!0),gb.clearChildCellNodeDataIncludeMe(),ia.removeEmptyChildRow(),ia.recalcRowNum(new xc(0)),
lb(),vb=ja.getRowNum(),W.getSelectionModel().setSelected(new KTSelectionModel.Target(vb,0,0,1));else if(null!=Zb&&null==rb){gb=[];vb.collectEntity(gb);for(rb=0;rb<gb.length;rb++)Zb=gb[rb],Zb.getProperties().forEach(function(bc){bc.setRelatedBaseProp(null)});kb(ja,gb,vb.getCol());vb.clearChildCellNodeDataIncludeMe();ia.removeEmptyChildRow();ia.recalcRowNum(new xc(0));lb();vb=ja.getRowNum();W.getSelectionModel().setSelected(new KTSelectionModel.Target(vb,0,0,1))}else if(null!=Zb&&null!=rb){ja.makeLocalCopy(ja.getParentRowModel(),
gb.getCol(),!0);gb.clearChildCellNodeDataIncludeMe();gb=[];vb.collectEntity(gb);for(rb=0;rb<gb.length;rb++)Zb=gb[rb],Zb.getProperties().forEach(function(bc){bc.setRelatedBaseProp(null)});kb(ja,gb,vb.getCol());vb.clearChildCellNodeDataIncludeMe();ia.removeEmptyChildRow();ia.recalcRowNum(new xc(0));lb();vb=ja.getRowNum();W.getSelectionModel().setSelected(new KTSelectionModel.Target(vb,0,0,1))}},kb=function(ja,gb,vb){ja.getEntityCellNode(vb).setEntity(gb[0],!0);if(1<gb.length)for(var rb=1;rb<gb.length;rb++){var Zb=
gb[rb],bc=Zb.getParentEntity();bc=ja.deepFindRowByEntity(vb,bc);var fc=bc.findSameAliasRowModel(Zb,!1);fc?fc.getEntityCellNode(vb).setEntity(Zb,!0):(fc=new I(bc.getColSize(),bc.getRowLevel()+1),fc.initCellNode(),fc.setEntityMergeChangeListener(ja.getEntityChangeListener()),fc.getEntityCellNode(vb).setEntity(Zb,!0),bc.addChildrenRowModel(fc),fc.setParentRowModel(bc))}},Jb=function(ja){if(ja==F.R_1_1)return eb.get("oneToOne","\u4e00\u5bf9\u4e00");if(ja==F.R_1_N)return eb.get("oneToN","\u4e00\u5bf9\u591a");
if(ja==F.R_N_1)return eb.get("nToOne","\u591a\u5bf9\u4e00")}}var W,X,ia,ka,Aa,sa,ya;this.setBizEntityMergeCtx=function($a){X=$a};this.setPropMapDataRowCreator=function($a){ya=$a};this.getInnerTable=function(){return W};this.setHeadCellPainter=function($a){Aa=$a};this.setEntityMergeModel=function($a){ia=$a};this.setTableSelectChangeHandler=function($a){ka=$a};this.getTableJqUI=function(){return W.getUI()};this.selectFirstRow=function(){W.getSelectionModel().setSelected(new KTSelectionModel.Target(0,
0,0,ia.getColSize()-1))};var Qa=function($a,Ab){($a=$a.data("my-ctrl"))&&$a.showFeature&&$a.showFeature(Ab)},Ia=function($a){var Ab=-1,wb=-1,yb=null;$a.setCellAcrossListener(function(ac,kb,Jb){ac||(Jb=kb=-1);if(Ab!=kb||wb!=Jb)yb&&Qa(yb,!1),yb=ac,Ab=kb,wb=Jb,1<=Ab&&yb&&Qa(yb,!0)})};this.initMergeTable=function(){W=new KTable;W.setDraggableAdjusting(!0,1,0);var $a=W,Ab=$a.setStyle,wb=new KTStyle;wb.setVerticalAlign("middle");wb.setFontSize(Sb.getFontSize());wb.setFontUnit("px");wb.setFontName(Sb.getFontName());
wb.setColor(com.kingdee.bos.qing.common.CommonTableSkin.COLOR);Ab.call($a,wb);W.setBorder(null);W.getCellRender().setPaddingHV(8,1);Ia(W);yc.setupSingleRowSelection(W);W.getSelectionModel().addChangeListener(ka);$a=ia.getColSize();W.setMultiTreeSupported(!0,ia.getChildMaxRowNum()+1,$a);sa=new Y(W);W.setTreeHandlerRender(sa);$a=new Ja(W);$a.setOutsideVisible(!0);$a.setHeadCellPainter(Aa);W.setCellRender($a);ob()};this.refreshData=function(){lb()};var lb=function(){yc.clear(W);ob();W.updateUI()},ob=
function(){sa.prepareBefore();ia.deepVisitRow(function($a){$a.getPropMapModels()||ya&&ya($a,X);if(0==$a.getRowNum()){var Ab=$a.getColSize(),wb=W.isSyncUIWhenModelChanged();W.setSyncUIWhenModelChanged(!1);var yb=W.addRow();yb.setHeight(30);var ac=yb.setStyle,kb=new KTStyle;kb.setBackgroundColor("#fffff");kb.setBold(!1);kb.setTextAlign("left");ac.call(yb,kb);ac=yb.setBorder;kb=new KTBorderStyle;kb.setTopBorderWidth(1);kb.setTopBorderPen("solid");kb.setTopBorderColor("#E5E5E5");kb.setBottomBorderWidth(1);
kb.setBottomBorderPen("solid");kb.setBottomBorderColor("#E5E5E5");ac.call(yb,kb);W.setSyncUIWhenModelChanged(wb);yb.setUserObject($a);for(wb=0;wb<Ab;wb++){W.addColumn(wb+"").setWidth(170);ac=$a.getEntityCellNode(wb).getEntity();kb=new KTCellTreeModel($a.getRowLevel());kb.setExpanded(!0);var Jb=yb.getCell(wb);Jb.setValue(ac.getAlias());Jb.setTreeModel(kb)}}else{yb=ia.getColSize();Ab=yc.createRow(W,!1);Ab.setUserObject($a);for(wb=0;wb<yb;wb++)ac=$a.getEntityCellNode(wb).getEntity(),kb=new KTCellTreeModel($a.getRowLevel()),
kb.setExpanded(!0),Jb=Ab.getCell(wb),Jb.setValue(ac?ac.getAlias():""),Jb.setTreeModel(kb);$a=new KTBorderStyle;$a.setBottomBorderWidth(1);$a.setBottomBorderPen("solid");$a.setBottomBorderColor("#E5E5E5");Ab.setBorder($a)}})}}function oc(){sc.call(this);var Y=this,Ja,W=this.protectedMethod,X,ia,ka,Aa,sa,ya,Qa,Ia=0,lb;this.setSourceEntity=function(kb){ka=kb};this.setTargetEntityForMerge=function(kb){Aa=kb};this.setTargetEntityRelations=function(kb){sa=kb};this.protectedCreateUi=function(){return Ja=
$("<div>")};this.getSubTitle=function(){return eb.get("mergeEntityAndMatchField","\u5b9e\u4f53\u5408\u5e76\u4e0e\u5b57\u6bb5\u5339\u914d")};this.isLastStep=function(){return!0};this.over=function(kb){kb&&Y.getCtxApi().refreshFinishFlag()};var ob=function(kb){var Jb={};ka.collectSources(Jb);var ja=new Za;ja.fromJsonObject(kb,Jb);return ja};this.intoThisStep=function(kb,Jb){Jb||(ka instanceof kd?(kb=Y.getCtxApi().createFacade(function(ja){ja=ob(ja);var gb={};gb[ka.getAssociateName()]=ja;$a(gb)}),kb.setBlockingJqUi(Y.getJqUi()),
kb.setShowBlocking(!0),kb.getDesigntimeDataObject(ka.getSource().toJsonObject(),ka.getAssociateName())):(kb=Y.getCtxApi().createFacade(function(ja){for(var gb={},vb=0;vb<ja.length;vb++){var rb=ob(ja[vb]);gb[rb.getFisrtEntity().getAssociateName()]=rb}$a(gb)}),Jb=[],Jb.push(ka.getChildren()[0].getSource().toJsonObject()),kb.setBlockingJqUi(Y.getJqUi()),kb.setShowBlocking(!0),kb.getUnionDesigntimeDataObject([ka.toJsonObject()],Jb,!0)))};var $a=function(kb){X=$("<div>");var Jb=new da;Jb.setText(eb.get("mergeEntity",
"\u5b9e\u4f53\u5408\u5e76"));Jb.setEnabled(!1);Jb=Jb.getJqUi();Jb.addClass("dm-entity-merge-label-title");X.append(Jb);Qa=new jc(ka,Aa);Qa.setBox(Y.getCtxApi().getBoxModel());Qa.setGlobal(Y.getCtxApi().getGlobal());Qa.setDesigntimeObjDataMap(kb);Qa.setFunOpenRelationDialog(Y.getCtxApi().getOpenRelationDlgFun());Qa.setEntityRelations(sa);Qa.setFunRowSelectChangeCallBack(wb);X.append(Qa.getJqUi());Qa.refresh();ia=$("<div>");ia.addClass("dm-source-db-table-selection-center");kb=new da;kb.setText(eb.get("setFieldRelation",
"\u5b57\u6bb5\u5339\u914d"));kb.setEnabled(!1);kb=kb.getJqUi();kb.addClass("dm-entity-field-match-label-title");ia.append(kb);lb=$("<div>");lb.addClass("dm-entity-field-match-label-title-field-num");ia.append(lb);ya=new Xb;ya.setFieldSelectChangeListener(function(ja){Ab(ja)});kb=ya.getJqUi();kb.addClass("dm-biz-entity-fieldmatch-table-container");ia.append(kb);kb=new wc;kb.setHorizontalSplit(!0);kb.setEnabled(!1);kb.setFirstSize(360,-1,-1);kb.setSecondSize(560,-1,-1);kb.setResizeMode(wc.RESIZE_MODE_SECOND_FIXED);
kb.setFirstChild(wc.createChildWrapper(X));kb.setSecondChild(wc.createChildWrapper(ia));Ja.append(kb.getJqUi());Qa.selectRow(0)},Ab=function(kb){Ia=kb;kb=eb.get("selectedFieldNum","\u5df2\u9009\u62e9#1\u4e2a\u5b57\u6bb5");kb=kb.replace("#1",Ia);lb.text(kb)},wb=function(kb){var Jb=kb.getPropMapModels(),ja=kb.getEntityCellNode(0).getEntity(),gb=kb.getEntityCellNode(1).getEntity(),vb=new Qc(ja,gb),rb=ja?ja.getAssociateName():null;ya.setBizEntityMergeCtx(Qa.getBizEntityMergeCtx());vb.setEntityCompareModel(Qa.getBizEntityMergeCtx().getEntityCompareModel(rb));
vb.setEntityMergeCtx(Qa.getBizEntityMergeCtx());ya.setPropMappingHelper(vb);ya.setPropertyRelationRows(Jb);ya.setBox(Y.getCtxApi().getBoxModel());ya.setEntityMergeModel(kb);ya.loadData(ja,gb);kb=ya.getSelectedFieldNum();Ab(kb)},yb=function(kb){var Jb=Qa.getRootMergeModel(),ja=[];Jb.makeFlat(ja);Jb=Jb.getColSize();var gb=new Ob;ac(ja,0,Jb,gb,kb)},ac=function(kb,Jb,ja,gb,vb){if(Jb>=kb.length)vb(!0);else{for(var rb=kb[Jb],Zb=0;Zb<ja;Zb++){var bc=rb.getEntityCellNode(Zb).getErrorDesc();if(bc){W.getMessageCurtain().showPrompt(bc);
vb(!1);return}}if(bc=rb.getPropMapModels()){for(Zb in bc){var fc=bc[Zb].getUnAcceptedError();if(fc){W.getMessageCurtain().showPrompt(fc.getErrorDesc());vb(!1);return}}gb.isAllPropNotSelected(bc)?(Zb=eb.get("allPropNotSelectError",'\u6570\u636e\u8868"#1"\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b57\u6bb5'),rb=rb.getFirstNotEmptyNode().getEntity(),W.getMessageCurtain().showPrompt(Zb.replace("#1",rb.getAlias)),vb(!1)):(rb=gb.getSelectedFieldNum(bc),tb.checkFieldNum(rb,W.getMessageCurtain(),function(Tc){Tc?
ac(kb,Jb+1,ja,gb,vb):vb(!1)}))}else ac(kb,Jb+1,ja,gb,vb)}};this.outThisStep=function(kb,Jb){kb?Jb(null):Qa&&yb(function(ja){ja&&(Qa.mergeBizEntity(),Jb(null))})}}function rc(){ec.call(this);var Y=this,Ja,W;this.isLastStep=function(){return!1};this.protectedGetNextStep=function(){var ka=new oc;ka.setCtxApi(Y.getCtxApi());ka.setSourceEntity(Ja);var Aa=Y.getCheckedCloneEntities();ka.setTargetEntityForMerge(Aa);var sa=Y.getAllInnerRelations();if(X(sa))ka=eb.get("relationDiffTips1",'\u4e1a\u52a1\u5b9e\u4f53"#1"\u4e2d\uff0c \u5b58\u5728\u6570\u636e\u8868\u67092\u4e2a\u53ca\u4ee5\u4e0a\u5b57\u6bb5\u4e0e\u5176\u4ed6\u6570\u636e\u8868\u521b\u5efa\u5173\u7cfb\uff0c\u8bf7\u53d6\u6d88\u52fe\u9009\u4e0d\u6ee1\u8db3\u5408\u5e76\u6761\u4ef6\u7684\u6570\u636e\u8868\u3002').replace("#1",
W),ia(ka);else{var ya={};Aa.forEach(function(Ia){ya[Ia.getName()]=Ia});var Qa=[];sa.forEach(function(Ia){Ia=Ia.clone();var lb=ya[Ia.getFromEntity().getName()];lb&&(Ia.setFromEntity(lb),Ia.setFromProperty(lb.findProperty(Ia.getFromProperty().getName())));if(lb=ya[Ia.getToEntity().getName()])Ia.setToEntity(lb),Ia.setToProperty(lb.findProperty(Ia.getToProperty().getName()));Qa.push(Ia)});ka.setTargetEntityRelations(Qa);return ka}};this.over=function(ka){};this.setSourceEntity=function(ka){Ja=ka};this.setSelectModeDisplayName=
function(ka){W=ka};var X=function(ka){for(var Aa={},sa=!1,ya=0;ya<ka.length;ya++){var Qa=ka[ya],Ia=Qa.getFromEntity().getName(),lb=Qa.getFromProperty().getName();if(Aa[Ia]&&Aa[Ia]!=lb&&Qa.isInnerRelation()){sa=!0;break}else Aa[Ia]=lb}return sa},ia=function(ka){var Aa=com.kingdee.bos.qing.ui.component.MessageDialog,sa=Aa.createFeedbackDialog();sa.setOptionType(Aa.OPTION_OK);sa.setMsgImageType(Aa.MSG_WARNING);sa.setButtonText(Aa.OPTION_OK,eb.get("iknow","\u6211\u77e5\u9053\u4e86"));sa.setMessage(ka);
sa.setExtendPainter(function(ya,Qa){var Ia=$("<div class='sa-ctrl-feedback-dialog-text'>"),lb=$("<span>");lb.text(Qa);lb.appendTo(Ia);Qa=$("<a onclick='javascript:window.open(\"https://q.kdcloud.com/support/index.html?version=1.0&docId=Tvqwnwaig\");' href='#'>");Qa.css({cursor:"pointer",color:"#5582f3"});Qa.text(eb.get("viewDocument","\u67e5\u770b\u5e2e\u52a9\u6587\u6863"));Qa.appendTo(Ia);Ia.appendTo(ya)});sa.showDialog()}}function Kc(){var Y=[],Ja={},W=[];this.addEntityExchanger=function(X,ia){X?
(Y.push(X),Ja[X.getName()]=ia):W.push(ia)};this.getNewAddedEntities=function(){return W};this.getNewEntity=function(X){return Ja[X]};this.getAllOldEntity=function(){return Y}}function Bc(Y,Ja){var W,X,ia,ka,Aa,sa,ya,Qa,Ia,lb,ob,$a=[];this.setFunSelectChangeCallBack=function(ra){ob=ra};this.relayoutViews=function(){ia.getInnerTable().relayoutViews()};this.setGlobal=function(ra){Qa=ra};this.getRootEntityMergeRow=function(){return ya};this.setBox=function(ra,bb){W=bb;X=ra;lb=W.findUnionInnerEntityRelation(Y.getName())};
this.getBizUnionInnerEntityRelations=function(){return lb};this.setFunOpenRelationDialog=function(ra){Aa=ra};this.setDesigntimeObjDataMap=function(ra){Ia=ra};var Ab=function(ra,bb,Oa){Oa=$("<div>");Oa.addClass("dm-modify-union-entity-menu");Ra.background(Oa,"menu");$(bb).append(Oa);var Pa=ra.getCurrentColIdx();Oa.on("click",function(ua){bc(ua,Pa)})},wb=function(ra){var bb=ra.getUserObject();ra=bb.getEntity();var Oa=[];bb.collectEntity(Oa);var Pa=Ia[ra.getAssociateName()];bb=ra.getSource();Pa=Pa.cloneMe();
ra=new hd(ra,Oa,Pa,bb);ra.setSelectConfirmHandler(ja);ra.initUi();ra.showDialog()},yb=function(ra,bb){var Oa=ra.getUnionLocation();0<bb.length&&ya.deepVisitRow(function(Pa){Pa=Pa.getEntityCellNode(Oa);var ua=Pa.getEntity();ua&&0<=bb.indexOf(ua)&&(ka.removeInnerEntityUnit(ua),lb.removeRelation(ua),Pa.setEntity(null,!0))})},ac=function(ra,bb){var Oa=[],Pa;for(Pa in bb){var ua=bb[Pa];ua.getFromEntity()!=ra&&ua.getToEntity()!=ra||Oa.push(ua)}return Oa},kb=function(ra,bb,Oa){ra=ra.getUnionLocation();var Pa=
ya.getColSize(),ua=new Ob,nb;for(nb in bb){var pb=bb[nb],Bb=ac(pb,Oa);pb.setUnionLocation(ra);pb.setUnionUnit(!0);pb.getProperties().splice(0,0,ua.createBizUnionEntityNameField());ua.resetIndexNameIfExist(pb,ka.getSourceInnerEntityNameMap());ua.resetIndexAliasIfExist(pb,ka.getSourceInnerEntityAliasMap());var Yb=ya.deepFindRowByEntity(ra,pb.getParentEntity(),!0);ka.addNewInnerEntityUnit(pb,Bb);pb.setParentEntity(Yb.getEntityCellNode(ra).getEntity());Bb.forEach(function(dc){dc.getToEntity()==pb&&dc.setFromEntity(pb.getParentEntity());
lb.addRelation(dc)});(Bb=Yb.findSameAliasRowModel(pb,!0))?Bb.getEntityCellNode(ra).setEntity(pb,!0):(Bb=new I(Pa,Yb.getRowLevel()+1),Bb.setEntityMergeChangeListener(Sa),Bb.setRowNum(Yb.getChildMaxRowNum()+1),Bb.initCellNode(),Yb.addChildrenRowModel(Bb),Bb.setParentRowModel(Yb),Bb.getEntityCellNode(ra).setEntity(pb,!0))}},Jb=function(ra,bb){var Oa=ra.getUnionLocation(),Pa={};bb.forEach(function(ua){Pa[ua.getAssociateName()]=ua});ya.deepVisitRow(function(ua){var nb=ua.getEntityCellNode(Oa).getEntity();
if(nb){var pb=Pa[nb.getAssociateName()];if(pb){var Bb=ka.getEntityUnitPropAssociateNameMap(nb.getName()),Yb={},dc=[];dc.push(nb.getProperties()[0]);Yb[dc[0].getAssociateName()]=dc[0];var Pc=[];pb.getProperties().forEach(function(ta){var e=ta.getAssociateName(),h=Bb[e];h?(dc.push(h),Yb[e]=h):(dc.push(ta),Yb[e]=ta,Pc.push(ta),0<=ta.getTreeType()&&nb.getTreeRootProps().push(pb.getTreeRootProp(ta)))});ka.replaceEntityPropAssociateNameMap(nb.getName(),Yb);var cd=ua.getPropMapModels(),Wc=ua.getCurrentUnionEntity(),
Vc=Wc.indexOfEntity(nb);if(!cd){Wc=ua.getOriginalUnionEntity()?ua.getOriginalUnionEntity():ua.getCurrentUnionEntity();var dd=ka.getEntityCompareModel(Wc.getName());dd=new Dc(Wc,dd);dd.setEntityMergeCtx(ka);cd=dd.loadPropertyMapModels();ua.setPropertyMapModels(cd)}dd={};var rd=[];ua.setPropertyMapModels(rd);ua.getUnionChangeState().setPropMapChanged(!0);for(ua=0;ua<cd.length;ua++){var la=cd[ua],Z=la.getFieldPropByIndex(Vc);Z?Yb[Z.getAssociateName()]?rd.push(la):(la.resetProperty(Vc,null),la.isEmpty()||
rd.push(la),Z=la.getBaseFieldProp(),dd[Z.getAssociateName()]=la):(Z=la.getBaseFieldProp(),dd[Z.getAssociateName()]=la,rd.push(la))}for(ua=0;ua<Pc.length;ua++)cd=Pc[ua],(la=dd[cd.getAssociateName()])?la.resetProperty(Vc,cd):(la=new cb,la.init(Wc.getChildren().length),la.setProperty(Vc,cd,!0),rd.push(la));nb.setProperties(dc)}}})},ja=function(ra,bb,Oa,Pa,ua){var nb=0<bb.length||0<Oa.length;yb(ra,bb);Jb(ra,Pa);kb(ra,Oa,ua);nb&&(ya.removeEmptyChildRow(),ya.recalcRowNum(new xc(0)),ia.refreshData());ia.selectFirstRow()};
this.getBizUnionEntityMergeCtx=function(){return ka};var gb=function(ra){if(KTSelectionModel.CHANGE_ADD==ra){ra=ia.getInnerTable();var bb=ra.getSelectionModel().getSelected().getRowIdx();ra=ra.getRow(bb).getUserObject();ob&&ob(ra)}},vb=function(ra){var bb=new Gc,Oa=ya.getEntityCellNode(ra),Pa=Oa.getEntity(),ua=Oa.getEndEntityNodeInTree();ua&&ua.getEntity()!=Pa&&(Pa=eb.get("checkInnerRelation","\u67e5\u770b\u5185\u90e8\u5173\u7cfb")+"...",Pa=zc.createActionMenuItem(Pa,Zb),Pa.setIconName("relation"),
Pa.setUserObject(Oa),bb.addItemModel(Pa));Oa=eb.get("selectEntityAndField","\u9009\u62e9\u6570\u636e\u8868\u53ca\u5b57\u6bb5")+"...";Pa=zc.createActionMenuItem(Oa,wb);Pa.setIconName("btn_edit");Oa=ya.getEntityCellNode(ra);Pa.setUserObject(Oa);bb.addItemModel(Pa);0<ra&&(Oa=eb.get("deleteEntity","\u5220\u9664"),Pa=zc.createActionMenuItem(Oa,rb),Pa.setIconName("delete"),Oa=ya.getEntityCellNode(ra),Pa.setUserObject(Oa),bb.addItemModel(Pa));return bb},rb=function(ra){var bb=ra.getUserObject().getEntity().getUnionLocation();
ya.deepVisitRow(function(Oa){var Pa=Oa.getEntityCellNode(bb),ua=Pa.getEntity();ua&&(Pa.setEntity(null,!0),lb.removeRelation(ua));Oa.removeEntityCell(bb)});ya.removeEmptyChildRow();ia.refreshData();ia.selectFirstRow()},Zb=function(ra){ra=ra.getUserObject();var bb=ra.getEntity(),Oa=[];ra.collectEntity(Oa);var Pa=new ed;Pa.addEntities(Oa);lb.getRelations().forEach(function(ua){Pa.addRelation(ua)});Aa&&Aa(Pa,bb,Qa)},bc=function(ra,bb){var Oa=$(ra.currentTarget);if((ra=Oa.data("menu"))&&ra.isShowing())Oa.data("menu",
null),ra.hide();else{ra=new zc;ra.setModel(vb(bb));ra.setIconSetter(function(ua,nb){Ra.background(ua,nb)});ra.setHideListener(function(){Oa.data("menu",null)});Oa.data("menu",ra);bb=Oa.outerHeight();var Pa=[0,bb];Pa=oa.upwardCoordinate(Oa[0],Pa,Ja[0]);ra.show(Ja,Pa[0],Pa[1],Oa,!0,[0,-bb])}},fc=function(ra,bb){var Oa=ra.getCurrentUnionEntity(),Pa=Oa.indexOfEntity(bb),ua=ra.getPropMapModels();ua||(ua=ka.getEntityCompareModel(Oa.getName()),ua=new Dc(Oa,ua),ua.setEntityMergeCtx(ka),ua=ua.loadPropertyMapModels());
var nb=[],pb=[];ua.forEach(function(Bb){Bb.deleteProperty(Pa);Bb.isEmpty()||(nb.push(Bb),pb.push(Bb.getBaseFieldProp()))});ra.setPropertyMapModels(nb);Oa.removeChild(bb);Oa.setProperties(pb)},Tc=function(ra,bb){var Oa=ra.getCurrentUnionEntity();if(Oa){var Pa=ka.getEntityCompareModel(Oa.getName()),ua=new Dc(Oa,Pa);ua.setEntityMergeCtx(ka);Pa=ra.getPropMapModels();Pa||(Pa=ua.loadPropertyMapModels(),ra.setPropertyMapModels(Pa));ra=Fb(Oa,bb);for(var nb=ka.getEntityUnitPropAssociateNameMap(bb.getName()),
pb={},Bb=0;Bb<Pa.length;Bb++){var Yb=Pa[Bb];Yb.spliceNewLocation(ra);var dc=Yb.getBaseFieldProp().getAssociateName();if(dc=nb[dc])Yb.resetProperty(ra,dc),pb[dc.getName()]=dc,ua.setPropMapRowStatus(Yb)}Oa=Oa.getChildren().length;bb=bb.getProperties();for(Bb=0;Bb<bb.length;Bb++)ua=bb[Bb],pb[ua.getName()]||(Yb=new cb,Yb.init(Oa),Yb.setProperty(ra,ua,!0),Pa.push(Yb))}else{Pa=new Qc(bb,null);Pa.setEntityMergeCtx(ka);Pa=Pa.createPropRelationMapData();ra.setPropertyMapModels(Pa);pb=new Cc;pb.setName(bb.getName());
pb.setAssociateName(bb.getName());pb.getChildren().push(bb);var Pc=[];Pa.forEach(function(cd){Pc.push(cd.getBaseFieldProp())});pb.setProperties(Pc);ra.setCurrentUnionEntity(pb)}},Sa=function(ra,bb,Oa,Pa){Oa&&!Pa?fc(ra,Oa):!Oa&&Pa&&Tc(ra,Pa)};this.getRemovedUnionEntity=function(){return $a};var Fb=function(ra,bb){for(var Oa=ra.getChildren(),Pa=[],ua=-1,nb=0;nb<Oa.length;nb++)if(Oa[nb].getUnionLocation()<bb.getUnionLocation())Pa.push(Oa[nb]);else{ua=nb;Pa.push(bb);break}if(0<=ua&&ua<Oa.length)for(nb=
ua;nb<Oa.length;nb++)Pa.push(Oa[nb]);-1==ua&&(Pa.push(bb),ua=Pa.length-1);ra.resetEntityChildren(Pa);return ua};this.getJqUi=function(){if(!sa){sa=$("<div>");sa.addClass("dm-biz-entity-merge-table-container");ka=new ub;ka.initForModifyMerge(W,Y,Ia);ya=Ta();ia=new Cb;ia.setBizEntityMergeCtx(ka);ia.setEntityMergeModel(ya);ia.setTableSelectChangeHandler(gb);ia.setHeadCellPainter(Ab);ia.initMergeTable();var ra=$(ia.getInnerTable().getUI());ra.addClass("dm-entity-merge-table");ra.appendTo(sa)}return sa};
var Ua=function(ra){(ra=ra.getOriginalUnionEntity())&&$a.push(ra)},Ta=function(){var ra=ka.getArrSourceEntity(),bb=ra[0].getChildren().length,Oa=null,Pa=new I(bb,0);Pa.setEntityMergeChangeListener(Sa);Pa.setRowNum(0);Pa.initCellNode();var ua=ra[0];Oa=ua.getChildren();for(var nb=0;nb<Oa.length;nb++)Pa.getEntityCellNode(nb).setEntity(Oa[nb]);Pa.setOriginalUnionEntity(X.getEntityByName(ua.getName()));Pa.setCurrentUnionEntity(ua);Pa.setRowRemoveListener(Ua);for(nb=1;nb<ra.length;nb++){var pb=ra[nb];Oa=
pb.getChildren();ua=Oa[0].getParentEntity();if(ua=Pa.deepFindRowByEntity(Oa[0].getUnionLocation(),ua)){var Bb=new I(bb,ua.getRowLevel()+1);Bb.setParentRowModel(ua);Bb.setRowNum(nb);Bb.setEntityMergeChangeListener(Sa);Bb.setRowRemoveListener(Ua);Bb.initCellNode();ua.addChildrenRowModel(Bb);Bb.setOriginalUnionEntity(X.getEntityByName(pb.getName()));Bb.setCurrentUnionEntity(pb);Oa.forEach(function(Yb){var dc=Yb.getUnionLocation();Bb.getEntityCellNode(dc).setEntity(Yb)});Oa=pb.getParentEntity().getName();
pb=pb.getName();if(Oa=X.getRelationByEntitiesName(Oa,pb))ua.setRelationFromProp(Oa.getFromProperty()),Bb.setRelationToProp(Oa.getToProperty())}}return Pa};this.selectRow=function(ra){ia.getInnerTable().getSelectionModel().setSelected(new KTSelectionModel.Target(ra,0,0,ya.getColSize()-1))};this.refresh=function(){ia.getInnerTable().updateUI()}}function uc(Y){tc.call(this,Y);var Ja=this.protectedMethod,W=this,X,ia,ka,Aa,sa;this.setEntityMergeModel=function(ob){ka=ob;ia=ob.getPropMapModels()};this.setBizUnionEntityMergeCtx=
function(ob){X=ob};this.setFieldSelectChangeListener=function(ob){sa=ob};this.protectedGetPropMapLoader=function(){var ob=new Dc(W.getUnionEntity(),W.getCompareModel());ob.setEntityMergeCtx(X);ob.setPropMapRelationDataRows(ia);return ob};this.protectedCreateHeadRow=function(ob,$a){ob=yc.createHeadRow(ob);for(var Ab=0;Ab<$a.length;Ab++)ob.getCell(Ab).setValue($a[Ab].getName())};var ya=function(ob){ob=(Y-100)/ob;return 230>ob?230:ob};this.protectedGetCellValue=function(ob){return ob?ob.getTreeType()==
l.TREE_TYPE_FLEX?ob.getAlias()+"("+eb.get("flexField","\u5f39\u6027\u57df")+")":ob.isEnum()?ob.getAlias()+"("+eb.get("enumField","\u679a\u4e3e\u5b57\u6bb5")+")":ob.getAlias():""};var Qa=function(ob){var $a=[];$a.push(null);ob.getProperties().forEach(function(Ab){var wb=ob.getName();wb=Ab.getName()==Ec.CUSTOM_BIZ_ENTITY_NAME_FIELD?!1:!X.isRelationProperty(wb,Ab,ub.UNION_ENTITY_UNIT);wb&&$a.push(Ab)});return $a},Ia=function(ob){ka.getUnionChangeState().setPropCheckChanged(ob);sa&&sa(W.getSelectedFieldNum())};
this.getSelectedFieldNum=function(){return Aa?Aa.getCheckCount()-1:0};this.protectedCreateColumnMetas=function(){var ob=W.getSubEntitys();if(0!=ob.length){var $a=0,Ab=[];Aa=new Wb(Ia);Ab.push(new Ha($a++,"",40,null,-1,new xb(Aa),new Eb(Aa)));Ab.push(new Ha($a++,ob[0].getAlias(),ya(ob.length),ob[0],0,new ab));for(var wb=1;wb<ob.length;wb++){var yb=new ab;yb.setItemModels(Qa(ob[wb]));yb.setCustomItemPainter(lb);yb.setPropSelectChangedListener(function(ac,kb){Ja.doFieldSelectChanged(ac,kb);ka.getUnionChangeState().setPropMapChanged(!0);
sa&&sa(W.getSelectedFieldNum())});Ab.push(new Ha($a++,ob[wb].getAlias(),ya(ob.length),ob[wb],wb,yb))}return Ab}};var lb=function(ob,$a){$a=W.protectedGetCellValue($a);ob.text($a);ob.attr("title",$a)}}function Wb(Y){var Ja=[],W,X=0;this.setFullCheckBox=function(ia){W=ia};this.cleanOnRefreshTable=function(){X=Ja.length=0};this.addSubCheckBox=function(ia){Ja.push(ia);ia.isChecked()?X++:W&&W.setChecked(!1)};this.isAllChecked=function(){return Ja.length==X};this.handleSubCheckBoxChanged=function(ia,ka){ka?
X++:X--;ia=Ja.length==X;W.setChecked(ia);Y&&Y(!ia)};this.handleFullCheckChanged=function(ia){X=ia?Ja.length:0;for(var ka in Ja){var Aa=Ja[ka],sa=Aa.getUserObject();sa.isLocked()?!ia&&X++:(Aa.setChecked(ia),sa.setSelected(ia))}Y&&Y(!ia)};this.getCheckCount=function(){return X}}function tc(Y){function Ja(Ua){La.call(this);this.paintCell=function(Ta,ra,bb,Oa){Ta=ra.getUserObject();ra=ra.getColIndex();Oa=$("<div>");Oa.text(Ta.getAlias());Oa.attr("title",Ta.getAlias());Oa.addClass("dm-multi-entity-column-head");
$(bb).append(Oa);if(Ta&&Ta.isErrorExist()){Oa=Sc.createWarning();Oa.addClass("dm-entity-list-item-notexist");var Pa=Gb.getDefaultErrorDesc(Ta);Oa.attr("title",Pa);Oa.css("cursor","pointer");Oa.attr("data-columnIndex",ra);$(bb).append(Oa)}Ua||(Oa=$("<div>"),Ra.background(Oa,"btn_delete"),Oa.attr("title",eb.get("delete","\u5220\u9664")),Oa.addClass("dm-multi-entity-column-delete"),Oa.on("click",Fb),Oa.attr("data-columnIndex",ra),$(bb).append(Oa));Ta.getSource().getUserSql&&(Oa=Ta.getSource().getUserSql(Ta.getName()),
void 0!==Oa&&null!==Oa&&(Oa=$("<div>"),Ra.background(Oa,"btn_edit"),Oa.attr("title",eb.get("editSql","\u7f16\u8f91")),Oa.addClass(Ua?"dm-multi-entity-column-delete":"dm-multi-entity-column-Edit"),Oa.on("click",{oEntity:Ta},Tc),Oa.attr("data-columnIndex",ra),$(bb).append(Oa)))}}function W(){vc.call(this);var Ua=this,Ta,ra,bb;this.setIndex=function(Oa){bb=Oa};this.setRefreshMergedTable=function(Oa){ra=Oa};this.setSelectEntity=function(Oa){Ta=Oa};this.getNextStep=function(Oa){var Pa=new Kb;Pa.setCtxApi(Ua.getCtxApi());
Pa.setSource(Ua.getSource());Pa.setUserSqlModel(Oa);Pa.setSelectEntity(Ta);Pa.setRefreshMergedTable(ra);Pa.setIndex(bb);Pa.setIsChangeSql(!0);Pa.intoThisStep(Ua)};this.isLastStep=function(){return!0}}var X=this,ia,ka,Aa,sa=[],ya,Qa=[],Ia=[],lb,ob,$a,Ab=[],wb=!0,yb,ac;this.setCreateNewMergeModifiedEntity=function(Ua){$a=Ua};this.setGlobalDependence=function(Ua){ob=Ua};this.setFieldSelectChangeListener=function(Ua){ac=Ua};this.refreshTable=function(){yc.refresh(Aa)};this.setUnionEntityCompareModel=
function(Ua){lb=Ua};this.setUnionEntity=function(Ua){ka=Ua;Ua.getUnionType();Ia=[];ka.getChildren().forEach(function(Ta){Ia.push(Ta);if(wb){var ra=new Nc;ra.setEntity(Ta);Ab.push(ra)}});wb=!1};this.getArrEntitySource=function(){return Ab};this.getUnionEntity=function(){return ka};this.getCompareModel=function(){return lb};this.getSubEntitys=function(){return Ia};this.getPropertyMapModels=function(){return sa};this.getJqUi=function(){if(!ia){ia=$("<div>");ia.addClass("dm-union-entity-prop-map-container");
Aa=yc.createTable();Aa.setSyncUIWhenModelChanged(!1);yc.bindTableListenerForCtrl(Aa);var Ua=$(Aa.getUI());Ua.addClass("dm-entity-fieldtable");Ua.appendTo(ia)}return ia};this.protectedGetPropMapLoader=function(){return new bd(ka,lb)};this.loadData=function(){yc.clear(Aa);Qa=X.protectedCreateColumnMetas();ya=new $b(Aa);ya.setColumnMetas(Qa);ya.setOutsideVisible(!0);Aa.setCellRender(ya);gb();X.protectedCreateHeadRow(Aa,Qa);sa=X.protectedGetPropMapLoader().loadPropertyMapModels();vb();X.refreshTable()};
this.checkRelation=function(){for(var Ua=0;Ua<sa.length;Ua++){var Ta=sa[Ua].getPrompt();if(Ta&&""!=Ta)return!1}return!0};this.protectedCreateHeadRow=function(Ua,Ta){yc.createHeadRow(Ua)};var kb=function(){var Ua=(Y-110)/Ia.length;return 200>Ua?200:Ua};this.protectedCreateColumnMetas=function(){if(0!=Ia.length){var Ua=0,Ta=[];yb=new Wb(ja);Ta.push(new Ha(Ua++,"",40,null,-1,new xb(yb),new Eb(yb)));for(var ra=0;ra<Ia.length;ra++){var bb=Ia[ra],Oa=new ab;Oa.setItemModels(bc(bb));Oa.setCustomItemPainter(fc);
Oa.setPropSelectChangedListener(function(Pa,ua){Zb(Pa,ua);Jb()});bb=new Ja(0==ra);Ta.push(new Ha(Ua++,Ia[ra].getAlias(),kb(),Ia[ra],ra,Oa,bb))}return Ta}};var Jb=function(){ac&&ac(X.getSelectedFieldNum())};this.getSelectedFieldNum=function(){return yb?yb.getCheckCount():0};var ja=function(Ua){Jb()},gb=function(){Aa.addColumns(Qa.length);for(var Ua=0;Ua<Qa.length;Ua++)Aa.getColumn(Ua).setWidth(Qa[Ua].getWidth())},vb=function(){for(var Ua=0;Ua<sa.length;Ua++){var Ta=yc.createRow(Aa);Ta.setUserObject(sa[Ua]);
X.setRowCellValue(sa[Ua],Ta)}};this.protectedGetCellValue=function(Ua){return Ua?Ua.getAlias():""};this.setRowCellValue=function(Ua,Ta){Ta.getCell(0).setValue(Ua.isSelected());for(var ra=1;ra<=Ua.getPropCellSize();ra++){var bb=Ua.getFieldPropByIndex(ra-1);Ta.getCell(ra).setValue(X.protectedGetCellValue(bb))}};var rb=function(Ua){var Ta=Ua.getPropCells(),ra=Ua.findFirstNotNullPropCell();if(ra){var bb=ra.getProperty(),Oa;for(Oa in Ta){var Pa=Ta[Oa];Pa.setError(null);var ua=Pa.getProperty();if(ua&&ua!=
bb)if(ua.getTreeType()!=bb.getTreeType()){var nb=bb;nb=-1!=nb.getTreeType()?nb:-1!=ua.getTreeType()?ua:void 0;switch(nb.getTreeType()){case 0:var pb=eb.get("flexFieldInConsistent",'\u6570\u636e\u8868"#1"\u4e2d\u7684"#2"\u5b57\u6bb5\u4e3a\u5f39\u6027\u57df\u5b57\u6bb5\uff0c\u5f39\u6027\u57df\u53ea\u80fd\u4e0e\u5f39\u6027\u57df\u5b57\u6bb5\u5408\u5e76\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9');break;case 1:pb=eb.get("customFieldInConsistent",'\u6570\u636e\u8868"#1"\u4e2d\u7684"#2"\u5b57\u6bb5\u4e3a\u81ea\u5b9a\u4e49\u5b57\u6bb5\uff0c\u81ea\u5b9a\u4e49\u53ea\u80fd\u4e0e\u81ea\u5b9a\u4e49\u5b57\u6bb5\u5408\u5e76\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9')}Pa=
nb==bb?ra.getIndex():Pa.getIndex();pb=pb.replace("#1",Ia[Pa].getAlias());pb=pb.replace("#2",nb.getAlias());Ua.setPrompt(Oa,new Hc(!1,pb))}else Ub.isPropEnumValueConsistent(ua,bb)?Ub.isDataTypeConvertable(ua.getOutputDataType(),bb.getOutputDataType())||(pb=v.buildDataTypeInConsistantPrompt(ua,bb),Ua.setPrompt(Oa,new Hc(!0,pb))):(pb=eb.get("enumFieldInConsistent","\u5efa\u7acb\u6620\u5c04\u7684\u679a\u4e3e\u5b57\u6bb5\uff0c\u5176\u4e2d\u6bcf\u4e2a\u5b57\u6bb5\u679a\u4e3e\u503c\u5fc5\u987b\u5b8c\u5168\u4e00\u81f4\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9"),
Ua.setPrompt(Oa,new Hc(!1,pb)))}}},Zb=function(Ua,Ta){if(Ta){Ta=Ua.getJqUi().attr("data-colIndex")-1;var ra=Ua.getSelectedModel(),bb=Ua.getUserObject();Ua=bb.getPropCell(Ta).getProperty();if(!Ua||!ra||Ua.getName()!=ra.getName()){var Oa;if(ra)a:{for(Oa=0;Oa<sa.length;Oa++){var Pa=sa[Oa];if((Pa=Pa.getFieldPropByIndex(Ta))&&Pa.getName()==ra.getName())break a}Oa=-1}else Oa=-1;-1!=Oa&&(Pa=sa[Oa],Pa.resetProperty(Ta,null),Pa.isEmpty()?sa.splice(Oa,1):rb(Pa));bb.resetProperty(Ta,ra);bb.isEmpty()&&(ra=sa.indexOf(bb),
sa.splice(ra,1));rb(bb);Ua&&(ra=new cb,bb=ka.getChildren().length,ra.init(bb),ra.setProperty(Ta,Ua,!0),sa.push(ra));yc.clearWithoutHead(Aa);vb();yc.refresh(Aa)}}},bc=function(Ua){var Ta=[];Ta.push(null);Ua.getProperties().forEach(function(ra){Ta.push(ra)});lb.getUnSelectedProperty(Ua.getName()).forEach(function(ra){Ta.push(ra)});return Ta},fc=function(Ua,Ta){Ta=Ta?Ta.getAssociateName():"";Ua.text(Ta);Ua.attr("title",Ta)},Tc=function(Ua){var Ta=Ua.data.oEntity,ra=Ta.getSource().clone(),bb=ra.getUserSql(Ta.getName());
Ua=new W;Ua.setCtxApi({createFacade:ob.createFacade,isEntityNameExist:function(){},isEntityAliasExist:function(){}});Ua.setSource(ra);Ua.setUserSqlObj(bb);Ua.setAlias(Ta.getAlias());Ua.setRefreshMergedTable(Sa);bb=[];var Oa=X.getSubEntitys();ra=null;for(var Pa=0;Pa<Oa.length;Pa++)Oa[Pa].getName()==Ta.getName()?ra=Pa:bb.push(Oa[Pa].cloneMe());Ta=[];Oa=X.getPropertyMapModels();for(Pa=0;Pa<Oa.length;Pa++){var ua=Oa[Pa].cloneMe();ua.deleteProperty(ra);rb(ua);Ta.push(ua)}Pa=Ta.filter(function(pb){return!pb.isEmpty()});
bb=$a(bb,Pa);Ua.setSelectEntity(bb);Ua.setIndex(ra);ra=new Wa;ra.setTitle(eb.get("mergeDataSourceTitle","\u5408\u5e76\u6570\u636e\u8868"));ra.setSteps([Ua]);ra.show(960,540);var nb=$(".sa-ctrl-wizard-prev");nb.css("cursor","pointer");nb.on("mouseenter",function(){nb.css("background-color","#f7f7f7")});nb.on("mouseleave",function(){nb.css("background-color","")});nb.on("click",function(){nb.parent().parent().find(".sa-ctrl-dialog-close").click()});Ua=$(nb.children()[0]);Ua.text("\u53d6\u6d88");Ua.css("color",
"#666");Ua=$(".sa-ctrl-wizard-next");$(Ua.children()[0]).text("\u786e\u5b9a")},Sa=function(Ua,Ta,ra){ra=Ua.getChildren()[ra];for(var bb=0;bb<Ab.length;bb++){var Oa=Ab[bb];if(Oa.getEntity().getName()==ra.getName()){Oa.setUserSql(ra.getSource().getUserSql(ra.getName()));break}}X.setUnionEntity(Ua);X.setUnionEntityCompareModel(Ta);X.loadData();Jb()},Fb=function(Ua){Ua=Ua.target.getAttribute("data-columnIndex")-1;for(var Ta=0;Ta<sa.length;Ta++)sa[Ta].deleteProperty(Ua),rb(sa[Ta]);sa=sa.filter(function(ra){return!ra.isEmpty()});
Ia.splice(Ua,1);yc.clear(Aa);Qa=X.protectedCreateColumnMetas();ya.setColumnMetas(Qa);gb();X.protectedCreateHeadRow(Aa,Qa);vb();yc.refresh(Aa);Jb()};this.protectedMethod={doFieldSelectChanged:Zb,getPropMapDataRows:function(){return sa}}}function La(){this.paintCell=function(Y,Ja,W,X){Y.defaultPaint(W,X)}}function Eb(Y){La.call(this);this.paintCell=function(W,X,ia,ka){W=new U;W.setChecked(Y.isAllChecked());W.addCheckedListener(Ja);X=W.getJqUi();X.addClass("dm-merge-entity-fieldtable-checkbox");X.appendTo($(ia));
Y.setFullCheckBox(W)};var Ja=function(W,X){X&&Y.handleFullCheckChanged(W.isChecked())}}function xb(Y){La.call(this);this.paintCell=function(W,X,ia,ka){W.getCurrentRowIdx()==yc.getHeadRowCount()&&Y&&Y.cleanOnRefreshTable();X=W.getCurrentRow().getUserObject();ka=W.getCell().getValue();W=new U;W.setChecked(ka);W.setEnabled(!X.isLocked());W.setUserObject(X);W.addCheckedListener(Ja);X=W.getJqUi();X.addClass("dm-merge-entity-fieldtable-checkbox");X.appendTo($(ia));Y&&Y.addSubCheckBox(W)};var Ja=function(W,
X){X&&(X=W.getUserObject(),X.setSelected(W.isChecked()),Y&&Y.handleSubCheckBoxChanged(X,W.isChecked()))}}function ab(){La.call(this);var Y,Ja,W;this.setItemModels=function(ka){Y=ka};this.setPropSelectChangedListener=function(ka){W=ka};this.setCustomItemPainter=function(ka){Ja=ka};this.paintCell=function(ka,Aa,sa,ya){var Qa=Aa.getEntityLocation();if(0==Qa)ka.defaultPaint(sa,ya);else if(Aa=ka.getCurrentRow().getUserObject(),Qa=Aa.getPropCell(Qa),Qa.isSelectable()){var Ia=new ba;Ia.setItemModel(Y);Ia.setListItemPainter(ia);
Ia.setSearchListener(X);Ia.setShowFieldNameEnable(!1);ya=ka.getCellWidth();var lb=ka.getCellHeight();ya=yc.createCtrlInCell($(sa),ya,lb,lc);ya.setUserObject(Aa);ya.getJqUi().attr("data-colIndex",ka.getCurrentColIdx());(ka=Qa.getProperty())&&ya.setSelectedModel(ka);ya.setDropdownCreator(function(ob,$a,Ab){return Ia.createJqPopup(ob,$a,Ab)});ya.addSelectionListener(W);ya.setCustomPainter(function(ob,$a){Ja&&Ja($a,ob)});if(ka=Qa.getError())Aa=$("<div>"),Aa.text("!"),Aa.addClass("dm-mergetable-field-notmatch-prompt"),
Aa.attr("title",ka.getErrorDesc()),Aa.appendTo($(sa))}else ka.defaultPaint(sa,ya)};var X=function(ka,Aa,sa,ya,Qa){Aa=Aa.trim().toLowerCase();var Ia=[],lb;Aa||Ia.push(null);for(var ob=0;ob<ka.length;ob++)(lb=ka[ob])&&(lb=-1!=lb.getAlias().toLowerCase().indexOf(Aa)?!0:!1)&&Ia.push(ka[ob]);sa.children().remove();if(0<Ia.length){for(ob=0;ob<Ia.length;ob++)Qa(Ia[ob],sa,ya);Ia.length=0}else ka=new da,ka.setText(eb.get("nothingSearched","\u627e\u4e0d\u5230\u7b26\u5408\u7684\u7ed3\u679c")),ka.setEnabled(!1),
ka.setAlign(da.ALIGN_CENTER),ka=ka.getJqUi(),ka.addClass("dm-field-popup-search-result"),ka.appendTo(sa)},ia=function(ka,Aa,sa){sa=$("<div>");sa.addClass("dm-field-popup-list-item");sa.data("model",ka);var ya=$("<span>");ya.addClass("dm-field-popup-list-item-text");Ja?Ja(ya,ka):(ka=ka?ka.getAlias():"",ya.text(ka),ya.attr("title",ka));sa.append(ya);Aa.append(sa)}}function $b(Y){KTDefaultCellRender.call(this,Y);var Ja=this,W,X=this.paintCellUI;this.setColumnMetas=function(ia){W=ia};this.getTable=function(){return Y};
this.defaultPaint=function(ia,ka){X(ia,ka);$(ia).css("cursor","default")};this.paintCellUI=function(ia,ka){var Aa=Ja.getCurrentRowIdx(),sa=Ja.getCurrentColIdx();Aa<yc.getHeadRowCount()?(X(ia,ka),1==Aa&&(Aa=W[sa],(sa=Aa.getHeadCellPainter())&&sa.paintCell(Ja,Aa,ia,ka))):(Aa=W[sa],Aa.getBodyCellPainter().paintCell(Ja,Aa,ia,ka))}}function Ib(){ec.call(this);var Y=this;this.isLastStep=function(){return!1};this.over=function(){};this.getNewMergedEntity=function(){return Y.getCheckedCloneEntities()[0]}}
function Vb(){Ga.call(this);var Y=this,Ja;this.setSelectEntity=function(W){Ja=W};this.createNextTableSteps=function(){var W=new ma;W.setCtxApi(Y.getCtxApi());W.setSource(Y.getSource());W.setSelectEntity(Ja);var X=new Ib;X.setCtxApi(Y.getCtxApi());X.setSource(Y.getSource());var ia=new Kb;ia.setCtxApi(Y.getCtxApi());ia.setSource(Y.getSource());ia.setSelectEntity(Ja);return[W,X,ia]}}function Xa(){hb.call(this);var Y=this,Ja;this.setSelectEntity=function(W){Ja=W};this.createNextTableSteps=function(){var W=
Y.getSource(),X=Y.getCloneSource();Y.getSource().isTheSame(X)||(W=X);X=new ma;X.setCtxApi(Y.getCtxApi());X.setSource(W);X.setSelectEntity(Ja);var ia=new Ib;ia.setCtxApi(Y.getCtxApi());ia.setSource(W);var ka=new Kb;ka.setCtxApi(Y.getCtxApi());ka.setSource(W);ka.setSelectEntity(Ja);return[X,ia,ka]}}function ma(){n.call(this);var Y=this,Ja=this.protectedMethod,W,X,ia;this.setSelectEntity=function(sa){W=sa};this.getSelectEntity=function(){return W};this.getSelectNode=function(){return ia};this.doCheckBox=
function(sa){sa=sa.find(".dm-source-db-table-list-item-component").data("model");sa.isEnabled()&&(sa.setChecked(!0),sa.isChecked()?(X&&X!=sa&&(Aa(X,!1),X.setChecked(!1)),X=sa,ia=X.getJqUi().data("object"),ka(ia)):(ia=null,ka()),Aa(sa,sa.isChecked()))};this.unCheckBox=function(sa){sa&&sa.data("model").setChecked(!1)};this.newTableItemComponent=function(sa){var ya=new ea,Qa=ya.getJqUi();Qa.attr("table-name-component",Ya.encode(sa.getName()));Qa.addClass("dm-source-db-table-list-item-component");Qa.off();
Qa.data("object",sa);Qa.data("model",ya);return ya};this.defaultSelectTableWhenInit=function(sa){ia=sa;ka(sa)};var ka=function(sa){var ya=[];null!=sa&&ya.push(sa);Y.setArrSelectedDataObjectNode(ya)},Aa=function(sa,ya){(sa=sa.getJqUi().find(".sa-ctrl-radiobutton-check_enabled"))&&(ya?sa.addClass("dm-source-db-table-radioitem-checked"):sa.removeClass("dm-source-db-table-radioitem-checked"))};this.outThisStep=function(sa,ya){sa?ya(null):null==ia?(Ja.getMessageCurtain().showPrompt(eb.get("selectOneTable",
"\u8bf7\u9009\u4e2d\u4e00\u4e2a\u6570\u636e\u8868\u3002")),ya(Y)):(sa=Y.getDataObject(ia.getName()),ya(sa?null:Y))};this.getNewMergedEntity=function(){return Y.getDataObject(ia.getName()).getFisrtEntity()};this.isMultiSelectable=function(){return!1}}function Lb(){ma.call(this);var Y=this,Ja=this.protectedMethod;this.outThisStep=function(W,X){if(W)X(null);else if(W=Y.getSelectNode(),null==W)Ja.getMessageCurtain().showPrompt(eb.get("selectOneTable","\u8bf7\u9009\u4e2d\u4e00\u4e2a\u6570\u636e\u8868\u3002")),
X(Y);else{var ia=Y.getDataObject(W.getName()),ka=new hc;ka.setCtxApi(Y.getCtxApi());ka.setSource(Y.getSource());ka.setSourceEntity(Y.getSelectEntity());ka.setSelectModeDisplayName(W?W.getDisplayName():null);X(ia?ka:Y)}}}function hc(){ec.call(this);var Y=this,Ja=this.protectedMethod,W,X,ia;this.setSourceEntity=function(ya){W=ya};this.setSelectModeDisplayName=function(ya){};this.getNewMergedEntity=function(){for(var ya=X.getName(),Qa=Y.getCheckedCloneEntities(),Ia=0;Ia<Qa.length;Ia++)if(ya==Qa[Ia].getName())return Qa[Ia];
return X};this.newTableItemComponent=function(ya,Qa,Ia,lb,ob){Ia=new ea;Ia.setUserObject(Qa);Qa=Ia.getJqUi();Qa.addClass("dm-source-db-table-entity-list-item-checkbox");Qa.data("model",Ia);Qa.off();0==ya&&Aa(Ia);ob.css("margin-left",25);lb.append(Qa);Qa.on("mousedown",ka)};var ka=function(ya){ya=$(ya.currentTarget).data("model");var Qa=ya.getUserObject().getAssociateName();Ja.selectTable(Qa);Aa(ya)};this.doSelectItem=function(ya){ya=ya.parent();var Qa=ya.find(".dm-source-db-table-entity-list-item-checkbox");
Qa||(ya=ya.parent(),Qa=ya.find(".dm-source-db-table-entity-list-item-checkbox"));ya=Qa.data("model");Aa(ya)};var Aa=function(ya){ia&&ia!=ya&&(sa(ia,!1),ia.setChecked(!1));ia=ya;sa(ya,!0);ya.setChecked(!0);X=ya.getUserObject()},sa=function(ya,Qa){(ya=ya.getJqUi().find(".sa-ctrl-radiobutton-check_enabled"))&&(Qa?ya.addClass("dm-source-db-table-radioitem-checked"):ya.removeClass("dm-source-db-table-radioitem-checked"))};this.protectedGetNextStep=function(){var ya=new Kb;ya.setCtxApi(Y.getCtxApi());ya.setSource(Y.getSource());
ya.setSelectEntity(W);return ya};this.isLastStep=function(){return!1};this.over=function(ya){}}function Mb(){V.call(this);var Y=this,Ja;this.setSelectEntity=function(W){Ja=W};this.createNextTableSteps=function(){var W=new ma;W.setCtxApi(Y.getCtxApi());W.setSource(Y.getSource());W.setSelectEntity(Ja);var X=new Ib;X.setCtxApi(Y.getCtxApi());X.setSource(Y.getSource());var ia=new Kb;ia.setCtxApi(Y.getCtxApi());ia.setSource(Y.getSource());ia.setSelectEntity(Ja);return[W,X,ia]};this.creatNextCustomSqlStep=
function(){var W=new vc;W.setSqlType(B.SQLTYPE_SQL);W.setCtxApi(Y.getCtxApi());W.setSource(Y.getSource());W.setSelectEntity(Ja);return W};this.creatNextCustomKSqlStep=function(){var W=new vc;W.setSqlType(B.SQLTYPE_KSQL);W.setCtxApi(Y.getCtxApi());W.setSource(Y.getSource());W.setSelectEntity(Ja);return W};this.creatNextStoredProcedureStep=function(){var W=new mb;W.setCtxApi(Y.getCtxApi());W.setSource(Y.getSource());W.setSelectEntity(Ja);return W}}function mb(){ib.call(this);var Y=this,Ja,W,X;this.setSelectEntity=
function(Aa){Ja=Aa};this.isMultiSelectable=function(){return!1};this.doCheckBox=function(Aa){Aa=Aa.find(".dm-source-db-table-list-item-component").data("model");if(Aa.isEnabled()){Aa.setChecked(!0);var sa=Aa.getJqUi().data("object");Aa.isChecked()?ia(sa):ia();Aa.isChecked()?(W&&W!=Aa&&(ka(W,!1),W.setChecked(!1)),W=Aa,X=W.getJqUi().data("object")):(W&&W==Aa&&(W=null),X=null);ka(Aa,Aa.isChecked())}};this.newTableItemComponent=function(Aa){var sa=new ea,ya=sa.getJqUi();ya.attr("table-name-component",
Ya.encode(Aa.getName()));ya.addClass("dm-source-db-table-list-item-component");ya.off();ya.data("object",Aa);ya.data("model",sa);return sa};this.defaultSelectTableWhenInit=function(Aa){X=Aa;ia(Aa)};this.getNewMergedEntity=function(){return Y.getDataObject(X.getName()).getFisrtEntity()};this.getNextStep=function(Aa){var sa=new Ib;sa.setCtxApi(Y.getCtxApi());sa.setSource(Y.getSource());var ya=new Kb;ya.setCtxApi(Y.getCtxApi());ya.setSource(Y.getSource());ya.setStoredProcedureModels(Aa);ya.setSelectEntity(Ja);
return[sa,ya]};this.isLastStep=function(){return!1};var ia=function(Aa){var sa=[];null!=Aa&&sa.push(Aa);Y.setArrSelectedDataObjectNode(sa)},ka=function(Aa,sa){(Aa=Aa.getJqUi().find(".sa-ctrl-radiobutton-check_enabled"))&&(sa?Aa.addClass("dm-source-db-table-radioitem-checked"):Aa.removeClass("dm-source-db-table-radioitem-checked"))}}function vc(){ha.call(this);var Y=this,Ja;this.setSelectEntity=function(W){Ja=W};this.isLastStep=function(){return!1};this.getNewMergedEntity=function(){return Y.getArrEntity()[0]};
this.getNextStep=function(W){var X=new Kb;X.setCtxApi(Y.getCtxApi());X.setSource(Y.getSource());X.setUserSqlModel(W);X.setSelectEntity(Ja);return X};this.over=function(W){}}function Ob(){this.createBizUnionEntityNameField=function(){var X=new Ec;X.setAppointedDataType(Ec.DT_STRING);X.setDataType(Ec.DT_STRING);X.setName(Ec.CUSTOM_BIZ_ENTITY_NAME_FIELD);X.setAssociateName(Ec.CUSTOM_BIZ_ENTITY_NAME_FIELD);X.setAlias(eb.get("customBizEntityNameField","\u5b9e\u4f53\u540d\u79f0"));return X};this.isAllPropNotSelected=
function(X){for(var ia=1;ia<X.length;ia++)if(X[ia].isSelected())return!1;return!0};this.getSelectedFieldNum=function(X){for(var ia=0,ka=1;ka<X.length;ka++)X[ka].isSelected()&&ia++;return ia};this.rebuildInnerEntityProperty=function(X,ia,ka){X=X.getProperties();var Aa={},sa=[];ia.getProperties().forEach(function(ya){if(null==ka[ya.getName()]){var Qa=ya.getRelatedBaseProp()?ya.getRelatedBaseProp():ya.getName();Aa[Qa]=ya}});X.forEach(function(ya){var Qa=Aa[ya.getName()];Qa&&(Qa.setRelatedBaseProp(ya.getName()),
sa.push(Qa))});return sa};this.mergeUnionTreeProp4NewEntityMerge=function(X,ia){var ka=ia.getPropMapModels(),Aa=ia.getEntityCellNode(1).getEntity(),sa=ia.getEntityCellNode(0).getEntity();ia=[];for(var ya=0;ya<ka.length;ya++){var Qa=ka[ya];Qa.isSelected()&&0<=Qa.getBaseFieldProp().getTreeType()&&ia.push(Qa)}ka=X.getChildren();ya=[];if(Aa&&sa)for(sa=0;sa<ia.length;sa++)Ia=ia[sa],Qa=Ia.getFieldPropByIndex(1),lb=Ia.getBaseFieldProp(),(Ia=X.getTreeRootProp(lb))?(Qa&&(Qa=Aa.getTreeRootProp(Qa),Ia.mergeFrom(Qa)),
ya.push(Ia)):(Qa=Y(lb,ka))&&ya.push(Qa);else for(sa=0;sa<ia.length;sa++){var Ia=ia[sa],lb=Ia.getBaseFieldProp();(Ia=X.getTreeRootProp(lb))?ya.push(Ia):(Qa=Y(lb,ka))&&ya.push(Qa)}X.setTreeRootProps(ya)};var Y=function(X,ia){for(var ka=[],Aa=X.getName(),sa=0;sa<ia.length;sa++)for(var ya=ia[sa].getTreeRootProps(),Qa=0;Qa<ya.length;Qa++){var Ia=ya[Qa];Ia.getRefProp().getRelatedBaseProp()==Aa&&ka.push(Ia)}if(0<ka.length){X=ka[0].cloneMe(X);for(ia=1;ia<ka.length;ia++)X.mergeFrom(ka[ia]);return X}return null};
this.setUnionEntityProperties=function(X,ia){for(var ka=[],Aa={},sa={},ya=0;ya<ia.length;ya++){var Qa=ia[ya];if(Qa.isSelected()){var Ia=Qa.getBaseFieldProp();void 0===Ia.getFormatString()&&Ec.confirmDefaultFormatString(Ia);var lb=Ia.getName(),ob=Ja(Aa,lb),$a=Ja(sa,Ia.getAlias());Ia.setName(ob);Ia.setAlias($a);lb!=ob&&Qa.changeBasePropName(ob);Aa[Ia.getName()]=Ia;sa[Ia.getAlias()]=Ia;ka.push(Ia)}}X.getProperties().forEach(function(Ab){Ab.isCalculatingField()&&ka.push(Ab)});X.setProperties(ka)};var Ja=
function(X,ia){if(X[ia]){for(var ka=1,Aa=ia+"_"+ka;X[Aa];)ka++,Aa=ia+"_"+ka;return Aa}return ia};this.resetIndexAliasIfExist=function(X,ia){for(var ka=X.getAlias(),Aa=1;ia[ka];)ka=X.getAlias()+"_"+Aa,Aa++;X.setAlias(ka)};this.resetIndexNameIfExist=function(X,ia){for(var ka=X.getName(),Aa=1;ia[ka];)ka=X.getName()+"_"+Aa,Aa++;X.setName(ka)};this.convertEntityToUnion=function(X){var ia=new Cc;ia.setFilters(X.getFilters());ia.setName(X.getName());ia.setAlias(X.getAlias());ia.setDesign(X.getDesign());
X.setUnionUnit(!0);X.setFilters([]);X.setDesign(null);ia.getChildren().push(X);W(ia,X);return ia};var W=function(X,ia){var ka=[],Aa=[];ia.getProperties().forEach(function(sa){sa.isCalculatingField()?Aa.push(sa):ka.push(sa)});ia.setProperties(ka);X.setProperties(Aa)};this.createSpecialCalcProp4Relation=function(X,ia){var ka=new Ec,Aa=Math.floor(999999*Math.random()+1);ka.setName("F"+((new Date).getTime()+Aa));ka.setAssociateName(ka.getName());ka.setDataType(Ec.DT_STRING);ka.setHide(!0);ka.setHideInDataModeling(!0);
Aa=eb.get("customBizEntityNameField","\u5b9e\u4f53\u540d\u79f0");X=X.getAlias()+"."+ia.getAlias();ka.setAlias(Aa+"+"+X);ka.setFormula("["+Ec.CUSTOM_BIZ_ENTITY_NAME_FIELD+"]+["+ia.getName()+"]");return ka}}function Dc(Y,Ja){bd.call(this,Y,Ja);var W=this.protectedMethod,X,ia;this.setPropMapRelationDataRows=function(ka){ia=ka};this.protectedGetCurrentMapData=function(){return ia};this.isNeedAppendUnSelectProperty=function(){return!1};this.setEntityMergeCtx=function(ka){X=ka};this.setPropMapRowStatus=
function(ka){var Aa=ka.getBaseFieldProp(),sa=ka.getPropCells();if(Aa.getName()==Ec.CUSTOM_BIZ_ENTITY_NAME_FIELD)ka.setLocked(!0),sa.forEach(function(lb){lb.setSelectable(!1)});else for(Aa=0;Aa<sa.length;Aa++){var ya=sa[Aa],Qa=ya.getProperty();if(Qa){var Ia=W.getEntityUnitByIndex(ya.getIndex());X.isRelationProperty(Ia.getName(),Qa,ub.UNION_ENTITY_UNIT)&&(ka.setLocked(!0),ya.setSelectable(!1))}}}}function bd(Y,Ja){var W=this;this.protectedGetCurrentMapData=function(){return null};this.loadPropertyMapModels=
function(){var ia=W.protectedGetCurrentMapData();if(ia)return ia;ia=[];for(var ka=Y.getChildren(),Aa=Y.getProperties(),sa=0;sa<Aa.length;sa++){var ya=Aa[sa];if(!ya.isCalculatingField()){var Qa=ya.getName(),Ia=new cb;Ia.init(ka.length);for(var lb=!1,ob=0;ob<ka.length;ob++){var $a=ka[ob].getName();$a=Ja.getEntityRelatedPropMap($a)[Qa];Ia.setProperty(ob,$a,!1);lb=lb||null!=$a}lb&&(Ia.setUnionBaseProp(ya),Ia.setSelected(!0),W.setPropMapRowStatus(Ia),ia.push(Ia))}}W.isNeedAppendUnSelectProperty()&&X(ia);
return ia};this.isNeedAppendUnSelectProperty=function(){return!0};var X=function(ia){for(var ka=Y.getChildren(),Aa=[],sa=0,ya=0;ya<ka.length;ya++){var Qa=Ja.getUnSelectedProperty(ka[ya].getName());Qa&&0!=Qa.length&&Qa.forEach(function(Ia){var lb;a:{for(lb=0;lb<Aa.length;lb++){var ob=Aa[lb];if(ob.getBaseFieldProp().getName()==Ia.getName()){lb=ob;break a}}lb=null}lb?(Ia.setRelatedBaseProp(lb.getBaseFieldProp().getName()),lb.setProperty(sa,Ia,!1)):(lb=new cb,ob=Ia.cloneMe(),lb.init(ka.length),lb.setSelected(!1),
lb.setUnionBaseProp(ob),lb.setProperty(sa,Ia,!1),Aa.push(lb));ob=lb.getBaseFieldProp();if(ob!=Ia){var $a=Ia.getOutputDataType();Ub.isDataTypeConvertable($a,ob.getOutputDataType())||(Ia=v.buildDataTypeInConsistantPrompt(Ia,ob),lb.setPrompt(ya,new Hc(!0,Ia)))}});sa++}Aa.forEach(function(Ia){ia.push(Ia)})};this.setPropMapRowStatus=function(ia){};this.protectedMethod={getEntityUnitByIndex:function(ia){return Y.getChildren()[ia]}}}function Uc(Y,Ja){var W;this.setEntityCompareModel=function(Qa){W=Qa};var X=
function(Qa){for(var Ia={},lb=0;lb<Qa.length;lb++)Ia[Qa[lb].getAssociateName()]=Qa[lb];return Ia};this.createPropRelationMapData=function(){var Qa=[];ia(Qa);sa(Qa);ya(Qa);return Qa};var ia=function(Qa){for(var Ia=ka(),lb=0;lb<Ia.length;lb++){var ob=new cb;ob.init(2);ob.setProperty(0,Ia[lb],!0);Qa.push(ob)}return Qa},ka=function(){var Qa=[];if(Y.isUnion())Qa=Y.getProperties();else{Qa=Y.getProperties().map(function(lb){return lb.cloneMe()});var Ia=Y.getColumnToRowProperties();Ia&&0<Ia.length&&(Qa=Aa(Qa,
Ia))}return Qa.filter(function(lb){return!lb.isCalculatingField()})},Aa=function(Qa,Ia){for(var lb in Ia){var ob=Ia[lb],$a=ob.getUsedColumnToRowPropertyNames(),Ab;for(Ab in $a)a:{var wb=void 0,yb=$a[Ab],ac=Qa;for(wb in ac)if(yb==ac[wb].getName()){ac.splice(wb,1);break a}}Qa.push(ob.getFieldNameProperty());Qa=Qa.concat(ob.getFieldValueProperties())}return Qa},sa=function(Qa){for(var Ia=X(Ja.getProperties()),lb=0;lb<Qa.length;lb++){var ob=Qa[lb];if(!ob.getFieldPropByIndex(1)){var $a=ob.getBaseFieldProp(),
Ab=Ia[$a.getAssociateName()];Ab&&(Ia[$a.getAssociateName()]=null,ob.setProperty(1,Ab,!1),Ab.setRelatedBaseProp($a.getName()),Ub.isDataTypeConvertable(Ab.getOutputDataType(),$a.getOutputDataType())||($a=v.buildDataTypeInConsistantPrompt(Ab,$a),ob.setPrompt(1,new Hc(!0,$a))))}}},ya=function(Qa){for(var Ia=Ja.getProperties(),lb=0;lb<Ia.length;lb++){var ob=Ia[lb];if(!ob.getRelatedBaseProp()){var $a=new cb;$a.init(2);$a.setProperty(1,ob,!0);Qa.push($a)}}};this.protectedMethod={getEntityCompareModel:function(){return W},
createSelectedRowItem:ia,getEntityByIndex:function(Qa){return 0==Qa?Y:Ja},changePropListToMap:X,matchSameAssociateNameProperty:sa,createNewAddedProperty:ya}}function Qc(Y,Ja){Uc.call(this,Y,Ja);var W=Y&&Ja?2:1,X=this.protectedMethod,ia,ka=new Ob;this.setEntityMergeCtx=function(Aa){ia=Aa};this.createPropRelationMapData=function(){var Aa=[],sa=X.getEntityByIndex(0),ya=X.getEntityByIndex(1);if(sa&&ya){var Qa=X.changePropListToMap(ya.getProperties()),Ia=sa.getProperties(),lb=ya.getProperties(),ob=Ia.length,
$a=lb.length,Ab=sa.isUnion();sa={};for(var wb={},yb=0;yb<ob;yb++){var ac=new cb;ac.init(2);var kb=Ia[yb];if(!kb.isCalculatingField()){if(Ab)var Jb=kb;else Jb=kb.cloneMe(),kb.setRelatedBaseProp(Jb.getName());ac.setUnionBaseProp(Jb);ac.setProperty(0,kb);kb=Jb;var ja=Qa,gb=ac;if(kb.getName()==Ec.CUSTOM_BIZ_ENTITY_NAME_FIELD)ja=ka.createBizUnionEntityNameField(),ja.setRelatedBaseProp(kb.getName()),gb.setProperty(1,ja,!1),gb.setPropCellSelectable(1,!1),gb.setLocked(!0);else{var vb=X.getEntityByIndex(1),
rb=X.getEntityByIndex(0);ia.isSourceEntityFromProperty(rb.getName(),kb)?((vb=ia.findTargetEntityRelationFromProp(vb.getName()))?(vb.setRelatedBaseProp(kb.getName()),gb.setProperty(1,vb,!1),gb.setPropCellSelectable(1,!1)):((ja=ja[kb.getAssociateName()])&&ja.setRelatedBaseProp(kb.getName()),gb.setProperty(1,ja,!1),gb.setPropCellSelectable(1,!0)),gb.setLocked(!0)):ia.isSourceEntityToProperty(rb.getName(),kb)?(ja=ia.findTargetEntityRelationToProperty(vb.getName()),ja.setRelatedBaseProp(kb.getName()),
gb.setProperty(1,ja,!1),gb.setPropCellSelectable(1,!1),gb.setLocked(!0)):(ja=ja[kb.getAssociateName()])&&Ub.isPropEnumValueConsistent(ja,kb)?(kb.getTreeType()==ja.getTreeType()&&(ja.setRelatedBaseProp(kb.getName()),gb.setProperty(1,ja,!1)),ia.isRelationProperty(vb.getName(),ja,ub.TARGET_ENTITY)?(gb.setPropCellSelectable(1,!1),gb.setLocked(!0)):(gb.setFieldSelectable(!0),gb.setLocked(!1))):(gb.setFieldSelectable(!0),gb.setLocked(!1))}Aa.push(ac);(kb=ac.getFieldPropByIndex(1))?(delete Qa[kb.getAssociateName()],
sa[kb.getName()]=kb):wb[Jb.getAlias()]=ac}}for(yb=0;yb<$a;yb++)Qa=lb[yb],sa[Qa.getName()]||(ac=wb[Qa.getAlias()])&&!ac.isLocked()&&(Jb=ac.getFieldPropByIndex(0),Ub.isPropEnumValueConsistent(Jb,Qa)&&Jb.getTreeType()==Qa.getTreeType()&&(Qa.setRelatedBaseProp(Jb.getName()),ac.setProperty(1,Qa,!1),delete wb[Jb.getAlias()],sa[Qa.getName()]=Qa));for(yb=0;yb<$a;yb++)Qa=lb[yb],sa[Qa.getName()]||(ac=new cb,ac.init(2),Jb=Qa.cloneMe(),ac.setUnionBaseProp(Jb),Qa.setRelatedBaseProp(Jb.getName()),ac.setProperty(1,
Qa),ia.isRelationProperty(ya.getName(),Qa,ub.TARGET_ENTITY)&&(ac.setPropCellSelectable(1,!1),ac.setLocked(!0)),Aa.push(ac))}else for(ya=sa?sa:ya,lb=ya.isUnion(),$a=ya.getProperties(),Qa=ia.isAppendNewEntity()?ya==sa?ub.SOURCE_ENTITY:ub.TARGET_ENTITY:ub.UNION_ENTITY_UNIT,Ia=0;Ia<$a.length;Ia++)ob=$a[Ia],ob.isCalculatingField()||(sa=new cb,sa.init(1),lb?wb=ob:(wb=ob.cloneMe(),ob.setRelatedBaseProp(wb.getName())),sa.setUnionBaseProp(wb),sa.setProperty(0,ob),ia.isRelationProperty(ya.getName(),ob,Qa)&&
sa.setLocked(!0),ob.getName()==Ec.CUSTOM_BIZ_ENTITY_NAME_FIELD&&sa.setLocked(!0),Aa.push(sa));if(0!=Aa.length&&Aa[0].getBaseFieldProp().getName()!=Ec.CUSTOM_BIZ_ENTITY_NAME_FIELD){ya=new cb;ya.init(W);ya.setUnionBaseProp(ka.createBizUnionEntityNameField());lb=ka.createBizUnionEntityNameField();lb.setRelatedBaseProp(Ec.CUSTOM_BIZ_ENTITY_NAME_FIELD);ya.setProperty(0,lb,!1);ya.setLocked(!0);for(lb=1;lb<W;lb++)$a=ka.createBizUnionEntityNameField(),$a.setRelatedBaseProp(Ec.CUSTOM_BIZ_ENTITY_NAME_FIELD),
ya.setProperty(lb,$a,!1),ya.setPropCellSelectable(lb,!1);Aa.splice(0,0,ya)}return Aa}}function Xb(){cc.call(this);var Y=this,Ja=this.protectedMethod,W,X,ia,ka;this.setEntityMergeModel=function(Ia){X=Ia};this.setBizEntityMergeCtx=function(Ia){W=Ia};this.setFieldSelectChangeListener=function(Ia){ka=Ia};var Aa=function(Ia,lb){lb=sa(lb);Ia.text(lb);Ia.attr("title",lb)},sa=function(Ia){return Ia?Ia.getTreeType()==l.TREE_TYPE_FLEX?Ia.getAlias()+"("+eb.get("flexField","\u5f39\u6027\u57df")+")":Ia.isEnum()?
Ia.getAlias()+"("+eb.get("enumField","\u679a\u4e3e\u5b57\u6bb5")+")":Ia.getAlias():""};this.protectedFillRowCellValue=function(Ia,lb){var ob=Ja.getSourceEntity(),$a=Ja.getNewMergeEntity();ob&&$a?(ob=Ia.getFieldPropByIndex(0),$a=Ia.getFieldPropByIndex(1),lb.getCell(0).setValue(Ia.isSelected()),lb.getCell(1).setValue(sa(ob)),lb.getCell(2).setValue(sa($a)),lb.getCell(3).setValue(Ia.getPrompt())):(ob=Ia.findFirstNotNullPropCell().getProperty(),lb.getCell(0).setValue(Ia.isSelected()),lb.getCell(1).setValue(sa(ob)))};
var ya=function(){var Ia=Ja.getNewMergeEntity();if(!Ia)return[];var lb=[];lb.push(null);Ia.getProperties().forEach(function(ob,$a,Ab){$a=ob.getName()==Ec.CUSTOM_BIZ_ENTITY_NAME_FIELD?!1:($a=W.getTargetEntityRelationProps(Ja.getNewMergeEntity()))?$a[0]!=ob&&$a[1]!=ob:!0;$a&&lb.push(ob)});return lb};this.protectedPrepareColMeta=function(){var Ia=Ja.getSourceEntity(),lb=Ja.getNewMergeEntity();ia=new Wb(Qa);if(Ia&&lb){var ob=[],$a=new Ha(0,"",40,null,-1,new xb(ia),new Eb(ia));ob.push($a);$a=new ab;$a.setItemModels(ya());
$a.setCustomItemPainter(Aa);$a.setPropSelectChangedListener(function(Ab,wb){Ja.getFieldSelectChangeHandler()(Ab,wb);ka&&ka(Y.getSelectedFieldNum())});Ia=new Ha(1,Ia.getAlias(),225,Ia,0,$a);ob.push(Ia);lb=new Ha(2,lb.getAlias(),225,lb,1,$a);ob.push(lb)}else ob=[],lb=Ia?Ia:lb,$a=new Ha(0,"",40,null,-1,new xb(ia),new Eb(ia)),ob.push($a),Ia=new ab,lb=new Ha(1,lb.getAlias(),560,lb,0,Ia),ob.push(lb);return ob};this.getSelectedFieldNum=function(){return ia?ia.getCheckCount()-1:0};var Qa=function(Ia){X.getUnionChangeState().setPropCheckChanged(Ia);
ka&&ka(Y.getSelectedFieldNum())}}function cc(){var Y=this,Ja,W,X,ia,ka,Aa,sa,ya,Qa;this.getJqUi=function(){if(!Ja){Ja=$("<div>");Ja.addClass("dm-union-entity-prop-map-container");W=yc.createTable();W.setSyncUIWhenModelChanged(!1);yc.bindTableListenerForCtrl(W);var wb=$(W.getUI());wb.addClass("dm-entity-fieldtable");wb.appendTo(Ja)}return Ja};this.loadData=function(wb,yb){X=wb;ia=yb;sa=new Uc(X,ia);wb=Y.protectedPrepareColMeta();yc.clear(W);yb=new $b(W);yb.setColumnMetas(wb);yb.setOutsideVisible(!0);
W.setCellRender(yb);W.addColumns(wb.length);for(yb=0;yb<wb.length;yb++){var ac=wb[yb],kb=ac.getColIndex();W.getColumn(kb).setWidth(ac.getWidth())}yb=yc.createHeadRow(W);for(ac=0;ac<wb.length;ac++){kb=wb[ac];var Jb=kb.getColIndex();yb.getCell(Jb).setValue(kb.getName())}ka||(sa.setEntityCompareModel(Aa),ka=sa.createPropRelationMapData());$a()};var Ia=function(){if(!ia)return[];var wb=[];wb.push(null);ia.getProperties().forEach(function(yb,ac,kb){wb.push(yb)});return wb},lb=function(wb,yb){yb?yb.getAlias()?
(wb.text(yb.getAlias()),wb.attr("title",yb.getAlias())):(wb.text(yb.getAssociateName()),wb.attr("title",yb.getAssociateName())):(wb.text(""),wb.attr("title",""))};this.setFieldSelectChangeListener=function(wb){Qa=wb};this.protectedPrepareColMeta=function(){var wb=[];ya=new Wb(ob);var yb=new Ha(0,"",40,null,-1,new xb(ya),new Eb(ya));wb.push(yb);yb=new ab;yb.setItemModels(Ia());yb.setCustomItemPainter(lb);yb.setPropSelectChangedListener(function(kb,Jb){Ab(kb,Jb);Qa&&Qa(Y.getSelectedFieldNum())});var ac=
new Ha(1,X.getAlias(),400,X,0,yb);wb.push(ac);yb=new Ha(2,ia.getAlias(),400,ia,1,yb);wb.push(yb);return wb};var ob=function(wb){Qa&&Qa(Y.getSelectedFieldNum())};this.getSelectedFieldNum=function(){return ya?ya.getCheckCount():0};this.resize=function(){W.relayoutViews()};this.setBox=function(wb){};this.setPropMappingHelper=function(wb){sa=wb};this.setPropertyRelationRows=function(wb){ka=wb};this.setEntityCompareModel=function(wb){Aa=wb};this.getPropertyMapModels=function(){return ka};this.refresh=
function(){W.updateUI()};this.protectedInitUi=function(){};this.protectedFillRowCellValue=function(wb,yb){var ac=wb.getFieldPropByIndex(0),kb=wb.getFieldPropByIndex(1);yb.getCell(0).setValue(wb.isSelected());yb.getCell(1).setValue(ac?ac.getAlias():"");yb.getCell(2).setValue(kb?kb.getAlias():"");yb.getCell(3).setValue(wb.getPrompt())};var $a=function(){for(var wb=0;wb<ka.length;wb++){var yb=yc.createRow(W),ac=ka[wb];yb.setUserObject(ac);Y.protectedFillRowCellValue(ac,yb)}yc.refresh(W)},Ab=function(wb,
yb){if(yb){yb=wb.getSelectedModel();var ac=wb.getUserObject();wb=ac.getPropCell(1).getProperty();if(!wb||!yb||wb.getName()!=yb.getName()){var kb;if(yb)b:{for(kb=0;kb<ka.length;kb++){var Jb=ka[kb].getFieldPropByIndex(1);if(yb==Jb)break b}kb=-1}else kb=-1;-1!=kb&&(Jb=ka[kb],Jb.setProperty(1,null,!1),Jb.setPrompt(1,null),Jb.isEmpty()&&ka.splice(kb,1));ac.setProperty(1,yb,!1);ac.isEmpty()?ka.splice(ka.indexOf(ac),1):(kb=ac.getBaseFieldProp(),ac.setPrompt(1,null),kb&&yb&&(yb.setRelatedBaseProp(kb.getName()),
Ub.isPropEnumValueConsistent(yb,kb)?kb.getTreeType()!=yb.getTreeType()?(Jb=eb.get("flexFieldInConsistent",'\u6570\u636e\u8868"#1"\u4e2d\u7684"#2"\u5b57\u6bb5\u4e3a\u5f39\u6027\u57df\u5b57\u6bb5\uff0c\u5f39\u6027\u57df\u53ea\u80fd\u4e0e\u5f39\u6027\u57df\u5b57\u6bb5\u5408\u5e76\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9'),kb.getTreeType()==l.TREE_TYPE_FLEX?(Jb=Jb.replace("#1",X.getAlias()),Jb=Jb.replace("#2",kb.getAlias()),ac.setPrompt(1,new Hc(!1,Jb))):yb.getTreeType()==l.TREE_TYPE_FLEX&&(Jb=Jb.replace("#1",
ia.getAlias()),Jb=Jb.replace("#2",yb.getAlias()),ac.setPrompt(1,new Hc(!1,Jb)))):(Jb=yb.getOutputDataType(),Ub.isDataTypeConvertable(Jb,kb.getOutputDataType())||(yb=v.buildDataTypeInConsistantPrompt(yb,kb),ac.setPrompt(1,new Hc(!0,yb)))):(yb=eb.get("enumFieldInConsistent","\u5efa\u7acb\u6620\u5c04\u7684\u679a\u4e3e\u5b57\u6bb5\uff0c\u5176\u4e2d\u6bcf\u4e2a\u5b57\u6bb5\u679a\u4e3e\u503c\u5fc5\u987b\u5b8c\u5168\u4e00\u81f4\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9"),ac.setPrompt(1,new Hc(!1,yb)))));wb&&(wb.setRelatedBaseProp(null),
yb=new cb,yb.init(2),yb.setProperty(1,wb,!0),ka.push(yb));yc.clearWithoutHead(W);$a()}}};this.protectedMethod={getSourceEntity:function(){return X},getNewMergeEntity:function(){return ia},getFieldSelectChangeHandler:function(){return Ab}}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.data&&(com.kingdee.bos.qing.data=
{});var Da=com.kingdee.bos.qing.data;Da.PropertyMapTableModifyPane=tc;Da.DataSourceMergeFirstStep=function(){Db.call(this);var Y=this,Ja;this.createNextDbConnectStep=function(W){var X=new Mb;X.setSource(W);X.setCtxApi(Y.getCtxApi());X.setSelectEntity(Ja);return X};this.createNextFileConnectStep=function(W){var X=new Vb;X.setSource(W);X.setCtxApi(Y.getCtxApi());X.setSelectEntity(Ja);X.setIsUsedForMerge(Y.isUsedForMerge());return X};this.createNextOpenAPIConnectStep=function(W){var X=new Xa;X.setSource(W);
X.setCtxApi(Y.getCtxApi());X.setSelectEntity(Ja);return X};this.createNextSelectTableSteps=function(W){var X=new ma;X.setCtxApi(Y.getCtxApi());X.setSource(W);X.setSelectEntity(Ja);var ia=new Ib;ia.setCtxApi(Y.getCtxApi());ia.setSource(W);var ka=new Kb;ka.setCtxApi(Y.getCtxApi());ka.setSource(W);ka.setSelectEntity(Ja);return[X,ia,ka]};this.prepareStep=function(W){for(var X=0;X<W.length;X++)W[X].setCtxApi(Y.getCtxApi()),W[X].setSelectEntity(Ja)};this.setSelectEntity=function(W){Ja=W};this.isUsedForMerge=
function(){return!0}};Da.MergedTableModifyDialog=function(){ad.call(this);var Y=this,Ja=this.protectedMethod,W,X,ia,ka,Aa,sa,ya=0,Qa;this.setUnionEntityCompareModel=function(Sa){sa=Sa};this.setGlobalDependence=function(Sa){Aa=Sa};this.setRelations=function(Sa){ka=Sa};this.setUnionEntity=function(Sa){X=Sa};this.setConfirmListener=function(Sa){ia=Sa};this.refresh=function(){W.refreshTable()};var Ia=function(){W=new tc(800);W.setUnionEntity(X);W.setUnionEntityCompareModel(sa);W.setGlobalDependence(Aa);
W.setCreateNewMergeModifiedEntity(yb);W.setFieldSelectChangeListener(function(Sa){lb(Sa)});Y.setSize(800,480);Ja.setContentPaneCreator(function(){var Sa=W.getJqUi();Sa.children(".dm-entity-fieldtable").css("top","25px");Qa=$("<div>");Qa.addClass("dm-entity-field-match-label-title-field-num");Qa.css({left:"10px",top:"5px"});Qa.appendTo(Sa);W.loadData();var Fb=W.getSelectedFieldNum();lb(Fb);return Sa});Ja.setClosingAction(ob);Ja.setClosingChecker(Tc,!0)},lb=function(Sa){ya=Sa;Sa=eb.get("selectedFieldNum",
"\u5df2\u9009\u62e9#1\u4e2a\u5b57\u6bb5");Sa=Sa.replace("#1",ya);Qa.text(Sa)};this.initUi=function(){Ja.setTitle(eb.get("modifyMergedTable","\u4fee\u6539\u5408\u5e76\u72b6\u6001"));Ia()};var ob=function(Sa){if(Sa){Sa=W.getArrEntitySource();var Fb=W.getSubEntitys(),Ua={},Ta;for(Ta in Sa){var ra=Sa[Ta].getEntity(),bb=Ua[ra.getSource().getName()];null==bb&&(bb=[],Ua[ra.getSource().getName()]=bb);bb.push(ra.getSource())}for(Ta=0;Ta<Sa.length;Ta++)if(ra=Sa[Ta],null!=ra.getUserSql())for(var Oa=0;Oa<Fb.length;Oa++)if(bb=
ra.getEntity(),bb.getName()==Fb[Oa].getName()){var Pa=bb.getSource();bb=Ua[Pa.getName()];for(var ua in bb)bb[ua].addUserSql(ra.getUserSql());Fb[Oa].setSource(Pa);break}Ta=W.getSubEntitys();Ta=1==Ta.length?ac(Ta[0]):rb();gb(Ta);ia(Ta,wb(Ta))}else X&&X.getChildren()&&(Ta=X.getChildren(),0<Ta.length&&Jb(Ta[0],!0))},$a=function(Sa){var Fb=[],Ua={};Sa.getProperties().forEach(function(Ta){Ua[Ta.getName()]=Ta});X.getProperties().forEach(function(Ta){Ua[Ta.getName()]||Fb.push(Ta)});return Fb},Ab=function(Sa,
Fb){for(var Ua=[],Ta=0;Ta<ka.length;Ta++){var ra=ka[Ta],bb=Sa,Oa=Fb,Pa=ra.getFromEntity();ra=ra.getFromProperty();(bb=Pa.getName()==Oa&&ra.getName()==bb.getName())||(ra=ka[Ta],bb=Sa,Oa=Fb,Pa=ra.getToEntity(),ra=ra.getToProperty(),bb=Pa.getName()==Oa&&ra.getName()==bb.getName());bb&&Ua.push(ka[Ta])}return Ua},wb=function(Sa){var Fb=[];$a(Sa).forEach(function(Ua){Ab(Ua,Sa.getName()).forEach(function(Ta){Fb.push(Ta)})});return Fb},yb=function(Sa,Fb){Sa=rb(Sa,Fb);gb(Sa);return Sa},ac=function(Sa){Sa.setUnionUnit(!1);
Sa.setDesign(X.getDesign());Sa.setParild(X.getParild());Sa.setName(X.getName());Sa.setAlias(X.getAlias());Sa.setFilters(vb());Sa.getProperties().forEach(function(Fb){Fb.setRelatedBaseProp("")});kb(Sa);Jb(Sa,!1);return Sa},kb=function(Sa){var Fb=W.getPropertyMapModels();Fb=fc(0,Fb);Sa.setProperties(Fb)},Jb=function(Sa,Fb){var Ua=Sa.getProperties();if((Sa=Sa.getColumnToRowProperties())&&0<Sa.length){var Ta={};Ua.forEach(function(ra){var bb=ra.getRelatedBaseProp()?ra.getRelatedBaseProp():ra.getName();
Ta[bb]=ra});Zb(Ta,Ua,Sa,Fb)}},ja=function(Sa){for(var Fb=[],Ua=0;Ua<Sa.length;Ua++){var Ta=Sa[Ua];Ta.isSelected()&&Fb.push(Ta.getBaseFieldProp())}Sa={};for(Ua=0;Ua<Fb.length;Ua++){Ta=Fb[Ua];if(Sa[Ta.getName()]){for(var ra=1,bb=Ta.getName()+"_"+ra;Sa[bb];)ra++,bb=Ta.getName()+"_"+ra;Ta.setName(bb);Ta.setAlias(bb)}Sa[Ta.getName()]=Ta}return Fb},gb=function(Sa){X.getProperties().forEach(function(Fb){Fb.isCalculatingField()&&Sa.getProperties().push(Fb)})},vb=function(){return X.getFilters().filter(function(Sa,
Fb,Ua){return null!=Sa.getProperty()&&null!=Sa.getProperty().getName()})},rb=function(Sa,Fb){Fb=void 0==Fb?W.getPropertyMapModels():Fb;var Ua=new Cc;Ua.setFilters(vb());Sa=void 0==Sa?W.getSubEntitys():Sa;var Ta=ja(Fb);Ua.setProperties(Ta);for(Ta=0;Ta<Sa.length;Ta++){var ra=Sa[Ta],bb=ra.getProperties(),Oa=fc(Ta,Fb);ra.setProperties(Oa);if(0==Ta){var Pa=ra.getColumnToRowProperties();if(Pa&&0<Pa.length){var ua={};bb.forEach(function(nb){var pb=nb.getRelatedBaseProp()?nb.getRelatedBaseProp():nb.getName();
ua[pb]=nb});Zb(ua,Oa,Pa,!0)}}Ua.getChildren().push(ra)}Ua.setName(X.getName());Ua.setAlias(X.getAlias());Ua.setParild(X.getParild());Ua.setDesign(X.getDesign());Ua.setColumnToRowProperties(X.getColumnToRowProperties());return Ua},Zb=function(Sa,Fb,Ua,Ta){for(var ra in Ua){var bb=Ua[ra];if(bb){var Oa=void 0,Pa=Fb,ua=bb,nb=Ta,pb=[],Bb=ua.getFieldNameProperty();ua=ua.getFieldValueProperties();pb.push(Bb);pb=pb.concat(ua);for(Oa in pb){ua=pb[Oa];Bb=ua.getName();nb?ua.setRelatedBaseProp(Bb):ua.setRelatedBaseProp("");
for(var Yb in Pa)if(Pa[Yb].getName()==Bb){Pa.splice(Yb,1);break}}bc(Sa,Fb,bb)}}},bc=function(Sa,Fb,Ua){var Ta={};Fb.forEach(function(Pa){var ua=Pa.getRelatedBaseProp()?Pa.getRelatedBaseProp():Pa.getName();Ta[ua]=Pa});Ua=Ua.getUsedColumnToRowPropertyNames();for(var ra in Ua){var bb=Ua[ra],Oa=Sa[bb];Oa&&((bb=Ta[bb])&&bb.setRelatedBaseProp(""),bb||(Oa.setRelatedBaseProp(""),Fb.push(Oa)))}},fc=function(Sa,Fb){for(var Ua=[],Ta,ra,bb=0;bb<Fb.length;bb++)if(ra=Fb[bb],ra.isSelected()&&(Ta=ra.getFieldPropByIndex(Sa)))Ua.push(Ta),
Ta.setRelatedBaseProp(ra.getBaseFieldProp().getName());return Ua},Tc=function(Sa){for(var Fb=W.getPropertyMapModels(),Ua=!0,Ta=0;Ta<Fb.length;Ta++)Fb[Ta].isSelected()&&(Ua=!1);Ua?(Ja.getMessageCurtain().showPrompt(eb.get("atLeastSelectAField","\u81f3\u5c11\u9009\u4e2d\u4e00\u4e2a\u5b57\u6bb5\u3002")),Sa(!1)):tb.checkFieldNum(ya,Ja.getMessageCurtain(),Sa)}};Da.MergeDBCenterConnectionStep=function(){p.call(this);var Y=this,Ja;this.setSelectEntity=function(W){Ja=W};this.createNextTableSteps=function(){var W=
new ma;W.setCtxApi(Y.getCtxApi());W.setSource(Y.getSource());W.setSelectEntity(Ja);var X=new Ib;X.setCtxApi(Y.getCtxApi());X.setSource(Y.getSource());var ia=new Kb;ia.setCtxApi(Y.getCtxApi());ia.setSource(Y.getSource());ia.setSelectEntity(Ja);return[W,X,ia]};this.creatNextCustomSqlStep=function(){var W=new vc;W.setSqlType(B.SQLTYPE_SQL);W.setCtxApi(Y.getCtxApi());W.setSource(Y.getSource());W.setSelectEntity(Ja);return W};this.creatNextCustomKSqlStep=function(){var W=new vc;W.setSqlType(B.SQLTYPE_KSQL);
W.setCtxApi(Y.getCtxApi());W.setSource(Y.getSource());W.setSelectEntity(Ja);return W};this.creatNextStoredProcedureStep=function(){var W=new mb;W.setCtxApi(Y.getCtxApi());W.setSource(Y.getSource());W.setSelectEntity(Ja);return W}};Da.MergeSuperQueryStep=function(){ic.call(this);var Y=this,Ja;this.setSelectEntity=function(W){Ja=W};this.createNextTableSteps=function(){var W=new Lb;W.setCtxApi(Y.getCtxApi());W.setSource(Y.getSource());W.setSelectEntity(Ja);return W};this.creatNextCustomSqlStep=function(){var W=
new vc;W.setSqlType(B.SQLTYPE_SQL);W.setCtxApi(Y.getCtxApi());W.setSource(Y.getSource());W.setSelectEntity(Ja);return W}};Da.BizEntityMergeEntranceStep=function(){ma.call(this);var Y=this,Ja=this.protectedMethod,W,X,ia,ka,Aa,sa;this.setBox=function($a){sa=$a};this.setRelationDialogOpener=function($a){ka=$a};this.setGlobal=function($a){Aa=$a};var ya=function(){return ka},Qa=function(){return Aa};this.getSubTitle=function(){return eb.get("selectBizEntity","\u9009\u62e9\u4e1a\u52a1\u5b9e\u4f53")};this.isScannable=
function(){return!0};var Ia=function(){W=!0},lb=function(){return W};this.setFacadeCreator=function($a){X=$a};this.setFinishedCallback=function($a){ia=$a};this.intoThisStep=function($a,Ab){Ab?Y.refreshPreviewTable():(Y.setCtxApi({createFacade:X,finish:ia,isFinished:lb,getBoxModel:ob,getGlobal:Qa,getOpenRelationDlgFun:ya,refreshFinishFlag:Ia}),Y.loadLeftNodes())};var ob=function(){return sa};this.outThisStep=function($a,Ab){if($a)Ab(null);else if($a=Y.getSelectNode(),null==$a)Ja.getMessageCurtain().showPrompt(eb.get("selectOneTable",
"\u8bf7\u9009\u4e2d\u4e00\u4e2a\u6570\u636e\u8868\u3002")),Ab(Y);else{var wb=Y.getDataObject($a.getName()),yb=new rc;yb.setCtxApi(Y.getCtxApi());yb.setSource(Y.getSource());yb.setSourceEntity(Y.getSelectEntity());yb.setSelectModeDisplayName($a?$a.getDisplayName():null);Ab(wb?yb:Y)}}};Da.BizUnionEntityModifyDialog=function(){ad.call(this);var Y=this,Ja=this.protectedMethod,W,X,ia=new Ob,ka,Aa=$("<div>"),sa,ya,Qa,Ia,lb,ob,$a,Ab=0,wb;this.setOpenInnerRelationDialog=function(ua){lb=ua};this.setGlobalDependence=
function(ua){ka=ua};var yb=function(){sa=$("<div>");var ua=new da;ua.setText(eb.get("mergeEntity","\u5b9e\u4f53\u5408\u5e76"));ua.setEnabled(!1);ua=ua.getJqUi();ua.addClass("dm-entity-merge-label-title");sa.append(ua);W=new Bc(X,Aa);W.setBox(Ia,Qa);W.setGlobal(ka);W.setDesigntimeObjDataMap(ob);W.setFunOpenRelationDialog(lb);W.setFunSelectChangeCallBack(kb);sa.append(W.getJqUi());W.refresh();ya=$("<div>");ya.addClass("dm-source-db-table-selection-center");ua=new da;ua.setText(eb.get("setFieldRelation",
"\u5b57\u6bb5\u5339\u914d"));ua.setEnabled(!1);ua=ua.getJqUi();ua.addClass("dm-entity-field-match-label-title");ya.append(ua);wb=$("<div>");wb.addClass("dm-entity-field-match-label-title-field-num");ya.append(wb);$a=new uc(560);$a.setFieldSelectChangeListener(function(nb){ac(nb)});ua=$a.getJqUi();ua.addClass("dm-biz-entity-fieldmatch-table-container");ya.append(ua);ua=new wc;ua.setHorizontalSplit(!0);ua.setEnabled(!1);ua.setFirstSize(360,200,450);ua.setSecondSize(560,-1,-1);ua.setResizeMode(wc.RESIZE_MODE_FIRST_FIXED);
ua.setFirstChild(wc.createChildWrapper(sa));ua.setSecondChild(wc.createChildWrapper(ya));Aa.append(ua.getJqUi())},ac=function(ua){Ab=ua;ua=eb.get("selectedFieldNum","\u5df2\u9009\u62e9#1\u4e2a\u5b57\u6bb5");ua=ua.replace("#1",Ab);wb.text(ua)},kb=function(ua){$a.setEntityMergeModel(ua);var nb=ua.getCurrentUnionEntity();$a.setUnionEntity(nb);var pb=W.getBizUnionEntityMergeCtx();$a.setBizUnionEntityMergeCtx(pb);nb=pb.getEntityCompareModel(nb.getName());$a.setUnionEntityCompareModel(nb);$a.loadData();
ua.setPropertyMapModels($a.getPropertyMapModels());ua=$a.getSelectedFieldNum();ac(ua)};this.refreshContent=function(){W.selectRow(0)};this.initUi=function(ua,nb,pb){Ia=nb;Qa=nb.cloneMe();X=Qa.getEntityByName(ua);ob=pb;Ja.setTitle(eb.get("modifyMergedTable","\u4fee\u6539\u5408\u5e76\u72b6\u6001"));Y.setSize(960,540);Ja.setContentPaneCreator(function(){yb();return Aa});Ja.setClosingAction(Sa);Ja.setClosingChecker(Jb,!0)};var Jb=function(ua){var nb=W.getRootEntityMergeRow(),pb=nb.getColSize(),Bb=[];
nb.makeFlat(Bb);ja(Bb,0,pb,ua)},ja=function(ua,nb,pb,Bb){if(nb>=ua.length)Bb(!0);else{for(var Yb=ua[nb],dc=0;dc<pb;dc++){var Pc=Yb.getEntityCellNode(dc).getErrorDesc();if(Pc){Ja.getMessageCurtain().showPrompt(Pc);Bb(!1);return}}if(Pc=Yb.getPropMapModels()){for(var cd in Pc)if(dc=Pc[cd].getUnAcceptedError()){Ja.getMessageCurtain().showPrompt(dc.getErrorDesc());Bb(!1);return}ia.isAllPropNotSelected(Pc)?(Pc=eb.get("allPropNotSelectErrorCurtain",'\u6570\u636e\u8868"#1"\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b57\u6bb5\u3002'),
Yb=Yb.getFirstNotEmptyNode().getEntity(),Yb=Pc.replace("#1",Yb.getAlias()),Ja.getMessageCurtain().showPrompt(Yb),Bb(!1)):(Yb=ia.getSelectedFieldNum(Pc),tb.checkFieldNum(Yb,Ja.getMessageCurtain(),function(Wc){Wc?ja(ua,nb+1,pb,Bb):Bb(!1)}))}else ja(ua,nb+1,pb,Bb)}},gb=function(ua,nb){if((ua=ua.getFilters())&&0<ua.length){var pb={};nb.getProperties().forEach(function(Pc){pb[Pc.getName()]=Pc});for(var Bb in ua){var Yb=ua[Bb],dc=Yb.getProperty();dc&&(dc=dc.getName(),(dc=pb[dc])&&Yb.setProperty(dc))}nb.setFilters(ua)}},
vb=function(ua,nb){ua.getProperties().forEach(function(pb){pb.isCalculatingField()&&!pb.isHideInDataModeling()&&nb.getProperties().push(pb)})},rb=function(ua){for(var nb=ua.getCurrentUnionEntity(),pb=0;pb<ua.getColSize();pb++){var Bb=ua.getEntityCellNode(pb).getEntity();Bb&&nb.getEntityChild(Bb.getName()).setUnionLocation(Bb.getUnionLocation())}},Zb=function(ua,nb){W.getRootEntityMergeRow().deepVisitRow(function(pb){var Bb=pb.getParentRowModel(),Yb=pb.getOriginalUnionEntity(),dc=bb(pb);Yb?(ua.addEntityExchanger(Yb,
dc),gb(Yb,dc),vb(Yb,dc)):nb.push(dc);Yb=null!=pb.getParentRowModel();if(0<pb.getChildrenRows().length){a:{var Pc=W.getBizUnionEntityMergeCtx(),cd=dc.getChildren();for(Vc in cd){var Wc=Pc.getEntityRelationProperties(cd[Vc].getName(),ub.UNION_ENTITY_UNIT)[0];if(Wc){var Vc=dc.findProperty(Wc.getRelatedBaseProp());Vc=ia.createSpecialCalcProp4Relation(dc,Vc);break a}}Vc=null}Vc&&(dc.getProperties().push(Vc),pb.setRelationFromProp(Vc))}if(Yb){a:{Yb=W.getBizUnionEntityMergeCtx();Vc=dc.getChildren();for(dd in Vc)if(Pc=
Yb.getEntityRelationProperties(Vc[dd].getName(),ub.UNION_ENTITY_UNIT)[1]){var dd=dc.findProperty(Pc.getRelatedBaseProp());dd=ia.createSpecialCalcProp4Relation(dc,dd);break a}dd=null}dd&&(dc.getProperties().push(dd),pb.setRelationToProp(dd))}dc.setUnionType(Cc.BIZ_UNION);pb.setFinalUnionEntity(dc);Bb&&dc.setParentEntity(Bb.getFinalUnionEntity())})},bc=function(ua){ua=ua.getPropMapModels();var nb={};ua&&ua.forEach(function(pb){var Bb=pb.findFirstNotNullPropCell();Bb&&!pb.isSelected()&&(pb=Bb.getProperty(),
nb[pb.getName()]=pb)});return nb},fc=function(ua){var nb=W.getRemovedUnionEntity();Ta(nb);nb=ua.getOriginalUnionEntity();var pb=W.getBizUnionInnerEntityRelations();pb=pb?pb.getRelations():[];ua.makeFlat([]);var Bb=new Kc;ua.deepVisitRow(function(Yb){var dc=bc(Yb),Pc=Yb.getOriginalUnionEntity();Yb=Yb.getEntityCellNode(0).getEntity();var cd={},Wc=[];Yb.getProperties().forEach(function(Vc){Vc.getName()==Ec.CUSTOM_BIZ_ENTITY_NAME_FIELD||Vc.isCalculatingField()&&Vc.isHideInDataModeling()||dc[Vc.getName()]||
(Vc.getRelatedBaseProp(),Vc.setRelatedBaseProp(null),Wc.push(Vc),cd[Vc.getName()]=Vc)});Pc&&(Pc.getProperties().forEach(function(Vc){Vc.isCalculatingField()&&!Vc.isHideInDataModeling()&&Wc.push(Vc)}),Yb.setFilters(Pc.getFilters()));Yb.setProperties(Wc,cd);Yb.setUnionUnit(!1);Bb.addEntityExchanger(Pc,Yb)});Ia.replaceEntity(Bb,!0);ua=Bb.getNewAddedEntities();0<ua.length&&Ia.batchInsertEntity(ua);Ia.removeBizUnionInnerEntityRelations(nb.getName());pb.forEach(function(Yb){Ia.addRelation(Yb)})},Tc=function(){var ua=
W.getBizUnionInnerEntityRelations();ua&&(0==ua.getRelations().length?Ia.removeBizUnionInnerEntityRelations(ua.getRootUnionEntityName()):Ia.replaceOrAddUnionInnerEntityRelation(ua))},Sa=function(ua){if(ua){ua=W.getRootEntityMergeRow();var nb=!1;ua.deepVisitRow(function(Yb){Yb.isNeedRebuildUnion()&&(nb=!0)});if(nb){var pb=W.getBizUnionInnerEntityRelations().getRelations();if(Fb(pb))return ua=eb.get("relationDiffTips1",'\u4e1a\u52a1\u5b9e\u4f53"#1"\u4e2d\uff0c \u5b58\u5728\u6570\u636e\u8868\u67092\u4e2a\u53ca\u4ee5\u4e0a\u5b57\u6bb5\u4e0e\u5176\u4ed6\u6570\u636e\u8868\u521b\u5efa\u5173\u7cfb\uff0c\u8bf7\u53d6\u6d88\u52fe\u9009\u4e0d\u6ee1\u8db3\u5408\u5e76\u6761\u4ef6\u7684\u6570\u636e\u8868\u3002').replace("#1",
ua.getOriginalUnionEntity().getAlias()),Ua(ua),"relationDiff";if(1==ua.getColSize())fc(ua);else{pb=[];var Bb=W.getRemovedUnionEntity();Ta(Bb);Bb=new Kc;Zb(Bb,pb);Ia.replaceEntity(Bb,!1);0<pb.length&&Ia.batchInsertEntity(pb);Tc();ra();Ia.fireEntityRefresh(ua.getOriginalUnionEntity().getName())}}}},Fb=function(ua){for(var nb={},pb=!1,Bb=0;Bb<ua.length;Bb++){var Yb=ua[Bb],dc=Yb.getFromEntity().getName(),Pc=Yb.getFromProperty().getName();if(nb[dc]&&nb[dc]!=Pc&&Yb.isInnerRelation()){pb=!0;break}else nb[dc]=
Pc}return pb},Ua=function(ua){var nb=com.kingdee.bos.qing.ui.component.MessageDialog,pb=nb.createFeedbackDialog();pb.setOptionType(nb.OPTION_OK);pb.setMsgImageType(nb.MSG_WARNING);pb.setButtonText(nb.OPTION_OK,eb.get("iknow","\u6211\u77e5\u9053\u4e86"));pb.setMessage(ua);pb.setExtendPainter(function(Bb,Yb){var dc=$("<div class='sa-ctrl-feedback-dialog-text'>"),Pc=$("<span>");Pc.text(Yb);Pc.appendTo(dc);Yb=$("<a onclick='javascript:window.open(\"https://q.kdcloud.com/support/index.html?version=1.0&docId=Tvqwnwaig\");' href='#'>");
Yb.css({cursor:"pointer",color:"#5582f3"});Yb.text(eb.get("viewDocument","\u67e5\u770b\u5e2e\u52a9\u6587\u6863"));Yb.appendTo(dc);dc.appendTo(Bb)});pb.showDialog()},Ta=function(ua){ua.forEach(function(nb){Ia.removeEntityByName(nb.getName())})},ra=function(){var ua=W.getBizUnionEntityMergeCtx();W.getRootEntityMergeRow().deepVisitRow(function(nb){var pb=nb.getParentRowModel();if(pb){for(var Bb=pb.getInnerRelationProps()[0],Yb=nb.getInnerRelationProps()[1],dc,Pc=0;Pc<nb.getColSize();Pc++){var cd=nb.getEntityCellNode(Pc).getEntity();
if(cd&&(dc=ua.getInnerRelationByToEntityName(cd.getName())))break}dc&&(dc=dc.clone(),dc.setFromEntity(pb.getFinalUnionEntity()),dc.setToEntity(nb.getFinalUnionEntity()),dc.setFromProperty(Bb),dc.setToProperty(Yb),pb=pb.getOriginalUnionEntity(),nb=nb.getOriginalUnionEntity(),pb&&nb&&Ia.removeInnerRelationByFromAndToEntityName(pb.getName(),nb.getName()),Ia.addRelation(dc))}})},bb=function(ua){var nb=ua.getCurrentUnionEntity(),pb=ua.getPropMapModels();if(!pb){var Bb=[];nb.getProperties().forEach(function(e){e.isCalculatingField()||
Bb.push(e)});nb.setProperties(Bb);return nb}var Yb=nb.getChildren()[0];nb.setName(Yb.getName());nb.setAlias(Yb.getAlias());Yb=[];var dc={},Pc={},cd=nb.getChildren(),Wc=cd.length;cd.forEach(function(e,h){Pc[h]=[]});for(var Vc=[],dd=0;dd<pb.length;dd++){var rd=pb[dd];if(rd.isSelected()){var la=rd.getBaseFieldProp();Pa(la,dc);dc[la.getName()]=la;Yb.push(la);for(var Z=0;Z<Wc;Z++){var ta=rd.getFieldPropByIndex(Z);ta&&(ta.setRelatedBaseProp(la.getName()),Pc[Z].push(ta))}Oa(Vc,rd,cd)}}for(dd=0;dd<Wc;dd++)cd[dd].setProperties(Pc[dd]);
nb.setTreeRootProps(Vc);nb.setProperties(Yb);rb(ua);return nb},Oa=function(ua,nb,pb){var Bb=nb.getBaseFieldProp();if(0<=Bb.getTreeType()){var Yb=nb.findFirstNotNullPropCell();if(Yb){var dc=pb[Yb.getIndex()].getTreeRootProp(Yb.getProperty());if(dc){Bb=dc.cloneMe(Bb);var Pc=nb.getPropCellSize();for(Yb=Yb.getIndex()+1;Yb<Pc;Yb++)(dc=nb.getPropCell(Yb).getProperty())&&(dc=pb[Yb].getTreeRootProp(dc))&&Bb.mergeFrom(dc);ua.push(Bb)}}}},Pa=function(ua,nb){for(var pb=ua.getName(),Bb=1,Yb=!1,dc=-1;nb[pb];)pb=
ua.getName()+"_"+Bb,dc=Bb,Bb++,Yb=!0;Yb&&(ua.setName(pb),ua.setAlias(ua.getAlias()+"_"+dc))}};Da.DataFieldRelationSetStep=Kb;Da.DbSelectTable4MergeStep=ma;Da.DBMergeCustomSqlStep=vc;var oa,Ya,eb,Wa,ea,da,zb,U,wc,zc,Gc,ad,lc,yc,Sc,Cc=Da.UnionEntity,kd=Da.Entity,ed=Da.Box,Ec=Da.Property,l=Da.TreeProperty,B=Da.DBSource,J=Da.IconUtil,v=Da.PropDataTypeUtil,F=Da.Relation,T=Da.BizUnionInnerEntityRelations,I=Da.EntityMergeModel,S=Da.EntityCellNode,cb=Da.PropRelationMapModel,ub=Da.BizEntityMergeCtx,Ea=Da.SingleEntityCompareModel,
qb=Da.UnionEntityCompareModel,xc=Da.RowNum,Hc=Da.PropertyMapError,Nc=Da.EntitySourceChangeSqlModel,Za=Da.DesigntimeDataObject,ec=Da.DbSelectFieldStep,Db=Da.SourceTypeStep,n=Da.DbSelectTableStep,V=Da.DbConnectionStep,Ga=Da.FileConnectionStep,ha=Da.DbCustomSqlStep,ib=Da.DBStoredProcedureStep,p=Da.MetaDBConnectionStep,ic=Da.SuperQueryConnectionStep,sc=Da.AbstractImportEntityStep,hb=Da.OpenAPIConnectionStep,hd=Da.TableAndFieldSelectDialog,ba=Da.ChoosePropertyPane,Ra=Da.Icons,Sb;Da.MergeEntityUtil=new function(){this.isDataTypeConvertable=
function(Y,Ja){switch(Ja){case Ec.DT_STRING:return!0;case Ec.DT_INT:case Ec.DT_NUMBER:return Y==Ec.DT_INT||Y==Ec.DT_NUMBER;case Ec.DT_DATE:case Ec.DT_DATETIME:return Y==Ec.DT_DATE||Y==Ec.DT_DATETIME;case Ec.DT_BOOLEAN:return Y==Ec.DT_BOOLEAN}return!1};this.isPropEnumValueConsistent=function(Y,Ja){Y=Y.getEnumValue();Ja=Ja.getEnumValue();if(!Y&&!Ja)return!0;if(!Y&&Ja||Y&&!Ja||Object.keys(Ja).length!=Object.keys(Y).length)return!1;for(var W in Ja){var X=Ja[W],ia=Y[W];if(!ia||ia!=X)return!1}return!0}};
var Ub=Da.MergeEntityUtil,Gb=Da.EntityErrorStatesUtil,tb=Da.CheckFieldNumUtil;(function(){var Y=com.kingdee.bos.qing.common;oa=Y.DomUtil;Ya=Y.Base32Util;Y=com.kingdee.bos.qing.framework.common;eb=Y.MultilanguageManager.createPackageAccessor(Da);Sb=Y.GlobalFont;Y=com.kingdee.bos.qing.ui.component;Wa=Y.WizardDialog;ea=Y.RadioButton;da=Y.Label;zb=Y.ComboBox;U=Y.CheckBox;lc=Y.DropdownSelector;wc=Y.SplitPane;zc=Y.Menu;Gc=Y.MenuModel;ad=Y.AbstractModalDialog;Y=com.kingdee.bos.qing.common.ui;yc=Y.TableUtil;
Sc=Y.CommonIconUtil})()})();(function(){function Ha(){var la=!1,Z=!1;this.setError=function(ta){la=ta};this.isError=function(){return la};this.setTooModern=function(ta){Z=ta};this.isTooModern=function(){return Z}}function Kb(la,Z){this.getMessageCurtain=function(){return Z.getGlobal().getMessageCurtain()};this.insertToolbarButton=function(ta,e,h,g){return la.addButtonForHeadCustom(ta,e,h,g)};this.appendToolbarButton=function(ta,e,h,g){return la.addButtonForTailCustom(ta,e,h,g)};this.insertToolbarSeperator=function(){la.addSeperatorForHeadCustom()};
this.insertToolbarMenu=function(ta,e,h,g){return la.addMenuButtonForHeadCustom(function(){return ta},e,h,g)};this.appendToolbarMenu=function(ta,e,h,g){return la.addMenuButtonForTailCustom(function(){return ta},e,h,g)};this.setDirtyListener=function(ta){Z.hookDirtyListener(ta)};this.clearDirty=function(){Z.setDirty(!1)};this.isDirty=function(){return Z.isDirty()}}function jc(){var la,Z=$("<div>"),ta=$("<div>"),e=$("<div>");this.getJqUi=function(){la||(la=$("<div>"),la.addClass("dm-toolbar"),Z.addClass("dm-toolbar-sub"),
Z.appendTo(la),ta.addClass("dm-toolbar-sub"),ta.appendTo(la),e.addClass("dm-toolbar-sub"),e.appendTo(la));return la};this.addSeperator=function(){h(ta)};this.addSeperatorForHeadCustom=function(){h(Z)};this.addButton=function(c,k,d,f){return g(ta,!1,c,k,d,f)};this.addButtonForHeadCustom=function(c,k,d,f){return g(Z,!1,c,k,d,f)};this.addButtonForTailCustom=function(c,k,d,f){return g(e,!1,c,k,d,f)};this.addMenuButton=function(c,k,d,f){return g(ta,!0,c,k,d,f)};this.addMenuButtonForHeadCustom=function(c,
k,d,f){return g(Z,!0,c,k,d,f)};this.addMenuButtonForTailCustom=function(c,k,d,f){return g(e,!0,c,k,d,f)};var h=function(c){var k=$("<div>");k.addClass("dm-toolbar-seperator");k.appendTo(c)},g=function(c,k,d,f,b,r){var m=new ad;m.setIconSetter(function(t,A){rb.background(t,A)});m.setIconName(f);m.setText(b);m.setTooltips(null!=r?r:b);k&&m.setShowDropdownArrow(!0);m.addActionListener(function(t,A){k?a(t.getJqUi(),A,d,c):d(t)});m.getJqUi().appendTo(c);return m},a=function(c,k,d,f){var b=c.data("menu");
if(b&&b.isShowing())c.data("menu",null),b.hide();else{b=new Sc;b.setModel(d());b.setHideListener(function(){c.data("menu",null)});c.data("menu",b);d=null==f?ta:f;f=c.prop("offsetLeft");var r=c.prop("offsetHeight")+c.prop("offsetTop");b.show(d,f,r,k,!0)}}}function Cb(){lc.AbstractTabPane.call(this);var la=this,Z,ta,e,h;this.setTitle=function(g){Z=g};this.getTitle=function(){return Z};this.setGlobalDependence=function(g){ta=g};this.getGlobalDependence=function(){return ta};this.setDmModel=function(g){e&&
e.removeChangedListener(la.protectedModelChanged);e=g;h&&la.protectedUpdateUi(e);e&&e.addChangedListener(la.protectedModelChanged)};this.getDmModel=function(){return e};this.getJqUi=function(){h||(h=$("<div>"),la.protectedInit(h),e&&la.protectedUpdateUi(e));return h};this.resize=function(){};this.protectedInit=function(g){throw Error("Override me.");};this.protectedUpdateUi=function(g){throw Error("Override me.");};this.protectedModelChanged=function(g,a){}}function oc(){function la(O){KTDefaultCellRender.call(this,
O);var pa=this,va,Fa,Va,sb,Pb=this.paintCellUI;this.paintCellUI=function(mc,kc){if(va==pa.getCurrentRowIdx()&&Fa==pa.getCurrentColIdx()){var qc=pa.getCurrentRow(),Jc=new KTStyle;Jc.setBackgroundColor(com.kingdee.bos.qing.common.CommonTableSkin.ODD_ROW_BACKGROUND_COLOR);qc.setStyle(Jc);Jc=new KTStyle;Jc.setTextAlign("left");qc.getCell(Fa).setStyle(Jc);mc.style.zIndex=2;mc.style.overflow="visible";qc=$("<span class='dm-preview-row-tips'>");qc.text(Va);qc.appendTo(mc);if((qc=Z.getDmModel().getEntityByName(c))&&
(qc instanceof Ub&&qc.supportRefreshEntity(qc)||!(qc instanceof Ub)&&qc.getSource()&&qc.getSource().supportRefreshEntity())){var Fc=$("<span class='dm-preview-row-tips-refresh'>");Fc.text(U.get("refreshEntity","\u5237\u65b0\u6570\u636e"));Fc.css("display","none");Fc.appendTo(mc);Fc.on("click",function(Mc){Mc=Z.getDmModel().getEntityByName(c);vd(Mc.getName());yd()});sb?(qc=(qc=x[qc.getName()])?(new Date).getTime()-qc:0,setTimeout(function(){Fc.css("display","")},Math.max(1E4-qc,0))):Fc.css("display",
"")}}Pb(mc,kc)};this.setTipsParams=function(mc,kc,qc,Jc){va=mc;Fa=kc;Va=qc;sb=Jc}}Cb.call(this);var Z=this,ta=/^[\s\u3000\u4E00-\u9FA5a-zA-Z0-9_]+$/,e,h,g,a,c,k,d,f,b,r=[],m=null,t=!1,A=0,E,M=!1,z={},H={},x={},q={};this.createToolbarButtons=function(O){return[O.addButton(jd,"btn_add-entity",U.get("createEntity","\u65b0\u5efa\u6570\u636e\u8868"))]};this.createToolbarViewSysVarButton=function(O){E=O.addButton(D,"btn_view-sysvar",U.get("viewSystemVariable","\u67e5\u770b\u7cfb\u7edf\u53d8\u91cf"));return[E]};
var D=function(){if(0<r.length){var O=new tc;O.setArrSystemVar(r);O.showDialog()}else E.setEnabled(!1),O=Z.getGlobalDependence().createFacade(function(pa){if(pa)for(var va in pa){var Fa=new ja;Fa.setName(va);Fa.setValue(pa[va]);r.push(Fa)}pa=new tc;pa.setArrSystemVar(r);pa.showDialog();E.setEnabled(!0)}),O.setShowBlocking(!1),O.getPreviewDataSysVars()};this.protectedInit=function(O){a=$("<div>");a.addClass("dm-entity-list");k=ha.createTable();var pa=new la(k);pa.setEllipsis(!0);k.setCellRender(pa);
pa=$(k.getUI());pa.addClass("dm-entity-datapreview");d=new uc;d.setTitle(U.get("field","\u5b57\u6bb5"));d.setGlobalDependence(Z.getGlobalDependence());d.setPreviewRefreshRequestListener(wd);d.setValidNameChecker(sd);d.setCustomFieldHandler(Oc);d.setFieldAliasEditListener(td);f=new $b;f.setTitle(U.get("filter","\u8fc7\u6ee4"));f.setGlobalDependence(Z.getGlobalDependence());f.setPreviewRefreshRequestListener(wd);g=new lc;g.setTabLevel(lc.SECOND_LEVEL);g.addTab(d,!0);g.addTab(f);var va=g.getJqUi();va.addClass("dm-entity-setting");
b=new Wb;b.setTitle(U.get("sqlParse","SQL\u89e3\u6790"));b.setGlobalDependence(Z.getGlobalDependence());b.setPreviewRefreshRequestListener(wd);h=new yc;h.setHorizontalSplit(!1);h.setFirstSize(240,0,-1);h.setSecondSize(-1,0,-1);h.setFirstChild(yc.createChildWrapper(pa,function(){k.relayoutViews()}));h.setSecondChild(yc.createChildWrapper(va,function(){g.getCurrentTabPane().afterResize()}));h.getJqUi().addClass("dm-entity-rightside");e=new yc;e.setHorizontalSplit(!0);e.setFirstSize(260,100,600);e.setSecondSize(-1,
400,-1);e.setFirstChild(yc.createChildWrapper(a));e.setSecondChild(h);pa=e.getJqUi();pa.addClass("dm-tab-pane");pa.appendTo(O)};this.protectedUpdateUi=function(O){P(null);for(var pa=$(document.createDocumentFragment()),va=0,Fa=O.getEntityCount();va<Fa;va++){var Va=O.getEntityByIndex(va),sb=pa,Pb=sb.append,mc=void 0,kc=Va;Va=$("<div>");Va.addClass("dm-entity-list-item");var qc=kc.getName();Va.attr("datamodeling-name",Wa.encode(qc));Va.on("mousedown",jb);Va.on("mouseenter",Qb);Va.on("mouseleave",za);
kc.isSubNodeAtView()&&(qc=kc.getSubNodeLevel(),Va.css("margin-left",20*qc));qc=$("<div>");qc.addClass("dm-entity-list-item-icon");var Jc=Yb.entity2IconName(kc);rb.background(qc,Jc);Jc=$("<div>");Jc.addClass("dm-entity-list-item-text");Jc.text(kc.getAlias());a:{var Fc=kc,Mc=Jc;if(!Fc.isUnion()){var gd=Fc.getSource();if(gd.isUserSql(Fc.getName())||gd.isStoredProcedure(Fc.getName()))break a}Fc.getTitle()?(Fc=Fc.getTitle(),Mc.attr("title",Fc)):Fc.isUnion()?Mc.attr("title",Fc.getAlias()):ca(Fc,Mc)}Mc=
$("<div>");Mc.addClass("dm-entity-list-item-menu");rb.background(Mc,"menu");Mc.on("click",Na);kc.isErrorExist()&&(mc=ib.createWarning(),mc.addClass("dm-entity-list-item-notexist"),kc=dd.getDefaultErrorDescForTips(kc),mc.attr("title",kc),Jc.addClass("dm-entity-list-item-text-with-warning"),qc.addClass("dm-entity-list-item-icon-with-warning"));mc&&Va.append(mc);Va.append(qc);Va.append(Jc);Va.append(Mc);Pb.call(sb,Va)}a.empty();a.append(pa);a.find(".dm-entity-list-nodataprompt").remove();0==Z.getDmModel().getEntityCount()&&
(O=$("<div>"),O.text(U.get("noEntity","\u672a\u521b\u5efa\u6570\u636e\u8868")),O.addClass("dm-entity-list-nodataprompt"),a.append(O))};this.setDataSourceDisabled=function(O){M=O};this.protectedModelChanged=function(O,pa){if(O==Ra.KEY_ADD_ENTITIES){Z.protectedUpdateUi(Z.getDmModel());pa=pa[0];O=pa.getParentEntity();for(pa=pa.getName();O;)pa=O.getName(),O=O.getParentEntity();P(pa);G()}else if(O==Ra.KEY_REFRESH_ENTITY){Z.protectedUpdateUi(Z.getDmModel());O=Z.getDmModel().getEntityWithSubNodes(pa);for(var va=
0;va<O.length;va++){var Fa=O[va].getName();delete z[Fa]}O=pa.getParentEntity();for(pa=pa.getName();O;)pa=O.getName(),O=O.getParentEntity();P(pa);G()}else O==Ra.KEY_REMOVE_ENTITY?(Z.protectedUpdateUi(Z.getDmModel()),P(null),G()):O==Sb.KEY_CHANGE_SOURCE&&G()};this.into=function(){e.resize()};this.resize=function(){e.resize()};this.locateToFilterPane=function(O,pa,va){P(O);g.setCurrentTabPane(f);f.locateToErrorRow(pa,va)};var G=function(){Z.getGlobalDependence().setDirty(!0)},ca=function(O,pa){var va=
Z.getGlobalDependence().createFacade(function(Fa){pa.attr("title",Fa)},function(Fa,Va,sb){return null});va.setShowBlocking(!1);va.getEntityTitle(O)},y=function(O){return a.find("[datamodeling-name='"+Wa.encode(O)+"']")},P=function(O,pa){c&&aa(!1);(c=O)&&aa(!0);Dd();(O=Z.getDmModel().getEntityByName(c))?(Xc(null),Ed(),Tb(O,pa),Nb(O)):(Tb(null),Nb(null))},aa=function(O,pa){pa||(pa=c);var va=Z.getDmModel().getEntityByName(pa),Fa=va?!1:!0,Va=va?Yb.entity2IconName(va):null,sb=y(pa),Pb=sb.find(".dm-entity-list-item-icon"),
mc=sb.find(".dm-entity-list-item-notexist"),kc=sb.find(".dm-entity-list-item-menu"),qc=sb.find(".dm-entity-list-item-text");O&&!Fa?(O=va.getErrorState(),0==mc.length&&O&&(O=ib.createWarning(),O.addClass("dm-entity-list-item-notexist"),Fa=(Fa=va.getErrorDesc())?Fa:dd.getDefaultErrorDescForTips(va),va.isUnion()||va.getSource().isBasedOnDB()&&(Fa=U.get("dbTableExecuteError","\u6570\u636e\u8868\u6267\u884c\u5f02\u5e38")),O.attr("title",Fa),qc.addClass("dm-entity-list-item-text-with-warning"),Pb.addClass("dm-entity-list-item-icon-with-warning"),
O.insertBefore(Pb)),0<mc.length&&!va.isErrorExist()&&(mc.remove(),qc.removeClass("dm-entity-list-item-text-with-warning"),Pb.removeClass("dm-entity-list-item-icon-with-warning")),pa===c&&(sb.addClass("dm-entity-list-item_selected"),rb.background(Pb,Va+"_selected")),rb.background(kc,"menu_selected")):Fa||(sb.removeClass("dm-entity-list-item_selected"),rb.background(Pb,Va),rb.background(kc,"menu"))},jb=function(O){O=$(O.currentTarget);O=Wa.decode(O.attr("datamodeling-name"));c!=O&&P(O,!0)},Qb=function(O){$(O.currentTarget).find(".dm-entity-list-item-menu").css("display",
"block")},za=function(O){$(O.currentTarget).find(".dm-entity-list-item-menu").css("display","none")},Na=function(O){var pa=$(O.currentTarget);O=pa.parent();var va=Wa.decode(O.attr("datamodeling-name"));if((O=pa.data("menu"))&&O.isShowing())pa.data("menu",null),O.hide();else{O=new Sc;O.setModel(Ca(va));O.setIconSetter(function(sb,Pb){rb.background(sb,Pb)});O.setHideListener(function(){pa.data("menu",null)});pa.data("menu",O);va=pa.outerHeight();var Fa=Z.getGlobalDependence().getTopJqUi(),Va=[0,va];
Va=Ya.upwardCoordinate(pa[0],Va,Fa[0]);O.show(Fa,Va[0],Va[1],pa,!0,[0,-va])}},wa=function(){var O=Z.getDmModel(),pa=O.getEntityByName(c),va=pa.getChildren()[0].getSource(),Fa={};Fa[va.getName()]=va;var Va=Z.getGlobalDependence().createFacade(function(Pb){for(var mc={},kc=0;kc<Pb.length;kc++){var qc=Pb[kc],Jc=new wb;Jc.fromJsonObject(qc,Fa);mc[Jc.getFisrtEntity().getAssociateName()]=Jc}Pb=new Oa;Pb.setGlobalDependence(Z.getGlobalDependence());Pb.setOpenInnerRelationDialog(function(Fc,Mc,gd){var od=
new Xa;od.prepare(Fc,Mc,gd);od.showDialog()});Pb.initUi(c,O,mc);Pb.showDialog();Pb.refreshContent()}),sb=[];sb.push(va.toJsonObject());Va.setBlockingJqUi(Z.getJqUi());Va.setShowBlocking(!0);Va.getUnionDesigntimeDataObject([pa.toJsonObject()],sb,!0)},Ca=function(O){O=Z.getDmModel().getEntityByName(O);if(O instanceof Ub){var pa=new Cc;if(!O.isSubNodeAtView()){var va=O.getUnionType(),Fa=u(U.get("mergeDataSource","\u5408\u5e76\u6570\u636e\u8868..."),fa,!0);pa.addItemModel(Fa);va=va==Ub.BIZ_UNION?wa:C;
va=u(U.get("modifyMergedDataSource","\u4fee\u6539\u5408\u5e76\u72b6\u6001..."),va,!0);pa.addItemModel(va)}pa.addSeperator();Fa=u(U.get("renameEntity","\u91cd\u547d\u540d"),qd,!0);va=u(U.get("addCustomField","\u65b0\u5efa\u8ba1\u7b97\u5b57\u6bb5"),Yc);pa.addItemModel(Fa);O.isSupportColumnToRow()&&(Fa=O.getColumnToRowProperties(),Fa=null!=Fa&&0<Fa.length?U.get("modifyColumnToRow","\u4fee\u6539\u5217\u8f6c\u884c"):U.get("columnToRow","\u5217\u8f6c\u884c"),Fa=u(Fa,Ac),pa.addItemModel(Fa));pa.addItemModel(va);
O.getUnionType()==Ub.BIZ_UNION&&!O.isSubNodeAtView()&&na(O)&&(pa.addSeperator(),O=u(U.get("editInnerRelation","\u7f16\u8f91\u5185\u90e8\u5173\u7cfb"),Zc),pa.addItemModel(O));pa.addSeperator();O=u(U.get("deleteEntity","\u5220\u9664"),pd,!0,"delete");pa.addItemModel(O);return pa}Fa=new Cc;var Va=O.getSource();if(Va.isUserSql(O.getName())){var sb=O.getName();sb=Va.getUserSql(sb).getSqlType();sb=U.get("editSql","\u7f16\u8f91")+sb;sb=u(sb,xa)}else Va.isStoredProcedure(O.getName())&&Va.supportStoredProcedure&&
Va.supportStoredProcedure()&&(sb=U.get("editStoredProcedure","\u7f16\u8f91\u5b58\u50a8\u8fc7\u7a0b"),sb=u(sb,Ka));"ERPCloudEntity"===Va.getTypeName()?pa=O===O.getTopParentEntity()?u(U.get("tableAndFieldSelect","\u9009\u62e9\u6570\u636e\u8868\u53ca\u5b57\u6bb5"),Ma):u(U.get("fieldSelect","\u9009\u62e9\u5b57\u6bb5"),qa):Va.isSupportSelectField()&&(pa=u(U.get("fieldSelect","\u9009\u62e9\u5b57\u6bb5"),qa));Va.isSupportCustomField(O.getName())&&(va=u(U.get("addCustomField","\u65b0\u5efa\u8ba1\u7b97\u5b57\u6bb5"),
Yc));var Pb=O.getColumnToRowProperties();Pb=null!=Pb&&0<Pb.length;if(Va.isSupportColumnToRow()){var mc=Pb?U.get("modifyColumnToRow","\u4fee\u6539\u5217\u8f6c\u884c"):U.get("columnToRow","\u5217\u8f6c\u884c");mc=u(mc,Ac)}Pb=u(U.get("editInnerRelation","\u7f16\u8f91\u5185\u90e8\u5173\u7cfb"),Zc);var kc=u(U.get("renameEntity","\u91cd\u547d\u540d"),qd,!0),qc=null,Jc=O.isSubNodeAtView();Va.supportMergeTable()&&!Jc&&(qc=u(U.get("mergeDataSource","\u5408\u5e76\u6570\u636e\u8868..."),fa,!0));var Fc=u(U.get("deleteEntity",
"\u5220\u9664"),pd,!0,"delete");Jc?(Fa.addItemModel(kc),sb&&Fa.addItemModel(sb),pa&&Fa.addItemModel(pa),mc&&Fa.addItemModel(mc),va&&Fa.addItemModel(va)):(Va.isModifiable()&&(Jc=u(U.get("modifyConnection","\u6570\u636e\u6e90..."),Ic),Fa.addItemModel(Jc)),Va.isShowChangeSourceTypeButtonInMenu()&&(Va=u(U.get("changeDataSource","\u66f4\u6362\u6570\u636e\u6e90"),db),Fa.addItemModel(Va)),qc&&Fa.addItemModel(qc),Fa.addSeperator(),Fa.addItemModel(kc),sb&&Fa.addItemModel(sb),pa&&Fa.addItemModel(pa),mc&&Fa.addItemModel(mc),
va&&Fa.addItemModel(va),na(O)&&(Fa.addSeperator(),Fa.addItemModel(Pb)));Fa.addSeperator();Fa.addItemModel(Fc);return Fa},db=function(O){var pa=Z.getDmModel(),va=pa.getEntityByName(c),Fa=Z.getGlobalDependence();O=new fc;O.setChangeSourceType(!0);O.setDModel(pa);O.setOldEntity(va);O.setFacadeCreator(Fa.createFacade);O.setEntityExistChecker(ud,Ba);O.setFinishedCallback(function(Va){Va&&Va!==c?(vd(Va),aa(!0,Va)):P(c)});O.setDataSourceDisabled(M);pa=new J;pa.setTitle(U.get("changeDataSource","\u66f4\u6362\u6570\u636e\u6e90"));
pa.setSteps([O]);pa.show(960,540)},na=function(O){for(var pa=!1,va=0;va<Z.getDmModel().getEntityCount();va++){var Fa=Z.getDmModel().getEntityByIndex(va);O!=Fa&&Fa.getTopParentEntity()==O&&(pa=!0)}return pa},u=function(O,pa,va,Fa){O=Sc.createActionMenuItem(O+(va?"":"..."),pa);Fa&&O.setIconName(Fa);return O},L=function(O){var pa=[],va;for(va in O){var Fa=O[va].toJsonObject();pa.push(Fa)}return pa},C=function(){var O=Z.getDmModel(),pa=O.getEntityByName(c),va={};pa.collectSources(va);var Fa=Z.getGlobalDependence().createFacade(function(Va){var sb=
new wb;sb.fromJsonObject(Va,va);Va=new nb(pa,sb.getEntityMap());Va.compareAndSync();sb=new bb;var Pb=O.searchRelationsByEntityName(c);sb.setGlobalDependence(Z.getGlobalDependence());sb.setUnionEntity(pa);sb.setUnionEntityCompareModel(Va);sb.setRelations(Pb);sb.initUi();sb.setConfirmListener(function(mc,kc){kc.forEach(function(qc){O.removeRelation(qc)});O.refreshRelationEntity(mc);O.refreshEntity(mc)});sb.showDialog();setTimeout(sb.refresh)});Fa.setShowBlocking(!0);Fa.getUnionDesigntimeDataObject([pa.toJsonObject()],
L(va),!1)},Q=function(O,pa,va){var Fa=new Xa;Fa.prepare(O,pa,va);Fa.showDialog()},fa=function(){var O=Z.getDmModel(),pa=O.getEntityByName(c);if(pa instanceof Ub)var va=pa.getUnionType()==Ub.BIZ_UNION;else va=pa.getSource(),va=Tc.isBizSourceType(va.getTypeName())&&va.getMergeType()==Aa.BIZ_MERGE;var Fa;if(Fa=va){Fa={};for(var Va=O.getRelationCount(),sb=!1,Pb=0;Pb<Va;Pb++){var mc=O.getRelationByIndex(Pb),kc=mc.getFromEntity().getName(),qc=mc.getFromProperty().getName();if(Fa[kc]&&Fa[kc]!=qc&&mc.isInnerRelation()){sb=
!0;break}else Fa[kc]=qc}Fa=sb}Fa?(O=U.get("relationDiffTips",'\u4e1a\u52a1\u5b9e\u4f53"#1"\u4e2d\uff0c \u5b58\u5728\u6570\u636e\u8868\u67092\u4e2a\u53ca\u4ee5\u4e0a\u5b57\u6bb5\u4e0e\u5176\u4ed6\u6570\u636e\u8868\u521b\u5efa\u5173\u7cfb\uff0c\u8bf7\u5220\u9664\u4e0d\u6ee1\u8db3\u7684\u5408\u5e76\u6761\u4ef6\u7684\u6570\u636e\u8868\u3002').replace("#1",pa.getAlias()),R(O)):(va?(va=new ua,va.setGlobal(Z.getGlobalDependence()),va.setFacadeCreator(Z.getGlobalDependence().createFacade),va.setFinishedCallback(K),
va.setSelectEntity(pa),pa instanceof Ub?va.setSource(pa.getChildren()[0].getSource()):va.setSource(pa.getSource()),va.setRelationDialogOpener(Q),va.setBox(O)):(va=new ra,va.setDModel(O),va.setFacadeCreator(Z.getGlobalDependence().createFacade),va.setEntityExistChecker(ud,Ba),va.setFinishedCallback(K),va.setSelectEntity(pa),va.setDataSourceDisabled(M)),O=new J,O.setTitle(U.get("mergeDataSourceTitle","\u5408\u5e76\u6570\u636e\u8868")),O.setSteps([va]),O.show(960,540))},R=function(O){var pa=com.kingdee.bos.qing.ui.component.MessageDialog,
va=pa.createFeedbackDialog();va.setOptionType(pa.OPTION_OK);va.setMsgImageType(pa.MSG_WARNING);va.setButtonText(pa.OPTION_OK,U.get("iknow","\u6211\u77e5\u9053\u4e86"));va.setMessage(O);va.setExtendPainter(function(Fa,Va){var sb=$("<div class='sa-ctrl-feedback-dialog-text'>"),Pb=$("<span>");Pb.text(Va);Pb.appendTo(sb);Va=$("<a onclick='javascript:window.open(\"https://q.kdcloud.com/support/index.html?version=1.0&docId=Tvqwnwaig\");' href='#'>");Va.css({cursor:"pointer",color:"#5582f3"});Va.text(U.get("viewDocument",
"\u67e5\u770b\u5e2e\u52a9\u6587\u6863"));Va.appendTo(sb);sb.appendTo(Fa)});va.showDialog()},K=function(O){var pa=Z.getDmModel();pa.refreshRelationEntity(O);pa.refreshEntity(O);G();Wc.occur(Wc.DM_OPERATING_MERGE_TABLE,1)},xa=function(){for(var O=Z.getDmModel(),pa=O.getEntityByName(c),va=pa.getProperties(),Fa=[],Va=0;Va<va.length;Va++)va[Va].isCalculatingField()&&Fa.push(va[Va]);var sb=pa.getColumnToRowProperties();va=new Mb;va.setInitValue(O,pa,Z.getGlobalDependence());va.setConfirmListener(function(){y(c).find(".dm-entity-list-item-text").text(pa.getAlias());
var Pb=pa.getProperties();Pb=Pb.concat(Fa);var mc=[];mc=mc.concat(Pb);mc=N(mc,sb);w(O,pa,mc);pa.setProperties(Pb);O.getEntityByName(c).setColumnToRowProperties(sb);0!=Fa.length?nc(pa,!0,null):P(c)});va.initUi();va.showDialog()},Ka=function(){for(var O=Z.getDmModel(),pa=O.getEntityByName(c),va=pa.getProperties(),Fa=[],Va=0;Va<va.length;Va++)va[Va].isCalculatingField()&&Fa.push(va[Va]);var sb=pa.getColumnToRowProperties();va=new vc;va.setInitValue(O,pa,Z.getGlobalDependence());va.setConfirmListener(function(){y(c).find(".dm-entity-list-item-text").text(pa.getAlias());
var Pb=pa.getProperties();Pb=Pb.concat(Fa);var mc=[];mc=mc.concat(Pb);mc=N(mc,sb);w(O,pa,mc);pa.setProperties(Pb);O.getEntityByName(c).setColumnToRowProperties(sb);0!=Fa.length?nc(pa,!0,null):P(c)});va.initUiShowDialog()},w=function(O,pa,va){var Fa=O.searchRelationsByEntityName(c);if(Fa){for(var Va={},sb=0;sb<va.length;sb++)Va[va[sb].getName().toUpperCase()]=va[sb];for(sb=Fa.length-1;0<=sb;sb--){va=Fa[sb].getFromEntity();var Pb=Fa[sb].getToEntity(),mc=Fa[sb].getFromProperty(),kc=Fa[sb].getToProperty();
mc=mc.getName().toUpperCase();kc=kc.getName().toUpperCase();va==pa&&!Va[mc]||Pb==pa&&!Va[kc]?O.removeRelation(Fa[sb]):(va==pa&&Va[mc]&&Fa[sb].setFromProperty(Va[mc]),Pb==pa&&Va[kc]&&Fa[sb].setToProperty(Va[kc]))}}},N=function(O,pa){if(pa&&0<pa.length)for(var va in pa){var Fa=pa[va];if(Fa){var Va=Fa.getFieldNameProperty();Fa=Fa.getFieldValueProperties();O=O.concat(Va);O=O.concat(Fa)}}return O},qa=function(O){var pa=Z.getDmModel(),va=pa.getEntityByName(c),Fa=va.getSource();O=va.getProperties();for(var Va=
[],sb=[],Pb=0;Pb<O.length;Pb++)O[Pb].isCalculatingField()?Va.push(O[Pb]):sb.push(O[Pb]);O=va.getTopParentEntity().getAssociateName();Z.getGlobalDependence().createFacade(function(mc){var kc=new wb;kc.fromJsonObject(mc,[Fa]);var qc=kc.getEntityByAssociateName(va.getAssociateName());mc=qc.getProperties();qc.syncPropertyFrom(sb);kc=pa.getLockedPropNames(va);var Jc=new hc;Jc.setAllProperties(mc);Jc.setEntity(qc);Jc.setSelectedProperties(sb);Jc.setLockSelectedFieldNames(kc);Jc.setAllRelationPropName(pa.searchAllRelationPropNames(c));
Jc.setClosingCheckListener(function(Fc,Mc,gd){qc.setSource(Fa);rd.checkFieldNum(null!=Fc?Fc.length:0,gd,function(od){Mc(od)})});Jc.setConfirmListener(function(Fc,Mc){Fc=Fc.concat(Va);for(var gd=0;gd<Mc.length;gd++)pa.removeRelationByProperty(c,Mc[gd].getName());Mc=pa.searchRelationsByEntityName(c);for(gd=0;gd<Mc.length;gd++)for(var od=Mc[gd],zd=od.getFromProperty(),Fd=od.getToProperty(),Bd=0;Bd<Fc.length;Bd++){var xd=Fc[Bd];if(od.getFromEntity().getName()==c){if(zd.getAssociateName()==xd.getAssociateName()&&
zd!=xd){od.setFromProperty(xd);break}}else if(Fd.getAssociateName()==xd.getAssociateName()&&Fd!=xd){od.setToProperty(xd);break}}Mc=[];for(gd=0;gd<Fc.length;gd++)Fc[gd].hasChild()&&((od=va.getTreeRootProp(Fc[gd]))||(od=qc.getTreeRootProp(Fc[gd])),od&&Mc.push(od));va.setTreeRootProps(Mc);va.setProperties(Fc);0!=Va.length?nc(va,!0,null):P(c);G()});Jc.initUi();Jc.showDialog()}).getDesigntimeDataObject(Fa.toJsonObject(),O)},Ma=function(O){var pa=Z.getDmModel(),va=pa.getEntityByName(c),Fa=va.getSource();
O=va.getAssociateName();Z.getGlobalDependence().createFacade(function(Va){var sb=new wb;sb.fromJsonObject(Va,[Fa]);Va=sb.getEntities();for(var Pb=0;Pb<Va.length;Pb++)Va[Pb].setSource(Fa),q[Va[Pb].getAssociateName()]=Pb;Va=pa.getEntityWithSubNodes(va);var mc=[];Va.forEach(function(kc){mc[kc.getName()]=pa.searchAllRelationPropNames(kc.getName())});sb=new Bb(va,Va,sb,Fa);sb.setRelationPropName(mc);sb.setSelectConfirmHandler(Hb);sb.initUi();sb.showDialog()}).getDesigntimeDataObject(Fa.toJsonObject(),
O)},Hb=function(O,pa,va,Fa,Va){var sb=Z.getDmModel(),Pb=sb.getAllEntity();pa.forEach(function(mc){sb.removeEntity(mc)});va.forEach(function(mc){var kc=mc.getParentEntity(),qc=kc.getName(),Jc=Pb.indexOf(kc);kc=q[mc.getAssociateName()];var Fc=-1;for(Jc+=1;Jc<Pb.length;Jc++)if(Pb[Jc].findParentEntityByName(qc)){if(q[Pb[Jc].getAssociateName()]>kc){Fc=Jc;break}}else{Fc=Jc;break}sb.insertEntityByLocation(mc,Fc)});Va.forEach(function(mc){var kc=mc.getFromEntity().getName(),qc=mc.getToEntity().getName();
sb.isRelationExist(kc,qc)||sb.addRelation(mc)});Fa&&0>Fa.indexOf(O)&&Fa.push(O);Rb(Fa);sb.refreshEntities(Fa);sb.fireRefreshEntity(O)},Rb=function(O){var pa=[];Z.getDmModel().getAllEntity().forEach(function(va){pa[va.getAssociateName()]=va});O.forEach(function(va){var Fa=pa[va.getAssociateName()].getFilters();Fa&&0<Fa.length&&va.setFilters(Fa)})},Ic=function(O){O=Z.getDmModel();var pa=O.getEntityByName(c),va=pa.getSource(),Fa=Z.getGlobalDependence();var Va=va instanceof Ja?new Fb:va instanceof W||
va instanceof X||va instanceof ia?new Ua:va instanceof ka?new Ta:bc.createBizMetaSourceEditor(va.getTypeName());Va.setConfirmListener(function(sb){sb&&sb!==c?(vd(sb),aa(!0,sb)):P(c)});Va.edit(O,pa,va,Fa,M)},Yc=function(O){O=new Gb;O.setName("F"+(new Date).getTime());O.setAssociateName(O.getName());ld(O,!1,function(pa,va){pa.push(va);G()},function(){d.scrollToBottom()})},Ac=function(O){O=Z.getDmModel();var pa=O.getEntityByName(c);O=O.searchRelationsByEntityName(c);var va=new Xb;va.setGlobalDependence(Z.getGlobalDependence());
va.setRelationsAndEntity(O,pa);va.setConfirmListener(function(){Tb(pa);Nb(pa)});va.initUi();va.showDialog()},Zc=function(){var O=Z.getDmModel(),pa=O.getEntityByName(c),va=Z.getGlobalDependence(),Fa=new Xa;Fa.prepare(O,pa,va,!0);Fa.showDialog()},ld=function(O,pa,va,Fa){var Va=Z.getDmModel().getEntityByName(c),sb=Va.getProperties(),Pb=Va.toOutputPropertiesJsonObject(),mc=O.getDataType(),kc,qc=null,Jc=Z.getGlobalDependence().createFacade(function(Mc){var gd=Mc.ok,od=Mc.errorPosition,zd=Mc.errorPrompt;
kc=Mc.dataType;qc(gd,od,zd)});Jc.setShowBlocking(!1);var Fc=new Lb;Fc.setContext(Va.getOutputProperties(sb),O,pa);Fc.setSyntaxValidator(function(Mc,gd,od){qc=od;Jc.checkFormula(gd,Mc,Pb)});Fc.edit(function(){kc=kc?kc:Gb.DT_NUMBER;O.setDataType(kc);O.setAppointedDataType(null);kc!=mc&&Gb.confirmDefaultFormatString(O);va&&va(Va.getProperties(),O);nc(Va,!0,Fa)})},fd=function(O,pa){if(pa){O=O.getOutputProperties(O.getProperties());for(var va=0;va<O.length;va++){var Fa=O[va];if(Fa.isCalculatingField()){var Va=
pa[Fa.getName()];Fa.setCalculatingFieldInvalid(!Va.valid);Va=(Va=Va.dataType)?Va:Gb.DT_NUMBER;var sb=Fa.getDataType(),Pb=Fa.getAppointedDataType();sb!=Va&&(Fa.setDataType(Va),Gb.confirmDefaultFormatString(Fa));Pb==Va&&Fa.setAppointedDataType(null)}}}},nc=function(O,pa,va){var Fa=O.toOutputPropertiesJsonObject(function(Va){return Va.isNotExisted()});Z.getGlobalDependence().createFacade(function(Va){fd(O,Va.map);pa&&P(c);va&&va()}).checkAllFormula(Fa)},Oc=function(O,pa){var va=Z.getDmModel().getEntityByName(c),
Fa;if(Fa="recheckAll"==O)a:{Fa=va.getProperties();for(var Va=Fa.length-1;0<=Va;Va--)if(Fa[Va].isCalculatingField()){Fa=!0;break a}Fa=void 0}Fa&&nc(va,!0);if("modify"==O)ld(pa,!0);else if("delete"==O)for(O=va.getProperties(),Fa=O.length-1;0<=Fa;Fa--)if(pa==O[Fa]){O.splice(Fa,1);Fa=va;O=pa;if(Fa.isUnion())for(Fa=Fa.getChildren(),Va=0;Va<Fa.length;Va++)for(var sb=Fa[Va].getProperties(),Pb=sb.length-1;0<=Pb;Pb--)if(O.getName()==sb[Pb].getRelatedBaseProp()){sb.splice(Pb,1);break}O=va.getName();if(!pa.isCalculatingField()&&
(O=Z.getDmModel().searchRelationsByEntityName(O)))for(Fa=0;Fa<O.length;Fa++)Va=O[Fa],Va.getFromProperty().getName()==pa.getName()?Z.getDmModel().removeRelation(Va):Va.getToProperty().getName()==pa.getName()&&Z.getDmModel().removeRelation(Va);nc(va,!0);break}},jd=function(O){O=new fc;O.setDModel(Z.getDmModel());O.setFacadeCreator(Z.getGlobalDependence().createFacade);O.setEntityExistChecker(ud,Ba);O.setFinishedCallback(fb);O.setDataSourceDisabled(M);var pa=new J;pa.setTitle(U.get("createEntity","\u65b0\u5efa\u6570\u636e\u8868"));
pa.setSteps([O]);pa.show(960,540)},pd=function(O){var pa=Z.getDmModel(),va=pa.getEntityByName(c);pa.searchRelationsByEntityName(c);O=U.get("confirmDelEntity","\u5220\u9664\u6570\u636e\u8868\u201c#1\u201d\u540e\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u786e\u5b9a\u5220\u9664\u8be5\u6570\u636e\u8868\u5417\uff1f").replace("#1",va.getAlias());O=O.replace("#1",va.getAlias());var Fa=y(c).find(".dm-entity-list-item-menu");Fa.css("display","block");var Va=new Ea;Va.setText(O);Va.setConfirmedListener(function(sb){if(sb){sb=
pa.getEntityWithSubNodes(va);for(var Pb=0;Pb<sb.length;Pb++)pa.removeEntity(sb[Pb]),vd(sb[Pb].getName())}});Va.show(Fa);Fa.css("display","none")},qd=function(O){var pa=Z.getDmModel().getEntityByName(c);pa.getName();var va=pa.getAlias();O=y(c);var Fa=O.find(".dm-entity-list-item-text"),Va=new cb;Va.setText(va);var sb=Va.getJqUi();sb.css({position:"absolute",left:"0",right:"0",top:"0",height:O.height(),"z-index":"65535"});sb.appendTo(O);Va.requestFocus();var Pb=function(qc,Jc){var Fc=$.trim(Va.getText());
if(!Ba(Fc)&&sd(Fc)&&Fc!=va)pa.setAlias(Fc),Fa.text(Fc),qc=!0,G();else if(sd(Fc))Fc!=va&&(Mc=U.get("entityNameExist","\u5df2\u5b58\u5728\u6570\u636e\u8868\u540d\u79f0\uff1a"),Mc+=Fc,Jc&&(Mc+=U.get("abandonModify","\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002")),Z.getGlobalDependence().getMessageCurtain().showPrompt(Mc));else{var Mc=U.get("invalidEntityName","\u6570\u636e\u8868\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\uff0c\u4e14\u4e0d\u80fd\u5305\u542b\u7a7a\u683c\u3002");
""==Fc&&(Mc=U.get("entityNameNull","\u6570\u636e\u8868\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\u3002"));Jc&&(Mc=""==Fc?U.get("abandonModifysAndEntityNameNull","\u6570\u636e\u8868\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002"):U.get("abandonModifys","\u6570\u636e\u8868\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\uff0c\u4e14\u4e0d\u80fd\u5305\u542b\u7a7a\u683c\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002"));
Z.getGlobalDependence().getMessageCurtain().showPrompt(Mc)}Fc==va&&(qc=!0);qc&&(sb.remove(),document.body.removeEventListener("mousedown",mc,!0),document.body.removeEventListener("keydown",kc,!0))},mc=function(qc){for(qc=qc.target;qc!=document.body;){if(qc==sb[0])return;qc=qc.parentNode}Pb(!0,!0)},kc=function(qc){13==qc.keyCode&&Pb(!1,!1)};document.body.addEventListener("mousedown",mc,!0);document.body.addEventListener("keydown",kc,!0)},sd=function(O){return O&&0<O.indexOf(" ")?!1:ta.test(O)},ud=
function(O){return Z.getDmModel().isEntityNameExist(O)},Ba=function(O){return Z.getDmModel().isEntityAliasExist(O)},fb=function(O,pa){for(var va=0;va<O.length;va++){for(var Fa=O[va],Va=Fa.getProperties(),sb=0;sb<Va.length;sb++)Gb.confirmDefaultFormatString(Va[sb]);var Pb=sb=Fa.getName();for(Va=1;ud(Pb);)Pb=sb+"_"+Va++;Fa.setName(Pb);Pb=sb=Fa.getAlias();for(Va=1;Ba(Pb);)Pb=sb+"_"+Va++;Fa.setAlias(Pb)}Z.getDmModel().addEntities(O);if(pa)for(O=0;O<pa.length;O++)Z.getDmModel().addRelation(pa[O])},Nb=
function(O){d.updateUi(O);f.updateUi(O);b.updateUi(O)},Tb=function(O,pa){Xc(null);if(!O)return Cd(),!1;var va=Ed();A=va;Lc(O);if(!Rc(O))return!1;var Fa=[];O.collectJsonSource(Fa);var Va=[];O.toExecuteJsonArr(Va);if(pa&&z[O.getName()]){var sb=z[O.getName()];setTimeout(function(){pc(sb,O,va,!0)},100)}else gc(O,va,Va,Fa);return!0},gc=function(O,pa,va,Fa){delete z[O.getName()];var Va=Z.getGlobalDependence().createFacade(function(sb){pc(sb,O,pa,!1)},function(sb,Pb,mc){var kc=sb.toString();return"20"==
kc.substr(0,2)&&7==kc.length?(pa>=A&&(2040004==sb&&-1<Pb.indexOf("Too many tables; MySQL can only use 61 tables in a join")?kc=U.get("tooManyTablesSelectFieldOneEntityError","\u5f53\u524d\u5b9e\u4f53\u5173\u8054\u7684\u6570\u636e\u8868\u8fc7\u591a\uff0c\u8bf7\u53cd\u9009\u4e0d\u9700\u8981\u7684\u5b57\u6bb5\u3002"):(kc=U.get("errorInfo","\u9519\u8bef\u7801\uff1a#1\r\n\u9519\u8bef\u4fe1\u606f\uff1a#2"),kc=kc.replace("#1",sb),kc=kc.replace("#2",mc?mc:Pb)),m=null,aa(!0),Ad(kc)),!0):!1});Va.setShowBlocking(!1);
Va.previewData(va,Fa,11)},pc=function(O,pa,va,Fa){if(Z.getDmModel().getEntityByName(pa.getName())&&(aa(!0),va>=A)){Cd();va=new yb;O&&va.fromJsonObject(O);pa.setErrorInfo(va.getErrorInfo());aa(!0);var Va=va.getErrorInfo();if(Va){var sb=Va.getErrorDesc();Va="";sb=(sb?sb:dd.getDefaultErrorDesc(pa)).split("\uff1b");for(var Pb=0;Pb<sb.length;Pb++)Va+="<span class = 'entity-error-info' style='display: block;'>"+sb[Pb]+"</span>";Ad(Va);m=null;switch(pa.getErrorState()){case oa.AbstractEntity.ERROR_STATE_BIZMETANOTSUPPORT:Va=
da.getSupportQingAnalysisUrl(),Va=$("<a onclick='javascript:window.open(\""+Va+"\");' href='#'>"),Va.css("cursor","pointer"),Va.css("color","#5582f3"),Va.text(U.get("viewDocument","\u67e5\u770b\u5e2e\u52a9\u6587\u6863")),Z.getJqUi().find(".dm-entity-datapreview-waiting").append(Va)}}va.getErrorState()||(z[pa.getName()]=O,pa.setErrorInfo(null),m=va.getData(),O=va.getNotExistedPropNames(),pa.refreshNotExistedProperty(O),fd(pa,va.getCalcFieldCheckInfo()),Xc(pa,Fa),b.setSqlContent(va.getSqlContent()),
b.setUnPushdownFilterContent(va.getUnPushdownFilterContent()),Nb(pa),Rc(pa))}},Rc=function(O){return(O=(new La).checkEntityFilters(O))?(Xc(null),O=O.getPrompt(),O=U.get("filterCriteria","\u8fc7\u6ee4\u6761\u4ef6")+O,Ad(O),setTimeout(function(){g.setCurrentTabPane(f)},200),!1):!0},Lc=function(O){var pa=O.getColumnToRowProperties();if(pa&&0<pa.length){O.getProperties();for(var va in pa){var Fa=[],Va=pa[va],sb=Va.getFieldNameProperty();Fa.push(sb);var Pb=Va.getFieldValueProperties();Va=void 0;sb=Fa;
if(Pb&&0<Pb.length)for(Va in sb=sb?sb:[],Pb)sb.push(Pb[Va]);if(Fa&&0<Fa.length)for(Va in Va=void 0,sb=O,Fa)if(Pb=Fa[Va])Pb.setColumnToRowField(!0),sb.findProperty(Pb.getName())?Pb.setColumnToRowFieldInvalid(!1):Pb.setColumnToRowFieldInvalid(!0)}}},Xc=function(O,pa){ha.clear(k);if(O&&Z.getDmModel().isEntityNameExist(O.getName())){var va=ha.createHeadRow(k),Fa=O.getProperties(),Va=O.getOutputProperties(Fa),sb=Va.length,Pb=[];Fa=0;for(var mc=!1,kc=0;kc<sb;kc++){var qc=Va[kc],Jc=qc.getOutputDataType(),
Fc=Jc==Gb.DT_INT||Jc==Gb.DT_NUMBER,Mc=k.addColumn(qc.getName());Mc.setStyle(ha.getColumnStyle(Fc));Mc.setWidth(id(Jc));Fc=qc.isHideInDataModeling()||qc.isNotExisted();Mc.setHide(Fc);va.getCell(kc).setValue(qc.getAlias());Pb[kc]=Zb.createFormater(Jc,qc.getFormatString());mc||Fc||(Fa=kc,mc=!0)}va=m.length;kc=0;for(mc=Math.min(va,10);kc<mc;kc++)for(qc=m[kc],Jc=ha.createRow(k),Mc=0;Mc<sb;Mc++)Va[Mc].isNotExisted()&&qc.length<Va.length&&qc.splice(Mc,0,""),Fc=(0,Pb[Mc])(qc[Mc]),Jc.getCell(Mc).setValue(Fc);
Va="";if(0==va)Va=U.get("noPreviewData","\u6ca1\u6709\u6570\u636e"),nd(Va,null,Fa,!1);else if(10>=va)Va=U.get("totalRows","\u603b\u5171#1\u884c\u6570\u636e").replace("#1",va),nd(Va,va,Fa,!1);else if(nd(U.get("loadingTotalRows","\u6b63\u5728\u8ba1\u7b97\u603b\u884c\u6570\uff0c\u8bf7\u7a0d\u5019...."),null,Fa,!0),10<va&&(Va=U.get("dataShownRows","\u4ec5\u9884\u89c8\u524d#1\u884c\u6570\u636e").replace("#1",10)),Z.getDmModel().isEntityNameExist(O.getName())&&!(new La).checkEntityFilters(O)){Pb={};O.collectSources(Pb);
sb=[];for(var gd in Pb)kc=Pb[gd].toJsonObject(),sb.push(kc);gd=[];gd.push(O.toExecutableJsonObject());for(Pb=O;Pb.getParentEntity();)Pb=Pb.getParentEntity(),gd.push(Pb.toExecutableJsonObject());pa&&H.hasOwnProperty(O.getName())&&!H[O.getName()]||(pa&&H[O.getName()]?(pa=H[O.getName()],md(pa,O,Va,Fa)):$c(O,gd,sb,Va,Fa))}}ha.refresh(k);O&&c!=O.getName()&&P(c)},id=function(O){switch(O){case Gb.DT_INT:case Gb.DT_NUMBER:return 90;case Gb.DT_DATE:return 80;case Gb.DT_DATETIME:return 130;case Gb.DT_BOOLEAN:return 40;
default:return 120}},$c=function(O,pa,va,Fa,Va){var sb=(new Date).getTime();x[O.getName()]=sb;H[O.getName()]=null;var Pb=Z.getGlobalDependence().createFacade(function(mc){var kc=x[O.getName()];kc&&sb<kc||(H[O.getName()]=mc,md(mc,O,Fa,Va))},function(mc,kc,qc){kc=mc.toString();return"20"==kc.substr(0,2)&&7==kc.length&&209E4!=mc?(Fa=U.get("loadingTotalRowsError","\u83b7\u53d6\u603b\u884c\u6570\u5931\u8d25",null,Va),nd(Fa,null,null,!1),!0):!1});Pb.setShowBlocking(!1);Pb.getDataCount(pa,va)},md=function(O,
pa,va,Fa){c==pa.getName()&&(0<=O&&(va=U.get("totalRows","\u603b\u5171#1\u884c\u6570\u636e").replace("#1",O)+U.get("previewTipsComma",",")+va),nd(va,O,Fa,!1))},nd=function(O,pa,va,Fa){if(void 0==va||null==va)va=0;var Va=10;pa&&0<=pa&&10>pa&&(Va=pa);k.getRowsCount()-ha.getHeadRowCount()==Va||0==k.getRowsCount()-ha.getHeadRowCount()?(ha.createRow(k),pa=k.getCellRender(),pa.setTipsParams(k.getRowsCount()-1,va,O,Fa),ha.refresh(k)):k.getRowsCount()-ha.getHeadRowCount()==Va+1&&(pa=k.getCellRender(),pa.setTipsParams(k.getRowsCount()-
1,va,O,Fa),ha.refresh(k))},td=function(O){var pa=Z.getDmModel(),va=pa.getEntityByName(c);pa.fireRelationPropChanged(va.getName(),O.getName())},vd=function(O){delete z[O];delete H[O];for(var pa=Z.getDmModel().getAllEntity(),va=0;va<pa.length;va++){var Fa=pa[va];Fa.getParentEntity()&&Fa.getParentEntity().getName()==O&&vd(Fa.getName())}},wd=function(O){if(!t)if(O)O=Z.getDmModel(),O=O.getEntityByName(c),m&&Xc(O,!0);else{O=Z.getDmModel();O=O.getEntityByName(c);vd(O.getName());t=!0;var pa=$(k.getUI()).parent();
O=$("<div>");O.addClass("dm-entity-datapreview-darkmask");O.appendTo(pa);pa=$("<div>");pa.text(U.get("refreshPreviewData","\u7f16\u8f91\u5b8c\u6210\u540e\uff0c\u70b9\u51fb\u6b64\u5904\u5237\u65b0\u9884\u89c8\u6570\u636e\u3002"));pa.on("click",function(va){yd()});pa.addClass("dm-entity-datapreview-darkmask-button");pa.appendTo(O)}},yd=function(){var O=Z.getDmModel().getEntityByName(c);Tb(O)&&Dd()},Dd=function(){Z.getJqUi().find(".dm-entity-datapreview-darkmask").remove();t=!1},Ad=function(O){Cd();
var pa=$(k.getUI()),va=$("<div>");va.html(O);va.addClass("dm-entity-datapreview-waiting");va.appendTo(pa)},Cd=function(){Z.getJqUi().find(".dm-entity-datapreview-waiting").remove()},Ed=function(){Ad(U.get("loadingPreviewData","\u6b63\u5728\u83b7\u53d6\u9884\u89c8\u6570\u636e\uff0c\u8bf7\u7a0d\u5019\u2026\u2026"));return(new Date).getTime()}}function rc(){Cb.call(this);var la=this,Z,ta,e,h,g,a,c,k,d=!1;this.createToolbarButtons=function(u){return[u.addButton(Ca,"btn_add-relation",U.get("createRelation",
"\u65b0\u5efa\u5173\u7cfb"))]};this.protectedInit=function(u){e=$("<div>");e.addClass("dm-relation-list");h=new p;h.setDefaultTableSize(200,90);h.setSelectedListener(wa);h.setTableIconSetter(m);h.setFieldIconSetter(t);h.setNoFieldPrompt(U.get("relationNotCreate","\u672a\u521b\u5efa\u4e0e\u5176\u5b83\u6570\u636e\u8868\u7684\u5173\u7cfb"));var L=h.getJqUi();L.addClass("dm-relation-view");a=new Ib;a.setModifyMode(!0);a.setEntities(la.getDmModel().copyEntityArray());a.setDirtyListener(b);var C=a.createJqUi();
C.addClass("dm-relation-modify-major");var Q=$("<div>");Q.text(U.get("relatedfield","\u5173\u8054\u5b57\u6bb5"));Q.addClass("dm-relation-modify-title");g=$("<div>");g.append(Q);g.append(C);ta=new yc;ta.setHorizontalSplit(!1);ta.setFirstSize(-1,0,-1);ta.setSecondSize(160,0,-1);ta.setResizeMode(yc.RESIZE_MODE_SECOND_FIXED);ta.setFirstChild(yc.createChildWrapper(L));ta.setSecondChild(yc.createChildWrapper(g));ta.getJqUi().addClass("dm-relation-major");Z=new yc;Z.setHorizontalSplit(!0);Z.setFirstSize(260,
100,600);Z.setSecondSize(-1,400,-1);Z.setFirstChild(yc.createChildWrapper(e));Z.setSecondChild(ta);L=Z.getJqUi();L.addClass("dm-tab-pane");L.appendTo(u)};this.protectedUpdateUi=function(u,L,C){z(L);a.bindModel(u);if(!C){var Q=new ic;L=0;for(C=u.getEntityCount();L<C;L++){var fa=u.getEntityByIndex(L);fa.isSubNodeAtView()||(fa=jb(fa),Q.addTable(fa))}L=0;for(C=u.getRelationCount();L<C;L++)fa=u.getRelationByIndex(L),u.isRelationInsideSubSystem(fa)||(fa=za(fa),Q.addRelation(fa));h.setDataModel(Q)}Q=$(document.createDocumentFragment());
L=0;for(C=u.getRelationCount();L<C;L++)fa=u.getRelationByIndex(L),u.isRelationInsideSubSystem(fa)||Q.append(r(fa));e.empty();e.append(Q);la.updateEntityRelationToUi();db();q()};this.protectedModelChanged=function(u,L){if(h){var C=h.getDataModel();if(u==Ra.KEY_ADD_ENTITIES){for(var Q=!1,fa=0;fa<L.length;fa++)u=L[fa],u.isSubNodeAtView()||(Q=jb(u),C.addTable(Q),Q=!0);Q&&a.setEntities(la.getDmModel().copyEntityArray());b()}else if(u==Ra.KEY_REFRESH_ENTITY)u=L,u.isSubNodeAtView()||(C.refreshTable(u.getName()),
a.setEntities(la.getDmModel().copyEntityArray())),b();else if(u==Ra.KEY_REMOVE_ENTITY)u=L,u.isSubNodeAtView()||(Q=C.getTableById(u.getName()),C.removeTable(Q),a.setEntities(la.getDmModel().copyEntityArray())),b();else if(u==Ra.KEY_ADD_RELATION)fa=L,u=la.getDmModel(),u.isRelationInsideSubSystem(fa)||(Q=r(fa),e.append(Q),db(),u=za(fa),C.addRelation(u),Na(fa,C),z(L)),b();else if(u==Ra.KEY_REFRESH_RELATION)z(L),b();else if(u==Ra.KEY_REMOVE_RELATION){fa=L;Q=E(fa);Q.remove();db();z(null);var R=fa.getFromEntity().getTopParentEntity().getName(),
K=fa.getToEntity().getTopParentEntity().getName();u=C.getRelationByTableId(R,K);C.removeRelation(u);Na(fa,C);b()}else if(u==Y.KEY_FROM_PROPERTY_ALIAS_CHANED)fa=L,u=la.getDmModel(),u.isRelationInsideSubSystem(fa)||Na(fa,C);else if(u==Y.KEY_TO_PROPERTY_ALIAS_CHANED)fa=L,u=la.getDmModel(),u.isRelationInsideSubSystem(fa)||Na(fa,C);else if(u==Sb.KEY_CHANGE_ENTITYALIAS){u=L;L=(fa=u.isSubNodeAtView())?u.getTopParentEntity().getName():u.getName();Q=C.getTableById(L);fa?Q.refreshSubEntityDisplayName(u):Q.setDisplayName(u.getAlias());
u=la.getDmModel();C=e.find(".dm-relation-list-item");for(fa=0;fa<C.length;fa++){Q=$(C[fa]);R=Wa.decode(Q.attr("datamodeling-name1"));K=Wa.decode(Q.attr("datamodeling-name2"));R=u.getEntityByName(R);var xa=u.getEntityByName(K);K=R.getTopParentEntity().getName();R=R.getTopParentEntity().getAlias();var Ka=xa.getTopParentEntity().getName();xa=xa.getTopParentEntity().getAlias();K==L?(Q=Q.find(".dm-relation-list-item-text"),xa=u.getEntityByName(Ka).getAlias(),Q.text(R+"-"+xa)):Ka==L&&(Q=Q.find(".dm-relation-list-item-text"),
K=u.getEntityByName(K).getAlias(),Q.text(K+"-"+xa))}q();b()}else if(u==Y.KEY_FROM_ENTITY||u==Y.KEY_TO_ENTITY)fa=L.getRelation(),L=L.getOldValue().getName(),R=fa.getFromEntity().getName(),K=fa.getToEntity().getName(),Q=M(u==Y.KEY_FROM_ENTITY?L:R,u==Y.KEY_TO_ENTITY?L:K),A(Q,R,K);else if(u==Y.KEY_FROM_PROPERTY||u==Y.KEY_TO_PROPERTY||u==Y.KEY_RELATED)fa=L.getRelation(),u=la.getDmModel(),u.isRelationInsideSubSystem(fa)||(R=fa.getFromEntity().getTopParentEntity().getName(),K=fa.getToEntity().getTopParentEntity().getName(),
u=C.getRelationByTableId(R,K),C.removeRelation(u),u=za(fa),C.addRelation(u),Na(fa,C),z(fa));else if(u==Ra.KEY_MOVE_UP_RELATION||u==Ra.KEY_MOVE_DOWN_RELATION)db(),la.protectedUpdateUi(la.getDmModel(),c,!0),z(c),b()}};this.into=function(){Z.resize();h.updateViewBounds()};this.resize=function(){Z.resize();h.updateViewBounds()};this.collectEdited=function(){if(h)for(var u=la.getDmModel(),L=h.getDataModel(),C=0;C<L.getTableCount();C++){var Q=L.getTable(C);u.getEntityByName(Q.getId()).getDesign(!0).setRectangle(Q.getRect())}};
this.updateEntityRelationToUi=function(){if(e)for(var u=e.find(".dm-relation-list-item"),L=0;L<u.length;L++){var C=$(u[L]),Q=C.find(".dm-relation-list-item-icon"),fa=C.find(".dm-relation-list-item-text"),R=C.find(".dm-entity-list-item-notexist");R&&R.remove();R=C.data("entityRelation");C=U.get("notExistProperty","\u5173\u8054\u5173\u7cfb\u5f15\u7528\u4e86\u4e0d\u5b58\u5728\u7684\u5b57\u6bb5:");var K=!1,xa=!1,Ka="";if(R.getFromProperty().isNotExisted()){K=xa=!0;var w=R.getFromEntity();Ka+=w.getAlias()+
"."+R.getFromProperty().getAlias()}f(R.getFromProperty())&&(K=xa=!0,w=R.getFromEntity(),Ka+=w.getAlias()+"."+R.getFromProperty().getAlias());""!==Ka&&(R.getFromEntity()instanceof Ub||R.getFromEntity().getSource().isShowEntityMark())&&(C=U.get("relationRefNotExistedProp",'\u5173\u8054\u5173\u7cfb\u5f15\u7528\u4e86\u4e0d\u5b58\u5728\u6216\u672a\u5f00\u542f"\u652f\u6301\u8f7b\u5206\u6790"\u8bbe\u7f6e\u9879\u7684\u5b57\u6bb5:'));w="";if(R.getToProperty().isNotExisted()){xa=!0;var N=R.getToEntity();w+=
(K?"\uff0c":"")+N.getAlias()+"."+R.getToProperty().getAlias()}f(R.getToProperty())&&(xa=!0,N=R.getToEntity(),w+=(K?"\uff0c":"")+N.getAlias()+"."+R.getToProperty().getAlias());""!==w&&(R.getToEntity()instanceof Ub||R.getToEntity().getSource().isShowEntityMark())&&(C=U.get("relationRefNotExistedProp",'\u5173\u8054\u5173\u7cfb\u5f15\u7528\u4e86\u4e0d\u5b58\u5728\u6216\u672a\u5f00\u542f"\u652f\u6301\u8f7b\u5206\u6790"\u8bbe\u7f6e\u9879\u7684\u5b57\u6bb5:'));C=C+Ka+w;xa?(R=ib.createWarning(),R.addClass("dm-entity-list-item-notexist"),
R.attr("title",C),R.css("top","30%"),Q.css("left","19px"),fa.css("left","35px"),R.insertBefore(Q)):(Q.css("left","4px"),fa.css("left","24px"))}};var f=function(u){return u&&u.isCalculatingField()&&u.isCalculatingFieldInvalid()},b=function(){la.getGlobalDependence().setDirty(!0)},r=function(u){var L=u.getFromEntity(),C=u.getToEntity(),Q=L.getTopParentEntity(),fa=C.getTopParentEntity(),R=$("<div>");R.addClass("dm-relation-list-item");R.data("entityRelation",u);A(R,L.getName(),C.getName());R.on("mousedown",
D);R.on("mouseenter",G);R.on("mouseleave",ca);u=$("<div>");u.addClass("dm-relation-list-item-icon");rb.background(u,"relation");L=$("<div>");L.addClass("dm-relation-list-item-text");L.text(Q.getAlias()+"-"+fa.getAlias());Q=$("<div>");Q.addClass("dm-relation-list-item-up-down");fa=$("<div>");fa.attr("title",U.get("moveUpRelation","\u4e0a\u79fb"));fa.addClass("dm-relation-list-item-up");rb.background(fa,"up_move");fa.on("click",P);Q.append(fa);fa=$("<div>");fa.attr("title",U.get("moveDownRelation",
"\u4e0b\u79fb"));fa.addClass("dm-relation-list-item-down");rb.background(fa,"down_move");fa.on("click",aa);Q.append(fa);Q=$("<div>");Q.attr("title",U.get("deleteRelation","\u5220\u9664"));Q.addClass("dm-relation-list-item-delete");rb.background(Q,"delete");Q.on("click",y);R.append(u);R.append(L);R.append(Q);return R},m=function(u,L){L=la.getDmModel().getEntityByName(L.getId());L=Yb.entity2IconName(L)+"_selected";rb.background(u,L)},t=function(u,L,C){L=C.getUserObject();L=Yb.dataType2IconName(L);rb.background(u,
L)},A=function(u,L,C){u.attr("datamodeling-name1",Wa.encode(L));u.attr("datamodeling-name2",Wa.encode(C))},E=function(u){var L=u.getFromEntity().getName();u=u.getToEntity().getName();return M(L,u)},M=function(u,L){return e.find("[datamodeling-name1='"+Wa.encode(u)+"'][datamodeling-name2='"+Wa.encode(L)+"']")},z=function(u){c=u;H();x();q()},H=function(){var u=e.find(".dm-relation-list-item");u.removeClass("dm-relation-list-item_selected");for(var L=0;L<u.length;L++){var C=$(u[L]),Q=C.find(".dm-relation-list-item-icon");
rb.background(Q,"relation");Q=C.find(".dm-relation-list-item-delete");rb.background(Q,"delete");Q=C.find(".dm-relation-list-item-up");rb.background(Q,"up_move");C=C.find(".dm-relation-list-item-down");rb.background(C,"down_move")}c&&(u=E(c),u.addClass("dm-relation-list-item_selected"),L=u.find(".dm-relation-list-item-icon"),rb.background(L,"relation_selected"),Q=u.find(".dm-relation-list-item-delete"),rb.background(Q,"delete_selected"),Q=u.find(".dm-relation-list-item-up"),rb.background(Q,"up_move_selected"),
C=u.find(".dm-relation-list-item-down"),rb.background(C,"down_move_selected"))},x=function(){if(c){var u=c.getFromEntity().getTopParentEntity().getName(),L=c.getToEntity().getTopParentEntity().getName();u=h.getDataModel().getRelationByTableId(u,L);h.setSelectedRelation(u)}},q=function(){a.setRelation(c);g.css("display",c?"block":"none")},D=function(u){var L=$(u.currentTarget);var C=Wa.decode(L.attr("datamodeling-name1"));L=Wa.decode(L.attr("datamodeling-name2"));C=la.getDmModel().getRelationByEntitiesName(C,
L);u=$(u.target);u.hasClass("dm-relation-list-item-up")||u.hasClass("dm-relation-list-item-down")?(k=C,H(),x(),q()):c!=C&&z(C)},G=function(u){var L=$(u.currentTarget);L.find(".dm-relation-list-item-delete").css("display","block");u=L.prev();var C=L.next(),Q=L.find(".dm-relation-list-item-up");Q&&Q.css("display","block");(L=L.find(".dm-relation-list-item-down"))&&L.css("display","block");0<u.length&&0>=C.length&&L&&L.attr("disabled","disabled").css("opacity","0.6");0<C.length&&0>=u.length&&Q&&Q.attr("disabled",
"disabled").css("opacity","0.6")},ca=function(u){if(!d){u=$(u.currentTarget);u.find(".dm-relation-list-item-delete").css("display","none");var L=u.find(".dm-relation-list-item-up");L&&L.css("display","none");(u=u.find(".dm-relation-list-item-down"))&&u.css("display","none")}},y=function(u){var L=U.get("confirmDelRelation","\u5220\u9664\u8be5\u5173\u7cfb\u540e\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u786e\u5b9a\u5220\u9664\u8be5\u5173\u7cfb\u5417\uff1f"),C=$(u.currentTarget);u=new Ea;u.setText(L);u.setConfirmedListener(function(Q){Q&&
la.getDmModel().removeRelation(c);d=!1;C.css("display","none");Q=C.parent();var fa=Q.find(".dm-relation-list-item-up");fa&&fa.css("display","none");(Q=Q.find(".dm-relation-list-item-down"))&&Q.css("display","none")});u.show(C);d=!0},P=function(u){la.getDmModel().moveUpRelation(k)},aa=function(u){la.getDmModel().moveDownRelation(k)},jb=function(u){var L=u.getName(),C=new sc;C.setId(L);C.setDisplayName(u.getAlias());(L=u.getDesign())&&C.setRect(L.getRectangle());Qb(u,C);return C},Qb=function(u,L){var C=
[],Q={},fa=la.getDmModel(),R=fa.isEntityWithSubNodes(u);u=fa.getEntityWithSubNodes(u);for(var K=0;K<u.length;K++)for(var xa=u[K],Ka=fa.searchRelationsByEntityName(xa.getName()),w=0;w<Ka.length;w++){var N=Ka[w];if(!fa.isRelationInsideSubSystem(N)){var qa;N.getFromEntity().getName()==xa.getName()?qa=N.getFromProperty():N.getToEntity().getName()==xa.getName()&&(qa=N.getToProperty());var Ma=xa.getName()+"."+qa.getName();Q[Ma]||(Q[Ma]=!0,N=new hb,N.setId(Ma),Ma=qa.getParent(),R&&N.setSubNodeEntity(xa),
Ma=Ma?Ma.getAlias()+"."+qa.getAlias():qa.getAlias(),N.setDisplayName(Ma),N.setUserObject(qa.getOutputDataType()),C.push(N))}}L.setFields(C)},za=function(u){var L=u.getFromEntity(),C=u.getToEntity(),Q=new hd;Q.setFromTableId(L.getTopParentEntity().getName());Q.setFromFieldId(L.getName()+"."+u.getFromProperty().getName());Q.setToTableId(C.getTopParentEntity().getName());Q.setToFieldId(C.getName()+"."+u.getToProperty().getName());L=Q.setRelated;a:switch(u=u.getRelated(),u){case Y.R_1_1:u=hd.R_11;break a;
case Y.R_1_N:u=hd.R_1N;break a;case Y.R_N_1:u=hd.R_N1;break a;default:throw Error("Unknown Related: "+u);}L.call(Q,u);return Q},Na=function(u,L){var C=u.getFromEntity().getTopParentEntity(),Q=L.getTableById(C.getName());Q&&Qb(C,Q);C=u.getToEntity().getTopParentEntity();(Q=L.getTableById(C.getName()))&&Qb(C,Q)},wa=function(u,L){if(u){if(u=la.getDmModel(),c=u.getRelationByEntitiesName(L.getFromTableId(),L.getToTableId()),!c){var C=u.getEntityByName(L.getFromTableId());L=u.getEntityByName(L.getToTableId());
for(var Q=u.getEntityWithSubNodes(C),fa=u.getEntityWithSubNodes(L),R=0;R<Q.length;R++){C=Q[R];for(var K=0;K<fa.length;K++)if(L=fa[K],c=u.getRelationByEntitiesName(C.getName(),L.getName())){R=Q.length;break}}}}else c=null;H();q()},Ca=function(u){var L;u=0;for(var C=la.getDmModel(),Q=0;Q<C.getEntityCount();Q++)C.getEntityByIndex(Q).isSubNodeAtView()||u++;a:{C=la.getDmModel().getAllEntity();for(Q=0;Q<C.length;Q++)if(!C[Q].isSupportCreateRelation()){C=C[Q].getSource().getDisplayName(C[Q].getAssociateName());
Q=U.get("noSupportCreateRelation","\u4e0d\u652f\u6301\u521b\u5efa#1\u95f4\u7684\u5173\u7cfb\u3002");la.getGlobalDependence().getMessageCurtain().showPrompt(Q.replace("#1",C));C=!1;break a}C=!0}C&&(2>u?L=U.get("relationNeedTwoEntity","\u4e24\u4e2a\u53ca\u4ee5\u4e0a\u7684\u6570\u636e\u8868\u624d\u53ef\u4ee5\u5efa\u7acb\u5173\u7cfb\u3002"):na()==u-1&&(L=U.get("cannotAddMoreRelation","\u4e0d\u80fd\u65b0\u5efa\u66f4\u591a\u7684\u5173\u7cfb\u3002")),L?la.getGlobalDependence().getMessageCurtain().showPrompt(L):
(L=new Vb,L.prepare(la.getDmModel(),la.getGlobalDependence()),L.showDialog()))},db=function(){e.find(".dm-relation-list-nodataprompt").remove();if(0==na()){var u=$("<div>");u.text(U.get("noRelationCreated","\u672a\u521b\u5efa\u6570\u636e\u8868\u95f4\u7684\u5173\u7cfb"));u.addClass("dm-relation-list-nodataprompt");e.append(u)}},na=function(){for(var u=0,L=la.getDmModel(),C=0,Q=L.getRelationCount();C<Q;C++){var fa=L.getRelationByIndex(C);L.isRelationInsideSubSystem(fa)||u++}return u}}function Kc(){Cb.call(this);
var la=this,Z,ta,e;this.protectedInit=function(d){var f=new l;f.setText(U.get("dataExtract","\u6570\u636e\u63d0\u53d6"));f=f.getJqUi();Z=new wc;Z.setCronAnalysisFacade(h);Z.setScheduleChangedListener(g);Z.setUnTimingButtonText(U.get("disposableExtract","\u5b9e\u65f6\u63d0\u53d6"));Z.setTimingButtonText(U.get("timingExtract","\u5b9a\u65f6\u9884\u63d0\u53d6"));var b=Z.getJqUi();e=new Da;e.setConfigChangedListener(a);var r=e.getJqUi();c();Ya.layoutCtrl(f,20,25,200,23);Ya.layoutCtrl(b,20,55,500,500);
Ya.layoutCtrl(r,40,240,480,100);f.appendTo(d);b.appendTo(d);r.appendTo(d)};this.into=function(){a:{for(var d=la.getDmModel().getAllEntity(),f=0;f<d.length;f++)if(!d[f].isSupportExtractData()){d=d[f].getSource().getDisplayName(d[f].getAssociateName());f=U.get("noSupportExtractTimingData","#1\u7c7b\u578b\u7684\u6570\u636e\u8868\u4e0d\u652f\u6301\u5b9a\u65f6\u9884\u63d0\u53d6");Z.setTimingButtonDisabled(!0);Z.setTimingButtonTip(f.replace("#1",d));break a}Z.setTimingButtonDisabled(!1);Z.removeTimingButtonTip()}k()};
var h=function(d,f,b){f=la.getGlobalDependence().createFacade(f,b);f.setShowBlocking(!0);f.cronExpression(d)},g=function(){la.getGlobalDependence().setDirty(!0);k()},a=function(d){la.getGlobalDependence().setDirty(!0);la.getDmModel().setExtractConfig(d)},c=function(){var d=la.getGlobalDependence().createFacade(function(f){e.setExtractUserLimit(f)},function(f,b){return!0});d.setShowBlocking(!1);d.getExtractUserLimit()},k=function(){var d=Z.getSchedule().getPeriod(),f=e.getJqUi();d?(f.show(),Ya.layoutCtrl(f,
40,zc.Period_Monthly===d?240:zc.Period_Weekly===d?300:180,480,100)):f.hide()};this.protectedUpdateUi=function(d){var f=d.getExtractSchedule();Z.setSchedule(f);ta=d.getExtractConfig();e.setExtractConfig(ta)};this.showTimingExtractCustomPanePrompt=function(){Z&&Z.showCustomPanePrompt()};this.validateExtractConfig=function(){return Z&&Z.getSchedule().getPeriod()?e.validateConfig():null}}function Bc(){lc.AbstractTabPane.call(this);var la=this,Z,ta,e,h,g,a;this.setTitle=function(c){Z=c};this.getTitle=
function(){return Z};this.getJqUi=function(){g||(g=$("<div>"),la.protectedInit(g),void 0!==a&&la.protectedUpdateUi(a));return g};this.protectedInit=function(c){throw Error("Override me.");};this.updateUi=function(c){a=c;g&&la.protectedUpdateUi(a)};this.protectedUpdateUi=function(c){throw Error("Override me.");};this.afterResize=function(){throw Error("Override me.");};this.setGlobalDependence=function(c){ta=c};this.setPreviewRefreshRequestListener=function(c){e=c};this.setFieldAliasEditListener=function(c){h=
c};this.protectedMethod={getGlobalDependence:function(){return ta},firePreviewRefreshWithOnlyRepaint:function(c){ta.setDirty(!0);a&&e(c)},fireAliasEditRepaint:function(c){a&&h(c)},getCurrentEntity:function(){return a}}}function uc(){function la(r){KTDefaultCellRender.call(this,r);var m=[Gb.DT_STRING,Gb.DT_NUMBER,Gb.DT_INT,Gb.DT_DATE,Gb.DT_DATETIME,Gb.DT_BOOLEAN],t=this,A=this.paintCellUI;this.paintCellUI=function(H,x){if(t.getCurrentRowIdx()<ha.getHeadRowCount())A(H,x);else{var q=t.getCurrentRow().getUserObject();
if(1==t.getCurrentColIdx()){var D=$(H);q=t.getCell().getValue();H=$("<div>");H.text(q);H.addClass("dm-common-tablecell-editable");D.empty();D.append(H);D.css("cursor","pointer")}else q instanceof Gb?(D=$(H),2==t.getCurrentColIdx()?E(H,t.getCellWidth(),t.getCellHeight(),q,t.getCurrentRow()):3==t.getCurrentColIdx()?(H=t.getCell().getValue(),q=q.getOutputDataType(),D.empty(),H&&(x=new n,x.setJustForInteger(q==Gb.DT_INT),q=x.toSampleString(H),H=$("<div>"),H.text(q),H.addClass("dm-entity-fieldtable-format-text"),
H.appendTo(D),q=$("<div>"),rb.background(q,"btn_edit"),q.addClass("dm-entity-fieldtable-format-icon"),q.appendTo(D))):4==t.getCurrentColIdx()?(H=new v,H.setChecked(q.isHide()),H.setUserObject(q),H.addCheckedListener(b),q=H.getJqUi(),q.addClass("dm-entity-fieldtable-checkbox"),q.appendTo(D)):(A(H,x),D.css("cursor","default"),0==t.getCurrentColIdx()&&(q.isCalculatingField()?(z(D,q),q.isCalculatingFieldInvalid()&&(H=ib.createWarning(),H.addClass("dm-entity-fieldtable-name-error"),H.attr("title",U.get("CalculatingField",
"\u8ba1\u7b97\u5b57\u6bb5")+'"'+q.getAlias()+'"'+U.get("invalid","\u65e0\u6548")),D.append(H))):q.isColumnToRowField()?q.isColumnToRowFieldInvalid()&&(H=ib.createWarning(),H.addClass("dm-entity-fieldtable-name-error"),H.attr("title",U.get("columnToRowPropertyNotExists","\u5217\u8f6c\u884c\u5b57\u6bb5\u4e0d\u5b58\u5728\uff0c\u8bf7\u91cd\u65b0\u914d\u7f6e\u5217\u8f6c\u884c")),D.append(H)):q.isNotExisted()&&(M(D,q),$(x).css({right:"31px",width:"unset"}),H=ib.createWarning(),H.addClass("dm-entity-fieldtable-name-error"),
H.attr("title",U.get("fieldNotExistInfo","\u8be5\u6570\u636e\u6e90\u4e2d\u4e0d\u5b58\u5728\u5b57\u6bb5")+'"'+q.getName()+'"'),(x=g)&&x.isUnion()&&(x=x.getChildren()[0]),x&&x.getSource().isShowEntityMark()&&H.attr("title",U.get("fieldNotExistInfo","\u8be5\u6570\u636e\u6e90\u4e2d\u4e0d\u5b58\u5728\u5b57\u6bb5")+'"'+q.getName()+'"'+U.get("fieldNotSupportQing",'\u6216\u8be5\u5b57\u6bb5\u672a\u5f00\u542f"\u652f\u6301\u8f7b\u5206\u6790"\u8bbe\u7f6e\u9879')),D.append(H))))):A(H,x)}};var E=function(H,x,q,
D,G){var ca=D.getDataType();D=D.getOutputDataType();H=ha.createCtrlInCell(H,x,q,ed);H.setSelected(D);H.setItemModels(m);H.setUserObject(G);H.setEnabled(a);H.setCustomPainter(function(y,P,aa){y=y?!1:aa==ca;var jb=Yb.dataType2IconName(aa),Qb=$("<div>");Qb.addClass("dm-entity-fieldtable-datatype-icon");rb.background(Qb,jb);Qb.appendTo(P);aa=Pc.getDataTypeDesc(aa);jb=$("<div>");jb.text(aa+(y?"("+U.get("origin","\u539f\u59cb")+")":""));jb.addClass("dm-entity-fieldtable-datatype-text");jb.appendTo(P)});
H.addSelectedChangedListener(f)},M=function(H,x){var q=$("<div>");q.addClass("dm-entity-fieldtable-op");q.addClass("dm-entity-fieldtable-op-delete");rb.backgroundWithHover(q,"btn_delete");q.on("click",function(D){D=new Ea;D.setText(U.get("deleteUnExistedField","\u5220\u9664\u8be5\u5b57\u6bb5\u540e\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u786e\u5b9a\u5220\u9664\u8be5\u5b57\u6bb5\u5417\uff1f"));D.setConfirmedListener(function(G){G&&h("delete",x)});D.show(q)});H.append(q)},z=function(H,x){var q=$("<div>");
q.addClass("dm-entity-fieldtable-op");q.addClass("dm-entity-fieldtable-op-edit");rb.backgroundWithHover(q,"btn_edit");q.on("click",function(G){h("modify",x)});var D=$("<div>");D.addClass("dm-entity-fieldtable-op");D.addClass("dm-entity-fieldtable-op-delete");rb.backgroundWithHover(D,"btn_delete");D.on("click",function(G){G=new Ea;G.setText(U.get("deleteCustomField","\u5220\u9664\u8be5\u5b57\u6bb5\u540e\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u786e\u5b9a\u5220\u9664\u8be5\u5b57\u6bb5\u5417\uff1f"));G.setConfirmedListener(function(ca){ca&&
h("delete",x)});G.show(D)});H.append(q);H.append(D)}}Bc.call(this);var Z=this.protectedMethod,ta,e,h,g,a=!0;this.protectedInit=function(r){ta=ha.createTable();ta.addCellClickListener(d);ha.bindTextEditor(ta,c,k);ha.bindTableListenerForCtrl(ta);var m=new la(ta);m.setOutsideVisible(!1);ta.setCellRender(m);ta.addColumns(5);ta.getColumn(0).setWidth(200);ta.getColumn(1).setWidth(200);ta.getColumn(2).setWidth(140);ta.getColumn(3).setWidth(160);ta.getColumn(4).setWidth(140);m=ha.createHeadRow(ta);m.getCell(0).setValue(U.get("fieldName",
"\u5b57\u6bb5\u540d\u79f0"));m.getCell(1).setValue(U.get("showName","\u663e\u793a\u540d\u79f0"));m.getCell(2).setValue(U.get("dataType","\u6570\u636e\u7c7b\u578b"));m.getCell(3).setValue(U.get("numberFormat","\u6570\u5b57\u683c\u5f0f"));m.getCell(4).setValue(U.get("hideWhileAnalyze","\u5728\u5206\u6790\u4e2d\u9690\u85cf"));m=$(ta.getUI());m.addClass("dm-entity-fieldtable");m.appendTo(r);ta.setSyncUIWhenModelChanged(!0)};this.protectedUpdateUi=function(r){g=r;var m=[];r&&(m=r.getPropertyViewNodes(),
a=r.isSupportChangeFieldType());ha.clearWithoutHead(ta);ta.setSyncUIWhenModelChanged(!1);for(r=0;r<m.length;r++){var t=m[r],A=t.isProperty();if(!A||!t.getModel().isHideInDataModeling()){var E=ha.createRow(ta);var M=t.getTreeLevel();M=new KTCellTreeModel(M);E.getCell(0).setTreeModel(M);E.getCell(0).setValue(t.getDisplayName());E.getCell(1).setValue(t.getAlias());A?(E.setUserObject(t.getModel()),A=E,t=t.getModel(),A.getCell(2).setValue(t.getOutputDataType()),A.getCell(3).setValue(t.getFormatString()?
t.getFormatString():""),A.getCell(4).setValue(t.isHide())):E.setUserObject(t)}}E&&(m=(m=E.getBorder())?m.copy():new KTBorderStyle,m.setBottomBorderWidth(1),m.setBottomBorderPen("solid"),m.setBottomBorderColor("#eee"),E.setBorder(m));ta.setSyncUIWhenModelChanged(!0);ha.refresh(ta)};this.afterResize=function(){ta.relayoutViews()};this.into=function(){ta.relayoutViews()};this.setValidNameChecker=function(r){e=r};this.setCustomFieldHandler=function(r){h=r};this.scrollToBottom=function(){var r=ta.getRowsCount()-
1;ta.scrollCellVisible(r,0,!0)};var c=function(r,m){return 1==m},k=function(r,m,t,A,E){m=r.getUserObject();var M=Z.getCurrentEntity(),z=!1;if(M){M=M.getPropertyViewNodes();for(var H=0;H<M.length;H++){var x=M[H];if(m instanceof Gb){if(m.getName()==x.getUniqueName())continue}else if(x.getUniqueName()==m.getUniqueName())continue;if(x.getAlias()==A){z=!0;break}}}if(z)return r=U.get("duplicatedName","\u91cd\u590d\u7684\u5b57\u6bb5\u663e\u793a\u540d\u79f0\uff1a")+A,E||(r+=U.get("abandonModify","\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002")),
Z.getGlobalDependence().getMessageCurtain().showPrompt(r),!1;if(!e(A))return r=U.get("invalidFieldName","\u5b57\u6bb5\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\uff0c\u4e14\u4e0d\u80fd\u5305\u542b\u7a7a\u683c\u3002"),""==A&&(r=U.get("fieldNameNull","\u5b57\u6bb5\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a\u3002")),E||(r=""==A?U.get("abandonModifysAndFieldNameNull","\u5b57\u6bb5\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002"):
U.get("abandonModifyAndFielNameValid","\u5b57\u6bb5\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\uff0c\u4e14\u4e0d\u80fd\u5305\u542b\u7a7a\u683c\uff0c\u5df2\u653e\u5f03\u4fee\u6539\u3002")),Z.getGlobalDependence().getMessageCurtain().showPrompt(r),!1;m.getAlias()!=A&&(t.setValue(A),m.setAlias(A),m.getDisplayName&&r.getCell(0).setValue(m.getDisplayName()),Z.firePreviewRefreshWithOnlyRepaint(!0),Z.fireAliasEditRepaint(m));return!0},
d=function(r,m){if(!(m.getRowIdx()<ha.getHeadRowCount())&&3==m.getColIdx()){var t=m.getCell();if(t&&t.getValue()){var A=m.getRow().getUserObject();r=new ma;r.edit(A.getAlias(),A.getFormatString(),function(E){A.setFormatString(E);t.setValue(E);Z.firePreviewRefreshWithOnlyRepaint(!0)});r.showDialog()}}},f=function(r,m,t){r=r.getUserObject();var A=r.getUserObject();A.setAppointedDataType(t);m!=t&&(Gb.confirmDefaultFormatString(A),r.getCell(3).setValue(A.getFormatString()));h("recheckAll",null);Z.firePreviewRefreshWithOnlyRepaint(!1)},
b=function(r,m){m&&(r.getUserObject().setHide(r.isChecked()),Z.getGlobalDependence().setDirty(!0))}}function Wb(){Bc.call(this);var la=!0,Z,ta,e,h,g,a,c;this.getSelectEntity=function(){return e};this.setSqlContent=function(f){f?(f=f.toUpperCase(),f=f.replace(RegExp(",","gm"),",\n"),f=f.replace(RegExp("SELECT","gm"),"SELECT\n"),f=f.replace(RegExp("FROM","gm"),"\nFROM\n"),f=f.replace(RegExp("WHERE","gm"),"\nWHERE\n"),f=f.replace(RegExp("UNION","gm"),"\nUNION\n"),f=f.replace(RegExp("GROUP BY","gm"),
"\nGROUP BY\n"),f=f.replace(RegExp("HAVING","gm"),"\nHAVING\n"),Z=f=f.replace(RegExp("ORDER BY","gm"),"\nORDER BY\n")):Z=U.get("emptyData","\u6682\u65e0\u76f8\u5173\u6570\u636e")};this.setUnPushdownFilterContent=function(f){ta=f?f:U.get("emptyData","\u6682\u65e0\u76f8\u5173\u6570\u636e")};this.setNeedOpenNewTab=function(f){la=f};this.isNeedOpenNewTab=function(){return la};this.protectedInit=function(f){f.css("overflow","auto");f.css("white-space","pre-wrap");a=$("<div>");a.addClass("dm-view-system-variable");
a.css("overflow","auto");var b=$("<div id ='SQL_CONTENT' >"),r=$("<div id ='SQL_CONTENT_icon'>");r.text("\u25b2");r.addClass("dm-view-system-variable-icon-close");var m=$("<div id ='SQL_CONTENT_text'>");m.text(U.get("sqlContent","\u811a\u672c\u5185\u5bb9"));m.addClass("dm-view-system-variable-text");r.appendTo(b);m.appendTo(b);b.appendTo(a);h=$("<textarea id='SQL_CONTENT_value' >");r={position:"relative",width:"90%",height:"200px",color:"#666",border:"0.1px solid #E9ECF1"};h.css(r);h.attr("readonly",
!0);h.text(Z);h.addClass("dm-view-system-variable-value");h.appendTo(a);b.on("click",function(A){d(A)});b=$("<div id ='SQL_FILTER' >");m=$("<div id ='SQL_FILTER_icon'>");m.text("\u25b2");m.addClass("dm-view-system-variable-icon-close");var t=$("<div id ='SQL_FILTER_text'>");t.text(U.get("unPushdownFilterConditions","\u4e0d\u53ef\u4e0b\u63a8\u7684\u8fc7\u6ee4\u6761\u4ef6"));t.addClass("dm-view-system-variable-text");m.appendTo(b);t.appendTo(b);b.appendTo(a);g=$("<textarea id='SQL_FILTER_value' >");
g.css(r);g.css("height","120px");g.attr("readonly",!0);g.text(ta);g.addClass("dm-view-system-variable-value");g.appendTo(a);b.on("click",function(A){d(A)});a.appendTo(f);c=$("<div>");c.css({color:"rgb(102, 102, 102)",margin:"10px"});c.text(U.get("unSupportSqlParse","\u5f53\u524d\u6570\u636e\u7c7b\u578b\u6682\u4e0d\u652f\u6301SQL\u89e3\u6790\u3002"));c.appendTo(f)};var k=function(){Z==U.get("emptyData","\u6682\u65e0\u76f8\u5173\u6570\u636e")?(a.hide(),c.show()):(h.text(Z),g.text(ta),c.hide(),a.show())};
this.protectedUpdateUi=function(f){e=f;k()};var d=function(f){$("#"+f.currentTarget.id+"_value");$("#"+f.currentTarget.id+"_value").is(":hidden")?($("#"+f.currentTarget.id+"_icon").removeClass("dm-view-system-variable-icon-close"),$("#"+f.currentTarget.id+"_icon").addClass("dm-view-system-variable-icon-open"),$("#"+f.currentTarget.id+"_value").css("display","block")):($("#"+f.currentTarget.id+"_icon").removeClass("dm-view-system-variable-icon-open"),$("#"+f.currentTarget.id+"_icon").addClass("dm-view-system-variable-icon-close"),
$("#"+f.currentTarget.id+"_value").css("display","none"))};this.afterResize=function(){k()}}function tc(){B.call(this);var la=this,Z=this.protectedMethod,ta,e=[];(function(){Z.setTitle(U.get("viewSystemVariable","\u67e5\u770b\u7cfb\u7edf\u53d8\u91cf"));la.setSize(810,570);Z.setSelectable(!0);Z.setContentPaneCreator(function(){ta||(ta=h());return ta});Z.setFooterClosingOnly(!0);Z.setClosingChecker2(null,function(c){Z.destroy();return!0});Z.setClosingAction(function(c){})})();this.setArrSystemVar=function(c){e=
c};this.getArrSystemVar=function(){return e};var h=function(){var c=$("<div>");c.addClass("dm-view-system-variable");c.css("overflow","auto");c.css("width","780px");for(var k in e){var d=$("<div id ='"+k+"' >"),f=$("<div id ='"+k+"_icon'>");f.text("\u25b2");f.addClass("dm-view-system-variable-icon-close");var b=$("<div id ='"+k+"_text'>"),r=a(e[k].getName());b.text(r);b.addClass("dm-view-system-variable-text");f.appendTo(d);b.appendTo(d);d.appendTo(c);f=$("<p id ='"+k+"_value'>");f.text(g(e[k].getValue()));
f.addClass("dm-view-system-variable-value");f.appendTo(c);d.on("click",function(m){var t=$("#"+m.currentTarget.id+"_value");m=$("#"+m.currentTarget.id+"_icon");t.is(":hidden")?(m.removeClass("dm-view-system-variable-icon-close"),m.addClass("dm-view-system-variable-icon-open"),t.css("display","block"),t.css("word-break","break-all")):(m.removeClass("dm-view-system-variable-icon-open"),m.addClass("dm-view-system-variable-icon-close"),t.css("display","none"))})}return c},g=function(c){"\u6682\u65e0\u6570\u636e"==
c&&(c=U.get("emptyData","\u6682\u65e0\u6570\u636e"));return c},a=function(c){for(var k,d=0;d<dc.SUPPORTED_VAR_TYPE.length;d++){var f=dc.SUPPORTED_VAR_TYPE[d];if(f.getTypeID()==c){k=U.get(f.getI18nKey(),f.getDefaultDesc());break}}return k}}function La(){var la=this,Z=!1;this.setFromFilterPane=function(g){Z=g};this.checkArrEntityFilter=function(g){for(var a=0;a<g.length;a++){var c=g[a],k=la.checkEntityFilters(c);if(k)return g=U.get("entityFilterCriteria","\u6570\u636e\u8868\u201c#1\u201d\u8fc7\u6ee4\u6761\u4ef6").replace("#1",
c.getAlias()),k.setPrompt(g+k.getPrompt()),k}return null};this.checkEntityFilters=function(g){if(!g)return null;a:{var a=g.getFilters();for(var c,k=0;k<a.length;k++){var d=a[k];if(!d.isEmpty()){c=g;var f=k,b=c.findProperty(d.getProperty().getName());b?b.isNotExisted()?(b=U.get("lackField","\u7b2c#1\u884c\u5b57\u6bb5\u4e0d\u5b58\u5728\u3002"),b=b.replace("#1",f+1),c=new sa(c.getName(),f,b)):c=null:(b=U.get("lackField","\u7b2c#1\u884c\u5b57\u6bb5\u4e0d\u5b58\u5728\u3002"),b=b.replace("#1",f+1),c=new sa(c.getName(),
f,b));c||(c=g,f=k,b=d.getProperty(),b.isCalculatingField()&&b.isCalculatingFieldInvalid()?(b=U.get("invalidProperty","\u7b2c#1\u884c\u65e0\u6548\u7684\u5b57\u6bb5\u3002"),b=b.replace("#1",f+1),c=new sa(c.getName(),f,b)):c=null);if(!c)b:{c=g;b=d;f=k;if(b.getCompareOp()==tb.COMPARE_VARIABLE&&b.isSystemVariant()){b=b.getValue();for(var r=!1,m=0;m<dc.SUPPORTED_VAR_TYPE.length;m++)if(dc.SUPPORTED_VAR_TYPE[m].getTypeID()==b){r=!0;break}if(!r){b=U.get("invalidSystemVarType","\u7b2c#1\u884c\u65e0\u6548\u7684\u7cfb\u7edf\u53d8\u91cf\u3002");
b=b.replace("#1",f+1);c=new sa(c.getName(),f,b);break b}}c=null}c||(c=h(g,d,k));c||(c=g,f=k,(d=d.checkCompletion())?(b=U.get("incompleteFilter","\u7b2c#1\u884c\u4e0d\u5b8c\u6574\uff0c"),b=b.replace("#1",f+1),b+=d,c=new sa(c.getName(),f,b)):c=null);if(c){a=c;break a}}}a=c}return a?a:e(g)};this.checkRelationPropertyExisted=function(g){for(var a=g.copyEntityArray(),c=0;c<a.length;c++)for(var k=a[c],d=g.searchRelationsByEntityName(k.getName()),f=0;f<d.length;f++){var b=d[f],r=b.getFromEntity().getName()==
k.getName(),m=U.get("notExistProperty","\u5173\u8054\u5173\u7cfb\u5f15\u7528\u4e86\u4e0d\u5b58\u5728\u7684\u5b57\u6bb5:");if(r){if(b.getFromEntity()instanceof Ub||b.getFromEntity().getSource().isShowEntityMark())m=U.get("relationRefNotExistedProp",'\u5173\u8054\u5173\u7cfb\u5f15\u7528\u4e86\u4e0d\u5b58\u5728\u6216\u672a\u5f00\u542f"\u652f\u6301\u8f7b\u5206\u6790"\u8bbe\u7f6e\u9879\u7684\u5b57\u6bb5:');if(b.getFromProperty().isNotExisted()||!k.findProperty(b.getFromProperty().getName()))return m+k.getAlias()+
"."+b.getFromProperty().getAlias()+U.get("fullStop","\u3002")}else{if(b.getToEntity()instanceof Ub||b.getToEntity().getSource().isShowEntityMark())m=U.get("relationRefNotExistedProp",'\u5173\u8054\u5173\u7cfb\u5f15\u7528\u4e86\u4e0d\u5b58\u5728\u6216\u672a\u5f00\u542f"\u652f\u6301\u8f7b\u5206\u6790"\u8bbe\u7f6e\u9879\u7684\u5b57\u6bb5:');if(b.getToProperty().isNotExisted()||!k.findProperty(b.getToProperty().getName()))return m+k.getAlias()+"."+b.getToProperty().getAlias()+U.get("fullStop","\u3002")}if(ta(b.getFromProperty()))return U.get("relationRefInvalidCalculateProp",
"\u5173\u8054\u5173\u7cfb\u5f15\u7528\u4e86\u65e0\u6548\u7684\u8ba1\u7b97\u5b57\u6bb5\uff1a")+b.getFromEntity().getAlias()+"."+b.getFromProperty().getAlias();if(ta(b.getToProperty()))return U.get("relationRefInvalidCalculateProp","\u5173\u8054\u5173\u7cfb\u5f15\u7528\u4e86\u65e0\u6548\u7684\u8ba1\u7b97\u5b57\u6bb5\uff1a")+b.getFromEntity().getAlias()+"."+b.getToProperty().getAlias()}return null};this.checkExtractUserConfig=function(g){return(g=g.validateExtractConfig())?(g=new sa("Extract warning",
0,g),g.setPromptLevel(sa.LEVEL_WARNING),g):null};var ta=function(g){return g&&g.isCalculatingField()&&g.isCalculatingFieldInvalid()},e=function(g){var a=0,c=-1,k=0;var d=g.getFilters();for(var f=0;f<d.length;f++)d[f].isEmpty()||(k=f);d=k;f=g.getFilters();for(k=0;k<f.length;k++){var b=f[k];if(!b.isEmpty()){a+=b.getLeftBracketCount();a-=b.getRightBracketCount();0>c&&0!=a&&(c=k);if(0>a)return a=U.get("bracketMismatch","\u5de6\u53f3\u62ec\u53f7\u4e0d\u5339\u914d\u3002"),new sa(g.getName(),c,a);if(k!=
d&&!b.getLogicOp())return a=U.get("lackLogicalSymbol","\u7b2c#1\u884c\u7f3a\u5c11\u903b\u8f91\u7b26"),a=a.replace("#1",k+1),new sa(g.getName(),k,a)}}return 0<a?(a=U.get("bracketMismatch","\u5de6\u53f3\u62ec\u53f7\u4e0d\u5339\u914d\u3002"),new sa(g.getName(),c,a)):null},h=function(g,a,c){if(a.getCompareOp()==tb.COMPARE_VARIABLE&&a.isMacroVar()&&(a=a.getValue())&&(a=oa.DesigntimeMacroCache.get(a))&&a.getMacroCheckResult()){var k=a.getMacroCheckResult(),d=com.kingdee.bos.qing.macro.model.MacroStatusEnum;
switch(k.getMacroStatus()){case d.AVAILABLE:case d.PROPERTY_ABNORMAL:break;case d.WITHOUT_DB_PERMISSION:case d.WITHOUT_ENTITY_PERMISSION:case d.WITHOUT_DB_CENTER_PERMISSION:case d.WITHOUT_SCHEMA_PERMISSION:case d.NOT_EXIST:return d=U.get("invalidMacroFilter","\u7b2c#1\u884c\u5f15\u7528\u7684\u5b8f\u53d8\u91cf\u5df2\u88ab\u5220\u9664\u6216\u6ca1\u6709\u6743\u9650\u8bbf\u95ee\u3002"),d=d.replace("#1",c+1),new sa(g.getName(),c,d);case d.DB_NOT_EXIST:return d=U.get("invalidFilterDBNoExist","\u7b2c#1\u884c\u5f15\u7528\u7684\u5b8f\u53d8\u91cf\u201c#2\u201d\uff0c\u5176\u4f7f\u7528\u7684\u6570\u636e\u5e93\u8fde\u63a5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u3002"),
d=d.replace("#1",c+1),d=d.replace("#2",a.getName()),new sa(g.getName(),c,d);case d.ENTITY_NOT_EXIST:return d=U.get("invalidFilterEntityNoExist","\u8fc7\u6ee4\u6761\u4ef6\u7b2c#1\u884c\u5f15\u7528\u7684\u5b8f\u53d8\u91cf\u201c#2\u201d\uff0c\u5176\u4f7f\u7528\u7684\u57fa\u7840\u8d44\u6599\u4e0d\u5b58\u5728\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u3002"),d=d.replace("#1",c+1),d=d.replace("#2",a.getName()),new sa(g.getName(),c,d);case d.DB_CENTER_NO_APP_METADATA:case d.DB_CENTER_NO_APP:return Z?(d=U.get("appNotExistFilter",
"\u5b8f\u53d8\u91cf\u201c#1\u201d\u4f7f\u7528\u7684\u5e94\u7528\u201c#2\u201d\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u3002"),d=d.replace("#1",a.getName()),d=d.replace("#2",k.getAppNumber())):(d=U.get("appNotExist","\u7b2c#1\u884c\u5f15\u7528\u7684\u5b8f\u53d8\u91cf\u201c#2\u201d\uff0c\u5176\u4f7f\u7528\u7684\u5e94\u7528\u201c#3\u201d\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u3002"),d=d.replace("#1",c+1),d=d.replace("#2",
a.getName()),d=d.replace("#3",k.getAppNumber())),new sa(g.getName(),c,d);case d.DB_CENTER_APP_CLOUD_DISABLED:return Z?(d=U.get("appCloudDisabledFilter","\u5b8f\u53d8\u91cf\u201c#1\u201d\u4f7f\u7528\u7684\u5e94\u7528\u201c#2\u201d\u6240\u5728\u4e91\u88ab\u7981\u7528\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u3002"),d=d.replace("#1",a.getName()),d=d.replace("#2",k.getAppNumber())):(d=U.get("appCloudDisabled","\u7b2c#1\u884c\u5f15\u7528\u7684\u5b8f\u53d8\u91cf\u201c#2\u201d\uff0c\u5176\u4f7f\u7528\u7684\u5e94\u7528\u201c#3\u201d\u6240\u5728\u4e91\u88ab\u7981\u7528\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u3002"),
d=d.replace("#1",c+1),d=d.replace("#2",a.getName()),d=d.replace("#3",k.getAppNumber())),new sa(g.getName(),c,d);case d.DB_CENTER_APP_DISABLED:return Z?(d=U.get("appDisabledFilter","\u5b8f\u53d8\u91cf\u201c#1\u201d\u4f7f\u7528\u7684\u5e94\u7528\u201c#2\u201d\u88ab\u7981\u7528\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u3002"),d=d.replace("#1",a.getName()),d=d.replace("#2",k.getAppNumber())):(d=U.get("appDisabled","\u7b2c#1\u884c\u5f15\u7528\u7684\u5b8f\u53d8\u91cf\u201c#2\u201d\uff0c\u5176\u4f7f\u7528\u7684\u5e94\u7528\u201c#3\u201d\u88ab\u7981\u7528\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u3002"),
d=d.replace("#1",c+1),d=d.replace("#2",a.getName()),d=d.replace("#3",k.getAppNumber())),new sa(g.getName(),c,d);default:throw Error("Unknown macro status: "+k.getMacroStatus());}}return null}}function Eb(){var la=this,Z,ta,e,h,g;this.setFunCheckError=function(a){ta=a};this.setFunGetGlobalDependence=function(a){Z=a};this.setFunGetCurrentEntity=function(a){e=a};this.setFunFirePreviewRefreshWithOnlyRepaint=function(a){h=a};this.getJqUi=function(){g||(g=la.protectedInit());return g};this.protectedInit=
function(){throw Error("overwrite me");};this.updateUi=function(a){throw Error("overwrite me");};this.afterResize=function(){throw Error("overwrite me");};this.locateToErrorRow=function(a,c){throw Error("overwrite me");};this.protectedMethod={checkError:function(){ta&&ta()},getGlobalDependence:Z,getCurrentEntity:function(){return e?e():null},firePreviewRefreshWithOnlyRepaint:function(a){h&&h(a)}}}function xb(){Eb.call(this);var la;this.protectedInit=function(){la=ha.createTable();var Z=new KTDefaultCellRender(la);
Z.setOutsideVisible(!1);la.setCellRender(Z);la.addColumns(8);la.getColumn(0).setWidth(20);la.getColumn(1).setWidth(100);la.getColumn(2).setWidth(180);la.getColumn(3).setWidth(100);la.getColumn(4).setWidth(220);la.getColumn(5).setWidth(100);la.getColumn(6).setWidth(60);la.getColumn(7).setWidth(100);Z=ha.createHeadRow(la);Z.getCell(1).setValue(U.get("leftBracket","\u5de6\u62ec\u53f7"));Z.getCell(2).setValue(U.get("field","\u5b57\u6bb5"));Z.getCell(3).setValue(U.get("compare","\u6bd4\u8f83"));Z.getCell(4).setValue(U.get("value",
"\u503c"));Z.getCell(5).setValue(U.get("rightBracket","\u53f3\u62ec\u53f7"));Z.getCell(6).setValue(U.get("logic","\u903b\u8f91"));Z=$(la.getUI());Z.addClass("dm-entity-filtertable");la.setSyncUIWhenModelChanged(!0);return Z};this.updateUi=function(Z){ha.clearWithoutHead(la);ha.refresh(la)};this.afterResize=function(){la.relayoutViews()};this.locateToErrorRow=function(Z,ta){}}function ab(){function la(q){KTDefaultCellRender.call(this,q);var D=this,G=e,ca=this.paintCellUI;this.paintCellUI=function(na,
u){if(D.getCurrentRowIdx()<ha.getHeadRowCount()||!D.getCell())ca(na,u);else{var L=D.getCellWidth(),C=D.getCellHeight(),Q=D.getCurrentRow();if(1==D.getCurrentColIdx()||5==D.getCurrentColIdx()){u=1==D.getCurrentColIdx();var fa=D.getCell().getValue();Ca(na,L,C,u,fa,Q)}else if(2==D.getCurrentColIdx()){var R=D.getCell().getValue();y(na,L,C,R,Q)}else 3==D.getCurrentColIdx()?(u=D.getCell().getValue(),fa=Q.getUserObject(),R=fa.getProperty(),fa=fa.getComparedDataType(),R=R?R.isEnum():!1,na=ha.createCtrlInCell(na,
L,C,ed),na.setSelected(u),na.setItemModels(fa?tb.getSelectableCompares(fa,R):[]),na.setUserObject(Q),na.setCustomPainter(za),na.addSelectedChangedListener(r)):4==D.getCurrentColIdx()?(u=D.getCell().getValue(),wa(na,L,C,u,Q)):6==D.getCurrentColIdx()?(u=D.getCell().getValue(),db(na,L,C,u,Q)):0==D.getCurrentColIdx()?(Q=D.getCell().getValue(),na=$(na),na.find(".dm-entity-filtertable-prompt").remove(),Q&&(L=ib.createWarning(),L.addClass("dm-entity-filtertable-prompt"),L.attr("title",Q),L.appendTo(na))):
ca(na,u)}};var y=function(na,u,L,C,Q){var fa=new pb,R=G.getCurrentEntity(),K=R.getFilteredProperties(function(xa){return!xa.isHideInDataModeling()});R=R?R.getOutputProperties(K):[];fa.setItemModel(R);fa.setListItemPainter(jb);fa.setSearchListener(P);fa.setShowFieldNameListener(aa);na=ha.createCtrlInCell(na,u,L,xc);na.setUserObject(Q);na.setSelectedModel(C);na.setDropdownCreator(function(xa,Ka,w){return fa.createJqPopup(xa,Ka,w)});na.addSelectionListener(function(xa){var Ka=xa.getSelectedModel();xa=
xa.getUserObject();var w=xa.getUserObject(),N=w.getProperty(),qa=w.getComparedDataType(),Ma=Ka.getOutputDataType();w.setProperty(Ka);w.setCompareType(tb.COMPARE_WITH_APPOINTED);xa.getCell(2).setValue(Ka);if(qa!=Ma||N.getEnumValue()!=Ka.getEnumValue()){N=w.getCompareOp();Ka=tb.getSelectableCompares(Ma,Ka.isEnum());Ma=!1;for(qa=0;qa<Ka.length;qa++)if(N==Ka[qa]){Ma=!0;break}Ma||(N=tb.COMPARE_EQUAL);w.setCompareOp(N);b(xa.getCell(3),N);w.setValue(null);w.setValueMode(tb.MODE_CONST);w.setRelativeDateRange(null);
b(xa.getCell(4)," ")}e.checkError();e.firePreviewRefreshWithOnlyRepaint(!1)});na.setCustomPainter(function(xa,Ka){Ka.text(xa?xa.getAlias():"")})},P=function(na,u,L,C,Q,fa){u=u.trim().toLowerCase();for(var R=[],K,xa=0;xa<na.length;xa++)K=na[xa],(K=-1!=K.getAlias().trim().toLowerCase().indexOf(u)?!0:fa&&-1!=K.getName().trim().toLowerCase().indexOf(u)?!0:!1)&&R.push(na[xa]);L.children().remove();if(0<R.length){for(xa=0;xa<R.length;xa++)Q(R[xa],L,C);R.length=0}else na=new l,na.setText(U.get("nothingSearched",
"\u627e\u4e0d\u5230\u7b26\u5408\u7684\u7ed3\u679c")),na.setEnabled(!1),na.setAlign(l.ALIGN_CENTER),na=na.getJqUi(),na.addClass("dm-field-popup-search-result"),na.appendTo(L);aa(L,fa)},aa=function(na,u){if(u)for(na=na.find(".dm-field-popup-list-item-field-name"),u=0;u<na.length;u++){var L=na.eq(u);L.css("display","inline-block");var C=L.prev().text()+L.text();L.prev().attr("title",null);L.parent().attr("title",C)}else for(na=na.find(".dm-field-popup-list-item-field-name"),u=0;u<na.length;u++)L=na.eq(u),
L.css("display","none"),L.parent().attr("title",null),L.prev().attr("title",L.prev().text())},jb=function(na,u,L){var C=$("<div>");C.addClass("dm-field-popup-list-item");C.data("model",na);var Q=na?na.getAlias():"",fa=$("<span>");fa.text(Q);fa.attr("title",Q);fa.addClass("dm-field-popup-list-item-text");Q="";na&&(Q=na.getFormula()?na.getAlias():na.getName());var R=$("<span>");R.addClass("dm-field-popup-list-item-field-name");R.text("("+Q+")");C.append(fa);C.append(R);u.append(C);L&&L.getAlias()==
na.getAlias()&&Qb(u,C)},Qb=function(na,u){var L=null;0<na.height()?(clearTimeout(L),u.addClass("dm-list-item_selected_enabled"),na.prop("scrollTop",u.prop("offsetTop"))):L=setTimeout(function(){Qb(na,u)},0)},za=function(na,u,L){switch(L){case tb.COMPARE_EQUAL:na=U.get("equal","\u7b49\u4e8e");break;case tb.COMPARE_NOT_EQUAL:na=U.get("notEqual","\u4e0d\u7b49\u4e8e");break;case tb.COMPARE_GREATER:na=U.get("greater","\u5927\u4e8e");break;case tb.COMPARE_GREATER_EQUAL:na=U.get("equalOrGreater","\u5927\u4e8e\u7b49\u4e8e");
break;case tb.COMPARE_LESS:na=U.get("less","\u5c0f\u4e8e");break;case tb.COMPARE_LESS_EQUAL:na=U.get("equalOrLess","\u5c0f\u4e8e\u7b49\u4e8e");break;case tb.COMPARE_INCLUDE:na=U.get("include","\u5305\u542b");break;case tb.COMPARE_NOT_INCLUDE:na=U.get("notInclude","\u4e0d\u5305\u542b");break;case tb.COMPARE_START_WITH:na=U.get("startWith","\u5f00\u5934\u662f");break;case tb.COMPARE_END_WITH:na=U.get("endWith","\u7ed3\u5c3e\u662f");break;case tb.COMPARE_NULL:na=U.get("compareNull","\u4e3a\u7a7a");break;
case tb.COMPARE_NOT_NULL:na=U.get("compareNotNull","\u4e0d\u4e3a\u7a7a");break;case tb.COMPARE_RELATIVE_DATE_RANGE:na=U.get("relativeDateRange","\u76f8\u5bf9\u65e5\u671f");break;case tb.COMPARE_VARIABLE:na=U.get("compareVariable","\u5339\u914d\u53d8\u91cf");break;case tb.COMPARE_IN:na=U.get("compareIn","\u5728......\u4e4b\u5185");break;case tb.COMPARE_NOT_IN:na=U.get("compareNotIn","\u4e0d\u5728......\u4e4b\u5185");break;default:na=""}u.text(na);u.attr("title",na)},Na=function(na,u){var L=U.get("enterSplit",
"\u7cbe\u786e\u5339\u914d\u591a\u503c\uff0c\u5404\u9879\u4e4b\u95f4\u4f7f\u7528\u56de\u8f66\u4f5c\u4e3a\u5206\u9694\u7b26"),C=na.getCompareOp()==tb.COMPARE_IN?U.get("compareIn","\u5728......\u4e4b\u5185"):U.get("compareNotIn","\u4e0d\u5728......\u4e4b\u5185"),Q=JSON.parse(na.getValue());Q=Q?Q.join("\n"):"";var fa=new Ob;fa.setCaption(C,L);fa.setClosingChecker(function(R){if(R&&5E4<R.length)return U.get("matchTooLong","\u5339\u914d\u9879\u4e0d\u80fd\u8d85\u8fc750000\u4e2a\u5b57\u7b26")});fa.setText(Q,
function(R,K){R&&x(u,na,K)});fa.showDialogLeftAnchorTo(u.getJqUi())},wa=function(na,u,L,C,Q){var fa=$(na);fa.empty();fa.css("cursor","");var R=Q.getUserObject(),K=R.getCompareOp();if(!tb.isCompareOpWithoutValue(K)){var xa=R.getProperty(),Ka=R.getComparedDataType(),w=xa?xa.getEnumValue():null;xa=xa?xa.isVoidEnumProp():null;if(K==tb.COMPARE_VARIABLE)if(oa.MacroVariateSelectorRegister.isRegisterComplete()){var N=ha.createCtrlInCell(na,u,L,Hc);N.setClearable(!0);N.addActionListener(function(nc){nc=new lb;
nc.setSelectedCallback(function(Oc){z(N,R,Oc)});nc.setSelected(N.getModel());nc.showDialog()});N.setCustomPainter(function(nc){var Oc=R.getValue();nc=null==nc?Oc?Oc:"":nc.getDisplayName();""!=nc&&(nc=(R.isMacroVar()?"$":R.isSystemVariant()?"@":"")+nc);return nc});N.addClearListener(function(nc){z(nc,R,null)});R.isSystemVariant()?Vc.getImpl(Vc.SYS_VAR_HELPER).loadVarModelAdapter(R.getValue(),function(nc){N.setModel(nc)}):R.isMacroVar()&&Vc.getImpl(Vc.MACRO_VAR_HELPER).loadVarModelAdapter(R.getValue(),
function(nc){N.setModel(nc)})}else{var qa=ha.createCtrlInCell(na,u,L,ed);R.setValueMode(tb.MODE_SYS_VAR);na=Vc.getImpl(Vc.SYS_VAR_HELPER);var Ma=na.createSysVarAdapters(dc.SUPPORTED_VAR_TYPE);na.loadVarModelAdapter(R.getValue(),function(nc){nc=nc?nc:Ma[0];qa.setSelected(nc);R.setValue(nc.getId())});qa.setItemModels(Ma);qa.setUserObject(Q);qa.addSelectedChangedListener(M);qa.setCustomPainter(function(nc,Oc,jd){nc=jd.getDisplayName();Oc.text(nc)})}else if(K==tb.COMPARE_IN||K==tb.COMPARE_NOT_IN)if(R.getProperty().isEnum()){var Hb=
[],Rb;for(Rb in w)Hb.push({fieldValue:w[Rb],fieldName:Rb});var Ic=[];(C=JSON.parse(R.getValue()))&&C.forEach(function(nc){Hb.forEach(function(Oc){nc==Oc.fieldName&&Ic.push({fieldValue:Oc.fieldValue,fieldName:Oc.fieldName})})});var Yc=new mb;Yc.setItemModel(Hb,function(nc,Oc){return nc&&Oc&&nc.fieldName==Oc.fieldName});Yc.setSelectedItemModel(Ic);na=ha.createCtrlInCell(na,u,L,xc);na.setUserObject(Q);na.setSelectedModel(Ic);na.setDropdownCreator(function(nc,Oc,jd,pd){return Yc.createJqPopup(nc,Oc,jd,
pd)});na.addSelectionListener(function(nc){var Oc=nc.getSelectedModel();nc=nc.getUserObject().getUserObject();if(null==Oc||0==Oc.length)nc.setValue(null);else{var jd=JSON.parse(nc.getValue()),pd=[],qd;for(qd in Oc)pd.push(Oc[qd].fieldName);null!=jd&&JSON.stringify(jd.sort())==JSON.stringify(pd.sort())||e.firePreviewRefreshWithOnlyRepaint(!1);nc.setValue(JSON.stringify(pd))}e.checkError()});na.setCustomPainter(function(nc,Oc){var jd=[],pd;for(pd in nc)jd.push(nc[pd].fieldValue);Oc.text(jd.join(","))})}else N=
ha.createCtrlInCell(na,u,L,Hc),N.setClearable(!0),N.setUserObject(Q),N.getJqUi().find(".sa-ctrl-f7selector-text").on("click",function(){Na(R,N)}),N.addActionListener(function(nc){Na(R,N)}),null!=C&&""!=C&&" "!=C&&C&&N.setModel(JSON.parse(C).join(",")),N.setCustomPainter(function(nc){return nc}),N.addClearListener(function(nc){x(nc,R,null)});else if(k(Ka,w,xa))na=$("<div>"),na.text(C),na.addClass("dm-common-tablecell-editable"),na.appendTo(fa),fa.css("cursor","pointer");else if(Ka==Gb.DT_DATE||Ka==
Gb.DT_DATETIME)if(tb.isCompareOpRelativeDateRangeValue(K)){var Ac=Ka==Gb.DT_DATETIME;Ka="";var Zc=C;Zc instanceof ea?Ka=Ga.modelToDisplayText(Zc,Ac):(Zc=new ea,Zc.setPeriod(ea.PERIOD_DAY),Zc.setWhichPeriod(0));var ld=ha.createCtrlInCell(na,u,L,l);ld.setText(Ka);ld.setUserObject(Q);na=ld.getJqUi();na.find(".sa-ctrl-label-text").css("padding-right","12px");na.css("line-height","28px");na.on("click",function(nc){nc=Zc;var Oc=fd,jd=new Z;jd.edit(nc,Ac,Oc);jd.showDialog()});u=$("<div>");rb.background(u,
"btn_edit");u.addClass("dm-entity-fieldtable-format-icon");u.appendTo(na);var fd=function(nc){R.setRelativeDateRange(nc);R.setValueMode(tb.MODE_SYS_VAR);ld.setText(Ga.modelToDisplayText(nc,Ac));Q.getCell(4).setValue(nc);e.checkError();e.firePreviewRefreshWithOnlyRepaint(!1)}}else fa=new Date,C=C?parseInt(C):null,isNaN(C)||null==C?(R=Q.getUserObject(),R.setValue(fa.getTime()),R.setValueMode(tb.MODE_CONST)):fa.setTime(C),na=ha.createCtrlInCell(na,u,L,Ka==Gb.DT_DATETIME?S:I),na.setDateObject(fa),na.setUserObject(Q),
na.addModelChangedListener(H);else if(Ka==Gb.DT_BOOLEAN)qa=ha.createCtrlInCell(na,u,L,ed),qa.setSelected(C),qa.setItemModels([Gb.BOOLEAN_TRUE,Gb.BOOLEAN_FALSE]),qa.setUserObject(Q),qa.setCustomPainter(function(nc,Oc,jd){nc=jd==Gb.BOOLEAN_TRUE?U.get("dataTypeTrue","\u771f"):jd==Gb.BOOLEAN_FALSE?U.get("dataTypeFalse","\u5047"):"";Oc.text(nc)}),qa.addSelectedChangedListener(E);else if(null!=w){Hb=[];for(Rb in w)Hb=Hb.concat(Rb);qa=ha.createCtrlInCell(na,u,L,ed);qa.setSelected(C);qa.setItemModels(Hb);
qa.setUserObject(Q);qa.setCustomPainter(function(nc,Oc,jd){Oc.text(w[jd])});qa.addSelectedChangedListener(E)}}},Ca=function(na,u,L,C,Q,fa){na=ha.createCtrlInCell(na,u,L,ed);na.setSelected(Q);na.setItemModels([0,1,2,3,4]);na.setUserObject(fa);na.setCustomPainter(function(R,K,xa){R=C?"(":")";for(var Ka="",w=0;w<xa;w++)Ka+=R;K.text(Ka)});na.addSelectedChangedListener(C?m:t)},db=function(na,u,L,C,Q){na=ha.createCtrlInCell(na,u,L,ed);na.setSelected(C?C:null);na.setItemModels([null,tb.LOGIC_AND,tb.LOGIC_OR]);
na.setUserObject(Q);na.setCustomPainter(function(fa,R,K){fa="";K==tb.LOGIC_AND?fa=U.get("and","\u5e76\u4e14"):K==tb.LOGIC_OR&&(fa=U.get("or","\u6216"));R.text(fa)});na.addSelectedChangedListener(A)}}function Z(){B.call(this);var q=this,D=this.protectedMethod,G;this.edit=function(ca,y,P){D.setTitle(U.get("relativeDateRange","\u76f8\u5bf9\u65e5\u671f"));G||(q.setSize(450,430),G=new Ga,G.setContainsTime(y),y=new ea,y.fromJsonObject(ca.toJsonObject()),G.setModel(y),D.setContentPaneCreator(function(){return G.getJqUi()}),
D.setClosingAction(function(aa){aa&&(aa=G.getModel(),P(aa))}))}}Eb.call(this);var ta=this,e=this.protectedMethod,h,g,a=new zb;this.protectedInit=function(){h=ha.createTable();ha.bindTextEditor(h,d,f);ha.bindTableListenerForCtrl(h,c);var q=new la(h);q.setOutsideVisible(!1);h.setCellRender(q);h.addColumns(8);h.getColumn(0).setWidth(20);h.getColumn(1).setWidth(100);h.getColumn(2).setWidth(180);h.getColumn(3).setWidth(100);h.getColumn(4).setWidth(220);h.getColumn(5).setWidth(100);h.getColumn(6).setWidth(60);
h.getColumn(7).setWidth(140);q=ha.createHeadRow(h);q.getCell(1).setValue(U.get("leftBracket","\u5de6\u62ec\u53f7"));q.getCell(2).setValue(U.get("field","\u5b57\u6bb5"));q.getCell(3).setValue(U.get("compare","\u6bd4\u8f83"));q.getCell(4).setValue(U.get("value","\u503c"));q.getCell(5).setValue(U.get("rightBracket","\u53f3\u62ec\u53f7"));q.getCell(6).setValue(U.get("logic","\u903b\u8f91"));q=$(h.getUI());q.addClass("dm-entity-filtertable");h.setSyncUIWhenModelChanged(!0);return q};this.updateUi=function(q){q=
q?q.getFilters():[];for(var D=q.length-1;0<=D;D--){var G=q[D];if(0!=G.getLeftBracketCount()||0!=G.getRightBracketCount()||G.getProperty()||G.getCompareOp()||G.getValue())break;else q.splice(D,1)}ha.clearWithoutHead(h);var ca=q.length,y=Math.max(8,ca+4);for(D=0;D<y;D++){D<ca?G=q[D]:(G=new tb,q.push(G));var P=ha.createRow(h),aa=D==ca-1;P.setUserObject(G);P.getCell(0).setValue("");P.getCell(1).setValue(G.getLeftBracketCount());P.getCell(2).setValue(G.getProperty());P.getCell(3).setValue(G.getCompareOp());
var jb=G.getCompareOp();tb.isCompareOpRelativeDateRangeValue(jb)?P.getCell(4).setValue(G.getRelativeDateRange()?G.getRelativeDateRange():""):P.getCell(4).setValue(G.getValue()?G.getValue():"");P.getCell(5).setValue(G.getRightBracketCount());P.getCell(6).setValue(aa?null:G.getLogicOp())}ha.refresh(h)};this.afterResize=function(){console.log("oTable relayoutViews.")};this.locateToErrorRow=function(q,D){for(var G=ha.getHeadRowCount();G<h.getRowsCount();G++)h.getRow(G).getCell(0).setValue("");0<=q&&h.getRow(q+
ha.getHeadRowCount()).getCell(0).setValue(D)};var c=function(q,D,G,ca){var y=e.getCurrentEntity();if(y){q=null;if(D){q=KTableUIAbstractView.createCellId(h.getRow(G),h.getColumn(7));q=ta.getJqUi().find("#"+q);var P=G-ha.getHeadRowCount();a.setFontSize(12,"Microsoft YaHei");D=U.get("insert","\u63d2\u5165");G=a.measureWidth(D)+10;ca=$("<div>");ca.text(D);ca.addClass("dm-entity-filtertable-op");ca.addClass("dm-entity-filtertable-op-insert");ca.css("width",G);ca.appendTo(q);ca.on("click",function(aa){aa=
new tb;y.getFilters().splice(P,0,aa);ta.updateUi(e.getCurrentEntity());e.checkError()});D=U.get("deleteRow","\u5220\u9664");D=a.measureWidth(D)+10;ca=$("<div>");ca.text(U.get("deleteRow","\u5220\u9664"));ca.addClass("dm-entity-filtertable-op");ca.addClass("dm-entity-filtertable-op-delete");ca.css({width:D,left:G+10});ca.appendTo(q);ca.on("click",function(aa){y.getFilters().splice(P,1);ta.updateUi(e.getCurrentEntity());e.checkError();e.firePreviewRefreshWithOnlyRepaint(!1)})}else g&&g.find(".dm-entity-filtertable-op").remove();
g=q}},k=function(q,D,G){return null!=G&&1==G?!0:q==Gb.DT_STRING?null==D:q==Gb.DT_STRING||q==Gb.DT_NUMBER||q==Gb.DT_INT},d=function(q,D){if(4!=D)return!1;D=h.getRow(q).getUserObject();q=D.getCompareOp();if(q==tb.COMPARE_VARIABLE||q==tb.COMPARE_IN||q==tb.COMPARE_NOT_IN||tb.isCompareOpWithoutValue(q))return!1;q=D.getProperty();D=D.getComparedDataType();var G=q?q.getEnumValue():null;q=q?q.isVoidEnumProp():null;return k(D,G,q)},f=function(q,D,G,ca,y){q=q.getUserObject();q.getValue()!==ca&&(q.setValue(ca),
G.setValue(ca),e.checkError(),e.firePreviewRefreshWithOnlyRepaint(!1));return!0},b=function(q,D){q.setValue(""===D?" ":"");q.setValue(D)},r=function(q,D,G){q=q.getUserObject();var ca=q.getUserObject();ca.setCompareOp(G);q.getCell(3).setValue(G);if(tb.isCompareOpWithoutValue(D)!=tb.isCompareOpWithoutValue(G)||tb.isCompareOpRelativeDateRangeValue(D)!=tb.isCompareOpRelativeDateRangeValue(G)||tb.isCompareOpWithinOrNotWithinValue(D)!=tb.isCompareOpWithinOrNotWithinValue(G))ca.setValue(null),ca.setRelativeDateRange(null),
ca.setValueMode(tb.MODE_CONST),b(q.getCell(4)," ");if(G==tb.COMPARE_VARIABLE||D==tb.COMPARE_VARIABLE)ca.setValue(null),ca.setRelativeDateRange(null),ca.setValueMode(G==tb.COMPARE_VARIABLE?tb.MODE_SYS_VAR:tb.MODE_CONST),b(q.getCell(4)," ");e.checkError();e.firePreviewRefreshWithOnlyRepaint(!1)},m=function(q,D,G){q=q.getUserObject();q.getUserObject().setLeftBracketCount(G);q.getCell(1).setValue(G);e.checkError();e.firePreviewRefreshWithOnlyRepaint(!1)},t=function(q,D,G){q=q.getUserObject();q.getUserObject().setRightBracketCount(G);
q.getCell(5).setValue(G);e.checkError();e.firePreviewRefreshWithOnlyRepaint(!1)},A=function(q,D,G){q=q.getUserObject();q.getUserObject().setLogicOp(G);q.getCell(6).setValue(G);e.checkError();e.firePreviewRefreshWithOnlyRepaint(!1)},E=function(q,D,G){q=q.getUserObject();q.getUserObject().setValue(G);q.getCell(4).setValue(G);e.checkError();e.firePreviewRefreshWithOnlyRepaint(!1)},M=function(q,D,G){q=q.getUserObject();q.getUserObject().setValue(G.getId());q.getCell(4).setValue(G.getDisplayName());e.checkError();
e.firePreviewRefreshWithOnlyRepaint(!1)},z=function(q,D,G){if(null!=G){var ca=G.getFilterMode();D.setValue(G.getId());D.setValueMode(G.getFilterMode());ca==tb.MODE_MACRO_VAR&&(D=oa.DesigntimeMacroCache.convertToDesigntimeModel(G),oa.DesigntimeMacroCache.put(G.getId(),D))}else D.setValue(null);q.setModel(G);e.checkError();e.firePreviewRefreshWithOnlyRepaint(!1)},H=function(q){var D=""+q.getDateObject().getTime();q=q.getUserObject();var G=q.getUserObject();G.setValue(D);G.setValueMode(tb.MODE_CONST);
q.getCell(4).setValue(D);e.checkError();e.firePreviewRefreshWithOnlyRepaint(!1)},x=function(q,D,G){null!=G&&q.setModel(G.replace(/(\n\s*)+/g,","));if(null==G||D.getValue()!=JSON.stringify(G.split("\n"))){q=q.getUserObject();if(null!=G&&""!=G){G=JSON.parse(JSON.stringify(G.split("\n")));var ca=[];G&&G.forEach(function(y){""!=y.trim()&&ca.push(y)});G=JSON.stringify(ca);D.setValue(G);q.getCell(4).setValue(G)}else D.setValue(null),q.getCell(4).setValue(null);e.checkError();e.firePreviewRefreshWithOnlyRepaint(!1)}}}
function $b(){Bc.call(this);var la=this,Z=this.protectedMethod,ta,e;this.protectedInit=function(g){};this.protectedUpdateUi=function(g){var a=la.getJqUi();a.empty();if(g){ta=null;if(g.getSource){var c=g.getSource();ta=bc.createFilterUIRender(c.getTypeName())}ta||(ta=new ab);ta.setFunGetGlobalDependence(Z.getGlobalDependence);ta.setFunCheckError(h);ta.setFunGetCurrentEntity(Z.getCurrentEntity);ta.setFunFirePreviewRefreshWithOnlyRepaint(Z.firePreviewRefreshWithOnlyRepaint)}else e||(e=new xb,e.setFunGetGlobalDependence(Z.getGlobalDependence),
e.setFunCheckError(h),e.setFunGetCurrentEntity(Z.getCurrentEntity),e.setFunFirePreviewRefreshWithOnlyRepaint(Z.firePreviewRefreshWithOnlyRepaint)),ta=e;ta.getJqUi().appendTo(a);ta.updateUi(g)};this.afterResize=function(){ta.afterResize()};this.into=function(){la.protectedUpdateUi(Z.getCurrentEntity());h()};this.locateToErrorRow=function(g,a){ta.locateToErrorRow(g,a)};var h=function(){var g=Z.getCurrentEntity(),a=new La;a.setFromFilterPane(!0);(g=a.checkEntityFilters(g))?la.locateToErrorRow(g.getFiltersErrorRow(),
g.getPrompt()):la.locateToErrorRow(-1)}}function Ib(){function la(C,Q,fa){var R=this,K;this.setTabLevel=function(xa){K=xa};this.getTabLevel=function(){return K};this.getParentProperty=function(){return fa};this.getEntity=function(){return C};this.getProperty=function(){return Q};this.isTitleItem=function(){return Q?Q.hasChild():!0};this.isEquals=function(xa){return xa instanceof la?xa.getEntity()==R.getEntity()&&xa.getProperty()==R.getProperty():!1}}var Z=this,ta,e,h=$("<div>"),g=$("<div>"),a=new ed,
c=new xc,k=new ed,d=new xc,f=new ed,b=new v,r=new v,m,t,A=new pb,E=new pb,M={},z,H=!1,x=!1,q=!0;this.setEditable=function(C){q=C};this.setDirtyListener=function(C){ta=C};this.setRelationChangeListener=function(C){z=C};this.setModifyMode=function(C){C=C?!1:!0;a.getJqUi().css("display",C?"block":"none");k.getJqUi().css("display",C?"block":"none");h.css("display",C?"none":"block");g.css("display",C?"none":"block")};this.setModifyInnerRelationMode=function(C){x=C;Z.setModifyMode(C);c.setEnabled(!1);d.setEnabled(!1);
f.setEnabled(!1)};this.bindModel=function(C){t=C};this.initPropItemModels=function(){for(var C=t.copyEntityArray(),Q=0;Q<C.length;Q++){var fa=C[Q].getTopParentEntity(),R=wa(fa);M[fa.getName()]=R}};this.setEntities=function(C){for(var Q=[],fa=0;fa<C.length;fa++){var R=C[fa];R.isSubNodeAtView()||Q.push(R)}a.setItemModels(Q);k.setItemModels(Q)};var D=function(C,Q){var fa=M[C.getName()];fa||(fa=wa(C),M[C.getName()]=fa);for(var R=0;R<fa.length;R++){var K=fa[R];if(K.getEntity().getName()==C.getName()&&
K.getProperty()&&K.getProperty().getName()==Q.getName())return K}return new la(C,Q)};this.setRelation=function(C){m=C;h.empty();g.empty();var Q=C?!0:!1;if(Q){var fa=x?C.getFromEntity():C.getFromEntity().getTopParentEntity(),R=x?C.getToEntity():C.getToEntity().getTopParentEntity();jb(!0,h,fa);jb(!0,g,R);x&&(c.setEnabled(!1),d.setEnabled(!1),f.setEnabled(!1))}H=!0;a.setSelected(Q?C.getFromEntity().getTopParentEntity():null);c.setSelectedModel(Q?D(C.getFromEntity(),C.getFromProperty()):null);k.setSelected(Q?
C.getToEntity().getTopParentEntity():null);d.setSelectedModel(Q?D(C.getToEntity(),C.getToProperty()):null);f.setSelected(Q?C.getRelated():null);H=!1;b.setChecked(Q?C.isFromPointKeepFifthWheel():!1);r.setChecked(Q?C.isToPointKeepFifthWheel():!1)};this.getRelation=function(){return m};this.createJqUi=function(){f.setItemModels([Y.R_1_1,Y.R_1_N,Y.R_N_1]);f.setCustomPainter(aa);f.addSelectedChangedListener(u);var C=f.getJqUi();a.setCustomPainter(jb);a.addSelectedChangedListener(db);c.setCustomPainter(P);
c.setDropdownCreator(G);c.addSelectionListener(function(w){na(w)});k.setCustomPainter(jb);k.addSelectedChangedListener(db);d.setCustomPainter(P);d.setDropdownCreator(ca);d.addSelectionListener(function(w){na(w)});b.setText(U.get("keepFifthWheel","\u4fdd\u7559\u65e0\u6cd5\u5173\u8054\u7684\u884c"));b.setEnabled(q);b.addCheckedListener(L);r.setText(U.get("keepFifthWheel","\u4fdd\u7559\u65e0\u6cd5\u5173\u8054\u7684\u884c"));r.setEnabled(q);r.addCheckedListener(L);var Q=a.getJqUi(),fa=c.getJqUi(),R=b.getJqUi(),
K=k.getJqUi(),xa=d.getJqUi(),Ka=r.getJqUi();e=$("<div>");e.append(h);e.append(g);e.append(Q);e.append(fa);e.append(R);e.append(K);e.append(xa);e.append(Ka);e.append(C);h.addClass("dm-relation-setting-from1");Q.addClass("dm-relation-setting-from1");fa.addClass("dm-relation-setting-from2");R.addClass("dm-relation-setting-from3");C.addClass("dm-relation-setting-related");g.addClass("dm-relation-setting-to1");K.addClass("dm-relation-setting-to1");xa.addClass("dm-relation-setting-to2");Ka.addClass("dm-relation-setting-to3");
return e};var G=function(C,Q,fa){var R=Z.getRelation();R=wa(R.getFromEntity().getTopParentEntity());E.setItemModel(R);E.setSearchListener(y);E.setListItemPainter(Qb);E.setShowFieldNameListener(za);return E.createJqPopup(C,Q,fa)},ca=function(C,Q,fa){var R=Z.getRelation();R=wa(R.getToEntity().getTopParentEntity());A.setItemModel(R);A.setSearchListener(y);A.setListItemPainter(Qb);A.setShowFieldNameListener(za);return A.createJqPopup(C,Q,fa)},y=function(C,Q,fa,R,K,xa){Q=Q.toLowerCase();K=!0;for(var Ka,
w=0;w<C.length;w++){var N=C[w].getProperty();if(Ka=N&&-1!=N.getAlias().toLowerCase().indexOf(Q)?!0:N&&xa&&-1!=N.getName().toLowerCase().indexOf(Q)?!0:!1){K=!1;Ka=C[w].getEntity();N.setFieldVisible(!0);N.getParent()&&N.getParent().setFieldVisible(!0);if(N.hasChild()&&(N=Ka.getTreeRootProp(N))){N=N.getChildren();for(var qa=0;qa<N.length;qa++)N[qa].setFieldVisible(!0)}Ka.setFieldVisible(!0);for(Ka=Ka.getParentEntity();Ka;)Ka.setFieldVisible(!0),Ka=Ka.getParentEntity()}}fa.children().remove();if(K)C=
new l,C.setText(U.get("nothingSearched","\u627e\u4e0d\u5230\u7b26\u5408\u7684\u7ed3\u679c")),C.setEnabled(!1),C.setAlign(l.ALIGN_CENTER),C=C.getJqUi(),C.addClass("dm-field-popup-search-result"),C.appendTo(fa);else for(w=0;w<C.length;w++)Qb(C[w],fa,R,!0);za(fa,xa)},P=function(C,Q){if(C){var fa=C.getEntity(),R=C.getProperty(),K="";t.isEntityWithSubNodes(fa.getTopParentEntity())&&(K=K+fa.getAlias()+".");C.getParentProperty()&&(K=K+C.getParentProperty().getAlias()+".");K+=R.getAlias();Q.text(K);Q.attr("title",
K)}else Q.text("")},aa=function(C,Q,fa){switch(fa){case Y.R_1_1:Q.text(U.get("oneToOne","\u4e00\u5bf9\u4e00"));break;case Y.R_1_N:Q.text(U.get("oneToN","\u4e00\u5bf9\u591a"));break;case Y.R_N_1:Q.text(U.get("nToOne","\u591a\u5bf9\u4e00"));break;default:Q.text("")}},jb=function(C,Q,fa){if(fa){C=Yb.entity2IconName(fa);var R=$("<div>");R.addClass("dm-relation-setting-item-icon");rb.background(R,C);R.appendTo(Q);C=$("<div>");C.addClass("dm-relation-setting-item-text");C.text(fa.getAlias());C.appendTo(Q)}},
Qb=function(C,Q,fa,R){if(C){if(C.getProperty()){var K=C.getProperty();var xa=K.getFieldVisible();K.setFieldVisible(!1)}else K=C.getEntity(),xa=K.getFieldVisible(),K.setFieldVisible(!1);R=!xa&&R?!1:!0}else R=!1;if(R){R=$("<div>");R.data("model",C);K=C.getEntity();var Ka=C.getProperty();if(C.isTitleItem())Ka?(R.addClass("dm-field-popup-list-item-title"),xa=Yb.getTreePropIconName(),Ka=Ka.getAlias(),K=$("<div>")):(R.addClass("dm-field-popup-list-item-title"),xa=Yb.entity2IconName(K),Ka=K.getAlias(),K=
$("<div>")),K.addClass("dm-relation-setting-item-text"),K.text(Ka);else{R.addClass("dm-field-popup-list-item");xa=Ka.getOutputDataType();xa=Yb.dataType2IconName(xa);K=$("<div>");K.addClass("dm-relation-setting-item-text");K.addClass("dm-field-popup-list-item-field-text");var w=Ka.getAlias(),N=$("<span>");N.text(w);N.attr("title",w);N.addClass("dm-field-popup-list-item-text");Ka=Ka.getFormula()?Ka.getAlias():Ka.getName();w=$("<span>");w.addClass("dm-field-popup-list-item-field-name");w.text("("+Ka+
")");K.append(N);K.append(w)}K.appendTo(R);R.appendTo(Q);0<C.getTabLevel()&&R.css("margin-left",20*C.getTabLevel());K=$("<div>");K.addClass("dm-relation-setting-item-icon");rb.background(K,xa);K.appendTo(R);fa&&fa.isEquals(C)&&Na(Q,R)}},za=function(C,Q){if(Q)for(C=C.find(".dm-field-popup-list-item-field-name"),Q=0;Q<C.length;Q++){var fa=C.eq(Q);fa.css("display","inline-block");var R=fa.prev().text()+fa.text();fa.prev().attr("title",null);fa.parent().attr("title",R)}else for(C=C.find(".dm-field-popup-list-item-field-name"),
Q=0;Q<C.length;Q++)fa=C.eq(Q),fa.css("display","none"),fa.parent().attr("title",null),fa.prev().attr("title",fa.prev().text())},Na=function(C,Q){var fa=null;0<C.height()?(clearTimeout(fa),Q.addClass("dm-list-item_selected_enabled"),C.prop("scrollTop",Q.prop("offsetTop"))):fa=setTimeout(function(){Na(C,Q)},0)},wa=function(C){var Q=[];C=t.getEntityWithSubNodes(C);if(1==C.length)Ca(C[0],Q);else for(var fa=0;fa<C.length;fa++){var R=C[fa],K=new la(R,null);K.setTabLevel(R.getSubNodeLevel());Q.push(K);Ca(R,
Q)}return Q},Ca=function(C,Q){for(var fa=C.getChooseRelationProperties(),R=t.isEntityWithSubNodes(C.getTopParentEntity())?C.getSubNodeLevel():-1,K=0;K<fa.length;K++){var xa=fa[K];if(xa.hasChild()){var Ka=new la(C,xa);Ka.setTabLevel(R+1);Q.push(Ka);var w=C.getTreeRootProp(xa);if(w&&w.getTreeType()==ac.TREE_TYPE_FLEX&&(w=w.getChildren())&&0<w.length)for(var N=0;N<w.length;N++){var qa=new la(C,w[N],xa);qa.setTabLevel(Ka.getTabLevel()+1);Q.push(qa)}}else xa.isHideInDataModeling()||(xa=new la(C,xa),xa.setTabLevel(R+
1),Q.push(xa))}},db=function(C,Q,fa){H||((C==a?c:d).setSelectedModel(null),m&&(C==a?(m.setFromEntity(fa),m.setFromProperty(null)):(m.setToEntity(fa),m.setToProperty(null))),ta&&ta())},na=function(C){var Q=C.getSelectedModel();!H&&Q&&(m&&(C==c?(m.setFromEntity(Q.getEntity()),m.setFromProperty(Q.getProperty())):(m.setToEntity(Q.getEntity()),m.setToProperty(Q.getProperty()))),ta&&ta())},u=function(C,Q,fa){H||(m&&m.setRelated(fa),ta&&ta())},L=function(C,Q){Q&&(C==b?(m.setFromPointKeepFifthWheel(C.isChecked()),
z&&z(m,Y.KEY_FROM_ENTITY,C.isChecked())):C==r&&(m.setToPointKeepFifthWheel(C.isChecked()),z&&z(m,Y.KEY_TO_ENTITY,C.isChecked())),ta())}}function Vb(){B.call(this);var la=this,Z=this.protectedMethod,ta=new Ib,e=$("<div>"),h;this.prepare=function(f,b){h=f;b=new Y;b.setRelated(Y.R_1_1);for(var r=f.copyEntityArray(),m=0;m<r.length-1;m++)for(var t=m+1;t<r.length;t++){var A=r[m],E=r[t];if(!A.isSubNodeAtView()&&!E.isSubNodeAtView()&&f.isNewRelationCreatable(A.getName(),E.getName())){b.setFromEntity(A);m=
A.getChooseRelationProperties();b.setFromProperty(null!=m&&0<m.length?m[0]:null);b.setToEntity(E);E=E.getChooseRelationProperties();b.setToProperty(null!=E&&0<E.length?E[0]:null);m=r.length;break}}ta.bindModel(f);ta.setEntities(r);ta.initPropItemModels();ta.setRelation(b);k();Z.setContentPaneCreator(g);Z.setClosingChecker(a);Z.setClosingAction(c);Z.setTitle(U.get("createRelation","\u65b0\u5efa\u5173\u7cfb"));la.setSize(640,360)};var g=function(){e.addClass("dm-relation-dialog-prompt");ta.setModifyMode(!1);
ta.setDirtyListener(k);var f=ta.createJqUi();f.addClass("dm-relation-dialog-setting");var b=$("<div>");b.append(f);b.append(e);return b},a=function(){return!k()},c=function(f){f&&(f=ta.getRelation(),h.addRelation(f))},k=function(){e.empty();var f=!1,b=ta.getRelation(),r=b.getFromEntity().getName(),m=b.getToEntity().getName(),t=b.getFromEntity().getAlias(),A=b.getToEntity().getAlias();r==m?(r=U.get("forbidRelateToItself","\u4e0d\u5141\u8bb8\u521b\u5efa\u6570\u636e\u8868\u4e0e\u5176\u81ea\u8eab\u7684\u5173\u7cfb\uff0c\u8bf7\u9009\u62e9\u4e24\u4e2a\u4e0d\u540c\u7684\u6570\u636e\u8868\u3002"),
d(!0,r),f=!0):h.isRelationExist(r,m)?(r=U.get("relationExist","\u5df2\u5b58\u5728\u201c#1\u201d\u548c\u201c#2\u201d\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u4e0d\u80fd\u91cd\u590d\u521b\u5efa\u3002"),r=r.replace("#1",t),r=r.replace("#2",A),d(!0,r),f=!0):h.isNewRelationCreatable(r,m)||(r=U.get("ringlikeRelation","\u7531\u4e8e\u53ef\u80fd\u4f7f\u5df2\u5b58\u5728\u7684\u5173\u7cfb\u5f62\u6210\u73af\u72b6\uff0c\u4e0d\u5141\u8bb8\u521b\u5efa\u201c#1\u201d\u548c\u201c#2\u201d\u4e4b\u95f4\u7684\u5173\u7cfb\u3002"),
r=r.replace("#1",t),r=r.replace("#2",A),d(!0,r),f=!0);t=b.getFromProperty();b=b.getToProperty();t&&b?t.getOutputDataType()!=b.getOutputDataType()&&(r=U.get("inconsistentDataType","\u4e24\u4e2a\u5b57\u6bb5\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u4e00\u81f4\u3002\u5982\u679c\u786e\u8ba4\u6ca1\u6709\u903b\u8f91\u95ee\u9898\uff0c\u53ef\u4ee5\u5ffd\u7565\u6b64\u8b66\u544a\u3002"),d(!1,r)):(r=U.get("fieldIncomplete","\u5b57\u6bb5\u4e0d\u5b8c\u6574\u3002"),d(!0,r),f=!0);return f},d=function(f,b){var r=$("<div>");
r.text("!");r.addClass("dm-relation-dialog-promptitem-icon");r.addClass("dm-relation-dialog-promptitem-icon-"+(f?"err":"warn"));f=$("<div>");f.addClass("dm-relation-dialog-promptitem-text");f.text(b);var m=$("<div>");m.addClass("dm-relation-dialog-promptitem");m.append(r);m.append(f);setTimeout(function(){e.append(m)},100)}}function Xa(){B.call(this);var la=this,Z=this.protectedMethod,ta,e,h,g=new Ib,a,c={},k={},d,f=[],b;this.prepare=function(y,P,aa,jb){ta=y;e=P;b=jb;g.setEditable(b);h=aa;g.bindModel(ta);
g.setModifyInnerRelationMode(!0);g.setDirtyListener(r);g.setRelationChangeListener(m);Z.setContentPaneCreator(t);Z.setClosingChecker(function(){return!0});Z.setClosingAction(function(Qb){if(Qb)for(var za in k){Qb=k[za];var Na=c[Qb.getFromEntity().getName()+Qb.getToEntity().getName()];Na.setFromPointKeepFifthWheel(Qb.isFromPointKeepFifthWheel());Na.setToPointKeepFifthWheel(Qb.isToPointKeepFifthWheel())}});b?Z.setTitle(U.get("editInnerRelation","\u7f16\u8f91\u5185\u90e8\u5173\u7cfb")):Z.setTitle(U.get("checkInnerRelation",
"\u67e5\u770b\u5185\u90e8\u5173\u7cfb"));la.setSize(920,570)};var r=function(){h.setDirty(!0)},m=function(y,P,aa){y=y.getToEntity();if(y.isUnion()&&y.getUnionType()==Ub.BIZ_UNION){var jb=y.getTopParentEntity();jb=ta.getBizUnionInnerEntityRelations(jb.getName());for(var Qb in jb){var za=jb[Qb];-1<y.indexOfEntity(za.getToEntity())&&(P==Y.KEY_FROM_ENTITY&&za.setFromPointKeepFifthWheel(aa),P==Y.KEY_TO_ENTITY&&za.setToPointKeepFifthWheel(aa))}}},t=function(){var y=$("<div>");d=$("<div>");d.addClass("dm-relation-list");
var P=g.createJqUi();P.addClass("dm-entity-inner-relation-rightside");var aa=$("<div>");aa.addClass("dm-entity-inner-relation-rightside-div");aa.append(P);P=new yc;P.setHorizontalSplit(!0);P.setEnabled(!0);P.setFirstSize(200,160,300);P.setSecondSize(660,0,-1);P.setResizeMode(yc.RESIZE_MODE_FIRST_FIXED);P.setFirstChild(yc.createChildWrapper(d));P.setSecondChild(yc.createChildWrapper(aa));aa=$(document.createDocumentFragment());for(var jb,Qb=0,za=ta.getRelationCount();Qb<za;Qb++){var Na=ta.getRelationByIndex(Qb);
!ta.isRelationInsideSubSystem(Na)||Na.getFromEntity().getTopParentEntity()!=e&&Na.getToEntity().getTopParentEntity()!=e||(jb||(jb=Na.clone()),c[Na.getFromEntity().getName()+Na.getToEntity().getName()]=Na,Na=Na.clone(),f[Qb]=Na,aa.append(H(Na)))}d.empty();d.append(aa);jb&&D(jb);jb=P.getJqUi();y.append(jb);return y},A=function(){d.find(".dm-relation-list-item").remove();for(var y=0,P=f.length;y<P;y++){var aa=f[y];aa&&(c[aa.getFromEntity().getName()+aa.getToEntity().getName()]=aa,aa=aa.clone(),f[y]=
aa,d.append(H(aa)),D(a))}},E=function(y){y=$(y.currentTarget);var P=q(y.parent().parent());for(y=0;y<f.length;y++)if(f[y]&&P){var aa=f[y].getFromEntity(),jb=f[y].getToEntity(),Qb=P.getFromEntity(),za=P.getToEntity();if(aa.getName()==Qb.getName()&&jb.getName()==za.getName()&&(aa=z(y,!1),-1<aa)){P=aa;aa=f[y];f[y]=f[P];f[P]=aa;A();break}}},M=function(y){y=$(y.currentTarget);var P=q(y.parent().parent());for(y=0;y<f.length;y++)if(f[y]&&P){var aa=f[y].getFromEntity(),jb=f[y].getToEntity(),Qb=P.getFromEntity(),
za=P.getToEntity();if(aa.getName()==Qb.getName()&&jb.getName()==za.getName()&&(aa=z(y,!0),-1<aa)){P=aa;aa=f[y];f[y]=f[P];f[P]=aa;A();break}}},z=function(y,P){if(P)for(y+=1;y<f.length;y++){if(f[y])return y}else for(--y;0<=y;y--)if(f[y])return y;return-1},H=function(y){var P=y.getFromEntity(),aa=y.getToEntity();y=$("<div>");y.addClass("dm-relation-list-item");var jb=P.getName(),Qb=aa.getName();y.attr("datamodeling-name1",Wa.encode(jb));y.attr("datamodeling-name2",Wa.encode(Qb));y.on("mousedown",x);
y.on("mouseenter",G);y.on("mouseleave",ca);jb=$("<div>");jb.addClass("dm-relation-list-item-icon");rb.background(jb,"relation");Qb=$("<div>");Qb.addClass("dm-relation-list-item-text");Qb.css("right","5px");Qb.text(P.getAlias()+"-"+aa.getAlias());P=$("<div>");P.addClass("dm-relation-list-item-up-down");aa=$("<div>");aa.attr("title",U.get("moveUpRelation","\u4e0a\u79fb"));aa.addClass("dm-relation-list-item-up");rb.background(aa,"up_move");aa.on("click",E);P.append(aa);aa=$("<div>");aa.attr("title",
U.get("moveDownRelation","\u4e0b\u79fb"));aa.addClass("dm-relation-list-item-down");rb.background(aa,"down_move");aa.on("click",M);P.append(aa);y.append(jb);y.append(Qb);return y},x=function(y){y=$(y.currentTarget);y=q(y);a!=y&&D(y)},q=function(y){var P=Wa.decode(y.attr("datamodeling-name1"));y=Wa.decode(y.attr("datamodeling-name2"));return k[P+y]?k[P+y]:ta.getRelationByEntitiesName(P,y).clone()},D=function(y){a=y;k[y.getFromEntity().getName()+y.getToEntity().getName()]=y;y=d.find(".dm-relation-list-item");
y.removeClass("dm-relation-list-item_selected");for(var P=0;P<y.length;P++){var aa=$(y[P]),jb=aa.find(".dm-relation-list-item-icon");rb.background(jb,"relation");jb=aa.find(".dm-relation-list-item-up");rb.background(jb,"up_move");aa=aa.find(".dm-relation-list-item-down");rb.background(aa,"down_move")}a&&(P=a,y=P.getFromEntity().getName(),P=P.getToEntity().getName(),y=d.find("[datamodeling-name1='"+Wa.encode(y)+"'][datamodeling-name2='"+Wa.encode(P)+"']"),y.addClass("dm-relation-list-item_selected"),
P=y.find(".dm-relation-list-item-icon"),rb.background(P,"relation_selected"),jb=y.find(".dm-relation-list-item-up"),rb.background(jb,"up_move_selected"),aa=y.find(".dm-relation-list-item-down"),rb.background(aa,"down_move_selected"));g.setRelation(a)},G=function(y){y=$(y.currentTarget);if(0<y.prev().length){var P=y.find(".dm-relation-list-item-up");P&&P.css("display","block")}0<y.next().length&&(y=y.find(".dm-relation-list-item-down"))&&y.css("display","block")},ca=function(y){y=$(y.currentTarget);
var P=y.find(".dm-relation-list-item-up");P&&P.css("display","none");(y=y.find(".dm-relation-list-item-down"))&&y.css("display","none")}}function ma(){B.call(this);var la=this,Z=this.protectedMethod,ta;this.edit=function(e,h,g){Z.setTitle(U.get("numberFormatOfField","\u5b57\u6bb5[#1]\u7684\u6570\u5b57\u683c\u5f0f").replace("#1",e));ta||(ta=new Db,la.setSize(428,257),Z.setContentPaneCreator(function(){return ta.getJqUi()}),Z.setClosingChecker(ta.isValidToAccepted),Z.setClosingAction(function(a){a&&
(a=ta.getModel().encode(),g(a))}));e=new ec;e.decode(h?h:"#,##0");ta.setModel(e)}}function Lb(){function la(){V.FieldsProvider.call(this);var b=this.protectedMethod,r=new Z;(function(){r.setCustomItemPainter(function(m,t){var A=Yb.dataType2IconName(t.getOutputDataType()),E=$("<div>");E.addClass("dm-customfield-fields-icon");rb.background(E,A);E.appendTo(m);A=$("<div>");A.addClass("dm-customfield-fields-text");A.text(t.getAlias());A.appendTo(m)});r.addDBLClickListener(function(m){m="["+m.getSelecteds()[0].getAlias()+
"]";b.fireChoosingEvent(m)})})();this.setAllFields=function(m){r.setAllFields(m)};this.getJqUi=function(){return r.getJqUi()}}function Z(){var b,r=$("<div>"),m,t;this.setAllFields=function(A){b=A};this.getJqUi=function(){var A=$("<div>"),E=new qb;E.setSearchListenerDelay(200);E.setPlaceholder(U.get("search","\u641c\u7d22"));E.addSearchListener(function(){var z=E.getText().trim(),H=new Ec;if(z){var x=[],q;for(q in b){var D=b[q];0<=D.getAlias().toUpperCase().indexOf(z.toUpperCase())&&x.push(D)}r.empty();
0<x.length?H.setItemModels(x):(z=new l,z.setText(U.get("nothingSearched","\u627e\u4e0d\u5230\u7b26\u5408\u7684\u7ed3\u679c")),z.setEnabled(!1),z.setAlign(l.ALIGN_CENTER),z=z.getJqUi(),z.addClass("dm-field-popup-search-result"),z.appendTo(r))}else r.empty(),H.setItemModels(b);H.addDBLClickListener(m);H.setCustomItemPainter(t);H.getJqUi().appendTo(r)});var M=E.getJqUi();M.addClass("dm-customfield-fields-search");M.appendTo(A);M=new Ec;M.setItemModels(b);M.addDBLClickListener(m);M.setCustomItemPainter(t);
r.addClass("dm-customfield-fields-list");M.getJqUi().appendTo(r);r.appendTo(A);return A};this.setCustomItemPainter=function(A){t=A};this.addDBLClickListener=function(A){m=A}}B.call(this);var ta=this,e=this.protectedMethod,h=new V,g,a,c;(function(){ta.setSize(800,570);e.setSelectable(!0);e.setContentPaneCreator(function(){return h.getJqUi()});e.setClosingChecker(function(){return h.isValidToAccepted()});e.setClosingAction(function(b){b&&(h.acceptEditing(),c.setAlias(h.getEditedDisplayName()),c.setFormula(h.getEditedExecutableFormula()),
g())});h.setFunctionsProviderCreator(function(b){return b.getInstanceForDataModeling()});h.setDuplicatedNameChecker(function(b,r){a:{for(var m=0;m<a.length;m++){var t=a[m];if(b!=t.getName()&&r==t.getAlias()){b=!0;break a}}b=!1}return b});h.setDisplayNameTranslator(function(b,r){return r?d(b):k(b)})})();this.setSyntaxValidator=function(b){h.setSyntaxValidator(b)};this.setContext=function(b,r,m){a=b;c=r;e.setTitle(m?U.get("modifyCustomField","\u7f16\u8f91\u8ba1\u7b97\u5b57\u6bb5"):U.get("addCustomField",
"\u65b0\u5efa\u8ba1\u7b97\u5b57\u6bb5"))};this.edit=function(b){g=b;b=new la;b.setAllFields(a);h.setFieldsProvider(b);h.setEditingTarget(c.getName(),c.getAlias(),c.getFormula());ta.showDialog();h.prepareToStart()};var k=function(b){return f(b,function(r){return r.getAlias()},function(r){return r.getName()})},d=function(b){return f(b,function(r){return r.getName()},function(r){return r.getAlias()})},f=function(b,r,m){for(var t={},A=0;A<a.length;A++){var E=a[A],M="["+r(E)+"]";E="["+m(E)+"]";if(M!=E)for(var z=
null;-1!=b.indexOf(M);)z||(z="["+eb.createUUID()+"]",t[z]=E),b=b.replace(M,z)}for(z in t)for(E=t[z];-1!=b.indexOf(z);)b=b.replace(z,E);return b}}function hc(){B.call(this);var la=this,Z=this.protectedMethod,ta,e,h,g=[],a=[],c=[],k=[];this.setEntity=function(b){};this.setAllProperties=function(b){g=b};this.setSelectedProperties=function(b){a=b};this.setLockSelectedFieldNames=function(b){c=b};this.setAllRelationPropName=function(b){k=b};this.setConfirmListener=function(b){e=b};this.setClosingCheckListener=
function(b){h=b};this.initUi=function(){Z.setTitle(U.get("selectField","\u9009\u62e9\u5b57\u6bb5"));if(!ta){ta=new Sa;ta.setChoiceField(!0);ta.setAllField(g);var b=[],r=!0;for(t in a)-1<g.indexOf(a[t])&&b.push(a[t].getName());for(var m in c){var t=c[m];var A=!1,E;for(E in g){var M=g[E];if(M&&M.getName()==t){A=!0;break}}if(!A){r=!1;break}}ta.setSelectedFieldName(b);ta.setLockSelectedFieldNames(c&&r?c:[]);ta.setAllRelationPropNames(k?k:[]);la.setSize(640,480);Z.setContentPaneCreator(function(){return ta.getJqUi()});
Z.setClosingAction(d);Z.setClosingChecker(function(z){var H=ta.getSelectedFieldName();c=c?c:[];var x=[],q;for(q in H){var D=H[q];0>c.indexOf(D)&&x.push(D)}0==x.length?(0==c.length?Z.getMessageCurtain().showPrompt(U.get("atLeastSelectAField","\u81f3\u5c11\u9009\u4e2d\u4e00\u4e2a\u5b57\u6bb5\u3002")):Z.getMessageCurtain().showPrompt(U.get("atLeastSelectAFieldExceptLockField","\u9664\u4e86\u9501\u5b9a\u7684\u5173\u8054\u5b57\u6bb5\uff0c\u81f3\u5c11\u9009\u4e2d\u4e00\u4e2a\u5b57\u6bb5\u3002")),z(!1)):
(H=[],f(H,[]),h&&h(H,z,Z.getMessageCurtain()))},!0)}};var d=function(b){if(b){b=[];var r=[];f(b,r);e(b,r)}},f=function(b,r){for(var m=g,t=ta.getSelectedFieldName(),A=a,E={},M=0;M<A.length;M++){var z=A[M];E[z.getAssociateName()]=z}for(M in m)0<=t.indexOf(m[M].getName())?(b.push(m[M]),E[m[M].getAssociateName()]||Gb.confirmDefaultFormatString(m[M])):r.push(m[M])}}function Mb(){B.call(this);var la=this,Z=this.protectedMethod,ta,e,h,g,a;this.setInitValue=function(f,b,r){e=f;h=b;g=r};this.setConfirmListener=
function(f){a=f};this.initUi=function(){var f=h.getName();sSqlType=h.getSource().getUserSql(f).getSqlType();f=U.get("editSql","\u7f16\u8f91")+sSqlType;Z.setTitle(f);la.setSize(960,540);Z.setContentPaneCreator(c);Z.setClosingAction(k);Z.setClosingChecker(d,!0);Z.setSelectable(!0)};var c=function(){var f=h.getName(),b=h.getSource().getUserSql(f).getSqlType(),r=h.getSource().getUserSql(f).getContent(),m=new ya;m.setName(f);m.setSqlType(b);m.setContent(r);ta=new cd;h.getSource().getConnectionType()==
Aa.DBCONNECTION_TYPE_SUPERQUERY&&ta.setIsShowTips(!0);ta.setUserSqlObjModel(m);ta.setFacadeCreator(g.createFacade);ta.setAlias(h.getAlias());ta.setMessageCurtain(Z.getMessageCurtain());return ta.getJqUi()},k=function(f){f&&a()},d=function(f){var b=h.getName(),r=ta.check();if(r)Z.getMessageCurtain().showPrompt(r),f(!1);else{var m=h.getName(),t=h.getSource(),A=t.clone();A.setName(t.getName());A.removeUserSql(m);ta.asynGetUserSqlObjModel(function(E){A.addUserSql(E);ta.getDesigntimeDataObject(A,b,Z.getMessageCurtain(),
g.createFacade,function(M,z){var H=z;if(h.getAlias()!=z)for(var x=1;e.isEntityAliasExist(H);)H=z+"_"+x++;z={};z[t.getName()]=t;x=e.getEntityByName(b);x.setProperties([]);x.fromJsonObject(M.entities[0],z);x.setAlias(H);M=x.getProperties();for(H=0;H<M.length;H++)Gb.confirmDefaultFormatString(M[H]);t.removeUserSql(m);t.addUserSql(E);f(!0)},function(){f(!1)})})}}}function mb(){var la=[],Z,ta,e=[],h=[],g;this.setItemModel=function(d,f){g=f;la=d};this.setListItemPainter=function(d){};this.setSelectedItemModel=
function(d){e=d;h=e.slice(0)};this.setLastTimeSelectedModel=function(d){h=d};this.getSelectedItemModel=function(){return e};this.createJqPopup=function(d,f,b,r){Z=$("<div>");Z.appendTo(d);ta=$("<div>");Z.addClass("dm-field-popup");ta.addClass("dm-enum-popup-list-owner");for(d=0;d<la.length;d++)c(la[d],ta,f,!1);f=new Nc;f.setHighlight(!0);f.setText(U.get("ok","\u786e\u5b9a"));f=f.getJqUi();f.css("z-index",3);f.css("margin-left",10);Ya.layoutCtrlWithLRTB(f,"50%",null,80,null,8,28);f.on("click",function(m){h=
e.slice(0);b(e)});d=new Nc(U.get("cancle","\u53d6\u6d88"));d.setHighlight(!1);d=d.getJqUi();d.css("z-index",3);d.css("margin-left",-90);Ya.layoutCtrlWithLRTB(d,"50%",null,80,null,8,28);d.on("click",function(m){e=h.slice(0);r()});ta.appendTo(Z);f.appendTo(Z);d.appendTo(Z);ta.css("height","77%");return[-1,260]};var a=function(d,f){f=d.getUserObject();d=d.isChecked();f&&d?(d=k(f),0>d&&e.push(f)):f&&!d&&(d=k(f),-1<d&&e.splice(d,1))},c=function(d,f,b){var r=k(d);b=$("<div>");b.addClass("dm-field-popup-list-item");
b.data("model",d);var m=$("<div>"),t=new v;t.setUserObject(d);t.setChecked(-1<r);t.addCheckedListener(a);r=t.getJqUi();r.addClass("dm-fieldselection-checkbox-icon");r.data("model",t);t=$("<div>");t.text(d.fieldValue);t.addClass("dm-fieldselection-checkbox-text");m.append(r);m.append(t);b.append(m);f.append(b)},k=function(d){for(var f=0;f<e.length;f++)if(g(d,e[f]))return f;return-1}}function vc(){B.call(this);var la=this,Z=this.protectedMethod,ta,e,h,g,a,c;this.setInitValue=function(m,t,A){ta=m;e=
t;h=A};this.setConfirmListener=function(m){g=m};this.initUiShowDialog=function(){var m=Z.getMessageCurtain(),t=e.getSource(),A=e.getAssociateName(),E=t.getStoredProcedure(A);A=E.getAssociateName();var M=U.get("editStoredProcedure","\u7f16\u8f91\u5b58\u50a8\u8fc7\u7a0b")+" "+A;Z.setTitle(M);la.setSize(560,540);Z.setClosingAction(d);Z.setClosingChecker(f,!0);M=h.createFacade(function(z){for(var H={},x=E.getParameters(),q=0;q<x.length;q++){var D=x[q].getName();H[D]=x[q].getValue()}x=[];for(q=0;q<z.length;q++){var G=
new Ia;G.fromJsonObject(z[q]);D=G.getName();(D=H[D])&&G.setValue(D);x.push(G)}z=new Qa;z.fromJsonObject(E.toJsonObject());z.setParameters(x);a=new Pa;a.setInitValue(z,t,h.createFacade,m);a.setCallbackDesignTimeDataObject(k);Z.setContentPaneCreator(function(){var ca=a.getJqUi();ca.css("left","0px");ca.css("right","0px");return ca});la.showDialog();a.refreshTable()},function(z,H,x){x=z.toString();return"20"==x.substr(0,2)&&7==x.length&&209E4!=z?(m.showError(H),!0):!1});M.setShowBlocking(!1);M.getStoredProcedureParameters(t.toJsonObject(),
A)};var k=function(m,t){c=t},d=function(m){m&&g()},f=function(m){var t=e.getSource();e.getName();var A=e.getProperties(),E=e.getAlias(),M=e.getAssociateName();t.getStoredProcedure(M);var z=a.getStoredProcedureModel();if(c){var H=c.getFisrtEntity();H.setAlias(E);var x=H.getProperties();x=b(A,x);H.setProperties(x);for(var q=H.getProperties(),D=0;D<q.length;D++)Gb.confirmDefaultFormatString(q[D]);ta.refreshEntity(H);r(A,x)?z.getIsChange()&&h.getMessageCurtain().showPrompt(U.get("storedProcedureSetChangeTips",
"\u60a8\u4fee\u6539\u4e86\u5b58\u50a8\u8fc7\u7a0b\u8bbe\u7f6e\uff0c\u6570\u636e\u7ed3\u679c\u96c6\u53ef\u80fd\u53d1\u751f\u53d8\u52a8\uff0c\u60a8\u4e5f\u53ef\u4ee5\u91cd\u65b0\u8bbe\u7f6e\u5b57\u6bb5\u3002")):h.getMessageCurtain().showPrompt(U.get("propertiesChangeTips","\u6570\u636e\u5b57\u6bb5\u5df2\u53d1\u751f\u53d8\u52a8\uff0c\u5df2\u5220\u9664\u4e86\u90e8\u5206\u539f\u5b57\u6bb5\uff0c\u60a8\u4e5f\u53ef\u4ee5\u91cd\u65b0\u8bbe\u7f6e\u5b57\u6bb5\u3002"));m(!0)}else z.setName(M),H=t.clone(),H.setName(t.getName()),
H.removeStoredProcedure(M),H.addStoredProcedure(z),h.createFacade(function(G){var ca={};ca[t.getName()]=t;var y=new wb;y.fromJsonObject(G,ca);G=y.getFisrtEntity();G.setAlias(E);ca=G.getProperties();y=b(A,ca);G.setProperties(y);y=G.getProperties();for(var P=0;P<y.length;P++)Gb.confirmDefaultFormatString(y[P]);ta.refreshEntity(G);r(e.getProperties(),ca)?z.getIsChange()&&h.getMessageCurtain().showPrompt(U.get("storedProcedureSetChangeTips","\u60a8\u4fee\u6539\u4e86\u5b58\u50a8\u8fc7\u7a0b\u8bbe\u7f6e\uff0c\u6570\u636e\u7ed3\u679c\u96c6\u53ef\u80fd\u53d1\u751f\u53d8\u52a8\uff0c\u60a8\u4e5f\u53ef\u4ee5\u91cd\u65b0\u8bbe\u7f6e\u5b57\u6bb5\u3002")):
h.getMessageCurtain().showPrompt(U.get("propertiesChangeTips","\u6570\u636e\u5b57\u6bb5\u5df2\u53d1\u751f\u53d8\u52a8\uff0c\u5df2\u5220\u9664\u4e86\u90e8\u5206\u539f\u5b57\u6bb5\uff0c\u60a8\u4e5f\u53ef\u4ee5\u91cd\u65b0\u8bbe\u7f6e\u5b57\u6bb5\u3002"));t.removeStoredProcedure(M);t.addStoredProcedure(z);m(!0)},function(G,ca,y){y=G.toString();return"20"==y.substr(0,2)&&7==y.length&&209E4!=G?(2020501==G&&(G=z.getAssociateName(),ca=-1==ca?U.get("notFindResult","\u6ca1\u6709\u83b7\u53d6\u5230\u5b58\u50a8\u8fc7\u7a0b#1\u7684\u7ed3\u679c\u96c6\u3002").replace("#1",
G):U.get("notFindIdxResult","\u6ca1\u6709\u83b7\u53d6\u5230\u5b58\u50a8\u8fc7\u7a0b#1\u7b2c#2\u4e2a\u7684\u7ed3\u679c\u96c6\u3002").replace("#1",G).replace("#2",ca)),Z.getMessageCurtain().showPrompt(ca),m(!1),!0):!1}).getDesigntimeDataObject(H.toJsonObject(),e.getAssociateName())},b=function(m,t){for(var A=[],E=[],M=0;M<t.length;M++)E.push(t[M].getName());for(M=0;M<m.length;M++)0<=E.indexOf(m[M].getName())&&A.push(m[M]);return A},r=function(m,t){if(m.length!==t.length)return!1;for(var A=[],E=0;E<
m.length;E++)A.push(m[E].getName());for(E=0;E<t.length;E++)if(-1==A.indexOf(t[E].getName()))return!1;return!0}}function Ob(){B.call(this);var la=this,Z=this.protectedMethod,ta=new l,e=new l,h=new ub,g,a;this.setCaption=function(d,f){Z.setTitle(d);ta.setText(f)};this.setText=function(d,f){h.setText(d);var b=0;d&&(d=d.split("\n").length,b=1E3<d?1E3:d);e.setText(b+"/1000\u9879");a=function(r){var m=r?$.trim(h.getText()):null;f(r,m)};Z.setClosingAction(a)};this.showDialogLeftAnchorTo=function(d){d&&(la.setSize(450,
430),d=Ya.upwardCoordinate(document.body,[0,0],document.body),la.setPosition(Math.max(0,d[0]-10),Math.max(6,d[1]-430+40)));h.addEditedListener(k);Z.setContentPaneCreator(c);la.showDialog();h.requestFocus()};this.setClosingChecker=function(d){d&&(g=function(){var f=d($.trim(h.getText()));f&&Z.getMessageCurtain().showPrompt(f);return f?!1:!0},Z.setClosingChecker(g))};var c=function(){e.setAlign(l.ALIGN_RIGHT);Ya.layoutCtrlWithLRTB(ta.getJqUi(),0,0,null,0,null,23);Ya.layoutCtrlWithLRTB(h.getJqUi(),0,
0,null,30,null,260);Ya.layoutCtrlWithLRTB(e.getJqUi(),290,0,null,287,null,23);var d=$("<div>");d.append(ta.getJqUi());d.append(h.getJqUi());d.append(e.getJqUi());return d},k=function(d){var f=d.getText(),b=[];f&&(b=f.trim().replace(/(\n\s*)+/g,"\n").split("\n"));f=b.length;1E3<f&&(d.setText(b.slice(0,1E3).join("\n")),f=1E3);e.setText(f+"/1000\u9879");Z.getMessageCurtain().hide()}}function Dc(){function la(za){KTDefaultCellRender.call(this,za);var Na=this,wa=this.paintCellUI;this.paintCellUI=function(w,
N){var qa=Na.getCellWidth(),Ma=Na.getCellHeight(),Hb=Na.getCurrentRow();if(Na.getCurrentRowIdx()<ha.getHeadRowCount()&&22==Hb.getHeight())if(1==Na.getCurrentColIdx()){var Rb=z(U.get("targetFieldName","\u76ee\u6807\u5c5e\u6027\u5217"),a.getFieldName());a.setFieldName(x(Rb));Ca(w,qa,Ma,Hb,Rb,!1,Na.getCurrentColIdx())}else 2==Na.getCurrentColIdx()?(4==za.getColumnsCount()?(Rb=4<za.getColumnsCount(),N=z(U.get("targetFieldValue","\u76ee\u6807\u503c\u5217"),a.getFieldValueName(Na.getCurrentColIdx()-2))):
(Rb=4<za.getColumnsCount(),N=z(U.get("targetFieldValue","\u76ee\u6807\u503c\u5217")+(Na.getCurrentColIdx()-1),a.getFieldValueName(Na.getCurrentColIdx()-2))),a.addFieldValueName(Na.getCurrentColIdx()-2,x(N)),Ca(w,qa,Ma,Hb,N,Rb,Na.getCurrentColIdx())):2<Na.getCurrentColIdx()&&Na.getCurrentColIdx()<za.getColumnsCount()-1?(Rb=4<za.getColumnsCount(),N=z(U.get("targetFieldValue","\u76ee\u6807\u503c\u5217")+(Na.getCurrentColIdx()-1),a.getFieldValueName(Na.getCurrentColIdx()-2)),a.addFieldValueName(Na.getCurrentColIdx()-
2,x(N)),Ca(w,qa,Ma,Hb,N,Rb,Na.getCurrentColIdx())):wa(w,N);else if(Rb=Na.getCurrentRowIdx()-3,1==Na.getCurrentColIdx()&&Na.getCurrentRowIdx()>=ha.getHeadRowCount()){w=$(w);Ma=w.find(".dm-common-tablecell-editable");N=Ma.eq(0);var Ic=!0;qa=Hb.getCell(1).getValue();0==Ma.length&&(Ic=!1,N=$("<div>"),N.addClass("dm-common-tablecell-editable"),w.css("cursor","pointer"),N.appendTo(w));N.text(qa);Ic&&(Rb=Na.getCurrentRowIdx()-3,(Ma=a.getColumnToRowPropertyItem(Rb))||(Ma=new Jb),Ma.setFieldName(qa),a.addColumnToRowPropertyItem(Rb,
Ma));P(w,Hb,za,Na.getCurrentColIdx(),Rb)}else Na.getCurrentRowIdx()>=ha.getHeadRowCount()&&1<Na.getCurrentColIdx()&&Na.getCurrentColIdx()<za.getColumnsCount()-1?(w=$(w),N=Hb.getCell(Na.getCurrentColIdx()).getValue(),fa(w,qa,Ma,N,Hb,Na.getCurrentRowIdx()-3,Na.getCurrentColIdx()),P(w,Hb,za,Na.getCurrentColIdx(),Rb)):(wa(w,N),P($(w),Hb,za,Na.getCurrentColIdx(),Rb))};var Ca=function(w,N,qa,Ma,Hb,Rb,Ic){var Yc=$(w),Ac=ha.createCtrlInCell(w,N,qa,l);Ac.setText(na(Hb));Ac.setUserObject(Ma);w=Ac.getJqUi();
w.css({"line-height":"28px",width:"100%"});w.find(".sa-ctrl-label-text").css("width","90%");N=$("<div>");rb.background(N,"btn_edit");N.css("left","90%");N.on("click",function(){db(Yc,Ac,Ic)});N.addClass("dm-entity-fieldtable-format-icon");N.appendTo(w);Rb&&(N.css("left","80%"),w.find(".sa-ctrl-label-text").css("width","80%"),Rb=$("<div>"),rb.background(Rb,"btn_delete"),Rb.css("left","90%"),Rb.addClass("dm-entity-fieldtable-format-icon"),Rb.on("click",function(){a.deleteFieldValueProperty(Ic-2);za.removeColumn(Ic)}),
Rb.appendTo(w));u(Yc,Ic,Hb)},db=function(w,N,qa){var Ma=new Uc;Ma.setSize(null,100);var Hb=new Qc($(document.body));Hb.setSize(312,155);var Rb=N.getText().replace("\uff08"+U.get("columnName","\u540d\u79f0\uff1a"),"\uff08");Rb=C(Rb,"\uff09")?Rb.substring(Rb.indexOf("\uff08")+1,Rb.length-1):"";var Ic=Ma.getJqUi();Ma.setInputValue(Rb);Hb.setTitle(U.get("modifyFieldName","\u4fee\u6539\u5b57\u6bb5\u540d\u79f0"));Hb.setClosingListener(function(Yc){if(Yc){Yc=Ma.getInputValue().trim();var Ac=L(Yc,qa);Ac?
Ma.showMessage(Ac,"#FCAD05"):Rb!=Yc?(Ac=N.getText(),C(Ac,"\uff09")?Yc?N.setText(Ac.substring(0,Ac.indexOf("\uff08")+1)+Yc+"\uff09"):N.setText(Ac.substring(0,Ac.indexOf("\uff08"))):Yc&&N.setText(Ac+"\uff08"+Yc+"\uff09"),u(w,qa,N.getText()),N.setText(na(N.getText())),f.showSuccess(U.get("editSuccess","\u4fee\u6539\u6210\u529f\u3002")),Hb.destroy()):Hb&&Hb.destroy()}});Hb.showDialog(Ic);setTimeout(function(){Ma&&Ma.setFocus()},100)},na=function(w){return w.replace("\uff08","\uff08"+U.get("columnName",
"\u540d\u79f0\uff1a"))},u=function(w,N,qa){w=x(N,qa);q(N,qa);1==N?a.setFieldName(w):a.addFieldValueName(N-2,w)},L=function(w,N){if(null==w||""==w||0==w.length)return U.get("fieldNameIsNull","\u5b57\u6bb5\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a");if(50<w.length)return U.get("fieldNameCanNotExceedLimit","\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26");if(w){var qa=w.indexOf("\uff08"),Ma=w.indexOf("\uff09");-1<qa&&-1<Ma&&(w=w.substr(0,qa)+w.substr(qa+1,Ma-(qa+1)));if(!w.match(/^[\s\u3000\u4E00-\u9FA5a-zA-Z0-9_]{1,}$/))return U.get("headNameComponentCheckError",
"\u540d\u79f0\u53ea\u80fd\u7531\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210");qa=a.getFieldName();Ma=a.getFieldValueNames().indexOf(w);if(w==qa&&1!=N||-1<Ma&&Ma!=N-2)return U.get("headNameRepeatCheckError","\u5b57\u6bb5\u540d\u79f0\u5df2\u5b58\u5728")}},C=function(w,N){return w.indexOf(N)==w.length-N.length},Q=function(){for(var w=c,N=[],qa=0;qa<w.length;qa++){var Ma=w[qa],Hb;if(Hb=!Ma.isCalculatingField()){a:{Hb=void 0;var Rb=Ma;if(null!=k&&0!=k.length)for(Hb in k){var Ic=
k[Hb];if(Ic&&Ic.getName()==Rb.getName()){Hb=!0;break a}}Hb=!1}Hb=!Hb}Hb&&N.push(Ma)}return N},fa=function(w,N,qa,Ma,Hb,Rb,Ic){var Yc=new pb,Ac=Q();Yc.setItemModel(Ac);Yc.setListItemPainter(xa);Yc.setSearchListener(R);Yc.setShowFieldNameListener(K);w=ha.createCtrlInCell(w,N,qa,xc);w.setUserObject(Hb);w.setSelectedModel(Ma);w.setDropdownCreator(function(Zc,ld,fd){return Yc.createJqPopup(Zc,ld,fd)});w.setCustomPainter(function(Zc,ld){ld.text(Zc?"\u5b57\u6bb5 ["+Zc.getAlias()+"] \u7684\u503c":"");if(Zc){(ld=
a.getColumnToRowPropertyItem(Rb))||(ld=new Jb);var fd=ld.getPropertyValues();null==fd&&(fd=[]);var nc=Zc.getName();fd[Ic-2]=nc;ld.setPropertyValues(fd);fd=ld.getFieldName();fd||(fd=(fd=Zc.getAlias())?fd:nc,Hb.getCell(1).setValue(fd),ld.setFieldName(fd));a.addColumnToRowPropertyItem(Rb,ld);Hb.getCell(Ic).setValue(Zc)}else Hb.getCell(Ic).setValue("");jb(za,Rb,Ic-2)})},R=function(w,N,qa,Ma,Hb,Rb){N=N.toLowerCase();for(var Ic=[],Yc,Ac=0;Ac<w.length;Ac++)Yc=w[Ac],(Yc=-1!=Yc.getAlias().toLowerCase().indexOf(N)?
!0:Rb&&-1!=Yc.getName().toLowerCase().indexOf(N)?!0:!1)&&Ic.push(w[Ac]);qa.children().remove();if(0<Ic.length){for(Ac=0;Ac<Ic.length;Ac++)Hb(Ic[Ac],qa,Ma);Ic.length=0}else w=new l,w.setText(U.get("nothingSearched","\u627e\u4e0d\u5230\u7b26\u5408\u7684\u7ed3\u679c")),w.setEnabled(!1),w.setAlign(l.ALIGN_CENTER),w=w.getJqUi(),w.addClass("dm-field-popup-search-result"),w.appendTo(qa);K(qa,Rb)},K=function(w,N){if(N)for(w=w.find(".dm-field-popup-list-item-field-name"),N=0;N<w.length;N++){var qa=w.eq(N);
qa.css("display","inline-block");var Ma=qa.prev().text()+qa.text();qa.prev().attr("title",null);qa.parent().attr("title",Ma)}else for(w=w.find(".dm-field-popup-list-item-field-name"),N=0;N<w.length;N++)qa=w.eq(N),qa.css("display","none"),qa.parent().attr("title",null),qa.prev().attr("title",qa.prev().text())},xa=function(w,N,qa){var Ma=$("<div>");Ma.addClass("dm-field-popup-list-item");Ma.data("model",w);var Hb=w?w.getAlias():"",Rb=$("<span>");Rb.text(Hb);Rb.attr("title",Hb);Rb.addClass("dm-field-popup-list-item-text");
Hb="";w&&(Hb=w.getFormula()?w.getAlias():w.getName());var Ic=$("<span>");Ic.text("("+Hb+")");Ic.addClass("dm-field-popup-list-item-field-name");Ma.append(Rb);Ma.append(Ic);N.append(Ma);qa&&qa.getAlias()==w.getAlias()&&Ka(N,Ma)},Ka=function(w,N){var qa=null;0<w.height()?(clearTimeout(qa),N.addClass("dm-list-item_selected_enabled"),w.prop("scrollTop",N.prop("offsetTop"))):qa=setTimeout(function(){Ka(w,N)},0)}}var Z=this,ta,e,h,g,a,c,k,d,f,b={},r=new zb;this.setMessageCurtain=function(za){f=za};this.isExistError=
function(){return 0<e.find(".dm-entity-filtertable-prompt").length?!0:!1};this.getErrorMessage=function(){var za=null,Na=a.getColumnToRowPropertyItems();if(null!=Na&&0<Na.length)if(Z.isExistError())za=d;else{a:{za=a.getFieldValueProperties();Na=a.getColumnToRowPropertyItems();for(var wa=0;wa<za.length;wa++){var Ca;if(Ca=Na&&0<Na.length)b:{Ca=void 0;var db=Na,na=wa;for(Ca in db){var u=db[Ca];if(u&&(u=u.getPropertyValues()[na])&&m(u)){Ca=!1;break b}}Ca=!0}if(Ca){za=U.get("existsUnconfigColumn",'"\u76ee\u6807\u503c\u5217#1"\u672a\u8bbe\u7f6e').replace("#1",
wa+1);break a}}za=void 0}za||(za=aa());if(za)return za;Na=a.getFieldName();wa=a.getFieldValueNames();Na?-1<wa.indexOf("")&&(za=wa.indexOf(""),za=U.get("Rename","\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u5b57\u6bb5\u503c"+(za+1)+"\u540d\u79f0\u3002")):za=U.get("Rename","\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u5b57\u6bb5\u540d\u79f0\u3002")}return za};this.setCurrentEntityProperties=function(za){c=za};this.setSetUpRelationProperties=function(za){k=za};this.initAllPropertyNamesMap=function(za,Na){if(za&&Na)try{b={};var wa=
[];Na instanceof Ub?wa=Na.getChildren():wa.push(Na);for(var Ca in wa){var db=wa[Ca].getSource(),na=wa[Ca].getTopParentEntity().getAssociateName(),u=za.createFacade(function(L){var C=new wb;C.fromJsonObject(L,[db]);(L=C.getEntityByAssociateName(na))&&L.getProperties().forEach(function(Q){b[Q.getName()]=Q})});u.setShowBlocking(!1);u.getDesigntimeDataObject(db.toJsonObject(),na)}}catch(L){window.console&&console.error(L.stack)}};var m=function(za){if(c)for(var Na in c){var wa=c[Na];if(wa.getName()==
za)return wa}return null};this.setColumnToRowProperty=function(za){null==za?a=new kb:(a=new kb,a.fromJsonObject(za.toJsonObject()))};this.getColumnToRowProperty=function(){return a};var t=function(){var za=$("<div class='dm-column-to-row-delete'>"),Na=$("<div>"),wa=$("<span class='dm-column-to-row-delete-button'>"),Ca=U.get("clearColumnToRowSetting",'\u6e05\u7a7a"\u5217\u8f6c\u884c"\u8bbe\u7f6e');wa.text(Ca);wa.attr("title",Ca);wa.on("click",function(){a=new kb;y()});Na.append(wa);za.append(Na);e.append(za)},
A=function(){var za=$("<div>");za.addClass("dm-column-to-row-add-column");Ya.layoutCtrlWithLRTB(za,null,0,130,390,null,50);var Na=$("<div>");Na.addClass("dm-column-to-row-advanced-setting");Ya.layoutCtrlWithLRTB(Na,null,0,80,6,null,20);var wa=$("<div>");wa.addClass("dm-column-to-row-advanced-setting-desc");wa.text(U.get("advancedSetting","\u9ad8\u7ea7"));var Ca=$("<div>");Ca.addClass("dm-column-to-row-advanced-setting-desc-icon");wa.appendTo(Na);Ca.appendTo(Na);wa.css("text-align","right");Ya.layoutCtrlWithLRTB(wa,
null,20,130,0,0,20);Ya.layoutCtrlWithLRTB(Ca,null,4,7,4,null,7);Na.on("click",function(){h?E(h):(h=$("<div class='dm-column-to-row-add-column-button'>"),h.text(U.get("addColumnButton",'\u6dfb\u52a0"\u76ee\u6807\u503c\u5217"')),h.on("click",function(db){db=ta.getColumnsCount();ta.insertColumn(db-1,"columns"+db).setWidth(200);y(a);E(h)}),Ya.layoutCtrlWithLRTB(h,null,1,120,26,null,28),za.append(h))});za.append(Na);e.append(za)},E=function(za){za&&("block"==za.css("display")?za.hide():za.show())},M=function(za,
Na){return za.indexOf(Na)==za.length-Na.length},z=function(za,Na){if(Na)var wa=Na;else{Na=0;if(null!=c&&0<c.length)for(wa in c){var Ca=c[wa],db=Ca.getName();Ca.getAlias();Na=H(db,Na);Na=H(db,Na)}(Ca=a.getFieldName())&&(Na=H(Ca,Na));Ca=a.getFieldValueNames();if(null!=Ca&&0<Ca.length)for(wa in Ca)Na=H(Ca[wa],Na);wa="column"+(parseInt(Na)+1)}Na=wa;return M(za,"\uff09")?za.substring(0,za.indexOf("\uff08")+1)+Na+"\uff09":Na?za+"\uff08"+Na+"\uff09":za},H=function(za,Na){if(0==!za.indexOf("column"))return Na;
(za=za.substring(za.indexOf("column")+6,za.length))&&/^\+?[1-9][0-9]*$/.test(za)&&(za=parseInt(za),null!=Na&&void 0!=Na&&parseInt(Na)<za&&(Na=za));return Na},x=function(za,Na){return(Na=q(za,Na))?Na:"column"+za},q=function(za,Na){return Na&&M(Na,"\uff09")?Na.substring(Na.indexOf("\uff08")+1,Na.lastIndexOf("\uff09")):""},D=function(za,Na){return 1==Na},G=function(za,Na,wa,Ca,db){wa.setValue(Ca);return!0};this.getJqUi=function(){if(e)return e;e=$("<div>");var za=$("<div class='dm-column-to-row-table'>");
ta=ha.createTable();ta.setSyncUIWhenModelChanged(!0);ta.setDraggableAdjusting(!0,3,0,new bd);ha.bindTextEditor(ta,D,G);ha.bindTableListenerForCtrl(ta,ca);var Na=new la(ta);Na.setOutsideVisible(!1);ta.setCellRender(Na);Na=a.getFieldValueNames();var wa=a.getFieldName(),Ca=Na.length+3;if(null==Na||0==Na.length)Na=[U.get("firstFieldOne","\u76ee\u6807\u503c\u52171")],Ca=4;ta.addColumns(Ca);ta.getColumn(0).setWidth(25);ta.getColumn(1).setWidth(200);for(var db=0;db<Na.length;db++){var na=2+db;ta.getColumn(na).setWidth(200)}ta.getColumn(Ca-
1).setWidth(162);Ca=ha.createHeadRow(ta);Ca.getCell(1).setValue(z(U.get("targetFieldName","\u76ee\u6807\u5c5e\u6027\u5217"),wa));for(db=0;db<Na.length;db++)na=2+db,Ca.getCell(na).setValue(z(U.get("targetFieldValue","\u76ee\u6807\u503c\u5217"),Na[db]));Na=$(ta.getUI());Ya.layoutCtrlWithLRTB(Na,0,0,null,50,0,null);za.append(Na);e.append(za);y();Na.children().eq(1).css("width","100%");t();A();return e};var ca=function(za,Na,wa,Ca){za=null;if(Na){za=KTableUIAbstractView.createCellId(ta.getRow(wa),ta.getColumn(ta.getColumnsCount()-
1));za=Z.getJqUi().find("#"+za);r.setFontSize(12);Ca=U.get("insert","\u63d2\u5165");Na=r.measureWidth(Ca)+10;var db=$("<div>");db.text(Ca);db.addClass("dm-entity-filtertable-op");db.addClass("dm-entity-filtertable-op-insert");db.css("width",Na);db.appendTo(za);db.on("click",function(u){a.getColumnToRowPropertyItems().splice(wa-3,0,null);y()});Ca=U.get("deleteRow","\u5220\u9664");db=r.measureWidth(Ca)+10;var na=$("<div>");na.text(Ca);na.addClass("dm-entity-filtertable-op");na.addClass("dm-entity-filtertable-op-delete");
na.css({width:db,left:Na+10});na.appendTo(za);na.on("click",function(u){a.deleteColumnToRowPropertyItem(wa-3);y()})}else g&&g.find(".dm-entity-filtertable-op").remove();g=za},y=function(){ha.clearWithoutHead(ta);var za=a.getColumnToRowPropertyItems(),Na=a.getFieldValueNames();if(za)for(var wa=0;wa<za.length;wa++){var Ca=za[wa];if(Ca){var db=ha.createRow(ta);db.getCell(1).setValue(Ca.getFieldName());var na=Ca.getPropertyValues();for(Ca=0;Ca<Na.length;Ca++){var u=2+Ca,L=m(na[Ca]);db.getCell(u).setValue(L)}}else for(db=
ha.createRow(ta),db.getCell(1).setValue(""),Ca=0;Ca<Na.length;Ca++)u=2+Ca,db.getCell(u).setValue("")}za=10-(za?za.length:0);if(0<za)for(wa=0;wa<za;wa++)for(db=ha.createRow(ta),db.setHeight(30),Ca=1,Na=ta.getColumnsCount()-1;Ca<Na;Ca++)db.getCell(Ca).setValue("");ha.refresh(ta)},P=function(za,Na,wa,Ca,db){for(var na=0;na<Ca;na++)za=za.prev();a:{if(Na){na=wa.getColumnsCount()-3;var u=!1,L=!1;try{var C=Na.getCell(1)}catch(fa){console.log("error");break a}C&&C.getValue()&&(L=!0);for(C=2;C<na+2;C++){var Q=
Na.getCell(C);if(Q&&Q.getValue()){u=!0;break}}if(L&&!u){d=U.get("existColumnToRowErrorItem","\u5b58\u5728\u4e0d\u5b8c\u6574\u7684\u914d\u7f6e\u9879");Qb(za,null,null,U.get("existColumnToRowErrorItem","\u5b58\u5728\u4e0d\u5b8c\u6574\u7684\u914d\u7f6e\u9879"));break a}else if(u&&!L){d=U.get("existColumnToRowErrorItem","\u5b58\u5728\u4e0d\u5b8c\u6574\u7684\u914d\u7f6e\u9879");Qb(za,null,null,U.get("existColumnToRowErrorItem","\u5b58\u5728\u4e0d\u5b8c\u6574\u7684\u914d\u7f6e\u9879"));break a}}Qb(za,null,
null,null)}jb(wa,db,Ca)},aa=function(){c.forEach(function(db){b[db.getName()]=db});var za=[],Na=a.getFieldName(),wa=a.getFieldValueNames();za.push(Na);za=za.concat(wa);for(var Ca in za)if(Na=za[Ca],b[Na])return za=U.get("existsSameColumnName",'\u5f53\u524d\u8bbe\u7f6e\u7684\u7b2c#1\u5217\u5217\u540d\u79f0"#2"\u4e0e\u5df2\u5b58\u5728\u7684\u5217\u540d\u79f0\u91cd\u590d'),za=za.replace("#1",parseInt(Ca)+1),za=za.replace("#2",Na)},jb=function(za,Na,wa){za.getColumnsCount();var Ca=za.getRowsCount()-3;
if(0<Ca)for(var db=3;db<Ca;db++)if(za.getRow(db).getCell(1).getValue()){a:{var na=Na;var u=wa,L=za.getRow(na+3).getCell(u+2).getValue();if(L=L?L.getName():"")for(var C=a.getColumnToRowPropertyItems(),Q=0;Q<C.length;Q++){var fa=C[Q];if(fa){var R=fa.getPropertyValues(),K;for(K in R)if((Q!=na||K!=u)&&R[K]==L){R.splice(K,1,"");fa.setPropertyValues(R);na=!0;break a}}}na=!1}if(na){y();break}}},Qb=function(za,Na,wa,Ca){za=$(za);za.find(".dm-entity-filtertable-prompt").remove();Ca&&(Na=ib.createWarning(),
Na.addClass("dm-entity-filtertable-prompt"),Na.css({left:"5px",right:"0px"}),Na.attr("title",Ca),Na.appendTo(za))}}function bd(){this.isRowDraggable=function(la,Z){return!0};this.isColumnDraggable=function(la,Z){return!0};this.getMinRowHeightLimited=function(la,Z){return 3};this.getMinColumnWidthLimited=function(la,Z){return 4};this.rowDraggedAction=function(la,Z,ta){var e=la.isSyncUIWhenModelChanged();la.setSyncUIWhenModelChanged(!0);Z=la.getRow(Z);Z.setHeight(Z.getHeight()+ta);la.setSyncUIWhenModelChanged(e)};
this.columnDraggedAction=function(la,Z,ta){var e=la.isSyncUIWhenModelChanged();la.setSyncUIWhenModelChanged(!0);Z=la.getColumn(Z);Z.setWidth(Z.getWidth()+ta);la.setSyncUIWhenModelChanged(e)};this.getTailBlankForDragging=function(){return 0}}function Uc(){var la,Z,ta,e;this.setSize=function(h,g){};this.getDefault=function(){};this.setInputValue=function(h){e.setText(h)};this.getInputValue=function(){return e.getText()};this.setFocus=function(){e.requestFocus()};this.showMessage=function(h,g){clearTimeout(ta);
Z.text(h);g&&Z.css("color",g);ta=setTimeout(function(){Z.text("")},5E3)};this.getJqUi=function(){if(!la){la=$("<div>");var h=$("<div>");h.addClass("field-input-container");var g=U.get("fieldName","\u5b57\u6bb5\u540d\u79f0"),a=new l;a.setText(g);a.setRequired(!0);a=a.getJqUi();a.attr("title",g);Ya.layoutCtrl(a,8,0,72,21);e=new cb;g=e.getJqUi();g.addClass("field-name-input");Z=$("<div>");Z.addClass("message-tips");h.append(a);h.append(g);la.append(h);la.append(Z)}return la}}function Qc(la){var Z=$("<div class='sa-ctrl-common-modallayer'>"),
ta=new ba(Z),e=0,h=0,g=320,a=240,c=la?la:$(document.body),k,d;this.setTitle=function(f){d=f};this.setClosingListener=function(f){k=f};this.setSize=function(f,b){g=f;a=b};this.showDialog=function(f){Z.appendTo(c);if(!e){var b=c.prop("clientWidth"),r=c.prop("clientHeight");e=b-g>>1;h=(r-a)/3}ta.setBounds(e,h,g,a);ta.setToolbarVisible(!1);ta.setContent(f);ta.setTitle(d);ta.addClosingListener(function(m,t){if(t)k(t);else return m.destroy(),Z.remove(),!0});ta.addClosedListener(function(m){m.destroy();
Z.remove()});ta.showFooterPane();ta.show()};this.destroy=function(){ta.destroy();Z.remove()}}function Xb(){B.call(this);var la=this,Z=this.protectedMethod,ta,e,h,g,a=[],c;this.setGlobalDependence=function(r){e=r};this.getGlobalDependence=function(){return e};this.setRelationsAndEntity=function(r,m){var t=[];if(null!=r&&0<r.length)for(var A=0;A<r.length;A++){if(r[A].getFromEntity().getName()==m.getName()){var E=r[A].getFromProperty();t.push(E)}r[A].getToEntity().getName()==m.getName()&&(E=r[A].getToProperty(),
t.push(E))}c=t;r=h=m;m=r.getColumnToRowProperties();t=r.getProperties();if(null!=m&&0<m.length)for(var M in m)A=new Dc,A.setColumnToRowProperty(m[M]),A.setSetUpRelationProperties(c),A.setCurrentEntityProperties(t),A.setMessageCurtain(Z.getMessageCurtain()),A.initAllPropertyNamesMap(e,r),a.push(A);else A=new Dc,A.setColumnToRowProperty(null),A.setCurrentEntityProperties(t),A.setSetUpRelationProperties(c),A.initAllPropertyNamesMap(e,r),A.setMessageCurtain(Z.getMessageCurtain()),a.push(A)};this.getEntity=
function(){return h};this.setConfirmListener=function(r){g=r};this.setColumnToRowPanels=function(r){a=r};this.getColumnToRowPanels=function(){return a};this.initUi=function(){var r=U.get("columnToRow","\u5217\u8f6c\u884c");la.setSize(620,560);Z.setTitle(r);var m=$("<div>");r=$("<div>");r.css({position:"absolute","z-index":"1"});var t=$("<span>");t.addClass("dm-column-to-row-add-column-desc");var A=U.get("configColumnDesc",'\u8bf7\u5728"\u76ee\u6807\u503c\u5217"\u4e2d\u9009\u62e9\u9700\u8981\u8fdb\u884c\u8f6c\u7f6e\u7684\u5217');
t.text(A);t.attr("title",A);t.appendTo(r);t=k().getJqUi();t.appendTo(r);t.css({display:"inline-block",top:"6px","margin-left":"5px"});t.css("z-index",2);r.appendTo(m);Z.setContentPaneCreator(function(){for(var E in a)m.append(a[E].getJqUi());return m});Z.setClosingChecker(b,!0);Z.setClosingAction(d);Z.setSelectable(!0)};var k=function(){if(!ta){var r=$("<div>"),m=$("<span>");m.text(U.get("columnToRowHelpIconTips","\u201c\u5217\u8f6c\u884c\u201d\u529f\u80fd\u53ef\u5c06\u539f\u59cb\u6570\u636e\u4e2d\u7684\u540c\u4e00\u884c\u591a\u5217\u6570\u636e\u8f6c\u6362\u4e3a\u591a\u884c\u6570\u636e  "));
m.appendTo(r);m=da.getColumnToRowUrl();m=$("<a onclick='javascript:window.open(\""+m+"\");' href='#'>");m.text(U.get("viewDetails","\u67e5\u770b\u5e2e\u52a9\u6587\u6863"));m.css("cursor","pointer");m.css("color","#5582f3");m.appendTo(r);ta=new Za;ta.setIconType(Za.ICON_TYPE_QUESTION);ta.setTipsSize(200,70);ta.setTipsHtml(r[0])}return ta},d=function(r){if(r){r=la.getColumnToRowPanels();var m=la.getEntity(),t=m.getProperties();m=m.getPropertyViewNodes();for(var A=[],E={},M=0;M<m.length;M++){var z=m[M];
z&&z.isProperty()&&(z=z.getModel(),E[z.getName()]=z)}if(null!=r&&0<r.length)for(var H in r)if(M=r[H].getColumnToRowProperty())if(z=M.getColumnToRowPropertyItems(),null!=z&&0!=z.length){z=t;var x=m,q=E,D=M,G=D.getColumnToRowPropertyItems();if(null!=G&&0<G.length)for(var ca=0;ca<G.length;ca++)G[ca]||(G.splice(ca,1),ca--);var y=D.getFieldNameProperty();G=D.getFieldValueProperties();ca=D.getColumnToRowPropertyItems();D=D.getUsedColumnToRowPropertyNames();var P=y.getName();if(!q[P]){y.setHide(!1);var aa=
new gb(y,0);x.push(aa);q[P]=y}for(y=0;y<G.length;y++){P=G[y];var jb=P.getName();q[jb]||(P.setHide(!1),aa=new gb(P,0),x.push(aa),q[jb]=P);if(ca&&0<ca.length){var Qb=void 0;jb=aa=void 0;var za=ca,Na=z,wa=y,Ca=0;for(Qb in za){var db=za[Qb];if(db){var na=db.getPropertyValues()[wa];a:{db=void 0;var u=Na;for(db in u){var L=u[db];if(L instanceof Gb&&L.getName()==na){db=L;break a}}db=null}if(db)if(u=db.getPrecision()?db.getPrecision():0,Ca=Math.max(Ca,u),!jb)jb=db.getDataType(),aa=db.getFormatString();else if(jb!=
db.getDataType()){jb=Gb.DT_STRING;aa=null;break}}}Qb={};Qb.dataType=jb;Qb.format=aa;Qb.precision=Ca;aa=Qb;P.setDataType(aa.dataType);P.setFormatString(aa.format);P.setPrecision(aa.precision)}}f(z,x,q,D);M&&0<M.getColumnToRowPropertyItems().length&&A.push(M)}else f(t,m,E,[]);h.setColumnToRowProperties(A);g()}},f=function(r,m,t,A){for(var E in r){var M=r[E],z=M.getName(),H=A.indexOf(z);z=t[z];-1!=H||z||(M.setHide(!1),M=new gb(M,0),m.push(M))}},b=function(r){for(var m in a){var t=a[m];if(oColumnToRowProperty=
t.getColumnToRowProperty())if(t=t.getErrorMessage())return Z.getMessageCurtain().showError(t),r(!1),!1}r(!0)}}function cc(){Gc.call(this);var la=this,Z=this.getDisplayText;this.getDisplayText=function(){return 0===la.getSelectedValue().length?U.get("selectUsersPlaceholder","\u8bf7\u9009\u62e9\u7528\u6237\uff08\u9ed8\u8ba4\u5305\u542b\u4e1a\u52a1\u4e3b\u9898\u521b\u5efa\u4eba\uff09"):Z()}}function Da(){var la,Z,ta,e,h,g,a,c,k,d,f,b;this.getJqUi=function(){if(!la){var M=new l(U.get("extractUsers","\u63d0\u53d6\u65f6\u7684\u7528\u6237\u8eab\u4efd\uff1a")),
z=new F;e=new T;h=new T;e.setText(U.get("extractByCreator","\u6309\u4e1a\u52a1\u4e3b\u9898\u521b\u5efa\u4eba\u63d0\u53d6"));h.setText(U.get("extractByUsers","\u6309\u6307\u5b9a\u7528\u6237\u5206\u522b\u63d0\u53d6"));z.addElement(e);z.addElement(h);z.addChangedListener(A);M=M.getJqUi();z=e.getJqUi();var H=h.getJqUi();Z=m();la=$("<div>");la.append(M);la.append(z);la.append(H);la.append(Z);Ya.layoutCtrl(M,0,0,300,23);Ya.layoutCtrl(z,0,30,300,23);Ya.layoutCtrl(H,0,60,300,23);Ya.layoutCtrl(Z,0,90,500,
50)}return la};this.setExtractConfig=function(M){f=!0;(c=M)?h.setChecked(!0):e.setChecked(!0);f=!1};this.setExtractUserLimit=function(M){b=M};this.setConfigChangedListener=function(M){d=M};this.validateConfig=function(){if(!c)return null;var M;c.getExtractUsers()&&0!==c.getExtractUsers().length?b&&c.getExtractUsers().length>=b&&(M=U.get("selectUsersLimitWaring","\u6307\u5b9a\u7528\u6237\u6570\u91cf\u8d85\u8fc7\u6700\u5927\u9650\u5236\u3002")):M=U.get("selectUsersWarning","\u8bf7\u9009\u62e9\u7528\u6237\u3002");
return M};var r=function(){f||d&&d(c)},m=function(){var M=new l(U.get("selectUsers","\u6307\u5b9a\u7528\u6237"));M.setRequired(!0);g=new cc;g.setConfirmClear(!1);g.setSelectedListener(function(D){c.setExtractUsers(D);r();b&&c.getExtractUsers().length>=b?t(ta,U.get("selectUsersLimitWaring","\u6307\u5b9a\u7528\u6237\u6570\u91cf\u8d85\u8fc7\u6700\u5927\u9650\u5236\u3002")):ta.empty()});var z=[Ab.REAL_TIME,Ab.USE_THEME_CREATOR],H=new l(U.get("otherUserPolicy","\u5176\u4ed6\u7528\u6237\u63d0\u53d6\u7b56\u7565"));
a=new ed;a.setItemModels(z);a.setCustomPainter(E);a.addSelectedChangedListener(function(D,G,ca){c.setDefaultPolicy(ca);r()});M=M.getJqUi();z=g.getJqUi();H=H.getJqUi();var x=a.getJqUi();H.attr("title",U.get("otherUserPolicy","\u5176\u4ed6\u7528\u6237\u63d0\u53d6\u7b56\u7565"));var q=$("<div>");ta=$("<div>");q.append(M);q.append(z);q.append(H);q.append(x);q.append(ta);Ya.layoutCtrl(M,20,0,100,23);Ya.layoutCtrl(z,130,0,250,23);Ya.layoutCtrl(H,20,30,100,23);Ya.layoutCtrl(x,130,30,250,23);Ya.layoutCtrl(ta,
390,0,600,23);return q},t=function(M,z,H){var x=$("<div>");x.text("!");x.addClass("dm-relation-dialog-promptitem-icon");x.addClass("dm-relation-dialog-promptitem-icon-"+(H?"err":"warn"));H=$("<div>");H.addClass("dm-relation-dialog-promptitem-text");H.text(z);var q=$("<div>");q.addClass("dm-relation-dialog-promptitem");q.append(x);q.append(H);setTimeout(function(){M.empty();M.append(q)},100)},A=function(){e.isChecked()?(Z.hide(),k=c,c=null):(Z.show(),c=k||c,c||(c=new $a,c.setDefaultPolicy(Ab.REAL_TIME)),
g.setSelectedValue(c.getExtractUsers()),a.setSelected(c.getDefaultPolicy()));r()},E=function(M,z,H){M="";Ab.REAL_TIME===H?M=U.get("disposableExtract","\u5b9e\u65f6\u63d0\u53d6"):Ab.USE_THEME_CREATOR===H&&(M=U.get("extractByCreator","\u6309\u4e1a\u52a1\u4e3b\u9898\u521b\u5efa\u4eba\u8eab\u4efd\u63d0\u53d6"));z.text(M);z.attr("title",M)}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&
(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.data&&(com.kingdee.bos.qing.data={});var oa=com.kingdee.bos.qing.data;oa.Main=function(){var la,Z=new jc,ta=[],e,h=new oc,g=new rc,a=new Kc,c,k,d,f,b=!1,r=!1,m=new function(){this.createFacade=function(z,H,x){return new vb(k,z,function(q,D,G){return H&&H(q,D,G)?!0:!1},x)};this.getTopJqUi=function(){return la};this.getMessageCurtain=function(){return c};this.setDirty=function(z){t(z)};this.getRemoteImpl=function(){return k}};this.setRemoteImpl=
function(z){k=z};this.setDataSourceDisabled=function(z){r=z};this.createJqUi=function(){la=$("<div>");la.addClass("dm-main");c=new kd;c.getJqUi().appendTo(la);Z.getJqUi().appendTo(la);h.setTitle(U.get("entity","\u6570\u636e\u8868"));g.setTitle(U.get("relation","\u5173\u7cfb"));a.setTitle(U.get("config","\u8bbe\u7f6e"));e=new lc;e.addTab(h,!0);e.addTab(g);e.addTab(a);e.addTabChangedListener(E);h.setGlobalDependence(m);g.setGlobalDependence(m);a.setGlobalDependence(m);ta[0]=h.createToolbarButtons(Z);
ta[1]=g.createToolbarButtons(Z);ta[2]=[];ta[3]=h.createToolbarViewSysVarButton(Z);h.setDataSourceDisabled(r);var z=e.getJqUi();z.addClass("dm-main-body");z.appendTo(la);return la};this.resize=function(){e.getCurrentTabPane().resize()};this.getConductor=function(){if(!d){var z={getGlobal:function(){return m}};z.setDirty=t;z.isDirty=function(){return b};z.hookDirtyListener=function(H){f=H};d=new Kb(Z,z)}return d};this.saveAfterRefreshUploadTypeSource=function(z){if(z){var H=h.getDmModel(),x=new Ra;
x.fromJsonObject(z);H.refreshUploadTypeSourceUrl(x.getSources())}};this.setJsonModel=function(z,H){var x=new Ha,q=new Ra;try{z&&z.boxModel&&q.fromJsonObject(z.boxModel);var D=z.systemVarTypes;D&&0<D.length&&dc.VARIANTTYPEENUM.forEach(function(P){D.forEach(function(aa){P.getTypeID()==aa&&dc.SUPPORTED_VAR_TYPE.push(P)})});var G=z.designtimeMacros;oa.DesigntimeMacroCache.clear();if(G&&0<G.length){z=0;for(var ca=G.length;z<ca;z++){var y=new ob;y.fromJsonObject(G[z]);oa.DesigntimeMacroCache.put(y.getId(),
y)}}h.setDmModel(q);g.setDmModel(q);a.setDmModel(q)}catch(P){x.setError(!0),window.console&&console.error(P.stack)}t(!1);q.isTooModern()&&c.showPrompt(U.get("docTooModern","\u6587\u6863\u7684\u7248\u672c\u6bd4\u73af\u5883\u66f4\u9ad8\uff0c\u5df2\u6700\u5927\u517c\u5bb9\u6027\u52a0\u8f7d\u3002"));x.setTooModern(q.isTooModern());H&&H(x)};this.getJsonModel=function(){g.collectEdited();var z=h.getDmModel(),H=new La,x=H.checkArrEntityFilter(z.copyEntityArray());if(x){var q=x.getPrompt();c.showError(q);
setTimeout(function(){e.setCurrentTabPane(h);h.locateToFilterPane(x.getEntityName(),x.getFiltersErrorRow(),q)},500);return null}var D=H.checkRelationPropertyExisted(z);if(D)return c.showError(D),setTimeout(function(){e.setCurrentTabPane(g);g.updateEntityRelationToUi()},500),null;g.updateEntityRelationToUi();if(x=z.checkSchedule())return x.showMessageCurtain(c),z=z.getExtractSchedule(),"Custom"==z.getPeriod()&&(z=z.getCron(),"undefined"!=typeof z&&""!=z||a.showTimingExtractCustomPanePrompt()),setTimeout(function(){e.setCurrentTabPane(a)},
500),null;if(x=H.checkExtractUserConfig(a))return x.showMessageCurtain(c),setTimeout(function(){e.setCurrentTabPane(a)},500),null;A(z);t(!1);return z.toJsonObject()};var t=function(z){b=z;f&&f(b)},A=function(z){if(z){var H=z.getRelationCount();Wc.occur(Wc.DM_CREATE_RELATION,H);var x=z.getSources(),q=[];for(H=0;H<x.length;H++){var D=x[H];q.push(D.getTypeName());if(D instanceof Ja){var G=D.getAllUserSqlName(),ca=D.getAllStoredProcedureName();G&&0<G.length?(G=D.getUserSql(G[0]).getSqlType(),Wc.occur(Wc.DM_IMPORT_TYPE,
G,D.getTypeName())):ca&&0<ca.length?Wc.occur(Wc.DM_IMPORT_TYPE,Wc.DM_IMPORT_TYPE_STORED_PROCEDURE,D.getTypeName()):Wc.occur(Wc.DM_IMPORT_TYPE,Wc.DM_IMPORT_TYPE_TABLE,D.getTypeName())}}Wc.occur(Wc.DM_SOURCE_TYPE,q);for(H=0;H<z.getEntityCount();H++){x=0;q=z.getEntityByIndex(H).getProperties();for(D=0;D<q.length;D++)q[D].isCalculatingField()&&x++;Wc.occur(Wc.DM_OPERATING_NEW_FIELD,x)}z.getExtractSchedule().getPeriod()?Wc.occur(Wc.DM_DATA_EXTRACT_TYPE,Wc.DM_DATA_TIMING_EXTRACT):Wc.occur(Wc.DM_DATA_EXTRACT_TYPE,
Wc.DM_DATA_DISPOSABLE_EXTRACT)}},E=function(z,H){var x=z=!1,q=!1;H==h?z=!0:H==g?x=!0:H==a&&(q=!0);M(ta[0],z);M(ta[3],z);M(ta[1],x);M(ta[2],q)},M=function(z,H){for(var x=0;x<z.length;x++)z[x].getJqUi().css("display",H?"":"none")}};oa.AbstractFilterUIRender=Eb;var Ya,eb,Wa,ea,da,zb,U,wc,zc,Gc,ad,lc,yc,Sc,Cc,kd,ed,Ec,l,B,J,v,F,T,I,S,cb,ub,Ea,qb,xc,Hc,Nc,Za,ec,Db,n,V,Ga,ha,ib,p,ic,sc,hb,hd,ba,Ra=oa.Box,Sb=oa.Entity,Ub=oa.UnionEntity,Gb=oa.Property,tb=oa.FilterItem,Y=oa.Relation,Ja=oa.DBSource,W=oa.ExcelSource,
X=oa.TextSource,ia=oa.XMLSource,ka=oa.OpenAPISource,Aa=oa.AbstractSource,sa=oa.FiltersCheckingResult,ya=oa.UserSqlObj,Qa=oa.StoredProcedureModel,Ia=oa.StoredProcedureParameterModel,lb=oa.VarSelectDialog,ob=oa.DesigntimeMacro,$a=oa.ExtractConfig,Ab=oa.ExtractPolicy,wb=oa.DesigntimeDataObject,yb=oa.PreviewDataModel,ac=oa.TreeProperty,kb=oa.ColumnToRowProperty,Jb=oa.ColumnToRowPropertyItem,ja=oa.SystemVarModel,gb=oa.PropertyViewNode,vb=oa.Facade,rb=oa.Icons,Zb=oa.FormatUtil,bc=oa.SourceType,fc=oa.SourceTypeStep,
Tc=oa.BizSourceTypeContext,Sa=oa.SelectFieldPane,Fb=oa.DbConnectionModifyingEditor,Ua=oa.FileConnectionModifyingEditor,Ta=oa.OpenAPIConnectionModifyingEditor,ra=oa.DataSourceMergeFirstStep,bb=oa.MergedTableModifyDialog,Oa=oa.BizUnionEntityModifyDialog,Pa=oa.StoredProcedurePreviewPanel,ua=oa.BizEntityMergeEntranceStep,nb=oa.UnionEntityCompareModel,pb=oa.ChoosePropertyPane,Bb=oa.TableAndFieldSelectDialog,Yb=oa.IconUtil,dc=oa.SystemVarType,Pc=oa.PropDataTypeUtil,cd=oa.DbCustomSqlPanel,Wc=oa.UserOperationReporter,
Vc=oa.VariateHelperFactory,dd=oa.EntityErrorStatesUtil,rd=oa.CheckFieldNumUtil;(function(){var la=com.kingdee.bos.qing.common;Ya=la.DomUtil;eb=la.Util;Wa=la.Base32Util;ea=la.RelativePeriodModel;zb=la.TextMeasurer;la=com.kingdee.bos.qing.framework.common;U=la.MultilanguageManager.createPackageAccessor(oa);da=la.OfficialArticleUtil;la=com.kingdee.bos.qing.biz.common;Gc=la.UserDialogSelector;la=com.kingdee.bos.qing.schedule;wc=la.ScheduleSelector;zc=la.QingSchedule;la=com.kingdee.bos.qing.ui.component;
ba=la.Dialog;ad=la.ToolbarButton;lc=la.TabContainer;yc=la.SplitPane;Sc=la.Menu;Cc=la.MenuModel;kd=la.MessageCurtain;ed=la.ComboBox;Ec=la.List;l=la.Label;B=la.AbstractModalDialog;J=la.WizardDialog;v=la.CheckBox;F=la.RadioButtonGroup;T=la.RadioButton;I=la.DateSelector;S=la.DateTimeSelector;cb=la.TextField;ub=la.TextArea;Ea=la.SimpleConfirmer;qb=la.SearchBox;xc=la.DropdownSelector;Nc=la.Button;Hc=la.F7Selector;Za=la.HelpIcon;la=com.kingdee.bos.qing.common.ui;ec=la.NumberFormatModel;Db=la.NumberFormatSettingPanel;
n=la.NumberFormatSample;V=la.FormulaEditorPanel;Ga=la.RelativePeriodPanel;ha=la.TableUtil;ib=la.CommonIconUtil;la=com.kingdee.bos.qing.data.rview;p=la.RelationView;ic=la.DataModel;sc=la.Table;hb=la.Field;hd=la.Relation})()})();(function(){function Ha(){com.kingdee.bos.qing.framework.common.AbstractRemoteCall.call(this);var Cb;this.getRemoteUrl=function(oc){return Cb};this.setRemoteUrl=function(oc){Cb=oc}}function Kb(){var Cb=this;this.getParamSkin=function(){return Cb.getUrlParam("skin")};this.getParamLanguage=function(){return Cb.getUrlParam("language")};this.getParamPathPrefix=function(){return Cb.getUrlParam("path")};this.getUrlParam=function(oc){return com.kingdee.bos.qing.common.Util.decodeParamFromUrl(window.location.search,
oc)}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.data&&(com.kingdee.bos.qing.data={});var jc=com.kingdee.bos.qing.data;jc.DataModelingScene=function(){var Cb,oc,rc,Kc,Bc,uc,Wb;(function(){var Vb=com.kingdee.bos.qing;Cb=Vb.CodeLoader;oc=Vb.CommonCodeImporter;Vb=com.kingdee.bos.qing.framework.common;
rc=Vb.WebPageInitializer;Kc=Vb.WindowResizeObserver;Vb=com.kingdee.bos.qing.data;Bc=Vb.Main;uc=Vb.UserOperationReporter;Wb=Vb.Integration})();var tc=this,La=new Kb,Eb,xb;this.start=function(Vb){Cb.setCallback(function(){ab();tc.protectedCustomInitEnv();$b(Vb?Vb:document.body);tc.protectedLoadingImpl(tc.getRemoteImpl(),xb,function(Xa){})});oc.importDataModelingSkin(Cb);oc.importDataModelingI18n(Cb);tc.protectedImportMoreCode(Cb)};this.getUrlParam=function(Vb){return La.getUrlParam(Vb)};this.protectedGetRemoteUrl=
function(){throw Error("Override me.");};this.protectedImportMoreCode=function(Vb){};this.protectedCustomInitEnv=function(){throw Error("Override me.");};this.protectedCustomInitDesigner=function(Vb){throw Error("Override me.");};this.protectedLoadingImpl=function(Vb,Xa,ma){throw Error("Override me.");};this.protectedGetDataSourceDisabled=function(){};this.getRemoteImpl=function(){Eb||(Eb=new Ha,Eb.setRemoteUrl(tc.protectedGetRemoteUrl()));return Eb};var ab=function(){rc.init();uc.hookCollector(function(Vb,
Xa,ma){com.kingdee.bos.qing.behavior.BehaviorManager.interestInBehavior(Vb,Xa,0,ma)});Ib()},$b=function(Vb){xb=new Bc;xb.setRemoteImpl(tc.getRemoteImpl());xb.setDataSourceDisabled(tc.protectedGetDataSourceDisabled());var Xa=new Kc;Xa.setCallbackImmediately(function(){Ib()});Xa.setDelay(250);Xa.setCallback(function(){xb.resize();Wb.fireWindowResizeListener()});Xa.observe();tc.protectedCustomInitDesigner(xb);Xa=xb.createJqUi();$(Vb).append(Xa);xb.resize()},Ib=function(){document.body.style.height=document.documentElement.clientHeight+
"px"}};jc.RemoteImpl=Ha})();
//qingVersionTag: 20250324