(function(){function W(){K.call(this)}function K(){var a,d=this,e,f,g,n,h,c,b=com.kingdee.bos.qing.common.Util;this.show=function(m){p().appendTo(m);c||(c=$("<div>"),A.layoutCtrlWithLRTB(c,0,0,null,0,0,null),c.css({"z-index":"-1",background:"#fff"}));c.appendTo(m)};var p=function(){a||(a=$("<div class='sa-qing-publish-card-main'>"),g=$("<div class='sa-qing-publish-card-head'>"),(e=b.decodeParamFromUrl(location.search,"cardName"))||(e=" "),f=$("<div class='sa-qing-publish-card-title sa-qing-publish-fontfamily'>"),
e=com.kingdee.bos.qing.common.Base64Util.decode(e),f.text(e),f.attr("title",e),f.appendTo(g),n=$("<div>"),n.addClass("sa-qing-publish-card-content"),n.appendTo(a),d.protectedCustomContent(n),d.protectedCustomHead(g),g.appendTo(a));return a};this.protectedCustomHead=function(m){};this.protectedCustomContent=function(m){};var l=function(m,k,q){return b.appendParamToUrl(m,k,q)};this.protectedMethod={getTitleUi:function(){return f},getTitle:function(){return e},getContentUi:function(){return n},getUrlParam:function(m){return b.decodeParamFromUrl(location.search,
m)},appendUrlParam:l,appendAccountIdParam:function(m){var k=D.getUrlParamValue("kdcdc");k&&(m=l(m,"kdcdc",k));return m},getMainUi:p,appendOperateBtnUI:function(m){for(var k=5,q=0,r=m.length;q<r;q++)m[q].css({position:"absolute",top:"5px",right:k+"px"}),k+=35,g.append(m[q])},insertOperateBtnUI:function(m){for(var k=0,q=m.length;k<q;k++)m[k].css({position:"relative","margin-right":"10px",display:"inline-block"}),m[k].insertBefore(f)},insertExtraOperateBtn:function(m){if(!h){h=$("<div>");a.append(h);
var k=g.height();A.layoutCtrlWithLRTB(h,0,0,null,k,null,44);h.hide()}k=20;for(var q=0,r=m.length;q<r;q++){var w=m[q].getJqUi();A.layoutCtrlWithLRTB(w,null,k,80,0,null,16);A.layoutCtrlMiddleAlign(w,16);h.append(w);w=$("<div>");w.addClass("sa-qing-publish-card-extraicon-border");h.append(w);A.layoutCtrlWithLRTB(w,null,k,0,0,null,24);A.layoutCtrlMiddleAlign(w,24);k+=90}},showExtraOperateContainer:function(){if(h){h.show();var m=h[0].offsetTop,k=h.height();n.css("top",m+k+"px");$(window).trigger("resize")}},
hideExtraOperateContainer:function(){h&&(n.css("top",g.height()+"px"),h.hide(),$(window).trigger("resize"))}}}function I(a,d,e){var f=a,g=d,n,h,c;this.getJqUi=function(){n||(n=$("<div>"),h=$("<div>"),h.addClass("sa-qing-publish-card-icon"),u.Icons.background(h,g),c=$("<div>"),c.addClass("sa-qing-publish-card-extraicon-text"),c.text(f),A.layoutCtrl(h,0,0,16,16),A.layoutCtrl(c,21,0,60,16),n.append(h),n.append(c),n.on("click",e));return n};this.changeIcon=function(b){g=b;u.Icons.background(h,g)};this.changeName=
function(b){f=b;c.text(f)}}function J(){K.call(this);var a=this.protectedMethod,d=this,e,f=new Q;this.protectedCustomContent=function(c){e=new C;e.setSchemaLoadCallback(n);e.show(c)};this.protectedCustomHead=function(c){g()};this.protectedOpenSquare=function(){throw Error("override me");};this.protectedOpenAnalysis=function(){throw Error("override me");};this.protectedGetRefreshUrl=function(){throw Error("override me");};var g=function(){var c=$("<div class='sa-qing-publish-card-icon'>"),b=$("<div class='sa-qing-publish-card-icon'>"),
p=$("<div class = 'sa-qing-publish-card-icon'>"),l=$("<div class= 'sa-qing-publish-card-icon'>");b.on("click",function(){var k=a.getMainUi();e.checkOperatePermAndPrompt(k,C.PERM_TYPE_ENTER_SQUARE)&&d.protectedOpenSquare()});u.Icons.background(b,"btn-edit");b.on("mouseover",function(k){u.Icons.background(b,"btn-edit-on")});b.on("mouseout",function(k){u.Icons.background(b,"btn-edit")});b.attr("title",t.get("squareIntoDesigner","\u8fdb\u5165\u8bbe\u8ba1\u5668\u4e2a\u6027\u5316\u4fee\u6539"));c.on("click",
function(){var k=a.getMainUi();e.checkOperatePermAndPrompt(k,C.PERM_TYPE_ENTER_ANALYSIS)&&d.protectedOpenAnalysis()});u.Icons.background(c,"btn-analysis");c.on("mouseover",function(k){u.Icons.background(c,"btn-analysis-on")});c.on("mouseout",function(k){u.Icons.background(c,"btn-analysis")});c.attr("title",t.get("squareOpenAnalysis","\u6253\u5f00\u201c\u6570\u636e\u5206\u6790\u201d\u5de5\u5177"));p.on("click",h);u.Icons.background(p,"btn-refresh");p.on("mouseover",function(k){u.Icons.background(p,
"btn-refresh-on")});p.on("mouseout",function(k){u.Icons.background(p,"btn-refresh")});p.attr("title",t.get("cardRefresh","\u5237\u65b0"));l.on("click",function(){e.showExtraFilter(a.getMainUi())});u.Icons.background(l,"btn-filter");l.on("mouseover",function(k){u.Icons.background(l,"btn-filter-on")});l.on("mouseout",function(k){u.Icons.background(l,"btn-filter")});l.attr("title",t.get("cardFilter","\u8fc7\u6ee4\u6761\u4ef6"));l.hide();f.addIconUi(b);f.addIconUi(c);f.addIconUi(p);var m=f.getJqUi();
f.hide();$(document.body).on("mouseenter",function(){l.show();f.show()});$(document.body).on("mouseleave",function(){l.hide();f.hide()});a.appendOperateBtnUI([m,l])},n=function(){var c=new L;c.setDesc(e.getDescription());c.show(a.getMainUi(),a.getTitleUi())},h=function(){var c=d.protectedGetRefreshUrl();window.location.href=c};this.protectedMethod.reExcuteCard=h;this.protectedMethod.applyExternalFilter=function(c){e&&e.applyExternalFilter(c.getExternalFilterItem())};this.protectedMethod.setFilteringListener=
function(c){e&&e.setFilteringListener(c)}}function B(){K.call(this);var a=this.protectedMethod,d;this.protectedCustomContent=function(g){d||(d=new R,d.setSchemaLoadCallback(e),d.setDrawLegendCallback(function(){g.css("bottom","42px")}));d.show(g)};var e=function(){f()},f=function(){var g=new L;g.setDesc(d.getDescription());g.setShowOnlyMouseOn(!1);g.show(a.getMainUi(),a.getTitleUi());$(document.body).on("touchmove scroll",function(){g.hideTips()})};this.protectedMethod.getSquareExhibition=function(){return d}}
function S(){J.call(this);var a=this.protectedMethod;this.protectedOpenSquare=function(){var d=a.getUrlParam("pageId");if(top.window.invokeCustomEvent){var e={tag:a.getUrlParam("tag"),cardName:a.getTitle()};top.window.invokeCustomEvent(d,"",["QingCard","openSquare",JSON.stringify(e)])}};this.protectedOpenAnalysis=function(){var d=a.getUrlParam("pageId");if(top.window.invokeCustomEvent){var e={tag:a.getUrlParam("tag"),cardName:a.getTitle()};top.window.invokeCustomEvent(d,"",["QingCard","openAnalysis",
JSON.stringify(e)])}};this.protectedGetRefreshUrl=function(){var d=a.getUrlParam("pageId"),e=a.getUrlParam("skin"),f=a.getUrlParam("language"),g=a.getTitle(),n=a.getUrlParam("schemaAdditionalTag"),h=a.getUrlParam("bizTag"),c=a.getUrlParam("path");c=a.appendAccountIdParam((c?c:"/ierp")+"/qing/cardEntrance.do");h&&(c=a.appendUrlParam(c,"publishId",h));n&&(c=a.appendUrlParam(c,"cardId",n));g&&(c=a.appendUrlParam(c,"cardName",g));d&&(c=a.appendUrlParam(c,"pageId",d));e&&(c=a.appendUrlParam(c,"skin",e));
f&&(c=a.appendUrlParam(c,"language",f));return c}}function M(a,d,e,f){T.call(this,a,d,e,f);var g=this.protectedMethod;this.loadSquareSchema=function(n,h,c){g.remote("loadSquareSchema",{publishId:n,bizTag:h,schemaAdditionalTag:c})};this.loadSquareSchemaWithOper=function(n,h,c){g.remote("loadSquareSchemaWithOper",{publishId:n,bizTag:h,schemaAdditionalTag:c})};this.loadNocodeCardSchema=function(n){g.remote("loadNocodeCardSchema",{cardId:n})}}function Q(){var a,d=[],e,f,g;this.setParent=function(b){g=
b};this.getJqUi=function(){a=$("<div class='sa-qing-publish-card-showmoreicon'>");a.on("click",n);u.Icons.background(a,"btn-more");a.on("mouseover",function(b){u.Icons.background(a,"btn-more-on")});a.on("mouseout",function(b){u.Icons.background(a,"btn-more")});a.attr("title",t.get("cardMoreOperate","\u66f4\u591a"));return a};this.addIconUi=function(b){d.push(b)};this.show=function(){a&&a.show()};this.hide=function(){a&&a.hide();h()};var n=function(){if(e)e.is(":hidden")?e&&(e.show(),f.show()):h();
else{e=$("<div class='sa-qing-publish-card-iconcontainer'>");for(var b=0,p=d.length;b<p;b++){var l=d[b];l.addClass("sa-qing-public-card-iconimplicit");e.append(l)}b=a.position().top;p=a.height();e.css({top:p+b+12+"px",right:0});g?e.appendTo(g):e.appendTo($(document.body));c();$(document.body).on("click",function(m){$(m.target).hasClass("sa-qing-publish-card-showmoreicon")||h()})}},h=function(){e&&(e.hide(),f.hide())},c=function(){var b=11*Math.pow(2,.5),p=a.position().left+a.width()/2,l=e.position(),
m=l.left,k=l.top,q=e.width();l=b/2;p=Math.min(p-b/2,m+q-b);f=$("<div class='sa-qing-public-card-container'>");m=k-(parseInt(9/Math.pow(2,.5))+1);f.css({width:b+"px",height:l+"px",top:m+"px",left:p+"px"});b=$("<div class='sa-qing-public-card-arrow'>");b.css({width:"9px",height:"9px",top:l-4.5-1+"px",left:"50%","margin-left":"-4.5px"});b.appendTo(f);g?f.appendTo(g):f.appendTo($(document.body))}}function N(){H.call(this);var a;this.getRemoteUrl=function(d){return a};this.setRemoteUrl=function(d){a=d}}
function U(){com.kingdee.bos.qing.AbstractSquareIframeScene.call(this);var a=this,d=this.protectedMethod,e,f,g;this.setSchemaContent=function(b){e=b};this.setSchemaLoadCallback=function(b){g=b};this.applyExternalFilter=function(b){var p=d.copyFilters();if(p&&b)for(var l=b.getFieldName(),m=0;m<p.length;m++){var k=p[m];if(k.getAssociatedField().getText()==l){n(p,k,b);break}}};this.hasShowFilter=function(){try{var b=d.copyFilters()}catch(m){return!1}if(0==b.length)return!1;for(var p=!1,l=0;l<b.length;l++)if(b[l].isOnShow()){p=
!0;break}return p};var n=function(b,p,l){p.getPreparedModel()?h(b,p,l):d.updateFilterPreparedValue(b,p,function(m){m&&h(b,p,l)})},h=function(b,p,l){x.applyFilter(p,l);d.filtering(b)};this.protectedLoadingImpl=function(b){e?(b(e),g&&g()):c(function(){b(e);g&&g()})};this.protectedGetRemoteUrl=function(){var b=a.getUrlParam("path");return(b?b:"/ierp")+"/qing/core.do"};this.protectedShowErrorImpl=function(b,p,l,m){f||(f=new com.kingdee.bos.qing.scene.common.square.exhibition.CardErrorUi(b),f.setShowDetail(!0));
f.show(p,l,m);return!0};var c=function(b){a.protectedGetSchemaContent(function(p){e=p.schemaContentVo.schemaContent;b()},function(p,l,m){a.displayError(p,l,m)})};this.protectedGetSchemaContent=function(b,p){}}function C(){U.call(this);var a=this,d,e,f,g;this.protectedImportMoreCode=function(n){n.loadSkinJs("linkage","skin");n.loadJs("linkage/linkage.js");n.loadSkinCss("linkage","linkage")};this.checkOperatePermAndPrompt=function(n,h){if(!g)return!0;var c=!0;if(h==C.PERM_TYPE_ENTER_ANALYSIS){if(0!=
(g&1)){c=!1;var b=t.get("enterAnalysis","\u8fdb\u5165\u201c\u6570\u636e\u5206\u6790\u201d")}}else if(h==C.PERM_TYPE_ENTER_SQUARE)0!=(g&128)&&(c=!1,b=t.get("enterEdit","\u8fdb\u5165\u8bbe\u8ba1\u5668"));else throw Error("unknown permType");c||(h=t.get("cardEditUnaccessable","\u60a8\u6ca1\u6709#1\u7684\u6743\u9650").replace("#1",b),a.displayActionPrompt(n,h));return c};this.protectedCustomInitEnv=function(){e=a.getUrlParam("bizTag");f=a.getUrlParam("schemaAdditionalTag");d=a.getUrlParam("publishId");
var n=a.getUrlParam("path");n=(n?n:"/ierp")+"/qing/linkage.do";var h=new com.kingdee.bos.qing.linkage.LinkageManage;h.setCurrentLinkageTag(a.getUrlParam("tag"));h.initRuntime(n,com.kingdee.bos.qing.integration.LinkageJumper.jump);n=com.kingdee.bos.qing.behavior.BehaviorManager;n.interestInBehaviorEntrance(n.ENTRANCE_CARD);com.kingdee.bos.qing.integration.ImglibUrlParser.hookUrlParser()};this.protectedGetSchemaContent=function(n,h){var c=new N,b=a.getUrlParam("path");c.setRemoteUrl((b?b:"/ierp")+"/qing/card.do");
(new M(c,function(p){g=p.operation["2"]|p.operation["1"];n(p)},h)).loadSquareSchemaWithOper(d,e,f)}}function R(){com.kingdee.bos.qing.AbstractSquareIframeScene.call(this);var a=this,d=this.protectedMethod,e,f,g,n,h,c,b,p,l;this.protectedImportMoreCode=function(k){k.loadSkinJs("lightapp/common","skin");k.loadCss("lightapp/common/qing-lapp.css")};this.setDrawLegendCallback=function(k){b=k};this.setCloseFilterCallback=function(k){l&&l.setClosedListener(k)};this.hasFilter=function(){return l?l.hasFilters():
!1};this.getFilterUi=function(){return l&&l.hasFilters()?l.getJqUi():$("<div>")};this.updateFilterUi=function(){l&&l.updateUi()};this.protectedCustomInitEnv=function(){g=a.getUrlParam("path");n=a.getUrlParam("bizTag");h=a.getUrlParam("publishId");c=new N;c.setRemoteUrl((g?g:"/ierp")+"/qing/card.do");var k=com.kingdee.bos.qing.behavior.BehaviorManager;k.interestInBehaviorEntrance(k.ENTRANCE_CARD)};this.protectedDrawCustomLegend=function(k,q){com.kingdee.bos.qing.chart.SquareConfig.COMBO_LEGEND_MODE=
!1;k!=com.kingdee.bos.qing.square.model.SquareModel.ChartType_GIS&&(k=(new com.kingdee.bos.qing.lapp.ui.LappSquareLegendRender).createLegendUi(k,q))&&(k.appendTo($(document.body)),b())};this.setSchemaLoadCallback=function(k){p=k};this.protectedLoadingImpl=function(k){f?(k(f),p&&p()):m(function(){k(f);p&&p();l||(l=new com.kingdee.bos.qing.lapp.ui.LappFilter(d.copyFilters,d.updateFilterPreparedValue,d.filtering))})};this.protectedGetRemoteUrl=function(){return(g?g:"/ierp")+"/qing/core.do"};this.protectedShowErrorImpl=
function(k,q,r,w){e||(e=new com.kingdee.bos.qing.scene.common.square.exhibition.CardErrorUi(k),e.setShowDetail(!0));e.show(q,r,w);return!0};var m=function(k){(new M(c,function(q){f=q.schemaContent;k()},function(q,r,w){a.displayError(q,r,w)})).loadSquareSchema(h,n)}}function L(){var a,d,e,f,g,n=!0,h;this.setDesc=function(l){a=l};this.show=function(l,m){d=l;e=m;c()};this.hideTips=function(){f&&f.removeTips()};this.setShowOnlyMouseOn=function(l){n=l};var c=function(){b();h||(h=new com.kingdee.bos.qing.framework.common.WindowResizeObserver,
h.setDelay(100),h.setCallback(function(){b()}),h.observe())},b=function(){var l=function(){var m=e.width(),k=e.text();if(0==m)setTimeout(l,100);else{var q=e.height(),r=e.position(),w=r.top;r=r.left;k=p(k,e.css("font-size"));m=r+Math.min(m,k)+5;q=w+(q-16)/2;a&&(g||(f=new E,f.setIconType(E.ICON_TYPE_QUESTION),f.setContainer(d),f.setTipsText(a),g=f.getJqUi(),g.appendTo(d),n&&(g.hide(),$(document.body).on("mouseenter",function(){g.show()}),$(document.body).on("mouseleave",function(){g.hide()}))),g.css({position:"absolute",
left:m+"px",top:q+"px"}))}};l()},p=function(l,m){m||(m="12px");var k=$("<div>");k.css({position:"absolute","font-size":m,visibility:"hidden",height:"auto",width:"auto","white-space":"nowrap"});k.appendTo($(document.body));k.text(l);l=k.outerWidth();k.remove();return l}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.scene&&
(com.kingdee.bos.qing.scene={});"undefined"==typeof com.kingdee.bos.qing.scene.cardExhibition&&(com.kingdee.bos.qing.scene.cardExhibition={});var u=com.kingdee.bos.qing.scene.cardExhibition;u.DSBCardContainer=function(){K.call(this);var a=this.protectedMethod,d;this.protectedCustomContent=function(f){if(!d){var g=a.getUrlParam("pageId"),n=a.getUrlParam("skin"),h=a.getUrlParam("language"),c=a.getUrlParam("publishId"),b=a.getUrlParam("path");b=(b?b:"/ierp")+"/qing/publishEntrance.do";c&&(b=a.appendUrlParam(b,
"publishId",c));g&&(b=a.appendUrlParam(b,"pageId",g));n&&(b=a.appendUrlParam(b,"skin",n));h&&(b=a.appendUrlParam(b,"language",h));b=com.kingdee.bos.qing.integration.PageHelper.getIframeUrl(b);d=$("<iframe>");d.css({position:"absolute",left:0,top:0,height:"100%",width:"100%",border:"none"});d.attr("allowfullscreen","true");d.attr("src",b)}d.appendTo(f)};this.protectedCustomHead=function(f){var g=$("<div class = 'sa-qing-publish-card-icon'>");g.css({position:"absolute",right:0,top:"5px"});g.on("click",
e);u.Icons.background(g,"btn-refresh");g.on("mouseover",function(n){u.Icons.background(g,"btn-refresh-on")});g.on("mouseout",function(n){u.Icons.background(g,"btn-refresh")});g.attr("title",t.get("cardRefresh","\u5237\u65b0"));$(document.body).on("mouseenter",function(){g.show()});$(document.body).on("mouseleave",function(){g.hide()});g.appendTo(f);g.hide()};var e=function(){var f=a.getUrlParam("pageId"),g=a.getUrlParam("skin"),n=a.getUrlParam("language"),h=a.getTitle(),c=a.getUrlParam("publishId"),
b=a.getUrlParam("path");b=a.appendAccountIdParam((b?b:"/ierp")+"/qing/cardEntrance.do");c&&(b=a.appendUrlParam(b,"publishId",c));h&&(b=a.appendUrlParam(b,"cardName",h));f&&(b=a.appendUrlParam(b,"pageId",f));g&&(b=a.appendUrlParam(b,"skin",g));n&&(b=a.appendUrlParam(b,"language",n));window.location.href=b}};u.RemoteImpl=N;u.AbstractDesktopExhibition=U;u.IconContainer=Q;u.CardFacade=M;var T,H,t,A,F,E,D;(function(){var a=com.kingdee.bos.qing;D=a.Seer;a=com.kingdee.bos.qing.framework.common;T=a.AbstractFacade;
H=a.AbstractRemoteCall;t=a.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.scene);F=a.AbstractIcons;a=com.kingdee.bos.qing.ui.component;E=a.HelpIcon;a=com.kingdee.bos.qing.common;A=a.DomUtil})();u.CardContainerFactory=new function(){var a={};this.getCardContainer=function(d){return(d=a[d])?new d:new S};this.getCardErrContainer=function(){return new W};this.regist=function(d,e){a[d]=e}};u.CardContainerFactory.regist("mobileCtrl_FullScreen",function(){B.call(this);var a=this.protectedMethod,
d,e,f,g,n;this.protectedCustomHead=function(r){d||(d=$("<div class='sa-qing-publish-card-icon'>"),d.on("click",h),u.Icons.background(d,"btn-back"),a.insertOperateBtnUI([d]));d.show();e||(e=$("<div class='sa-qing-publish-card-icon'>"),e.on("click",b),u.Icons.background(e,"btn-list"),a.appendOperateBtnUI([e]));e.show()};var h=function(){var r=a.getUrlParam("pageId");top.window.invokeCustomEvent&&top.window.invokeCustomEvent(r,"",["","closeView",JSON.stringify({})])},c=!1,b=function(){if(c)a.hideExtraOperateContainer(),
q(),c=!1;else{if(!f){var r=[];a.getSquareExhibition().hasFilter()&&(g=new I(t.get("lappFilter","\u8fc7\u6ee4"),"lapp-filter",k),r.push(g));f=new I(t.get("landscapeBtn","\u6a2a\u5c4f"),"btn-horizontal",l);r.push(f);a.insertExtraOperateBtn(r)}a.showExtraOperateContainer();c=!0}},p=!1,l=function(){if(p)try{var r=window.screen.orientation;r&&(r.lock("portrait-primary"),f&&(f.changeName(t.get("landscapeBtn","\u6a2a\u5c4f")),f.changeIcon("btn-horizontal")),$(window).trigger("resize"),p=!1)}catch(G){}else try{var w=
window.screen.orientation;w&&(w.lock("landscape-primary"),f.changeName(t.get("verticalScreenBtn"),"\u7ad6\u5c4f"),f.changeIcon("btn-vertical"),$(window).trigger("resize"),p=!0)}catch(G){}},m=!1,k=function(){if(m)q();else{g.changeIcon("lapp-filter-on");var r=a.getSquareExhibition().getFilterUi();n||(n=$("<div>"),n.append(r),n.appendTo(a.getContentUi()));r.show();A.layoutCtrlWithLRTB(n,0,0,null,0,44,null);a.getSquareExhibition().updateFilterUi();n.show();m=!0}},q=function(){n&&n.hide();g&&g.changeIcon("lapp-filter");
m=!1}});u.CardContainerFactory.regist("mobileCtrl",function(){B.call(this);var a=this.protectedMethod,d,e,f,g,n,h,c,b;this.protectedCustomHead=function(z){d=$("<div class = 'sa-qing-publish-card-icon'>");d.on("click",m);u.Icons.background(d,"btn-refresh");d.attr("title",t.get("cardRefresh","\u5237\u65b0"));e=$("<div class = 'sa-qing-publish-card-icon'>");e.on("click",p);u.Icons.background(e,"btn-fullscreen");e.attr("title",t.get("fullScreenBtn","\u5168\u5c4f"));a.appendOperateBtnUI([e,d])};var p=
function(){if(document.body.requestFullScreen||document.body.webkitRequestFullScreen||document.body.msRequestFullscreen||document.body.mozRequestFullScreen)b||(b=com.kingdee.bos.qing.common.FullScreenHelper,b.addChangedListener(l)),b.request(document.body);else{var z=a.getUrlParam("pageId");if(top.window.invokeCustomEvent){var O={tag:a.getUrlParam("tag"),ctrlName:a.getUrlParam("ctrlName"),ctrlRefId:a.getUrlParam("ctrlRefId"),hasCustomSchema:a.getUrlParam("hasCustomSchema")};top.window.invokeCustomEvent(z,
"",["","openFullScreenForm",JSON.stringify(O)])}}},l=function(z){null==z?k():z==document.body&&(a.getMainUi().css("top","44px"),d.hide(),e.hide(),f||(f=$("<div class='sa-qing-publish-card-icon'>"),f.on("click",k),u.Icons.background(f,"btn-back"),a.insertOperateBtnUI([f])),f.show(),g||(g=$("<div class='sa-qing-publish-card-icon'>"),g.on("click",r),u.Icons.background(g,"btn-list"),a.appendOperateBtnUI([g])),g.show())},m=function(){var z=a.getUrlParam("pageId"),O=a.getUrlParam("skin"),Y=a.getUrlParam("language"),
Z=a.getTitle(),aa=a.getUrlParam("ctrlRefId"),ba=a.getUrlParam("cardScene"),ca=a.getUrlParam("ctrlName"),da=a.getUrlParam("hasCustomSchema"),y=a.getUrlParam("path");y=(y?y:"/ierp")+"/qing/devctrlCardEntrance.do";aa&&(y=a.appendUrlParam(y,"ctrlRefId",aa));Z&&(y=a.appendUrlParam(y,"cardName",Z));z&&(y=a.appendUrlParam(y,"pageId",z));O&&(y=a.appendUrlParam(y,"skin",O));Y&&(y=a.appendUrlParam(y,"language",Y));ba&&(y=a.appendUrlParam(y,"cardScene",ba));ca&&(y=a.appendUrlParam(y,"ctrlName",ca));da&&(y=a.appendUrlParam(y,
"hasCustomSchema",da));y=a.appendUrlParam(y,"mobileCtrl",!0);window.location.href=y},k=function(){d.show();e.show();g.hide();f.hide();a.hideExtraOperateContainer();X();b.exit();v();a.getMainUi().css("top","0px");q=w=P=!1},q=!1,r=function(){if(q)a.hideExtraOperateContainer(),X(),q=!1;else{if(!n){var z=[];a.getSquareExhibition().hasFilter()&&(h=new I(t.get("lappFilter","\u8fc7\u6ee4"),"lapp-filter",V),z.push(h));n=new I(t.get("landscapeBtn","\u6a2a\u5c4f"),"btn-horizontal",G);z.push(n);a.insertExtraOperateBtn(z)}a.showExtraOperateContainer();
q=!0}},w=!1,G=function(){if(w)v();else try{var z=window.screen.orientation;z&&(z.lock("landscape-primary"),n.changeName(t.get("verticalScreenBtn"),"\u7ad6\u5c4f"),n.changeIcon("btn-vertical"),$(window).trigger("resize"),w=!0)}catch(O){}},v=function(){try{var z=window.screen.orientation;z&&(z.lock("portrait-primary"),n&&(n.changeName(t.get("landscapeBtn","\u6a2a\u5c4f")),n.changeIcon("btn-horizontal")),$(window).trigger("resize"),w=!1)}catch(O){}},P=!1,V=function(){if(P)X();else{h.changeIcon("lapp-filter-on");
var z=a.getSquareExhibition().getFilterUi();c||(c=$("<div>"),c.append(z),c.appendTo(a.getContentUi()));z.show();A.layoutCtrlWithLRTB(c,0,0,null,0,44,null);a.getSquareExhibition().updateFilterUi();c.show();P=!0}},X=function(){c&&c.hide();h&&h.changeIcon("lapp-filter");P=!1}});u.CardContainerFactory.regist("devctrl",function(){J.call(this);var a=this.protectedMethod,d=this.protectedCustomContent;this.protectedCustomContent=function(h){d(h);com.kingdee.bos.qing.integration.CardCtrlMsgHandler.setCallback(n);
h=com.kingdee.bos.qing.msgbus.MsgBus;h.focus(h.MESSAGE_TYPE_FILTERACTION,e);h.focus(h.MESSAGE_TYPE_REFRESHACTION,f);a.setFilteringListener(g)};var e=function(h){a.applyExternalFilter(h)},f=function(h){a.reExcuteCard()},g=function(){var h=com.kingdee.bos.qing.msgbus.MsgBus,c=a.getUrlParam("parentPageId");h.sendMsg(c,"hello world",h.MESSAGE_TYPE_CUSTOMEVENT)};this.protectedOpenSquare=function(){var h=a.getUrlParam("pageId");if(top.window.invokeCustomEvent){var c={tag:a.getUrlParam("tag"),cardName:a.getUrlParam("cardName"),
formPageId:a.getUrlParam("formPageId"),publishId:a.getUrlParam("publishId"),schemaAdditionalTag:a.getUrlParam("schemaAdditionalTag"),bizTag:a.getUrlParam("bizTag"),hasMainView:a.getUrlParam("hasMainView")};top.window.invokeCustomEvent(h,"",["","openSquare",JSON.stringify(c)])}};this.protectedOpenAnalysis=function(){var h="true"==a.getUrlParam("hasMainView");var c=a.getUrlParam("path");c=(c?c:"/ierp")+"/qing/editAnalysisCardEntrance.do";var b=a.getUrlParam("skin"),p=a.getUrlParam("language"),l=a.getUrlParam("publishId"),
m=a.getUrlParam("bizTag"),k=a.getUrlParam("schemaAdditionalTag"),q=a.getUrlParam("cardScene"),r=a.getUrlParam("tag");l&&(c=a.appendUrlParam(c,"publishId",l));m&&(c=a.appendUrlParam(c,"bizTag",m));q&&(c=a.appendUrlParam(c,"cardScene",q));k&&(c=a.appendUrlParam(c,"schemaAdditionalTag",k));b&&(c=a.appendUrlParam(c,"skin",b));p&&(c=a.appendUrlParam(c,"language",p));r&&(c=a.appendUrlParam(c,"tag",r));top.window.invokeCustomEvent&&h?(h={tag:a.getUrlParam("tag"),cardName:a.getUrlParam("cardName"),bizTag:a.getUrlParam("bizTag"),
publishId:a.getUrlParam("publishId"),schemaAdditionalTag:a.getUrlParam("schemaAdditionalTag")},c=a.getUrlParam("pageId"),top.window.invokeCustomEvent(c,"",["","openAnalysis",JSON.stringify(h)])):window.open(c)};this.protectedGetRefreshUrl=function(){var h=a.getUrlParam("pageId"),c=a.getUrlParam("skin"),b=a.getUrlParam("language"),p=a.getTitle(),l=a.getUrlParam("schemaAdditionalTag"),m=a.getUrlParam("cardScene"),k=a.getUrlParam("hasMainView"),q=a.getUrlParam("ctrlRefId"),r=a.getUrlParam("ctrlName"),
w=a.getUrlParam("hasCustomSchema"),G=a.getUrlParam("parentPageId"),v=a.getUrlParam("path");v=(v?v:"/ierp")+"/qing/devctrlCardEntrance.do";q&&(v=a.appendUrlParam(v,"ctrlRefId",q));l&&(v=a.appendUrlParam(v,"schemaAdditionalTag",l));p&&(v=a.appendUrlParam(v,"cardName",p));h&&(v=a.appendUrlParam(v,"pageId",h));c&&(v=a.appendUrlParam(v,"skin",c));b&&(v=a.appendUrlParam(v,"language",b));m&&(v=a.appendUrlParam(v,"cardScene",m));k&&(v=a.appendUrlParam(v,"hasMainView",k));r&&(v=a.appendUrlParam(v,"ctrlName",
r));w&&(v=a.appendUrlParam(v,"hasCustomSchema",w));G&&(v=a.appendUrlParam(v,"parentPageId",G));return v};var n=function(h){(h=h.content)&&h.refreshCard&&a.reExcuteCard()}});C.PERM_TYPE_ENTER_ANALYSIS="enter_analysis";C.PERM_TYPE_ENTER_SQUARE="enter_square";u.Icons=new function(){F.call(this);var a=this.protectedMethod;this.protectedInit=function(e,f){e=com.kingdee.bos.qing.scene.cardExhibition.ComboIcon;if(!e)throw Error("com.kingdee.bos.qing.scene.cardExhibition.ComboIcon not found.");e.define(f,
"publish-resource-sprite");f.setStartPosition(1,1);f.setGap(1);f.setIconSize(16,16);d(0,0,"btn-analysis");d(1,0,"btn-analysis-on");d(0,1,"btn-edit");d(1,1,"btn-edit-on");d(0,2,"btn-filter");d(1,2,"btn-filter-on");d(0,3,"btn-refresh");d(1,3,"btn-refresh-on");d(0,4,"btn-more");d(1,4,"btn-more-on");d(2,0,"btn-list");d(3,0,"btn-list-on");d(2,1,"lapp-filter");d(3,1,"lapp-filter-on");d(2,2,"btn-horizontal");d(3,2,"btn-vertical");d(2,3,"btn-fullscreen");d(3,3,"btn-back")};var d=function(e,f,g){a.registIcon(e,
f,g)}};var x=new function(){this.applyFilter=function(a,d){var e=com.kingdee.bos.qing.msgbus.ExternalFilterItem,f=d.getFilterType();if(e.FILTER_TYPE_DISCRETE==f){if(a instanceof com.kingdee.bos.qing.core.model.DiscreteFilter)for(e=a.getPreparedModel().getItems(),d=d.getValues(),f=0;f<e.length;f++)for(var g=0;g<d.length;g++){var n=d[g],h=e[f];h.getValue()==n?a.addSelectedValue(n):a.removeSelectedValue(h.getValue())}}else e.FILTER_TYPE_DATERANGE==f?a instanceof com.kingdee.bos.qing.core.model.ContinuousDateFilter&&
(f=a.getPreparedModel(),e=f.getFromDateMs(),g=f.getToDateMs(),f=d.getStartDate(),d=d.getEndDate(),d=0==d&&g?g:d,a.setFromDateMs(0==f&&e?e:f),a.setToDateMs(d)):e.FILTER_TYPE_CONTINUOUS==f&&(f=a.getPreparedModel(),e=d.getFloor(),d=d.getCeiling(),g=f.getMin(),f=f.getMax(),a.setValue(e?e:g,d?d:f))}};u.ExternalFilterHelper=x})();(function(){function W(){com.kingdee.bos.qing.AbstractSquareDivScene.call(this);var t=this.protectedMethod,A,F,E;this.setSchemaContent=function(x){A=x};this.setSchemaLoadCallback=function(x){E=x};this.createChartInfoUi=function(x){return t.createChartInfoUi(x)};this.createInsightUi=function(x){return t.createInsightUi(x)};this.protectedLoadingImpl=function(x){x=x(A);E&&E(x)};this.protectedShowErrorImpl=function(x,a,d,e){F||(F=new com.kingdee.bos.qing.scene.common.square.exhibition.CardErrorUi(x),
F.setShowDetail(!0));F.show(a,d,e);return!0};this.protectedInitMode=function(){R.init();D();var x=new L;x.setCallbackImmediately(function(){D()});x.setDelay(10);x.setCallback(function(){t.redraw()});x.observe()};var D=function(){document.body.style.height=document.documentElement.clientHeight+"px"}}function K(){com.kingdee.bos.qing.AbstractModalDesignerScene.call(this);var t,A,F,E=!0,D,x=!0;this.setIsSquare=function(a){E=a};this.protectedIsSquare=function(){return E};this.protectedInitDesigner=function(a){var d=
C.get("finish","\u5b8c\u6210");a.getConductor().insertToolbarButton(function(f){A(a)},"btn_save",d,null);d=new Q;var e=new N(function(f){f=new U;f.setText(C.get("resetConfirmTips","\u60a8\u786e\u5b9a\u8981\u91cd\u7f6e\u5230\u53d1\u5e03\u6700\u521d\u59cb\u7684\u72b6\u6001\uff0c\u5e76\u9000\u51fa\u5417\uff1f"));f.setConfirmedListener(function(n){n&&F(a)});var g=(void 0).getJqUi();f.show(g)});e.setText(C.get("resetAndBack","\u91cd\u7f6e\u5e76\u8fd4\u56de"));d.addItemModel(e);a.setDesignerOperationJudger(x?
null:D,x?D:null);if(d=window.com.kingdee.bos.qing.AnalysisSceneOuterApi)d.inside.setDirtyChecker(function(){return!1}),d.inside.setBeforeClosing(function(){return TabStatusHelper.setTabStatus(!1)})};this.protectedLoading=function(a,d){t(a,d)};this.setSchemaLoader=function(a){t=a};this.setSchemaSaver=function(a){A=a};this.setSchemaReseter=function(a){F=a};this.setDesignerOperationJudger=function(a){D=a};this.setSquareOrLonger=function(a){x=a};this.protectedIsSquare=function(){return x}}"undefined"==
typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.scene&&(com.kingdee.bos.qing.scene={});var I=com.kingdee.bos.qing.scene;I.ThemeAIAnalysisScene=function(){this.preload=function(c){S.importSkin(B);S.importI18n(B);B.loadSkinJs("schema-manage","skin-initialize");B.loadI18n("schema-manage","schema-initialize");B.loadSkinCss("schema-manage",
"schema-manage");B.loadSkinJs("map-designer","integration-skin");B.loadJs("map-designer/map-integration.js");B.loadSkinCss("map-designer","map-integration");B.loadI18n("map-designer","map-integration");B.loadSkinCss("ai-analysis","ai-analysis");B.loadSkinJs("ai-analysis","skin");B.loadJs("ai-analysis/ai-analysis-ui.js");B.loadI18n("ai-analysis","ai-analysis");B.setCallback(c)};this.start=function(){R.init();t();var c=d("themeName"),b=com.kingdee.bos.qing.ai.analysis.Integration;b.setTag(d("tag"));
b.setThemeId(d("themeId"));b.setThemeName(c);b.setChartCreator(E);b.setRefreshChart(F);b.setAIAnalysisRemoteImpl(e());b.setSchemaRemoteImpl(g());b.setLappRemoteImpl(f());b.setOpenDesigner(A);b.setDataModelEntrance(function(){var l=d("themeId"),m=d("isPreset"),k=M.getUrlParamValue(),q=C.get("dataModeling","\u6570\u636e\u51c6\u5907")+"-"+c,r=h()+"/qing/dataModelingEntrance.do";r=H.appendParamToUrl(r,"themeID",l);r=H.appendParamToUrl(r,"isPreset",m);k&&(r=H.appendParamToUrl(r,"skin",k));u.openNewTab(q,
r);u.closeCurrentTab()});var p=new com.kingdee.bos.qing.ai.analysis.AIAnalysisMain;p.setThemeName(c);b=$(document.body);b.css("overflowY","hidden");p.getJqUi().appendTo(b);b=new L;b.setDelay(250);b.setCallback(function(){p.resize()});b.observe();b=com.kingdee.bos.qing.behavior.BehaviorManager;b.interestInBehaviorEntrance(b.ENTRANCE_THEME_AI_ANALYSIS)};var t=function(){var c=com.kingdee.bos.qing.map.common.Integration,b=h();c.setRemoteUrl(b+"/qing/mapManage.do");var p=new com.kingdee.bos.qing.map.integration.MapSelectorDialog;
com.kingdee.bos.qing.core.MapLibraryRegister.registerTemplateSelector(function(l,m){p.setParamPathPrefix(b);p.showDialog(l,m)})},A=function(c,b,p){var l=d("tag"),m=new K,k=function(q){m.hide();q&&p(q)};m.setIsSquare(!0);m.setRemoteUrl(n());m.setRemoteTag(l);m.setSquareOrLonger(!0);m.setClosable(!0);m.setSchemaLoader(function(q,r){q.setJsonModelBook(b);r(!0)});m.setSchemaSaver(function(q){q=q.getJsonModelBook();k(q)});m.setSchemaReseter(function(q){k(null)});m.show(c,function(){k(null)})},F=function(c,
b,p){b.children().remove();D(b,function(l){var m=d("tag"),k=n(),q=new W;q.setRemoteUrl(k);q.setRemoteTag(m);q.setSchemaContent(c);q.setExecutedListener(function(r){p(r,q.redraw,q.createChartInfoUi,q.createInsightUi)});q.show(l)})},E=function(c,b,p,l,m){D(b,function(k){x(c,k,p,l,m)})},D=function(c,b){var p=$("<div>");p.appendTo(c);T.layoutCtrlWithLRTB(p,0,0,null,0,0,null);var l=com.kingdee.bos.qing.prepare.AIAnalysisDataExtractor;l.getJqUi().appendTo(c);l.start();l.setExtractDataFinishedSuccessCallback(function(){b(p)})},
x=function(c,b,p,l,m){var k=d("tag"),q=n(),r=new W;r.setRemoteUrl(q);r.setRemoteTag(k);a(k,c,b,function(w){var G=w.schema,v=w.chartInfo,P=w.view;r.setSchemaContent(G.schemaContent);r.setSchemaLoadCallback(function(V){p(G.schemaName,V,v,P,r.redraw,r.createChartInfoUi,r.createInsightUi)});r.setExecutedListener(function(V){l(V,r.createInsightUi)});r.show(b)},function(w,G,v){m(w,G,v);return!0})},a=function(c,b,p,l,m){var k=e();l=new com.kingdee.bos.qing.ai.analysis.AIAnalysisFacade(k,l,m);l.setBlockingJqUi(p);
l.loadAIAnalysisSchema(c,b)},d=function(c){return H.decodeParamFromUrl(location.search,c)},e=function(){var c=new J,b=h()+"/qing/AIAnalysis.do";c.setRemoteUrl(b);return c},f=function(){var c=new J,b=h()+"/qing/lapp.do";c.setRemoteUrl(b);return c},g=function(){var c=new J,b=h()+"/qing/schemaManage.do";c.setRemoteUrl(b);return c},n=function(){return h()+"/qing/core.do"},h=function(){var c=H.decodeParamFromUrl(location.search,"path");return c?c:"/ierp"}};var J,B,S,M,Q,N,U,C,R,L,u,T,H;(function(){var t=
com.kingdee.bos.qing;B=t.CodeLoader;S=t.CommonCodeImporter;M=t.SkinUtil;t=com.kingdee.bos.qing.ui.component;Q=t.MenuModel;N=t.MenuItemModel;U=t.SimpleConfirmer;t=com.kingdee.bos.qing.framework.common;C=t.MultilanguageManager.createPackageAccessor(I);R=t.WebPageInitializer;L=t.WindowResizeObserver;u=t.TabbedUiUtil;t=com.kingdee.bos.qing.common;T=t.DomUtil;H=t.Util;t=com.kingdee.bos.qing.scene.cardExhibition;J=t.RemoteImpl})()})();
//qingVersionTag: 20250324