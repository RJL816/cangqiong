(function(){function I(){Z.call(this);var m=this,f=this.protectedMethod,z,R,aa,K,U;this.setCurrentPublishSchema=function(a){U=a};this.setUserOperatorPrevCheck=function(a){aa=a};this.setCloseResourceLock=function(a){};this.protectedHaveToCarryData=function(){return!1};this.protectedNeedToShowMessageBox=function(){return!0};this.protectedGetRemoteUrl=function(){var a=f.getUrlParamUtil().getParamPathPrefix();return(a?a:"/ierp")+"/qing/core.do"};this.protectedImportMoreCode=function(a){a.pushSkinJs("scene",
"skin");a.pushI18n("scene","scene")};this.protectedCustomInitEnv=function(a){a=$("<div>");a.css({position:"fixed",bottom:"3px",right:"1px",width:"180px",height:"18px",zIndex:"999"});la(a);m.protectedNeedToShowMessageBox()&&ha(a);a.appendTo($(document.body));com.kingdee.bos.qing.integration.ImglibUrlParser.hookUrlParser()};var la=function(a){G.setCallback(function(){var b=new com.kingdee.bos.qing.support.Main;b.setParamLanguage(f.getUrlParamUtil().getParamLanguage());b.creatSupportUi(a)});G.loadCss("support/support.css");
G.loadJs("support/support-ui.js");G.loadI18n("support","support")},ha=function(a){G.setCallback(function(){var b=com.kingdee.bos.qing.common.Util.decodeParamFromUrl(window.location.search,"path");b=b?b:"/ierp";com.kingdee.bos.qing.message.common.Integration.setRemoteUrl(b+"/qing/messageManage.do");ma(b);var e=new com.kingdee.bos.qing.message.ui.Main;e.setFunOpenMessageDialog(function(){e.setViewSize(null,null,10,30)});e.setMessageWidth(80);e.getJqUi(25).appendTo(a)});G.loadSkinCss("message","message");
G.loadSkinJs("message","skin");G.loadJs("message/message-manage-ui.js");G.loadI18n("message","message")},ma=function(a){var b=com.kingdee.bos.qing.message.common.Integration;b.setImportJSCodeForManager(function(){var g=com.kingdee.bos.qing.CodeLoader;g.setCallback(function(){var p=com.kingdee.bos.qing.theme.message.panel.common.Integration;p.setFunPublishRemoteImpl(function(){var d=new com.kingdee.bos.qing.theme.message.panel.common.RemoteImpl;d.setRemoteUrl(a+"/qing/publishTo.do");return d});p.setFunQingCenterAndMenuEntrance(function(d,
c,k,r){c=H.getUrlParamValue();var h=a+"/qing/publishEntrance.do";h=l.appendParamToUrl(h,"publishId",d);"extreport"==r?(h=l.appendParamToUrl(h,"appID","qing_rpt"),c&&(h=l.appendParamToUrl(h,"skin",c)),D.openNewTabInAppId(k,h,h,D.QING_RPT)):(c&&(h=l.appendParamToUrl(h,"skin",c)),D.openNewTabInAppId(k,h,h,D.QING_ANALYSIS))});p.setResourceRemoteUrl(a+"/qing/resource.do");p.setDataModelEntrance(function(d,c,k){var r=H.getUrlParamValue();c=C.get("dataModeling","\u6570\u636e\u51c6\u5907")+"-"+c;var h=a+
"/qing/dataModelingEntrance.do";h=l.appendParamToUrl(h,"themeID",d);h=l.appendParamToUrl(h,"isPreset",k);r&&(h=l.appendParamToUrl(h,"skin",r));D.openNewTabInAppId(c,h,h,D.QING_ANALYSIS)});p.setFunPublishContext(function(){var d=new com.kingdee.bos.qing.publish.common.PublishContext;d.setParamPathPrefix(a);d.setLappEntranceUrl(a+"/qing/lappEntrance.do");d.setSpaceID(N.getUrlParamValue("qingID"));return d});p.setFunPublishedEmailLoginViewUrl(function(){var d=H.getUrlParamValue(),c=N.getUrlParamValue("language"),
k=a+"/qing/publishedEmailEntrance.do?publishId=(publishId)&kdcdc=(accountId)";d&&(k=l.appendParamToUrl(k,"skin",d));c&&(k=l.appendParamToUrl(k,"language",c));return k});p.setFunPublishedEmailAnonymousViewUrl(function(){var d=H.getUrlParamValue(),c=N.getUrlParamValue("language"),k=a+"/index.html?userId=Guest&accountId=(accountId)&appNumber=qing&formId=qing_analysis_pub_email#/dform?appNumber=qing&formId=qing_analysis_pub_email&publishId=(publishId)";d&&(k=l.appendParamToUrl(k,"skin",d));c&&(k=l.appendParamToUrl(k,
"language",c));return k});p.setFunPublishContentEditEntrance(function(){return function(d,c,k){var r=com.kingdee.bos.qing.publish.model.PublishTargetType;if(k&&r.MOBILE==k){r=d.getPublishId();var h=d.getId()}else r=d.getId();var q=H.getUrlParamValue(),L=N.getUrlParamValue("language");k=a+"/qing/publishContentEditEntrance.do";k=l.appendParamToUrl(k,"skin",q);k=l.appendParamToUrl(k,"language",L);k=l.appendParamToUrl(k,"publishId",r);h&&(k=l.appendParamToUrl(k,"lappId",h));h=k;c&&(r="editPublishedContent-"+
r,q=com.kingdee.bos.qing.publish.common.PublishSubscribeHelper,q.putSubscribe(r,c),k=l.appendParamToUrl(k,"subscribeKey",r),k=l.appendParamToUrl(k,"currentPageClientId",q.getCurrentPageClientId()));c=com.kingdee.bos.qing.framework.common.TabbedUiUtil;c.openNewTabInAppId(C.get("editPublishedContent","\u7f16\u8f91\u53d1\u5e03\u65b9\u6848-")+d.getName(),k,h,c.QING_ANALYSIS)}});p.setFunTimedPushContentEditEntrance(function(){return function(d){var c=a+"/qing/timedPushContentEditEntrance.do",k=C.get("editTimedPushContent",
"\u7f16\u8f91\u63a8\u9001\u65b9\u6848");if(d instanceof com.kingdee.bos.qing.timedpush.model.EmailConfig){var r=d.getId(),h=d.getPublishSourceType();q=d.getSchemaSourceType();c=l.appendParamToUrl(c,"configId",r);c=l.appendParamToUrl(c,"publishSourceType",h);c=l.appendParamToUrl(c,"schemaType",q);c=l.appendParamToUrl(c,"pushTarget","email");k=k+"-"+d.getNameRule().getName();d.isSourceNameNotFound()&&(c=l.appendParamToUrl(c,"errorCode","2301001"))}else{r=d.getId();h=d.getPushTargetType();var q=d.getSchemaType();
c=l.appendParamToUrl(c,"configId",r);c=l.appendParamToUrl(c,"pushTargetType",h);c=l.appendParamToUrl(c,"schemaType",q);c=l.appendParamToUrl(c,"pushTarget","lapp");k=k+"-"+d.getName();d.getSourceName()||(c=l.appendParamToUrl(c,"errorCode","2301001"))}d=H.getUrlParamValue();q=N.getUrlParamValue("language");d&&(c=l.appendParamToUrl(c,"skin",d));q&&(c=l.appendParamToUrl(c,"language",q));d=com.kingdee.bos.qing.framework.common.TabbedUiUtil;d.openNewTabInAppId(k,c,c,d.QING_ANALYSIS)}});p=com.kingdee.bos.qing.modeler.message.panel.common.Integration;
p.setMessageRemoteUrl(a+"/qing_modeler/message.do");p.setFunOpenModelSetPage(function(d,c){var k=H.getUrlParamValue(),r=C.get("modelSet","\u6a21\u578b\u96c6-")+c,h=a+"/qing_modeler/modelSetMainPage.do";h=l.appendParamToUrl(h,"modelSetId",d);h=l.appendParamToUrl(h,"modelSetName",c);h=l.appendParamToUrl(h,"currentPageClientId",com.kingdee.bos.qing.framework.common.RemoteFramework.getClientID());k&&(h=l.appendParamToUrl(h,"skin",k));D.openNewTabInAppId(r,h,h,D.QING_MODELER)});p.setFunOpenModelDesign(function(d,
c,k,r,h){var q=com.kingdee.bos.qing.modeler.message.panel.common.ModelType,L=H.getUrlParamValue();h=(h=q.getModelTypeText(h))?h+"-"+k:k;q=a+"/qing_modeler/deployDesignerEntrance.do";q=l.appendParamToUrl(q,"modelSetId",d);q=l.appendParamToUrl(q,"modelId",c);q=l.appendParamToUrl(q,"modelName",k);q=l.appendParamToUrl(q,"modelDeployId",r);L&&(q=l.appendParamToUrl(q,"skin",L));D.openNewTabInAppId(h,q,q,D.QING_MODELER)})});g.loadSkinCss("message","messagepanel");g.loadSkinJs("message","skin");g.loadJs("message/message-content-panel-management.js");
g.loadI18n("message","messagepanel");g.loadSkinCss("qingmodeler/message","message-modeler-panel");g.loadSkinJs("qingmodeler/message","skin");g.loadJs("qingmodeler/message/message-content-panel-management.js");g.loadI18n("qingmodeler/message","message-modeler-panel")});var e=l.decodeParamFromUrl(location.search,"appID");b.setAppId(e)},S=function(a){a=new com.kingdee.bos.qing.publish.permission.PermLabelManageDialog(x());a.setSpaceID(N.getUrlParamValue("qingID"));a.showDialog()},V=function(a,b,e,g,
p,d){var c=com.kingdee.bos.qing.publish.model.PublishSourceType,k=com.kingdee.bos.qing.publish.model.PublishTargetType;a!=c.EXTREPORT&&a!=c.DASHBOARD&&b!=k.GUIMENU?(a=new com.kingdee.bos.qing.publish.common.PublishFacade(x(),function(r){d&&d()},function(r,h){return 2301016==r?(ia().showPrompt(C.get("publishNoOperAuthExceptionCurtain","\u6ca1\u6709\u64cd\u4f5c\u6743\u9650\u3002"),2E3),!0):!1}),b=e.getBizTag(),c=e.getDsbPublishId(),e.getRefToId()&&(b=e.getRefToId()),a.judgePublishOper(b,c,g,p)):d&&
d()},ba=function(){com.kingdee.bos.qing.timedpush.LappIntegration.syncDatacenterInfo(x())},na=function(){var a=f.getUrlParamUtil().getParamPathPrefix();com.kingdee.bos.qing.timedpush.LappIntegration.setLappPrivateUrl(a+"/qing/lappPrivateInfo.do")},P=function(a,b,e,g,p,d){var c=f.getUrlParamUtil().getParamPathPrefix(),k=com.kingdee.bos.qing.publish.common,r=k.PublishContext;k=com.kingdee.bos.qing.schemamanage.model;var h=k.SchemaAttrModel;k=k.SchemaModel;var q=f.getUrlParamUtil().getUrlParam("bizTag"),
L=m.protectedHaveToCarryData(),t;com.kingdee.bos.qing&&com.kingdee.bos.qing.prepare&&com.kingdee.bos.qing.prepare.DataSourceInfoContext&&(t=com.kingdee.bos.qing.prepare.DataSourceInfoContext.getCurrentDataSourceInfo());var M=t&&t.hasDirectModeTable();t=new r;t.setSource(p);t.setBizTag(q);t.setCurrentSourceType(b);t.setHaveToCarryData(L);t.setHasDirectModeTable(M);t.setParamPathPrefix(c);t.setSchemaTag("Dashboard-Analysis"==d?f.getUrlParamUtil().getUrlParam("schemaTag"):null);t.setSpaceID(N.getUrlParamValue("qingID"));
b=new h;b.setSchemaType(h.SCHEMATYPE_SYSTEM);b.setIsDefault(!0);b.setSchemaName(A("sysPublishScheme","\u7cfb\u7edf\u9ed8\u8ba4\u65b9\u6848"));b.setSource(e);p=new k;p.setSchemaAttr(b);p.setSchemaContent(a.getJsonModelBook());a=p.toJsonObject();t.setCurrentContentModel(a);a=f.getUrlParamUtil().getParamTag();b=function(J){J+="/qinganalysis/lappPreviewEntrance.do";for(var u=window.location.search.substring(1).split("&"),E=0;E<u.length;E++){var B=u[E],O=B.indexOf("=");if(-1!=O){var ca=B.substring(0,O);
"clientID"!=ca&&"safetyCode"!=ca&&(B=B.substring(O+1),J+=0>J.indexOf("?")?"?":"&",J+=ca,J+="=",J+=B)}}return J};e==h.SCHEMASOURCE_SQUARE?(t.setScene(r.Scene.Square),e=b(c),e=l.appendParamToUrl(e,"view","10"),t.setMobilePreviewUrl(e),c=l.appendParamToUrl(c+"/qing/lappEntrance.do","tag",a),c=l.appendParamToUrl(c,"view","10"),t.setLappEntranceUrl(c)):e==h.SCHEMASOURCE_LONGER&&(t.setScene(r.Scene.Longer),t.setMobilePreviewUrl(b(c)),c=l.appendParamToUrl(c+"/qing/lappEntrance.do","tag",a),t.setLappEntranceUrl(c));
g&&(t.setRefToId(f.getUrlParamUtil().getUrlParam("publishId")),t.setDsbPublishId(g),t.setDashBoardAnalysis(!0));return t},oa=function(a){var b=!1;if(a&&(a=a.tables)&&0<a.length)for(var e=0;e<a.length;e++)if(a[e].subViews){b=!0;break}return b},Q=function(a,b){aa?aa(function(e){var g=new com.kingdee.bos.qing.schemamanage.common.SchemaManageFacade(w(),function(d){d.publishInfoPerCheck==I.PUBLISHINFO_PERMISSION_PUBLISHPLAN_EXIST?a&&a(b):d.publishInfoPerCheck==I.THEME_IS_DEL?v($(document.body),"msg-warning",
C.get("ThemeIsDel","\u8be5\u53d1\u5e03\u8bb0\u5f55\u7684\u6765\u6e90\u88ab\u5220\u9664")):d.publishInfoPerCheck==I.PUBLISHINFO_NOEXIST?v($(document.body),"msg-warning",C.get("publishInfoExist","\u53d1\u5e03\u8bb0\u5f55\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664")):d.publishInfoPerCheck==I.PERMISSION_CANCEL?v($(document.body),"msg-jurisdiction",C.get("notAuthority","\u60a8\u6ca1\u6709\u8be5\u53d1\u5e03\u8bb0\u5f55\u7684\u67e5\u770b\u6743\u9650, \u8bf7\u8054\u7cfb\u53d1\u5e03\u4eba")+'"'+d.publishInfoUserName+
'"'+C.get("authority","\u6388\u6743")):d.publishInfoPerCheck==I.PUBLSIHPLAN_DELETE&&v($(document.body),"msg-warning",C.get("publishPlanExist","\u8be5\u5206\u6790\u65b9\u6848\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664"))}),p=new com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel;p.setFId(U.getCurrentSchemaId());p.setSchemaName(U.getCurrentSchemaName());g.checkPublishInfoAndAuthority(e,p)}):a&&a(b)},w=function(){var a=f.getUrlParamUtil().getParamPathPrefix(),b=f.getUrlParamUtil().getParamTag();
a=(a?a:"/ierp")+"/qing/schemaManage.do";var e=new com.kingdee.bos.qing.RemoteImpl;e.setRemoteUrl(a);e.setTag(b);return e},v=function(a,b,e){a=new da;a.setOptionType(da.OPTION_OK);a.setButtonText(da.RETURN_OK,C.get("ISee","\u6211\u77e5\u9053\u4e86"));var g={};g.text=e;g.iconName=b;a.setMessage(g);a.setCustomPainter(function(p,d){var c=$("<div>");c.addClass("sa-ctrl-msgdlg-icon");ja.background(c,d.iconName);var k=$("<div>");k.addClass("sa-ctrl-msgdlg-content");k.text(d.text);p.append(c);p.append(k)});
a.showDialog(380,280)},F=function(a,b,e){z?b(z):(new com.kingdee.bos.qing.core.Facade(a,function(g){z=g;b(g)},e)).getMeta()},y=function(a){z=null;F(m.getRemoteImpl(),a)},x=function(){var a=f.getUrlParamUtil().getParamPathPrefix(),b=f.getUrlParamUtil().getParamTag();a=(a?a:"/ierp")+"/qing/publishTo.do";var e=new com.kingdee.bos.qing.RemoteImpl;e.setRemoteUrl(a);e.setTag(b);return e},W=function(){var a=f.getUrlParamUtil().getParamPathPrefix(),b=H.getUrlParamValue(),e=f.getUrlParamUtil().getParamLanguage();
a=(a?a:"/ierp")+"/index.html?userId=Guest&accountId=(accountId)&appNumber=qing&formId=qing_analysis_pub_email#/dform?appNumber=qing&formId=qing_analysis_pub_email&publishId=(publishId)";b&&(a=l.appendParamToUrl(a,"skin",b));e&&(a=l.appendParamToUrl(a,"language",e));return a},T=function(){var a=f.getUrlParamUtil().getParamPathPrefix(),b=H.getUrlParamValue(),e=f.getUrlParamUtil().getParamLanguage();a=(a?a:"/ierp")+"/qing/publishedEmailEntrance.do?publishId=(publishId)&kdcdc=(accountId)";b&&(a=l.appendParamToUrl(a,
"skin",b));e&&(a=l.appendParamToUrl(a,"language",e));return a},ea=function(){return function(a,b,e){var g=com.kingdee.bos.qing.publish.model.PublishTargetType;if(e&&g.MOBILE==e){e=a.getPublishId();var p=a.getId();var d=a.getLappUserType()}else e=a.getId();g=f.getUrlParamUtil().getParamPathPrefix();var c=H.getUrlParamValue(),k=f.getUrlParamUtil().getParamLanguage();g=l.appendParamToUrl((g?g:"/ierp")+"/qing/publishContentEditEntrance.do","skin",c);g=l.appendParamToUrl(g,"language",k);g=l.appendParamToUrl(g,
"publishId",e);p&&(g=l.appendParamToUrl(g,"lappId",p));d&&(g=l.appendParamToUrl(g,"lappUserType",d));p=g;b&&(d="editPublishedContent-"+e,e=com.kingdee.bos.qing.publish.common.PublishSubscribeHelper,e.putSubscribe(d,b),g=l.appendParamToUrl(g,"subscribeKey",d),g=l.appendParamToUrl(g,"currentPageClientId",e.getCurrentPageClientId()));D.openNewTab(C.get("editPublishedContent","\u7f16\u8f91\u53d1\u5e03\u65b9\u6848-")+a.getName(),g,p)}},pa=function(){return function(a){var b=f.getUrlParamUtil().getParamPathPrefix();
b=(b?b:"/ierp")+"/qing/timedPushContentEditEntrance.do";var e=C.get("editTimedPushContent","\u7f16\u8f91\u63a8\u9001\u65b9\u6848");if(a instanceof com.kingdee.bos.qing.timedpush.model.EmailConfig){var g=a.getId(),p=a.getPublishSourceType();d=a.getSchemaSourceType();b=l.appendParamToUrl(b,"configId",g);b=l.appendParamToUrl(b,"publishSourceType",p);b=l.appendParamToUrl(b,"schemaType",d);b=l.appendParamToUrl(b,"pushTarget","email");e=e+"-"+a.getNameRule().getName();a.isSourceNameNotFound()&&(b=l.appendParamToUrl(b,
"errorCode","2301001"))}else{g=a.getId();p=a.getPushTargetType();var d=a.getSchemaType();b=l.appendParamToUrl(b,"configId",g);b=l.appendParamToUrl(b,"pushTargetType",p);b=l.appendParamToUrl(b,"schemaType",d);b=l.appendParamToUrl(b,"pushTarget","lapp");e=e+"-"+a.getName();a.getSourceName()||(b=l.appendParamToUrl(b,"errorCode","2301001"))}a=H.getUrlParamValue();d=f.getUrlParamUtil().getParamLanguage();a&&(b=l.appendParamToUrl(b,"skin",a));d&&(b=l.appendParamToUrl(b,"language",d));D.openNewTab(e,b)}},
A=function(a,b){return C.get(a,b)},ia=function(){R||(R=new com.kingdee.bos.qing.ui.component.MessageCurtain,R.getJqUi().appendTo($(document.body)));return R};f.getMLS=A;f.importLinkage=function(a){a.pushSkinJs("linkage","skin");a.pushJs("linkage/linkage.js");a.pushSkinCss("linkage","linkage")};f.importForSchema=function(a){a.pushSkinJs("schema-manage","skin-initialize");a.pushJs("schema-manage/schema-manage-initialize.js");a.pushI18n("schema-manage","schema-initialize");a.pushSkinCss("schema-manage",
"schema-manage");a.pushJs("schema-manage/schema-manage-ui.js");a.pushI18n("schema-manage","schema-ui")};f.importForPublish=function(a){a.pushJs("biz-common/qing-biz-common.js");a.pushSkinCss("biz-common","biz-common");a.pushSkinJs("biz-common","skin");a.pushI18n("biz-common","biz-common");a.pushSkinJs("imagelib","skin");a.pushSkinCss("imagelib","qing-imagelib");a.pushJs("imagelib/imagelib.js");a.pushI18n("imagelib","imagelib");a.pushJs("common/qing-schedule.js");a.pushI18n("common","qing-schedule");
a.pushSkinCss("publish","qing-publish");a.pushSkinJs("publish","skin");a.pushI18n("publish","publish");a.pushJs("publish/qing-publish.js");a.pushSkinCss("timedpush","qing-timedpush");a.pushSkinJs("timedpush","skin");a.pushI18n("timedpush","timedpush");a.pushJs("timedpush/qing-timedpush.js");a.pushJs("lightapp/common/qing-lapp-env.js");a.pushJs("timedpush/qing-timedpush-lapp.js");a.pushJs("timedpush/html2canvas.js")};f.importForMap=function(a){a.pushSkinJs("map-designer","integration-skin");a.pushJs("map-designer/map-integration.js");
a.pushSkinCss("map-designer","map-integration");a.pushI18n("map-designer","map-integration")};f.hookLongerPublishTo=function(a,b,e,g,p,d){com.kingdee.bos.qing.publish.common.UserOperationReporter.hookCollector(function(t,M,J){com.kingdee.bos.qing.behavior.BehaviorManager.interestInBehavior(t,M,0,J)});b=com.kingdee.bos.qing.publish.model;var c=b.PublishTargetType;b=com.kingdee.bos.qing.schemamanage.model;var k=b.SchemaAttrModel,r=function(t){var M=com.kingdee.bos.qing.publish.common.PublishFactory,
J=t.getUserObject(),u=t.getText().replace("...",""),E=P(a,e,k.SCHEMASOURCE_LONGER,g,p,d);V(e,J,E,"longer",n.ANALYSIS_PUBLISH,function(){var B=M.createPublishToDialog(u,x(),E,J,ea());B.setOuterMessageCurtain(ia());B.showDialog()})},h=com.kingdee.bos.qing.ui.component.MenuItemModel;b=new com.kingdee.bos.qing.ui.component.MenuModel;var q=new h(function(t){Q(r,t)});q.setUserObject(c.APPMENU);q.setText(A("toAppMenu","\u5e94\u7528\u83dc\u5355..."));b.addItemModel(q);q=new h(function(t){Q(r,t)});q.setUserObject(c.CENTER);
q.setText(A("toAnalysisCenter","\u6570\u636e\u5de5\u4f5c\u53f0\u9605\u89c8\u5939..."));b.addItemModel(q);q=new h(function(t){Q(r,t)});q.setUserObject(c.MOBILE);q.setText(A("toMobile","\u79fb\u52a8\u8f7b\u5e94\u7528..."));b.addItemModel(q);ba();na();b.addSeperator();var L=function(){var t=com.kingdee.bos.qing.publish.common.PublishManagerDialog,M=P(a,e,com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel.SCHEMASOURCE_LONGER);(new t(x(),M,ea())).showDialog()};q=new h(function(t){Q(L,t)});q.setUserObject();
q.setText(A("publishManager","\u53d1\u5e03\u7ba1\u7406")+"...");b.addItemModel(q);c=new h(S);c.setUserObject();c.setText(A("permLabelManage","\u6743\u9650\u6807\u7b7e\u7ba1\u7406")+"...");b.addItemModel(c);c=A("publishTo","\u53d1\u5e03\u5230");return a.getConductor().appendToolbarMenu(b,"publish_to",c)};f.hookSquarePublishTo=function(a,b,e){com.kingdee.bos.qing.publish.common.UserOperationReporter.hookCollector(function(r,h,q){com.kingdee.bos.qing.behavior.BehaviorManager.interestInBehavior(r,h,0,
q)});b=com.kingdee.bos.qing.publish.model;var g=b.PublishTargetType;b=com.kingdee.bos.qing.schemamanage.model;var p=b.SchemaAttrModel,d=function(r){var h=com.kingdee.bos.qing.publish.common.PublishFactory,q=r.getUserObject(),L=r.getText().replace("...",""),t=P(a,e,p.SCHEMASOURCE_SQUARE);V(e,q,t,"square",n.CARD_PUBLISH,function(){var M=h.createPublishToDialog(L,x(),t,q,ea());M.setOuterMessageCurtain(ia());M.showDialog()})},c=com.kingdee.bos.qing.ui.component.MenuItemModel;b=new com.kingdee.bos.qing.ui.component.MenuModel;
var k=new c(d);k.setUserObject(g.CARD_REPOSITORY);k.setText(A("toCardRepository","\u5361\u7247\u5e93..."));b.addItemModel(k);d=new c(d);d.setText(A("toMobile","\u79fb\u52a8\u8f7b\u5e94\u7528..."));d.setUserObject(g.MOBILE);b.addItemModel(d);ba();na();b.addSeperator();g=new c(function(){var r=com.kingdee.bos.qing.publish.common.PublishManagerDialog,h=P(a,e,com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel.SCHEMASOURCE_SQUARE);(new r(x(),h,ea())).showDialog()});g.setUserObject();g.setText(A("publishManager",
"\u53d1\u5e03\u7ba1\u7406")+"...");b.addItemModel(g);g=new c(S);g.setUserObject();g.setText(A("permLabelManage","\u6743\u9650\u6807\u7b7e\u7ba1\u7406")+"...");b.addItemModel(g);g=A("publishTo","\u53d1\u5e03\u5230");return a.getConductor().appendToolbarMenu(b,"publish_to",g)};f.hookPublishManager=function(a,b,e){var g=A("publishManager","\u53d1\u5e03\u7ba1\u7406");return a.getConductor().appendToolbarButton(function(){var p=com.kingdee.bos.qing.publish.common.PublishManagerDialog,d=P(a,b,e);(new p(x(),
d,ea())).showDialog()},"publish_manager",g)};f.hookCloseTab=function(a){var b=A("closeTab","\u9000\u51fa");return a.getConductor().appendToolbarButton(function(){a.getConductor().isDirty()?fa.showConfirmExitDialog():D.closeCurrentTab()},"error_close",b)};f.hookShareTo=function(a,b,e,g,p){com.kingdee.bos.qing.publish.common.UserOperationReporter.hookCollector(function(u,E,B){com.kingdee.bos.qing.behavior.BehaviorManager.interestInBehavior(u,E,0,B)});var d=function(u){u=A("yzjCommunicate","\u4e91\u4e4b\u5bb6\u6c9f\u901a...").replace("...",
"");var E=P(a,g,b);u=com.kingdee.bos.qing.timedpush.PublishToYunzhijiaDialogFactory.createDialog(u,x(),E);u.setOuterMessageCurtain(ia());u.showDialog()},c=function(u){u=com.kingdee.bos.qing.CodeLoader.createSafety();u.pushJs("yzj-web/qingjs.js");u.pushJs("yzj-web/imcloud.js");u.pushJs("yzj-web/imsdkerp.js");u.pushJs("yzj-web/imShare.js");u.pushSkinCss("yzj-web","imcloud");u.pushSkinCss("yzj-web","imsdk");u.pushSkinCss("yzj-web","imsdkerp");u.load(function(){})};e=new ka;(new X(function(u){window.beLoadedImCloud?
d(u):c(u)})).setText(A("yzjCommunicate","\u4e91\u4e4b\u5bb6\u6c9f\u901a..."));var k=com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel,r=m.protectedHaveToCarryData(),h;com.kingdee.bos.qing&&com.kingdee.bos.qing.prepare&&com.kingdee.bos.qing.prepare.DataSourceInfoContext&&(h=com.kingdee.bos.qing.prepare.DataSourceInfoContext.getCurrentDataSourceInfo());h=h&&h.hasDirectModeTable();var q=com.kingdee.bos.qing.publish.model.PublishTargetType;if(!h&&!r&&b==k.SCHEMASOURCE_LONGER){var L=function(u){var E=
u.getText().replace("...",""),B=P(a,g,b,p);V(g,q.EMAIL,B,"longer",n.ANALYSIS_TIMEPUSH,function(){var O=new com.kingdee.bos.qing.timedpush.EmailPublishConfigDialog(E,x(),B,W(),T(),pa(),a);O.setOuterMessageCurtain(ia());O.showDialog()})},t=new X(function(u){Q(L,u)});t.setText(A("emailSchedulePush","\u90ae\u4ef6\u5b9a\u65f6\u63a8\u9001..."));e.addItemModel(t)}if(!h&&!r){var M=function(u){var E=P(a,g,b,p),B="longer",O=n.ANALYSIS_TIMEPUSH;b==k.SCHEMASOURCE_SQUARE&&(B="square",O=n.CARD_TIMEPUSH);V(g,q.EMAIL,
E,B,O,function(){var ca=new com.kingdee.bos.qing.timedpush.LappSchedulePush,qa=u.getText().replace("...","");ca.createDialog(qa,x(),E,pa(),a)})};r=new X(function(u){Q(M,u)});r.setText(A("mobileSchedulePush","\u79fb\u52a8\u7aef\u5b9a\u65f6\u63a8\u9001")+"...");e.addItemModel(r)}e.addSeperator();var J=function(){var u=com.kingdee.bos.qing.publish.common.PushManager,E=P(a,g,b);u=new u(pa());var B=com.kingdee.bos.qing.timedpush;u.registerEmailPushPanelConstructor(B.EmailConfigManagePanel);u.initEmailPushConfig(x(),
W(),T());u.registerLappPushPanelConstructor(B.LappPushManagePanel);u.initLappPushConfig(function(O,ca,qa){return com.kingdee.bos.qing.publish.common.PublishFactory.createPublishFacade(com.kingdee.bos.qing.publish.model.PublishTargetType.MOBILE,x(),O,ca,qa)},E);u.showDialog()};r=new X(function(u){Q(J,u)});r.setUserObject();r.setText(A("pushManager","\u5b9a\u65f6\u63a8\u9001\u7ba1\u7406")+"...");e.addItemModel(r);e=a.getConductor().appendToolbarMenu(e,"btn_communicate",A("timedPush","\u5b9a\u65f6\u63a8\u9001"));
e.addActionListener(function(){window.beLoadedImCloud||(window.funCallback=d)});return e};f.initDesigntimeLinkage=function(){var a=f.getUrlParamUtil().getParamPathPrefix(),b=(a?a:"/ierp")+"/qing/linkage.do",e=com.kingdee.bos.qing.integration.LinkageJumper;a=new com.kingdee.bos.qing.linkage.LinkageManage;a.initDesigntime(b,e.jump);b=f.getUrlParamUtil().getParamTag();a.setCurrentLinkageTag(b)};f.loadMeta=F;f.reloadMeta=y;f.hookRefresh=function(a,b){var e=f.getMLS("refresh","\u6570\u636e\u66f4\u65b0"),
g=function(){b.restart();b.setExtractDataFinishedSuccessCallback(function(p){p||oa(z)?y(function(d){var c=a.getJsonModelBook();a.prepareMeta(d);a.setJsonModelBook(c)}):a.reExecute()})};return a.getConductor().appendToolbarButton(function(){Q(g)},"btn_reset",e)};f.getMessageCurtain=ia;f.hookSetCurrentTabStatus=function(a){a.getConductor().setDirtyListener(function(b){fa.setTabStatus(b)})};f.loadPublishOperList=function(a,b,e,g,p){K?e(K):(new com.kingdee.bos.qing.publish.common.PublishFacade(x(),function(d){K=
d;e(K)},p)).loadPublishOperList(a,b,g)};f.loadPublishOperModel=function(a,b,e,g){K?e(K):(new com.kingdee.bos.qing.publish.common.PublishFacade(x(),function(p){K=p.noOperValueMap;e(K)},g)).loadPublishOperModel(a,b)};f.registMapMapLibrary=function(a){com.kingdee.bos.qing.map.common.Integration.setRemoteUrl(a+"/qing/mapManage.do");var b=new com.kingdee.bos.qing.map.integration.MapSelectorDialog;com.kingdee.bos.qing.core.MapLibraryRegister.registerTemplateSelector(function(e,g){b.setParamPathPrefix(a);
b.showDialog(e,g)})}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.scene&&(com.kingdee.bos.qing.scene={});"undefined"==typeof com.kingdee.bos.qing.scene.common&&(com.kingdee.bos.qing.scene.common={});"undefined"==typeof com.kingdee.bos.qing.scene.common.designer&&(com.kingdee.bos.qing.scene.common.designer=
{});var Y=com.kingdee.bos.qing.scene.common.designer,H,Z,G,da,ja,l,C,D,ka,X,fa,N;(function(){var m=com.kingdee.bos.qing;H=m.SkinUtil;Z=m.AbstractDesignerScene;G=m.CodeLoader;N=m.Seer;m=com.kingdee.bos.qing.common;l=m.Util;m=com.kingdee.bos.qing.framework.common;C=m.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.scene);D=m.TabbedUiUtil;m=com.kingdee.bos.qing.ui.component;ka=m.MenuModel;X=m.MenuItemModel;da=m.MessageDialog;ja=m.Icons;m=com.kingdee.bos.qing.integration;fa=m.TabStatusHelper})();
Y.AbstractDesignerSceneImpl=I;Y.LongerDesignerOperationJudgerModel=function(m){com.kingdee.bos.qing.core.LongerDesignerOperationJudger.call(this);m&&0!=m&&(this.protectedParseDesignable=function(){return 0==(m&n.ANALYSIS_EDITABLE)},this.protectedParseDataDetailReadable=function(){return 0==(m&n.ANALYSIS_DETAIL)},this.protectedParseExportable=function(){return 0==(m&n.ANALYSIS_EXPORT)},this.protectedParsePrintable=function(){return 0==(m&n.ANALYSIS_PRINT)},this.protectedParsePublishable=function(){return 0==
(m&n.ANALYSIS_PUBLISH)},this.protectedParseTimingPushable=function(){return 0==(m&n.ANALYSIS_TIMEPUSH)})};Y.SquareDesignerOperationJudgerModel=function(m){com.kingdee.bos.qing.core.SquareDesignerOperationJudger.call(this);m&&0!=m&&(this.protectedParsePublishable=function(){return 0==(m&n.CARD_PUBLISH)},this.protectedParseTimingPushable=function(){return 0==(m&n.CARD_TIMEPUSH)})};Y.LongerDesignerOperationJudger=function(){com.kingdee.bos.qing.core.LongerDesignerOperationJudger.call(this);var m=this;
this.protectedParseDesignable=function(){return m.isDesignable()};this.protectedParseDataDetailReadable=function(){return m.isDataDetailReadable()};this.protectedParseExportable=function(){return m.isExportable()};this.protectedParsePrintable=function(){return m.isPrintable()};this.protectedParsePublishable=function(){return m.isPublishable()};this.protectedParseTimingPushable=function(){return m.isTimingPushable()}};var n={};Y.OperCodeType=n;n.ANALYSIS_EDITABLE=2;n.ANALYSIS_EXPORT=4;n.ANALYSIS_PRINT=
8;n.ANALYSIS_PUBLISH=16;n.ANALYSIS_TIMEPUSH=32;n.ANALYSIS_DETAIL=64;n.CARD_PUBLISH=256;n.CARD_TIMEPUSH=512;n.ENTRY_ANALYSIS=1;n.ENTRY_SQUARE=128;I.THEME_IS_DEL="Theme is Delete";I.PUBLISHINFO_PERMISSION_PUBLISHPLAN_EXIST="success";I.PUBLISHINFO_NOEXIST="PublishInfo Not Exist";I.PERMISSION_CANCEL="Not Permission";I.PUBLSIHPLAN_DELETE="Publish Not Exist"})();(function(){function I(){H.call(this);var n=this.protectedMethod,m=this.protectedInitDesignerForSquare;this.protectedInitDesignerForSquare=function(z){m(z);com.kingdee.bos.qing.integration.CardCtrlMsgHandler.setCallback(f)};var f=function(z){(z=z.content)&&z.evtName&&(z=new fa,z.setOptionType(fa.OPTION_OK),z.setMessage(n.getMLS("operateForbidden","\u5f53\u524d\u573a\u666f\u4e0d\u652f\u6301\u8be5\u64cd\u4f5c")),z.showDialog())}}function Y(){H.call(this);var n=this.protectedMethod,m=this.protectedInitDesignerForSquare;
this.protectedInitDesignerForSquare=function(f){m(f);"true"!=n.getUrlParamUtil().getUrlParam("isPreset")?(n.hookPublishAndPushBtn(f),"true"!=n.getUrlParamUtil().getUrlParam("haveToCarryData")&&n.hookRefresh(f,com.kingdee.bos.qing.prepare.DataExtractor)):n.getMessageCurtain().showPrompt(n.getMLS("presetPublishAnalysisTipsCurtain","\u9884\u7f6e\u7684\u6570\u636e\u5206\u6790\u4e0d\u5141\u8bb8\u53d1\u5e03\u7b49\u64cd\u4f5c\uff0c\u5982\u6709\u9700\u8981\uff0c\u53ef\u590d\u5236\u540e\u518d\u8fdb\u884c\u64cd\u4f5c\u3002"),
5E3);n.hookCloseTab(f)};this.protectedAfterSaveSquare=function(){G&&G.refreshCard()};this.protectedAfterReset=function(){G&&G.refreshCard();X.closeCurrentTab()}}function H(){function n(w,v,F,y){ka.call(this,w,v,F,y);var x=this.protectedMethod;this.resetCustomSquare=function(W){x.remote("resetCustomSquare",{bizTag:W})}}function m(){D.call(this);var w;this.getRemoteUrl=function(v){return w};this.setRemoteUrl=function(v){w=v}}da.call(this);var f=this.protectedMethod,z=this,R,aa,K,U,la,ha,ma,S,V,ba;this.protectedHaveToCarryData=
function(){return"true"==f.getUrlParamUtil().getUrlParam("haveToCarryData")};this.protectedAfterSaveSquare=function(){};this.protectedAfterReset=function(){};this.protectedIsEditUserSchema=function(){return!0};var na=this.protectedImportMoreCode;this.protectedImportMoreCode=function(w){na(w);f.importLinkage(w);f.importForSchema(w);f.importForPublish(w);f.importForMap(w);w.pushJs("qhf/qing-qhf.js")};var P=this.protectedCustomInitEnv;this.protectedCustomInitEnv=function(w){f.setModuleWithLonger(!1,
!1);f.setModuleWithSquare(!0,!0);P(w);R=f.getUrlParamUtil().getUrlParam("bizTag");aa=f.getUrlParamUtil().getUrlParam("schemaAdditionalTag");U=f.getUrlParamUtil().getUrlParam("publishSourceType");K=f.getUrlParamUtil().getUrlParam("publishId");ha=new m;var v=f.getUrlParamUtil().getParamPathPrefix();ha.setRemoteUrl((v?v:"/ierp")+"/qing/schemaManage.do");V=new m;V.setRemoteUrl((v?v:"/ierp")+"/qing/card.do");f.registMapMapLibrary(v);v=com.kingdee.bos.qing.behavior.BehaviorManager;v.interestInBehaviorEntrance(v.ENTRANCE_CARD_SQUARE);
f.loadPublishOperList(K,null,function(F){var y=com.kingdee.bos.qing.publish.model.OperType,x=0;F[y.SQUARE]&&(x|=F[y.SQUARE]);F[y.LONGER]&&(x|=F[y.LONGER]);ba=new N(x);w()})};this.protectedInitDesignerForSquare=function(w){w.setDesignerOperationJudger(null,ba);f.hookSetCurrentTabStatus(w);f.initDesigntimeLinkage();oa(w)};this.protectedLoadingSquare=function(w,v,F){f.loadMeta(w,function(y){var x=com.kingdee.bos.qing.schemamanage.SchemaManage,W=com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel;
v.prepareMeta(y);y=new x(R,W.SCHEMASOURCE_SQUARE,aa);y.setReloadMetaFun(function(T){f.reloadMeta(function(ea){v.prepareMeta(ea);T&&T()})});z.protectedIsEditUserSchema()?(y.setPublishId(K),y.initializeForSquareEdit(ha,v,function(T){S||(S=v.getJsonModelBook());F(T)})):y.initializeForSystemSquareSave(ha,v,function(T){S||(S=v.getJsonModelBook());F(T)});y.setSaveSuccessCallback(z.protectedAfterSaveSquare);ma=y.getSchemaContext();Q(v)})};var oa=function(w){var v=f.getUrlParamUtil().getUrlParam("tag");com.kingdee.bos.qing.qhf.QHFSceneExporterRegister.register(v,
function(){var F=com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel.SCHEMASOURCE_SQUARE;var y="subject"==U?com.kingdee.bos.qing.qhf.QHFExporter.SCENE_TYPE_PUBLISH_SUBJECT_SQUARE:com.kingdee.bos.qing.qhf.QHFExporter.SCENE_TYPE_PUBLISH_EMBEDDED_SQUARE;var x=w.getJsonModelBook();return{publishId:R,initSchemaContext:S?JSON.stringify(S):null,finalSchemaContext:x?JSON.stringify(x):null,schemaType:F,sceneType:y}})};f.hookPublishAndPushBtn=function(w){var v=com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel.SCHEMASOURCE_SQUARE;
ba.protectedParsePublishable()&&f.hookSquarePublishTo(w,ma,U);"true"!=f.getUrlParamUtil().getUrlParam("haveToCarryData")&&ba.protectedParseTimingPushable()&&f.hookShareTo(w,v,null,U)};var Q=function(w){var v=new ja,F=new l(function(y){y=new C;y.setText(f.getMLS("resetConfirmTips","\u60a8\u786e\u5b9a\u8981\u91cd\u7f6e\u5230\u53d1\u5e03\u6700\u521d\u59cb\u7684\u72b6\u6001\uff0c\u5e76\u9000\u51fa\u5417\uff1f"));y.setConfirmedListener(function(W){W&&(new n(V,z.protectedAfterReset)).resetCustomSquare(R+
aa)});var x=la.getJqUi();y.show(x)});F.setText(f.getMLS("resetAndExit","\u91cd\u7f6e\u5e76\u9000\u51fa"));v.addItemModel(F);la=w.getConductor().insertToolbarMenu(v,"btn_reset",f.getMLS("reset","\u91cd\u7f6e"),null)}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.scene&&(com.kingdee.bos.qing.scene=
{});var Z=com.kingdee.bos.qing.scene;Z.CardSquareScene=Y;var G,da,ja,l,C,D,ka,X,fa,N;(function(){var n=com.kingdee.bos.qing.framework.common;D=n.AbstractRemoteCall;ka=n.AbstractFacade;X=n.TabbedUiUtil;n=com.kingdee.bos.qing.integration;G=n.RefreshCardHelper;n=com.kingdee.bos.qing.scene.common.designer;da=n.AbstractDesignerSceneImpl;N=n.SquareDesignerOperationJudgerModel;n=com.kingdee.bos.qing.ui.component;ja=n.MenuModel;l=n.MenuItemModel;C=n.SimpleConfirmer;fa=n.MessageDialog})();Z.CardSquareSceneFactory=
new function(){var n={};this.getSquareScene=function(m){return(m=n[m])?new m:new Y};this.regist=function(m,f){n[m]=f}};Z.CardSquareSceneFactory.regist("devctrlAp",function(){I.call(this);var n=this.protectedMethod;this.protectedIsEditUserSchema=function(){return!1};this.protectedAfterSaveSquare=function(){setTimeout(function(){var m=n.getUrlParamUtil().getUrlParam("pageId");if(top.window.invokeCustomEvent){var f={ctrlRefId:n.getUrlParamUtil().getUrlParam("ctrlRefId")};top.window.invokeCustomEvent(m,
"",["","setCustomSchema",JSON.stringify(f)])}},300)};this.protectedAfterReset=function(){var m=n.getUrlParamUtil().getUrlParam("pageId");top.window.invokeCustomEvent&&top.window.invokeCustomEvent(m,"",["","resetCustomSchema",JSON.stringify({})])}});Z.CardSquareSceneFactory.regist("devctrl",function(){I.call(this);var n=this.protectedMethod;this.protectedAfterSaveSquare=function(){setTimeout(function(){m(n.getUrlParamUtil().getUrlParam("hasMainView"))},300)};this.protectedAfterReset=function(){m("false")};
var m=function(f){var z=n.getUrlParamUtil().getUrlParam("cardCtrlPageId");top.window.invokeCustomEvent&&(f={designerPageId:n.getUrlParamUtil().getUrlParam("pageId"),hasMainView:f},top.window.invokeCustomEvent(z,"",["QingCard","refreshCard",JSON.stringify(f)]))}})})();
//qingVersionTag: 20250324