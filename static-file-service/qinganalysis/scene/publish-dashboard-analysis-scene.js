(function(){function H(){aa.call(this);var r=this,p=this.protectedMethod,T,X,ba,w,v;this.setCurrentPublishSchema=function(a){v=a};this.setUserOperatorPrevCheck=function(a){ba=a};this.setCloseResourceLock=function(a){};this.protectedHaveToCarryData=function(){return!1};this.protectedNeedToShowMessageBox=function(){return!0};this.protectedGetRemoteUrl=function(){var a=p.getUrlParamUtil().getParamPathPrefix();return(a?a:"/ierp")+"/qing/core.do"};this.protectedImportMoreCode=function(a){a.pushSkinJs("scene",
"skin");a.pushI18n("scene","scene")};this.protectedCustomInitEnv=function(a){a=$("<div>");a.css({position:"fixed",bottom:"3px",right:"1px",width:"180px",height:"18px",zIndex:"999"});ca(a);r.protectedNeedToShowMessageBox()&&R(a);a.appendTo($(document.body));com.kingdee.bos.qing.integration.ImglibUrlParser.hookUrlParser()};var ca=function(a){I.setCallback(function(){var b=new com.kingdee.bos.qing.support.Main;b.setParamLanguage(p.getUrlParamUtil().getParamLanguage());b.creatSupportUi(a)});I.loadCss("support/support.css");
I.loadJs("support/support-ui.js");I.loadI18n("support","support")},R=function(a){I.setCallback(function(){var b=com.kingdee.bos.qing.common.Util.decodeParamFromUrl(window.location.search,"path");b=b?b:"/ierp";com.kingdee.bos.qing.message.common.Integration.setRemoteUrl(b+"/qing/messageManage.do");ha(b);var e=new com.kingdee.bos.qing.message.ui.Main;e.setFunOpenMessageDialog(function(){e.setViewSize(null,null,10,30)});e.setMessageWidth(80);e.getJqUi(25).appendTo(a)});I.loadSkinCss("message","message");
I.loadSkinJs("message","skin");I.loadJs("message/message-manage-ui.js");I.loadI18n("message","message")},ha=function(a){var b=com.kingdee.bos.qing.message.common.Integration;b.setImportJSCodeForManager(function(){var g=com.kingdee.bos.qing.CodeLoader;g.setCallback(function(){var m=com.kingdee.bos.qing.theme.message.panel.common.Integration;m.setFunPublishRemoteImpl(function(){var d=new com.kingdee.bos.qing.theme.message.panel.common.RemoteImpl;d.setRemoteUrl(a+"/qing/publishTo.do");return d});m.setFunQingCenterAndMenuEntrance(function(d,
c,k,q){c=C.getUrlParamValue();var h=a+"/qing/publishEntrance.do";h=f.appendParamToUrl(h,"publishId",d);"extreport"==q?(h=f.appendParamToUrl(h,"appID","qing_rpt"),c&&(h=f.appendParamToUrl(h,"skin",c)),z.openNewTabInAppId(k,h,h,z.QING_RPT)):(c&&(h=f.appendParamToUrl(h,"skin",c)),z.openNewTabInAppId(k,h,h,z.QING_ANALYSIS))});m.setResourceRemoteUrl(a+"/qing/resource.do");m.setDataModelEntrance(function(d,c,k){var q=C.getUrlParamValue();c=l.get("dataModeling","\u6570\u636e\u51c6\u5907")+"-"+c;var h=a+
"/qing/dataModelingEntrance.do";h=f.appendParamToUrl(h,"themeID",d);h=f.appendParamToUrl(h,"isPreset",k);q&&(h=f.appendParamToUrl(h,"skin",q));z.openNewTabInAppId(c,h,h,z.QING_ANALYSIS)});m.setFunPublishContext(function(){var d=new com.kingdee.bos.qing.publish.common.PublishContext;d.setParamPathPrefix(a);d.setLappEntranceUrl(a+"/qing/lappEntrance.do");d.setSpaceID(D.getUrlParamValue("qingID"));return d});m.setFunPublishedEmailLoginViewUrl(function(){var d=C.getUrlParamValue(),c=D.getUrlParamValue("language"),
k=a+"/qing/publishedEmailEntrance.do?publishId=(publishId)&kdcdc=(accountId)";d&&(k=f.appendParamToUrl(k,"skin",d));c&&(k=f.appendParamToUrl(k,"language",c));return k});m.setFunPublishedEmailAnonymousViewUrl(function(){var d=C.getUrlParamValue(),c=D.getUrlParamValue("language"),k=a+"/index.html?userId=Guest&accountId=(accountId)&appNumber=qing&formId=qing_analysis_pub_email#/dform?appNumber=qing&formId=qing_analysis_pub_email&publishId=(publishId)";d&&(k=f.appendParamToUrl(k,"skin",d));c&&(k=f.appendParamToUrl(k,
"language",c));return k});m.setFunPublishContentEditEntrance(function(){return function(d,c,k){var q=com.kingdee.bos.qing.publish.model.PublishTargetType;if(k&&q.MOBILE==k){q=d.getPublishId();var h=d.getId()}else q=d.getId();var n=C.getUrlParamValue(),J=D.getUrlParamValue("language");k=a+"/qing/publishContentEditEntrance.do";k=f.appendParamToUrl(k,"skin",n);k=f.appendParamToUrl(k,"language",J);k=f.appendParamToUrl(k,"publishId",q);h&&(k=f.appendParamToUrl(k,"lappId",h));h=k;c&&(q="editPublishedContent-"+
q,n=com.kingdee.bos.qing.publish.common.PublishSubscribeHelper,n.putSubscribe(q,c),k=f.appendParamToUrl(k,"subscribeKey",q),k=f.appendParamToUrl(k,"currentPageClientId",n.getCurrentPageClientId()));c=com.kingdee.bos.qing.framework.common.TabbedUiUtil;c.openNewTabInAppId(l.get("editPublishedContent","\u7f16\u8f91\u53d1\u5e03\u65b9\u6848-")+d.getName(),k,h,c.QING_ANALYSIS)}});m.setFunTimedPushContentEditEntrance(function(){return function(d){var c=a+"/qing/timedPushContentEditEntrance.do",k=l.get("editTimedPushContent",
"\u7f16\u8f91\u63a8\u9001\u65b9\u6848");if(d instanceof com.kingdee.bos.qing.timedpush.model.EmailConfig){var q=d.getId(),h=d.getPublishSourceType();n=d.getSchemaSourceType();c=f.appendParamToUrl(c,"configId",q);c=f.appendParamToUrl(c,"publishSourceType",h);c=f.appendParamToUrl(c,"schemaType",n);c=f.appendParamToUrl(c,"pushTarget","email");k=k+"-"+d.getNameRule().getName();d.isSourceNameNotFound()&&(c=f.appendParamToUrl(c,"errorCode","2301001"))}else{q=d.getId();h=d.getPushTargetType();var n=d.getSchemaType();
c=f.appendParamToUrl(c,"configId",q);c=f.appendParamToUrl(c,"pushTargetType",h);c=f.appendParamToUrl(c,"schemaType",n);c=f.appendParamToUrl(c,"pushTarget","lapp");k=k+"-"+d.getName();d.getSourceName()||(c=f.appendParamToUrl(c,"errorCode","2301001"))}d=C.getUrlParamValue();n=D.getUrlParamValue("language");d&&(c=f.appendParamToUrl(c,"skin",d));n&&(c=f.appendParamToUrl(c,"language",n));d=com.kingdee.bos.qing.framework.common.TabbedUiUtil;d.openNewTabInAppId(k,c,c,d.QING_ANALYSIS)}});m=com.kingdee.bos.qing.modeler.message.panel.common.Integration;
m.setMessageRemoteUrl(a+"/qing_modeler/message.do");m.setFunOpenModelSetPage(function(d,c){var k=C.getUrlParamValue(),q=l.get("modelSet","\u6a21\u578b\u96c6-")+c,h=a+"/qing_modeler/modelSetMainPage.do";h=f.appendParamToUrl(h,"modelSetId",d);h=f.appendParamToUrl(h,"modelSetName",c);h=f.appendParamToUrl(h,"currentPageClientId",com.kingdee.bos.qing.framework.common.RemoteFramework.getClientID());k&&(h=f.appendParamToUrl(h,"skin",k));z.openNewTabInAppId(q,h,h,z.QING_MODELER)});m.setFunOpenModelDesign(function(d,
c,k,q,h){var n=com.kingdee.bos.qing.modeler.message.panel.common.ModelType,J=C.getUrlParamValue();h=(h=n.getModelTypeText(h))?h+"-"+k:k;n=a+"/qing_modeler/deployDesignerEntrance.do";n=f.appendParamToUrl(n,"modelSetId",d);n=f.appendParamToUrl(n,"modelId",c);n=f.appendParamToUrl(n,"modelName",k);n=f.appendParamToUrl(n,"modelDeployId",q);J&&(n=f.appendParamToUrl(n,"skin",J));z.openNewTabInAppId(h,n,n,z.QING_MODELER)})});g.loadSkinCss("message","messagepanel");g.loadSkinJs("message","skin");g.loadJs("message/message-content-panel-management.js");
g.loadI18n("message","messagepanel");g.loadSkinCss("qingmodeler/message","message-modeler-panel");g.loadSkinJs("qingmodeler/message","skin");g.loadJs("qingmodeler/message/message-content-panel-management.js");g.loadI18n("qingmodeler/message","message-modeler-panel")});var e=f.decodeParamFromUrl(location.search,"appID");b.setAppId(e)},ia=function(a){a=new com.kingdee.bos.qing.publish.permission.PermLabelManageDialog(E());a.setSpaceID(D.getUrlParamValue("qingID"));a.showDialog()},Z=function(a,b,e,g,
m,d){var c=com.kingdee.bos.qing.publish.model.PublishSourceType,k=com.kingdee.bos.qing.publish.model.PublishTargetType;a!=c.EXTREPORT&&a!=c.DASHBOARD&&b!=k.GUIMENU?(a=new com.kingdee.bos.qing.publish.common.PublishFacade(E(),function(q){d&&d()},function(q,h){return 2301016==q?(Y().showPrompt(l.get("publishNoOperAuthExceptionCurtain","\u6ca1\u6709\u64cd\u4f5c\u6743\u9650\u3002"),2E3),!0):!1}),b=e.getBizTag(),c=e.getDsbPublishId(),e.getRefToId()&&(b=e.getRefToId()),a.judgePublishOper(b,c,g,m)):d&&d()},
Q=function(){com.kingdee.bos.qing.timedpush.LappIntegration.syncDatacenterInfo(E())},L=function(){var a=p.getUrlParamUtil().getParamPathPrefix();com.kingdee.bos.qing.timedpush.LappIntegration.setLappPrivateUrl(a+"/qing/lappPrivateInfo.do")},F=function(a,b,e,g,m,d){var c=p.getUrlParamUtil().getParamPathPrefix(),k=com.kingdee.bos.qing.publish.common,q=k.PublishContext;k=com.kingdee.bos.qing.schemamanage.model;var h=k.SchemaAttrModel;k=k.SchemaModel;var n=p.getUrlParamUtil().getUrlParam("bizTag"),J=
r.protectedHaveToCarryData(),t;com.kingdee.bos.qing&&com.kingdee.bos.qing.prepare&&com.kingdee.bos.qing.prepare.DataSourceInfoContext&&(t=com.kingdee.bos.qing.prepare.DataSourceInfoContext.getCurrentDataSourceInfo());var K=t&&t.hasDirectModeTable();t=new q;t.setSource(m);t.setBizTag(n);t.setCurrentSourceType(b);t.setHaveToCarryData(J);t.setHasDirectModeTable(K);t.setParamPathPrefix(c);t.setSchemaTag("Dashboard-Analysis"==d?p.getUrlParamUtil().getUrlParam("schemaTag"):null);t.setSpaceID(D.getUrlParamValue("qingID"));
b=new h;b.setSchemaType(h.SCHEMATYPE_SYSTEM);b.setIsDefault(!0);b.setSchemaName(y("sysPublishScheme","\u7cfb\u7edf\u9ed8\u8ba4\u65b9\u6848"));b.setSource(e);m=new k;m.setSchemaAttr(b);m.setSchemaContent(a.getJsonModelBook());a=m.toJsonObject();t.setCurrentContentModel(a);a=p.getUrlParamUtil().getParamTag();b=function(G){G+="/qinganalysis/lappPreviewEntrance.do";for(var u=window.location.search.substring(1).split("&"),B=0;B<u.length;B++){var A=u[B],M=A.indexOf("=");if(-1!=M){var U=A.substring(0,M);
"clientID"!=U&&"safetyCode"!=U&&(A=A.substring(M+1),G+=0>G.indexOf("?")?"?":"&",G+=U,G+="=",G+=A)}}return G};e==h.SCHEMASOURCE_SQUARE?(t.setScene(q.Scene.Square),e=b(c),e=f.appendParamToUrl(e,"view","10"),t.setMobilePreviewUrl(e),c=f.appendParamToUrl(c+"/qing/lappEntrance.do","tag",a),c=f.appendParamToUrl(c,"view","10"),t.setLappEntranceUrl(c)):e==h.SCHEMASOURCE_LONGER&&(t.setScene(q.Scene.Longer),t.setMobilePreviewUrl(b(c)),c=f.appendParamToUrl(c+"/qing/lappEntrance.do","tag",a),t.setLappEntranceUrl(c));
g&&(t.setRefToId(p.getUrlParamUtil().getUrlParam("publishId")),t.setDsbPublishId(g),t.setDashBoardAnalysis(!0));return t},da=function(a){var b=!1;if(a&&(a=a.tables)&&0<a.length)for(var e=0;e<a.length;e++)if(a[e].subViews){b=!0;break}return b},O=function(a,b){ba?ba(function(e){var g=new com.kingdee.bos.qing.schemamanage.common.SchemaManageFacade(qa(),function(d){d.publishInfoPerCheck==H.PUBLISHINFO_PERMISSION_PUBLISHPLAN_EXIST?a&&a(b):d.publishInfoPerCheck==H.THEME_IS_DEL?ja($(document.body),"msg-warning",
l.get("ThemeIsDel","\u8be5\u53d1\u5e03\u8bb0\u5f55\u7684\u6765\u6e90\u88ab\u5220\u9664")):d.publishInfoPerCheck==H.PUBLISHINFO_NOEXIST?ja($(document.body),"msg-warning",l.get("publishInfoExist","\u53d1\u5e03\u8bb0\u5f55\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664")):d.publishInfoPerCheck==H.PERMISSION_CANCEL?ja($(document.body),"msg-jurisdiction",l.get("notAuthority","\u60a8\u6ca1\u6709\u8be5\u53d1\u5e03\u8bb0\u5f55\u7684\u67e5\u770b\u6743\u9650, \u8bf7\u8054\u7cfb\u53d1\u5e03\u4eba")+'"'+d.publishInfoUserName+
'"'+l.get("authority","\u6388\u6743")):d.publishInfoPerCheck==H.PUBLSIHPLAN_DELETE&&ja($(document.body),"msg-warning",l.get("publishPlanExist","\u8be5\u5206\u6790\u65b9\u6848\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664"))}),m=new com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel;m.setFId(v.getCurrentSchemaId());m.setSchemaName(v.getCurrentSchemaName());g.checkPublishInfoAndAuthority(e,m)}):a&&a(b)},qa=function(){var a=p.getUrlParamUtil().getParamPathPrefix(),b=p.getUrlParamUtil().getParamTag();
a=(a?a:"/ierp")+"/qing/schemaManage.do";var e=new com.kingdee.bos.qing.RemoteImpl;e.setRemoteUrl(a);e.setTag(b);return e},ja=function(a,b,e){a=new V;a.setOptionType(V.OPTION_OK);a.setButtonText(V.RETURN_OK,l.get("ISee","\u6211\u77e5\u9053\u4e86"));var g={};g.text=e;g.iconName=b;a.setMessage(g);a.setCustomPainter(function(m,d){var c=$("<div>");c.addClass("sa-ctrl-msgdlg-icon");ea.background(c,d.iconName);var k=$("<div>");k.addClass("sa-ctrl-msgdlg-content");k.text(d.text);m.append(c);m.append(k)});
a.showDialog(380,280)},ma=function(a,b,e){T?b(T):(new com.kingdee.bos.qing.core.Facade(a,function(g){T=g;b(g)},e)).getMeta()},na=function(a){T=null;ma(r.getRemoteImpl(),a)},E=function(){var a=p.getUrlParamUtil().getParamPathPrefix(),b=p.getUrlParamUtil().getParamTag();a=(a?a:"/ierp")+"/qing/publishTo.do";var e=new com.kingdee.bos.qing.RemoteImpl;e.setRemoteUrl(a);e.setTag(b);return e},oa=function(){var a=p.getUrlParamUtil().getParamPathPrefix(),b=C.getUrlParamValue(),e=p.getUrlParamUtil().getParamLanguage();
a=(a?a:"/ierp")+"/index.html?userId=Guest&accountId=(accountId)&appNumber=qing&formId=qing_analysis_pub_email#/dform?appNumber=qing&formId=qing_analysis_pub_email&publishId=(publishId)";b&&(a=f.appendParamToUrl(a,"skin",b));e&&(a=f.appendParamToUrl(a,"language",e));return a},pa=function(){var a=p.getUrlParamUtil().getParamPathPrefix(),b=C.getUrlParamValue(),e=p.getUrlParamUtil().getParamLanguage();a=(a?a:"/ierp")+"/qing/publishedEmailEntrance.do?publishId=(publishId)&kdcdc=(accountId)";b&&(a=f.appendParamToUrl(a,
"skin",b));e&&(a=f.appendParamToUrl(a,"language",e));return a},fa=function(){return function(a,b,e){var g=com.kingdee.bos.qing.publish.model.PublishTargetType;if(e&&g.MOBILE==e){e=a.getPublishId();var m=a.getId();var d=a.getLappUserType()}else e=a.getId();g=p.getUrlParamUtil().getParamPathPrefix();var c=C.getUrlParamValue(),k=p.getUrlParamUtil().getParamLanguage();g=f.appendParamToUrl((g?g:"/ierp")+"/qing/publishContentEditEntrance.do","skin",c);g=f.appendParamToUrl(g,"language",k);g=f.appendParamToUrl(g,
"publishId",e);m&&(g=f.appendParamToUrl(g,"lappId",m));d&&(g=f.appendParamToUrl(g,"lappUserType",d));m=g;b&&(d="editPublishedContent-"+e,e=com.kingdee.bos.qing.publish.common.PublishSubscribeHelper,e.putSubscribe(d,b),g=f.appendParamToUrl(g,"subscribeKey",d),g=f.appendParamToUrl(g,"currentPageClientId",e.getCurrentPageClientId()));z.openNewTab(l.get("editPublishedContent","\u7f16\u8f91\u53d1\u5e03\u65b9\u6848-")+a.getName(),g,m)}},ka=function(){return function(a){var b=p.getUrlParamUtil().getParamPathPrefix();
b=(b?b:"/ierp")+"/qing/timedPushContentEditEntrance.do";var e=l.get("editTimedPushContent","\u7f16\u8f91\u63a8\u9001\u65b9\u6848");if(a instanceof com.kingdee.bos.qing.timedpush.model.EmailConfig){var g=a.getId(),m=a.getPublishSourceType();d=a.getSchemaSourceType();b=f.appendParamToUrl(b,"configId",g);b=f.appendParamToUrl(b,"publishSourceType",m);b=f.appendParamToUrl(b,"schemaType",d);b=f.appendParamToUrl(b,"pushTarget","email");e=e+"-"+a.getNameRule().getName();a.isSourceNameNotFound()&&(b=f.appendParamToUrl(b,
"errorCode","2301001"))}else{g=a.getId();m=a.getPushTargetType();var d=a.getSchemaType();b=f.appendParamToUrl(b,"configId",g);b=f.appendParamToUrl(b,"pushTargetType",m);b=f.appendParamToUrl(b,"schemaType",d);b=f.appendParamToUrl(b,"pushTarget","lapp");e=e+"-"+a.getName();a.getSourceName()||(b=f.appendParamToUrl(b,"errorCode","2301001"))}a=C.getUrlParamValue();d=p.getUrlParamUtil().getParamLanguage();a&&(b=f.appendParamToUrl(b,"skin",a));d&&(b=f.appendParamToUrl(b,"language",d));z.openNewTab(e,b)}},
y=function(a,b){return l.get(a,b)},Y=function(){X||(X=new com.kingdee.bos.qing.ui.component.MessageCurtain,X.getJqUi().appendTo($(document.body)));return X};p.getMLS=y;p.importLinkage=function(a){a.pushSkinJs("linkage","skin");a.pushJs("linkage/linkage.js");a.pushSkinCss("linkage","linkage")};p.importForSchema=function(a){a.pushSkinJs("schema-manage","skin-initialize");a.pushJs("schema-manage/schema-manage-initialize.js");a.pushI18n("schema-manage","schema-initialize");a.pushSkinCss("schema-manage",
"schema-manage");a.pushJs("schema-manage/schema-manage-ui.js");a.pushI18n("schema-manage","schema-ui")};p.importForPublish=function(a){a.pushJs("biz-common/qing-biz-common.js");a.pushSkinCss("biz-common","biz-common");a.pushSkinJs("biz-common","skin");a.pushI18n("biz-common","biz-common");a.pushSkinJs("imagelib","skin");a.pushSkinCss("imagelib","qing-imagelib");a.pushJs("imagelib/imagelib.js");a.pushI18n("imagelib","imagelib");a.pushJs("common/qing-schedule.js");a.pushI18n("common","qing-schedule");
a.pushSkinCss("publish","qing-publish");a.pushSkinJs("publish","skin");a.pushI18n("publish","publish");a.pushJs("publish/qing-publish.js");a.pushSkinCss("timedpush","qing-timedpush");a.pushSkinJs("timedpush","skin");a.pushI18n("timedpush","timedpush");a.pushJs("timedpush/qing-timedpush.js");a.pushJs("lightapp/common/qing-lapp-env.js");a.pushJs("timedpush/qing-timedpush-lapp.js");a.pushJs("timedpush/html2canvas.js")};p.importForMap=function(a){a.pushSkinJs("map-designer","integration-skin");a.pushJs("map-designer/map-integration.js");
a.pushSkinCss("map-designer","map-integration");a.pushI18n("map-designer","map-integration")};p.hookLongerPublishTo=function(a,b,e,g,m,d){com.kingdee.bos.qing.publish.common.UserOperationReporter.hookCollector(function(t,K,G){com.kingdee.bos.qing.behavior.BehaviorManager.interestInBehavior(t,K,0,G)});b=com.kingdee.bos.qing.publish.model;var c=b.PublishTargetType;b=com.kingdee.bos.qing.schemamanage.model;var k=b.SchemaAttrModel,q=function(t){var K=com.kingdee.bos.qing.publish.common.PublishFactory,
G=t.getUserObject(),u=t.getText().replace("...",""),B=F(a,e,k.SCHEMASOURCE_LONGER,g,m,d);Z(e,G,B,"longer",x.ANALYSIS_PUBLISH,function(){var A=K.createPublishToDialog(u,E(),B,G,fa());A.setOuterMessageCurtain(Y());A.showDialog()})},h=com.kingdee.bos.qing.ui.component.MenuItemModel;b=new com.kingdee.bos.qing.ui.component.MenuModel;var n=new h(function(t){O(q,t)});n.setUserObject(c.APPMENU);n.setText(y("toAppMenu","\u5e94\u7528\u83dc\u5355..."));b.addItemModel(n);n=new h(function(t){O(q,t)});n.setUserObject(c.CENTER);
n.setText(y("toAnalysisCenter","\u6570\u636e\u5de5\u4f5c\u53f0\u9605\u89c8\u5939..."));b.addItemModel(n);n=new h(function(t){O(q,t)});n.setUserObject(c.MOBILE);n.setText(y("toMobile","\u79fb\u52a8\u8f7b\u5e94\u7528..."));b.addItemModel(n);Q();L();b.addSeperator();var J=function(){var t=com.kingdee.bos.qing.publish.common.PublishManagerDialog,K=F(a,e,com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel.SCHEMASOURCE_LONGER);(new t(E(),K,fa())).showDialog()};n=new h(function(t){O(J,t)});n.setUserObject();
n.setText(y("publishManager","\u53d1\u5e03\u7ba1\u7406")+"...");b.addItemModel(n);c=new h(ia);c.setUserObject();c.setText(y("permLabelManage","\u6743\u9650\u6807\u7b7e\u7ba1\u7406")+"...");b.addItemModel(c);c=y("publishTo","\u53d1\u5e03\u5230");return a.getConductor().appendToolbarMenu(b,"publish_to",c)};p.hookSquarePublishTo=function(a,b,e){com.kingdee.bos.qing.publish.common.UserOperationReporter.hookCollector(function(q,h,n){com.kingdee.bos.qing.behavior.BehaviorManager.interestInBehavior(q,h,
0,n)});b=com.kingdee.bos.qing.publish.model;var g=b.PublishTargetType;b=com.kingdee.bos.qing.schemamanage.model;var m=b.SchemaAttrModel,d=function(q){var h=com.kingdee.bos.qing.publish.common.PublishFactory,n=q.getUserObject(),J=q.getText().replace("...",""),t=F(a,e,m.SCHEMASOURCE_SQUARE);Z(e,n,t,"square",x.CARD_PUBLISH,function(){var K=h.createPublishToDialog(J,E(),t,n,fa());K.setOuterMessageCurtain(Y());K.showDialog()})},c=com.kingdee.bos.qing.ui.component.MenuItemModel;b=new com.kingdee.bos.qing.ui.component.MenuModel;
var k=new c(d);k.setUserObject(g.CARD_REPOSITORY);k.setText(y("toCardRepository","\u5361\u7247\u5e93..."));b.addItemModel(k);d=new c(d);d.setText(y("toMobile","\u79fb\u52a8\u8f7b\u5e94\u7528..."));d.setUserObject(g.MOBILE);b.addItemModel(d);Q();L();b.addSeperator();g=new c(function(){var q=com.kingdee.bos.qing.publish.common.PublishManagerDialog,h=F(a,e,com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel.SCHEMASOURCE_SQUARE);(new q(E(),h,fa())).showDialog()});g.setUserObject();g.setText(y("publishManager",
"\u53d1\u5e03\u7ba1\u7406")+"...");b.addItemModel(g);g=new c(ia);g.setUserObject();g.setText(y("permLabelManage","\u6743\u9650\u6807\u7b7e\u7ba1\u7406")+"...");b.addItemModel(g);g=y("publishTo","\u53d1\u5e03\u5230");return a.getConductor().appendToolbarMenu(b,"publish_to",g)};p.hookPublishManager=function(a,b,e){var g=y("publishManager","\u53d1\u5e03\u7ba1\u7406");return a.getConductor().appendToolbarButton(function(){var m=com.kingdee.bos.qing.publish.common.PublishManagerDialog,d=F(a,b,e);(new m(E(),
d,fa())).showDialog()},"publish_manager",g)};p.hookCloseTab=function(a){var b=y("closeTab","\u9000\u51fa");return a.getConductor().appendToolbarButton(function(){a.getConductor().isDirty()?P.showConfirmExitDialog():z.closeCurrentTab()},"error_close",b)};p.hookShareTo=function(a,b,e,g,m){com.kingdee.bos.qing.publish.common.UserOperationReporter.hookCollector(function(u,B,A){com.kingdee.bos.qing.behavior.BehaviorManager.interestInBehavior(u,B,0,A)});var d=function(u){u=y("yzjCommunicate","\u4e91\u4e4b\u5bb6\u6c9f\u901a...").replace("...",
"");var B=F(a,g,b);u=com.kingdee.bos.qing.timedpush.PublishToYunzhijiaDialogFactory.createDialog(u,E(),B);u.setOuterMessageCurtain(Y());u.showDialog()},c=function(u){u=com.kingdee.bos.qing.CodeLoader.createSafety();u.pushJs("yzj-web/qingjs.js");u.pushJs("yzj-web/imcloud.js");u.pushJs("yzj-web/imsdkerp.js");u.pushJs("yzj-web/imShare.js");u.pushSkinCss("yzj-web","imcloud");u.pushSkinCss("yzj-web","imsdk");u.pushSkinCss("yzj-web","imsdkerp");u.load(function(){})};e=new S;(new N(function(u){window.beLoadedImCloud?
d(u):c(u)})).setText(y("yzjCommunicate","\u4e91\u4e4b\u5bb6\u6c9f\u901a..."));var k=com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel,q=r.protectedHaveToCarryData(),h;com.kingdee.bos.qing&&com.kingdee.bos.qing.prepare&&com.kingdee.bos.qing.prepare.DataSourceInfoContext&&(h=com.kingdee.bos.qing.prepare.DataSourceInfoContext.getCurrentDataSourceInfo());h=h&&h.hasDirectModeTable();var n=com.kingdee.bos.qing.publish.model.PublishTargetType;if(!h&&!q&&b==k.SCHEMASOURCE_LONGER){var J=function(u){var B=
u.getText().replace("...",""),A=F(a,g,b,m);Z(g,n.EMAIL,A,"longer",x.ANALYSIS_TIMEPUSH,function(){var M=new com.kingdee.bos.qing.timedpush.EmailPublishConfigDialog(B,E(),A,oa(),pa(),ka(),a);M.setOuterMessageCurtain(Y());M.showDialog()})},t=new N(function(u){O(J,u)});t.setText(y("emailSchedulePush","\u90ae\u4ef6\u5b9a\u65f6\u63a8\u9001..."));e.addItemModel(t)}if(!h&&!q){var K=function(u){var B=F(a,g,b,m),A="longer",M=x.ANALYSIS_TIMEPUSH;b==k.SCHEMASOURCE_SQUARE&&(A="square",M=x.CARD_TIMEPUSH);Z(g,n.EMAIL,
B,A,M,function(){var U=new com.kingdee.bos.qing.timedpush.LappSchedulePush,la=u.getText().replace("...","");U.createDialog(la,E(),B,ka(),a)})};q=new N(function(u){O(K,u)});q.setText(y("mobileSchedulePush","\u79fb\u52a8\u7aef\u5b9a\u65f6\u63a8\u9001")+"...");e.addItemModel(q)}e.addSeperator();var G=function(){var u=com.kingdee.bos.qing.publish.common.PushManager,B=F(a,g,b);u=new u(ka());var A=com.kingdee.bos.qing.timedpush;u.registerEmailPushPanelConstructor(A.EmailConfigManagePanel);u.initEmailPushConfig(E(),
oa(),pa());u.registerLappPushPanelConstructor(A.LappPushManagePanel);u.initLappPushConfig(function(M,U,la){return com.kingdee.bos.qing.publish.common.PublishFactory.createPublishFacade(com.kingdee.bos.qing.publish.model.PublishTargetType.MOBILE,E(),M,U,la)},B);u.showDialog()};q=new N(function(u){O(G,u)});q.setUserObject();q.setText(y("pushManager","\u5b9a\u65f6\u63a8\u9001\u7ba1\u7406")+"...");e.addItemModel(q);e=a.getConductor().appendToolbarMenu(e,"btn_communicate",y("timedPush","\u5b9a\u65f6\u63a8\u9001"));
e.addActionListener(function(){window.beLoadedImCloud||(window.funCallback=d)});return e};p.initDesigntimeLinkage=function(){var a=p.getUrlParamUtil().getParamPathPrefix(),b=(a?a:"/ierp")+"/qing/linkage.do",e=com.kingdee.bos.qing.integration.LinkageJumper;a=new com.kingdee.bos.qing.linkage.LinkageManage;a.initDesigntime(b,e.jump);b=p.getUrlParamUtil().getParamTag();a.setCurrentLinkageTag(b)};p.loadMeta=ma;p.reloadMeta=na;p.hookRefresh=function(a,b){var e=p.getMLS("refresh","\u6570\u636e\u66f4\u65b0"),
g=function(){b.restart();b.setExtractDataFinishedSuccessCallback(function(m){m||da(T)?na(function(d){var c=a.getJsonModelBook();a.prepareMeta(d);a.setJsonModelBook(c)}):a.reExecute()})};return a.getConductor().appendToolbarButton(function(){O(g)},"btn_reset",e)};p.getMessageCurtain=Y;p.hookSetCurrentTabStatus=function(a){a.getConductor().setDirtyListener(function(b){P.setTabStatus(b)})};p.loadPublishOperList=function(a,b,e,g,m){w?e(w):(new com.kingdee.bos.qing.publish.common.PublishFacade(E(),function(d){w=
d;e(w)},m)).loadPublishOperList(a,b,g)};p.loadPublishOperModel=function(a,b,e,g){w?e(w):(new com.kingdee.bos.qing.publish.common.PublishFacade(E(),function(m){w=m.noOperValueMap;e(w)},g)).loadPublishOperModel(a,b)};p.registMapMapLibrary=function(a){com.kingdee.bos.qing.map.common.Integration.setRemoteUrl(a+"/qing/mapManage.do");var b=new com.kingdee.bos.qing.map.integration.MapSelectorDialog;com.kingdee.bos.qing.core.MapLibraryRegister.registerTemplateSelector(function(e,g){b.setParamPathPrefix(a);
b.showDialog(e,g)})}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.scene&&(com.kingdee.bos.qing.scene={});"undefined"==typeof com.kingdee.bos.qing.scene.common&&(com.kingdee.bos.qing.scene.common={});"undefined"==typeof com.kingdee.bos.qing.scene.common.designer&&(com.kingdee.bos.qing.scene.common.designer=
{});var W=com.kingdee.bos.qing.scene.common.designer,C,aa,I,V,ea,f,l,z,S,N,P,D;(function(){var r=com.kingdee.bos.qing;C=r.SkinUtil;aa=r.AbstractDesignerScene;I=r.CodeLoader;D=r.Seer;r=com.kingdee.bos.qing.common;f=r.Util;r=com.kingdee.bos.qing.framework.common;l=r.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.scene);z=r.TabbedUiUtil;r=com.kingdee.bos.qing.ui.component;S=r.MenuModel;N=r.MenuItemModel;V=r.MessageDialog;ea=r.Icons;r=com.kingdee.bos.qing.integration;P=r.TabStatusHelper})();
W.AbstractDesignerSceneImpl=H;W.LongerDesignerOperationJudgerModel=function(r){com.kingdee.bos.qing.core.LongerDesignerOperationJudger.call(this);r&&0!=r&&(this.protectedParseDesignable=function(){return 0==(r&x.ANALYSIS_EDITABLE)},this.protectedParseDataDetailReadable=function(){return 0==(r&x.ANALYSIS_DETAIL)},this.protectedParseExportable=function(){return 0==(r&x.ANALYSIS_EXPORT)},this.protectedParsePrintable=function(){return 0==(r&x.ANALYSIS_PRINT)},this.protectedParsePublishable=function(){return 0==
(r&x.ANALYSIS_PUBLISH)},this.protectedParseTimingPushable=function(){return 0==(r&x.ANALYSIS_TIMEPUSH)})};W.SquareDesignerOperationJudgerModel=function(r){com.kingdee.bos.qing.core.SquareDesignerOperationJudger.call(this);r&&0!=r&&(this.protectedParsePublishable=function(){return 0==(r&x.CARD_PUBLISH)},this.protectedParseTimingPushable=function(){return 0==(r&x.CARD_TIMEPUSH)})};W.LongerDesignerOperationJudger=function(){com.kingdee.bos.qing.core.LongerDesignerOperationJudger.call(this);var r=this;
this.protectedParseDesignable=function(){return r.isDesignable()};this.protectedParseDataDetailReadable=function(){return r.isDataDetailReadable()};this.protectedParseExportable=function(){return r.isExportable()};this.protectedParsePrintable=function(){return r.isPrintable()};this.protectedParsePublishable=function(){return r.isPublishable()};this.protectedParseTimingPushable=function(){return r.isTimingPushable()}};var x={};W.OperCodeType=x;x.ANALYSIS_EDITABLE=2;x.ANALYSIS_EXPORT=4;x.ANALYSIS_PRINT=
8;x.ANALYSIS_PUBLISH=16;x.ANALYSIS_TIMEPUSH=32;x.ANALYSIS_DETAIL=64;x.CARD_PUBLISH=256;x.CARD_TIMEPUSH=512;x.ENTRY_ANALYSIS=1;x.ENTRY_SQUARE=128;H.THEME_IS_DEL="Theme is Delete";H.PUBLISHINFO_PERMISSION_PUBLISHPLAN_EXIST="success";H.PUBLISHINFO_NOEXIST="PublishInfo Not Exist";H.PERMISSION_CANCEL="Not Permission";H.PUBLSIHPLAN_DELETE="Publish Not Exist"})();(function(){function H(f,l,z,S){aa.call(this,f,l,z,S);var N=this.protectedMethod;this.loadSquareSchema=function(P,D){P={ref:JSON.stringify(P),dashboardUniqueId:D};N.remote("squareLoadSchema",P)}}function W(){I.call(this);var f;this.getRemoteUrl=function(l){return f};this.setRemoteUrl=function(l){f=l}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing=
{});"undefined"==typeof com.kingdee.bos.qing.scene&&(com.kingdee.bos.qing.scene={});com.kingdee.bos.qing.scene.DashboardAnalysisdScene=function(){V.call(this);var f=this,l=this.protectedMethod,z,S,N,P,D,x,r,p,T=this.protectedImportMoreCode;this.protectedImportMoreCode=function(w){T(w);l.importForSchema(w);l.importForPublish(w);l.importLinkage(w)};var X=this.protectedCustomInitEnv;this.protectedCustomInitEnv=function(w){l.setModuleWithLonger(!0,!0);l.setModuleWithSquare(!1,!1);X(w);z=l.getUrlParamUtil().getUrlParam("schemaTag");
S=l.getUrlParamUtil().getUrlParam("publishSourceType");N=l.getUrlParamUtil().getUrlParam("dsbPublishId");P=l.getUrlParamUtil().getUrlParam("refUid");D="true"==l.getUrlParamUtil().getUrlParam("isPreset");l.getUrlParamUtil().getUrlParam("timedPush");x=new C;var v=l.getUrlParamUtil().getParamPathPrefix();x.setRemoteUrl((v?v:"/ierp")+"/qing/schemaManage.do");x.setTag(l.getUrlParamUtil().getParamTag());v=com.kingdee.bos.qing.behavior.BehaviorManager;v.interestInBehaviorEntrance(v.ENTRANCE_PUBLISH_DASHBOARD_ANALYSIS);
p=new ea;if(v=window.sessionStorage.getItem("publish-dsb-oDesignerOperationJudger"))window.sessionStorage.removeItem("publish-dsb-oDesignerOperationJudger"),p.decodeFromJson(JSON.parse(v));w()};this.protectedInitDesignerForLonger=function(w){w.setDesignerOperationJudger(p,null);var v=window.sessionStorage.getItem("publish-dsb-oAdditionalFilterApi");v&&(window.sessionStorage.removeItem("publish-dsb-oAdditionalFilterApi"),v=com.kingdee.bos.qing.core.shared.AdditionalFilterInfoParser.decodeAdditionalFilterApi(v),
w.setAdditionalFilterApi(v));v=com.kingdee.bos.qing.publish.model.PublishTargetType;var ca=l.getUrlParamUtil().getUrlParam("publishTargetType");D||v.EMAIL==ca?D&&l.getMessageCurtain().showPrompt(l.getMLS("presetPublishAnalysisTipsCurtain","\u9884\u7f6e\u7684\u6570\u636e\u5206\u6790\u4e0d\u5141\u8bb8\u53d1\u5e03\u7b49\u64cd\u4f5c\uff0c\u5982\u6709\u9700\u8981\uff0c\u53ef\u590d\u5236\u540e\u518d\u8fdb\u884c\u64cd\u4f5c\u3002"),5E3):(v=com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel.SCHEMASOURCE_LONGER,
p.protectedParsePublishable()&&l.hookLongerPublishTo(w,r,S,l.getUrlParamUtil().getUrlParam("dsbPublishId"),0,"Dashboard-Analysis"),!f.protectedHaveToCarryData()&&p.protectedParseTimingPushable()&&l.hookShareTo(w,v,null,S,l.getUrlParamUtil().getUrlParam("dsbPublishId")),f.protectedHaveToCarryData()||l.hookRefresh(w,com.kingdee.bos.qing.prepare.DataExtractor),l.hookSetCurrentTabStatus(w));l.initDesigntimeLinkage();(v=window.com.kingdee.bos.qing.AnalysisSceneOuterApi)?(p.protectedParseDesignable()&&
v.inside.setDirtyChecker(function(){return w.getConductor().isDirty()}),v.inside.setBeforeClosing(function(){return com.kingdee.bos.qing.integration.TabStatusHelper.setTabStatus(!1)}),w.getConductor().appendToolbarButton(v.inside.requestClosing,"error_close",l.getMLS("closeTab","\u9000\u51fa"))):l.hookCloseTab(w)};this.protectedHaveToCarryData=function(){return"true"==l.getUrlParamUtil().getUrlParam("haveToCarryData")};this.protectedNeedToShowMessageBox=function(){return"qing_workbench"!==l.getUrlParamUtil().getUrlParam("openFrom")};
this.protectedLoadingLonger=function(w,v,ca){l.loadMeta(w,function(R){var ha=com.kingdee.bos.qing.schemamanage.SchemaManage,ia=com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel,Z=com.kingdee.bos.qing.schemamanage.LoadSchemaError;v.prepareMeta(R);var Q=new ha(z,ia.SCHEMASOURCE_LONGER);Q.setDesignerOperationJudger(p);Q.setPublishId(l.getUrlParamUtil().getUrlParam("publishId"));Q.setDsbPublishId(N);Q.setReloadMetaFun(function(L){l.reloadMeta(function(F){v.prepareMeta(F);L&&L()})});R={};R.uid=P;
(new H(ba(),function(L){var F=L.model;if(L=window.sessionStorage.getItem("publish-dsb-oJsonFilterSetForInstead"))window.sessionStorage.removeItem("publish-dsb-oJsonFilterSetForInstead"),L=JSON.parse(L),F=com.kingdee.bos.qing.ModelHelper.mergeFilterState(F,L);Q.initialize(x,v,function(da){da||(da=l.createSquare2LongerModelTransformer(),v.setJsonModelBook(F,function(O){(new Z).showErrorMsg(O)},da));ca(!0)},null,D)},function(){return!1})).loadSquareSchema(R,N);r=Q.getSchemaContext()},function(R,ha){return 301201==
R?(l.getMessageCurtain().showError(l.getMLS("extractDataFailToRefreshCurtain","\u51c6\u5907\u6570\u636e\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u51fa\u6570\u636e\u518d\u8fdb\u884c\u8be5\u64cd\u4f5c\u3002")),!0):!1})};var ba=function(){var w=new W,v=l.getUrlParamUtil().getParamPathPrefix();w.setRemoteUrl((v?v:"/ierp")+"/qing/runtimeDashboard.do");return w}};var C,aa,I,V,ea;(function(){var f=com.kingdee.bos.qing;C=f.RemoteImpl;f=com.kingdee.bos.qing.framework.common;aa=f.AbstractFacade;I=f.AbstractRemoteCall;
f=com.kingdee.bos.qing.scene.common.designer;V=f.AbstractDesignerSceneImpl;ea=f.LongerDesignerOperationJudger})()})();
//qingVersionTag: 20250324