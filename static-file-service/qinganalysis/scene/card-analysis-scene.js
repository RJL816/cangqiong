(function(){function H(){da.call(this);var p=this,q=this.protectedMethod,W,aa,x,y,M;this.setCurrentPublishSchema=function(a){M=a};this.setUserOperatorPrevCheck=function(a){x=a};this.setCloseResourceLock=function(a){};this.protectedHaveToCarryData=function(){return!1};this.protectedNeedToShowMessageBox=function(){return!0};this.protectedGetRemoteUrl=function(){var a=q.getUrlParamUtil().getParamPathPrefix();return(a?a:"/ierp")+"/qing/core.do"};this.protectedImportMoreCode=function(a){a.pushSkinJs("scene",
"skin");a.pushI18n("scene","scene")};this.protectedCustomInitEnv=function(a){a=$("<div>");a.css({position:"fixed",bottom:"3px",right:"1px",width:"180px",height:"18px",zIndex:"999"});E(a);p.protectedNeedToShowMessageBox()&&I(a);a.appendTo($(document.body));com.kingdee.bos.qing.integration.ImglibUrlParser.hookUrlParser()};var E=function(a){J.setCallback(function(){var b=new com.kingdee.bos.qing.support.Main;b.setParamLanguage(q.getUrlParamUtil().getParamLanguage());b.creatSupportUi(a)});J.loadCss("support/support.css");
J.loadJs("support/support-ui.js");J.loadI18n("support","support")},I=function(a){J.setCallback(function(){var b=com.kingdee.bos.qing.common.Util.decodeParamFromUrl(window.location.search,"path");b=b?b:"/ierp";com.kingdee.bos.qing.message.common.Integration.setRemoteUrl(b+"/qing/messageManage.do");ia(b);var e=new com.kingdee.bos.qing.message.ui.Main;e.setFunOpenMessageDialog(function(){e.setViewSize(null,null,10,30)});e.setMessageWidth(80);e.getJqUi(25).appendTo(a)});J.loadSkinCss("message","message");
J.loadSkinJs("message","skin");J.loadJs("message/message-manage-ui.js");J.loadI18n("message","message")},ia=function(a){var b=com.kingdee.bos.qing.message.common.Integration;b.setImportJSCodeForManager(function(){var f=com.kingdee.bos.qing.CodeLoader;f.setCallback(function(){var l=com.kingdee.bos.qing.theme.message.panel.common.Integration;l.setFunPublishRemoteImpl(function(){var d=new com.kingdee.bos.qing.theme.message.panel.common.RemoteImpl;d.setRemoteUrl(a+"/qing/publishTo.do");return d});l.setFunQingCenterAndMenuEntrance(function(d,
c,k,n){c=D.getUrlParamValue();var h=a+"/qing/publishEntrance.do";h=g.appendParamToUrl(h,"publishId",d);"extreport"==n?(h=g.appendParamToUrl(h,"appID","qing_rpt"),c&&(h=g.appendParamToUrl(h,"skin",c)),z.openNewTabInAppId(k,h,h,z.QING_RPT)):(c&&(h=g.appendParamToUrl(h,"skin",c)),z.openNewTabInAppId(k,h,h,z.QING_ANALYSIS))});l.setResourceRemoteUrl(a+"/qing/resource.do");l.setDataModelEntrance(function(d,c,k){var n=D.getUrlParamValue();c=w.get("dataModeling","\u6570\u636e\u51c6\u5907")+"-"+c;var h=a+
"/qing/dataModelingEntrance.do";h=g.appendParamToUrl(h,"themeID",d);h=g.appendParamToUrl(h,"isPreset",k);n&&(h=g.appendParamToUrl(h,"skin",n));z.openNewTabInAppId(c,h,h,z.QING_ANALYSIS)});l.setFunPublishContext(function(){var d=new com.kingdee.bos.qing.publish.common.PublishContext;d.setParamPathPrefix(a);d.setLappEntranceUrl(a+"/qing/lappEntrance.do");d.setSpaceID(K.getUrlParamValue("qingID"));return d});l.setFunPublishedEmailLoginViewUrl(function(){var d=D.getUrlParamValue(),c=K.getUrlParamValue("language"),
k=a+"/qing/publishedEmailEntrance.do?publishId=(publishId)&kdcdc=(accountId)";d&&(k=g.appendParamToUrl(k,"skin",d));c&&(k=g.appendParamToUrl(k,"language",c));return k});l.setFunPublishedEmailAnonymousViewUrl(function(){var d=D.getUrlParamValue(),c=K.getUrlParamValue("language"),k=a+"/index.html?userId=Guest&accountId=(accountId)&appNumber=qing&formId=qing_analysis_pub_email#/dform?appNumber=qing&formId=qing_analysis_pub_email&publishId=(publishId)";d&&(k=g.appendParamToUrl(k,"skin",d));c&&(k=g.appendParamToUrl(k,
"language",c));return k});l.setFunPublishContentEditEntrance(function(){return function(d,c,k){var n=com.kingdee.bos.qing.publish.model.PublishTargetType;if(k&&n.MOBILE==k){n=d.getPublishId();var h=d.getId()}else n=d.getId();var m=D.getUrlParamValue(),N=K.getUrlParamValue("language");k=a+"/qing/publishContentEditEntrance.do";k=g.appendParamToUrl(k,"skin",m);k=g.appendParamToUrl(k,"language",N);k=g.appendParamToUrl(k,"publishId",n);h&&(k=g.appendParamToUrl(k,"lappId",h));h=k;c&&(n="editPublishedContent-"+
n,m=com.kingdee.bos.qing.publish.common.PublishSubscribeHelper,m.putSubscribe(n,c),k=g.appendParamToUrl(k,"subscribeKey",n),k=g.appendParamToUrl(k,"currentPageClientId",m.getCurrentPageClientId()));c=com.kingdee.bos.qing.framework.common.TabbedUiUtil;c.openNewTabInAppId(w.get("editPublishedContent","\u7f16\u8f91\u53d1\u5e03\u65b9\u6848-")+d.getName(),k,h,c.QING_ANALYSIS)}});l.setFunTimedPushContentEditEntrance(function(){return function(d){var c=a+"/qing/timedPushContentEditEntrance.do",k=w.get("editTimedPushContent",
"\u7f16\u8f91\u63a8\u9001\u65b9\u6848");if(d instanceof com.kingdee.bos.qing.timedpush.model.EmailConfig){var n=d.getId(),h=d.getPublishSourceType();m=d.getSchemaSourceType();c=g.appendParamToUrl(c,"configId",n);c=g.appendParamToUrl(c,"publishSourceType",h);c=g.appendParamToUrl(c,"schemaType",m);c=g.appendParamToUrl(c,"pushTarget","email");k=k+"-"+d.getNameRule().getName();d.isSourceNameNotFound()&&(c=g.appendParamToUrl(c,"errorCode","2301001"))}else{n=d.getId();h=d.getPushTargetType();var m=d.getSchemaType();
c=g.appendParamToUrl(c,"configId",n);c=g.appendParamToUrl(c,"pushTargetType",h);c=g.appendParamToUrl(c,"schemaType",m);c=g.appendParamToUrl(c,"pushTarget","lapp");k=k+"-"+d.getName();d.getSourceName()||(c=g.appendParamToUrl(c,"errorCode","2301001"))}d=D.getUrlParamValue();m=K.getUrlParamValue("language");d&&(c=g.appendParamToUrl(c,"skin",d));m&&(c=g.appendParamToUrl(c,"language",m));d=com.kingdee.bos.qing.framework.common.TabbedUiUtil;d.openNewTabInAppId(k,c,c,d.QING_ANALYSIS)}});l=com.kingdee.bos.qing.modeler.message.panel.common.Integration;
l.setMessageRemoteUrl(a+"/qing_modeler/message.do");l.setFunOpenModelSetPage(function(d,c){var k=D.getUrlParamValue(),n=w.get("modelSet","\u6a21\u578b\u96c6-")+c,h=a+"/qing_modeler/modelSetMainPage.do";h=g.appendParamToUrl(h,"modelSetId",d);h=g.appendParamToUrl(h,"modelSetName",c);h=g.appendParamToUrl(h,"currentPageClientId",com.kingdee.bos.qing.framework.common.RemoteFramework.getClientID());k&&(h=g.appendParamToUrl(h,"skin",k));z.openNewTabInAppId(n,h,h,z.QING_MODELER)});l.setFunOpenModelDesign(function(d,
c,k,n,h){var m=com.kingdee.bos.qing.modeler.message.panel.common.ModelType,N=D.getUrlParamValue();h=(h=m.getModelTypeText(h))?h+"-"+k:k;m=a+"/qing_modeler/deployDesignerEntrance.do";m=g.appendParamToUrl(m,"modelSetId",d);m=g.appendParamToUrl(m,"modelId",c);m=g.appendParamToUrl(m,"modelName",k);m=g.appendParamToUrl(m,"modelDeployId",n);N&&(m=g.appendParamToUrl(m,"skin",N));z.openNewTabInAppId(h,m,m,z.QING_MODELER)})});f.loadSkinCss("message","messagepanel");f.loadSkinJs("message","skin");f.loadJs("message/message-content-panel-management.js");
f.loadI18n("message","messagepanel");f.loadSkinCss("qingmodeler/message","message-modeler-panel");f.loadSkinJs("qingmodeler/message","skin");f.loadJs("qingmodeler/message/message-content-panel-management.js");f.loadI18n("qingmodeler/message","message-modeler-panel")});var e=g.decodeParamFromUrl(location.search,"appID");b.setAppId(e)},fa=function(a){a=new com.kingdee.bos.qing.publish.permission.PermLabelManageDialog(F());a.setSpaceID(K.getUrlParamValue("qingID"));a.showDialog()},Q=function(a,b,e,f,
l,d){var c=com.kingdee.bos.qing.publish.model.PublishSourceType,k=com.kingdee.bos.qing.publish.model.PublishTargetType;a!=c.EXTREPORT&&a!=c.DASHBOARD&&b!=k.GUIMENU?(a=new com.kingdee.bos.qing.publish.common.PublishFacade(F(),function(n){d&&d()},function(n,h){return 2301016==n?(ba().showPrompt(w.get("publishNoOperAuthExceptionCurtain","\u6ca1\u6709\u64cd\u4f5c\u6743\u9650\u3002"),2E3),!0):!1}),b=e.getBizTag(),c=e.getDsbPublishId(),e.getRefToId()&&(b=e.getRefToId()),a.judgePublishOper(b,c,f,l)):d&&
d()},X=function(){com.kingdee.bos.qing.timedpush.LappIntegration.syncDatacenterInfo(F())},ca=function(){var a=q.getUrlParamUtil().getParamPathPrefix();com.kingdee.bos.qing.timedpush.LappIntegration.setLappPrivateUrl(a+"/qing/lappPrivateInfo.do")},L=function(a,b,e,f,l,d){var c=q.getUrlParamUtil().getParamPathPrefix(),k=com.kingdee.bos.qing.publish.common,n=k.PublishContext;k=com.kingdee.bos.qing.schemamanage.model;var h=k.SchemaAttrModel;k=k.SchemaModel;var m=q.getUrlParamUtil().getUrlParam("bizTag"),
N=p.protectedHaveToCarryData(),r;com.kingdee.bos.qing&&com.kingdee.bos.qing.prepare&&com.kingdee.bos.qing.prepare.DataSourceInfoContext&&(r=com.kingdee.bos.qing.prepare.DataSourceInfoContext.getCurrentDataSourceInfo());var O=r&&r.hasDirectModeTable();r=new n;r.setSource(l);r.setBizTag(m);r.setCurrentSourceType(b);r.setHaveToCarryData(N);r.setHasDirectModeTable(O);r.setParamPathPrefix(c);r.setSchemaTag("Dashboard-Analysis"==d?q.getUrlParamUtil().getUrlParam("schemaTag"):null);r.setSpaceID(K.getUrlParamValue("qingID"));
b=new h;b.setSchemaType(h.SCHEMATYPE_SYSTEM);b.setIsDefault(!0);b.setSchemaName(A("sysPublishScheme","\u7cfb\u7edf\u9ed8\u8ba4\u65b9\u6848"));b.setSource(e);l=new k;l.setSchemaAttr(b);l.setSchemaContent(a.getJsonModelBook());a=l.toJsonObject();r.setCurrentContentModel(a);a=q.getUrlParamUtil().getParamTag();b=function(G){G+="/qinganalysis/lappPreviewEntrance.do";for(var t=window.location.search.substring(1).split("&"),C=0;C<t.length;C++){var B=t[C],P=B.indexOf("=");if(-1!=P){var Y=B.substring(0,P);
"clientID"!=Y&&"safetyCode"!=Y&&(B=B.substring(P+1),G+=0>G.indexOf("?")?"?":"&",G+=Y,G+="=",G+=B)}}return G};e==h.SCHEMASOURCE_SQUARE?(r.setScene(n.Scene.Square),e=b(c),e=g.appendParamToUrl(e,"view","10"),r.setMobilePreviewUrl(e),c=g.appendParamToUrl(c+"/qing/lappEntrance.do","tag",a),c=g.appendParamToUrl(c,"view","10"),r.setLappEntranceUrl(c)):e==h.SCHEMASOURCE_LONGER&&(r.setScene(n.Scene.Longer),r.setMobilePreviewUrl(b(c)),c=g.appendParamToUrl(c+"/qing/lappEntrance.do","tag",a),r.setLappEntranceUrl(c));
f&&(r.setRefToId(q.getUrlParamUtil().getUrlParam("publishId")),r.setDsbPublishId(f),r.setDashBoardAnalysis(!0));return r},ja=function(a){var b=!1;if(a&&(a=a.tables)&&0<a.length)for(var e=0;e<a.length;e++)if(a[e].subViews){b=!0;break}return b},U=function(a,b){x?x(function(e){var f=new com.kingdee.bos.qing.schemamanage.common.SchemaManageFacade(qa(),function(d){d.publishInfoPerCheck==H.PUBLISHINFO_PERMISSION_PUBLISHPLAN_EXIST?a&&a(b):d.publishInfoPerCheck==H.THEME_IS_DEL?ha($(document.body),"msg-warning",
w.get("ThemeIsDel","\u8be5\u53d1\u5e03\u8bb0\u5f55\u7684\u6765\u6e90\u88ab\u5220\u9664")):d.publishInfoPerCheck==H.PUBLISHINFO_NOEXIST?ha($(document.body),"msg-warning",w.get("publishInfoExist","\u53d1\u5e03\u8bb0\u5f55\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664")):d.publishInfoPerCheck==H.PERMISSION_CANCEL?ha($(document.body),"msg-jurisdiction",w.get("notAuthority","\u60a8\u6ca1\u6709\u8be5\u53d1\u5e03\u8bb0\u5f55\u7684\u67e5\u770b\u6743\u9650, \u8bf7\u8054\u7cfb\u53d1\u5e03\u4eba")+'"'+d.publishInfoUserName+
'"'+w.get("authority","\u6388\u6743")):d.publishInfoPerCheck==H.PUBLSIHPLAN_DELETE&&ha($(document.body),"msg-warning",w.get("publishPlanExist","\u8be5\u5206\u6790\u65b9\u6848\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664"))}),l=new com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel;l.setFId(M.getCurrentSchemaId());l.setSchemaName(M.getCurrentSchemaName());f.checkPublishInfoAndAuthority(e,l)}):a&&a(b)},qa=function(){var a=q.getUrlParamUtil().getParamPathPrefix(),b=q.getUrlParamUtil().getParamTag();
a=(a?a:"/ierp")+"/qing/schemaManage.do";var e=new com.kingdee.bos.qing.RemoteImpl;e.setRemoteUrl(a);e.setTag(b);return e},ha=function(a,b,e){a=new Z;a.setOptionType(Z.OPTION_OK);a.setButtonText(Z.RETURN_OK,w.get("ISee","\u6211\u77e5\u9053\u4e86"));var f={};f.text=e;f.iconName=b;a.setMessage(f);a.setCustomPainter(function(l,d){var c=$("<div>");c.addClass("sa-ctrl-msgdlg-icon");u.background(c,d.iconName);var k=$("<div>");k.addClass("sa-ctrl-msgdlg-content");k.text(d.text);l.append(c);l.append(k)});
a.showDialog(380,280)},ma=function(a,b,e){W?b(W):(new com.kingdee.bos.qing.core.Facade(a,function(f){W=f;b(f)},e)).getMeta()},na=function(a){W=null;ma(p.getRemoteImpl(),a)},F=function(){var a=q.getUrlParamUtil().getParamPathPrefix(),b=q.getUrlParamUtil().getParamTag();a=(a?a:"/ierp")+"/qing/publishTo.do";var e=new com.kingdee.bos.qing.RemoteImpl;e.setRemoteUrl(a);e.setTag(b);return e},oa=function(){var a=q.getUrlParamUtil().getParamPathPrefix(),b=D.getUrlParamValue(),e=q.getUrlParamUtil().getParamLanguage();
a=(a?a:"/ierp")+"/index.html?userId=Guest&accountId=(accountId)&appNumber=qing&formId=qing_analysis_pub_email#/dform?appNumber=qing&formId=qing_analysis_pub_email&publishId=(publishId)";b&&(a=g.appendParamToUrl(a,"skin",b));e&&(a=g.appendParamToUrl(a,"language",e));return a},pa=function(){var a=q.getUrlParamUtil().getParamPathPrefix(),b=D.getUrlParamValue(),e=q.getUrlParamUtil().getParamLanguage();a=(a?a:"/ierp")+"/qing/publishedEmailEntrance.do?publishId=(publishId)&kdcdc=(accountId)";b&&(a=g.appendParamToUrl(a,
"skin",b));e&&(a=g.appendParamToUrl(a,"language",e));return a},ea=function(){return function(a,b,e){var f=com.kingdee.bos.qing.publish.model.PublishTargetType;if(e&&f.MOBILE==e){e=a.getPublishId();var l=a.getId();var d=a.getLappUserType()}else e=a.getId();f=q.getUrlParamUtil().getParamPathPrefix();var c=D.getUrlParamValue(),k=q.getUrlParamUtil().getParamLanguage();f=g.appendParamToUrl((f?f:"/ierp")+"/qing/publishContentEditEntrance.do","skin",c);f=g.appendParamToUrl(f,"language",k);f=g.appendParamToUrl(f,
"publishId",e);l&&(f=g.appendParamToUrl(f,"lappId",l));d&&(f=g.appendParamToUrl(f,"lappUserType",d));l=f;b&&(d="editPublishedContent-"+e,e=com.kingdee.bos.qing.publish.common.PublishSubscribeHelper,e.putSubscribe(d,b),f=g.appendParamToUrl(f,"subscribeKey",d),f=g.appendParamToUrl(f,"currentPageClientId",e.getCurrentPageClientId()));z.openNewTab(w.get("editPublishedContent","\u7f16\u8f91\u53d1\u5e03\u65b9\u6848-")+a.getName(),f,l)}},ka=function(){return function(a){var b=q.getUrlParamUtil().getParamPathPrefix();
b=(b?b:"/ierp")+"/qing/timedPushContentEditEntrance.do";var e=w.get("editTimedPushContent","\u7f16\u8f91\u63a8\u9001\u65b9\u6848");if(a instanceof com.kingdee.bos.qing.timedpush.model.EmailConfig){var f=a.getId(),l=a.getPublishSourceType();d=a.getSchemaSourceType();b=g.appendParamToUrl(b,"configId",f);b=g.appendParamToUrl(b,"publishSourceType",l);b=g.appendParamToUrl(b,"schemaType",d);b=g.appendParamToUrl(b,"pushTarget","email");e=e+"-"+a.getNameRule().getName();a.isSourceNameNotFound()&&(b=g.appendParamToUrl(b,
"errorCode","2301001"))}else{f=a.getId();l=a.getPushTargetType();var d=a.getSchemaType();b=g.appendParamToUrl(b,"configId",f);b=g.appendParamToUrl(b,"pushTargetType",l);b=g.appendParamToUrl(b,"schemaType",d);b=g.appendParamToUrl(b,"pushTarget","lapp");e=e+"-"+a.getName();a.getSourceName()||(b=g.appendParamToUrl(b,"errorCode","2301001"))}a=D.getUrlParamValue();d=q.getUrlParamUtil().getParamLanguage();a&&(b=g.appendParamToUrl(b,"skin",a));d&&(b=g.appendParamToUrl(b,"language",d));z.openNewTab(e,b)}},
A=function(a,b){return w.get(a,b)},ba=function(){aa||(aa=new com.kingdee.bos.qing.ui.component.MessageCurtain,aa.getJqUi().appendTo($(document.body)));return aa};q.getMLS=A;q.importLinkage=function(a){a.pushSkinJs("linkage","skin");a.pushJs("linkage/linkage.js");a.pushSkinCss("linkage","linkage")};q.importForSchema=function(a){a.pushSkinJs("schema-manage","skin-initialize");a.pushJs("schema-manage/schema-manage-initialize.js");a.pushI18n("schema-manage","schema-initialize");a.pushSkinCss("schema-manage",
"schema-manage");a.pushJs("schema-manage/schema-manage-ui.js");a.pushI18n("schema-manage","schema-ui")};q.importForPublish=function(a){a.pushJs("biz-common/qing-biz-common.js");a.pushSkinCss("biz-common","biz-common");a.pushSkinJs("biz-common","skin");a.pushI18n("biz-common","biz-common");a.pushSkinJs("imagelib","skin");a.pushSkinCss("imagelib","qing-imagelib");a.pushJs("imagelib/imagelib.js");a.pushI18n("imagelib","imagelib");a.pushJs("common/qing-schedule.js");a.pushI18n("common","qing-schedule");
a.pushSkinCss("publish","qing-publish");a.pushSkinJs("publish","skin");a.pushI18n("publish","publish");a.pushJs("publish/qing-publish.js");a.pushSkinCss("timedpush","qing-timedpush");a.pushSkinJs("timedpush","skin");a.pushI18n("timedpush","timedpush");a.pushJs("timedpush/qing-timedpush.js");a.pushJs("lightapp/common/qing-lapp-env.js");a.pushJs("timedpush/qing-timedpush-lapp.js");a.pushJs("timedpush/html2canvas.js")};q.importForMap=function(a){a.pushSkinJs("map-designer","integration-skin");a.pushJs("map-designer/map-integration.js");
a.pushSkinCss("map-designer","map-integration");a.pushI18n("map-designer","map-integration")};q.hookLongerPublishTo=function(a,b,e,f,l,d){com.kingdee.bos.qing.publish.common.UserOperationReporter.hookCollector(function(r,O,G){com.kingdee.bos.qing.behavior.BehaviorManager.interestInBehavior(r,O,0,G)});b=com.kingdee.bos.qing.publish.model;var c=b.PublishTargetType;b=com.kingdee.bos.qing.schemamanage.model;var k=b.SchemaAttrModel,n=function(r){var O=com.kingdee.bos.qing.publish.common.PublishFactory,
G=r.getUserObject(),t=r.getText().replace("...",""),C=L(a,e,k.SCHEMASOURCE_LONGER,f,l,d);Q(e,G,C,"longer",v.ANALYSIS_PUBLISH,function(){var B=O.createPublishToDialog(t,F(),C,G,ea());B.setOuterMessageCurtain(ba());B.showDialog()})},h=com.kingdee.bos.qing.ui.component.MenuItemModel;b=new com.kingdee.bos.qing.ui.component.MenuModel;var m=new h(function(r){U(n,r)});m.setUserObject(c.APPMENU);m.setText(A("toAppMenu","\u5e94\u7528\u83dc\u5355..."));b.addItemModel(m);m=new h(function(r){U(n,r)});m.setUserObject(c.CENTER);
m.setText(A("toAnalysisCenter","\u6570\u636e\u5de5\u4f5c\u53f0\u9605\u89c8\u5939..."));b.addItemModel(m);m=new h(function(r){U(n,r)});m.setUserObject(c.MOBILE);m.setText(A("toMobile","\u79fb\u52a8\u8f7b\u5e94\u7528..."));b.addItemModel(m);X();ca();b.addSeperator();var N=function(){var r=com.kingdee.bos.qing.publish.common.PublishManagerDialog,O=L(a,e,com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel.SCHEMASOURCE_LONGER);(new r(F(),O,ea())).showDialog()};m=new h(function(r){U(N,r)});m.setUserObject();
m.setText(A("publishManager","\u53d1\u5e03\u7ba1\u7406")+"...");b.addItemModel(m);c=new h(fa);c.setUserObject();c.setText(A("permLabelManage","\u6743\u9650\u6807\u7b7e\u7ba1\u7406")+"...");b.addItemModel(c);c=A("publishTo","\u53d1\u5e03\u5230");return a.getConductor().appendToolbarMenu(b,"publish_to",c)};q.hookSquarePublishTo=function(a,b,e){com.kingdee.bos.qing.publish.common.UserOperationReporter.hookCollector(function(n,h,m){com.kingdee.bos.qing.behavior.BehaviorManager.interestInBehavior(n,h,
0,m)});b=com.kingdee.bos.qing.publish.model;var f=b.PublishTargetType;b=com.kingdee.bos.qing.schemamanage.model;var l=b.SchemaAttrModel,d=function(n){var h=com.kingdee.bos.qing.publish.common.PublishFactory,m=n.getUserObject(),N=n.getText().replace("...",""),r=L(a,e,l.SCHEMASOURCE_SQUARE);Q(e,m,r,"square",v.CARD_PUBLISH,function(){var O=h.createPublishToDialog(N,F(),r,m,ea());O.setOuterMessageCurtain(ba());O.showDialog()})},c=com.kingdee.bos.qing.ui.component.MenuItemModel;b=new com.kingdee.bos.qing.ui.component.MenuModel;
var k=new c(d);k.setUserObject(f.CARD_REPOSITORY);k.setText(A("toCardRepository","\u5361\u7247\u5e93..."));b.addItemModel(k);d=new c(d);d.setText(A("toMobile","\u79fb\u52a8\u8f7b\u5e94\u7528..."));d.setUserObject(f.MOBILE);b.addItemModel(d);X();ca();b.addSeperator();f=new c(function(){var n=com.kingdee.bos.qing.publish.common.PublishManagerDialog,h=L(a,e,com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel.SCHEMASOURCE_SQUARE);(new n(F(),h,ea())).showDialog()});f.setUserObject();f.setText(A("publishManager",
"\u53d1\u5e03\u7ba1\u7406")+"...");b.addItemModel(f);f=new c(fa);f.setUserObject();f.setText(A("permLabelManage","\u6743\u9650\u6807\u7b7e\u7ba1\u7406")+"...");b.addItemModel(f);f=A("publishTo","\u53d1\u5e03\u5230");return a.getConductor().appendToolbarMenu(b,"publish_to",f)};q.hookPublishManager=function(a,b,e){var f=A("publishManager","\u53d1\u5e03\u7ba1\u7406");return a.getConductor().appendToolbarButton(function(){var l=com.kingdee.bos.qing.publish.common.PublishManagerDialog,d=L(a,b,e);(new l(F(),
d,ea())).showDialog()},"publish_manager",f)};q.hookCloseTab=function(a){var b=A("closeTab","\u9000\u51fa");return a.getConductor().appendToolbarButton(function(){a.getConductor().isDirty()?R.showConfirmExitDialog():z.closeCurrentTab()},"error_close",b)};q.hookShareTo=function(a,b,e,f,l){com.kingdee.bos.qing.publish.common.UserOperationReporter.hookCollector(function(t,C,B){com.kingdee.bos.qing.behavior.BehaviorManager.interestInBehavior(t,C,0,B)});var d=function(t){t=A("yzjCommunicate","\u4e91\u4e4b\u5bb6\u6c9f\u901a...").replace("...",
"");var C=L(a,f,b);t=com.kingdee.bos.qing.timedpush.PublishToYunzhijiaDialogFactory.createDialog(t,F(),C);t.setOuterMessageCurtain(ba());t.showDialog()},c=function(t){t=com.kingdee.bos.qing.CodeLoader.createSafety();t.pushJs("yzj-web/qingjs.js");t.pushJs("yzj-web/imcloud.js");t.pushJs("yzj-web/imsdkerp.js");t.pushJs("yzj-web/imShare.js");t.pushSkinCss("yzj-web","imcloud");t.pushSkinCss("yzj-web","imsdk");t.pushSkinCss("yzj-web","imsdkerp");t.load(function(){})};e=new T;(new S(function(t){window.beLoadedImCloud?
d(t):c(t)})).setText(A("yzjCommunicate","\u4e91\u4e4b\u5bb6\u6c9f\u901a..."));var k=com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel,n=p.protectedHaveToCarryData(),h;com.kingdee.bos.qing&&com.kingdee.bos.qing.prepare&&com.kingdee.bos.qing.prepare.DataSourceInfoContext&&(h=com.kingdee.bos.qing.prepare.DataSourceInfoContext.getCurrentDataSourceInfo());h=h&&h.hasDirectModeTable();var m=com.kingdee.bos.qing.publish.model.PublishTargetType;if(!h&&!n&&b==k.SCHEMASOURCE_LONGER){var N=function(t){var C=
t.getText().replace("...",""),B=L(a,f,b,l);Q(f,m.EMAIL,B,"longer",v.ANALYSIS_TIMEPUSH,function(){var P=new com.kingdee.bos.qing.timedpush.EmailPublishConfigDialog(C,F(),B,oa(),pa(),ka(),a);P.setOuterMessageCurtain(ba());P.showDialog()})},r=new S(function(t){U(N,t)});r.setText(A("emailSchedulePush","\u90ae\u4ef6\u5b9a\u65f6\u63a8\u9001..."));e.addItemModel(r)}if(!h&&!n){var O=function(t){var C=L(a,f,b,l),B="longer",P=v.ANALYSIS_TIMEPUSH;b==k.SCHEMASOURCE_SQUARE&&(B="square",P=v.CARD_TIMEPUSH);Q(f,
m.EMAIL,C,B,P,function(){var Y=new com.kingdee.bos.qing.timedpush.LappSchedulePush,la=t.getText().replace("...","");Y.createDialog(la,F(),C,ka(),a)})};n=new S(function(t){U(O,t)});n.setText(A("mobileSchedulePush","\u79fb\u52a8\u7aef\u5b9a\u65f6\u63a8\u9001")+"...");e.addItemModel(n)}e.addSeperator();var G=function(){var t=com.kingdee.bos.qing.publish.common.PushManager,C=L(a,f,b);t=new t(ka());var B=com.kingdee.bos.qing.timedpush;t.registerEmailPushPanelConstructor(B.EmailConfigManagePanel);t.initEmailPushConfig(F(),
oa(),pa());t.registerLappPushPanelConstructor(B.LappPushManagePanel);t.initLappPushConfig(function(P,Y,la){return com.kingdee.bos.qing.publish.common.PublishFactory.createPublishFacade(com.kingdee.bos.qing.publish.model.PublishTargetType.MOBILE,F(),P,Y,la)},C);t.showDialog()};n=new S(function(t){U(G,t)});n.setUserObject();n.setText(A("pushManager","\u5b9a\u65f6\u63a8\u9001\u7ba1\u7406")+"...");e.addItemModel(n);e=a.getConductor().appendToolbarMenu(e,"btn_communicate",A("timedPush","\u5b9a\u65f6\u63a8\u9001"));
e.addActionListener(function(){window.beLoadedImCloud||(window.funCallback=d)});return e};q.initDesigntimeLinkage=function(){var a=q.getUrlParamUtil().getParamPathPrefix(),b=(a?a:"/ierp")+"/qing/linkage.do",e=com.kingdee.bos.qing.integration.LinkageJumper;a=new com.kingdee.bos.qing.linkage.LinkageManage;a.initDesigntime(b,e.jump);b=q.getUrlParamUtil().getParamTag();a.setCurrentLinkageTag(b)};q.loadMeta=ma;q.reloadMeta=na;q.hookRefresh=function(a,b){var e=q.getMLS("refresh","\u6570\u636e\u66f4\u65b0"),
f=function(){b.restart();b.setExtractDataFinishedSuccessCallback(function(l){l||ja(W)?na(function(d){var c=a.getJsonModelBook();a.prepareMeta(d);a.setJsonModelBook(c)}):a.reExecute()})};return a.getConductor().appendToolbarButton(function(){U(f)},"btn_reset",e)};q.getMessageCurtain=ba;q.hookSetCurrentTabStatus=function(a){a.getConductor().setDirtyListener(function(b){R.setTabStatus(b)})};q.loadPublishOperList=function(a,b,e,f,l){y?e(y):(new com.kingdee.bos.qing.publish.common.PublishFacade(F(),function(d){y=
d;e(y)},l)).loadPublishOperList(a,b,f)};q.loadPublishOperModel=function(a,b,e,f){y?e(y):(new com.kingdee.bos.qing.publish.common.PublishFacade(F(),function(l){y=l.noOperValueMap;e(y)},f)).loadPublishOperModel(a,b)};q.registMapMapLibrary=function(a){com.kingdee.bos.qing.map.common.Integration.setRemoteUrl(a+"/qing/mapManage.do");var b=new com.kingdee.bos.qing.map.integration.MapSelectorDialog;com.kingdee.bos.qing.core.MapLibraryRegister.registerTemplateSelector(function(e,f){b.setParamPathPrefix(a);
b.showDialog(e,f)})}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.scene&&(com.kingdee.bos.qing.scene={});"undefined"==typeof com.kingdee.bos.qing.scene.common&&(com.kingdee.bos.qing.scene.common={});"undefined"==typeof com.kingdee.bos.qing.scene.common.designer&&(com.kingdee.bos.qing.scene.common.designer=
{});var V=com.kingdee.bos.qing.scene.common.designer,D,da,J,Z,u,g,w,z,T,S,R,K;(function(){var p=com.kingdee.bos.qing;D=p.SkinUtil;da=p.AbstractDesignerScene;J=p.CodeLoader;K=p.Seer;p=com.kingdee.bos.qing.common;g=p.Util;p=com.kingdee.bos.qing.framework.common;w=p.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.scene);z=p.TabbedUiUtil;p=com.kingdee.bos.qing.ui.component;T=p.MenuModel;S=p.MenuItemModel;Z=p.MessageDialog;u=p.Icons;p=com.kingdee.bos.qing.integration;R=p.TabStatusHelper})();
V.AbstractDesignerSceneImpl=H;V.LongerDesignerOperationJudgerModel=function(p){com.kingdee.bos.qing.core.LongerDesignerOperationJudger.call(this);p&&0!=p&&(this.protectedParseDesignable=function(){return 0==(p&v.ANALYSIS_EDITABLE)},this.protectedParseDataDetailReadable=function(){return 0==(p&v.ANALYSIS_DETAIL)},this.protectedParseExportable=function(){return 0==(p&v.ANALYSIS_EXPORT)},this.protectedParsePrintable=function(){return 0==(p&v.ANALYSIS_PRINT)},this.protectedParsePublishable=function(){return 0==
(p&v.ANALYSIS_PUBLISH)},this.protectedParseTimingPushable=function(){return 0==(p&v.ANALYSIS_TIMEPUSH)})};V.SquareDesignerOperationJudgerModel=function(p){com.kingdee.bos.qing.core.SquareDesignerOperationJudger.call(this);p&&0!=p&&(this.protectedParsePublishable=function(){return 0==(p&v.CARD_PUBLISH)},this.protectedParseTimingPushable=function(){return 0==(p&v.CARD_TIMEPUSH)})};V.LongerDesignerOperationJudger=function(){com.kingdee.bos.qing.core.LongerDesignerOperationJudger.call(this);var p=this;
this.protectedParseDesignable=function(){return p.isDesignable()};this.protectedParseDataDetailReadable=function(){return p.isDataDetailReadable()};this.protectedParseExportable=function(){return p.isExportable()};this.protectedParsePrintable=function(){return p.isPrintable()};this.protectedParsePublishable=function(){return p.isPublishable()};this.protectedParseTimingPushable=function(){return p.isTimingPushable()}};var v={};V.OperCodeType=v;v.ANALYSIS_EDITABLE=2;v.ANALYSIS_EXPORT=4;v.ANALYSIS_PRINT=
8;v.ANALYSIS_PUBLISH=16;v.ANALYSIS_TIMEPUSH=32;v.ANALYSIS_DETAIL=64;v.CARD_PUBLISH=256;v.CARD_TIMEPUSH=512;v.ENTRY_ANALYSIS=1;v.ENTRY_SQUARE=128;H.THEME_IS_DEL="Theme is Delete";H.PUBLISHINFO_PERMISSION_PUBLISHPLAN_EXIST="success";H.PUBLISHINFO_NOEXIST="PublishInfo Not Exist";H.PERMISSION_CANCEL="Not Permission";H.PUBLSIHPLAN_DELETE="Publish Not Exist"})();(function(){function H(u,g,w,z){da.call(this,u,g,w,z);var T=this.protectedMethod;this.loadSquareSchema=function(S,R,K){T.remote("loadSquareSchema",{publishId:S,bizTag:R,schemaAdditionalTag:K})}}function V(){J.call(this);var u,g;this.getRemoteUrl=function(w){w.tag=g;return u};this.setRemoteUrl=function(w){u=w};this.setTag=function(w){g=w}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&
(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.scene&&(com.kingdee.bos.qing.scene={});com.kingdee.bos.qing.scene.CardAnalysisScene=function(){D.call(this);var u=this.protectedMethod,g,w,z,T,S,R,K,v,p;this.protectedHaveToCarryData=function(){return"true"==u.getUrlParamUtil().getUrlParam("haveToCarryData")};var q=this.protectedImportMoreCode;this.protectedImportMoreCode=function(x){q(x);u.importForSchema(x);u.importForPublish(x);u.importLinkage(x);x.pushJs("qhf/qing-qhf.js")};var W=
this.protectedCustomInitEnv;this.protectedCustomInitEnv=function(x){u.setModuleWithLonger(!0,!0);u.setModuleWithSquare(!1,!1);W(x);g=u.getUrlParamUtil().getUrlParam("bizTag");z=u.getUrlParamUtil().getUrlParam("schemaAdditionalTag");T=u.getUrlParamUtil().getUrlParam("publishSourceType");S="true"==u.getUrlParamUtil().getUrlParam("isPreset");w=u.getUrlParamUtil().getUrlParam("publishId");R=new V;var y=u.getUrlParamUtil().getParamPathPrefix();R.setRemoteUrl((y?y:"/ierp")+"/qing/schemaManage.do");R.setTag(u.getUrlParamUtil().getParamTag());
y=com.kingdee.bos.qing.behavior.BehaviorManager;y.interestInBehaviorEntrance(y.ENTRANCE_CARD_ANALYSIS);u.loadPublishOperList(w,null,function(M){var E=com.kingdee.bos.qing.publish.model.OperType,I=0;M[E.SQUARE]&&(I|=M[E.SQUARE]);M[E.LONGER]&&(I|=M[E.LONGER]);p=new Z(I);x()})};this.protectedInitDesignerForLonger=function(x){x.setDesignerOperationJudger(p,null);if(S)u.getMessageCurtain().showPrompt(u.getMLS("presetPublishAnalysisTipsCurtain","\u9884\u7f6e\u7684\u6570\u636e\u5206\u6790\u4e0d\u5141\u8bb8\u53d1\u5e03\u7b49\u64cd\u4f5c\uff0c\u5982\u6709\u9700\u8981\uff0c\u53ef\u590d\u5236\u540e\u518d\u8fdb\u884c\u64cd\u4f5c\u3002"),
5E3);else{var y=com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel.SCHEMASOURCE_LONGER;p.protectedParsePublishable()&&u.hookLongerPublishTo(x,K,T);"true"!=u.getUrlParamUtil().getUrlParam("haveToCarryData")&&p.protectedParseTimingPushable()&&u.hookShareTo(x,y,null,T);"true"!=u.getUrlParamUtil().getUrlParam("haveToCarryData")&&u.hookRefresh(x,com.kingdee.bos.qing.prepare.DataExtractor)}u.hookCloseTab(x);u.hookSetCurrentTabStatus(x);u.initDesigntimeLinkage();aa(x)};this.protectedLoadingLonger=function(x,
y,M){u.loadMeta(x,function(E){var I=com.kingdee.bos.qing.schemamanage.SchemaManage,ia=com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel,fa=com.kingdee.bos.qing.schemamanage.LoadSchemaError;y.prepareMeta(E);var Q=new I(g+z,ia.SCHEMASOURCE_LONGER);Q.setPublishId(g);Q.setDesignerOperationJudger(p);Q.setReloadMetaFun(function(X){u.reloadMeta(function(ca){y.prepareMeta(ca);X&&X()})});E=u.getUrlParamUtil().getParamPathPrefix();E=(E?E:"/ierp")+"/qing/card.do";I=new V;I.setRemoteUrl(E);(new H(I,function(X){var ca=
X.schemaContent;Q.initialize(R,y,function(L){L||(L=u.createSquare2LongerModelTransformer(),y.setJsonModelBook(ca,function(ja){(new fa).showErrorMsg(ja)},L));v||(v=y.getJsonModelBook());M(!0)})})).loadSquareSchema(w,g,z);K=Q.getSchemaContext()})};var aa=function(x){var y=u.getUrlParamUtil().getUrlParam("tag");com.kingdee.bos.qing.qhf.QHFSceneExporterRegister.register(y,function(){var M=com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel.SCHEMASOURCE_LONGER;var E="subject"==T?com.kingdee.bos.qing.qhf.QHFExporter.SCENE_TYPE_PUBLISH_SUBJECT_LONGER:
com.kingdee.bos.qing.qhf.QHFExporter.SCENE_TYPE_PUBLISH_EMBEDDED_LONGER;var I=x.getJsonModelBook();return{publishId:g,schemaId:g+z,initSchemaContext:v?JSON.stringify(v):null,finalSchemaContext:I?JSON.stringify(I):null,schemaType:M,sceneType:E}})}};var D,da,J,Z;(function(){var u=com.kingdee.bos.qing.framework.common;da=u.AbstractFacade;J=u.AbstractRemoteCall;u=com.kingdee.bos.qing.scene.common.designer;D=u.AbstractDesignerSceneImpl;Z=u.LongerDesignerOperationJudgerModel})()})();
//qingVersionTag: 20250324