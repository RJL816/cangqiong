(function(){function Z(){oa.call(this);var F=this,x=this.protectedMethod,N,S,V,T,da;this.setCurrentPublishSchema=function(b){da=b};this.setUserOperatorPrevCheck=function(b){V=b};this.setCloseResourceLock=function(b){};this.protectedHaveToCarryData=function(){return!1};this.protectedNeedToShowMessageBox=function(){return!0};this.protectedGetRemoteUrl=function(){var b=x.getUrlParamUtil().getParamPathPrefix();return(b?b:"/ierp")+"/qing/core.do"};this.protectedImportMoreCode=function(b){b.pushSkinJs("scene",
"skin");b.pushI18n("scene","scene")};this.protectedCustomInitEnv=function(b){b=$("<div>");b.css({position:"fixed",bottom:"3px",right:"1px",width:"180px",height:"18px",zIndex:"999"});a(b);F.protectedNeedToShowMessageBox()&&f(b);b.appendTo($(document.body));com.kingdee.bos.qing.integration.ImglibUrlParser.hookUrlParser()};var a=function(b){R.setCallback(function(){var e=new com.kingdee.bos.qing.support.Main;e.setParamLanguage(x.getUrlParamUtil().getParamLanguage());e.creatSupportUi(b)});R.loadCss("support/support.css");
R.loadJs("support/support-ui.js");R.loadI18n("support","support")},f=function(b){R.setCallback(function(){var e=com.kingdee.bos.qing.common.Util.decodeParamFromUrl(window.location.search,"path");e=e?e:"/ierp";com.kingdee.bos.qing.message.common.Integration.setRemoteUrl(e+"/qing/messageManage.do");k(e);var q=new com.kingdee.bos.qing.message.ui.Main;q.setFunOpenMessageDialog(function(){q.setViewSize(null,null,10,30)});q.setMessageWidth(80);q.getJqUi(25).appendTo(b)});R.loadSkinCss("message","message");
R.loadSkinJs("message","skin");R.loadJs("message/message-manage-ui.js");R.loadI18n("message","message")},k=function(b){var e=com.kingdee.bos.qing.message.common.Integration;e.setImportJSCodeForManager(function(){var y=com.kingdee.bos.qing.CodeLoader;y.setCallback(function(){var G=com.kingdee.bos.qing.theme.message.panel.common.Integration;G.setFunPublishRemoteImpl(function(){var p=new com.kingdee.bos.qing.theme.message.panel.common.RemoteImpl;p.setRemoteUrl(b+"/qing/publishTo.do");return p});G.setFunQingCenterAndMenuEntrance(function(p,
n,A,C){n=U.getUrlParamValue();var D=b+"/qing/publishEntrance.do";D=B.appendParamToUrl(D,"publishId",p);"extreport"==C?(D=B.appendParamToUrl(D,"appID","qing_rpt"),n&&(D=B.appendParamToUrl(D,"skin",n)),W.openNewTabInAppId(A,D,D,W.QING_RPT)):(n&&(D=B.appendParamToUrl(D,"skin",n)),W.openNewTabInAppId(A,D,D,W.QING_ANALYSIS))});G.setResourceRemoteUrl(b+"/qing/resource.do");G.setDataModelEntrance(function(p,n,A){var C=U.getUrlParamValue();n=Q.get("dataModeling","\u6570\u636e\u51c6\u5907")+"-"+n;var D=b+
"/qing/dataModelingEntrance.do";D=B.appendParamToUrl(D,"themeID",p);D=B.appendParamToUrl(D,"isPreset",A);C&&(D=B.appendParamToUrl(D,"skin",C));W.openNewTabInAppId(n,D,D,W.QING_ANALYSIS)});G.setFunPublishContext(function(){var p=new com.kingdee.bos.qing.publish.common.PublishContext;p.setParamPathPrefix(b);p.setLappEntranceUrl(b+"/qing/lappEntrance.do");p.setSpaceID(u.getUrlParamValue("qingID"));return p});G.setFunPublishedEmailLoginViewUrl(function(){var p=U.getUrlParamValue(),n=u.getUrlParamValue("language"),
A=b+"/qing/publishedEmailEntrance.do?publishId=(publishId)&kdcdc=(accountId)";p&&(A=B.appendParamToUrl(A,"skin",p));n&&(A=B.appendParamToUrl(A,"language",n));return A});G.setFunPublishedEmailAnonymousViewUrl(function(){var p=U.getUrlParamValue(),n=u.getUrlParamValue("language"),A=b+"/index.html?userId=Guest&accountId=(accountId)&appNumber=qing&formId=qing_analysis_pub_email#/dform?appNumber=qing&formId=qing_analysis_pub_email&publishId=(publishId)";p&&(A=B.appendParamToUrl(A,"skin",p));n&&(A=B.appendParamToUrl(A,
"language",n));return A});G.setFunPublishContentEditEntrance(function(){return function(p,n,A){var C=com.kingdee.bos.qing.publish.model.PublishTargetType;if(A&&C.MOBILE==A){C=p.getPublishId();var D=p.getId()}else C=p.getId();var H=U.getUrlParamValue(),fa=u.getUrlParamValue("language");A=b+"/qing/publishContentEditEntrance.do";A=B.appendParamToUrl(A,"skin",H);A=B.appendParamToUrl(A,"language",fa);A=B.appendParamToUrl(A,"publishId",C);D&&(A=B.appendParamToUrl(A,"lappId",D));D=A;n&&(C="editPublishedContent-"+
C,H=com.kingdee.bos.qing.publish.common.PublishSubscribeHelper,H.putSubscribe(C,n),A=B.appendParamToUrl(A,"subscribeKey",C),A=B.appendParamToUrl(A,"currentPageClientId",H.getCurrentPageClientId()));n=com.kingdee.bos.qing.framework.common.TabbedUiUtil;n.openNewTabInAppId(Q.get("editPublishedContent","\u7f16\u8f91\u53d1\u5e03\u65b9\u6848-")+p.getName(),A,D,n.QING_ANALYSIS)}});G.setFunTimedPushContentEditEntrance(function(){return function(p){var n=b+"/qing/timedPushContentEditEntrance.do",A=Q.get("editTimedPushContent",
"\u7f16\u8f91\u63a8\u9001\u65b9\u6848");if(p instanceof com.kingdee.bos.qing.timedpush.model.EmailConfig){var C=p.getId(),D=p.getPublishSourceType();H=p.getSchemaSourceType();n=B.appendParamToUrl(n,"configId",C);n=B.appendParamToUrl(n,"publishSourceType",D);n=B.appendParamToUrl(n,"schemaType",H);n=B.appendParamToUrl(n,"pushTarget","email");A=A+"-"+p.getNameRule().getName();p.isSourceNameNotFound()&&(n=B.appendParamToUrl(n,"errorCode","2301001"))}else{C=p.getId();D=p.getPushTargetType();var H=p.getSchemaType();
n=B.appendParamToUrl(n,"configId",C);n=B.appendParamToUrl(n,"pushTargetType",D);n=B.appendParamToUrl(n,"schemaType",H);n=B.appendParamToUrl(n,"pushTarget","lapp");A=A+"-"+p.getName();p.getSourceName()||(n=B.appendParamToUrl(n,"errorCode","2301001"))}p=U.getUrlParamValue();H=u.getUrlParamValue("language");p&&(n=B.appendParamToUrl(n,"skin",p));H&&(n=B.appendParamToUrl(n,"language",H));p=com.kingdee.bos.qing.framework.common.TabbedUiUtil;p.openNewTabInAppId(A,n,n,p.QING_ANALYSIS)}});G=com.kingdee.bos.qing.modeler.message.panel.common.Integration;
G.setMessageRemoteUrl(b+"/qing_modeler/message.do");G.setFunOpenModelSetPage(function(p,n){var A=U.getUrlParamValue(),C=Q.get("modelSet","\u6a21\u578b\u96c6-")+n,D=b+"/qing_modeler/modelSetMainPage.do";D=B.appendParamToUrl(D,"modelSetId",p);D=B.appendParamToUrl(D,"modelSetName",n);D=B.appendParamToUrl(D,"currentPageClientId",com.kingdee.bos.qing.framework.common.RemoteFramework.getClientID());A&&(D=B.appendParamToUrl(D,"skin",A));W.openNewTabInAppId(C,D,D,W.QING_MODELER)});G.setFunOpenModelDesign(function(p,
n,A,C,D){var H=com.kingdee.bos.qing.modeler.message.panel.common.ModelType,fa=U.getUrlParamValue();D=(D=H.getModelTypeText(D))?D+"-"+A:A;H=b+"/qing_modeler/deployDesignerEntrance.do";H=B.appendParamToUrl(H,"modelSetId",p);H=B.appendParamToUrl(H,"modelId",n);H=B.appendParamToUrl(H,"modelName",A);H=B.appendParamToUrl(H,"modelDeployId",C);fa&&(H=B.appendParamToUrl(H,"skin",fa));W.openNewTabInAppId(D,H,H,W.QING_MODELER)})});y.loadSkinCss("message","messagepanel");y.loadSkinJs("message","skin");y.loadJs("message/message-content-panel-management.js");
y.loadI18n("message","messagepanel");y.loadSkinCss("qingmodeler/message","message-modeler-panel");y.loadSkinJs("qingmodeler/message","skin");y.loadJs("qingmodeler/message/message-content-panel-management.js");y.loadI18n("qingmodeler/message","message-modeler-panel")});var q=B.decodeParamFromUrl(location.search,"appID");e.setAppId(q)},h=function(b){b=new com.kingdee.bos.qing.publish.permission.PermLabelManageDialog(I());b.setSpaceID(u.getUrlParamValue("qingID"));b.showDialog()},g=function(b,e,q,y,
G,p){var n=com.kingdee.bos.qing.publish.model.PublishSourceType,A=com.kingdee.bos.qing.publish.model.PublishTargetType;b!=n.EXTREPORT&&b!=n.DASHBOARD&&e!=A.GUIMENU?(b=new com.kingdee.bos.qing.publish.common.PublishFacade(I(),function(C){p&&p()},function(C,D){return 2301016==C?(X().showPrompt(Q.get("publishNoOperAuthExceptionCurtain","\u6ca1\u6709\u64cd\u4f5c\u6743\u9650\u3002"),2E3),!0):!1}),e=q.getBizTag(),n=q.getDsbPublishId(),q.getRefToId()&&(e=q.getRefToId()),b.judgePublishOper(e,n,y,G)):p&&p()},
r=function(){com.kingdee.bos.qing.timedpush.LappIntegration.syncDatacenterInfo(I())},l=function(){var b=x.getUrlParamUtil().getParamPathPrefix();com.kingdee.bos.qing.timedpush.LappIntegration.setLappPrivateUrl(b+"/qing/lappPrivateInfo.do")},c=function(b,e,q,y,G,p){var n=x.getUrlParamUtil().getParamPathPrefix(),A=com.kingdee.bos.qing.publish.common,C=A.PublishContext;A=com.kingdee.bos.qing.schemamanage.model;var D=A.SchemaAttrModel;A=A.SchemaModel;var H=x.getUrlParamUtil().getUrlParam("bizTag"),fa=
F.protectedHaveToCarryData(),K;com.kingdee.bos.qing&&com.kingdee.bos.qing.prepare&&com.kingdee.bos.qing.prepare.DataSourceInfoContext&&(K=com.kingdee.bos.qing.prepare.DataSourceInfoContext.getCurrentDataSourceInfo());var ha=K&&K.hasDirectModeTable();K=new C;K.setSource(G);K.setBizTag(H);K.setCurrentSourceType(e);K.setHaveToCarryData(fa);K.setHasDirectModeTable(ha);K.setParamPathPrefix(n);K.setSchemaTag("Dashboard-Analysis"==p?x.getUrlParamUtil().getUrlParam("schemaTag"):null);K.setSpaceID(u.getUrlParamValue("qingID"));
e=new D;e.setSchemaType(D.SCHEMATYPE_SYSTEM);e.setIsDefault(!0);e.setSchemaName(O("sysPublishScheme","\u7cfb\u7edf\u9ed8\u8ba4\u65b9\u6848"));e.setSource(q);G=new A;G.setSchemaAttr(e);G.setSchemaContent(b.getJsonModelBook());b=G.toJsonObject();K.setCurrentContentModel(b);b=x.getUrlParamUtil().getParamTag();e=function(ca){ca+="/qinganalysis/lappPreviewEntrance.do";for(var M=window.location.search.substring(1).split("&"),ba=0;ba<M.length;ba++){var Y=M[ba],ja=Y.indexOf("=");if(-1!=ja){var pa=Y.substring(0,
ja);"clientID"!=pa&&"safetyCode"!=pa&&(Y=Y.substring(ja+1),ca+=0>ca.indexOf("?")?"?":"&",ca+=pa,ca+="=",ca+=Y)}}return ca};q==D.SCHEMASOURCE_SQUARE?(K.setScene(C.Scene.Square),q=e(n),q=B.appendParamToUrl(q,"view","10"),K.setMobilePreviewUrl(q),n=B.appendParamToUrl(n+"/qing/lappEntrance.do","tag",b),n=B.appendParamToUrl(n,"view","10"),K.setLappEntranceUrl(n)):q==D.SCHEMASOURCE_LONGER&&(K.setScene(C.Scene.Longer),K.setMobilePreviewUrl(e(n)),n=B.appendParamToUrl(n+"/qing/lappEntrance.do","tag",b),K.setLappEntranceUrl(n));
y&&(K.setRefToId(x.getUrlParamUtil().getUrlParam("publishId")),K.setDsbPublishId(y),K.setDashBoardAnalysis(!0));return K},d=function(b){var e=!1;if(b&&(b=b.tables)&&0<b.length)for(var q=0;q<b.length;q++)if(b[q].subViews){e=!0;break}return e},t=function(b,e){V?V(function(q){var y=new com.kingdee.bos.qing.schemamanage.common.SchemaManageFacade(w(),function(p){p.publishInfoPerCheck==Z.PUBLISHINFO_PERMISSION_PUBLISHPLAN_EXIST?b&&b(e):p.publishInfoPerCheck==Z.THEME_IS_DEL?z($(document.body),"msg-warning",
Q.get("ThemeIsDel","\u8be5\u53d1\u5e03\u8bb0\u5f55\u7684\u6765\u6e90\u88ab\u5220\u9664")):p.publishInfoPerCheck==Z.PUBLISHINFO_NOEXIST?z($(document.body),"msg-warning",Q.get("publishInfoExist","\u53d1\u5e03\u8bb0\u5f55\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664")):p.publishInfoPerCheck==Z.PERMISSION_CANCEL?z($(document.body),"msg-jurisdiction",Q.get("notAuthority","\u60a8\u6ca1\u6709\u8be5\u53d1\u5e03\u8bb0\u5f55\u7684\u67e5\u770b\u6743\u9650, \u8bf7\u8054\u7cfb\u53d1\u5e03\u4eba")+'"'+p.publishInfoUserName+
'"'+Q.get("authority","\u6388\u6743")):p.publishInfoPerCheck==Z.PUBLSIHPLAN_DELETE&&z($(document.body),"msg-warning",Q.get("publishPlanExist","\u8be5\u5206\u6790\u65b9\u6848\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664"))}),G=new com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel;G.setFId(da.getCurrentSchemaId());G.setSchemaName(da.getCurrentSchemaName());y.checkPublishInfoAndAuthority(q,G)}):b&&b(e)},w=function(){var b=x.getUrlParamUtil().getParamPathPrefix(),e=x.getUrlParamUtil().getParamTag();
b=(b?b:"/ierp")+"/qing/schemaManage.do";var q=new com.kingdee.bos.qing.RemoteImpl;q.setRemoteUrl(b);q.setTag(e);return q},z=function(b,e,q){b=new la;b.setOptionType(la.OPTION_OK);b.setButtonText(la.RETURN_OK,Q.get("ISee","\u6211\u77e5\u9053\u4e86"));var y={};y.text=q;y.iconName=e;b.setMessage(y);b.setCustomPainter(function(G,p){var n=$("<div>");n.addClass("sa-ctrl-msgdlg-icon");ma.background(n,p.iconName);var A=$("<div>");A.addClass("sa-ctrl-msgdlg-content");A.text(p.text);G.append(n);G.append(A)});
b.showDialog(380,280)},v=function(b,e,q){N?e(N):(new com.kingdee.bos.qing.core.Facade(b,function(y){N=y;e(y)},q)).getMeta()},J=function(b){N=null;v(F.getRemoteImpl(),b)},I=function(){var b=x.getUrlParamUtil().getParamPathPrefix(),e=x.getUrlParamUtil().getParamTag();b=(b?b:"/ierp")+"/qing/publishTo.do";var q=new com.kingdee.bos.qing.RemoteImpl;q.setRemoteUrl(b);q.setTag(e);return q},P=function(){var b=x.getUrlParamUtil().getParamPathPrefix(),e=U.getUrlParamValue(),q=x.getUrlParamUtil().getParamLanguage();
b=(b?b:"/ierp")+"/index.html?userId=Guest&accountId=(accountId)&appNumber=qing&formId=qing_analysis_pub_email#/dform?appNumber=qing&formId=qing_analysis_pub_email&publishId=(publishId)";e&&(b=B.appendParamToUrl(b,"skin",e));q&&(b=B.appendParamToUrl(b,"language",q));return b},E=function(){var b=x.getUrlParamUtil().getParamPathPrefix(),e=U.getUrlParamValue(),q=x.getUrlParamUtil().getParamLanguage();b=(b?b:"/ierp")+"/qing/publishedEmailEntrance.do?publishId=(publishId)&kdcdc=(accountId)";e&&(b=B.appendParamToUrl(b,
"skin",e));q&&(b=B.appendParamToUrl(b,"language",q));return b},m=function(){return function(b,e,q){var y=com.kingdee.bos.qing.publish.model.PublishTargetType;if(q&&y.MOBILE==q){q=b.getPublishId();var G=b.getId();var p=b.getLappUserType()}else q=b.getId();y=x.getUrlParamUtil().getParamPathPrefix();var n=U.getUrlParamValue(),A=x.getUrlParamUtil().getParamLanguage();y=B.appendParamToUrl((y?y:"/ierp")+"/qing/publishContentEditEntrance.do","skin",n);y=B.appendParamToUrl(y,"language",A);y=B.appendParamToUrl(y,
"publishId",q);G&&(y=B.appendParamToUrl(y,"lappId",G));p&&(y=B.appendParamToUrl(y,"lappUserType",p));G=y;e&&(p="editPublishedContent-"+q,q=com.kingdee.bos.qing.publish.common.PublishSubscribeHelper,q.putSubscribe(p,e),y=B.appendParamToUrl(y,"subscribeKey",p),y=B.appendParamToUrl(y,"currentPageClientId",q.getCurrentPageClientId()));W.openNewTab(Q.get("editPublishedContent","\u7f16\u8f91\u53d1\u5e03\u65b9\u6848-")+b.getName(),y,G)}},aa=function(){return function(b){var e=x.getUrlParamUtil().getParamPathPrefix();
e=(e?e:"/ierp")+"/qing/timedPushContentEditEntrance.do";var q=Q.get("editTimedPushContent","\u7f16\u8f91\u63a8\u9001\u65b9\u6848");if(b instanceof com.kingdee.bos.qing.timedpush.model.EmailConfig){var y=b.getId(),G=b.getPublishSourceType();p=b.getSchemaSourceType();e=B.appendParamToUrl(e,"configId",y);e=B.appendParamToUrl(e,"publishSourceType",G);e=B.appendParamToUrl(e,"schemaType",p);e=B.appendParamToUrl(e,"pushTarget","email");q=q+"-"+b.getNameRule().getName();b.isSourceNameNotFound()&&(e=B.appendParamToUrl(e,
"errorCode","2301001"))}else{y=b.getId();G=b.getPushTargetType();var p=b.getSchemaType();e=B.appendParamToUrl(e,"configId",y);e=B.appendParamToUrl(e,"pushTargetType",G);e=B.appendParamToUrl(e,"schemaType",p);e=B.appendParamToUrl(e,"pushTarget","lapp");q=q+"-"+b.getName();b.getSourceName()||(e=B.appendParamToUrl(e,"errorCode","2301001"))}b=U.getUrlParamValue();p=x.getUrlParamUtil().getParamLanguage();b&&(e=B.appendParamToUrl(e,"skin",b));p&&(e=B.appendParamToUrl(e,"language",p));W.openNewTab(q,e)}},
O=function(b,e){return Q.get(b,e)},X=function(){S||(S=new com.kingdee.bos.qing.ui.component.MessageCurtain,S.getJqUi().appendTo($(document.body)));return S};x.getMLS=O;x.importLinkage=function(b){b.pushSkinJs("linkage","skin");b.pushJs("linkage/linkage.js");b.pushSkinCss("linkage","linkage")};x.importForSchema=function(b){b.pushSkinJs("schema-manage","skin-initialize");b.pushJs("schema-manage/schema-manage-initialize.js");b.pushI18n("schema-manage","schema-initialize");b.pushSkinCss("schema-manage",
"schema-manage");b.pushJs("schema-manage/schema-manage-ui.js");b.pushI18n("schema-manage","schema-ui")};x.importForPublish=function(b){b.pushJs("biz-common/qing-biz-common.js");b.pushSkinCss("biz-common","biz-common");b.pushSkinJs("biz-common","skin");b.pushI18n("biz-common","biz-common");b.pushSkinJs("imagelib","skin");b.pushSkinCss("imagelib","qing-imagelib");b.pushJs("imagelib/imagelib.js");b.pushI18n("imagelib","imagelib");b.pushJs("common/qing-schedule.js");b.pushI18n("common","qing-schedule");
b.pushSkinCss("publish","qing-publish");b.pushSkinJs("publish","skin");b.pushI18n("publish","publish");b.pushJs("publish/qing-publish.js");b.pushSkinCss("timedpush","qing-timedpush");b.pushSkinJs("timedpush","skin");b.pushI18n("timedpush","timedpush");b.pushJs("timedpush/qing-timedpush.js");b.pushJs("lightapp/common/qing-lapp-env.js");b.pushJs("timedpush/qing-timedpush-lapp.js");b.pushJs("timedpush/html2canvas.js")};x.importForMap=function(b){b.pushSkinJs("map-designer","integration-skin");b.pushJs("map-designer/map-integration.js");
b.pushSkinCss("map-designer","map-integration");b.pushI18n("map-designer","map-integration")};x.hookLongerPublishTo=function(b,e,q,y,G,p){com.kingdee.bos.qing.publish.common.UserOperationReporter.hookCollector(function(K,ha,ca){com.kingdee.bos.qing.behavior.BehaviorManager.interestInBehavior(K,ha,0,ca)});e=com.kingdee.bos.qing.publish.model;var n=e.PublishTargetType;e=com.kingdee.bos.qing.schemamanage.model;var A=e.SchemaAttrModel,C=function(K){var ha=com.kingdee.bos.qing.publish.common.PublishFactory,
ca=K.getUserObject(),M=K.getText().replace("...",""),ba=c(b,q,A.SCHEMASOURCE_LONGER,y,G,p);g(q,ca,ba,"longer",L.ANALYSIS_PUBLISH,function(){var Y=ha.createPublishToDialog(M,I(),ba,ca,m());Y.setOuterMessageCurtain(X());Y.showDialog()})},D=com.kingdee.bos.qing.ui.component.MenuItemModel;e=new com.kingdee.bos.qing.ui.component.MenuModel;var H=new D(function(K){t(C,K)});H.setUserObject(n.APPMENU);H.setText(O("toAppMenu","\u5e94\u7528\u83dc\u5355..."));e.addItemModel(H);H=new D(function(K){t(C,K)});H.setUserObject(n.CENTER);
H.setText(O("toAnalysisCenter","\u6570\u636e\u5de5\u4f5c\u53f0\u9605\u89c8\u5939..."));e.addItemModel(H);H=new D(function(K){t(C,K)});H.setUserObject(n.MOBILE);H.setText(O("toMobile","\u79fb\u52a8\u8f7b\u5e94\u7528..."));e.addItemModel(H);r();l();e.addSeperator();var fa=function(){var K=com.kingdee.bos.qing.publish.common.PublishManagerDialog,ha=c(b,q,com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel.SCHEMASOURCE_LONGER);(new K(I(),ha,m())).showDialog()};H=new D(function(K){t(fa,K)});H.setUserObject();
H.setText(O("publishManager","\u53d1\u5e03\u7ba1\u7406")+"...");e.addItemModel(H);n=new D(h);n.setUserObject();n.setText(O("permLabelManage","\u6743\u9650\u6807\u7b7e\u7ba1\u7406")+"...");e.addItemModel(n);n=O("publishTo","\u53d1\u5e03\u5230");return b.getConductor().appendToolbarMenu(e,"publish_to",n)};x.hookSquarePublishTo=function(b,e,q){com.kingdee.bos.qing.publish.common.UserOperationReporter.hookCollector(function(C,D,H){com.kingdee.bos.qing.behavior.BehaviorManager.interestInBehavior(C,D,0,
H)});e=com.kingdee.bos.qing.publish.model;var y=e.PublishTargetType;e=com.kingdee.bos.qing.schemamanage.model;var G=e.SchemaAttrModel,p=function(C){var D=com.kingdee.bos.qing.publish.common.PublishFactory,H=C.getUserObject(),fa=C.getText().replace("...",""),K=c(b,q,G.SCHEMASOURCE_SQUARE);g(q,H,K,"square",L.CARD_PUBLISH,function(){var ha=D.createPublishToDialog(fa,I(),K,H,m());ha.setOuterMessageCurtain(X());ha.showDialog()})},n=com.kingdee.bos.qing.ui.component.MenuItemModel;e=new com.kingdee.bos.qing.ui.component.MenuModel;
var A=new n(p);A.setUserObject(y.CARD_REPOSITORY);A.setText(O("toCardRepository","\u5361\u7247\u5e93..."));e.addItemModel(A);p=new n(p);p.setText(O("toMobile","\u79fb\u52a8\u8f7b\u5e94\u7528..."));p.setUserObject(y.MOBILE);e.addItemModel(p);r();l();e.addSeperator();y=new n(function(){var C=com.kingdee.bos.qing.publish.common.PublishManagerDialog,D=c(b,q,com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel.SCHEMASOURCE_SQUARE);(new C(I(),D,m())).showDialog()});y.setUserObject();y.setText(O("publishManager",
"\u53d1\u5e03\u7ba1\u7406")+"...");e.addItemModel(y);y=new n(h);y.setUserObject();y.setText(O("permLabelManage","\u6743\u9650\u6807\u7b7e\u7ba1\u7406")+"...");e.addItemModel(y);y=O("publishTo","\u53d1\u5e03\u5230");return b.getConductor().appendToolbarMenu(e,"publish_to",y)};x.hookPublishManager=function(b,e,q){var y=O("publishManager","\u53d1\u5e03\u7ba1\u7406");return b.getConductor().appendToolbarButton(function(){var G=com.kingdee.bos.qing.publish.common.PublishManagerDialog,p=c(b,e,q);(new G(I(),
p,m())).showDialog()},"publish_manager",y)};x.hookCloseTab=function(b){var e=O("closeTab","\u9000\u51fa");return b.getConductor().appendToolbarButton(function(){b.getConductor().isDirty()?na.showConfirmExitDialog():W.closeCurrentTab()},"error_close",e)};x.hookShareTo=function(b,e,q,y,G){com.kingdee.bos.qing.publish.common.UserOperationReporter.hookCollector(function(M,ba,Y){com.kingdee.bos.qing.behavior.BehaviorManager.interestInBehavior(M,ba,0,Y)});var p=function(M){M=O("yzjCommunicate","\u4e91\u4e4b\u5bb6\u6c9f\u901a...").replace("...",
"");var ba=c(b,y,e);M=com.kingdee.bos.qing.timedpush.PublishToYunzhijiaDialogFactory.createDialog(M,I(),ba);M.setOuterMessageCurtain(X());M.showDialog()},n=function(M){M=com.kingdee.bos.qing.CodeLoader.createSafety();M.pushJs("yzj-web/qingjs.js");M.pushJs("yzj-web/imcloud.js");M.pushJs("yzj-web/imsdkerp.js");M.pushJs("yzj-web/imShare.js");M.pushSkinCss("yzj-web","imcloud");M.pushSkinCss("yzj-web","imsdk");M.pushSkinCss("yzj-web","imsdkerp");M.load(function(){})};q=new ea;(new ka(function(M){window.beLoadedImCloud?
p(M):n(M)})).setText(O("yzjCommunicate","\u4e91\u4e4b\u5bb6\u6c9f\u901a..."));var A=com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel,C=F.protectedHaveToCarryData(),D;com.kingdee.bos.qing&&com.kingdee.bos.qing.prepare&&com.kingdee.bos.qing.prepare.DataSourceInfoContext&&(D=com.kingdee.bos.qing.prepare.DataSourceInfoContext.getCurrentDataSourceInfo());D=D&&D.hasDirectModeTable();var H=com.kingdee.bos.qing.publish.model.PublishTargetType;if(!D&&!C&&e==A.SCHEMASOURCE_LONGER){var fa=function(M){var ba=
M.getText().replace("...",""),Y=c(b,y,e,G);g(y,H.EMAIL,Y,"longer",L.ANALYSIS_TIMEPUSH,function(){var ja=new com.kingdee.bos.qing.timedpush.EmailPublishConfigDialog(ba,I(),Y,P(),E(),aa(),b);ja.setOuterMessageCurtain(X());ja.showDialog()})},K=new ka(function(M){t(fa,M)});K.setText(O("emailSchedulePush","\u90ae\u4ef6\u5b9a\u65f6\u63a8\u9001..."));q.addItemModel(K)}if(!D&&!C){var ha=function(M){var ba=c(b,y,e,G),Y="longer",ja=L.ANALYSIS_TIMEPUSH;e==A.SCHEMASOURCE_SQUARE&&(Y="square",ja=L.CARD_TIMEPUSH);
g(y,H.EMAIL,ba,Y,ja,function(){var pa=new com.kingdee.bos.qing.timedpush.LappSchedulePush,qa=M.getText().replace("...","");pa.createDialog(qa,I(),ba,aa(),b)})};C=new ka(function(M){t(ha,M)});C.setText(O("mobileSchedulePush","\u79fb\u52a8\u7aef\u5b9a\u65f6\u63a8\u9001")+"...");q.addItemModel(C)}q.addSeperator();var ca=function(){var M=com.kingdee.bos.qing.publish.common.PushManager,ba=c(b,y,e);M=new M(aa());var Y=com.kingdee.bos.qing.timedpush;M.registerEmailPushPanelConstructor(Y.EmailConfigManagePanel);
M.initEmailPushConfig(I(),P(),E());M.registerLappPushPanelConstructor(Y.LappPushManagePanel);M.initLappPushConfig(function(ja,pa,qa){return com.kingdee.bos.qing.publish.common.PublishFactory.createPublishFacade(com.kingdee.bos.qing.publish.model.PublishTargetType.MOBILE,I(),ja,pa,qa)},ba);M.showDialog()};C=new ka(function(M){t(ca,M)});C.setUserObject();C.setText(O("pushManager","\u5b9a\u65f6\u63a8\u9001\u7ba1\u7406")+"...");q.addItemModel(C);q=b.getConductor().appendToolbarMenu(q,"btn_communicate",
O("timedPush","\u5b9a\u65f6\u63a8\u9001"));q.addActionListener(function(){window.beLoadedImCloud||(window.funCallback=p)});return q};x.initDesigntimeLinkage=function(){var b=x.getUrlParamUtil().getParamPathPrefix(),e=(b?b:"/ierp")+"/qing/linkage.do",q=com.kingdee.bos.qing.integration.LinkageJumper;b=new com.kingdee.bos.qing.linkage.LinkageManage;b.initDesigntime(e,q.jump);e=x.getUrlParamUtil().getParamTag();b.setCurrentLinkageTag(e)};x.loadMeta=v;x.reloadMeta=J;x.hookRefresh=function(b,e){var q=x.getMLS("refresh",
"\u6570\u636e\u66f4\u65b0"),y=function(){e.restart();e.setExtractDataFinishedSuccessCallback(function(G){G||d(N)?J(function(p){var n=b.getJsonModelBook();b.prepareMeta(p);b.setJsonModelBook(n)}):b.reExecute()})};return b.getConductor().appendToolbarButton(function(){t(y)},"btn_reset",q)};x.getMessageCurtain=X;x.hookSetCurrentTabStatus=function(b){b.getConductor().setDirtyListener(function(e){na.setTabStatus(e)})};x.loadPublishOperList=function(b,e,q,y,G){T?q(T):(new com.kingdee.bos.qing.publish.common.PublishFacade(I(),
function(p){T=p;q(T)},G)).loadPublishOperList(b,e,y)};x.loadPublishOperModel=function(b,e,q,y){T?q(T):(new com.kingdee.bos.qing.publish.common.PublishFacade(I(),function(G){T=G.noOperValueMap;q(T)},y)).loadPublishOperModel(b,e)};x.registMapMapLibrary=function(b){com.kingdee.bos.qing.map.common.Integration.setRemoteUrl(b+"/qing/mapManage.do");var e=new com.kingdee.bos.qing.map.integration.MapSelectorDialog;com.kingdee.bos.qing.core.MapLibraryRegister.registerTemplateSelector(function(q,y){e.setParamPathPrefix(b);
e.showDialog(q,y)})}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.scene&&(com.kingdee.bos.qing.scene={});"undefined"==typeof com.kingdee.bos.qing.scene.common&&(com.kingdee.bos.qing.scene.common={});"undefined"==typeof com.kingdee.bos.qing.scene.common.designer&&(com.kingdee.bos.qing.scene.common.designer=
{});var ia=com.kingdee.bos.qing.scene.common.designer,U,oa,R,la,ma,B,Q,W,ea,ka,na,u;(function(){var F=com.kingdee.bos.qing;U=F.SkinUtil;oa=F.AbstractDesignerScene;R=F.CodeLoader;u=F.Seer;F=com.kingdee.bos.qing.common;B=F.Util;F=com.kingdee.bos.qing.framework.common;Q=F.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.scene);W=F.TabbedUiUtil;F=com.kingdee.bos.qing.ui.component;ea=F.MenuModel;ka=F.MenuItemModel;la=F.MessageDialog;ma=F.Icons;F=com.kingdee.bos.qing.integration;na=F.TabStatusHelper})();
ia.AbstractDesignerSceneImpl=Z;ia.LongerDesignerOperationJudgerModel=function(F){com.kingdee.bos.qing.core.LongerDesignerOperationJudger.call(this);F&&0!=F&&(this.protectedParseDesignable=function(){return 0==(F&L.ANALYSIS_EDITABLE)},this.protectedParseDataDetailReadable=function(){return 0==(F&L.ANALYSIS_DETAIL)},this.protectedParseExportable=function(){return 0==(F&L.ANALYSIS_EXPORT)},this.protectedParsePrintable=function(){return 0==(F&L.ANALYSIS_PRINT)},this.protectedParsePublishable=function(){return 0==
(F&L.ANALYSIS_PUBLISH)},this.protectedParseTimingPushable=function(){return 0==(F&L.ANALYSIS_TIMEPUSH)})};ia.SquareDesignerOperationJudgerModel=function(F){com.kingdee.bos.qing.core.SquareDesignerOperationJudger.call(this);F&&0!=F&&(this.protectedParsePublishable=function(){return 0==(F&L.CARD_PUBLISH)},this.protectedParseTimingPushable=function(){return 0==(F&L.CARD_TIMEPUSH)})};ia.LongerDesignerOperationJudger=function(){com.kingdee.bos.qing.core.LongerDesignerOperationJudger.call(this);var F=this;
this.protectedParseDesignable=function(){return F.isDesignable()};this.protectedParseDataDetailReadable=function(){return F.isDataDetailReadable()};this.protectedParseExportable=function(){return F.isExportable()};this.protectedParsePrintable=function(){return F.isPrintable()};this.protectedParsePublishable=function(){return F.isPublishable()};this.protectedParseTimingPushable=function(){return F.isTimingPushable()}};var L={};ia.OperCodeType=L;L.ANALYSIS_EDITABLE=2;L.ANALYSIS_EXPORT=4;L.ANALYSIS_PRINT=
8;L.ANALYSIS_PUBLISH=16;L.ANALYSIS_TIMEPUSH=32;L.ANALYSIS_DETAIL=64;L.CARD_PUBLISH=256;L.CARD_TIMEPUSH=512;L.ENTRY_ANALYSIS=1;L.ENTRY_SQUARE=128;Z.THEME_IS_DEL="Theme is Delete";Z.PUBLISHINFO_PERMISSION_PUBLISHPLAN_EXIST="success";Z.PUBLISHINFO_NOEXIST="PublishInfo Not Exist";Z.PERMISSION_CANCEL="Not Permission";Z.PUBLSIHPLAN_DELETE="Publish Not Exist"})();(function(){function Z(){ia.call(this)}function ia(){var a,f=this,k,h,g,r,l,c,d=com.kingdee.bos.qing.common.Util;this.show=function(z){t().appendTo(z);c||(c=$("<div>"),N.layoutCtrlWithLRTB(c,0,0,null,0,0,null),c.css({"z-index":"-1",background:"#fff"}));c.appendTo(z)};var t=function(){a||(a=$("<div class='sa-qing-publish-card-main'>"),g=$("<div class='sa-qing-publish-card-head'>"),(k=d.decodeParamFromUrl(location.search,"cardName"))||(k=" "),h=$("<div class='sa-qing-publish-card-title sa-qing-publish-fontfamily'>"),
k=com.kingdee.bos.qing.common.Base64Util.decode(k),h.text(k),h.attr("title",k),h.appendTo(g),r=$("<div>"),r.addClass("sa-qing-publish-card-content"),r.appendTo(a),f.protectedCustomContent(r),f.protectedCustomHead(g),g.appendTo(a));return a};this.protectedCustomHead=function(z){};this.protectedCustomContent=function(z){};var w=function(z,v,J){return d.appendParamToUrl(z,v,J)};this.protectedMethod={getTitleUi:function(){return h},getTitle:function(){return k},getContentUi:function(){return r},getUrlParam:function(z){return d.decodeParamFromUrl(location.search,
z)},appendUrlParam:w,appendAccountIdParam:function(z){var v=T.getUrlParamValue("kdcdc");v&&(z=w(z,"kdcdc",v));return z},getMainUi:t,appendOperateBtnUI:function(z){for(var v=5,J=0,I=z.length;J<I;J++)z[J].css({position:"absolute",top:"5px",right:v+"px"}),v+=35,g.append(z[J])},insertOperateBtnUI:function(z){for(var v=0,J=z.length;v<J;v++)z[v].css({position:"relative","margin-right":"10px",display:"inline-block"}),z[v].insertBefore(h)},insertExtraOperateBtn:function(z){if(!l){l=$("<div>");a.append(l);
var v=g.height();N.layoutCtrlWithLRTB(l,0,0,null,v,null,44);l.hide()}v=20;for(var J=0,I=z.length;J<I;J++){var P=z[J].getJqUi();N.layoutCtrlWithLRTB(P,null,v,80,0,null,16);N.layoutCtrlMiddleAlign(P,16);l.append(P);P=$("<div>");P.addClass("sa-qing-publish-card-extraicon-border");l.append(P);N.layoutCtrlWithLRTB(P,null,v,0,0,null,24);N.layoutCtrlMiddleAlign(P,24);v+=90}},showExtraOperateContainer:function(){if(l){l.show();var z=l[0].offsetTop,v=l.height();r.css("top",z+v+"px");$(window).trigger("resize")}},
hideExtraOperateContainer:function(){l&&(r.css("top",g.height()+"px"),l.hide(),$(window).trigger("resize"))}}}function U(a,f,k){var h=a,g=f,r,l,c;this.getJqUi=function(){r||(r=$("<div>"),l=$("<div>"),l.addClass("sa-qing-publish-card-icon"),u.Icons.background(l,g),c=$("<div>"),c.addClass("sa-qing-publish-card-extraicon-text"),c.text(h),N.layoutCtrl(l,0,0,16,16),N.layoutCtrl(c,21,0,60,16),r.append(l),r.append(c),r.on("click",k));return r};this.changeIcon=function(d){g=d;u.Icons.background(l,g)};this.changeName=
function(d){h=d;c.text(h)}}function oa(){ia.call(this);var a=this.protectedMethod,f=this,k,h=new B;this.protectedCustomContent=function(c){k=new ea;k.setSchemaLoadCallback(r);k.show(c)};this.protectedCustomHead=function(c){g()};this.protectedOpenSquare=function(){throw Error("override me");};this.protectedOpenAnalysis=function(){throw Error("override me");};this.protectedGetRefreshUrl=function(){throw Error("override me");};var g=function(){var c=$("<div class='sa-qing-publish-card-icon'>"),d=$("<div class='sa-qing-publish-card-icon'>"),
t=$("<div class = 'sa-qing-publish-card-icon'>"),w=$("<div class= 'sa-qing-publish-card-icon'>");d.on("click",function(){var v=a.getMainUi();k.checkOperatePermAndPrompt(v,ea.PERM_TYPE_ENTER_SQUARE)&&f.protectedOpenSquare()});u.Icons.background(d,"btn-edit");d.on("mouseover",function(v){u.Icons.background(d,"btn-edit-on")});d.on("mouseout",function(v){u.Icons.background(d,"btn-edit")});d.attr("title",x.get("squareIntoDesigner","\u8fdb\u5165\u8bbe\u8ba1\u5668\u4e2a\u6027\u5316\u4fee\u6539"));c.on("click",
function(){var v=a.getMainUi();k.checkOperatePermAndPrompt(v,ea.PERM_TYPE_ENTER_ANALYSIS)&&f.protectedOpenAnalysis()});u.Icons.background(c,"btn-analysis");c.on("mouseover",function(v){u.Icons.background(c,"btn-analysis-on")});c.on("mouseout",function(v){u.Icons.background(c,"btn-analysis")});c.attr("title",x.get("squareOpenAnalysis","\u6253\u5f00\u201c\u6570\u636e\u5206\u6790\u201d\u5de5\u5177"));t.on("click",l);u.Icons.background(t,"btn-refresh");t.on("mouseover",function(v){u.Icons.background(t,
"btn-refresh-on")});t.on("mouseout",function(v){u.Icons.background(t,"btn-refresh")});t.attr("title",x.get("cardRefresh","\u5237\u65b0"));w.on("click",function(){k.showExtraFilter(a.getMainUi())});u.Icons.background(w,"btn-filter");w.on("mouseover",function(v){u.Icons.background(w,"btn-filter-on")});w.on("mouseout",function(v){u.Icons.background(w,"btn-filter")});w.attr("title",x.get("cardFilter","\u8fc7\u6ee4\u6761\u4ef6"));w.hide();h.addIconUi(d);h.addIconUi(c);h.addIconUi(t);var z=h.getJqUi();
h.hide();$(document.body).on("mouseenter",function(){w.show();h.show()});$(document.body).on("mouseleave",function(){w.hide();h.hide()});a.appendOperateBtnUI([z,w])},r=function(){var c=new na;c.setDesc(k.getDescription());c.show(a.getMainUi(),a.getTitleUi())},l=function(){var c=f.protectedGetRefreshUrl();window.location.href=c};this.protectedMethod.reExcuteCard=l;this.protectedMethod.applyExternalFilter=function(c){k&&k.applyExternalFilter(c.getExternalFilterItem())};this.protectedMethod.setFilteringListener=
function(c){k&&k.setFilteringListener(c)}}function R(){ia.call(this);var a=this.protectedMethod,f;this.protectedCustomContent=function(g){f||(f=new ka,f.setSchemaLoadCallback(k),f.setDrawLegendCallback(function(){g.css("bottom","42px")}));f.show(g)};var k=function(){h()},h=function(){var g=new na;g.setDesc(f.getDescription());g.setShowOnlyMouseOn(!1);g.show(a.getMainUi(),a.getTitleUi());$(document.body).on("touchmove scroll",function(){g.hideTips()})};this.protectedMethod.getSquareExhibition=function(){return f}}
function la(){oa.call(this);var a=this.protectedMethod;this.protectedOpenSquare=function(){var f=a.getUrlParam("pageId");if(top.window.invokeCustomEvent){var k={tag:a.getUrlParam("tag"),cardName:a.getTitle()};top.window.invokeCustomEvent(f,"",["QingCard","openSquare",JSON.stringify(k)])}};this.protectedOpenAnalysis=function(){var f=a.getUrlParam("pageId");if(top.window.invokeCustomEvent){var k={tag:a.getUrlParam("tag"),cardName:a.getTitle()};top.window.invokeCustomEvent(f,"",["QingCard","openAnalysis",
JSON.stringify(k)])}};this.protectedGetRefreshUrl=function(){var f=a.getUrlParam("pageId"),k=a.getUrlParam("skin"),h=a.getUrlParam("language"),g=a.getTitle(),r=a.getUrlParam("schemaAdditionalTag"),l=a.getUrlParam("bizTag"),c=a.getUrlParam("path");c=a.appendAccountIdParam((c?c:"/ierp")+"/qing/cardEntrance.do");l&&(c=a.appendUrlParam(c,"publishId",l));r&&(c=a.appendUrlParam(c,"cardId",r));g&&(c=a.appendUrlParam(c,"cardName",g));f&&(c=a.appendUrlParam(c,"pageId",f));k&&(c=a.appendUrlParam(c,"skin",k));
h&&(c=a.appendUrlParam(c,"language",h));return c}}function ma(a,f,k,h){L.call(this,a,f,k,h);var g=this.protectedMethod;this.loadSquareSchema=function(r,l,c){g.remote("loadSquareSchema",{publishId:r,bizTag:l,schemaAdditionalTag:c})};this.loadSquareSchemaWithOper=function(r,l,c){g.remote("loadSquareSchemaWithOper",{publishId:r,bizTag:l,schemaAdditionalTag:c})};this.loadNocodeCardSchema=function(r){g.remote("loadNocodeCardSchema",{cardId:r})}}function B(){var a,f=[],k,h,g;this.setParent=function(d){g=
d};this.getJqUi=function(){a=$("<div class='sa-qing-publish-card-showmoreicon'>");a.on("click",r);u.Icons.background(a,"btn-more");a.on("mouseover",function(d){u.Icons.background(a,"btn-more-on")});a.on("mouseout",function(d){u.Icons.background(a,"btn-more")});a.attr("title",x.get("cardMoreOperate","\u66f4\u591a"));return a};this.addIconUi=function(d){f.push(d)};this.show=function(){a&&a.show()};this.hide=function(){a&&a.hide();l()};var r=function(){if(k)k.is(":hidden")?k&&(k.show(),h.show()):l();
else{k=$("<div class='sa-qing-publish-card-iconcontainer'>");for(var d=0,t=f.length;d<t;d++){var w=f[d];w.addClass("sa-qing-public-card-iconimplicit");k.append(w)}d=a.position().top;t=a.height();k.css({top:t+d+12+"px",right:0});g?k.appendTo(g):k.appendTo($(document.body));c();$(document.body).on("click",function(z){$(z.target).hasClass("sa-qing-publish-card-showmoreicon")||l()})}},l=function(){k&&(k.hide(),h.hide())},c=function(){var d=11*Math.pow(2,.5),t=a.position().left+a.width()/2,w=k.position(),
z=w.left,v=w.top,J=k.width();w=d/2;t=Math.min(t-d/2,z+J-d);h=$("<div class='sa-qing-public-card-container'>");z=v-(parseInt(9/Math.pow(2,.5))+1);h.css({width:d+"px",height:w+"px",top:z+"px",left:t+"px"});d=$("<div class='sa-qing-public-card-arrow'>");d.css({width:"9px",height:"9px",top:w-4.5-1+"px",left:"50%","margin-left":"-4.5px"});d.appendTo(h);g?h.appendTo(g):h.appendTo($(document.body))}}function Q(){F.call(this);var a;this.getRemoteUrl=function(f){return a};this.setRemoteUrl=function(f){a=f}}
function W(){com.kingdee.bos.qing.AbstractSquareIframeScene.call(this);var a=this,f=this.protectedMethod,k,h,g;this.setSchemaContent=function(d){k=d};this.setSchemaLoadCallback=function(d){g=d};this.applyExternalFilter=function(d){var t=f.copyFilters();if(t&&d)for(var w=d.getFieldName(),z=0;z<t.length;z++){var v=t[z];if(v.getAssociatedField().getText()==w){r(t,v,d);break}}};this.hasShowFilter=function(){try{var d=f.copyFilters()}catch(z){return!1}if(0==d.length)return!1;for(var t=!1,w=0;w<d.length;w++)if(d[w].isOnShow()){t=
!0;break}return t};var r=function(d,t,w){t.getPreparedModel()?l(d,t,w):f.updateFilterPreparedValue(d,t,function(z){z&&l(d,t,w)})},l=function(d,t,w){da.applyFilter(t,w);f.filtering(d)};this.protectedLoadingImpl=function(d){k?(d(k),g&&g()):c(function(){d(k);g&&g()})};this.protectedGetRemoteUrl=function(){var d=a.getUrlParam("path");return(d?d:"/ierp")+"/qing/core.do"};this.protectedShowErrorImpl=function(d,t,w,z){h||(h=new com.kingdee.bos.qing.scene.common.square.exhibition.CardErrorUi(d),h.setShowDetail(!0));
h.show(t,w,z);return!0};var c=function(d){a.protectedGetSchemaContent(function(t){k=t.schemaContentVo.schemaContent;d()},function(t,w,z){a.displayError(t,w,z)})};this.protectedGetSchemaContent=function(d,t){}}function ea(){W.call(this);var a=this,f,k,h,g;this.protectedImportMoreCode=function(r){r.loadSkinJs("linkage","skin");r.loadJs("linkage/linkage.js");r.loadSkinCss("linkage","linkage")};this.checkOperatePermAndPrompt=function(r,l){if(!g)return!0;var c=!0;if(l==ea.PERM_TYPE_ENTER_ANALYSIS){if(0!=
(g&1)){c=!1;var d=x.get("enterAnalysis","\u8fdb\u5165\u201c\u6570\u636e\u5206\u6790\u201d")}}else if(l==ea.PERM_TYPE_ENTER_SQUARE)0!=(g&128)&&(c=!1,d=x.get("enterEdit","\u8fdb\u5165\u8bbe\u8ba1\u5668"));else throw Error("unknown permType");c||(l=x.get("cardEditUnaccessable","\u60a8\u6ca1\u6709#1\u7684\u6743\u9650").replace("#1",d),a.displayActionPrompt(r,l));return c};this.protectedCustomInitEnv=function(){k=a.getUrlParam("bizTag");h=a.getUrlParam("schemaAdditionalTag");f=a.getUrlParam("publishId");
var r=a.getUrlParam("path");r=(r?r:"/ierp")+"/qing/linkage.do";var l=new com.kingdee.bos.qing.linkage.LinkageManage;l.setCurrentLinkageTag(a.getUrlParam("tag"));l.initRuntime(r,com.kingdee.bos.qing.integration.LinkageJumper.jump);r=com.kingdee.bos.qing.behavior.BehaviorManager;r.interestInBehaviorEntrance(r.ENTRANCE_CARD);com.kingdee.bos.qing.integration.ImglibUrlParser.hookUrlParser()};this.protectedGetSchemaContent=function(r,l){var c=new Q,d=a.getUrlParam("path");c.setRemoteUrl((d?d:"/ierp")+"/qing/card.do");
(new ma(c,function(t){g=t.operation["2"]|t.operation["1"];r(t)},l)).loadSquareSchemaWithOper(f,k,h)}}function ka(){com.kingdee.bos.qing.AbstractSquareIframeScene.call(this);var a=this,f=this.protectedMethod,k,h,g,r,l,c,d,t,w;this.protectedImportMoreCode=function(v){v.loadSkinJs("lightapp/common","skin");v.loadCss("lightapp/common/qing-lapp.css")};this.setDrawLegendCallback=function(v){d=v};this.setCloseFilterCallback=function(v){w&&w.setClosedListener(v)};this.hasFilter=function(){return w?w.hasFilters():
!1};this.getFilterUi=function(){return w&&w.hasFilters()?w.getJqUi():$("<div>")};this.updateFilterUi=function(){w&&w.updateUi()};this.protectedCustomInitEnv=function(){g=a.getUrlParam("path");r=a.getUrlParam("bizTag");l=a.getUrlParam("publishId");c=new Q;c.setRemoteUrl((g?g:"/ierp")+"/qing/card.do");var v=com.kingdee.bos.qing.behavior.BehaviorManager;v.interestInBehaviorEntrance(v.ENTRANCE_CARD)};this.protectedDrawCustomLegend=function(v,J){com.kingdee.bos.qing.chart.SquareConfig.COMBO_LEGEND_MODE=
!1;v!=com.kingdee.bos.qing.square.model.SquareModel.ChartType_GIS&&(v=(new com.kingdee.bos.qing.lapp.ui.LappSquareLegendRender).createLegendUi(v,J))&&(v.appendTo($(document.body)),d())};this.setSchemaLoadCallback=function(v){t=v};this.protectedLoadingImpl=function(v){h?(v(h),t&&t()):z(function(){v(h);t&&t();w||(w=new com.kingdee.bos.qing.lapp.ui.LappFilter(f.copyFilters,f.updateFilterPreparedValue,f.filtering))})};this.protectedGetRemoteUrl=function(){return(g?g:"/ierp")+"/qing/core.do"};this.protectedShowErrorImpl=
function(v,J,I,P){k||(k=new com.kingdee.bos.qing.scene.common.square.exhibition.CardErrorUi(v),k.setShowDetail(!0));k.show(J,I,P);return!0};var z=function(v){(new ma(c,function(J){h=J.schemaContent;v()},function(J,I,P){a.displayError(J,I,P)})).loadSquareSchema(l,r)}}function na(){var a,f,k,h,g,r=!0,l;this.setDesc=function(w){a=w};this.show=function(w,z){f=w;k=z;c()};this.hideTips=function(){h&&h.removeTips()};this.setShowOnlyMouseOn=function(w){r=w};var c=function(){d();l||(l=new com.kingdee.bos.qing.framework.common.WindowResizeObserver,
l.setDelay(100),l.setCallback(function(){d()}),l.observe())},d=function(){var w=function(){var z=k.width(),v=k.text();if(0==z)setTimeout(w,100);else{var J=k.height(),I=k.position(),P=I.top;I=I.left;v=t(v,k.css("font-size"));z=I+Math.min(z,v)+5;J=P+(J-16)/2;a&&(g||(h=new V,h.setIconType(V.ICON_TYPE_QUESTION),h.setContainer(f),h.setTipsText(a),g=h.getJqUi(),g.appendTo(f),r&&(g.hide(),$(document.body).on("mouseenter",function(){g.show()}),$(document.body).on("mouseleave",function(){g.hide()}))),g.css({position:"absolute",
left:z+"px",top:J+"px"}))}};w()},t=function(w,z){z||(z="12px");var v=$("<div>");v.css({position:"absolute","font-size":z,visibility:"hidden",height:"auto",width:"auto","white-space":"nowrap"});v.appendTo($(document.body));v.text(w);w=v.outerWidth();v.remove();return w}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.scene&&
(com.kingdee.bos.qing.scene={});"undefined"==typeof com.kingdee.bos.qing.scene.cardExhibition&&(com.kingdee.bos.qing.scene.cardExhibition={});var u=com.kingdee.bos.qing.scene.cardExhibition;u.DSBCardContainer=function(){ia.call(this);var a=this.protectedMethod,f;this.protectedCustomContent=function(h){if(!f){var g=a.getUrlParam("pageId"),r=a.getUrlParam("skin"),l=a.getUrlParam("language"),c=a.getUrlParam("publishId"),d=a.getUrlParam("path");d=(d?d:"/ierp")+"/qing/publishEntrance.do";c&&(d=a.appendUrlParam(d,
"publishId",c));g&&(d=a.appendUrlParam(d,"pageId",g));r&&(d=a.appendUrlParam(d,"skin",r));l&&(d=a.appendUrlParam(d,"language",l));d=com.kingdee.bos.qing.integration.PageHelper.getIframeUrl(d);f=$("<iframe>");f.css({position:"absolute",left:0,top:0,height:"100%",width:"100%",border:"none"});f.attr("allowfullscreen","true");f.attr("src",d)}f.appendTo(h)};this.protectedCustomHead=function(h){var g=$("<div class = 'sa-qing-publish-card-icon'>");g.css({position:"absolute",right:0,top:"5px"});g.on("click",
k);u.Icons.background(g,"btn-refresh");g.on("mouseover",function(r){u.Icons.background(g,"btn-refresh-on")});g.on("mouseout",function(r){u.Icons.background(g,"btn-refresh")});g.attr("title",x.get("cardRefresh","\u5237\u65b0"));$(document.body).on("mouseenter",function(){g.show()});$(document.body).on("mouseleave",function(){g.hide()});g.appendTo(h);g.hide()};var k=function(){var h=a.getUrlParam("pageId"),g=a.getUrlParam("skin"),r=a.getUrlParam("language"),l=a.getTitle(),c=a.getUrlParam("publishId"),
d=a.getUrlParam("path");d=a.appendAccountIdParam((d?d:"/ierp")+"/qing/cardEntrance.do");c&&(d=a.appendUrlParam(d,"publishId",c));l&&(d=a.appendUrlParam(d,"cardName",l));h&&(d=a.appendUrlParam(d,"pageId",h));g&&(d=a.appendUrlParam(d,"skin",g));r&&(d=a.appendUrlParam(d,"language",r));window.location.href=d}};u.RemoteImpl=Q;u.AbstractDesktopExhibition=W;u.IconContainer=B;u.CardFacade=ma;var L,F,x,N,S,V,T;(function(){var a=com.kingdee.bos.qing;T=a.Seer;a=com.kingdee.bos.qing.framework.common;L=a.AbstractFacade;
F=a.AbstractRemoteCall;x=a.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.scene);S=a.AbstractIcons;a=com.kingdee.bos.qing.ui.component;V=a.HelpIcon;a=com.kingdee.bos.qing.common;N=a.DomUtil})();u.CardContainerFactory=new function(){var a={};this.getCardContainer=function(f){return(f=a[f])?new f:new la};this.getCardErrContainer=function(){return new Z};this.regist=function(f,k){a[f]=k}};u.CardContainerFactory.regist("mobileCtrl_FullScreen",function(){R.call(this);var a=this.protectedMethod,
f,k,h,g,r;this.protectedCustomHead=function(I){f||(f=$("<div class='sa-qing-publish-card-icon'>"),f.on("click",l),u.Icons.background(f,"btn-back"),a.insertOperateBtnUI([f]));f.show();k||(k=$("<div class='sa-qing-publish-card-icon'>"),k.on("click",d),u.Icons.background(k,"btn-list"),a.appendOperateBtnUI([k]));k.show()};var l=function(){var I=a.getUrlParam("pageId");top.window.invokeCustomEvent&&top.window.invokeCustomEvent(I,"",["","closeView",JSON.stringify({})])},c=!1,d=function(){if(c)a.hideExtraOperateContainer(),
J(),c=!1;else{if(!h){var I=[];a.getSquareExhibition().hasFilter()&&(g=new U(x.get("lappFilter","\u8fc7\u6ee4"),"lapp-filter",v),I.push(g));h=new U(x.get("landscapeBtn","\u6a2a\u5c4f"),"btn-horizontal",w);I.push(h);a.insertExtraOperateBtn(I)}a.showExtraOperateContainer();c=!0}},t=!1,w=function(){if(t)try{var I=window.screen.orientation;I&&(I.lock("portrait-primary"),h&&(h.changeName(x.get("landscapeBtn","\u6a2a\u5c4f")),h.changeIcon("btn-horizontal")),$(window).trigger("resize"),t=!1)}catch(E){}else try{var P=
window.screen.orientation;P&&(P.lock("landscape-primary"),h.changeName(x.get("verticalScreenBtn"),"\u7ad6\u5c4f"),h.changeIcon("btn-vertical"),$(window).trigger("resize"),t=!0)}catch(E){}},z=!1,v=function(){if(z)J();else{g.changeIcon("lapp-filter-on");var I=a.getSquareExhibition().getFilterUi();r||(r=$("<div>"),r.append(I),r.appendTo(a.getContentUi()));I.show();N.layoutCtrlWithLRTB(r,0,0,null,0,44,null);a.getSquareExhibition().updateFilterUi();r.show();z=!0}},J=function(){r&&r.hide();g&&g.changeIcon("lapp-filter");
z=!1}});u.CardContainerFactory.regist("mobileCtrl",function(){R.call(this);var a=this.protectedMethod,f,k,h,g,r,l,c,d;this.protectedCustomHead=function(b){f=$("<div class = 'sa-qing-publish-card-icon'>");f.on("click",z);u.Icons.background(f,"btn-refresh");f.attr("title",x.get("cardRefresh","\u5237\u65b0"));k=$("<div class = 'sa-qing-publish-card-icon'>");k.on("click",t);u.Icons.background(k,"btn-fullscreen");k.attr("title",x.get("fullScreenBtn","\u5168\u5c4f"));a.appendOperateBtnUI([k,f])};var t=
function(){if(document.body.requestFullScreen||document.body.webkitRequestFullScreen||document.body.msRequestFullscreen||document.body.mozRequestFullScreen)d||(d=com.kingdee.bos.qing.common.FullScreenHelper,d.addChangedListener(w)),d.request(document.body);else{var b=a.getUrlParam("pageId");if(top.window.invokeCustomEvent){var e={tag:a.getUrlParam("tag"),ctrlName:a.getUrlParam("ctrlName"),ctrlRefId:a.getUrlParam("ctrlRefId"),hasCustomSchema:a.getUrlParam("hasCustomSchema")};top.window.invokeCustomEvent(b,
"",["","openFullScreenForm",JSON.stringify(e)])}}},w=function(b){null==b?v():b==document.body&&(a.getMainUi().css("top","44px"),f.hide(),k.hide(),h||(h=$("<div class='sa-qing-publish-card-icon'>"),h.on("click",v),u.Icons.background(h,"btn-back"),a.insertOperateBtnUI([h])),h.show(),g||(g=$("<div class='sa-qing-publish-card-icon'>"),g.on("click",I),u.Icons.background(g,"btn-list"),a.appendOperateBtnUI([g])),g.show())},z=function(){var b=a.getUrlParam("pageId"),e=a.getUrlParam("skin"),q=a.getUrlParam("language"),
y=a.getTitle(),G=a.getUrlParam("ctrlRefId"),p=a.getUrlParam("cardScene"),n=a.getUrlParam("ctrlName"),A=a.getUrlParam("hasCustomSchema"),C=a.getUrlParam("path");C=(C?C:"/ierp")+"/qing/devctrlCardEntrance.do";G&&(C=a.appendUrlParam(C,"ctrlRefId",G));y&&(C=a.appendUrlParam(C,"cardName",y));b&&(C=a.appendUrlParam(C,"pageId",b));e&&(C=a.appendUrlParam(C,"skin",e));q&&(C=a.appendUrlParam(C,"language",q));p&&(C=a.appendUrlParam(C,"cardScene",p));n&&(C=a.appendUrlParam(C,"ctrlName",n));A&&(C=a.appendUrlParam(C,
"hasCustomSchema",A));C=a.appendUrlParam(C,"mobileCtrl",!0);window.location.href=C},v=function(){f.show();k.show();g.hide();h.hide();a.hideExtraOperateContainer();X();d.exit();m();a.getMainUi().css("top","0px");J=P=aa=!1},J=!1,I=function(){if(J)a.hideExtraOperateContainer(),X(),J=!1;else{if(!r){var b=[];a.getSquareExhibition().hasFilter()&&(l=new U(x.get("lappFilter","\u8fc7\u6ee4"),"lapp-filter",O),b.push(l));r=new U(x.get("landscapeBtn","\u6a2a\u5c4f"),"btn-horizontal",E);b.push(r);a.insertExtraOperateBtn(b)}a.showExtraOperateContainer();
J=!0}},P=!1,E=function(){if(P)m();else try{var b=window.screen.orientation;b&&(b.lock("landscape-primary"),r.changeName(x.get("verticalScreenBtn"),"\u7ad6\u5c4f"),r.changeIcon("btn-vertical"),$(window).trigger("resize"),P=!0)}catch(e){}},m=function(){try{var b=window.screen.orientation;b&&(b.lock("portrait-primary"),r&&(r.changeName(x.get("landscapeBtn","\u6a2a\u5c4f")),r.changeIcon("btn-horizontal")),$(window).trigger("resize"),P=!1)}catch(e){}},aa=!1,O=function(){if(aa)X();else{l.changeIcon("lapp-filter-on");
var b=a.getSquareExhibition().getFilterUi();c||(c=$("<div>"),c.append(b),c.appendTo(a.getContentUi()));b.show();N.layoutCtrlWithLRTB(c,0,0,null,0,44,null);a.getSquareExhibition().updateFilterUi();c.show();aa=!0}},X=function(){c&&c.hide();l&&l.changeIcon("lapp-filter");aa=!1}});u.CardContainerFactory.regist("devctrl",function(){oa.call(this);var a=this.protectedMethod,f=this.protectedCustomContent;this.protectedCustomContent=function(l){f(l);com.kingdee.bos.qing.integration.CardCtrlMsgHandler.setCallback(r);
l=com.kingdee.bos.qing.msgbus.MsgBus;l.focus(l.MESSAGE_TYPE_FILTERACTION,k);l.focus(l.MESSAGE_TYPE_REFRESHACTION,h);a.setFilteringListener(g)};var k=function(l){a.applyExternalFilter(l)},h=function(l){a.reExcuteCard()},g=function(){var l=com.kingdee.bos.qing.msgbus.MsgBus,c=a.getUrlParam("parentPageId");l.sendMsg(c,"hello world",l.MESSAGE_TYPE_CUSTOMEVENT)};this.protectedOpenSquare=function(){var l=a.getUrlParam("pageId");if(top.window.invokeCustomEvent){var c={tag:a.getUrlParam("tag"),cardName:a.getUrlParam("cardName"),
formPageId:a.getUrlParam("formPageId"),publishId:a.getUrlParam("publishId"),schemaAdditionalTag:a.getUrlParam("schemaAdditionalTag"),bizTag:a.getUrlParam("bizTag"),hasMainView:a.getUrlParam("hasMainView")};top.window.invokeCustomEvent(l,"",["","openSquare",JSON.stringify(c)])}};this.protectedOpenAnalysis=function(){var l="true"==a.getUrlParam("hasMainView");var c=a.getUrlParam("path");c=(c?c:"/ierp")+"/qing/editAnalysisCardEntrance.do";var d=a.getUrlParam("skin"),t=a.getUrlParam("language"),w=a.getUrlParam("publishId"),
z=a.getUrlParam("bizTag"),v=a.getUrlParam("schemaAdditionalTag"),J=a.getUrlParam("cardScene"),I=a.getUrlParam("tag");w&&(c=a.appendUrlParam(c,"publishId",w));z&&(c=a.appendUrlParam(c,"bizTag",z));J&&(c=a.appendUrlParam(c,"cardScene",J));v&&(c=a.appendUrlParam(c,"schemaAdditionalTag",v));d&&(c=a.appendUrlParam(c,"skin",d));t&&(c=a.appendUrlParam(c,"language",t));I&&(c=a.appendUrlParam(c,"tag",I));top.window.invokeCustomEvent&&l?(l={tag:a.getUrlParam("tag"),cardName:a.getUrlParam("cardName"),bizTag:a.getUrlParam("bizTag"),
publishId:a.getUrlParam("publishId"),schemaAdditionalTag:a.getUrlParam("schemaAdditionalTag")},c=a.getUrlParam("pageId"),top.window.invokeCustomEvent(c,"",["","openAnalysis",JSON.stringify(l)])):window.open(c)};this.protectedGetRefreshUrl=function(){var l=a.getUrlParam("pageId"),c=a.getUrlParam("skin"),d=a.getUrlParam("language"),t=a.getTitle(),w=a.getUrlParam("schemaAdditionalTag"),z=a.getUrlParam("cardScene"),v=a.getUrlParam("hasMainView"),J=a.getUrlParam("ctrlRefId"),I=a.getUrlParam("ctrlName"),
P=a.getUrlParam("hasCustomSchema"),E=a.getUrlParam("parentPageId"),m=a.getUrlParam("path");m=(m?m:"/ierp")+"/qing/devctrlCardEntrance.do";J&&(m=a.appendUrlParam(m,"ctrlRefId",J));w&&(m=a.appendUrlParam(m,"schemaAdditionalTag",w));t&&(m=a.appendUrlParam(m,"cardName",t));l&&(m=a.appendUrlParam(m,"pageId",l));c&&(m=a.appendUrlParam(m,"skin",c));d&&(m=a.appendUrlParam(m,"language",d));z&&(m=a.appendUrlParam(m,"cardScene",z));v&&(m=a.appendUrlParam(m,"hasMainView",v));I&&(m=a.appendUrlParam(m,"ctrlName",
I));P&&(m=a.appendUrlParam(m,"hasCustomSchema",P));E&&(m=a.appendUrlParam(m,"parentPageId",E));return m};var r=function(l){(l=l.content)&&l.refreshCard&&a.reExcuteCard()}});ea.PERM_TYPE_ENTER_ANALYSIS="enter_analysis";ea.PERM_TYPE_ENTER_SQUARE="enter_square";u.Icons=new function(){S.call(this);var a=this.protectedMethod;this.protectedInit=function(k,h){k=com.kingdee.bos.qing.scene.cardExhibition.ComboIcon;if(!k)throw Error("com.kingdee.bos.qing.scene.cardExhibition.ComboIcon not found.");k.define(h,
"publish-resource-sprite");h.setStartPosition(1,1);h.setGap(1);h.setIconSize(16,16);f(0,0,"btn-analysis");f(1,0,"btn-analysis-on");f(0,1,"btn-edit");f(1,1,"btn-edit-on");f(0,2,"btn-filter");f(1,2,"btn-filter-on");f(0,3,"btn-refresh");f(1,3,"btn-refresh-on");f(0,4,"btn-more");f(1,4,"btn-more-on");f(2,0,"btn-list");f(3,0,"btn-list-on");f(2,1,"lapp-filter");f(3,1,"lapp-filter-on");f(2,2,"btn-horizontal");f(3,2,"btn-vertical");f(2,3,"btn-fullscreen");f(3,3,"btn-back")};var f=function(k,h,g){a.registIcon(k,
h,g)}};var da=new function(){this.applyFilter=function(a,f){var k=com.kingdee.bos.qing.msgbus.ExternalFilterItem,h=f.getFilterType();if(k.FILTER_TYPE_DISCRETE==h){if(a instanceof com.kingdee.bos.qing.core.model.DiscreteFilter)for(k=a.getPreparedModel().getItems(),f=f.getValues(),h=0;h<k.length;h++)for(var g=0;g<f.length;g++){var r=f[g],l=k[h];l.getValue()==r?a.addSelectedValue(r):a.removeSelectedValue(l.getValue())}}else k.FILTER_TYPE_DATERANGE==h?a instanceof com.kingdee.bos.qing.core.model.ContinuousDateFilter&&
(h=a.getPreparedModel(),k=h.getFromDateMs(),g=h.getToDateMs(),h=f.getStartDate(),f=f.getEndDate(),f=0==f&&g?g:f,a.setFromDateMs(0==h&&k?k:h),a.setToDateMs(f)):k.FILTER_TYPE_CONTINUOUS==h&&(h=a.getPreparedModel(),k=f.getFloor(),f=f.getCeiling(),g=h.getMin(),h=h.getMax(),a.setValue(k?k:g,f?f:h))}};u.ExternalFilterHelper=da})();(function(){function Z(){var u,L,F,x,N=[],S,V,T,da=R.decodeParamFromUrl(location.search,"cardScene"),a=R.decodeParamFromUrl(location.search,"cardTag"),f=!1,k=!1,h=!1,g;window.addEventListener("message",function(E){if(E=E.data){var m=E.methodName;if(E.cardId==V)switch(m){case "updateTitle":F.text(E.title);break;default:console.log("undefined msg methodName:"+m)}}});this.initUi=function(E){if(!u){V=J("cardId");u=$("<div>");u.addClass("qing-noceode-card-main");L=$("<div>");L.addClass("qing-noceode-card-head");
L.appendTo(u);T=J("cardName");F=$("<div>");F.addClass("qing-noceode-card-title");F.text(T);F.attr("title",T);F.appendTo(L);var m=$("<div tabIndex=-1 style='outline: none;'>");m.css({width:"20px","float":"left",height:"40px",left:"15px",position:"relative"});m.appendTo($(document.body));m.on("mousedown",P);m.on("mouseup",P);m.on("keydown",P);m.on("keyup",P);x=$("<div>");x.addClass("qing-noceode-card-content");x.appendTo(u)}u.appendTo(E)};this.showContent=function(){l();x.empty();g=new ia;g.show(x);
setInterval(function(){localStorage.getItem("refreshData_"+a)&&(w(),localStorage.removeItem("refreshData_"+a))},1200)};this.showError=function(E,m,aa){l(E);x.empty();var O=new com.kingdee.bos.qing.scene.common.square.exhibition.CardErrorUi(x);O.setShowErrorDetailListener(r);O.setShowDetail(!0);O.show(E,m,aa)};var r=function(E,m,aa){m=$("<div>");m.addClass("qing-noceode-error-detail-container");var O=$("<div>");O.text(Q.get("errorCode","\u9519\u8bef\u7801\uff1a")+E);E=$("<div>");E.addClass("qing-noceode-error-detail-content");
E.text(aa);O.appendTo(m);E.appendTo(m);m.appendTo(x)};this.getContentContainer=function(){return x};var l=function(E){var m;if(m=E)if(m=!1,E=""+E,"3010001"==E||"3010002"==E||"3010003"==E||"3010004"==E)m=!0;m?c(!1):da&&da===Z.NO_PERM_SCENE?c(!1):c(!0)},c=function(E){var m=$("<div>");m.addClass("qing-nocode-card-icon-container");m.appendTo(L);t(m,Q.get("refreshChart","\u5237\u65b0\u56fe\u8868"),"nocodecard-icon-refresh",w);E&&(t(m,Q.get("editChart","\u7f16\u8f91\u56fe\u8868"),"nocodecard-icon-edit",
z),S=t(m,Q.get("filter","\u8fc7\u6ee4"),"nocodecard-icon-filter",v),t(m,Q.get("delete","\u5220\u9664"),"nocodecard-icon-delete",I));$(document.body).on("mouseenter",function(){d(!0)});$(document.body).on("mouseleave",function(){d(!1)})},d=function(E){for(var m=0,aa=0;aa<N.length;aa++){var O=N[aa];E?O==S?g&&g.hasShowFilter()&&(O.show(),m++):(O.show(),m++):O.hide()}E&&0<m?F.css("width","calc(100% - "+(28*m-12)+"px)"):F.css("width","100%")},t=function(E,m,aa,O){var X=$("<span>");X.addClass("qing-nocode-card-icon");
X.addClass(aa);X.addClass("qing-nocode-card-icon-normal");X.attr("title",m);X.on("click",O);X.hide();E.append(X);N.push(X);return X},w=function(){var E=J("path");E=R.appendParamToUrl((E?E:"/ierp")+"/qing/qingNoCodeCardEntrance.do","cardName",T);E=R.appendParamToUrl(E,"cardId",V);da&&(E=R.appendParamToUrl(E,"cardScene",da));var m=J("tag");m&&(E=R.appendParamToUrl(E,"tag",m));E=R.appendParamToUrl(E,"cardTag",a);E=com.kingdee.bos.qing.integration.PageHelper.getIframeUrl(E);window.location.href=E},z=
function(){top.window.postMessage({methodName:"openSettingDialog",cardId:V},"*")},v=function(){g.showExtraFilter(u)},J=function(E){return R.decodeParamFromUrl(location.search,E)},I=function(){top.window.postMessage({methodName:"deleteCard",cardId:V},"*")},P=function(E){var m=E.type;E=E.keyCode;m&&"mousedown"===m&&(k=!0);m&&"mouseup"===m&&(k=!1);m&&E&&"keydown"===m&&"17"==E&&(f=!0);m&&E&&"keyup"===m&&"17"==E&&(f=!1);m&&E&&"keydown"===m&&"16"==E&&(h=!0);m&&E&&"keyup"===m&&"16"==E&&(h=!1);f&&k&&h&&(m=
J("path"),m=R.appendParamToUrl((m?m:"/ierp")+"/qing/nocodecardDesignerEntrance.do","cardId",V),m=R.appendParamToUrl(m,"cardName","\u65e0\u4ee3\u7801\u5361\u7247\u6d4b\u8bd5"),m=R.appendParamToUrl(m,"cardClientId",W.getClientID()),m=R.appendParamToUrl(m,"cardTag",a),m=com.kingdee.bos.qing.integration.PageHelper.getIframeUrl(m),window.open(m,"\u7edf\u8ba1\u5361\u7247-\u6597\u65b9\u8bbe\u8ba1\u5668"),m={methodName:"openQingCardDesigner",cardId:V,cardName:T,tag:J("tag"),cardClientId:W.getClientID(),cardTag:a},
top.window.postMessage(m,"*"),h=k=f=!1)}}function ia(){ea.call(this);var u=this;this.protectedImportMoreCode=function(L){};this.protectedCustomInitEnv=function(){};this.protectedGetSchemaContent=function(L,F){var x=u.getUrlParam("path"),N=u.getUrlParam("cardId"),S=new ka;S.setRemoteUrl((x?x:"/ierp")+"/qing/nocodeCard.do");(new U(S,L,F)).loadNocodeCardSchema(N)}}function U(u,L,F,x){B.call(this,u,L,F,x);var N=this.protectedMethod;this.loadNocodeCardSchema=function(S){N.remote("loadNocodeCardSchema",
{cardId:S})};this.checkNocodeCardPerm=function(S){N.remote("checkNocodeCardPerm",{cardId:S})};this.loadNocodeCardSchemaForDesigner=function(S,V,T){N.remote("loadNocodeCardSchemaForDesigner",{cardId:S,paramCacheId:V,tag:T})};this.saveNocodeCardSchema=function(S,V,T){S={cardId:S,model:JSON.stringify(V.toJsonObject()),tag:T};N.remote("saveNocodeCardSchema",S)}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});
"undefined"==typeof com.kingdee.bos.qing&&(com.kingdee.bos.qing={});"undefined"==typeof com.kingdee.bos.qing.scene&&(com.kingdee.bos.qing.scene={});"undefined"==typeof com.kingdee.bos.qing.scene.nocode&&(com.kingdee.bos.qing.scene.nocode={});var oa=com.kingdee.bos.qing.scene.nocode;oa.NocodeCardContainer=Z;oa.NocodecardDesignerScene=function(){na.call(this);var u=this.protectedMethod,L,F,x,N,S=new ma;window.addEventListener("message",function(c){c=c.data;"refreshData"==c.methodName?(x=c.filterCacheId,
a()):"notificationCardRefresh"==c.methodName&&l()});var V=this.protectedImportMoreCode;this.protectedImportMoreCode=function(c){V(c);u.importForMap(c);c.pushJs("qhf/qing-qhf.js")};var T=this.protectedCustomInitEnv;this.protectedCustomInitEnv=function(c){u.setModuleWithSquare(!0,!1);T(c);la.setFullScreenPadding(0,45,0,0);var d=g();L=u.getUrlParamUtil().getUrlParam("cardId");F=u.getUrlParamUtil().getUrlParam("tag");u.registMapMapLibrary(d);S.getJqUi().appendTo($(document.body));r();c();c=$(".sa-main");
c.css("top","50px");c.css("bottom","0px");c.css("height","unset");d=$("<div>");d.css({position:"relative",top:"15px","font-size":"25px","text-align":"center"});d.text("\u65e0\u4ee3\u7801\u7684\u540c\u5b66\uff0c\u8bf7\u5c3d\u5feb\u5b9e\u73b0\u54e6\uff01");d.insertAfter(c)};this.protectedInitDesignerForSquare=function(c){c.getConductor().hideBriefOutput();da(c);u.hookCloseTab(c);u.hookSetCurrentTabStatus(c)};var da=function(c){var d=u.getMLS("refresh","\u6570\u636e\u66f4\u65b0");return c.getConductor().appendToolbarButton(function(){a()},
"btn_reset",d)},a=function(){oExtractData=com.kingdee.bos.qing.prepare.NocodeCardDesignerDataExtractor;oExtractData.setParamCacheId(x);oExtractData.setFirstFromCache(!1);oExtractData.setExtractDataFinishedSuccessCallback(function(c){x=null;c?u.reloadMeta(function(d){if(N){var t=N.getJsonModelBook();N.prepareMeta(d);N.setJsonModelBook(t)}(d=u.getCurrentVisibleDesigner())&&d.reExecute()}):(c=u.getCurrentVisibleDesigner())&&c.reExecute()});oExtractData.restart()};this.protectedLoadingSquare=function(c,
d,t){N=d;u.loadMeta(c,function(w){d.prepareMeta(w);d.getConductor().insertToolbarButton(function(z){k()},"btn_finish",Q.get("finish","\u5b8c\u6210"));d.getConductor().insertToolbarSeperator();f()})};var f=function(){var c=h();(new U(c,function(d){N.setJsonModelBook(d.schemaContentVo.schemaContent,function(t){});N.getConductor().clearDirty()},function(d,t,w){return!1})).loadNocodeCardSchemaForDesigner(L,x,F)},k=function(){var c=h(),d=new com.kingdee.bos.qing.schemamanage.model.SchemaModel;d.setSchemaContent(N.getJsonModelBook());
var t=new com.kingdee.bos.qing.schemamanage.model.SchemaAttrModel;d.setSchemaAttr(t);(new U(c,function(w){w&&(L=w,top.window.postMessage({methodName:"qingCardSaveSuccess",cardId:L},"*"),l(),S.showSuccess(Q.get("saveSuccess","\u4fdd\u5b58\u6210\u529f\u3002")),N.getConductor().clearDirty())})).saveNocodeCardSchema(L,d,F)},h=function(){var c=new ka,d=g()+"/qing/nocodeCard.do";c.setRemoteUrl(d);return c},g=function(){var c=u.getUrlParamUtil().getParamPathPrefix();return c?c:"/ierp"},r=function(){com.kingdee.bos.qing.qhf.QHFSceneExporterRegister.register(F,
function(){var c=com.kingdee.bos.qing.qhf.QHFExporter.SCENE_TYPE_EMBEDDED_LONGER_SQUARE,d=_oLongerDesigner?_oLongerDesigner.getJsonModelBook():null,t=N?N.getJsonModelBook():null;return{bizTag:void 0,squareInitSchemaContext:null,longerFinalSchemaContext:d?JSON.stringify(d):null,squareFinalSchemaContext:t?JSON.stringify(t):null,sceneType:c}})},l=function(){var c=u.getUrlParamUtil().getUrlParam("cardTag");localStorage.setItem("refreshData_"+c,!0)}};var R,la,ma,B,Q,W,ea,ka,na;(function(){var u=com.kingdee.bos.qing.common;
R=u.Util;u=com.kingdee.bos.qing.ui.component;la=u.Dialog;ma=u.MessageCurtain;u=com.kingdee.bos.qing.framework.common;B=u.AbstractFacade;Q=u.MultilanguageManager.createPackageAccessor(com.kingdee.bos.qing.scene);W=u.RemoteFramework;u=com.kingdee.bos.qing.scene.cardExhibition;ea=u.AbstractDesktopExhibition;ka=u.RemoteImpl;u=com.kingdee.bos.qing.scene.common.designer;na=u.AbstractDesignerSceneImpl})();Z.HOME_SCENE="home";Z.NO_PERM_SCENE="noPerm"})();
//qingVersionTag: 20250324