var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.owns=function(Ca,sa){return Object.prototype.hasOwnProperty.call(Ca,sa)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(Ca,sa,Fa){if(Ca==Array.prototype||Ca==Object.prototype)return Ca;Ca[sa]=Fa.value;return Ca};$jscomp.getGlobal=function(Ca){Ca=["object"==typeof globalThis&&globalThis,Ca,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var sa=0;sa<Ca.length;++sa){var Fa=Ca[sa];if(Fa&&Fa.Math==Math)return Fa}throw Error("Cannot find global object");};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(Ca,sa){var Fa=$jscomp.propertyToPolyfillSymbol[sa];if(null==Fa)return Ca[sa];Fa=Ca[Fa];return void 0!==Fa?Fa:Ca[sa]};
$jscomp.polyfill=function(Ca,sa,Fa,Sa){sa&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(Ca,sa,Fa,Sa):$jscomp.polyfillUnisolated(Ca,sa,Fa,Sa))};$jscomp.polyfillUnisolated=function(Ca,sa,Fa,Sa){Fa=$jscomp.global;Ca=Ca.split(".");for(Sa=0;Sa<Ca.length-1;Sa++){var Oa=Ca[Sa];if(!(Oa in Fa))return;Fa=Fa[Oa]}Ca=Ca[Ca.length-1];Sa=Fa[Ca];sa=sa(Sa);sa!=Sa&&null!=sa&&$jscomp.defineProperty(Fa,Ca,{configurable:!0,writable:!0,value:sa})};
$jscomp.polyfillIsolated=function(Ca,sa,Fa,Sa){var Oa=Ca.split(".");Ca=1===Oa.length;Sa=Oa[0];Sa=!Ca&&Sa in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var Za=0;Za<Oa.length-1;Za++){var gb=Oa[Za];if(!(gb in Sa))return;Sa=Sa[gb]}Oa=Oa[Oa.length-1];Fa=$jscomp.IS_SYMBOL_NATIVE&&"es6"===Fa?Sa[Oa]:null;sa=sa(Fa);null!=sa&&(Ca?$jscomp.defineProperty($jscomp.polyfills,Oa,{configurable:!0,writable:!0,value:sa}):sa!==Fa&&(void 0===$jscomp.propertyToPolyfillSymbol[Oa]&&(Fa=1E9*Math.random()>>>0,
$jscomp.propertyToPolyfillSymbol[Oa]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(Oa):$jscomp.POLYFILL_PREFIX+Fa+"$"+Oa),$jscomp.defineProperty(Sa,$jscomp.propertyToPolyfillSymbol[Oa],{configurable:!0,writable:!0,value:sa})))};$jscomp.polyfill("Object.values",function(Ca){return Ca?Ca:function(sa){var Fa=[],Sa;for(Sa in sa)$jscomp.owns(sa,Sa)&&Fa.push(sa[Sa]);return Fa}},"es8","es3");
$jscomp.polyfill("Array.prototype.fill",function(Ca){return Ca?Ca:function(sa,Fa,Sa){var Oa=this.length||0;0>Fa&&(Fa=Math.max(0,Oa+Fa));if(null==Sa||Sa>Oa)Sa=Oa;Sa=Number(Sa);0>Sa&&(Sa=Math.max(0,Oa+Sa));for(Fa=Number(Fa||0);Fa<Sa;Fa++)this[Fa]=sa;return this}},"es6","es3");$jscomp.typedArrayFill=function(Ca){return Ca?Ca:Array.prototype.fill};$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.findInternal=function(Ca,sa,Fa){Ca instanceof String&&(Ca=String(Ca));for(var Sa=Ca.length,Oa=0;Oa<Sa;Oa++){var Za=Ca[Oa];if(sa.call(Fa,Za,Oa,Ca))return{i:Oa,v:Za}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(Ca){return Ca?Ca:function(sa,Fa){return $jscomp.findInternal(this,sa,Fa).v}},"es6","es3");
$jscomp.polyfill("Object.is",function(Ca){return Ca?Ca:function(sa,Fa){return sa===Fa?0!==sa||1/sa===1/Fa:sa!==sa&&Fa!==Fa}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(Ca){return Ca?Ca:function(sa,Fa){var Sa=this;Sa instanceof String&&(Sa=String(Sa));var Oa=Sa.length;Fa=Fa||0;for(0>Fa&&(Fa=Math.max(Fa+Oa,0));Fa<Oa;Fa++){var Za=Sa[Fa];if(Za===sa||Object.is(Za,sa))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(Ca,sa,Fa){if(null==Ca)throw new TypeError("The 'this' value for String.prototype."+Fa+" must not be null or undefined");if(sa instanceof RegExp)throw new TypeError("First argument to String.prototype."+Fa+" must not be a regular expression");return Ca+""};$jscomp.polyfill("String.prototype.includes",function(Ca){return Ca?Ca:function(sa,Fa){return-1!==$jscomp.checkStringArgs(this,sa,"includes").indexOf(sa,Fa||0)}},"es6","es3");
$jscomp.polyfill("String.prototype.startsWith",function(Ca){return Ca?Ca:function(sa,Fa){var Sa=$jscomp.checkStringArgs(this,sa,"startsWith");sa+="";var Oa=Sa.length,Za=sa.length;Fa=Math.max(0,Math.min(Fa|0,Sa.length));for(var gb=0;gb<Za&&Fa<Oa;)if(Sa[Fa++]!=sa[gb++])return!1;return gb>=Za}},"es6","es3");$jscomp.arrayIteratorImpl=function(Ca){var sa=0;return function(){return sa<Ca.length?{done:!1,value:Ca[sa++]}:{done:!0}}};$jscomp.arrayIterator=function(Ca){return{next:$jscomp.arrayIteratorImpl(Ca)}};
$jscomp.initSymbol=function(){};$jscomp.polyfill("Symbol",function(Ca){if(Ca)return Ca;var sa=function(Za,gb){this.$jscomp$symbol$id_=Za;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:gb})};sa.prototype.toString=function(){return this.$jscomp$symbol$id_};var Fa="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",Sa=0,Oa=function(Za){if(this instanceof Oa)throw new TypeError("Symbol is not a constructor");return new sa(Fa+(Za||"")+"_"+Sa++,Za)};return Oa},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(Ca){if(Ca)return Ca;Ca=Symbol("Symbol.iterator");for(var sa="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Fa=0;Fa<sa.length;Fa++){var Sa=$jscomp.global[sa[Fa]];"function"===typeof Sa&&"function"!=typeof Sa.prototype[Ca]&&$jscomp.defineProperty(Sa.prototype,Ca,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return Ca},
"es6","es3");$jscomp.iteratorPrototype=function(Ca){Ca={next:Ca};Ca[Symbol.iterator]=function(){return this};return Ca};$jscomp.iteratorFromArray=function(Ca,sa){Ca instanceof String&&(Ca+="");var Fa=0,Sa=!1,Oa={next:function(){if(!Sa&&Fa<Ca.length){var Za=Fa++;return{value:sa(Za,Ca[Za]),done:!1}}Sa=!0;return{done:!0,value:void 0}}};Oa[Symbol.iterator]=function(){return Oa};return Oa};
$jscomp.polyfill("Array.prototype.keys",function(Ca){return Ca?Ca:function(){return $jscomp.iteratorFromArray(this,function(sa){return sa})}},"es6","es3");
(function(){function Ca(Oa,Za,gb,mb){sa.call(this,Oa,Za,gb,mb);var ya=this.protectedMethod;this.getGenericMaxColNumber=function(){ya.remote("getGenericMaxColNumber",{})};this.getUserSqlField=function(jb,yb,Na,fb,Xa){ya.remote("getUserSqlField",{dataSetType:jb,dataSource:yb,dataSourceType:Na,sqlType:fb,sqlContent:Xa})};this.checkGenericSourceRunnable=function(jb){jb={source:JSON.stringify(jb.toJsonObject())};ya.remote("checkGenericSourceRunnable",jb)}}"undefined"==typeof com&&(com={});"undefined"==
typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.extreport&&(com.kingdee.bos.extreport={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner&&(com.kingdee.bos.extreport.datasetdesigner={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner.wizard&&(com.kingdee.bos.extreport.datasetdesigner.wizard={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner.wizard.common&&(com.kingdee.bos.extreport.datasetdesigner.wizard.common=
{});com.kingdee.bos.extreport.datasetdesigner.wizard.common.GenericFacade=Ca;var sa,Fa,Sa;(function(){var Oa=com.kingdee.bos.qing.framework.common;sa=Oa.AbstractFacade;Oa=com.kingdee.bos.extreport.datasetdesigner.common;Fa=Oa.FacadeType;Sa=Oa.FacadeFactory})();Sa.addFacade(Fa.Generic,Ca)})();(function(){function Ca(k){var c=this,b,a,e,d=r.SQL;this.genUniqueName=function(q){if(b)return b;for(var l="GenericSQL"+(new Date).getTime();g(q,l);)l="GenericSQL"+(new Date).getTime();return b=l};var g=function(q,l){if(-1!=q.indexOf(l)||-1!=q.indexOf(l.toLowerCase())||-1!=q.indexOf(l.toUpperCase()))return!0;q=m();for(var V=0;V<q.length;V++){var G=q[V];if(G!=c&&G.getName()==l)return!0}return!1},m=function(){var q=[];k.getModel().getSources().forEach(function(l){X.isSupportUserSql(l)&&q.concat(l.getUserSqls())});
return q};this.isUsing=function(){return 0!=c.getUsingTables().length};this.getUsingTables=function(){var q=[];k.getModel().getTables().forEach(function(l){-1!=l.getUsingSourceIds().indexOf(k.getId())&&(l.isUnionTable()?l.getSubTables().forEach(function(V){V.getName()==c.getName()&&q.push(V)}):l.getName()==c.getName()&&q.push(l))});return q};this.getDataSource=function(){return k};this.getName=function(){return b};this.setName=function(q){c.getDataSource().getModel().setDirty(b!==q);b=q};this.getAlias=
function(){return a};this.setAlias=function(q){c.getDataSource().getModel().setDirty(a!==q);a=q};this.getContent=function(){return e};this.setContent=function(q){c.getDataSource().getModel().setDirty(e!==q);e=q};this.getType=function(){return d};this.setType=function(q){d=q};this.toJsonObject=function(){var q={};q.name=b;q.alias=a;q.content=e;q.type=d;return q};this.fromJsonObject=function(q){b=q.name;a=q.alias;e=q.content;d=q.type}}function sa(){this.isEmpty=function(){throw Error("override me");
}}function Fa(){this.getAllColumns=function(){throw Error("override me");};this.getCalcCols=function(){throw Error("override me");};this.getFilters=function(){throw Error("override me");};this.getOrders=function(){throw Error("override me");};this.deleteColumn=function(k){throw Error("override me");};this.getColsJsons=function(){throw Error("override me");}}function Sa(k){sa.call(this);qb.call(this,k);lb.call(this);var c=this,b,a,e,d=[];this.init=function(g,m){e=g;a=m};this.check=function(){return c.getException($a.DATA_SOURCE)};
this.getId=function(){return b};this.isUsing=function(){return c.getModel().getTables().some(function(g){return g.getUsingSourceIds().some(function(m){return m==b})})};this.delUseless=function(){if(c.isMultipleType()){var g=Object.values(c.fetchRelatedSourceMap()),m=g.length;g.forEach(function(q){if(q.getName()&&!q.isUsing()&&0==q.getUserSqls().length&&1!=m){var l=c.getModel().getSources();l.splice(l.indexOf(q),1);m--}})}};this.checkDeletable=function(){for(var g=c.getModel().getTables(),m=c.fetchRelatedSourceMap(),
q=[],l=0;l<g.length;l++)for(var V=g[l],G=V.getUsingSourceIds(),pa=0;pa<G.length;pa++)m[G[pa]]&&q.push(V);if(0==q.length)q=null;else if(4>q.length){g="";for(m=0;m<q.length;m++)g+=Ia.get("leftQuotation","\u201c")+q[m].getAlias()+Ia.get("rightQuotation","\u201d"),m!=q.length-1&&(g+=Ia.get("comma","\uff0c"));q=Ia.get("delTable1","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u901a\u7528\u67e5\u8be2\u6570\u636e\u96c6\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u201c\u8fde\u63a5\u201d\u533a\u57df\u5220\u9664\u8be5\u6570\u636e\u6e90\u4e0b\u7684\u6570\u636e\u8868#1\u3002").replace("#1",
g)}else q=Ia.get("delTable2","\u8be5\u6570\u636e\u6e90\u5df2\u88ab\u901a\u7528\u67e5\u8be2\u6570\u636e\u96c6\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u201c\u8fde\u63a5\u201d\u533a\u57df\u5220\u9664\u8be5\u6570\u636e\u6e90\u4e0b\u7684\u201c#1\u201d\uff0c\u201c#2\u201d\uff0c\u201c#3\u201d\u7b49#4\u4e2a\u6570\u636e\u8868\u3002").replace("#1",q[0].getAlias()).replace("#2",q[1].getAlias()).replace("#3",q[2].getAlias()).replace("#4",q.length);return q};this.isMultipleType=function(){return!(c.getDataSourceType()==
X.OUT_DB||c.getDataSourceType()==X.USER_SUPER_QUERY)};this.getIdentifier=function(){return c.isMultipleType()?c.getDataSourceType():c.getName()};this.fetchRelatedSourceMap=function(){for(var g={},m=c.getModel().getSources(),q=0;q<m.length;q++){var l=m[q];c.checkSourceEquality(l)&&(g[l.getId()]=l)}return g};this.checkSourceEquality=function(g){return g.getDataSourceType()!=c.getDataSourceType()?!1:g.getIdentifier()==c.getIdentifier()};this.setId=function(g){c.getModel().setDirty(b!==g);b=g};this.getName=
function(){return a};this.setName=function(g){c.getModel().setDirty(a!==g);a=g};this.getDataSourceType=function(){return e};this.setDataSourceType=function(g){c.getModel().setDirty(e!==g);e=g};this.getSourceIdOfTable=function(g){return X.containTableSourceName(e)?a:g.getName()};this.getUserSqls=function(){return d};this.addUserSql=function(g){c.getModel().setDirty(!0);d.push(g)};this.delUserSqlByName=function(g){for(var m=0;m<d.length;m++)if(d[m].getName()==g){d.splice(m,1);break}};this.getUserSqlByName=
function(g){for(var m=0;m<d.length;m++)if(d[m].getName()==g)return d[m];return null};this.setUserSqls=function(g){c.getModel().setDirty(d!==g);d=g};this.isEmpty=function(){return!b&&!a&&!e&&0===d.length};this.toJsonObject=function(){var g={};g.id=b;g.name=a;g.dataSourceType=e;if(d){for(var m=[],q=0;q<d.length;q++)m.push(d[q].toJsonObject());g.userSqls=m}return g};this.getDisplayName=function(){return X.OUT_DB==e||X.USER_SUPER_QUERY==e?a:X.typeToDisplayName(e)};this.fromJsonObject=function(g,m){b=
g.id;a=g.name;e=g.dataSourceType;c.addExceptionFromMapCheckResult(m,$a.DATA_SOURCE,b);if(g=g.userSqls)for(m=0;m<g.length;m++){var q=g[m],l=new Ca(c);l.fromJsonObject(q);d.push(l)}}}function Oa(k){sa.call(this);Fa.call(this);qb.call(this,k);lb.call(this);var c=this,b,a,e,d,g,m,q,l=[],V=[],G=[],pa=[],ma=[],Aa=Oa.BASE_WIDTH,Pa;this.check=function(){var f=c.getSourceOrTableException();if(f)return f;f=Ia.get("resetErrorProp","\u5c5e\u6027\u5b58\u5728\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u3002");
c.removeException($a.GENERIC_CLIENT_ORDER_ERROR,b);c.removeException($a.GENERIC_CLIENT_FILTER_ERROR,b);c.removeException($a.GENERIC_CLIENT_UNION_ERROR,b);for(var Q=0;Q<pa.length;Q++){var y=pa[Q];if(y.check())return y.hasClientExp()&&c.addException($a.GENERIC_CLIENT_FILTER_ERROR,b,f),f}for(Q=0;Q<ma.length;Q++)if(y=ma[Q],y.check())return y.hasClientExp()&&c.addException($a.GENERIC_CLIENT_FILTER_ERROR,b,f),f;if(c.checkUnionConfig())return c.addException($a.GENERIC_CLIENT_UNION_ERROR,b,f),f;for(Q=0;Q<
G.length;Q++)if(G[Q].check())return f;return null};this.checkUnionConfig=function(){if(!c.isUnionTable())return!1;var f=c.getUnionFieldHelper(),Q=f.getHeadWrapper();return Q.getArrTable().length!=c.getSubTables().length?!0:c.getSubTables().some(function(y){if(y.getSourceOrTableException()||Q.isSubTableDeleted(y))return!0;var ra=y.getColumns();y=f.collectUnionFieldByTable(y);for(var Ka=0;Ka<ra.length;Ka++){var Wa=ra[Ka],ib=y.indexOf(Wa);-1!=ib&&y.splice(ib,1);if(Wa.getException())return!0}return 0!=
y.length})};this.checkUnionFieldConfig=function(f){if(!c.isUnionTable())return!1;for(var Q=c.getUnionFieldHelper().getRowWrappers(),y=0;y<Q.length;y++){var ra=Q[y];if(ra.getBenchmark().getName()==f.getName()){f=ra.getArrGenericCols();for(Q=0;Q<f.length;Q++)if(y=f[Q])return y.getException()||-1==y.getSourceTable().getColumns().indexOf(y);break}}return!1};this.getKey=function(){return Oa.KEY_TABLE};this.isUnionTable=function(){return 0!=c.getSubTables().length};this.getUnionFieldHelper=function(){return Pa};
this.setUnionFieldHelper=function(f){Pa=f};this.syncUnionFieldHelper=function(){Pa=c.isUnionTable()?ea.build(this):null};this.getWidth=function(){return Aa};this.setWidth=function(f){Aa=f};this.getHeight=function(){return Oa.BASE_HEIGHT*(l.length+1)};this.setHeight=function(f){};this.setPosition=function(f,Q){m=f;q=Q};this.getShowText=function(){return d?d:a};this.getDisplayText=function(){return d+"("+a+")"};this.getId=function(){return b};this.setId=function(f){c.getModel().setDirty(b!==f);b=f};
this.getName=function(){return a};this.setName=function(f){c.getModel().setDirty(a!==f);a=f};this.getDisplayName=function(){return e};this.setDisplayName=function(f){c.getModel().setDirty(e!==f);e=f};this.getAlias=function(){return d};this.setAlias=function(f){c.getModel().setDirty(d!==f);d=f};this.getSourceId=function(){return g};this.getParentTable=function(){if(!c.isSubTable())return c;for(var f=c.getModel().getTables(),Q,y=0;y<f.length;y++)for(var ra=f[y],Ka=ra.getSubTables(),Wa=0;Wa<Ka.length;Wa++)if(Ka[Wa]==
c){Q=ra;break}return Q};this.getUsingSourceIds=function(){if(!c.isUnionTable())return[g];for(var f=c.getSubTables(),Q=[],y=0;y<f.length;y++)Q.push(f[y].getSourceId());return Q};this.getTableSource=function(){for(var f=[],Q=c.getModel().getSources(),y=c.getUsingSourceIds(),ra=0;ra<Q.length;ra++){var Ka=Q[ra];if(-1!=y.indexOf(Ka.getId())&&(f.push(Ka),f.length==y.length))break}return f};this.getUniqueRefsSourceIds=function(){for(var f=c.getUsingSourceIds(),Q=c.getModel().getTables(),y=0;y<Q.length;y++){var ra=
Q[y];if(ra!=c){ra=ra.getUsingSourceIds();for(var Ka=0;Ka<ra.length;Ka++){var Wa=f.indexOf(ra[Ka]);-1!=Wa&&f.splice(Wa,1)}}}return f};this.syncColsToDataSet=function(){c.getModel().setDirty(!0);for(var f=c.getModel(),Q=f.getColumns(),y=-1,ra={},Ka=0;Ka<Q.length;Ka++){var Wa=Q[Ka];Wa.getSourceTable()&&Wa.getSourceTable().getId()===c.getId()&&(0>y&&(y=Ka),ra[Wa.getSourceField().getName()]=Wa,Q.splice(Ka,1),Ka--)}-1==y&&(y=0);Ka=[];Wa=[];for(var ib=[],nb=[],ta=c.getAllColumns(),Ja=0;Ja<ta.length;Ja++){var Ta=
ta[Ja],bb=ra[Ta.getName()];bb?nb.push(bb):(bb=mb.newInstance(Ta,f,c),ib.push(bb));Ta.isCalcColumn()?(bb.setIsModelCalcCol(!1),bb.setDataType(Ta.getDataType()),bb.markAsCalcColumn(!0),bb.setSourceTable(c),bb.setCalcColName(Ta.getName()),bb.setSourceField(Ta),Wa.push(bb)):Ka.push(bb)}f.setLegalStringInDataSetCols(nb.concat(ib));f=y;for(y=0;y<Ka.length;y++)Q.splice(y+f,0,Ka[y]);for(y=0;y<Wa.length;y++)Q.push(Wa[y]);c.getModel().syncCalcCol()};this.addColsToDataSet=function(f){c.getModel().setDirty(!0);
var Q=c.getModel();c.setColumns(f);Q.buildColumnInDataSetModel(f,c)};this.isUserSqlSource=function(){return c.isUnionTable()?!1:0!=ca(c.getTableSource()).length};this.getSourceTableDisplayText=function(){if(c.isUnionTable())return"";var f=c.getTableSource();return X.isSupportUserSql(f[0])&&(f=ca(f),0!=f.length)?f[0]&&f[0].getAlias():e?e:a};var ca=function(f){var Q=[];f.forEach(function(y){y.getUserSqls().forEach(function(ra){ra.getName()==c.getName()&&Q.push(ra)})});return Q};this.setSourceId=function(f){c.getModel().setDirty(g!==
f);g=f};this.getX=function(){return m};this.setX=function(f){c.getModel().setDirty(m!==f);m=f};this.getY=function(){return q};this.setY=function(f){c.getModel().setDirty(q!==f);q=f};this.getSubTables=function(){return l};this.setSubTables=function(f){c.getModel().setDirty(l!==f);l=f};this.addSubTable=function(f){c.getModel().setDirty(!0);f.setX(0);f.setY(0);f.setId(ha());f.setAlias(ia(f.getAlias()));l.push(f);Pa&&Pa.addSubTable(f)};this.delSubTable=function(f){f=l.indexOf(f);-1!=f&&l.splice(f,1)};
this.getColumns=function(){return V};this.setColumns=function(f){c.getModel().setDirty(V!==f);V=f};this.getColsJsons=function(){for(var f=[],Q=0;Q<V.length;Q++)f.push(V[Q].toFullJson());return f};this.addColumns=function(f){c.getModel().setDirty(!0);V=V.concat(f)};this.removeColumn=function(f){var Q=f.getSourceTable();Q&&Q.getId()===c.getId()&&(f=f.getSourceField(),f=V.indexOf(f),-1<f&&V.splice(f,1))};this.getColumn=function(f){if(!f)return null;for(var Q=c.getAllColumns(),y=0;y<Q.length;y++){var ra=
Q[y];if(f.toUpperCase()===ra.getName().toUpperCase())return ra}return null};this.deleteColumn=function(f){if(f.isCalcColumn()){if(f=f.getCalcCol())f=G.indexOf(f),-1<f&&G.splice(f,1)}else{f=f.getSourceField();var Q=V.indexOf(f);-1<Q&&(V.splice(Q,1),Pa&&Pa.cancelSelectedRow(f))}c.syncCalcCol();c.syncColsToDataSet()};var la=[];this.syncCalcCol=function(){for(var f=[],Q=0;Q<G.length;Q++){var y=new mb(c.getModel(),c);y.setIsModelCalcCol(!1);y.markAsCalcColumn(!0);y.setCalcColName(G[Q].getName());y.fromCalCol(G[Q],
c);f.push(y)}la=c.getColumns().concat(f)};this.getAllColumns=function(){c.syncCalcCol();return la};this.getCalcCols=function(){return G};this.setCalcCols=function(f){c.getModel().setDirty(G!==f);G=f};this.delCalcCol=function(f){f=G.indexOf(f);-1!=f&&G.splice(f,1)};this.getFilters=function(){return pa};this.setFilters=function(f){c.getModel().setDirty(pa!==f);pa=f};this.getOrders=function(){return ma};this.setOrders=function(f){c.getModel().setDirty(ma!==f);ma=f};this.addOrder=function(f){c.getModel().setDirty(!0);
ma.push(f)};this.equals=function(f){return b==f.getId()};this.isEmpty=function(){return!b&&!a&&!d&&!g};this.getSourceOrTableException=function(){for(var f=c.getTableSource(),Q=0;Q<f.length;Q++){var y=f[Q];if(y&&y.getException($a.DATA_SOURCE))return y.getException($a.DATA_SOURCE);if(c.getException($a.TABLE))return c.getException($a.TABLE)}return null};this.addFieldException=function(f){f.addException($a.FIELD,c.getId()+"$"+f.getName(),Ia.get("loseField","\u5b57\u6bb5\u201c#1\u201d\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002").replace("#1",
f.getAlias()))};this.getAllColumnsMap=function(){var f=c.getAllColumns();return Ba(f)};this.getColumnsMap=function(){return Ba(V)};var Ba=function(f){for(var Q={},y=0;y<f.length;y++){var ra=f[y];Q[ra.getName()]=ra}return Q};this.checkFilterParamExp=function(){if(pa&&0!=pa.length){c.removeException($a.GENERIC_CLIENT_FILTER_ERROR,b);for(var f=0;f<pa.length;f++){var Q=pa[f];Q.checkParamExp()&&Q.hasClientExp()&&c.addException($a.GENERIC_CLIENT_FILTER_ERROR,b,Ia.get("resetErrorProp","\u5c5e\u6027\u5b58\u5728\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u3002"))}}};
this.checkProps=function(f){for(var Q=!1,y=0;y<f.length;y++){var ra=u[f[y]]();if(ra&&0<ra.length&&ra[0].check)for(var Ka=0;Ka<ra.length;Ka++)ra[Ka].check()&&(Q=!0)}return Q};this.toUnion=function(){if(c.isUnionTable())return!0;c.getModel().setDirty(!0);for(var f=new Oa(c.getModel()),Q=c.getColumns(),y=0;y<Q.length;y++)Q[y].setSourceTable(f);f.setColumns(Q);f.setSourceId(c.getSourceId());f.setAlias(c.getAlias());f.setName(c.getName());c.addSubTable(f);c.setColumns([]);c.setSourceId(null);c.setName(Ia.get("unionTable",
"\u5408\u5e76\u8868"));c.setAlias(Ia.get("unionTable","\u5408\u5e76\u8868"));c.getModel().setUniqueAliasForTable(c);c.syncUnionFieldHelper();return!0};this.toSingle=function(f){if(c.isUnionTable()){for(var Q=f.getColumns(),y=0;y<Q.length;y++){var ra=Q[y];ra.setMapName(null);ra.setSourceTable(c);ra.setSourceField(ra)}c.setColumns(Q);c.setSourceId(f.getSourceId());c.setName(f.getName());c.setAlias(f.getAlias());c.setDisplayName(f.getDisplayName());c.setSubTables([]);c.getModel().setUniqueAliasForTable(c);
c.syncUnionFieldHelper()}};this.toDataSetModel=function(){var f=db.createDataSetModel(wb.GENERIC_QUERY_DATASET),Q=c.getModel();f.setDataSetType(Q.getDataSetType());for(var y=c.getFilters(),ra=!1,Ka=0;Ka<y.length;Ka++)if(y[Ka].getParameterByValue()){ra=!0;break}ra&&f.setParameters(Q.getParameters());f.setSources(Q.getSources());f.setTables([this]);f.buildColumnInDataSetModel(this.getColumns(),c);return f};var ha=function(){var f={};l.forEach(function(y,ra){f[y.getId()]=y.getId()});for(var Q=1;f[Oa.SUB_TABLE_PERFIX+
Q];)Q++;return Oa.SUB_TABLE_PERFIX+Q},ia=function(f){var Q={};c.getSubTables().forEach(function(Wa){Q[Wa.getAlias().toUpperCase()]=!0});for(var y=f.toUpperCase(),ra="",Ka=1;Q[y+ra];)ra="_"+Ka++;return f+ra};this.isSubTable=function(){return-1!=c.getId().indexOf(Oa.SUB_TABLE_PERFIX)};var n={};n[Oa.SUB_TABLES]=Oa;n[Oa.COLUMNS]=mb;n[Oa.CALC_COLS]=ya;n[Oa.FILTERS]=jb;n[Oa.ORDERS]=yb;var u={};u[Oa.SUB_TABLES]=this.getSubTables;u[Oa.COLUMNS]=this.getColumns;u[Oa.CALC_COLS]=this.getCalcCols;u[Oa.FILTERS]=
this.getFilters;u[Oa.ORDERS]=this.getOrders;var p=Oa.ARR_KEYS;this.toJsonObject=function(){var f={};f.id=b;f.name=a;f.displayName=e;f.alias=d;f.sourceId=g;f.x=m;f.y=q;for(var Q=0;Q<p.length;Q++){var y=p[Q];f=c.getModel().toArrJson(f,y,u[y])}return f};this.fromJsonObject=function(f,Q){b=f.id;a=f.name;e=f.displayName;d=f.alias;g=f.sourceId;m=parseInt(f.x);q=parseInt(f.y);c.addExceptionFromMapCheckResult(Q,$a.TABLE,b);for(var y=0;y<p.length;y++){var ra=p[y];c.getModel().fromArrJson(f[ra],Q,n[ra],u[ra],
c)}c.syncUnionFieldHelper()}}function Za(k){var c=this,b,a;this.getJoin=function(){return k};this.getLeftField=function(){return b};this.setLeftField=function(e){c.getJoin().getModel().setDirty(b!==e);b=e};this.getRightField=function(){return a};this.setRightField=function(e){c.getJoin().getModel().setDirty(a!==e);a=e};this.isRepeatJoinFields=function(){if(!b||!a)return!1;for(var e=k.getJoinFields(),d=0;d<e.length;d++){var g=e[d];if(g!=c&&g.getLeftField()==c.getLeftField()&&g.getRightField()==c.getRightField())return!0}return!1};
this.toJsonObject=function(){var e={};e.leftField=b;e.rightField=a;return e};this.fromJsonObject=function(e){b=e.leftField;a=e.rightField}}function gb(k){sa.call(this);qb.call(this,k);lb.call(this);var c=this,b,a,e,d=[];this.check=function(){return g()?Ia.get("resetErrorJoin","\u5173\u8054\u5b58\u5728\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u3002"):null};this.getKey=function(){return gb.KEY_JOIN};var g=function(){var l=c.getModel().getTableById(a),V=c.getModel().getTableById(e);if(!l||l.getSourceOrTableException()||
!V||V.getSourceOrTableException())return!0;c.removeException($a.GENERIC_CLIENT_JOIN_ERROR,l.getId()+V.getId());for(var G=l.getAllColumnsMap(),pa=V.getAllColumnsMap(),ma={},Aa=0;Aa<d.length;Aa++){var Pa=d[Aa],ca=Pa.getLeftField(),la=Pa.getRightField();if(m(G,ca)||m(pa,la))return c.addException($a.GENERIC_CLIENT_JOIN_ERROR,l.getId()+V.getId(),Ia.get("resetErrorJoin","\u5173\u8054\u8bbe\u7f6e\u5b58\u5728\u9519\u8bef\u3002")),!0;ca=ca+"_"+la;if(ma[ca])return!0;ma[ca]=Pa}return!1},m=function(l,V){if(!V||
!l[V])return!0;l=l[V];if(l.isCalcColumn()){if((l=l.getCalcCol())&&l.check())return!0}else if(l.check())return!0;return!1};this.getId=function(){return a+"&"+e};this.getJoinType=function(){return b};this.setJoinType=function(l){c.getModel().setDirty(b!==l);b=l};this.getLeftTable=function(){return a};this.getLeftTableObject=function(){if(a)return q(a)};this.setLeftTable=function(l){c.getModel().setDirty(a!==l);a=l};this.getRightTable=function(){return e};this.getRightTableObject=function(){if(e)return q(e)};
this.setRightTable=function(l){c.getModel().setDirty(e!==l);e=l};var q=function(l){return c.getModel().getTableById(l)};this.getJoinFields=function(){return d};this.setJoinFields=function(l){c.getModel().setDirty(d!==l);d=l};this.addJoinFields=function(l){d.push(l)};this.getIconName=function(){return oa.typeToIconName(b)};this.isEmpty=function(){return!b&&!a&&!e&&0===d.length};this.toJsonObject=function(){var l={};l.joinType=b;l.leftTable=a;l.rightTable=e;if(d){for(var V=[],G=0;G<d.length;G++){var pa=
d[G].toJsonObject();V.push(pa)}l.joinFields=V}return l};this.fromJsonObject=function(l,V){b=l.joinType;a=l.leftTable;e=l.rightTable;if(l=l.joinFields)for(var G=0;G<l.length;G++){var pa=l[G],ma=new Za(c);ma.fromJsonObject(pa);d.push(ma)}c.addExceptionFromMapCheckResult(V,$a.JOIN)}}function mb(k,c){sa.call(this);qa.call(this,k);lb.call(this);var b=this.protectedMethod,a=this,e,d=c,g=a,m,q,l=!0,V=!1;this.check=function(){V&&g?g.check()?a.addException($a.FIELD,a.getName(),Ia.get("loseField","\u5b57\u6bb5\u201c#1\u201d\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002").replace("#1",
a.getAlias())):a.clearException($a.FIELD):d&&d.isUnionTable()&&(d.checkUnionFieldConfig(a)?a.addException($a.FIELD,a.getName(),Ia.get("loseField","\u5b57\u6bb5\u201c#1\u201d\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002").replace("#1",a.getAlias())):a.clearException($a.FIELD));return a.getException($a.FIELD)};this.setIsModelCalcCol=function(G){l=G};this.IsModelCalcCol=function(){return l};this.getMapName=function(){return e};this.setMapName=function(G){a.getModel().setDirty(e!==G);e=G};this.getSourceTable=
function(){return d};this.setSourceTable=function(G){a.getModel().setDirty(d!==G);d=G};this.getSourceTableAlias=function(){var G=this.getSourceTable();if(G)return G.getAlias()};this.getSourceColumnAlias=function(){var G=a.getCalcCol();return G&&G.getSourceField()?G.getSourceField():g.getAlias()};this.getSourceField=function(){return g};this.setSourceField=function(G){a.getModel().setDirty(g!==G);g=G};this.getOriginalDataType=function(){return m?a.getCalcCol().getOriginDataType():g.getDataType()};
this.isEmpty=function(){return!e&&!d&&!g&&!b.getName()&&!b.getAlias()};this.markAsCalcColumn=function(G){m=G};this.isCalcColumn=function(){return!0===m};this.setCalcColName=function(G){q=G};this.getCalcCol=function(){if(q){var G=l?a.getModel().getCalcCols():d.getCalcCols();if(G&&0<G.length)for(var pa=0;pa<G.length;pa++)if(q===G[pa].getName())return G[pa]}return null};this.fromCalCol=function(G,pa){a.init(G.getName(),G.getAlias(),G.getDataType());g=a;d=pa};this.toJSON=function(){return this.toJsonObject()};
this.toJsonObject=function(){var G=b.toJsonObject();G.mapName=e;-1!=a.getModel().getColumns().indexOf(a)&&(G.sourceTable=d&&d.getId(),G.sourceField=g&&g.getName());return G};this.toFullJson=function(){var G=b.toJsonObject();G.mapName=e;G.sourceTable=d&&d.getId();G.sourceField=g&&g.getName();return G};this.equals=function(G){return a.getName()==G.getName()};this.fromJsonObject=function(G,pa){b.fromJsonObject(G);e=G.mapName;var ma=a.getModel();G.sourceTable&&(V=!0,d=ma.getTableById(G.sourceTable));
G.sourceField&&(g=d.getColumn(G.sourceField));if(d)for(G=d.getCalcCols(),ma=0;ma<G.length;ma++){var Aa=G[ma];Aa.getName()==g.getName()&&(l=!1,a.setDataType(g.getDataType()),a.markAsCalcColumn(!0),a.setCalcColName(Aa.getName()))}a.addExceptionFromMapCheckResult(pa,$a.FIELD,c?c.getId()+"$"+a.getName():a.getName())}}function ya(k,c){sa.call(this);qb.call(this,k);lb.call(this);var b=this,a,e,d,g,m,q,l,V={},G,pa=!1;this.check=function(){b.removeException($a.GENERIC_CLIENT_CALC_ERROR,a);var ma=b.getException($a.CALCULATE_FIELD);
if(ma)return ma;(ma=z.checkCalcCol(b,c))&&b.addException($a.GENERIC_CLIENT_CALC_ERROR,a,ma);return ma};this.isTableCalc=function(){return null!=c};this.getFromTable=function(){return c};this.getName=function(){return a};this.setName=function(ma){b.getModel().setDirty(a!==ma);a=ma};this.getAlias=function(){return e};this.setAlias=function(ma){b.getModel().setDirty(e!==ma);e=ma;b.getModel().syncCalcCol()};this.getDataType=function(){return d};this.setDataType=function(ma){b.getModel().setDirty(d!==
ma);d=ma;b.getModel().syncCalcCol()};this.getFormula=function(){return g};this.setFormula=function(ma){b.getModel().setDirty(g!==ma);g=ma};this.getSrcTable=function(){return m};this.isEmpty=function(){return!a&&!e&&!d&&!g};this.getReferences=function(){return l};this.setOriginDataType=function(ma){G=ma};this.getOriginDataType=function(){return G};this.setCalculatingFieldInvalid=function(ma){pa=ma};this.isCalculatingFieldInvalid=function(){return pa};this.setSourceField=function(ma){q=ma};this.getSourceField=
function(){return q};this.getRefColumn=function(ma){return V[ma]};this.collectSrcTable=function(ma){var Aa=!1;V={};if((l=ma)&&0!==ma.length)for(var Pa=c?c.getAllColumns():b.getModel().getAllColumns(),ca=0;ca<ma.length;ca++)for(var la=ma[ca],Ba=!1,ha=0;ha<Pa.length;ha++){var ia=Pa[ha],n=ia.getSourceTable();if(n&&n.getId().toUpperCase()+ya.FORMULA_DELIMITER+ia.getName().toUpperCase()===la.toUpperCase())if(V[la]=ia,!Aa&&u&&u!==n){Aa=!0;var u=null}else Ba||(u=n,Ba=!0);else ia.getName().toUpperCase()===
la.toUpperCase()&&(V[la]=ia)}else u=null;if(!Ba||Aa)u=null;m=u};this.toJSON=function(){return b.toJsonObject()};this.toJsonObject=function(){var ma={};ma.name=a;ma.alias=e;ma.dataType=d;ma.formula=g;ma.sourceField=q;ma.originDataType=G;ma.references=l;return ma};this.fromJsonObject=function(ma,Aa){a=ma.name;e=ma.alias;d=ma.dataType;g=ma.formula;G=ma.originDataType;q=ma.sourceField;b.collectSrcTable(ma.references);b.addExceptionFromMapCheckResult(Aa,$a.CALCULATE_FIELD,c?c.getId()+"$"+a:a)}}function jb(k,
c){sa.call(this);qb.call(this,k);lb.call(this);var b=this,a=0,e,d,g,m,q,l=0,V,G,pa=c,ma;this.setFromTable=function(ca){pa=ca};this.check=function(){if(b.isEmpty())return null;b.clearException($a.GENERIC_CLIENT_FILTER_ERROR);var ca=b.getException($a.FILTER),la=t.checkFilterItem(b);if(la){var Ba=Pa();(pa||Ba)&&b.addException($a.GENERIC_CLIENT_FILTER_ERROR,pa?pa.getId()+"$"+Ba:Ba,la)}return ca?ca:la};this.hasClientExp=function(){return b.getException($a.GENERIC_CLIENT_FILTER_ERROR)?!0:!1};this.checkParamExp=
function(){return b.getValueMode()==Y.PARAM&&b.check()?!0:!1};this.getFromFilters=function(){return pa?pa.getFilters():b.getModel().getFilters()};this.getLeftBrackets=function(){return a};this.setLeftBrackets=function(ca){b.getModel().setDirty(a!==ca);a=ca};this.getField=function(){return e};this.setField=function(ca){b.getModel().setDirty(e!==ca);e=ca;Aa()};this.getCompareOp=function(){return d};this.setCompareOp=function(ca){b.getModel().setDirty(d!==ca);d=ca};this.getValueMode=function(){return g};
this.setValueMode=function(ca){b.getModel().setDirty(g!==ca);g=ca};this.getValue=function(){return m};this.setValue=function(ca){b.getModel().setDirty(m!==ca);m=ca};this.getDisplayValue=function(){return q};this.setDisplayValue=function(ca){q=ca};this.getRightBrackets=function(){return l};this.setRightBrackets=function(ca){b.getModel().setDirty(l!==ca);l=ca};this.getLogicOp=function(){return V};this.setLogicOp=function(ca){b.getModel().setDirty(V!==ca);V=ca};this.setRelativeDateRange=function(ca){G=
ca};this.getRelativeDateRange=function(){return G};this.getDataType=function(){if(!b.getField())return"";var ca=pa?pa:b.getModel();if(ca){ca=ca.getAllColumns();for(var la=0;la<ca.length;la++){var Ba=ca[la];if(b.getField().toUpperCase()===Ba.getName().toUpperCase())return Ba.getDataType()}}return""};this.getColumn=function(){var ca=pa?pa:b.getModel();return ca?ca.getColumn(e):null};this.getParameterByValue=function(){if(!m||g!=Y.PARAM)return null;for(var ca=b.getModel().getParameters(),la=0;la<ca.length;la++){var Ba=
ca[la];if(Ba.getName()==m)return Ba}return null};this.getValueDisplayText=function(){var ca="";if(null!=b.getValue()||null!=b.getRelativeDateRange())if(b.getCompareOp()==U.RELATIVE_DATE_RANGE)ca="("+Ia.get("relativeDate1","\u76f8\u5bf9\u65e5\u671f")+")"+vb.modelToDisplayText(b.getRelativeDateRange(),!1);else switch(b.getValueMode()){case Y.CONST:ca="";var la=b.getDataType(),Ba=b.getValue(),ha=b.getCompareOp();if(la===K.BOOLEAN)ca="true"==Ba?Ia.get("true","\u771f"):Ia.get("false","\u5047");else if(la===
K.DATE)ca=b.getDateByString(Ba),la=new tb,la.setFormatString("yyyy-MM-dd"),ca=la.format(ca);else if(la===K.DATETIME)ca=b.getDateByString(Ba),la=new tb,la.setFormatString("yyyy-MM-dd HH:mm:ss"),ca=la.format(ca);else if(ha==U.NOT_IN||ha==U.IN)for(la=Ba.split(I.SPLIT),Ba=0;Ba<la.length;Ba++)ca+='"'+la[Ba]+'"',Ba!=la.length-1&&(ca+=",");else ca=Ba?Ba:"";break;case Y.PARAM:ca=Ia.get("param","\u53c2\u6570")+"[";la=(la=b.getParameterByValue())?la.getAlias():"";ca=ca+la+"]";break;case Y.VARIABLE:ca=Ia.get("variant",
"\u53d8\u91cf")+"["+(b.getDisplayValue()?b.getDisplayValue():"")+"]"}d&&(U.RELATIVE_DATE_RANGE==d?la=U.compareOpToText(U.EQUAL)+ca:U.IN==d||U.NOT_IN==d?(g==Y.CONST&&(ca="["+ca+"]"),la=U.IN==d?Ia.get("withinVal","\u5728#1\u4e4b\u5185"):la=Ia.get("withoutVal","\u4e0d\u5728#1\u4e4b\u5185"),la=la.replace("#1",ca)):la=U.compareOpToText(d)+ca,ca=la);return ca};this.getDateByString=function(ca){var la=new Date;ca=ca?parseInt(ca):null;isNaN(ca)||null==ca||la.setTime(ca);return la};this.getAlias=function(){return ma};
var Aa=function(){var ca;(ca=pa?pa.getColumn(e):b.getModel().getColumn(e))&&(ma=ca.getAlias())};this.isEmpty=function(){return(!a||0===a)&&(!l||0===l)&&!e&&!d&&!m&&!q&&!V};this.toJsonObject=function(){var ca={};ca.leftBrackets=a;ca.field=e;ca.compareOp=d;ca.valueMode=g;ca.value=m;ca.displayValue=q;ca.rightBrackets=l;ca.logicOp=V;ca.relativeDateRange=G?G.toJsonObject():null;return ca};var Pa=function(){var ca=""+a+e+d;kb.isNotEmptyStr(g)&&(ca+=g);kb.isNotEmptyStr(m)&&(ca+=m);ca+=l;kb.isNotEmptyStr(V)&&
(ca+=V);return ca};this.fromJsonObject=function(ca,la){a=ca.leftBrackets;e=ca.field;d=ca.compareOp;g=ca.valueMode;m=ca.value;q=ca.displayValue;l=ca.rightBrackets;V=ca.logicOp;ca.relativeDateRange&&(G=new Ab,G.fromJsonObject(ca.relativeDateRange));Aa();ca=Pa();b.addExceptionFromMapCheckResult(la,$a.FILTER,c?c.getId()+"$"+ca:ca)}}function yb(k,c){sa.call(this);qb.call(this,k);lb.call(this);var b=this,a,e,d;this.check=function(){b.removeException($a.GENERIC_CLIENT_ORDER_ERROR,a);var m=b.getException($a.ORDER);
if(m)return m;(m=h.checkOrder(b,c))&&b.addException($a.GENERIC_CLIENT_ORDER_ERROR,a,m);return m};this.hasClientExp=function(){return b.getException($a.GENERIC_CLIENT_ORDER_ERROR,a)};this.getField=function(){return a};this.setField=function(m){b.getModel().setDirty(a!==m);a=m;g()};this.getOrder=function(){return e};this.setOrder=function(m){b.getModel().setDirty(e!==m);e=m};this.getAlias=function(){return d};this.getColByField=function(){if(!a)return"";var m=c?c.getColumn(a):k.getColumn(a);return m?
m:d?d:a};this.isEmpty=function(){return!a&&!e};var g=function(){var m;(m=c?c.getColumn(a):b.getModel().getColumn(a))&&(d=m.getAlias())};this.toJsonObject=function(){var m={};m.field=a;m.order=e;return m};this.fromJsonObject=function(m,q){a=m.field;e=m.order;g();b.addExceptionFromMapCheckResult(q,$a.ORDER,c?c.getId()+"$"+a:a)}}function Na(){rb.call(this);Fa.call(this);var k=this,c=this.protectedMethod,b=this.protectedCheckerMethod,a=1318,e=376,d=[],g=[],m=[],q=[],l=[],V=[],G=[];this.getException=function(n,
u){var p;n===$a.DATA_SOURCE&&((p=b.getException(n,u))||(p=pa(n,u,d)));p||(p=pa(n,u,g));p||n!==$a.JOIN&&n!==$a.GENERIC_CLIENT_JOIN_ERROR||(p=pa(n,u,m));p||(p=pa(n,u,q));p||(p=pa(n,u,l));p||(p=pa(n,u,V));p||(p=pa(n,u,G));return p};var pa=function(n,u,p){var f=null;if(!p||0===p.length)return f;for(var Q=0;Q<p.length;Q++){var y=p[Q];if(f=y.getException(n,u))break;else if(y.getTables&&(f=pa(n,u,y.getTables())),!f&&y.getJoins&&(f=pa(n,u,y.getJoins())),!f&&y.getColumns&&(f=pa(n,u,y.getColumns())),!f&&y.getCalcCols&&
(f=pa(n,u,y.getCalcCols())),!f&&y.getFilters&&(f=pa(n,u,y.getFilters())),!f&&y.getOrders&&(f=pa(n,u,y.getOrders())),f)break}return f};this.checkProps=function(n){for(var u=0;u<n.length;u++){var p=ha[n[u]]();if(p&&0<p.length&&p[0].check)for(var f=0;f<p.length;f++)p[f].check()}};this.checkAllProps=function(){k.checkProps(Na.ARR_KEYS)};this.checkFilterParamExp=function(){for(var n=0;n<V.length;n++)V[n].checkParamExp();for(n=0;n<g.length;n++)g[n].checkFilterParamExp()};this.hasContent=function(){return!1};
this.clone=function(){var n=new Na;n.fromJsonObject(k.toJsonObject(),k.getExceptionMap());return n};this.getWidth=function(){return a};this.setWidth=function(n){a=n};this.getHeight=function(){return e};this.setHeight=function(n){e=n};this.getSources=function(){return d};this.setSources=function(n){k.setDirty(d!==n);d=n};this.addSource=function(n){k.setDirty(!0);d.push(n)};this.removeSource=function(n){k.setDirty(!0);d.splice(d.indexOf(n),1)};this.getTables=function(){return g};this.addTable=function(n){k.setDirty(!0);
g.push(n)};this.setTables=function(n){k.setDirty(g!==n);g=n};this.getJoins=function(){return m};this.concatJoins=function(n){for(var u=0;u<n.length;u++)m.push(n[u]);return m[u]};this.setJoins=function(n){k.setDirty(m!==n);m=n};this.addJoins=function(n){k.setDirty(!0);m.push(n)};this.switchJoin=function(n,u){k.setDirty(!0);var p=m.indexOf(n),f=m.indexOf(u);m[p]=u;m[f]=n};this.getColumns=function(){return q};this.setColumns=function(n){k.setDirty(q!==n);q=n;k.syncCalcCol()};this.addColumns=function(n){q=
q.concat(n);k.syncCalcCol()};this.deleteColumn=function(n){if(n.isCalcColumn()){if(n=n.getCalcCol())n=l.indexOf(n),-1<n&&l.splice(n,1)}else{var u=q.indexOf(n);-1<u&&q.splice(u,1);u=n.getSourceTable();n=n.getSourceField();u&&u.removeColumn(n)}k.syncCalcCol()};var ma=[];this.syncCalcCol=function(){for(var n=[],u=0;u<l.length;u++){var p=new mb(k);p.markAsCalcColumn(!0);p.setCalcColName(l[u].getName());p.fromCalCol(l[u],l[u].getSrcTable());n.push(p)}ma=k.getColumns().concat(n)};this.getAllColumns=function(){k.syncCalcCol();
return ma};this.getColsJsons=function(){for(var n=[],u=0;u<q.length;u++)n.push(q[u].toFullJson());return n};this.getCalcCols=function(){return l};this.getCalcCol=function(n){for(var u=u;u<l.length;u++)if(n===l[u].getName())return l[u];return null};this.setCalcCols=function(n){k.setDirty(l!==n);l=n};this.getFilters=function(){return V};this.setFilters=function(n){k.setDirty(V!==n);V=n};this.getOrders=function(){return G};this.setOrders=function(n){k.setDirty(G!==n);G=n};this.getUnFinishedSource=function(n){if(!X.isMultipleType(n))return null;
for(var u=0;u<d.length;u++)if(d[u].getDataSourceType()==n&&!d[u].getName())return d[u];return null};this.addTableAndSource=function(n,u,p){k.setDirty(!0);u&&k.addSource(n);p.setSourceId(n.getId());k.setUniqueAliasForTable(p);k.addTable(p)};this.createNewSource=function(n,u){var p=k.getSourceByName(n),f=!1;p||(p=k.getUnFinishedSource(u));p||(p=Na.buildSource(k,u),p.setId(k.getUniqueSourceId()),f=!0);p.setName(n);return{oModel:p,bNewCreated:f}};this.doDeleteJoinByRight=function(n){for(var u=0;u<m.length;u++)if(m[u].getRightTable()==
n.getId()){m.splice(u,1);break}};this.doDeleteColumns=function(n){for(var u=q.length-1;0<=u;u--){var p=q[u];p.getSourceTable()&&p.getSourceTable().getId()===n.getId()&&q.splice(u,1)}k.syncCalcCol()};this.getFirstTable=function(){return g[0]?g[0]:null};this.isTableDeletable=function(n){return n.isSubTable()||1==g.length?!0:0!=n.getSubTables().length?!1:1==k.findRelatedToOtherTable(n,!1).length};this.findRelatedToOtherTable=function(n,u){return n.isSubTable()?[]:Aa(n,u,function(p){return p.getLeftTable()},
function(p){return p.getRightTable()})};this.findRelatedToCurrentTables=function(n,u){return n.isSubTable()?[]:Aa(n,u,function(p){return p.getRightTable()},function(p){return p.getLeftTable()})};this.findRelatedToCurrentJoins=function(n){if(n.isSubTable())return[];var u=n.getId(),p=[];m.forEach(function(f){f.getLeftTable()==u&&p.push(f)});return p};var Aa=function(n,u,p,f){var Q=[];n=[n];for(var y={},ra=0;ra<g.length;ra++)y[g[ra].getId()]=g[ra];for(;0!=n.length;){ra=n.shift();var Ka=f;for(var Wa=
[],ib=0;ib<m.length;ib++){var nb=m[ib];Ka(nb)==ra.getId()&&Wa.push(nb)}Ka=Wa;for(ra=0;ra<Ka.length;ra++)if(Wa=y[p(Ka[ra])])Q.push(Wa),u&&n.push(Wa)}return Q};this.getJoinsByTable=function(n){for(var u=[],p=0;p<m.length;p++){var f=m[p];f.getLeftTable()!=n.getId()&&f.getRightTable()!=n.getId()||u.push(f)}return u};this.buildColumnInDataSetModel=function(n,u){n=mb.copyBasicInfo(n,k,u);k.setLegalStringInDataSetCols(n);for(u=0;u<n.length;u++)q.push(n[u]);k.syncCalcCol()};this.setLegalStringInDataSetCols=
function(n){return k.setLegalColNames(n,k.getAllColumns())};this.setLegalColNames=function(n,u){if(!n||0==n.length)return[];var p={},f={};if(u)for(var Q=0;Q<u.length;Q++){var y=u[Q];p[y.getName().toUpperCase()]=y.getName();f[y.getAlias().toUpperCase()]=y.getAlias()}for(Q=0;Q<n.length;Q++){y=n[Q];var ra=y.getName().toUpperCase();ra.length>kb.iMAX_COLUMN_LEN&&(ra=ra.substring(0,kb.iMAX_COLUMN_LEN));u=y.getAlias().toUpperCase();u.length>kb.iMAX_COLUMN_LEN&&(u=u.substring(0,kb.iMAX_COLUMN_LEN));ra=kb.replaceIllegalChar(ra,
p,"COLUMN");u=kb.replaceIllegalChar(u,f,"COLUMN");p[ra]=ra;f[u]=u;y.setName(ra);y.setAlias(u)}return n};this.setUniqueAliasForTable=function(n){var u=k.getTableAliasMap(n),p="",f=1,Q=n.getAlias();for(p=Q+p;u[p.toUpperCase()];)p="_"+f++,p=Q+p;n.setAlias(p)};this.getTableAliasMap=function(n){for(var u={},p=0;p<g.length;p++)g[p]!=n&&(u[g[p].getAlias().toUpperCase()]=g[p]);return u};this.getSourceByName=function(n){for(var u=0;u<d.length;u++){var p=d[u];if(p.getName()==n)return p}return null};this.getTableById=
function(n){return Pa(n,g)};var Pa=function(n,u){for(var p=0;p<u.length;p++){var f=u[p];if(n===f.getId()||0<f.getSubTables().length&&(f=Pa(n,f.getSubTables())))return f}};this.getColumn=function(n){if(!n)return null;0===ma.length&&k.syncCalcCol();for(var u=0;u<ma.length;u++){var p=ma[u];if(n.toUpperCase()===p.getName().toUpperCase())return p}return null};this.isEmpty=function(){return d&&0!==d.length&&g&&0!==g.length?null:Ia.get("unDesigned","\u5f53\u524d\u6570\u636e\u96c6\u672a\u5305\u542b\u4efb\u4f55\u6570\u636e\uff0c\u8bf7\u62d6\u5165\u6570\u636e\u8868\u81f3\u201c\u8fde\u63a5\u201d\u533a\u57df\u5f00\u59cb\u8bbe\u8ba1\u3002")};
this.getUniqueSourceId=function(n){n||(n=k.getSourceIdMap());return la(Na.SOURCE_PREFIX,n)};this.getUniqueTableId=function(n){n||(n=k.getTableIdMap());return la(Na.TABLE_PREFIX,n)};this.getTableIdMap=function(){return ca(g,function(n){return n.getId()})};this.getSourceIdMap=function(){return ca(d,function(n){return n.getId()})};var ca=function(n,u){if(!n||0==n.length||!u)return{};for(var p={},f=0;f<n.length;f++){var Q=u(n[f]);p[Q]=Q}return p},la=function(n,u){for(var p,f=1;;){p=n+f;if(!u[p])break;
f++}return p},Ba={};Ba[Na.SOURCES]=Sa;Ba[Na.TABLES]=Oa;Ba[Na.JOINS]=gb;Ba[Na.COLUMNS]=mb;Ba[Na.CALC_COLS]=ya;Ba[Na.FILTERS]=jb;Ba[Na.ORDERS]=yb;var ha={};ha[Na.SOURCES]=this.getSources;ha[Na.TABLES]=this.getTables;ha[Na.JOINS]=this.getJoins;ha[Na.COLUMNS]=this.getColumns;ha[Na.CALC_COLS]=this.getCalcCols;ha[Na.FILTERS]=this.getFilters;ha[Na.ORDERS]=this.getOrders;var ia=Na.ARR_KEYS;this.toArrJson=function(n,u,p){if(p){var f=[];p=p();for(var Q=0;Q<p.length;Q++){var y=p[Q];y.isEmpty()||f.push(y.toJsonObject())}n[u]=
f}return n};this.fromArrJson=function(n,u,p,f,Q){if(n)for(var y=0;y<n.length;y++){var ra=n[y],Ka=new p(k,Q);Ka.fromJsonObject(ra,u);f&&f().push(Ka)}};this.toJsonObject=function(){var n=c.toJsonObject();n.height=e;n.width=a;for(var u=0;u<ia.length;u++){var p=ia[u];n=k.toArrJson(n,p,ha[p])}if(q&&0<q.length){p=[];for(u=0;u<q.length;u++)p.push(q[u].toJsonObject());n.outputColumns=p}if(l&&0<l.length){p=n.outputColumns;for(u=0;u<l.length;u++){var f=l[u],Q=new mb(this);Q.init(f.getName(),f.getAlias(),f.getDataType());
p.push(Q.toJsonObject())}n.outputColumns=p}return n};this.fromJsonObject=function(n,u){e=n.height;a=n.width;for(var p=0;p<ia.length;p++){var f=ia[p];k.fromArrJson(n[f],u,Ba[f],ha[f])}c.fromJsonObject(n,u)}}function fb(k,c){var b;this.getDataSetModel=function(){return b.getModel()};this.setUnionTable=function(a){b=a};this.pushUnionTable=function(a){k.push(a)};this.getArrTable=function(){return k};this.getTableIdx=function(a){return k.indexOf(a)};this.getHeadLen=function(){return k.length};this.getHeadTable=
function(a){return k[a]};this.deleteTable=function(a,e){a=k.indexOf(a);if(-1!=a){k.splice(a,1);for(var d=0;d<e.length;d++){var g=e[d];g.deleteColByIndex(a);0==g.getNonNullSize()&&(e.splice(d,1),d--)}}};this.isSubTableDeleted=function(a){return c?!1:-1==b.getSubTables().indexOf(a)};this.clone=function(){var a=new fb([].concat(k));a.setUnionTable(b);return a}}function Xa(k){var c=this,b=!1,a,e,d;this.setArrGenericCols=function(l){a=l;g()};this.initArrColByIndex=function(l,V){a=[];for(var G=0;G<k.getHeadLen();G++)G==
l?a.push(V):a.push(null);g()};this.pushGenericCol=function(l){a.push(l);g()};this.setGenericColByIdx=function(l,V){a[l]=V;g()};this.deleteColByIndex=function(l){a.splice(l,1);g()};var g=function(){for(var l=0;l<a.length;l++)if(a[l]){d=a[l];break}e=m()};this.setSelected=function(l){b=l};this.isSelected=function(){return b};this.getArrGenericCols=function(){return a};this.getArrUnCompatible=function(){return e};this.getGenericColByIdx=function(l){return a[l]};this.getTableByIdx=function(l){return k.getHeadTable(l)};
this.getRowLen=function(){return a.length};this.getNonNullSize=function(){var l=0;a.forEach(function(V){V&&l++});return l};this.getBenchmark=function(){return d};this.isSubColDeleted=function(l){var V=a.indexOf(l);return(V=this.getTableByIdx(V))&&(k.isSubTableDeleted(V)||-1==V.getColumns().indexOf(l))};var m=function(){var l=c.getBenchmark(),V=[];a.forEach(function(G,pa){G&&G.getDataType()!=l.getDataType()&&V.push(pa)});return V};this.transToUnionCol=function(l,V,G){var pa=c.getBenchmark(),ma=a.indexOf(pa);
if(k.getHeadTable(ma).isUnionTable()){if(c.isSelected())for(l=0;l<a.length;l++)(V=a[l])&&V!=pa&&V.setMapName(pa.getName());return pa}if(!c.isSelected())return null;pa=mb.copyBasicInfo([pa],pa.getModel(),G)[0];G=q(l,pa.getName());ma=q(V,pa.getAlias());pa.setName(G);pa.setAlias(ma);l[G]=G;V[ma]=ma;for(l=0;l<a.length&&c.isSelected();l++)(V=a[l])&&V.setMapName(pa.getName());return pa};this.resetMapName=function(){a.forEach(function(l){l&&l.setMapName(null)})};var q=function(l,V){for(var G=1,pa="";l&&
l[V+pa];)pa="_"+G,G++;return V+pa};this.clone=function(l){l=new Xa(l);l.setArrGenericCols([].concat(a));l.setSelected(b);return l}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.extreport&&(com.kingdee.bos.extreport={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner&&(com.kingdee.bos.extreport.datasetdesigner={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner.generic&&
(com.kingdee.bos.extreport.datasetdesigner.generic={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner.generic.model&&(com.kingdee.bos.extreport.datasetdesigner.generic.model={});var Ra=com.kingdee.bos.extreport.datasetdesigner.generic.model;Ra.GenericQueryTable=Oa;Ra.GenericQueryDataSource=Sa;Ra.GenericQueryColumn=mb;Ra.GenericQueryCalcCol=ya;Ra.GenericQueryFilter=jb;Ra.GenericQueryOrder=yb;Ra.GenericQueryDataSetModel=Na;Ra.GenericQueryJoin=gb;Ra.GenericQueryJoinField=Za;Ra.GenericQueryUserSql=
Ca;Ra.UnionFieldHeadWrapper=fb;Ra.UnionFieldRowWrapper=Xa;var tb,Ab,Ia,kb,vb,ub,qb,lb,rb,$a,db,wb,qa,K,I;(function(){var k=com.kingdee.bos.qing.common;tb=k.DateFormater;Ab=k.RelativePeriodModel;k=com.kingdee.bos.qing.framework.common;Ia=k.MultilanguageManager.createPackageAccessor(com.kingdee.bos.extreport.datasetdesigner);k=com.kingdee.bos.extreport.datasetdesigner.common;kb=k.StringUtil;k=com.kingdee.bos.qing.common.ui;vb=k.RelativePeriodPanel;k=com.kingdee.bos.extreport.datasetdesigner.model;ub=
k.RptSourceType;qb=k.ModelContainer;lb=k.ModelChecker;rb=k.AbstractDataSetModel;$a=k.DataSetModelCheckType;db=k.DataSetModelFactory;wb=k.DataSetType;qa=k.OutputColumn;K=k.OutputColumDataType;I=k.ParamDefaultValueType})();var X={ENTITY:"ENTITY",DATA_CENTER:"DATA_CENTER",QING_MODELER:"QING_MODELER",SUPER_QUERY:"SUPER_QUERY",USER_SUPER_QUERY:"USER_SUPER_QUERY",OUT_DB:"OUT_DB"};X.ARR_SUPPORT_USER_SQL=[X.DATA_CENTER,X.USER_SUPER_QUERY,X.OUT_DB,X.SUPER_QUERY];X.ARR_TREE_LEVEL_FIELD_SOURCE=[X.SUPER_QUERY,
X.ENTITY];X.isSupportUserSql=function(k){return-1!=X.ARR_SUPPORT_USER_SQL.indexOf(k.getDataSourceType())};X.typeToDisplayName=function(k){switch(k){case X.ENTITY:return Ia.get("entity","\u4e1a\u52a1\u5b9e\u4f53");case X.DATA_CENTER:return Ia.get("currentDataCenter","\u5f53\u524d\u6570\u636e\u4e2d\u5fc3");case X.QING_MODELER:return Ia.get("qingmodler","\u8f7b\u5efa\u6a21");case X.SUPER_QUERY:return Ia.get("superQuery","\u8d85\u7ea7\u67e5\u8be2");default:return Ia.get("outDB","\u516c\u5171\u6570\u636e\u6e90")}};
X.typeToIconName=function(k){switch(k){case X.ENTITY:return"ds_entity";case X.DATA_CENTER:return"ds_datacenter";case X.QING_MODELER:return"ds_qingmodeler";case X.SUPER_QUERY:return"ds_superquery";default:return"ds_outdb"}};X.typeToFeatureName=function(k){switch(k){case X.ENTITY:return Ia.get("ENTITY","\u5b9e\u4f53");case X.QING_MODELER:return Ia.get("MODELER","\u6a21\u578b");default:return Ia.get("TABLE","\u8868")}};X.isMultipleType=function(k){return!(k==X.OUT_DB||k==X.USER_SUPER_QUERY)};X.getTableLabel=
function(k){switch(k){case X.SUPER_QUERY:return Ia.get("code","\u7f16\u7801");case X.ENTITY:return Ia.get("entityMark","\u5b9e\u4f53\u6807\u8bc6");case X.QING_MODELER:return Ia.get("MODELER","\u6a21\u578b");default:return Ia.get("tableName","\u8868\u540d")}};X.getSrcLabel=function(k){switch(k){case X.SUPER_QUERY:return Ia.get("tableName","\u8868\u540d");case X.ENTITY:return Ia.get("entitySet","\u5b9e\u4f53\u540d");case X.QING_MODELER:return Ia.get("modelerSet","\u6a21\u578b\u96c6");case X.DATA_CENTER:return Ia.get("app",
"\u5e94\u7528")}};X.isSwitchable=function(k){return X.isOutDB(k)||k==X.DATA_CENTER||k==X.SUPER_QUERY};X.isOutDB=function(k){return k==X.OUT_DB||k==X.USER_SUPER_QUERY};X.containTableSourceName=function(k){return k==X.ENTITY||k==X.QING_MODELER};Ra.GenericQueryDataSourceType=X;var ja;ub.fromGenericSourceType=function(k){ja||(ja={},ja[X.DATA_CENTER]=ub.DATA_CENTER,ja[X.OUT_DB]=ub.OUT_DB,ja[X.USER_SUPER_QUERY]=ub.OUT_DB,ja[X.SUPER_QUERY]=ub.SUPER_QUERY,ja[X.ENTITY]=ub.ENTITY,ja[X.QING_MODELER]=ub.QING_MODELER);
return ja[k]};var U={RELATIVE_DATE_RANGE:"RELATIVE_DATE_RANGE",EQUAL:"EQUAL",NOT_EQUAL:"NOT_EQUAL",GREATER:"GREATER",GREATER_EQUAL:"GREATER_EQUAL",LESS:"LESS",LESS_EQUAL:"LESS_EQUAL",INCLUDE:"INCLUDE",NOT_INCLUDE:"NOT_INCLUDE",START_WITH:"START_WITH",END_WITH:"END_WITH",NULL:"NULL",NOT_NULL:"NOT_NULL",IN:"IN",NOT_IN:"NOT_IN"};U.COMPARES_FOR_STRING=[U.EQUAL,U.NOT_EQUAL,U.INCLUDE,U.NOT_INCLUDE,U.START_WITH,U.END_WITH,U.NULL,U.NOT_NULL,U.IN,U.NOT_IN];U.COMPARES_FOR_NUMBER=[U.EQUAL,U.NOT_EQUAL,U.GREATER,
U.GREATER_EQUAL,U.LESS,U.LESS_EQUAL,U.NULL,U.NOT_NULL,U.IN,U.NOT_IN];U.COMPARES_FOR_DATETIME=[U.RELATIVE_DATE_RANGE,U.EQUAL,U.NOT_EQUAL,U.GREATER,U.GREATER_EQUAL,U.LESS,U.LESS_EQUAL,U.NULL,U.NOT_NULL];U.COMPARES_FOR_BOOLEAN=[U.EQUAL,U.NOT_EQUAL,U.NULL,U.NOT_NULL];U.COMPARES_FOR_BINARY=[U.EQUAL,U.NOT_EQUAL,U.NULL,U.NOT_NULL];U.compareOpToText=function(k){switch(k){case U.EQUAL:k=Ia.get("searchEqual","\u7b49\u4e8e");break;case U.NOT_EQUAL:k=Ia.get("searchNotEqual","\u4e0d\u7b49\u4e8e");break;case U.GREATER:k=
Ia.get("greater","\u5927\u4e8e");break;case U.GREATER_EQUAL:k=Ia.get("equalOrGreater","\u5927\u4e8e\u7b49\u4e8e");break;case U.LESS:k=Ia.get("less","\u5c0f\u4e8e");break;case U.LESS_EQUAL:k=Ia.get("equalOrLess","\u5c0f\u4e8e\u7b49\u4e8e");break;case U.INCLUDE:k=Ia.get("searchInclude","\u5305\u542b");break;case U.NOT_INCLUDE:k=Ia.get("searchNotInclude","\u4e0d\u5305\u542b");break;case U.START_WITH:k=Ia.get("searchStartOf","\u5f00\u5934\u662f");break;case U.END_WITH:k=Ia.get("searchEndOf","\u7ed3\u5c3e\u662f");
break;case U.NULL:k=Ia.get("compareNull","\u4e3a\u7a7a");break;case U.NOT_NULL:k=Ia.get("compareNotNull","\u4e0d\u4e3a\u7a7a");break;case U.RELATIVE_DATE_RANGE:k=Ia.get("relativeDate1","\u76f8\u5bf9\u65e5\u671f");break;case U.IN:k=Ia.get("within","\u5728......\u4e4b\u5185");break;case U.NOT_IN:k=Ia.get("without","\u4e0d\u5728......\u4e4b\u5185");break;default:k=""}return k};Ra.GenericQueryCompareOp=U;var D={AND:"AND",OR:"OR",logicOpToText:function(k){var c="";k===D.AND?c=Ia.get("and","\u5e76\u4e14"):
k===D.OR&&(c=Ia.get("or","\u6216"));return c}};Ra.GenericQueryLogicOp=D;var Y={CONST:"CONST",PARAM:"PARAM",VARIABLE:"VARIABLE"};Ra.GenericQueryValueMode=Y;Y.typeToText=function(k){switch(k){case Y.CONST:return Ia.get("constant","\u5e38\u91cf");case Y.PARAM:return Ia.get("param","\u53c2\u6570");case Y.VARIABLE:return Ia.get("variant","\u53d8\u91cf")}};var oa={LEFT:"LEFT",RIGHT:"RIGHT",INNER:"INNER",FULL:"FULL"};Ra.GenericQueryJoinType=oa;oa.ALL_JOIN_TYPE=[oa.LEFT,oa.RIGHT="RIGHT",oa.INNER="INNER",
oa.FULL="FULL"];oa.typeToText=function(k){switch(k){case oa.LEFT:return Ia.get("leftJoin","\u5de6\u5173\u8054");case oa.RIGHT:return Ia.get("rightJoin","\u53f3\u5173\u8054");case oa.INNER:return Ia.get("innerJoin","\u5185\u5173\u8054");default:return Ia.get("fullJoin","\u5168\u5173\u8054")}};oa.typeToIconName=function(k,c){switch(k){case oa.LEFT:k="leftjoin";break;case oa.RIGHT:k="rightjoin";break;case oa.INNER:k="innerjoin";break;default:k="fulljoin"}c&&(k+=c+"x");return k};var aa={ASC:"ASC",DESC:"DESC"};
Ra.GenericQueryOrderType=aa;aa.toString=function(k){return k==aa.ASC?Ia.get("ascending","\u5347\u5e8f"):Ia.get("descending","\u964d\u5e8f")};aa.ALL_TYPE=[aa.ASC,aa.DESC];var r={SQL:"SQL",KSQL:"KSQL"};Ra.GenericQueryUserSqlType=r;Oa.KEY_TABLE="TABLE";Oa.BASE_WIDTH=180;Oa.BASE_HEIGHT=40;Oa.SUB_TABLES="subTables";Oa.COLUMNS="columns";Oa.CALC_COLS="calcCols";Oa.FILTERS="filters";Oa.ORDERS="orders";Oa.ARR_KEYS=[Oa.SUB_TABLES,Oa.COLUMNS,Oa.CALC_COLS,Oa.FILTERS,Oa.ORDERS];Oa.SUB_TABLE_PERFIX="sub_table_";
Oa.ENEITY_SPLITOR="@#!&@";Oa.splitEntityPath=function(k){return k.split(Oa.ENEITY_SPLITOR)};Oa.checkTableName=function(k,c,b){if(c.getAlias().toUpperCase()!=k.toUpperCase()){var a=c.isUnionTable()?Ia.get("tableName","\u8868\u540d"):Ia.get("alias","\u5225\u540d");k=k.trim();if(!k)return Ia.get("emptyText","#1\u4e0d\u53ef\u4e3a\u7a7a\u3002").replace("#1",a);if(k.length>kb.iMAX_COLUMN_LEN)return Ia.get("textLenLimit","#1\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc732\u4e2a\u5b57\u7b26\u3002").replace("#1",a);
if(!kb.isValidString(k))return Ia.get("invalidText","#1\u4e0d\u80fd\u4ee5\u6570\u5b57\u3001\u4e0b\u5212\u7ebf\u5f00\u5934\uff0c\u4e14\u4e0d\u80fd\u5305\u542b\u4ee5\u4e0b\u7279\u6b8a\u7b26\u53f7\uff1a#2").replace("#1",a).replace("#2","!@#$%^&*?~+-=()[]{}<>\\/|.,:;`'\"");var e={};if(b&&b.isUnionTable()&&-1!=b.getSubTables().indexOf(c))for(c=b.getSubTables(),b=0;b<c.length;b++)e[c[b].getAlias().toUpperCase()]=!0;else e=c.getModel().getTableAliasMap();if(e[k.toUpperCase()])return Ia.get("repeatText",
"\u91cd\u590d\u7684#1\uff1a#2\u3002").replace("#1",a).replace("#2",k)}};gb.KEY_JOIN="JOIN";gb.findFirstMatchedField=function(k,c,b){var a=k.getAllColumnsMap();k=k.getAllColumns();c=c.getAllColumns();for(var e=0;e<c.length;e++){var d=c[e];if(a[d.getName()]){var g=new Za(b);g.setLeftField(a[d.getName()].getName());g.setRightField(d.getName());break}}g||(g=new Za(b),0<k.length&&g.setLeftField(k[0].getName()),0<c.length&&g.setRightField(c[0].getName()));return g};mb.EMPTY=new mb;mb.copyBasicInfo=function(k,
c,b){for(var a=[],e=0;e<k.length;e++){var d=mb.newInstance(k[e],c,b);a.push(d)}return a};mb.newInstance=function(k,c,b){c=new mb(c);c.setName(k.getName());c.setAlias(k.getAlias());c.setDataType(k.getDataType());b&&(c.setSourceTable(b),c.setSourceField(k));return c};ya.FORMULA_DELIMITER="\x00";Ra.CalcColCheckHelper=z;var z=new function(){this.checkCalcCol=function(c,b){if(!c.isEmpty())return c.isCalculatingFieldInvalid()?Ia.get("invalidCalculatingField","\u8ba1\u7b97\u5b57\u6bb5\u3010#1\u3011\u65e0\u6548").replace("#1",
c.getAlias()):(c=k(c,b))?c:null};var k=function(c,b){var a=c.getReferences();if(a&&0<a.length){b=b?b:c.getModel();for(var e=c.getModel(),d=0;d<a.length;d++){var g=a[d],m=g.split(ya.FORMULA_DELIMITER);if(1===m.length){m=m[0];var q=b.getColumn(m);if(!q||q.check())return a=(a=c.getRefColumn(g))?a.getAlias():m,Ia.get("invalidCFFieldRef","\u8ba1\u7b97\u5b57\u6bb5\u3010#1\u3011\u5f15\u7528\u7684\u5b57\u6bb5\u3010#2\u3011\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664").replace("#1",c.getAlias()).replace("#2",
a)}else{q=m[0];m=m[1];var l=e.getTableById(q);if(!l)return Ia.get("invalidCFTableRef","\u8ba1\u7b97\u5b57\u6bb5\u3010#1\u3011\u5f15\u7528\u7684\u8868\u3010#2\u3011\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664").replace("#1",c.getAlias()).replace("#2",q);q=l.getColumn(m);if(!q||q.check())return a=(a=c.getRefColumn(g))?a.getAlias():m,Ia.get("invalidCFFieldRef","\u8ba1\u7b97\u5b57\u6bb5\u3010#1\u3011\u5f15\u7528\u7684\u5b57\u6bb5\u3010#2\u3011\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664").replace("#1",
c.getAlias()).replace("#2",a)}}}else if("undefined"===typeof a)return Ia.get("invalidCalculatingField1","\u8ba1\u7b97\u5b57\u6bb5\u65e0\u6548");return null}},t=new function(){var k=this;this.checkFiltersValue=function(b){for(var a=[],e=0;e<b.length;e++){a.push(null);var d=b[e];d.isEmpty()||(a[e]=c(d))}return a};this.checkFiltersLogical=function(b){for(var a=[],e=!1,d=0,g=-1,m,q=m=0;q<b.length;q++)b[q].isEmpty()||(m=q);for(q=0;q<b.length;q++){a.push(null);var l=b[q];if(!l.isEmpty()){d+=l.getLeftBrackets()?
l.getLeftBrackets():0;d-=l.getRightBrackets()?l.getRightBrackets():0;0>g&&0!=d&&(g=q);0>d&&!e&&(e=!0,a[g]=Ia.get("bracketMismatch","\u8fc7\u6ee4\u8868\u8fbe\u5f0f\u4e0d\u5b8c\u6574\uff0c\u5de6\u53f3\u62ec\u53f7\u4e0d\u5339\u914d\u3002"));if(q!==m&&!l.getLogicOp()){var V=Ia.get("lackLogicalSymbol","\u7b2c#1\u884c\u7f3a\u5c11\u903b\u8f91\u7b26\u3002").replace("#1",q+1);a[q]=V}q==m&&l.getLogicOp()&&(V=Ia.get("logicalSymbolUnnecessary","\u5b58\u5728\u591a\u4f59\u7684\u903b\u8f91\u3002"),a[q]=V)}}0<d&&
(V=Ia.get("bracketMismatch","\u8fc7\u6ee4\u8868\u8fbe\u5f0f\u4e0d\u5b8c\u6574\uff0c\u5de6\u53f3\u62ec\u53f7\u4e0d\u5339\u914d\u3002"),a[g]=V);return a};this.checkFilterItem=function(b){if(b.isEmpty())return null;var a=c(b);if(a)return a;a=b.getFromFilters();b=a.indexOf(b);return-1!=b?k.checkFiltersLogical(a)[b]:null};var c=function(b){var a=b.getCompareOp(),e=b.getField(),d=b.getRelativeDateRange(),g=b.getValue(),m=b.getValueMode();if(!(e||a||d||g||m))return null;if(!e)return Ia.get("missField","\u5b57\u6bb5\u4e0d\u5b58\u5728\u3002");
var q=b.getColumn();if(!q&&/^F\d{13,}$/.test(e))return Ia.get("reSelectMissAnyField","\u5b57\u6bb5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");if(!q||q===mb.EMPTY||q.getException())return Ia.get("reSelectMissField","\u5b57\u6bb5\u201c#1\u201d\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002").replace("#1",e);if(q.isCalcColumn()&&(e=q.getCalcCol())&&(e=e.check()))return e;q=q.getDataType();if(-1==jb.getAvailableCompares(q).indexOf(a))return Ia.get("unMatchCompare",
"\u6bd4\u8f83\u7b26\u4e0d\u5339\u914d\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");if(!jb.isCompareOpWithoutValue(a)){if(!g&&!d)return Ia.get("lackValue","\u8fc7\u6ee4\u8868\u8fbe\u5f0f\u4e0d\u5b8c\u6574\uff0c\u7f3a\u5c11\u503c\u3002");if(m==Y.CONST&&!K.checkValue(q,g))if(jb.isCompareOpWithinOrNotWithinValue(a)){if(!g)return Ia.get("lackValue","\u8fc7\u6ee4\u8868\u8fbe\u5f0f\u4e0d\u5b8c\u6574\uff0c\u7f3a\u5c11\u503c\u3002");b=g.split(I.SPLIT);for(a=0;a<b.length;a++)if(!K.checkValue(q,b[a]))return Ia.get("wrongType",
"\u6570\u636e\u7c7b\u578b\u4e0d\u5339\u914d\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u3002")}else{if(q===K.DATE?(b=b.getDateByString(g),a=new tb,a.setFormatString("yyyy-MM-dd"),g=a.format(b)):q===K.DATETIME&&(b=b.getDateByString(g),a=new tb,a.setFormatString("yyyy-MM-dd HH:mm:ss"),g=a.format(b)),!K.checkValue(q,g))return Ia.get("wrongType","\u6570\u636e\u7c7b\u578b\u4e0d\u5339\u914d\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u3002")}else if(m==Y.PARAM){b=b.getParameterByValue();if(!b)return Ia.get("reSelectParameter",
"\u53c2\u6570\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");if(b.getException())return Ia.get("errorParam","\u53c2\u6570\u8bbe\u7f6e\u5b58\u5728\u9519\u8bef\uff0c\u8bf7\u68c0\u67e5\u8be5\u53c2\u6570\u3002")}}return null}};Ra.FilterCheckHelper=t;jb.isCompareOpWithoutValue=function(k){return k===U.NULL||k===U.NOT_NULL};jb.isCompareOpRelativeDateRangeValue=function(k){return k===U.RELATIVE_DATE_RANGE};jb.isCompareOpWithinOrNotWithinValue=function(k){return k===
U.IN||k===U.NOT_IN};jb.isDateTimeType=function(k){return k===K.DATE||k===K.DATETIME};jb.isBoolType=function(k){return k===K.BOOLEAN};jb.getAvailableCompares=function(k){switch(k){case K.BOOLEAN:return U.COMPARES_FOR_BOOLEAN;case K.INT:case K.NUMBER:return U.COMPARES_FOR_NUMBER;case K.STRING:return U.COMPARES_FOR_STRING;case K.DATETIME:case K.DATE:return U.COMPARES_FOR_DATETIME;case K.BINARY:return U.COMPARES_FOR_BINARY}};Ra.OrderCheckHelper=h;var h=new function(){this.checkOrder=function(c,b){if(!c.isEmpty())return(c=
k(c,b))?c:null};var k=function(c,b){var a=c.getField(),e=c.getOrder();if(!a)return Ia.get("missField","\u5b57\u6bb5\u4e0d\u5b58\u5728");if(!e)return Ia.get("lackOfOrderType","\u6ca1\u6709\u9009\u62e9\u6392\u5e8f\u65b9\u5f0f");c=b?b.getColumn(a):c.getModel().getColumn(a);return!c||c.check()?/^F\d{13,}$/.test(a)?Ia.get("reSelectMissAnyField","\u5b57\u6bb5\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002"):Ia.get("reSelectMissField","\u5b57\u6bb5\u201c#1\u201d\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002").replace("#1",
a):c.isCalcColumn()&&(a=c.getCalcCol())&&(a=a.check())?a:null}};Na.TABLE_PREFIX="table_";Na.SOURCE_PREFIX="source_";Na.SOURCES="sources";Na.TABLES="tables";Na.JOINS="joins";Na.COLUMNS="columns";Na.CALC_COLS="calcCols";Na.FILTERS="filters";Na.ORDERS="orders";Na.ARR_KEYS=[Na.SOURCES,Na.TABLES,Na.JOINS,Na.COLUMNS,Na.CALC_COLS,Na.FILTERS,Na.ORDERS];Na.buildSource=function(k,c,b){k=new Sa(k);k.init(c,b);return k};db.addDataSetModel(wb.GENERIC_QUERY_DATASET,Na);var ea=new function(){function k(e,d,g){var m=
this;this.delGenericTable=function(l){d.deleteTable(l,g)};this.getHeadWrapper=function(){return d};this.getRowWrappers=function(){return g};this.resetMapNameByCols=function(l){for(var V={},G=0;G<l.length;G++)V[l[G].getName()]=!0;for(G=0;G<g.length;G++){l=g[G];var pa=l.getBenchmark().getName();V[pa]&&l.resetMapName()}};this.syncToModel=function(){var l=m.getHeadWrapper(),V=m.getRowWrappers(),G=l.getHeadLen();q();if(1==G)l=l.getHeadTable(0),e.toSingle(l);else{var pa=[],ma={},Aa={};V.forEach(function(Pa){Pa.isSelected()?
pa.push(Pa.transToUnionCol(ma,Aa,e)):Pa.resetMapName()});e.setColumns(pa);e.setSubTables([].concat(l.getArrTable()))}};var q=function(){for(var l=m.getHeadWrapper(),V=m.getRowWrappers(),G=l.getHeadLen(),pa=0;pa<G;pa++){for(var ma=l.getHeadTable(pa),Aa=[],Pa=0;Pa<V.length;Pa++){var ca=V[Pa],la=ca.getGenericColByIdx(pa);la&&!ca.isSubColDeleted(la)&&Aa.push(la)}ma.setColumns(Aa)}};this.cancelSelectedRow=function(l){for(var V=0;V<g.length;V++){var G=g[V];if(G.getBenchmark().getMapName()==l.getName()){G.setSelected(!1);
break}}};this.syncColInSubTable=function(l,V,G){l=d.getTableIdx(l);if(-1!=l){for(var pa={},ma=0;ma<V.length;ma++)pa[V[ma].getName()]=V[ma];for(ma=0;ma<g.length;ma++){var Aa=g[ma],Pa=Aa.getGenericColByIdx(l);Pa&&(-1==G.indexOf(Pa)||Pa.getMapName()||1!=Aa.getNonNullSize()?pa[Pa.getName()]&&(Pa=pa[Pa.getName()],Aa.setGenericColByIdx(l,Pa),V.splice(V.indexOf(Pa),1)):(g.splice(ma,1),ma--))}for(ma=0;ma<V.length;ma++)G=V[ma],Aa=new Xa(d),Aa.initArrColByIndex(l,G),Aa.setSelected(!1),g.push(Aa)}};this.addSubTable=
function(l){d.pushUnionTable(l);l=[].concat(l.getColumns());for(var V={},G=0;G<g.length;G++){var pa=g[G],ma=pa.getBenchmark();V[ma.getName()]=pa;pa.pushGenericCol(null)}for(G=0;G<l.length;G++)ma=l[G],(pa=V[ma.getMapName()])&&pa.isSelected()?pa.setGenericColByIdx(d.getHeadLen()-1,ma):(pa=new Xa(d),pa.initArrColByIndex(d.getHeadLen()-1,ma),pa.setSelected(null!=ma.getMapName()),g.push(pa))};this.collectUnionFieldByTable=function(l){l=d.getArrTable().indexOf(l);var V=[];if(-1!=l)for(var G=0;G<g.length;G++){var pa=
g[G].getGenericColByIdx(l);pa&&pa.getMapName()&&V.push(pa)}return V};this.clone=function(){for(var l=d.clone(),V=[],G=0;G<g.length;G++)V.push(g[G].clone(l));return new k(e,l,V)}}this.build=function(e,d,g){var m=null,q=[];g?(m=new fb([d,e],!0),q=c(d,e,m)):e.isUnionTable()&&(d=e.getSubTables(),m=new fb([].concat(d)),m.setUnionTable(e),q=b(d,m));return new k(e,m,q)};var c=function(e,d,g){var m=[];e=e.getColumns();var q=d.getColumnsMap(),l=d.getColumns().concat();e.forEach(function(V,G){(G=q[V.getName()])&&
l.splice(l.indexOf(G),1);var pa=new Xa(g);pa.setArrGenericCols([V,G]);m.push(pa)});l.forEach(function(V,G){G=new Xa(g);G.setArrGenericCols([null,V]);m.push(G)});0==m.length&&(d=new Xa(g),d.setArrGenericCols([null,null]),m.push(d));return m},b=function(e,d){var g=[],m=[],q=[];e.forEach(function(ma){ma=ma.getColumns();var Aa={},Pa={};ma.forEach(function(ca){var la=ca.getMapName();la?Aa[la]=ca:Pa[ca.getName()]=ca});g.push(Aa);m.push(Pa);q.push(ma.concat())});e=[];for(var l=0;l<q.length;l++)for(var V=
q[l],G=0;G<V.length;G++){var pa=a(d,V[G],l,g,m,q);e.push(pa)}return e},a=function(e,d,g,m,q,l){var V=[];V.fill(null,0,e.getHeadLen());V[g]=d;var G=d.getMapName()?!0:!1;for(g+=1;g<e.getHeadLen();g++){var pa=G?m[g][d.getMapName()]:q[g][d.getName()];if(V[g]=pa){var ma=l[g];ma.splice(ma.indexOf(pa),1)}}e=new Xa(e);e.setArrGenericCols(V);e.setSelected(G);return e}};Ra.UnionFieldHelperBuilder=ea})();(function(){function Ca(b,a){ub.call(this,b,a);var e=this,d,g,m,q;this.resize=function(){g&&g.resize()};this.fireTabChangeEvent=function(){e.model2Ui()};this.protectedInit=function(l){m=$("<div>");m.css("overflow","hidden");m.appendTo(l);gb.layoutCtrlWithLRTB(m,0,0,null,0,0,null)};this.protectedUpdateUi=function(){d=e.getDataSetModelVO().getDataSetModel();g=e.getTableRender(a,d);q||(q=g.getJqUI(),q.appendTo(m));g.updateTable()};this.getTableRender=function(l,V){throw Error("override me");};this.getDataSetModel=
function(){return d}}function sa(){qb.call(this);this.protectInitTable=function(){throw Error("override me");};this.updateTable=function(b){throw Error("override me");};this.resize=function(){throw Error("override me");};this.trimTable=function(b){for(var a=b.length-1;0<=a;a--)if(b[a].isEmpty())b.splice(a,1);else break};this.refreshPrompt=function(b,a){for(var e=b.getRowsCount(),d=db.getHeadRowCount();d<e;d++){var g=b.getRow(d),m=g.getUserObject().check();g.getCell(a).setValue(m?m:"")}};this.addOpBtn=
function(b,a,e){var d=$("<div>");d.text(a);d.addClass("generic-table-op-child");d.appendTo(b);d.on("click",e)}}function Fa(b){function a(ia){KTDefaultCellRender.call(this,ia);var n=this,u=this.paintCellUI;this.paintCellUI=function(y,ra){var Ka=n.getCell(),Wa=n.getCurrentRowIdx(),ib=n.getCurrentRow(),nb=n.getCurrentColIdx(),ta=ib.getUserObject(),Ja=$(y);if(1===Wa&&1===nb)u(y,ra),ta=$("<span>"),Pa(ta,"calcField"),ta.addClass("wizard-output-calc-icon"),ta.attr("title",ya.get("newCalcCol","\u65b0\u5efa\u8ba1\u7b97\u5b57\u6bb5")),
gb.layoutCtrlWithLRTB(ta,null,5,16,4,null,16),Ja.append(ta),ta.on("click",function(Ta){Ta=new Y(e);Ta.setName("F"+(new Date).getTime());ma(Ta)});else if(Wa<db.getHeadRowCount())u(y,ra);else if(1===nb){ra=Ka.getValue();Ka=ta.getSourceTable();y=G(ra);if(ta.isCalcColumn())Ja.empty(),(ra=ta.getCalcCol())&&ra.check()&&Ja.append(V(ra.getAlias(),ra.check())),Q(Ja,ta),p(Ja,ta),y.css({width:"calc(100% - 60px)"});else{if(Ka&&Ka.getSourceOrTableException()){Ja.empty();Ja.append(V(ra,ya.get("srcOrTbError","\u6570\u636e\u8868\u5b58\u5728\u9519\u8bef\uff0c\u60a8\u65e0\u6cd5\u6b63\u5e38\u4f7f\u7528\u8be5\u5b57\u6bb5\u3002")));
Ja.append(y);return}if(ta.check()){Ja.empty();Ja.append(V(ra));Ja.append(y);p(Ja,ta);return}}Ja.append(y)}else 2===nb?l(Ja,Ka,ta):3===nb?ca(y,ib,ta,n.getCellWidth(),n.getCellHeight()):(Ja.empty(),Ka&&(ta=Ka.getValue(),Ja.append(pa(ta))))};var p=function(y,ra){var Ka=$("<span>");Ka.attr("title",ya.get("delField","\u5220\u9664\u5b57\u6bb5"));Ka.addClass("wizard-field-del-btn");K.background(Ka,"delete");Ka.on("click",function(){if(ra.isCalcColumn()){var Wa=Ia.createFeedbackDialog();Wa.setMsgImageType(Ia.MSG_CONFIRM);
Wa.setMessage(ya.get("delCalcCol","\u5220\u9664\u8ba1\u7b97\u5b57\u6bb5\u201c#1\u201d\u540e\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u786e\u5b9a\u5220\u9664\u8be5\u8ba1\u7b97\u5b57\u6bb5\u5417\uff1f").replace("#1",ra.getAlias()));Wa.setClosingChecker(function(ib){ib==Ia.RETURN_OK&&f(ra);return!0});Wa.showDialog()}else f(ra)});Ka.appendTo(y)},f=function(y){var ra=y.getSourceTable();y.isCalcColumn()&&y.IsModelCalcCol()?(e.deleteColumn(y),g.updateTable()):(ra.deleteColumn(y),ra&&d.fireEvent(vb.COLS_AREA_DEL_COL,
ra))},Q=function(y,ra){var Ka=$("<span>");Ka.attr("title",ya.get("editing","\u7f16\u8f91"));Ka.addClass("wizard-field-edit-btn");K.background(Ka,"edit");Ka.on("click",function(){ma(ra.getCalcCol(),!0)});Ka.appendTo(y)}}sa.call(this);var e,d=b,g=this,m,q;this.getJqUI=function(){q||g.protectInitTable();return q};this.setDataSetModel=function(ia){e=ia};this.resize=function(){m&&db.refresh(m)};this.protectInitTable=function(){m=db.createTable();var ia=new a(m);ia.setOutsideVisible(!1);m.setCellRender(ia);
ia=new rb;ia.setColumnNotDraggable([0]);ia.setColumnMinWidth([50,150,150,85,150,150]);m.setDraggableAdjusting(!0,3,0,ia);m.addColumns(6);ia=m.getColumn(0);var n=m.getColumn(1),u=m.getColumn(2),p=m.getColumn(3),f=m.getColumn(4),Q=m.getColumn(5);ia.setWidth(60);n.setWidth(200);u.setWidth(200);p.setWidth(150);f.setWidth(200);Q.setWidth(200);ia=db.createHeadRow(m);ia.getCell(0).setValue(ya.get("NO","\u5e8f\u53f7"));ia.getCell(1).setValue(ya.get("fieldName","\u5b57\u6bb5\u540d\u79f0"));ia.getCell(2).setValue(ya.get("displayName",
"\u663e\u793a\u540d\u79f0"));ia.getCell(3).setValue(ya.get("dataType","\u6570\u636e\u7c7b\u578b"));ia.getCell(4).setValue(ya.get("tableSource","\u6765\u6e90\u8868"));ia.getCell(5).setValue(ya.get("fieldSource","\u6765\u6e90\u5b57\u6bb5"));m.setSyncUIWhenModelChanged(!0);db.bindTextEditor(m,Ba,ha);db.bindTableListenerForCtrl(m);q&&q.remove();q=$(m.getUI())};this.updateTable=function(){m.setSyncUIWhenModelChanged(!1);db.clearWithoutHead(m);var ia=e?e.getAllColumns():[],n=0;if(ia)for(var u=0,p=ia.length;u<
p;u++,n++){var f=ia[u],Q=n,y=db.createRow(m);y.setUserObject(f);var ra=y.getCell(0),Ka=ra.getStyle();Ka||(Ka=new KTStyle);Ka.setTextAlign("center");ra.setStyle(Ka);ra.setValue(Q+1);f.isCalcColumn()?(y.getCell(1).setValue(ya.get("calcColLabel","(\u8ba1\u7b97\u5b57\u6bb5)")),Q=f.getSourceColumnAlias(),y.getCell(5).setValue(Q?Q:f.getAlias())):(y.getCell(5).setValue(f.getSourceField().getName()),y.getCell(1).setValue(f.getName()));y.getCell(2).setValue(f.getAlias());y.getCell(3).setValue(f.getDataType());
f.isCalcColumn()&&f.IsModelCalcCol()||y.getCell(4).setValue(f.getSourceTableAlias())}m.setSyncUIWhenModelChanged(!0);db.refresh(m)};var l=function(ia,n,u){ia.empty();ia.css("cursor","pointer");var p=$("<div>");n=n.getValue();u=u.getSourceColumnAlias();p.text(n);n=ya.get("aliasShow","\u663e\u793a\u540d\u79f0\uff1a#1").replace("#1",n);u=ya.get("srcAliasShow","\u539f\u59cb\u663e\u793a\u540d\u79f0\uff1a#1").replace("#1",u);p.attr("title",n+"\n"+u);p.addClass("wizard-output-alias-input");p.appendTo(ia)},
V=function(ia,n){var u=qa.createWarning();u.addClass("wizard-field-error-icon");u.attr("title",n?n:ya.get("loseField","\u5b57\u6bb5#1\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664").replace("#1",ia));return u},G=function(ia){var n=$("<span>");n.text(ia);n.addClass("wizard-field-error-name");n.attr("title",ia);return n},pa=function(ia){var n=$("<span>");n.text(ia);n.addClass("wizard-normal-value");n.attr("title",ia);return n},ma=function(ia,n){var u=!0,p=null,f,Q,y=ia.isTableCalc();if(y){var ra=
ia.getFromTable();var Ka=ra.getCalcCols();var Wa=ra.getColsJsons();ra=ra.getAllColumns()}else Ka=e.getCalcCols(),Wa=e.getColsJsons(),ra=e.getAllColumns();var ib=d.createDesignerFacade(function(Ja){var Ta=Ja.ok,bb=Ja.errorPosition,ob=Ja.errorPrompt;f=Ja.dataType;Q=Ja.reference;p(Ta,bb,ob);u||(n=!0,ta(!0))});ib.setShowBlocking(!1);var nb=new $a;nb.setContext(ra,ia,n);nb.setFieldIconProvider(function(Ja,Ta,bb){return g.doPaintIcon(Ja,Ta,bb)});nb.setSyntaxValidator(function(Ja,Ta,bb){p=bb;bb=[].concat(Ka);
n||bb.push(ia);ib.checkCalcFormula(Ta,Ja,Wa,bb)});var ta=function(Ja){u=!1;f=f?f.toLowerCase():I.NUMBER;ia.setOriginDataType(f);ia.setDataType(f);ia.collectSrcTable(Q);ia.setSourceField(nb.getEditedDisplayName());var Ta=e.getCalcCols();if(!n)e.setLegalStringInDataSetCols([ia]),Ta.push(ia);else if(0<Ta.length){if(!y){for(var bb=[],ob=0;ob<Ta.length;ob++){var xb=Ta[ob];xb&&xb.getName()!==ia.getName()&&bb.push(xb)}e.setLegalColNames([ia],bb)}bb={};for(ob=0;ob<Ta.length;ob++)xb=Ta[ob],xb.getName()!==
ia.getName()&&(bb[xb.getName()]=!0);Ta=e.getColumns();for(ob=0;ob<Ta.length;ob++)xb=Ta[ob],xb.getName()!==ia.getName()&&(bb[xb.getName()]=!0);bb=kb.replaceIllegalChar(ia.getAlias(),bb,"COLUMN");ia.setAlias(bb);y&&(bb=ia.getFromTable(),bb.syncColsToDataSet(),d.fireEvent(vb.CALC_MODEFIED_FROM_FIELD_AREA,bb))}Aa(Ja,Wa,Ka)};nb.edit(ta)},Aa=function(ia,n,u){if(u&&0!==u.length){var p=d.createDesignerFacade(function(f){if(f=f.map)for(var Q=0;Q<u.length;Q++){var y=f[u[Q].getName()].valid;u[Q].setCalculatingFieldInvalid(!y)}g.updateTable()});
p.setShowBlocking(!ia);p.checkAllFormulas(n,u)}},Pa=function(ia,n){K.background(ia,n);ia.on("mouseenter",function(){K.background(ia,n+"_hover")});ia.on("mouseleave",function(){K.background(ia,n)})},ca=function(ia,n,u,p,f){n=u.getDataType();ia=db.createCtrlInCell(ia,p,f,jb);ia.setItemModels(I.GENERIC_ALL_DATA_TYPES);ia.setUserObject(u);ia.setDropdownMinWidth(120);ia.setCustomPainter(function(Q,y,ra){var Ka=$("<div>"),Wa=u.getDataType();g.doPaintIcon(Ka,ra,!Q&&Wa===ra);Ka.addClass("dataset-fields-select-field-dataType-icon");
y.append(Ka);Ka=I.dataTypeToName(ra);Wa=$("<div>");Wa.addClass("dataset-fields-select-field-dataType-text");var ib=u.getOriginalDataType();Q||ib!==ra||(Ka=Ka+"("+ya.get("original","\u539f\u59cb")+")");Wa.text(Ka);Wa.attr("title",Ka);y.append(Wa)});ia.addSelectedChangedListener(la);ia.setSelected(n)},la=function(ia,n,u){n!==u&&(n=ia.getUserObject(),n.setDataType(u),n.isCalcColumn()&&n.getCalcCol().setDataType(u),ia.setItemModels(I.GENERIC_ALL_DATA_TYPES),ia.setSelected(u))},Ba=function(ia,n){return 2===
n},ha=function(ia,n,u,p,f){if(!(0>m.getColumnIndex(n))){ia=ia.getUserObject();if(p&&0!==p.length){if(32<p.length)return u=ya.get("displayTooLong32","\u663e\u793a\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc732\u4e2a\u5b57\u7b26\u3002"),d.getMessageCurtain().showPrompt(u),!1;if(kb.isValidString(p)){n=e.getColumns();f=0;for(var Q=n.length;f<Q;f++){var y=n[f],ra=y.getAlias();if(ia!==y&&ra&&p.toLowerCase()===ra.toLowerCase())return u=ya.get("duplicatedName","\u91cd\u590d\u7684\u663e\u793a\u540d\u79f0\uff1a#1\u3002").replace("#1",
p),d.getMessageCurtain().showPrompt(u),!1}}else return u=ya.get("invalidDisplayName","\u663e\u793a\u540d\u79f0\u4e0d\u80fd\u4ee5\u6570\u5b57\u3001\u4e0b\u5212\u7ebf\u5f00\u5934\uff0c\u4e14\u4e0d\u80fd\u5305\u542b\u4ee5\u4e0b\u7279\u6b8a\u7b26\u53f7\uff1a#1\u3002").replace("#1","!@#$%^&*?~+-=()[]{}<>\\/|.,:;`'\""),d.getMessageCurtain().showPrompt(u),!1}else return u=ya.get("displayEmpty","\u663e\u793a\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\u3002"),d.getMessageCurtain().showPrompt(u),!1;ia.isCalcColumn()&&
ia.IsModelCalcCol()&&ia.getCalcCol().setAlias(p);u.setValue(p);ia.setAlias(p);return!0}}}function Sa(b,a){function e(){Ra.call(this);var da=this,Ha=this.protectedMethod,wa;this.edit=function(Da,Ea,Ma){Ha.setTitle(ya.get("relativeDate1","\u76f8\u5bf9\u65e5\u671f"));wa||(da.setSize(450,430),wa=new wb,wa.setContainsTime(Ea),Ea=new mb,Ea.fromJsonObject(Da.toJsonObject()),wa.setModel(Ea),Ha.setContentPaneCreator(function(){return wa.getJqUi()}),Ha.setClosingAction(function(Va){Va&&(Va=wa.getModel(),Ma(Va))}))}}
function d(){Ra.call(this);var da=this,Ha=this.protectedMethod,wa=new Xa,Da=new Xa,Ea=new tb,Ma,Va;this.setCaption=function(cb,pb){Ha.setTitle(cb);wa.setText(pb)};this.setText=function(cb,pb){Ea.setText(cb);var zb=0;cb&&(cb=cb.split("\n").length,zb=1E3<cb?1E3:cb);Da.setText(zb+"/1000\u9879");Va=function(Jb){var Mb=Jb?$.trim(Ea.getText()):null;pb(Jb,Mb)};Ha.setClosingAction(Va)};this.showDialogLeftAnchorTo=function(cb){cb&&(da.setSize(450,430),cb=gb.upwardCoordinate(document.body,[0,0],document.body),
da.setPosition(Math.max(0,cb[0]-10),Math.max(6,cb[1]-430+40)));Ea.addEditedListener(Ya);Ha.setContentPaneCreator(eb);da.showDialog();Ea.requestFocus()};this.setClosingChecker=function(cb){cb&&(Ma=function(){var pb=cb($.trim(Ea.getText()));pb&&Ha.getMessageCurtain().showPrompt(pb);return!pb},Ha.setClosingChecker(Ma))};var eb=function(){Da.setAlign(Xa.ALIGN_RIGHT);gb.layoutCtrlWithLRTB(wa.getJqUi(),0,0,null,0,null,23);gb.layoutCtrlWithLRTB(Ea.getJqUi(),0,0,null,30,null,260);gb.layoutCtrlWithLRTB(Da.getJqUi(),
290,0,null,287,null,23);var cb=$("<div>");cb.append(wa.getJqUi());cb.append(Ea.getJqUi());cb.append(Da.getJqUi());return cb},Ya=function(cb){var pb=cb.getText(),zb=[];pb&&(zb=pb.trim().replace(/(\n\s*)+/g,"\n").split("\n"));pb=zb.length;1E3<pb&&(cb.setText(zb.slice(0,1E3).join("\n")),pb=1E3);Da.setText(pb+"/1000\u9879");Ha.getMessageCurtain().hide()}}function g(da){KTDefaultCellRender.call(this,da);var Ha=this,wa=this.paintCellUI;this.paintCellUI=function(Da,Ea){if(Ha.getCurrentRowIdx()<db.getHeadRowCount()||
!Ha.getCell())wa(Da,Ea);else{var Ma=Ha.getCellWidth(),Va=Ha.getCellHeight(),eb=Ha.getCurrentRow(),Ya=Ha.getCurrentColIdx();1===Ya||5===Ya?(Ea=1===Ya,Ya=Ha.getCell().getValue(),ob(Da,Ma,Va,Ea,Ya,eb)):2===Ya?(Ea=Ha.getCell().getValue(),Ya=new lb,Ya.setSelectionListener(la),Ya.doPaint(q,Da,Ma,Va,eb,Ea)):3===Ya?(Ea=Ha.getCell().getValue(),Ya=eb.getUserObject().getDataType(),Va=db.createCtrlInCell(Da,Ma,Va,jb),Va.setSelected(Ea),Va.setItemModels(Ya?X.getAvailableCompares(Ya):[]),Va.setUserObject(eb),Va.setDropdownMinWidth(100),
Va.setCustomPainter(ia),Va.addSelectedChangedListener(ha)):4===Ya?(Ha.getCell().getValue(),Da=$(Da),Da.empty(),Da.css("cursor",""),Ma=eb.getUserObject(),Ea=Ma.getCompareOp(),X.isCompareOpWithoutValue(Ea)?Ma.setValueMode(null):Ma.getField()&&p(Da,Va,eb)):6===Ya?(Ea=Ha.getCell().getValue(),xb(Da,Ma,Va,Ea,eb)):0===Ya?(eb=Ha.getCell().getValue(),Va=$(Da),Va.empty(),eb&&(Da=qa.createWarning(),Da.addClass("wizard-filter-prompt-icon"),Da.attr("title",eb),Da.appendTo(Va))):wa(Da,Ea)}}}sa.call(this);var m=
this,q=a,l,V,G;this.getJqUI=function(){l||m.protectInitTable();return l};this.setDataSetModel=function(da){q=da};this.getDataSetModel=function(){return q};this.resize=function(){G&&db.refresh(G)};this.protectInitTable=function(){G=db.createTable();db.bindTableListenerForCtrl(G,Aa);var da=new rb;da.setColumnNotDraggable([0]);da.setColumnMinWidth([80,50,150,80,150,50,50,80]);G.setDraggableAdjusting(!0,3,0,da);da=new g(G);da.setOutsideVisible(!1);G.setCellRender(da);G.addColumns(8);G.getColumn(0).setWidth(20);
G.getColumn(1).setWidth(100);G.getColumn(2).setWidth(180);G.getColumn(3).setWidth(100);G.getColumn(4).setWidth(220);G.getColumn(5).setWidth(100);G.getColumn(6).setWidth(60);G.getColumn(7).setWidth(100);da=db.createHeadRow(G);da.getCell(1).setValue(ya.get("leftBracket1","\u5de6\u62ec\u53f7"));da.getCell(2).setValue(ya.get("field","\u5b57\u6bb5"));da.getCell(3).setValue(ya.get("compare","\u6bd4\u8f83"));da.getCell(4).setValue(ya.get("value","\u503c"));da.getCell(5).setValue(ya.get("rightBracket1","\u53f3\u62ec\u53f7"));
da.getCell(6).setValue(ya.get("logic","\u903b\u8f91"));l&&l.remove();l=$(G.getUI());G.setSyncUIWhenModelChanged(!0)};this.updateTable=function(){var da=q?q.getFilters():[];m.trimTable(da);pa(q)};var pa=function(da){db.clearWithoutHead(G);da=da?da.getFilters():[];for(var Ha=da.length,wa=Math.max(4,Ha),Da=0;Da<wa;Da++){if(Da<Ha)var Ea=da[Da];else Ea=ma(),da.push(Ea);var Ma=db.createRow(G);Ma.setUserObject(Ea);var Va=Ea.check();Ma.getCell(0).setValue(Va?Va:"");Ma.getCell(1).setValue(Ea.getLeftBrackets());
Va=q.getColumn(Ea.getField());Ea.isEmpty()||Va?Ma.getCell(2).setValue(Va?Va:z.EMPTY):(Va=new z(Ea.getModel()),Va.setAlias(Ea.getAlias()),Ma.getCell(2).setValue(Va));Ma.getCell(3).setValue(Ea.getCompareOp());X.isCompareOpRelativeDateRangeValue(Ea.getCompareOp())?Ma.getCell(4).setValue(Ea.getRelativeDateRange()?Ea.getRelativeDateRange():""):Ma.getCell(4).setValue(Ea.getValue()?Ea.getValue():"");Ma.getCell(5).setValue(Ea.getRightBrackets());Ma.getCell(6).setValue(Ea.getLogicOp())}db.refresh(G)},ma=function(){if(q instanceof
D)return new X(q);if(q instanceof r)return new X(q.getModel(),q)},Aa=function(da,Ha,wa,Da){if(q){da=null;if(Ha){Ha=KTableUIAbstractView.createCellId(G.getRow(wa),G.getColumn(7));da=l.find("#"+Ha);da.addClass("generic-table-op-container");var Ea=wa-db.getHeadRowCount();m.addOpBtn(da,ya.get("insert","\u63d2\u5165"),function(){var Ma=q,Va=ma();Ma.getFilters().splice(Ea,0,Va);pa(Ma)});m.addOpBtn(da,ya.get("del","\u5220\u9664"),function(){var Ma=q;Ma.getFilters().splice(Ea,1);pa(Ma)})}else V&&V.find(".generic-table-op-child").remove();
V=da}},Pa=function(da,Ha,wa){da=da.getUserObject();da.getUserObject().setLeftBrackets(wa);da.getCell(1).setValue(wa);m.refreshPrompt(G,0)},ca=function(da,Ha,wa){da=da.getUserObject();da.getUserObject().setRightBrackets(wa);da.getCell(5).setValue(wa);m.refreshPrompt(G,0)},la=function(da){var Ha=da.getSelectedModel();da=da.getUserObject();var wa=da.getUserObject(),Da=wa.getDataType(),Ea=Ha.getDataType();wa.setField(Ha.getName());wa.clearException();da.getCell(2).setValue(Ha);if(Da!==Ea){Ha=wa.getCompareOp();
var Ma=X.getAvailableCompares(Ea);Ha&&Ma.includes(Ha)||(Ha=ja.EQUAL);if(X.isDateTimeType(Da)!==X.isDateTimeType(Ea)||X.isBoolType(Da)!==X.isBoolType(Ea))wa.setValue(null),wa.setDisplayValue(null),wa.setRelativeDateRange(null);wa.setCompareOp(Ha);Ba(da.getCell(3),Ha);Ba(da.getCell(4),wa.getValue())}m.refreshPrompt(G,0)},Ba=function(da,Ha){da.setValue(""===Ha?" ":"");da.setValue(Ha)},ha=function(da,Ha,wa){da=da.getUserObject();var Da=da.getUserObject();Da.setCompareOp(wa);da.getCell(3).setValue(wa);
wa!==ja.RELATIVE_DATE_RANGE&&Da.setRelativeDateRange(null);if(X.isCompareOpWithoutValue(Ha)!==X.isCompareOpWithoutValue(wa)||X.isCompareOpRelativeDateRangeValue(Ha)!==X.isCompareOpRelativeDateRangeValue(wa)||X.isCompareOpWithinOrNotWithinValue(Ha)!==X.isCompareOpWithinOrNotWithinValue(wa))Da.setValue(null),Da.setDisplayValue(null),Da.setRelativeDateRange(null),da.getCell(4).setValue(" ");Ba(da.getCell(4),Da.getValue());m.refreshPrompt(G,0)},ia=function(da,Ha,wa){da=ja.compareOpToText(wa);Ha.text(da);
Ha.attr("title",da)},n=function(da,Ha){var wa=Ha.getUserObject(),Da=wa.getCompareOp(),Ea=[];try{var Ma=wa.getValue();Ma&&(Ea=Ma.split(k.SPLIT))}catch(Va){}wa=Ea?Ea.join("\n"):"";Ea=new d;Ma=ya.get("propertyAlias","\u7cbe\u786e\u5339\u914d\u591a\u503c\uff0c\u5404\u9879\u4e4b\u95f4\u4f7f\u7528\u56de\u8f66\u4f5c\u4e3a\u5206\u9694\u7b26");Da=Da===ja.IN?ya.get("within","\u5728......\u4e4b\u5185"):ya.get("without","\u4e0d\u5728......\u4e4b\u5185");Ea.setCaption(Da,Ma);Ea.setClosingChecker(function(Va){if(Va&&
5E4<Va.length)return ya.get("matchTooLong","\u5339\u914d\u9879\u4e0d\u80fd\u8d85\u8fc750000\u4e2a\u5b57\u7b26")});Ea.setText(wa,function(Va,eb){Va&&(u(da,eb,Ha),m.refreshPrompt(G,0))});Ea.showDialogLeftAnchorTo(da.getJqUi())},u=function(da,Ha,wa){var Da=wa.getUserObject();null!=Ha&&da.setModel(Ha.replace(/(\n\s*)+/g,","));da=Da.getValue();if(null==Ha||!da||JSON.stringify(da.split(k.SPLIT))!==JSON.stringify(Ha.split("\n")))if(null!=Ha&&""!==Ha){Ha=JSON.parse(JSON.stringify(Ha.split("\n")));var Ea=
[];Ha&&Ha.forEach(function(Ma){""!==Ma.trim()&&Ea.push(Ma)});Ha=Ea.join(k.SPLIT);Da.setValue(Ha);wa.getCell(4).setValue(Ha)}else Da.setValue(null),wa.getCell(4).setValue(null)},p=function(da,Ha,wa){da.empty();var Da=wa.getUserObject(),Ea=f(wa,Ha),Ma=Q(wa,Ha);Ea&&(Ea.addSelectedChangedListener(function(Va,eb,Ya){eb!==Ya&&(Da.setValueMode(Ya),Ma.remove(),Da.setValue(""),Ma=Q(wa,Ha),da.append(Ma),m.refreshPrompt(G,0))}),da.append(Ea.getJqUi()));da.append(Ma)},f=function(da,Ha){var wa=da.getUserObject();
if(wa.getCompareOp()!==ja.RELATIVE_DATE_RANGE){da=new jb;var Da=wa.getValueMode();Da||(Da=oa.CONST);wa.setValueMode(Da);da.setItemModels([oa.CONST,oa.PARAM,oa.VARIABLE]);da.setSelected(Da);da.setDropdownMinWidth(50);da.setCustomPainter(function(Ea,Ma,Va){Ea=oa.typeToText(Va);Ma.text(Ea);Ma.attr("title",Ea)});wa=da.getJqUi();wa.removeClass("sa-ctrl-common-background_enabled");wa.addClass("wizard-filter-value-ctrl-valueMode");wa.css("height",Ha-2+"px");return da}},Q=function(da,Ha){var wa=da.getUserObject(),
Da=wa.getCompareOp();if(Da===ja.RELATIVE_DATE_RANGE)return ra(Ha,da);var Ea=wa.getValueMode();wa=wa.getDataType();switch(Ea){case oa.CONST:if(Da===ja.IN||Da===ja.NOT_IN)return y(Ha,da);if(wa===I.BOOLEAN)return Wa(da,Ha);if(wa===I.DATE||wa===I.DATETIME){Da=da.getUserObject();Ea=Da.getDataType()===I.DATETIME?new Na:new yb;wa=new Date;var Ma=Da.getValue();Ma=Ma?parseInt(Ma):null;isNaN(Ma)||null==Ma?(Da.setValue(""+wa.getTime()),m.refreshPrompt(G,0)):wa.setTime(Ma);Ea.setDateObject(wa);Ea.setUserObject(da);
Ea.addModelChangedListener(Ta);da=Ea.getJqUi();da.addClass("wizard-filter-value-ctrl-paddingLeft");da.css({width:"calc(100% - 58px)",height:Ha-2});return da}return Ka(da,Ha);case oa.PARAM:return ib(da,Ha);case oa.VARIABLE:return nb(da,Ha)}},y=function(da,Ha){var wa=new fb;wa.setClearable(!0);var Da=wa.getJqUi();Da.addClass("wizard-filter-value-ctrl-valueSetting");Da.css("height",da-2+"px");wa.getJqUi().find(".sa-ctrl-f7selector-text").on("click",function(){n(wa,Ha)});wa.addActionListener(function(Ma){n(wa,
Ha)});var Ea=Ha.getUserObject();wa.addClearListener(function(){Ea.setValue("");m.refreshPrompt(G,0)});(da=Ea.getValue())&&da.trim()&&wa.setModel(da.split(k.SPLIT).join(","));return Da},ra=function(da,Ha){var wa=Ha.getUserObject(),Da=wa.getRelativeDateRange(),Ea="",Ma=wa.getDataType()===I.DATETIME;Da instanceof mb?Ea=wb.modelToDisplayText(Da,Ma):(Da=new mb,Da.setPeriod(mb.PERIOD_DAY),Da.setWhichPeriod(0),wa.setRelativeDateRange(Da));var Va=new fb,eb=Va.getJqUi();eb.addClass("wizard-filter-value-ctrl-valueSetting-full");
eb.css("height",da-2+"px");Va.setModel(Ea);eb.find(".sa-ctrl-f7selector-text").on("click",function(){var cb=Da,pb=Ya,zb=new e;zb.edit(cb,Ma,pb);zb.showDialog()});Va.addActionListener(function(){var cb=Da,pb=Ya,zb=new e;zb.edit(cb,Ma,pb);zb.showDialog()});var Ya=function(cb){wa.setRelativeDateRange(cb);wa.setValueMode("");Va.setModel(wb.modelToDisplayText(cb,Ma));Ha.getCell(4).setValue(cb);m.refreshPrompt(G,0)};return eb},Ka=function(da,Ha){var wa=da.getUserObject(),Da=new Ab;da=wa.getValue();Da.setText(da?
da:"");Da.setPlaceholder(ya.get("enterValue","\u8bf7\u8f93\u5165\u503c"));Da.addEditedListener(function(){wa.setValue(Da.getText().trim())});Da.addBlurListener(function(){m.refreshPrompt(G,0)});da=Da.getJqUi();da.addClass("wizard-filter-value-ctrl-paddingLeft");da.css("height",Ha-2+"px");var Ea=Ja();Ea.on("mousedown",function(eb){eb.stopPropagation();Da.setText("");wa.setValue("");m.refreshPrompt(G,0)});var Ma=da.find("input");Ma.css({overflow:"hidden","text-overflow":"ellipsis"});var Va=!1;Ma.on("focus",
function(){Va=!0;setTimeout(function(){var eb=wa.getValue();eb&&(Ma[0].setSelectionRange(eb.length,eb.length),Ma[0].scrollLeft=Ma[0].scrollWidth)},100)});Da.addBlurListener(function(){Va=!1;Ea.hide();Ma.css("padding","0px 4px 0px 4px");Ma[0].scrollLeft=0});da.on("mouseleave",function(){Va||(Ea.hide(),Ma.css("padding","0px 4px 0px 4px"))});da.on("mouseenter",function(){Ea.show();Ma.css("padding","0px 21px 0px 4px")});Ea.hide();da.append(Ea);return da},Wa=function(da,Ha){var wa=da.getUserObject(),Da=
new jb,Ea=wa.getValue();Da.setItemModels(["true","false"]);Da.setUserObject(da);Da.setDropdownMinWidth(120);Da.setSelected("true"===Ea?"true":"false");Da.setCustomPainter(function(Ma,Va,eb){wa.setValue(eb);Ma="true"===eb?ya.get("true","\u771f"):ya.get("false","\u5047");Va.text(Ma)});Da.addSelectedChangedListener(function(Ma,Va,eb){Va!==eb&&(Ma.getUserObject().getUserObject().setValue(eb),m.refreshPrompt(G,0))});da=Da.getJqUi();da.addClass("wizard-filter-value-ctrl-paddingLeft");da.css({width:"calc(100% - 58px)",
height:Ha-2});return da},ib=function(da,Ha){var wa=da.getUserObject(),Da=new jb,Ea=wa.getModel().getParameters();wa=wa.getValue();Da.setUserObject(da);Da.setDropdownMinWidth(120);var Ma;if(Ea&&0<Ea.length&&(Da.setItemModels(Ea),wa))for(da=0;da<Ea.length;da++)wa===Ea[da].getName()&&(Ma=Ea[da]);Ma||(Ma=wa);Da.setSelected(Ma);Da.setCustomPainter(function(Va,eb,Ya){if(Ya instanceof ea){var cb=$("<span>"),pb=Ya.getDataType();pb=h.dataTypeToIconName(pb);var zb=Da.getSelected();!Va&&zb&&Ya===zb&&(pb+="_selected");
K.background(cb,pb);cb.addClass("dataset-fields-select-field-dataType-icon");eb.append(cb);Va=Ya.getName();cb=Ya.getAlias();Ya=Va;cb&&(Ya=cb+"("+Va+")");Va=$("<div>");Va.addClass("dataset-fields-select-field-dataType-text");Va.text(Ya);Va.attr("title",Ya);eb.append(Va)}else Ya?eb.text(Ya):(Ya=$("<span>"),Ya.css("color","#aaa"),Ya.text(ya.get("selectParam","\u8bf7\u9009\u62e9\u4e00\u4e2a\u53c2\u6570")),eb.append(Ya))});Da.addSelectedChangedListener(function(Va,eb,Ya){eb=Va.getUserObject().getUserObject();
var cb=Ya.getName(),pb=Ya.getAlias();eb.setValue(cb);eb.setDisplayValue(pb);Va.setItemModels(Ea);Va.setSelected(Ya);m.refreshPrompt(G,0)});Ma=Da.getJqUi();Ma.addClass("wizard-filter-value-ctrl-paddingLeft");Ma.css({width:"calc(100% - 58px)",height:Ha-2});return Ma},nb=function(da,Ha){var wa=da.getUserObject(),Da=new fb;da=Da.getJqUi();var Ea=wa.getValue(),Ma=wa.getDisplayValue();Ea&&(Ea.startsWith("@")||Ea.startsWith("$"))&&Ma?Da.setModel(Ma):(Ea=da.find(".sa-ctrl-f7selector-text"),Ma=$("<span>"),
Ma.css("color","#aaa"),Ma.text(ya.get("pickVar","\u8bf7\u9009\u62e9\u4e00\u4e2a\u53d8\u91cf")),Ea.append(Ma));da.find(".sa-ctrl-f7selector-text").on("click",function(){ta(Da,wa,wa.getValue())});Da.addActionListener(function(){ta(Da,wa,wa.getValue())});da.addClass("wizard-filter-value-ctrl-paddingLeft");da.css({width:"calc(100% - 58px)",height:Ha-2});return da},ta=function(da,Ha,wa){wa=new c(b,!1,wa);wa.setFunSelectCallBack(function(Da,Ea){Ha.setValue(Ea);Ha.setDisplayValue(Da);da.setModel(Da);m.refreshPrompt(G,
0)});wa.showDialog()},Ja=function(){var da=$("<span>");da.attr("title",ya.get("clear","\u6e05\u7a7a"));da.addClass("wizard-filter-value-del-btn");K.background(da,"delete");return da},Ta=function(da){var Ha=""+da.getDateObject().getTime();da.getUserObject().getUserObject().setValue(Ha);m.refreshPrompt(G,0)},bb=function(da,Ha,wa){da=da.getUserObject();da.getUserObject().setLogicOp(wa);da.getCell(6).setValue(wa);m.refreshPrompt(G,0)},ob=function(da,Ha,wa,Da,Ea,Ma){da=db.createCtrlInCell(da,Ha,wa,jb);
da.setSelected(Ea);da.setItemModels([0,1,2,3,4]);da.setUserObject(Ma);da.setDropdownMinWidth(100);da.setCustomPainter(function(Va,eb,Ya){Va=Da?"(":")";for(var cb="",pb=0;pb<Ya;pb++)cb+=Va;eb.text(cb)});da.addSelectedChangedListener(Da?Pa:ca)},xb=function(da,Ha,wa,Da,Ea){da=db.createCtrlInCell(da,Ha,wa,jb);da.setSelected(Da?Da:null);da.setItemModels([null,U.AND,U.OR]);da.setUserObject(Ea);da.setDropdownMinWidth(50);da.setCustomPainter(function(Ma,Va,eb){Va.text(U.logicOpToText(eb))});da.addSelectedChangedListener(bb)}}
function Oa(b){function a(Aa){KTDefaultCellRender.call(this,Aa);var Pa=this,ca=this.paintCellUI;this.paintCellUI=function(la,Ba){var ha=Pa.getCell();if(Pa.getCurrentRowIdx()<db.getHeadRowCount()||!ha)ca(la,Ba);else{Ba=Pa.getCurrentRow();var ia=Pa.getCurrentColIdx();ha=Pa.getCellWidth();var n=Pa.getCellHeight();if(1===ia){ia=Pa.getCell().getValue();var u=new lb;u.setSelectionListener(G);u.doPaint(d,la,ha,n,Ba,ia,!0,ma)}else 2===ia?(ia=Pa.getCell().getValue(),pa(la,ha,n,Ba,ia)):0===ia&&(Ba=Pa.getCell().getValue(),
la=$(la),la.empty(),Ba&&(ha=qa.createWarning(),ha.addClass("wizard-filter-prompt-icon"),ha.attr("title",Ba),ha.appendTo(la)))}}}sa.call(this);var e=this,d,g,m,q;this.getJqUI=function(){m||e.protectInitTable();return m};this.getDataSetModel=function(){return d};this.setDataSetModel=function(Aa){d=Aa};this.resize=function(){g&&db.refresh(g)};this.protectInitTable=function(){g=db.createTable();db.bindTableListenerForCtrl(g,V);var Aa=new a(g);Aa.setOutsideVisible(!1);g.setCellRender(Aa);g.setDraggableAdjusting(!0,
0,0);g.addColumns(4);Aa=g.getColumn(0);var Pa=g.getColumn(1),ca=g.getColumn(2),la=g.getColumn(3);Aa.setWidth(20);Pa.setWidth(250);ca.setWidth(250);la.setWidth(250);Aa=db.createHeadRow(g);Aa.getCell(1).setValue(ya.get("orderField","\u6392\u5e8f\u5b57\u6bb5"));Aa.getCell(2).setValue(ya.get("orderType","\u6392\u5e8f\u65b9\u5f0f"));Aa.getCell(3).setValue(ya.get("operation","\u64cd\u4f5c"));g.setSyncUIWhenModelChanged(!0);m&&m.remove();m=$(g.getUI())};this.updateTable=function(){var Aa=d?d.getOrders():
[];e.trimTable(Aa);l()};var l=function(){db.clearWithoutHead(g);for(var Aa=d?d.getOrders():[],Pa=Aa.length,ca=Math.max(4,Pa),la=0;la<ca;la++){if(la<Pa)var Ba=Aa[la];else Ba=new aa(d),Aa.push(Ba);var ha=db.createRow(g);ha.setUserObject(Ba);var ia=Ba.check();ha.getCell(0).setValue(ia?ia:"");ia=d.getColumn(Ba.getField());Ba.isEmpty()||ia?ha.getCell(1).setValue(ia?ia:z.EMPTY):(ia=new z(Ba.getModel()),ia.setAlias(Ba.getAlias()),ha.getCell(1).setValue(ia));ha.getCell(2).setValue(Ba.getOrder())}db.refresh(g)},
V=function(Aa,Pa,ca,la){if(d){Aa=null;if(Pa){Pa=KTableUIAbstractView.createCellId(g.getRow(ca),g.getColumn(3));Aa=m.find("#"+Pa);Aa.addClass("generic-table-op-container");var Ba=ca-db.getHeadRowCount();e.addOpBtn(Aa,ya.get("insert","\u63d2\u5165"),function(){var ha=d,ia=new aa(ha);ha.getOrders().splice(Ba,0,ia);l()});0<Ba&&e.addOpBtn(Aa,ya.get("up","\u4e0a\u79fb"),function(){if(0!==Ba){var ha=d.getOrders(),ia=ha[Ba-1];ha[Ba-1]=ha[Ba];ha[Ba]=ia;l()}});e.addOpBtn(Aa,ya.get("del","\u5220\u9664"),function(){d.getOrders().splice(Ba,
1);l()})}else q&&q.find(".generic-table-op-child").remove();q=Aa}},G=function(Aa){var Pa=Aa.getSelectedModel();Aa=Aa.getUserObject();var ca=Aa.getUserObject();ca.setField(Pa.getName());ca.clearException();if(!ca.getOrder()){ca.setOrder(t.ASC);ca=Aa.getCell(2);var la=t.ASC;ca.setValue(""===la?" ":"");ca.setValue(la)}Aa.getCell(1).setValue(Pa);e.refreshPrompt(g,0)},pa=function(Aa,Pa,ca,la,Ba){Aa=db.createCtrlInCell(Aa,Pa,ca,jb);Aa.setItemModels([t.ASC,t.DESC]);Aa.setUserObject(la);!la.getUserObject().isEmpty()&&
Ba&&Aa.setSelected(Ba===t.ASC?Ba:t.DESC);Aa.setCustomPainter(function(ha,ia,n){n?(ha=n===t.ASC?ya.get("ascending","\u5347\u5e8f"):ya.get("descending","\u964d\u5e8f"),ia.text(ha)):ia.text("")});Aa.addSelectedChangedListener(function(ha,ia,n){ia!==n&&(ha.getUserObject().getUserObject().setOrder(n),e.refreshPrompt(g,0))});Aa.getJqUi().css({height:ca-2})},ma=function(){var Aa=d.getOrders();if(Aa&&0<Aa.length){for(var Pa=[],ca=0;ca<Aa.length;ca++)Pa.push(Aa[ca].getField());return Pa}return[]}}"undefined"==
typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.extreport&&(com.kingdee.bos.extreport={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner&&(com.kingdee.bos.extreport.datasetdesigner={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner.wizard&&(com.kingdee.bos.extreport.datasetdesigner.wizard={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner.wizard.output&&
(com.kingdee.bos.extreport.datasetdesigner.wizard.output={});var Za=com.kingdee.bos.extreport.datasetdesigner.wizard.output;Za.TabColumnPane=function(b){Ca.call(this,ya.get("field","\u5b57\u6bb5"),b);var a;this.getTableRender=function(e,d){a||(a=new Fa(e,d));a.setDataSetModel(d);return a}};Za.TabFilterPane=function(b){Ca.call(this,ya.get("filter","\u8fc7\u6ee4"),b);var a;this.getTableRender=function(e,d){a||(a=new Sa(e));a.setDataSetModel(d);return a}};Za.TabOrderPane=function(b){Ca.call(this,ya.get("order",
"\u6392\u5e8f"),b);var a;this.getTableRender=function(e,d){a||(a=new Oa(e));a.setDataSetModel(d);return a}};Za.GenericDataSetFilterRender=Sa;var gb,mb,ya,jb,yb,Na,fb,Xa,Ra,tb,Ab,Ia,kb,vb,ub,qb,lb,rb,$a,db,wb,qa,K,I,X,ja,U,D,Y,oa,aa,r,z,t,h,ea,k,c;(function(){var b=com.kingdee.bos.qing.common;gb=b.DomUtil;mb=b.RelativePeriodModel;b=com.kingdee.bos.qing.framework.common;ya=b.MultilanguageManager.createPackageAccessor(com.kingdee.bos.extreport.datasetdesigner);b=com.kingdee.bos.extreport.datasetdesigner.common;
kb=b.StringUtil;vb=b.EventType;b=com.kingdee.bos.extreport.datasetdesigner.common.ui;ub=b.AbstractDataSetTabPane;qb=b.DataTypeIconPainter;lb=b.FieldDropPainter;rb=b.TableCustomExpandor;$a=b.CalcFieldEditor;b=com.kingdee.bos.qing.ui.component;jb=b.ComboBox;yb=b.DateSelector;Na=b.DateTimeSelector;fb=b.F7Selector;Xa=b.Label;Ra=b.AbstractModalDialog;tb=b.TextArea;Ab=b.TextField;Ia=b.MessageDialog;b=com.kingdee.bos.qing.common.ui;db=b.TableUtil;wb=b.RelativePeriodPanel;qa=b.CommonIconUtil;b=com.kingdee.bos.extreport.datasetdesigner;
K=b.Icons;b=com.kingdee.bos.extreport.datasetdesigner.model;I=b.OutputColumDataType;h=b.ParamDataType;ea=b.Parameter;k=b.ParamDefaultValueType;b=com.kingdee.bos.extreport.datasetdesigner.generic.model;X=b.GenericQueryFilter;ja=b.GenericQueryCompareOp;U=b.GenericQueryLogicOp;D=b.GenericQueryDataSetModel;Y=b.GenericQueryCalcCol;oa=b.GenericQueryValueMode;aa=b.GenericQueryOrder;r=b.GenericQueryTable;z=b.GenericQueryColumn;t=b.GenericQueryOrderType;b=com.kingdee.bos.extreport.datasetdesigner.ctrl;c=b.MacroAndSysTemVarSelectDialog})()})();(function(){function Ca(){var A=this,B,J;this.getJqUi=function(){B||(B=$("<div>"),B.addClass("wizard-prop"),A.protectedInit(B));return B};this.refreshUi=function(){B||(B=$("<div>"),B.addClass("wizard-prop"));B.empty();A.protectedInit(B)};this.protectedInit=function(){throw Error("override");};this.getNodeStatusMonitor=function(){return J};this.setNodeStatusMonitor=function(C){J=C};this.setGenericModel=function(){throw Error("Override");};this.createNewArea=function(C){var Z=$("<div>"),R=$("<div>");
R.text(C);R.addClass("wizard-prop-title");Z.addClass("wizard-prop-area");Z.append(R);return Z};this.decorateRow=function(C,Z,R,W){var E=$("<div>");C&&(C=C.getJqUi(),C.addClass("wizard-prop-row-label"),Z&&C.attr("title",Z),W&&C.css("width","100%"),E.append(C));R&&(Z=R.getJqUi(),Z.addClass("wizard-prop-row-ctrl"),W&&Z.css("width","100%"),E.append(Z),ha.makeTextOmissible(Z));E.addClass("wizard-prop-row");return E}}function sa(A){Ca.call(this);var B=this,J,C,Z,R,W=!1;this.protectedInit=function(N){W=
C.getSourceOrTableException()?!0:!1;(C.isUnionTable()?new Sa(A,B):new Fa(A,B)).protectedInitArea(N);L(N);na(N);S(N)};var E;this.updateOrderTable=function(){clearTimeout(E);E=setTimeout(function(){Z&&Z.updateTable()},0)};this.setGenericModel=function(N){J=N.getModel();C=N};this.getDataSetModel=function(){return J};this.getTableModel=function(){return C};this.getArrSourceModel=function(){return C.getTableSource()};this.isErrorInTableOrSource=function(){return W};var L=function(N){var ba=B.createNewArea(h.get("calcCol",
"\u8ba1\u7b97\u5b57\u6bb5")),v=$("<div>");C.getCalcCols().forEach(function(T){ba.append(H(T))});var x=(new ia).measureWidth(h.get("newCalcCol","\u65b0\u5efa\u8ba1\u7b97\u5b57\u6bb5"));v.text(h.get("newCalcCol","\u65b0\u5efa\u8ba1\u7b97\u5b57\u6bb5"));W?v.addClass("wizard-prop-add-calc-col-invalid"):(v.on("click",function(){var T=new p(J,C);T.setName("F"+(new Date).getTime());F(C.getAllColumns(),T,!1)}),v.addClass("wizard-prop-add-calc-col"));v.css("width",x+20);ba.append(v);N.append(ba)},F=function(N,
ba,v){var x=!0,T=null,O,M,fa=A.createDesignerFacade(function(xa){var Qa=xa.ok,Ua=xa.errorPosition,ka=xa.errorPrompt;O=xa.dataType;M=xa.reference;T(Qa,Ua,ka);x||(v=!0,La(!0))},function(){}),ua=new zb;ua.setContext(N,ba,v,J.getAllColumns());ua.setFieldIconProvider(function(xa,Qa,Ua){Qa=b.dataTypeToIconName(Qa);Ua&&(Qa+="_selected");k.background(xa,Qa)});ua.setSyntaxValidator(function(xa,Qa,Ua){T=Ua;fa.setShowBlocking(!1);Ua=[].concat(C.getCalcCols());v||Ua.push(ba);fa.checkCalcFormula(Qa,xa,C.getColsJsons(),
Ua,C.getId())});var La=function(){x=!1;O=O?O.toLowerCase():b.NUMBER;ba.setOriginDataType(O);ba.setDataType(O);ba.collectSrcTable(M);var xa=C.getCalcCols();v?(C.syncColsToDataSet(),w()):(xa.push(ba),C.syncColsToDataSet(),B.refreshUi(),B.getNodeStatusMonitor().notifyListener(Ra.KEY_NODE_CALC_CHANGE,C))};ua.edit(La)},w=function(N){var ba=C.getColsJsons(),v=C.getCalcCols();if(v&&0!==v.length){var x=A.createDesignerFacade(function(T){if(T=T.map)for(var O=0;O<v.length;O++){var M=T[v[O].getName()].valid;
v[O].setCalculatingFieldInvalid(!M)}C.checkProps([n.CALC_COLS,n.FILTERS,n.ORDERS]);B.refreshUi();B.getNodeStatusMonitor().notifyListener(Ra.KEY_NODE_CALC_CHANGE,C)});x.setShowBlocking(!N);x.checkAllFormulas(ba,v,C.getId())}},H=function(N){var ba=$("<div>"),v=$("<div>"),x=$("<div>"),T=$("<div>"),O=$("<div>");T.hide();O.hide();var M=0,fa=N.check(),ua=cb.createWarning();ua.attr("title",fa);ba.append(ua);ha.layoutCtrl(ua,10,8);fa&&(M=20);!fa&&ua.hide();ba.addClass("generic-calc-row");ba.on("mouseenter",
function(){!W&&T.show();!W&&O.show();ba.addClass("generic-calc-row-hover");ha.layoutCtrlWithLRTB(x,30+M,40,null,0,0,null)});ba.on("mouseleave",function(){T.hide();O.hide();ba.removeClass("generic-calc-row-hover");ha.layoutCtrlWithLRTB(x,30+M,0,null,0,0,null)});k.background(v,b.dataTypeToIconName(N.getDataType()));v.addClass("generic-calc-row-icon");ha.layoutCtrl(v,10+M,8,16,16);fa=N.getAlias();x.text(fa);x.addClass("generic-calc-row-alias");ba.attr("title",fa);ha.layoutCtrlWithLRTB(x,30+M,0,null,
0,0,null);Fb.backgroundWithHover(T,"edit");T.on("click",function(){F(C.getAllColumns(),N,!0)});ha.layoutCtrlWithLRTB(T,null,22,16,7,null,16);Fb.backgroundWithHover(O,"del");O.on("click",function(){var La=l.createFeedbackDialog();La.setMsgImageType(l.MSG_CONFIRM);La.setMessage(h.get("delCalcCol","\u5220\u9664\u8ba1\u7b97\u5b57\u6bb5\u201c#1\u201d\u540e\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u786e\u5b9a\u5220\u9664\u8be5\u8ba1\u7b97\u5b57\u6bb5\u5417\uff1f").replace("#1",N.getAlias()));La.setClosingChecker(function(xa){xa==
l.RETURN_OK&&(C.delCalcCol(N),C.checkProps([n.CALC_COLS,n.FILTERS,n.ORDERS]),C.syncColsToDataSet(),B.getNodeStatusMonitor().notifyListener(Ra.KEY_NODE_CALC_CHANGE,C),B.refreshUi());return!0});La.showDialog()});ha.layoutCtrlWithLRTB(O,null,2,16,7,null,16);ba.append(v);ba.append(x);ba.append(T);ba.append(O);W&&(T.hide(),O.hide());return ba},na=function(N){R=B.createNewArea(h.get("filter","\u8fc7\u6ee4"));var ba=h.get("filterCondition","\u8fc7\u6ee4\u6761\u4ef6"),v=new e(ba),x=new G,T=Db.getErrorIcon(h.get("filterError",
"\u8fc7\u6ee4\u6761\u4ef6\u5b58\u5728\u9519\u8bef\uff0c\u8bf7\u4fee\u6539\u8fc7\u6ee4\u6761\u4ef6\u3002"));T.hide();W?x.setEnabled(!1):C.checkProps([n.FILTERS])&&T.show();x.setCustomPainter(function(O){return O&&0!=O.length?h.get("haveSet","\u5df2\u8bbe\u7f6e"):h.get("unset","\u672a\u8bbe\u7f6e")});x.addActionListener(function(O){O=new tb;O.setWizardTable(C);O.setGlobal(A);O.setFunCloseCallBack(function(M){C.setFilters(M);C.checkProps([n.FILTERS])?T.show():T.hide();x.setModel(C.getFilters());B.getNodeStatusMonitor().notifyListener(Ra.KEY_NODE_FILTER_CHANGE,
C)});O.showDialog()});x.setModel(C.getFilters());T.addClass("wizard-prop-filter-error");ba=B.decorateRow(v,ba,x);ba.append(T);R.append(ba);N.append(R)},S=function(N){var ba=B.createNewArea(h.get("order","\u6392\u5e8f"));N.append(ba);Z=new qa(C);Z.setEnabled(!W);Z.setNodeStatusMonitor(B.getNodeStatusMonitor());N=Z.getJqUi();N.addClass("generic-order-table");ba.append(N);setTimeout(function(){Z.updateTable()},0)}}function Fa(A,B){var J;this.protectedInitArea=function(R){C(R)};var C=function(R){J=B.createNewArea(h.get("dataTable",
"\u6570\u636e\u8868"));var W=B.getArrSourceModel()[0],E=W.getDataSourceType(),L=B.getTableModel(),F=B.isErrorInTableOrSource(),w=B.getDataSetModel(),H=h.get("dataSource","\u6570\u636e\u6e90"),na=y.getTableLabel(E),S=h.get("alias","\u522b\u540d"),N=h.get("selectedField","\u5df2\u9009\u5b57\u6bb5"),ba=new e(H),v=new e(na),x=new e(S),T=new e(N),O=new q,M=new q,fa=new q,ua=new G;O.setEnabled(!1);O.setText(W.getDisplayName());if(y.isSwitchable(E)){var La=$("<div>");La.show();Fb.backgroundWithHover(La,
"switch");La.on("click",function(){var ka=new Y(A);ka.setSourceModel(W);ka.setTableModel(L);ka.showDialog()});La.attr("title",h.get("changeSource","\u66f4\u6362\u6570\u636e\u6e90"));ha.layoutCtrlWithLRTB(La,null,2,16,8,null,16);O.getJqUi().append(La);La=O.protectedMethod.getJqInput();ha.layoutCtrlWithLRTB(La,0,20,"auto");ha.makeTextOmissible(La)}if(!y.isOutDB(E)){var xa=y.getSrcLabel(E);La=new e(xa);var Qa=new q;Qa.setEnabled(!1);Qa.setReadonly(!0);xa=B.decorateRow(La,xa,Qa);var Ua=W.getName();La=
A.createQueryFacade(function(ka){ka&&(Ua=ka)},function(){return!0},function(){Qa.setText(Ua)});La.setBlockingJqUi(xa);La.getTableSrcName(W.toJsonObject())}M.setEnabled(!1);M.setReadonly(!0);E=E==y.ENTITY?Sb.getEntityNumber(W.getName()):L.getSourceTableDisplayText();M.setText(E);F&&fa.setEnabled(!1);fa.setText(L.getAlias());fa.addBlurListener(function(ka){Z(ka,!0)});fa.addAcceptableListener(function(ka){Z(ka,!1)});ha.makeTextOmissible(fa.protectedMethod.getJqInput());F&&ua.setEnabled(!1);ua.setCustomPainter(function(ka){if(ka){if(1<
ka.length)return h.get("selectedMoreFields","\u5df2\u9009\u62e9#1\u7b49#2\u4e2a\u5b57\u6bb5").replace("#1",ka[0].getAlias()).replace("#2",ka.length);if(1==ka.length)return h.get("setField","\u5df2\u9009\u62e9\u5b57\u6bb5#1").replace("#1",ka[0].getAlias())}return""});ua.addActionListener(function(){var ka=new Za(A,W,L);ka.setArrSelected(L.getColumns());ka.setCloseCallBack(function(va,P){ua.setModel(va);for(var za=0;za<va.length;za++)va[za].setModel(w);L.setName(P);L.setColumns(va);L.syncColsToDataSet();
L.checkProps([n.COLUMNS,n.CALC_COLS,n.FILTERS,n.ORDERS]);B.refreshUi(R);B.getNodeStatusMonitor().notifyListener(Ra.KEY_NODE_FIELDS_RESELECT,L)});ka.showDialog()});ua.setModel(L.getColumns());J.append(B.decorateRow(ba,H,O));xa&&J.append(xa);J.append(B.decorateRow(v,na,M));J.append(B.decorateRow(x,S,fa));J.append(B.decorateRow(T,N,ua));R.append(J)},Z=function(R,W){var E=R.getText(),L=n.checkTableName(E,B.getTableModel());L?(A.getMessageCurtain().showPrompt(L,2E3),W&&R.setText(B.getTableModel().getAlias())):
(B.getTableModel().setAlias(E.trim()),B.getNodeStatusMonitor().notifyListener(Ra.KEY_NODE_RENAME,B.getTableModel()))}}function Sa(A,B){var J;this.protectedInitArea=function(L){C(L)};var C=function(L){J=B.createNewArea(h.get("union","\u5408\u5e76"));var F=B.getTableModel(),w=h.get("tableName","\u8868\u540d"),H=h.get("unionSet","\u5408\u5e76\u8bbe\u7f6e"),na=new e(w),S=new e(H),N=new q,ba=new G,v=cb.createWarning();v.attr("title",h.get("unionSetWarn","\u5408\u5e76\u8bbe\u7f6e\u5b58\u5728\u9519\u8bef\u3002"));
!F.checkUnionConfig()&&v.hide();N.setText(F.getAlias());N.addBlurListener(function(x){E(x,!0)});N.addAcceptableListener(function(x){E(x,!1)});ba.setCustomPainter(function(x){return x&&0!=x.length?h.get("haveSet","\u5df2\u8bbe\u7f6e"):h.get("unset","\u672a\u8bbe\u7f6e")});ba.addActionListener(function(x){var T=F.getSubTables().length;x=new ub;x.setGenericTable(F);x.setCloseCallBack(function(O,M,fa){O=O.getDelSubTables();M.getModel();for(var ua=0;ua<O.length;ua++)Hb.deleteSubTable(O[ua],M);fa.syncToModel();
M.setUnionFieldHelper(fa);M.syncColsToDataSet();M.checkProps([n.COLUMNS,n.CALC_COLS,n.FILTERS,n.ORDERS]);B.refreshUi();B.getNodeStatusMonitor().notifyListener(Ra.KEY_NODE_FIELDS_RESELECT,M);T!=M.getSubTables().length&&B.getNodeStatusMonitor().notifyListener(Ra.KEY_DEL_SUBTABLE,M)});x.showDialog()});ba.setModel(F.getColumns());H=B.decorateRow(S,H,ba);v.addClass("wizard-prop-filter-error");H.append(v);J.append(B.decorateRow(na,w,N));J.append(H);L.append(J);Z(J)&&v.show()},Z=function(L){var F=!1,w=B.getTableModel(),
H=w.getSubTables();if(H&&0!=H.length)return H.forEach(function(na){var S=na.getSourceOrTableException();F=F||!!S;L.append(R(na,w,S))}),F},R=function(L,F,w){var H=$("<div>"),na=$("<div>"),S=$("<div>"),N=0;if(w){N=20;var ba=cb.createWarning();ba.attr("title",w);ha.layoutCtrl(ba,11,7);H.append(ba)}k.background(na,"table");S.text(L.getAlias());S.attr("title",L.getAlias());var v=L.getTableSource()[0];if(y.isSwitchable(v.getDataSourceType())){var x=W("switch",h.get("changeSource","\u66f4\u6362\u6570\u636e\u6e90"),
function(){var M=new Y(A);M.setSourceModel(v);M.setTableModel(L);M.showDialog()});x.addClass("generic-prop-sub-table-field");x.hide()}var T=W("edit",h.get("selectField","\u9009\u62e9\u5b57\u6bb5"),function(){var M=L.getTableSource()[0];M=new Za(A,M,L);M.setArrSelected(L.getColumns());M.setCloseCallBack(function(fa,ua){var La={};fa.forEach(function(ka){La[ka.getName()]=ka});ua=L.getColumns();fa=[];for(var xa=0;xa<ua.length;xa++){var Qa=ua[xa],Ua=Qa.getName();La[Ua]?delete La[Ua]:(fa.push(Qa),ua.splice(xa,
1),xa--)}ua=Object.values(La);L.setColumns(ua.concat(L.getColumns()));F.getUnionFieldHelper().syncColInSubTable(L,ua,fa);F.syncColsToDataSet();F.checkProps([n.COLUMNS,n.CALC_COLS,n.FILTERS,n.ORDERS]);B.refreshUi();B.getNodeStatusMonitor().notifyListener(Ra.KEY_NODE_FIELDS_RESELECT,F)});M.showDialog()});T.addClass("generic-prop-sub-table-source");T.hide();var O=W("del",h.get("del","\u5220\u9664"),function(){var M=l.createFeedbackDialog();M.setMsgImageType(l.MSG_CONFIRM);M.setMessage(h.get("delTable",
"\u5220\u9664\u6570\u636e\u8868\u201c#1\u201d\u540e\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u786e\u5b9a\u5220\u9664\u8be5\u6570\u636e\u8868\u5417\uff1f").replace("#1",L.getAlias()));M.setClosingChecker(function(fa){fa==l.RETURN_OK&&(Hb.deleteSubTable(L,F,!0),F.checkProps([n.COLUMNS,n.CALC_COLS,n.FILTERS,n.ORDERS]),B.refreshUi(),B.getNodeStatusMonitor().notifyListener(Ra.KEY_NODE_FIELDS_RESELECT,F),B.getNodeStatusMonitor().notifyListener(Ra.KEY_DEL_SUBTABLE,F));return!0});M.showDialog()});O.addClass("generic-prop-sub-table-delete");
O.hide();H.on("mouseenter",function(){x&&x.show();!w&&T.show();O.show();H.addClass("generic-prop-sub-table-row-background");ha.layoutCtrlWithLRTB(S,30+N,60,null,0,0,null)});H.on("mouseleave",function(){x&&x.hide();T.hide();O.hide();H.removeClass("generic-prop-sub-table-row-background");ha.layoutCtrlWithLRTB(S,30+N,7,null,0,0,null)});ha.layoutCtrl(na,10+N,7,16,16);ha.layoutCtrlWithLRTB(S,30+N,7,null,0,0,null);H.addClass("generic-prop-sub-table-row");H.append(na);H.append(S);H.append(O);H.append(T);
x&&H.append(x);return H},W=function(L,F,w){var H=$("<div>");k.background(H,L);Fb.backgroundWithHover(H,L);H.on("click",w);H.attr("title",F);return H},E=function(L,F){var w=B.getTableModel(),H=L.getText();H!=w.getAlias()&&(n.checkTableName(H,w)?F&&L.setText(w.getAlias()):(w.setAlias(H.trim()),B.getNodeStatusMonitor().notifyListener(Ra.KEY_NODE_RENAME,w)))}}function Oa(A){Ca.call(this);var B=this,J,C,Z,R,W;this.protectedInit=function(w){J=B.createNewArea(h.get("join","\u5173\u8054"));J.addClass("wizard-attr-join-area");
E();F();w.append(J)};this.setGenericModel=function(w){var H=w.getModel();C=w;R=H.getTableById(C.getLeftTable());W=H.getTableById(C.getRightTable())};var E=function(){var w=h.get("joinType","\u5173\u8054\u7c7b\u578b");w=(new e(w)).getJqUi();var H=$("<div>");Z=new pa;Z.addChangedListener(function(S,N){N&&(C.setJoinType(S.getUserObject()),B.getNodeStatusMonitor().notifyListener(Ra.CHANGE_JOIN_TYPE,C))});for(var na=0;na<ra.ALL_JOIN_TYPE.length;na++)H.append(L(ra.ALL_JOIN_TYPE[na],na));w.addClass("wizard-attr-join-ctrl-title");
H.addClass("wizard-attr-join-ctrl-area");J.append(w);J.append(H)},L=function(w,H){var na=new V;na.setChecked(C.getJoinType()==w);na.setUserObject(w);Z.addElement(na);var S=$("<div>"),N=na.getJqUi(),ba=$("<div>"),v=$("<div>");S.on("click",function(){na.setChecked(!0);C.setJoinType(w);B.getNodeStatusMonitor().notifyListener(Ra.CHANGE_JOIN_TYPE,C)});S.attr("title",ra.typeToText(w));v.text(ra.typeToText(w));k.background(ba,"micro_"+ra.typeToIconName(w));var x=35*parseInt(H/2)+30;ha.layoutCtrlWithLRTB(S,
0==H%2?"20px":"60%",null,null,x);S.addClass("wizard-attr-join-radio");N.addClass("wizard-attr-join-radio-ctrl");ba.addClass("wizard-attr-join-radio-icon");v.addClass("wizard-attr-join-radio-text");S.append(N);S.append(ba);S.append(v);return S},F=function(){var w=new Xa;w.setGenericJoinModel(C,R,W);w.setFunChangeLeftTableCallback(function(H){var na=H.getModel();R=na.getTableById(H.getLeftTable());var S=na.findRelatedToCurrentTables(W,!0),N={};N[H.getRightTable()]=H.getRightTable();for(H=0;H<S.length;H++)N[S[H].getId()]=
S[H].getId();S=[];var ba=na.getJoins();for(H=0;H<ba.length;H++){var v=ba[H];N[v.getRightTable()]&&(S.push(v),ba.splice(H,1),H--)}na.concatJoins(S);B.getNodeStatusMonitor().notifyListener(Ra.KEY_TARGET_JOIN_CHANGE,C)});w.setFunChangeFieldCallBack(function(){B.getNodeStatusMonitor().notifyListener(Ra.KEY_NODE_JOIN_FIELD_CHANGE,C)});w=w.getJqUi();w.addClass("wizard-attr-join-field-pane");J.append(w)}}function Za(A,B,J){a.call(this);var C=this,Z=this.protectedMethod,R,W,E=[];(function(){Z.setTitle(h.get("selectField",
"\u9009\u62e9\u5b57\u6bb5"));Z.setSelectable(!0);C.setSize(670,500);Z.getDialogCtrl().addResizeListener(function(){});Z.setContentPaneCreator(function(){var L=B.getSourceIdOfTable(J);R=new gb(A,B,L);R.setSelectedGenericCols(E);B.getDataSourceType()==y.ENTITY&&R.setSelectedEntityPath(J.getName());return R.getJqUi()});Z.setClosingAction(function(L){});Z.setClosingChecker(function(){var L=R.getSelectedCols();if(0==L.length)return Z.getMessageCurtain().showPrompt(h.get("atLeastOneField","\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b57\u6bb5")),
!1;var F=R.getMaxCount();if(L.length>F)return Z.getMessageCurtain().showPrompt(h.get("maxFields","\u81f3\u591a\u9009\u62e9#1\u4e2a\u5b57\u6bb5\u3002").replace("#1",F)),!1;F=J.getName();B.getDataSourceType()==y.ENTITY&&(F=R.getEntityTableName());for(var w=0;w<L.length;w++)L[w].setSourceTable(J);W&&W(L,F);return!0});Z.setFooterClosingOnly(!1)})();this.setArrSelected=function(L){E=L};this.setCloseCallBack=function(L){W=L}}function gb(A,B,J){jb.call(this);var C,Z=this,R,W,E=!1,L=50,F=[],w={};this.getJqUi=
function(){C||(C=$("<div>"),E=-1!=y.ARR_TREE_LEVEL_FIELD_SOURCE.indexOf(B.getDataSourceType()),Z.hookInvalidUi(C),S(C));return C};var H=function(){R=new ya;C.append(R.getJqUi())},na=function(){R=new ya;W=new mb(A);W.setSelectMenuCallback(function(O){R.updateFieldUI(O)});var T=new Aa;T.setFirstSize(200,150,250);T.setSecondSize(-1,-1,-1);T.setHorizontalSplit(!0);T.setResizeMode(Aa.RESIZE_MODE_FIRST_FIXED);T.setFirstChild(Aa.createChildWrapper(W.getJqUi()));T.setSecondChild(Aa.createChildWrapper(R.getJqUi()));
C.append(T.getJqUi());setTimeout(function(){T.resize(!0)},0)};this.setSelectedGenericCols=function(T){T.forEach(function(O){w[O.getName()]=O})};this.getSelectedCols=function(){return E?W.getSelectedFieldsByMenu():R.getSelectedFields()};this.getMaxCount=function(){return L};this.getEntityTableName=function(){if(B.getDataSourceType()==y.ENTITY){for(var T="",O=Object.values(W.getSelectedMenu()),M=0;M<O.length;M++)T+=O[M].getName(),M!=O.length-1&&(T+=n.ENEITY_SPLITOR);return T}return""};this.setSelectedEntityPath=
function(T){F=n.splitEntityPath(T)};var S=function(T){var O=A.createGenericFacade(function(M){L=M},function(M,fa,ua){L=50;return!0},function(){var M=y.isSupportUserSql(B)?B.getUserSqlByName(J):void 0;M?ba(T,M):N(T)});O.setBlockingJqUi(T);O.getGenericMaxColNumber()},N=function(T){var O=A.getMainDataSetModelVO().getDataSetModel(),M=Ja.fromDataSetSourceType(O.getDataSetType(),B.getDataSourceType()),fa=A.createQueryFacade(function(ua){ua=ua[0];(E?new x:new v).fromJsonAndUpdateUi(ua)},function(ua,La,xa){Z.showInvalidUi(h.get("fetchTableFailedTips",
"\u6570\u636e\u8868\u5b58\u5728\u9519\u8bef\uff0c\u65e0\u6cd5\u83b7\u5f97\u8868\u7ed3\u6784\u3002\u60a8\u53ef\u4ee5"),xa);return!0});fa.setBlockingJqUi(T);fa.getTableFields(O.getDataSetType(),M,B.toJsonObject(),[J])},ba=function(T,O){var M=A.getMainDataSetModelVO().getDataSetModel(),fa=Ja.fromDataSetSourceType(M.getDataSetType(),B.getDataSourceType()),ua=A.createGenericFacade(function(La){(E?new x:new v).fromJsonAndUpdateUi(La)},function(La,xa,Qa){Z.showInvalidUi(h.get("fetchTableFailed","\u6570\u636e\u8868\u5b58\u5728\u9519\u8bef\uff0c\u65e0\u6cd5\u83b7\u5f97\u8868\u7ed3\u6784\u3002"),
Qa);return!0});ua.setBlockingJqUi(T);ua.getUserSqlField(M.getDataSetType(),B.getName(),fa,O.getType(),O.getContent())},v=function(){this.fromJsonAndUpdateUi=function(T){var O=new Ta;O.fromJsonObject(T);T=A.getMainDataSetModelVO().getDataSetModel();O=O.getChildren();for(var M=[],fa=0;fa<O.length;fa++){var ua=O[fa],La=ua.getName(),xa=new u(T);xa.setName(La);xa.setAlias(ua.getDisplayName());xa.setDataType(ua.getType());ua=new Na(xa);w[La]&&ua.setSelected(!0);M.push(ua)}Z.hideInvalidUi();R||(E?na():H());
R.updateFieldUI(M)}},x=function(){var T={};this.fromJsonAndUpdateUi=function(fa){var ua=new Ta;ua.fromJsonObject(fa,{});fa=O(ua);R||(E?na():H());W.setArrMenus(fa,F);W.setMapTreeToFields(T);W.updateTreeStructUi(fa[0]?fa[0]:null)};var O=function(fa){var ua=[];fa.getChildren().forEach(function(La){ua.push(M(La,null))});return ua},M=function(fa,ua){var La=A.getMainDataSetModelVO().getDataSetModel(),xa=new fb;xa.setName(fa.getName());xa.setUserObject(fa);xa.setFunPaintItem(function(ka,va,P){va.empty();
var za=$("<div>"),Ga=$("<div>"),ab=k,hb=ab.background;var sb=va.hasClass(fb.CONTENT_SELECTED_CLASS)?"_selected":"";ka=B.getDataSourceType()!=y.ENTITY?"table"+sb:0==ka.getLevel()?"entity_head"+sb:"entity_sub"+sb;hb.call(ab,za,ka);Ga.text(P.getDisplayName());va.attr("title",P.getDisplayName());ha.layoutCtrl(za,0,7,16,16);ha.layoutCtrlWithLRTB(Ga,20,0);va.append(za);va.append(Ga)});ua&&ua.addChildren(xa);var Qa=fa.getChildren&&fa.getChildren()&&0<fa.getChildren().length,Ua=[];fa.getFieldNode().getChildren().forEach(function(ka){var va=
ka.getName(),P=new u(La);P.setName(va);P.setAlias(ka.getDisplayName());P.setDataType(ka.getType());P=new Na(P);w[va]&&P.setSelected(!0);if(ka.getExtension("isFK")||ka.getExtension("isPK")&&Qa)P.setSelected(!0),P.setEnabled(!1);Ua.push(P)});T[fa.getName()]=Ua;Qa&&fa.getChildren().forEach(function(ka){M(ka,xa)});return xa}}}function mb(A){var B=this,J,C,Z=[],R={},W;this.getJqUi=function(){if(!J){var S=$("<div>");S.addClass("checkbox-menu");ha.layoutCtrlWithLRTB(S,0,0,null,0,0,null);J=S}return J};this.setArrMenus=
function(S,N){Z=S;var ba=[];for(Z.forEach(function(v){v.deepFirstVisiting(function(x){E(x,N,ba)})});0<ba.length;)w(!0,ba.shift())};var E=function(S,N,ba){-1!=N.indexOf(S.getName())&&(S.setSelected(!0),ba.push(S));S.addFunMenuCheckClick(function(v,x){w(v,x);C&&F();L(x)});S.addFunContentClick(function(v,x){C&&F();L(v)});J.append(S.initJqUi())};this.getArrMenus=function(){return Z};this.setSelectMenuCallback=function(S){W=S};var L=function(S){C=S;S.getJqContent().addClass(fb.CONTENT_SELECTED_CLASS);
S.updateJqUi();H(S)},F=function(){C.getJqContent().removeClass(fb.CONTENT_SELECTED_CLASS);C.updateJqUi()};this.setMapTreeToFields=function(S){R=S};this.getMapTreeToFields=function(){return R};var w=function(S,N){N.setSelected(S);var ba=N.getParent(),v=N,x=!1;if(ba&&(x=ba.getSelected(),!x))for(;ba;)ba.setEnabled(v.getSelected()||!S),ba.getPeers().forEach(function(O){O.visiting(function(M){M.setEnabled(!S)})}),v=ba,ba=v.getParent();ba=N.getChildren();if(S){var T=!1;ba.some(function(O){return O.getSelected()?
T=!0:!1});T||ba.forEach(function(O){O.visiting(function(M){M.setEnabled(!1)});O.setEnabled(!0)})}else ba.forEach(function(O){O.visiting(function(M){!S&&M.setSelected(!1);M.setEnabled(!x)})});N.getPeers().forEach(function(O){O.visiting(function(M){M.setEnabled(!S&&!x)});O.setEnabled(!S)});Z.forEach(function(O){O.deepFirstVisiting(function(M){M.updateJqUi()})})};this.updateTreeStructUi=function(S){!C&&S&&L(S);Z.forEach(function(N){N.deepFirstVisiting(function(ba){ba.updateJqUi()})});H(S)};var H=function(S){var N=
[];S&&R[S.getName()]&&(N=R[S.getName()]);W&&W(N)};this.getSelectedFieldsByMenu=function(){var S={};na(function(N){S[N.getName()]||(S[N.getName()]=N)});return Object.values(S)};var na=function(S){var N=B.getSelectedMenu(),ba=B.getMapTreeToFields();Object.keys(ba).forEach(function(v){N[v]&&ba[v].forEach(function(x){x.getSelected()&&S(x.getField())})})};this.getSelectedMenu=function(){var S=[];B.getArrMenus().forEach(function(N){N.deepFirstVisiting(function(ba){ba.getSelected()&&(S[ba.getName()]=ba)})});
return S}}function ya(){var A=[],B,J,C,Z,R,W,E,L,F,w,H,na=!1,S=!0,N=!0,ba=!0,v=!0,x,T;this.getContentPaneCreator=function(){return M};this.show=function(){B.show()};this.hide=function(){B.hide()};this.getJqUi=function(){B||M();return B};this.setJqNoDataUI=function(P){R=P};this.getSelectedFields=function(){var P=[];A.forEach(function(za){za.getSelected()&&P.push(za.getField())});return P};this.setSelectedItem=function(){};this.updateFieldUI=function(P){P||(P=[]);P=A=P;J.show();Z.empty();C.empty();
P&&0!==P.length?R&&R.hide():R&&R.show();na=!1;w&&w.setChecked(!1);L&&L.clear();if(S){C.show();var za=O(P),Ga=C,ab=Ga.append,hb=za==P.length,sb=$("<div>");sb.addClass("wizard-field-dialog-line");F=new g;F.setChecked(hb);F.addCheckedListener(xa);hb=F.getJqUi();hb.addClass("wizard-field-dialog-checkbox");hb.appendTo(sb);hb=$("<div>");hb.addClass("wizard-field-dialog-allcheckbox-text");hb.text(h.get("selectAll","\u5168\u9009"));hb.appendTo(sb);E=$("<div>");E.addClass("wizard-field-dialog-selected-prompt");
E.text(h.get("selectedItem","(\u5df2\u9009\u62e9#1\u9879)"));E.appendTo(sb);ab.call(Ga,sb);fa(za)}else C.hide();for(za=0;za<P.length;za++)Ga=P[za],Ga.setFunFieldCheckClick(ka),Ga.initJqUi(),ab=Ga.getJqUi(),ab.appendTo(Z),w&&w.isChecked()&&!Ga.getSelected()&&ab.hide();ua()};this.setFunFieldCheckClick=function(P){x=P};this.setFunAllCheckboxClick=function(P){T=P};this.setAllCheckboxSelected=function(P){F.setChecked(P)};this.setShowSearchText=function(P){v=P};this.setFunCustomErrorPainter=function(P){};
var O=function(P){for(var za=0,Ga=0;Ga<P.length;Ga++)P[Ga].getSelected()&&za++;return za},M=function(){if(!B){B=$("<div>");J=$("<div>");J.hide();J.addClass("wizard-field-dialog-content");if(v){var P=$("<div class='wizard-field-dialog-search'>");P.text(h.get("search","\u641c\u7d22"));P.appendTo(J)}P=J;var za=P.append;L=new Pa;L.setShowSearchIcon(!0);L.addSearchListener(ua);L.setSearchListenerDelay(500);L.setPlaceholder(h.get("inputSearch","\u8f93\u5165\u641c\u7d22\u6587\u672c"));var Ga=L.getJqUi();
Ga.addClass("wizard-field-dialog-search-box");v?Ga.css("left","10px"):Ga.css("width","90%");za.call(P,Ga);N&&J.append(Qa);C=$("<div>");C.addClass("wizard-field-dialog-main-all-check");Z=$("<div class='wizard-field-dialog-main-area'>");ba&&Z.css("overflow","scroll");R&&B.append(R);J.append(C);J.append(Z);B.append(J)}return B},fa=function(P){E&&E.text(h.get("selectedItem","(\u5df2\u9009\u62e9#1\u9879)").replace("#1",P))},ua=function(P){H=$.trim(L.getText());La(A,H)},La=function(P,za){if(0==za.length){W&&
W.hide();for(var Ga=0;Ga<P.length;Ga++){var ab=P[Ga];na&&!ab.getSelected()||ab.show(!0)}F&&F.setChecked(va())}else{var hb=!0;for(Ga=0;Ga<P.length;Ga++)if(ab=P[Ga],!na||ab.getSelected()){var sb=ab.getDisplayName().toLowerCase(),Bb=ab.getName().toLowerCase();-1===sb.indexOf(za.toLowerCase())&&-1===Bb.indexOf(za.toLowerCase())?ab.show(!1):(ab.show(!0),hb=!1)}hb?(W||(W=$("<div>"),W.addClass("wizard-field-dialog-no-result-container"),P=$("<div>"),P.addClass("wizard-field-dialog-no-result-icon"),k.background(P,
"no_data"),P.appendTo(W),P=$("<div>"),P.addClass("wizard-field-dialog-view-tip"),P.text(h.get("noSearchResult","\u6ca1\u6709\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u7ed3\u679c")),P.appendTo(W),W.appendTo(J),W.hide()),W.show(),R&&R.hide(),F&&F.setChecked(!1)):(W&&W.hide(),F&&F.setChecked(va()))}};this.updateSelectedItemsPrompt=function(){fa(O(A))};var xa=function(P,za){if(za){var Ga=P.isChecked();if(Ga)for(Ga=0;Ga<A.length;Ga++){var ab=A[Ga];ab.isShow()&&ab.getEnabled()&&!ab.getSelected()&&ab.setSelected(!0)}else for(ab=
0;ab<A.length;ab++){var hb=A[ab];hb.isShow()&&hb.getEnabled()&&hb.setSelected(Ga)}T&&T(P,za);P=O(A);fa(P)}},Qa=function(){w=new g;w.setChecked(na);w.addCheckedListener(Ua);w.setText(h.get("showOnlyChecked","\u4ec5\u663e\u793a\u9009\u4e2d\u9879"));var P=w.getJqUi();ha.layoutCtrl(P,290,5,200,23);return P},Ua=function(P,za){za&&((na=P.isChecked())?A.forEach(function(Ga){Ga.getSelected()||Ga.show(!1)}):A.forEach(function(Ga){Ga.show(!0)}),La(A,H))};this.setShowAllCheckbox=function(P){S=P};this.setShowScroll=
function(P){ba=P};this.setShowOnlyChecked=function(P){N=P};var ka=function(P,za){x&&x(P,za);P=O(A);fa(P);F&&F.setChecked(va())},va=function(){for(var P=!0,za=0;za<A.length;za++){var Ga=A[za];if(Ga.isShow()&&!Ga.getSelected()){P=!1;break}}return P}}function jb(){var A=this,B,J;this.hookInvalidUi=function(C){B||(B=C,C=A.getInvalidPane().getJqUi(),B.append(C),C.hide());return A.getInvalidPane()};this.showInvalidUi=function(C,Z){J.setMessage(C,Z);A.getInvalidPane().getJqUi().show()};this.hideInvalidUi=
function(){A.getInvalidPane().getJqUi().hide()};this.getInvalidPane=function(){J||(J=new yb(h.get("fetchTableFailedTips","\u6570\u636e\u8868\u5b58\u5728\u9519\u8bef\uff0c\u65e0\u6cd5\u83b7\u5f97\u8868\u7ed3\u6784\u3002\u60a8\u53ef\u4ee5")));return J}}function yb(A){var B="",J="",C;this.getJqUi=function(){if(C)return C;var Z=$("<div>"),R=$("<span>"),W=$("<span>"),E=$("<div>"),L=h.get("showDetail","\u67e5\u770b\u8be6\u7ec6");R.text(A);R.attr("title",A+L);W.text(L);W.attr("title",L);W.on("click",function(){var F=
new l;F.setCustomPainter(function(w,H){var na=$("<div>");na.text(B);var S=$('<textarea readonly="true" ></textarea>');S.text(H);S.addClass("sa-ctrl-msgdlg-detail");S.on("click",function(){S.select()});S.addClass("extreport-dataset-designer-top-border");ha.layoutCtrlWithLRTB(S,0,0,null,35,0,null);na.appendTo(w);S.appendTo(w)});F.setOptionType(l.OPTION_OK);F.setButtonText(l.OPTION_OK,h.get("ok","\u786e\u5b9a"));F.setMessage(J);F.showDialog(300,320)});k.background(E,"marco_error");Z.addClass("wizard-dialog-invalid-ui");
R.addClass("wizard-dialog-invalid-row-text");W.addClass("wizard-dialog-invalid-btn");E.addClass("wizard-dialog-invalid-icon");R.append(W);Z.append(E);Z.append(R);return C=Z};this.setMessage=function(Z,R){B=Z;J=R}}function Na(A){var B=this,J=A,C=!1,Z=!0,R=!0,W,E,L;this.setField=function(w){J=w};this.getField=function(){return J};this.getDisplayName=function(){return J.getAlias()?J.getAlias():""};this.getName=function(){return J.getName()?J.getName():""};this.getFieldType=function(){return J.getDataType()};
this.setSelected=function(w){C=w;W&&W.setChecked(w)};this.setShowRelationIcon=function(w){};this.show=function(w){w?E&&E.show():E&&E.hide();R=w};this.isShow=function(){return R};this.getSelected=function(){return C};this.setEnabled=function(w){Z=w};this.getEnabled=function(){return Z};this.getJqUi=function(){return E};this.setFunFieldCheckClick=function(w){L=w};this.initJqUi=function(){E=$("<div>");W=new g;W.setUserObject(B);W.setChecked(C);W.addCheckedListener(function(w,H){H&&(C=w.isChecked(),L&&
L(w.isChecked(),B))});W.setEnabled(Z);F(B,W);return E};var F=function(w,H){w=$("<div>");w.addClass("wizard-field-dialog-line");H=H.getJqUi();H.addClass("wizard-field-dialog-checkbox");H.appendTo(w);H=$("<div>");H.addClass("wizard-field-dialog-checkbox-type");k.background(H,b.dataTypeToIconName(J.getDataType()));w.append(H);H=J.getAlias()+"("+J.getName()+")";var na=$("<div>");na.addClass("wizard-field-dialog-checkbox-text");na.text(H);na.attr("title",H);na.appendTo(w);w.appendTo(E)}}function fb(){var A=
this,B,J,C,Z=!1,R=!0,W=!0,E,L,F,w=[],H=[],na=[],S;this.getJqContent=function(){return J};this.setName=function(v){C=v};this.getName=function(){return C};this.setUserObject=function(v){F=v};this.getUserObject=function(){return F};this.setParent=function(v){L=v};this.getParent=function(){return L};this.getPeers=function(){var v=[],x=A.getParent();if(!x)return v;x.getChildren().forEach(function(T){T!=A&&v.push(T)});return v};this.addChildren=function(v){w.push(v);v.setParent(A)};this.getChildren=function(){return w};
this.setSelected=function(v){Z=v;E&&E.setChecked(v)};this.show=function(v){v?B&&B.show():B&&B.hide();W=v};this.isShow=function(){return W};this.getSelected=function(){return E?E.isChecked():Z};this.setEnabled=function(v){R=v};this.getEnabled=function(){return R};this.getLevel=function(){for(var v=0,x=A.getParent();x;)v++,x=x.getParent();return v};this.getJqUi=function(){return B};this.visiting=function(v){for(var x=[A];0<x.length;){var T=x.pop();if(v(T))break;!T.isLeafNode()&&(x=x.concat(T.getChildren()))}};
this.deepFirstVisiting=function(v){v(A);for(var x=A.getChildren(),T=0;T<x.length;T++){var O=x[T];O.isLeafNode()?v(O):O.deepFirstVisiting(v)}};this.isLeafNode=function(){return 0==w.length};this.addFunMenuCheckClick=function(v){H.push(v)};this.addFunContentClick=function(v){na.push(v)};var N=function(v){H.forEach(function(x){x(v,A)})},ba=function(){na.forEach(function(v){v(A,J)})};this.setFunPaintItem=function(v){S=v};this.updateJqUi=function(){E.setEnabled(A.getEnabled());S&&S(A,J,A.getUserObject())};
this.initJqUi=function(){if(B)return B;B=$("<div>");J=$("<div>");E=new g;E.setEnabled(A.getEnabled());E.setUserObject(A);E.setChecked(Z);E.addCheckedListener(function(T,O){O&&N(T.isChecked())});var v=E.getJqUi();J.addClass("checkbox-tree-content");J.on("click",function(){ba()});A.updateJqUi();var x=20*A.getLevel();ha.layoutCtrlWithLRTB(v,x,null,20,4,null,20);ha.layoutCtrlWithLRTB(J,x+19,1,null,0,0,30);B.addClass("checkbox-tree-row");B.append(v);B.append(J);return B}}function Xa(){var A,B,J,C,Z,R,
W,E,L,F,w,H=h.get("sameJoin","\u5b58\u5728\u76f8\u540c\u7684\u5173\u8054\u5173\u7cfb\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002");this.getJqUi=function(){if(!A){A=$("<div>");na();var M=$("<div>");B=$("<div>");var fa=h.get("joinField","\u5173\u8054\u5b57\u6bb5");fa=(new e(fa)).getJqUi();fa.addClass("wizard-join-pane-text");S();var ua=$("<div>");ua.on("click",N);ua.text(h.get("addJoinField","\u6dfb\u52a0\u5173\u8054\u5b57\u6bb5"));ua.addClass("wizard-pane-join-append");var La=(new ia).measureWidth(h.get("addJoinField",
"\u6dfb\u52a0\u5173\u8054\u5b57\u6bb5"));ua.css("width",La+15);B.addClass("wizard-join-pane");M.addClass("wizard-join-field-area");M.append(B);M.append(ua);A.append(fa);A.append(M);A.addClass("wizard-join-pane")}return A};this.setGenericJoinModel=function(M,fa,ua){Z=M;R=fa;W=ua;C=fa.getModel();F=R.getSourceOrTableException();w=W.getSourceOrTableException()};this.setFunChangeLeftTableCallback=function(M){E=M};this.setFunChangeFieldCallBack=function(M){L=M};var na=function(){var M=h.get("joinTable",
"\u5173\u8054\u8868"),fa=new e(M);M=$("<div>");var ua=Db.getErrorIcon(F),La=Db.getErrorIcon(w);!F&&ua.hide();!w&&La.hide();var xa=new Kb(R,ba(),function(ka,va){R=va;(F=R.getSourceOrTableException())?ua.show():ua.hide();ka.setAllModel(ba());Z.setLeftTable(va.getId());Z.setJoinFields([Wa.findFirstMatchedField(R,W,Z)]);B.empty();S();E&&E(Z)},function(ka,va,P){k.background(P,"table");va.text(ka.getAlias())});xa.setPaneClass(I);var Qa=$("<div>");k.background(Qa,"table");var Ua=new z;Ua.setIcon(Qa);Ua.setText(W.getAlias());
Ua.setEnabled(!1);fa=fa.getJqUi();xa=xa.getJqUi();Ua=Ua.getJqUi();Ua.attr("title",W.getAlias());fa.addClass("wizard-join-pane-text");xa.addClass("wizard-join-pane-table-left");ua.addClass("wizard-join-pane-table-left-error");Ua.addClass("wizard-join-pane-table-right");La.addClass("wizard-join-pane-table-right-error");M.addClass("wizard-pane-join-field-row");A.append(fa);Ua.append(Qa);M.append(ua);M.append(xa);M.append(La);M.append(Ua);A.append(M)},S=function(){J=[];for(var M=Z.getJoinFields(),fa=
0;fa<M.length;fa++)B.append(v(M[fa],F,w))},N=function(){var M=new Ka(Z);Z.addJoinFields(M);L&&L();B.append(v(M,F,w));for(M=0;M<J.length;M++)J[M].show()},ba=function(){for(var M=[],fa=C.getTables(),ua=C.findRelatedToCurrentTables(W,!0),La=0;La<fa.length;La++){var xa=fa[La];xa!=W&&-1==ua.indexOf(xa)&&M.push(xa)}return M},v=function(M,fa,ua){for(var La=$("<div>"),xa=$("<div>"),Qa=$("<div>"),Ua,ka,va=R.getAllColumns(),P=W.getAllColumns(),za=[],Ga=[],ab=!1,hb=0;hb<va.length;hb++){var sb=va[hb];sb.check()||
za.push(sb);sb.getName()==M.getLeftField()&&(Ua=va[hb])}for(hb=0;hb<P.length;hb++)sb=P[hb],sb.check()||Ga.push(sb),sb.getName()==M.getRightField()&&(ka=P[hb]);va=x(M.getLeftField(),fa,Ua);P=x(M.getRightField(),ua,ka);var Bb=Db.getErrorIcon(va),Eb=Db.getErrorIcon(P);va||P||!M.isRepeatJoinFields()||(ab=!0,Bb.attr("title",H),Eb.attr("title",H),Bb.show(),Eb.show());za=new Kb(Ua?Ua:M.getLeftField(),za,function(Cb,Lb){Ua=Lb;O(M.setLeftField,M,Ua,ka,Bb)},T);za.setPaneClass(K);Ga=new Kb(ka?ka:M.getRightField(),
Ga,function(Cb,Lb){ka=Lb;O(M.setRightField,M,ka,Ua,Eb)},T);Ga.setPaneClass(K);fa&&za.setEnabled(!1);ua&&Ga.setEnabled(!1);Qa.on("click",function(){var Cb=Z.getJoinFields();Cb.splice(Cb.indexOf(M),1);J.splice(J.indexOf(Qa),1);ab?(B.empty(),S()):(1==J.length&&J[0].hide(),La.remove());L&&L()});xa.text("=");Qa.text("x");J.push(Qa);1>=Z.getJoinFields().length?Qa.hide():Qa.show();fa=za.getJqUi();ua=Ga.getJqUi();Bb.addClass("wizard-join-pane-icon-left");fa.addClass("wizard-join-pane-ctrl-left");xa.addClass("wizard-pane-join-equal");
Eb.addClass("wizard-join-pane-icon-right");ua.addClass("wizard-join-pane-ctrl-right");Qa.addClass("wizard-join-pane-delete-icon");La.addClass("wizard-pane-join-field-row");La.append(Bb);La.append(fa);La.append(xa);La.append(Eb);La.append(ua);La.append(Qa);return La},x=function(M,fa,ua){if(M)if(fa||!ua)var La=h.get("loseField","\u5b57\u6bb5\u201c#1\u201d\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002").replace("#1",M);else ua.isCalcColumn()?(M=ua.getCalcCol())&&M.check()&&(La=h.get("invalidCalculatingField",
"\u8ba1\u7b97\u5b57\u6bb5\u3010#1\u3011\u65e0\u6548").replace("#1",ua.getAlias())):La=ua.check();else La=h.get("unSelectField","\u672a\u9009\u62e9\u5b57\u6bb5\u3002");return La},T=function(M,fa,ua){var La=M.getDataType();La=b.dataTypeToIconName(La);k.background(ua,La);fa.text(M.getAlias())},O=function(M,fa,ua,La,xa){var Qa=fa.isRepeatJoinFields();M(ua.getName());L&&L();(M=ua.check())?(xa.attr("title",M),xa.show(),La=!1):(xa.hide(),La=!La||La.check()?!1:!0);La&&(fa=fa.isRepeatJoinFields(),Qa||fa)&&
(B.empty(),S())}}function Ra(){var A=this,B,J=[];this.reset=function(){A.setSelected(void 0)};this.syncSelectedModel=function(C){if(B&&C)if(B instanceof n){var Z=C.getTables();for(C=0;C<Z.length;C++){var R=Z[C];if(R.getId()==B.getId()){B=R;break}}}else if(B instanceof Wa)for(Z=C.getJoins(),C=0;C<Z.length;C++)if(R=Z[C],R.getId()==B.getId()){B=R;break}};this.addSelectNodeListener=function(C){J.push(C)};this.addEventListener=function(C){J.push(C)};this.setSelected=function(C){(B=C)&&A.notifyListener(Ra.KEY_NODE_SELECTED,
C)};this.getSelected=function(){return B};this.notifyListener=function(C,Z,R){for(var W=0;W<J.length;W++)(0,J[W])(C,Z,R)}}function tb(){a.call(this);var A=this,B=this.protectedMethod,J,C,Z,R;(function(){B.setTitle(h.get("filter","\u8fc7\u6ee4"));B.setSelectable(!0);A.setSize(933,480);B.getDialogCtrl().addResizeListener(function(){});B.setContentPaneCreator(function(){return W()});B.setClosingAction(function(E){if(E){E=C.getFilters();for(var L=[],F=0;F<E.length;F++){var w=E[F];w.isEmpty()||(w.setFromTable(Z),
L.push(w))}R&&R(L)}});B.setFooterClosingOnly(!1)})();var W=function(){var E=$("<div>"),L=new Jb(J,C),F=L.getJqUI();setTimeout(function(){L.updateTable()},0);E.append(F);return E};this.setWizardTable=function(E){for(var L=new n(E.getModel()),F=L.fromJsonObject,w=E.toJsonObject(),H=E.getFilters(),na={},S=0;S<H.length;S++)for(var N=H[S].getExceptionMap(),ba=Object.keys(N),v=0;v<ba.length;v++){var x=ba[v];na[x]||(na[x]=[]);var T=na[x];x=N[x];for(var O=Object.keys(x),M=0;M<O.length;M++){var fa=O[M],ua=
new ta;ua.setCode(fa);ua.setMessage(x[fa]);T.push(ua)}}F.call(L,w,na);C=L;Z=E};this.setFunCloseCallBack=function(E){R=E};this.setGlobal=function(E){J=E}}function Ab(A,B,J,C,Z){function R(){la.AbstractWizardStep.call(this);var v,x,T;this.getSubTitle=function(){return h.get("selectField","\u9009\u62e9\u5b57\u6bb5")};this.getJqUi=function(O){v=O;T||(na=new gb(F,H,H.getSourceIdOfTable(N)),T=na.getJqUi());return T};this.intoThisStep=function(O,M){v.setNextEnabled(!0)};this.outThisStep=function(O,M){O=
na.getSelectedCols();var fa=na.getMaxCount();if(O.length>fa)return v.getMessageCurtain().showPrompt(h.get("maxFields","\u81f3\u591a\u9009\u62e9#1\u4e2a\u5b57\u6bb5\u3002").replace("#1",fa)),!1;H.getDataSourceType()==y.ENTITY&&N.setName(na.getEntityTableName());if(0==O.length)return v.getMessageCurtain().showPrompt(h.get("atLeastOneField","\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b57\u6bb5")),!1;for(fa=0;fa<O.length;fa++){var ua=O[fa];ua.setModel(w);ua.setSourceTable(N)}N.setColumns(O);x||(x=new W);
M(x)}}function W(){la.AbstractWizardStep.call(this);var v,x,T=[0,1],O=[h.get("join","\u5173\u8054"),h.get("union","\u5408\u5e76")],M=["join","union"],fa=0,ua,La,xa;this.getSubTitle=function(){return h.get("linkWay","\u9009\u62e9\u8fde\u63a5\u65b9\u5f0f")};this.getJqUi=function(ka){ua=ka;if(!v){v=$("<div>");ka=$("<div>");for(var va=0,P=0;P<T.length;P++)ka.append(Qa(T[P],va)),va+=160;ka.addClass("wizard-add-table-center-group");v.append(ka);ha.layoutCtrlWithLRTB(v,0,0,null,0,0,null)}return v};var Qa=
function(ka,va){var P=$("<div>"),za=$("<div>"),Ga=$("<div>");za.addClass("wizard-add-table-cell-icon");Ga.addClass("wizard-add-table-cell-text");P.addClass("wizard-add-table-cell");P.on("click",function(){fa!=ka&&(x&&(x.removeClass("wizard-add-table-cell-selected"),x.find(".wizard-add-table-cell-triangle").remove(),x.find(".wizard-add-table-cell-selected-icon").remove()),fa=ka,Ua(P),ua.setNextEnabled(!0))});P.attr("title",O[ka]);Ga.text(O[ka]);k.background(za,M[ka]);ka==fa&&Ua(P);P.append(za);P.append(Ga);
ha.layoutCtrlWithLRTB(P,va);return P};this.intoThisStep=function(ka,va){ua.setNextEnabled(null!=fa)};this.outThisStep=function(ka,va){if(0==fa){La||(La=new E);var P=La}else xa||(xa=new L),P=xa;va(ka?null:P)};var Ua=function(ka){var va=$("<div>"),P=$("<div>");k.background(va,"tick");ka.addClass("wizard-add-table-cell-selected");P.addClass("wizard-add-table-cell-triangle");va.addClass("wizard-add-table-cell-selected-icon");ka.append(va);ka.append(P);x=ka}}function E(){la.AbstractWizardStep.call(this);
var v,x,T,O,M;this.getSubTitle=function(){return h.get("chooseLinkWay","\u9009\u62e9\u8fde\u63a5\u65b9\u5f0f-\u5173\u8054")};this.getJqUi=function(xa){v=xa;x||(x=$("<div>"),ha.layoutCtrlWithLRTB(x,0,0,null,0,0,null),fa());return x};var fa=function(){x&&x.empty();O?M.getId()!=O.getLeftTable()&&(M=w.getTableById(O.getLeftTable())):(M=w.getTables()[0],O=new Wa(w),O.setJoinType(ra.LEFT),O.setLeftTable(M.getId()),O.setRightTable(N.getId()));O.setJoinFields([Wa.findFirstMatchedField(M,N,O)]);var xa=$("<div>");
ua(xa);var Qa=new Xa;Qa.setGenericJoinModel(O,M,N);Qa=Qa.getJqUi();xa.addClass("wizard-pane-join-div");Qa.addClass("wizard-pane-join-area");x.append(xa);x.append(Qa)},ua=function(xa){var Qa;$(ra.ALL_JOIN_TYPE).each(function(Ua,ka){var va=$("<div>"),P=$("<div>"),za=$("<div>");va.on("click",function(){T&&(T.removeClass("wizard-pane-join-single-type-selected"),T.find(".wizard-pane-join-single-type-triangle").remove(),T.find(".wizard-pane-join-single-type-selected-icon").remove(),Qa&&Qa.removeClass("wizard-pane-join-hide-left"));
T=va;Ua!=ra.ALL_JOIN_TYPE.length-1&&(Qa=va.next(),Qa.addClass("wizard-pane-join-hide-left"));La(va);O.setJoinType(ka)});va.attr("title",ra.typeToText(ka));k.background(P,ra.typeToIconName(ka,2));za.text(ra.typeToText(ka));va.addClass("wizard-pane-join-single-type");P.addClass("wizard-pane-join-single-type-icon");za.addClass("wizard-pane-join-single-type-text");Ua==ra.ALL_JOIN_TYPE.length-1?va.addClass("wizard-pane-join-single-type-border"):Ua==ra.ALL_JOIN_TYPE.indexOf(O.getJoinType())+1&&(va.addClass("wizard-pane-join-hide-left"),
Qa=va);ka==O.getJoinType()&&(La(va),T=va);va.append(P);va.append(za);xa.append(va)})},La=function(xa){var Qa=$("<div>"),Ua=$("<div>");k.background(Qa,"tick");xa.addClass("wizard-pane-join-single-type-selected");Ua.addClass("wizard-pane-join-single-type-triangle");Qa.addClass("wizard-pane-join-single-type-selected-icon");xa.append(Qa);xa.append(Ua)};this.intoThisStep=function(xa,Qa){fa()};this.outThisStep=function(xa,Qa){if(!xa){xa=O.getJoinFields();for(var Ua={},ka=0;ka<xa.length;ka++){var va=xa[ka],
P=va.getLeftField();va=va.getRightField();if(!P||!va){v.getMessageCurtain().showPrompt(h.get("chooseLinkField","\u8bf7\u9009\u62e9\u5173\u8054\u5b57\u6bb5"));return}P=P+"_"+va;if(Ua[P]){v.getMessageCurtain().showPrompt(h.get("sameJoin","\u5b58\u5728\u76f8\u540c\u7684\u5173\u8054\u5173\u7cfb\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002"));return}Ua[P]=!0}}Qa()};this.isLastStep=function(){return!0};this.over=function(xa){xa&&(xa=na.getSelectedCols(),N.syncColsToDataSet(xa),w.addJoins(O),w.addTableAndSource(H,
S,N),ba&&ba(N,O))}}function L(){la.AbstractWizardStep.call(this);var v,x,T;this.getSubTitle=function(){return h.get("unionLink","\u9009\u62e9\u8fde\u63a5\u65b9\u5f0f-\u5408\u5e76")};this.getJqUi=function(M){v=M;T||(T=$("<div>"),ha.layoutCtrlWithLRTB(T,0,0,null,0,0,null),O());return T};var O=function(){T&&T.empty();x=new kb;x.setGenericTables(w.getTables(),N);var M=x.getJqUi();T.append(M)};this.intoThisStep=function(M,fa){O()};this.outThisStep=function(M,fa){M?fa():x.hasSelected()?fa():v.getMessageCurtain().showPrompt(h.get("atLeastOneField",
"\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b57\u6bb5\u3002"))};this.isLastStep=function(){return!0};this.over=function(M){if(M){S&&w.addSource(H);N.setSourceId(H.getId());var fa=x.getHeadWrapper();M=x.getRowWrappers();fa=fa.getArrTable()[0];for(var ua=[],La={},xa={},Qa=0;Qa<M.length;Qa++){var Ua=M[Qa].transToUnionCol(La,xa,fa);Ua&&ua.push(Ua)}fa.isUnionTable()||fa.toUnion();fa.setColumns(ua);fa.addSubTable(N);fa.syncColsToDataSet();ba&&ba(fa)}}}var F=A,w=B,H=J,na,S=C,N=Z,ba;this.setFunFinishedCallBack=
function(v){ba=v};this.show=function(){var v=new R,x=new la;x.setSteps([v]);x.show(670,500)}}function Ia(){function A(E){KTDefaultCellRender.call(this,E);var L=this,F=this.paintCellUI;this.paintCellUI=function(w,H){var na=L.getCell(),S=L.getCurrentRow(),N=L.getCurrentColIdx(),ba=L.getCurrentRowIdx(),v=L.getCellWidth(),x=L.getCellHeight(),T=$(w);if(ba<Ya.getHeadRowCount()){if(F(w,H),1==ba)if(0==N){w=!0;v=J.getRowWrappers();for(x=0;x<v.length;x++){var O=v[x];if(!w)break;w=w&&O.isSelected()}v=new g;
v.setChecked(w);v.addCheckedListener(function(xa,Qa){if(Qa){xa=xa.isChecked();for(Qa=0;Qa<R.length;Qa++)R[Qa].setChecked(xa);var Ua=J.getRowWrappers();for(Qa=0;Qa<Ua.length;Qa++)Ua[Qa].setSelected(xa)}});Z=v;w=v.getJqUi();ha.layoutCtrlWithLRTB(w,11,null,"100%");T.append(w)}else{var M=na.getUserObject();J.protectedPaintTableHead(M,N,w,H)}}else if(O=S.getUserObject(),0==N){ba==Ya.getHeadRowCount()&&(R=[]);var fa=new g;fa.setChecked(O.isSelected());fa.addCheckedListener(function(xa,Qa){if(Qa)if(xa=fa.isChecked(),
O.setSelected(xa),xa){for(xa=0;xa<R.length;xa++)if(!R[xa].isChecked())return;Z.setChecked(!0)}else Z.setChecked(!1)});R.push(fa);w=fa.getJqUi();ha.layoutCtrlWithLRTB(w,11,null,"100%",5);T.append(w)}else if(1==N){var ua=na.getValue();M=O.getTableByIdx(ua);if(w=O.getGenericColByIdx(ua)){if(v=W(na,O,M,w))x=cb.createWarning(),x.attr("title",v),ha.layoutCtrl(x,null,8),T.append(x),x=$("<div>"),Fb.backgroundWithHover(x,"del"),x.on("click",function(){O.setGenericColByIdx(ua,null);if(0==O.getNonNullSize()){var xa=
J.getRowWrappers();xa.splice(xa.indexOf(O),1)}J.updateUnionFieldTable()}),ha.layoutCtrlWithLRTB(x,null,3,16,6,null,16),T.append(x);x=$("<div>");H=w.getDataType();k.background(x,b.dataTypeToIconName(H));x.addClass("wizard-pane-join-table-selector-icon");v&&ha.layoutCtrlWithLRTB(x,18);H=$("<div>");H.text(w.getAlias());H.attr("title",w.getAlias());H.addClass("wizard-union-table-field-text");v&&ha.layoutCtrlWithLRTB(H,36);T.append(x);T.append(H)}}else{ua=na.getValue();w=O.getGenericColByIdx(ua);M=O.getTableByIdx(ua);
H=M.getColumns();var La=new K;La.setModel([null].concat(H));v=Ya.createCtrlInCell(T,v,x,ca);x=v.getJqUi();v.setSelectedModel(w);v.setDropdownCreator(function(xa,Qa,Ua){return La.createJqUi(xa,Qa,Ua)});v.addSelectionListener(function(xa){xa=xa.getSelectedModel();var Qa=ua,Ua=O,ka=J.getHeadWrapper(),va=Ua.getGenericColByIdx(Qa),P=J.getRowWrappers();if(va){var za=ka.getHeadTable(Qa);W(na,Ua,za,va)||(ka=new Da(ka),ka.initArrColByIndex(Qa,va),P.push(ka))}if(xa){a:{va=J.getRowWrappers();for(ka=0;ka<va.length;ka++)if(va[ka].getGenericColByIdx(Qa)==
xa){va=va[ka];break a}va=null}1==va.getNonNullSize()?P.splice(P.indexOf(va),1):va.setGenericColByIdx(Qa,null)}Ua.setGenericColByIdx(Qa,xa);0==Ua.getNonNullSize()&&P.splice(P.indexOf(Ua),1);J.updateUnionFieldTable()});v.setCustomPainter(function(xa,Qa){Qa.empty();if(xa){var Ua=W(na,O,M,xa);if(Ua){var ka=Db.getErrorIcon(Ua);ka.addClass("generic-union-table-error-icon");Qa.append(ka)}ka=$("<div>");ka.addClass("wizard-pane-join-table-selector-icon");var va=b.dataTypeToIconName(xa.getDataType());k.background(ka,
va);Ua&&ha.layoutCtrl(ka,22);Qa.append(ka);ka=$("<div>");ka.addClass("wizard-pane-join-table-selector-text");ka.text(xa.getAlias());ka.attr("title",xa.getAlias());Ua&&ha.layoutCtrl(ka,39);Qa.append(ka)}});T.append(x)}}}function B(){Mb.call(this);this.isColumnDraggable=function(E,L){return 0!==L};this.getMinColumnWidthLimited=function(E,L){return 80};this.getTailBlankForDragging=function(){return-1}}var J=this,C,Z,R=[];this.getHeadWrapper=function(){};this.getRowWrappers=function(){};this.hasSelected=
function(){for(var E=J.getRowWrappers(),L=0;L<E.length;L++)if(E[L].isSelected())return!0;return!1};this.protectedPaintTableHead=function(E,L,F){};this.getJqUi=function(){C=Ya.createTable();C.setDraggableAdjusting(!0,3,0,new B);C.setSyncUIWhenModelChanged(!1);var E=new A(C);E.setOutsideVisible(!1);C.setCellRender(E);Ya.bindTableListenerForCtrl(C);E=$(C.getUI());setTimeout(J.updateUnionFieldTable,0);return E};this.updateUnionFieldTable=function(){Ya.clear(C);var E=J.getHeadWrapper(),L=E.getHeadLen(),
F=E.getArrTable();C.addColumns(1+L);var w=Ya.createHeadRow(C);w.setUserObject(E);C.getColumn(0).setWidth(35);for(E=0;E<L;E++)C.getColumn(E+1).setWidth(300),w.getCell(E+1).setUserObject(F[E]);L=J.getRowWrappers();for(E=0;E<L.length;E++){var H=L[E];F=H.getRowLen();w=Ya.createRow(C);w.setUserObject(H);H=H.getArrUnCompatible();for(var na=0;na<F;na++)w.getCell(na+1).setValue(na),w.getCell(na+1).setUserObject(-1!=H.indexOf(na))}Ya.refresh(C)};var W=function(E,L,F,w){var H=L.isSubColDeleted(w),na=null;H||
(na=F.getSourceOrTableException()||w.getException());E=E.getUserObject();F=null;if(H||na||E)E=w.getAlias(),H?F=h.get("loseField","\u5b57\u6bb5\u201c#1\u201d\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\u3002").replace("#1",E):na?F=na:(L=L.getBenchmark().getAlias(),w=b.dataTypeToName(w.getDataType()),F=h.get("unMatchedType","\u5b57\u6bb5\u201c#1\u201d\u7684\u6570\u636e\u7c7b\u578b\u4e3a#2\uff0c\u4e0e\u5b57\u6bb5\u201c#3\u201d\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u4e00\u81f4\u3002").replace("#1",
E).replace("#2",w).replace("#3",L));return F}}function kb(){Ia.call(this);var A=this,B,J,C;this.setGenericTables=function(Z,R){B=Z;J=R;C=Ea.build(J,B[0],!0)};this.getHeadWrapper=function(){return C.getHeadWrapper()};this.getRowWrappers=function(){return C.getRowWrappers()};this.protectedPaintTableHead=function(Z,R,W,E){W=$(W);1==R?(Z=new Kb(Z,B,function(L,F){C=Ea.build(J,F,!0);A.updateUnionFieldTable()},function(L,F,w){w.hide();F.text(L.getAlias());ha.layoutCtrlWithLRTB(F,null,null,"100%")}),Z.setPaneClass(I),
Z=Z.getJqUi(),Z.addClass("wizard-union-table-field-dropdown-head"),W.append(Z)):(Z=Z.getAlias(),W.text(Z),W.attr("title",Z),W.css("line-height","22px"))}}function vb(){Ia.call(this);var A=this,B,J=[];this.setUnionFieldHelper=function(C){B=C};this.getHeadWrapper=function(){return B.getHeadWrapper()};this.getRowWrappers=function(){return B.getRowWrappers()};this.getDelSubTables=function(){return J};this.protectedPaintTableHead=function(C,Z,R,W){Z=$(R);R=$("<span>");W=C.getAlias();R.text(W);R.attr("title",
W);R.addClass("generic-subtable-head");Z.append(R);A.getHeadWrapper().isSubTableDeleted(C)&&(R=Db.getErrorIcon(h.get("loseTable","\u6570\u636e\u8868\u201c#1\u201d\u5df2\u88ab\u5220\u9664\u3002").replace("#1",C.getAlias())),R.addClass("generic-union-table-error-icon"),ha.layoutCtrl(R,4,5),Z.append(R));1<A.getHeadWrapper().getHeadLen()&&(R=$("<div>"),Fb.backgroundWithHover(R,"del"),R.addClass("generic-prop-sub-table-head-del"),R.on("click",function(){J.push(C);B.delGenericTable(C);A.updateUnionFieldTable()}),
Z.append(R))}}function ub(){a.call(this);var A=this,B=this.protectedMethod,J,C,Z,R;(function(){B.setTitle(h.get("editUnion","\u7f16\u8f91\u5408\u5e76\u8868"));B.setSelectable(!0);A.setSize(670,500);B.setContentPaneCreator(function(){var W=new vb;W.setUnionFieldHelper(C);Z=W;return W.getJqUi()});B.setClosingAction(function(W){});B.setClosingChecker(function(){if(!Z.hasSelected())return B.getMessageCurtain().showPrompt(h.get("atLeastOneField","\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5b57\u6bb5\u3002")),
!1;R&&R(Z,J,C);return!0});B.setFooterClosingOnly(!1)})();this.setGenericTable=function(W){J=W;C=J.getUnionFieldHelper().clone()};this.setCloseCallBack=function(W){R=W}}function qb(A){this.getLastSelectedSource=function(B){B=B.getDataSourceType();return B!=y.SUPER_QUERY&&B!=y.DATA_CENTER?"":qb.SOURCE_NAME[B]};this.cacheLastSelectedSource=function(B){var J=B.getDataSourceType();if(J==y.SUPER_QUERY||J==y.DATA_CENTER)qb.SOURCE_NAME[J]=B.getName()}}function lb(A){var B=this;(function(){Hb.removeFunDelSourceInterceptor();
A!=y.DATA_CENTER&&A!=y.SUPER_QUERY||Hb.setFunDelSourceInterceptor(function(J){return J!=B.getGenericSource()})})()}function rb(A,B){Nb.call(this,A);lb.call(this,B.getDataSourceType());qb.call(this,A);var J=this,C,Z,R=!1,W,E,L=B,F,w=[],H=this.getJqUi;this.getJqUi=function(){if(!C){C=$("<div>");var S=H();S.addClass("generic-searchTable-pane");var N=C,ba=N.append,v=J.getGenericSource();v=y.typeToFeatureName(v.getDataSourceType());Z=Gb.createTitle(v);J.protectedCustomizeTitleArea(Z);ba.call(N,Z);C.append(S)}return C};
this.protectedCustomizeTitleArea=function(S){};this.addFunLoadDataListener=function(S){w.push(S)};var na=function(S){for(var N=0;N<w.length;N++)(0,w[N])(S)};this.loadData=function(S){var N=J.getGenericSource();if(N.getException(ib.DATA_SOURCE))J.setArrNodes([]),R=!0,J.updateUi();else{var ba=N.getModel(),v=A.createQueryFacade(function(x){var T=new da;T.fromJsonObject(x,{});E=T;x=T.getTableNode();J.setArrNodes(x.initArrNode());na(!0);J.fireFunSyncSourceState(!0)},function(x,T,O){J.setArrNodes([]);na(!1);
J.fireFunSyncSourceState(!1,T);return!0},function(){R=!0;J.updateUi()});v.setBlockingJqUi(S);v.getUsableTableObject(ba.getDataSetId(),ba.toJsonObject(),N.getId())}};this.getDataSourceTableObjectVO=function(){return E};this.getGenericSource=function(){return L};this.updateGenericSource=function(S){L=S};this.protectedIsNodeMatch=function(S,N){return(N=N.getDisplayName())&&0<=N.toUpperCase().indexOf(S.toUpperCase())};this.setFunSyncSourceState=function(S){F=S};this.fireFunSyncSourceState=function(S,
N){var ba=J.getGenericSource();S?ba.removeException(ib.DATA_SOURCE,ba.getId(),N):ba.addException(ib.DATA_SOURCE,ba.getId(),N);F&&F(J,ba,S)};this.setNodeStatusMonitor=function(S){W=S};this.getNodeStatusMonitor=function(){return W};this.isReadyForUpdateUi=function(){return R};this.protectedGetNoTableUi=function(S,N,ba){S=J.getArrNodes();N=J.getGenericSource().getException(ib.DATA_SOURCE);ba=J.protectedPaintErrorInfoUi(N,!ba&&0==S.length);ba.css("background-color","#fff");return ba};this.protectedPaintErrorInfoUi=
function(S,N){N=$("<div>");var ba=$("<div>"),v=$("<div>"),x=J.getGenericSource().getDataSourceType();k.background(ba,"marco_error");ba.addClass("generic-table-dpp-error");if(x==y.QING_MODELER)v.text(h.get("noValidModel","\u6682\u65e0\u53ef\u7528\u7684\u6a21\u578b"));else if(x==y.ENTITY)v.text(h.get("noValidEntity","\u6682\u65e0\u53ef\u7528\u7684\u5b9e\u4f53"));else if(x==y.OUT_DB||x==y.USER_SUPER_QUERY)S?(k.background(ba,"notable"),ba.addClass("generic-table-out-db-error"),v.text(h.get("noGetTable",
"\u6570\u636e\u6e90\u5b58\u5728\u9519\u8bef\uff0c\u65e0\u6cd5\u83b7\u53d6\u6570\u636e\u8868\u3002"))):v.text(h.get("noValidTable","\u6682\u65e0\u53ef\u7528\u7684\u8868"));v.addClass("generic-table-error-tips");N.append(ba);N.append(v);ha.layoutCtrlWithLRTB(N,0,0,null,31,0,null);return N}}function $a(A,B){wb.call(this,A,B);var J=this,C,Z,R;this.protectedCreateCtrlAtTop=function(F){var w=J.getGenericSource();if(w=J.getLastSelectedSource(w)){Z=w;var H=A.createQueryFacade(function(na){var S=new eb;S.fromJsonObject(na);
W(F,S);S.getIsNoConnPerm()&&J.fireFunSyncSourceState(!1,h.get("noDataCenterPermission","\u60a8\u6ca1\u6709\u201c\u6570\u636e\u4e2d\u5fc3\u8fde\u63a5\u201d\u6743\u9650\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6388\u6743\u3002"));C=S},function(na,S,N){W(F,null)});H.setBlockingJqUi(F);H.getAppNameByAppNumber(w)}else W(F,null);return 30};this.protectedGetTopGap=function(){return 30};this.protectedShowOrHideTips=function(F,w){R&&(w&&F?R.hide():R.show())};this.protectedCanShowNoTableUi=function(){return null!=
Z};var W=function(F,w){var H=h.get("app","\u5e94\u7528"),na=new ia;na.setFontSize(12);na=5+na.measureWidth(H);var S=$("<div>"),N=new e;N.setText(H);H=N.getJqUi();H.addClass("wizard-source-ctrl-label");ha.layoutCtrl(H,5,null,30);if(N=E()){var ba=cb.createWarning();ba.attr("title",N);ha.layoutCtrl(ba,na+3,8);na+=18;S.append(ba)}N=new Pb;N.setFunSelectedChangeListener(function(v){var x=v.value;Z=x;(v=J.getGenericSource())&&v.delUseless();v=A.getMainDataSetModelVO().getDataSetModel();x=v.createNewSource(x,
y.DATA_CENTER);var T=x.oModel;J.updateGenericSource(T);x.bNewCreated&&v.addSource(T);J.cacheLastSelectedSource(T);L(F)});w&&(ba={},ba.text=w.getAppName(),ba.value=w.getAppNumber(),N.setSelectedValue(ba));w=N.getJqUi();ba=N.getJqText();N=N.getJqIcon();ha.layoutCtrlWithLRTB(ba,0,5,"",0,0,23);ha.layoutCtrlWithLRTB(N,"",10,16,5,0,16);ha.layoutCtrlWithLRTB(w,na,5,null,3,null,23);S.addClass("wizard-source-ctrl-row");S.append(H);S.append(w);F.append(S);R=S},E=function(){if(!C)return"";var F=C.getAppName()?
C.getAppName():C.getAppNumber();if(C.getIsCloudBanned())return h.get("cloudBan","\u5e94\u7528\u201c#1\u201d\u6240\u5728\u4e91\u88ab\u7981\u7528\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002").replace("#1",F);if(C.getIsAppDeleted())return h.get("appDel","\u5e94\u7528\u201c#1\u201d\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002").replace("#1",F);if(C.getIsAppBanned())return h.get("appBan","\u5e94\u7528\u201c#1\u201d\u88ab\u7981\u7528\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002").replace("#1",
F)};this.protectedPaintErrorInfoUi=function(){var F=$("<div>"),w=$("<div>"),H=$("<div>");C&&C.getIsNoConnPerm()?(k.background(w,"notable"),w.addClass("generic-table-out-db-error"),H.text(h.get("noGetTable","\u6570\u636e\u6e90\u5b58\u5728\u9519\u8bef\uff0c\u65e0\u6cd5\u83b7\u53d6\u6570\u636e\u8868\u3002")),H.addClass("generic-table-error-tips"),ha.layoutCtrlWithLRTB(F,0,0,null,31,0,null)):(k.background(w,"marco_error"),w.addClass("generic-table-dpp-error"),H.text(h.get("noValidTable","\u6682\u65e0\u53ef\u7528\u7684\u8868")),
H.addClass("generic-table-error-tips"),ha.layoutCtrlWithLRTB(F,0,0,null,60,0,null));F.append(w);F.append(H);F.css("z-index",1);return F};var L=J.loadData;this.loadData=function(){}}function db(A,B){wb.call(this,A,B);var J=this,C,Z,R;this.protectedCreateCtrlAtTop=function(F){var w=A.createQueryFacade(function(H){var na=new Va;na.fromJsonObject(H);W(F,na.getSuperQuerySchemas())},function(H,na){W(F,[],na);return!0});w.setBlockingJqUi(F);w.getSuperQuerySchemaList();return 30};this.protectedGetTopGap=
function(){return 30};this.protectedShowOrHideTips=function(F,w){C&&(w&&F?C.hide():C.show())};this.protectedCanShowNoTableUi=function(){return null!=Z};var W=function(F,w,H){R=w;var na=h.get("schema","\u6a21\u5f0f");w=new ia;w.setFontSize(12);var S=w.measureWidth(na);w=5;var N=$("<div>"),ba=new e;ba.setText(na);na=ba.getJqUi();na.addClass("wizard-source-ctrl-label");ha.layoutCtrl(na,w);w+=S;if(H)S=cb.createWarning(),S.attr("title",H),ha.layoutCtrl(S,w+3,8),w+=18,N.append(S);else if(0==R.length){var v=
new m;v.setTipsText(h.get("superQueryTips2","\u201c\u8d85\u7ea7\u67e5\u8be2\u201d\u6ca1\u6709\u53ef\u4f7f\u7528\u7684\u6a21\u5f0f\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u8fdb\u884c\u6388\u6743\u3002"));v=v.getJqUi();ha.layoutCtrl(v,32,7);w+=22}H=new d;H.addSelectedChangedListener(function(x,T,O){(x=J.getGenericSource())&&x.delUseless();Z=x=O.getName();O=A.getMainDataSetModelVO().getDataSetModel();x=O.createNewSource(x,y.SUPER_QUERY);T=x.oModel;J.updateGenericSource(T);x.bNewCreated&&O.addSource(T);
E(F)});H.setItemModels(R);H.setCustomPainter(L);if(S=J.getLastSelectedSource(J.getGenericSource()))Z=S,H.setSelected(S);H=H.getJqUi();ha.layoutCtrlWithLRTB(H,w,5,null,3,null,23);N.addClass("wizard-source-ctrl-row");N.append(na);v&&N.append(v);N.append(H);F.append(N);C=N},E=J.loadData;this.loadData=function(){};var L=function(F,w,H){F&&!H?0!=R.length&&w.text(h.get("selectSchemaTips","\u8bf7\u9009\u62e9\u4e00\u4e2a\u6a21\u5f0f")):(F=H.getName(),H=H.getAlias(),w.text(H?H:F))}}function wb(A,B){rb.call(this,
A,B);var J=this,C;this.protectedCustomizeTitleArea=function(w){var H=$("<div>");k.background(H,"add");H.attr("title",h.get("userSql","\u521b\u5efa\u81ea\u5b9a\u4e49SQL/KSQL"));H.on("click",function(){var na=new Ha(J.getGenericSource());na.setType(wa.SQL);L(na,!0)});ha.layoutCtrlWithLRTB(H,null,0,16,4,null,16);H.css("cursor","pointer");H.hide();w.append(H);J.addFunLoadDataListener(function(na){na&&H.show()})};var Z=J.setArrNodes;this.setArrNodes=function(w){C=w;R()};var R=function(){var w=0<C.length?
C[0].getRoot():new Ta;for(var H=[],na=J.getGenericSource().getUserSqls(),S=0;S<na.length;S++){var N=Ib.create(na[S]);N.setParentNode(w);H.push(N)}w=H.concat(C);Z(w)},W=J.protectedPaintCellItem;this.protectedPaintCellItem=function(w){if(Ib.isUserSqlNode(w)){var H=$("<div>");var na=$("<div>"),S=$("<div>"),N=$("<div>"),ba=$("<div>");N.hide();ba.hide();var v=w.getDisplayName();H.attr("title",v);H.on("mouseenter",function(){N.show();ba.show();ha.layoutCtrlWithLRTB(S,24,50,null,7,null,null)});H.on("mouseleave",
function(){N.hide();ba.hide();ha.layoutCtrlWithLRTB(S,24,4,null,7,null,null)});J.highlightKeyWords(S,v);N.on("click",function(){var x=J.getGenericSource().getUserSqlByName(w.getName());L(x,!1)});N.attr("title",h.get("usersql1","\u81ea\u5b9a\u4e49SQL/KSQL"));ba.attr("title",h.get("del","\u5220\u9664"));ba.on("click",function(){var x=new Ba;x.setText(h.get("delUserSql","\u786e\u5b9a\u5220\u9664\u8be5\u81ea\u5b9a\u4e49SQL/KSQL\u5417\uff1f"));x.setConfirmedListener(function(T){if(T)if(T=J.getGenericSource().getUserSqlByName(w.getName()).getUsingTables(),
0==T.length)J.getGenericSource().delUserSqlByName(w.getName()),F();else{var O=T.length;T=1==O?h.get("userSqlUsed","\u8be5\u81ea\u5b9a\u4e49SQL/KSQl\u5df2\u88ab\u901a\u7528\u67e5\u8be2\u6570\u636e\u96c6\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u201c\u8fde\u63a5\u201d\u533a\u57df\u5220\u9664\u6570\u636e\u8868#1\u3002").replace("#1",T[0].getAlias()):2==O?h.get("userSqlUsed2","\u8be5\u81ea\u5b9a\u4e49SQL/KSQL\u5df2\u88ab\u901a\u7528\u67e5\u8be2\u6570\u636e\u96c6\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u201c\u8fde\u63a5\u201d\u533a\u57df\u5220\u9664\u6570\u636e\u8868\u201c#1\u201d\uff0c\u201c#2\u201d\u3002").replace("#1",
T[0].getAlias()).replace("#2",T[1].getAlias()):3==O?h.get("userSqlUsed3","\u8be5\u81ea\u5b9a\u4e49SQL/KSQL\u5df2\u88ab\u901a\u7528\u67e5\u8be2\u6570\u636e\u96c6\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u201c\u8fde\u63a5\u201d\u533a\u57df\u5220\u9664\u6570\u636e\u8868\u201c#1\u201d\uff0c\u201c#2\u201d\uff0c\u201c#3\u201d\u3002").replace("#1",T[0].getAlias()).replace("#2",T[1].getAlias()).replace("#3",T[2].getAlias()):h.get("userSqlUsed4","\u8be5\u81ea\u5b9a\u4e49SQL/KSQL\u5df2\u88ab\u901a\u7528\u67e5\u8be2\u6570\u636e\u96c6\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u201c\u8fde\u63a5\u201d\u533a\u57df\u5220\u9664\u201c#1\u201d\u7b49#2\u4e2a\u6570\u636e\u8868\u3002").replace("#1",
T[1].getAlias()).replace("#2",T.length);A.getMessageCurtain().showPrompt(T,2500)}});x.show(ba,!1)});k.background(na,"SQL"+(J.getSelectedNode()==w?"_selected":""));k.backgroundWithHover(ba,"del");k.backgroundWithHover(N,"edit");H.append(na);H.append(S);H.append(N);H.append(ba);H.addClass("wizard-tablearea-table-item-context");na.addClass("extreport-dataset-designer-tablearea-table-icon");S.addClass("wizard-tablearea-table-name");N.addClass("generic-sql-edit-icon");ba.addClass("generic-sql-del-icon");
ha.layoutCtrlWithLRTB(S,24,4,null,7,null,null)}else H=W(w);return H};var E=J.getIconNameByNode;this.getIconNameByNode=function(w){return Ib.isUserSqlNode(w)?"SQL":E(w)};var L=function(w,H){var na=J.getGenericSource(),S=new U(A,function(){A.fireEvent(Ob.QUERY_AREA_SET_HINT_TYPE,J.getDataSourceTableObjectVO().getMapTableFields())});S.setGenericSource(na);S.setArrTableNodes(C);S.setGenericQueryUserSql(w);S.setFunConfirmCallBack(function(N,ba){var v=J.getGenericSource();if(H)v.addUserSql(N),F();else if(N=
N.getUsingTables(),0==N.length)F();else{for(var x=0;x<N.length;x++){var T=N[x];T.clearException(ib.FIELD);var O=T.getColumns();for(x=0;x<O.length;x++){var M=O[x],fa=ba[M.getName()];fa?(M.setAlias(fa.getDisplayName()),M.setDataType(fa.getType()),M.clearException(ib.FIELD)):T.addFieldException(M)}}F();v.getModel().checkAllProps();J.getNodeStatusMonitor().notifyListener(Ra.MANUAL_MODEL_TO_UI)}});S.showDialog()},F=function(){R();var w=J.getArrNodes();w[0]&&J.setSelectedNode(w[0]);J.updateUi()}}function qa(A){pb.call(this);
var B=this,J,C;this.setNodeStatusMonitor=function(E){J=E};this.protectGetTableModelList=function(){return A.getOrders()};this.protectedGetTableColNumber=function(){return 4};this.protectedSetHeadWidthAndValue=function(E,L){var F=($(E.getUI()).width()-80)/2;E.getColumn(2).setWidth(F);E.getColumn(3).setWidth(F);L.getCell(2).setValue(h.get("orderField","\u6392\u5e8f\u5b57\u6bb5"));L.getCell(3).setValue(h.get("orderType","\u6392\u5e8f\u65b9\u5f0f"))};this.protectedSetCellValue=function(E,L){L=L.check();
E.getCell(2).setValue(L?L:"");E.getCell(3).setValue(" ")};this.protectedDeleteRowsCallBack=function(E){W();J.notifyListener(Ra.KEY_NODE_ORDER_CHANGE,A)};var Z=B.deleteParam;this.deleteParam=function(E){if(0!=B.getSelectedCount()){var L=l.createFeedbackDialog();L.setMsgImageType(l.MSG_CONFIRM);L.setMessage(h.get("delOrder","\u5220\u9664\u6240\u9009\u6392\u5e8f\u4f9d\u636e\u540e\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f"));L.setClosingChecker(function(F){F==l.RETURN_OK&&
Z(E);return!0});L.showDialog()}};this.protectedAddBtnCallBack=function(){var E=new f(A.getModel(),A);E.setField("");E.setOrder("");A.addOrder(E)};var R=function(){var E={};A.getOrders().forEach(function(F){E[F.getField()]=!0});var L=[];A.getAllColumns().forEach(function(F){!E[F.getName()]&&L.push(F)});return L};this.protectedPaintCell=function(E,L,F,w,H){E=$(w);E.empty();if(2===L){var na=H.getCellWidth();w=H.getCellHeight();var S=F.getUserObject();H=S.getColByField();var N=F.getCell(2).getValue();
L=cb.createWarning();N?L.attr("title",N):L.hide();ha.layoutCtrl(L,1,5);var ba=N?12:0;w=Ya.createCtrlInCell(E,na-ba,w,ca);H&&w.setSelectedModel(H);w.setDropdownCreator(function(v,x,T){var O=new K;O.setModel(R());x=O.createJqUi(v,x,T);v=x[0];x=x[1];125>na-ba&&(v=125);return[v,x]});w.addSelectionListener(function(v){v=v.getSelectedModel();S.setField(v.getName());S.getOrder()||(S.setOrder(xb.ASC),F.getCell(3).setValue(xb.ASC));F.getCell(2).setValue(S.check());W();J.notifyListener(Ra.KEY_NODE_ORDER_CHANGE,
A)});w.setCustomPainter(function(v,x){x.empty();if(v){var T=$("<div>");if("string"==typeof v)T.text(v),ha.layoutCtrlWithLRTB(T,2,0);else{var O=$("<div>"),M=v.getDataType();M=b.dataTypeToIconName(M);k.background(O,M);ha.layoutCtrl(O,null,2,16,16);T.text(v.getAlias());ha.layoutCtrlWithLRTB(T,22,0);x.append(O)}ha.makeTextOmissible(T);x.append(T)}});H=w.getJqUi();H.addClass("generic-prop-sort-background");ha.layoutCtrlWithLRTB(H,ba,0,null,0,0);E.append(L);E.append(H)}else 3===L&&(S=F.getUserObject(),
L=new d,L.setSelected(S.getOrder()),L.setItemModels(xb.ALL_TYPE),L.setCustomPainter(function(v,x,T){T&&(v=$("<div>"),v.text(xb.toString(T)),x.append(v))}),L.addSelectedChangedListener(function(v,x,T){S.setOrder(T);F.getCell(2).setValue(S.check());W();J.notifyListener(Ra.KEY_NODE_ORDER_CHANGE,A)}),L.showFeature(!1),E.data("my-ctrl",L),L=L.getJqUi(),L.addClass("generic-prop-sort-background"),E.append(L))};this.protectedSyncTableHeight=function(E){};this.protectedSetTitleStyle=function(E,L){var F=(new ia).measureWidth(h.get("orderWay",
"\u6392\u5e8f\u4f9d\u636e"));E.setText(h.get("orderWay","\u6392\u5e8f\u4f9d\u636e"));C||(E=cb.createWarning(),E.attr("title",h.get("orderWayWarn","\u6392\u5e8f\u4f9d\u636e\u5b58\u5728\u9519\u8bef\uff0c\u8bf7\u4fee\u6539\u6392\u5e8f\u4f9d\u636e\u3002")),ha.layoutCtrl(E,F+10,7),L.append(E),C=E);W()};var W=function(){A.getOrders().some(function(E){return null!=E.check()})?C.show():C.hide()}}function K(){var A=[];this.createJqUi=function(R,W,E){var L=new Qb;L.setItemModel(A);L.setListItemPainter(C);L.setFunGetSelectedIconName(function(F){return B(F,
!0)});L.setFunGetButtonName(J);L.setFunModelEqualsChecker(Z);return L.createJqPopup(R,W,E)};this.setModel=function(R){A=R};var B=function(R,W){R=R.getDataType();R=b.dataTypeToIconName(R);return W?R+"_selected":R},J=function(){return h.get("showOrigin","\u663e\u793a\u5b57\u6bb5\u540d\u79f0")},C=function(R,W,E,L){k.background(W,B(R,!1));W=R.getName();L&&R.isCalcColumn&&R.isCalcColumn()&&(W=(W=R.getCalcCol())?W.getAlias():R.getName());R=R.getAlias()+(L?"("+W+")":"");E.text(R)},Z=function(R,W){return R&&
"string"!=typeof R&&R.equals(W)?!0:!1}}function I(){var A=[];this.createJqUi=function(Z,R,W){var E=new Qb;E.setItemModel(A);E.setListItemPainter(J);E.setFunGetSelectedIconName(function(L){return"table_selected"});E.setFunGetButtonName(B);E.setFunModelEqualsChecker(C);return E.createJqPopup(Z,R,W)};this.setModel=function(Z){A=Z};var B=function(){return h.get("showOriginName","\u663e\u793a\u8868\u540d")},J=function(Z,R,W,E){k.background(R,"table");Z=Z.getAlias()+(E?"("+Z.getName()+")":"");W.text(Z)},
C=function(Z,R){return Z&&"string"!=typeof Z&&Z.equals(R)?!0:!1}}function X(A){Nb.call(this,A);var B,J,C,Z,R,W,E=this.getJqUi;this.getJqUi=function(){C||(C=E());return C};this.setTableNode=function(F){B=F};this.protectedCreateCtrlAtTop=function(F){var w=$("<div>"),H=$("<div>"),na=$("<div>"),S=B?B.getDisplayName():"";k.background(H,"table");na.text(S);w.attr("title",S);w.on("click",function(){J&&J(B)});w.addClass("generic-sql-field-table-ctrl");H.addClass("extreport-dataset-designer-field-table-item-icon");
na.addClass("extreport-dataset-designer-field-table-item-name");w.append(H);w.append(na);F.append(w);Z=na;R=w};this.protectedGetTopGap=function(){return 0};this.setFunDBClickSelectedTable=function(F){J=F};this.protectedGetNoTableUi=function(){W||(W=$("<div>"),Gb.initNoDataUi(W,h.get("noField","\u6682\u65e0\u5b57\u6bb5")),ha.layoutCtrlWithLRTB(W,1,1,null,0,0,null));return W};this.protectedShowOrHideTips=function(F,w){R&&(w?R.hide():R.show())};var L=this.updateUi;this.updateUi=function(){var F=B?B.getDisplayName():
"";Z.text(F);R.attr("title",F);L()}}function ja(A,B){var J=this,C,Z,R,W,E,L,F,w,H,na,S,N="",ba="",v=ja.SQL,x=!0,T=[],O,M;this.getJqUi=function(){C||(C=$("<div>"),ua());return C};this.setTableNode=function(P){T=P};this.setFunGetFieldByTable=function(P){O=P};this.setSqlContent=function(P){N=P};this.isSupportKsql=function(){return x};this.setIsSupportKsql=function(P){x=P};this.setSqlType=function(P){v=P};this.getSqlType=function(){return v};this.getSqlContent=function(){return S.getSqlContent()};this.close=
function(){S&&S.close()};this.setFunSetSqlTypeCallBack=function(P){M=P};var fa,ua=function(){La();ka();va();E=new Aa;E.setFirstSize(260,200,300);E.setSecondSize(-1,-1,-1);E.setHorizontalSplit(!0);E.setResizeMode(Aa.RESIZE_MODE_FIRST_FIXED);E.setFirstChild(Aa.createChildWrapper(F.getJqUi(),function(){clearTimeout(fa);fa=setTimeout(function(){w.updateUi();H.updateUi()},0);L.resize(!0)}));E.setSecondChild(Aa.createChildWrapper(L.getJqUi()));var P=E.getJqUi();P.addClass("generic-sql-pane");ha.layoutCtrlWithLRTB(P,
0,0,null,0,0,null);C.append(P);setTimeout(function(){E.resize(!0);F.resize(!0);L.resize(!0);var za=T[0];za&&(w.setSelectedNode(za),Ua(za),H.setTableNode(za));w.updateUi();H.updateUi()})},La=function(){var P=xa(),za=Qa();F=new Aa;F.setHorizontalSplit(!1);F.setFirstSize(300,200,400);F.setSecondSize(-1,-1,-1);F.setResizeMode(Aa.RESIZE_MODE_FIRST_FIXED);F.setFirstChild(Aa.createChildWrapper(P));F.setSecondChild(Aa.createChildWrapper(za));return F},xa=function(){var P=$("<div>"),za=Gb.createTitle(h.get("table",
"\u8868")),Ga=new Nb(A);Ga.setArrNodes(T);Ga.setFunDBClickedCallback(function(hb){A.fireEvent(Ob.QUERY_AREA_INSERT_TYPE,hb.getName())});Ga.setFunItemPressedCallback(function(hb){Ua(hb)});w=Ga;var ab=Ga.getJqUi();P.append(za);P.append(Ga.getJqUi());ha.layoutCtrlWithLRTB(ab,0,0,null,30,0,null);return P},Qa=function(){var P=$("<div>"),za=Gb.createTitle(h.get("field","\u5b57\u6bb5")),Ga=new X(A);Ga.setFunDBClickSelectedTable(function(ab){w.scrollToSpecifiedNode(ab)});Ga.setFunDBClickedCallback(function(ab){A.fireEvent(Ob.QUERY_AREA_INSERT_TYPE,
ab.getName())});H=Ga;Ga=Ga.getJqUi();P.append(za);P.append(Ga);ha.layoutCtrlWithLRTB(Ga,0,0,null,30,0,null);return P},Ua=function(P){if(null==P)H.setTableNode(null),H.setArrNodes([]),H.updateUi();else{var za=ba=(new Date).getTime()+"";O&&O(H,P,function(Ga){za==ba&&(Ga[0]&&H.setSelectedNode(Ga[0]),H.setTableNode(P),H.setArrNodes(Ga),H.updateUi())})}},ka=function(){var P=$("<div>"),za=Gb.createTitle(h.get("variant","\u53d8\u91cf"));na=new Tb(A,P,za);na.init();P.append(za);R=P},va=function(){if(!Z){Z=
$("<div>");Z.addClass("generic-sql-pane-border");var P=Gb.createTitle(h.get("queryStatement","\u67e5\u8be2\u8bed\u53e5"));P.addClass("extreport-dataset-designer-bottom-border");var za=new m;za.setIconType(m.ICON_TYPE_QUESTION);za.setTipsText(h.get("addInSql","\u5728\u8868\u3001\u5b57\u6bb5\u53ca\u53d8\u91cf\u533a\u57df\u53cc\u51fb\u9f20\u6807\u5de6\u952e\uff0c\u53ef\u4ee5\u5728\u67e5\u8be2\u8bed\u53e5\u8f93\u5165\u6846\u4e2d\u5149\u6807\u6240\u5728\u4f4d\u7f6e\u63d2\u5165\u6307\u5b9a\u503c\u3002"));
za=za.getJqUi();ha.layoutCtrlWithLRTB(za,null,null,16,4,null,16);za.css({position:"relative","float":"left","margin-left":"4px"});za.appendTo(P);var Ga=h.get("comment","\u6ce8\u91ca/\u53cd\u6ce8\u91ca");za=new ma(Ga);za.addActionListener(function(){S.commentSelectedSqlContent()});za=za.getJqUi();za.addClass("generic-sql-comment");za.attr("title",Ga);var ab=h.get("format","\u683c\u5f0f\u5316");Ga=new ma(ab);Ga.addActionListener(function(){S.formatSelectedSqlContent()});Ga=Ga.getJqUi();Ga.attr("title",
ab);Ga.addClass("generic-sql-format");if(J.isSupportKsql()){ab=$("<div>");var hb=new pa;var sb=new V;sb.setText("KSQL");var Bb=new V;Bb.setText("SQL");hb.addElement(Bb);hb.addElement(sb);hb.toCheckTheElement(function(Cb){return v==ja.SQL&&Cb==Bb||v==ja.KSQL&&Cb==sb});hb.addChangedListener(function(Cb,Lb){Lb&&(Cb=ja.SQL,sb.isChecked()&&(Cb=ja.KSQL),M&&M(Cb))});hb=Bb.getJqUi();ha.layoutCtrlWithLRTB(hb,null,0,60,0,null,24);var Eb=sb.getJqUi();ha.layoutCtrlWithLRTB(Eb,null,70,60,0,null,24);Eb.appendTo(ab);
hb.appendTo(ab);ab.addClass("generic-sql-type-btn");ab.appendTo(P)}Ga.appendTo(P);za.appendTo(P);P.appendTo(Z);S=new D(A,B);W=S.getJqUi();W.appendTo(Z)}L=new Aa;L.setFirstSize(-1,-1,-10);L.setSecondSize(300,200,400);L.setHorizontalSplit(!0);L.setResizeMode(Aa.RESIZE_MODE_SECOND_FIXED);L.setFirstChild(Aa.createChildWrapper(Z,function(){S.initSqlEditor(N?N:null);S.adjustSqlEditorHeight(R.height())}));L.setSecondChild(Aa.createChildWrapper(R))}}function U(A,B){a.call(this);var J=this,C=this.protectedMethod,
Z,R=[],W,E,L,F,w=wa.SQL,H=!1,na;(function(){C.setTitle(h.get("usersql1","\u81ea\u5b9a\u4e49SQL/KSQL"));J.setSize(0!=document.body.clientWidth?.9*document.body.clientWidth:800,0!=document.body.clientHeight?.95*document.body.clientHeight:700);C.setContentPaneCreator(function(){Z=$("<div>");var x=Ja.fromDataSetSourceType(c.GENERIC_QUERY_DATASET,W.getDataSourceType()),T=A.createQueryFacade(function(O){H=O},function(){H=w==wa.KSQL},function(){S();setTimeout(B,0)});T.setBlockingJqUi(Z);T.isSupportKsql(c.GENERIC_QUERY_DATASET,
x,W.toJsonObject());return Z});C.setClosingAction(function(x){});C.setClosingChecker(function(){if(!F)return C.getMessageCurtain().showPrompt(h.get("nameEmpty","\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a")+"\u3002"),!1;if(!L.getSqlContent())return C.getMessageCurtain().showPrompt(h.get("emptyQuery","\u67e5\u8be2\u8bed\u53e5\u4e0d\u80fd\u4e3a\u7a7a\u3002")),!1;ba();return!1});C.setFooterClosingOnly(!1)})();var S=function(){var x=Z,T=$("<div>"),O=new e(h.get("name","\u540d\u79f0"));O.setRequired(!0);var M=
new q;M.setText(F);M.addBlurListener(function(ua){var La=ua.getText();N(La)?F=La.trim():ua.setText(F)});M.addAcceptableListener(function(ua){ua=ua.getText();N(ua)&&(F=ua.trim())});var fa=new ja(A,W);fa.setTableNode(R);fa.setIsSupportKsql(H);fa.setSqlType(w==wa.SQL?ja.SQL:ja.KSQL);fa.setSqlContent(E.getContent());fa.setFunGetFieldByTable(function(ua,La,xa){var Qa=Ja.fromDataSetSourceType(c.GENERIC_QUERY_DATASET,W.getDataSourceType()),Ua=A.createQueryFacade(function(ka){ka=ka[0];var va=new Ta;va.fromJsonObject(ka);
xa(va.initArrNode())},function(){xa([]);return!0});Ua.setBlockingJqUi(ua.getJqUi());Ua.getTableFields(c.GENERIC_QUERY_DATASET,Qa,W.toJsonObject(),[La.getName()])});L=fa;fa=fa.getJqUi();O=O.getJqUi();M=M.getJqUi();T.append(O);T.append(M);T.addClass("generic-sql-dialog-name");x.append(T);x.append(fa);ha.layoutCtrlWithLRTB(O,0,0,50,null,null,30);ha.layoutCtrlWithLRTB(M,50,null,200,5,null,20);ha.layoutCtrlWithLRTB(fa,0,0,null,30,0,null);return x};this.setArrTableNodes=function(x){R=x};this.setGenericSource=
function(x){W=x};this.setGenericQueryUserSql=function(x){E=x;F=E.getAlias();w=E.getType()};this.getSqlType=function(){L&&(w=L.getSqlType()==ja.SQL?wa.SQL:wa.KSQL);return w};this.setFunConfirmCallBack=function(x){na=x};var N=function(x){x=x.trim();if(!x)return C.getMessageCurtain().showPrompt(h.get("giveUpChangeByEmptyNameClick","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a\u3002")),!1;if(x==F)return!0;if(x.length>Rb.iMAX_COLUMN_LEN)return C.getMessageCurtain().showPrompt(h.get("nameLimit","\u540d\u79f0\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc732\u4e2a\u5b57\u7b26\u3002")),
!1;if(!Rb.isValidString(x))return C.getMessageCurtain().showPrompt(h.get("legalName","\u540d\u79f0\u4e0d\u80fd\u4ee5\u6570\u5b57\u3001\u4e0b\u5212\u7ebf\u5f00\u5934\uff0c\u4e14\u4e0d\u80fd\u5305\u542b\u4ee5\u4e0b\u7279\u6b8a\u7b26\u53f7\uff1a#1").replace("#1","!@#$%^&*?~+-=()[]{}<>\\/|.,:;`'\"")),!1;for(var T=!1,O=W.getUserSqls(),M=x.toUpperCase(),fa=0;fa<O.length;fa++){var ua=O[fa];if(ua!=E&&ua.getAlias().toUpperCase()==M){T=!0;break}}for(fa=0;!T&&fa<R.length;fa++)if(R[fa].getDisplayName().toUpperCase()==
M){T=!0;break}return T?(C.getMessageCurtain().showPrompt(h.get("duplicateName","\u91cd\u590d\u7684\u540d\u79f0\uff1a#1").replace("#1",x)),!1):!0},ba=function(){var x=W.getModel(),T=Ja.fromDataSetSourceType(x.getDataSetType(),W.getDataSourceType());A.createGenericFacade(function(O){var M=new Ta;M.fromJsonObject(O);O={};if(M.hasChildren()){var fa=M.getChildren();for(M=0;M<fa.length;M++){var ua=fa[M];O[ua.getName()]=ua}}if(!E.getName()){fa=[];for(M=0;M<R.length;M++)fa.push(R[M].getName());E.genUniqueName(fa)}E.setAlias(F);
E.setType(J.getSqlType());E.setContent(L.getSqlContent());na&&na(E,O);L.close();C.destroy()},function(O,M,fa){v(M,fa);return!0}).getUserSqlField(x.getDataSetType(),W.getName(),T,J.getSqlType(),L.getSqlContent())},v=function(x,T){var O=new l;O.setCustomPainter(function(M,fa){var ua=$("<div>");ua.text(x);var La=$('<textarea readonly="true" ></textarea>');La.text(fa);La.addClass("sa-ctrl-msgdlg-detail");La.on("click",function(){La.select()});La.addClass("extreport-dataset-designer-top-border");ha.layoutCtrlWithLRTB(La,
0,0,null,35,0,null);ua.appendTo(M);La.appendTo(M)});O.setOptionType(l.OPTION_OK);O.setButtonText(l.OPTION_OK,h.get("ok","\u786e\u5b9a"));O.setMessage(T);O.showDialog(300,320)}}function D(A,B){Ub.call(this,A);var J=this;this.protectedGetHintInSql=function(C,Z){var R=B.getModel(),W=Ja.fromDataSetSourceType(R.getDataSetType(),B.getDataSourceType()),E=A.createQueryFacade(function(L){if(L){for(var F=0;F<L.length;F++){var w={};(new Ta).fromJsonObject(L[F],w);J.addHintTables(w)}C.showHint({completeSingle:!1})}},
function(L,F){return!0});E.setShowBlocking(!1);E.getTableFields(R.getDataSetType(),W,B.toJsonObject(),Z)}}function Y(A){a.call(this);var B=this,J=this.protectedMethod,C,Z,R=!1,W=[],E;(function(){J.setTitle(h.get("changeSource","\u66f4\u6362\u6570\u636e\u6e90"));J.setSelectable(!0);B.setSize(960,480);J.setContentPaneCreator(function(){E=$("<div>");L();return E});J.setClosingAction(function(v){});J.setClosingChecker(function(){var v=H();if(!v)return J.getMessageCurtain().showPrompt(h.get("oneSource",
"\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u6570\u636e\u6e90\u3002")),!1;if(v.getId()==Z.getName())return!0;var x=v.protectedHasException();if(x)return J.getMessageCurtain().showPrompt(x),!1;S(v);return!1});J.setFooterClosingOnly(!1)})();this.setSourceModel=function(v){Z=v};this.setTableModel=function(v){C=v};var L=function(){var v,x=[],T=A.createQueryFacade(function(O){var M=new ob;M.fromJsonObject(O);v=new oa(A);v.setType(y.DATA_CENTER);v.setDisplayName(y.typeToDisplayName(y.DATA_CENTER));Z.getDataSourceType()==
v.getType()&&(v.setId(Z.getName()),v.setSelected(!0));v.setDBCenterPerm(M.hasDataCenterPerm());v.setEnabled(M.hasDataCenterPerm());if(M.hasDBManagePerm())for(O=M.getOutDBList(),M=0;M<O.length;M++){var fa=O[M],ua=fa.getName();fa=fa.getDbType();if(fa!=bb.TYPE_SUPERQUERY){var La=fa==bb.TYPE_SUPERQUERY?y.USER_SUPER_QUERY:y.OUT_DB,xa=new aa(A);xa.setId(ua);xa.setType(La);xa.setDBType(fa);xa.setDisplayName(ua);xa.setSelected(Z.getDataSourceType()==xa.getType()&&Z.getName()==ua);x.push(xa)}}},function(){return!0},
function(){F(v,void 0,x)});T.setBlockingJqUi(E);T.checkDataSourcePermission(!0)},F=function(v,x,T){var O=$("<div>");O.addClass("generic-switch-content");O.on("click",w);var M=[];v&&M.push(v);x&&M.push(x);na(O,h.get("cosmic","\u91d1\u8776\u4e91\u82cd\u7a79"),M);na(O,h.get("outDB","\u516c\u5171\u6570\u636e\u6e90"),T);E.append(O);v=$("<div>");x=new g;x.setText(h.get("syncSource",'\u540c\u65f6\u4fee\u6539"\u8fde\u63a5"\u753b\u5e03\u5176\u4ed6\u7684\u540c\u6e90\u6570\u636e\u8868'));x.setChecked(R);x.addCheckedListener(function(fa,
ua){R=fa.isChecked()});v.append(x.getJqUi());ha.layoutCtrlWithLRTB(v,0,0,null,null,0,23);E.append(v)},w=function(v){v=$(v.target);if(v=ha.upwardSearchHasClass(v,E,r.MARK_CLASS_NAME)){v=v.attr("source-index");for(var x=0;x<W.length;x++)W[x].setSelected(x==v)}},H=function(){for(var v,x=0;x<W.length;x++)if(W[x].isSelected()){v=W[x];break}return v},na=function(v,x,T){if(0!=T.length){var O=$("<div>");O.text(x);O.addClass("wizard-datasource-dialog-title");x=$("<div>");x.addClass("generic-switch-base");
for(var M=0;M<T.length;M++){var fa=T[M],ua=fa.init();W.push(fa);ua.attr("source-index",W.length-1);x.append(ua)}v.append(O);v.append(x)}},S=function(v){var x=A.getMainDataSetModelVO().getDataSetModel().createNewSource(v.getId(),v.getType()).oModel,T=A.createGenericFacade(function(O){N()},function(O,M){J.getMessageCurtain().showPrompt(M);y.isOutDB(v.getType())&&(v.setEnabled(!1),v.setSelected(!1));return!0});T.setBlockingJqUi(E);T.checkGenericSourceRunnable(x)},N=function(){var v=A.getMainDataSetModelVO().getDataSetModel(),
x=v.clone(),T=H(),O=x.createNewSource(T.getId(),T.getType());T=O.oModel;O.bNewCreated&&x.addSource(T);var M=[];R?ba(x,function(fa){fa.getSourceId()==Z.getId()&&M.push(fa)}):M.push(x.getTableById(C.getId()));for(O=0;O<M.length;O++)M[O].setSourceId(T.getId());A.createDesignerFacade(function(fa){A.jsonModelToUi(fa);J.destroy()},function(){}).checkModel(v.getDataSetId(),x.toJsonObject())},ba=function(v,x){for(v=v.getTables().concat([]);0!=v.length;){var T=v.shift(),O=T.getSubTables();v=v.concat(O);x(T)}}}
function oa(A){r.call(this,A);var B=this,J=!0;this.protectedPaintUI=function(R,W,E){k.background(W,"cosmic");ha.layoutCtrl(W,14,8,90,45);E.addClass("generic-cosmic-source-title");W=(new e(h.get("app","\u5e94\u7528"))).getJqUi();ha.layoutCtrl(W,109,8);R.append(W);W=new Pb;W.setFunSelectedChangeListener(function(L){B.setId(L.value)});C(W,R);Z(W,R);E=W.getJqUi();ha.layoutCtrlWithLRTB(W.getJqText(),0,5,"",0,0,23);W.getJqText().css("background","transparent");ha.layoutCtrlWithLRTB(W.getJqIcon(),"",10,
16,5,0,16);ha.layoutCtrlWithLRTB(E,105,10,null,29,null,30);R.append(E);R.addClass("generic-cosmic-source-cell")};this.setDBCenterPerm=function(R){J=R};this.protectedHasException=function(){if(!B.getId())return h.get("chooseApp2","\u8bf7\u9009\u62e9\u4e00\u4e2a\u5e94\u7528\u3002")};var C=function(R,W){if(!J){R.setEnabled(!1);B.setEnabled(!1);R=(new ia).measureWidth(h.get("app","\u5e94\u7528"));var E=new m,L=$("<div>"),F=h.get("dataCenterTips","\u60a8\u6ca1\u6709\u201c\u6570\u636e\u4e2d\u5fc3\u8fde\u63a5\u201d\u6743\u9650\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u8fdb\u884c\u6388\u6743\u3002\u6388\u6743\u65b9\u5f0f\u8bf7\u53c2\u8003#1\u3002");
L.text(F);L.html(function(){return L.html().replace("#1","<a onclick='javascript:window.open(\""+ea.getQingRptSqlDataSetUrl()+"\");' href='#' style = 'cursor: pointer; color: var(--color-main, #5582f3); text-decoration: none'> "+h.get("helpDoc","\u5e2e\u52a9\u6587\u6863")+"</a>")});E.setTipsHtml(L);E=E.getJqUi();ha.layoutCtrl(E,115+R,10);W.append(E)}},Z=function(R,W){var E=B.getId();if(E){var L={};L.text=E;L.value=E;var F=A.createQueryFacade(function(w){L.text=w},function(){return!0},function(){R.setSelectedValue(L)});
F.setBlockingJqUi(W);F.loadAppNameByAppNumber(E)}}}function aa(A){r.call(this,A);var B;this.getDBType=function(){return B};this.setDBType=function(J){B=J};this.protectedPaintUI=function(J,C,Z){k.background(C,B.replace(" ","_"));C.addClass("wizard-datasource-dialog-cell-outdb");C.addClass("wizard-datasource-dialog-cell-icon");Z.addClass("wizard-datasource-dialog-cell-text");J.addClass("wizard-datasource-dialog-cell")}}function r(A){var B=this,J,C,Z,R,W=!0,E,L,F,w;this.init=function(){E||(E=$("<div>"),
E.addClass(r.MARK_CLASS_NAME),L=$("<div>"),F=$("<div>"),E.attr("title",B.getDisplayName()),F.text(B.getDisplayName()),B.protectedPaintUI(E,L,F),E.append(L),E.append(F),H(),na());return E};this.protectedPaintUI=function(S,N,ba){throw Error("override");};this.protectedHasException=function(){};this.setSelected=function(S){R!=S&&(R=S&&W,H())};this.isSelected=function(){return R};var H=function(){if(E)if(R){var S=$("<div>"),N=$("<div>");k.background(S,"tick");E.addClass("wizard-datasource-dialog-selected");
N.addClass("wizard-datasource-dialog-selected-triangle");S.addClass("wizard-datasource-dialog-selected-icon");E.append(S);E.append(N)}else E.removeClass("wizard-datasource-dialog-selected"),E.find(".wizard-datasource-dialog-selected-triangle").remove(),E.find(".wizard-datasource-dialog-selected-icon").remove()};this.setEnabled=function(S){W=S;na()};var na=function(){E&&(w||(w=$("<div>"),E.append(w),w.css({"background-color":"rgba(0, 0, 0, 0.1)",cursor:"default","z-index":"5"}),ha.layoutCtrl(w,0,0,
"100%","100%")),W?w.hide():w.show())};this.setId=function(S){J=S};this.getId=function(){return J};this.getDisplayName=function(){return C};this.setDisplayName=function(S){C=S};this.setType=function(S){Z=S};this.getType=function(){return Z}}function z(){q.call(this);var A=this.protectedMethod,B,J=this.getJqUi;this.getJqUi=function(){var C=J(),Z=A.getJqInput();B&&(Z.css({left:16,width:"calc(100% - 16px)"}),ha.layoutCtrl(B,2,10,16,16),C.append(B));return C};this.setIcon=function(C){B=C}}"undefined"==
typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.extreport&&(com.kingdee.bos.extreport={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner&&(com.kingdee.bos.extreport.datasetdesigner={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner.generic&&(com.kingdee.bos.extreport.datasetdesigner.generic={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner.generic.component&&
(com.kingdee.bos.extreport.datasetdesigner.generic.component={});var t=com.kingdee.bos.extreport.datasetdesigner.generic.component;t.DataSourceDialog=function(A,B){a.call(this);var J=this,C=this.protectedMethod,Z,R,W,E,L,F=[],w=[],H=[],na={},S={},N={},ba={},v,x;(function(){C.setTitle(h.get("selectDataSource","\u9009\u62e9\u6570\u636e\u6e90"));C.setSelectable(!0);J.setSize(960,480);C.setContentPaneCreator(function(){Z=$("<div>");T();return Z});C.setClosingAction(function(ka){});C.setClosingChecker(function(){if(0==
F.length)return C.getMessageCurtain().showPrompt(h.get("oneSource","\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u6570\u636e\u6e90\u3002")),!1;for(var ka=[],va=B.getSourceIdMap(),P=[],za=0;za<F.length;za++){var Ga=F[za];if(Ga.isMultipleType()){var ab=Object.values(Ga.fetchRelatedSourceMap());0==ab.length?(ab=B.getUniqueSourceId(va),Ga.setId(ab),va[ab]=ab,P.push(Ga),ka[0]=Ga):P=P.concat(ab)}else Ga.getId()||(ab=B.getUniqueSourceId(va),Ga.setId(ab),va[ab]=ab),P.push(Ga),ka[0]=Ga}ka=ka[0];B.setSources(P);B.clearException(ib.DATA_SOURCE,
nb.DATA_SOURCE_UNDEFINED);x&&x(B,ka);return!0});C.setFooterClosingOnly(!1)})();this.setSelectedSource=function(ka){for(var va={},P=0;P<ka.length;P++){var za=ka[P];za.isMultipleType()?va[za.getDataSourceType()]||(va[za.getDataSourceType()]=za.getDataSourceType(),F.push(za)):F.push(za)}};this.setFunCloseCallBack=function(ka){x=ka};var T=function(){var ka=A.createQueryFacade(function(va){var P=new ob;P.fromJsonObject(va);L=P.isSuperQueryNotDeployed();N[y.QING_MODELER]=P.hasQingModelerPerm();N[y.ENTITY]=
P.hasEntityPerm();N[y.DATA_CENTER]=P.hasDataCenterPerm();N[y.SUPER_QUERY]=P.hasSuperQuerySchema()&&!L;N[y.OUT_DB]=P.hasDBManagePerm();N[y.USER_SUPER_QUERY]=P.hasDBManagePerm();if(P.hasDBManagePerm())for(va=P.getOutDBList(),P=0;P<va.length;P++){var za=va[P],Ga=za.getName();za=za.getDbType();za!=bb.TYPE_SUPERQUERY&&(H.push(Q.buildSource(B,y.OUT_DB,Ga)),ba[Ga]=za)}},function(){},function(){w.push(Q.buildSource(B,y.ENTITY));w.push(Q.buildSource(B,y.DATA_CENTER));w.push(Q.buildSource(B,y.QING_MODELER));
E=$("<div>");var va=$("<div>");va.text(h.get("cosmic","\u91d1\u8776\u4e91\u82cd\u7a79"));va.addClass("wizard-datasource-dialog-title");E.append(va);va=O();for(var P=0;P<w.length;P++){var za=w[P],Ga=va[za.getIdentifier()];Ga&&(za=Ga,w[P]=Ga);E.append(M(za,Ga,!0))}if(0<H.length){P=$("<div>");P.text(h.get("outDB","\u516c\u5171\u6570\u636e\u6e90"));P.addClass("wizard-datasource-dialog-title");E.append(P);for(P=0;P<H.length;P++){za=H[P];if(Ga=va[za.getIdentifier()])za=Ga,w[P]=Ga;E.append(M(za,Ga,!1))}va=
$("<div>");va.addClass("wizard-datasource-dialog-title");E.append(va)}E.addClass("wizard-datasource-dialog-main");Z.append(E);va=$("<div>");R=$("<div>");P=$("<div>");W=$("<div>");R.text(h.get("selectedSource","\u5df2\u9009\u6570\u636e\u6e90(#1)").replace("#1",0));P.text(h.get("allClear","\u5168\u90e8\u6e05\u9664"));P.on("click",Qa);for(za=0;za<F.length;za++)fa(F[za]);Ua();R.addClass("wizard-datasource-dialog-total");P.addClass("wizard-datasource-dialog-delete");W.addClass("wizard-datasource-dialog-select-list");
va.addClass("wizard-datasource-dialog-sub");va.append(R);va.append(P);va.append(W);Z.append(va)});ka.setBlockingJqUi(Z);ka.checkDataSourcePermission(!0)},O=function(){for(var ka={},va=0;va<F.length;va++)ka[F[va].getIdentifier()]=F[va];return ka},M=function(ka,va,P){var za=$("<div>"),Ga=$("<div>"),ab=$("<div>");za.on("click",function(){if(O()[ka.getIdentifier()])La(ka);else{var hb=ka.getDataSourceType();if(N[hb])F.push(ka),ua(za,ka),fa(ka),Ua();else{var sb=C.getMessageCurtain(),Bb=sb.showPrompt;v||
(v={},v[y.QING_MODELER]=h.get("invalidDpp","\u5f53\u524d\u7cfb\u7edf\u6ca1\u6709\u3010\u8f7b\u5efa\u6a21\u3011\u6a21\u5757\u7684\u4f7f\u7528\u8bb8\u53ef\uff0c\u8bf7\u4e0e\u7cfb\u7edf\u7ba1\u7406\u5458\u8054\u7cfb\u3002"),v[y.DATA_CENTER]=h.get("invalidDBCenter","\u60a8\u6ca1\u6709\u201c\u6570\u636e\u4e2d\u5fc3\u8fde\u63a5\u201d\u6743\u9650\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u8fdb\u884c\u6388\u6743\u3002"),v[y.SUPER_QUERY]=h.get("superQueryTips2","\u201c\u8d85\u7ea7\u67e5\u8be2\u201d\u6ca1\u6709\u53ef\u7528\u7684\u6a21\u5f0f\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u8fdb\u884c\u6388\u6743\u3002"));
hb=hb==y.SUPER_QUERY&&L?h.get("superQueryTips1","\u5f53\u524d\u73af\u5883\u672a\u90e8\u7f72\u8d85\u7ea7\u67e5\u8be2\u670d\u52a1\u6216\u670d\u52a1\u672a\u542f\u52a8\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u68c0\u67e5\u8d85\u7ea7\u67e5\u8be2\u90e8\u7f72\u60c5\u51b5\u3002"):v[hb];Bb.call(sb,hb)}}});za.attr("title",ka.getDisplayName());ab.text(ka.getDisplayName());P?k.background(Ga,"cosmic"):(P=ba[ka.getName()],k.background(Ga,P.replace(" ","_")),za.addClass("wizard-datasource-dialog-cell-outdb"));
za.addClass("wizard-datasource-dialog-cell");Ga.addClass("wizard-datasource-dialog-cell-icon");ab.addClass("wizard-datasource-dialog-cell-text");za.append(Ga);za.append(ab);va&&ua(za,ka);return za},fa=function(ka){var va=$("<div>"),P=$("<div>"),za=$("<div>"),Ga=ka.check();Ga?(Ga=Db.getErrorIcon(Ga),Ga.addClass("wizard-datasource-dialog-item-error"),va.append(Ga),ha.layoutCtrlWithLRTB(P,18)):ha.layoutCtrlWithLRTB(P,2);za.attr("title",h.get("del","\u5220\u9664"));za.on("click",function(){La(ka)});k.background(za,
"delete");za.hide();P.text(ka.getDisplayName());va.attr("title",ka.getDisplayName());va.on("mouseenter",function(){P.addClass("wizard-datasource-dialog-item-text-hover");za.show()});va.on("mouseleave",function(){P.removeClass("wizard-datasource-dialog-item-text-hover");za.hide()});S[ka.getIdentifier()]=va;va.addClass("wizard-datasource-dialog-select-item");P.addClass("wizard-datasource-dialog-item-text");za.addClass("wizard-datasource-dialog-select-delete");va.append(P);va.append(za);W.append(va)},
ua=function(ka,va){na[va.getIdentifier()]=ka;va=$("<div>");var P=$("<div>");k.background(va,"tick");ka.addClass("wizard-datasource-dialog-selected");P.addClass("wizard-datasource-dialog-selected-triangle");va.addClass("wizard-datasource-dialog-selected-icon");ka.append(va);ka.append(P)},La=function(ka){var va=ka.checkDeletable();va?C.getMessageCurtain().showPrompt(va):(F.splice(F.indexOf(ka),1),xa(ka),Ua())},xa=function(ka){ka=ka.getIdentifier();var va=S[ka],P=na[ka];va&&(va.remove(),delete S[ka]);
P&&(P.removeClass("wizard-datasource-dialog-selected"),P.find(".wizard-datasource-dialog-selected-triangle").remove(),P.find(".wizard-datasource-dialog-selected-icon").remove(),delete na[ka])},Qa=function(){if(0!=F.length){for(var ka=[],va=0;va<F.length;va++){var P=F[va];P.checkDeletable()?ka.push(P):xa(P)}F=ka;0<F.length&&(ka=1==F.length?F[0].checkDeletable():h.get("delTablesBeforeSource","\u201c#1\u201d\u7b49#2\u4e2a\u6570\u636e\u6e90\u5df2\u88ab\u6570\u636e\u96c6\u4f7f\u7528\uff0c\u8bf7\u5148\u5728\u201c\u8fde\u63a5\u201d\u533a\u57df\u5220\u9664\u76f8\u5e94\u6570\u636e\u6e90\u4e0b\u7684\u8868\u3002").replace("#1",
F[0].getDisplayName()).replace("#2",F.length),C.getMessageCurtain().showPrompt(ka));Ua()}},Ua=function(){R.text(h.get("selectedSource","\u5df2\u9009\u6570\u636e\u6e90(#1)").replace("#1",F.length))}};t.FieldsChosenDialog=Za;t.JoinConfigPane=Xa;t.NodeStatusMonitor=Ra;t.InvalidPane=yb;t.GenericSearchTableCache=qb;var h,ea,k,c,b,a,e,d,g,m,q,l,V,G,pa,ma,Aa,Pa,ca,la,Ba,ha,ia,n,u,p,f,Q,y,ra,Ka,Wa,ib,nb,ta,Ja,Ta,bb,ob,xb,da,Ha,wa,Da,Ea,Ma,Va,eb,Ya,cb,pb,zb,Jb,Mb,Nb,Fb,Rb,Ob,Sb,Kb,Qb,Tb,Gb,Ub,Pb;(function(){var A=
com.kingdee.bos.qing.framework.common;h=A.MultilanguageManager.createPackageAccessor(com.kingdee.bos.extreport.datasetdesigner);ea=A.OfficialArticleUtil;A=com.kingdee.bos.extreport.datasetdesigner;k=A.Icons;A=com.kingdee.bos.extreport.datasetdesigner.model;c=A.DataSetType;b=A.OutputColumDataType;A=com.kingdee.bos.qing.ui.component;e=A.Label;d=A.ComboBox;g=A.CheckBox;m=A.HelpIcon;q=A.TextField;l=A.MessageDialog;V=A.RadioButton;a=A.AbstractModalDialog;G=A.F7Selector;pa=A.RadioButtonGroup;ma=A.WorkButton;
Aa=A.SplitPane;ca=A.DropdownSelector;Pa=A.SearchBox;la=A.WizardDialog;Ba=A.SimpleConfirmer;A=com.kingdee.bos.qing.common;ha=A.DomUtil;ia=A.TextMeasurer;A=com.kingdee.bos.extreport.datasetdesigner.model;ib=A.DataSetModelCheckType;nb=A.DataSetModelCheckCode;ta=A.DataSetModelCheckResult;Ja=A.RptSourceType;Ta=A.FolderNode;bb=A.OutDBVO;ob=A.DataSourceCheckerVO;da=A.DataSourceTableObjectVO;Ma=A.LeafNode;Va=A.SuperQueryCheckerVO;eb=A.DBCenterCheckerVO;A=com.kingdee.bos.extreport.datasetdesigner.generic.model;
n=A.GenericQueryTable;u=A.GenericQueryColumn;p=A.GenericQueryCalcCol;f=A.GenericQueryOrder;Q=A.GenericQueryDataSetModel;y=A.GenericQueryDataSourceType;ra=A.GenericQueryJoinType;Ka=A.GenericQueryJoinField;Wa=A.GenericQueryJoin;xb=A.GenericQueryOrderType;Ha=A.GenericQueryUserSql;wa=A.GenericQueryUserSqlType;Da=A.UnionFieldRowWrapper;Ea=A.UnionFieldHelperBuilder;A=com.kingdee.bos.qing.common.ui;Ya=A.TableUtil;cb=A.CommonIconUtil;A=com.kingdee.bos.extreport.datasetdesigner.wizard.output;Jb=A.GenericDataSetFilterRender;
A=com.kingdee.bos.extreport.datasetdesigner.common;Rb=A.StringUtil;Ob=A.EventType;Sb=A.EntityHelper;A=com.kingdee.bos.extreport.datasetdesigner.common.ui;Nb=A.SearchableTable;Fb=A.IconHelper;pb=A.CheckBoxTable;Kb=A.SearchDropDown;Qb=A.ChoosePropertyPane;Tb=A.SystemAndMacroVarArea;Gb=A.QueryCommonUi;Ub=A.QueryArea;Pb=A.AppChooseDialogSelector;zb=A.CalcFieldEditor;Mb=A.TableCustomExpandor})();var Vb=new function(){var A;this.measureWidth=function(B,J){A||(A=new com.kingdee.bos.qing.common.TextMeasurer);
J||(J=12);Vb.setFontSize(J);return A.measureWidth(B)}},Wb=new function(){var A,B,J;this.setGlobal=function(C){A=C};this.setNodeStatusMonitor=function(C){B=C};this.getJqUiByModel=function(C){J||(J={},J[n.KEY_TABLE]=sa,J[Wa.KEY_JOIN]=Oa);var Z=new (J[C.getKey()])(A);Z.setGenericModel(C);Z.setNodeStatusMonitor(B);return Z}};t.AttrUIFactory=Wb;fb.CONTENT_SELECTED_CLASS="checkbox-tree-content-selected";var Db=new function(){this.getErrorIcon=function(A){var B=$("<div>");B.text("!");B.addClass("wizard-error-icon");
A?(B.attr("title",A),B.show()):B.hide();return B}};t.ErrorIconFactory=Db;Ra.KEY_NODE_SELECTED="NEW_NODE_SELECTED";Ra.CHANGE_JOIN_TYPE="CHANGE_JOIN_TYPE";Ra.KEY_TARGET_JOIN_CHANGE="KEY_TARGET_JOIN_CHANGE";Ra.KEY_NODE_RELAYOUT="KEY_NODE_RELAYOUT";Ra.KEY_NODE_CHANGE_POSITION="KEY_NODE_CHANGE_POSITION";Ra.KEY_NODE_RENAME="KEY_NODE_RENAME";Ra.KEY_NODE_FIELDS_RESELECT="KEY_NODE_FIELDS_RESELECT";Ra.KEY_NODE_JOIN_FIELD_CHANGE="KEY_NODE_JOIN_FIELD_CHANGE";Ra.KEY_NODE_FILTER_CHANGE="KEY_NODE_FILTER_CHANGE";
Ra.KEY_NODE_ORDER_CHANGE="KEY_NODE_ORDER_CHANGE";Ra.KEY_NODE_CALC_CHANGE="KEY_NODE_CALC_CHANGE";Ra.MANUAL_MODEL_TO_UI="MANUAL_MODEL_TO_UI";Ra.SWITCH_ORDER_OF_JOIN="SWITCH_ORDER_OF_JOIN";Ra.KEY_DEL_SUBTABLE="KEY_DEL_SUBTABLE";Ra.KEY_REFRESH_ATTR_UI="KEY_REFRESH_ATTR_UI";var Hb=new function(){var A,B,J,C,Z,R=[],W=[],E;this.setGlobal=function(N){A=N};this.setFunDelSourceInterceptor=function(N){E=N};this.removeFunDelSourceInterceptor=function(){E=null};this.addTable=function(N,ba,v,x){B=N;J=ba;ba=B.createNewSource(v,
x);C=ba.oModel;Z=ba.bNewCreated;0==N.getTables().length?na():S()};this.deleteTable=function(N){B=N.getModel();var ba=B.findRelatedToCurrentTables(N,!0);for(L(N);0!=ba.length;)L(ba.shift());ba=B;for(var v=0;v<R.length;v++)(0,R[v])(ba,N,void 0);H()};var L=function(N){B.doDeleteJoinByRight(N);F(N);B.doDeleteColumns(N);var ba=B.getTables();ba.splice(ba.indexOf(N),1)};this.deleteSubTable=function(N,ba,v){B=N.getModel();v&&(v=Ea.build(ba),v.delGenericTable(N),v.syncToModel());F(N);ba.syncColsToDataSet();
H()};var F=function(N){var ba=A.getMainDataSetModelVO().getDataSetModel().getSources();N=N.getUniqueRefsSourceIds();if(0!=N.length){var v=[];for(var x={},T=0;T<ba.length;T++){var O=ba[T];if(O.isMultipleType()&&0==O.getUserSqls().length){var M=O.getDataSourceType();x[M]||(x[M]={});x[M][O.getId()]=O;-1!=N.indexOf(O.getId())&&v.push(O)}}v=[x,v];N=v[0];v=v[1];for(x=0;x<v.length;x++)T=v[x],O=E?E(T):!0,O&&(O=T.getDataSourceType(),M=Object.values(N[O]),1<M.length?(delete N[O][T.getId()],T=ba.indexOf(T),
-1!=T&&ba.splice(T,1)):1==M.length&&N[O][T.getId()].setName(null))}};this.addFunAddTableCallBack=function(N){W.push(N)};var w=function(N,ba,v){for(var x=0;x<W.length;x++)(0,W[x])(N,ba,v)};this.addFunDeleteTableCallBack=function(N){R.push(N)};var H=function(){C=Z=J=B=null},na=function(){var N=new Za(A,C,J);N.setCloseCallBack(function(ba,v){J.addColsToDataSet(ba);B.addTableAndSource(C,Z,J);J.setName(v);w(B,J);H()});N.showDialog()},S=function(){var N=new Ab(A,B,C,Z,J);N.setFunFinishedCallBack(function(ba,
v){w(B,ba,v);H()});N.show()}};t.TableHelper=Hb;qb.SOURCE_NAME={};qb.TABLE={};qb.clear=function(){qb.TABLE={}};var Ib=new function(){this.create=function(A){var B=new Ma;B.setCommentInfo(A.getAlias());B.setDisplayName(A.getAlias());B.setName(A.getName());B.setType(Ib.DATABASE_TYPE);return B};this.isUserSqlNode=function(A){return A instanceof Ma&&A.getType()==Ib.DATABASE_TYPE}};Ib.DATABASE_TYPE="Generic_DataBase";var Xb=new function(){var A,B,J,C,Z,R;this.setGlobal=function(F){A=F};this.setNodeStatusMonitor=
function(F){B=F};this.setDragHandler=function(F){J=F};this.setFunSyncSourceState=function(F){C=F};this.setFunGetLinkAreaCentralPos=function(F){Z=F};this.getSearchTable=function(F){F=W(F);F.loadData(F.getJqUi());return F};var W=function(F){R||(R={},R[y.DATA_CENTER]=$a,R[y.SUPER_QUERY]=db,R[y.USER_SUPER_QUERY]=wb,R[y.OUT_DB]=wb,R[y.QING_MODELER]=rb,R[y.ENTITY]=rb);var w=new (R[F.getDataSourceType()])(A,F);w.setFunSyncSourceState(C);w.setNodeStatusMonitor(B);w.setFunDBClickedCallback(function(H){if(H instanceof
Ma){var na=w.getGenericSource(),S=na.getDataSourceType();na=E(H,na);var N=A.getMainDataSetModelVO().getDataSetModel();H=L(H);var ba=Z();H.setPosition(ba[0],ba[1]);Hb.addTable(N,H,na,S)}return null});J.bindDragUi(w.getJqUi(),function(H){if(H=ha.upwardSearch(H,w.getJqUi(),function(N){return N.hasClass("wizard-tablearea-table-item-context")})){H=H.data("model");if(H instanceof Ma){var na=w.getGenericSource(),S=na.getDataSourceType();na=E(H,na);return[L(H),na,S]}return null}});return w},E=function(F,
w){var H=w.getDataSourceType();return y.containTableSourceName(H)?F.getName():w.getName()},L=function(F){var w=A.getMainDataSetModelVO().getDataSetModel(),H=new n(w);H.setName(F.getName());H.setAlias(F.getDisplayName());H.setDisplayName(F.getDisplayName());H.setId(w.getUniqueTableId());return H}};t.SearchableTableFactory=Xb;ja.SQL="SQL";ja.KSQL="KSQL";r.MARK_CLASS_NAME="generic-source"})();(function(){function Ca(){var qa=this;this.createNode=function(K){return document.createElementNS("http://www.w3.org/2000/svg",K)};this.createWithAttrs=function(K,I){K=qa.createNode(K);qa.setAttributes(K,I);return K};this.setText=function(K,I){$(K).empty();I=document.createTextNode(I);K.appendChild(I)};this.setTitle=function(K,I){var X=K.getElementsByTagName("title");0==X.length?(X=qa.createNode("title"),K.appendChild(X)):X=X[0];qa.setText(X,I)};this.addClass=function(K,I){$(K).addClass(I)};this.createPath=
function(K,I,X,ja){var U=qa.createNode("path"),D=qa.getPathCoordinate(K,I),Y=qa.getPathCoordinate(K+X,I);X=qa.getPathCoordinate(K+X,I+ja);K=qa.getPathCoordinate(K,I+ja);qa.setAttributes(U,{d:"M"+D+" L"+Y+" L"+X+" L"+K+" Z"});return U};this.setAttributes=function(K,I){for(var X in I)K.setAttribute(X,I[X])};this.getPathCoordinate=function(K,I){return""+K+" "+I}}function sa(qa){var K=this,I,X=new Ca,ja,U,D,Y,oa,aa,r,z,t;this.getModel=function(){return qa};this.getX=function(){return 0};this.getY=function(){return 0};
this.getWidth=function(){return kb.BASE_WIDTH};this.getHeight=function(){return kb.BASE_HEIGHT};this.setScaleHelper=function(b){U=b};this.getScaleHelper=function(){return U};this.changeNodeDisplayName=function(){throw Error("override me");};this.getNamePositionRect=function(){throw Error("override me");};this.getOperateIconUi=function(){return D};this.updateUiInHover=function(b){};this.changePosition=function(b,a){I&&(b=ea([b,a]),X.setAttributes(I,{transform:"translate("+b[0]+","+b[1]+")"}))};this.getSvgElement=
function(){if(!I){I=X.createNode("g");X.setAttributes(I,{transform:"translate("+h(K.getX())+","+h(K.getY())+")"});K.protectedAddUi(I);var b=X.createNode("rect");X.setAttributes(b,{width:h(20),height:h(20),x:h(K.getWidth()-20)+"px",y:h((K.getHeight()>>1)-10)+"px",fill:"none","pointer-events":"visible",cursor:"pointer"});I.appendChild(b);D=$(b);b=X.createNode("image");X.setAttributes(b,{width:h(18),height:h(18),x:h(K.getWidth()-18-5)+"px",y:h((K.getHeight()>>1)-9)+"px",href:Xa.SvgIconHelper.makeUrl("menu"),
cursor:"pointer"});I.appendChild(b);Y=$(b);X.setTitle(b,tb.get("moreOperation","\u66f4\u591a\u64cd\u4f5c"));Y.addClass(sa.NODE_OPERATE_ICON_CLASS);D.addClass(sa.NODE_OPERATE_ICON_CLASS);Y.hide();D.hide();k();c()}return I};this.remove=function(){I&&I.remove();z&&z.remove();z=I=null};this.protectedAddUi=function(b){};this.setSelected=function(b){oa=b;k()};this.isSelected=function(){return oa};this.setHover=function(b){(aa=b)?(D.show(),Y.show()):(Y.hide(),D.hide());K.updateUiInHover(aa)};this.isHover=
function(){return aa};this.setInvalid=function(b,a){r=b;t=a;c()};var h=function(b){return U?U.getScaledSize(b):b},ea=function(b){return U?U.getScaledCoordinate(b):b},k=function(){if(I)if(oa){ja=X.createNode("rect");var b=Math.max(2,h(2));X.setAttributes(ja,{width:h(K.getWidth())+b,height:h(K.getHeight())+b,x:-(b>>1),y:-(b>>1),rx:h(4),fill:"none","stroke-width":b,stroke:"#276ff5"});I.appendChild(ja)}else ja&&ja.remove(),ja=null},c=function(){if(I)if(r){if(z||(z=X.createNode("image"),X.setAttributes(z,
{width:h(16),height:h(16),x:h(K.getWidth()-16>>1),y:-h(19),href:Xa.SvgIconHelper.makeUrl("error")}),I.appendChild(z)),t){var b=X.createNode("title");X.setText(b,t);z.appendChild(b)}}else z&&z.remove(),z=null};this.protectedMethod={getSvgHelper:function(){return X},getScaledSize:h,getScaledCoordinate:ea}}function Fa(qa){sa.call(this,qa);var K=this,I=this.protectedMethod,X,ja,U,D;this.getId=function(){return K.getGenericTable().getId()};this.getCoordinate=function(){return[K.getX(),K.getY()]};this.getGenericTable=
function(){return qa};this.setPosition=function(aa,r){qa.setX(aa);qa.setY(r)};this.getX=function(){return qa.getX()};this.getY=function(){return qa.getY()};this.getWidth=function(){return kb.BASE_WIDTH};this.getHeight=function(){return kb.BASE_HEIGHT};this.protectedAddUi=function(aa){ja=aa;I.getSvgHelper().addClass(aa,sa.NODE_UI_CLASS);aa.setAttribute("id",K.getId());K.addRectUi(ja,qa);aa=ja;var r=K.protectedGetUiOffsetX(),z=I.getSvgHelper(),t=z.createNode("text");$(t).addClass(sa.NODE_NAME_UI_CLASS);
z.setAttributes(t,{fill:"#666",x:I.getScaledSize(Fa.TEXT_LEFT+r),y:I.getScaledSize(5+Fa.FONT_SIZE),"font-size":I.getScaledSize(Fa.FONT_SIZE),cursor:"default"});aa.appendChild(t);X=t;Y(qa.getAlias());t=K.protectedGetUiOffsetX();r=I.getSvgHelper();z=r.createNode("rect");var h=r.setAttributes,ea=I.getScaledSize(30),k=I.getScaledSize(30),c=I.getScaledSize(5+t),b=I.getScaledSize(K.getHeight()-30)>>1,a=I.getScaledSize(4);if(qa.isUnionTable())var e=Xa.SvgIconHelper.getTableIconColor();else{e=qa.getTableSource();
var d="";e[0]&&(d=e[0].getDataSourceType());e=Xa.SvgIconHelper.getTableIconColor(d)}h.call(r,z,{width:ea,height:k,x:c,y:b,rx:a,fill:e});h=r.createNode("image");ea=r.setAttributes;k=I.getScaledSize(20);c=I.getScaledSize(20);t=I.getScaledSize(10+t);b=I.getScaledSize(K.getHeight()-20)>>1;a=Xa.SvgIconHelper;e=a.makeUrl;d=qa.isUnionTable()?"union":qa.isUserSqlSource()?"usersql":"table";ea.call(r,h,{width:k,height:c,x:t,y:b,href:e.call(a,d)});aa.appendChild(z);aa.appendChild(h);r=K.protectedGetUiOffsetX();
z=I.getSvgHelper();U=z.createNode("text");z.setAttributes(U,{fill:"#666",x:I.getScaledSize(Fa.TEXT_LEFT+16+1+r),y:I.getScaledSize(kb.BASE_HEIGHT-4-5+1),"font-size":I.getScaledSize(10)});D=z.createNode("image");z.setAttributes(D,{width:I.getScaledSize(16),height:I.getScaledSize(16),x:I.getScaledSize(Fa.TEXT_LEFT-2+r),y:I.getScaledSize(kb.BASE_HEIGHT-4-16),href:Xa.SvgIconHelper.makeUrl("field_num")});aa.appendChild(D);aa.appendChild(U);oa()};this.addRectUi=function(aa,r){r=I.getSvgHelper();var z=r.createNode("rect");
r.setAttributes(z,{width:I.getScaledSize(K.getWidth()),height:I.getScaledSize(K.getHeight()),x:0,y:0,rx:I.getScaledSize(4),fill:"#fafafa","stroke-width":I.getScaledSize(1),stroke:"#999",cursor:"pointer"});aa.appendChild(z)};this.changeNodeDisplayName=function(){Y(qa.getAlias())};this.updateUiInHover=function(aa){aa=aa?Fa.NAME_WIDTH-20:Fa.NAME_WIDTH;Y(qa.getAlias(),aa)};this.updateFieldCount=function(){oa()};this.protectedGetUiOffsetX=function(){return 0};var Y=function(aa,r){var z=K.protectedGetUiOffsetX();
null==r&&(r=Fa.NAME_WIDTH);r-=z;z=I.getSvgHelper();r=Xa.SvgTextTrimer.trim(aa,I.getScaledSize(Fa.FONT_SIZE),I.getScaledSize(r));z.setText(X,r);z.setTitle(ja,aa)};this.getTitle=function(){return qa.getAlias()};this.getNamePositionRect=function(){var aa=I.getScaledSize(K.getX()+Fa.TEXT_LEFT),r=I.getScaledSize(K.getY()+Fa.TEXT_TOP),z=I.getScaledSize(Fa.NAME_WIDTH),t=Math.max(14,I.getScaledSize(18));return[aa,r,z,t]};var oa=function(){if(U){var aa=qa.getColumns().length,r=I.getSvgHelper();r.setText(U,
aa);aa=tb.get("selectedFields","\u5df2\u9009\u62e9#1\u4e2a\u5b57\u6bb5").replace("#1",aa);r.setTitle(U,aa);r.setTitle(D,aa)}}}function Sa(qa){Fa.call(this,qa);var K=this,I=this.protectedMethod,X,ja,U=[];this.getId=function(){return K.getGenericTable().getId()};this.getHeight=function(){return kb.BASE_HEIGHT*(qa.getSubTables().length+1)};this.protectedAddUi=function(aa){X=aa;aa=I.getSvgHelper();var r=aa.createNode("rect");aa.setAttributes(r,{width:I.getScaledSize(K.getWidth()),height:I.getScaledSize(K.getHeight()),
x:0,y:0,rx:I.getScaledSize(4),fill:"#fafafa","stroke-width":I.getScaledSize(1),stroke:"#999",cursor:"pointer"});X.append(r);D()};this.updateUiInHover=function(aa){};this.updateFieldCount=function(){ja&&ja.updateFieldCount()};this.changeNodeDisplayName=function(){ja&&ja.changeNodeDisplayName()};this.getTableNodeUIs=function(){return U};var D=function(){U=[];var aa=K.getScaleHelper(),r=new Oa(qa);r.setScaleHelper(aa);var z=r.getSvgElement();X.append(z);ja=r;U.push(r);qa.getSubTables().forEach(function(t,
h){t=new Za(t,qa);t.setScaleHelper(aa);h=t.getSvgElement();X.append(h);U.push(t)});Y()},Y=function(){var aa=kb.BASE_HEIGHT,r=aa,z=I.getSvgHelper(),t=z.createNode("path");z.setAttributes(t,{"stroke-width":I.getScaledSize(1),stroke:"#999",d:oa(0,r)});X.append(t);aa+=kb.BASE_HEIGHT;r=qa.getSubTables();for(z=0;z<r.length;z++)if(z!=r.length-1){t=aa;var h=I.getSvgHelper(),ea=h.createNode("path");h.setAttributes(ea,{"stroke-dasharray":"5,5",stroke:"#999",d:oa(0,t)});X.append(ea);aa+=kb.BASE_HEIGHT}},oa=
function(aa,r){var z="M"+I.getScaledSize(aa)+" ";z+=I.getScaledSize(r)+" ";z+="L"+I.getScaledSize(aa+K.getWidth())+" ";return z+=I.getScaledSize(r)+" "}}function Oa(qa){Fa.call(this,qa);var K=this,I=this.protectedMethod;this.getId=function(){return K.getGenericTable().getId()+Sa.INNER_NODE+K.getGenericTable().getId()};this.getCoordinate=function(){return[K.getGenericTable().getX(),K.getGenericTable().getY()]};this.getX=function(){return 0};this.getY=function(){return 0};this.addRectUi=function(X,
ja){ja=I.getSvgHelper();var U=ja.createNode("rect");ja.setAttributes(U,{width:I.getScaledSize(K.getWidth()-2),height:I.getScaledSize(K.getHeight()-2),x:I.getScaledSize(1),y:I.getScaledSize(1),rx:I.getScaledSize(4),fill:"#fafafa","stroke-width":0,stroke:"none",cursor:"pointer"});X.appendChild(U)};this.getNamePositionRect=function(){var X=I.getScaledSize(qa.getX()+Fa.TEXT_LEFT),ja=I.getScaledSize(qa.getY()+Fa.TEXT_TOP),U=I.getScaledSize(Fa.NAME_WIDTH),D=Math.max(14,I.getScaledSize(18));return[X,ja,
U,D]}}function Za(qa,K){Fa.call(this,qa);var I=this.protectedMethod,X=this;this.getCoordinate=function(){var ja=K.getX(),U=K.getY();return[ja,U+X.getY()]};this.getId=function(){return K.getId()+Sa.INNER_NODE+X.getGenericTable().getId()};this.getParentNode=function(){return K};this.getX=function(){return 0};this.getY=function(){return kb.BASE_HEIGHT*(K.getSubTables().indexOf(qa)+1)};this.addRectUi=function(ja,U){U=I.getSvgHelper();var D=U.createNode("rect");U.setAttributes(D,{width:I.getScaledSize(X.getWidth()-
2),height:I.getScaledSize(X.getHeight()-2),x:I.getScaledSize(1),y:I.getScaledSize(1),rx:I.getScaledSize(4),fill:"#fafafa","stroke-width":0,stroke:"none",cursor:"pointer"});ja.appendChild(D)};this.protectedGetUiOffsetX=function(){return 35};this.getNamePositionRect=function(){var ja=I.getScaledSize(K.getX()+X.getX()+Fa.TEXT_LEFT+X.protectedGetUiOffsetX()),U=I.getScaledSize(K.getY()+X.getY()+Fa.TEXT_TOP),D=I.getScaledSize(Fa.NAME_WIDTH-X.protectedGetUiOffsetX()),Y=Math.max(14,I.getScaledSize(18));return[ja,
U,D,Y]}}function gb(){var qa,K=new Ca,I,X,ja,U,D,Y=gb.DEFAULT_ICON_SIZE,oa=gb.DEFAULT_ICON_SIZE+20,aa,r,z,t;this.setGenericJoin=function(a){X=a};this.getGenericJoin=function(){return X};this.setInvalid=function(a,e){U=a;D=e;h()};var h=function(){if(r)if(U){if(z||(z=K.createNode("image"),K.setAttributes(z,{width:c(16),height:c(16),x:c(gb.DEFAULT_ICON_SIZE-16>>1),y:0,href:Xa.SvgIconHelper.makeUrl("error")}),r.appendChild(z)),D){var a=K.createNode("title");K.setText(a,D);z.appendChild(a)}}else z&&z.remove(),
z=null};this.getSvgElement=function(){if(!r){var a=k(),e=a[1];a=ea(a[0]);var d=K.createNode("path");K.setAttributes(d,{d:a,"stroke-width":c(2),fill:"none",stroke:"#b5bfd3"});aa=d;a=c(gb.DEFAULT_ICON_SIZE);d=K.createNode("image");K.setAttributes(d,{width:a,height:a,x:0,y:c(10),href:Xa.SvgIconHelper.makeUrl(X.getIconName()),cursor:"pointer"});qa=d;a=X.getModel().getJoins().indexOf(X);a=0>a?"-1":a+1+"";d=$a.measureText(a,10);var g=K.createNode("text");K.setAttributes(g,{fill:"#666",x:c(Y-d>>1),y:c(oa-
5),"font-size":c(10)});K.setText(g,a);t=g;r=K.createNode("g");a=c(oa);K.setAttributes(r,{transform:"translate("+(e[0]-(a>>1))+","+(e[1]-(a>>1))+")",width:c(Y),height:c(oa)});r.appendChild(qa);r.appendChild(t);b();h()}return[aa,r]};var ea=function(a){for(var e="",d=0;d<a.length;d++){var g=a[d];0==d?e+="M":e+=" L";e+=K.getPathCoordinate(g[0],g[1])}return e};this.setScaleHelper=function(a){I=a};this.remove=function(){aa&&aa.remove();qa&&qa.remove();z&&z.remove();r&&r.remove();t&&t.remove();t=r=z=qa=
aa=null};this.changePosition=function(){if(aa){var a=k(),e=a[1],d=c(gb.DEFAULT_ICON_SIZE+20);K.setAttributes(aa,{d:ea(a[0])});K.setAttributes(r,{transform:"translate("+(e[0]-(d>>1))+","+(e[1]-(d>>1))+")"})}};this.setSelected=function(a){ja=a;b()};var k=function(){for(var a=Xa.LineCoordinateHelper.getLinePathCoordinate(X),e=[],d=0;d<a.length;d++){var g=a[d];g=[g.getX(),g.getY()];g=I?I.getScaledCoordinate(g):g;e.push(g)}a=e.pop();e.push([a[0]+c(gb.DEFAULT_ICON_SIZE+10),a[1]]);d=[e[e.length-2],e[e.length-
1]];g=d[0][0]+d[1][0]>>1;2==e.length&&(g=(a[0]+e[0][0]>>1)+d[1][0]>>1);return[e,[g,d[0][1]+d[1][1]>>1]]},c=function(a){return I?I.getScaledSize(a):a},b=function(){aa&&(ja?K.setAttributes(aa,{"stroke-width":c(2),stroke:"#276ff5"}):K.setAttributes(aa,{"stroke-width":c(2),stroke:"#b5bfd3"}))}}function mb(qa){function K(){var r=[],z=!1;this.isBetween=function(h,ea){return 0<r.length?r[0]==h&&r[r.length-1]==ea:!1};this.getLength=function(){return r.length};this.setEnd=function(h){z=h};this.isEnd=function(){return z};
this.addRect=function(h){r.push(h)};this.getAllRect=function(){return r};this.getLastRect=function(){if(0<r.length)return r[r.length-1]};this.generateLinePath=function(h,ea){if(0==r.length)return null;var k=r[r.length-1];if(!r[0].isInRect(h)||!k.isInRect(ea))return null;k=[];k.push(h);for(var c=1;c<r.length;c++){var b=k,a=b.push;a:{var e=k[k.length-1],d=r[c-1],g=r[c];var m=e.getX();e=e.getY();d=d.getOverlapLineSegment(g);if(d.isHorizontal()){if(m>d.getStartX()&&m<d.getEndX()){m=new ya(m,d.getStartY());
break a}}else if(e>d.getStartY()&&e<d.getEndY()){m=new ya(d.getStartX(),e);break a}m=d.getMidPoint()}a.call(b,m)}k.push(ea);ea=[];ea.push(h);for(c=1;c<k.length;c++){e=k[c-1];var q=k[c];h=r[c-1];m=[];g=e.getX();d=e.getY();a=q.getX();b=q.getY();h.isOnBorder(e)&&h.isOnBorder(q)?(e=h.getPositionRelation(e,q),e==I.POSITION_RELATION_ADJACENT_SIDE?(m=g,g=h,h=new ya(a,d),g.isOnBorder(h)&&(h=new ya(m,b)),g=[],g.push(new ya(m,d)),g.push(h),g.push(new ya(a,b)),m=g):e==I.POSITION_RELATION_SAME_SIDE?(m=g,e=h,
m==a?(q=Math.min(10,e.getWidth()>>1),g=new ya(m-q,d),h=new ya(a-q,b),e.isInRect(g)&&e.isInRect(h)||(g=new ya(m+q,d),h=new ya(m+q,b))):(q=Math.min(10,e.getHeight()>>1),g=new ya(m,d-q),h=new ya(a,b-q),e.isInRect(g)&&e.isInRect(h)||(g=new ya(m,d+q),h=new ya(a,b+q))),e=[],e.push(new ya(m,d)),e.push(g),e.push(h),e.push(new ya(a,b)),m=e):g==a||d==b?(m.push(new ya(g,d)),m.push(new ya(a,b))):m=t(g,d,a,b,h)):g==a||d==b?(m.push(new ya(g,d)),m.push(new ya(a,b))):m=t(g,d,a,b,h);h=m;h.splice(0,1);ea=ea.concat(h)}k=
ea;c=[];for(ea=0;ea<k.length;ea++){h=k[ea];b=c.length;if(a=1<b)a=c[b-2],m=c[b-1],d=h,a=a.getX()==m.getX()&&m.getX()==d.getX()||a.getY()==m.getY()&&m.getY()==d.getY()?!0:!1;a&&c.splice(b-1,1);c.push(h)}return c};this.clone=function(){for(var h=new K,ea=0;ea<r.length;ea++)h.addRect(r[ea]);return h};var t=function(h,ea,k,c,b){var a=h+k>>1,e=[];e.push(new ya(h,ea));var d=new ya(a,ea);a=new ya(a,c);if(b.isOnBorder(d)||b.isOnBorder(a))ea=ea+c>>1,d=new ya(h,ea),a=new ya(k,ea);e.push(d);e.push(a);e.push(new ya(k,
c));return e}}function I(r,z,t,h){var ea=this;this.isInRect=function(c){var b=c.getX();c=c.getY();return b>=r.getX()&&c>=r.getY()&&b>=t.getX()&&c<=t.getY()&&b<=z.getX()&&c>=z.getY()&&b<=h.getX()&&c<=h.getY()?!0:!1};this.isAdjoin=function(c){return null!=ea.getOverlapLineSegment(c)};this.getOverlapLineSegment=function(c){var b=[];ea.isOnBorder(c.getLeftTop())&&k(b,c.getLeftTop());ea.isOnBorder(c.getRightTop())&&k(b,c.getRightTop());ea.isOnBorder(c.getLeftBottom())&&k(b,c.getLeftBottom());ea.isOnBorder(c.getRightBottom())&&
k(b,c.getRightBottom());c.isOnBorder(r)&&k(b,r);c.isOnBorder(z)&&k(b,z);c.isOnBorder(t)&&k(b,t);c.isOnBorder(h)&&k(b,h);return 2>b.length?null:new X(b[0],b[1])};this.getBoundMidPoint=function(c){return(c=ea.getOverlapLineSegment(c))?c.getMidPoint():null};var k=function(c,b){for(var a=!1,e=0;e<c.length;e++){var d=c[e];if(d.getX()==b.getX()&&d.getY()==b.getY()){a=!0;break}}a||c.push(b)};this.isOnBorder=function(c){return-1<ea.getBorderIndex(c)};this.getWidth=function(){return z.getX()-r.getX()};this.getHeight=
function(){return h.getY()-z.getY()};this.getPositionRelation=function(c,b){c=ea.getBorderIndex(c);b=ea.getBorderIndex(b);b=Math.abs(c-b);if(0==b)return I.POSITION_RELATION_SAME_SIDE;if(1==b||3==b)return I.POSITION_RELATION_ADJACENT_SIDE;if(2==b)return I.POSITION_RELATION_OPPOSITE_SIDE};this.getOverlap=function(c){var b=c.getLeftTop(),a=c.getRightTop(),e=c.getLeftBottom();c=c.getRightBottom();b=new ya(Math.max(r.getX(),b.getX()),Math.max(r.getY(),b.getY()));a=new ya(Math.min(z.getX(),a.getX()),Math.max(z.getY(),
a.getY()));e=new ya(Math.max(t.getX(),e.getX()),Math.min(t.getY(),e.getY()));c=new ya(Math.min(h.getX(),c.getX()),Math.min(h.getY(),c.getY()));e=new I(b,a,e,c);return e.isValid()?e:null};this.isValid=function(){return r.isOnLeft(z)&&r.getY()==z.getY()&&t.isOnLeft(h)&&t.getY()==h.getY()&&r.isAbove(t)&&r.getX()==t.getX()&&z.isAbove(h)&&z.getX()==z.getX()?!0:!1};this.getLeftTop=function(){return r};this.getRightTop=function(){return z};this.getLeftBottom=function(){return t};this.getRightBottom=function(){return h};
this.getBorderIndex=function(c){var b=c.getX();c=c.getY();return c==r.getY()&&b>=r.getX()&&b<=z.getX()?0:b==z.getX()&&c>=z.getY()&&c<=h.getY()?1:c==h.getY()&&b>=t.getX()&&b<=h.getX()?2:b==r.getX()&&c>=r.getY()&&c<=t.getY()?3:-1}}function X(r,z){this.getStartX=function(){return Math.min(r.getX(),z.getX())};this.getEndX=function(){return Math.max(r.getX(),z.getX())};this.getStartY=function(){return Math.min(r.getY(),z.getY())};this.getEndY=function(){return Math.max(r.getY(),z.getY())};this.getMidPoint=
function(){return new ya(r.getX()+z.getX()>>1,r.getY()+z.getY()>>1)};this.isHorizontal=function(){return r.getY()==z.getY()};this.isVertical=function(){return r.getX()==z.getX()}}var ja=qa.getModel(),U,D,Y,oa;this.getLinePathCoordinate=function(){try{U=ja.getTableById(qa.getLeftTable());D=ja.getTableById(qa.getRightTable());var r=U.getX()+U.getWidth()+1,z=U.getY()+(U.getHeight()>>1),t=D.getX()-gb.DEFAULT_ICON_SIZE-10,h=D.getY()+(D.getHeight()>>1);Y=new ya(r,z);oa=new ya(t,h);var ea=Math.min(D.getX()-
gb.DEFAULT_ICON_SIZE-10,U.getX())-50,k=Math.max(D.getX()+D.getWidth(),U.getX()+U.getWidth())+50,c=Math.min(D.getY(),U.getY())-50,b=Math.max(D.getY()+D.getHeight(),U.getY()+D.getHeight())+50;var a=new ya(ea,c);var e=new ya(k,c);var d=new ya(ea,b);var g=new ya(k,b);var m=[new I(a,e,d,g)],q=ja.getTables();for(r=0;r<q.length;r++){z=void 0;var l=q[r];t=m;h=[];var V=l.getX()-gb.DEFAULT_ICON_SIZE-10,G=l.getY(),pa=l.getWidth(),ma=l.getHeight(),Aa=new ya(V,G),Pa=new ya(V+pa,G),ca=new ya(V,G+ma),la=new ya(V+
pa,G+ma);z=new I(Aa,Pa,ca,la);for(a=0;a<t.length;a++){e=h;var Ba=e.concat;var ha=t[a],ia=ha.getOverlap(z);if(ia){d=[];var n=ha.getLeftTop(),u=ha.getRightTop(),p=ha.getLeftBottom(),f=ha.getRightBottom(),Q=ia.getLeftTop(),y=ia.getRightTop(),ra=ia.getLeftBottom(),Ka=ia.getRightBottom();if(n.isOnLeft(Q)){var Wa=n,ib=new ya(Q.getX(),n.getY()),nb=p,ta=new ya(Q.getX(),p.getY()),Ja=new I(Wa,ib,nb,ta);d.push(Ja)}n.isAbove(Q)&&(Wa=new ya(Q.getX(),n.getY()),ib=u,nb=Q,ta=new ya(f.getX(),y.getY()),Ja=new I(Wa,
ib,nb,ta),d.push(Ja));u.isOnRight(y)&&(Wa=y,ib=new ya(u.getX(),y.getY()),nb=new ya(Ka.getX(),f.getY()),Ja=new I(Wa,ib,nb,f),d.push(Ja));p.isBelow(Ka)&&(Wa=ra,ib=Ka,nb=new ya(ra.getX(),p.getY()),ta=new ya(Ka.getX(),f.getY()),Ja=new I(Wa,ib,nb,ta),d.push(Ja));var Ta=d}else Ta=[ha];h=Ba.call(e,Ta)}m=h}q=m;var bb,ob;for(m=0;m<q.length;m++){var xb=q[m];xb.isInRect(Y)&&(bb=xb);xb.isInRect(oa)&&(ob=xb)}if(bb&&ob&&bb!=ob){xb=ob;var da=new K;da.addRect(bb);ob=[];aa(da,q,bb,xb,ob);if(0==ob.length)var Ha=null;
else{da=[];for(m=0;m<ob.length;m++){var wa=ob[m].generateLinePath(Y,oa),Da=wa.length;da.push(wa);if(void 0==Ma){var Ea=m;var Ma=Da}else Da<Ma&&(Ea=m,Ma=Da)}Ha=da[Ea]}}else Ha=null;return Ha}catch(Va){return null}};var aa=function(r,z,t,h,ea){for(var k=r.getLastRect(),c=r.getAllRect(),b=[],a=0;a<z.length;a++){var e=z[a];-1<c.indexOf(e)||e!=k&&k.isAdjoin(e)&&b.push(e)}if(0!=b.length)if(-1<b.indexOf(h))r.addRect(h),ea.push(r);else for(k=0;k<b.length;k++)c=b[k],a=r.clone(),a.addRect(c),aa(a,z,t,h,ea)};
I.POSITION_RELATION_SAME_SIDE="same_side";I.POSITION_RELATION_ADJACENT_SIDE="adjacent_side";I.POSITION_RELATION_OPPOSITE_SIDE="opposite_side"}function ya(qa,K){this.getX=function(){return qa};this.getY=function(){return K};this.isOnLeft=function(I){return I.getX()>qa};this.isOnRight=function(I){return I.getX()<qa};this.isAbove=function(I){return I.getY()>K};this.isBelow=function(I){return I.getY()<K}}function jb(){var qa=this,K,I,X=[],ja,U;this.protectedGetItemModels=function(){};this.protectedGetListPainter=
function(){};this.protectedGetListItemSize=function(){return[100,20]};this.protectedGetSuggestDropdownPos=function(){};this.protectedGetOperateIconHeight=function(){return 0};this.protectedGetOperateIconUi=function(){};this.addSelectedCallback=function(r){X.push(r)};this.setNode=function(r){r!=ja&&D();ja=r};this.setScaleHelper=function(r){U=r};var D=function(){if(I){var r=$(document.body);r.off("mousedown",aa);r.off("mousewheel",oa);I.detach();I=null}},Y=function(){K=new Ia;K.setItemModels(qa.protectedGetItemModels());
K.addPressedListener(function(r,z){D();if((z=r.getSelecteds())&&0!=z.length){for(var t=0;t<X.length;t++)(0,X[t])(z[0],ja);r.setSelecteds([])}});K.setCustomItemPainter(function(r,z){var t=qa.protectedGetListItemSize()[1];r.css({height:t+"px","line-height":t+"px"});(t=qa.protectedGetListPainter())&&t(r,z)})},oa=function(r){return Ra.isDescendent(r.target,K.getJqUi()[0])?!0:!1},aa=function(r){var z=qa.protectedGetOperateIconUi();z.is(":visible")&&(Ra.isDescendent(r.target,z[0])||Ra.isDescendent(r.target,
I[0]))||D()};this.protectedMethod={getNode:function(){return ja},doDropdown:function(){if(I)D();else{K||Y();var r=$(document.body),z=qa.protectedGetSuggestDropdownPos(),t=z[0],h=z[1],ea=r.prop("clientHeight"),k=qa.protectedGetListItemSize()[1],c=qa.protectedGetItemModels().length;k=Math.min(c*k+2,(ea>>1)-10);h+k>ea&&(z=z[1]-k-qa.protectedGetOperateIconHeight(),0<=z&&(h=z));z=qa.protectedGetListItemSize()[0];I=$("<div>");I.css("cursor","pointer");I.css("position","absolute");I.css("left",t+"px");I.css("top",
h+"px");I.css("width",z+"px");I.css("height",k+"px");I.css("box-shadow","0 0 2px 0 #ccc");I.css("z-index","999999");I.appendTo(r);K.setItemModels(qa.protectedGetItemModels());t=K.getJqUi();t.appendTo(I);t.css("position","absolute");t.css("left","0px");t.css("top","0px");t.css("width","100%");t.css("height","100%");K.scrollSelectedToVisible();r.on("mousedown",aa);r.on("mousewheel",oa)}},getScaledSize:function(r){return U?U.getScaledSize(r):r},getScaledCoordinate:function(r){return U?U.getScaledCoordinate(r):
r}}}function yb(){function qa(r,z,t,h){this.getX1=function(){return r};this.getX2=function(){return t};this.getY1=function(){return z};this.getY2=function(){return h}}var K=!1,I,X,ja=[],U,D;this.isPrepared=function(){return K};this.prepare=function(r,z,t){D=t;X=z;r=r.getTables();I=[];for(z=0;z<r.length;z++){var h=r[z];t=h.getX();var ea=h.getY(),k=t+h.getWidth();h=ea+h.getHeight();I.push(new qa(t,ea,k,h))}K=!0};this.anchor=function(r){aa();U=r;var z=!1,t=!1;for(r=0;r<I.length;r++){var h=I[r];if(!z){z=
h;var ea=U[1]+(U[3]>>1);var k=z.getY1()+z.getY2()>>1;if(10>=Math.abs(k-ea)){ea=Y(z);var c=D.getScaledSize(k);oa(ea[0],c,ea[1],c);U[1]=k-(U[3]>>1);k=!0}else k=!1;k?z=!0:(ea=U[1],k=z.getY1(),10>=Math.abs(k-ea)?(ea=Y(z),c=D.getScaledSize(k),oa(ea[0],c,ea[1],c),U[1]=k,k=!0):k=!1,k?z=!0:(ea=U[1]+U[3],k=z.getY2(),10>=Math.abs(ea-k)?(z=Y(z),ea=D.getScaledSize(k),oa(z[0],ea,z[1],ea),U[1]=k-U[3],z=!0):z=!1))}t||(t=h,k=U[0],h=t.getX1(),10>=Math.abs(h-k)?(k=Y(t,!0),ea=D.getScaledSize(h),oa(ea,k[0],ea,k[1]),
U[0]=h,h=!0):h=!1,h||(k=U[0]+U[2],h=t.getX2(),10>=Math.abs(h-k)?(t=Y(t,!0),k=D.getScaledSize(h),oa(k,t[0],k,t[1]),U[0]=h-U[2],h=!0):h=!1),t=h);if(z&&t)break}};this.abort=function(){aa()};var Y=function(r,z){if(z){z=U[1];var t=r.getY1();z<t?r=r.getY2():(z=t,r=U[1]+U[3])}else z=U[0],t=r.getX1(),z<t?r=r.getX2():(z=t,r=U[0]+U[2]);return D.getScaledCoordinate([z-15,r+15])},oa=function(r,z,t,h){var ea=$("<div>");ea.addClass("wizard-designer-auxiliary-line");X.append(ea);ja.push(ea);Ra.layoutCtrl(ea,r,z,
t-r,h-z)},aa=function(){for(var r=0;r<ja.length;r++)ja[r].remove();ja=[]}}function Na(qa){var K,I,X,ja,U,D,Y;this.getJqUi=function(d){K||(K=$("<div>"),oa(d),d.append(K));return K};this.updateDropdown=function(){aa()};this.setNodeStatusMonitor=function(d){Y=d;Y.addEventListener(function(g,m){g!=lb.CHANGE_JOIN_TYPE&&g!=lb.KEY_TARGET_JOIN_CHANGE&&g!=lb.KEY_NODE_RENAME&&g!=lb.KEY_DEL_SUBTABLE||aa()})};var oa=function(d){var g=$("<div>"),m=$("<div>");g.text(tb.get("joinOrder","\u5173\u8054\u987a\u5e8f"));
rb.backgroundWithHover(m,"arrow_down");K.on("click",function(q){if(I&&I.is(":visible"))I.remove(),ja&&ja.remove(),rb.backgroundWithHover(m,"arrow_down");else{q=$("<div>");var l=k(),V=$("<div>"),G=$("<div>");V.text(tb.get("sort","\u987a\u5e8f"));G.text(tb.get("join","\u5173\u8054"));V.addClass("generic-link-sort-title");G.addClass("generic-prop-sort-link");l.append(V);l.append(G);V=h();q.append(l);q.append(V);q.addClass(Na.DROP_DOWN);Ra.makeSelectable(q,!1);d.append(q);I=q;rb.backgroundWithHover(m,
"arrow_up")}});m.addClass("generic-link-sort-icon");g.addClass("generic-link-sort-text");K.addClass(Na.UI_MARK);K.append(m);K.append(g)},aa=function(){I&&I.is(":visible")&&h()},r=function(d,g,m){ja&&ja.remove();var q=$("<div>");ja=q;var l=$(document.body);l.on("mousedown",t);var V=z(m);m.forEach(function(G){var pa=G.getModel().getJoins().indexOf(G);pa=ea(G,pa,!1,V);pa.on("click",function(){q.remove();l.off("mousedown",t);qa.getMainDataSetModelVO().getDataSetModel().switchJoin(g,G);h();Y.notifyListener(lb.SWITCH_ORDER_OF_JOIN)});
pa.addClass("generic-link-switch-row");q.append(pa)});q.addClass("generic-link-switch-content");d=Ra.upwardCoordinate(d[0],[0,0],l[0]);Ra.layoutCtrl(q,d[0]+9,d[1],35+V+35+V,26*Math.min(m.length,10));l.append(q)},z=function(d){var g=45,m=new Ab;m.setFontSize(12);d.forEach(function(q){var l=q.getLeftTableObject();q=q.getRightTableObject();g=Math.max(g,Math.max(m.measureWidth(l.getAlias().substring(0,10)),m.measureWidth(q.getAlias().substring(0,10))))});return g},t=function(d){ja.is(":visible")&&(Ra.isDescendent(d.target,
ja[0])||Ra.isDescendent(d.target,ja[0]))||ja.remove()},h=function(){X||(X=$("<div>"),X.addClass("generic-link-dropdown-content"));X.empty();var d=X,g=qa.getMainDataSetModelVO().getDataSetModel();if(0==g.getJoins().length)return g=$("<div>"),g.text(tb.get("noJoin","\u6682\u65e0\u5173\u8054")),g.addClass("generic-prop-link-tips"),d.append(g),d;a();g.getJoins().forEach(function(m,q){var l=c(m);l.reverse();q=ea(m,q,0<l.length);var V=$("<div>");V.attr("title",tb.get("joinOrder","\u66f4\u6362\u5173\u8054\u987a\u5e8f"));
if(0<l.length){var G=$("<div>");G.on("click",function(){r(V,m,l)});rb.backgroundWithHover(G,"replace");G.addClass("generic-link-icon-center-btn");V.append(G);V.addClass("generic-prop-link-replace");q.append(V)}d.append(q)});return d},ea=function(d,g,m,q){var l=k(),V=$("<div>"),G=$("<div>"),pa=$("<div>"),ma=$("<div>");V.text(g+1+"");g=d.getLeftTableObject();G.text(g.getAlias());G.attr("title",g.getAlias());g=$("<div>");var Aa=d.getJoinType();pa.attr("title",ub.typeToText(Aa));qb.background(g,"micro_"+
ub.typeToIconName(Aa));d=d.getRightTableObject();ma.text(d.getAlias());ma.attr("title",d.getAlias());V.addClass("generic-prop-link-serial");G.addClass("generic-prop-link-left-table");pa.addClass("generic-prop-link-join");ma.addClass(m?"generic-prop-link-with-btn":"generic-prop-link-right-table");g.addClass("generic-link-icon-center-join");q&&(G.css("width",q),ma.css("width",q),l.css("width",35+q+35+q));pa.append(g);l.append(V);l.append(G);l.append(pa);l.append(ma);return l},k=function(){var d=$("<div>");
d.addClass("generic-link-sort-row");return d},c=function(d){d=D[d.getId()];var g=d.getIndex(),m=d.getMinIndexOfSons(),q=d.getRoot(),l=d.getParentPath(),V=[];U.forEach(function(G){G!=q&&b(G,g,m,l,[],V)});return V},b=function(d,g,m,q,l,V){var G=d.getParent();G&&l.push(G.getIndex());d.getChildren()&&0<d.getChildren().length&&d.getChildren().forEach(function(Aa){b(Aa,g,m,q,l,V)});G=d.getGenericJoin();var pa=d.getIndex();d=d.getMinIndexOfSons();d=pa<=m&&g<=d;for(var ma=0;d&&ma<l.length;ma++)d=l[ma]<g;
for(ma=0;d&&ma<q.length;ma++)d=q[ma]<pa;d&&V.splice(0,0,G);0<l.length&&l.splice(l.length-1,1)},a=function(){U=[];D={};var d=qa.getMainDataSetModelVO().getDataSetModel(),g=d.getFirstTable();if(g)return d.findRelatedToCurrentJoins(g).forEach(function(m){U.push(e(m))}),D},e=function(d){var g=new fb(d);D[d.getId()]=g;var m=qa.getMainDataSetModelVO().getDataSetModel();d=d.getRightTableObject();m.findRelatedToCurrentJoins(d).forEach(function(q){g.addChild(e(q))});return g}}function fb(qa){var K=this,I,
X=[];this.getGenericJoin=function(){return qa};this.addChild=function(ja){ja.setParent(K);X.push(ja)};this.setParent=function(ja){I=ja};this.getParent=function(){return I};this.getRoot=function(){for(var ja=K;ja.getParent();)ja=ja.getParent();return ja};this.getParentPath=function(){for(var ja=[],U=K.getParent();U;)ja.push(U.getIndex()),U=U.getParent();return ja};this.getChildren=function(){return X};this.getIndex=function(){return qa.getModel().getJoins().indexOf(qa)};this.getMinIndexOfSons=function(){if(0==
X.length)return Number.MAX_VALUE;var ja=Number.MAX_VALUE;K.traverseSubTree(function(U){ja=Math.min(ja,U.getIndex())});return ja};this.traverseSubTree=function(ja){K.getChildren().forEach(function(U){ja(U);U.traverseSubTree(ja)})}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.extreport&&(com.kingdee.bos.extreport={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner&&
(com.kingdee.bos.extreport.datasetdesigner={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner.wizard&&(com.kingdee.bos.extreport.datasetdesigner.wizard={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner.wizard.link&&(com.kingdee.bos.extreport.datasetdesigner.wizard.link={});var Xa=com.kingdee.bos.extreport.datasetdesigner.wizard.link;Xa.Svg=Ca;Xa.DragInsideCheckResult=function(qa,K){this.getJqPhysicalUi=function(){return qa};this.getModeler=function(){return K}};Xa.DragHandler=
function(){var qa=$(document.body),K,I,X,ja,U,D,Y,oa,aa,r,z,t;this.bindDragUi=function(a,e){var d=!1,g=[-1,-1],m=null,q=function(){K=d=!1;m=null;g=[-1,-1]};Y&&Y.off();Y=a=$(a);a.on("mousedown",function(l){d=!0;K=!1;m=$(l.target);g=[l.screenX,l.screenY]});a.on("mouseup",function(l){q()});a.on("mouseleave",function(l){d&&q()});a.on("mousemove",function(l){var V=!1;d&&(V=5<Math.abs(l.screenX-g[0])||5<Math.abs(l.screenY-g[1]));V&&(d=!1,(t=e(m))?(U=new yb,X=oa(),ja=t[0],K=!0,qa.on("mousemove",h),qa.on("mouseup",
ea),qa.on("mouseleave",c)):q())})};this.bindDropUi=function(a,e,d,g,m){oa=e;aa=d;r=g;D=m};this.setFunNoneTableExists=function(a){};var h=function(a){if(K){if(!I){I=$("<div onselectstart='return false'>");I.addClass("wizard-dragdrop-mask");var e=Ra.getCurrentTargetPosition(a);e=Ra.upwardCoordinate(a.target,e,qa[0]);I.data("target-origin-pos-left",e[0]);I.data("target-origin-pos-top",e[1]);I.appendTo(qa)}if(e=aa(a,X,ja)){var d=e.getJqPhysicalUi();U.isPrepared()||U.prepare(e.getModeler(),d,D);z||(z=
$("<div>"),Ra.layoutCtrlWithLRTB(z,0,0,null,0,0,null),z.css("z-index",999999));z.appendTo(d);k();a=[ja.getX(),ja.getY()];a=D.getScaledCoordinate(a);a=Ra.upwardCoordinate(d[0],a,qa[0]);e=D.getScaledSize(ja.getWidth());d=D.getScaledSize(ja.getHeight());Ra.layoutCtrl(I,a[0],a[1],e,d)}else I.text(""),e=Ra.getCurrentTargetPosition(a),e=Ra.upwardCoordinate(a.target,e,qa[0]),Ra.layoutCtrl(I,e[0]-20,e[1]-15,40,30)}},ea=function(a){aa(a,X,ja)?(k(),r(t,function(){I.remove();I=null}),b(!0)):b()},k=function(){var a=
[ja.getX(),ja.getY(),ja.getWidth(),ja.getHeight()];U.anchor(a);ja.setPosition(a[0],a[1])},c=function(){b()},b=function(a){K=!1;!a&&I&&I.animate({left:I.data("target-origin-pos-left"),top:I.data("target-origin-pos-top"),width:4,height:3},function(){I.remove();I=null});qa.off("mousemove",h);qa.off("mouseup",ea);qa.off("mouseleave",c);z&&z.remove();U&&U.abort()}};Xa.AbstractNodeUI=sa;Xa.TableNodeUI=Fa;Xa.UnionTableNode=Sa;Xa.SubUnionNode=Za;Xa.DomainUnionNode=Oa;Xa.LineUi=gb;Xa.NodeOperateCreator=function(){jb.call(this);
var qa=this.protectedMethod,K=this,I,X,ja=[];this.hook=function(D,Y,oa){K.setNode(D);I=Y;X=oa};this.showOperateList=function(){qa.doDropdown()};this.getMark=function(){return"modeler-designer-node-operate"};this.setOperateTypes=function(D){ja=D};this.protectedGetItemModels=function(){return ja};this.protectedGetListPainter=function(){return U};this.protectedGetOperateIconUi=function(){return X.getOperateIconUi()};this.protectedGetSuggestDropdownPos=function(){var D=$(document.body),Y=X.getCoordinate();
var oa=Y[0]+X.getWidth();Y=Y[1]+X.getHeight();oa=qa.getScaledCoordinate([oa-15,Y-15]);oa=Ra.upwardCoordinate(I[0],oa,D[0]);D=oa[0];oa=oa[1]+K.protectedGetOperateIconHeight();return[D,oa]};var U=function(D,Y){D.text(wb.typeToName(Y))}};Xa.DraggingAnchor=yb;Xa.JoinSorter=Na;var Ra,tb,Ab,Ia,kb,vb,ub,qb,lb,rb;(function(){var qa=com.kingdee.bos.qing.common;Ra=qa.DomUtil;tb=qa.MLS;Ab=qa.TextMeasurer;qa=com.kingdee.bos.qing.ui.component;Ia=qa.List;qa=com.kingdee.bos.extreport.datasetdesigner.generic.model;
kb=qa.GenericQueryTable;vb=qa.GenericQueryDataSourceType;ub=qa.GenericQueryJoinType;qa=com.kingdee.bos.extreport.datasetdesigner.generic.component;lb=qa.NodeStatusMonitor;qa=com.kingdee.bos.extreport.datasetdesigner;qb=qa.Icons;qa=com.kingdee.bos.extreport.datasetdesigner.common.ui;rb=qa.IconHelper})();var $a=new function(){var qa,K,I;this.init=function(){I=$("<div>");Ra.layoutCtrl(I,-10,-10,10,10);qa=new Ca;var ja=qa.createNode("svg");qa.setAttributes(ja,{width:10,height:10});K=qa.createNode("text");
ja.appendChild(K);I.append($(ja));$(document.body).append(I);I.hide()};this.trim=function(ja,U,D){I.show();qa.setAttributes(K,{"font-size":U+"px"});U=X(ja);for(var Y=ja,oa=1;U>D&&oa<ja.length;)Y=ja.slice(0,ja.length-oa)+"...",U=X(Y),oa++;I.hide();return Y};this.measureText=function(ja,U){U&&qa.setAttributes(K,{"font-size":U+"px"});I.show();ja=X(ja);I.hide();return ja};var X=function(ja){qa.setText(K,ja);return K.getComputedTextLength()}};Xa.SvgTextTrimer=$a;sa.NODE_UI_CLASS="rpt-designer-node";sa.NODE_OPERATE_ICON_CLASS=
"rpt-designer-node-operate-icon";sa.NODE_NAME_UI_CLASS="rpt-designer-node-name";sa.NodeLineUiMark="rpt-designer-line";Fa.FONT_SIZE=11;Fa.NAME_WIDTH=140;Fa.TEXT_LEFT=40;Fa.TEXT_TOP=3;Sa.INNER_NODE="INNERNODE";gb.DEFAULT_ICON_SIZE=32;var db=new function(){this.makeUrl=function(qa){return"../qinganalysis/qingrpt/dataset-designer/icons/svgicon/"+qa+".svg"};this.getTableIconColor=function(qa){var K="#ffa500";switch(qa){case vb.ENTITY:case vb.DATA_CENTER:K="#A06AE2";break;case vb.SUPER_QUERY:K="#A2ADC9";
break;case vb.USER_SUPER_QUERY:case vb.OUT_DB:K="#ffa500";break;case vb.QING_MODELER:K="#40A9FF"}return K}};Xa.SvgIconHelper=db;Xa.LineCoordinateHelper=new function(){this.getLinePathCoordinate=function(qa){var K=qa.getModel();var I=K.getTableById(qa.getLeftTable()),X=K.getTableById(qa.getRightTable()),ja=I.getX()+I.getWidth()+1,U=I.getY()+(I.getHeight()>>1);K=X.getX()-gb.DEFAULT_ICON_SIZE-10;var D=X.getY()+(X.getHeight()>>1),Y=1>Math.abs(U-D),oa=ja>K,aa=Math.abs(U-D)<I.getHeight()+X.getHeight()>>
1,r=[];r.push(new ya(ja,U));aa&&oa?(Y=10,X=Math.max(I.getHeight(),X.getHeight()),K-Y>I.getX()&&D>I.getY()+I.getHeight()&&(Y=K-I.getX()+10),I=new ya(ja+10,U),ja=new ya(ja+10,Math.min(U,D)-X),U=new ya(K-Y,Math.min(U,D)-X),Y=new ya(K-Y,D),r.push(I),r.push(ja),r.push(U),r.push(Y)):Y||(oa?aa||(Y=I.getHeight()-X.getHeight()>>1,Y=U<D?Y:-Y,I=new ya(ja+10,U),ja=new ya(ja+10,(U+D>>1)+Y),U=new ya(K-10,(U+D>>1)+Y),Y=new ya(K-10,D),r.push(I),r.push(ja),r.push(U),r.push(Y)):(I=new ya(ja+K>>1,U),ja=new ya(ja+K>>
1,D),r.push(I),r.push(ja)));r.push(new ya(K,D));K=r;a:{D=K;if(!(2>D.length))for(r=1;r<D.length;r++){b:{ja=D[r-1];Y=D[r];X=qa;U=ja.getX();ja=ja.getY();I=Y.getX();Y=Y.getY();X=X.getModel().getTables();for(oa=0;oa<X.length;oa++){var z=X[oa];aa=z.getX();var t=aa+z.getWidth(),h=z.getY();z=h+z.getHeight();if(U>aa&&U<t&&I>aa&&I<t){if(Math.max(ja,Y)>h&&Math.min(ja,Y)<z){U=!0;break b}}else if(ja>h&&ja<z&&Y>h&&Y<z&&Math.max(U,I)>aa&&Math.min(U,I)<t){U=!0;break b}}U=!1}if(U){D=!0;break a}}D=!1}D&&(qa=(new mb(qa)).getLinePathCoordinate(qa))&&
(K=qa);return K}};Xa.LineCoordinateHelper.BASE_LINE_SHAPE_S="s";Xa.LineCoordinateHelper.BASE_LINE_SHAPE_U="u";Xa.LineCoordinateHelper.BASE_LINE_SHAPE_Z="z";var wb={PREVIEW_TABLE:"PREVIEW_TABLE",DELETE_TABLE:"DELETE_TABLE",typeToName:function(qa){switch(qa){case wb.PREVIEW_TABLE:return tb.get("preview","\u9884\u89c8");case wb.DELETE_TABLE:return tb.get("del","\u5220\u9664");default:return""}}};Xa.OperateType=wb;Na.UI_MARK="generic-link-sort-btn";Na.DROP_DOWN="generic-link-dropdown"})();(function(){function Ca(){var D=1,Y=[];this.zoomIn=function(){var aa=Ca.SUPPORT_SCALES.indexOf(D);aa<Ca.SUPPORT_SCALES.length-1&&(D=Ca.SUPPORT_SCALES[aa+1],oa())};this.zoomOut=function(){var aa=Ca.SUPPORT_SCALES.indexOf(D);0<aa&&(D=Ca.SUPPORT_SCALES[aa-1],oa())};this.autoAdaptScale=function(aa,r,z,t){aa=Math.max(aa/D/z,r/D/t);if(1>aa)1>D&&(D=1,oa());else{aa=1/aa;r=[];for(z=0;z<Ca.SUPPORT_SCALES.length;z++)r.push(Ca.SUPPORT_SCALES[z]);r.sort();for(z=0;z<r.length;z++)if(aa<r[z]){aa=r[z];break}D=aa;
oa()}};this.getRatio=function(){return D};this.setCustomRatio=function(aa){D=aa};this.getScaledSize=function(aa){return 1==D?aa:D*aa};this.getRawSize=function(aa){return 1==D?aa:aa/D};this.getScaledCoordinate=function(aa){return 1==D?aa:[D*aa[0],D*aa[1]]};this.getRawCoordinate=function(aa){return 1==D?aa:[aa[0]/D,aa[1]/D]};this.addPropertyChangedListener=function(aa){Y.push(aa)};var oa=function(){for(var aa=0;aa<Y.length;aa++){var r=Y[aa];r&&r()}}}function sa(){var D=new tb,Y,oa=this,aa,r,z,t={},
h={},ea,k=!1;this.create=function(a,e){aa=e;Y||(Y=D.createNode("svg"),e=ea.getScaledSize(a.getWidth()),a=ea.getScaledSize(a.getHeight()),D.setAttributes(Y,{width:e,height:a}),aa[0].appendChild(Y))};this.getSvgRoot=function(){return Y};this.setScaleHelper=function(a){ea=a};this.setNodeOperateCreator=function(a){r=a};this.setNodeStatusMonitor=function(a){};this.clear=function(){h={};t={};Y&&Y.remove();Y=null};this.renameNode=function(a,e){var d=t[a];d&&(a=d.getGenericTable(),z||(z=new gb),z.setCallback(function(g,
m){e(g,d,m)}),z.hook(a,d,aa))};this.addTableUi=function(a){Y&&c(a)};this.getNodeOperateUiMark=function(){return vb.NODE_OPERATE_ICON_CLASS};this.changeTableUiPosition=function(a){var e=a.getId();(e=t[e])&&e.changePosition(a.getX(),a.getY())};this.changeTableDisplayName=function(a){a=a.getId();(a=t[a])&&a.changeNodeDisplayName()};this.addSelectedUi=function(a){oa.cleanSelectedUi();a&&(a instanceof qa?oa.addSelectedTableUi(a):oa.addSelectedJoinUi(a))};this.cleanSelectedUi=function(){for(var a=Object.keys(t),
e=0,d=a.length;e<d;e++){var g=a[e];(g=t[g])&&g.setSelected(!1)}a=Object.keys(h);e=0;for(d=a.length;e<d;e++)g=a[e],(g=h[g])&&g.setSelected(!1)};this.addSelectedTableUi=function(a){var e=a.getId(),d=t[e];d&&(delete t[e],d.remove());c(a).setSelected(!0)};this.getTableModelByUi=function(a,e){var d=a.attr("id");if(d){if(a.hasClass(oa.getTableUiMark()))return a=t[d],e&&a instanceof lb?a.getParentNode():a.getGenericTable();if(a.hasClass(oa.getJoinUiMark()))return h[d].getGenericJoin()}};this.getTableUiMark=
function(){return vb.NODE_UI_CLASS};this.getJoinUiMark=function(){return vb.NodeLineUiMark};this.showNodeOperateSelector=function(){r&&r.showOperateList()};this.setTableUiHover=function(a){if(a=t[a]){var e=a.getGenericTable();a.setHover(!0);k=!0;r.hook(e,aa,a)}return a};this.setNodeOperateTypes=function(a){r.setOperateTypes(a)};this.cleanHoverUi=function(){if(k){for(var a=Object.keys(t),e=0,d=a.length;e<d;e++){var g=t[a[e]];g&&g.setHover(!1)}k=!1}};this.updateInvalidTableUi=function(a,e){(a=t[a.getId()])&&
(e?a.setInvalid(!0,e):a.setInvalid(!1))};this.updateFieldCount=function(a){a=a.getId();(a=t[a])&&a.updateFieldCount()};var c=function(a){var e=t[a.getId()];if(a.isUnionTable()){e&&e instanceof qb||(delete t[a.getId()],e=new qb(a),e.setScaleHelper(ea));t[e.getId()]=e;Y.appendChild(e.getSvgElement());for(var d=e.getTableNodeUIs(),g=0;g<d.length;g++){var m=d[g];t[m.getId()]=m}}else e||(e=new Ia(a),e.setScaleHelper(ea)),t[e.getId()]=e,Y.appendChild(e.getSvgElement());(a=a.check())&&e.setInvalid(!0,a);
return e};this.addJoinUi=function(a){Y&&b(a)};this.updateJoinUi=function(a){var e=h[a.getId()];e&&(e.remove(),b(a))};this.updateInvalidJoinUi=function(a,e){(a=h[a.getId()])&&(e?a.setInvalid(!0,e):a.setInvalid(!1))};this.changeJoinUiPosition=function(a){(a=h[a.getId()])&&a.changePosition()};this.addSelectedJoinUi=function(a){var e=h[a.getId()];e&&(e.setSelected(!0),e.remove(),b(a,e))};var b=function(a){var e=a.getId(),d=h[e];d||(d=new Ab,d.setScaleHelper(ea),d.setGenericJoin(a),h[e]=d);var g=d.getSvgElement(),
m=g[1];m.setAttribute("id",e);D.addClass(m,oa.getJoinUiMark());Y.appendChild(g[0]);Y.appendChild(m);(a=a.check())&&d.setInvalid(!0,a)}}function Fa(){var D,Y,oa,aa,r,z,t,h;this.startDrag=function(e,d){r=d;Y=[e.clientX,e.clientY];oa=(e=r.position())?[e.left,e.top]:[0,0];z=$("<div>");z.css("z-index",999999);z.appendTo($(document.body));z.css("cursor","move");Na.layoutCtrlWithLRTB(z,0,0,null,0,0,null);z.on("mousemove",ea);z.on("mouseup",k);z.on("mouseleave",c)};this.setMovableArea=function(e){aa=e};this.setGlobal=
function(e){t=e};this.setScaleHelper=function(e){h=e};var ea=function(e){var d=e.clientX-Y[0];e=e.clientY-Y[1];if(D)var g=!0;else g=Math.abs(e),g=5<Math.abs(d)||5<g?D=!0:!1;g&&r.css({left:a(oa[0]+d,!0)+"px",top:a(oa[1]+e,!1)+"px"})},k=function(e){b()},c=function(e){b()},b=function(){z.css("cursor","default");z&&z.remove();z=null},a=function(e,d){if(d){d=9999;var g=r.width();var m=aa.width()}else d=9999,g=r.height(),m=aa.height();d=h.getScaledSize(d);var q=g>d;d=0<e?q?0:Math.min(e,d-g):q?Math.max(e,
m-g):Math.max(e,m-d);d!=e&&t.getMessageCurtain().showPrompt(Xa.get("svgMaxSize","\u5df2\u8fbe\u5230\u7ed8\u5236\u533a\u57df\u6700\u5927\u5c3a\u5bf8\u3002"));return d}}function Sa(){function D(t){var h,ea,k,c,b=[],a,e=0;this.setX=function(d){t.setX(d)};this.getHeight=function(){return t.getHeight()};this.getX=function(){return t.getX()};this.setY=function(d){t.setY(d)};this.getY=function(){return t.getY()};this.setMod=function(d){h=d};this.getMod=function(){return h};this.setRightSibling=function(d){ea=
d};this.getRightSibling=function(){return ea};this.setRoot=function(d){k=d};this.getRoot=function(){return k};this.setIndex=function(d){c=d};this.getIndex=function(){return c};this.setChildren=function(d){b=d};this.getChildren=function(){return b};this.addChildren=function(d){b.push(d)};this.setContours=function(d){a=d};this.getContours=function(){return a};this.setContourShift=function(d){e=d};this.getContourShift=function(){return e}}function Y(t,h){var ea=t,k=h;this.setTop=function(c){ea=c};this.getTop=
function(){return ea};this.setBottom=function(c){k=c};this.getBottom=function(){return k}}this.reLayout=function(t){var h=t.getTables();t=t.getJoins();for(var ea={},k={},c=0;c<h.length;c++){var b=h[c],a=b.getId();b=new D(b);ea[a]=b;k[a]=b}for(c=0;c<t.length;c++)h=t[c],a=h.getLeftTable(),h=h.getRightTable(),a=ea[a],b=ea[h],b.setRoot(a),a.addChildren(b),k[h]&&delete k[h];t=Object.values(k)[0];aa(t,0,0);z(t,0)};var oa=150+qa.BASE_WIDTH,aa=function(t,h,ea){t.setX(h*oa);t.setY(0);t.setIndex(ea);t.setMod(0);
if(0!=t.getChildren().length){h++;ea=t.getChildren();for(var k=0;k<ea.length;k++){var c=ea[k];b&&c.setRightSibling(b);var b=c;aa(c,h,k)}}t.getRightSibling()&&t.setY(t.getRightSibling().getY()+t.getRightSibling().getHeight()+50);if(0!=t.getChildren().length&&(ea=t.getChildren(),h=(ea[0].getY()+ea[ea.length-1].getY())/2-((t.getHeight()>>1)-(qa.BASE_HEIGHT>>1)),t.getRightSibling()?t.setMod(t.getY()-h):t.setY(h),h=[],r(t,h,0,0),t.setContours(h),0<t.getIndex()))for(t.setContourShift(0),h=t.getRoot().getChildren(),
b=0;b<t.getIndex();b++)if(ea=h[b],0!=ea.getChildren().length){k=Math.min(ea.getContours().length,t.getContours().length);c=0;for(var a=1;a<k;a++){var e=ea.getContours()[a].getBottom()+ea.getContourShift();e=t.getContours()[a].getTop()+t.getContourShift()-e;50>e&&(c=Math.max(c,50-e))}0<c&&(t.setY(t.getY()+c),t.setMod(t.getMod()+c),t.setContourShift(t.getContourShift()+c))}},r=function(t,h,ea,k){var c=t.getY()+ea;if(h[k]){var b=h[k];b.setTop(Math.min(b.getTop(),c));b.setBottom(Math.max(b.getBottom(),
c))}else h[k]=new Y(t.getY(),c);ea+=t.getMod();k++;t=t.getChildren();for(c=0;c<t.length;c++)r(t[c],h,ea,k)},z=function(t,h){t.setY(t.getY()+h);h+=t.getMod();t=t.getChildren();for(var ea=0;ea<t.length;ea++)z(t[ea],h)}}function Oa(){this.adaptSize=function(D){var Y=D.getTables();if(1>Y.length)var oa=[0,0,D.getWidth(),D.getHeight()];else{var aa=Y[0],r=aa.getX(),z=aa.getY();oa=r+aa.getWidth();aa=z+aa.getHeight();for(var t=1;t<Y.length;t++){var h=Y[t];r=Math.min(r,h.getX());z=Math.min(z,h.getY());oa=Math.max(oa,
h.getX()+h.getWidth());aa=Math.max(aa,h.getY()+h.getHeight())}oa=[r-100,z-100,oa+100,aa+100]}z=D.getWidth();aa=D.getHeight();Y=-oa[0];r=-oa[1];z=oa[2]-z;oa=oa[3]-aa;if(0!=Y||0!=z||0!=r||0!=oa){if(0!=Y||0!=r)for(aa=D.getTables(),t=0;t<aa.length;t++)h=aa[t],h.setPosition(h.getX()+Y,h.getY()+r);Y=new ya(Y,r,z,oa);D.setWidth(Y.getHorizonExtension()+D.getWidth());D.setHeight(Y.getVerticalExtension()+D.getHeight());return Y}return null}}function Za(){var D,Y,oa,aa,r,z,t,h,ea=!1,k,c;this.setTarget=function(q){oa=
q};this.setScaleHelper=function(q){c=q};this.setDataSetModel=function(q){k=q};this.setMovableArea=function(q){D=q};this.startDrag=function(q){h=new wb;h.prepare(k,D,c);Y=[q.clientX,q.clientY];aa=$("<div>");aa.css("z-index",999999);aa.appendTo($(document.body));Na.layoutCtrlWithLRTB(aa,0,0,null,0,0,null);aa.on("mousemove",b);aa.on("mouseup",a);aa.on("mouseleave",g)};this.setEndMoveCallback=function(q){z=q};var b=function(q){if(ea)var l=!0;else l=Math.abs(q.clientY-Y[1]),l=5<Math.abs(q.clientX-Y[0])||
5<l?ea=!0:!1;if(l){if(!r){r=$("<div>");r.addClass("wizard-dragdrop-mask");r.appendTo(D);var V=oa.getX(),G=oa.getY(),pa=oa.getWidth();l=oa.getHeight();t=[V,G];V=c.getScaledCoordinate(t);pa=c.getScaledSize(pa);l=c.getScaledSize(l);Na.layoutCtrl(r,V[0],V[1],pa,l)}q=d(q);e(q);q=c.getScaledCoordinate(q);Na.layoutCtrl(r,q[0],q[1],null,null)}},a=function(q){r&&(q=d(q),e(q),z&&z(q[0],q[1]));m()},e=function(q){if(r){var l=c.getRawSize(r.width()),V=c.getRawSize(r.height()),G=c.getRawCoordinate(q);l=[G[0],G[1],
l,V];h.anchor(l);q[0]=l[0];q[1]=l[1]}},d=function(q){var l=q.clientX-Y[0];q=q.clientY-Y[1];var V=c.getScaledCoordinate(t);return[V[0]+l,V[1]+q]},g=function(q){m()},m=function(){aa&&(aa.off("mousemove",b),aa.off("mouseup",a),aa.off("mouseleave",g),aa.remove(),aa=null);r&&(r&&r.remove(),r=null);h&&h.abort()}}function gb(){var D,Y,oa,aa,r,z,t=!1;this.hook=function(b,a,e){t=!1;D=b;r=a.getNamePositionRect();z=e;h()};this.release=function(){oa&&oa.hide()};this.setCallback=function(b){aa=b};var h=function(){Y||
(Y=new U,oa=Y.getJqUi(),$(document.body).append(oa),Y.addEditedListener(k),Y.addBlurListener(c),oa.css("z-index",99999));var b=D.getAlias();Y.setText(b);ea();oa.show();setTimeout(function(){Y.requestFocus()},0)},ea=function(){var b=$(document.body),a=[r[0],r[1]];a=Na.upwardCoordinate(z[0],a,b[0]);oa.find(".sa-ctrl-textarea-real").css("font-size",r[3]+"px");Na.layoutCtrl(oa,a[0],a[1],r[2],r[3])},k=function(){t=!0},c=function(b){oa.hide();t&&(b=b.getText(),aa(D,b))}}function mb(){var D=this,Y,oa,aa,
r,z,t,h,ea,k,c,b,a,e,d,g,m=!1;this.getJqUi=function(){if(!Y){Y=$("<div>");Y.addClass("wizard-page-toolbar");z=$("<div>");z.addClass("wizard-page-ratio-text");G();z.appendTo(Y);var u=l(),p=V(),f=q(),Q=pa(),y=5;Na.layoutCtrl(Q,y,5,16,16);Na.layoutCtrl(f,y+=26,5,16,16);Na.layoutCtrl(p,y+=26,5,16,16);Na.layoutCtrl(u,y+=26,5,16,16);Na.layoutCtrl(z,y+26,0,35,25);Y.append(f);Y.append(p);Y.append(u);Y.append(Q)}return Y};this.getUiMark=function(){return"wizard-page-toolbar"};this.getOverViewUiMark=function(){return"wizard-overview"};
this.setScaleHelper=function(u){oa=u;oa.addPropertyChangedListener(G)};this.setNodeStatusMonitor=function(u){r=u;r.addEventListener(function(p,f){p!=K.KEY_NODE_SELECTED&&p!=K.CHANGE_JOIN_TYPE&&p!=K.KEY_TARGET_JOIN_CHANGE&&p!=K.KEY_NODE_RELAYOUT&&p!=K.KEY_NODE_CHANGE_POSITION&&p!=K.KEY_NODE_RENAME&&p!=K.KEY_NODE_FIELDS_RESELECT&&p!=K.KEY_NODE_JOIN_FIELD_CHANGE&&p!=K.KEY_NODE_FILTER_CHANGE&&p!=K.KEY_NODE_CALC_CHANGE&&p!=K.KEY_NODE_ORDER_CHANGE&&p!=K.SWITCH_ORDER_OF_JOIN&&p!=K.KEY_DEL_SUBTABLE||ha()})};
this.setLinkUiHelper=function(u){aa=u};var q=function(){var u=$("<div>");u.on("click",function(p){r.notifyListener(K.KEY_NODE_RELAYOUT);ia()});u.attr("title",Xa.get("autoLayout","\u81ea\u52a8\u5e03\u5c40"));n(u,"layout");u.css("cursor","pointer");return u},l=function(){var u=$("<div>");n(u,"zoom_out");u.on("click",function(){oa.zoomOut();ia()});u.attr("title",Xa.get("zoomOut","\u7f29\u5c0f"));u.css("cursor","pointer");return u},V=function(){var u=$("<div>");n(u,"zoom_in");u.on("click",function(){oa.zoomIn();
ia()});u.attr("title",Xa.get("zoomIn","\u653e\u5927"));u.css("cursor","pointer");return u},G=function(){var u=oa?oa.getRatio():1;u=parseInt(100*u)+"%";z.text(u);z.attr("title",Xa.get("currentRatio","\u5f53\u524d\u6bd4\u4f8b#1").replace("#1",u))};this.setOverViewContainer=function(u){k=u};this.setLinkUi=function(u){c=u};var pa=function(){t=$("<div>");t.on("click",Ba);t.css("cursor","pointer");t.attr("title",Xa.get("overallView","\u5168\u5c40\u89c6\u56fe"));I.background(t,ma());t.on("mouseenter",function(){I.background(t,
ma()+"_hover")});t.on("mouseleave",function(){I.background(t,ma())});return t},ma=function(){return m?"arrow_up":"arrow_down"},Aa=function(u){ea||(ea=$("<div>"),ea.addClass("wizard-overview-capture"),ea.appendTo(b));var p=k.width(),f=k.height();ea.css({width:a*p+"px",height:a*f+"px"});ea.show();p=Na.getCurrentTargetPosition(u);p=Na.upwardCoordinate(u.target,p,h[0]);Pa(p);h.css("cursor","move");h.on("mousemove",ca);h.on("mouseup",la);h.on("mouseleave",la)},Pa=function(u){Na.layoutCtrl(ea,u[0]-(ea.width()>>
1),u[1]-(ea.height()>>1),null,null)},ca=function(u){var p=Na.getCurrentTargetPosition(u);p=Na.upwardCoordinate(u.target,p,h[0]);Pa(p);u=ea.position();Na.layoutCtrl(c,(e-u.left)/a,(d-u.top)/a,null,null)},la=function(){ea.hide();h.css("cursor","default");h.off("mousemove",ca);h.off("mouseup",la);h.off("mouseleave",la)},Ba=function(){m?(m=!1,h.hide(),g&&g.remove(),I.background(t,"arrow_down")):(m=!0,h||(h=$("<div>"),h.hide(),h.on("mousedown",Aa),h.addClass(D.getOverViewUiMark()),h.appendTo(k),b=$("<div>"),
b.addClass("wizard-overview-ops-layer"),b.appendTo(h)),ha(),h.show(),I.background(t,"arrow_up"))},ha=function(){if(m){ia();var u=aa.getSvgRoot();u=u.cloneNode(!0);var p="translate("+e+","+d+") ";u.setAttribute("transform-origin","0 0");u.setAttribute("transform",p+"scale("+a+")");g&&g.remove();g=u;h.append(u)}},ia=function(){var u=aa.getSvgRoot(),p=parseInt(u.getAttribute("height"));u=parseInt(u.getAttribute("width"));a=Math.min(140/p,260/u);u=u*a>>1;p=p*a>>1;e=130>u?130-u:0;d=70>p?70-p:0},n=function(u,
p){I.background(u,p);u.on("mouseenter",function(){I.background(u,p+"_hover")});u.on("mouseleave",function(){I.background(u,p)})}}function ya(D,Y,oa,aa){this.getLeftExtension=function(){return D};this.getTopExtension=function(){return Y};this.getHorizonExtension=function(){return D+oa};this.getVerticalExtension=function(){return Y+aa}}function jb(D,Y){function oa(r){ja.call(this);var z=this,t=this.protectedMethod,h=$("<div>"),ea,k,c;(function(){t.setTitle(Xa.get("preview","\u9884\u89c8")+"-"+r);var a=
$(document.body),e=a.prop("clientWidth");a=a.prop("clientHeight");var d=Math.min(1,Math.max(.8,1.16-2E-4*e));e=parseInt(d*e);a=parseInt(d*a);z.setSize(e,a);t.getDialogCtrl().setMinSize(680,240);t.setSelectable(!0);t.getDialogCtrl().setFullScreenEnabled();t.getDialogCtrl().setResizeEnabled();t.getDialogCtrl().addResizeListener(function(){b()});t.setContentPaneCreator(function(){var g=fb.decodeParamFromUrl(window.location.search,"dataSetId")+"_Single_Table";ea=$("<iframe allowfullscreen allowTransparency='true'id= "+
g+">");ea.css({width:"100%",border:"0px"});ea.appendTo(h);var m=function(l){c=l;l=yb.getUrlParamValue();var V=fb.decodeParamFromUrl(location.search,"path");V=fb.appendParamToUrl((V?V:"/ierp")+"/qing_rpt/dataSetPreview.do","isInDialog","true");V=fb.appendParamToUrl(V,"cacheId",c);V=fb.appendParamToUrl(V,"dataSetId",g);V=fb.appendParamToUrl(V,"dataSetName",r);l&&(V=fb.appendParamToUrl(V,"skin",l));V=com.kingdee.bos.qing.integration.PageHelper.getIframeUrl(V);ea=h.find("#"+g);ea.attr("src",V);ea.on("load",
function(){b(h,ea)})},q=function(l,V){return 8077E3<l?(t.getMessageCurtain().showPrompt(V,5E3),!0):!1};k&&aa.createDesignerFacade(m,q).cacheModel(g,k.toJsonObject());return h});t.setFooterPaneCreator(null);t.setClosingChecker2(function(g){},function(g){c&&aa.createDesignerFacade(null,null).cleanCacheModel(c);g(!0)},!0);t.setClosingAction(function(g){})})();this.setModel=function(a){k=a};var b=function(){if(h&&ea){var a=h.prop("clientHeight");ea.css("height",a+"px")}}}var aa=D;this.showDialog=function(){var r=
new oa(Y.getAlias()),z=Y.toDataSetModel();r.setModel(z);r.showDialog()}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.extreport&&(com.kingdee.bos.extreport={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner&&(com.kingdee.bos.extreport.datasetdesigner={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner.wizard&&(com.kingdee.bos.extreport.datasetdesigner.wizard=
{});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner.wizard.link&&(com.kingdee.bos.extreport.datasetdesigner.wizard.link={});NS=com.kingdee.bos.extreport.datasetdesigner.wizard.link;NS.LinkArea=function(){var D,Y,oa=!1,aa,r,z,t,h,ea,k=new Sa,c=new Oa,b,a,e=!0,d;this.getJqUi=function(){D||(g(),m());return D};this.setDataSetModel=function(p){z=p};this.repaintUI=function(){if(z&&(c.adaptSize(z),ia(),e&&0!=document.body.clientHeight&&0!=document.body.clientWidth&&(ha(),e=!1),!(0>=z.getTables().length))){var p=
b.getSelected();p||(p=z.getTables()[0]);b.setSelected(p)}};this.setGlobal=function(p){r=p;rb.setGlobal(p)};this.setDragHandler=function(p){aa=p};this.setNodeStatusMonitor=function(p){b=p;b.addEventListener(u)};var g=function(){D=$("<div>");D.on("mousedown",q);D.on("mousemove",G);D.addClass("wizard-designer-page");$(document).on("keydown",function(f){46==f.keyCode&&(f=b.getSelected(),f instanceof qa&&z.isTableDeletable(f)&&Aa(f))});kb.init();pa();ma();Y=$("<div>");Y.appendTo(D);var p=new ub(r);p.getJqUi(D);
p.setNodeStatusMonitor(b);ea=p;h=new mb;h.setScaleHelper(a);h.setNodeStatusMonitor(b);h.setLinkUiHelper(t);h.setOverViewContainer(D);h.setLinkUi(Y);p=h.getJqUi();D.append(p);Na.layoutCtrlWithLRTB(Y,0,0,null,0,0,null);aa.bindDropUi(Y,Pa,ca,la,a);z&&Ba()},m=function(){rb.addFunAddTableCallBack(function(p,f,Q){if(p=c.adaptSize(z)){Q=Y.position();var y=a.getScaledSize(p.getLeftExtension());p=a.getScaledSize(p.getTopExtension());Na.layoutCtrl(Y,Q.left-y,Q.top-p,null,null);ia()}else t.addTableUi(f),Q&&
t.addJoinUi(Q);1>=z.getTables().length&&ha();b.setSelected(f);ea.updateDropdown()});rb.addFunDeleteTableCallBack(function(){var p=z.getTables();0<p.length?b.setSelected(p[0]):b.setSelected(null);ia();ea.updateDropdown()})},q=function(p){var f=$(p.target);if(Na.upwardSearchHasClass(f,D,ub.UI_MARK)||Na.upwardSearchHasClass(f,D,ub.DROP_DOWN))return!0;if(!Na.upwardSearchHasClass(f,D,h.getUiMark())&&!Na.upwardSearchHasClass(f,D,h.getOverViewUiMark()))if(Na.upwardSearchHasClass(f,D,t.getNodeOperateUiMark()))t.showNodeOperateSelector(),
p.stopPropagation();else if(f=Na.upwardSearchHasClass(f,D,t.getTableUiMark())||Na.upwardSearchHasClass(f,D,t.getJoinUiMark())){var Q=t.getTableModelByUi(f,!0);Q!=b.getSelected()&&b.setSelected(Q);if(f.hasClass(t.getTableUiMark())){var y=new Za;y.setTarget(Q);y.setEndMoveCallback(function(ra,Ka){Q.setPosition(ra,Ka);b.notifyListener(K.KEY_NODE_CHANGE_POSITION,Q)});y.setMovableArea(Y);y.setScaleHelper(a);y.setDataSetModel(z);y.startDrag(p)}f=f.attr("id");d==f?(l(p,d),d=null):(d=f,setTimeout(function(){d=
null},1E3))}else f=new Fa,f.setMovableArea(D),f.setGlobal(r),f.setScaleHelper(a),f.startDrag(p,Y)},l=function(p,f){p=$(p.target);Na.upwardSearchHasClass(p,D,vb.NODE_NAME_UI_CLASS)&&t.renameNode(f,V)},V=function(p,f,Q){var y=p,ra;f instanceof lb&&(y=ra=f.getParentNode());(f=qa.checkTableName(Q,p,ra))?r.getMessageCurtain().showPrompt(f,2E3):(p.setAlias(Q.trim()),b.notifyListener(K.KEY_NODE_RENAME,p),b.notifyListener(K.KEY_REFRESH_ATTR_UI,y))},G=function(p){p=$(p.target);!Na.upwardSearchHasClass(p,D,
h.getOverViewUiMark())&&(t.cleanHoverUi(),p=Na.upwardSearchHasClass(p,D,t.getTableUiMark()))&&(p=t.setTableUiHover(p.attr("id")),t.setNodeOperateTypes(z.isTableDeletable(p.getGenericTable())?[db.PREVIEW_TABLE,db.DELETE_TABLE]:[db.PREVIEW_TABLE]))},pa=function(){a=new Ca;a.addPropertyChangedListener(function(){var p=Y.width(),f=Y.height();ia();var Q=Y.width(),y=Y.height(),ra=Y.position();Na.layoutCtrl(Y,ra.left+(p-Q>>1),ra.top+(f-y>>1),null,null)})},ma=function(){var p=new $a;p.setScaleHelper(a);p.addSelectedCallback(function(f,
Q){f==db.PREVIEW_TABLE?Q.check()?r.getMessageCurtain().showPrompt(Xa.get("tablePreviewError","\u6570\u636e\u8868\u8bbe\u7f6e\u5b58\u5728\u9519\u8bef\uff0c\u65e0\u6cd5\u9884\u89c8\u6570\u636e\u3002"),5E3):(new jb(r,Q)).showDialog():f==db.DELETE_TABLE&&Aa(Q)});t=new sa;t.setNodeOperateCreator(p);t.setScaleHelper(a)},Aa=function(p){if(!oa){var f=Xa.get("delTable","\u5220\u9664\u6570\u636e\u8868\u201c#1\u201d\u540e\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u786e\u5b9a\u5220\u9664\u8be5\u6570\u636e\u8868\u5417\uff1f").replace("#1",
p.getAlias());p.isSubTable()||0!=z.findRelatedToCurrentTables(p,!1).length&&(f=Xa.get("delWizardTableAndOther","\u5220\u9664\u6240\u9009\u6570\u636e\u8868\uff0c\u5c06\u4f1a\u540c\u65f6\u5220\u9664\u5176\u53f3\u4fa7\u5173\u8054\u7684\u5176\u4ed6\u6570\u636e\u8868\uff0c\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f"));var Q=X.createFeedbackDialog();Q.setMsgImageType(X.MSG_CONFIRM);Q.setMessage(f);Q.setClosingChecker(function(y){y==X.RETURN_OK&&(p.isSubTable()?(y=p.getParentTable(),rb.deleteSubTable(p,y,
!0),b.notifyListener(K.KEY_NODE_FIELDS_RESELECT,y),b.notifyListener(K.KEY_DEL_SUBTABLE,y),b.notifyListener(K.KEY_REFRESH_ATTR_UI,y)):rb.deleteTable(p));oa=!1;return!0});Q.showDialog();oa=!0}},Pa=function(){var p=[0,0];p=Na.upwardCoordinate(D[0],p,document.body);var f=[D.prop("clientWidth"),D.prop("clientHeight")];f=Na.upwardCoordinate(D[0],f,document.body);return new function(Q,y,ra,Ka){this.getLeft=function(){return Q};this.getRight=function(){return y};this.getTop=function(){return ra};this.getBottom=
function(){return Ka}}(p[0],f[0],p[1],f[1])},ca=function(p,f,Q){var y=Na.getCurrentTargetPosition(p);y=Na.upwardCoordinate(p.target,y,document.body);p=y[0];y=y[1];if(p<f.getLeft()||p>f.getRight()||y<f.getTop()||y>f.getBottom())return null;f=[0,0];f=Na.upwardCoordinate(Y[0],f,document.body);p-=f[0];f=y-f[1];p-=parseInt(a.getScaledSize(Q.getWidth())>>1);f-=parseInt(a.getScaledSize(Q.getHeight())>>1);f=a.getRawCoordinate([p,f]);Q.setPosition(f[0],f[1]);return new Ra(Y,z)};this.getCentralCoordinate=function(){var p=
[0,0];p=Na.upwardCoordinate(Y[0],p,document.body);var f=D.position(),Q=f.left+(D.width()>>1);f=f.top+(D.height()>>1);f=Na.upwardCoordinate(D[0],[Q,f],document.body);Q=f[0]-p[0];f=f[1]-p[1];Q-=parseInt(a.getScaledSize(qa.BASE_WIDTH)>>1);f-=parseInt(a.getScaledSize(qa.BASE_HEIGHT)>>1);return a.getRawCoordinate([Q,f])};var la=function(p,f){f();rb.addTable(z,p[0],p[1],p[2])},Ba=function(){var p=n();Na.layoutCtrl(Y,null,null,p[0],p[1]);t.create(z,Y)},ha=function(){var p=n();Na.layoutCtrl(Y,-(p[0]-D.width()>>
1),-(p[1]-D.height()>>1),null,null)},ia=function(){t&&t.clear();Ba();for(var p=z.getTables(),f=z.getJoins(),Q=0;Q<p.length;Q++)t.addTableUi(p[Q]);for(Q=0;Q<f.length;Q++)t.addJoinUi(f[Q]);(p=b.getSelected())&&t.addSelectedUi(p)},n=function(){var p=a.getScaledSize(z.getWidth()),f=a.getScaledSize(z.getHeight());return[p,f]},u=function(p,f,Q){if(p==K.CHANGE_JOIN_TYPE)t.updateJoinUi(f);else if(p==K.KEY_TARGET_JOIN_CHANGE||p==K.SWITCH_ORDER_OF_JOIN||p==K.KEY_DEL_SUBTABLE)ia();else if(p==K.KEY_NODE_RELAYOUT)k.reLayout(z),
c.adaptSize(z),ia(),f=n(),a.autoAdaptScale(f[0],f[1],D.width(),D.height()),ha();else if(p==K.KEY_NODE_CHANGE_POSITION)if(p=c.adaptSize(z))ia(),f=Y.position(),Q=a.getScaledSize(p.getLeftExtension()),p=a.getScaledSize(p.getTopExtension()),Na.layoutCtrl(Y,f.left-Q,f.top-p,null,null);else for(t.changeTableUiPosition(f),f=z.getJoinsByTable(f);0<f.length;)t.changeJoinUiPosition(f.shift());else if(p==K.KEY_NODE_RENAME)t.changeTableDisplayName(f);else if(p==K.KEY_NODE_FIELDS_RESELECT)for(t.updateFieldCount(f),
t.updateInvalidTableUi(f,f.check()),f=f.getModel().getJoinsByTable(f),p=0;p<f.length;p++)Q=f[p],t.updateInvalidJoinUi(Q,Q.check());else p==K.KEY_NODE_SELECTED?t.addSelectedUi(f):p==K.KEY_NODE_JOIN_FIELD_CHANGE?(Q=f,t.updateInvalidJoinUi(Q,Q.check())):p!=K.KEY_NODE_FILTER_CHANGE&&p!=K.KEY_NODE_ORDER_CHANGE&&p!=K.KEY_NODE_CALC_CHANGE||t.updateInvalidTableUi(f,f.check())}};var yb,Na,fb,Xa,Ra,tb,Ab,Ia,kb,vb,ub,qb,lb,rb,$a,db,wb,qa,K,I,X,ja,U;(function(){var D=com.kingdee.bos.qing;yb=D.SkinUtil;D=com.kingdee.bos.qing.common;
Na=D.DomUtil;Xa=D.MLS;fb=D.Util;D=com.kingdee.bos.extreport.datasetdesigner.generic.model;qa=D.GenericQueryTable;D=com.kingdee.bos.extreport.datasetdesigner.generic.component;K=D.NodeStatusMonitor;rb=D.TableHelper;D=com.kingdee.bos.extreport.datasetdesigner.wizard.link;Ra=D.DragInsideCheckResult;tb=D.Svg;kb=D.SvgTextTrimer;Ab=D.LineUi;Ia=D.TableNodeUI;vb=D.AbstractNodeUI;ub=D.JoinSorter;qb=D.UnionTableNode;lb=D.SubUnionNode;$a=D.NodeOperateCreator;db=D.OperateType;wb=D.DraggingAnchor;D=com.kingdee.bos.extreport.datasetdesigner;
I=D.Icons;D=com.kingdee.bos.qing.ui.component;X=D.MessageDialog;ja=D.AbstractModalDialog;U=D.TextField})();Ca.SUPPORT_SCALES=[.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5]})();(function(){function Ca(D,Y){var oa,aa,r,z,t,h,ea,k,c,b,a,e,d,g={},m=[],q=!0;this.setFunAddDataSourceCallback=function(la){a=la};this.setEnableButtonFunCallBack=function(la){e=la};this.setFunShowNoDataSourceUi=function(la){d=la};this.setDragHandler=function(la){};this.getJqUi=function(){oa||pa();return oa};this.dataSourceModel2Ui=function(la,Ba){g={};var ha=[];m=ha;for(var ia={},n=0;n<la.length;n++){var u=la[n],p=u.getDataSourceType();p==rb.OUT_DB||p==rb.USER_SUPER_QUERY?ha.push(u):ia[p]||(ia[p]=
p,ha.push(u))}l(ha,Ba)};var l=function(la,Ba){k.setItemModels(la,function(ha,ia){return G(ha,ia)});k.setSelecteds(Ba?[Ba]:V(la));e&&e(!0,!0,!0)},V=function(la){if(0<k.getSelecteds().length)for(var Ba=k.getSelecteds()[0],ha=0;ha<la.length;ha++)if(G(Ba,la[ha]))return[la[ha]];return[la[0]]},G=function(la,Ba){var ha=la.checkSourceEquality(Ba);return ha=ha&&!!la.getException()===!!Ba.getException()};this.getSelectedSource=function(){return k.getSelecteds()[0]};this.setDataSetModel=function(la){b=la;if(c){la=
c.getGenericSource();for(var Ba=b.getSources(),ha=0;ha<Ba.length;ha++){var ia=Ba[ha];if(ia.getId()==la.getId()){c.updateGenericSource(ia);break}}}};this.updateUi=function(){Pa()};this.resize=function(){Pa()};this.showNoSourceUi=function(){aa||Aa();oa.hide();aa.show();0==document.body.clientHeight&&0==document.body.clientWidth||!q||(q=!1,setTimeout(function(){ca()},0))};this.showPaneUi=function(){aa&&aa.hide();oa.show()};this.isNeedShowNoDataSourceUi=function(la){la=la.getException(ub.DATA_SOURCE,
qb.DATA_SOURCE_UNDEFINED);return gb.isNotEmptyStr(la)};this.showNoTableExceptionUiFromModel=function(la){};this.isShowNoTableExceptionUi=function(){};var pa=function(){t=$("<div>");z=$("<div>");ma(z);ea=new fb;ea.setHorizontalSplit(!1);ea.setFirstSize(260,260,-1);ea.setSecondSize(400,260,-1);ea.setResizeMode(fb.RESIZE_MODE_FIRST_FIXED);ea.setFirstChild(fb.createChildWrapper(z,function(){}));ea.setSecondChild(fb.createChildWrapper(t));oa=ea.getJqUi()},ma=function(la){Na.createTitle(Sa.get("dataSource",
"\u6570\u636e\u6e90")).appendTo(la);var Ba=$("<div>");Ba.attr("title",Sa.get("dataSourceDesc","\u6dfb\u52a0\u6570\u636e\u6e90"));Za.background(Ba,"add");Ba.addClass("wizard-add-source-icon");Ba.appendTo(la);Ba.on("click",function(){ca()});var ha=function(ia,n){ia.css("height","30px");ia.css("cursor","default");g[n.getIdentifier()]=ia;var u=n.check();if(u){var p=U.getErrorIcon(u);sa.layoutCtrlWithLRTB(p,null,null,null,8);p.appendTo(ia)}if(n){p=$("<div>");p.addClass("extreport-dataset-designer-sourcearea-icon");
var f=rb.typeToIconName(n.getDataSourceType());Za.background(p,f);p.appendTo(ia);f=n.getDisplayName();ia.attr("name",f);var Q=$("<div>");Q.addClass("extreport-dataset-designer-sourcearea-name");Q.text(f);Q.attr("title",f);Q.appendTo(ia);u&&(sa.layoutCtrl(p,20),sa.layoutCtrl(Q,44))}var y=$("<div>");y.attr("title",Sa.get("deleteDs","\u5220\u9664\u6570\u636e\u6e90"));y.addClass("extreport-dataset-designer-sourcearea-switch-btn");y.on("mousedown",function(ra){ra.stopPropagation();(ra=n.checkDeletable())?
Y.getMessageCurtain().showPrompt(ra,2500):(ra=new tb,ra.setText(Sa.get("delSource","\u786e\u5b9a\u5220\u9664\u8be5\u6570\u636e\u6e90\u5417\uff1f")),ra.setConfirmedListener(function(Ka){if(Ka){Ka=Object.values(n.fetchRelatedSourceMap());for(var Wa=0;Wa<Ka.length;Wa++)b.removeSource(Ka[Wa]);Ka=m.indexOf(n);-1!=Ka&&m.splice(Ka,1);0==b.getSources().length?d():(Ka=0==Ka?Ka:--Ka,l(m,m[Ka]))}}),ra.show(y,!1))});Za.background(y,"delete");y.appendTo(ia);y.hide();ia.mouseenter(function(){y.show()}).mouseleave(function(){y.hide()})};
Ba=new Xa;Ba.setBorderVisible(!0);Ba.setToggleSelectingEnabled(!1);Ba.setCustomItemPainter(ha);Ba.setCustomSelectedsPainter(function(ia,n){n&&0<n.length&&ia&&0<ia.length&&(ia=ia[0],ia.css("background-color",""),ia.css("color",""))});Ba.addSelectedChangedListener(function(ia,n,u){u&&0<u.length&&(c&&(c=null,h&&h.remove(),h=null),c=K.getSearchTable(u[0]),h=c.getJqUi(),sa.layoutCtrlWithLRTB(h,0,0,null,0,0,null),t.append(h))});k=Ba;k.setItemModels([]);K.setFunSyncSourceState(function(ia,n,u){ia=g[n.getIdentifier()];
ia.empty();ha(ia,n)});Ba=Ba.getJqUi();sa.layoutCtrlWithLRTB(Ba,0,0,null,25,0,null);Ba.appendTo(la)},Aa=function(){aa=$("<div>");aa.appendTo(oa.parent());sa.layoutCtrl(aa,null,null,"100%","100%");var la=Na.createTitle(Sa.get("dataSource","\u6570\u636e\u6e90")),Ba=0;mb.isEnglish()&&(Ba=24);sa.layoutCtrl(la,null,null,60+Ba,null);la.appendTo(aa);la=$("<div>");la.addClass("extreport-dataset-designer-left-border");la.addClass("extreport-dataset-designer-right-border");la.addClass("extreport-dataset-designer-top-border");
la.addClass("extreport-dataset-designer-bottom-border");la.appendTo(aa);sa.layoutCtrlWithLRTB(la,0,0,null,25,0,null);r=$("<div>");r.addClass("extreport-dataset-select-source-tip-ui");r.appendTo(la);r.hide();setTimeout(function(){r.show()},0);la=$("<div>");la.appendTo(r);Za.background(la,"NoParam");sa.layoutCtrlCenterAlign(la,200);sa.layoutCtrlMiddleAlign(la,120);sa.layoutCtrl(la,null,130,null,null);la=Sa.get("noAddSourceClick","\u5c1a\u672a\u6dfb\u52a0\u6570\u636e\u6e90\uff0c\u70b9\u51fb\u6dfb\u52a0");
Ba=new Fa;Ba.setFontSize(Oa.getFontSize(),Oa.getFontName());var ha=Ba.measureWidth(la);Ba=$("<div>");Ba.text(Sa.get("noAddSource","\u5c1a\u672a\u6dfb\u52a0\u6570\u636e\u6e90\uff0c\u70b9\u51fb"));Ba.css({color:"rgb(102, 102, 102)"});sa.layoutCtrlCenterAlign(Ba,ha+5);sa.layoutCtrlMiddleAlign(Ba,100);sa.layoutCtrl(Ba,null,213,null,null);Ba.appendTo(r);ha=$("<div>");ha.text(Sa.get("addSource","\u6dfb\u52a0"));ha.attr("title",la);ha.on("click",function(){ca()});ha.addClass("extreport-dataset-designer-text-add");
ha.appendTo(Ba)},Pa=function(){r&&r.is(":visible")||(ea.resize(!0),c&&c.isReadyForUpdateUi()&&c.updateUi(!0))},ca=function(){var la=new $a(Y,b);la.setSelectedSource(b.getSources());la.setFunCloseCallBack(a);la.showDialog()}}"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.extreport&&(com.kingdee.bos.extreport={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner&&
(com.kingdee.bos.extreport.datasetdesigner={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner.wizard&&(com.kingdee.bos.extreport.datasetdesigner.wizard={});var sa,Fa,Sa,Oa,Za,gb,mb,ya,jb,yb,Na,fb,Xa,Ra,tb,Ab,Ia,kb,vb,ub,qb,lb,rb,$a,db,wb,qa,K,I,X,ja,U;(function(){var D=com.kingdee.bos.qing.common;sa=D.DomUtil;Fa=D.TextMeasurer;D=com.kingdee.bos.qing.framework.common;Sa=D.MultilanguageManager.createPackageAccessor(com.kingdee.bos.extreport.datasetdesigner);Oa=D.GlobalFont;D=com.kingdee.bos.extreport.datasetdesigner;
Za=D.Icons;D=com.kingdee.bos.extreport.datasetdesigner.common;gb=D.StringUtil;mb=D.LanguageUtil;ya=D.EventType;D=com.kingdee.bos.extreport.datasetdesigner.common.query;jb=D.TabQueryPaneFactory;D=com.kingdee.bos.extreport.datasetdesigner.common.ui;yb=D.AbstractDataSetTabPane;Na=D.QueryCommonUi;D=com.kingdee.bos.qing.ui.component;fb=D.SplitPane;Xa=D.List;Ra=D.TabContainer;tb=D.SimpleConfirmer;D=com.kingdee.bos.extreport.datasetdesigner.wizard.output;Ab=D.TabColumnPane;Ia=D.TabFilterPane;kb=D.TabOrderPane;
D=com.kingdee.bos.extreport.datasetdesigner.model;vb=D.DataSetType;ub=D.DataSetModelCheckType;qb=D.DataSetModelCheckCode;D=com.kingdee.bos.extreport.datasetdesigner.generic.model;lb=D.GenericQueryDataSetModel;rb=D.GenericQueryDataSourceType;D=com.kingdee.bos.extreport.datasetdesigner.generic.component;$a=D.DataSourceDialog;ja=D.AttrUIFactory;X=D.NodeStatusMonitor;U=D.ErrorIconFactory;qa=D.TableHelper;K=D.SearchableTableFactory;I=D.GenericSearchTableCache;D=com.kingdee.bos.extreport.datasetdesigner.wizard.link;
db=D.LinkArea;wb=D.DragHandler})();jb.addQueryPane(vb.GENERIC_QUERY_DATASET,function(D,Y){yb.call(this,Sa.get("query","\u67e5\u8be2"),Y);var oa=this,aa,r,z,t,h,ea,k,c,b,a,e,d,g,m,q,l,V,G,pa,ma,Aa,Pa,ca;this.resize=function(ta){r&&r.is(":visible")?e&&e.resize(!0):(e&&e.resize(!0),l&&l.resize(!0),ca&&ca.resize(),m&&m.resize(!0),Aa&&Aa.repaintUI());ta=q.getCurrentTabPane();q.setCurrentTabPane(ta)};this.fireTabChangeEvent=function(){oa.resize();var ta=oa.getDataSetModelVO();ta&&ta.getDataSetModel()};
this.setEnableButtonFunCallBack=function(ta){Pa=ta};this.protectedInit=function(ta){ia();aa||(ca=new Ca(D,Y),ca.setDragHandler(d),ca.setFunAddDataSourceCallback(ra),ca.setFunShowNoDataSourceUi(f),ca.setEnableButtonFunCallBack(Pa),aa=ca.getJqUi());k||(k=$("<div>"),Na.createTitle(Sa.get("link","\u8fde\u63a5")).appendTo(k),Aa=new db,Aa.setGlobal(Y),Aa.setDragHandler(d),Aa.setNodeStatusMonitor(g),Aa.getJqUi().appendTo(k));n();u();l=new fb;l.setHorizontalSplit(!1);l.setFirstSize(396,260,-1);l.setSecondSize(260,
130,-1);l.setResizeMode(fb.RESIZE_MODE_SECOND_FIXED);l.setFirstChild(fb.createChildWrapper(k,function(){var Ta=q.getCurrentTabPane();Ta&&Ta.resize()}));l.setSecondChild(fb.createChildWrapper(c));m=new fb;m.setHorizontalSplit(!0);m.setFirstChild(fb.createChildWrapper(l.getJqUi(),function(){var Ta=q.getCurrentTabPane();Ta&&Ta.resize();ma&&ma.updateOrderTable&&ma.updateOrderTable()}));m.setSecondChild(fb.createChildWrapper(ea));m.setFirstSize(400,-1,-1);m.setSecondSize(300,260,400);m.setResizeMode(fb.RESIZE_MODE_SECOND_FIXED);
h=$("<div>");m.getJqUi().appendTo(h);e=new fb;e.setHorizontalSplit(!0);e.setFirstSize(260,200,400);e.setSecondSize(600,-1,-1);e.setResizeMode(fb.RESIZE_MODE_FIRST_FIXED);e.setFirstChild(fb.createChildWrapper(aa));e.setSecondChild(fb.createChildWrapper(h,function(){r&&r.is(":visible")&&f();ca&&ca.updateUi();m.resize(!0)}));var Ja=e.getJqUi();Ja.addClass("extreport-dataset-designer-tab-pane");Ja.attr("onselectstart","return false;");Ja.appendTo(ta)};this.protectedUpdateUi=function(ta){la(ta)};this.protectedGetDataSourceModel=
function(ta){return ta.getSources()};var la=function(ta){if(ta=ta.getDataSetModel())if(ca.setDataSetModel(ta),Aa.setDataSetModel(ta),g.syncSelectedModel(ta),I.clear(),ta.checkProps([lb.FILTERS,lb.ORDERS]),Y.isCurrentTab(oa)&&oa.resize(!0),ca.isNeedShowNoDataSourceUi(ta))f(),Pa&&Pa(!1,!1,!1);else{r&&r.hide();m.getJqUi().show();var Ja=oa.protectedGetDataSourceModel(ta);ta.getException(ub.DATA_SOURCE)?(Pa&&Pa(!1,!1,!0),ca.showNoTableExceptionUiFromModel(Ja)):Pa&&Pa(!0,!0,!0);ca.dataSourceModel2Ui(Ja);
(Ja=q.getCurrentTabPane())&&Ja.model2Ui();Ba(ta)?Q():(l.resize(!0),Aa.repaintUI())}},Ba=function(ta){ta=ta.getTables();return!ta||0===ta.length},ha=function(ta){Ba(ta)?Q():(z||p(),ea.show(),z.hide(),l&&l.resize());ta&&ta.checkProps([lb.FILTERS,lb.ORDERS]);q&&(ta=q.getCurrentTabPane())&&ta.model2Ui()},ia=function(){d=new wb;d.setFunNoneTableExists(function(ta){return Ba(ta)});g=new X;qa.addFunAddTableCallBack(function(ta,Ja){ha(ta)});qa.addFunDeleteTableCallBack(function(ta,Ja){ha(ta)});ja.setGlobal(Y);
ja.setNodeStatusMonitor(g);Y.addListener(ya.PARAM_NAME_CHANGE,function(ta){(ta=ta.model)&&ta.checkFilterParamExp&&ta.checkFilterParamExp()});Y.addListener(ya.COLS_AREA_DEL_COL,function(ta){ta.check();g.notifyListener(X.KEY_NODE_FIELDS_RESELECT,ta);g.notifyListener(X.KEY_REFRESH_ATTR_UI,ta)});Y.addListener(ya.CALC_MODEFIED_FROM_FIELD_AREA,function(ta){ta.check();g.notifyListener(X.KEY_REFRESH_ATTR_UI,ta)});K.setGlobal(Y);K.setDragHandler(d);K.setNodeStatusMonitor(g);K.setFunGetLinkAreaCentralPos(function(){return Aa.getCentralCoordinate()});
g.addEventListener(function(ta){ta==X.MANUAL_MODEL_TO_UI&&la(Y.getMainDataSetModelVO())})},n=function(){c||(c=$("<div>"),V=new Ab(Y),G=new Ia(Y),pa=new kb(Y),q=new Ra,q.setTabLevel(Ra.SECOND_LEVEL),q.addTab(V,!0),q.addTab(G),q.addTab(pa),q.addTabChangedListener(function(ta,Ja){Ja.fireTabChangeEvent()}),q.getJqUi().appendTo(c),Ka(c,"downArrow"),g.addEventListener(function(ta,Ja){if(ta==X.KEY_NODE_FIELDS_RESELECT||ta==X.KEY_NODE_RENAME||ta==X.KEY_NODE_CALC_CHANGE)ta==X.KEY_NODE_FIELDS_RESELECT&&Y.getMainDataSetModelVO().getDataSetModel().checkProps([lb.COLUMNS,
lb.CALC_COLS,lb.FILTERS,lb.ORDERS]),(ta=q.getCurrentTabPane())&&ta.model2Ui()}))},u=function(){if(!ea){ea=$("<div>");var ta=$("<div>");ta.addClass("wizard-prop-content");var Ja=Na.createTitle(Sa.get("prop","\u5c5e\u6027"));Ka(Ja,"rightArrow");Ja.appendTo(ea);ta.appendTo(ea);g.addEventListener(function(Ta,bb){Ta==X.KEY_NODE_SELECTED?(ta.empty(),ma=ja.getJqUiByModel(bb),ta.append(ma.getJqUi())):Ta==X.KEY_REFRESH_ATTR_UI&&bb==g.getSelected()&&(ta.empty(),ma=ja.getJqUiByModel(bb),ta.append(ma.getJqUi()))})}},
p=function(){Na.createTitle(Sa.get("link","\u8fde\u63a5")).appendTo(h);z=$("<div>");z.addClass("wizard-no-table-or-source");z.appendTo(h);sa.layoutCtrlWithLRTB(z,0,0,null,25,0,null);var ta=$("<div>");ta.appendTo(z);Za.background(ta,"linkBg");sa.layoutCtrlCenterAlign(ta,254);sa.layoutCtrlMiddleAlign(ta,140)},f=function(){if(!r){r=$("<div>");r.addClass("wizard-no-table-or-source");r.appendTo(h);sa.layoutCtrlWithLRTB(r,0,0,null,25,0,null);t=$("<div id='noDatasource'>");t.addClass("extreport-dataset-no-source-tip-ui");
t.appendTo(r);var ta=$("<div id='middle'>");ta.appendTo(t);sa.layoutCtrlCenterAlign(ta,180);sa.layoutCtrlMiddleAlign(ta,230);var Ja=$("<div id='left'>");sa.layoutCtrlCenterAlign(Ja,180);sa.layoutCtrlMiddleAlign(Ja,230);Ja.css({transform:"translateX(-280px)"});Ja.appendTo(t);var Ta=$("<div>");Za.background(Ta,"ds_linkTable");sa.layoutCtrlCenterAlign(Ta,144);sa.layoutCtrl(Ta,null,0,144,144);Ta.appendTo(ta);Ta=$("<div>");Za.background(Ta,"datasource");sa.layoutCtrlCenterAlign(Ta,144);sa.layoutCtrl(Ta,
null,0,144,144);Ta.appendTo(Ja);Ta=$("<div>");Ta.text(Sa.get("dataSourceDesc","\u6dfb\u52a0\u6570\u636e\u6e90"));Ta.css({color:"rgb(102, 102, 102)","text-align":"center"});sa.layoutCtrlCenterAlign(Ta,100);sa.layoutCtrlMiddleAlign(Ta,100);sa.layoutCtrl(Ta,null,180,null,null);Ta.appendTo(Ja);Ja=$("<div>");Ja.text(Sa.get("linkTable","\u8fde\u63a5\u6570\u636e\u8868"));Ja.css({color:"rgb(102, 102, 102)","text-align":"center"});sa.layoutCtrlCenterAlign(Ja,160);sa.layoutCtrlMiddleAlign(Ja,100);sa.layoutCtrl(Ja,
null,180,null,null);Ja.appendTo(ta);ta=$("<div id='arrow1'>");Za.background(ta,"arrow");sa.layoutCtrlCenterAlign(ta,64);sa.layoutCtrlMiddleAlign(ta,64);ta.css({transform:"translate(-140px, -43px)"});ta.appendTo(t);ta=$("<div id='arrow2'>");Za.background(ta,"arrow");sa.layoutCtrlCenterAlign(ta,64);sa.layoutCtrlMiddleAlign(ta,64);ta.css({transform:"translate(140px, -43px)"});ta.appendTo(t);ta=$("<div id='right'>");sa.layoutCtrlCenterAlign(ta,180);sa.layoutCtrlMiddleAlign(ta,230);ta.css({transform:"translateX(280px)"});
ta.appendTo(t);Ja=$("<div>");Ja.appendTo(ta);Za.background(Ja,"param");sa.layoutCtrlCenterAlign(Ja,144);sa.layoutCtrl(Ja,null,0,144,144);Ja=$("<div>");Ja.text(Sa.get("parameterDesc","\u8bbe\u7f6e\u53c2\u6570\u53ca\u63a7\u4ef6"));Ja.css({color:"rgb(102, 102, 102)","text-align":"center"});sa.layoutCtrlCenterAlign(Ja,100);sa.layoutCtrlMiddleAlign(Ja,100);sa.layoutCtrl(Ja,null,180,null,null);Ja.appendTo(ta)}Pa&&Pa(!1,!1,!1);ea.hide();y(!1);r.show();z&&z.hide();ca.showNoSourceUi()},Q=function(){z||p();
ea.hide();z.show()},y=function(ta){for(var Ja=oa.getJqUi().parent().parent().children(".sa-ctrl-tab-head"),Ta,bb=0;bb<Ja.length;bb++){var ob=$(Ja[bb]);ob.text()!=oa.getTitle()&&(Ta=ob)}ta?Ta&&Ta.removeClass("extreport-dataset-designer-disable-param-tab"):Ta&&Ta.addClass("extreport-dataset-designer-disable-param-tab")},ra=function(ta,Ja){0==ta.getTables().length&&(y(!0),r&&r.hide(),Q(),ca.showPaneUi(),ca.resize());ca.dataSourceModel2Ui(ta.getSources(),Ja)},Ka=function(ta,Ja){var Ta=$("<div>");Ta.on("click",
function(bb){Wa(Ja)});Ta.addClass("extreport-dataset-designer-cursor-pointer");Za.backgroundWithHover(Ta,Ja);Ta.appendTo(ta);sa.layoutCtrlWithLRTB(Ta,null,4,16,4,null,16)},Wa=function(ta){"downArrow"===ta?(l.collapseSecondHalf(!0),c.show(!1),ib(!0)):"rightArrow"===ta?(m.collapseSecondHalf(!0),nb(!0)):"upArrow"===ta?(l.collapseSecondHalf(!1),c.show(!0),ib(!1)):"leftArrow"===ta&&(m.collapseSecondHalf(!1),nb(!1))},ib=function(ta){if(!b){b=$("<div>");b.on("click",function(){Wa("upArrow")});b.addClass("extreport-dataset-designer-show-output-btn");
var Ja=$("<div>");Ja.appendTo(b);Za.backgroundWithHover(Ja,"upArrow");var Ta=$("<div>");Ta.text(Sa.get("outputPane","\u5b57\u6bb5/\u8fc7\u6ee4/\u6392\u5e8f"));Ta.appendTo(b);sa.layoutCtrlMiddleAlign(Ta,16);sa.layoutCtrlMiddleAlign(Ja,16);sa.layoutCtrlWithLRTB(Ta,5,null,null,null,null,null);sa.layoutCtrlWithLRTB(Ja,null,5,16,null,null,16);b.appendTo(l.getJqUi())}ta?(b.show(),l.setSplitLineWide(27)):(b.hide(),l.setSplitLineWide(8));l.resize()},nb=function(ta){if(!a){a=$("<div>");a.addClass("extreport-dataset-designer-show-param-btn");
a.on("click",function(){Wa("leftArrow")});var Ja=$("<div>");Ja.appendTo(a);Za.backgroundWithHover(Ja,"leftArrow");var Ta=$("<div>");Ta.text(Sa.get("etc","..."));Ta.appendTo(a);sa.layoutCtrlCenterAlign(Ta,16);sa.layoutCtrlWithLRTB(Ta,null,null,null,25,0,null);sa.layoutCtrlCenterAlign(Ja,16);sa.layoutCtrlWithLRTB(Ja,null,null,null,5,null,16);a.appendTo(e.getJqUi())}ta?(a.show(),m.setSplitLineWide(27)):(a.hide(),m.setSplitLineWide(8));m.resize()}})})();
//qingVersionTag: 20250324