var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,c,d){if(f==Array.prototype||f==Object.prototype)return f;f[c]=d.value;return f};
$jscomp.getGlobal=function(f){f=["object"==typeof globalThis&&globalThis,f,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var c=0;c<f.length;++c){var d=f[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(f,c){var d=$jscomp.propertyToPolyfillSymbol[c];if(null==d)return f[c];d=f[d];return void 0!==d?d:f[c]};$jscomp.polyfill=function(f,c,d,n){c&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(f,c,d,n):$jscomp.polyfillUnisolated(f,c,d,n))};
$jscomp.polyfillUnisolated=function(f,c,d,n){d=$jscomp.global;f=f.split(".");for(n=0;n<f.length-1;n++){var e=f[n];if(!(e in d))return;d=d[e]}f=f[f.length-1];n=d[f];c=c(n);c!=n&&null!=c&&$jscomp.defineProperty(d,f,{configurable:!0,writable:!0,value:c})};
$jscomp.polyfillIsolated=function(f,c,d,n){var e=f.split(".");f=1===e.length;n=e[0];n=!f&&n in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var z=0;z<e.length-1;z++){var D=e[z];if(!(D in n))return;n=n[D]}e=e[e.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?n[e]:null;c=c(d);null!=c&&(f?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:c}):c!==d&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(d=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+d+"$"+e),$jscomp.defineProperty(n,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:c})))};$jscomp.polyfill("Object.is",function(f){return f?f:function(c,d){return c===d?0!==c||1/c===1/d:c!==c&&d!==d}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(f){return f?f:function(c,d){var n=this;n instanceof String&&(n=String(n));var e=n.length;d=d||0;for(0>d&&(d=Math.max(d+e,0));d<e;d++){var z=n[d];if(z===c||Object.is(z,c))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(f,c,d){if(null==f)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return f+""};$jscomp.polyfill("String.prototype.includes",function(f){return f?f:function(c,d){return-1!==$jscomp.checkStringArgs(this,c,"includes").indexOf(c,d||0)}},"es6","es3");
(function(){"undefined"==typeof com&&(com={});"undefined"==typeof com.kingdee&&(com.kingdee={});"undefined"==typeof com.kingdee.bos&&(com.kingdee.bos={});"undefined"==typeof com.kingdee.bos.extreport&&(com.kingdee.bos.extreport={});"undefined"==typeof com.kingdee.bos.extreport.datasetdesigner&&(com.kingdee.bos.extreport.datasetdesigner={});com.kingdee.bos.extreport.datasetdesigner.Main=function(){var g=this,ya=$(document.body),E,w,F,X,fa,ha,x,L,N,C,O,v,P,y,Y,G,Q,ia,B,H,Z=!1,p=new function(){var a,
b,k,h=new d,m=new ja;this.getMainDataSetModelVO=function(){return g.getDataSetModelVO()};this.collectJsonModel=function(l){return R(l)};this.addWindowResizeListener=function(l){h.addListener(l)};this.removeWindowResizeListener=function(l){h.removeListener(l)};this.fireWindowResizeEvent=function(){h.fireEvent(function(l){l()})};this.addListener=function(l,r){m.addListener(l,r)};this.removeListener=function(l,r){m.removeListener(l,r)};this.fireEvent=function(l,r){m.fireEvent(l,r)};this.getMessageCurtain=
function(){a||(a=new ka,a.getJqUi().appendTo($("body")));return a};var q=function(l){var r=c.decodeParamFromUrl(window.location.search,"path");l=(r?r:"/ierp")+l;r=new la;r.setRemoteUrl(l);return r},A=function(l,r,u,aa,ba){ba||(b||(b=q("/qing_rpt/datasetDesigner.do")),ba=b);return new l(ba,r,function(za,Aa,Ba){return u?u(za,Aa,Ba):!1},aa)};this.createDesignerFacade=function(l,r,u){return A(I.getFacade(J.Designer),l,r,u)};this.createQueryFacade=function(l,r,u){return A(I.getFacade(J.Query),l,r,u)};
this.createParamCtrlFacade=function(l,r,u){return A(I.getFacade(J.ParamCtrl),l,r,u)};this.createMacroManageFacade=function(l,r,u){var aa=I.getFacade(J.Macro);k||(k=q("/qing/macroManage.do"));return A(aa,l,r,u,k)};this.createGenericFacade=function(l,r,u){return A(I.getFacade(J.Generic),l,r,u)};this.isCurrentTab=function(l){return x.getCurrentTabPane()===l};this.jsonModelToUi=function(l){l=ca(l);da(l,!1)}};this.start=function(){z.init();ma.hookCollector(function(a,b){S.interestInBehavior(a,b)});C="true"==
c.decodeParamFromUrl(window.location.search,"isPreset");v=c.decodeParamFromUrl(window.location.search,"dataSetId");P=c.decodeParamFromUrl(window.location.search,"dataSetName");G=c.decodeParamFromUrl(window.location.search,"spaceType");Q=c.decodeParamFromUrl(window.location.search,"spaceId");ia=c.decodeParamFromUrl(window.location.search,"spaceCreatorId");S.interestInBehaviorEntrance(S.ENTRANCE_EXTREPORT_DATASET_DESIGNER);Ca()};this.getDataSetModelVO=function(){return y};var Ga=function(a){E=$("<div>");
E.addClass("extreport-dataset-designer");Da(a);Ea();na();Fa();E.appendTo(ya);if(G==T.COLLABORATION&&!a.isUserAcquiredLock()){Z=!0;X.setEnabled(!1);var b=e.get("datasetLockedByOther","\u5f53\u524d\u6570\u636e\u96c6\u5df2\u88ab\u201c#1\u201d\u9501\u5b9a\uff0c\u60a8\u7684\u4fee\u6539\u5c06\u65e0\u6cd5\u4fdd\u5b58\uff0c\u5efa\u8bae\u60a8\u9501\u5b9a\u5f53\u524d\u6570\u636e\u96c6\u540e\u518d\u8fdb\u884c\u7f16\u8f91\u3002").replace("#1",a.getLockHolderName());p.getMessageCurtain().showPrompt(b,-1)}Z||G!=
T.COLLABORATION||p.createDesignerFacade(function(k){k&&p.getMessageCurtain().showPrompt(k,-1)},function(){return!0}).checkSpaceCreatorPerm(v,a.getDataSetModel().toJsonObject())},Da=function(a){F=new oa;w=F.getJqUi();w.addClass("extreport-dataset-designer-toolbar");var b=e.get("save","\u4fdd\u5b58");X=F.createButton(w,!1,Ha,b,b);b=e.get("preview","\u9884\u89c8");fa=F.createButton(w,!1,Ia,b,b);b=e.get("check","\u6821\u9a8c");ha=F.createButton(w,!1,function(){U()},b,b);b=e.get("close","\u9000\u51fa");
F.createButton(w,!1,Ja,b,b);if(G==T.COLLABORATION){var k=a.getLockType()==K.EXPLICIT_LOCK?e.get("lockedByExplicit","\u5df2\u88ab\u201c#1\u201d\u957f\u671f\u9501\u5b9a"):e.get("lockedByOther","\u5df2\u88ab\u201c#1\u201d\u9501\u5b9a");a.isUserAcquiredLock()?(b="lock_by_me",k=k.replace("#1",e.get("me","\u6211")),B=$("<span>"),B.addClass("extreport-dataset-designer-lock-btn"),a=a.getLockType()==K.EXPLICIT_LOCK?e.get("unlockExplicit","\u89e3\u9664\u957f\u671f\u9501\u5b9a"):e.get("acquireLockExplicit",
"\u6539\u4e3a\u957f\u671f\u9501\u5b9a"),B.text(a),B.on("click",function(){var h=new pa;h.show(E);if(y.getLockType()==K.EXPLICIT_LOCK){var m=Ka;var q=e.get("unlockExplicitTips","\u89e3\u9664\u957f\u671f\u9501\u5b9a\u540e\uff0c\u9000\u51fa\u7f16\u8f91\u754c\u9762\u5c06\u4f1a\u81ea\u52a8\u91ca\u653e\u9501\u5b9a\uff0c\u786e\u5b9a\u89e3\u9664\u957f\u671f\u9501\u5b9a\u5417\uff1f")}else m=La,q=e.get("acquireLockExplicitTips","\u6539\u4e3a\u957f\u671f\u9501\u5b9a\u540e\uff0c\u9000\u51fa\u7f16\u8f91\u754c\u9762\u5c06\u4ecd\u4f1a\u88ab\u60a8\u6301\u7eed\u9501\u5b9a\uff0c\u5176\u4ed6\u4eba\u4e0d\u80fd\u7f16\u8f91\u8be5\u6570\u636e\u96c6\uff0c\u786e\u5b9a\u957f\u671f\u9501\u5b9a\u5417\uff1f");
h.setText(q);h.setConfirmedListener(function(A){A&&m()});h.show(B)}),B.appendTo(w)):(b="lock_by_other",k=k.replace("#1",a.getLockHolderName()));H=$("<span>");H.addClass("extreport-dataset-designer-lock-tips");H.text(k);H.appendTo(w);a=$("<span>");a.addClass("extreport-dataset-designer-lock-icon");V.getSpaceIcon().background(a,b);a.appendTo(w)}w.appendTo(E)},La=function(){V.getFacadeInstance(function(a){a&&a.isUserAcquiredLock?(a=e.get("lockedByExplicit","\u5df2\u88ab\u201c#1\u201d\u957f\u671f\u9501\u5b9a").replace("#1",
e.get("me","\u6211")),H.text(a),B.text(e.get("unlockExplicit","\u89e3\u9664\u957f\u671f\u9501\u5b9a")),y.setLockType(K.EXPLICIT_LOCK)):p.getMessageCurtain().showPrompt(e.get("acquireLockExplicitFail","\u957f\u671f\u9501\u5b9a\u5931\u8d25\u3002"))}).acquireLock(v,!0,Q)},Ka=function(){V.getFacadeInstance(function(a){a=e.get("lockedByOther","\u5df2\u88ab\u201c#1\u201d\u9501\u5b9a").replace("#1",e.get("me","\u6211"));H.text(a);B.text(e.get("acquireLockExplicit","\u6539\u4e3a\u957f\u671f\u9501\u5b9a"));
y.setLockType(K.IMPLICIT_LOCK)}).releaseLock(v,!0,Q)},Ea=function(){L=qa.createTabQueryPane(O,p);L.setEnableButtonFunCallBack(Ma);N=new ra(p);x=new sa;x.addTab(L,!0);x.addTab(N);x.addTabChangedListener(Na);var a=x.getJqUi();a.addClass("extreport-dataset-designer-tab");a.appendTo(E);p.addWindowResizeListener(function(){var b=x.getCurrentTabPane();b&&b.resize()})},Na=function(a,b){b.fireTabChangeEvent()},Fa=function(){var a=new ta;a.setCallbackImmediately(function(){na();p.fireWindowResizeEvent()});
a.setDelay(100);a.observe()},na=function(){document.body.style.height=document.documentElement.clientHeight+"px"},Ca=function(){p.createDesignerFacade(function(a){a=ca(a);var b=a.getDataSetModel();b&&(O=parseInt(b.getDataSetType()));Ga(a);da(a,!0);C&&p.getMessageCurtain().showPrompt(e.get("cantSavePreset","\u9884\u7f6e\u6570\u636e\u96c6\u4e0d\u5141\u8bb8\u4fdd\u5b58\uff0c\u5982\u6709\u9700\u8981\uff0c\u53ef\u590d\u5236\u540e\u518d\u8fdb\u884c\u64cd\u4f5c\u3002"),-1)},function(a,b){return 8077E3<a?
(p.getMessageCurtain().showPrompt(b,5E3),!0):!1}).loadModel(v,G,Q)},ca=function(a){var b=new ua;b.fromJsonObject(a);if(a=b.getDataSetModel())a.setPreset(C),a.setDataSetId(v),a.setDataSetName(P);return b},da=function(a,b){x.getCurrentTabPane().getJqUi().show();var k=!1;y&&y.getDataSetModel().isDirty()&&(k=!0);y=a;L.model2Ui(b);N.model2Ui();k&&!b?y.getDataSetModel().setDirty(!0,!0):y.getDataSetModel().setDirty(!1,!0)},va=function(a,b){a=ca(a);da(a,b)},Ma=function(a,b,k){X.setEnabled(C||Z?!1:a);fa.setEnabled(b);
ha.setEnabled(k)},Ha=function(){C?p.getMessageCurtain().showPrompt(e.get("cantSavePreset","\u9884\u7f6e\u6570\u636e\u96c6\u4e0d\u5141\u8bb8\u4fdd\u5b58\uff0c\u5982\u6709\u9700\u8981\uff0c\u53ef\u590d\u5236\u540e\u518d\u8fdb\u884c\u64cd\u4f5c\u3002"),-1):U(function(){var a=p.createDesignerFacade(function(k){va(k,!0);p.createDesignerFacade(function(h){var m=e.get("saveSuccess","\u4fdd\u5b58\u6210\u529f\u3002");h?p.getMessageCurtain().showPrompt(m+h,-1):p.getMessageCurtain().showSuccess(m)},function(){return!0}).checkSpaceCreatorPerm(v,
g.getDataSetModelVO().getDataSetModel().toJsonObject())},function(k,h){return 23771004==k?(k=e.get("datasetLockedByOther","\u5f53\u524d\u6570\u636e\u96c6\u5df2\u88ab\u201c#1\u201d\u9501\u5b9a\uff0c\u60a8\u7684\u4fee\u6539\u5c06\u65e0\u6cd5\u4fdd\u5b58\uff0c\u5efa\u8bae\u60a8\u9501\u5b9a\u5f53\u524d\u6570\u636e\u96c6\u540e\u518d\u8fdb\u884c\u7f16\u8f91\u3002").replace("#1",h),p.getMessageCurtain().showPrompt(k),!0):8077E3<k?(p.getMessageCurtain().showPrompt(h,5E3),!0):!1}),b=R(!0,t.SAVE_CHECK_TYPE);
b&&a.saveModel(v,Y,b,G)})},xa=function(a,b){var k=a==t.DATA_SOURCE,h=t.GENERIC_QUERY_CHECK_TYPE.includes(a)||a==t.GENERIC_CLIENT_FILTER_ERROR||a==t.GENERIC_CLIENT_ORDER_ERROR,m=a==t.DATA_CLIENT_JAVA_PARAM_ERROR,q=a==t.OUTPUT_COLUMN,A=a==t.PARAM;if(a==t.PARAM_CLIENT_ERROR||m)a=b;else if(h)a=b;else{var l;q&&(l=M(t.OUTPUT_COLUMN,wa.OUTPUT_COLUMNS_NAME_EXP));a=k?b:q?l?l.msg:e.get("showExecuteError","\u67e5\u8be2\u8bed\u53e5\u6267\u884c\u5931\u8d25\uff0c\u8bf7\u4fee\u6539\u67e5\u8be2\u8bed\u53e5\u3002"):
A?e.get("showParamError","\u53c2\u6570\u8bbe\u7f6e\u5b58\u5728\u9519\u8bef\uff0c\u8bf7\u68c0\u67e5\u53c2\u6570\u3002"):null}a&&p.getMessageCurtain().showPrompt(a,5E3);k||q||h||m?x.setCurrentTabPane(L):x.setCurrentTabPane(N)},R=function(a,b){var k=g.getDataSetModelVO().getDataSetModel(),h=k.isEmpty();if(h)return p.getMessageCurtain().showPrompt(h,5E3),null;if(a){var m;if(b)for(a=0;a<b.length&&!(m=M(b[a]));a++);else m=M();if(m)return xa(m.type,m.msg),null}return k.toJsonObject()},M=function(a,b){if(!a&&
!b){for(var k,h=0;h<t.CHECK_EXP_TYPE.length&&!(k=M(t.CHECK_EXP_TYPE[h]));h++);return k}h=g.getDataSetModelVO().getDataSetModel();if(k=h.getException(a,b))return{type:a,msg:k};var m=h.getParameters();if(m)for(h=0;h<m.length;h++)if(k=m[h].getException(a,b))return{type:a,msg:k}},Ia=function(){var a=function(){var k=p.createDesignerFacade(function(m){Y=m;m=f.getUrlParamValue();var q=c.decodeParamFromUrl(location.search,"path");q=c.appendParamToUrl((q?q:"/ierp")+"/qing_rpt/dataSetPreview.do","cacheId",
Y);q=c.appendParamToUrl(q,"dataSetId",v);q=c.appendParamToUrl(q,"dataSetName",P);q=c.appendParamToUrl(q,"isPreset",C);q=c.appendParamToUrl(q,"spaceCreatorId",ia);m&&(q=c.appendParamToUrl(q,"skin",m));D.openNewTab(P,q,q)},function(m,q){return 8077E3<m?(p.getMessageCurtain().showPrompt(q,5E3),!0):!1}),h=R(!0);h&&k.cacheModel(v,h)},b=function(){O===ea.JAVA_DATASET?p.fireEvent(W.Java_PARAM_AREA_REFRESH,{isPreview:!0,funCallback:function(){p.fireEvent(W.OUTPUT_AREA_REFRESH,{isPreview:!0,funCallback:a})}}):
p.fireEvent(W.OUTPUT_AREA_REFRESH,{isPreview:!0,funCallback:a})};O===ea.GENERIC_QUERY_DATASET?U(a):U(b)},U=function(a){var b=function(h){va(h);(h=M())?xa(h.type,h.msg):a?a():p.getMessageCurtain().showSuccess(e.get("checkSuccess","\u6821\u9a8c\u901a\u8fc7\u3002"))},k=function(h,m){return 8077E3<h?(p.getMessageCurtain().showPrompt(m,5E3),!0):!1};setTimeout(function(){var h=p.createDesignerFacade(b,k),m=R(!0,t.CLIENT_CHECK_TYPE);m&&h.checkModel(v,m)},0)},Ja=function(){!C&&y.getDataSetModel().isDirty()?
n.showConfirmExitDialog():D.closeCurrentTab()}};var f,c,d,n,e,z,D,ta,S,ka,oa,sa,pa,la,ma,ja,qa,ra,ua,t,wa,ea,T,K,W,V,J,I;(function(){var g=com.kingdee.bos.qing;f=g.SkinUtil;g=com.kingdee.bos.qing.common;c=g.Util;d=g.EventListenerList;g=com.kingdee.bos.qing.integration;n=g.TabStatusHelper;g=com.kingdee.bos.qing.framework.common;e=g.MultilanguageManager.createPackageAccessor(com.kingdee.bos.extreport.datasetdesigner);z=g.WebPageInitializer;D=g.TabbedUiUtil;ta=g.WindowResizeObserver;g=com.kingdee.bos.qing.behavior;
S=g.BehaviorManager;g=com.kingdee.bos.qing.ui.component;ka=g.MessageCurtain;oa=g.Toolbar;sa=g.TabContainer;pa=g.SimpleConfirmer;g=com.kingdee.bos.extreport.datasetdesigner;ra=g.TabParamCtrlPane;g=com.kingdee.bos.extreport.datasetdesigner.common;la=g.RemoteImpl;ma=g.UserOperationReporter;ja=g.EventListenerMap;W=g.EventType;J=g.FacadeType;I=g.FacadeFactory;g=com.kingdee.bos.extreport.datasetdesigner.common.query;qa=g.TabQueryPaneFactory;g=com.kingdee.bos.extreport.datasetdesigner.model;ua=g.DataSetModelVO;
t=g.DataSetModelCheckType;wa=g.DataSetModelCheckCode;ea=g.DataSetType;g=com.kingdee.bos.qing.collaboration.model;T=g.SpaceType;K=g.LockType;g=com.kingdee.bos.qing.collaboration.common;V=g.SpaceHelper})()})();
//qingVersionTag: 20250324