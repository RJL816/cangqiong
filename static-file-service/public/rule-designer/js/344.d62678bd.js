(self.webpackChunkrule_designer=self.webpackChunkrule_designer||[]).push([[344,820,400],{32344:function(e,t,n){"use strict";n.r(t),n.d(t,{RuleDesigner:function(){return Xa}});var r={};n.r(r),n.d(r,{CustomInput:function(){return Gr},Switch:function(){return qr}});var a={};n.r(a),n.d(a,{CustomInput:function(){return Kr}});var l={};n.r(l),n.d(l,{CustomInput:function(){return Hr}});var i={};n.r(i),n.d(i,{CustomInput:function(){return Jr}});var c={};n.r(c),n.d(c,{CustomInput:function(){return Xr}});var o={};n.r(o),n.d(o,{CustomInput:function(){return $r}});var u={};n.r(u),n.d(u,{CustomInput:function(){return na}});var d={};n.r(d),n.d(d,{CustomInput:function(){return Da}});var s={};n.r(s),n.d(s,{CustomInput:function(){return Ba}});var f={};n.r(f),n.d(f,{CustomInput:function(){return Ga}});n(19600);var m=n(39448),p=n.n(m),g=n(18860),v=n.n(g),y=n(55748),h=n.n(y),C=n(7312),A=n.n(C),E=n(54120),b=n.n(E),k=n(63808),N=n.n(k),I=n(45040),R=n.n(I),x=n(30112),T=n(72048),S=n(47976),w=n.n(S),L=n(81744),P=n.n(L),F=n(43400),M=n.n(F),D=n(18040),B=n.n(D),U=n(54116),V=n(2664),z=n(81043),j=n(45076),O=n.n(j),q=n(98752),G=M().createContext({});G.displayName="DesignerContext";var K=M().createContext({});K.displayName="FlowViewContext";var W=function(e){var t=e.prefixCls,n="".concat(t,"-target-handle");return M().createElement("div",{className:n})},Q={position:"absolute",cursor:"auto",background:"#999",width:"1px",height:"1px",border:"none",boderRadius:"0",left:0},H={position:"absolute",cursor:"auto",background:"#999",width:"1px",height:"1px",border:"none",boderRadius:"0",left:"-8px"},J={position:"absolute",cursor:"auto",background:"#999",width:"1px",height:"1px",border:"none",boderRadius:"0",right:0},X={cursor:"auto",background:"#999",width:"1px",height:"5px",border:"none",boderRadius:"0"},Y={cursor:"auto",background:"#999",width:"1px",height:"1px",border:"none",boderRadius:"0"},Z=(0,D.ErrorBoundaryWrap)((function(e){var t,n,r=e.data,a=(e.id,(0,F.useContext)(G)),l=a.getPrefixCls,i=a.prefixCls,c=l&&l(i,"controls-rule-node");return M().createElement("div",{className:c,style:{width:null===(t=r.size)||void 0===t?void 0:t.width,height:null===(n=r.size)||void 0===n?void 0:n.height}},M().createElement(q._2,{type:"source",position:q.JC.Right,id:"b",style:J}))}),"flow-rule-node"),_=function(e){var t=(0,F.useContext)(K).canClick,n=(0,(0,F.useContext)(G).getKdesignerApi)().selection.setSelect;return(0,F.useCallback)((function(r){t&&(r.stopPropagation(),n([e]))}),[])},$=n(82600),ee=n.n($),te=function(e){var t=(0,F.useState)(!1),n=(0,T.c)(t,2),r=n[0],a=n[1],l=(0,F.useContext)(G).getKdesignerApi,i=(0,F.useMemo)((function(){return l()}),[]).selection,c=(0,F.useCallback)((function(t){var n=t.value,r=null==n?void 0:ee()(n).call(n,e);a(r)}),[e]);return(0,F.useEffect)((function(){var t=i.getSelection(),n=null==t?void 0:ee()(t).call(t,e);a(n);var r=i.addSelectChangeListener(c);return function(){r()}}),[]),r},ne=n(71252),re=n.n(ne),ae=(0,D.ErrorBoundaryWrap)((function(e){var t,n,r=e.data,a=e.id,l=r.PreDescription,i=(0,F.useContext)(G),c=i.getPrefixCls,o=i.prefixCls,u=c&&c(o,"controls-condition-node"),d=te(a),s=_(a);return M().createElement("div",{className:re()(u,{"node-selection":d}),style:{width:null===(t=r.size)||void 0===t?void 0:t.width,height:null===(n=r.size)||void 0===n?void 0:n.height},onClick:s},M().createElement(q._2,{type:"target",position:q.JC.Left,id:"a",style:H},M().createElement(W,{prefixCls:o})),M().createElement(q._2,{type:"source",position:q.JC.Right,id:"b",style:J}),M().createElement("div",{className:"".concat(u,"-label")},l))}),"flow-condition-node"),le=n(34984),ie=n(12388),ce=n.n(ie),oe=n(47332),ue=n.n(oe),de="ConditionNode",se="RuleNode",fe="JudgeNode",me="EndNode",pe="TrueNode",ge="FalseNode",ve="ActionNode",ye="RetNode",he="AddNode";function Ce(e){return e.Type===de}function Ae(e){return e.__Type__===ve}function Ee(e){return e.Type===pe}function be(e){return e.Type===ge}var ke=function(e,t){var n=["CardRowPanelAp","CardEntryRowAp","ListGridViewAp","ReportListAp"];return ee()(n).call(n,e)&&"formmeta"===t?"ClientRules":"Rules"},Ne=function(e){var t=["CardEntryRowAp","ListGridViewAp","CardRowPanelAp"];return!ee()(t).call(t,e)},Ie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!1;return ce()(t)?n=null==t?void 0:ee()(t).call(t,e):"[object Object]"===Object.prototype.toString.call(t)&&(n="lock"===(null==t?void 0:t[e])),n},Re=function(e,t,n){for(var r=e.Categories,a=0;a<r.length;a++){var l,i,c=ue()(l=r[a].ElementTypes).call(l,(function(e){return e.Id===t}));if(c)return ue()(i=c.Properties).call(i,(function(e){return e.PropertyName===n}))}},xe=["data","id"],Te=(0,D.ErrorBoundaryWrap)((function(e){var t,n,r=e.data,a=(e.id,(0,le.c)(e,xe),(0,F.useContext)(G)),l=a.getPrefixCls,i=a.prefixCls,c=a.getRulesNodes,o=a.activeRuleNodeId,u=l&&l(i,"controls-judge-node"),d=function(e,t){if(!e)return!0;var n=!0;return null==e||A()(e).call(e,(function(e){t!==e.Id||Ne(e._Type_)||(n=!1)})),n}(c(),o);return M().createElement("div",{className:u,style:{width:null===(t=r.size)||void 0===t?void 0:t.width,height:null===(n=r.size)||void 0===n?void 0:n.height}},M().createElement(q._2,{type:"target",position:q.JC.Left,id:"a",style:H},M().createElement(W,{prefixCls:i})),d&&M().createElement(q._2,{type:"source",position:q.JC.Bottom,id:"FalseNode",style:X}),M().createElement(q._2,{type:"source",position:q.JC.Right,id:"TrueNode",style:J}),M().createElement("div",{className:"".concat(u,"-label"),title:(0,D.getLangMsg)("ruled.judgeNode.key0001")},(0,D.getLangMsg)("ruled.judgeNode.key0001")),M().createElement("svg",{width:"100%",height:"100%",version:"1.1",xmlns:"http://www.w3.org/2000/svg",style:{overflow:"unset"}},M().createElement("polygon",{points:"0,18 31,0 62,18 31,36",style:{fill:"#fafafa",stroke:"#999",strokeWidth:1}})))}),"flow-judge-node"),Se=function(e){var t,n,r=e.data,a=e.id,l=e.label,i=(0,F.useRef)(null),c=(0,F.useContext)(G),o=c.getPrefixCls,u=c.prefixCls,d=o&&o(u,"controls-tf-node"),s=te(a),f=_(a);return M().createElement("div",{className:re()(d,{"node-selection":s}),ref:i,style:{width:null===(t=r.size)||void 0===t?void 0:t.width,height:null===(n=r.size)||void 0===n?void 0:n.height},onClick:f},M().createElement(q._2,{type:"target",position:q.JC.Left,id:"a",style:Q}),M().createElement(q._2,{type:"source",position:q.JC.Right,id:"b",style:J}),M().createElement("div",{className:"".concat(d,"-label"),title:l},l))},we=function(e){return function(t){var n="true"===e?(0,D.getLangMsg)("ruled.tfNode.key0001"):"false"===e?(0,D.getLangMsg)("ruled.tfNode.key0002"):null;return M().createElement(Se,(0,V.c)({},t,{label:n}))}},Le=(0,D.ErrorBoundaryWrap)(we("true"),"flow-tf-node"),Pe=(0,D.ErrorBoundaryWrap)(we("false"),"flow-tf-node"),Fe=n(67928),Me=n.n(Fe),De=null,Be=null,Ue="front",Ve=Ue,ze=function(e,t,n){var r=(0,F.useContext)(G),a=r.getKdesignerApi,l=(r.getPrefixCls,r.prefixCls,r.getRulesNodes,r.activeRuleNodeId,(0,Fe.throttle)((function(t){t.preventDefault(),function(e){Be=e}(e);var n=t.target.getBoundingClientRect();Ve=t.clientX<=n.x+n.width/2?Ue:"back"}),200));return{onDragStart:function(n){!function(e){De=e}(e),t&&t(n)},onDragOver:function(e){e.preventDefault(),e.persist(),l(e)},onDrop:function(e){var t,r;e.preventDefault(),r=Be,(t=De)&&r&&r!==t&&a().data.customUpdateState((0,D.createCustomUpdateAction)((function(e){var n=e.Items,a=ue()(n).call(n,(function(e){return e.Id===t})),l=ue()(n).call(n,(function(e){return e.Id===r})),i=ue()(n).call(n,(function(e){return e.ParentId===r})),c=null==i?void 0:i.Id,o=l.ParentId,u=ue()(n).call(n,(function(e){return e.ParentId===t})),d=a.ParentId;if(Ve===Ue){if(o===t)return;u.ParentId=d,l.ParentId=t,a.ParentId=o,a.NodeType=l.NodeType}else{if(c===t)return;u.ParentId=d,a.ParentId=r,a.NodeType=l.NodeType,i.ParentId=t}}))),n&&n(e)},draggable:!0}},je=n(75984),Oe=n.n(je),qe=n(11984),Ge=n.n(qe),Ke=n(54895),We=n(77284),Qe=n(89280),He=n(43840),Je=n(3460),Xe=n(27688),Ye=n(88836),Ze=n.n(Ye),_e=n(59312),$e=n.n(_e),et=n(83789),tt=n(12640),nt=n.n(tt),rt=n(89843),at=n.n(rt),lt=n(97440),it=n.n(lt),ct=n(64248),ot=n.n(ct),ut=n(58496);var dt=function(e,t,n,r){var a,l=e[0],i=l.entity,c=l.treeMap,o=(null==i||null===(a=i[t])||void 0===a?void 0:a[n])||"";return"object"===(0,ut.c)(o)&&r&&(o=o[r]),o?[c[o]]:[]},st=function(e){var t=[],n=function e(t,n){var r=t.children;null!=r&&r.length&&(n.push.apply(n,(0,z.c)(r)),A()(r).call(r,(function(t){return e(t,n)})))};return A()(e).call(e,(function(e){t.push(e),n(e,t)})),t},ft=function(e){var t=(0,Fe.cloneDeep)(e);return ce()(t)?t:t?[t]:[]},mt=["type","id","nodeType","ret","description","actionType","parentId"];function pt(e,t,n){return t=(0,We.c)(t),(0,Ke.c)(e,gt()?Ge()(t,n||[],(0,We.c)(e).constructor):t.apply(e,n))}function gt(){try{var e=!Boolean.prototype.valueOf.call(Ge()(Boolean,[],(function(){})))}catch(e){}return(gt=function(){return!!e})()}var vt=function(e){var t,n={FieldChanged:(0,D.getLangMsg)("ruled.meta.key0012"),ItemAdded:(0,D.getLangMsg)("ruled.meta.key0013"),Initialized:(0,D.getLangMsg)("ruled.meta.key0014")};return Oe()(t=e.checked).call(t,(function(t){return{Name:n[t]||t,Value:t,Locked:!e["support".concat(t)]}}))},yt=function(e){return new(Ze())([["FormulaAction",(0,D.getLangMsg)("ruled.meta.key0015")],["TakeBaseProAction",(0,D.getLangMsg)("ruled.meta.key0016")],["SetEqutionAction",(0,D.getLangMsg)("ruled.meta.key0017")],["ClearValueAction",(0,D.getLangMsg)("ruled.meta.key0018")],["FillQtyAction",(0,D.getLangMsg)("ruled.meta.key0019")],["LockFieldAction",(0,D.getLangMsg)("ruled.meta.key0020")],["UnlockFieldAction",(0,D.getLangMsg)("ruled.meta.key0020")],["ShowFieldAction",(0,D.getLangMsg)("ruled.meta.key0020")],["HideFieldAction",(0,D.getLangMsg)("ruled.meta.key0020")],["LockControlAction",(0,D.getLangMsg)("ruled.meta.key0021")],["UnlockControlAction",(0,D.getLangMsg)("ruled.meta.key0021")],["ShowControlAction",(0,D.getLangMsg)("ruled.meta.key0021")],["HideControlAction",(0,D.getLangMsg)("ruled.meta.key0021")],["ClientLockFieldAction",(0,D.getLangMsg)("ruled.meta.key0020")],["ClientUnlockFieldAction",(0,D.getLangMsg)("ruled.meta.key0020")],["ClientShowFieldAction",(0,D.getLangMsg)("ruled.meta.key0020")],["ClientHideFieldAction",(0,D.getLangMsg)("ruled.meta.key0020")],["ClientLockControlAction",(0,D.getLangMsg)("ruled.meta.key0021")],["ClientUnlockControlAction",(0,D.getLangMsg)("ruled.meta.key0021")],["ClientShowControlAction",(0,D.getLangMsg)("ruled.meta.key0021")],["ClientHideControlAction",(0,D.getLangMsg)("ruled.meta.key0021")],["ClientSetFieldfmtAction",(0,D.getLangMsg)("ruled.meta.key0022")],["ClientSetFieldAction",(0,D.getLangMsg)("ruled.meta.key0023")],["ClientSetControlAction",(0,D.getLangMsg)("ruled.meta.key0024")]]).get(e)||(0,D.getLangMsg)("ruled.meta.key0025")},ht=function(e,t){var n=e.id,r=[{Id:"RET",Name:(0,D.getLangMsg)("ruled.meta.key0026"),Editor:{Type:"MultiSelect",Enum:vt(e),Required:!0},Visible:!0,Locked:t},{Id:"Description",Name:(0,D.getLangMsg)("ruled.meta.key0027"),Editor:{Type:"Input",DataType:"String"},Visible:!0,Locked:t},"SetEqutionAction"===n?{Id:"OnlyEmptyRow",Name:(0,D.getLangMsg)("ruled.meta.key0028"),Editor:{Type:"Switch"},Visible:!0,Locked:t}:null,{Id:"Value",Name:yt(n),Editor:{Type:"CustomInput",Required:!0},Locked:t}];return v()(r).call(r,Boolean)},Ct=function(e,t,n){var r,a=st(ft(t)),l=null===(r=ue()(a).call(a,(function(e){return e.data===n})))||void 0===r?void 0:r.serviceType;return v()(e).call(e,(function(e){var t=e.serviceTypes;return void 0===l||t===l}))},At=function(e,t,n,r,a){var l=new($e()),i=t[0],c=i.serviceType,o=i.rulesTree,u=i.lockRules,d=Ct(c,o,n),s=Ie(a,u),f=Oe()(d).call(d,(function(e){var t=e.metaClass,n=e.title,r=e.tips,a=e.checked;return l.add(t),{Id:t,Name:n,Icon:"Icon",Tips:r,Properties:[{Id:"Property",Name:n,DefaultCollapse:!1,Nodes:ht(e,s)}],Accept:[],IsContainer:!0,CheckedRet:a}})),m=function(e){return{Categories:[{Id:"ActionNode",Name:(0,D.getLangMsg)("ruled.meta.key0001"),Controls:[{Id:"RuleRoot",Name:(0,D.getLangMsg)("ruled.meta.key0002"),Icon:"Icon",Properties:[],Accept:[],IsContainer:!0,Visible:!1},{Id:"RuleNode",Name:(0,D.getLangMsg)("ruled.meta.key0002"),Icon:"Icon",Properties:[{Id:"Property",Name:(0,D.getLangMsg)("ruled.meta.key0003"),DefaultCollapse:!1,Nodes:[{Id:"Description",Name:(0,D.getLangMsg)("ruled.meta.key0004"),Editor:{Type:"Input",DataType:"String",Required:!0},Visible:!0},{Id:"Enabled",Name:(0,D.getLangMsg)("ruled.meta.key0005"),Editor:{Type:"Switch",DataType:"Boolean",Required:!0},Visible:!0}]}],Accept:[],IsContainer:!0},{Id:"ConditionNode",Name:(0,D.getLangMsg)("ruled.meta.key0006"),Icon:"Icon",Properties:[{Id:"Property",Name:(0,D.getLangMsg)("ruled.meta.key0006"),DefaultCollapse:!1,Nodes:[{Id:"PreDescription",Name:(0,D.getLangMsg)("ruled.meta.key0007"),Editor:{Type:"Input",DataType:"String",Required:!0},Visible:!0,Locked:e},{Id:"PreCondition",Name:(0,D.getLangMsg)("ruled.meta.key0008"),Editor:{Type:"CustomInput",DataType:"String",Required:!0},Visible:!0,Locked:e}]}],Accept:[],IsContainer:!0},{Id:"JudgeNode",Name:(0,D.getLangMsg)("ruled.meta.key0009"),Icon:"Icon",Properties:[],Accept:[],IsContainer:!0},{Id:"TrueNode",Name:(0,D.getLangMsg)("ruled.meta.key0010"),Icon:"Icon",Properties:[],Accept:["ActionNode"],IsContainer:!0},{Id:"FalseNode",Name:(0,D.getLangMsg)("ruled.meta.key0011"),Icon:"Icon",Properties:[],Accept:["ActionNode"],IsContainer:!0},{Id:"EndNode",Name:(0,D.getLangMsg)("ruled.meta.key0011"),Icon:"Icon",Properties:[],Accept:["ActionNode"],IsContainer:!0}]}]}}(s);return(0,et.cp)(m,(function(e){for(var t=(0,T.c)(e.Categories,1)[0].Controls,n=t.length-1;n>t.length-4;n--)t[n].Accept=(0,z.c)(l);t.push.apply(t,(0,z.c)(Oe()(f).call(f,(function(e){return e.Accept=(0,z.c)(l),e}))))}))},Et=function(){function e(t){var n=t.type,r=t.id,a=t.parentId;(0,Je.c)(this,e),(0,x.c)(this,et.qg,!0),(0,x.c)(this,"Type","RuleNode"),(0,x.c)(this,"Id","node"),(0,x.c)(this,"ParentId",""),this.Type=n,this.Id=r,this.ParentId=a}return(0,Xe.c)(e,[{key:"getValue",value:function(){throw new Error("sub class must realize self getValue")}}]),e}(),bt=function(e){function t(e){var n,r=e.type,a=void 0===r?"RuleNode":r,l=e.id,i=e.description,c=e.enabled,o=e.parentId,u=e.relationContainerNodeId;return(0,Je.c)(this,t),n=pt(this,t,[{type:a,id:l,parentId:o,relationContainerNodeId:u}]),(0,x.c)((0,Qe.c)(n),"Description",""),(0,x.c)((0,Qe.c)(n),"Enabled",!0),(0,x.c)((0,Qe.c)(n),"RelationContainerNodeId",""),n.Description=i,n.Enabled=c,n.RelationContainerNodeId=u,n}return(0,He.c)(t,e),(0,Xe.c)(t,[{key:"getValue",value:function(){return t.getValue.call(this)}}],[{key:"getValue",value:function(){return{Id:this.Id,Description:this.Description,Enabled:this.Enabled}}}]),t}(Et),kt=function(e){function t(e){var n,r=e.type,a=void 0===r?"ConditionNode":r,l=e.id,i=e.preDescription,c=e.preCondition,o=e.parentId;return(0,Je.c)(this,t),n=pt(this,t,[{type:a,id:l,parentId:o}]),(0,x.c)((0,Qe.c)(n),"PreDescription",""),(0,x.c)((0,Qe.c)(n),"PreCondition",""),n.PreDescription=i,n.PreCondition=c,n}return(0,He.c)(t,e),(0,Xe.c)(t,[{key:"getValue",value:function(){return t.getValue.call(this)}}],[{key:"getValue",value:function(){return{PreCondition:this.PreCondition||"",PreDescription:this.PreDescription||""}}}]),t}(Et),Nt=function(e){function t(e){var n=e.type,r=void 0===n?fe:n,a=e.id,l=e.parentId;return(0,Je.c)(this,t),pt(this,t,[{type:r,id:a,parentId:l}])}return(0,He.c)(t,e),(0,Xe.c)(t)}(Et),It=function(e){function t(e){var n,r=e.type,a=void 0===r?ye:r,l=e.id,i=e.parentId,c=e.ret,o=void 0===c?"":c;return(0,Je.c)(this,t),(n=pt(this,t,[{type:a,id:l,parentId:i}])).RET=o,n}return(0,He.c)(t,e),(0,Xe.c)(t)}(Et),Rt=function(e){function t(e){var n=e.type,r=void 0===n?pe:n,a=e.id,l=e.parentId;return(0,Je.c)(this,t),pt(this,t,[{type:r,id:a,parentId:l}])}return(0,He.c)(t,e),(0,Xe.c)(t)}(Et),xt=function(e){function t(e){var n=e.type,r=void 0===n?ge:n,a=e.id,l=e.parentId;return(0,Je.c)(this,t),pt(this,t,[{type:r,id:a,parentId:l}])}return(0,He.c)(t,e),(0,Xe.c)(t)}(Et),Tt=function(e){function t(e){var n=e.type,r=void 0===n?he:n,a=e.id,l=e.parentId;return(0,Je.c)(this,t),pt(this,t,[{type:r,id:a,parentId:l}])}return(0,He.c)(t,e),(0,Xe.c)(t)}(Et),St=function(e){function t(e){var n=e.type,r=void 0===n?me:n,a=e.id,l=e.parentId;return(0,Je.c)(this,t),pt(this,t,[{type:r,id:a,parentId:l}])}return(0,He.c)(t,e),(0,Xe.c)(t)}(Et),wt="true",Lt="false",Pt=function(e){function t(e){var n,r,a=e.type,l=void 0===a?"ActionNode":a,i=e.id,c=e.nodeType,o=e.ret,u=e.description,d=e.actionType,s=e.parentId,f=(0,le.c)(e,mt);return(0,Je.c)(this,t),r=pt(this,t,[{type:l,id:i,parentId:s}]),(0,x.c)((0,Qe.c)(r),"NodeType","true"),(0,x.c)((0,Qe.c)(r),"ActionType",""),(0,x.c)((0,Qe.c)(r),"Description",""),(0,x.c)((0,Qe.c)(r),"__Type__","ActionNode"),(0,x.c)((0,Qe.c)(r),"RET",""),(0,x.c)((0,Qe.c)(r),"_Type_",""),r.NodeType=c,r.ActionType=d,r.Description=u,r.RET=o,r._Type_=r.Type,A()(n=w()(f)).call(n,(function(e){r[e]=f[e]})),r}return(0,He.c)(t,e),(0,Xe.c)(t)}(Et),Ft=function(e){var t=e.data,n=e.close,r=e.onClick,a=e.panelRef,l=e.prefixCls,i=(0,F.useCallback)((function(e,t){e.stopPropagation(),r&&r(t),n&&n()}),[n,r]);return M().createElement("div",{className:l+"-list",ref:a},t&&(null==t?void 0:Oe()(t).call(t,(function(e,t){return M().createElement("div",{key:t,className:l+"-list-item",title:e.title,onClick:function(t){return i(t,e)}},e.title)}))))},Mt=function(e){var t=e.onClick,n=e.className,r=(0,F.useState)(!1),a=(0,T.c)(r,2),l=a[0],i=a[1],c=(0,F.useRef)(null),o=(0,F.useContext)(G),u=o.ruleMetaInfo,d=o.activeRuleNodeId,s=o.getPrefixCls,f=o.prefixCls,m=(null==u?void 0:u[0])||{},p=m.serviceType,g=m.rulesTree;if(!p)return null;p=Ct(p,g,d);var v=s&&s(f,"add-icon"),y=(0,F.useCallback)((function(){i(!0)}),[]),h=(0,F.useCallback)((function(e){t(e)}),[]),C=(0,F.useCallback)((function(){i(!1)}),[]);return(0,D.useOnClickOutside)([c],(function(){C()})),M().createElement("div",{className:re()(v,n)},M().createElement(U.Icon,{prefix:"designericon",type:"tianjiakapian",onClick:y}),l&&M().createElement(Ft,{data:p,onClose:C,onClick:h,panelRef:c,prefixCls:v}))},Dt=(0,D.ErrorBoundaryWrap)((function(e){var t,n,r=e.data,a=e.id,l=r.Description,i=r.ParentId,c=r.Id,o=(0,F.useContext)(G),u=o.getPrefixCls,d=o.prefixCls,s=o.getKdesignerApi,f=o.isLockRule,m=(0,F.useMemo)((function(){return s()}),[]),p=m.data,g=m.selection,v=f(),y=u&&u(d,"controls-action-node"),h=v?{}:ze(a,void 0,void 0),C=te(a),A=_(a),E=function(e,t){var n=e||{},r=n.id,a=n.title,l=n.checked,o=(0,D.createUUid)(),u={Type:"TakeBaseProAction"===r?null==e?void 0:e.metaClass:r,Name:a,ParentId:"pre"===t?i:c,Id:o,RET:ce()(l)?l.join(","):l};p.addControl((0,D.createAddAction)(u)).then((function(){g.setSelect([o])}))},b=C&&!v,k=v?H:C?Q:H;return M().createElement("div",{className:y},b&&M().createElement(Mt,{className:"".concat(y,"-pre-add"),onClick:function(e){return E(e,"pre")}}),M().createElement("div",(0,V.c)({className:re()("".concat(y,"-node"),{"node-selection":C}),style:{width:null===(t=r.size)||void 0===t?void 0:t.width,height:null===(n=r.size)||void 0===n?void 0:n.height},onMouseDown:A},h),M().createElement(q._2,{type:"target",position:q.JC.Left,id:"a",style:k},!b&&M().createElement(W,{prefixCls:d})),M().createElement(q._2,{type:"source",position:q.JC.Right,id:"b",style:J}),M().createElement("div",{className:"".concat(y,"-label")},l)),b&&M().createElement(Mt,{className:"".concat(y,"-next-add"),onClick:function(e){return E(e,"next")}}))}),"flow-action-node"),Bt=(0,D.ErrorBoundaryWrap)((function(e){var t,n,r=e.data,a=(e.id,(0,F.useContext)(G)),l=a.getPrefixCls,i=a.prefixCls,c=l&&l(i,"controls-end-node");return M().createElement("div",{className:c,style:{width:null===(t=r.size)||void 0===t?void 0:t.width,height:null===(n=r.size)||void 0===n?void 0:n.height}},M().createElement(q._2,{type:"target",position:q.JC.Left,id:"a",style:H},M().createElement(W,{prefixCls:i})))}),"flow-end-node"),Ut=(0,D.ErrorBoundaryWrap)((function(e){var t,n,r=e.data,a=(0,F.useContext)(G),l=a.getPrefixCls,i=a.prefixCls,c=a.getKdesignerApi;if((0,a.isLockRule)())return null;var o=(0,F.useMemo)((function(){return c()}),[]),u=o.data,d=o.selection,s=l&&l(i,"controls-add-node"),f=r.ParentId;return M().createElement("div",{className:s,style:{width:null===(t=r.size)||void 0===t?void 0:t.width,height:null===(n=r.size)||void 0===n?void 0:n.height}},M().createElement(q._2,{type:"target",position:q.JC.Left,id:"addTarget",style:Q}),M().createElement(Mt,{onClick:function(e){var t=e||{},n=t.metaClass,r=t.title,a=t.checked,l=(0,D.createUUid)(),i={Type:"TakeBaseProAction"===n?null==e?void 0:e.metaClass:n,Name:r,ParentId:f,Id:l,Ret:ce()(a)?a.join(","):a};u.addControl((0,D.createAddAction)(i)).then((function(){d.setSelect([l])}))}}),M().createElement(q._2,{type:"source",position:q.JC.Right,id:"addSource",style:J}))}),"flow-action-node"),Vt=n(84912),zt=n.n(Vt),jt=n(39832),Ot=n.n(jt),qt=n(29636),Gt=n.n(qt),Kt=n(11872),Wt=n.n(Kt),Qt=["_Type_","ActionType","Description","RET"];function Ht(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}var Jt=function(e){return e[e.length-1].Id},Xt=function(e,t,n,r){var a={id:(0,D.createUUid)(),parentId:r},l=n===wt?new Rt(a):new xt(a);e.push(l),A()(t).call(t,(function(t,r){var a=t._Type_,l=t.ActionType,i=t.Description,c=t.RET,o=(0,le.c)(t,Qt),u=new Pt(function(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=Ht(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=Ht(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}({type:a,id:(0,D.createUUid)(),nodeType:n,actionType:l,description:i,ret:ce()(c)?c.join(","):c,parentId:Jt(e)},o));e.push(u)})),e.push(new St({id:(0,D.createUUid)(),parentId:Jt(e)}))},Yt=["Type","NodeType","ParentId"],Zt=function(e){var t=JSON.parse(Ot()(e));return A()(Yt).call(Yt,(function(e){delete t[e]})),"string"==typeof t.RET&&(t.RET=t.RET.split(",")),t},_t=function(e,t,n,r){var a=e[r].Items,l=(0,D.createUUid)(),i=O()(a).call(a,(function(e,t){var a=(0,T.c)(e,2),i=a[0],c=a[1];if(ee()(n).call(n,t.Id)){i.push(t);var o=ke(t._Type_,r),u=t[o],d=t.Id;(null==u?void 0:u.length)>0&&A()(u).call(u,(function(e){var n=e.Description,r=e.Enabled,a=void 0===r||r,i=e.Id,o=e.PreDescription,u=e.PreCondition,s=e.TrueActions,f=void 0===s?[]:s,m=e.FalseActions,p=void 0===m?[]:m,g=[],v=new bt({id:i,description:n,enabled:a,parentId:l,relationContainerNodeId:d});g.push(v);var y=(0,D.createUUid)(),h=new kt({id:y,preDescription:o,preCondition:u,parentId:Jt(g)});g.push(h);var C=new Nt({id:(0,D.createUUid)(),parentId:y});g.push(C);var A=Jt(g);Xt(g,f,wt,A),Ne(t._Type_)&&Xt(g,p,Lt,A),c.push.apply(c,g)}))}return e}),[[],[{Type:"RuleRoot",Id:l}]]),c=(0,T.c)(i,2);return[c[0],{Items:c[1]}]};function $t(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function en(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=$t(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=$t(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}var tn=function(e){var t=e.Type;return Ae(e)?ve:t},nn=function(e){var t,n={x:0,y:0},r=[],a=[];return A()(e).call(e,(function(e){var t,l=e.Id,i=e.Type,c=(e.Name,e.ParentId);(r.push({id:l,position:n,type:tn(e),data:en({},e)}),i!==se)&&a.push(en(en({id:P()(t="".concat(c,"-")).call(t,l),source:c,target:l,type:"step"},function(e){return Ee(e)?{sourceHandle:"TrueNode"}:be(e)?{sourceHandle:"FalseNode"}:{}}(e)),{},{style:{stroke:"#999"}}))})),P()(t=[]).call(t,r,a)},rn=function(e,t,n,r){var a,l={id:(0,D.createUUid)(),parentId:r},i=n===wt?new Rt(l):new xt(l);e.push(i),A()(a=v()(t).call(t,(function(e){return e.NodeType===n}))).call(a,(function(t,n){var r=t.ActionType,a=t.Description,l=t.RET,i=t.NodeType,c=new Pt({type:r,id:(0,D.createUUid)(),nodeType:i,actionType:r,description:a,ret:l,parentId:Jt(e)});e.push(c)})),e.push(new St({id:(0,D.createUUid)(),parentId:Jt(e)}))},an=function(e,t){var n,r=t.findControlByCondition((function(e){return e.Type===se})),a=Oe()(r).call(r,(function(e){return t.getAllSubControls(e.Id)}));if(!a.length)return[];var l=new(Ze());A()(a).call(a,(function(e){return t=e,r=ue()(t).call(t,(function(e){return Ce(e)})),a=new($e())(v()(n=Oe()(t).call(t,(function(e){return e.RET}))).call(n,(function(e){return!(0,Fe.isUndefined)(e)}))),A()(a).call(a,(function(e){var n=l.get(e)||[],a=[],i=en(en({},r),{},{Id:(0,D.createUUid)()}),c=new Nt({id:(0,D.createUUid)(),parentId:i.Id});a.push(i,c);var o=c.Id,u=v()(t).call(t,(function(t){return t.RET===e}));rn(a,u,wt,o),rn(a,u,Lt,o),n.push(a),l.set(e,n)})),l;var t,n,r,a}));var i=new($e())(v()(n=Oe()(e).call(e,(function(e){return e.RET}))).call(n,(function(e){return!(0,Fe.isUndefined)(e)}))),c=[],o=new bt({id:(0,D.createUUid)(),parentId:""});return c.push(o),A()(i).call(i,(function(e){var t=new It({id:(0,D.createUUid)(),parentId:o.Id,ret:e});c.push(t);var n=l.get(e)||[];A()(n).call(n,(function(e){e[0].ParentId=t.Id,c.push.apply(c,(0,z.c)(e))}))})),nn(c)},ln=function(e,t){if(t)return e;var n=[];return A()(e).call(e,(function(t,r){if(t.Type===me){var a=e[r-1];if(be(a)||Ee(a)){var l=(0,D.createUUid)();n.push(new Tt({id:l,parentId:a.Id}),en(en({},t),{},{ParentId:l}))}else n.push(t)}else n.push(t)})),n},cn=(0,D.ErrorBoundaryWrap)((function(e){var t,n,r=e.data,a=(e.id,r.RET),l=(0,F.useRef)(null),i=(0,F.useContext)(G),c=i.getPrefixCls,o=i.prefixCls,u=c&&c(o,"controls-condition-node");return M().createElement("div",{className:u,ref:l,style:{width:null===(t=r.size)||void 0===t?void 0:t.width,height:null===(n=r.size)||void 0===n?void 0:n.height}},M().createElement(q._2,{type:"target",position:q.JC.Left,id:"a",style:Y}),M().createElement(q._2,{type:"source",position:q.JC.Right,id:"b",style:J}),M().createElement("div",{className:"".concat(u,"-label")},a))}),"flow-ret-node");function on(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function un(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=on(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=on(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}function dn(e){switch(e.type){case se:case me:return{width:11,height:11};case ye:case de:return{width:117,height:sn(e,117)};case fe:return{width:62,height:36};case pe:case ge:return{width:70,height:24};case ve:return{width:146,height:sn(e,146)};case he:return{width:16,height:16};default:return{width:172,height:36}}}function sn(e,t){var n=e.type,r=e.data,a="";a=n===de?r.PreDescription||"":n===ye?r.RET||"":r.Description||"";var l=document.createElement("div");l.setAttribute("style","width: ".concat(t,"px; line-height: 18px;border: 1px solid transparent; word-break: break-word;padding: 8px 16px; max-width:320px; position:absolute; left:-9999px; top:0px; display:flex;min-height: 36px; font-weight: bold;font-size: 12px;")),document.body.appendChild(l),l.innerText=a;var i=l.getBoundingClientRect().height;return document.body.removeChild(l),i}var fn=function(e,t,n,r){if(e.type===se)return n.x;var a=ue()(t).call(t,(function(e){return e.id===r}));if(a){var l=a.position,i=a.data.size;return l.x+i.width+50}return n.x};function mn(){return{style:{background:"#ECEEF2"},panOnScroll:!0,zoomOnScroll:!1,preventScrolling:!1,nodesConnectable:!1,nodesDraggable:!1,panOnScrollMode:q.WY.Free,defaultZoom:1,minZoom:1/1.2/1.2,maxZoom:1.44,zoomOnDoubleClick:!1}}function pn(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function gn(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=pn(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=pn(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}var vn={RuleNode:Z,ConditionNode:ae,JudgeNode:Te,TrueNode:Le,FalseNode:Pe,EndNode:Bt,ActionNode:Dt,RetNode:cn},yn=function(e){var t=e.visible,n=(0,F.useState)([]),r=(0,T.c)(n,2),a=r[0],l=r[1],i=(0,F.useState)("LR"),c=(0,T.c)(i,1)[0],o=(0,F.useState)(!0),u=(0,T.c)(o,2),d=u[0],s=u[1],f=(0,F.useContext)(G),m=f.getKdesignerApi,p=f.getPrefixCls,g=f.prefixCls,v=(0,F.useMemo)((function(){return m()}),[]),y=v.data,h=(v.selection,p&&p(g,"all-rules-view-body")),C=(0,F.useRef)(),E=(0,F.useRef)([]),b=(0,F.useRef)(!1),k=function(e){var t,n,r=new(zt().graphlib.Graph);r.setDefaultEdgeLabel((function(){return{}})),r.setGraph({rankdir:e,nodesep:30,ranksep:50,marginx:100,align:"UL"}),A()(t=E.current).call(t,(function(e){(0,q.yW)(e)?(e.data.size=dn(e),r.setNode(e.id,gn(gn({},e.data.size),{},{shape:"rect"}))):r.setEdge(e.source,e.target)})),zt().layout(r);var a=Oe()(n=E.current).call(n,(function(e){if((0,q.yW)(e)){var t=r.node(e.id);e.targetPosition=q.JC.Left,e.sourcePosition=q.JC.Right,e.position={x:t.x-t.width/2,y:t.y+(36-t.height)/2}}return e}));l(a)},N=(0,F.useCallback)((function(e){var t=y.findControlByCondition((function(e){return e.Type===se})),n=O()(t).call(t,(function(e,t){return P()(e).call(e,y.getAllSubControls(t.Id))}),[]);E.current=an(n,y),b.current=!1,k(c)}),[c]);(0,F.useEffect)((function(){b.current=!0,k(c);var e=y.addDataChangeListener(N);return function(){e()}}),[c]),(0,F.useEffect)((function(){if(a.length>0){var e,t,n=null===(e=C.current.toObject())||void 0===e?void 0:e.zoom;null===(t=C.current)||void 0===t||t.fitView({minZoom:n,maxZoom:n})}}),[a]),(0,F.useEffect)((function(){if(t){b.current=!0;var e=y.findControlByCondition((function(e){return e.Type===se})),n=O()(e).call(e,(function(e,t){return P()(e).call(e,y.getAllSubControls(t.Id))}),[]);E.current=an(n,y),k(c)}}),[t]);var I=un(un({},mn()),{},{style:{background:"#fff"}}),R=(0,F.useMemo)((function(){return{canClick:!1}}),[]);return M().createElement(K.Provider,{value:R},M().createElement("div",{className:h},M().createElement(q.Mt,null,M().createElement(q.cp,(0,V.c)({elements:a,nodeTypes:vn,onLoad:function(e){b.current=!0,k("LR"),C.current=e},panOnScroll:d,onNodeMouseEnter:function(){s(!1)},onNodeMouseLeave:function(){s(!0)}},I)))))},hn=function(e){var t=e.visible,n=e.setVisible,r=(0,F.useContext)(G),a=r.getPrefixCls,l=r.prefixCls,i=a&&a(l,"all-rules-view");return M().createElement(U.Modal,{body:M().createElement(yn,{visible:t}),titleIcon:null,className:i,footer:null,maskClosable:!1,width:1074,height:520,title:(0,D.getLangMsg)("ruled.allRulesView.key0001"),closable:!0,destroyOnClose:!0,onCancel:function(){return n(!1)},onOk:function(){return n(!1)},mask:!0,visible:t})},Cn=(0,D.isMac)(),An="rule-designer-node-nav-tool",En=(0,D.ErrorBoundaryWrap)((function(){var e,t,n=(0,F.useContext)(G),r=n.getKdesignerApi,a=n.isLockRule,l=n.activeRuleId,i=(0,F.useState)(!1),c=(0,T.c)(i,2),o=c[0],u=c[1],d=(0,F.useState)(!0),s=(0,T.c)(d,2),f=s[0],m=s[1],p=r(),g=p.data,v=p.selection,y=a(l),h=(0,F.useRef)(y),C=g.canUndo(),A=g.canRedo(),E=(0,F.useCallback)((function(e){if(!h.current){var t=e.value;if(t!==e.oldValue&&1===t.length){var n=t[0],r=g.findControl(n);m(!Ae(r))}}}),[]);(0,F.useEffect)((function(){var e=v.addSelectChangeListener(E);return function(){e()}}),[]),(0,F.useEffect)((function(){h.current=y,y&&m(!0)}),[y]),(0,D.useDataChangeForceUpdateEffect)(p);var b=(0,F.useCallback)((function(e){var t=!1,n=!0;switch(e){case 1:t=!C,n=C;break;case 2:t=!A,n=A;break;case 3:t=f,n=!f;break;default:t=!1,n=!0}return{disable:t,command:n}}),[f,A,C]),k=(0,F.useCallback)((function(){b(2).disable||A&&g.redo()}),[A,b]),N=(0,F.useCallback)((function(){b(1).disable||C&&g.undo()}),[C,b]),I=(0,F.useCallback)((function(){if(!b(3).disable){var e=(0,v.getSelection)();if(1===e.length){var t=g.findControl(e[0]);g.deleteControl((0,D.createDeleteAction)(e)).then((function(){var e=t.ParentId;v.setSelect([e])}))}}}),[b]),R=(0,F.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=b(e),a=r.disable,l=r.command;return t?re()((0,x.c)((0,x.c)({},"".concat(An,"-buttonbox-operation-disable-icon"),a),"".concat(An,"-buttonbox-operation-btn-icon"),l)):n?re()((0,x.c)((0,x.c)((0,x.c)({},"".concat(An,"-buttonbox-operation-disable"),a),"".concat(An,"-buttonbox-last-operation"),!0),"".concat(An,"-buttonbox-operation-btn"),l)):re()((0,x.c)((0,x.c)({},"".concat(An,"-buttonbox-operation-disable"),a),"".concat(An,"-buttonbox-operation-btn"),l))}),[b]);return M().createElement("div",{className:An},M().createElement("div",{className:An+"-buttonbox"},M().createElement("div",{title:P()(e="".concat((0,D.getLangMsg)("ruled.navToolBar.key0001"),"\n")).call(e,Cn?"⌘+Z":"Ctrl+Z"),className:R(1),onClick:N},M().createElement(U.Icon,{prefix:"designericon",type:"chexiao",className:R(1,!0)})),M().createElement("div",{title:P()(t="".concat((0,D.getLangMsg)("ruled.navToolBar.key0002"),"\n")).call(t,Cn?"⌘+Y":"Ctrl+Y"),className:R(2,!1,!0),onClick:k},M().createElement(U.Icon,{prefix:"designericon",type:"zhongzuo",className:R(2,!0)}))),M().createElement("div",{className:An+"-buttonbox"},M().createElement("div",{title:"".concat((0,D.getLangMsg)("ruled.navToolBar.key0003"),"\nDelete"),onClick:I,className:R(3,!1,!0)},M().createElement(U.Icon,{prefix:"designericon",type:"shanchu",className:R(3,!0)}))),M().createElement(hn,{visible:o,setVisible:u}))}),"ed-nav-toolbar"),bn=function(){var e=(0,F.useContext)(D.ConfigContext),t=(e.getPrefixCls,e.prefixCls,(0,F.useContext)(G)),n=t.getPrefixCls,r=t.prefixCls,a=n&&n(r),l="".concat(a,"-top-view-main"),i=M().createElement("div",{className:l},M().createElement(En,null));return M().createElement(D.ViewHeader,{content:i,portalId:l})};var kn=function(e,t){var n=(0,F.useContext)(G),r=n.getKdesignerApi,a=n.isLockRule,l=n.activeRuleId,i=(0,F.useMemo)((function(){return r()}),[]),c=i.data;(0,F.useEffect)((function(){if(!a(l)){var t=e.current;if(t){var n=function(e){if(e.target===t)switch(e.stopPropagation(),e.keyCode){case D.keyCode.DELETE:!function(e,t){var n=e.data,r=e.selection,a=(0,r.getSelection)();if(1===a.length){var l=n.findControl(a[0]);if(!Ae(l))return;n.deleteControl((0,D.createDeleteAction)(a)).then((function(){var e=l.ParentId;r.setSelect([e])}))}}(i);break;case D.keyCode.Z:var n=c.canUndo();(0,D.isCtrlActive)(e)&&n&&c.undo();break;case D.keyCode.Y:var r=c.canRedo();(0,D.isCtrlActive)(e)&&r&&c.redo()}};return t.addEventListener("keydown",n),function(){t.removeEventListener("keydown",n)}}}}),[l])};function Nn(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function In(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=Nn(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=Nn(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}var Rn={RuleNode:Z,ConditionNode:ae,JudgeNode:Te,TrueNode:Le,FalseNode:Pe,EndNode:Bt,ActionNode:Dt,AddNode:Ut},xn=function(e){var t=e.prefixCls;return M().createElement("div",{className:"".concat(t,"-empty")},M().createElement("img",{src:"data:image/png;base64,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",alt:(0,D.getLangMsg)("ruled.mainView.key0001"),width:"168",height:"96"}),M().createElement("p",null,(0,D.getLangMsg)("ruled.mainView.key0002")),M().createElement("p",null,(0,D.getLangMsg)("ruled.mainView.key0003")))},Tn=(0,F.memo)((function(e){var t=(0,F.useContext)(G),n=t.getKdesignerApi,r=t.getPrefixCls,a=t.prefixCls,l=t.activeRuleId,i=t.activeRuleNodeId,c=t.isLockRule,o=n(),u=o.data,d=o.selection,s=c(),f=(0,F.useState)([]),m=(0,T.c)(f,2),p=m[0],g=m[1],y=(0,F.useState)(!1),h=(0,T.c)(y,2),C=h[0],E=h[1],b=r&&r(a,"flow-view"),k=(0,F.useRef)({x:0,y:0,zoom:1}),N=(0,F.useRef)(),I=(0,F.useRef)(null),R=(0,F.useRef)([]),x=(0,F.useRef)(""),S=(0,F.useRef)(null),w=(0,F.useCallback)((function(){if(i){var e=u.findControlByCondition((function(e){return e.RelationContainerNodeId===i}));E(!e.length)}}),[i]),L=(0,F.useCallback)((function(e){var t=U(l),n=ln(t,s);R.current=nn(n),w(),j()}),[l,w]),B=(0,F.useCallback)((function(e){var t=e.value[0];if(x.current&&x.current===t){var n,r=document.querySelector('[data-id="'.concat(x.current,'"]')),a=((null==r?void 0:r.getBoundingClientRect())||{}).right,l=void 0===a?0:a,i=((null===(n=S.current)||void 0===n?void 0:n.getBoundingClientRect())||{}).right,c=void 0===i?0:i;if(l>c){var o,d=k.current,s=d.x,f=d.y,m=d.zoom,p=c-l-30*m,g=u.getSubControls(t)[0];if(g.Type===me){var v=g.Id,y=document.querySelector('[data-id="'.concat(v,'"]')),h=((null==y?void 0:y.getBoundingClientRect())||{}).right;p=c-(void 0===h?0:h)}null===(o=N.current)||void 0===o||o.setTransform({x:s+p,y:f,zoom:m},100)}x.current=""}}),[]),U=(0,F.useCallback)((function(e){if(!e)return[];if(!u.findControl(e))return[];var t=u.getAllSubControls(e);return(0,z.c)(t)}),[]),j=function(e){var t,n,r=new(zt().graphlib.Graph);r.setDefaultEdgeLabel((function(){return{}})),r.setGraph({rankdir:"LR",nodesep:30,ranksep:50,align:"DL"}),A()(t=R.current).call(t,(function(e){(0,q.yW)(e)?(e.data.size=dn(e),r.setNode(e.id,In(In({},e.data.size),{},{shape:"rect"}))):r.setEdge(e.source,e.target)})),zt().layout(r);var a=O()(n=R.current).call(n,(function(e,t){if((0,q.yW)(t)){var n=t.data.ParentId,a=r.node(t.id);t.targetPosition=q.JC.Left,t.sourcePosition=q.JC.Right,t.position={x:fn(t,e,a,n),y:a.y+(36-a.height)/2}}return P()(e).call(e,t)}),[]);if(g(a),e){var l,i=function(e){var t,n=v()(t=Oe()(e).call(e,(function(e){if((0,q.yW)(e)){var t=e.position,n=t.x;return t.y,n}return null}))).call(t,Boolean);return Math.max.apply(Math,(0,z.c)(n))}(a),c=null===(l=I.current)||void 0===l?void 0:l.setCenter;null==c||c(Math.round(i/2),100,1)}};(0,F.useEffect)((function(){var e=u.addDataChangeListener(L),t=d.addSelectChangeListener(B);return function(){e(),t()}}),[L,B]);var W=(0,F.useCallback)((function(e){x.current=e}),[]);(0,F.useEffect)((function(){w()}),[i]),(0,F.useEffect)((function(){return D.eventBus.on("add-control-id",W),function(){D.eventBus.off("add-control-id",W)}}),[]),(0,F.useEffect)((function(){var e=U(l),t=ln(e,s);R.current=nn(t),j(!0)}),[l]),kn(S);var Q=mn(),H=(0,F.useMemo)((function(){return{canClick:!0}}),[]);return M().createElement(K.Provider,{value:H},M().createElement(bn,null),M().createElement(q.Mt,null,M().createElement(q.cp,(0,V.c)({elements:C?[]:p,nodeTypes:Rn,onLoad:function(e){N.current=e},onClick:function(e){e.persist()},ref:S,tabIndex:-1,onMove:function(e){k.current=e}},Q),M().createElement(Sn,{ref:I}),C&&M().createElement(xn,{prefixCls:b}))))})),Sn=(0,F.forwardRef)((function(e,t){var n=(0,q._s)();return(0,F.useImperativeHandle)(t,(function(){return n})),M().createElement("div",null)}));Tn.displayName="MainView",Sn.displayName="Operation";var wn=Tn,Ln=n(13760),Pn=n.n(Ln),Fn=n(52360),Mn=n.n(Fn),Dn=["prefixCls","node","removeRule","editRule","setRule","onSelect","selectId","editId","curSelectRuleTree","isDaggble"],Bn="ruleEnable",Un="ruleDelete",Vn="ruleEdit";function zn(e){e.prefixCls;var t=e.node,n=e.removeRule,r=e.editRule,a=e.setRule,l=e.onSelect,i=e.selectId,c=e.editId,o=e.curSelectRuleTree,u=e.isDaggble,d=(0,le.c)(e,Dn),s=(0,(0,F.useContext)(G).isLockRule)(null==t?void 0:t.Id),f=(0,F.useState)(""),m=(0,T.c)(f,2),p=m[0],g=m[1],v=(0,F.useState)(t.Description||t.PreDescriptions),y=(0,T.c)(v,2),h=y[0],C=y[1],A=(0,F.useRef)(null),E=(0,F.useCallback)((function(e){var t;C(Mn()(t=e.target.value).call(t))}),[]),b=function(e){var n,a=null===(n=e.target)||void 0===n||null===(n=n.value)||void 0===n?void 0:Mn()(n).call(n);g(""),r(t,a||(0,D.getLangMsg)("ruled.ruleListItem.key0008"))},k=(0,F.useCallback)((function(){var e=M().createElement(M().Fragment,null,M().createElement("img",{src:"data:image/png;base64,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"}),M().createElement("span",{style:{textAlign:"center",marginTop:12}},(0,D.getLangMsg)("ruled.ruleListItem.key0009")),M().createElement("span",{style:{textAlign:"center",marginTop:5}},(0,D.getLangMsg)("ruled.ruleListItem.key0010")));U.Modal.confirm({title:(0,D.getLangMsg)("ruled.ruleListItem.key0002"),cancelText:(0,D.getLangMsg)("ruled.ruleListItem.key0003"),okText:(0,D.getLangMsg)("ruled.ruleListItem.key0004"),body:e,bodyStyle:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},footerStyle:{alignItems:"start"},onOk:function(){n&&n(t)}})}),[t]),N=(0,F.useCallback)((function(){a&&a(t)}),[t]);(0,F.useEffect)((function(){c===t.Id&&g(Vn)}),[c]),(0,F.useEffect)((function(){if(p===Vn){var e=A.current;if(!e)return;e.focus(),e.select()}}),[p]),(0,F.useEffect)((function(){C(t.Description||t.PreDescription)}),[t.Description,t.PreDescription]);var I,R,S=M().createElement(U.Dropdown.Menu,{onClick:function(e){switch(e){case Bn:N();break;case"ruleCopy":break;case Un:k()}}},M().createElement(U.Dropdown.Item,{className:"leftrule-li-dropdowm-item",key:Bn,disabled:(I=o,R=["CardEntryRowAp","ListGridViewAp"],ee()(R).call(R,null==I?void 0:I.type))},M().createElement(M().Fragment,null,(0,D.getLangMsg)("ruled.ruleListItem.key0005"),t.Enabled&&M().createElement(U.Icon,{prefix:"designericon",type:"shuzhankaibeifen",className:"leftrule-li-dropdowm-item-right"}))),M().createElement(U.Dropdown.Item,{className:"leftrule-li-dropdowm-item",key:Un},M().createElement("span",null,(0,D.getLangMsg)("ruled.ruleListItem.key0004"))));return M().createElement("div",(0,V.c)({draggable:p!==Vn&&u,className:re()((0,x.c)({"leftrule-li":!0,selected:i===t.Id},p,!0)),onClick:function(e){var n;(!e.target||null!==(n=e.currentTarget)&&void 0!==n&&n.contains(e.target))&&i!==t.Id&&l&&l(t)}},d),!s&&M().createElement(U.Icon,{prefix:"designericon",type:"tuozhuailiebiao",className:"leftrule-li-text-dragIcon"}),M().createElement("div",{className:"leftrule-li-text",id:"drag",title:s||i!==t.Id?"":(0,D.getLangMsg)("ruled.ruleListItem.key0006"),onDoubleClick:function(e){var n;s||e.target&&(null===(n=e.currentTarget)||void 0===n||!n.contains(e.target))||i===t.Id&&g(Vn)}},p!==Vn||s?M().createElement(M().Fragment,null,t.Description||t.PreDescription):M().createElement("input",{ref:A,onChange:E,onKeyUp:function(e){13===e.keyCode&&b(e)},onBlur:b,value:h,placeholder:(0,D.getLangMsg)("ruled.ruleListItem.key0007")}),M().createElement("div",{className:re()("leftrule-li-status",{disabled:s})},t.Enabled&&M().createElement(U.Icon,{prefix:"designericon",type:"shuzhankaibeifen",className:"leftrule-li-status-right"}),!s&&M().createElement(U.Dropdown,{placement:"bottomRight",popperClassName:"leftrule-li-dropdowm",scrollHidden:!0,trigger:"click",menu:S,onClick:function(e){return e.stopPropagation()}},M().createElement("span",{className:"leftrule-li-status-btn"},"···")))))}var jn=(0,F.memo)(zn);function On(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function qn(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=On(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=On(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}function Gn(e){var t=e.prefixCls,n=e.data,r=e.removeRule,a=e.setRule,l=e.editRule,i=e.onSelect,c=e.selectId,o=e.editId,u=e.curSelectRuleTree,d=(0,F.useContext)(G),s=d.getKdesignerApi,f=d.isDragRule,m=d.ruleMetaInfo,p=(0,F.useMemo)((function(){return s()}),[]).data,g=(m[0]||{}).lockRules,v=(0,F.useRef)(null),y=(0,F.useRef)(null),h=function(e,t,n,r){var a;if(r&&(v.current=qn(qn({},t),{},{dragControlIndex:n}),e.dataTransfer.setDragImage)){var l=(a=t.Description||t.PreDescription,y.current=document.createElement("div"),y.current.classList.add("leftrule-li-dragelement"),y.current.innerHTML=a,document.body.appendChild(y.current),y.current);e.dataTransfer.setDragImage(l,140,16)}},C=(0,Fe.throttle)((function(e,t){e.preventDefault()}),100),A=function(e,t){e&&e.querySelector("#drag").classList.remove(t?"drag-hover-up":"drag-hover-dowm")},E=function(e,t){return!g||(ce()(g)?n=ee()(g).call(g,e)===ee()(g).call(g,t):"[object Object]"===Object.prototype.toString.call(g)&&(n=g[e]===g[t]),n);var n},b=function(){document.body.removeChild(y.current),v.current=null};return(null==n?void 0:n.length)>0?M().createElement("div",{className:"leftrule-ul",onDragOver:function(e){return e.preventDefault()}},n&&Oe()(n).call(n,(function(e,d){var s,m,g=f(e.Id,null===(s=n[d-1])||void 0===s?void 0:s.Id,null===(m=n[d+1])||void 0===m?void 0:m.Id);return M().createElement(jn,{prefixCls:t,node:e,key:e.Id,removeRule:r,setRule:a,editRule:l,onSelect:i,selectId:c,editId:o,isDaggble:g,curSelectRuleTree:u,onDrop:function(t){return function(e,t,n){e.preventDefault();var r=v.current||{},a=r.Id,l=r.dragControlIndex;if(!(0,Fe.isUndefined)(l)&&!(0,Fe.isUndefined)(a)&&a!==t.Id&&E(t.Id,a)){var i=n<l;A(e.currentTarget,i),p.insertControl((0,D.createInsertAction)({originId:a,targetId:t.Id,isPre:i})),v.current=null}}(t,e,d)},onDragStart:function(t){return h(t,e,d,g)},onDragEnter:function(t){return function(e,t,n){var r=v.current||{},a=r.dragControlIndex,l=r.Id;if(!(0,Fe.isUndefined)(a)&&!(0,Fe.isUndefined)(l)&&n!==a&&E(t.Id,l)){var i=n<a;!function(e,t){e&&e.querySelector("#drag").classList.add(t?"drag-hover-up":"drag-hover-dowm")}(e.currentTarget,i)}}(t,e,d)},onDragOver:function(e){return C(e,d)},onDragLeave:function(e){return function(e,t){var n=(v.current||{}).dragControlIndex;if(!(0,Fe.isUndefined)(n)&&t!==n){var r=t<n;A(e.currentTarget,r)}}(e,d)},onDragEnd:b})}))):null}var Kn=(0,F.memo)(Gn),Wn=["children","visible","setVisible","prefixCls"],Qn="rule-designer_addRuleTooltipVisible",Hn=(0,F.memo)((function(e){var t=e.children,n=e.visible,r=e.setVisible,a=e.prefixCls,l=(0,le.c)(e,Wn);(0,F.useEffect)((function(){D.eventBus.on("onViewCollapseChange",(function(e){var t=e.position,n=e.hide;"left"===t&&n&&r(!1)}))}),[]);var i=!1,c=window.localStorage.getItem(Qn),o=(0,F.useCallback)((function(){i&&window.localStorage.setItem(Qn,"false"),r(!1)}),[i]),u=(0,F.useMemo)((function(){return M().createElement(M().Fragment,null,M().createElement("span",{className:"".concat(a,"-bar-tooltip-text")},(0,D.getLangMsg)("ruled.ruleContent.key0001")),M().createElement("div",{className:"".concat(a,"-bar-tooltip-footer")},M().createElement(U.Checkbox,{className:"".concat(a,"-bar-tooltip-footer-checkbox"),onChange:function(){i=!0}},(0,D.getLangMsg)("ruled.ruleContent.key0005")),M().createElement(U.Button,{type:"ghost",className:"".concat(a,"-bar-tooltip-footer-btn"),onClick:o},(0,D.getLangMsg)("ruled.ruleContent.key0002"))))}),[o]);return"false"!==c&&n?M().createElement(U.Tooltip,(0,V.c)({visible:n,popperClassName:"".concat(a,"-bar-tooltip"),tip:u},l),t):t}));var Jn=function(e){var t=e.prefixCls,n=e.data,r=e.addRule,a=e.canAddRules,l=e.removeRule,i=e.editRule,c=e.setRule,o=e.ruleSelect,u=e.selectId,d=e.editId,s=e.allRuleList,f=e.curSelectRuleTree,m=(0,F.useState)(0===s.length&&!u),p=(0,T.c)(m,2),g=p[0],v=p[1];(0,F.useEffect)((function(){v(0===s.length&&!u)}),[s,u]);var y=(0,F.useCallback)((function(){f&&a&&(v(!1),r((0,D.getLangMsg)("ruled.ruleListItem.key0008")))}),[r,a]);return M().createElement(M().Fragment,null,M().createElement("div",{className:"".concat(t,"-bar")},M().createElement("span",{className:"".concat(t,"-bar-title")},(0,D.getLangMsg)("ruled.ruleContent.key0003")),a?M().createElement(Hn,{prefixCls:t,placement:"rightTop",defaultVisible:g,visible:g,setVisible:v,arrow:!0},M().createElement("div",{className:"".concat(t,"-bar-handle"),onClick:y},M().createElement(U.Icon,{prefix:"designericon",type:"tianjia3",style:{fontSize:12}}),M().createElement("span",null,(0,D.getLangMsg)("ruled.ruleContent.key0004")))):M().createElement("div",{className:re()("".concat(t,"-bar-handle"),{disabled:!a}),onClick:y},M().createElement(U.Icon,{prefix:"designericon",type:"tianjia3",style:{fontSize:12}}),M().createElement("span",null,(0,D.getLangMsg)("ruled.ruleContent.key0004")))),M().createElement(Kn,{curSelectRuleTree:f,prefixCls:t,editId:d,data:n,removeRule:l,setRule:c,selectId:u,editRule:i,onSelect:o}))};var Xn=function(e){var t=e.data,n=e.selectid,r=e.ruleList,a=e.onSelect,l=(0,F.useState)([]),i=(0,T.c)(l,2),c=i[0],o=i[1],u=(0,F.useState)([n]),d=(0,T.c)(u,2),s=d[0],f=d[1],m=(0,F.useState)(t),p=(0,T.c)(m,2),g=p[0],v=p[1];(0,F.useEffect)((function(){(0,Fe.isEqual)(t,g)||v(t)}),[t]);var y=(0,F.useCallback)((function(e,t){f(e),a&&a(e,r,t)}),[r]),h=(0,F.useCallback)((function(e){o(e)}),[]);return(0,F.useEffect)((function(){f([n])}),[n]),M().createElement("div",{className:"ruleTree",style:{display:"flex",flexDirection:"column"}},M().createElement(U.Tree,{name:"ruleTree",treeData:g,defaultExpandAll:!0,virtual:!1,expandedKeys:c,selectedKeys:s,onExpand:h,onSelect:y,classsName:"ruleTree",showIcon:!0}))};n(13128);function Yn(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zn(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=Yn(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=Yn(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}function _n(e,t){var n=[];if(e)for(var r=function(){var r,l,i,c=e[a],o=ke(null==c?void 0:c.type,t);c[o]&&ce()(c[o])&&(n=P()(n).call(n,null===(i=c[o])||void 0===i?void 0:Oe()(i).call(i,(function(e){return Zn(Zn({},e),{},{parentId:c.Id})}))));c.title=P()(r="".concat(c.title,"(")).call(r,(null===(l=c[o])||void 0===l?void 0:l.length)||0,")");var u=_n(e[a].children,t);n=P()(n).call(n,u.list)},a=0;a<e.length;a++)r();return{list:n}}var $n=["EntryAp","CardEntryAp"],er=function e(t,n,r){return A()(t).call(t,(function(t){var a=ue()(n).call(n,(function(e){return e.Id===t.data}));if(t.disabled=!a,t.title=t.text,a){t.Id=a.Id,t.key=a.Id,t.title=a.Name||t.text,t.parentid=a.ParentId,"formmeta"===r&&ee()($n).call($n,a._Type_)&&!a.EntryId&&(t.icon=M().createElement(tr,null),t.disabled=!0,t.showIcon=!0);var l=ke(a._Type_,r);t[l]=ce()(a[l])?a[l]:[]}t.children&&(t.children=e(t.children,n,r))})),t};function tr(){return M().createElement(U.Tooltip,{placement:"right",tip:(0,D.getLangMsg)("ruled.leftPanel.key0001")},M().createElement(U.Icon,{style:{zIndex:1},prefix:"designericon",type:"bangdingfenlushiti"}))}function nr(e){var t=e.setActiveRuleNodeId,n=e.getPrefixCls,r=e.prefixCls,a=e.getKdesignerApi,l=e.ruleMetaInfo,i=e.getRulesNodes,c=e.activeRuleId,o=e.setActiveRuleId,u=e.getRulesLocked,d=a(),s=d.data,f=d.selection,m=n&&n(r,"leftrule"),p=(null==l?void 0:l[0])||{},g=p.metaType,y=p.rulesTree,h=p.showRule,C=(0,F.useState)([]),A=(0,T.c)(C,2),E=A[0],b=A[1],k=(0,F.useState)(),N=(0,T.c)(k,2),I=N[0],R=N[1],x=(0,F.useState)(),S=(0,T.c)(x,2),w=S[0],L=S[1],P=(0,F.useState)([]),B=(0,T.c)(P,2),U=B[0],V=B[1],z=(0,F.useState)(!1),j=(0,T.c)(z,2),O=j[0],q=j[1],G=(0,F.useRef)([]),K=(0,F.useRef)(I),W=(0,F.useRef)();(0,F.useEffect)((function(){K.current=I}),[I]),(0,F.useEffect)((function(){var e,n,r,a,l=i(),c=er(ft(y),l,g),d={},s="";null!=h&&h.entityId?(d=ce()(c)?ue()(c).call(c,(function(e){return e.Id===h.entityId})):{},s=h.entityId):(d=ce()(c)?c[0]:{},s=null!==(r=d)&&void 0!==r&&r.disabled?"":null===(a=d)||void 0===a?void 0:a.Id);if(s){W.current=d,R(s),t(s);var f=!u(s);q(f)}var m=null===(e=_n(c,g))||void 0===e?void 0:e.list;G.current=m,m=v()(m).call(m,(function(e){return e.parentId===s})),b(c),V(m);var p=(null===(n=m)||void 0===n?void 0:n.length)>0?m[0].Id:"";H((null==h?void 0:h.ruleId)||p),o((null==h?void 0:h.ruleId)||p)}),[]),(0,F.useEffect)((function(){var e=s.addDataChangeListener((function(){Pn()((function(){Q()}))}));return function(){e()}}),[]);var Q=function(){var e=i(),t=er(ft(y),e,g),n=_n(t,g).list;G.current=n,n=v()(n).call(n,(function(e){return e.parentId===K.current})),b(t),V(n)},H=function(e){var t=s.getData().Items,n=ue()(t).call(t,(function(t){return"ConditionNode"===t.Type&&t.ParentId===e}));n?f.setSelect([n.Id]):f.setSelect(e?[e]:[])},J=(0,F.useCallback)((function(e){var t=s.getData().Items,n=ue()(t).call(t,(function(e){return"RuleRoot"===e.Type}));if(n){var r,a=Ne(null===(r=W.current)||void 0===r?void 0:r.type);(function(e,t,n,r,a){var l=(0,D.createUUid)(),i=new bt({id:l,description:e,parentId:t,enabled:!0,relationContainerNodeId:n}),c=(0,D.createUUid)(),o=new kt({id:c,parentId:l,preDescription:(0,D.getLangMsg)("ruled.leftPanelApi.key0001")}),u=(0,D.createUUid)(),d=new Nt({id:u,parentId:c}),s=(0,D.createUUid)(),f=new Rt({id:s,parentId:u}),m=(0,D.createUUid)(),p=new xt({id:m,parentId:u}),g=(0,D.createUUid)(),v=new St({id:g,parentId:s}),y=(0,D.createUUid)(),h=new St({id:y,parentId:m}),C=a?[i,o,d,f,v,p,h]:[i,o,d,f,v];return r((0,D.createAddAction)(Oe()(C).call(C,(function(e){return JSON.parse(Ot()(e))}))))})(e,n.Id,I,s.addControl,a).then((function(e){var t;null!==(t=e[0])&&void 0!==t&&null!==(t=t.value[0])&&void 0!==t&&t.Id&&(H(e[0].value[0].Id),o(e[0].value[0].Id),L(e[0].value[0].Id))}))}}),[e,W]),X=(0,F.useCallback)((function(e,t){var n,r;n=e.Id,r=t,(0,s.batchUpdateControlPropertyValues)((0,D.createUpdateAction)([[n,{Description:r}]]))}),[e]),Y=(0,F.useCallback)((function(e){var t,n;t=e.Id,n=!e.Enabled,(0,s.batchUpdateControlPropertyValues)((0,D.createUpdateAction)([[t,{Enabled:n}]]))}),[e]),Z=(0,F.useCallback)((function(e){var t,n;f.setSelect([]),(t=e.Id,n=s.deleteControl,n((0,D.createDeleteAction)([t]))).then((function(e){}))}),[e,U]),_=(0,F.useCallback)((function(e,n,r){var a;R(e[0]),t(e[0]),L(""),W.current=null==r?void 0:r.node;var l=v()(a=G.current).call(a,(function(t){return t.parentId===e[0]})),i=l&&l.length>0?l[0].Id:"";H(i),o(i),V(l);var c=!u(e[0]);q(c)}),[G.current]),$=(0,F.useCallback)((function(e){H(e.Id),o(e.Id)}),[e]);return M().createElement("div",{className:m},M().createElement("div",{className:"".concat(m,"-panel")},M().createElement(Xn,{data:E,ruleList:U,selectid:I,onSelect:_})),M().createElement("div",{className:"".concat(m,"-panel")},M().createElement(Jn,{prefixCls:m,data:U,selectId:c,editId:w,addRule:J,canAddRules:O,editRule:X,setRule:Y,removeRule:Z,ruleSelect:$,ruleTreeSelectId:I,allRuleList:G.current,curSelectRuleTree:W.current})))}function rr(){return M().createElement(G.Consumer,null,(function(e){return M().createElement(nr,e)}))}rr.tabKey="leftTree",rr.tabName="";var ar=rr,lr="rule-designer",ir=function(e){var t=e.children,n="rule-designer-right-view";return M().createElement(M().Fragment,null,M().createElement("div",{className:"".concat(n,"-property-bar")},M().createElement("span",{className:"".concat(n,"-bar-title"),title:(0,D.getLangMsg)("ruled.rightPanel.key0001")},(0,D.getLangMsg)("ruled.rightPanel.key0001"))),t)},cr=function(e){var t=e.text;return M().createElement("div",{className:"".concat(lr,"-empty-node")},t)},or=function(e){var t=(0,F.useContext)(G),n=t.getKdesignerApi,r=t.activeRuleNodeId,a=t.isLockRule,l=n().data,i=a(),c=(0,F.useState)((function(){var e=l.findControlByCondition((function(e){return e.RelationContainerNodeId===r}));return!(null!=e&&e.length)})),o=(0,T.c)(c,2),u=o[0],d=o[1],s=(0,F.useCallback)((function(){if(r){var e=l.findControlByCondition((function(e){return e.RelationContainerNodeId===r}));d(!e.length)}}),[r]);(0,F.useEffect)((function(){var e=l.addDataChangeListener(s);return function(){e()}}),[s]),(0,F.useEffect)((function(){s()}),[r]);var f=M().createElement("div",{className:"".concat(lr,"-control-view")},i?M().createElement(cr,{text:(0,D.getLangMsg)("ruled.rightPanel.key0002")}):u?M().createElement(cr,{text:(0,D.getLangMsg)("ruled.rightPanel.key0003")}):M().createElement(D.ControlView,e)),m=M().createElement(ir,null,M().createElement("div",{className:"".concat(lr,"-property-view")},u?M().createElement(cr,{text:(0,D.getLangMsg)("ruled.rightPanel.key0004")}):M().createElement(D.PropertyView,e)));return M().createElement(U.SplitPanel,{mode:"vertical",defaultSplit:"280",firstSlot:f,secondSlot:m,canFold:!1})};or.tabKey="Services",or.tabName="";var ur=or,dr={FormulaAction:"jisuanziduan3",TakeBasePropertyAction:"xiedaijichuziliaoshuxing",SetEqutionAction:"xiedaiziduan",ClearValueAction:"qingchuziduan2",FillQtyAction:"shulianghuansuan",LockFieldAction:"suodingziduan",UnlockFieldAction:"jiesuoziduan",ShowFieldAction:"xianshiziduan",HideFieldAction:"yincangziduan",LockControlAction:"suodingkongjian3",UnlockControlAction:"jiesuokongjian3",ShowControlAction:"xianshikongjian3",HideControlAction:"yincangkongjian3",ClientLockFieldAction:"suodingziduan",ClientUnlockFieldAction:"jiesuoziduan",ClientShowFieldAction:"xianshiziduan",ClientHideFieldAction:"yincangziduan",ClientLockControlAction:"suodingkongjian3",ClientUnlockControlAction:"jiesuokongjian3",ClientShowControlAction:"xianshikongjian3",ClientHideControlAction:"yincangkongjian3",ClientSetFieldfmtAction:"ziduanxianshiyangshi",ClientSetFieldAction:"ziduanshuxing",ClientSetControlAction:"kongjianshuxing",ClientSetRowFmtAction:"shezhixingyangshi"};function sr(e){return dr[e]||"zidingyifuwu"}var fr=["type","value"],mr=function(e,t,n){e.globalConfig;var r,a=e.dataContext,l=(e.selectionContext,e.action),i=(e.dataFactory,e.modelFactory,e.metaReader),c=(l.type,l.value),o=((0,le.c)(l,fr),[l]);if(ce()(c))return o;var u,d=c.Type,s=c.ParentId,f=c.Id,m=c.Name,p=c.Ret,g=[],v=i.getControlMeta(d);if(!ee()(r=[se,de,fe,pe,ge,me]).call(r,d)){var y,h=v.CheckedRet,C=a.findControl(s),A=a.findControlIndex(s)+1,E=C.NodeType,b={type:d,actionType:"TakeBasePropertyAction"===d?"TakeBaseProAction":d,description:m,parentId:s,id:f,nodeType:(u=C,Ee(u)||be(u)?Ee(C)?wt:Lt:E),ret:p||(h||[]).join(",")},k=a.getSubControls(s),N=Oe()(k).call(k,(function(e){var t=e.Id;return(0,D.createUpdateAction)([[t,{ParentId:f}]])}));return D.eventBus.emit("add-control-id",f),g.push.apply(g,P()(y=[(0,D.createAddAction)(JSON.parse(Ot()(new Pt(b))),{index:A})]).call(y,(0,z.c)(N))),g}return o},pr=["type","value"],gr=function(e,t,n){e.globalConfig;var r,a=e.dataContext,l=(e.selectionContext,e.action),i=(e.dataFactory,e.modelFactory,e.metaReader,l.type,l.value),c=((0,le.c)(l,pr),a.findControl(i[0])),o=c.Type,u=c.ParentId,d=c.Id,s=[];if(!ee()(r=[se,de,fe,pe,ge,me]).call(r,o)){var f=a.getSubControls(d),m=Oe()(f).call(f,(function(e){var t=e.Id;return(0,D.createUpdateAction)([[t,{ParentId:u}]])}));return s.push.apply(s,(0,z.c)(m)),P()(s).call(s,[l])}var p=[l];return P()(p).call(p,s)},vr=(0,x.c)((0,x.c)({},D.ActionType.ADD,mr),D.ActionType.DELETE,gr),yr=function(e,t){var n=e.action,r=e.dataContext,a=e.selectionContext,l=e.globalConfig,i=e.dataFactory,c=e.modelFactory,o=e.metaReader,u=e.success,d=e.fail,s=(l.dataRef,l.keywordMapping,[]),f=n.type,m=vr[f];if(m){var p=m({globalConfig:l,dataContext:r,selectionContext:a,action:n,dataFactory:i,modelFactory:c,metaReader:o},u(s),d);p&&s.push.apply(s,(0,z.c)(p))}else s.push(n);s.length&&u(s)},hr=n(30479),Cr=n.n(hr),Ar=n(65624),Er=n.n(Ar),br=function(e){var t=e.visible,n=e.triggerRef,r=e.setVisible,a=e.children,l=e.onCancel,i=e.onConfirm,c=(0,F.useRef)(null),o=(0,F.useContext)(G),u=o.getPrefixCls,d=o.prefixCls,s=u&&u(d,"fields-add-panel");return(0,D.useOnClickOutside)([c,n],(function(e){var n,a,l=document.getElementById("dialogShow"),i=nt()(Array.prototype).call(document.querySelectorAll(".rule-designer-tree-select-popper")),c=nt()(Array.prototype).call(document.querySelectorAll(".rule-designer-select-popper")),o=nt()(Array.prototype).call(document.querySelectorAll(".rule-designer-tooltip-popper")),u=null===(n=P()(a=[]).call(a,(0,z.c)(i),(0,z.c)(c),(0,z.c)(o)))||void 0===n?void 0:Er()(n).call(n,(function(t){return null==t?void 0:t.contains(e.target)}));l&&null!=l&&l.contains(e.target)||u||t&&r(!1)})),t?M().createElement("div",{className:s,ref:c},M().createElement("div",{className:"".concat(s,"-body")},a),M().createElement("footer",{className:"".concat(s,"-footer")},M().createElement(U.Button,{onClick:l,type:"second",className:"".concat(s,"-cancel-btn"),style:{marginRight:"12px"}},(0,D.getLangMsg)("ruled.fieldsAddPanel.key0001")),M().createElement(U.Button,{className:"".concat(s,"-modal-ok-btn"),type:"primary",onClick:i},(0,D.getLangMsg)("ruled.fieldsAddPanel.key0002")))):null},kr=function(e){var t=e.prefixCls,n=e.label,r=e.children;return M().createElement("div",{className:"".concat(t,"-fields-item-wrap")},M().createElement("div",{className:"".concat(t,"-fields-item-label")},n),r)},Nr=n(39568),Ir=n.n(Nr),Rr="data:image/png;base64,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";function xr(e,t){var n=void 0!==it()&&ot()(e)||e["@@iterator"];if(!n){if(ce()(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return Tr(e,t);var r=nt()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return at()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Tr(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,l=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw l}}}}function Tr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Sr(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function wr(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=Sr(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=Sr(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}var Lr=function(e){return e},Pr=function e(t,n){var r,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return v()(r=Oe()(t).call(t,(function(t){var r=t.id,l=t.children,i=t.text,c=l?{children:e(l,n,a)}:{children:[]};return wr(wr(wr({},t),{},{key:r,title:n?i:i.replace(/(\S+)\(\S+\)/g,"$1")},c),{},{checkable:a,selectable:!l&&!a})}))).call(r,Boolean)},Fr=function(e){var t=[],n=function e(t,n){var r=t.key,a=t.children;n.push(r),a&&A()(a).call(a,(function(t){return e(t,n)}))};return A()(e).call(e,(function(e){n(e,t)})),t},Mr=function e(t,n){var r,a=xr(t);try{for(a.s();!(r=a.n()).done;){var l=r.value,i=l.key,c=l.children;if(n===i)return!0;if(c&&c.length){var o=e(c,n);if(o)return o}}}catch(e){a.e(e)}finally{a.f()}return!1},Dr=function(e,t){var n;if(""===t)return e;var r=function e(t,n){return v()(t).call(t,(function(t){var r;if(-1!==Ir()(r=t.text||"").call(r,n)&&(!t.children||0===t.children.length))return!0;var a=t.children&&e(t.children,n);return(null==a?void 0:a.length)>0?(t.children=a,!0):void 0}))};return v()(n=Oe()(e).call(e,(function(e){if(!(null==e?void 0:e.children))return e;var n=r(e.children,t);return wr(wr({},e),{},{children:n})}))).call(n,(function(e){var t;return null==e||null===(t=e.children)||void 0===t?void 0:t.length}))};function Br(e){var t=e.className,n=(0,D.getLangMsg)("ruled.searchTree.key0001");return M().createElement("div",{className:t},M().createElement("img",{className:"".concat(t,"-img"),src:Rr,height:"72",alt:n}),M().createElement("div",{className:"".concat(t,"-text")},n))}var Ur=(0,F.memo)((function(e){var t=e.placeholder,n=e.data,r=e.showDefinitionId,a=void 0===r||r,l=e.checkable,i=e.checkedKeys,c=void 0===i?[]:i,o=e.expandedKeys,u=e.onSelect,d=e.onCheck,s=e.filterTreeData,f=void 0===s?Lr:s,m=e.onDataChange,p=e.scrollToKey,g=e.expandAll,y=e.selectedNodeKeys,h=void 0===y?[]:y,C=(0,F.useRef)(null),A=(0,F.useRef)([]),E=(0,F.useState)(""),b=(0,T.c)(E,2),k=b[0],N=b[1],I=(0,F.useState)(h),R=(0,T.c)(I,2),x=R[0],S=R[1],w=(0,F.useState)((function(){return Pr(f(n),a,l)})),L=(0,T.c)(w,2),B=L[0],j=L[1],O=(0,F.useState)((function(){var e,t,n=[];g?n=Fr(B):n=Oe()(t=B||[]).call(t,(function(e){return e.key}));return P()(e=[]).call(e,(0,z.c)(n),(0,z.c)(o||[]))})),q=(0,T.c)(O,2),G=q[0],K=q[1],W=(0,F.useMemo)((function(){return p&&Mr(B,p)?{scrollToKey:p}:{}}),[p,B]);(0,F.useEffect)((function(){j((function(e){var t,r=Pr(f(n),a,l),i=Oe()(t=v()(r).call(r,(function(t){var n=Oe()(e).call(e,(function(e){return e.key}));return!ee()(n).call(n,t.key)}))).call(t,(function(e){return e.key}));return K((function(e){var t;return P()(t=[]).call(t,(0,z.c)(e),(0,z.c)(i))})),r}))}),[n,l]),(0,F.useEffect)((function(){j((function(){var e=Pr(f(n),a,l);return Dr(e,k)}))}),[a]),(0,F.useEffect)((function(){m&&m(B)}),[B]),(0,F.useEffect)((function(){x.length&&!p&&S([])}),[p]),(0,F.useEffect)((function(){h.length&&S(h)}),[h]);return M().createElement("div",{className:"kd-search-tree-wrap"},M().createElement(U.Input,{className:"kd-search-tree-input",style:{marginBottom:9,width:"100%"},ref:C,value:k,placeholder:t||(0,D.getLangMsg)("ruled.searchTree.key0002"),borderType:"bordered",onChange:function(e){var t=e.target.value,r=Pr(f(n),a,l);if(t){r=Dr(r,t),k||(A.current=G),j(r);var i=Fr(r);K(i)}else Me().isEqual(r,B)||j(r),K(A.current);N(t)},allowClear:!0,prefix:M().createElement("div",null,M().createElement(U.Icon,{type:"search",style:{cursor:"pointer"}}))}),!k||null!=B&&B.length?M().createElement("div",{className:"kd-search-tree"},M().createElement("div",{className:"tree-container"},M().createElement(U.Tree,(0,V.c)({name:"definition",checkable:!!l,expandedKeys:G,showIcon:!1,style:{width:"100%"},onExpand:function(e,t){var n,r=t.expanded,a=t.node,l=(t.event,a.key),i=v()(e).call(e,Boolean);i=r?P()(n=[l]).call(n,(0,z.c)(i)):v()(i).call(i,(function(e){return e!==l})),K(i)},treeData:B,onSelect:function(e,t){var n=t.checked,r=t.node,a=t.event;S(e),u(n,r,a)},selectedKeys:x,onCheck:d,checkedKeys:c,virtual:!1},W)))):M().createElement(Br,{className:"search-empty"}))})),Vr=Ur,zr=function(e){var t=e.prefixCls,n=e.value,r=e.treeData,a=e.onSelect,l=e.scrollToKey,i=(0,F.useState)(!1),c=(0,T.c)(i,2),o=c[0],u=c[1],d=(0,F.useRef)(null),s=(0,F.useRef)(null);(0,D.useOnClickOutside)([s,d],(function(e){o&&u(!1)}));return M().createElement(U.Tooltip,{ref:d,visible:o,trigger:"click",placement:"bottomRight",onVisibleChange:function(e){return u(e)},popperClassName:"".concat(t,"-tree-select-popper"),tip:M().createElement("div",{ref:s,className:"".concat(t,"-search-tree-wrap")},M().createElement(Vr,{data:r,onSelect:function(e,t,n){a(t),u(!1)},scrollToKey:l}))},M().createElement("div",{className:"".concat(t,"-tree-select")},M().createElement("span",null,n||""),M().createElement(U.Icon,{type:o?"arrow-up":"arrow-down"})))};function jr(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Or(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=jr(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=jr(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}var qr=function(e){var t=e.field,n=e.id,r=(0,F.useContext)(G),a=r.getKdesignerApi,l=r.isLockRule,i=a().data,c=t.FieldName,o=l(),u=(0,F.useState)((function(){return(null==c?void 0:c.length)&&(null==c?void 0:Cr()(c).call(c,(function(e){return!0===e.OnlyEmptyRow})))})),d=(0,T.c)(u,2),s=d[0],f=d[1];return M().createElement(D.SwitchPropertyEditor,(0,V.c)({},e,{locked:o,value:s,handleChange:function(e){if(!e&&s&&null!=c&&c.length){var t=Oe()(c).call(c,(function(e){return delete e.OnlyEmptyRow,e}));i.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[n,{fieldName:t}]]))}else if(e&&!s&&null!=c&&c.length){var r=Oe()(c).call(c,(function(t){return Or(Or({},t),{},{OnlyEmptyRow:e})}));i.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[n,{fieldName:r}]]))}f(e)}}))},Gr=function(e){var t=e.className,n=e.editor,r=e.Name,a=e.Tips,l=e.field,i=e.id,c=e.editorType,o=n.NameHidden,u=n.Required,d=(0,F.useContext)(G),s=d.getKdesignerApi,f=d.getPrefixCls,m=d.prefixCls,p=d.ruleMetaInfo,g=d.activeRuleNodeId,y=d.isLockRule,h=l.ActionType,C=l.Expression,A=void 0===C?[]:C,E=l.FieldName,b=void 0===E?[]:E,k=s().data,N=f&&f(m,"takeBaseProAction-editor"),I=y(),R=(0,F.useState)(!1),x=(0,T.c)(R,2),S=x[0],w=x[1],L=(0,F.useState)({}),B=(0,T.c)(L,2),V=B[0],z=B[1],j=(0,F.useRef)(null),O=(0,F.useRef)(null),q=(0,F.useMemo)((function(){return dt(p,g,c||h,"target")}),[p,g,h]),K=(0,F.useMemo)((function(){return dt(p,g,c||h,"source")}),[p,g,h]),W=function(e){k.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[i,e]])).then((function(){w(!1),z({})}))};return M().createElement(M().Fragment,null,M().createElement(D.NameTipWrapper,{nameHidden:o,className:t,name:r,tips:a,required:u,nameStyle:{width:"205px"}}),M().createElement("div",{className:N},M().createElement(U.Tooltip,{ref:j,getTriggerElement:function(){return O.current||j.current},visible:S,placement:"bottomRight",popperClassName:"".concat(m,"-fields-add-panel-popper"),tip:M().createElement(br,{visible:S,triggerRef:O||j,setVisible:function(e){w(e),!e&&z({})},onCancel:function(){z({}),w(!1)},onConfirm:function(){var e,t,n,r,a;(0,Fe.isUndefined)(null==V?void 0:V.index)?function(){var e=V.SrcField,t=V.TargetField;if(t||e){var n=V.SrcFieldName,r=V.TargetFieldName,a=P()(A).call(A,{SrcField:e,TargetField:t,_Type_:"TakeValueId"}),l=P()(b).call(b,{SrcFieldName:n,TargetFieldName:r,_Type_:"TakeValueId"});W({FieldName:l,Expression:a})}}():(e=(0,Fe.cloneDeep)(b),t=(0,Fe.cloneDeep)(A),n=V.index,r=V.SrcField,a=V.TargetField,r&&(e[n].SrcFieldName=V.SrcFieldName,t[n].SrcField=r),a&&(e[n].TargetFieldName=V.TargetFieldName,t[n].TargetField=a),W({FieldName:e,Expression:t}))}},M().createElement(kr,{label:(0,D.getLangMsg)("ruled.setEqution.key0001"),prefixCls:m},M().createElement(zr,{value:null==V?void 0:V.SrcFieldName,treeData:K,prefixCls:m,onSelect:function(e){z((function(t){var n=e.id,r=e.text;return Or(Or({},t),{},{SrcFieldName:r,SrcField:n})}))},scrollToKey:null==V?void 0:V.SrcField})),M().createElement(kr,{label:(0,D.getLangMsg)("ruled.setEqution.key0002"),prefixCls:m},M().createElement(zr,{value:null==V?void 0:V.TargetFieldName,treeData:q,prefixCls:m,onSelect:function(e){z((function(t){var n=e.id,r=e.text;return Or(Or({},t),{},{TargetFieldName:r,TargetField:n})}))},scrollToKey:null==V?void 0:V.TargetField})))},M().createElement("div",{ref:O,className:re()("".concat(N,"-add"),{disabled:I}),onClick:function(e){I||(O.current=e.target,z({}),w(!0))}},M().createElement(U.Icon,{type:"add"}),(0,D.getLangMsg)("ruled.setEqution.key0003"))),Oe()(b).call(b,(function(e,t){return M().createElement("div",{className:re()("".concat(N,"-field-name"),{disabled:I,edit:(null==V?void 0:V.index)===t}),key:t},M().createElement("div",{className:"".concat(N,"-field-name-wrap")},M().createElement("div",{className:"".concat(N,"-field-name-item")},M().createElement("div",{className:"".concat(N,"-field-name-label")},(0,D.getLangMsg)("ruled.setEqution.key0002")),M().createElement("div",{className:"".concat(N,"-field-name-value")},e.TargetFieldName||"")),M().createElement("div",{className:"".concat(N,"-field-name-item")},M().createElement("div",{className:"".concat(N,"-field-name-label")},(0,D.getLangMsg)("ruled.setEqution.key0004")),M().createElement("div",{className:"".concat(N,"-field-name-value")},e.SrcFieldName||"")),M().createElement(U.Icon,{type:"edit",className:"".concat(N,"-field-name-item-edit"),onClick:function(e){return function(e,t){if(!I){O.current=e.target;var n=ue()(A).call(A,(function(e,n){return n===t}))||{},r=ue()(b).call(b,(function(e,n){return n===t}))||{};z(Or(Or(Or({},n),r),{},{index:t})),w(!0)}}(e,t)}}),M().createElement(U.Icon,{prefix:"designericon",type:"shanchu",onClick:function(){return function(e){if(!I){var t=v()(A).call(A,(function(t,n){return n!==e})),n=v()(b).call(b,(function(t,n){return n!==e}));k.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[i,{FieldName:n,Expression:t}]])).then((function(){w(!1)}))}}(t)}})))}))))},Kr=function(e){return M().createElement(Gr,(0,V.c)({},e,{editorType:"TakeBaseProAction"}))};function Wr(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qr(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=Wr(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=Wr(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}var Hr=function(e){var t=e.className,n=e.editor,r=e.Name,a=e.Tips,l=e.field,i=e.id,c=l.Expression,o=void 0===c?"":c;o=o?JSON.parse(o):[];var u=n.NameHidden,d=n.Required,s=(0,F.useContext)(G),f=s.getKdesignerApi,m=s.getPrefixCls,p=s.prefixCls,g=s.getDataRef,y=s.isLockRule,h=f().data,C=(0,F.useContext)(D.GlobalConfigContext).showMessage,A=m&&m(p,"fillQty-editor"),E=g().entitymeta,b=y(),k=(0,F.useState)(!1),N=(0,T.c)(k,2),I=N[0],R=N[1],x=(0,F.useState)({}),S=(0,T.c)(x,2),w=S[0],L=S[1],B=(0,F.useRef)(null),V=(0,F.useRef)(null),z=["BaseUnitqtyField","QtyField"],j=(0,F.useMemo)((function(){var e,t=v()(e=E.Items).call(e,(function(e){return ee()(z).call(z,e._Type_)}));return Oe()(t).call(t,(function(e){return{label:e.Name,value:e.Key}}))}),E),O=function(e){var t,n=ue()(t=E.Items).call(t,(function(t){return t.Key===e}));return(null==n?void 0:n.Name)||""},q=function(e){h.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[i,{Expression:Ot()(e)}]])).then((function(){R(!1),L({})}))};return M().createElement(M().Fragment,null,M().createElement(D.NameTipWrapper,{nameHidden:u,className:t,name:r,tips:a,required:d,nameStyle:{width:"205px"}}),M().createElement("div",{className:A},M().createElement(U.Tooltip,{ref:B,visible:I,placement:"bottomRight",popperClassName:"".concat(p,"-fields-add-panel-popper"),getTriggerElement:function(){return V.current||B.current},tip:M().createElement(br,{visible:I,triggerRef:V||B,setVisible:function(e){R(e),!e&&L({})},onCancel:function(){L({}),R(!1)},onConfirm:function(){var e,t,n,r;(0,Fe.isUndefined)(null==w?void 0:w.index)?function(){var e=w.srcQtyField,t=w.distQtyField;if(!e&&!t)return C((0,D.getLangMsg)("ruled.fillQty.key0002"));var n=P()(o).call(o,{distQtyField:t,srcQtyField:e});q(n)}():(e=(0,Fe.cloneDeep)(o),t=w.index,n=w.srcQtyField,r=w.distQtyField,n&&(e[t].srcQtyField=n),r&&(e[t].distQtyField=r),q(e))}},M().createElement(kr,{label:(0,D.getLangMsg)("ruled.fillQty.key0003"),prefixCls:p},M().createElement(U.Select,{className:"".concat(p,"-fields-item-trigger"),popperClassName:"".concat(p,"-select-popper"),scrollHidden:!0,placeholder:(0,D.getLangMsg)("ruled.fillQty.key0004"),borderType:"bordered",value:null==w?void 0:w.srcQtyField,options:j,onChange:function(e){e!==w.distQtyField?L((function(t){return Qr(Qr({},t),{},{srcQtyField:e})})):C((0,D.getLangMsg)("ruled.fillQty.key0001"))},notFoundContent:(0,D.getLangMsg)("ruled.fillQty.key0007")})),M().createElement(kr,{label:(0,D.getLangMsg)("ruled.fillQty.key0005"),prefixCls:p},M().createElement(U.Select,{className:"".concat(p,"-fields-item-trigger"),popperClassName:"".concat(p,"-select-popper"),scrollHidden:!0,placeholder:(0,D.getLangMsg)("ruled.fillQty.key0004"),borderType:"bordered",value:null==w?void 0:w.distQtyField,options:j,onChange:function(e){e!==w.srcQtyField?L((function(t){return Qr(Qr({},t),{},{distQtyField:e})})):C((0,D.getLangMsg)("ruled.fillQty.key0001"))},notFoundContent:(0,D.getLangMsg)("ruled.fillQty.key0007")})))},M().createElement("div",{ref:V,className:re()("".concat(A,"-add"),{disabled:b}),onClick:function(e){b||(V.current=e.target,L({}),R(!0))}},M().createElement(U.Icon,{type:"add"}),(0,D.getLangMsg)("ruled.fillQty.key0006"))),Oe()(o).call(o,(function(e,t){var n=e.distQtyField,r=e.srcQtyField;return M().createElement("div",{className:re()("".concat(A,"-field-name"),{disabled:b,edit:(null==w?void 0:w.index)===t}),key:t},M().createElement("div",{className:"".concat(A,"-field-name-wrap")},M().createElement("div",{className:"".concat(A,"-field-name-item")},M().createElement("div",{className:"".concat(A,"-field-name-label")},(0,D.getLangMsg)("ruled.fillQty.key0003")),M().createElement("div",{className:"".concat(A,"-field-name-value")},O(r))),M().createElement("div",{className:"".concat(A,"-field-name-item")},M().createElement("div",{className:"".concat(A,"-field-name-label")},(0,D.getLangMsg)("ruled.fillQty.key0005")),M().createElement("div",{className:"".concat(A,"-field-name-value")},O(n))),M().createElement(U.Icon,{type:"edit",className:"".concat(A,"-field-name-item-edit"),onClick:function(e){return function(e,t){if(!b){V.current=e.target;var n=ue()(o).call(o,(function(e,n){return n===t}))||{};L(Qr(Qr({},n),{},{index:t})),R(!0)}}(e,t)}}),M().createElement(U.Icon,{prefix:"designericon",type:"shanchu",onClick:function(){return function(e){if(!b){var t=v()(o).call(o,(function(t,n){return n!==e}));h.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[i,{Expression:Ot()(t)}]]))}}(t)}})))}))))},Jr=function(e){var t=e.className,n=e.editor,r=e.Name,a=e.Tips,l=e.field,i=e.id,c=n.NameHidden,o=n.Required,u=(0,F.useContext)(G),d=u.getKdesignerApi,s=u.getPrefixCls,f=u.prefixCls,m=u.ruleMetaInfo,p=u.activeRuleNodeId,g=u.isLockRule,y=l.ActionType,h=l.Expression,C=void 0===h?"":h,A=d().data,E=s&&s(f,"clearValue-editor"),b=g(),k=(0,F.useState)(!1),N=(0,T.c)(k,2),I=N[0],R=N[1],x=(0,F.useRef)(null),S=(0,F.useMemo)((function(){return dt(m,p,y)}),[m,p,y]),w=(0,F.useMemo)((function(){return st(S)}),[S]),L=(0,F.useState)((function(){return C.split(":")})),P=(0,T.c)(L,2),B=P[0],V=P[1],z=(0,F.useState)((function(){var e=C.split(":");return v()(w).call(w,(function(t){return ee()(e).call(e,t.id)&&(0,Fe.isUndefined)(t.children)}))})),j=(0,T.c)(z,2),O=j[0],q=j[1];(0,F.useEffect)((function(){var e=C.split(":");(0,Fe.isEqual)(e,B)||(V(e),q((function(){return v()(w).call(w,(function(t){return ee()(e).call(e,t.id)&&(0,Fe.isUndefined)(t.children)}))})))}),[C]);return M().createElement(M().Fragment,null,M().createElement(D.NameTipWrapper,{nameHidden:c,className:t,name:r,tips:a,required:o}),M().createElement("div",{className:E},M().createElement(U.Tooltip,{ref:x,visible:I,placement:"bottomRight",popperClassName:"".concat(f,"-fields-tree-panel-popper"),tip:M().createElement(br,{visible:I,triggerRef:x,setVisible:R,onCancel:function(){return R(!1)},onConfirm:function(){var e=v()(w).call(w,(function(e){return ee()(B).call(B,e.id)&&(0,Fe.isUndefined)(e.children)}));q(e),A.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[i,{Expression:B.join(":")}]])).then((function(){R(!1)}))}},M().createElement("div",{className:"".concat(f,"-tree-container")},M().createElement(Vr,{data:S,checkable:!0,onCheck:function(e,t){t.checked,t.node,t.event;var n=v()(w).call(w,(function(t){return ee()(e).call(e,t.id)&&(0,Fe.isUndefined)(t.children)}));V(Oe()(n).call(n,(function(e){return e.id})))},checkedKeys:B})))},M().createElement("div",{className:re()("".concat(E,"-add"),{disabled:b}),onClick:function(){b||R(!0)}},M().createElement(U.Icon,{type:"add"}),(0,D.getLangMsg)("ruled.clearValue.key0001"))),Oe()(O).call(O,(function(e){var t=e.text,n=e.id;return M().createElement("div",{className:re()("".concat(E,"-field-item"),{disabled:b}),key:n},M().createElement("div",{className:"".concat(E,"-field-item-label")},t),M().createElement(U.Icon,{prefix:"designericon",type:"shanchu",onClick:function(){return function(e){if(!b){var t=v()(B).call(B,(function(t){return t!==e}));V(t),q((function(t){return v()(t).call(t,(function(t){return t.id!==e}))})),A.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[i,{Expression:t.join(":")}]]))}}(n)}}))}))))},Xr=function(e){var t,n=e.className,r=e.editor,a=e.Name,l=e.Tips,i=e.field,c=e.id,o=r.NameHidden,u=r.Required,d=(0,F.useContext)(G),s=d.getKdesignerApi,f=d.getPrefixCls,m=d.prefixCls,p=d.ruleMetaInfo,g=d.activeRuleNodeId,y=d.isLockRule,h=i.Fields,C=void 0===h?[]:h,A=i.ActionType,E=s().data,b=f&&f(m,"checkFields-editor"),k=y(),N=(0,F.useState)(!1),I=(0,T.c)(N,2),R=I[0],x=I[1],S=(0,F.useRef)(null),w=(0,F.useState)(C),L=(0,T.c)(w,2),P=L[0],B=L[1],V=(0,F.useMemo)((function(){return dt(p,g,A)}),[p,g,A]),z=(0,F.useMemo)((function(){return st(V)}),[V]),j=(null===(t=p[0])||void 0===t?void 0:t.rulesTree)||[],O=ce()(j)?j:[j],q=(0,F.useMemo)((function(){return st(O)}),[O]),K=v()(q).call(q,(function(e){return e.data===g})),W=K.length?K[0].type:"",Q=["CardEntryRowAp","CardRowPanelAp"],H=ee()(Q).call(Q,W)?"id":"data",J=(0,F.useState)((function(){var e;return v()(e=Oe()(C).call(C,(function(e){var t=e.Id,n=ue()(z).call(z,(function(e){return e[H]===t}));return null==n?void 0:n.id}))).call(e,Boolean)})),X=(0,T.c)(J,2),Y=X[0],Z=X[1],_=(0,F.useMemo)((function(){var e;return v()(e=Oe()(P).call(P,(function(e){var t=e.Id;return ue()(z).call(z,(function(e){return e[H]===t}))}))).call(e,Boolean)}),[P]);(0,F.useEffect)((function(){var e;(0,Fe.isEqual)(P,C)||(B(C),Z(v()(e=Oe()(C).call(C,(function(e){var t=e.Id,n=ue()(z).call(z,(function(e){return e[H]===t}));return null==n?void 0:n.id}))).call(e,Boolean)))}),[C]);return M().createElement(M().Fragment,null,M().createElement(D.NameTipWrapper,{nameHidden:o,className:n,name:a,tips:l,required:u}),M().createElement("div",{className:b},M().createElement(U.Tooltip,{ref:S,visible:R,placement:"bottomRight",popperClassName:"".concat(m,"-fields-tree-panel-popper"),tip:M().createElement(br,{visible:R,triggerRef:S,setVisible:x,onCancel:function(){return x(!1)},onConfirm:function(){var e=v()(z).call(z,(function(e){return ee()(Y).call(Y,e.id)&&(0,Fe.isUndefined)(e.children)})),t=Oe()(e).call(e,(function(e){return{_Type_:"FieldId",Id:e[H]}}));B(t),E.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[c,{Fields:t}]])).then((function(){x(!1)}))}},M().createElement("div",{className:"".concat(m,"-tree-container")},M().createElement(Vr,{data:V,checkable:!0,onCheck:function(e,t){t.checked,t.node,t.event;var n=v()(z).call(z,(function(t){return ee()(e).call(e,t.id)&&(0,Fe.isUndefined)(t.children)}));Z(Oe()(n).call(n,(function(e){return e.id})))},checkedKeys:Y})))},M().createElement("div",{className:re()("".concat(b,"-add"),{disabled:k}),onClick:function(){k||x(!0)}},M().createElement(U.Icon,{type:"add"}),(0,D.getLangMsg)("ruled.checkField.key0001"))),Oe()(_).call(_,(function(e){var t=e.text,n=e.id;return M().createElement("div",{className:re()("".concat(b,"-field-item"),{disabled:k}),key:n},M().createElement("div",{className:"".concat(b,"-field-item-label")},t),M().createElement(U.Icon,{prefix:"designericon",type:"shanchu",onClick:function(){return function(e){if(!k){var t=v()(Y).call(Y,(function(t){return t!==e})),n=v()(_).call(_,(function(t){return t.id!==e}));Z(t);var r=Oe()(n).call(n,(function(e){return{_Type_:"FieldId",Id:e[H]}}));B(r),E.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[c,{Fields:r}]]))}}(n)}}))}))))},Yr=function(e){var t=e.type,n=e.className,r=e.handleChange,a=e.value,l=e.hideThemeBtn,i=e.hideAlphaInput,c=e.disabled,o=(0,F.useState)(!1),u=(0,T.c)(o,2),d=u[0],s=u[1],f=(0,F.useState)(a||""),m=(0,T.c)(f,2),p=m[0],g=m[1],v=(0,F.useRef)(null),y=(0,F.useRef)(null),h="kdesigner-right-view";return(0,F.useEffect)((function(){a!==p&&g(a)}),[a]),M().createElement(M().Fragment,null,M().createElement("div",{className:"".concat(h,"-color-editor"),ref:y},M().createElement(D.ColorPrefixIcon,{disabled:c,className:"".concat(h,"-color-editor"),type:t,color:p,onClick:function(){c||s(!0)}}),M().createElement(U.Input,{className:"".concat(h,"-color-editor-input"),ref:v,borderType:"bordered",value:p,onChange:function(e){var t=e.target.value;g(t),r(t)},disabled:c,onClick:function(){s(!0)}})),M().createElement(D.ColorPicker,{triggerDom:y,showPanel:d,colorValue:p,className:n,hideThemeBtn:l,hideAlphaInput:i,onClosePanel:function(){s(!1)},onChange:function(e){r(e)}}))};function Zr(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function _r(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=Zr(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=Zr(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}var $r=function(e){var t=e.className,n=e.editor,r=e.Name,a=e.Tips,l=e.field,i=e.id,c=n.NameHidden,o=n.Required,u=(0,F.useContext)(G),d=u.getKdesignerApi,s=u.getPrefixCls,f=u.prefixCls,m=u.ruleMetaInfo,p=u.activeRuleNodeId,g=u.isLockRule,y=u.getRulesNodes,h=l.DisplayStyles,C=void 0===h?[]:h,A=l.ActionType,E=d().data,b=s&&s(f,"checkFields-editor"),k=g(),N=(0,F.useState)(!1),I=(0,T.c)(N,2),R=I[0],S=I[1],w=(0,F.useState)(C),L=(0,T.c)(w,2),B=L[0],V=L[1],z=(0,F.useRef)(null),j=(0,F.useRef)(null),O=(0,F.useMemo)((function(){return dt(m,p,A)}),[m,p,A]),q=(0,F.useMemo)((function(){return st(O)}),[O]),K=(0,F.useState)((function(){var e;return v()(e=Oe()(C).call(C,(function(e){var t=e.Id,n=ue()(q).call(q,(function(e){return e.id===t}));return null==n?void 0:n.id}))).call(e,Boolean)})),W=(0,T.c)(K,2),Q=W[0],H=W[1],J=(0,F.useMemo)((function(){var e;return v()(e=Oe()(B).call(B,(function(e){var t=e.Id;return ue()(q).call(q,(function(e){return e.id===t}))}))).call(e,Boolean)}),[B]);(0,F.useEffect)((function(){var e;(0,Fe.isEqual)(C,B)||(V(C),H(v()(e=Oe()(C).call(C,(function(e){var t=e.Id,n=ue()(q).call(q,(function(e){return e.id===t}));return null==n?void 0:n.id}))).call(e,Boolean)))}),[C]);var X=function(e,t,n){var r=Oe()(C).call(C,(function(r){return n===r.Id?_r(_r({},r),{},(0,x.c)({},e,t)):r}));V(r),E.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[i,{DisplayStyles:r}]]))},Y=function(e,t,n){var r,a=t.target.value,l=Oe()(C).call(C,(function(t){return n===t.Id?_r(_r({},t),{},(0,x.c)({},e,a)):t}));V(l),r=l,j.current&&clearTimeout(j.current),j.current=Pn()((function(){j.current=null,E.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[i,{DisplayStyles:r}]]))}),300)};return M().createElement(M().Fragment,null,M().createElement("div",{className:"".concat(b,"-header")},M().createElement(D.NameTipWrapper,{nameHidden:c,className:t,name:r,tips:a,required:o}),M().createElement(U.Tooltip,{ref:z,visible:R,placement:"bottomRight",popperClassName:"".concat(f,"-fields-tree-panel-popper"),tip:M().createElement(br,{visible:R,triggerRef:z,setVisible:S,onCancel:function(){return S(!1)},onConfirm:function(){var e=v()(q).call(q,(function(e){return ee()(Q).call(Q,e.id)&&(0,Fe.isUndefined)(e.children)})),t=Oe()(e).call(e,(function(e){var t=ue()(B).call(B,(function(t){return t.Id===e.id})),n={_Type_:"DisplayStyle",FontSize:"12",Id:e.id,ForeColor:null,BackgroundColor:null,ValueFontSize:"12",ValueForeColor:null,ValueBackgroundColor:null};return t||n}));V(t),E.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[i,{DisplayStyles:t}]])).then((function(){S(!1)}))}},M().createElement("div",{className:"".concat(f,"-tree-container")},M().createElement(Vr,{data:O,checkable:!0,onCheck:function(e,t){t.checked,t.node,t.event;var n=v()(q).call(q,(function(t){return ee()(e).call(e,t.id)&&(0,Fe.isUndefined)(t.children)}));H(Oe()(n).call(n,(function(e){return e.id})))},checkedKeys:Q})))},M().createElement("div",{className:re()("".concat(b,"-add"),{disabled:k}),onClick:function(){k||S(!0)}},M().createElement(U.Icon,{type:"add"}),(0,D.getLangMsg)("ruled.clientSetFieldfmt.key0001")))),M().createElement("div",{className:"".concat(b,"-body")},Oe()(B).call(B,(function(e){var t,n,r,a,l,c,o=e.ForeColor,u=e.BackgroundColor,d=e.FontSize,s=e.ValueForeColor,f=e.ValueFontSize,m=e.ValueBackgroundColor,g=e.Id,h=ue()(J).call(J,(function(e){return e.id===g}));if(!h)return null;var C=h.text,A=h.id;return M().createElement("div",{className:re()("".concat(b,"-field-form"),{disabled:k}),key:A},M().createElement("div",{className:"".concat(b,"-field-header")},M().createElement("div",{className:"".concat(b,"-field-name")},C),M().createElement(U.Icon,{prefix:"designericon",type:"shanchu",onClick:function(){return function(e){if(!k){var t=v()(Q).call(Q,(function(t){return t!==e})),n=v()(J).call(J,(function(t){return t.id!==e}));H(t);var r=Oe()(n).call(n,(function(e){var t=ue()(B).call(B,(function(t){return t.Id===e.id})),n={_Type_:"DisplayStyle",FontSize:"12",Id:e.id,ForeColor:null,BackgroundColor:null,ValueFontSize:"12",ValueForeColor:null,ValueBackgroundColor:null};return t||n}));V(r),E.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[i,{DisplayStyles:r}]]))}}(A)}})),M().createElement("div",{className:"".concat(b,"-field-form-item")},M().createElement("div",{className:P()(t="".concat(b,"-field-form-item-block ")).call(t,b,"-field-form-item-ffsetting")},M().createElement("div",{className:"".concat(b,"-field-form-label")},(0,D.getLangMsg)("ruled.clientSetFieldfmt.key0002")),M().createElement(U.Input,{borderType:"bordered",value:d,disabled:k,onChange:function(e){return Y("FontSize",e,A)}})),M().createElement("div",{className:P()(n="".concat(b,"-field-form-item-block ")).call(n,b,"-field-form-item-fontcolor")},M().createElement("div",{className:"".concat(b,"-field-form-label")},(0,D.getLangMsg)("ruled.clientSetFieldfmt.key0003")),M().createElement(Yr,{className:"".concat(b,"-field-form-coloreditor"),disabled:k,hideThemeBtn:!0,hideAlphaInput:!0,type:"foreColor",value:o,handleChange:function(e){return X("ForeColor",e,A)}})),M().createElement("div",{className:P()(r="".concat(b,"-field-form-item-block ")).call(r,b,"-field-form-item-bgcolor")},M().createElement("div",{className:"".concat(b,"-field-form-label")},(0,D.getLangMsg)("ruled.clientSetFieldfmt.key0004")),M().createElement(Yr,{className:"".concat(b,"-field-form-coloreditor"),disabled:k,hideThemeBtn:!0,hideAlphaInput:!0,type:"backgroundColor",value:u,handleChange:function(e){return X("BackgroundColor",e,A)}}))),function(){var e=y(),t=v()(e).call(e,(function(e){return e.Id===p}));if(t.length){var n=t[0]._Type_,r=["CardRowPanelAp","CardEntryRowAp"];return ee()(r).call(r,n)}return!1}()&&M().createElement("div",{className:"".concat(b,"-field-form-item")},M().createElement("div",{className:P()(a="".concat(b,"-field-form-item-block ")).call(a,b,"-field-form-item-ffsetting")},M().createElement("div",{className:"".concat(b,"-field-form-label")},(0,D.getLangMsg)("ruled.clientSetFieldfmt.key0005")),M().createElement(U.Input,{borderType:"bordered",value:f,disabled:k,onChange:function(e){return Y("ValueFontSize",e,A)}})),M().createElement("div",{className:P()(l="".concat(b,"-field-form-item-block ")).call(l,b,"-field-form-item-fontcolor")},M().createElement("div",{className:"".concat(b,"-field-form-label")},(0,D.getLangMsg)("ruled.clientSetFieldfmt.key0006")),M().createElement(Yr,{className:"".concat(b,"-field-form-coloreditor"),disabled:k,hideThemeBtn:!0,hideAlphaInput:!0,type:"foreColor",value:s,handleChange:function(e){return X("ValueForeColor",e,A)}})),M().createElement("div",{className:P()(c="".concat(b,"-field-form-item-block ")).call(c,b,"-field-form-item-bgcolor")},M().createElement("div",{className:"".concat(b,"-field-form-label")},(0,D.getLangMsg)("ruled.clientSetFieldfmt.key0007")),M().createElement(Yr,{className:"".concat(b,"-field-form-coloreditor"),disabled:k,hideThemeBtn:!0,hideAlphaInput:!0,type:"backgroundColor",value:m,handleChange:function(e){return X("ValueBackgroundColor",e,A)}}))))}))))};function ea(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ta(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=ea(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=ea(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}var na=function(e){var t=e.className,n=e.editor,r=e.Name,a=e.Tips,l=e.field,i=e.id,c=n.NameHidden,o=n.Required,u=(0,F.useContext)(G),d=u.getKdesignerApi,s=u.getPrefixCls,f=u.prefixCls,m=u.ruleMetaInfo,p=u.activeRuleNodeId,g=u.isLockRule,y=l.ClientProperties,h=void 0===y?[]:y,C=l.ActionType,A=d().data,E=s&&s(f,"setField-editor"),b=g(),k=(0,F.useState)(!1),N=(0,T.c)(k,2),I=N[0],R=N[1],x=(0,F.useState)(!1),S=(0,T.c)(x,2),w=S[0],L=S[1],B=(0,F.useState)(!1),V=(0,T.c)(B,2),j=V[0],O=V[1],q=(0,F.useRef)(null),K=((0,F.useRef)(null),(0,F.useRef)(null),(0,F.useRef)(null)),W=(0,F.useRef)(h);(0,F.useEffect)((function(){w&&j||R(!1)}),[w,j]);var Q=(0,F.useMemo)((function(){return dt(m,p,C)}),[m,p,C]),H=(0,F.useMemo)((function(){return st(Q)}),[Q]),J=(0,F.useState)({}),X=(0,T.c)(J,2),Y=X[0],Z=X[1],_=(0,F.useState)((function(){return Oe()(h).call(h,(function(e){var t=ue()(H).call(H,(function(t){return t.id===e.Id}));return ta(ta({},e),{},{Text:null==t?void 0:t.text,Ref:M().createRef()})}))})),$=(0,T.c)(_,2),ee=$[0],te=$[1];(0,F.useEffect)((function(){if(!(0,Fe.isEqual)(h,W.current)){var e=Oe()(h).call(h,(function(e){var t=ue()(H).call(H,(function(t){return t.id===e.Id}));return ta(ta({},e),{},{Text:null==t?void 0:t.text,Ref:M().createRef()})}));te(e),W.current=h}}),[h]),(0,F.useEffect)((function(){Y.Id&&K.current&&K.current.focus()}),[Y.Id]);var ne=function(e,t,n){var r=ue()(ee).call(ee,(function(e){return e.Id===t.id}));Z(r||{Id:t.id,PropertyName:"",PropertyValue:"",_Type_:"ClientProperty",Text:t.title,Ref:M().createRef()}),R(!1)},ae=function(){var e,t=!1,n=Oe()(ee).call(ee,(function(e){return e.Id===Y.Id&&(e=Y,t=!0),e}));t||(n=P()(e=[]).call(e,(0,z.c)(ee),[Y]));if((0,Fe.isEqual)(n,ee))return L(!1),O(!1),void Z({});te(n),A.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[i,{ClientProperties:Oe()(n).call(n,(function(e){return delete e.Text,delete e.Ref,e}))}]])).then((function(){L(!1),O(!1),Z({})}))},le=(0,F.useCallback)((function(e,t){b||(Z(t),O(t.Id))}),[]),ie=(0,F.useCallback)((function(e){var t=e.Id;if(!b){var n=v()(ee).call(ee,(function(e){return e.Id!==t}));te(n),A.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[i,{ClientProperties:Oe()(n).call(n,(function(e){return delete e.Text,e}))}]]))}}),[ee]),ce=(0,F.useCallback)((function(e,t){var n,r=ta({},Y),a=null===(n=e.target)||void 0===n||null===(n=n.value)||void 0===n?void 0:Mn()(n).call(n);"name"===t?r.PropertyName=a:"value"===t&&(r.PropertyValue=a),Z(r)}),[Y]),oe=function(e,t,n){return M().createElement(br,{visible:t,triggerRef:e,setVisible:n,onCancel:function(){n(!1)},onConfirm:ae},M().createElement("div",{className:"".concat(E,"-container")},M().createElement(kr,{label:(0,D.getLangMsg)("ruled.clientSetField.key0001"),prefixCls:f},M().createElement(U.Tooltip,{popperClassName:"".concat(f,"-tooltip-popper"),visible:I,onVisibleChange:function(e){return R(e)},trigger:"click",placement:"bottomRight",tip:M().createElement("div",{className:"".concat(f,"-tree-select-popper")},M().createElement(Vr,{className:"".concat(f,"-container-searchtree"),data:Q,onSelect:ne,selectedNodeKeys:[null==Y?void 0:Y.Id],expandAll:!0}))},M().createElement("div",{className:"".concat(E,"-container-select")},M().createElement("span",null,null!=Y&&Y.Text?Y.Text:""),M().createElement(U.Icon,{type:I?"arrow-up":"arrow-down"})))),M().createElement(kr,{label:(0,D.getLangMsg)("ruled.clientSetField.key0002"),prefixCls:f},M().createElement(U.Input,{className:"".concat(E,"-container-input"),ref:K,disabled:!(null!=Y&&Y.Text),borderType:"bordered",onChange:function(e){return ce(e,"name")},value:Y.PropertyName})),M().createElement(kr,{label:(0,D.getLangMsg)("ruled.clientSetField.key0003"),prefixCls:f},M().createElement(U.Input,{className:"".concat(E,"-container-input"),disabled:!(null!=Y&&Y.Text),borderType:"bordered",onChange:function(e){return ce(e,"value")},value:Y.PropertyValue}))))};return M().createElement(M().Fragment,null,M().createElement("div",{className:"".concat(E,"-header")},M().createElement(D.NameTipWrapper,{nameHidden:c,className:t,name:r,tips:a,required:o}),M().createElement(U.Tooltip,{ref:q,visible:w,placement:"bottomRight",popperClassName:"".concat(f,"-fields-add-panel-popper"),tip:oe(q,w,L)},M().createElement("div",{className:re()("".concat(E,"-add"),{disabled:b}),onClick:function(){b||(L(!0),Z({}))}},M().createElement(U.Icon,{type:"add"}),(0,D.getLangMsg)("ruled.clientSetField.key0004")))),M().createElement("div",{className:"".concat(E,"-body")},Oe()(ee).call(ee,(function(e){var t=e.Text,n=e.Id,r=e.PropertyName,a=e.PropertyValue;return M().createElement("div",{className:re()("".concat(E,"-item"),{disabled:b}),key:n},M().createElement(U.Tooltip,{ref:e.Ref,visible:j===n,placement:"bottomRight",popperClassName:"".concat(f,"-fields-add-panel-popper"),scrollHidden:!0,tip:oe(e.Ref,j===n,O)},M().createElement("div",{className:"".concat(E,"-item-header")},M().createElement("p",null,t),M().createElement("div",{className:"".concat(E,"-item-header-right")},M().createElement(U.Icon,{className:"".concat(E,"-item-header-right-icon"),type:"edit",onClick:function(t){return le(t,e)}}),M().createElement(U.Icon,{className:"".concat(E,"-item-header-right-icon"),type:"delete",onClick:function(){return ie(e)}})))),M().createElement("p",{className:"".concat(E,"-item-text")},M().createElement("label",null,(0,D.getLangMsg)("ruled.clientSetField.key0002")),M().createElement("span",null,r)),M().createElement("p",{className:"".concat(E,"-item-text")},M().createElement("label",null,(0,D.getLangMsg)("ruled.clientSetField.key0003")),M().createElement("span",null,a)))}))))},ra=function(e){var t=e.onClick,n=e.className,r=e.editor,a=e.Name,l=e.Tips,i=e.value,c=e.disabled,o=r.NameHidden,u=r.Required;return M().createElement(M().Fragment,null,M().createElement(D.NameTipWrapper,{nameHidden:o,className:n,name:a,tips:l,required:u}),M().createElement(U.Input,{className:"".concat(n,"-custom-input"),borderType:"bordered",readOnly:!0,value:i,disabled:c,suffix:!c&&M().createElement(U.Icon,{prefix:"designericon",type:"gengduo",style:{cursor:"pointer"},onClick:t})}))},aa=n(41256),la=n.n(aa),ia=n(6908),ca=n.n(ia),oa=n(71536),ua=n.n(oa),da=n(18232),sa=["(",")","()","Backspace","CLR"],fa=/{{Field id="([^"]+)" text="([^"]+)"}}/,ma=/{{Field id="([^"]+)" text="([^"]+)"}}/g;n(7947),n(12848),n(92004),n(80760),n(23360),n(87376);function pa(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ga(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=pa(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=pa(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}function va(e,t){var n=void 0!==it()&&ot()(e)||e["@@iterator"];if(!n){if(ce()(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return ya(e,t);var r=nt()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return at()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ya(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,l=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw l}}}}function ya(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ha={mode:{name:"custom"},autoCloseBrackets:!0,autofocus:!0,styleActiveLine:!0,lineNumbers:!0,smartIndent:!0,matchBrackets:!0,lineWrapping:!1,singleCursorHeightPerLine:!0,placeholder:""},Ca=(0,F.forwardRef)((function(e,t){var n,r,a,l=e.value,i=e.expressionData,c=e.operations,o=e.treeData,u=e.onClickField,d=st(o),s=ca()(n=v()(d).call(d,(function(e){return(0,Fe.isUndefined)(e.children)}))).call(n,(function(e,t){return t.id.length-e.id.length})),f=(0,F.useContext)(G),m=f.invokeAction,p=f.getEncodeValue,g=(0,F.useState)(""),y=(0,T.c)(g,2),h=y[0],C=y[1],A=(0,F.useRef)(null),E=(0,F.useRef)([]),b=(0,F.useRef)("safari"==(r=navigator.userAgent,(a=function(e){return r.match(e)})(/Trident\/(\d+)/)?"ie":a(/Firefox\/(\d+)/)?"firefox":a(/Edge?\/(\d+)/)?"edge":a(/Chrome\/(\d+)/)?"chrome":a(/Safari\/(\d+)/)?"safari":"unknow")),k=(0,F.useMemo)((function(){var e,t=[],n=va(i);try{for(n.s();!(e=n.n()).done;){var r=e.value.types,a=Oe()(r).call(r,(function(e){return e.id}));t.push.apply(t,(0,z.c)(a))}}catch(e){n.e(e)}finally{n.f()}return t}),[i]),N=(0,F.useMemo)((function(){return v()(c).call(c,(function(e){return!ee()(sa).call(sa,e)}))}),[c]),I=(0,F.useMemo)((function(){return function(e,t){return{name:"custom",fn:function(){var n=ca()(e).call(e,(function(e,t){return t.length-e.length}));t=Oe()(t).call(t,(function(e){return e.toLowerCase()}));var r=v()(t).call(t,(function(e){return!/^\w+\s*\w*/.test(e)})),a=v()(t).call(t,(function(e){return/^\w+\s*\w*/.test(e)}));function l(e,t){if(t.beforeParams=!1,e.match(/\w+(?=\(.*\))/)){e.eatWhile(/\w+/);var l=e.current();return ee()(n).call(n,l)?"expression-style":null}if(e.match(/\w+/)){var i=e.current();return ee()(a).call(a,i.toLowerCase())?"operation-style":null}for(var c=0;c<r.length;c++)if(e.match(r[c]))return"operation-style";return e.next(),null}return{startState:function(){return{tokenize:l,beforeParams:!1,inParams:!1}},token:function(e,t){return e.eatSpace()?null:t.tokenize(e,t)}}}}}(k,N)}),[k,N]);(0,F.useImperativeHandle)(t,(function(){return{insertText:R,getEditorValue:function(){return(0,Fe.trimStart)(h)},getEditor:function(){return A.current.editor}}})),(0,F.useEffect)((function(){return D.eventBus.on("setFunctionParam",R),function(){D.eventBus.off("setFunctionParam",R)}}),[]);var R=function(e){var t=A.current.editor,n=t.getCursor();n.line;e=0!==n.ch?" ".concat(e," "):"".concat(e," "),t.replaceRange(e,n),Pn()((function(){t.refresh(),t.focus(),t.scrollIntoView(null)}),0)},x=function(e,t,n,r){for(var a=e.getSearchCursor(n,t,{multiline:"disable"});a.findNext();){if(0===e.findMarks(a.from(),a.to()).length){var l=a.from(),i=a.to();e.replaceRange(r,l,i)}}},S=function(e,t){for(var n=e.getSearchCursor(fa,t,{multiline:"disable"});n.findNext();){if(0===e.findMarks(n.from(),n.to()).length){var r=n.from(),a=n.to(),l=e.getRange(r,a).match(fa),i=document.createElement("div");i.setAttribute("class","tag"),i.setAttribute("data-id",l[1]),i.setAttribute("data-text",l[2]),E.current.push(i),e.markText(r,a,{replacedWith:i})}}},w=function(e){var t,n=!1;E.current=v()(t=E.current).call(t,(function(e){if(e.ownerDocument.body.contains(e)){if(!e.dataset.__react_rendered){var t=e.dataset.id,r=e.dataset.text;e.dataset.__react_rendered="1",ua().render(M().createElement(Aa,{id:t,text:r,onClickField:u}),e),n=!0}return!0}return e.dataset.__react_rendered&&ua().unmountComponentAtNode(e),!1})),n&&e.refresh()};return ha.placeholder=(0,D.getLangMsg)("ruled.editArea.key0001"),M().createElement("div",{className:"code-edit"},M().createElement(da.Mf,{ref:A,value:h,options:ha,defineMode:I,onBeforeChange:function(e,t,n){C(n)},onChange:function(e,t,n){var r,a=ga(ga({},t.from),{},{ch:0}),l=va(s);try{for(l.s();!(r=l.n()).done;){var i,c=r.value,o=c.id,u=c.longText.replace(/(\S+)\(\S+\)/g,"$1"),d=b.current?new RegExp("\\s*(".concat(o,")\\s")):new RegExp("(?<!\\S)(".concat(o,")(?=\\s)")),f=P()(i='{{Field id="'.concat(o,'" text="')).call(i,u,'"}}');x(e,a,d,f)}}catch(e){l.e(e)}finally{l.f()}S(e,a)},editorDidMount:function(e){var t,n=l,r=va(s);try{for(r.s();!(t=r.n()).done;){var a,i=t.value,c=i.id,o=i.longText.replace(/(\S+)\(\S+\)/g,"$1"),u=P()(a='{{Field id="'.concat(c,'" text="')).call(a,o,'"}}'),d=b.current?new RegExp('[^\\w|\\d|\\.|="|\\n]*(?:('.concat(c,'))[^\\w|\\d|"|\\n]*'),"g"):new RegExp('(?<!\\w|\\d|\\.|=")('.concat(c,')(?!\\w|\\d|")'),"g");n=n.replace(d,u)}}catch(e){r.e(e)}finally{r.f()}var f=Pn()((function(){clearTimeout(f),e.setValue(n),e.setCursor(e.lineCount(),0)}),0)},onUpdate:function(e){w(e)}}),M().createElement("div",{className:re()(["check-btn",{disabled:""===h}]),onClick:function(){if(""!==h){var e=p((0,Fe.trimStart)(h));m("validateFormula",[e])}}},(0,D.getLangMsg)("ruled.editArea.key0002")))}));function Aa(e){var t=e.text,n=e.id,r=e.onClickField;return M().createElement("span",{onClick:function(){return r(n)}},t)}var Ea=Ca,ba=function(e){var t=e.operations,n=e.onOperationClick;return M().createElement("div",{className:"condition-operator"},Oe()(t).call(t,(function(e){return M().createElement("div",{className:"operation-item",key:e,onClick:function(){return n(e)}},e)})))};function ka(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Na(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=ka(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=ka(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}var Ia=function(e){var t=e.description,n=e.alertData,r=e.setAlertData;return M().createElement("div",{className:"note-area"},n.visible&&M().createElement(U.Alert,{message:n.msg,showIcon:!0,closable:!0,type:n.type,delayOffTime:"success"===n.type?1e3:0,onClose:function(){return r((function(e){return Na(Na({},e),{},{visible:!1})}))}}),t?M().createElement("div",{className:"description-content"},t):M().createElement("div",{className:"description-content"},(0,D.getLangMsg)("ruled.editors.key0001"),M().createElement("br",null),(0,D.getLangMsg)("ruled.editors.key0002"),M().createElement("br",null),(0,D.getLangMsg)("ruled.editors.key0003"),M().createElement("br",null),(0,D.getLangMsg)("ruled.editors.key0004")))};function Ra(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function xa(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=Ra(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=Ra(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}function Ta(e){var t=e.className,n=(0,D.getLangMsg)("ruled.expressionTree.key0001");return M().createElement("div",{className:"".concat(t,"-empty")},M().createElement("img",{className:"".concat(t,"-empty-img"),src:Rr,height:"72",alt:n}),M().createElement("div",{className:"".concat(t,"-empty-text")},n))}var Sa=function(e){var t=e.data,n=e.onSelect,r=e.onShowDescription,a=(0,F.useState)(""),l=(0,T.c)(a,2),i=l[0],c=l[1],o=(0,F.useState)(null),u=(0,T.c)(o,2),d=u[0],s=u[1],f=(0,F.useState)(""),m=(0,T.c)(f,2),p=m[0],g=m[1],y=(0,F.useState)(t),h=(0,T.c)(y,2),C=h[0],A=h[1];return M().createElement("div",{className:"kd-expression-tree-wrap"},M().createElement(U.Input,{style:{marginBottom:9,width:"100%"},value:i,placeholder:(0,D.getLangMsg)("ruled.expressionTree.key0002"),borderType:"bordered",onChange:function(e){var n=e.target.value;c(n),A((function(){var e=function(e,t){var n;return v()(n=Oe()(e).call(e,(function(e){var n=e.types,r=v()(n).call(n,(function(e){var n;return ee()(n=e.name).call(n,t)}));return r.length?xa(xa({},e),{},{types:r}):null}))).call(n,Boolean)}(t,n);return e}))},allowClear:!0,prefix:M().createElement("div",null,M().createElement(U.Icon,{type:"search",style:{cursor:"pointer"}}))}),!i||null!=C&&C.length?M().createElement("div",{className:"kd-expression-tree"},M().createElement("div",{className:"kd-expression-tree-body"},Oe()(C).call(C,(function(e){var t=e.types,a=e.name;return M().createElement(U.Collapse,{name:"Collapse",key:e.id,defaultActiveKey:e.id},M().createElement(U.Collapse.Panel,{header:a,panelKey:e.id},Oe()(t).call(t,(function(t){var a;return M().createElement("div",{key:P()(a="".concat(e.id,"-")).call(a,t.key),className:re()(["expression-item",{"is-active":t.id===p}]),onClick:function(){return function(e){var t=e.id,a=e.desc;n(e),g(t),s(a),r(a)}(t)},onMouseOver:function(){return r(t.desc)},onMouseLeave:function(){return r(d)}},t.name||"")}))))})))):M().createElement(Ta,{className:"left-datasource"}))};function wa(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function La(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=wa(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=wa(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}var Pa=(0,F.forwardRef)((function(e,t){var n=e.value,r=e.actionType,a=e.className,l=e.showDefinitionId,i=(e.setCheckboxVisible,e.confirmCallback),c=(0,F.useState)(null),o=(0,T.c)(c,2),u=o[0],d=o[1],s=(0,F.useState)(""),f=(0,T.c)(s,2),m=f[0],p=f[1],g=(0,F.useContext)(G),v=g.ruleMetaInfo,y=g.activeRuleNodeId,h=g.invokeAction,C=(0,F.useRef)(null),A=(0,F.useRef)(null),E=(0,F.useMemo)((function(){return dt(v,y,r)}),[v,y]),b=(0,F.useMemo)((function(){return v[0].functionTypes}),[v]),k=(0,F.useMemo)((function(){var e=v[0].functionOperations;return la()(e)}),[v]),N=(0,F.useState)({visible:!1,msg:"",type:"success"}),I=(0,T.c)(N,2),R=I[0],x=I[1],S=(0,F.useRef)(null),w=(0,F.useRef)(!1);(0,F.useImperativeHandle)(t,(function(){return{getEditorValue:function(){var e;return null===(e=A.current)||void 0===e?void 0:e.getEditorValue()},setIsClickConfirmBtn:function(e){w.current=e}}})),(0,F.useEffect)((function(){return D.eventBus.on("validateFormula",L),function(){D.eventBus.off("validateFormula",L)}}),[]);var L=function(e){var t=e.result,n=e.msg;x((function(){return{type:"fail"===t?"error":"success",visible:!0,msg:n}})),"success"===t&&(S.current=Pn()((function(){S.current&&clearTimeout(S.current),x((function(e){return La(La({},e),{},{visible:!1})}))}),1100)),w.current&&(w.current=!1,"success"===t&&i())},B=(0,F.useCallback)((function(e){var t;null===(t=A.current)||void 0===t||t.insertText(e)}),[A.current]),U=(0,F.useCallback)((function(e){var t,n=null===(t=A.current)||void 0===t?void 0:t.getEditor();"Backspace"===e?(n.execCommand("delCharBefore"),n.refresh(),n.focus()):"CLR"===e?(n.setValue(""),n.focus()):B(e)}),[B]),V=(0,F.useCallback)((function(e,t,n){var r,a,l=t.longText,i=t.id,c=l.replace(/(\S+)\(\S+\)/g,"$1"),o=P()(r='{{Field id="'.concat(i,'" text="')).call(r,c,'"}}');null===(a=A.current)||void 0===a||a.insertText(o)}),[A.current]),z=(0,F.useCallback)((function(e){var t=e.settingFormId,n=e.id,r=(null==E?void 0:E[0])||{};t?h("showFunctionSetting",[n,Ot()(r)]):B("".concat(n,"()"))}),[h,B,E]),j=(0,F.useCallback)((function(e){var t,n;"1"!==(null===(t=C.current)||void 0===t?void 0:t.getCurTab())?(null===(n=C.current)||void 0===n||n.setCurTab("1"),Pn()((function(){p(e)}),0)):p(e)}),[C.current]);return M().createElement("div",{className:"".concat(a,"-body")},M().createElement("div",{className:"panel-aside"},M().createElement("div",{className:"panel-aside-header"},(0,D.getLangMsg)("ruled.conditionModal.key0001")),M().createElement("div",{className:"panel-aside-main"},M().createElement(Vr,{placeholder:(0,D.getLangMsg)("ruled.conditionModal.key0002"),data:E,showDefinitionId:l,onSelect:V,scrollToKey:m}))),M().createElement("div",{className:"panel-main"},M().createElement(ba,{operations:k,onOperationClick:U}),M().createElement(Ea,{ref:A,value:n,expressionData:b,operations:k,treeData:E,onClickField:j}),M().createElement(Ia,{description:u,alertData:R,setAlertData:x})),M().createElement("div",{className:"panel-aside"},M().createElement("div",{className:"panel-aside-header"},(0,D.getLangMsg)("ruled.conditionModal.key0003")),M().createElement("div",{className:"panel-aside-main"},M().createElement(Sa,{data:b,onSelect:z,onShowDescription:d}))))})),Fa=function(e){var t=e.value,n=e.modalTitle,r=e.actionType,a=e.visible,l=e.setVisible,i=e.onConfirm,c=(0,F.useState)(!0),o=(0,T.c)(c,2),u=o[0],d=o[1],s=(0,F.useState)(!1),f=(0,T.c)(s,2),m=f[0],p=f[1],g=(0,F.useRef)(null),v=(0,F.useContext)(G),y=v.getPrefixCls,h=v.prefixCls,C=v.invokeAction,A=v.getEncodeValue,E=y&&y(h,"condition-modal"),b=(0,F.useCallback)((function(){var e,t=null===(e=g.current)||void 0===e?void 0:e.getEditorValue();i(t),l(!1)}),[g.current,l,i]),k=M().createElement(M().Fragment,null,u&&M().createElement(U.Checkbox,{className:"".concat(E,"-footer-checkbox"),checked:m,onChange:function(e){var t=!!e.target.checked;p(t)}},(0,D.getLangMsg)("ruled.conditionModal.key0004")),M().createElement("div",{className:"".concat(E,"-footer-btns")},M().createElement(U.Button,{onClick:function(){return l(!1)},type:"second",className:"".concat(E,"-cancel-btn")},(0,D.getLangMsg)("ruled.conditionModal.key0006")),M().createElement(U.Button,{onClick:function(){var e,t,n=null===(e=g.current)||void 0===e?void 0:e.getEditorValue();C("validateFormula",[A(n)]),null===(t=g.current)||void 0===t||t.setIsClickConfirmBtn(!0)},type:"primary",className:"".concat(E,"-ok-btn")},(0,D.getLangMsg)("ruled.conditionModal.key0005"))));return M().createElement(U.Modal,{body:M().createElement(Pa,{ref:g,value:t,className:E,actionType:r,showDefinitionId:m,setCheckboxVisible:d,confirmCallback:b}),bodyStyle:{justifyContent:"start",alignItems:"start",overflowX:"hidden",overflowY:"auto",flexDirection:"column"},titleIcon:null,className:E,footer:k,maskClosable:!1,width:1e3,height:614,title:n||(0,D.getLangMsg)("ruled.conditionModal.key0007"),closable:!0,destroyOnClose:!0,onCancel:function(){return l(!1)},onOk:function(){return l(!1)},mask:!0,visible:a})},Ma=function(e){var t=e.field,n=e.id,r=e.propName,a=e.actionType,l=e.modalTitle,i=e.locked,c=t[r]||"",o=(0,F.useState)(!1),u=(0,T.c)(o,2),d=u[0],s=u[1],f=(0,(0,F.useContext)(G).getKdesignerApi)().data,m=(0,F.useCallback)((function(e){var t=e.replace(ma,"$1");f.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[n,(0,x.c)({},r,t)]]))}),[]);return M().createElement(M().Fragment,null,M().createElement(ra,(0,V.c)({},e,{disabled:i,value:c,onClick:function(){i||s(!0)}})),M().createElement(Fa,{value:c,actionType:a,modalTitle:l,visible:d,setVisible:s,onConfirm:m}))},Da=function(e){var t=(0,(0,F.useContext)(G).isLockRule)();return M().createElement(Ma,(0,V.c)({},e,{locked:t,actionType:"FormulaAction",propName:"Expression",modalTitle:(0,D.getLangMsg)("ruled.formula.key0001")}))},Ba=function(e){var t=(0,(0,F.useContext)(G).isLockRule)();return M().createElement(Ma,(0,V.c)({},e,{locked:t,actionType:"PreCondition",propName:"PreCondition"}))};function Ua(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Va(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=Ua(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=Ua(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}var za=["__Type__","_Type_","Type","RET","ParentId","NodeType","Id","Description","ActionType"],ja=function(e){var t,n=e.field,r=e.id,a=(t=Va({},n),A()(za).call(za,(function(e){delete t[e]})),w()(t).length?Ot()(t):""),l=n.ActionType,i=(0,F.useContext)(G),c=i.getKdesignerApi,o=i.invokeAction,u=i.metaType,d=i.activeRuleNodeId,s=i.ruleMetaInfo,f=i.isLockRule,m=c().data,p=f();(0,F.useEffect)((function(){return D.eventBus.on("setCustomRuleAction",g),function(){D.eventBus.off("setCustomRuleAction",g)}}),[]);var g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=e||{},m.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[r,Va({},e)]]))};return M().createElement(M().Fragment,null,M().createElement(ra,(0,V.c)({},e,{disabled:p,value:a,onClick:function(){var e=s[0].serviceType,t=ue()(e).call(e,(function(e){return e.metaClass===l})),r={metaType:u,treeNodeId:d,serviceType:t,value:n};o("showCustomRuleServiceSetting",[Ot()(r)])}})))};function Oa(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function qa(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=Oa(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=Oa(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}var Ga=function(e){var t,n,r,a=e.field,l=e.id,i=(0,F.useContext)(G),c=i.getKdesignerApi,o=i.getPrefixCls,u=i.prefixCls,d=i.isLockRule,s=a.DisplayStyles,f=void 0===s?[]:s,m=c().data,p=o&&o(u,"checkFields-editor"),g=d(),v=(0,F.useState)(f[0]||{_Type_:"DisplayStyle",FontSize:"12",Id:"RowFormatSet",ForeColor:null,BackgroundColor:null}),y=(0,T.c)(v,2),h=y[0],C=y[1],A=(0,F.useRef)(null),E=function(e,t){var n=qa(qa({},h),{},(0,x.c)({},e,t));C(n),m.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[l,{DisplayStyles:[n]}]]))},b=h.ForeColor,k=h.BackgroundColor,N=h.FontSize;return M().createElement("div",{className:"".concat(p,"-body")},M().createElement("div",{className:re()("".concat(p,"-field-form"),{disabled:g})},M().createElement("div",{className:"".concat(p,"-field-header")},M().createElement("div",{className:"".concat(p,"-field-name")},(0,D.getLangMsg)("ruled.clientSetRowFmt.key0001"))),M().createElement("div",{className:"".concat(p,"-field-form-item")},M().createElement("div",{className:P()(t="".concat(p,"-field-form-item-block ")).call(t,p,"-field-form-item-ffsetting")},M().createElement("div",{className:"".concat(p,"-field-form-label")},(0,D.getLangMsg)("ruled.clientSetRowFmt.key0002")),M().createElement(U.Input,{borderType:"bordered",value:N,disabled:g,onChange:function(e){var t,n=e.target.value,r=qa(qa({},h),{},{FontSize:n});C(r),t=[r],A.current&&clearTimeout(A.current),A.current=Pn()((function(){A.current=null,m.batchUpdateControlPropertyValues((0,D.createUpdateAction)([[l,{DisplayStyles:t}]]))}),300)}})),M().createElement("div",{className:P()(n="".concat(p,"-field-form-item-block ")).call(n,p,"-field-form-item-fontcolor")},M().createElement("div",{className:"".concat(p,"-field-form-label")},(0,D.getLangMsg)("ruled.clientSetRowFmt.key0003")),M().createElement(Yr,{className:"".concat(p,"-field-form-coloreditor"),disabled:g,hideThemeBtn:!0,hideAlphaInput:!0,type:"foreColor",value:b,handleChange:function(e){return E("ForeColor",e)}})),M().createElement("div",{className:P()(r="".concat(p,"-field-form-item-block ")).call(r,p,"-field-form-item-bgcolor")},M().createElement("div",{className:"".concat(p,"-field-form-label")},(0,D.getLangMsg)("ruled.clientSetRowFmt.key0004")),M().createElement(Yr,{className:"".concat(p,"-field-form-coloreditor"),disabled:g,hideThemeBtn:!0,hideAlphaInput:!0,type:"backgroundColor",value:k,handleChange:function(e){return E("BackgroundColor",e)}})))))},Ka=function(){var e=[],t=[[a,"TakeBasePropertyAction"],[r,"SetEqutionAction"],[l,"FillQtyAction"],[i,"ClearValueAction"],[c,"LockFieldAction"],[c,"UnlockFieldAction"],[c,"ShowFieldAction"],[c,"HideFieldAction"],[c,"LockControlAction"],[c,"UnlockControlAction"],[c,"ShowControlAction"],[c,"HideControlAction"],[c,"ClientLockFieldAction"],[c,"ClientUnlockFieldAction"],[c,"ClientShowFieldAction"],[c,"ClientHideFieldAction"],[c,"ClientLockControlAction"],[c,"ClientUnlockControlAction"],[c,"ClientShowControlAction"],[c,"ClientHideControlAction"],[o,"ClientSetFieldfmtAction"],[u,"ClientSetFieldAction"],[u,"ClientSetControlAction"],[d,"FormulaAction"],[s,"ConditionNode"],[f,"ClientSetRowFmtAction"]];return A()(t).call(t,(function(t){var n,r=(0,T.c)(t,2),a=r[0],l=r[1];A()(n=w()(a)).call(n,(function(t){e.push([t,a[t],l])})),e.push(["CustomInput",ja,""])})),e};n(10936);function Wa(e,t){var n=w()(e);if(p()){var r=p()(e);t&&(r=v()(r).call(r,(function(t){return h()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qa(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?A()(n=Wa(Object(a),!0)).call(n,(function(t){(0,x.c)(e,t,a[t])})):b()?N()(e,b()(a)):A()(r=Wa(Object(a))).call(r,(function(t){R()(e,t,h()(a,t))}))}return e}var Ha=(0,F.memo)((0,F.forwardRef)((function(e,t){var n,r=e.data,a=void 0===r?{}:r,l=e.meta,i=void 0===l?{}:l,c=e.onData,o=e.showMessage,u=void 0===o?function(e){}:o,d=e.handleCustomInputEditor,s=void 0===d?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n]}:d,f=e.invokeAction,m=void 0===f?function(e,t){}:f,p=e.getEncodeValue,g=void 0===p?function(e){return e}:p,v=e.ruleMetaInfo,y=void 0===v?{}:v,h=e.metaType,C=e.selectMetaType,E=void 0===C?h:C,b=e.onApi,k=e.getLangMsg,N=(0,F.useRef)(null),I=(0,F.useRef)(a),R=(0,F.useRef)(null),x=(0,F.useState)(""),S=(0,T.c)(x,2),L=S[0],B=S[1],z=(0,F.useState)(""),j=(0,T.c)(z,2),O=j[0],q=j[1],K=(0,F.useCallback)((function(e){return e}),[]);(0,F.useImperativeHandle)(t,(function(){return{}}));var W=w()((null===(n=y[0])||void 0===n?void 0:n.entity)||{}),Q="formmeta"===h?["BillFormAp","BasedataFormAp","EntryAp","CardEntryRowAp","ListGridViewAp","CardEntryAp","FormAp"]:["BaseEntity","BillEntity","EntryEntity","SubEntryEntity"],H=(0,F.useState)((function(){return _t(a,Q,W,h)})),J=(0,T.c)(H,2),X=(0,T.c)(J[0],2),Y=X[0],Z=X[1],_=(J[1],(0,F.useRef)(Y)),$=At(0,y,L,0,O);D.ControlView.tabName=k("ruled.views.key0001"),ar.tabName=k("ruled.leftPanel.key0002"),ur.tabName=k("ruled.rightPanel.key0005");var te=(0,F.useCallback)((function(e){switch(e){case"main":return{main:wn};case"left":return{control:ar};case"right":return{property:ur};default:return{}}}),[]),ne=(0,F.useCallback)((function(e,t,n){s(e,t,n)}),[s]),re=(0,F.useCallback)((function(){return M().createElement("div",{className:"rule-designer-empty-node"},k("ruled.views.key0002"))}),[]),ae=(0,F.useCallback)((function(){return M().createElement("div",{className:"rule-designer-empty-node"},k("ruled.views.key0002"))}),[]),le=(0,F.useMemo)((function(){return{showMessage:u,getViews:te,processPropertyName:K,keywordMapping:{id:"Id",type:"Type",name:"Name",key:"Key",items:"Items",parentId:"ParentId"},enableSearch:!1,dataPortalIdPrefix:"rule-designer-top-view",enableDiffDefaultData:!1,controlViewSetting:{showCollapseTop:!1,hideHelpIcon:!0,hideAnchorIcon:!0,searchInputPlaceholder:k("ruled.views.key0003"),getEmptyView:re,hideTitleTips:!0},propertyViewSetting:{getEmptyView:ae},getOutlineItemIcon:function(e){return M().createElement(U.Icon,{prefix:"designericon",type:sr(e),className:"rule-designer-control-icon"})},onCustomInputClick:ne,preHandle:yr,getPropertyEditors:Ka,onViewCollapseChange:function(e){D.eventBus.emit("onViewCollapseChange",e)},getLangMsg:k}}),[u,te,K,ne,Ka]),ie=(0,F.useCallback)((function(e){var t,n;N.current=Qa({attrActions:null===(t=R.current)||void 0===t?void 0:t.attrActions,resetPatches:null===(n=R.current)||void 0===n||null===(n=n.dataContext)||void 0===n?void 0:n.resetPatches},e),b(Qa({setFunctionParam:function(e){D.eventBus.emit("setFunctionParam",e)},validateFormula:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.eventBus.emit("validateFormula",e)},setCustomRuleAction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.eventBus.emit("setCustomRuleAction",e)}},N.current))}),[b]),oe=(0,F.useCallback)((function(e,t){_.current;I.current=function(e,t,n,r,a,l){var i;return a.current=JSON.parse(Ot()(a.current)),null===(i=a.current)||void 0===i||A()(i).call(i,(function(e){var t=ke(e._Type_,l);e[t]&&delete e[t]})),(0,et.Ut)(n,(function(t){var n,i=t[l].Items;A()(i).call(i,(function(e){var t=ke(e._Type_,l);e[t]&&delete e[t]})),A()(n=e.Items).call(n,(function(e){if("RelationContainerNodeId"in e){var t,n=ue()(i).call(i,(function(t){return t.Id===e.RelationContainerNodeId}));if(!n)return;var c=ke(n._Type_,l),o=bt.getValue.call(e),u=r.getAllSubControls(e.Id),d=[],s=[];if(A()(u).call(u,(function(e){Ce(e)?(0,V.c)(o,kt.getValue.call(e)):Ae(e)&&(e.NodeType===wt?d.push(Zt(e)):Ne(n._Type_)&&s.push(Zt(e)))})),d.length&&(o.TrueActions=d),s.length&&(o.FalseActions=s),ce()(n[c])){var f,m,p=Gt()(f=n[c]).call(f,(function(e){return e.Id===o.Id}));-1===p?n[c].push(o):Wt()(m=n[c]).call(m,p,1,o)}else n[c]=[o];ue()(t=a.current).call(t,(function(e){return e.Id===n.Id}))[c]=JSON.parse(Ot()(n[c]))}}))}))}(e,0,I.current,N.current.data,_,h),c&&c(I.current,t)}),[c]);(0,F.useEffect)((function(){}),[a]),(0,F.useEffect)((function(){b(Qa({setFunctionParam:function(e){D.eventBus.emit("setFunctionParam",e)},validateFormula:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.eventBus.emit("validateFormula",e)},setCustomRuleAction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.eventBus.emit("setCustomRuleAction",e)}},N.current))}),[]),(0,F.useEffect)((function(){if(O){var e=N.current.data,t=e.getData();e.resetPatches(),e.resetData(t,!1)}}),[O]);var de=(0,F.useRef)({getRulesNodes:function(){return _.current},getKdesignerApi:function(){return N.current},getDataRef:function(){return I.current},invokeAction:function(e,t){m(e,t)},prefixCls:"rule-designer",getPrefixCls:function(e,t,n){var r;return n||(e=e||"rule-designer",t?P()(r="".concat(e,"-")).call(r,t):e)}}),se=(0,F.useMemo)((function(){return Qa(Qa({ruleMetaInfo:y,activeRuleNodeId:L,setActiveRuleNodeId:B,activeRuleId:O,setActiveRuleId:q,metaType:h},de.current),{},{isLockRule:function(e){var t,n;return e=null!==(t=e)&&void 0!==t?t:O,Ie(e,null===(n=y[0])||void 0===n?void 0:n.lockRules)},isDragRule:function(e,t,n){var r;return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=!0;if(ce()(r))a=!ee()(r).call(r,e);else if("[object Object]"===Object.prototype.toString.call(r)){var l=r[e];a="unlock"===l?t&&(!n||!r[e])&&"unlock"===r[t]||!t&&"unlock"===r[n]||"unlock"===r[t]||"unlock"===r[n]:"lock"!==l}return a}(e,t,n,null===(r=y[0])||void 0===r?void 0:r.lockRules)},getRulesLocked:function(e){return function(e,t,n,r){var a,l="entitymeta"===r?"entitymeta":"formmeta",i=ue()(a=n[l].Items).call(a,(function(t){return t.Id===e})),c=null==i?void 0:i._Type_,o="entitymeta"===r?t:t[r],u=Re(o,c,"Rules");return"lock"===(null==u?void 0:u.LockType)}(e,i,a,E)},getEncodeValue:g})}),[L,y,h,O]);return M().createElement(M().Fragment,null,M().createElement(U.ConfigProvider,{value:{prefixCls:"kdesigner"}},M().createElement(G.Provider,{value:se},M().createElement(Ja,{ref:R,globalConfig:le,onData:oe,meta:$,data:Z,onApi:ie}))))}))),Ja=M().memo(B());Ha.displayName="RuleDesigner";var Xa=Ha},19600:function(){},13128:function(){}}]);