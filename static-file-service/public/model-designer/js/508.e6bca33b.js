(self.webpackChunkmodel_designer=self.webpackChunkmodel_designer||[]).push([[508,820,400],{3872:function(e,t,n){"use strict";n.r(t),n.d(t,{ModelDesigner:function(){return Rt}});n(19600);var a=n(47976),o=n.n(a),l=n(39448),r=n.n(l),i=n(18860),c=n.n(i),u=n(55748),d=n.n(u),s=n(7312),g=n.n(s),f=n(54120),m=n.n(f),p=n(63808),v=n.n(p),A=n(45040),I=n.n(A),C=n(30112),y=n(72048),b=n(81744),D=n.n(b),E=n(13760),h=n.n(E),N=n(82600),w=n.n(N),S=n(43400),M=n.n(S),x=n(18040),k=n.n(x),T={id:"Id",type:"_Type_",name:"Name",key:"Key",parentId:"ParentId",items:"Items",fieldType:"FieldType",fieldName:"FieldName",tableName:"TableName"},P=n(2664),L=n(75984),R=n.n(L),B=n(29636),z=n.n(B),j=n(65624),U=n.n(j),V=n(10044),Q=n(82448),K=(n(2152),n(81043)),G=n(47332),O=n.n(G),J=n(54116),Z=M().createContext({});Z.displayName="DesignerContext";var Y="Items",H="_Type_",F="Id",X="ParentId",W="Name",_="TableSymbolAps",q="ReferenceSymbolAps",$="RelTableIdSymbol",ee="DataModelAp",te="PhysicalDiagram",ne="DMPackageAp",ae="TableAp",oe="RelationShipAp",le="TableGroupAp",re=n(71252),ie=n.n(re),ce=n(73400),ue=n.n(ce),de="_tablegroup",se=function(e,t){for(var n=e;n!==document.body;){if(n===t)return!0;n=n.parentNode}return!1},ge=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return ue()(e).call(e,de)},fe=function(e,t,n,a,o,l){var r=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=1,a=!1,o="";!a;)o=t+n,a=!U()(e).call(e,(function(e){return e.Key===o})),n++;return o}(e,"reference");return{ParentId:t,RelStart:{ParentId:n,_Type_:"RelNode",Id:(0,x.createUUid)(),RelTableId:o},_Type_:"RelationShipAp",RelationShipType:"0..*",Id:a,RelEnd:{ParentId:n,_Type_:"RelNode",Id:(0,x.createUUid)(),RelTableId:l},Key:r,Name:"reference"}},me=function(e,t,n,a){return{Id:(0,x.createUUid)(),Name:e,ParentId:t,RelTableIdSymbol:n,_Type_:"TableSymbolAp",Position:a}};function pe(e){var t=e.diagramId,n=(0,S.useContext)(x.ConfigContext),a=n.getPrefixCls,o=n.prefixCls,l=a&&a(o,"top-view-wrapper"),r=M().createElement("div",{className:l},t&&M().createElement(ve,{diagramId:t}));return M().createElement(x.ViewHeader,{content:r,portalId:"kdesigner-top-view-main"})}function ve(e){var t=e.diagramId,n=(0,S.useContext)(x.ConfigContext),a=n.getPrefixCls,o=n.prefixCls,l=a&&a(o,"top-view-wrapper"),r=(0,S.useContext)(Z),i=r.getKdesignerApi,u=r.currDiagramId,d=r.setIsValidConnection,s=(0,S.useMemo)((function(){return i()}),[]),g=s.data,f=s.meta,m=s.selection,p=(0,S.useState)(!1),v=(0,y.c)(p,2),A=v[0],I=v[1],b=(0,S.useState)(!1),E=(0,y.c)(b,2),h=E[0],N=E[1],w=(0,S.useContext)(x.GlobalConfigContext),k=w.onTableClick,T=w.showMessage,P=g.getRootId(),L=(0,S.useCallback)((function(e){var t=e.diagramId,n=e.position;A&&(z({diagramId:t,position:n}),I(!1))}),[A]);(0,S.useEffect)((function(){var e,t=null===(e=document.getElementsByClassName("react-flow__pane"))||void 0===e?void 0:e[0];t&&(t.style.cursor=A?"crosshair":"grab")}),[A]),(0,S.useEffect)((function(){return x.eventBus.on("tablePosition",L),function(){x.eventBus.off("tablePosition")}}),[L]),(0,S.useEffect)((function(){d(h)}),[h]);var B=(0,S.useCallback)((function(e){if(A||h){var t=e.target,n=document.getElementById("top-view-add-table-btn"),a=document.getElementById("top-view-add-refs-btn");if(!se(t,n)&&!se(t,a)){var o=document.getElementById("ui-designer-root");se(t,o)||(N(!1),I(!1))}}}),[A,h]);(0,S.useEffect)((function(){return document.addEventListener("click",B),function(){document.removeEventListener("click",B)}}),[B]),(0,x.useDataChangeForceUpdateEffect)(s);var z=function(e){var t,n,a=e.diagramId,o=e.position,l=g.findControl(a);if((null==l?void 0:l[H])===te)if(l[X]!==P){var r=null===(t=f.getControlMeta(ae))||void 0===t?void 0:t[W],i=(0,x.createUUid)(),c=null===(n=g.getData())||void 0===n?void 0:n.Isv,u="kingdee"===c?"t_table":"tk_".concat(c,"_table"),d={Name:r,_Type_:ae,Id:i,ParentId:l[X],Key:"table",TableName:u.toUpperCase()},s=me(r,a,i,o),p=(0,x.createAddAction)([d,s]),v=l[_]||[],A=D()(v).call(v,[s]),I=(0,x.createUpdateAction)([[a,{TableSymbolAps:A}]]),C=(0,x.createCustomUpdateAction)(["model_custom_action",p,I]);g.customUpdateState(C).then((function(){m.setSelect(i),k({table:d,fields:[]})}))}else T((0,x.getLangMsg)("modeld.topView.disableAddTable"),"warn")},j=function(e){var t=!1,n=!0,a=g.canUndo(),o=g.canRedo();switch(e){case"undo":t=!a,n=a;break;case"redo":t=!o,n=o;break;default:t=!1,n=!0}return{disable:t,command:n}},U=(0,S.useCallback)((function(){g.canUndo()&&(g.undo(),m.setSelect(t))}),[t]),V=(0,S.useCallback)((function(){g.canRedo()&&(g.redo(),m.setSelect(t))}),[t]),Q=ie()((0,C.c)((0,C.c)({},l+"-toolbar-item",!0),l+"-toolbar-item-selected",A)),G=ie()((0,C.c)((0,C.c)({},l+"-toolbar-item",!0),l+"-toolbar-item-selected",h)),Y=(0,S.useCallback)((function(e){var t=j(e),n=t.disable,a=t.command;return ie()((0,C.c)((0,C.c)((0,C.c)({},"".concat(l,"-toolbar-operation-item"),!0),"".concat(l,"-toolbar-operation-disable"),n),"".concat(l,"-toolbar-operation-btn"),a))}),[j]),F=(0,S.useCallback)((function(){var e=m.getActiveSelectedId();if(u){var t=g.findControl(u),n=(g.findControl(e)||{})._Type_;if(n===ae){var a=t[_],o=c()(a).call(a,(function(t){return t.RelTableIdSymbol!==e}));if(o.length<a.length){var l,r,i,d,s=null===(l=t[q])||void 0===l?void 0:c()(l).call(l,(function(t){var n,a;return(null==t||null===(n=t.DestinationSymbol)||void 0===n?void 0:n.RelTableIdSymbol)!==e&&(null==t||null===(a=t.SourceSymbol)||void 0===a?void 0:a.RelTableIdSymbol)!==e})),f=(0,x.createUpdateAction)([[u,(0,C.c)((0,C.c)({},_,o),q,s)]]);g.batchUpdateControlPropertyValues(f),m.setSelect(u);var p=null===(r=O()(a).call(a,(function(t){return t.RelTableIdSymbol===e})))||void 0===r?void 0:r.Id;if(!p)return;var v=null===(i=t[q])||void 0===i||null===(i=c()(i).call(i,(function(t){var n,a;return(null==t||null===(n=t.DestinationSymbol)||void 0===n?void 0:n.RelTableIdSymbol)===e||(null==t||null===(a=t.SourceSymbol)||void 0===a?void 0:a.RelTableIdSymbol)===e})))||void 0===i?void 0:R()(i).call(i,(function(e){return e.Id}));g.deleteControl((0,x.createDeleteAction)(D()(d=[p]).call(d,(0,K.c)(v))))}}else if(n===oe){var A=t[q],I=c()(A).call(A,(function(t){var n;return(null==t||null===(n=t.RelationShipSymbol)||void 0===n?void 0:n.RelRelationIdSymbol)!==e}));if(I.length<A.length){var y=(0,x.createUpdateAction)([[u,(0,C.c)({},q,I)]]);g.batchUpdateControlPropertyValues(y),m.setSelect(u);var b=g.findControlByCondition((function(t){var n;return(null==t||null===(n=t.RelationShipSymbol)||void 0===n?void 0:n.RelRelationIdSymbol)===e})),E=b&&b[0].Id;E&&g.deleteControl((0,x.createDeleteAction)([E]))}}}}),[u]);return M().createElement("div",{className:l+"-toolbar"},M().createElement("div",{className:l+"-toolbar-item-group"},M().createElement(J.Icon,{prefix:"designericon",type:"biao57",className:Q,id:"top-view-add-table-btn",title:(0,x.getLangMsg)("modeld.topView.addTable"),onClick:function(){I(!A),N(!1)}}),M().createElement(J.Icon,{prefix:"designericon",type:"xinzengguanxi",className:G,id:"top-view-add-refs-btn",title:(0,x.getLangMsg)("modeld.topView.addRelationship"),onClick:function(){N(!h),I(!1)}})),M().createElement("div",{className:l+"-toolbar-item-group"},M().createElement(J.Icon,{prefix:"designericon",type:"chexiao",className:Y("undo"),title:(0,x.getLangMsg)("modeld.topView.undo"),onClick:U}),M().createElement(J.Icon,{prefix:"designericon",type:"zhongzuo",className:Y("redo"),title:(0,x.getLangMsg)("modeld.topView.redo"),onClick:V})),M().createElement("div",{className:l+"-toolbar-item-group"},M().createElement(J.Icon,{prefix:"designericon",type:"shanchu4",className:l+"-toolbar-item",title:(0,x.getLangMsg)("modeld.topView.delete"),onClick:F})))}var Ae=function(e){return e.connectionNodeId};function Ie(e,t){var n=o()(e);if(r()){var a=r()(e);t&&(a=c()(a).call(a,(function(t){return d()(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n,a,o=null!=arguments[t]?arguments[t]:{};t%2?g()(n=Ie(Object(o),!0)).call(n,(function(t){(0,C.c)(e,t,o[t])})):m()?v()(e,m()(o)):g()(a=Ie(Object(o))).call(a,(function(t){I()(e,t,d()(o,t))}))}return e}function ye(e,t){var n=e.width,a=e.height,o=e.positionAbsolute,l=t.positionAbsolute,r=n/2,i=a/2,c=o.x+r,u=o.y+i,d=l.x+t.width/2,s=l.y+t.height/2,g=(d-c)/(2*r)-(s-u)/(2*i),f=(d-c)/(2*r)+(s-u)/(2*i),m=1/(Math.abs(g)+Math.abs(f)),p=m*g,v=m*f;return{x:r*(p+v)+c,y:i*(-p+v)+u}}function be(e,t){var n=Ce(Ce({},e.positionAbsolute),e),a=Math.round(n.x),o=Math.round(n.y),l=Math.round(t.x),r=Math.round(t.y);return l<=a+1?V.JC.Left:l>=a+n.width-1?V.JC.Right:r<=o+1?V.JC.Top:r>=n.y+n.height-1?V.JC.Bottom:V.JC.Top}function De(e,t){var n=o()(e);if(r()){var a=r()(e);t&&(a=c()(a).call(a,(function(t){return d()(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ee(e){for(var t=1;t<arguments.length;t++){var n,a,o=null!=arguments[t]?arguments[t]:{};t%2?g()(n=De(Object(o),!0)).call(n,(function(t){(0,C.c)(e,t,o[t])})):m()?v()(e,m()(o)):g()(a=De(Object(o))).call(a,(function(t){I()(e,t,d()(o,t))}))}return e}var he=function(e){var t=e.id,n=e.source,a=e.target,o=e.style,l=(0,S.useState)(!1),r=(0,y.c)(l,2),i=r[0],c=r[1],u=(0,(0,S.useContext)(Z).getKdesignerApi)(),d=u.selection;u.data,(0,S.useEffect)((function(){var e=d.addSelectChangeListener((function(e){var n=e.value[0];c(n===t)}));return function(){null==e||e()}}),[]);var s=(0,V.o3)((0,S.useCallback)((function(e){return e.nodeInternals.get(n)}),[n])),g=(0,V.o3)((0,S.useCallback)((function(e){return e.nodeInternals.get(a)}),[a]));if(!s||!g)return null;var f=function(e,t){var n=ye(e,t),a=ye(t,e),o=be(e,n),l=be(t,a);return{sx:n.x,sy:n.y,tx:a.x,ty:a.y,sourcePos:o,targetPos:l}}(s,g),m=f.sx,p=f.sy,v=f.tx,A=f.ty,I=f.sourcePos,C=f.targetPos,b=(0,V.ym)({sourceX:m,sourceY:p,sourcePosition:I,targetPosition:C,targetX:v,targetY:A}),D=(0,y.c)(b,1)[0],E=i?"#276FF5":"#999",h=Ee(Ee({},o),{},{stroke:E}),N=i?"url(#1__color=#276FF5&type=arrowclosed)":"url(#1__color=#999&type=arrowclosed)";return M().createElement("path",{id:t,className:"react-flow__edge-path",d:D,markerEnd:N,style:h})};var Ne=function(e){var t=e.fromX,n=e.fromY,a=e.toX,o=e.toY,l=e.connectionLineStyle,r=(0,V.uQ)({sourceX:t,sourceY:n,targetX:a,targetY:o}),i=(0,y.c)(r,1)[0];return M().createElement("g",null,M().createElement("path",{style:l,fill:"none",d:i}),M().createElement("circle",{cx:a,cy:o,fill:"black",r:3,stroke:"black",strokeWidth:1.5}))},we="main-view-wrapper",Se=function(e){var t=e.FitViewOpertions,n=e.onZoomIn,a=e.onZoomOut,o=e.onFitView,l=(0,V.Pb)(),r=l.zoomIn,i=l.zoomOut,c=l.fitView,u=(0,S.useContext)(x.ConfigContext),d=u.getPrefixCls,s=u.prefixCls,g=d&&d(s,"main-view"),f=(0,S.useCallback)((function(){null==r||r(),null==n||n()}),[r,n]),m=(0,S.useCallback)((function(){null==i||i(),null==a||a()}),[i,a]),p=(0,S.useCallback)((function(){null==c||c(t),null==o||o()}),[c,t,o]),v=(0,x.getLangMsg)("modeld.operationBtns.plus"),A=(0,x.getLangMsg)("modeld.operationBtns.minus"),I=(0,x.getLangMsg)("modeld.operationBtns.fitView");return M().createElement("div",{className:g+"-operation-box"},M().createElement("div",{onClick:f,className:g+"-operation-box-button",title:v},M().createElement(J.Icon,{prefix:"designericon",type:"fangda",className:g+"-operation-box-button-icon"})),M().createElement("div",{onClick:m,className:g+"-operation-box-button",title:A},M().createElement(J.Icon,{prefix:"designericon",type:"suoxiao",className:g+"-operation-box-button-icon"})),M().createElement("div",{className:g+"-operation-box-button",onClick:p,title:I},M().createElement(J.Icon,{prefix:"designericon",type:"wanzhengshitu",className:g+"-operation-box-button-icon"})))};Se.displayName="OperationBtns";var Me=Se;function xe(e,t){var n=o()(e);if(r()){var a=r()(e);t&&(a=c()(a).call(a,(function(t){return d()(e,t).enumerable}))),n.push.apply(n,a)}return n}function ke(e){for(var t=1;t<arguments.length;t++){var n,a,o=null!=arguments[t]?arguments[t]:{};t%2?g()(n=xe(Object(o),!0)).call(n,(function(t){(0,C.c)(e,t,o[t])})):m()?v()(e,m()(o)):g()(a=xe(Object(o))).call(a,(function(t){I()(e,t,d()(o,t))}))}return e}function Te(e){e.data;var t,n=(0,S.useState)({nodesData:[],edgesData:[]}),a=(0,y.c)(n,2),o=a[0],l=a[1],r=(0,S.useState)(),i=(0,y.c)(r,2),c=i[0],u=i[1],d=(0,S.useState)(""),s=(0,y.c)(d,2),f=s[0],m=s[1],p=(0,S.useContext)(x.ConfigContext),v=p.getPrefixCls,A=p.prefixCls,I=(0,S.useContext)(Z),C=I.getKdesignerApi,b=I.setCurrDiagramId,D=I.dataTypes,E=C(),h=E.selection,N=E.data;(0,S.useEffect)((function(){var e=h.getActiveSelectedId();u(e)}),[]),(0,S.useEffect)((function(){var e=N.addDataChangeListener(k),t=h.addSelectChangeListener((function(e){var t=e.value[0];u(t),k()}));return function(){null==e||e(),null==t||t()}}),[f]);var k=(0,S.useCallback)((function(){var e=h.getActiveSelectedId();if(e){var t=N.findControl(e)||{},n=t._Type_,a=t.TableSymbolAps,o=t.ReferenceSymbolAps,r=void 0===o?[]:o,i=a||[];if(n===ae||n===oe){var c=N.findControl(f);i=(null==c?void 0:c.TableSymbolAps)||[],r=(null==c?void 0:c.ReferenceSymbolAps)||[]}else{if(n!==te)return n===ne?void(N.findControl(f)||l({nodesData:[],edgesData:[]})):void 0;m(e),b(e)}var u=R()(i).call(i,(function(e){return e.RelTableIdSymbol})),d=R()(r).call(r,(function(e){return e.RelationShipSymbol.RelRelationIdSymbol})),s=N.getData().Items,p=[],v=[],A=[];g()(s).call(s,(function(e){var t=z()(u).call(u,(function(t){return t===e.Id}));if(t>-1){var n=(0,P.c)({},e,{Position:i[t].Position});p.push(n)}else w()(u).call(u,e.ParentId)&&"ColumnAp"===e._Type_?v.push(e):w()(d).call(d,e.Id)&&A.push(e)}));var I=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=R()(e).call(e,(function(e,t){var n=e.Position;return{id:e.Id,type:"table",position:{x:(null==n?void 0:n.X)||t%4*360,y:(null==n?void 0:n.Y)||500*Math.floor(t/4)},data:{id:e.Id,name:e.Name,items:[],size:{width:320,height:500}}}}));g()(t).call(t,(function(e){var t=z()(o).call(o,(function(t){return t.id===e.ParentId}));o[t].data.items.push({name:e.Name,type:a[e.ColumnType],isNotNull:e.ColumnNull,isPrimaryKey:e.ColumnPrimaryKey,isForeignKey:!1})}));var l=R()(n).call(n,(function(e){return{id:e.Id,type:"floating",source:e.RelStart.RelTableId,target:e.RelEnd.RelTableId}}));return{nodesData:o,edgesData:l}}(p,v,A,D),C=I.nodesData,y=I.edgesData;l({nodesData:C,edgesData:y})}}),[f]),T=ge(c)?le:null===(t=N.findControl(c))||void 0===t?void 0:t._Type_,L=o.nodesData&&o.nodesData.length>0,B=v(A,we);return M().createElement("div",{className:B,id:"ui-designer-root"},M().createElement(pe,{diagramId:f}),M().createElement(ze,{nodesData:o.nodesData,edgesData:o.edgesData,diagramId:f,setSelect:h.setSelect,hasNodesData:L}),L?null:M().createElement(je,{selectType:T}))}var Pe={strokeWidth:2,stroke:"#999"},Le={table:function(e){var t=e.id,n=e.data,a=(0,S.useState)(!1),o=(0,y.c)(a,2),l=o[0],r=o[1],i=(0,S.useState)(!1),c=(0,y.c)(i,2),u=c[0],d=c[1],s=(0,S.useContext)(Z),g=s.getKdesignerApi,f=s.isValidConnection,m=(0,S.useContext)(x.ConfigContext),p=m.getPrefixCls,v=m.prefixCls,A=g(),I=A.selection,b=A.data,D=(0,S.useContext)(x.GlobalConfigContext).onTableClick;(0,S.useEffect)((function(){var e=I.getSelection(),n=null==e?void 0:w()(e).call(e,t);d(n);var a=I.addSelectChangeListener((function(e){var n=e.value[0]===t;d(n)}));return function(){null==a||a()}}),[]);var E=p&&p(v,"main-view-table-node"),h=(0,V.o3)(Ae),N=!!h,k=n.name,T=n.items,P=R()(T).call(T,(function(e,t){var n=e.name,a=e.type,o=e.isNotNull,l=e.isPrimaryKey,r=(e.isForeignKey,ie()((0,C.c)((0,C.c)({},E+"-icon",!0),"customNode",!0)));return M().createElement("li",{key:t,className:E+"-field-wrapper"},M().createElement("div",{className:E+"-field-wrapper-icon-wrapper "+r},l?M().createElement(J.Icon,{prefix:"designericon",type:"zhujian",className:E+"-field-wrapper-primary-key-icon"}):o?M().createElement(J.Icon,{prefix:"designericon",type:"chuangjianshijian",className:E+"-field-wrapper-must-input-icon"}):null),M().createElement("span",{className:E+"-field-wrapper-name"},n),M().createElement("span",{className:E+"-field-wrapper-type"},a))})),L=T.length>5,B=l?320:160,z=ie()((0,C.c)((0,C.c)({},E,!0),E+"-selected",u)),j=(0,S.useCallback)((function(){var e=b.getSubControls(t)||[],n=b.findControl(t);D({table:n,fields:e})}),[t]),U=ie()((0,C.c)((0,C.c)({},E+"-field-panel",!0),E+"-field-panel-is-connecting",N));return M().createElement("div",{className:z,onClick:function(){I.setSelect(t)}},M().createElement("div",{className:E+"-header"},k),M().createElement("div",{className:E+"-body"},!N&&M().createElement(V._2,{className:"customHandle",position:V.JC.Right,type:"source",style:{zIndex:f?0:-1}}),M().createElement(V._2,{className:"customHandle",position:V.JC.Left,type:"target",isConnectableStart:!1}),M().createElement("ul",{className:U,style:{maxHeight:B}},P)),L&&M().createElement("div",{className:E+"-footer",onClick:function(e){return r(!l)}},M().createElement(J.Icon,{prefix:"designericon",type:l?"xialajiantoufanxiang":"xialajiantou"})),u&&M().createElement(J.Icon,{prefix:"designericon",type:"shouxieqianming",className:E+"-add-icon",onClick:j}))}},Re={floating:he},Be={style:{strokeWidth:2,stroke:"#999"},type:"floating",markerEnd:{type:V.eO.ArrowClosed,color:"#999"}},ze=function(e){var t=e.nodesData,n=void 0===t?[]:t,a=e.edgesData,o=void 0===a?[]:a,l=e.diagramId,r=e.hasNodesData,i=(0,V.wn)(n),c=(0,y.c)(i,3),u=c[0],d=c[1],s=c[2],g=(0,V.lu)(o),f=(0,y.c)(g,3),m=f[0],p=f[1],v=f[2],A=(0,S.useContext)(Z),I=A.getKdesignerApi,b=A.currDiagramId,E=A.isValidConnection,h=I(),N=h.selection,w=h.data,k=(0,S.useRef)({}),T=(0,S.useState)(!0),P=(0,y.c)(T,2),L=P[0],B=P[1];(0,S.useEffect)((function(){d(n)}),[n]),(0,S.useEffect)((function(){p(o)}),[o]);var z=(0,S.useCallback)((function(e){if(E){var t=e.source,n=e.target,a=w.findControl(b),o=a.ReferenceSymbolAps||[];if(!U()(o).call(o,(function(e){var a=e.SourceSymbol.RelTableIdSymbol,o=e.DestinationSymbol.RelTableIdSymbol;return a===t&&o===n||a===n&&o===t}))){p((function(t){return(0,V.Wq)(e,t)}));var l=(0,x.createUUid)(),r=(0,x.createUUid)(),i=function(e,t,n,a,o){return{ParentId:e,_Type_:"ReferenceSymbolAp",Key:"ReferenceSymbolAp",Id:t,RelationShipSymbol:{ParentId:t,_Type_:"RelationShipSymbolAp",RelRelationIdSymbol:n},SourceSymbol:{ParentId:t,_Type_:"TableSymbolAp",RelTableIdSymbol:a},DestinationSymbol:{ParentId:t,_Type_:"TableSymbolAp",RelTableIdSymbol:o}}}(b,l,r,t,n),c=w.getData().Items,u=fe(c,a.ParentId,l,r,t,n);w.addControl((0,x.createAddAction)([u,i]));var d=(0,x.createUpdateAction)([[b,(0,C.c)({},q,D()(o).call(o,i))]]);w.batchUpdateControlPropertyValues(d)}}}),[p,b,E]),j=(0,S.useCallback)((function(e,t){N.setSelect(t.id)}),[N]),K=function(e,t){var n,a=null===(n=document.getElementById("ui-designer-root"))||void 0===n?void 0:n.getBoundingClientRect();if(!a||!k.current.getViewport)return{X:e,Y:t};var o=k.current.getViewport(),l=o.x,r=o.y,i=o.zoom;return{X:(e-a.x-l)/i,Y:(t-a.y-r)/i}},G=(0,S.useCallback)((function(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),O=(0,S.useCallback)((function(e){if(e.preventDefault(),l){var t=e.dataTransfer.getData("application/reactflow"),n=w.findControl(t)||{};if(n[H]===ae){var a=K(e.clientX,e.clientY),o=w.findControl(l)[_]||[],r=me(n[W],l,t,a),i=D()(o).call(o,[r]),c=(0,x.createUpdateAction)([[l,{TableSymbolAps:i}]]),u=(0,x.createAddAction)([r]),d=(0,x.createCustomUpdateAction)(["model_custom_action",u,c]);w.customUpdateState(d).then((function(){N.setSelect(t)}))}}}),[l]);return M().createElement(M().Fragment,null,M().createElement("svg",{style:{position:"absolute",top:0,left:0}},M().createElement("defs",null,M().createElement("marker",{class:"react-flow__arrowhead",id:"1__color=#276FF5&type=arrowclosed",markerWidth:"12.5",markerHeight:"12.5",viewBox:"-10 -10 20 20",markerUnits:"strokeWidth",orient:"auto-start-reverse",refX:"0",refY:"0"},M().createElement("polyline",{"stroke-linecap":"round","stroke-linejoin":"round",points:"-5,-4 0,0 -5,4 -5,-4",style:{stroke:"rgb(39, 111, 245)",fill:"rgb(39, 111, 245)",strokeWidth:1}})))),M().createElement(V.UX,{onInit:function(e){k.current=e},style:{background:"#ECEEF2"},nodes:u,edges:m,onNodesChange:s,onEdgesChange:v,onConnect:z,onEdgeClick:j,onPaneClick:function(e){var t=e.clientX,n=e.clientY,a=K(t,n);x.eventBus.emit("tablePosition",{diagramId:l,position:a})},fitView:!0,fitViewOptions:{maxZoom:1},nodeTypes:Le,edgeTypes:Re,defaultEdgeOptions:Be,connectionLineComponent:Ne,connectionLineStyle:Pe,onDragOver:G,onDrop:O,onNodeDragStop:function(e,t){var n=(w.findControl(b)||[])[_],a=!1,o="",l=t.position,r=l.x,i=l.y,c=R()(n).call(n,(function(e){if(e.RelTableIdSymbol===t.id){o=e.Id;var n=e.Position||{};if(n.X!==r||n.Y!==i)return a=!0,ke(ke({},e),{},{Position:{X:r,Y:i}})}return e}));if(a){var u=(0,x.createUpdateAction)([[b,(0,C.c)({},_,c)],[o,{Position:{X:r,Y:i}}]]);w.batchUpdateControlPropertyValues(u)}},nodesConnectable:E,panOnScroll:L,onNodeMouseEnter:function(){B(!1)},onNodeMouseLeave:function(){B(!0)},zoomOnScroll:!1,preventScrolling:!1},r&&M().createElement(Q.k,{zoomable:!0,pannable:!0}),r&&M().createElement(Me,null)))},je=function(e){var t,n=e.selectType,a=(0,S.useContext)(x.ConfigContext),o=(0,a.getPrefixCls)(a.prefixCls,we),l="";if(w()(t=[ne,ee,le]).call(t,n))l=(0,x.getLangMsg)({key:"modeld.emptyPanel.tips1",variables:{icon:M().createElement(J.Icon,{prefix:"designericon",type:"tianjiaziji"})}});else{if(n!==te)return null;l=(0,x.getLangMsg)({key:"modeld.emptyPanel.tips2",variables:{icon:M().createElement(J.Icon,{prefix:"designericon",type:"biao57"})}})}return M().createElement("div",{className:o+"-empty-panel"},M().createElement("img",{className:o+"-empty-panel-img",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOAAAACACAMAAAAlB5WJAAAAP1BMVEUAAADZ3OzY3unX3efX3ujZ3unX3ejY3erW3OfX3ejW3OfY3unX3ejW3OfX3ejv9f/j6fTj6fTi6PPK0Nvu9P8w9aIhAAAAEnRSTlMACQ4lHBcuEyA6NSlEP0qA6aZdRYr1AAACYklEQVR42u3W23KjMAyAYUs+YQxZSPf9n3U7G3ahTRMiZIpF9dszBpKbb3QBRtM0TdM0TdPE58bhurFfRkBu5pH7LUE4XhlACcKBA5QgvHKAEoQsoAQhCyhByAJKELKAEoQsoAQhCyhByAJKELKAEoQsoAQhCyhByAJKELKAEoQsoAQhCyhByAJKEF6n3hZx0Ka2FKhABZJSoAIVqEAFVtWPAS5ToAIrSoEKVCApBTJe9KwU+C0Beo9wUiDadJlKFk8HdP3lQ707FdD33V0pngYI4d1zuVtdgHMAIXUPauEMwNl3X0L5L3pI/ZMSiAeG/mlBOrBJKwkHYjo5MB8JBN/kELJ1YPYK2tXKA5dfhlN9RrNLzVFAbC+fanchhteBbytRgBC6LwpQ3IdhvR2A2Hfd5YvVlxsiACKA8e+A9tHeDei7h7kyvGjD32w+YoKue5I3/NBmSqWB2D8tsn0u50OB6TkwAddniRUHrhR4Pm9rBybP8YGlAwuXdh2ha8iVBrarRcYAGwnAvB2Ijl5pYFgPNgN9HcB2ZaN04FoOonfOR6ADN1QcSMiiQGAm1dCmGDd0LDBbkAa0xEhC3NDhwObsQIuygA2914GwoQqAIAro6MXXgeRVBdBTgMRdHujp3YAE5HQxXcP/0c7Hv/9IBFLbCRh9jP7jujX/Np9mUfXASE8WEGPEiBinc25+dndvFtUPxJtvOhdrenZ/Lw5IS+AEzw2EDZlFCjweaKhLHpC0pQFNbSlQgQokpUAF/jTgUNY3mNoaywJHU1tuKDpAZ6rLjUMx3lihT9M0TdM0TdOI/QEKf4vvLLD1bQAAAABJRU5ErkJggg=="}),M().createElement("div",{className:o+"-empty-panel-tips"},l))},Ue=n(12640),Ve=n.n(Ue),Qe=n(45076),Ke=n.n(Qe),Ge=n(52360),Oe=n.n(Ge),Je=n(6908),Ze=n.n(Je),Ye=n(39568),He=n.n(Ye),Fe=n(89843),Xe=n.n(Fe),We=n(59312),_e=n.n(We),qe=n(12388),$e=n.n(qe),et=n(67928),tt={DataModelAp:"moxing2",DMPackageAp:"bao4",TableAp:"biao57",TableGroupAp:"biaofenzu",PhysicalDiagram:"moxingtu"};function nt(e){return tt[e]||"Flexmianban"}var at=null,ot=function(e,t,n){if(e.dataTransfer&&e.dataTransfer.setDragImage){e.dataTransfer.dropEffect="move",e.dataTransfer.setDragImage(function(e,t){var n;at&&document.body.removeChild(at),at=null,at=document.createElement("div");var a=nt(e),o=D()(n='<i class="designericon designericon-'.concat(a,'" style="font-size:20px"></i>')).call(n,t);return at.innerHTML=o,at.style.cssText="position:absolute;top:-9999px;left:-9999px;opacity:1!important;display:flex;align-items:center",document.body.appendChild(at),at}(t,n),-20,-24)}},lt=function(){var e=(0,S.useRef)(null),t=(0,S.useContext)(Z).getKdesignerApi,n=(0,S.useMemo)((function(){return t()}),[]),a=n.data,o=n.selection,l=a.getRootId();return{onDragStart:(0,S.useCallback)((function(t){var n=t.event,o=t.node;n.stopPropagation();var l=o.nodeKey;l=l.substr(2);var r=a.findControl(l);e.current=l;var i=r||{},c=i._Type_,u=i.Name;!r&&ge(l)&&(c=le,u=(0,x.getLangMsg)("modeld.leftView.tableGroupName")),ot(n,c,u),n.dataTransfer.setData("application/reactflow",l)}),[]),onDragEnter:(0,S.useCallback)((function(e){e.event,e.node}),[]),onDragOver:(0,S.useCallback)((0,et.debounce)((function(e){e.event,e.node}),100),[]),onDragLeave:(0,S.useCallback)((function(e){e.event,e.node}),[]),onDrop:(0,S.useCallback)((function(t){var n=t.event,r=t.node,i=(t.dragNodesKeys,t.dropPosition);!function(e){e.preventDefault(),e.stopPropagation()}(n);var c=e.current;if(c!==l){var u=ge(c),d=r.key,s=r.$type,g=r.parentId,f=s===le,m=f?Ve()(g).call(g,2):Ve()(d).call(d,2);a.swapControl((0,x.createSwapAction)({origin:c,target:m,dropPosition:i,originIsTableGroup:u,targetIsTableGroup:f})).then((function(e){o.setSelect([c])}))}}),[]),onDragEnd:(0,S.useCallback)((function(e){e.event,e.node}),[])}},rt=n(11872),it=n.n(rt);function ct(e,t){var n=o()(e);if(r()){var a=r()(e);t&&(a=c()(a).call(a,(function(t){return d()(e,t).enumerable}))),n.push.apply(n,a)}return n}function ut(e){for(var t=1;t<arguments.length;t++){var n,a,o=null!=arguments[t]?arguments[t]:{};t%2?g()(n=ct(Object(o),!0)).call(n,(function(t){(0,C.c)(e,t,o[t])})):m()?v()(e,m()(o)):g()(a=ct(Object(o))).call(a,(function(t){I()(e,t,d()(o,t))}))}return e}var dt=function(e){var t=e.prefixCls,n=M().createElement(J.Icon,{prefix:"designericon",type:"xinzeng",style:{color:"#212121"}}),a=M().createElement("span",{className:"text-blod"},(0,x.getLangMsg)("modeld.leftView.noDataTips3")),o=M().createElement("span",{className:"text-blod"},(0,x.getLangMsg)("modeld.leftView.noDataTips5"));return M().createElement("div",{className:"".concat(t,"-template-empty")},M().createElement("img",{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTY4cHgiIGhlaWdodD0iOTZweCIgdmlld0JveD0iMCAwIDE2OCA5NiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgIDx0aXRsZT7pgJrnlKgv5pqC5peg5pWw5o2uPC90aXRsZT4KICAgIDxkZWZzPgogICAgICAgIDxsaW5lYXJHcmFkaWVudCB4MT0iNTAlIiB5MT0iMCUiIHgyPSI1MCUiIHkyPSIxMDAlIiBpZD0ibGluZWFyR3JhZGllbnQtMSI+CiAgICAgICAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiNENkRDRTciIG9mZnNldD0iMCUiPjwvc3RvcD4KICAgICAgICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iI0Q2RENFNyIgc3RvcC1vcGFjaXR5PSIwIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD4KICAgICAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPC9kZWZzPgogICAgPGcgaWQ9IumAmueUqC/mmoLml6DmlbDmja4iIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSLnvJbnu4QiPgogICAgICAgICAgICA8ZyBpZD0i6IOM5pmvL+S6kSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTA4LCA0MCkiIGZpbGw9InVybCgjbGluZWFyR3JhZGllbnQtMSkiIG9wYWNpdHk9IjAuMzAwMDAwMDEyIj4KICAgICAgICAgICAgICAgIDxnIGlkPSLlvaLnirbnu5PlkIgiPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0zLDM5IEwzLDI0IEMzLDE1LjcxNTcyODggOS43MTU3Mjg3NSw5IDE4LDkgQzI1LjQ2MTY3NzYsOSAzMS42NTA4NDY5LDE0LjQ0ODI1NTggMzIuODA2Mzk0OCwyMS41ODM2NTQzIEMzMy43OTc4NzUsMjEuMjA2NDc3OSAzNC44NzQ4MjQ3LDIxIDM2LDIxIEM0MC45NzA1NjI3LDIxIDQ1LDI1LjAyOTQzNzMgNDUsMzAgTDQ1LDM5IEwzLDM5IFoiPjwvcGF0aD4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8ZyBpZD0i6IOM5pmvL+S6kSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzYsIDU2KSBzY2FsZSgtMSwgMSkgdHJhbnNsYXRlKC0zNiwgLTU2KXRyYW5zbGF0ZSgxMiwgMzIpIiBmaWxsPSJ1cmwoI2xpbmVhckdyYWRpZW50LTEpIiBvcGFjaXR5PSIwLjMwMDAwMDAxMiI+CiAgICAgICAgICAgICAgICA8ZyBpZD0i5b2i54q257uT5ZCIIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMywzOSBMMywyNCBDMywxNS43MTU3Mjg4IDkuNzE1NzI4NzUsOSAxOCw5IEMyNS40NjE2Nzc2LDkgMzEuNjUwODQ2OSwxNC40NDgyNTU4IDMyLjgwNjM5NDgsMjEuNTgzNjU0MyBDMzMuNzk3ODc1LDIxLjIwNjQ3NzkgMzQuODc0ODI0NywyMSAzNiwyMSBDNDAuOTcwNTYyNywyMSA0NSwyNS4wMjk0MzczIDQ1LDMwIEw0NSwzOSBMMywzOSBaIj48L3BhdGg+CiAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgPGcgaWQ9Iue8lue7hCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzYsIDApIj4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik02Myw5IEw2MywyNCBMNzgsMjQgTDc4LDg0IEM3OCw4NS42NTY4NTQyIDc2LjY1Njg1NDIsODcgNzUsODcgTDIxLDg3IEMxOS4zNDMxNDU4LDg3IDE4LDg1LjY1Njg1NDIgMTgsODQgTDE4LDEyIEMxOCwxMC4zNDMxNDU4IDE5LjM0MzE0NTgsOSAyMSw5IEw2Myw5IFoiIGlkPSLot6/lvoQiIGZpbGw9IiNFMkU4RjMiPjwvcGF0aD4KICAgICAgICAgICAgICAgIDxyZWN0IGlkPSLnn6nlvaIiIGZpbGw9IiNDQUQwREIiIHg9IjI0IiB5PSIyNCIgd2lkdGg9IjkiIGhlaWdodD0iOSI+PC9yZWN0PgogICAgICAgICAgICAgICAgPHBvbHlnb24gaWQ9IuefqeW9oiIgZmlsbD0iI0VFRjRGRiIgcG9pbnRzPSI2MyA5IDc4IDI0IDYzIDI0Ij48L3BvbHlnb24+CiAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2iIiBmaWxsPSIjQ0FEMERCIiB4PSIyNCIgeT0iMzkiIHdpZHRoPSI0OCIgaGVpZ2h0PSI2Ij48L3JlY3Q+CiAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2iIiBmaWxsPSIjQ0FEMERCIiB4PSIyNCIgeT0iNTEiIHdpZHRoPSIyNCIgaGVpZ2h0PSI2Ij48L3JlY3Q+CiAgICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg==",alt:"",width:168,height:96}),M().createElement("div",{className:"text"},M().createElement("span",null,(0,x.getLangMsg)("modeld.leftView.noDataTips1")),n,M().createElement("span",null,(0,x.getLangMsg)("modeld.leftView.noDataTips2"),a,(0,x.getLangMsg)("modeld.leftView.noDataTips4"),o)))},st={},gt="id",ft=function(e){var t=e.data,n=e.meta,a=(0,S.useContext)(x.ConfigContext),l=a.getPrefixCls,r=a.prefixCls,i=(0,S.useContext)(Z),u=i.getKdesignerApi,d=i.currDiagramId,s=(0,S.useMemo)((function(){return u()}),[]),f=s.data,m=s.selection,p=(0,S.useContext)(x.GlobalConfigContext).onTableClick,v=f.getRootId(),A=(0,S.useState)([]),I=(0,y.c)(A,2),b=I[0],E=I[1],h=(0,S.useState)(600),N=(0,y.c)(h,2),k=(N[0],N[1]),T=(0,S.useState)(void 0),P=(0,y.c)(T,2),L=P[0],B=P[1],z=(0,S.useState)([]),j=(0,y.c)(z,2),U=j[0],V=j[1],Q=(0,S.useState)(v),G=(0,y.c)(Q,2),_=G[0],q=G[1],oe=(0,S.useRef)(null),re=(0,S.useRef)(null),ce=(0,S.useState)(t),ue=(0,y.c)(ce,2),se=ue[0],fe=ue[1],me=(0,S.useState)(!1),pe=(0,y.c)(me,2),ve=pe[0],Ae=pe[1],Ie=(0,S.useState)(ee),Ce=(0,y.c)(Ie,2),ye=Ce[0],be=Ce[1],De=(0,S.useRef)(null),Ee=(0,S.useRef)(""),he=lt(),Ne=he.onDragStart,we=he.onDragEnter,Se=he.onDragOver,Me=he.onDragLeave,xe=he.onDrop,ke=he.onDragEnd,Te=l&&l(r,"left-view")||"model-designer-left-view";(0,S.useEffect)((function(){var e;if(v){var t=D()(e="".concat(gt)).call(e,v);V([t]),E([t]),m.setSelect(v)}}),[]),(0,S.useEffect)((function(){var e,t=null==b||null===(e=b[0])||void 0===e?void 0:Ve()(e).call(e,2);if(t){var n=(f.findControl(t)||{})[H];!n&&ge(t)&&(n=le),be(n)}}),[b]),(0,S.useEffect)((function(){var e=(null==se?void 0:se.Items)||[],t=c()(e).call(e,(function(e){var t;return w()(t=[te,ne,ae]).call(t,e[H])})).length;Ae(!t),Ee.current=null==se?void 0:se.Isv}),[se]);var Pe=(0,S.useMemo)((function(){var e="".concat(Te,"-search-prefix-icon");return M().createElement(J.Icon,{prefix:"designericon",type:"sousuo",className:e})}),[Te]),Le=(0,S.useCallback)((function(e){var t=e.value,n=(null==t?void 0:t.Items)||[],a=c()(n).call(n,(function(e){var t;return w()(t=[te,ne,ae]).call(t,e[H])})).length;Ae(!a),fe(t),Ee.current=null==t?void 0:t.Isv}),[]),Re=(0,S.useCallback)((function(e){var t,n=e.value;if(n.length){var a=Ke()(n).call(n,(function(e,t){var n,a;return D()(n=[]).call(n,(0,K.c)(e),[D()(a="".concat(gt)).call(a,t)])}),[]);E(a),q(D()(t="".concat(gt)).call(t,n[0]));var o=(f.findControl(n[0])||{})[H];if(o===te||o===ae){var l=(0,K.c)(U);g()(n).call(n,(function(e){for(var t,n=e;n!==v&&""!==n;){var a,o=D()(a="".concat(gt)).call(a,n);!w()(l).call(l,o)&&l.unshift(o),n=f.getParentControlId(n)}var r=D()(t="".concat(gt)).call(t,v);!w()(l).call(l,r)&&l.unshift(r);var i=f.findControl(e);if((null==i?void 0:i[H])===ae){var c,u,d=f.getParentControlId(e),s=D()(c=D()(u="".concat(gt)).call(u,d)).call(c,de);!w()(l).call(l,s)&&l.unshift(s)}})),V(l)}}}),[v,U]);(0,S.useEffect)((function(){var e=m.addSelectChangeListener(Re),t=f.addDataChangeListener(Le);return function(){e(),t()}}),[Re]);var Be=(0,S.useMemo)((function(){return function(e,t,n,a){var l,r=c()(l=(0,K.c)(e[Y])).call(l,(function(e){return He()(n).call(n,e[H])>-1})),i=[],u={},d=[],s=(null==t?void 0:t.prefix)||"";return g()(r).call(r,(function(e,n){var l,r,i,c,f=e.Id,m=e.Name,p=e.ParentId,v=e.Key,A=e.Hidden,I=e.Invisible,C=e[H],y=e.TableName,b={key:D()(l="".concat(s)).call(l,f),title:m||v||f,parentId:p?D()(r="".concat(s)).call(r,p):p,Hidden:A||I,$type:C};if(C===ne){var E,h,N,w=D()(E=D()(h="".concat(s)).call(h,f)).call(E,de),S={key:w,title:a("modeld.leftView.tableGroupName"),parentId:D()(N="".concat(s)).call(N,f),Hidden:A||I,$type:le};d.unshift(S),b=ut(ut({},b),{},{tableGroupId:w})}C===ae&&(b.title=D()(i="".concat(y,"(")).call(i,m,")")),t&&n>0&&g()(c=o()(t)).call(c,(function(t){b[t]=e[H]})),b.parentId?d.push(b):u=ut({},b)})),g()(d).call(d,(function(e){if(e.$type===ae){var t,n=e.parentId,a=(null===(t=O()(d).call(d,(function(e){return e.key===n})))||void 0===t?void 0:t.tableGroupId)||n;e.parentId=a}})),function e(t,n,a){var o=(0,K.c)(n),l=0;t.parentId||i.push(ut(ut({},t),{},{level:a})),g()(n).call(n,(function(n,r){if((null==n?void 0:n.parentId)===t.key){var c,u=D()(c="".concat(a,"_")).call(c,l++);i.push(ut(ut({},n),{},{level:u})),it()(o).call(o,r,1,void 0),t.children?t.children.push(n):t.children=[n],e(n,o,u)}}))}(u,d,"0"),u.searchData=i,[u]}(se,{prefix:gt},[ee,te,ne,ae],x.getLangMsg)}),[se]),ze=(0,S.useCallback)((function(e){var t,n,a,o,l,r=(0,K.c)((null==Be||null===(t=Be[0])||void 0===t?void 0:t.searchData)||[]),i=Oe()(n=e.target.value).call(n),u=R()(a=Ze()(o=R()(l=c()(r).call(r,(function(e){var t=e.title.toLowerCase(),n=e.key.toLowerCase(),a=i.toLowerCase();return w()(t).call(t,a)||w()(n).call(n,a)}))).call(l,(function(e){var t;return{id:null===(t=e.key)||void 0===t?void 0:Ve()(t).call(t,2),level:e.level}}))).call(o,(function(e){return e.level}))).call(a,(function(e){return e.id}));st[i]=(0,K.c)(u),B(i)}),[Be]),je=(0,S.useCallback)((function(){var e;if(!L||!st[L])return null;var t=st[L],n=t.length;if(n<=0)return v;var a=null===(e=b[0])||void 0===e?void 0:Ve()(e).call(e,2);if(!w()(t).call(t,a))return t[0];var o=He()(t).call(t,a);return o===n-1?o=0:o++,t[o]}),[L,b]),Ue=(0,S.useCallback)((function(){re.current&&re.current.focus();var e=je(),t=f.findControl(e);if(e&&!t){var n,a=(0,K.c)(U),o=D()(n="".concat(gt)).call(n,e),l=o.split(de)[0];return!w()(a).call(a,o)&&a.unshift(o),!w()(a).call(a,l)&&a.unshift(l),V(a),E([o]),q(o),void m.setSelect(e)}e&&m.setSelect([t?e:v])}),[re,je]);(0,S.useEffect)((function(){var e=(0,et.debounce)((function(){var e=document.body.clientHeight-30-80-20;k(e),De.current&&(De.current.style.height="".concat(e,"px"))}),100);return window.addEventListener("resize",e),function(){st={},window.removeEventListener("resize",e)}}),[]),(0,S.useEffect)((function(){var e=document.body.clientHeight-30-80-20;k(e),De.current&&(De.current.style.height="".concat(e,"px"))}),[De]);var Qe=(0,S.useCallback)((function(e,t){t.event,t.node;E(e);var n=R()(e).call(e,(function(e){return Ve()(e).call(e,2)}));m.setSelect(n)}),[]),Ge=(0,S.useCallback)((function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).nodeKey;if(!e)return M().createElement(J.Icon,{prefix:"designericon",type:"Flexmianban"});var t=(f.findControl(Ve()(e).call(e,2))||{})[H];!t&&ge(e)&&(t=le);var n=nt(t);return M().createElement(J.Icon,{prefix:"designericon",type:n})}),[]),Je=(0,S.useCallback)((function(e){var t,a,o,l,r,i,c=[],u=null===(t=O()(a=n.Controls).call(a,(function(t){return t[F]===e})))||void 0===t?void 0:t[W],d=(0,x.createUUid)(),s=null===(o=b[0])||void 0===o?void 0:Ve()(o).call(o,2),g=e===ne?"package":e===ae?"table":"physicaldiagram";e===ae&&(s=ye===le?null===(l=b[0])||void 0===l?void 0:Ve()(r=l.split(de)[0]).call(r,2):null===(i=f.findControl(s))||void 0===i?void 0:i[X]);var v={Name:u,_Type_:e,Id:d,ParentId:s,Key:g};if(e===ae){var A="kingdee"===Ee.current?"t_table":"tk_".concat(Ee.current,"_table");v.TableName=A.toUpperCase()}if(c.push(v),e===ne){var I,C,y=null===(I=O()(C=n.Controls).call(C,(function(e){return e[F]===te})))||void 0===I?void 0:I[W],D=(0,x.createUUid)(),E={Name:y,_Type_:te,Id:D,ParentId:d,Key:"physicaldiagram"};c.push(E)}var h=(0,x.createAddAction)(c);f.addControl(h).then((function(t){var n=t[0].value;if(m.setSelect($e()(n)?[n[0][F]]:[n[F]]),e===ae){var a=$e()(n)?n[0]:n;p({table:a,fields:[]})}}))}),[ye,b]),Ye=(0,S.useMemo)((function(){var e="".concat(Te,"-li-dropdowm-item");return ye===ee?M().createElement(J.Dropdown.Menu,{onClick:Je},M().createElement(J.Dropdown.Item,{className:e,key:ne},M().createElement("div",{className:e+"-container"},M().createElement(J.Icon,{prefix:"designericon",type:"bao4",className:e+"-right"}),(0,x.getLangMsg)("modeld.leftView.package"))),M().createElement(J.Dropdown.Item,{className:e,key:te},M().createElement("div",{className:e+"-container"},M().createElement(J.Icon,{prefix:"designericon",type:"moxingtu",className:e+"-right"}),(0,x.getLangMsg)("modeld.leftView.physicalDiagram")))):M().createElement(J.Dropdown.Menu,{onClick:Je},ye===ne&&M().createElement(J.Dropdown.Item,{className:e,key:te},M().createElement("div",{className:e+"-container"},M().createElement(J.Icon,{prefix:"designericon",type:"moxingtu",className:e+"-right"}),(0,x.getLangMsg)("modeld.leftView.physicalDiagram"))),ye===le&&M().createElement(J.Dropdown.Item,{className:e,key:ae},M().createElement("div",{className:e+"-container"},M().createElement(J.Icon,{prefix:"designericon",type:"biao57",className:e+"-right"}),(0,x.getLangMsg)("modeld.leftView.table"))),ye===ae&&M().createElement(J.Dropdown.Item,{className:e,key:ae},M().createElement("div",{className:e+"-container"},M().createElement(J.Icon,{prefix:"designericon",type:"biao57",className:e+"-right"}),(0,x.getLangMsg)("modeld.leftView.table"))))}),[ye,Je]),Fe=(0,S.useCallback)((function(){var e,t,n=null===(e=b[0])||void 0===e?void 0:Ve()(e).call(e,2),a=f.findControl(n)||{},o=a[H],l=a[X];if(o===ne)t=(0,x.getLangMsg)("modeld.leftView.deletePackagePrompt");else if(o===te)t=(0,x.getLangMsg)("modeld.leftView.deletephysicalDiagramPrompt");else{if(o!==ae)return;t=(0,x.getLangMsg)("modeld.leftView.deleteTablePrompt"),l=d}!function(e,t,n){var a=M().createElement(M().Fragment,null,M().createElement("img",{src:t}),M().createElement("span",{style:{textAlign:"center",marginTop:12}},e));J.Modal.confirm({title:"删除确认",cancelText:"取消",okText:"确认",body:a,bodyStyle:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},footerStyle:{alignItems:"start"},onOk:n})}(t,"data:image/png;base64,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",(function(){return function(e,t,n){var a=f.getAllSubControlIds(t);if(e===ae){var o=f.findControlByCondition((function(e){return e[$]===t})),l=R()(o).call(o,(function(e){return e[F]}));a=D()(a).call(a,l)}else if(e===te);else if(e===ne){var r=f.findControlByCondition((function(e){return e[X]===t&&e[H]===ae})),i=R()(r).call(r,(function(e){return e[F]})),c=Ke()(i).call(i,(function(e,t){var n=f.findControlByCondition((function(e){return e[$]===t})),a=R()(n).call(n,(function(e){return e[F]}));return D()(e).call(e,a)}),[]),u=D()(a).call(a,c);a=Xe()(new(_e())(u))}f.deleteControl((0,x.createDeleteAction)(a)).then((function(){m.setSelect([n])}))}(o,n,l)}))}),[b,d]),We=(0,S.useMemo)((function(){return ye&&ye!==te?M().createElement(J.Dropdown,{placement:"bottomRight",popperClassName:"leftrule-li-dropdowm",scrollHidden:!0,trigger:"click",menu:Ye,onClick:function(e){return e.stopPropagation()}},M().createElement(J.Icon,{prefix:"designericon",className:"".concat(Te,"-search-icon"),type:"xinzeng",title:(0,x.getLangMsg)("modeld.leftView.add")})):M().createElement(J.Icon,{prefix:"designericon",className:ie()("".concat(Te,"-search-icon"),"".concat(Te,"-search-icon-disable")),type:"xinzeng",title:(0,x.getLangMsg)("modeld.leftView.add")})}),[ye,Ye]),qe=(0,S.useMemo)((function(){return ie()("".concat(Te,"-search-icon"),(0,C.c)({},"".concat(Te,"-search-icon-disable"),ye===le||ye===ee))}),[ye]);return M().createElement("div",{className:"".concat(Te,"-wrap"),tabIndex:-1},M().createElement("div",{className:"".concat(Te,"-search")},M().createElement(J.Input,{prefix:Pe,borderType:"bordered",className:"".concat(Te,"-search-input"),onChange:ze,onPressEnter:Ue,value:L,ref:re,allowClear:!0}),We,M().createElement(J.Icon,{prefix:"designericon",className:qe,onClick:Fe,type:"shanchu4",title:(0,x.getLangMsg)("modeld.leftView.delete")})),M().createElement("div",{ref:oe,tabIndex:-1},M().createElement(J.Tree,{ref:De,name:"ModelTree",treeData:Be,width:280,virtual:!0,draggable:!0,showIcon:!0,icon:Ge,expandOnClickNode:!0,onlyExpandOnClickIcon:!0,expandedKeys:U,selectedKeys:b,scrollToKey:_,onSelect:Qe,onExpand:function(e,t){var n,a=t.expanded,o=t.node.key,l=c()(e).call(e,Boolean);l=a?D()(n=[o]).call(n,(0,K.c)(l)):c()(l).call(l,(function(e){return e!==o})),l=Xe()(new(_e())(l)),V(l)},onDragStart:Ne,onDragEnter:we,onDragOver:Se,onDragLeave:Me,onDrop:xe,onDragEnd:ke,onDoubleClick:function(){var e,t=Ve()(e=b[0]).call(e,2),n=f.findControl(t);if(n[H]===ae){var a=f.getSubControls(t)||[];p({table:n,fields:a})}}})),ve&&M().createElement(dt,{prefixCls:Te}))};ft.tabKey="leftView";var mt=ft,pt=n(2992),vt=n.n(pt);function At(e,t){var n=o()(e);if(r()){var a=r()(e);t&&(a=c()(a).call(a,(function(t){return d()(e,t).enumerable}))),n.push.apply(n,a)}return n}function It(e){for(var t=1;t<arguments.length;t++){var n,a,o=null!=arguments[t]?arguments[t]:{};t%2?g()(n=At(Object(o),!0)).call(n,(function(t){(0,C.c)(e,t,o[t])})):m()?v()(e,m()(o)):g()(a=At(Object(o))).call(a,(function(t){I()(e,t,d()(o,t))}))}return e}var Ct=function(e){var t=e.globalConfig,n=e.dataContext,a=e.action,o=t.showMessage,l=a.type,r=a.value,i=r,c=r.origin,u=r.target,d=r.dropPosition,s=r.originIsTableGroup,g=r.targetIsTableGroup;if(s)return o((0,x.getLangMsg)("modeld.leftView.dragMessage04"),"warn");var f=n.findControl(u),m=f[F],p=f[H],v=f[X],A=n.getData().Items,I=z()(A).call(A,(function(e){return e[F]===u})),C=-1,y="";-1===d?(C=I-1,y=v):1===d?(C=I,y=v):0===d&&(C=I,y=m);var b=n.findControl(y),D=null==b?void 0:b[H],E=n.findControl(c),h=E[H];return h===te&&0!==d&&g?o((0,x.getLangMsg)("modeld.leftView.dragMessage05"),"warn"):h!==te||(0!==d||E[X]===m&&!g)&&(0===d||E[X]===y&&p!==ae)?h===ne&&(0===d&&p!==ee||0!==d&&D!==ee)?o((0,x.getLangMsg)("modeld.leftView.dragMessage02"),"warn"):h===ae&&(0===d&&!g||0!==d&&p!==ae)?o((0,x.getLangMsg)("modeld.leftView.dragMessage03"),"warn"):[{type:l,value:i=It(It({},i),{},{origin:[c],targetIndex:C,targetParentId:y})}]:o((0,x.getLangMsg)("modeld.leftView.dragMessage01"),"warn")},yt=function(e){var t=e.action,n=(t.type,t.value);return $e()(n)&&"model_custom_action"===n[0]?it()(n).call(n,1,n.length):[t]},bt=(0,C.c)((0,C.c)({},x.ActionType.DRAG,Ct),x.ActionType.CUSTOMUPDATE,yt),Dt=function(e,t){var n=e.action,a=e.dataContext,o=e.globalConfig,l=e.success,r=o.keywordMapping,i=!1,c=[],u=n.type,d=bt[u];if(d){var s=d({globalConfig:o,dataContext:a,action:n});s&&c.push.apply(c,(0,K.c)(s))}else c.push(n);c.length&&function e(n){var a=[],o=t.getKdesignerApi;return vt().all(R()(n).call(n,(function(e){var t=e.type,n=e.value,a=o();if(t===x.ActionType.ADD){var l=$e()(n)?n:[n];return vt().all(R()(l).call(l,(function(e){var t,n,o=a.data.findControlByCondition((function(t){return e[r.type]===t[r.type]})).length;return"IndexAp"!==e._Type_&&"ColumnAp"!==e._Type_&&(e[r.name]=D()(t="".concat(e[r.name])).call(t,0===o?"":o)),e[r.type]===ae&&(e[r.tableName]=D()(n="".concat(e[r.tableName])).call(n,0===o?"":o)),e}))).then((function(t){return e.value=t,e}))}return vt().resolve(e)}))).then((function(t){return a.length?(i=!0,e(a).then((function(e){return l(D()(t).call(t,e))}))):i?D()(t).call(t,a):l(D()(t).call(t,a))}))}(c)},Et=function(e){var t=e.kdesignerApi;return function(e){var n,a;if(e[0]){var o=e[0].table,l=o[F],r=e[0].fields||[],i=t.current.data,u=null===(n=i.getData())||void 0===n?void 0:n[Y],d=R()(a=c()(u).call(u,(function(e){return e[X]===l}))).call(a,(function(e){return e[F]})),s=(0,x.createDeleteAction)((0,K.c)(d)),g=(0,x.createAddAction)((0,K.c)(r),{isInstrucAdd:!0}),f=(0,x.createUpdateAction)([[l,o]]),m=(0,x.createCustomUpdateAction)(["model_custom_action",s,g,f]);i.customUpdateState(m).then((function(){}))}}},ht=n(58496),Nt=function(){return function(e,t){var n=t.Hide;return!(!n||"object"!==(0,ht.c)(n))&&n.Hide}},wt=n(39832),St=n.n(wt),Mt="update",xt="alias",kt=new x.DelayQueueUtil([Mt,xt]),Tt=function(e){var t=e.dataRef,n=e.kdesignerApi,a=e.keywordMapping;return function(e){var o;if(e&&e[0]){var l=e[0];l=(0,et.isArray)(l)?l:[l];var r=[],i=c()(o=R()(l).call(l,(function(e){var o,l=e.itemId,i=e.value,c=(e.metaType,e.propertyName),u=e.alias,d=c,s=(0,et.isUndefined)(u)?St()(i):u,g=O()(o=t.current.Items).call(o,(function(e){return e.Id===l}));if(g){var f=g[d];if((0,et.isUndefined)(f)){var m=n.current.meta.getControlPropertyDefaultValue(g[H],d);m&&(f=m)}if(!(0,et.isEqual)(f,i))return[l,(0,C.c)({},c,i)];if(!(0,et.isUndefined)(s)){var p=n.current.aliasData.getAliasDataPropValue(g[a.type],c,i);(0,et.isEqual)(p,s)||r.push({type:g[a.type],propName:c,value:i,alias:s})}}}))).call(o,Boolean);kt.addQueueData(i,Mt),kt.addQueueData(r,xt),kt.addTimer((function(){var e=kt.getQueueData(Mt),t=kt.getQueueData(xt);e.length&&n.current.data.batchUpdateControlPropertyValues((0,x.createUpdateAction)(e)),t.length&&h()((function(){n.current.aliasData.setAliasDataPropValue(t)})),kt.clearQueue()}))}}};n(10936);function Pt(e,t){var n=o()(e);if(r()){var a=r()(e);t&&(a=c()(a).call(a,(function(t){return d()(e,t).enumerable}))),n.push.apply(n,a)}return n}function Lt(e){for(var t=1;t<arguments.length;t++){var n,a,o=null!=arguments[t]?arguments[t]:{};t%2?g()(n=Pt(Object(o),!0)).call(n,(function(t){(0,C.c)(e,t,o[t])})):m()?v()(e,m()(o)):g()(a=Pt(Object(o))).call(a,(function(t){I()(e,t,d()(o,t))}))}return e}var Rt=function(e){var t=e.getLangMsg,n=e.data,a=e.meta,o=e.dataTypes,l=e.showMessage,r=e.onData,i=e.onApi,c=e.onTableClick,u=e.handleCustomInputEditor,d=e.getPropertyAliasValue,s=void 0===d?function(){return null}:d,g=(0,S.useMemo)((function(){return(0,x.adaptorMeta)(a,x.transformKeyMap,n)}),[]),f=(0,S.useRef)(null),m=(0,S.useRef)(n),p=(0,S.useState)(""),v=(0,y.c)(p,2),A=v[0],I=v[1],b=(0,S.useState)(!1),E=(0,y.c)(b,2),N=E[0],P=E[1];(0,S.useEffect)((function(){m.current=n}),[n]);var L=(0,S.useMemo)((function(){return{getKdesignerApi:function(){return f.current},prefixCls:"model-designer",getPrefixCls:function(e,t,n){var a;return n||(e=e||"model-designer",t?D()(a="".concat(e,"-")).call(a,t):e)},currDiagramId:A,setCurrDiagramId:I,isValidConnection:N,setIsValidConnection:P,dataTypes:o}}),[A,N]),R=(0,S.useCallback)((function(e){return e}),[]),B=(0,S.useCallback)((function(e,t,n){var a=f.current.aliasData,o=t[T.type],l=t[e],r=t;if((0,et.isUndefined)(l)){var i=f.current.meta.getControlPropertyDefaultValue(o,e);i&&(r=Lt(Lt({},t),{},(0,C.c)({},e,i)))}var c=h()((function(){var t,a=n.Alias,o=n.EmptyDisplay;!a||!o&&w()(t=[void 0,""]).call(t,r[e])||s(e,r,n)}));if(a.hasAliasDataPropValue(o,e,r[e])){var u=a.getAliasDataPropValue(o,e,r[e]);return u&&clearTimeout(c),u}}),[s]),z=(0,S.useCallback)((function(e,t,n,a){var o=t[e],l=t[T.type],r=t;if((0,et.isUndefined)(o)){var i=f.current.meta.getControlPropertyDefaultValue(l,e);i&&(r=Lt(Lt({},t),{},(0,C.c)({},e,i)))}u(e,r,n,a)}),[u]),j={keywordMapping:T,getLangMsg:t,getViews:function(e){switch(e){case"main":return{main:Te};case"left":return mt.tabName=t("modeld.leftView.tabName"),{control:mt};case"right":return x.PropertyView.getTabName=function(){return t("modeld.rightView.tabName")},{property:x.PropertyView}}},preHandle:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Dt.apply(void 0,D()(t).call(t,[Lt({invokeAction:function(e,t){}},L)]))},showMessage:l,onTableClick:c,designerContextValue:L,processPropertyName:R,propertyViewSetting:{showEmptyView:function(e){return!!ge(e)},getEmptyView:function(){return null}},filterProperty:function(e,t){return Nt()(e,t)},onCustomInputClick:z,getEditorFormatValue:B};return M().createElement(J.ConfigProvider,{value:{prefixCls:"kdesigner"}},M().createElement(Z.Provider,{value:L},M().createElement(k(),{globalConfig:j,meta:g,data:n,onApi:function(e){f.current=Lt({setTableInfo:Et({kdesignerApi:f}),setProperty:Tt({dataRef:m,kdesignerApi:f,keywordMapping:T})},e),i&&i(f.current)},onData:r})))}},19600:function(){}}]);