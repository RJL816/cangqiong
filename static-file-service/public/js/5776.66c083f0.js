"use strict";(self["webpackJsonp_bos-platform"]=self["webpackJsonp_bos-platform"]||[]).push([[5776],{830496:function(t,e,o){o.r(e),e.default={preview:"_1IwqKVd6",normal:"y2w-_qWu",close:"lsl0XT1y","button-container":"_2OfoRD3c",btn:"_13jZFD3X","btn-disabled":"_292Jv4G6"}},785776:function(t,e,o){function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}o(182320),o(909112),o(697060),o(360776),o(743924),o(205960),o(846428),o(708896),o(606200),o(534440),o(670864),o(387912),o(836887),o(78504),o(776512),o(977864),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,o(241872),o(323784),o(297336),o(880920),o(633768),o(513640);var r=function(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=n(t)&&"function"!=typeof t)return{default:t};var o=g(e);if(o&&o.has(t))return o.get(t);var r={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if("default"!==i&&Object.prototype.hasOwnProperty.call(t,i)){var s=a?Object.getOwnPropertyDescriptor(t,i):null;s&&(s.get||s.set)?Object.defineProperty(r,i,s):r[i]=t[i]}return r.default=t,o&&o.set(t,r),r}(o(795520)),a=h(o(369396)),i=h(o(671252)),s=h(o(830496)),u=o(218652),l=o(439532),c=o(608008),f=o(674260),d=o(868256),m=o(984844),v=o(891052),p=o(703188);function h(t){return t&&t.__esModule?t:{default:t}}function g(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,o=new WeakMap;return(g=function(t){return t?o:e})(t)}function b(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,y(n.key),n)}}function y(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var r=o.call(t,e||"default");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:String(e)}function w(t,e,o){return e=I(e),function(t,e){if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return O(t)}(t,k()?Reflect.construct(e,o||[],I(t).constructor):e.apply(t,o))}function k(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(k=function(){return!!t})()}function I(t){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},I(t)}function O(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function D(t,e){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},D(t,e)}var E=e.default=function(t){function e(t){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=w(this,e,[t])).onKeyDown=function(t){switch(t.keyCode){case p.KEYS.ESC:o.onClose(t);break;case 37:o.onPre(t);break;case 39:o.onNext(t)}},o.onClose=function(t){t.stopPropagation();var e=o.context.close;e&&e(),o.setState({activeIndex:0,urls:[],isStaticImage:!1,zoomNum:100,rotateNum:0,direction:"next"},(function(){document.removeEventListener("keydown",o.onKeyDown,!0)}))},o.onImgClick=function(t){o.state.canOperate?t.stopPropagation():o.onClose(t)},o.onPre=function(t){t.stopPropagation();var e=o.state.activeIndex;--e<0||(o.imgDom&&(o.imgDom.src=""),o.setState({activeIndex:e,direction:"pre"}),0!==o.state.rotateNum&&o.onRotate(t,270),100!==o.state.zoomNum&&o.bigImg(t,"fangda",75))},o.onNext=function(t){t.stopPropagation();var e=o.state,n=e.activeIndex;++n>=e.urls.length||(o.imgDom&&(o.imgDom.src=""),o.setState({activeIndex:n,direction:"next"}),0!==o.state.rotateNum&&o.onRotate(t,270),100!==o.state.zoomNum&&o.bigImg(t,"fangda",75))},o.onImageLoaded=function(t){var e=o.state,n=e.activeIndex,r=void 0===n?0:n,a=e.urls;"next"===e.direction?r++:r--;var i=a&&a[r];i&&((new Image).src=i)},o.container=document.body,o.state={urls:o.getImgs(t),activeIndex:t.activeIndex,direction:"next",rotateNum:0,zoomNum:100,left:0,top:0,isStaticImage:!1},o.fileserver=null,o.onRotate=o.onRotate.bind(O(o)),o.bigImg=o.bigImg.bind(O(o)),o.fnDown=o.fnDown.bind(O(o)),o.disX=0,o.disY=0,o}var o,n,c;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&D(t,e)}(e,t),o=e,(n=[{key:"componentDidMount",value:function(){this.keyCodes=(0,f.getData)(d.KEY_FORBIDDEN_CODE)||(0,v.List)();var t=this.keyCodes.push(p.KEYS.ESC);(0,f.setData)(d.KEY_FORBIDDEN_CODE,t);var e=this.context.uiData;e&&this.showPreviewImage(e)}},{key:"componentWillUnmount",value:function(){(0,f.setData)(d.KEY_FORBIDDEN_CODE,this.keyCodes),document.removeEventListener("keydown",this.onKeyDown,!0),window.removeEventListener("mousewheel",this.bigImg,{passive:!1}),window.removeEventListener("DOMMouseScroll",this.bigImg,{passive:!1})}},{key:"showPreviewImage",value:function(t){var e,o=this,n=t.showToolbar,r=void 0===n||n,a=t.canOperate,i=void 0===a||a,s=t.activeIndex,l=void 0===s?0:s,c=(t.urls,t.pageId),f=t.isStaticImage,d=void 0!==f&&f,m=(0,u.getFormConfig)(c)(this.props.state);this.fileserver=m&&m.fileserver,this.pageId=c,e=this.getImgs(t),this.setState({showToolbar:r,canOperate:i,activeIndex:l,urls:e,left:0,top:0,isStaticImage:d},(function(){document.addEventListener("keydown",o.onKeyDown,!0),window.addEventListener("mousewheel",o.bigImg,{passive:!1}),window.addEventListener("DOMMouseScroll",o.bigImg,{passive:!1})}))}},{key:"fnDown",value:function(t){if(0!=this.state.canOperate){var e=t||window.event;this.disX=e.clientX-this.state.left,this.disY=e.clientY-this.state.top,document.onmousemove=this.fnMove.bind(this),document.onmouseup=this.fnUp.bind(this)}}},{key:"fnMove",value:function(t){var e=t||window.event;e.target||e.srcElement,this.setState({left:e.clientX-this.disX,top:e.clientY-this.disY})}},{key:"fnUp",value:function(){document.onmousemove=null,document.onmuseup=null}},{key:"onRotate",value:function(t,e){t.stopPropagation(),this.imgDom&&(0===e?(this.setTransform("rotate(90deg)"),this.setState({rotateNum:90})):90===e?(this.setTransform("rotate(180deg)"),this.setState({rotateNum:180})):180===e?(this.setTransform("rotate(270deg)"),this.setState({rotateNum:270})):270===e&&(this.setTransform("rotate(0deg)"),this.setState({rotateNum:0})))}},{key:"setTransform",value:function(t){var e=this.imgDom.style.transform;-1!==t.indexOf("rotate")?-1!==e.indexOf("rotate")?e=e.replace(/rotate\([^\)]*\)/,t):e+=" "+t:-1!==t.indexOf("scale")&&(-1!==e.indexOf("scale")?e=e.replace(/scale\([^\)]*\)/,t):e+=" "+t),this.imgDom.style.transform=e}},{key:"bigImg",value:function(t,e,o){if(e&&t.preventDefault(),t.stopPropagation(),0!=this.state.canOperate){var n=t.wheelDelta||-t.detail;if(this.imgDom){var r=this.state.zoomNum||100;if("suoxiao"===e){if(o<=25)return;r=o-25,this.setState({zoomNum:r})}else if("fangda"===e){if(o>=250)return;r=o+25,this.setState({zoomNum:r})}else if(n<0){if(r<=25)return;r-=5,this.setState({zoomNum:r})}else{if(r>=250)return;r+=5,this.setState({zoomNum:r})}r>=25&&r<=250&&this.setTransform("scale(".concat(r/100,")"))}}}},{key:"getImgs",value:function(t){var e=t.urls;return e&&!Array.isArray(e)&&(e=[e]),e}},{key:"render",value:function(){var t=this,e=this.state,o=e.activeIndex,n=e.urls,u=e.isStaticImage,c=n&&(n[o]||n[0]);if(!c)return null;c=u?(0,l.getImgFullPath)(this.fileserver,c):(0,l.getImgFullPath)(this.fileserver,c,!0),this.pageId&&(c=(0,m.appendParamsToUrl)(c));var f,d,v,p="kdfont kdfont-qianfan1 kd-hover-color "+s.default.btn,h="kdfont kdfont-suoxiao kd-hover-color "+s.default.btn,g="kdfont kdfont-fangda kd-hover-color "+s.default.btn,b="kdfont kdfont-xuanzhuan kd-hover-color "+s.default.btn,w="kdfont kdfont-houfan1 kd-hover-color "+s.default.btn,k=(0,i.default)((f={},d=s.default.normal,v=!0,(d=y(d))in f?Object.defineProperty(f,d,{value:v,enumerable:!0,configurable:!0,writable:!0}):f[d]=v,f));0===o&&(p+=" "+s.default["btn-disabled"]),o===n.length-1&&(w+=" "+s.default["btn-disabled"]);var I={left:this.state.left,top:this.state.top,position:"relative",cursor:0!=this.state.canOperate?"move":"default",transition:"transform 0s linear"},O=!1!==this.state.showToolbar;return a.default.createPortal(r.default.createElement("div",{className:s.default.preview,onClick:this.onClose},r.default.createElement("img",{draggable:!1,ref:function(e){t.imgDom=e},className:k,style:I,"data-image-src":c,onClick:this.onImgClick,onLoad:this.onImageLoaded,onError:this.onImageLoaded,onMouseDown:this.fnDown}),r.default.createElement("div",{className:"kdfont kdfont-guanbiyulan kd-hover-color "+s.default.close,onClick:this.onClose}),O?r.default.createElement("div",{className:s.default["button-container"]},1===n.length?null:r.default.createElement("a",{href:"javascript:void(0)",onClick:this.onPre,className:p}),r.default.createElement("a",{href:"javascript:void(0)",onClick:function(e){return t.bigImg(e,"suoxiao",t.state.zoomNum)},className:h}),r.default.createElement("a",{href:"javascript:void(0)",onClick:function(e){return t.bigImg(e,"fangda",t.state.zoomNum)},className:g}),r.default.createElement("a",{href:"javascript:void(0)",onClick:function(e){return t.onRotate(e,t.state.rotateNum)},className:b}),1===n.length?null:r.default.createElement("a",{href:"javascript:void(0)",onClick:this.onNext,className:w})):null),this.container)}}])&&b(o.prototype,n),c&&b(o,c),Object.defineProperty(o,"prototype",{writable:!1}),e}(r.Component);E.contextType=c.SystemUIContext,E.defaultProps={urls:[],activeIndex:0}}}]);