"use strict";(self["webpackJsonp_bos-platform"]=self["webpackJsonp_bos-platform"]||[]).push([[7812,9860],{49400:function(e,t,n){n.r(t),t.default={"import-panel-title":"_2PiE_RxR","title-word":"Ol4Kd12c","title-close":"_7cenEVkx","import-panel-content":"_1TckApaz","import-panel-content-height":"eIiiatVT","import-input-div":"_21Nre7TE","import-input-img":"_1mDhdjqK","import-button-div":"_1sfpaLaF","import-btn-cancle":"_1eeT31kS","import-btn-summit":"_1GGgchOO","import-word":"_2OGh5AO3","file-list":"_2r-5Eb44","upload-root":"_1b4BYIzW","file-list-li":"c9Xy7igs","common-margin-right":"_18RuJqPw","file-list-img":"_209R9X4G","file-list-img-success":"_3QgpwETg","file-list-img-error":"_3hhv_mQR","file-list-img-uploading":"_2fZWddcI","file-list-filename":"_1l2_8NhW","file-list-filesize":"_2FHFJLN2","file-list-tip":"_17JGnt04",delete_but:"_3KO3Y9V0"}},55776:function(e,t,n){function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}n(697060),n(360776),n(743924),n(205960),n(846428),n(336368),n(708896),n(606200),n(534440),n(670864),n(836887),n(78504),n(776512),n(977864),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n(182320),n(909112),n(941408),n(622676),n(233696),n(241872),n(820444),n(976896),n(297336),n(721300),n(286620),n(880920),n(387912),n(804092),n(690512),n(997308);var o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=i(e)&&"function"!=typeof e)return{default:e};var n=S(t);if(n&&n.has(e))return n.get(e);var o={__proto__:null},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var r=l?Object.getOwnPropertyDescriptor(e,a):null;r&&(r.get||r.set)?Object.defineProperty(o,a,r):o[a]=e[a]}return o.default=e,n&&n.set(e,o),o}(n(795520)),l=O(n(540900)),a=O(n(369396)),r=O(n(258868)),s=O(n(671252)),u=n(891052),f=n(790832),c=n(211152),d=n(218652),p=O(n(937344)),m=O(n(247600)),h=n(46059),g=n(984844),v=n(331428),y=O(n(160512)),b=O(n(49400)),k=n(580032);function O(e){return e&&e.__esModule?e:{default:e}}function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(S=function(e){return e?n:t})(e)}function _(){return _=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_.apply(this,arguments)}function I(e,t,n){return(t=x(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function F(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,x(i.key),i)}}function E(e,t,n){return t&&j(e.prototype,t),n&&j(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function x(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=i(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:String(t)}function w(e,t,n){return t=C(t),function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return M(e)}(e,P()?Reflect.construct(t,n||[],C(e).constructor):t.apply(e,n))}function P(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(P=function(){return!!e})()}function C(e){return C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},C(e)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&z(e,t)}function z(e,t){return z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},z(e,t)}var R="uploading",N="success",L="error";(t.default=function(e){function t(e){var n;return F(this,t),(n=w(this,t,[e])).closePanel=n.closePanel.bind(M(n)),n.onClickOutSide=n.onClickOutSide.bind(M(n)),n.handleBeforeUpload=n.handleBeforeUpload.bind(M(n)),n.handleUploading=n.handleUploading.bind(M(n)),n.handleUploadSuccess=n.handleUploadSuccess.bind(M(n)),n.handleUploadFail=n.handleUploadFail.bind(M(n)),n.chooseFileAndUpload=n.chooseFileAndUpload.bind(M(n)),n.dragAndUpload=n.dragAndUpload.bind(M(n)),n.handleOnStart=n.handleOnStart.bind(M(n)),n.getFileListElement=n.getFileListElement.bind(M(n)),n.abort=n.abort.bind(M(n)),n.getSuffix=n.getSuffix.bind(M(n)),n.checkFileSize=n.checkFileSize.bind(M(n)),n.checkFileSuffix=n.checkFileSuffix.bind(M(n)),n.deleteFileInfo=n.deleteFileInfo.bind(M(n)),n.saveFileInfos=n.saveFileInfos.bind(M(n)),n.closeDialog=n.closeDialog.bind(M(n)),n.suffix=".rar,.zip,.png,.jpg,.xls,.xlsx",n.limitSize=10485760,n.limitCount=3,n.serverPathObj=I(I({},[h.COMMON_FILESERVER_URL],"/pulic/attachment/"),[h.IMAGE_SERVER_URL],"/pulic/picturefiled/"),n.validators={checkFileSize:n.checkFileSize,checkFileSuffix:n.checkFileSuffix},n.state={fileInfos:(0,u.Map)(),tips:"",visible:!0},n}return U(t,e),E(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"deleteFileInfo",value:function(e){var t=this,n=this.state.fileInfos,i=n.get(e);if(i){var o=i.url,l=i.status,a=i.name,r=i.size,s=i.file;Object.is(l,R)&&this.abort(i);var u=s.lastModified,f=n.delete(e);this.setState({fileInfos:f,tips:""},(function(){Object.is(l,N)&&p.default.postApi("attachment/remove.do",{path:o}),t.props.sendRemoveFile2Server&&t.props.sendRemoveFile2Server([{name:a,url:o,size:r,lastModified:u}])}))}}},{key:"onClickOutSide",value:function(e){for(var t=e.target;t;){if(t===a.default.findDOMNode(this))return;t=t.parentNode}this.closePanel()}},{key:"closePanel",value:function(){var e=this;if(this.state.fileInfos.size>0){var t=[],n=!0;this.state.fileInfos.forEach((function(e,i){var o=e.name,l=e.size,a=e.url,r=e.file,s=e.status;if(s===R&&(n=!1),!Object.is(s,L)){var u={name:o,size:l,url:a,uid:r.uid,lastModified:r.lastModified};t.push(u)}})),n?t.length>0?(this.props.sendFileUrlToServer([t]),this.closeDialog()):this.closeDialog():(0,y.default)({msg:(0,v.getLangMsg)("uploadComponent.key0009"),confirmType:0,buttonType:1,clickCallback:function(n,i,o,l){6===o&&(t.length>0&&e.props.sendFileUrlToServer([t]),e.closeDialog())}})}else this.closeDialog()}},{key:"closeDialog",value:function(){this.setState({visible:!1}),this.props.closePanel()}},{key:"checkFileSize",value:function(e,t){var n=this.props.limitSize||this.limitSize;return e.size>n&&(t.message=(0,v.getLangMsg)({key:"uploadComponent.key0001",variables:{limitSize:B(n)}}),t.status=L),t}},{key:"checkFileSuffix",value:function(e,t){var n=this.props.suffix||this.suffix,i=e.name,o=i.lastIndexOf(".");if(-1===o)t.message=(0,v.getLangMsg)({key:"uploadComponent.key0004",variables:{suffix:n}}),t.status=L;else{var l=i.substr(o).toLowerCase();-1===n.toLowerCase().indexOf(l)&&(t.message=(0,v.getLangMsg)({key:"uploadComponent.key0004",variables:{suffix:n}}),t.status=L)}return t}},{key:"saveFileInfos",value:function(e,t,n){return{fileInfos:e.set(t,n),tips:""}}},{key:"handleBeforeUpload",value:function(e,t){var n=this;this.uploadFile&&(0,f.isEqual)(this.uploadFile,t)||(t.forEach((function(e){e.uid=(0,k.generateUID)(e.uid)})),this.uploadFile=t);var i=e.name,o=e.size,l=this.state.fileInfos.filter((function(e){return e.status===N})),a=this.props.limitCount||this.limitCount,r={file:e,name:i,size:o,message:""};if(l.size+t.length>a)return this.setState({tips:(0,v.getLangMsg)({key:"uploadComponent.key0005",variables:{limitCount:a}})}),!1;var s=Object.values(this.validators).every((function(t){return r=t(e,r),!Object.is(r.status,L)}));return this.setState((function(t){var i=t.fileInfos;return n.saveFileInfos(i,e.uid,r)})),s}},{key:"handleOnStart",value:function(e){var t=this,n=e.name,i=e.size,o={file:e,name:n,size:i};this.setState((function(n){var i=n.fileInfos;return t.saveFileInfos(i,e.uid,o)}))}},{key:"handleUploading",value:function(e,t){var n=this,i=this.state.fileInfos,o=i.get(t.uid);void 0!==o&&this.setState((function(l){return o.percent=Math.round(e.percent),o.status=R,n.saveFileInfos(i,t.uid,o)}))}},{key:"handleUploadSuccess",value:function(e,t){var n=this,i=this.state.fileInfos,o=i.get(t.uid);void 0!==o&&this.setState((function(l){var a=e.status,r=e.description,s=void 0===r?(0,v.getLangMsg)("uploadComponent.key0006"):r;return a&&"error"===a?(o.status=L,o.message=s):(o.status=N,o.url=e.url),n.saveFileInfos(i,t.uid,o)}))}},{key:"handleUploadFail",value:function(e,t,n){var i=this,o=this.state.fileInfos,l=o.get(n.uid);void 0!==l&&this.setState((function(t){return l.status=L,l.message=e,i.saveFileInfos(o,n.uid,l)}))}},{key:"chooseFileAndUpload",value:function(){var e=this.refs.inner.uploader.fileInput;e&&e.click()}},{key:"dragAndUpload",value:function(e){"dragover"!==e.type?this.refs.inner.uploader.onFileDrop(e):e.preventDefault()}},{key:"abort",value:function(e){this.refs.inner.abort(e)}},{key:"getFileListElement",value:function(){return o.default.createElement("div",{className:b.default["file-list"]},o.default.createElement(D,{fileInfos:this.state.fileInfos,deleteFileInfo:this.deleteFileInfo}))}},{key:"getSuffix",value:function(){var e=this.props.suffix,t=void 0===e?this.suffix:e,n="";return t?(t.split(",").forEach((function(e,t){W[e]?n+=0===t?W[e]:",".concat(W[e]):console.warn("缺少该文件后缀",e)})),n):null}},{key:"render",value:function(){var e=this;if(!1===this.state.visible)return null;var t=this.props,n=t.suffix,i=t.title,l=t.multiple,a=t.pageId,u=t.url||h.COMMON_FILESERVER_URL,f=(0,c.getGlobalState)(),p=(0,d.getRootPageId)()(f),y=f.getIn(["forms",p,"fid"]),k={action:(0,g.appendCtsynonce)({pageId:a||p},u),accept:this.getSuffix(),multiple:l||!1,beforeUpload:this.handleBeforeUpload,onStart:this.handleOnStart,onSuccess:this.handleUploadSuccess,onProgress:this.handleUploading,onError:this.handleUploadFail,data:function(t){if(t)return{url:t.name,appId:"bos",fId:y,pageId:e.props.pageId||"",ctsynonce:(0,g.getCtsynonce)({pageId:a||p})}}},O=(0,s.default)(I(I({},b.default["import-panel-content"],!0),b.default["import-panel-content-height"],this.state.fileInfos.size>0)),S=(0,s.default)(b.default["import-panel-title"],"theme-bg"),F=(0,s.default)(b.default["title-close"],"kdfont kdfont-guanbiyulan");return o.default.createElement(m.default,{isShowClose:!1,isShowTitle:!1,height:"460px",width:"250px"},o.default.createElement("div",{className:b.default["upload-root"]},o.default.createElement("div",{className:S},o.default.createElement("span",{className:b.default["title-word"]},i||(0,v.getLangMsg)("uploadComponent.key0007")),o.default.createElement("span",{className:F,onClick:this.closePanel,title:(0,v.getLangMsg)("uploadComponent.key0008")})),o.default.createElement(r.default,_({},k,{ref:"inner"})),o.default.createElement("div",{className:O},o.default.createElement("div",{className:b.default["import-input-div"],onClick:this.chooseFileAndUpload,onDragOver:this.dragAndUpload,onDrop:this.dragAndUpload},o.default.createElement("span",{className:(0,s.default)(b.default["import-input-img"],{"kdfont kdfont-tianjia kd-hover-color":!0})}),o.default.createElement("span",{className:b.default["import-word"]},(0,v.getLangMsg)("uploadComponent.key0002")),n?o.default.createElement("span",{className:b.default["import-word"]},(0,v.getLangMsg)({key:"uploadComponent.key0003",variables:{suffix:n}})):null,this.state.tips?o.default.createElement("span",{className:b.default["file-list-tip"]},this.state.tips):null)),this.state.fileInfos.size>0?this.getFileListElement():null))}}]),t}(o.Component)).propsType={limitSize:l.default.number,multiple:l.default.bool,suffix:l.default.string,title:l.default.string,sendFileUrlToServer:l.default.func,closePanel:l.default.func,fileServer:l.default.string};var D=function(e){function t(){return F(this,t),w(this,t,arguments)}return U(t,e),E(t,[{key:"render",value:function(){var e=this.props,t=e.fileInfos,n=e.deleteFileInfo,i=[];return t.forEach((function(e,t){i.push(o.default.createElement(T,{key:t,fileInfo:e,deleteFileInfo:n}))})),o.default.createElement("ul",null,i)}}]),t}(o.Component);D.propsType={fileInfos:l.default.array.isRequired,deleteFileInfo:l.default.func.isRequired};var T=function(e){function t(){return F(this,t),w(this,t,arguments)}return U(t,e),E(t,[{key:"render",value:function(){var e=this,t=this.props.fileInfo,n=t.file,i=t.message,l=t.percent,a=t.status,r=(0,s.default)(I({"kdfont kdfont-shanchu kd-hover-color":!0},b.default.delete_but,!0)),u=(0,s.default)(b.default["file-list-img"],I(I(I(I({kdfont:!0},b.default["file-list-img-".concat(a)],!0),"kdfont-daiban","uploading"===a),"kdfont-fuxuankuangxuanzhong_yuan","success"===a),"kdfont-tishixinxi_l","error"===a)),f=void 0!==i?"[object String]"===Object.prototype.toString.call(i)?i:(0,v.getLangMsg)({key:"attachmentpanel.key0014"}):"";return o.default.createElement("li",{className:b.default["file-list-li"]},o.default.createElement("span",{className:u}),o.default.createElement("span",{className:b.default["file-list-filename"]},n.name),o.default.createElement("span",{className:b.default["file-list-filesize"]},B(n.size)),o.default.createElement("span",{className:r,onClick:function(){return e.props.deleteFileInfo(n.uid)}}),Object.is(a,R)?o.default.createElement(A,{percent:l}):o.default.createElement("span",{className:b.default["file-list-tip"]},f))}}]),t}(o.Component);T.propsType={fileInfo:l.default.object.isRequired,deleteFileInfo:l.default.func.isRequired};var A=function(e){function t(){return F(this,t),w(this,t,arguments)}return U(t,e),E(t,[{key:"render",value:function(){var e=this.props.percent,t={width:e+"%",height:"3px",backgroundColor:"#2B87F3",overflow:"hidden"};return o.default.createElement("div",{style:{width:"170px",height:"3px",backgroundColor:"#e2e2e2",overflow:"hidden"}},o.default.createElement("div",{style:t,title:"".concat(e,"%")}))}}]),t}(o.Component);A.propsType={percent:l.default.number.isRequired};var B=function(e){return e>=1048576?(Math.round(100*e/1048576)/100).toString()+"MB":(Math.round(100*e/1024)/100).toString()+"KB"},W={".doc":"application/msword",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".xls":"application/vnd.ms-excel",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".ppt":"application/vnd.ms-powerpoint",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".css":"text/css",".csv":"text/csv",".gif":"image/gif",".jpe":"image/jpeg",".jpeg":"image/jpeg",".jpg":"image/jpeg",".png":"image/png",".mp3":"audio/mpeg",".mp4":"audio/mp4,video/mp4",".pdf":"application/pdf",".zip":"application/zip",".rar":"application/x-rar-compressed",".7z":"application/x-7z-compressed",".tar":"application/x-tar",".ofd":".ofd,application/xml"}},116644:function(e,t,n){function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}n(182320),n(909112),n(697060),n(241872),n(743924),n(297336),n(336368),n(606200),n(534440),n(387912),n(78504),n(776512),n(977864),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n(76124);var o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=i(e)&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var o={__proto__:null},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var r=l?Object.getOwnPropertyDescriptor(e,a):null;r&&(r.get||r.set)?Object.defineProperty(o,a,r):o[a]=e[a]}return o.default=e,n&&n.set(e,o),o}(n(795520)),l=f(n(369396)),a=f(n(55776)),r=n(218652),s=n(608008),u=["pageId","key"];function f(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},d.apply(this,arguments)}function p(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},l=Object.keys(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}t.default=function(e){var t=e.appState,n=e.removeFile,i=e.sendUrl2Server,f=(0,o.useContext)(s.SystemUIContext),c=f.uiData,m=f.close,h=(0,o.useCallback)((function(){var e=c.pageId,s=c.key,f=p(c,u),h=(0,r.getFormConfig)(e)(t),g=h&&h.fileserver||"";return l.default.createPortal(o.default.createElement(a.default,d({fileServer:g,closePanel:m,sendRemoveFile2Server:function(t){return n(e,s,t)},sendFileUrlToServer:function(t){return i(e,s,t)},pageId:e},f)),document.body)}),[c]);return c&&Object.keys(c).length>0?h():null}}}]);