(self["webpackJsonp_bos-platform"]=self["webpackJsonp_bos-platform"]||[]).push([[4448],{331243:function(e,t,n){var r=n(387248),a=n(899928),o=n(554135);r({target:"Object",stat:!0},{fromEntries:function(e){var t={};return a(e,(function(e,n){o(t,e,n)}),void 0,!0),t}})},964972:function(e,t,n){"use strict";n.r(t),t.default={"loading-wrapper":"_103sUwKL","entity-designer-wrapper":"_1E__H_ts","tab-container":"_1NXAlMe5","entity-tab":"_2Z4h0O6F","tab-page":"_28lqITxS",hidden:"XYs3nG-6"}},440960:function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n(182320),n(909112),n(697060),n(360776),n(505684),n(241872),n(693917),n(205960),n(976896),n(721300),n(846428),n(969e3),n(606200),n(534440),n(76152),n(633768),n(690512),n(78504),n(776512),n(977864),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,n=e.model,r=e.dispatch,R=K((0,a.useState)(),2),x=R[0],B=R[1],U=K((0,a.useState)(),2),Y=U[0],W=U[1],J=K((0,a.useState)([]),2),z=J[0],H=J[1],X=(0,a.useRef)([]),q=K((0,a.useState)(),2),Z=q[0],$=q[1],Q=K((0,a.useState)(),2),ee=Q[0],te=Q[1],ne=K((0,a.useState)({}),2),re=ne[0],ae=ne[1],oe=K((0,a.useState)(!1),2),ue=oe[0],ie=oe[1],le=K((0,a.useState)({}),2),ce=le[0],fe=le[1],se=K((0,a.useState)({}),2),de=se[0],ge=se[1];(0,y.default)(n);var ve=(0,i.getDataProperty)(n.pageId,n.key,"open_args")(n.state),pe=(0,i.getDataProperty)(n.pageId,n.key,"addfield_args")(n.state),ye=(0,i.getDataProperty)(n.pageId,n.key,"delete_args")(n.state),be=(0,i.getDataProperty)(n.pageId,n.key,"menuOptions")(n.state),me=(0,i.getDataProperty)(n.pageId,n.key,"config")(n.state),he=(0,a.useRef)(),Ee=(0,a.useRef)(),_e=(0,a.useRef)({}),Oe=(0,a.useRef)(!1),Ie=(0,a.useRef)([]),ke=(0,a.useRef)(!1),Ce=(0,a.useRef)(!1),Se=((0,C.useFederatedModule)("entity").Component||{}).EntityDesigner;(0,a.useEffect)((function(){(0,d.setData)(s.KEY_TRAYMENU,!1);var e=(0,d.addDataChangeListener)(s.KEY_VALIDATE_EVENT,(function(e){var t=e.pageId;(void 0===t?"":t)===n.pageId&&Pe()})),t=n.sub_Event("setProperty",(function(){return Ae(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])})),r=n.sub_Event("setDesignMeta",(function(){return Le(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])})),a=n.sub_Event("transformModel",(function(){return Ue(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])})),o=n.sub_Event(D.SET_ENCODING_KEYS,(function(){return Ve(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])})),u=n.sub_Event(j.LOCK_PROPERTY,Ye),i=n.sub_Event(j.SET_DESIGNER_CONFIG,We),l=n.key,c=n.pageId,f=(0,b.addDataChangeListener)(c,[l,"activeTabId"],Ke),g=(0,d.addDataChangeListener)(s.KEY_PAGE_RELEASE,Je);return function(){e(),t&&n.unsub_Event(t),r&&n.unsub_Event(r),a&&n.unsub_Event(a),o&&n.unsub_Event(o),u&&n.unsub_Event(u),i&&n.unsub_Event(i),f&&f(),g&&g()}}),[]),(0,a.useEffect)((function(){if(ve){var e=ve[0],t=n.getFormConfig().clientParams||{},r=(t.modelver,t.modeltype,function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(t,T));(0,u.getEntityMetadata)(e,{onlyEntity:!0,otherParams:r}).then((function(e){B(e)}));var a=ve[2];W(a),Ee.current=a,ke.current=!1,Ce.current=null,$(Z)}}),[ve]),(0,a.useEffect)((function(){if(be.length>0){var e=be[0].id;te(e),Ie.current.unshift(e),_e.current[e]={}}}),[be]);var we=function(e){ke.current?Ee.current=(0,w.default)(e,Ce.current,"entitymeta"):Ee.current=e,Oe.current=!0};(0,a.useEffect)((function(){if(pe){var e=pe[0],t=e.entityId,n=(e.isStd,e.fields);n&&n.forEach((function(e){var n,r=e.fieldName,a=e.fieldNumber,o=e.fieldType;null===(n=he.current)||void 0===n||n.addField(o,t,r,a)}))}}),[pe]),(0,a.useEffect)((function(){if(ye){var e=ye[0],t=he.current;null==t||t.deleteControl(e.id)}}),[ye]);var Pe=function(){setTimeout((function(){Me(),r((0,O.save)(n))}),200)},De=(0,a.useCallback)((function(e){!ke.current&&(ke.current=!0),Ce.current=e,Te((0,M.getLangMsg)("ProFormDesignerBar.key0001"),0),we(Ee.current)}),[]),Me=function(){var e,t,a,o=n.pageId,u=n.key,l=(0,S.cloneDeep)(Ee.current);if(null!==(e=l.entitymeta)&&void 0!==e&&e.Items){var c,f=je(null==l||null===(c=l.entitymeta)||void 0===c?void 0:c.Items);X.current.length>0?(0,P.encodeDesignerValue)(f,X.current):z.length>0&&(0,P.encodeDesignerRule)(f,z),l.entitymeta.Items=f}if(null!=l&&null!==(t=l.formmeta)&&void 0!==t&&t.Items)if(X.current.length>0)(0,P.encodeDesignerValue)(null==l||null===(a=l.formmeta)||void 0===a?void 0:a.Items,X.current);else if(z.length>0){var s;(0,P.encodeDesignerRule)(null==l||null===(s=l.formmeta)||void 0===s?void 0:s.Items,z)}r((0,i.convertAppModelFunctionAction)((0,i.setControlPostValue)(o,u,l)))},je=function(){var e={};return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((function(t){var n=t.ParentId;return n?(e[n]=void 0===e[n]?0:e[n]+1,G(G({},t),{},{Index:e[n]})):t}))},Ae=(0,a.useCallback)((function(e){var t;he.current&&(null===(t=he.current)||void 0===t||t.setProperty(e))}),[]),Le=(0,a.useCallback)((function(e){ae(e),ie(!0)}),[]),Ne=(0,a.useCallback)((function(e){te("entityandfield"),Ie.current.unshift("entityandfield"),ie(!1)}),[]),Te=(0,a.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=n.pageId,a={type:t,content:e,duration:2e3,level:v.MSG_LEVEL.warning,pageId:r};(0,i.setDataMessages)(r,a)}),[n]),Re=(0,a.useCallback)((function(e,t){r((0,l.property_editor_click)(n,e,t))}),[]),xe=(0,a.useCallback)((function(e,t){var n=Ee.current,r=he.current,a=r.uiModel;return(0,c.default)({field:e,extendData:t,uiInfo:n,uiModel:a,kdesignerApi:r})}),[]),Be=(0,a.useCallback)((function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=t,u=o.Id,i=n.Form,l=n.Extenddata,c=Object.entries(o).filter((function(e){var t=K(e,2);t[0];return""!==t[1]})),s=Object.fromEntries(c),d=[];l&&(Array.isArray(l)?l.forEach((function(e){d.push(xe(s,e))})):d=xe(s,l));var g=s[e]?{value:s[e]}:{};return[u,r,e,G(G({form:(0,f.default)(i)},g),{},{context:d,item:{Id:u,_Type_:t._Type_}},a)]}),[]),Ge=(0,a.useCallback)((function(e,t,n){if(!1!==n.Editable){var r=Be(e,t,n,V);X.current.length>0&&(0,P.encodePropertyValue)(r,X.current),Re("getPropertyAlias",r)}}),[]),Fe=(0,a.useCallback)((function(e,t,n,r){var a=Be(e,t,n,V,r);X.current.length>0&&(0,P.encodePropertyValue)(a,X.current),Re("click",a)}),[]),Ke=function(e){te(e)},Ue=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if((0,i.getRootEncodeMethod)()){(0,d.setData)(s.KEY_KDBASE64,"kdbase64");var t=K(e,2)[1];H(t||[])}},Ve=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(0,i.getRootEncodeMethod)();if(t){var n;(0,d.setData)(s.KEY_ENCODE_METHOD,t);var r=null===(n=e[0])||void 0===n?void 0:n.default;X.current=r||[]}},Ye=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])[0];e&&fe(e)},We=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])[0];e&&ge(e)},Je=function(e){Object.keys(_e.current||{}).forEach((function(t){var n;if((null===(n=_e.current[t])||void 0===n?void 0:n.pageId)===e){var r;delete _e.current[t];var a=(null===(r=Ie.current)||void 0===r?void 0:r[0])||"entityandfield";te(a)}}))},ze=(0,b.getUserUIState)(n),He=(null===(t=ze.getIn(["entityDesigner","userConfig"]))||void 0===t?void 0:t.toJS())||{showLeftView:!1,showKey:!1,showType:!1,showFullRelationship:!1},Xe=(lt=(0,o.getGlobalState)(),ct=(0,I.getRootPageId)()(lt),(0,I.getFormConfigWithoutMeta)(ct)(lt)),qe=n.pageId,Ze=n.key,$e=(0,_.getCommonClass)(n),Qe=$e.Grow,et=$e.Shrink,tt=$e.AlignSelf,nt=(0,h.default)(F({},p.default["entity-designer-wrapper"],!0),(0,E.default)({Grow:Qe,Shrink:et,AlignSelf:tt})),rt=(0,h.default)(F(F({},p.default["entity-tab"],!0),p.default.hidden,"entityandfield"!==ee)),at=n.getMetaProperty(A.CONFIG_ITEMS),ot=null==at?void 0:at.get(A.LOGO),ut=n.getUserLocale(),it=(0,M.getCurrentLang)()||"zh_CN";var lt,ct;if("ie"===(0,L.getBrowserData)())return a.default.createElement(N.default,null);return x&&Y?a.default.createElement("div",{className:nt},a.default.createElement(m.default,{menuOptions:be,onSelectMenu:function(e){var t;te(e);var a=Ie.current.findIndex((function(t){return t===e}));if(a>-1&&Ie.current.splice(a,1),Ie.current.unshift(e),"entityandfield"!==e){"entityandfield"===ee&&"entityandfield"!==e&&Oe.current&&(Me(),Oe.current=!1);var o=(null===(t=_e.current[e])||void 0===t?void 0:t.pageId)||"";r((0,O.tabClick)(n,[e,o]))}},showPreviewBtn:!1,onSave:Pe,showMetaBtn:"zh_CN"===it,onClickMetaBtn:function(){var e;"entityandfield"===ee&&Oe.current&&(Me(),Oe.current=!1),te("meta");var t=(null===(e=_e.current.meta)||void 0===e?void 0:e.pageId)||"";r((0,O.tabClick)(n,["meta",t]))},showLockBtn:me.showExtensibleBtn,onClickLockBtn:function(){var e;"entityandfield"===ee&&Oe.current&&(Me(),Oe.current=!1),te("extensible");var t=(null===(e=_e.current.extensible)||void 0===e?void 0:e.pageId)||"";r((0,O.tabClick)(n,["extensible",t]))},showGotoLayoutBtn:!0,onClickGotoLayoutBtn:function(){r((0,O.tabClick)(n,["gotolayout",""]))},onClickGPTBtn:function(){r((0,O.tabClick)(n,["gpt",""]))},activeTabId:ee,pageId:qe,controlKey:Ze,userLocale:ut,logo:ot}),a.default.createElement("div",{className:p.default["tab-container"]},a.default.createElement("div",{className:rt},a.default.createElement(a.default.Suspense,{fallback:"loading"},Se&&a.default.createElement(Se,{name:"EntityDesigner",meta:x,data:Y,onData:we,getPropertyAliasValue:Ge,invokeAction:Re,showMessage:Te,handleCustomInputEditor:Fe,onApi:function(e){he.current=G({},e)},userConfig:He,onUserConfigChange:function(e){var t=he.current.getUserConfig();(0,b.setUserUIState)(n.pageId,["entityDesigner","userConfig"],t,!0)},showLockBtn:me.showExtensibleBtn,config:Xe,getLangMsg:M.getLangMsg,lockPropsMap:ce,designerConfig:de}))),(ft=(0,_.getControlSubFormsMap)(n.pageId,n.meta.get("id"),n.state),Object.keys(ft).map((function(e){var t,r=(0,I.getFormConfig)(e)(n.state),o=null==r||null===(t=r.openStyle)||void 0===t?void 0:t.tabId,u=null==r?void 0:r.pageId;_e.current[o]={pageId:u};var i=(0,h.default)(F(F({},p.default["tab-page"],!0),p.default.hidden,ee!==o));return a.default.createElement("div",{key:e,className:i},ft[e])})))),ue&&a.default.createElement(k.default,{designerNodeMetaInfo:re,designerData:Ee.current,designerMeta:x,open:ue,onClose:Ne,save:De,onCloseDesigner:Ne,model:n,invokeAction:Re,metaType:"entitymeta",showMessage:Te})):a.default.createElement("div",{className:p.default["loading-wrapper"]},a.default.createElement(g.default,null));var ft},n(622676),n(613468),n(233696),n(323784),n(743924),n(835164),n(927184),n(28292),n(331243),n(76124),n(387912),n(997308),n(86744);var a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=r(e)&&"function"!=typeof e)return{default:e};var n=x(t);if(n&&n.has(e))return n.get(e);var a={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=o?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(a,u,i):a[u]=e[u]}return a.default=e,n&&n.set(e,a),a}(n(795520)),o=n(211152),u=n(525896),i=n(218652),l=n(887084),c=R(n(935e3)),f=R(n(768696)),s=n(868256),d=n(674260),g=R(n(127360)),v=n(545072),p=R(n(964972)),y=R(n(472632)),b=n(738704),m=R(n(345692)),h=R(n(671252)),E=R(n(329132)),_=n(439532),O=n(858496),I=n(218652),k=R(n(487376)),C=n(869504),S=n(790832),w=R(n(628676)),P=n(811596),D=n(195196),M=n(331428),j=n(681868),A=n(290600),L=n(589200),N=R(n(810972)),T=["modelver","modeltype"];function R(e){return e&&e.__esModule?e:{default:e}}function x(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(x=function(e){return e?n:t})(e)}function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){F(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function F(e,t,n){var a;return a=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==r(a)?a:String(a))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function K(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,u,i=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{if(!l&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw a}}return i}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return U(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var V="entitymeta"}}]);