(self["webpackJsonp_bos-platform"]=self["webpackJsonp_bos-platform"]||[]).push([[4448,9860],{331243:function(e,t,n){var r=n(387248),a=n(899928),o=n(554135);r({target:"Object",stat:!0},{fromEntries:function(e){var t={};return a(e,(function(e,n){o(t,e,n)}),void 0,!0),t}})},964972:function(e,t,n){"use strict";n.r(t),t.default={"loading-wrapper":"_103sUwKL","entity-designer-wrapper":"_1E__H_ts","tab-container":"_1NXAlMe5","entity-tab":"_2Z4h0O6F","tab-page":"_28lqITxS",hidden:"XYs3nG-6"}},440960:function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n(182320),n(909112),n(697060),n(360776),n(505684),n(241872),n(693917),n(205960),n(976896),n(721300),n(846428),n(969e3),n(606200),n(534440),n(76152),n(633768),n(690512),n(78504),n(776512),n(977864),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,n=e.model,r=e.dispatch,x=U((0,a.useState)(),2),B=x[0],G=x[1],V=U((0,a.useState)(),2),W=V[0],J=V[1],z=U((0,a.useState)([]),2),H=z[0],X=z[1],q=(0,a.useRef)([]),Z=U((0,a.useState)(),2),$=Z[0],Q=Z[1],ee=U((0,a.useState)(),2),te=ee[0],ne=ee[1],re=U((0,a.useState)({}),2),ae=re[0],oe=re[1],ie=U((0,a.useState)(!1),2),ue=ie[0],le=ie[1],ce=U((0,a.useState)({}),2),fe=ce[0],se=ce[1],de=U((0,a.useState)({}),2),ge=de[0],pe=de[1];(0,y.default)(n);var ve=(0,u.getDataProperty)(n.pageId,n.key,"open_args")(n.state),ye=(0,u.getDataProperty)(n.pageId,n.key,"addfield_args")(n.state),be=(0,u.getDataProperty)(n.pageId,n.key,"delete_args")(n.state),me=(0,u.getDataProperty)(n.pageId,n.key,"menuOptions")(n.state),he=(0,u.getDataProperty)(n.pageId,n.key,"config")(n.state),Ee=(0,a.useRef)(),ke=(0,a.useRef)(),Oe=(0,a.useRef)({}),Ie=(0,a.useRef)(!1),Ce=(0,a.useRef)([]),Se=(0,a.useRef)(!1),we=(0,a.useRef)(!1),_e=((0,S.useFederatedModule)("entity").Component||{}).EntityDesigner;(0,a.useEffect)((function(){(0,d.setData)(s.KEY_TRAYMENU,!1);var e=(0,d.addDataChangeListener)(s.KEY_VALIDATE_EVENT,(function(e){var t=e.pageId;(void 0===t?"":t)===n.pageId&&Me()})),t=n.key,r=n.pageId,a=(0,b.addDataChangeListener)(r,[t,"activeTabId"],Ve),o=(0,d.addDataChangeListener)(s.KEY_PAGE_RELEASE,He),i=(0,T.subscribeControlMethod)(r,t,"directives",(function(e){void 0!==e&&Pe(e)}));return(0,b.setControlMount)(r,t,!0),function(){(0,b.setControlMount)(r,t,!1),e(),a&&a(),o&&o(),i&&i()}}),[]),(0,a.useEffect)((function(){if(ve){var e=ve[0],t=n.getFormConfig().clientParams||{},r=(t.modelver,t.modeltype,function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(t,R));(0,i.getEntityMetadata)(e,{onlyEntity:!0,otherParams:r}).then((function(e){G(e)}));var a=ve[2];J(a),ke.current=a,Se.current=!1,we.current=null,Q($)}}),[ve]),(0,a.useEffect)((function(){if(me.length>0){var e=me[0].id;ne(e),Ce.current.unshift(e),Oe.current[e]={}}}),[me]);var Pe=function(e){e.forEach((function(e){var t=e.methodname,n=e.args;switch(t){case"setProperty":Ne(n);break;case"setDesignMeta":Te(n);break;case"transformModel":Ye(n);break;case D.SET_ENCODING_KEYS:We(n);break;case j.LOCK_PROPERTY:Je(n);break;case j.SET_DESIGNER_CONFIG:ze(n)}}))},De=function(e){Se.current?ke.current=(0,_.default)(e,we.current,"entitymeta"):ke.current=e,Ie.current=!0};(0,a.useEffect)((function(){if(ye){var e=ye[0],t=e.entityId,n=(e.isStd,e.fields);n&&n.forEach((function(e){var n,r=e.fieldName,a=e.fieldNumber,o=e.fieldType;null===(n=Ee.current)||void 0===n||n.addField(o,t,r,a)}))}}),[ye]),(0,a.useEffect)((function(){if(be){var e=be[0],t=Ee.current;null==t||t.deleteControl(e.id)}}),[be]);var Me=function(){setTimeout((function(){Ae(),r((0,O.save)(n))}),200)},je=(0,a.useCallback)((function(e){!Se.current&&(Se.current=!0),we.current=e,xe((0,M.getLangMsg)("ProFormDesignerBar.key0001"),0),De(ke.current)}),[]),Ae=function(){var e,t,a,o=n.pageId,i=n.key,l=(0,w.cloneDeep)(ke.current);if(null!==(e=l.entitymeta)&&void 0!==e&&e.Items){var c,f=Le(null==l||null===(c=l.entitymeta)||void 0===c?void 0:c.Items);q.current.length>0?(0,P.encodeDesignerValue)(f,q.current):H.length>0&&(0,P.encodeDesignerRule)(f,H),l.entitymeta.Items=f}if(null!=l&&null!==(t=l.formmeta)&&void 0!==t&&t.Items)if(q.current.length>0)(0,P.encodeDesignerValue)(null==l||null===(a=l.formmeta)||void 0===a?void 0:a.Items,q.current);else if(H.length>0){var s;(0,P.encodeDesignerRule)(null==l||null===(s=l.formmeta)||void 0===s?void 0:s.Items,H)}r((0,u.convertAppModelFunctionAction)((0,u.setControlPostValue)(o,i,l)))},Le=function(){var e={};return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((function(t){var n=t.ParentId;return n?(e[n]=void 0===e[n]?0:e[n]+1,F(F({},t),{},{Index:e[n]})):t}))},Ne=(0,a.useCallback)((function(e){var t;Ee.current&&(null===(t=Ee.current)||void 0===t||t.setProperty(e))}),[]),Te=(0,a.useCallback)((function(e){oe(e),le(!0)}),[]),Re=(0,a.useCallback)((function(e){ne("entityandfield"),Ce.current.unshift("entityandfield"),le(!1)}),[]),xe=(0,a.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=n.pageId,a={type:t,content:e,duration:2e3,level:p.MSG_LEVEL.warning,pageId:r};(0,u.setDataMessages)(r,a)}),[n]),Be=(0,a.useCallback)((function(e,t){r((0,l.property_editor_click)(n,e,t))}),[]),Ge=(0,a.useCallback)((function(e,t){var n=ke.current,r=Ee.current,a=r.uiModel;return(0,c.default)({field:e,extendData:t,uiInfo:n,uiModel:a,kdesignerApi:r})}),[]),Fe=(0,a.useCallback)((function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=t,i=o.Id,u=n.Form,l=n.Extenddata,c=Object.entries(o).filter((function(e){var t=U(e,2);t[0];return""!==t[1]})),s=Object.fromEntries(c),d=[];l&&(Array.isArray(l)?l.forEach((function(e){d.push(Ge(s,e))})):d=Ge(s,l));var g=s[e]?{value:s[e]}:{};return[i,r,e,F(F({form:(0,f.default)(u)},g),{},{context:d,item:{Id:i,_Type_:t._Type_}},a)]}),[]),Ke=(0,a.useCallback)((function(e,t,n){if(!1!==n.Editable){var r=Fe(e,t,n,Y);q.current.length>0&&(0,P.encodePropertyValue)(r,q.current),Be("getPropertyAlias",r)}}),[]),Ue=(0,a.useCallback)((function(e,t,n,r){var a=Fe(e,t,n,Y,r);q.current.length>0&&(0,P.encodePropertyValue)(a,q.current),Be("click",a)}),[]),Ve=function(e){ne(e)},Ye=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if((0,u.getRootEncodeMethod)()){(0,d.setData)(s.KEY_KDBASE64,"kdbase64");var t=U(e,2)[1];X(t||[])}},We=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(0,u.getRootEncodeMethod)();if(t){var n;(0,d.setData)(s.KEY_ENCODE_METHOD,t);var r=null===(n=e[0])||void 0===n?void 0:n.default;q.current=r||[]}},Je=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])[0];e&&se(e)},ze=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])[0];e&&pe(e)},He=function(e){Object.keys(Oe.current||{}).forEach((function(t){var n;if((null===(n=Oe.current[t])||void 0===n?void 0:n.pageId)===e){var r;delete Oe.current[t];var a=(null===(r=Ce.current)||void 0===r?void 0:r[0])||"entityandfield";ne(a)}}))},Xe=(0,b.getUserUIState)(n),qe=(null===(t=Xe.getIn(["entityDesigner","userConfig"]))||void 0===t?void 0:t.toJS())||{showLeftView:!1,showKey:!1,showType:!1,showFullRelationship:!1},Ze=(ft=(0,o.getGlobalState)(),st=(0,I.getRootPageId)()(ft),(0,I.getFormConfigWithoutMeta)(st)(ft)),$e=n.pageId,Qe=n.key,et=(0,k.getCommonClass)(n),tt=et.Grow,nt=et.Shrink,rt=et.AlignSelf,at=(0,h.default)(K({},v.default["entity-designer-wrapper"],!0),(0,E.default)({Grow:tt,Shrink:nt,AlignSelf:rt})),ot=(0,h.default)(K(K({},v.default["entity-tab"],!0),v.default.hidden,"entityandfield"!==te)),it=n.getMetaProperty(A.CONFIG_ITEMS),ut=null==it?void 0:it.get(A.LOGO),lt=n.getUserLocale(),ct=(0,M.getCurrentLang)()||"zh_CN";var ft,st;if("ie"===(0,L.getBrowserData)())return a.default.createElement(N.default,null);return B&&W?a.default.createElement("div",{className:at},a.default.createElement(m.default,{menuOptions:me,onSelectMenu:function(e){var t;ne(e);var a=Ce.current.findIndex((function(t){return t===e}));if(a>-1&&Ce.current.splice(a,1),Ce.current.unshift(e),"entityandfield"!==e){"entityandfield"===te&&"entityandfield"!==e&&Ie.current&&(Ae(),Ie.current=!1);var o=(null===(t=Oe.current[e])||void 0===t?void 0:t.pageId)||"";r((0,O.tabClick)(n,[e,o]))}},showPreviewBtn:!1,onSave:Me,showMetaBtn:"zh_CN"===ct,onClickMetaBtn:function(){var e;"entityandfield"===te&&Ie.current&&(Ae(),Ie.current=!1),ne("meta");var t=(null===(e=Oe.current.meta)||void 0===e?void 0:e.pageId)||"";r((0,O.tabClick)(n,["meta",t]))},showLockBtn:he.showExtensibleBtn,onClickLockBtn:function(){var e;"entityandfield"===te&&Ie.current&&(Ae(),Ie.current=!1),ne("extensible");var t=(null===(e=Oe.current.extensible)||void 0===e?void 0:e.pageId)||"";r((0,O.tabClick)(n,["extensible",t]))},showGotoLayoutBtn:!0,onClickGotoLayoutBtn:function(){r((0,O.tabClick)(n,["gotolayout",""]))},onClickGPTBtn:function(){r((0,O.tabClick)(n,["gpt",""]))},activeTabId:te,pageId:$e,controlKey:Qe,userLocale:lt,logo:ut}),a.default.createElement("div",{className:v.default["tab-container"]},a.default.createElement("div",{className:ot},a.default.createElement(a.default.Suspense,{fallback:"loading"},_e&&a.default.createElement(_e,{name:"EntityDesigner",meta:B,data:W,onData:De,getPropertyAliasValue:Ke,invokeAction:Be,showMessage:xe,handleCustomInputEditor:Ue,onApi:function(e){Ee.current=F({},e)},userConfig:qe,onUserConfigChange:function(e){var t=Ee.current.getUserConfig();(0,b.setUserUIState)(n.pageId,["entityDesigner","userConfig"],t,!0)},showLockBtn:he.showExtensibleBtn,config:Ze,getLangMsg:M.getLangMsg,lockPropsMap:fe,designerConfig:ge}))),(dt=(0,k.getControlSubFormsMap)(n.pageId,n.meta.get("id"),n.state),Object.keys(dt).map((function(e){var t,r=(0,I.getFormConfig)(e)(n.state),o=null==r||null===(t=r.openStyle)||void 0===t?void 0:t.tabId,i=null==r?void 0:r.pageId;Oe.current[o]={pageId:i};var u=(0,h.default)(K(K({},v.default["tab-page"],!0),v.default.hidden,te!==o));return a.default.createElement("div",{key:e,className:u},dt[e])})))),ue&&a.default.createElement(C.default,{designerNodeMetaInfo:ae,designerData:ke.current,designerMeta:B,open:ue,onClose:Re,save:je,onCloseDesigner:Re,model:n,invokeAction:Be,metaType:"entitymeta",showMessage:xe})):a.default.createElement("div",{className:v.default["loading-wrapper"]},a.default.createElement(g.default,null));var dt},n(622676),n(613468),n(233696),n(323784),n(743924),n(835164),n(927184),n(28292),n(331243),n(76124),n(387912),n(997308),n(86744);var a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=r(e)&&"function"!=typeof e)return{default:e};var n=B(t);if(n&&n.has(e))return n.get(e);var a={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var u=o?Object.getOwnPropertyDescriptor(e,i):null;u&&(u.get||u.set)?Object.defineProperty(a,i,u):a[i]=e[i]}return a.default=e,n&&n.set(e,a),a}(n(795520)),o=n(211152),i=n(525896),u=n(218652),l=n(887084),c=x(n(935e3)),f=x(n(768696)),s=n(868256),d=n(674260),g=x(n(127360)),p=n(545072),v=x(n(964972)),y=x(n(472632)),b=n(738704),m=x(n(345692)),h=x(n(671252)),E=x(n(329132)),k=n(439532),O=n(858496),I=n(218652),C=x(n(487376)),S=n(869504),w=n(790832),_=x(n(628676)),P=n(811596),D=n(195196),M=n(331428),j=n(681868),A=n(290600),L=n(589200),N=x(n(810972)),T=n(738704),R=["modelver","modeltype"];function x(e){return e&&e.__esModule?e:{default:e}}function B(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(B=function(e){return e?n:t})(e)}function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){K(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function K(e,t,n){var a;return a=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==r(a)?a:String(a))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,i,u=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(u.push(r.value),u.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw a}}return u}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return V(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return V(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Y="entitymeta"}}]);