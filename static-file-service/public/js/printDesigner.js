"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackJsonp_bos-platform"] = self["webpackJsonp_bos-platform"] || []).push([[7856],{

/***/ "./src/component/web/KDPrintDesigner/KDPrintDesigner.jsx":
/*!***************************************************************!*\
  !*** ./src/component/web/KDPrintDesigner/KDPrintDesigner.jsx ***!
  \***************************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {

eval("\n\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"../../node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"../../node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"../../node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"../../node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.from.js */ \"../../node_modules/core-js/modules/es.array.from.js\");\n__webpack_require__(/*! core-js/modules/es.array.index-of.js */ \"../../node_modules/core-js/modules/es.array.index-of.js\");\n__webpack_require__(/*! core-js/modules/es.array.is-array.js */ \"../../node_modules/core-js/modules/es.array.is-array.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"../../node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"../../node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-string.js */ \"../../node_modules/core-js/modules/es.date.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.function.bind.js */ \"../../node_modules/core-js/modules/es.function.bind.js\");\n__webpack_require__(/*! core-js/modules/es.function.name.js */ \"../../node_modules/core-js/modules/es.function.name.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"../../node_modules/core-js/modules/es.number.constructor.js\");\n__webpack_require__(/*! core-js/modules/es.object.create.js */ \"../../node_modules/core-js/modules/es.object.create.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-properties.js */ \"../../node_modules/core-js/modules/es.object.define-properties.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"../../node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-own-property-descriptor.js */ \"../../node_modules/core-js/modules/es.object.get-own-property-descriptor.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-own-property-descriptors.js */ \"../../node_modules/core-js/modules/es.object.get-own-property-descriptors.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-prototype-of.js */ \"../../node_modules/core-js/modules/es.object.get-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.keys.js */ \"../../node_modules/core-js/modules/es.object.keys.js\");\n__webpack_require__(/*! core-js/modules/es.object.set-prototype-of.js */ \"../../node_modules/core-js/modules/es.object.set-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.reflect.construct.js */ \"../../node_modules/core-js/modules/es.reflect.construct.js\");\n__webpack_require__(/*! core-js/modules/es.regexp.exec.js */ \"../../node_modules/core-js/modules/es.regexp.exec.js\");\n__webpack_require__(/*! core-js/modules/es.regexp.to-string.js */ \"../../node_modules/core-js/modules/es.regexp.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"../../node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.weak-map.js */ \"../../node_modules/core-js/modules/es.weak-map.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"../../node_modules/core-js/modules/web.dom-collections.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", ({\n  value: true\n}));\nexports[\"default\"] = void 0;\n__webpack_require__(/*! core-js/modules/es.array.concat.js */ \"../../node_modules/core-js/modules/es.array.concat.js\");\n__webpack_require__(/*! core-js/modules/es.array.filter.js */ \"../../node_modules/core-js/modules/es.array.filter.js\");\n__webpack_require__(/*! core-js/modules/es.array.for-each.js */ \"../../node_modules/core-js/modules/es.array.for-each.js\");\n__webpack_require__(/*! core-js/modules/es.array.includes.js */ \"../../node_modules/core-js/modules/es.array.includes.js\");\n__webpack_require__(/*! core-js/modules/es.array.join.js */ \"../../node_modules/core-js/modules/es.array.join.js\");\n__webpack_require__(/*! core-js/modules/es.array.map.js */ \"../../node_modules/core-js/modules/es.array.map.js\");\n__webpack_require__(/*! core-js/modules/es.array.reduce.js */ \"../../node_modules/core-js/modules/es.array.reduce.js\");\n__webpack_require__(/*! core-js/modules/es.array.slice.js */ \"../../node_modules/core-js/modules/es.array.slice.js\");\n__webpack_require__(/*! core-js/modules/es.array.splice.js */ \"../../node_modules/core-js/modules/es.array.splice.js\");\n__webpack_require__(/*! core-js/modules/es.object.assign.js */ \"../../node_modules/core-js/modules/es.object.assign.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"../../node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.string.includes.js */ \"../../node_modules/core-js/modules/es.string.includes.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.for-each.js */ \"../../node_modules/core-js/modules/web.dom-collections.for-each.js\");\nvar _global = _interopRequireWildcard(__webpack_require__(/*! @/global */ \"./src/global/index.js\"));\nvar _react = _interopRequireWildcard(__webpack_require__(/*! react */ \"webpack/sharing/consume/default/react/react?dca2\"));\nvar _lodash = _interopRequireDefault(__webpack_require__(/*! lodash */ \"../../node_modules/lodash/lodash.js\"));\nvar _appModelFunction = __webpack_require__(/*! @/model/appModelFunction */ \"./src/model/appModelFunction.js\");\nvar _GlobalDataCacher = __webpack_require__(/*! @/model/GlobalDataCacher */ \"./src/model/GlobalDataCacher.js\");\nvar _AttachDataWrap = _interopRequireDefault(__webpack_require__(/*! ../../common/AttachDataWrap */ \"./src/component/common/AttachDataWrap.js\"));\nvar _symbolConst = __webpack_require__(/*! @/constant/symbolConst */ \"./src/constant/symbolConst.js\");\nvar _VisibleLockWrap = _interopRequireDefault(__webpack_require__(/*! ../../common/VisibleLockWrap */ \"./src/component/common/VisibleLockWrap.js\"));\nvar _KDPrintDesigner2 = _interopRequireDefault(__webpack_require__(/*! ./KDPrintDesigner.less */ \"./src/component/web/KDPrintDesigner/KDPrintDesigner.less\"));\nvar _api = __webpack_require__(/*! @/designer/utils/api */ \"./src/designer/utils/api.js\");\nvar _const = __webpack_require__(/*! @/constant/const */ \"./src/constant/const.js\");\nvar _kdesign = __webpack_require__(/*! @kdcloudjs/kdesign */ \"webpack/sharing/consume/default/@kdcloudjs/kdesign/@kdcloudjs/kdesign\");\nvar _console = _interopRequireDefault(__webpack_require__(/*! @/api/console */ \"./src/api/console.js\"));\nvar _useFederationModule = __webpack_require__(/*! @/hooks/useFederationModule.js */ \"./src/hooks/useFederationModule.js\");\nvar _PageManage = _interopRequireWildcard(__webpack_require__(/*! ./PageManage */ \"./src/component/web/KDPrintDesigner/PageManage.jsx\"));\nvar _action = __webpack_require__(/*! @/action/action.js */ \"./src/action/action.js\");\nvar _intlApi = __webpack_require__(/*! @/i18n/intlApi */ \"./src/i18n/intlApi.js\");\nvar _client = __webpack_require__(/*! @/action/actionname/global/custom/client */ \"./src/action/actionname/global/custom/client/index.js\");\nvar _excluded = [\"paper\", \"pages\"],\n  _excluded2 = [\"module\"];\nvar _dec, _class;\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\nfunction _getRequireWildcardCache(e) { if (\"function\" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(e) { return e ? t : r; })(e); }\nfunction _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || \"object\" != _typeof(e) && \"function\" != typeof e) return { \"default\": e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if (\"default\" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n[\"default\"] = e, t && t.set(e, n), n; }\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\nvar CHANGE_FILE_NAME = 'prtChangeFileName'; // 找不到使用代码，应该已经废弃\nvar inc = 0;\nvar KDPrintDesigner = (_dec = (0, _VisibleLockWrap[\"default\"])(true), (0, _AttachDataWrap[\"default\"])(_class = _dec(_class = /*#__PURE__*/function (_React$Component) {\n  _inherits(KDPrintDesigner, _React$Component);\n  function KDPrintDesigner(props) {\n    var _this;\n    _classCallCheck(this, KDPrintDesigner);\n    _this = _callSuper(this, KDPrintDesigner, [props]);\n    // 去掉系统侧边栏/自定义悬浮菜单\n    _this.showMessage = function (msg) {\n      var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 2;\n      var pageId = _this.props.model.pageId;\n      var messageData = {\n        type: type,\n        // 类型\n        // msgname: 'ShowNotificationMsg',\n        content: msg,\n        duration: 2000,\n        // message: msg,\n        level: _const.MSG_LEVEL.warning,\n        // detail: msg,\n        // messageKey: Math.random().toString(36).substr(2),\n        pageId: pageId\n      };\n      (0, _appModelFunction.setDataMessages)(pageId, messageData);\n    };\n    _this.handleOpenCustomDsModal = function () {\n      _this.invokeComponentCustomEvent(_client.CUSTOM_EVENT_OPEN_CUSTOMDS_MODAL);\n    };\n    _this.handleOpenRefDsModal = function () {\n      _this.invokeComponentCustomEvent(_client.CUSTOM_EVENT_OPEN_REFDS_MODAL);\n    };\n    _this.handleChangePLang = function (lang, saveFlag) {\n      saveFlag && _this.save();\n      var postData = _this.props.model.getPost();\n      var args = saveFlag ? {\n        language: lang,\n        postData: postData\n      } : {\n        language: lang\n      };\n      _this.invokeComponentCustomEvent(_client.CUSTOM_EVENT_CHANGE_PRINT_LANG, args);\n    };\n    _this.handlePassGridActionGuide = function () {\n      _this.invokeComponentCustomEvent(_client.CUSTOM_EVENT_PASS_GRID_ACTION_GUIDE);\n    };\n    _this.handlePassPrintActionGuide = function () {\n      _this.invokeComponentCustomEvent(_client.CUSTOM_EVENT_PASS_PRINT_ACTION_GUIDE);\n    };\n    _this.handleOpenDGridSortSettingEdModal = function (args) {\n      _this.invokeComponentCustomEvent(_client.CUSTOM_EVENT_OPEN_GRID_SORT_FIELDS, args);\n    };\n    _this.handleOpenDGridFilterSettingEdModal = function (args) {\n      _this.invokeComponentCustomEvent(_client.CUSTOM_EVENT_OPEN_GRID_FILTER_SETTING, args);\n    };\n    _this.handleChangeFileName = function (args) {\n      _this.invokeComponentCustomEvent(CHANGE_FILE_NAME, args);\n    };\n    _this.invokePrintDesignerCustomEvent = function (name, args) {\n      _this.invokeComponentCustomEvent(name, args);\n    };\n    _this.getPrintData = function () {\n      _this.save();\n      var _this$props = _this.props,\n        model = _this$props.model,\n        dispatch = _this$props.dispatch;\n      var data = _lodash[\"default\"].cloneDeep(_this.state.data);\n      data.pages.forEach(function (page) {\n        // TODO 原设计方案改动了源数据，导致后续用到分组的key全部需要特殊处理；\n        page.forEach(function (controlData) {\n          var _controlData$mergeSum;\n          controlData.bindField = _this.filterKeys(controlData.bindField);\n          controlData.mergeByField = _this.filterKeys(controlData.mergeByField);\n          controlData.mergeSummaryField = ((_controlData$mergeSum = controlData.mergeSummaryField) === null || _controlData$mergeSum === void 0 ? void 0 : _controlData$mergeSum.map(_this.filterKeys)) || [];\n        });\n      });\n      dispatch((0, _action.invokeControlService)(model, 'updatePrintData', [data]));\n    };\n    _this.componentDidMount = function () {\n      _this.setPropertyHandler = _this.props.model.sub_Event('updateSortFields', function () {\n        var args = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n        return _this.setProperty(args);\n      });\n      _this.updateFilterSetting = _this.props.model.sub_Event('updateFilterSetting', function () {\n        var args = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n        return _this.setProperty(args, 'filterSetting');\n      });\n      _this.updateFileName = _this.props.model.sub_Event('updateFileName', function () {\n        var args = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n        return _this.setProperty(args, 'fileName');\n      });\n      _this.removeInstructListener = (0, _GlobalDataCacher.addDataChangeListener)(_symbolConst.KEY_GET_PRINT_DATA, _this.getPrintData);\n      _this.removeValidateEventListener = (0, _GlobalDataCacher.addDataChangeListener)(_symbolConst.KEY_VALIDATE_EVENT, function (_ref) {\n        var _ref$pageId = _ref.pageId,\n          pageId = _ref$pageId === void 0 ? '' : _ref$pageId;\n        if (pageId !== _this.props.model.pageId) {\n          return;\n        }\n        _this.save();\n      });\n    };\n    _this.componentWillUnmount = function () {\n      inc--;\n      if (inc === 0) {\n        (0, _GlobalDataCacher.setData)(_symbolConst.KEY_TRAYMENU, true);\n      }\n      _this.removeValidateEventListener && _this.removeValidateEventListener();\n      _this.removeInstructListener && _this.removeInstructListener();\n      _this.setPropertyHandler && _this.props.model.unsub_Event(_this.setPropertyHandler);\n      _this.updateFilterSetting && _this.props.model.unsub_Event(_this.updateFilterSetting);\n      _this.updateFileName && _this.props.model.unsub_Event(_this.updateFileName);\n    };\n    _this.setProperty = function (args, type) {\n      var _this$printDesignerRe;\n      (_this$printDesignerRe = _this.printDesignerRef.current) === null || _this$printDesignerRe === void 0 || _this$printDesignerRe.setProperty(args, type);\n    };\n    _this.filterKeys = function (field) {\n      return (field === null || field === void 0 ? void 0 : field.split('.').filter(function (key) {\n        return !key.includes('$reportEntryGroup$');\n      }).join('.')) || '';\n    };\n    _this.save = function () {\n      var _this$printDesignerRe2;\n      var model = _this.props.model;\n      var key = model.key,\n        pageId = model.pageId;\n      (_this$printDesignerRe2 = _this.printDesignerRef.current) === null || _this$printDesignerRe2 === void 0 || _this$printDesignerRe2.beforeSave();\n      var data = _lodash[\"default\"].cloneDeep(_this.state.data);\n      data.pages.forEach(function (page) {\n        // TODO 原设计方案改动了源数据，导致后续用到分组的key全部需要特殊处理；\n        page.forEach(function (controlData) {\n          var _controlData$mergeSum2;\n          controlData.bindField = _this.filterKeys(controlData.bindField);\n          controlData.mergeByField = _this.filterKeys(controlData.mergeByField);\n          controlData.mergeSummaryField = ((_controlData$mergeSum2 = controlData.mergeSummaryField) === null || _controlData$mergeSum2 === void 0 ? void 0 : _controlData$mergeSum2.map(_this.filterKeys)) || [];\n        });\n      });\n      _this.props.dispatch((0, _appModelFunction.convertAppModelFunctionAction)((0, _appModelFunction.setControlPostValue)(pageId, key, data)));\n    };\n    _this.invokeComponentCustomEvent = function (name) {\n      var arg = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n      var _this$props$model = _this.props.model,\n        pageId = _this$props$model.pageId,\n        key = _this$props$model.key;\n      var args = [key, name, arg || ''];\n      _global[\"default\"][_global.INVOKE_CUSTOM_EVENT](pageId, '', args);\n    };\n    _this.componentWillMount = function () {\n      inc++;\n      (0, _GlobalDataCacher.setData)(_symbolConst.KEY_TRAYMENU, false);\n      var openArgs = (0, _appModelFunction.getDataProperty)(_this.props.model.pageId, _this.props.model.key, 'open_args')(_this.props.model.state);\n      if (openArgs) {\n        var _openArgs$toJS = openArgs.toJS(),\n          _openArgs$toJS2 = _slicedToArray(_openArgs$toJS, 1),\n          args = _openArgs$toJS2[0];\n        _this.previousOpenArgs = args;\n        args.Datasource = handleDatasource(args.Datasource);\n        if (!args) {\n          _console[\"default\"].error('no open arg');\n        } else {\n          var Datasource = args.Datasource,\n            Metadata = args.Metadata,\n            isFirstUseGrid = args.IsFirstUseGrid,\n            isFirstVisit = args.IsFirstVisit,\n            expressions = args.Function;\n          _this.setState({\n            definition: Datasource,\n            data: Metadata,\n            isFirstUseGrid: isFirstUseGrid,\n            isFirstVisit: isFirstVisit,\n            expressions: expressions\n          });\n        }\n      }\n    };\n    /**\n     * @description: 重置模板的状态\n     * @param {*} data 模板数据（包含多页）\n     * @param {*} additionalState （需要增量更新的数据，目前只有currentPointedPageIdx）\n     * @return {*}\n     */\n    _this.resetAndSetState = function (data, printData) {\n      var _this$printDesignerRe3, _this$printDesignerRe4;\n      var additionalState = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var resetPatches = (_this$printDesignerRe3 = _this.printDesignerRef.current) === null || _this$printDesignerRe3 === void 0 ? void 0 : _this$printDesignerRe3.resetPatches;\n      var resetData = (_this$printDesignerRe4 = _this.printDesignerRef.current) === null || _this$printDesignerRe4 === void 0 ? void 0 : _this$printDesignerRe4.resetData;\n      resetPatches();\n      resetData(printData, false);\n      _this.setState(_objectSpread({\n        data: data,\n        undo: [],\n        redo: []\n      }, additionalState));\n    };\n    _this.UNSAFE_componentWillReceiveProps = function (nextProp) {\n      var originOpenArgs = (0, _appModelFunction.getDataProperty)(nextProp.model.pageId, nextProp.model.key, 'open_args')(nextProp.model.state);\n      if (originOpenArgs) {\n        var _this$printDesignerRe5;\n        var _originOpenArgs$toJS = originOpenArgs.toJS(),\n          _originOpenArgs$toJS2 = _slicedToArray(_originOpenArgs$toJS, 1),\n          openArgs = _originOpenArgs$toJS2[0];\n        var pushUndoPatch = (_this$printDesignerRe5 = _this.printDesignerRef.current) === null || _this$printDesignerRe5 === void 0 ? void 0 : _this$printDesignerRe5.pushUndoPatch;\n        var Metadata = openArgs.Metadata;\n        var Datasource = handleDatasource(openArgs.Datasource);\n        var data = Metadata;\n        if (!_lodash[\"default\"].isEqual(_this.state.definition, Datasource) && (!_this.previousOpenArgs || !_lodash[\"default\"].isEqual(Datasource, _this.previousOpenArgs.Datasource))) {\n          _this.setState({\n            definition: Datasource\n          });\n        }\n        if (_this.isStashMeta || !_lodash[\"default\"].isEqual(_this.state.data, data) && (!_this.previousOpenArgs || !_lodash[\"default\"].isEqual(Metadata, _this.previousOpenArgs.Metadata))) {\n          if (_this.isStashMeta) {\n            // 模拟打印设计器里需要的数据\n            // 翻译其实会翻译所有页的数据，但是undoActions内的data存储的items数据是当前页\n            var _this$generatePrintDa = _this.generatePrintData({\n                data: data\n              }),\n              printData = _this$generatePrintDa.printData;\n            var _this$generatePrintDa2 = _this.generatePrintData(),\n              oldData = _this$generatePrintDa2.printData;\n            _this.resetAndSetState(data, printData);\n            // 手动添加一个可以撤销的动作\n            pushUndoPatch(oldData, printData);\n          } else {\n            var _this$generatePrintDa3 = _this.generatePrintData({\n                data: data,\n                curPage: 0\n              }),\n              _printData = _this$generatePrintDa3.printData;\n            // 如果不是翻译后执行的updateMeta，执行之前的清空history逻辑\n            _this.resetAndSetState(data, _printData, {\n              currentPointedPageIdx: 0\n            });\n          }\n        }\n        if (!_this.previousOpenArgs || !_lodash[\"default\"].isEqual(_this.previousOpenArgs, openArgs)) {\n          _this.previousOpenArgs = openArgs;\n        }\n      }\n    };\n    _this.componentDidUpdate = function (prevProps, prevState) {\n      if (_this.state.currentPointedPageIdx !== prevState.currentPointedPageIdx) {\n        // todo\n      }\n      var _this$state$data = _this.state.data,\n        _this$state$data$page = _this$state$data.pages,\n        pages = _this$state$data$page === void 0 ? [] : _this$state$data$page,\n        paper = _this$state$data.paper;\n      _this.dataRef.current.length = 0;\n      _this.dataRef.current.push(paper);\n      pages.forEach(function (page) {\n        page.forEach(function (comp) {\n          _this.dataRef.current.push(comp);\n        });\n      });\n    };\n    _this.onData = function (idx, data, event) {\n      var _event$value;\n      // if (idx !== this.state.currentPointedPageIdx) return\n      _console[\"default\"].log('onData idx', idx, data, event);\n      var eventType = event === null || event === void 0 ? void 0 : event.type;\n      if (event !== null && event !== void 0 && event.value && (event === null || event === void 0 || (_event$value = event.value) === null || _event$value === void 0 || (_event$value = _event$value[0]) === null || _event$value === void 0 ? void 0 : _event$value.type) === 'Attr' || eventType === 'reset') {\n        return;\n      }\n      var model = _this.props.model;\n      var key = model.key,\n        pageId = model.pageId;\n      var _$cloneDeep = _lodash[\"default\"].cloneDeep(_this.state.data),\n        paper = _$cloneDeep.paper;\n      var dataConfig = (data === null || data === void 0 ? void 0 : data.config) || {};\n      var isUpdateUndo = false;\n      // const prevConfig = this.state.data?.config || {}\n      if (eventType === 'redo' || eventType === 'undo') {\n        var _dataConfig$curPage = dataConfig.curPage,\n          curPage = _dataConfig$curPage === void 0 ? 0 : _dataConfig$curPage,\n          _dataConfig$pages = dataConfig.pages,\n          pages = _dataConfig$pages === void 0 ? 1 : _dataConfig$pages;\n        var _this$state = _this.state,\n          undo = _this$state.undo,\n          redo = _this$state.redo;\n        var _newPages = _lodash[\"default\"].cloneDeep(_this.state.data.pages);\n        var curItem;\n\n        // 均衡undo redo和history队列的长度\n        if (eventType === 'undo') {\n          curItem = (undo || []).pop();\n          curItem && redo.push(curItem);\n        } else {\n          curItem = (redo || []).pop();\n          curItem && undo.push(curItem);\n        }\n        if (pages !== _newPages.length) {\n          // page数量变化，代表走新增页签或删除页签的逻辑\n          if (pages > _newPages.length) {\n            var _curItem;\n            if (((_curItem = curItem) === null || _curItem === void 0 ? void 0 : _curItem.type) === 'delete') {\n              // curItem 需要redo或者undo的被删除页签的信息\n              var _curItem2 = curItem,\n                index = _curItem2.index,\n                item = _curItem2.item;\n              _newPages.splice(index, 0, item);\n            } else {\n              _newPages.push([]);\n            }\n          } else {\n            var _curItem3;\n            if (((_curItem3 = curItem) === null || _curItem3 === void 0 ? void 0 : _curItem3.type) === 'delete') {\n              var _curItem4 = curItem,\n                _index = _curItem4.index;\n              _newPages.splice(_index, 1);\n            } else {\n              _newPages.pop();\n            }\n          }\n          var _newData = Object.assign({}, _this.state.data, {\n            pages: _newPages\n          });\n          _this.setState({\n            currentPointedPageIdx: curPage,\n            data: _newData,\n            undo: _toConsumableArray(undo),\n            redo: _toConsumableArray(redo)\n          });\n          return;\n        }\n        if (curPage !== _this.state.currentPointedPageIdx) {\n          return _this.setState({\n            currentPointedPageIdx: curPage\n          });\n        }\n      } else {\n        // 如果不是删除事件触发的BatchActions，就添加一个占位符 因为删除我们已经手动添加了一个undo事件了， 就不需要再添加了\n        // 占位符， 用于平衡history队列的长度\n        if (!(event.type === 'BatchActions' && (event === null || event === void 0 ? void 0 : event.oldValue.config.pages) > (event === null || event === void 0 ? void 0 : event.value.config.pages))) {\n          isUpdateUndo = true;\n        }\n      }\n      var items = data.items;\n      var _items = _slicedToArray(items, 1),\n        newPaper = _items[0];\n      var paperProps = !_lodash[\"default\"].isEqual(newPaper, paper) ? {\n        paper: newPaper\n      } : {};\n      // 该不该全量更新？\n      // 可以局部更新\n      // 框架会初始调用一次，导致这里不能setState\n      // 这里不要setState 或者 设计器初始不调用\n      var newPages = _lodash[\"default\"].cloneDeep(_this.state.data.pages);\n      newPages[_this.state.currentPointedPageIdx] = items.slice(1); // 这里的idx不可靠，因为不是内核的事件分发比较复杂, reset之前发的也是之前的数据\n      var newData = Object.assign({}, _this.state.data, _objectSpread({\n        pages: newPages\n      }, paperProps));\n      // TODO：这里应该改为推方式\n      if (!_lodash[\"default\"].isEqual(newData, _this.state.data)) {\n        var other = isUpdateUndo ? {\n          undo: [].concat(_toConsumableArray(_this.state.undo), [{\n            eventPlaceholder: null\n          }])\n        } : {};\n        _this.setState(_objectSpread({\n          data: newData\n        }, other));\n      }\n    };\n    _this.addPage = function () {\n      var _this$printDesignerRe6;\n      if (_this.state.data.pages.length >= _PageManage.LIMIT_PAGE_COUNT) return;\n      var attrActions = (_this$printDesignerRe6 = _this.printDesignerRef.current) === null || _this$printDesignerRe6 === void 0 ? void 0 : _this$printDesignerRe6.attrActions;\n      var newPages = _lodash[\"default\"].cloneDeep(_this.state.data.pages).concat([[]]);\n      var newData = Object.assign({}, _this.state.data, {\n        pages: newPages\n      });\n      var curPage = newPages.length - 1;\n      var pagesLength = newPages.length;\n      var _this$generatePrintDa4 = _this.generatePrintData({\n          data: newData,\n          curPage: curPage\n        }),\n        pages = _this$generatePrintDa4.pages;\n      attrActions([{\n        value: {\n          curPage: curPage,\n          pages: pagesLength\n        },\n        attrName: 'config'\n      }, {\n        value: pages[curPage],\n        attrName: 'items'\n      }]);\n      _this.setState({\n        currentPointedPageIdx: curPage,\n        data: newData\n      });\n    };\n    _this.changePage = function (idx) {\n      if (idx !== _this.state.currentPointedPageIdx) {\n        var _this$printDesignerRe7;\n        var attrActions = (_this$printDesignerRe7 = _this.printDesignerRef.current) === null || _this$printDesignerRe7 === void 0 ? void 0 : _this$printDesignerRe7.attrActions;\n        var data = _this.state.data;\n        var curPage = idx;\n        var _this$generatePrintDa5 = _this.generatePrintData({\n            data: data,\n            curPage: curPage\n          }),\n          pages = _this$generatePrintDa5.pages;\n        var pagesLength = pages.length;\n        attrActions([{\n          value: {\n            curPage: curPage,\n            pages: pagesLength\n          },\n          attrName: 'config'\n        }, {\n          value: pages[curPage],\n          attrName: 'items'\n        }]);\n        _this.setState({\n          currentPointedPageIdx: curPage\n        });\n      }\n    };\n    _this.deletePage = function (e, idx) {\n      var _this$printDesignerRe8;\n      if (e.stopPropagation) {\n        e.stopPropagation();\n      } else {\n        e.cancelBubble = true;\n      }\n      var currentPointedPageIdx = _this.state.currentPointedPageIdx;\n      var newPages = _lodash[\"default\"].cloneDeep(_this.state.data.pages);\n      var attrActions = (_this$printDesignerRe8 = _this.printDesignerRef.current) === null || _this$printDesignerRe8 === void 0 ? void 0 : _this$printDesignerRe8.attrActions;\n      var deleteItem = newPages[idx];\n      newPages.splice(idx, 1);\n      var newData = Object.assign({}, _this.state.data, {\n        pages: newPages\n      });\n      var deleteData = {\n        index: idx,\n        item: deleteItem,\n        type: 'delete' // 增加delete Type 与undo产生的页面删除区分开来，作用于undo事件\n      };\n      var curPage = idx <= currentPointedPageIdx ? Math.max(currentPointedPageIdx - 1, 0) : currentPointedPageIdx;\n      var _this$generatePrintDa6 = _this.generatePrintData({\n          data: newData,\n          curPage: curPage\n        }),\n        pages = _this$generatePrintDa6.pages;\n      var pagesLength = pages.length;\n\n      // 打印大纲树 删除页面时items会变为空，但是又不会触发dataChangeListener，需要手动触发更新\n      attrActions([{\n        value: {\n          curPage: curPage,\n          pages: pagesLength\n        },\n        attrName: 'config'\n      }]);\n      if (idx > currentPointedPageIdx) {\n        _this.setState({\n          data: newData,\n          undo: [].concat(_toConsumableArray(_this.state.undo || []), [deleteData])\n        });\n      } else {\n        _this.setState({\n          currentPointedPageIdx: Math.max(currentPointedPageIdx - 1, 0),\n          data: newData,\n          undo: [].concat(_toConsumableArray(_this.state.undo || []), [deleteData])\n        });\n      }\n    };\n    (0, _api.getPrintMetadata)(props.model.componentData.getIn(['open_args', 0, 'Metadata', 'bizType'])).then(function (data) {\n      // data.Categories[0].Controls[0].Properties[0].Nodes.push(JSON.parse(JSON.stringify(data.Categories[0].Controls[0].Properties[0].Nodes[0])))\n      // data.Categories[0].Controls[0].Properties[0].Nodes[5].Id = 'sssssss'\n      // data.Categories[0].Controls[0].Properties[0].Nodes[5].dataSourceOption = {\n      //   showType: 'field',\n      //   DsType: {\n      //     hide: ['Sys', 'Workflow'],\n      //     onlyShow: []\n      //   },\n      //   FieldType: {\n      //     hide: [],\n      //     onlyShow: ['Text']\n      //   },\n      //   allowFormula: false\n      // }\n      _console[\"default\"].log(data);\n      _this.setState({\n        meta: data\n      });\n    })[\"catch\"](function (err) {\n      _console[\"default\"].log(err);\n    });\n    var _data = {};\n    var definition = [];\n    _console[\"default\"].log('mock meta data', _data);\n    _this.printDesignerRef = /*#__PURE__*/(0, _react.createRef)(null);\n    _this.state = {\n      meta: null,\n      data: _data,\n      definition: definition,\n      expressions: [],\n      currentPointedPageIdx: 0,\n      undo: [],\n      // 新增undo、redo队列， 用于同步history的长度，存放被删除页签的数据（被删除的页签可能存在多个，之前的方案不能顾及多个被删除后redo的情况）\n      redo: [],\n      // 这两个状态只有初次变更(进来或者刷新)\n      isFirstUseGrid: false,\n      isFirstVisit: false,\n      isModuleExsit: false\n    };\n    _this.dataRef = /*#__PURE__*/_react[\"default\"].createRef([]);\n    _this.dataRef.current = _this.dataRef.current || [];\n    _this.previousOpenArgs = null;\n    return _this;\n  }\n  _createClass(KDPrintDesigner, [{\n    key: \"generatePrintData\",\n    value:\n    /**\n     * @description: 构造打印模板的需要的结构数据\n     * @return {*}\n     */\n    function generatePrintData() {\n      var _ref2 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref2$data = _ref2.data,\n        data = _ref2$data === void 0 ? this.state.data : _ref2$data,\n        _ref2$curPage = _ref2.curPage,\n        curPage = _ref2$curPage === void 0 ? this.state.currentPointedPageIdx : _ref2$curPage;\n      var paper = data.paper,\n        pagesData = data.pages,\n        rest = _objectWithoutProperties(data, _excluded);\n      var pages = pagesData.map(function (page) {\n        return [paper].concat(_toConsumableArray(page));\n      });\n      var printData = _objectSpread(_objectSpread({}, rest), {}, {\n        items: pages[curPage],\n        config: {\n          curPage: curPage,\n          pages: pages.length\n        }\n      });\n      return {\n        pages: pages,\n        printData: printData\n      };\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n      _console[\"default\"].log(this.props);\n      var _this$state2 = this.state,\n        data = _this$state2.data,\n        meta = _this$state2.meta,\n        definition = _this$state2.definition,\n        currentPointedPageIdx = _this$state2.currentPointedPageIdx,\n        isFirstUseGrid = _this$state2.isFirstUseGrid,\n        isFirstVisit = _this$state2.isFirstVisit,\n        expressions = _this$state2.expressions;\n      if (!meta || _lodash[\"default\"].isEmpty(data)) {\n        return /*#__PURE__*/_react[\"default\"].createElement(LoadingSpin, null);\n      }\n      var _this$generatePrintDa7 = this.generatePrintData({\n          data: data,\n          curPage: currentPointedPageIdx\n        }),\n        pages = _this$generatePrintDa7.pages,\n        printData = _this$generatePrintDa7.printData;\n      var pageManage = /*#__PURE__*/_react[\"default\"].createElement(_PageManage[\"default\"], {\n        pages: pages,\n        changePage: this.changePage,\n        deletePage: this.deletePage,\n        addPage: this.addPage,\n        currentPointedPageIdx: currentPointedPageIdx\n      });\n      return /*#__PURE__*/_react[\"default\"].createElement(PrintDesignerWrapper, {\n        ref: this.printDesignerRef,\n        dataRef: this.dataRef,\n        pageManage: pageManage,\n        expressions: expressions,\n        meta: meta,\n        data: printData,\n        definition: definition,\n        onData: function onData(data, event) {\n          _console[\"default\"].log('printDesigner---------ondata', data, event);\n          _this2.onData(currentPointedPageIdx, data, event);\n        },\n        showMessage: this.showMessage,\n        handleOpenCustomDsModal: this.handleOpenCustomDsModal,\n        handleOpenRefDsModal: this.handleOpenRefDsModal,\n        handleChangePLang: this.handleChangePLang,\n        handlePassGridActionGuide: this.handlePassGridActionGuide,\n        handlePassPrintActionGuide: this.handlePassPrintActionGuide,\n        handleOpenDGridSortSettingEdModal: this.handleOpenDGridSortSettingEdModal,\n        handleOpenDGridFilterSettingEdModal: this.handleOpenDGridFilterSettingEdModal,\n        handleChangeFileName: this.handleChangeFileName,\n        invokePrintDesignerCustomEvent: this.invokePrintDesignerCustomEvent,\n        isFirstUseGrid: isFirstUseGrid,\n        isFirstVisit: isFirstVisit,\n        getLangMsg: _intlApi.getLangMsg\n      });\n    }\n  }]);\n  return KDPrintDesigner;\n}(_react[\"default\"].Component)) || _class) || _class);\nvar PrintDesignerWrapper = /*#__PURE__*/(0, _react.forwardRef)(function (props, forwardedRef) {\n  var _useFederatedModule = (0, _useFederationModule.useFederatedModule)('print'),\n    module = _useFederatedModule.Component;\n  if (!module) {\n    return /*#__PURE__*/_react[\"default\"].createElement(LoadingSpin, null, /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n      className: _KDPrintDesigner2[\"default\"].spinDivText\n    }, (0, _intlApi.getLangMsg)('PrintDesigner.key0002')), \" \");\n  }\n  return /*#__PURE__*/_react[\"default\"].createElement(PrintDesignerImp, _extends({}, props, {\n    ref: forwardedRef,\n    module: module\n  }));\n});\nvar FETCH_FONT_SRC = 'api/print/download.do?rcId=';\nvar PrintDesignerImp = /*#__PURE__*/(0, _react.forwardRef)(function (props, forwardedRef) {\n  var module = props.module,\n    designerProps = _objectWithoutProperties(props, _excluded2);\n  var _ref3 = module || {},\n    PrintDesigner = _ref3.PrintDesigner,\n    useInstallFontFamilyOnline = _ref3.useInstallFontFamilyOnline;\n  var meta = designerProps.meta;\n  var fontMapping = meta.FontMapping;\n  var fontNameMap = fontMapping && fontMapping.reduce(function (res, _ref4) {\n    var fontName = _ref4.Name,\n      rcId = _ref4.RcId,\n      fontFamily = _ref4.Code;\n    if (!rcId) return res;\n    res[fontFamily] = \"\".concat(FETCH_FONT_SRC).concat(rcId);\n    return res;\n  }, {});\n  var isShow = useInstallFontFamilyOnline(fontNameMap);\n  if (!isShow) {\n    return /*#__PURE__*/_react[\"default\"].createElement(LoadingSpin, null, /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n      className: _KDPrintDesigner2[\"default\"].spinDivText\n    }, (0, _intlApi.getLangMsg)('PrintDesigner.key0002')), \" \");\n  }\n  return /*#__PURE__*/_react[\"default\"].createElement(PrintDesigner, _extends({}, designerProps, {\n    ref: forwardedRef\n  }));\n});\nvar LoadingSpin = function LoadingSpin(_ref5) {\n  var children = _ref5.children;\n  return /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    className: _KDPrintDesigner2[\"default\"].spinDiv\n  }, /*#__PURE__*/_react[\"default\"].createElement(_kdesign.Spin, {\n    name: \"Spin\"\n  }), children);\n};\nvar handleDatasource = function handleDatasource(datasource) {\n  if (!datasource) return;\n  var data = datasource.reduce(function (data, def) {\n    var _def = def,\n      Items = _def.Items,\n      Type = _def.Type,\n      Id = _def.Id,\n      Name = _def.Name,\n      Key = _def.Key;\n    if (Type === 'ReportEntryGroup' && Items !== null && Items !== void 0 && Items.length) {\n      def = {\n        Items: handleDatasource(Items),\n        Id: Id,\n        bindField: Id,\n        dataSource: Key,\n        Name: Name,\n        // 后台给的该类型的数据Name是个字符串?调用.zh_CN直接取不到值\n        Icon: 'danjuti',\n        isReportEntryGroup: true,\n        // TODO 原设计方案改动了源数据，导致后续用到分组的key全部需要特殊处理；\n        Key: \"$$reportEntryGroup$$_\".concat(Key)\n      };\n      data.push(def);\n    } else if (Items !== null && Items !== void 0 && Items.length) {\n      def = _objectSpread(_objectSpread({}, def), {}, {\n        Items: handleDatasource(Items)\n      });\n      data.push(def);\n    } else {\n      data.push(def);\n    }\n    return data;\n  }, []);\n  return data;\n};\n\n// KDPrintDesigner.actions = Object.assign({}, actions)\nvar _default = exports[\"default\"] = KDPrintDesigner;\n\n//# sourceURL=webpack://bos-platform/./src/component/web/KDPrintDesigner/KDPrintDesigner.jsx?");

/***/ }),

/***/ "./src/component/web/KDPrintDesigner/PageManage.jsx":
/*!**********************************************************!*\
  !*** ./src/component/web/KDPrintDesigner/PageManage.jsx ***!
  \**********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {

eval("\n\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"../../node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"../../node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"../../node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"../../node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.filter.js */ \"../../node_modules/core-js/modules/es.array.filter.js\");\n__webpack_require__(/*! core-js/modules/es.array.for-each.js */ \"../../node_modules/core-js/modules/es.array.for-each.js\");\n__webpack_require__(/*! core-js/modules/es.array.from.js */ \"../../node_modules/core-js/modules/es.array.from.js\");\n__webpack_require__(/*! core-js/modules/es.array.is-array.js */ \"../../node_modules/core-js/modules/es.array.is-array.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"../../node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"../../node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-string.js */ \"../../node_modules/core-js/modules/es.date.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.function.name.js */ \"../../node_modules/core-js/modules/es.function.name.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"../../node_modules/core-js/modules/es.number.constructor.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-properties.js */ \"../../node_modules/core-js/modules/es.object.define-properties.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"../../node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-own-property-descriptor.js */ \"../../node_modules/core-js/modules/es.object.get-own-property-descriptor.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-own-property-descriptors.js */ \"../../node_modules/core-js/modules/es.object.get-own-property-descriptors.js\");\n__webpack_require__(/*! core-js/modules/es.object.keys.js */ \"../../node_modules/core-js/modules/es.object.keys.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"../../node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.regexp.exec.js */ \"../../node_modules/core-js/modules/es.regexp.exec.js\");\n__webpack_require__(/*! core-js/modules/es.regexp.to-string.js */ \"../../node_modules/core-js/modules/es.regexp.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"../../node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.weak-map.js */ \"../../node_modules/core-js/modules/es.weak-map.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.for-each.js */ \"../../node_modules/core-js/modules/web.dom-collections.for-each.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"../../node_modules/core-js/modules/web.dom-collections.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", ({\n  value: true\n}));\nexports.getDefaultAndDropPages = exports[\"default\"] = exports.LIMIT_PAGE_COUNT = void 0;\n__webpack_require__(/*! core-js/modules/es.array.concat.js */ \"../../node_modules/core-js/modules/es.array.concat.js\");\n__webpack_require__(/*! core-js/modules/es.array.map.js */ \"../../node_modules/core-js/modules/es.array.map.js\");\n__webpack_require__(/*! core-js/modules/es.array.slice.js */ \"../../node_modules/core-js/modules/es.array.slice.js\");\nvar _react = _interopRequireWildcard(__webpack_require__(/*! react */ \"webpack/sharing/consume/default/react/react?dca2\"));\nvar _classnames = _interopRequireDefault(__webpack_require__(/*! classnames */ \"../../node_modules/classnames/index.js\"));\nvar _PageManage = _interopRequireDefault(__webpack_require__(/*! ./PageManage.less */ \"./src/component/web/KDPrintDesigner/PageManage.less\"));\nvar _kdesign = __webpack_require__(/*! @kdcloudjs/kdesign */ \"webpack/sharing/consume/default/@kdcloudjs/kdesign/@kdcloudjs/kdesign\");\nvar _resizeObserve = _interopRequireDefault(__webpack_require__(/*! ../../../util/resizeObserve */ \"./src/util/resizeObserve.js\"));\nvar _intlApi = __webpack_require__(/*! ../../../i18n/intlApi */ \"./src/i18n/intlApi.js\");\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\nfunction _getRequireWildcardCache(e) { if (\"function\" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(e) { return e ? t : r; })(e); }\nfunction _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || \"object\" != _typeof(e) && \"function\" != typeof e) return { \"default\": e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if (\"default\" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n[\"default\"] = e, t && t.set(e, n), n; }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nvar LIMIT_PAGE_COUNT = exports.LIMIT_PAGE_COUNT = 20;\nvar DEFAULT_ITEM_WIDTH = 72;\nvar MAX_ITEM_WIDTH = 150;\nvar getDefaultAndDropPages = exports.getDefaultAndDropPages = function getDefaultAndDropPages(pages, spreadPageCount) {\n  var dropPages = pages.slice(spreadPageCount);\n  var defaultPages = pages.slice(0, spreadPageCount);\n  if (dropPages.length === 1) {\n    defaultPages = defaultPages.concat(dropPages);\n    dropPages = [];\n  }\n  return {\n    dropPages: dropPages,\n    defaultPages: defaultPages\n  };\n};\nvar pageManage = function pageManage(_ref) {\n  var pages = _ref.pages,\n    changePage = _ref.changePage,\n    deletePage = _ref.deletePage,\n    addPage = _ref.addPage,\n    currentPointedPageIdx = _ref.currentPointedPageIdx;\n  var _useState = (0, _react.useState)(-1),\n    _useState2 = _slicedToArray(_useState, 2),\n    selectValue = _useState2[0],\n    setSelectValue = _useState2[1];\n  var _useState3 = (0, _react.useState)(LIMIT_PAGE_COUNT),\n    _useState4 = _slicedToArray(_useState3, 2),\n    spreadPageCount = _useState4[0],\n    setSpreadPageCount = _useState4[1];\n  var _useState5 = (0, _react.useState)(-1),\n    _useState6 = _slicedToArray(_useState5, 2),\n    hoverOptionItem = _useState6[0],\n    setHoverOptionItem = _useState6[1];\n  var _getDefaultAndDropPag = getDefaultAndDropPages(pages, spreadPageCount),\n    intDropPages = _getDefaultAndDropPag.dropPages,\n    initdefaultPages = _getDefaultAndDropPag.defaultPages;\n  var _useState7 = (0, _react.useState)(initdefaultPages),\n    _useState8 = _slicedToArray(_useState7, 2),\n    defaultPages = _useState8[0],\n    setDefaultPages = _useState8[1];\n  var _useState9 = (0, _react.useState)(intDropPages),\n    _useState10 = _slicedToArray(_useState9, 2),\n    dropPages = _useState10[0],\n    setDropPages = _useState10[1];\n  var pageCount = (0, _react.useRef)(pages.length);\n  var lastPageItemRef = (0, _react.useRef)(); // 最后一个页签\n  var _useState11 = (0, _react.useState)(DEFAULT_ITEM_WIDTH),\n    _useState12 = _slicedToArray(_useState11, 2),\n    itemWidth = _useState12[0],\n    setItemWidth = _useState12[1]; // 最后一个页签的宽度\n\n  (0, _react.useEffect)(function () {\n    var _getDefaultAndDropPag2 = getDefaultAndDropPages(pages, spreadPageCount),\n      dropPages = _getDefaultAndDropPag2.dropPages,\n      defaultPages = _getDefaultAndDropPag2.defaultPages;\n    setDropPages(dropPages);\n    setDefaultPages(defaultPages);\n  }, [spreadPageCount, pages]);\n  (0, _react.useEffect)(function () {\n    if (lastPageItemRef.current) {\n      setItemWidth(Math.min(lastPageItemRef.current.offsetWidth, MAX_ITEM_WIDTH));\n    }\n  }, [lastPageItemRef.current]);\n  (0, _react.useEffect)(function () {\n    var newPageCount = dropPages.length + defaultPages.length;\n    var maxSelectValue = newPageCount - 1;\n    if (dropPages.length > 0) {\n      if (newPageCount > pageCount.current) {\n        // 新增时\n        setSelectValue(maxSelectValue);\n      } else if (newPageCount < pageCount.current) {\n        // 删除时\n        if (selectValue > maxSelectValue) {\n          setSelectValue(maxSelectValue);\n        }\n      } else {\n        // resize时\n        if (selectValue === -1) {\n          if (currentPointedPageIdx >= defaultPages.length) {\n            setSelectValue(currentPointedPageIdx);\n          } else {\n            setSelectValue(maxSelectValue);\n          }\n        } else {\n          if (selectValue < defaultPages.length - 1) {\n            setSelectValue(maxSelectValue);\n          } else if (currentPointedPageIdx >= defaultPages.length) {\n            setSelectValue(currentPointedPageIdx);\n          } else {\n            setSelectValue(maxSelectValue);\n          }\n        }\n      }\n    } else {\n      // 重置\n      setSelectValue(-1);\n    }\n    pageCount.current = newPageCount;\n  }, [defaultPages.length, dropPages.length, currentPointedPageIdx]);\n  var pageManageRef = (0, _react.useRef)();\n  var handleChange = function handleChange(value) {\n    setSelectValue(value);\n    changePage && changePage(value);\n  };\n  var handleMouseEnter = function handleMouseEnter(e) {\n    var targetEle = document.getElementsByClassName('kdesigner-select-item-option');\n    var length = targetEle.length;\n    var index = 0;\n    while (index < length) {\n      if (targetEle[index].contains(e.target)) {\n        setHoverOptionItem(index);\n        return;\n      }\n      index++;\n    }\n  };\n  var handleMouseLeave = function handleMouseLeave() {\n    setHoverOptionItem(-1);\n  };\n  var handleDelete = function handleDelete(e, value) {\n    deletePage(e, value);\n  };\n  var handleAdd = function handleAdd() {\n    addPage();\n  };\n  (0, _react.useEffect)(function () {\n    if (!pageManageRef.current) return;\n    var handleResize = function handleResize() {\n      if (!pageManageRef.current) return;\n      var parentElement = pageManageRef.current.parentElement;\n      var maxWidth = parentElement.clientWidth;\n      var paddingRight = 32;\n      var collapseItemWidth = itemWidth + 12;\n      var minWidth = paddingRight + collapseItemWidth;\n      var maxPageCount = Math.floor((maxWidth - minWidth) / itemWidth);\n      maxPageCount = maxPageCount > LIMIT_PAGE_COUNT ? LIMIT_PAGE_COUNT : maxPageCount;\n      setSpreadPageCount(maxPageCount);\n    };\n    var removeResizeObserve = (0, _resizeObserve[\"default\"])(pageManageRef.current, handleResize);\n    return function () {\n      removeResizeObserve.removeResizeObserve();\n    };\n  }, [itemWidth]);\n  return /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    className: _PageManage[\"default\"].pageManage,\n    ref: pageManageRef\n  }, defaultPages.map(function (page, idx, arr) {\n    return /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n      key: idx,\n      ref: idx === arr.length - 1 ? lastPageItemRef : null,\n      className: (0, _classnames[\"default\"])(_PageManage[\"default\"].pageBtn, _defineProperty({}, _PageManage[\"default\"].selectedPageBtn, currentPointedPageIdx === idx)),\n      onClick: function onClick() {\n        return changePage(idx);\n      }\n    }, /*#__PURE__*/_react[\"default\"].createElement(\"span\", {\n      className: _PageManage[\"default\"].pageText,\n      title: \"\".concat((0, _intlApi.getLangMsg)('PrintDesigner.key0001')).concat(idx + 1)\n    }, (0, _intlApi.getLangMsg)('PrintDesigner.key0001'), idx + 1), arr.length > 1 && /*#__PURE__*/_react[\"default\"].createElement(\"span\", {\n      className: _PageManage[\"default\"].pageDeleteBtn,\n      onClick: function onClick(e) {\n        return handleDelete(e, idx);\n      }\n    }, /*#__PURE__*/_react[\"default\"].createElement(_kdesign.Icon, {\n      type: \"close\"\n    })));\n  }), dropPages.length > 0 && /*#__PURE__*/_react[\"default\"].createElement(_kdesign.Select, {\n    borderType: \"bordered\",\n    defaultValue: spreadPageCount,\n    value: selectValue,\n    className: _PageManage[\"default\"]['page-select'],\n    onChange: handleChange,\n    dropdownRender: function dropdownRender(v) {\n      return /*#__PURE__*/_react[\"default\"].cloneElement(v, _objectSpread(_objectSpread({}, v.props), {}, {\n        onMouseOver: handleMouseEnter,\n        onMouseLeave: handleMouseLeave\n      }));\n    }\n  }, dropPages.map(function (v, i) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_kdesign.Select.Option, {\n      value: i + spreadPageCount\n    }, /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n      title: \"\".concat((0, _intlApi.getLangMsg)('PrintDesigner.key0001')).concat(spreadPageCount + i + 1),\n      className: (0, _classnames[\"default\"])(_PageManage[\"default\"].dropPageMenu, _defineProperty({}, _PageManage[\"default\"]['drop-focus'], currentPointedPageIdx + 1 > defaultPages.length))\n    }, (0, _intlApi.getLangMsg)('PrintDesigner.key0001'), spreadPageCount + i + 1, hoverOptionItem === i && /*#__PURE__*/_react[\"default\"].createElement(\"span\", {\n      className: _PageManage[\"default\"].pageDeleteBtn,\n      onClick: function onClick(e) {\n        return handleDelete(e, i + spreadPageCount);\n      }\n    }, /*#__PURE__*/_react[\"default\"].createElement(_kdesign.Icon, {\n      type: \"close\"\n    }))));\n  })), pages.length < LIMIT_PAGE_COUNT && /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    onClick: handleAdd,\n    className: _PageManage[\"default\"].pageAddBtn\n  }, /*#__PURE__*/_react[\"default\"].createElement(_kdesign.Icon, {\n    type: \"add\"\n  })));\n};\nvar _default = exports[\"default\"] = pageManage;\n\n//# sourceURL=webpack://bos-platform/./src/component/web/KDPrintDesigner/PageManage.jsx?");

/***/ }),

/***/ "./src/component/web/KDPrintDesigner/PageManage.less":
/*!***********************************************************!*\
  !*** ./src/component/web/KDPrintDesigner/PageManage.less ***!
  \***********************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n// extracted by mini-css-extract-plugin\n/* harmony default export */ __webpack_exports__[\"default\"] = ({\"pageManage\":\"PageManage_pageManage_-T_D\",\"dropPageMenu\":\"PageManage_dropPageMenu_1Rhb\",\"pageBtn\":\"PageManage_pageBtn_M-SX\",\"pageText\":\"PageManage_pageText_142T\",\"pageDeleteBtn\":\"PageManage_pageDeleteBtn_2Rdv\",\"selectedPageBtn\":\"PageManage_selectedPageBtn_3-M7\",\"pageAddBtn\":\"PageManage_pageAddBtn_2SC9\",\"page-select\":\"PageManage_page-select_31lm\",\"drop-focus\":\"PageManage_drop-focus_3lGy\",\"page-dropdown-item\":\"PageManage_page-dropdown-item_3350\",\"arrow-down\":\"PageManage_arrow-down_T1Bm\"});\n\n//# sourceURL=webpack://bos-platform/./src/component/web/KDPrintDesigner/PageManage.less?");

/***/ })

}]);