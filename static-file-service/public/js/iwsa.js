/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackJsonp_bos-platform"] = self["webpackJsonp_bos-platform"] || []).push([[7324],{

/***/ "./src/plugin/cert/IWSA/plugin.js":
/*!****************************************!*\
  !*** ./src/plugin/cert/IWSA/plugin.js ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {

"use strict";
eval("\n\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"../../node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"../../node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"../../node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"../../node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"../../node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-own-property-descriptor.js */ \"../../node_modules/core-js/modules/es.object.get-own-property-descriptor.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"../../node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.weak-map.js */ \"../../node_modules/core-js/modules/es.weak-map.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"../../node_modules/core-js/modules/web.dom-collections.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", ({\n  value: true\n}));\nexports[\"default\"] = main;\n__webpack_require__(/*! core-js/modules/es.array.for-each.js */ \"../../node_modules/core-js/modules/es.array.for-each.js\");\n__webpack_require__(/*! core-js/modules/es.array.includes.js */ \"../../node_modules/core-js/modules/es.array.includes.js\");\n__webpack_require__(/*! core-js/modules/es.array.index-of.js */ \"../../node_modules/core-js/modules/es.array.index-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.assign.js */ \"../../node_modules/core-js/modules/es.object.assign.js\");\n__webpack_require__(/*! core-js/modules/es.object.keys.js */ \"../../node_modules/core-js/modules/es.object.keys.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"../../node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.regexp.exec.js */ \"../../node_modules/core-js/modules/es.regexp.exec.js\");\n__webpack_require__(/*! core-js/modules/es.string.includes.js */ \"../../node_modules/core-js/modules/es.string.includes.js\");\n__webpack_require__(/*! core-js/modules/es.string.match.js */ \"../../node_modules/core-js/modules/es.string.match.js\");\n__webpack_require__(/*! core-js/modules/es.string.replace.js */ \"../../node_modules/core-js/modules/es.string.replace.js\");\n__webpack_require__(/*! core-js/modules/es.string.trim.js */ \"../../node_modules/core-js/modules/es.string.trim.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.for-each.js */ \"../../node_modules/core-js/modules/web.dom-collections.for-each.js\");\nvar _global = _interopRequireWildcard(__webpack_require__(/*! @/global */ \"./src/global/index.js\"));\nvar _certConst = __webpack_require__(/*! @/constant/certConst */ \"./src/constant/certConst.js\");\nvar _certService = __webpack_require__(/*! @/api/certService */ \"./src/api/certService.js\");\nfunction _getRequireWildcardCache(e) { if (\"function\" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(e) { return e ? t : r; })(e); }\nfunction _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || \"object\" != _typeof(e) && \"function\" != typeof e) return { \"default\": e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if (\"default\" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n[\"default\"] = e, t && t.set(e, n), n; }\n/**\n * IWSA证书数据结构\n * CertListData = {\n    certDN: 'C=CN, O=TOBACCO, OU=云南中烟CA, OU=公司本部, OU=信息管理部, CN=ERP测试',\n    issuerDN: 'C=CN, O=Tobacco, CN=云南中烟CA',\n    validBegin: '2020-11-30 10:40:59GMT',\n    validEnd: '2022-11-30 10:40:59GMT',\n    certSN: '0086 0018 7100 0004 43',\n    CertStore: 'MY',\n    KeyUsage: 'signature',\n    CertType: 'RSA'\n  }\n */\n\nvar CertStoreSM2 = 'infosec.sm2';\nfunction getCertName(certDN) {\n  var t = certDN.match(/(S(?!N)|L|O(?!U)|OU|SN|CN|E)=([^=]+)(?=, |$)/g);\n  for (var i = 0; i < t.length; i++) {\n    if (t[i].indexOf('CN=') === 0) {\n      return t[i].substr(3, t[i].length);\n    }\n  }\n  return 'defaultName';\n}\nfunction importCertCallBack(cert, TextData, callback) {\n  if (cert) {\n    var certInfo = {\n      serialNumber: cert.certSN,\n      // serialNumber: '008600187100000443',\n      issuer: cert.issuerDN,\n      publicKey: TextData,\n      begin: cert.validBegin,\n      end: cert.validEnd,\n      certName: getCertName(cert.certDN)\n    };\n    var data = {\n      success: true,\n      data: certInfo\n    };\n    callback && callback(data);\n  } else {\n    var callBackData = {\n      success: false,\n      status: _certConst.CERT_STATUS_IWSA_NOCERT\n    };\n    callback(callBackData);\n  }\n  _certService.certService.closeDialog();\n}\nfunction getConfig(configString, name) {\n  var params = configString.split('\\n');\n  var configParam = '';\n  params.forEach(function (param) {\n    if (param.includes(name)) {\n      configParam = param.trim().replace(\"\".concat(name, \"=\"), '').replace('\\r', '');\n    }\n  });\n  return configParam;\n}\nfunction vaildatePluginVersion(IWSAgent, callback) {\n  try {\n    var result = syncRunRC(IWSAgent, IWSAgent.IWSAGetVersion);\n    console.log(\"\\u4FE1\\u5B89\\u4E16\\u7EAA\\u7B7E\\u540D\\u8BC1\\u4E66\\u63D2\\u4EF6\\u7248\\u672C\\u53F7\\uFF1A\".concat(result));\n  } catch (error) {\n    var callBackData = {\n      success: false\n    };\n    callBackData.status = _certConst.CERT_STATUS_NOPLGUIN;\n    callBackData.pluginPath = _certConst.CERT_FILE_URI_IWSA;\n    callback(callBackData);\n  }\n}\nfunction syncRunRC(IWSAgent, fc) {\n  IWSAgent.IWSASetAsyncMode(false);\n  if (!fc) return;\n  var result = fc();\n  IWSAgent.IWSASetAsyncMode(true);\n  return result;\n}\nfunction getSignCertListInfo(IWSAgent) {\n  var issuer = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n  var serialNumber = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';\n  var signFC = arguments.length > 3 ? arguments[3] : undefined;\n  var callback = arguments.length > 4 ? arguments[4] : undefined;\n  if (!serialNumber || !issuer) {\n    // IWSAgent.IWSAGetAllCertsListInfo('', 'Sign', 0, signFC)\n    console.error('证书获取失败，无法完成签名');\n    var data = {\n      success: false,\n      status: _certConst.CERT_STATUS_NOT_FOUND\n    };\n    return callback(data);\n  } else {\n    IWSAgent.IWSAGetAllCertsListInfoByCertIssuerDNAndCertSN(CertStoreSM2, 'Sign', issuer, serialNumber, 2, signFC, callback);\n  }\n}\nfunction signCertText(IWSAgent, signText, issuer, serialNumber) {\n  var signType = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 'RAW';\n  var DigestArithmetic = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 'SHA1';\n  var callback = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : function () {};\n  try {\n    var signFC = function signFC(CertListData) {\n      if (!CertListData[0]) {\n        var _data = {\n          success: false,\n          status: _certConst.CERT_STATUS_IWSA_NOCERT\n        };\n        return callback(_data);\n      }\n      var encryptText = {};\n      var signStatus = '0';\n      var data = {\n        success: false\n      };\n      var onSignEnd = function onSignEnd(key, index, errorCode, signedData) {\n        if (errorCode !== '0') {\n          signStatus = errorCode;\n        }\n        encryptText[key] = signedData;\n        var isLastSignedText = Object.keys(signText).length - 1 === index;\n        if (isLastSignedText) {\n          if (signStatus === '0') {\n            data = {\n              success: true,\n              data: encryptText\n            };\n          } else if (signStatus === '-20005') {\n            data = {\n              success: false,\n              status: _certConst.CERT_STATUS_IWSA_NOCERT\n            };\n          } else if (signStatus === '-20020') {\n            data = {\n              success: false,\n              status: _certConst.CERT_STATUS_FAIL\n            };\n          } else {\n            data = {\n              success: false,\n              status: _certConst.CERT_STATUS_FAIL\n            };\n          }\n          callback(data);\n        }\n      };\n      // 如果证书类型是SM2，就强制使用Detached方式加密\n      if (CertListData[0].CertType === 'SM2') {\n        signType = 'Detached';\n      }\n      Object.keys(signText).forEach(function (key, index) {\n        // 第三个参数  1：强制RSA, 2：强制SM2, 3：优先RSA, 4：优先SM2\n        if (signType === 'Attached') {\n          IWSAgent.IWSAAttachedSignAdvDefaultDN(signText[key], '', 1, CertListData[0].certDN, 0, DigestArithmetic, function (errorCode, signedData) {\n            onSignEnd(key, index, errorCode, signedData);\n          });\n        } else if (signType === 'Detached') {\n          IWSAgent.IWSADetachedSignAdvDefaultDN(signText[key], CertStoreSM2, 4, CertListData[0].certDN, 0, DigestArithmetic, function (errorCode, signedData) {\n            onSignEnd(key, index, errorCode, signedData);\n          });\n        } else if (signType === 'RAW') {\n          IWSAgent.IWSARawSignDefaultDN(signText[key], CertListData[0].certDN, 0, DigestArithmetic, function (errorCode, signedData) {\n            onSignEnd(key, index, errorCode, signedData);\n          });\n        }\n      });\n    };\n    getSignCertListInfo(IWSAgent, issuer, serialNumber, signFC, callback);\n  } catch (error) {\n    throw new Error(error);\n  }\n}\nfunction IWSAGetCertPublicKeyInfoForIndex(index, callback) {\n  var IWSAgent = new window.IWSAgent();\n  IWSAgent.IWSAGetCertInfoForIndex(index, callback);\n}\nfunction getAllCertsByDNFilter(filter, getCertsSucceed) {\n  // CertStoreSM2 国密证书存储区，没有填“”\n  // CertStoreRSA RSA证书存储区，全部、加密、签名\n  // Keyspec 按密钥用法过滤，为0返回全部证书,为2返回签名证书\n  // SucceedFunction(CertListData) 证书的六项按顺序分别:CertListData[{certDN, issuerDN, certSN, validBegin, validEnd, CertStore, KeyUsage, CertType},{certDN, issuerDN, certSN, validBegin, validEnd, CertStore, KeyUsage, CertType}]   函数成功后的回调函数(同步方式忽略此参数)\n  // IWSAGetAllCertsListInfo(CertStoreSM2, CertStoreRSA,Keyspec,SucceedFunction)\n  var IWSAgent = new window.IWSAgent();\n  // certObj.IWSAGetAllCertsListInfoByCertDN('', 'Sign', 'C=cn,O=INFOSECTechnologiesRSA,CN=RSARoot2048', 2, (CertListData) => succeed(CertListData, callback))\n  // if (filter.issuerDNFilter === '' && filter.serialNumFilter === '') {\n  // 0 按密钥用法过滤，为0只返回全部证书,为2只返回签名证书\n  IWSAgent.IWSAGetAllCertsListInfo(CertStoreSM2, 'Sign', 2, getCertsSucceed);\n}\nfunction main(caConfig) {\n  var config = {// 导入时，证书过滤条件\n    // issuerDNFilter: getConfig(caConfig, 'issue'),\n    // serialNumFilter: getConfig(caConfig, 'serialNumFilter')\n  };\n  var IWSAgentFC = {\n    IWSAGetCertPublicKeyInfoForIndex: IWSAGetCertPublicKeyInfoForIndex,\n    getAllCertsByDNFilter: getAllCertsByDNFilter\n  };\n  var plugin = {\n    importCert: function importCert(params, callback) {\n      var pageId = params.pageId;\n      try {\n        _certService.certService.loadCertJs(function () {\n          var IWSAgent = new window.IWSAgent();\n          vaildatePluginVersion(IWSAgent, callback);\n          _certService.certService.selectCert(pageId, function (cert, pageId, publicKey) {\n            importCertCallBack(cert, publicKey, callback);\n            // IWSAgent.IWSABase64Encode(publicKey, (errorCode, TextData) => { importCertCallBack(cert, TextData, callback) })\n          }, 'IWSA', IWSAgentFC, config);\n        }, 'IWSA');\n      } catch (error) {\n        var callBackData = {\n          success: false,\n          status: error.message\n        };\n        callback(callBackData);\n      }\n    },\n    signCert: function signCert(params, callback) {\n      var serialNumber = params.serialNumber,\n        signText = params.signText,\n        issue = params.issue;\n      try {\n        _certService.certService.loadCertJs(function () {\n          var IWSAgent = new window.IWSAgent();\n          vaildatePluginVersion(IWSAgent, callback);\n          signCertText(IWSAgent, signText, issue, serialNumber, 'RAW', 'SHA1', callback);\n        }, 'IWSA');\n      } catch (error) {\n        var callBackData = {\n          success: false,\n          status: error.message\n        };\n        callback(callBackData);\n      }\n    }\n  };\n  if (!_global[\"default\"][_global.KD_PLUGIN]) {\n    _global[\"default\"][_global.KD_PLUGIN] = {};\n  }\n  _global[\"default\"][_global.KD_PLUGIN] = Object.assign({}, _global[\"default\"][_global.KD_PLUGIN], plugin);\n}\n\n//# sourceURL=webpack://bos-platform/./src/plugin/cert/IWSA/plugin.js?");

/***/ }),

/***/ "../../node_modules/xss-filters/src/xss-filters.js":
/*!******************************************************************************************!*\
  !*** delegated ../../node_modules/xss-filters/src/xss-filters.js from dll-reference lib ***!
  \******************************************************************************************/
/***/ (function(module, __unused_webpack_exports, __webpack_require__) {

eval("module.exports = (__webpack_require__(/*! dll-reference lib */ \"dll-reference lib\"))(8375);\n\n//# sourceURL=webpack://bos-platform/delegated_../../node_modules/xss-filters/src/xss-filters.js_from_dll-reference_lib?");

/***/ })

}]);