"use strict";(self.webpackChunknocode_flow=self.webpackChunknocode_flow||[]).push([[952],{53088:function(e,t,n){n.r(t),n.d(t,{NocodeFlow:function(){return cc}});var r={};n.r(r),n.d(r,{O:function(){return Ht},$M:function(){return Wt},W:function(){return Lt},uy:function(){return zt},eO:function(){return Kt},E7:function(){return Ut}});var a=n(34716),l=n.n(a),o=n(70696),i=n.n(o),c=n(4884),u=n.n(c),d=n(3464),s=n.n(d),f=n(25376),p=n(30644),v=n(760),m=n.n(v),y=n(23992),g=n.n(y),h=n(50524),E=n.n(h),b=n(13939),C=n.n(b),N=n(65984),I=n.n(N),T=n(18040),k=n.n(T),x=n(63548),_=n(2664),w=n(38456),M=n.n(w),S=n(98752),A=n(84912),P=n.n(A),D=I().createContext({});D.displayName="DesignerContext";var O=I().createContext({});O.displayName="FlowViewContext";var j=n(65992),B="StartSignalEvent",R="EndNoneEvent",F="QueryDataAutoTask",V="NewBillAutoTask",q="UpdateBillAutoTask",K="NoCodeAuditTask",U="NoCodeUserTask",H="NoCodeGateway",W="NoCodeJudgeTask",L="CalculateAutoTask",z="NoCodeNotifyTask",J="NullNode",G="ApiInvokeAutoTask",$="SequenceFlow",Y=n(34984),Q=n(99308),X=n.n(Q),Z=n(61260),ee=n.n(Z),te=n(25288),ne=n.n(te),re=n(11908),ae=n.n(re),le=n(73980),oe=n.n(le),ie=n(60644),ce=n(82504),ue="nocodeflow-main",de="nocodeflow-main-end-node",se="setSyncData",fe="filterItemLook",pe="done",ve="todo",me="terminate",ye="[文本]流程名称",ge="${proc.procName}",he=["bos_adminorg","bos_user"],Ee={NoCodeTextAreaField:"textarea"},be={1301:"1601",102:"1602"},Ce="nocode_flow_testapi";function Ne(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ne(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Te=function(e){return e===B},ke=function(e){var t=e._Type_,n=e.isNullNode;return t===H&&!n},xe=function(e){var t=e._Type_,n=e.isNullNode;return t===H&&n},_e=function(e){return e._Type_===W},we=function(e){return e===L},Me=function(e){return e===V},Se=function(e){return e===q},Ae=function(e){return e===U},Pe=function(e){return e===F},De=function(e){return e===G},Oe=function(e){return(null==e?void 0:E()(e).call(e,"NoCodeRefBillField"))||(null==e?void 0:E()(e).call(e,"NoCodeMulRefBillField"))},je=function(e){var t;return E()(t=["NoCodeCreatorField","NoCodeModifierField"]).call(t,e)},Be=function(e,t){var n=t.data,r=t.selection,a={},l=i()(e).call(e,(function(e,t){var r=n.findControl(e);return 0===t&&(a=r),!Te(r._Type_)}));if(l.length){var o=l[0],c=a.parentId,u=n.getPrevSibling(o).control,d=void 0===u?{}:u;n.deleteControl((0,T.createDeleteAction)(l)).then((function(){var e=n.findControl(c)||{};if(_e(a)&&ke(e))if(xe(d)){var t=n.getSubControls(c),l=i()(t).call(t,(function(e){return _e(e)}))||[],o=l[l.length-1];null!=o&&o.id&&r.setSelect([o.id])}else{var u=d.id;u&&r.setSelect([u])}else if(xe(e)){var s=e.parentIds.split(","),f=s[s.length-1];f&&r.setSelect([f])}else r.setSelect([c])}))}},Re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"calcId";return Ie((0,f.c)({},t,(0,T.createUUid)()),e)},Fe=function(e){var t={};return e&&e.forEach((function(e){var n=e.Config,r=e.Number;if(n){var a=(n||{}).Editor,l=void 0===a?{}:a;t[r]=null==l?void 0:l.Default}})),t},Ve=function(e,t){var n=t._Type_;if(we(n)||Se(n)){var r=(e.getControlMetaEditor(n,"setting")||{}).ChildProperty;if(!r)return t;var a=[Re(Fe(r))];return Ie(Ie({},t),{},{setting:a})}return function(e){return e===K}(n)||Ae(n)?Ie(Ie({},t),{},{taskSubject:st(dt(ge,{title:ye}),!0)}):t},qe=function(e,t,n,r){if(null!=e&&e.length){for(var a=t.data,l=[],o=0;o<e.length;o++){var i=e[o],c=a.findControl(i);if(Te(c._Type_))return void n("触发节点不允许复制",1);l.push(c)}n("复制成功",0),r(l)}},Ke=function(e){return"byrela"===e},Ue=function(e){var t;return E()(t=["NoCodeCreatorField","NoCodeCreateDateField","NoCodeModifierField","NoCodeModifyDateField","NoCodeBillNoField"]).call(t,e)},He=function(e){return"NoCodeGroupContainerAp"===e},We=n(82416),Le=["id","rootKey","number","type"],ze=["children"],Je=["children","valueItems","billEntityId","displayProp","isMulti","compareTypes","refSelf"];function Ge(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function $e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ge(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Ye=We.Condition.constants,Qe=Ye.allFieldRegExp,Xe=Ye.allExpRegExp,Ze=Ye.fieldRegExp,et=Ye.createFiledExp,tt=Ye.expRegExp,nt=function(e,t){var n;return m()(n="".concat(e)).call(n,t)},rt=function(e,t,n){var r;return m()(r="".concat(e,"_")).call(r,nt(t,n))},at=function(e){return function(e){return"view"===e}(e)||function(e){return"display"===e}(e)},lt=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!t||0===n.length)return r;for(var a=(0,ie.cloneDeep)(n),l=a.length-1;l>0;l--){var o=a[l];if(o.id===t&&!E()(r).call(r,o.parentId)){if(!xe(o)){var i=o.parentId;return r.push(i),ee()(a).call(a,l,1),e(i,a,r)}for(var c,u=null===(c=o.parentIds)||void 0===c?void 0:c.split(","),d=u.length,s=0;s<d;s++){var f=u[s];r.push(f),r=(0,j.c)(new(X())(m()(r).call(r,e(f,a,r))))}}}return r},ot=function(e){if(!e)return{};var t={},n=function(){var n,a={};null===(n=e[r])||void 0===n||n.forEach((function(e){a[e.prop]=e})),t[r]=a};for(var r in e)n();return t},it=function e(t){var n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce((function(l,o){var i=o.option,c=void 0===i?{}:i,u=c.children,d=void 0===u?[]:u,s=a||"pk"===o.type&&(null==c||!c.expendOnlyInExp)?e(o.value,d||[],n,r,a):[];if(0===n.length||E()(n).call(n,o.type)||null!=s&&s.length){var f=!0;if("function"==typeof r&&(f=r(o)),f){var p,v,m=$e($e({},o),{},{parentKey:t,key:o.value,type:null!==(p=Ee[null===(v=o.option)||void 0===v?void 0:v.editorType])&&void 0!==p?p:o.type});null!=n&&n.length&&!E()(n).call(n,o.type)&&(m.selectable=!1,m.checkable=!1),null!=s&&s.length&&(m.children=s),l.push(m)}}return l}),[])},ct=function(e){var t;if(!e)return"";var n,r=e._disp_,a=void 0===r?{}:r,l=e._Type_;if(l===F){var o,i,c=e.queryModel;if(Ke(c))return m()(o="".concat(null==e?void 0:e.name)).call(o,a.refbillField?"（".concat(a.refbillField,"）"):"");if(It(c))return m()(i="".concat(null==e?void 0:e.name)).call(i,a.apiId?"（".concat(a.apiId,"）"):"")}return l===q?m()(n="".concat(null==e?void 0:e.name)).call(n,a.refNodeId?"（".concat(a.refNodeId,"）"):""):m()(t="".concat(null==e?void 0:e.name)).call(t,a.formId?"（".concat(a.formId,"）"):"")};function ut(){return(window.crypto||window.webkitCrypto||window.mozCrypto||window.oCrypto||window.msCrypto).getRandomValues(new Uint32Array(1))[0]}var dt=function(e,t){return et(e,t)};function st(e,t){var n,r,a=(e=e.replace(/）/g,")").replace(/（/g,"(").replace(/“/g,'"').replace(/”/g,'"').replace(/‘/g,"'").replace(/’/g,"'")).replace(/ {{/g,"{{").replace(/}} /g,"}}").replace(Qe,"$1");return a=a.replace(Xe,(function(e){var t;return((null===(t=e.match(tt))||void 0===t?void 0:t[1])||"").replace("YMDDATE","DATE")})),m()(n=m()(r="".concat(ne()(a).call(a),"@@")).call(r,e,"@@")).call(n,t?1:0)}var ft={title:"流程名称",titlePrefix:"[文本]",nodeId:"${proc.procName}",key:"${proc.procName}",type:"text"},pt=["001"];function vt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=new Date(t),r={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};for(var a in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),r)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?r[a]:("00"+r[a]).substr((""+r[a]).length)));return e}var mt=function(e){return"time"===e},yt=function(e){var t=e.id,n=e.rootKey,r=e.number,a=e.type,l=(0,Y.c)(e,Le),o=ut();return r=r||nt(a,o),$e({id:t=t||rt(n,a,o),_Type_:a,number:r,itemId:t},l)},gt=function(e){var t=e.compareTypesMap,n=e.type,r=e.entityId,a=t[n]||[];return"bos_user"===r?a="nocodecreatorfield":"bos_adminorg"===r&&(a="orgfield"),"string"==typeof a&&(a=t[a]),function(e){return(null==e?void 0:i()(e).call(e,(function(e){return!E()(pt).call(pt,e.id)})))||[]}(a)},ht=function e(t,n,r){return(t||[]).reduce((function(t,a){var l,o,i=a.id,c=a.option,u=void 0===c?{}:c,d=u.children,s=(0,Y.c)(u,ze),f=m()(l="".concat(n,".")).call(l,i),p=null!=f&&E()(f).call(f,"fbasedataid")?i.split(".fbasedataid")[0]:f;if(((null==p||null===(o=p.split("."))||void 0===o?void 0:o.length)||0)>r)return t;var v=$e({},s);d&&(v.children=e(d,n,r));var y=$e($e({},a),{},{id:f,option:v||{}});return m()(t).call(t,y)}),[])},Et=function e(t,n,r){var a,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return i()(a=(n||[]).reduce((function(n,a){var o,i,c=a.caption,u=a.type,d=a.id,s=a.option,f=void 0===s?{}:s,p=a.typeCaption,v=null!=d&&E()(d).call(d,"fbasedataid")?d.split(".fbasedataid")[0]:d;if(((null==v||null===(o=v.split("."))||void 0===o?void 0:o.length)||0)>l)return n;var y=f.children,g=f.valueItems,h=f.billEntityId,b=f.displayProp,C=f.isMulti,N=(f.compareTypes,f.refSelf),I=(0,Y.c)(f,Je),T=function(e){return null==e?void 0:e.split("-")[0]}(u).toLowerCase(),k=d,x=$e({title:c,key:k,compareTypes:gt({compareTypesMap:r,type:T,entityId:h}),type:u,titlePrefix:p,selectable:"group"!==u},I);return Oe(u)||je(u)?x=(0,_.c)(x,{displayProp:b,entityId:h,isMulti:C}):function(e){return"NoCodeSelectItemField"===e}(u)&&(x=(0,_.c)(x,{isMulti:C})),g&&(x.items=g),C||(y?x.children=e(t,y,r,l):!0===N&&(x.children=e(t,ht(t,k,l),r,l))),"group"!==u||null!==(i=x)&&void 0!==i&&null!==(i=i.children)&&void 0!==i&&i.length?m()(n).call(n,x):n}),[])).call(a,(function(e){var t=e.type,n=e.entityId;return!Oe(t)&&!je(t)||null!==n}))},bt=function(e){return Ze.test(e)||tt.test(e)||(null==e?void 0:E()(e).call(e,"@@"))},Ct=[/^\$\{(.+?)\}/,/^disp\((.+?)\)/],Nt=function(e){return Ct.some((function(t){return t.test(e)}))&&!bt(e)},It=function(e){return"byapi"===e},Tt=["refbill","user","org"],kt=function(e){return!!e&&E()(Tt).call(Tt,e)},xt=function(e){return!!e&&(null==e?void 0:ae()(e).call(e,"combo"))},_t=function(e){var t=e.match(/^(\[[^\[\]]+\])+/g),n=null!=t&&t.length?t[0]:"";return{title:oe()(e).call(e,n.length),titlePrefix:n}},wt=function e(t){return t.reduce((function(t,n){var r=n.option,a=n.title,l=(r||{}).children,o=_t(a),i=o.title,c=o.titlePrefix,u=$e($e({},n),{},{title:i,titlePrefix:c});return l?(u.option=$e($e({},r),{},{children:e(l)}),m()(t).call(t,u)):m()(t).call(t,u)}),[])},Mt=function(e){return C()(e).reduce((function(t,n){var r=e[n];return t[n]=wt(r),t}),{})};function St(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function At(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?St(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):St(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Pt={x:0,y:0},Dt=function(e){return At({position:Pt},e)},Ot=function(e){return At({style:e.isDone?{stroke:"var(--kd-nc-primary-6)"}:{stroke:"#d9d9d9"},itemId:e.id},e)},jt=function(e){return e?"smoothstep":$},Bt=function(e,t){var n;return e&&E()(n=[pe,"doing",me,"exception_terminate"]).call(n,t)},Rt={},Ft=function(e,t){for(var n,r=e.getData(),a=r.Items,l=(r.edges,r.key),o=[],i=[],c=a.length,u=[],d={},s=at(t),f=0;f<c;f++){var p=a[f],v=p.id,y=p.parentId,h=p._Type_,b=(p.number,p.isNullNode),C=p.handleStatus,N=Bt(s,C);if(N&&C!==me&&(Rt[v]=N),h!==R){u.push(y);var I=b?J:h;if(o.push(Dt({id:v,type:I,data:At({},p)})),h!==B)if(b){var T=p.parentIds.split(",");if((null==T?void 0:T.length)>0)for(var k=(null==T?void 0:T.length)||0,x=0;x<k;x++){var _=T[x];u.push(_);var w=ut(),S=rt(l,$,w),A=Rt[_];A&&(Rt[v]=A),i.push(Ot({number:nt($,w),itemId:S,id:S,source:_,target:v,data:{parentId:_,id:v},type:jt(s),isDone:A}))}}else{if(ke(p)){var P=e.getSubControls(v)||[];N=!!M()(P).call(P,(function(e){return _e(e)&&e.handleStatus===pe}))}var D=rt(l,$,f);i.push(Ot({number:nt($,f),itemId:D,id:D,source:y,target:v,data:{parentId:y,id:v},type:jt(s),isDone:N}))}}else d=p}var O=function(e,t){return(M()(e).call(e,(function(e){return!E()(t).call(t,e.id)}))||{}).id}(o,u),F=d,V=F.id,q=F.number,K=F.handleStatus,U=function(e,t,n){return Dt({id:t,type:R,data:{id:t,itemId:t,number:e,parentId:n,_Type_:R}})}(q,V,O),H=g()(i).call(i,(function(e){var t=e.id.split($);return Number((null==t?void 0:t[1])||0)})),W=H.length>0?Math.max.apply(Math,(0,j.c)(H))+1:0,L=rt(l,$,W),z=nt($,W),G=Bt(s,K),Y=function(e,t,n,r,a,l){return Ot({id:t,source:r,target:n,data:{parentId:r,id:n},type:a||$,number:e,isDone:l})}(z,L,V,O,jt(s),G);return o.push(U),i.push(Y),m()(n=[]).call(n,o,i)};function Vt(e,t,n){var r,a,l=e.data,o=document.createElement("div");o.setAttribute("style",m()(r=m()(a="".concat("line-height: 20px; word-break: break-all; font-size: 14px;"," width: ")).call(a,t,"px; max-width:")).call(r,t,"px;")),document.body.appendChild(o),o.innerText=(null==l?void 0:l.documentation)||"";var i=o.getBoundingClientRect().height;return document.body.removeChild(o),n+(i>40?40:i)}function qt(){return{style:{background:"#F8FAFC"},panOnScroll:!0,zoomOnScroll:!1,preventScrolling:!1,nodesConnectable:!1,nodesDraggable:!1,panOnScrollMode:S.WY.Free,defaultZoom:1,minZoom:1/1.5/1.5/1.5,maxZoom:3.375,zoomOnDoubleClick:!1}}var Kt="_Type_",Ut="items",Ht="Controls",Wt="Enum",Lt="Items",zt="parentId",Jt=n(85640),Gt=n(29052),$t=n.n(Gt),Yt=n(24496),Qt=n.n(Yt),Xt=function(){var e=(0,Jt.c)($t().mark((function e(t,n){return $t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null==n){e.next=4;break}return window.localStorage.setItem(t,Qt()(n)),e.abrupt("return",!0);case 4:return e.abrupt("return",!1);case 7:e.prev=7,e.t0=e.catch(0),window.localStorage.clear();case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),Zt="nocodeflow.CopyContent",en=function(e){Xt(Zt,e)},tn=function(){var e=window.localStorage.getItem(Zt);return e&&(e=JSON.parse(e)),e},nn=["id","itemId","number","_Type_"];function rn(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function an(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rn(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):rn(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var ln=function(e,t){var n=(0,N.useContext)(D),a=n.getKdesignerApi,l=n.flowStatus,o=(0,N.useContext)(T.GlobalConfigContext).showMessage,c=(0,N.useMemo)((function(){return a()}),[]),u=c.data,d=c.selection,s=d.getSelection,p=d.setSelect,v=d.getActiveSelectedId;(0,N.useEffect)((function(){var t=e.current;if(t&&!at(l)){var n=function(e){if(e.target===t){e.stopPropagation();var n=e.keyCode;switch(n){case T.keyCode.BACKSPACE:case T.keyCode.DELETE:var a,l=s()[0],m=u.findControl(l),y=u.findControl(null==m?void 0:m.parentId);if(m._Type_===W&&null!=m&&null!==(a=m.parentId)&&void 0!==a&&E()(a).call(a,H)){var h=u.getAllSiblings(l);if(i()(h).call(h,(function(e){return e._Type_===W})).length<=2&&!y.isNullNode)break}!function(e){var t=(0,e.selection.getSelection)();1===t.length&&Be(t,e)}(c);break;case T.keyCode.Z:var b=u.canUndo();(0,T.isCtrlActive)(e)&&b&&u.undo();break;case T.keyCode.Y:var C=u.canRedo();(0,T.isCtrlActive)(e)&&C&&u.redo();break;case T.keyCode.LEFT:case T.keyCode.RIGHT:case T.keyCode.UP:case T.keyCode.DOWN:var N=v({dataContext:u,selectionContext:d}),I=n===T.keyCode.LEFT||n===T.keyCode.UP?u.getPrevSibling(N):u.getNextSibling(N),k=I&&I.control;k&&p([k[r.ID]]);break;case T.keyCode.C:if(e.preventDefault(),e.ctrlKey){null==e||e.stopPropagation();var x=s();qe(x,c,o,en)}break;case T.keyCode.V:if(e.preventDefault(),e.ctrlKey){var _=tn();if(Array.isArray(_)){var w=s();if(0===w.length){o("请先选择一个节点，再进行粘贴操作",1);break}if(1===w.length){var M=w[0],S=u.findControlIndex(M),A=u.getData().key,P=g()(_).call(_,(function(e){e.id,e.itemId,e.number;var t=e._Type_,n=(0,Y.c)(e,nn);return yt(an(an({},n),{},(0,f.c)((0,f.c)((0,f.c)({},zt,M),"rootKey",A),"type",t)))}));if(!P.length)return;var D=P[P.length-1].id,O=u.findControlByCondition((function(e){var t;return e[zt]===M||(null===(t=e.parentIds)||void 0===t?void 0:E()(t).call(t,M))})),j=g()(O).call(O,(function(e){return xe(e)?[e.id,{parentIds:e.parentIds.replace(M,D)}]:[e.id,(0,f.c)({},zt,D)]}));u.addControl((0,T.createPasteAction)(P,{index:S+1})).then((function(e){u.batchUpdateControlPropertyValues((0,T.createUpdateAction)(j),!1),p(D),o("粘贴成功",0)}))}}}}}};return t.addEventListener("keydown",n),function(){t.removeEventListener("keydown",n)}}}),[])},on=n(24244),cn=n.n(on),un=n(58496),dn=(0,N.memo)((function(e){var t=e.displayData,n=void 0===t?{}:t,r=e.propertyData,a=void 0===r?{}:r,l=e.className,o=(0,N.useMemo)((function(){var e=a||{},t=e.Editor,r=e.Id,l=t.Enum,o=t.DataType,i=t.Default,c=(t.Type,n[r||""]||i);if("Boolean"===o)return void 0!==c?c?"是":"否":i?"是":"否";if(l&&(null==l?void 0:l.length)>0){var u=(null==c?void 0:c.split(","))||[],d=[];return l.forEach((function(e){E()(u).call(u,e.Id)&&d.push(e.Name)})),d.join("，")||c||"-"}return c||"-"}),[a,n]),i=a.Editor.SubTitle;if(a.Editor.ChildProperty&&Array.isArray(o)){var c,u={};return null===(c=a.Editor)||void 0===c||null===(c=c.ChildProperty)||void 0===c||c.forEach((function(e){var t=e.Number,n=e.Name;u[t]=n})),null==o?void 0:g()(o).call(o,(function(e){var t=C()(e);return I().createElement("div",{className:"".concat(l,"-display-viewitem")},I().createElement("span",{className:"title"},a.Name,i&&I().createElement("span",{className:"subTitle"},i)),g()(t).call(t,(function(t,n){return u[t]?I().createElement("div",{key:n,className:"".concat(l,"-display-viewitem")},I().createElement("span",{className:"title"},u[t]),I().createElement("span",{className:"content"},"object"===(0,un.c)(e[t])?Qt()(e[t]):e[t])):null})))}))}return I().createElement("div",{className:"".concat(l,"-display-viewitem")},I().createElement("span",{className:"title"},a.Name,i&&I().createElement("span",{className:"subTitle"},i)),I().createElement("span",{className:"content"},"object"===(0,un.c)(o)?Qt()(o):o))}));dn.displayName="DisplayViewItem";var sn=(0,T.ErrorBoundaryWrap)(dn,"DisplayViewItem"),fn=n(71252),pn=n.n(fn);function vn(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vn(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):vn(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var yn=["content","expression","filter","orderby","newSetting","setting","calcSetting","userSelect","judgefilter","varselect","multivarselect","combineselector","userInputPerm","decisionOptions","triggerTime","parameterSetting","requestBody","Switch"],gn=["setting","decisionOptions","requestHeader","responseParams","requestBody","sourceData"],hn=(0,N.memo)((function(e){var t,n=e.controlData,r=e.isLoading,a=(0,N.useContext)(D),l=a.getPrefixCls,o=a.prefixCls,c=a.getKdesignerApi,u=(a.flowStatus,a.isReadonly),d=(0,N.useContext)(T.GlobalConfigContext).filterProperty,s=(0,N.useMemo)((function(){return c()}),[]),p=(0,N.useMemo)((function(){if(!n)return{};var e=mn({},n._disp_||{});return C()(n||{}).forEach((function(t){!e[t]&&n[t]&&(e[t]=n[t])})),e}),[n]);if(!n||r)return null;var v=s.meta,m=s.data,y=n._Type_,h=v.getDefaultData(y),b=v.getControlMeta(y);if(b.Properties){var k,x,w,M,S=m.getData(),A=(0,T.getModelData)(b.Properties,mn(mn({},S),{},{field:mn(mn({},h),n)})),P=cn()((k=A,x=function(e){return!d(e)},w=function(e){var t,n,r;return!(0==(null==e||null===(t=e.Nodes)||void 0===t?void 0:t.length)||(null==e||null===(n=e.Nodes)||void 0===n?void 0:n.every((function(e){return!1===(null==e?void 0:e.Visible)})))||u&&E()(r=["NCPG_ApiTest"]).call(r,e.Key))},t=g()(M=i()(k).call(k,w)).call(M,(function(e){var t=e.Nodes,n=i()(t).call(t,(function(e){return!1!==e.Visible&&x(e)}));return mn(mn({},e),{},{Nodes:n})})))).call(t,(function(e,t){return void 0===e.Seq?-1:void 0===t.Seq?1:e.Seq-t.Seq})),O=l(o,"property-view");return I().createElement("div",{className:pn()(O,(0,f.c)({},"".concat(O,"-display"),u))},null==P?void 0:g()(P).call(P,(function(e){var t=e.Nodes,r=e.Id,a=e.Name,l=e._Type_;return I().createElement("div",{key:r,className:"".concat(O,"-group")},"PropertyGroup"===l&&I().createElement("div",{className:"".concat(O,"-group-title")},a),g()(t).call(t,(function(e){if(u){var t=(null==e?void 0:e.Editor)||{},r=t.Type,a=t.Default;if(!E()(yn).call(yn,r)||void 0===p[e.Id]&&"undefined"===a)return I().createElement(sn,{className:"kdesigner-right-view",displayData:p,propertyData:e})}return I().createElement(T.PropertyViewItem,(0,_.c)({},e,{key:e.Id,field:n,className:"kdesigner-right-view",enableMutiSelect:!1,readonly:u,renderCustomError:function(e){if(E()(gn).call(gn,e.prop))return!0}}))})))})))}}));hn.displayName="PropertyView";var En=hn;function bn(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bn(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):bn(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Nn=(0,f.c)((0,f.c)((0,f.c)({},F,{desc:"查找结果",establish:"查找有结果",notEstablished:"查找无结果"}),K,{desc:"审批结果",establish:"审批通过",notEstablished:"审批否决"}),G,{desc:"响应状态"}),In=function(e,t){return{_Type_:"FilterItem",compareType:"1001",value:Qt()(t),fieldName:e}},Tn=(0,N.memo)((function(e){var t=e.Id,n=e.Name,r=e.className,a=(e.activedSelectId,e.Tips),l=e.Visible,o=void 0===l||l,i=e.parentId,c=e.rootKey,u=e.childId,d=(0,N.useState)(!1),s=(0,p.c)(d,2),f=s[0],v=s[1],y=(0,N.useContext)(D),h=y.getKdesignerApi,b=y.getControlIconMap,k=y.getNodeVariablesById,w=y.webMsg,S=y.getControlText,A=(0,N.useContext)(T.GlobalConfigContext).getOutlineItemIcon,P=(0,N.useMemo)((function(){return h()}),[]),O=P.data,j=P.selection,B=P.dataFactory,R=(0,N.useMemo)((function(){return O.findControl(i)}),[i]),F=function(e){var r=B({type:t,parentId:i,name:n}),a=(0,T.createAddAction)((0,_.c)(r,Cn({rootKey:c,childId:u},e)));O.addControl(a).then((function(e){if(e[0]){var t=e[0].value;if(ke(t)){var n=e[1].value;j.setSelect([null==n?void 0:n.id])}else j.setSelect(Array.isArray(t)?[t[0].id]:[t.id])}}))},V=(0,N.useCallback)((function(e){var t=k(e)||[];return M()(t).call(t,(function(e){var t;return null==e||null===(t=e.option)||void 0===t?void 0:t.isResult}))||{option:{}}}),[k]),q=(0,N.useCallback)((function(e){for(var t=[],n=V(e),r=n.option.valueItems,a=void 0===r?[]:r,l=0;l<a.length;l++){var o=a[l],i=o.name,c=o.value;t.push({name:"string"==typeof i?i:S(i),filter:[In(n.value,[{fieldValue:c}])]})}return t}),[V]),K=function(e){var t,n=R.name,r=R._Type_,a=(R.id,Nn[r]||{});null==w||w.showConfirmModal({title:m()(t="是否添加【".concat(n||"","】")).call(t,a.desc||"","为判断条件？"),content:"分支条件默认配置为".concat(g()(e).call(e,(function(e){return e.name})).join("、"),"；"),actions:[{text:"不添加",key:"cancel"},{text:"添加",key:"confirm"}],onAction:function(t){return function(e,t){"confirm"===e?F({childActions:t}):"cancel"===e&&F()}(t,e)},type:"prompt"})},U=(0,N.useCallback)((function(e){v(e)}),[]);if(!o)return null;var H=I().createElement("div",{className:"".concat(r,"-control-main"),onClick:function(){if(ke({_Type_:t})){var e;if(!R)return;var n=null==R?void 0:R[Kt],r=q(R.id);if(E()(e=C()(Nn)).call(e,n)&&(null==r?void 0:r.length)>0)return void K(r)}F()}},I().createElement("div",{className:"icon",style:{backgroundColor:b(t).bgc}},A(t)),I().createElement("span",{className:"title"},n));return I().createElement("div",{className:"".concat(r,"-control")},a?I().createElement(x.Tooltip,{placement:"right",tip:a||"",visible:f,onVisibleChange:U},H):H)}));Tn.displayName="ControlViewItem";var kn=function(e){var t=e.Categories,n=e.Controls;return g()(t).call(t,(function(e){var t=e.Id,r=i()(n).call(n,(function(e){return e.CategoryId===t&&!e.Hidden}));return Cn(Cn({},e),{},{Controls:r})}))},xn=(0,N.memo)((function(e){var t=e.controlData,n=e.parentId,r=e.childId,a=(0,N.useContext)(D),l=a.getPrefixCls,o=a.prefixCls,i=a.getKdesignerApi,c=(0,N.useMemo)((function(){return i()}),[]),u=c.meta,d=c.data.getData(),s=u.getMeta(),f=(0,N.useState)((function(){return kn(s)})),v=(0,p.c)(f,2),m=v[0],y=v[1],h=l(o,"control-view");return(0,N.useEffect)((function(){y((function(){return kn(s)}))}),[s]),I().createElement("div",{className:h},g()(m).call(m,(function(e,a){var l;return!1===e.Visible?null:I().createElement("div",{key:a,className:"".concat(h,"-container")},I().createElement("div",{key:a,className:"".concat(h,"-container-header")},e.Name),I().createElement("div",{className:"".concat(h,"-container-content")},g()(l=(null==e?void 0:e.Controls)||[]).call(l,(function(e){return I().createElement(Tn,(0,_.c)({key:e.Id,rootKey:d.key,className:"".concat(h,"-container-content")},e,{parentId:n,childId:r,activedSelectId:t.id}))}))))})))}));xn.displayName="ControlView";var _n=xn,wn="clickAddNode",Mn="setRightPanel",Sn="setRefBillTreeData",An="setTreeNodeChildren",Pn="setTestApi",Dn="setNoCodeIpList",On=(0,N.memo)((function(e){var t=e.prefixCls,n=e.isLoading,r=(0,N.useRef)(),a=(0,N.useContext)(D),l=a.getKdesignerApi,o=a.getControlIconMap,i=(0,N.useContext)(T.GlobalConfigContext).getOutlineItemIcon,c=(0,N.useState)(!1),u=(0,p.c)(c,2),d=u[0],s=u[1],v=(0,N.useState)(""),m=(0,p.c)(v,2),y=m[0],g=m[1],h=(0,N.useState)(!1),E=(0,p.c)(h,2),b=E[0],C=E[1],k=(0,N.useState)({}),w=(0,p.c)(k,2),M=w[0],S=w[1],A=(0,N.useState)(0),P=(0,p.c)(A,2),O=(P[0],P[1]),j=(0,N.useMemo)((function(){return l()}),[]),B=j.data,R=j.meta,F=j.selection,V=(B.getData(),B.getRootId()),q=B.findControl(y)||{},K=q._Type_,U=(0,N.useMemo)((function(){return R.getMeta()[Ht]}),[]),H=(0,N.useCallback)((function(e){S(e),C(!0),s(!0)}),[]),W=function(e){s(e.visible)};(0,N.useEffect)((function(){return T.eventBus.on(wn,H),T.eventBus.on(Mn,W),function(){T.eventBus.off(wn,H),T.eventBus.off(Mn,W)}}),[]);var L=(0,N.useCallback)((function(e){O((function(e){return e+1}))}),[]),z=(0,N.useCallback)((function(e){var t=e.value,n=(e.oldValue,t[0]);n&&n!==V&&C(!1),s(!!n),g(n)}),[]);(0,N.useEffect)((function(){var e=F.addSelectChangeListener(z),t=B.addDataChangeListener(L);return function(){null==e||e(),null==t||t()}}),[z]);var J=(0,N.useCallback)((function(){null==s||s(!1),F.setSelect([])}),[]),G=(0,N.useMemo)((function(){var e=(R.getControlMeta(K)||{}).Name;return mt(null==q?void 0:q.triggerMode)?"定时触发":e}),[K,null==q?void 0:q.triggerMode]),$=(0,N.useMemo)((function(){var e=!G;return I().createElement("div",{className:pn()("".concat(t,"_header"),(0,f.c)({},"".concat(t,"_header_add"),e)),style:{backgroundColor:o(K).bgc}},I().createElement("div",{className:"".concat(t,"_header_title")},e?I().createElement("span",{className:"addname"},"添加节点"):I().createElement(I().Fragment,null,I().createElement("span",{className:"".concat(t,"_header_title_icon")},i(K)),I().createElement("span",{className:"name"},G))),I().createElement(x.Icon,{className:"close",type:"close",onClick:J}))}),[q,U,K,G]);return I().createElement(x.Drawer,{ref:r,className:t,placement:"right",visible:d,onClose:function(){return null==s?void 0:s(!1)},mask:!1,title:$,width:640,closable:!1},b?I().createElement(_n,(0,_.c)({controlData:q},M)):I().createElement(En,{isLoading:n,controlData:q}))}));On.displayName="RightPanel";var jn=On,Bn=function(e){(0,N.useContext)(O).sendSyncData;var t=(0,N.useContext)(D),n=t.getKdesignerApi,r=(t.flowStatus,(0,N.useMemo)((function(){return n()}),[]).selection.setSelect);return(0,N.useCallback)((function(t){t.stopPropagation(),r([e])}),[])},Rn=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=(0,N.useRef)({fn:e,timer:null}).current;return(0,N.useEffect)((function(){r.fn=e}),[e]),(0,N.useCallback)((function(){if(!r.timer){var e,n;r.timer=setTimeout((function(){delete r.timer}),t);for(var a=arguments.length,l=new Array(a),o=0;o<a;o++)l[o]=arguments[o];(e=r.fn).call.apply(e,m()(n=[this]).call(n,l))}}),n)},Fn=null,Vn=null,qn=function(e,t,n){var r=(0,N.useContext)(D),a=r.getKdesignerApi,l=r.flowStatus,o=(0,N.useRef)(document.querySelector("#".concat(ue))),i=(0,S.o3)(),c=((0,S.CG)((function(e){return e.transform})),(0,S._s)()),u=Rn((function(e){var t=i.getState(),n=t.transform,r=(t.height,t.translateExtent,(0,p.c)(n,3)),a=r[0],l=r[1],u=r[2];if(e.clientY<100&&l<0){if(0===e.clientY)return;c.transform({x:a,y:l+200>0?0:l+200,zoom:u},300)}else if(o.current){var d,s=(null===(d=o.current)||void 0===d?void 0:d.getBoundingClientRect()).height;if(e.clientY<s&&e.clientY>s-100){var f=document.querySelector("#".concat(de));if(f){var v=f.getBoundingClientRect().top;if(v>s){var m=v-l-200>s?l-200:s-v;c.transform({x:a,y:m,zoom:u},300)}}}}}),300,[]),d=(0,ie.throttle)((function(t){t.preventDefault(),function(e){Vn=e}(e)}),200);return{dragEvent:{onDrag:u,onDragStart:function(n){!function(e){Fn=e}(e),t&&t(n)},draggable:!at(l)},dropEvent:{onDragOver:function(e){e.preventDefault(),e.persist(),d(e)},onDrop:function(e){var t,r;e.preventDefault(),r=Vn,(t=Fn)&&r&&r!==t&&a().data.customUpdateState((0,T.createCustomUpdateAction)((function(e){for(var n=e.Items,a=null,l=null,o=null,i=null,c=null,u=0;u<n.length;u++){var d;if(a&&o&&c)break;var s=n[u];s.id===t?(a=s,l=u):s.id===r&&(o=s,i=u),(xe(s)&&null!==(d=s.parentIds)&&void 0!==d&&E()(d).call(d,r)||s.parentId===r)&&(c=s)}if(a.parentId!==r){var f,p,v=M()(n).call(n,(function(e){var n;return xe(e)?null===(n=e.parentIds)||void 0===n?void 0:E()(n).call(n,t):e.parentId===t}));v&&(xe(v)?v.parentIds=null===(f=v.parentIds)||void 0===f?void 0:f.replace(t,a.parentId):v.parentId=a.parentId),a.parentId=r,c&&(xe(c)?c.parentIds=null===(p=c.parentIds)||void 0===p?void 0:p.replace(r,t):c.parentId=t),l>i?(ee()(n).call(n,l,1),ee()(n).call(n,i+1,0,a)):(ee()(n).call(n,i+1,0,a),ee()(n).call(n,l,1))}}))),n&&n(e)}}}},Kn=function(e){var t=(0,N.useState)(!1),n=(0,p.c)(t,2),r=n[0],a=n[1],l=(0,N.useContext)(D).getKdesignerApi,o=(0,N.useMemo)((function(){return l()}),[]).selection,i=(0,N.useCallback)((function(t){var n=t.value,r=null==n?void 0:E()(n).call(n,e);a(r)}),[e]);return(0,N.useEffect)((function(){var t=o.getSelection(),n=null==t?void 0:E()(t).call(t,e);a(n);var r=o.addSelectChangeListener(i);return function(){r()}}),[]),r};function Un(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Hn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Un(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Un(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Wn=function(e,t){var n,r=(0,N.useContext)(D),a=r.getPrefixCls,l=r.prefixCls,o=r.getKdesignerApi,i=r.flowStatus,c=a&&a(l,t||"controls"),u=(o().data.findControl(e)||{}).handleStatus,d=void 0===u?ve:u,s=qn(e),p=Bn(e),v=Kn(e),y=pn()("".concat(c),(0,f.c)({"node-selection":v},m()(n="".concat(c,"_")).call(n,d||ve),at(i)));return e?Hn(Hn({},s),{},(0,f.c)({isSelected:v,onClick:p,prefixClass:c,className:y},"data-node-id",e)):{}},Ln=function(e,t){var n=(0,N.useContext)(D).getKdesignerApi,r=(0,N.useMemo)((function(){return n()}),[]).meta,a=(0,N.useMemo)((function(){return r.getControlMetaEditor(e,t)}),[e,t]),l=(0,N.useMemo)((function(){return(null==a?void 0:a.Enum)||[]}),[a]);return(0,N.useCallback)((function(e){var t;void 0===e&&(e=a.Default||"");var n=(null===(t=e)||void 0===t?void 0:t.split(","))||[],r=[];return l.forEach((function(e){E()(n).call(n,e.Id)&&r.push(e.Name)})),r.join("，")}),[l])},zn=[{key:"copy",name:"复制"},{key:"delete",name:"删除"}],Jn=function(e){var t=e.data,n=e.close,r=e.onClick,a=e.panelRef,l=e.prefixCls,o=(0,N.useCallback)((function(e,t){e.stopPropagation(),null==r||r(t),null==n||n()}),[n,r]);return I().createElement("div",{className:l+"-list",ref:a},t&&(null==t?void 0:g()(t).call(t,(function(e,t){return I().createElement("div",{key:t,className:l+"-list-item",onClick:function(t){return o(t,e)}},e.name)}))))},Gn=(0,N.memo)((function(e){var t=e.prefix,n=e.id,r=(0,N.useContext)(D).getKdesignerApi,a=(0,N.useContext)(T.GlobalConfigContext).showMessage,l=(0,N.useMemo)((function(){return r()}),[]),o=(0,N.useState)(!1),i=(0,p.c)(o,2),c=i[0],u=i[1],d=((0,N.useRef)(null),(0,N.useRef)(null)),s=function(){u(!1)};(0,N.useEffect)((function(){return T.eventBus.on(Mn,s),function(){T.eventBus.off(Mn,s)}}),[]);var f=(0,N.useCallback)((function(){u(!1)}),[]);(0,T.useOnClickOutside)([d],(function(){f()}));var v=function(e){switch(e.key){case"delete":Be([n],l);break;case"copy":qe([n],l,a,en)}u(!1)};(0,N.useMemo)((function(){return I().createElement(x.Dropdown.Menu,null,g()(zn).call(zn,(function(e){var t=e.key,n=e.name;return I().createElement(x.Dropdown.Item,{key:t,onClick:function(e){return v(e)}},n)})))}),[]);return I().createElement("div",{className:"".concat(t,"_header_more"),onClick:function(e){e.stopPropagation(),u(!c)}},I().createElement(x.Icon,{title:"点击更多操作：删除等",className:"".concat(t,"_header_more_icon"),prefix:"designericon",type:"gengduo3"}),c&&I().createElement(Jn,{prefixCls:"".concat(t,"_header_more"),data:zn,panelRef:d,onClose:f,onClick:v}))}));Gn.displayName="MoreHandle";var $n=Gn,Yn=(0,N.memo)((function(e){var t=e.className,n=e.name,r=e.id,a=e.prefix,l=e.showMoreBtn,o=void 0===l||l,i=e._Type_,c=(0,N.useContext)(D),u=c.getPrefixCls,d=c.prefixCls,s=c.flowStatus,f=c.getControlIconMap,p=(0,N.useContext)(T.GlobalConfigContext).getOutlineItemIcon,v=u&&u(d,"controls"),m=pn()("".concat(a||v,"_header"),t),y=(0,N.useMemo)((function(){return f(i).bgc}),[i]);return I().createElement("div",{className:m,style:{backgroundColor:y}},I().createElement("div",{className:"".concat(v,"_header_title"),title:n},I().createElement("span",{className:"".concat(v,"_header_title_icon")},p(i)),I().createElement("span",{className:"name"},n)),!at(s)&&o&&I().createElement($n,{prefix:v,id:r}))}));Yn.displayName="NodeHeader";var Qn=Yn,Xn=(0,N.memo)((function(e){var t=e.children,n=e.id,r=(0,N.useContext)(D).getKdesignerApi,a=(0,N.useMemo)((function(){return r()}),[]).error,l=a.getError(),o=(0,N.useState)(l[n]||{}),i=(0,p.c)(o,2),c=i[0],u=i[1],d=(0,N.useState)(!1),s=(0,p.c)(d,2),f=(s[0],s[1]),v=(0,N.useRef)(null),m=(0,N.useRef)(!1),y=function(e){var t=a.getError(n)||{};u(t)};(0,N.useEffect)((function(){var e=a.addErrorChangeListener(y);return function(){e()}}),[]);(0,N.useEffect)((function(){}),[]);var g=(0,N.useMemo)((function(){var e=0;return C()(c).forEach((function(t){var n=c[t];n&&("string"==typeof n.msg?e+=1:C()((null==n?void 0:n.msg)||{}).forEach((function(t){var r=n.msg[t];e+=null==r?void 0:r.length})))})),e}),[c]),h=(0,N.useMemo)((function(){return"存在有".concat(g,"条错误，请修复后再发布！")}),[g]);if(0===g)return t;var E=pn()({"node-error":!!c});return I().createElement("div",{className:E},I().createElement("div",{className:"node-error-tips",onMouseEnter:function(){f(!0)},onMouseLeave:function(){setTimeout((function(){m.current||f(!1)}),1e3)}},I().createElement("div",{className:"node-error-tips-panel"},I().createElement("div",{ref:v,className:pn()("node-error-tips-panel-content")},I().createElement("span",null,h)),I().createElement("div",{className:"node-error-tips-panel-hot"})),I().createElement("div",{className:"node-error-tips-icon"},g)),t)}));Xn.displayName="ErrorNodeWrap";var Zn=Xn,er=n(31848),tr=n.n(er),nr=function(e){return e<10?"0"+e:e},rr=[4,6,9,11],ar=function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:31;return g()(e=tr()(t=new Array(n)).call(t,"")).call(e,(function(e,t){var n,a,l=t+1,o={key:l,title:"".concat(l,"月"),selectable:!1};return r=E()(rr).call(rr,l)?30:31,o.children=g()(n=tr()(a=new Array(2===l?29:r)).call(a,"")).call(n,(function(e,t){return function(e,t){var n,r,a=t+1;return{key:m()(n="".concat(nr(e),"-")).call(n,nr(a)),title:m()(r="".concat(e,"月")).call(r,a,"号")}}(l,t)})),o}))},lr=function(e){return"week"===e?(t=["一","二","三","四","五","六","日"],g()(t).call(t,(function(e,t){return{label:"周".concat(e),value:(t+1)%7+1+""}}))):"month"===e?function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:31;return g()(e=tr()(t=new Array(n)).call(t,"")).call(e,(function(e,t){return{label:"".concat(t+1,"号"),value:t+1+""}}))}():"year"===e?ar():[];var t},or={},ir=function(e){return or[e]||(or[e]=lr(e)),or[e]},cr=function(e){var t,n=new Date;if(!e)return n;var r=g()(t=e.split(":")).call(t,Number),a=(0,p.c)(r,3),l=a[0],o=a[1],i=a[2];return n.setHours(l,o,i),n},ur={},dr=function(e,t){if("day"===e)return"";if(!ur[e]){var n=ir(e);ur[e]={},"year"===e?n.forEach((function(t){var n;null==t||null===(n=t.children)||void 0===n||n.forEach((function(t){ur[e][t.key]=t.title}))})):n.forEach((function(t){ur[e][t.value]=t.label}))}var r=ur[e];return t.reduce((function(e,t){var n,a;return m()(n=m()(a="".concat(e)).call(a,e?"、":"")).call(n,r[t]||"")}),"")},sr=["prefixClass"];function fr(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function pr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fr(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):fr(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var vr=/^\S+/,mr=function(e){var t;return null==e||null===(t=e.match(vr))||void 0===t?void 0:t[0]},yr=(0,T.ErrorBoundaryWrap)((function(e){var t,n=e.data,r=e.id,a=(0,(0,N.useContext)(D).getKdesignerApi)(),l=a.data,o=a.meta,i=Wn(r),c=i.prefixClass,u=(0,Y.c)(i,sr),d=Ln(n._Type_,"fireKind"),s=Ln(n._Type_,"loopType"),f=pr(pr({},n),n._disp_),p=n.loopType,v=n.triggerTime,y=n.triggerMode,g=n.fireKind,h=n.startTime,E=n.endTime,b=mt(y),C=(0,N.useMemo)((function(){if(b)return dr(p,(null==v?void 0:v.date)||[])}),[b,p,v]);(0,N.useEffect)((function(){var e=n.name,t=o.getControlMeta(n._Type_).Name;e!==t&&"定时触发"!==e||(e=b?"定时触发":t,l.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[r,{name:e}]])))}),[b]);var k=m()(t="".concat(C," ")).call(t,null==v?void 0:v.time),x=mr(h),w=mr(E),M=d(g);return I().createElement(Zn,{id:r},I().createElement("div",u,I().createElement(Qn,(0,_.c)({showMoreBtn:!1,prefix:c},n)),I().createElement("div",{className:"".concat(c,"_content")},b?I().createElement(I().Fragment,null,I().createElement("div",{title:x},I().createElement("span",null,"开始时间："),x),I().createElement("div",{title:w},I().createElement("span",null,"结束时间："),w),I().createElement("div",null,I().createElement("span",null,"循环："),s(p)),I().createElement("div",{title:k},I().createElement("span",null,"触发时间："),k)):I().createElement(I().Fragment,null,I().createElement("div",{title:f.formId},I().createElement("span",null,"触发表单："),f.formId),I().createElement("div",{title:M},I().createElement("span",null,"触发类型："),M))),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:"b"})))}),"StartSignalEvent"),gr=["dragEvent","prefixClass"];function hr(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Er(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hr(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):hr(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var br=function(e){return"$assignment"===e},Cr=function(e,t){var n;return t?br(null==t?void 0:t.assignment)&&null!=t&&t.customVarName?null==t?void 0:t.customVarName:(null==t||null===(n=t._disp_)||void 0===n?void 0:n.assignment)||e:e},Nr=(0,T.ErrorBoundaryWrap)((function(e){var t=e.data,n=e.id,r=(e.selected,Wn(n)),a=r.dragEvent,l=r.prefixClass,o=(0,Y.c)(r,gr),i=Ln(t._Type_,"customVarType"),c=Er(Er({},t),t._disp_||{}),u=(0,N.useMemo)((function(){var e;return null===(e=c.setting)||void 0===e?void 0:e.length}),[c]),d=(0,N.useMemo)((function(){var e,n,r;return u>1?"":br(null===(e=t.setting)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.assignment)?null===(n=t.setting)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.customVarName:null===(r=c.setting)||void 0===r||null===(r=r[0])||void 0===r?void 0:r.assignment}),[u,t,c]);return I().createElement(Zn,{id:n},I().createElement("div",(0,_.c)({},a,o),I().createElement(S._2,{type:"target",position:S.JC.Top,id:n+"t"}),I().createElement(Qn,(0,_.c)({prefix:l},t)),I().createElement("div",{className:"".concat(l,"_content")},u>1?I().createElement("div",null,I().createElement("span",null,"运算："),u,"个"):I().createElement("div",{title:d},I().createElement("span",null,"赋值对象："),d),br(t.assignment)&&I().createElement("div",null,I().createElement("span",null,"对象类型："),i(t.customVarType)),I().createElement("div",{className:"".concat(l,"_content_des"),title:t.documentation||""},t.documentation||"")),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:n+"b"})))}),"flow-math-node"),Ir=["dragEvent","prefixClass"],Tr=function(e,t){var n=(e||{}).sourceData,r=null==n?void 0:g()(n).call(n,(function(e){var n=t.findControl(e.menuId);return n?e.name.replace(/\S+（/,"[".concat(n.name,"（")).replace(/\S+\]/,"[".concat(n.name,"]")):e.name}));return(null==r?void 0:r.join(","))||""},kr=(0,T.ErrorBoundaryWrap)((function(e){var t=e.data,n=e.id,r=Wn(n),a=r.dragEvent,l=r.prefixClass,o=(0,Y.c)(r,Ir),i=(0,N.useContext)(D).getKdesignerApi,c=(0,N.useMemo)((function(){return i()}),[]).data,u=t.documentation,d=void 0===u?"":u,s=(0,N.useMemo)((function(){return Tr(t.participant,c)}),[t]);return I().createElement(Zn,{id:n},I().createElement("div",(0,_.c)({},a,o),I().createElement(S._2,{type:"target",position:S.JC.Top,id:n+"t"}),I().createElement(Qn,(0,_.c)({prefix:l},t)),I().createElement("div",{className:"".concat(l,"_content")},I().createElement("div",{title:s},I().createElement("span",null,"审批人："),s),I().createElement("div",{title:d,className:"".concat(l,"_content_des")},d)),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:n+"b"})))}),"flow-action-node"),xr=["dragEvent","prefixClass"];function _r(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function wr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_r(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):_r(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Mr=(0,T.ErrorBoundaryWrap)((function(e){var t=e.data,n=e.id,r=Wn(n),a=r.dragEvent,l=r.prefixClass,o=(0,Y.c)(r,xr),i=Ln(t._Type_,"notifytype"),c=(0,N.useContext)(D).getKdesignerApi,u=(0,N.useMemo)((function(){return c()}),[]).data,d=(wr(wr({},t),t._disp_||{}),Tr(t.receiver,u));return I().createElement(Zn,{id:n},I().createElement("div",(0,_.c)({},a,o),I().createElement(S._2,{type:"target",position:S.JC.Top,id:n+"t"}),I().createElement(Qn,(0,_.c)({prefix:l},t)),I().createElement("div",{className:"".concat(l,"_content")},I().createElement("div",null,I().createElement("span",null,"消息类型："),i(t.notifytype)),I().createElement("div",{title:d},I().createElement("span",null,"通知对象："),Tr(t.receiver,u)),I().createElement("div",{className:"".concat(l,"_content_des"),title:t.documentation||""},t.documentation||"")),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:n+"b"})))}),"flow-message-node"),Sr=["dragEvent","prefixClass"],Ar=(0,T.ErrorBoundaryWrap)((function(e){var t,n,r=e.data,a=e.id,l=Wn(a),o=l.dragEvent,c=l.prefixClass,u=(0,Y.c)(l,Sr),d=(0,N.useContext)(D).getKdesignerApi,s=(0,N.useMemo)((function(){return d()}),[]).data,f=i()(t=s.getSubControls(r.parentId)).call(t,(function(e){return e._Type_===W})),p=(0,N.useMemo)((function(){return s.findControl(r.parentId)||{}}),[r.parentId]),v=(0,N.useMemo)((function(){return ke(p)}),[p]),m=(0,N.useMemo)((function(){return!v||f.length>2}),[f,v]);return I().createElement(Zn,{id:a},I().createElement("div",(0,_.c)({},v?{}:o,u),I().createElement(S._2,{type:"target",position:S.JC.Top,id:a+"t"}),I().createElement(Qn,(0,_.c)({prefix:c,showMoreBtn:m},r)),I().createElement("div",{className:"".concat(c,"_content")},I().createElement("div",null,I().createElement("span",null,"判断条件："),(null==r||null===(n=i()(r))||void 0===n?void 0:n.length)||0,"项"),I().createElement("div",{className:"".concat(c,"_content_des")},r.documentation||"")),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:a+"b"})))}),"flow-branch-node"),Pr=(0,T.ErrorBoundaryWrap)((function(e){var t,n=e.data,r=e.id,a=(e.selected,(0,N.useContext)(D)),l=a.getPrefixCls,o=a.prefixCls,c=a.getKdesignerApi,u=a.flowStatus,d=(0,N.useMemo)((function(){return c()}),[]),s=d.data,f=d.selection,p=d.dataFactory,v=l&&l(o,"controls-node"),y=at(u),g=(0,N.useCallback)((function(){var e=s.getData(),t=s.getSubControls(r),n=i()(t).call(t,(function(e){return e.isNullNode}))[0],a=p({type:W,parentId:r});s.addControl((0,T.createAddAction)((0,_.c)(a,{rootKey:e.key,childId:n.id,name:"判断分支"}))).then((function(e){if(e[0]){var t=e[0].value;if("NoCodeGateway"===t._Type_){var n=e[1].value;f.setSelect([null==n?void 0:n.id])}else f.setSelect(Array.isArray(t)?[t[0].id]:[t.id])}}))}),[r,n,p,s,f]),h=(0,N.useCallback)((function(){for(var e=s.getSubControls(r)||[],t=[r],n=0;n<e.length;n++){var a=e[n].id;a&&t.push(a)}null==Be||Be(t,d)}),[r,d,s,Be]),E=(0,N.useCallback)((function(){var e=n.leaveMode,t=void 0===e?"parallel":e;t="parallel"===t?"exclusion":"parallel";var a=[],l=s.getSubControls(r),o=0;l.forEach((function(e){e._Type_===W&&(o++,a.push([e.id,{seq:o}]))})),a.push([r,{leaveMode:t}]),s.batchUpdateControlPropertyValues((0,T.createUpdateAction)(a))}),[n,r,T.createUpdateAction,s]),b="exclusion"===(null==n?void 0:n.leaveMode),C=["兼容","唯一"],k=m()(t="切换为".concat(C[Number(!b)],"分支：")).call(t,["满足条件的分支依次执行","从左到右，只执行第一个满足条件"][Number(!b)]);return I().createElement("div",{className:"".concat(v,"-branch-start")},I().createElement(S._2,{type:"target",position:S.JC.Top}),I().createElement("div",{className:"diamond"},I().createElement("p",null)),y?I().createElement("div",{className:"change_readonly"},I().createElement("span",null,C[Number(b)])):I().createElement(I().Fragment,null,I().createElement("div",{className:"change",title:k,onClick:E},I().createElement(x.Icon,{type:"qiehuan",prefix:"nocodeplatformicon"}),I().createElement("span",null,C[Number(b)])),I().createElement("div",{className:"add",title:"添加新的分支",onClick:g},I().createElement(x.Icon,{type:"zengjia-yuan",prefix:"ncicon"})),I().createElement("div",{className:"delete",title:"删除当前分支",onClick:h},I().createElement(x.Icon,{type:"shanchu2",prefix:"nocodeplatformicon"}))),I().createElement(S._2,{type:"source",position:S.JC.Left}),I().createElement(S._2,{type:"source",position:S.JC.Right}))}),"flow-branch-node"),Dr=(0,T.ErrorBoundaryWrap)((function(e){e.data,e.id,e.selected;return I().createElement("div",null,I().createElement(S._2,{type:"target",position:S.JC.Left,id:"111"}),I().createElement(S._2,{type:"target",position:S.JC.Right,id:"222"}),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:"333"}),I().createElement("div",{style:{width:2,height:1,backgroundColor:"#d9d9d9"}}))}),"flow-branch-node"),Or=(0,T.ErrorBoundaryWrap)((function(e){var t,n,r=e.data,a=(e.id,(0,N.useContext)(D)),l=a.getPrefixCls,o=a.prefixCls,i=l&&l(o,"controls-end-node");null===(t=r.size)||void 0===t||t.width,null===(n=r.size)||void 0===n||n.height;return I().createElement("div",{className:i,id:de},I().createElement("span",null,"结束"),I().createElement(S._2,{type:"target",position:S.JC.Top,id:"a"}))}),"flow-end-node");function jr(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Br(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jr(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):jr(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Rr=[B,F,V],Fr=[G],Vr=function(e,t,n){return Ct.some((function(e){return e.test(t)}))&&(t=n(e,t)),!!he.some((function(e){var n;return null===(n=t)||void 0===n?void 0:E()(n).call(n,e)}))},qr=(0,N.memo)((function(e){var t=(0,N.useContext)(D),n=t.getKdesignerApi,r=t.getRefBillVarFormId,a=e.handleChange,l=e.value,o=e.className,i=e.editor,c=(e.locked,e.Name),u=e.propName,d=e.Tips,s=e.field,p=(e.id,e.readonly),v=i.NameHidden,m=i.Required,y=i.Title,g=s.id,h=s._disp_,b=s._Type_,C=n().data.getData(),k=(0,N.useMemo)((function(){return lt(g,C[Lt])}),[g,C]),_=(0,N.useMemo)((function(){var e=C[Lt];if(Array.isArray(e)&&null!=e&&e.length){for(var t=[],n=0,o=e.length;n<o;n++){var i=e[n],c=i[Kt],u=i.id,d=i.formId,s=i.refbillField,f=(i.name,i._disp_,i.parentId,i.apiId),p=i.queryModel;if(E()(k).call(k,u)){var v=d||s;if(Pe(c)&&It(p)){if(Se(b)||Ae(b))continue;v=f}if((Se(b)||Pe(b)||Ae(b))&&c===G)continue;if(E()(Rr).call(Rr,c)&&v||E()(Fr).call(Fr,c)){if(Ae(b)||Se(b))if(Vr(u,v,r)){l===u&&a("");continue}t.push({key:u,title:ct(e[n])})}}}return t}return[]}),[C[Lt],g,k]);return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:v,className:o,name:c,tips:d,required:m,title:y}),I().createElement(We.KDTreeSelect,{value:l,disabled:p,allowClear:!0,onChange:function(e,t){var n;a(e||"",{_disp_:Br(Br({},h),{},(0,f.c)({},u,(null==t||null===(n=t[0])||void 0===n?void 0:n.label)||""))})},treeData:_,treeDefaultExpandAll:!0,showFullLabelTips:!0,suffixIcon:I().createElement(x.Icon,{prefix:"designericon",type:"duixiangxuanze2"})}))}));qr.displayName="NodeBillTypeEditor";var Kr=(0,T.ErrorBoundaryWrap)(qr,"NodeBillTypeEditor"),Ur=function(e){var t=(0,N.useContext)(D),n=t.getKdesignerApi,r=t.getRefBillVarFormId,a=(0,N.useMemo)((function(){return n()}),[]).data,l=e.id,o=e.refNodeId;(0,N.useEffect)((function(){var e=a.findControl(o);if(e){var t=e[Kt],n=e.id,i=e.formId,c=e.refbillField,u=e.apiId,d=e.queryModel,s=i||c;if(Pe(t)&&It(d)&&(s=u),Vr(n,s,r)){var f=[[l,{refNodeId:void 0}]];a.batchUpdateControlPropertyValues((0,T.createUpdateAction)(f))}}}),[])},Hr=["dragEvent","prefixClass"],Wr=(0,T.ErrorBoundaryWrap)((function(e){var t=e.data,n=e.id,r=Wn(n),a=r.dragEvent,l=r.prefixClass,o=(0,Y.c)(r,Hr),i=(0,N.useContext)(D).getKdesignerApi,c=(0,N.useMemo)((function(){return i()}),[]).data,u=(0,N.useMemo)((function(){var e;if(!t.refNodeId)return"";var n=(null==t||null===(e=t._disp_)||void 0===e?void 0:e.refNodeId)||"",r=c.findControl(t.refNodeId);return r?n.replace(/\S+（/,"".concat(r.name,"（")):n}),[t]);Ur(t);var d=Tr(t.inputUser,c);return I().createElement(Zn,{id:n},I().createElement("div",(0,_.c)({},a,o),I().createElement(S._2,{type:"target",position:S.JC.Top,id:n+"t"}),I().createElement(Qn,(0,_.c)({prefix:l},t)),I().createElement("div",{className:"".concat(l,"_content")},I().createElement("div",{title:u},I().createElement("span",null,"录入表单："),u),I().createElement("div",{title:d},I().createElement("span",null,"录入人："),d)),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:n+"b"})))}),"flow-action-node"),Lr=["dragEvent","prefixClass"];function zr(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Jr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zr(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):zr(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Gr=(0,T.ErrorBoundaryWrap)((function(e){var t=e.data,n=e.id,r=e.type,a=Wn(n),l=a.dragEvent,o=a.prefixClass,i=(0,Y.c)(a,Lr),c=Jr(Jr({},t),t._disp_),u=(0,N.useMemo)((function(){return Ke(t.queryModel)?"refbillField":It(t.queryModel)?"apiId":"formId"}),[t.queryModel]);return I().createElement(Zn,{id:n},I().createElement("div",(0,_.c)({},l,i),I().createElement(S._2,{type:"target",position:S.JC.Top,id:n+"t"}),I().createElement(Qn,(0,_.c)({prefix:o},t)),I().createElement("div",{className:"".concat(o,"_content")},I().createElement("div",{title:c[u]},I().createElement("span",null,Pe(r)?"查找":"新增","表单："),c[u]),I().createElement("div",{className:"".concat(o,"_content_des"),title:t.documentation||""},t.documentation||"")),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:n+"b"})))}),"QueryDataAutoTask"),$r=["dragEvent","prefixClass"];function Yr(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yr(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Yr(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Xr=(0,T.ErrorBoundaryWrap)((function(e){var t=e.data,n=e.id,r=Wn(n),a=r.dragEvent,l=r.prefixClass,o=(0,Y.c)(r,$r),i=(0,N.useContext)(D),c=i.getKdesignerApi,u=(i.getRefBillVarFormId,(0,N.useMemo)((function(){return c()}),[]).data),d=(0,N.useMemo)((function(){return Qr(Qr({},t),t._disp_)}),[t]),s=(0,N.useMemo)((function(){if(!t.refNodeId)return"";var e=u.findControl(t.refNodeId);return e?d.refNodeId.replace(/\S+（/,"".concat(e.name,"（")):d.refNodeId}),[d]);return Ur(t),I().createElement(Zn,{id:n},I().createElement("div",(0,_.c)({},a,o),I().createElement(S._2,{type:"target",position:S.JC.Top,id:n+"t"}),I().createElement(Qn,(0,_.c)({prefix:l},t)),I().createElement("div",{className:"".concat(l,"_content")},I().createElement("div",{title:s},I().createElement("span",null,"修改表单："),s),I().createElement("div",{className:"".concat(l,"_content_des"),title:t.documentation||""},t.documentation||"")),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:n+"b"})))}),"UpdateBillAutoTask"),Zr=["dragEvent","prefixClass"];function ea(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ta(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ea(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):ea(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var na=(We.treeUtils||{}).dfs,ra=(0,T.ErrorBoundaryWrap)((function(e){var t=e.data,n=e.id,r=(0,N.useContext)(D),a=r.getPreNodeVariablesById,l=r.getKdesignerApi,o=(0,N.useMemo)((function(){return l()}),[]),i=o.data,c=o.meta,u=Wn(n),d=u.dragEvent,s=u.prefixClass,f=(0,Y.c)(u,Zr),p=ta(ta({},t),t._disp_||{}),v=(0,N.useCallback)((function(){return a(n)}),[n]),m=((0,N.useMemo)((function(){if(Nt(p.url)){var e,t=v();return(null===(e=na(t,(function(e){return e.fieldName===p.url})))||void 0===e?void 0:e.title)||""}return p.url}),[v,p.url]),Ln(t._Type_,"apiMode")(t.apiMode,i)),y=Ln(t._Type_,"authMode")(t.authMode,i),g=(0,N.useMemo)((function(){var e;return(0,ie.isUndefined)(t.apiMode)?null===(e=c.getControlMetaEditor(t._Type_,"apiMode"))||void 0===e?void 0:e.Default:t.apiMode}),[t]),h=(0,N.useMemo)((function(){var e;return(0,ie.isUndefined)(t.authMode)?null===(e=c.getControlMetaEditor(t._Type_,"authMode"))||void 0===e?void 0:e.Default:t.authMode}),[t]),E=(0,N.useMemo)((function(){var e;return(0,ie.isUndefined)(t.method)?null===(e=c.getControlMetaEditor(t._Type_,"method"))||void 0===e?void 0:e.Default:t.method}),[t]);return I().createElement(Zn,{id:n},I().createElement("div",(0,_.c)({},d,f),I().createElement(S._2,{type:"target",position:S.JC.Top,id:n+"t"}),I().createElement(Qn,(0,_.c)({prefix:s},t)),I().createElement("div",{className:"".concat(s,"_content")},I().createElement("div",null,I().createElement("span",null,"API模式："),m),"auth"===g&&I().createElement("div",null,I().createElement("span",null,"认证方式："),y),("request"===g||"oauth2"===h)&&I().createElement("div",null,I().createElement("span",null,"请求方式："),E),I().createElement("div",{className:"".concat(s,"_content_des")},t.documentation||"")),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:n+"b"})))}),"ApiInvokeAutoTask"),aa=(0,N.memo)((function(e){var t=e.id,n=e.sourceX,r=e.sourceY,a=e.targetX,l=e.targetY,o=e.sourcePosition,i=e.targetPosition,c=e.style,u=void 0===c?{}:c,d=e.markerEnd,s=e.data,f=(0,N.useContext)(D).getKdesignerApi,v=(0,N.useMemo)((function(){return f()}),[]),m=v.data,y=v.selection,g=s.parentId,h=Wn(g).dropEvent,E=(0,N.useState)(!1),b=(0,p.c)(E,2),C=b[0],k=b[1],_=m.getRootId(),w=(0,N.useMemo)((function(){return m.findControl(g)}),[m,g]),M=(0,N.useCallback)((function(e){var t=e.value;t[0]&&t[0]===_||k(!1)}),[_]);(0,N.useEffect)((function(){var e=y.addSelectChangeListener(M);return function(){e()}}),[]);var A=(0,N.useCallback)((function(e){e.stopPropagation(),y.setSelect([]);var t=s||{},n=t.parentId,r=t.id;T.eventBus.emit(wn,{parentId:n,childId:r}),k(!0)}),[_,s]),P={sourceX:n,sourceY:r,sourcePosition:o,targetX:a,targetY:l,targetPosition:i},O=(0,S.ym)(P),j=(0,N.useMemo)((function(){return!!w&&!(w._Type_===H&&!w.isNullNode)}),[w]),B=(0,N.useCallback)((function(e){e.persist(),y.setSelect([]),T.eventBus.emit(Mn,{visible:!1})}),[]);return I().createElement(I().Fragment,null,I().createElement("path",{id:t,style:u,className:"react-flow__edge-path",d:O,markerEnd:d}),j?I().createElement("foreignObject",{width:280,height:80,x:n-140,y:r+(l-r)/2-40,className:"add_node_foreignobject",onClick:B},I().createElement("div",h,I().createElement("div",{className:pn()("add_node",{add_node_active:C}),onClick:function(e){return A(e)}},I().createElement(x.Icon,{prefix:"nocodeplatformicon",type:"jia4"})))):null)}));aa.displayName="SequenceFlow";var la,oa=(0,T.ErrorBoundaryWrap)(aa,"SequenceFlow"),ia=(la={},(0,f.c)((0,f.c)((0,f.c)((0,f.c)((0,f.c)((0,f.c)((0,f.c)((0,f.c)((0,f.c)((0,f.c)(la,B,yr),R,Or),H,Pr),W,Ar),J,Dr),F,Gr),V,Gr),q,Xr),K,kr),U,Wr),(0,f.c)((0,f.c)((0,f.c)(la,z,Mr),L,Nr),G,ra)),ca=(0,f.c)({},$,oa);function ua(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function da(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ua(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):ua(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var sa=document.body.offsetWidth/2-140,fa=(0,N.memo)((function(e){var t=(0,N.useContext)(D),n=t.getKdesignerApi,r=t.getPrefixCls,a=t.prefixCls,l=t.setDesignerDataRef,o=t.invokeApi,i=t.flowStatus,c=t.isReadonly,u=t.flowMetaData,d=void 0===u?{}:u,s=t.setVariables,f=n(),v=f.selection,y=f.data,g=(f.meta,f.error),h=(0,N.useState)(!1),E=(0,p.c)(h,2),b=E[0],C=E[1],k=(0,N.useState)([]),x=(0,p.c)(k,2),w=x[0],A=x[1],j=(0,N.useMemo)((function(){var e;return c?{}:(null===(e=d[2])||void 0===e?void 0:e.errors)||{}}),[c]);(0,N.useEffect)((function(){g.replaceError(ot(j))}),[]);var F=(0,N.useRef)(null),V=(0,N.useRef)(null),q=r&&r(a,"rightpanel"),K=(0,N.useRef)({x:0,y:0,zoom:1}),W=(0,N.useRef)(),L=(0,N.useRef)(null),$=(0,N.useRef)([]),Y=(0,N.useRef)(null),Q=(0,N.useCallback)((function(e){var t=new(P().graphlib.Graph);t.setDefaultEdgeLabel((function(){return{}})),t.setGraph({rankdir:"TB",nodesep:96,ranksep:96,edgesep:96,marginx:sa,marginy:40});var n=[],r=[];$.current.forEach((function(e){(0,S.yW)(e)?(e.data.size=function(e){switch(e.type){case B:return{width:280,height:mt(e.data.triggerMode)?180:112};case U:return{width:280,height:112};case R:return{width:80,height:40};case z:return{width:280,height:Vt(e,248,112)};case G:return{width:280,height:Vt(e,248,"oauth2"===e.data.authMode?132:112)};case H:return{width:36,height:36};case J:return{width:2,height:1};default:return{width:280,height:Vt(e,248,84)}}}(e),t.setNode(e.id,da(da({},e.data.size),{},{shape:"rect"}))):(n.push({id:e.id,target:e.target,source:e.source,_Type_:e.type,itemId:e.itemId,number:e.number}),t.setEdge(e.source,e.target))})),P().layout(t);var a=$.current.reduce((function(e,n){if((0,S.yW)(n)){var a=t.node(n.id);n.targetPosition=[S.JC.Top],n.sourcePosition=S.JC.Bottom,n.position={x:a.x-a.width/2,y:a.y-a.height/2},r.push(da(da({},n.data),{},{position:n.position}))}return m()(e).call(e,n)}),[]);l({edges:n,nodes:r}),A(a)}),[l]),X=(0,N.useCallback)((function(e){$.current=Ft(y,i),Q(!0);for(var t=e.actions,n=void 0===t?[]:t,r=function(){var t=n[a],r=t.type;if("DELETE"===r){var l=(0,p.c)(t.value,1)[0],o=e.oldValue.Items,i=M()(o).call(o,(function(e){return e.id===l}));i&&te([i.parentId],!1)}else if("CUSTOMUPDATE"===r){var c=e.oldValue.Items,u=e.value.Items,d=M()(u).call(u,(function(e,t){return e.id!==c[t].id}));d&&te([d.id],!1)}else if("ADD"===r){var s=t.value.id;V.current=s}},a=0;a<n.length;a++)r()}),[Q]),Z=(0,N.useCallback)((function(e){var t=e.value,n=e.oldValue,r=t[0];if(r)(!V.current||V.current&&V.current!==r)&&(V.current=null,te(n,!1)),F.current=y.findControl(r);else{var a=n[0];y.findControl(a)&&(V.current=null,te(n,!1))}}),[]),ee=(0,N.useCallback)((function(e){var t=e.variables,n=void 0===t?{}:t,r=e.errors,a=void 0===r?{}:r;C(!1),a&&g.setError(ot(a)),n&&s((function(e){return da(da({},e),Mt(n))}))}),[]);(0,N.useEffect)((function(){var e,t=y.addDataChangeListener(X),n=v.addSelectChangeListener(Z);return c||(e=T.eventBus.on(se,ee)),function(){t(),n(),c||T.eventBus.off(se,e)}}),[X,Z,c]),(0,N.useEffect)((function(){$.current=Ft(y,i),Q(!0)}),[]),ln(Y);var te=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!c)if((null==e?void 0:e.length)>0){var n=y.findControl(e[0]);if(!t||F.current&&!(0,ie.isEqual)(n,F.current)){var r=y.getAllSubControlIds(e[0]);o.saveSyncData([(null==r?void 0:r.length)>0?r:e,["variables","errors"],[],{}])}}else{var a=v.getSelection();if(1===a.length){var l=y.findControl(a[0]);if(F.current&&l&&!(0,ie.isEqual)(l,F.current)){var i=y.getAllSubControlIds(a[0]);o.saveSyncData([(null==i?void 0:i.length)>0?i:a,["variables","errors"],[],{}])}}}},ne=qt(),re=(0,N.useMemo)((function(){return{sendSyncData:te}}),[te]);return I().createElement(O.Provider,{value:re},I().createElement(S.Mt,null,I().createElement(S.cp,(0,_.c)({id:ue,elements:w,nodeTypes:ia,edgeTypes:ca,onLoad:function(e){W.current=e;var t=y.getData().Items;if(2===t.length){var n=t[0];n.formId||setTimeout((function(){v.setSelect([n.id])}))}var r=M()(w).call(w,(function(e){return e.type===B}));setTimeout((function(){var t;return e.setTransform({x:sa-((null==r||null===(t=r.position)||void 0===t?void 0:t.x)||0),y:40,zoom:1})}),0)},onPaneClick:function(e){e.persist(),v.setSelect([]),T.eventBus.emit(Mn,{visible:!1})},ref:Y,tabIndex:-1,onMove:function(e){K.current=e}},ne),I().createElement(S.O,{showInteractive:!1}),I().createElement(pa,{ref:L}))),I().createElement(jn,{prefixCls:q,isLoading:b}))})),pa=(0,N.forwardRef)((function(e,t){var n=(0,S._s)();return(0,N.useImperativeHandle)(t,(function(){return n})),I().createElement("div",null)}));fa.displayName="MainView",pa.displayName="Operation";var va=fa;function ma(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ya(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ma(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):ma(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var ga={Id:"anonyoumsMockId",Name:"anonyoumsMockName",Key:"anonyoumsMockKey",DefaultGroup:!0},ha=function(e,t){var n,r,a=ya(ya({},n=e),{},{PropertyGroups:m()(r=[ga]).call(r,(0,j.c)(n.PropertyGroups||[]))});return(0,T.adaptorMeta)(a,(0,T.mergeTransformKeyMap)(T.transformKeyMap,(0,f.c)({},Ut,[Wt])),t)},Ea=function(e){var t=e.Hide;return!(!t||"object"!==(0,un.c)(t))&&t.Hide},ba={name:"name",id:"id",key:"key",edges:"edges",parentId:"parentId"},Ca=["type","parentId","childId","name","rootKey"];function Na(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ia(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Na(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Na(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Ta=function(e,t,n){e.globalConfig;var r=e.dataContext,a=(e.selectionContext,e.action),l=(e.dataFactory,e.modelFactory,e.metaReader),o=(a.type,a.value),i=[a];if(Array.isArray(o))return i;var c=o.type,u=o.parentId,d=o.childId,s=o.name,f=o.rootKey,p=(0,Y.c)(o,Ca),v=[],m=r.findControlIndex(u)+1,y=yt({rootKey:f,parentId:u,type:c,name:s}),h=y.id;if(c===H){var b=function(e,t,n){var r=e.name,a=e.rootKey,l=e.childActions,o=[],i=t.id;o.push((0,T.createAddAction)(Ia(Ia({},t),{},{leaveMode:"parallel"}),{index:n}));var c=3,u=[];if((null==l?void 0:l.length)>0){c=l.length+1;for(var d=0;d<l.length;d++){var s=l[d],f=yt(Ia({rootKey:a,type:W,parentId:t.id},s));u.push(f.id),o.push((0,T.createAddAction)(f,{index:n+d}))}}else for(var p=1;p<c;p++){var v=yt({rootKey:a,type:W,parentId:t.id,name:r,seq:p});u.push(v.id),o.push((0,T.createAddAction)(v,{index:n+p}))}var m=yt({parentId:i,name:"nullNode",rootKey:a,type:H,isNullNode:!0,parentIds:u.join(",")});return o.push((0,T.createAddAction)(m,{index:n+c})),o}(o,y,m)||[];h=(b[b.length-1]||{value:{}}).value.id,v.push.apply(v,(0,j.c)(b))}else if(c===W&&E()(u).call(u,H)){var C=r.getSubControls(u),N=[],I=g()(C).call(C,(function(e){return e._Type_===c&&N.push(e),(null==e?void 0:e.seq)||""}));v.push((0,T.createAddAction)(Ia(Ia({},y),{},{seq:Math.max.apply(Math,(0,j.c)(I))+1}),{index:m+N.length}))}else{var k=Ve(l,Ia(Ia(Ia({},p),y),{},{_disp_:{}}));v.push((0,T.createAddAction)(k,{index:m}))}var x=r.findControl(d),_={};if(x.isNullNode){var w,M=E()(w=x.parentIds).call(w,u)?x.parentIds.replace(u,h):[x.parentIds,h].join();_=(0,T.createUpdateAction)([[d,{parentIds:M}]])}else _=(0,T.createUpdateAction)([[d,{parentId:h}]]);return v.push(_),v},ka=["type","value"],xa=function(e,t){var n=[],r=t.parentId,a=t.id,l=e.findControl(r)||{};if(ke(l)){var o=e.getAllSubControlIds(a),c=function(e,t){var n=e.getSubControls(t);return M()(n).call(n,(function(e){return xe(e)}))}(e,r);if(c){var u,d,s=c.id,f=c.parentIds,p=null===(u=i()(d=f.split(",")).call(d,(function(e){return e!==o[o.length-1]})))||void 0===u?void 0:u.join(",");n.push((0,T.createDeleteAction)(oe()(o).call(o,1))),n.push((0,T.createUpdateAction)([[s,{parentIds:p}]]))}}else{var v=e.getSubControls(a);if(v[0]){var m=v[0];n.push((0,T.createUpdateAction)([[m.id,{parentId:r}]]))}}return n},_a=function(e,t,n){e.globalConfig;var r=e.dataContext,a=(e.selectionContext,e.action),l=(e.dataFactory,e.modelFactory,e.metaReader,a.type,a.value),o=((0,Y.c)(a,ka),[]);if(Array.isArray(l)){var i=r.findControl(l[0]),c=(i._Type_,i.parentId),u=i.id;if(ke(i)){var d,s,f=r.getAllSubControls(u),p=[],v=M()(f).call(f,(function(e){e._Type_;var t=e.parentId;return xe(e)&&t===u})),y=null===(d=r.getSubControls(null==v?void 0:v.id))||void 0===d?void 0:d[0];if(!y||xe(y))null===(s=r.getData()[Lt])||void 0===s||s.forEach((function(e){var t=e.id;e.parentId;if(xe(e)&&t!==(null==v?void 0:v.id)){var n=e.parentIds;e.id;if(E()(n).call(n,v.id)){var r=n.split(","),a=[];r.forEach((function(e){e===(null==v?void 0:v.id)?a.push(c):a.push(e)})),p.push((0,T.createUpdateAction)([[t,{parentIds:a.join(",")}]]))}}}));else p.push((0,T.createUpdateAction)([[y.id,{parentId:c}]]));o.push.apply(o,p)}else{var g=r.findControl(c)||{};if(_e(i)&&ke(g)){var h=xa(r,i);o.push.apply(o,(0,j.c)(h))}else l.forEach((function(e){var t=r.findControl(e),n=t._Type_,a=t.parentId;if(!Te(n)){var l,i=[];null===(l=r.getData()[Lt])||void 0===l||l.forEach((function(t){var l=t.id,o=t.parentId;if(xe(t)){var c=t.parentIds;if(E()(c).call(c,e)){var u=c.split(","),d=[];u.forEach((function(t){if(t===e)if(n===W){var l=r.getParentControl(e);ke(l)||d.push(a)}else d.push(a);else d.push(t)})),i.push((0,T.createUpdateAction)([[l,{parentIds:null==d?void 0:d.join(",")}]]))}}else o===e&&i.push((0,T.createUpdateAction)([[l,{parentId:a}]]))})),o.push.apply(o,i)}}))}}return m()(o).call(o,[a])},wa=(0,f.c)((0,f.c)({},T.ActionType.ADD,Ta),T.ActionType.DELETE,_a),Ma=function(e,t){var n=e.action,r=e.dataContext,a=e.selectionContext,l=e.globalConfig,o=e.dataFactory,i=e.modelFactory,c=e.metaReader,u=e.success,d=e.fail,s=(l.dataRef,l.keywordMapping,[]),f=n.type,p=wa[f];if(p){var v=p({globalConfig:l,dataContext:r,selectionContext:a,action:n,dataFactory:o,modelFactory:i,metaReader:c},u(s),d);v&&s.push.apply(s,(0,j.c)(v))}else s.push(n);s.length&&u(s)},Sa=function(e){var t=e.formId,n=e.eventName,r=e.parser,a=e.defaultValue,l=void 0===a?{}:a,o=(0,N.useState)(l),i=(0,p.c)(o,2),c=i[0],u=i[1];return(0,N.useEffect)((function(){var e=T.eventBus.on(n,(function(e){var n;if(null==e||!e.args||(null===(n=e.args)||void 0===n?void 0:n.formId)===t){var a="function"==typeof r?r(e):function(e){var t=e.data,n=e.args;return{data:t.rows,param:n.param}}(e);u(a)}}));return function(){T.eventBus.off(n,e)}}),[n,t,r]),(0,N.useEffect)((function(){t||u(l)}),[t]),c},Aa=We.treeUtils||{},Pa=Aa.dfs,Da=Aa.exludeTreeNodeByCallback,Oa=Aa.getListSortConfig,ja=(0,N.memo)((function(e){var t=e.handleChange,n=e.className,r=e.editor,a=e.Name,l=e.Tips,o=e.field,c=e.readonly,u=e.value,d=void 0===u?[]:u,s=r.NameHidden,f=r.Required,p=r.Title,v=r.Source,m=o[v],y=(0,N.useContext)(D),g=y.compareType,h=y.invokeAction,E=(0,N.useRef)(m),b=Sa({formId:m,eventName:"setListTreeConfig",parser:function(e){var t=e.data;return It(o.queryModel)?Da(Et(t,t,g),(function(e){return e.canOrder})):Et(t,t,g)},defaultValue:[]}),C=(0,N.useMemo)((function(){return Oa(b)}),[b]);return(0,N.useEffect)((function(){m&&h("listtreeconfig",[m])}),[m]),(0,N.useEffect)((function(){E.current!==m&&(E.current=m,t([]))}),[m]),(0,N.useEffect)((function(){if(null!=d&&d.length&&C.length){var e=!1,n=i()(d).call(d,(function(t){var n=Pa(C,(function(e){return e.key===t.number}));return n||(e=!0),n}));e&&t(n)}}),[C]),I().createElement(I().Fragment,null,c?I().createElement("div",{className:pn()("".concat(n,"-display-viewitem"),"".concat(n,"-display-orderby"))},I().createElement("span",{className:"title",title:p},a)):I().createElement(T.NameTipWrapper,{nameHidden:s,className:n,name:a,tips:l,required:f,title:p}),!c||null!=d&&d.length?I().createElement(We.OrderByEditor,{id:"filter",nameHidden:!0,readonly:c,style:{marginTop:"0px"},name:a,tips:l,required:f,treeData:C||[],value:d||[],onChange:t}):"-")}));ja.displayName="OrderByEditor";var Ba=(0,T.ErrorBoundaryWrap)(ja,"OrderByEditor"),Ra=n(72400),Fa=n.n(Ra),Va=n(35680),qa=n.n(Va);function Ka(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ua(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ka(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Ka(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Ha=I().memo((function(e){var t=e.field,n=e.id,r=e.propName,a=e.actionType,l=(e.modalTitle,e.locked),o=e.Name,i=e.handleChange,c=e.value,u=e.editor,d=e.Tips,s=e.className,v=e.readonly,y=e.hiddenTitle,g=u.NameHidden,h=u.Required,E=u.HideFunc,b=u.HasCheck,C=u.Placeholder,k=u.Title,_=(0,N.useContext)(D),w=_.getPreNodeVariablesById,M=_.expressionData,S=t._Type_,A=t.name,P=(0,N.useState)(!1),O=(0,p.c)(P,2),j=O[0],B=O[1],R=(0,N.useMemo)((function(){return b?function(e){return e?"string"==typeof e?JSON.parse(e):e:{content:"",check:!1}}(c):c}),[c]),F=b?R.content:R,V=(0,N.useRef)(""),q=(0,N.useMemo)((function(){var e=F||"",t=e.split("@@");return t.length>1?t:["",e,1]}),[F]),U=(0,p.c)(q,3),H=U[1],W=U[2],L=(0,N.useMemo)((function(){return w(n)}),[n,w]),z=(0,N.useMemo)((function(){return(null==M?void 0:M.expression).functionTypes}),[null==M?void 0:M.expression]),J=(0,N.useMemo)((function(){var e=(null==M?void 0:M.expression).functionOperations;return Fa()(e)}),[null==M?void 0:M.expression]),G=function(e){i(Ua(Ua({},c),e))},$=(0,N.useCallback)((function(e,t){if(B(!1),!e)return b?G({content:""}):i("");var n=st(e,t);b?G({content:n}):i(n)}),[i,c,b,st]),Y=(0,N.useCallback)((function(e){e.preventDefault(),l||v||B(!0)}),[B,l,v]);(0,N.useEffect)((function(){if(V.current!==A&&S===K&&null!=c&&c.check){var e,t=null==c||null===(e=c.content)||void 0===e?void 0:qa()(e).call(e,"【 ".concat(V.current," 】"),"【 ".concat(A," 】"));i(Ua(Ua({},c),{},{content:t||""})),V.current=A}}),[A,i,c,S]),(0,N.useEffect)((function(){var e,t,n,a,l,o;if(S===K&&null!=c&&c.check&&(null==c||!c.content)){var i="${proc.procName}",u=dt(i,{title:"[文本]流程名称"});switch(r){case"notifyInitiatorPassMsg":G({check:!0,content:m()(e=m()(t=m()(n="您申请的【 ".concat(i," 】在【 ")).call(n,A," 】节点审核通过@@您申请的【 ")).call(t,u," 】在【 ")).call(e,A," 】节点审核通过@@1")});break;case"notifyInitiatorRejectMsg":G({check:!0,content:m()(a=m()(l=m()(o="您申请的【 ".concat(i," 】在【 ")).call(o,A," 】节点审核否决@@您申请的【 ")).call(l,u," 】在【 ")).call(a,A," 】节点审核否决@@1")})}}}),[null==c?void 0:c.check,null==c?void 0:c.content,S,G]);var Q=!v&&h,X=pn()("".concat(s,"-condition"),(0,f.c)({},"".concat(s,"-nohover"),v));return I().createElement(I().Fragment,null,!y&&I().createElement("div",{className:pn()("".concat(s,"-condition-title"),(0,f.c)({},"".concat(s,"-readonly"),v))},I().createElement(T.NameTipWrapper,{name:o,className:s,nameHidden:g,tips:d,required:Q,title:k}),b&&I().createElement(x.Switch,{checked:null==R?void 0:R.check,disabled:v,onChange:function(e){if(b){var t={check:e};if(S===K&&e&&(null==c||!c.content)){var n,r="${proc.procName}",a=dt(r,{title:"[文本]流程名称"});t.content=m()(n="您有一个【 ".concat(r," 】待审批，请尽快处理@@您有一个【 ")).call(n,a," 】待审批，请尽快处理@@1")}G(t)}}})),(!b||(null==R?void 0:R.check))&&I().createElement(I().Fragment,null,I().createElement("div",{className:X,onMouseDown:Y},I().createElement("div",{className:"code-box"},I().createElement(We.EditArea,{value:H,placeholder:C,expressionData:z,operations:J,language:W,fieldData:L,readOnly:"nocursor"})),I().createElement("div",{className:"fx"},"FX")),I().createElement(We.Condition,{value:H,language:W,editorPlaceholder:C,hideFunc:E,fieldData:L,defaultExpandAll:!1,expressionData:z,operations:J,actionType:a,modalTitle:o,editorTitle:Cr(o,t),visible:j,onClose:function(){return B(!1)},onConfirm:$})))}));Ha.displayName="ConditionEditor";var Wa=(0,T.ErrorBoundaryWrap)(Ha,"ConditionEditor"),La=n(68456),za=n.n(La);function Ja(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ga(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ja(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Ja(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var $a=(0,N.memo)((function(e){var t=e.options,n=e.onClick,r=(0,N.useContext)(D).prefixCls,a="".concat(r,"-right-view-customcontent"),l=(0,N.useMemo)((function(){return(null==t?void 0:g()(t).call(t,(function(e){return Ga(Ga({icon:"duixiangxuanze"},e),{},{title:e.Title,key:e.Id,type:e.Type})})))||[]}),[t]);return(null==l?void 0:l.length)>0&&I().createElement(I().Fragment,null,I().createElement("div",{className:a},g()(l).call(l,(function(e,t){return I().createElement("div",{key:e.key||t,className:"".concat(a,"-item"),onClick:function(){null==n||n(e)}},I().createElement(x.Icon,{className:"".concat(a,"-item-icon"),prefix:"designericon",type:e.icon||"duixiangxuanze"}),I().createElement("span",null,e.title))}))))}));$a.displayName="CustomSelectContent";var Ya=$a,Qa=We.treeUtils.dfs,Xa=(0,N.memo)((function(e){var t=e.data,n=e.className,r=e.value,a=e.defaultExpandAll,l=e.readonly,o=e.onClear,i=e.setPropsData,c=e.customSelectOptions,u=(0,N.useState)(!1),d=(0,p.c)(u,2),s=d[0],f=d[1],v="".concat(n,"-var-select-wrap"),y=(0,N.useMemo)((function(){var e=null==c?void 0:M()(c).call(c,(function(e){return e.Id===r}));return(null==e?void 0:e.Title)||r}),[r,c]),g=(0,N.useCallback)((function(e){if(e){var t=e.type,n=e.key,r=e.title;"custom"===t&&i({value:n,label:r}),f(!1)}}),[i]);if(l){var h,E=null==c?void 0:M()(c).call(c,(function(e){return e.Id===r}));if(E)return null==E?void 0:E.Title;var b=Qa(t,(function(e){return e.key===y}))||{},C=b.title,T=void 0===C?"":C,k=b.titlePrefix,_=void 0===k?"":k;return m()(h="".concat(_)).call(h,T)}return I().createElement(We.KDTreeSelect,{visible:s,value:y,allowClear:!0,onChange:function(e,t){if(!e)return null==o?void 0:o();var n=(null==t?void 0:t[0])||{};i({value:e,label:(null==n?void 0:n.label)||(null==n?void 0:n.title)||""})},onVisibleChange:function(e){e!==s&&f(e)},treeData:t,treeDefaultExpandAll:a,showFullLabelTips:!0,dropdownRender:function(e){return I().createElement(I().Fragment,null,I().createElement(Ya,{prefixCls:v,options:c,onClick:g}),e)},suffixIcon:I().createElement(x.Icon,{prefix:"designericon",type:"duixiangxuanze2"})})}));Xa.displayName="VarSelectWrap";var Za=Xa,el=n(13440),tl=n.n(el),nl=n(59992),rl=n.n(nl),al=n(60600),ll=n.n(al);function ol(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function il(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ol(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):ol(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}function cl(e,t){var n=void 0!==rl()&&ll()(e)||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return ul(e,t);var r=oe()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return tl()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ul(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,l=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw l}}}}function ul(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var dl=function(e,t){var n,r=e||{},a=r.type,l=r.option,o=r.parentKey,i=E()(n=["refbill","user","org"]).call(n,a),c=i&&!(null!=l&&l.isMulti),u=i&&(null==l?void 0:l.isMulti)&&o===t;return("pk"===a||c||u)&&!(null!=l&&l.expendOnlyInExp)},sl=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return null==t?void 0:t.reduce((function(t,l){var o,i,c=l.type,u=l.option,d=l.children,s=l.key;if(Ee[null==u?void 0:u.editorType]&&(l.type=Ee[null==u?void 0:u.editorType]),(!n||(null==n?void 0:n(l)))&&null!=u&&null!==(o=u.children)&&void 0!==o&&o.length){var f;if(l.children=g()(f=u.children).call(f,(function(e){var t,n=Ee[null==e||null===(t=e.option)||void 0===t?void 0:t.editorType]||e.type;return il(il({},e),{},{key:e.value,parentKey:s,type:n})})),r||null!=u&&u.cannotSelect){var p=null==r?void 0:r(l),v="boolean"==typeof p?p:!(null!=u&&u.cannotSelect);l.selectable=v}"pk"===c&&a&&e(l.children,n,r,!1)}else null!=d&&d.length&&e(d,n,r,a);return m()(i=[]).call(i,(0,j.c)(t),[l])}),[])},fl=function(e,t){var n,r=[],a=0,l=t.length;function o(e,n){var i;if(E()(t).call(t,e.key)&&(a++,r.push.apply(r,(0,j.c)(n))),null!==(i=e.children)&&void 0!==i&&i.length){var c,u=cl(e.children);try{for(u.s();!(c=u.n()).done;){var d,s,f=c.value;if(a>=l)return(0,j.c)(new(X())(m()(s=[]).call(s,r)));o(f,m()(d=[]).call(d,(0,j.c)(n),[e.key]))}}catch(e){u.e(e)}finally{u.f()}}}var i,c=cl(e);try{for(c.s();!(i=c.n()).done;){var u,d=i.value;if(a>=l)return(0,j.c)(new(X())(m()(u=[]).call(u,r)));o(d,[])}}catch(e){c.e(e)}finally{c.f()}return(0,j.c)(new(X())(m()(n=[]).call(n,r)))},pl=function e(t,n){return t?t.reduce((function(t,r){var a=r.children,l=r.option,o=il({},r);return l?o.option.children=e(o.option.children,n):a&&(o.children=e(o.children,n)),n?null!=n&&n(o)?m()(t).call(t,o):t:m()(t).call(t,o)}),[]):t};function vl(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ml(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vl(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):vl(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var yl=We.ListFilterUtil.getFlowTypeByParam,gl=We.ListFilterUtil.SystemFields,hl=function(e){var t;return null===We.treeUtils||void 0===We.treeUtils||null===(t=We.treeUtils.exludeTreeNodeByCallback)||void 0===t?void 0:t.call(We.treeUtils,e,(function(e){var t=null==gl?void 0:M()(gl).call(gl,(function(t){var n;return null===(n=e.key)||void 0===n?void 0:E()(n).call(n,t)})),n=yl(e);return!t&&(!n||e.children)}))},El=(0,N.memo)((function(e){var t=(0,N.useContext)(D),n=t.getKdesignerApi,r=t.getPreNodeVariablesById,a=(0,N.useMemo)((function(){return n()}),[]).data,l=(e.handleChange,e.value),o=e.className,c=e.editor,u=e.Name,d=e.Tips,s=e.field,p=e.propName,v=(e.error,e.variablesTree),m=e.readonly,y=e.onPropertyChange,g=e.assignments,h=(c.Enum,c.NameHidden),b=c.Required,C=c.VarType,k=c.Source,x=c.Custom,_=void 0===x?[]:x,w=c.Title,M=s.id,S=s._disp_,A=s._Type_,P=s.refNodeId,O=s.loopby,j=function e(t,n){var r=(0,ie.cloneDeep)(t);return null==r||r.forEach((function(t){var n=t.children;return n&&(t.children=e(i()(n).call(n,(function(e){return(null==e?void 0:e.value)===l||!(null!=g&&E()(g).call(g,null==e?void 0:e.value))})),!1)),t})),null==r?void 0:i()(r).call(r,(function(e){var t,r,a,l,o,i;return(n&&(null===(t=e.children)||void 0===t?void 0:t.length)>0||!n)&&!(null!=e&&ae()(r=e.key).call(r,"${proc.")&&(null!=e&&null!==(a=e.value)&&void 0!==a&&za()(a).call(a,"ExecuteResult.QueryResult}")||null!=e&&null!==(l=e.value)&&void 0!==l&&za()(l).call(l,"AuditNumber}")||null!=e&&null!==(o=e.value)&&void 0!==o&&za()(o).call(o,"NodeName}")||null!=e&&null!==(i=e.key)&&void 0!==i&&za()(i).call(i,".procName}")))}))},B=(0,N.useMemo)((function(){var e=null!=v&&v.length?v:r(M,C)||[],t=P||O;if(Se(A)||Me(A)){var n=sl(e,(function(e){var n,r,a=e.parentKey===t&&(null==e||null===(n=e.option)||void 0===n?void 0:n.isMulti);return("pk"===e.type||a)&&!(null!=e&&null!==(r=e.option)&&void 0!==r&&r.expendOnlyInExp)}),(function(){return!1}));return hl(n)}if(we(A)){var a=i()(e).call(e,(function(e){var t=e._Type_,n=e.queryModel;return!(Pe(t)&&It(n)||De(t))})),l=sl(a,(function(e){var t;return"pk"===e.type&&!(null!=e&&null!==(t=e.option)&&void 0!==t&&t.expendOnlyInExp)}),(function(e){return!(null==yl?void 0:yl(e))}));return hl(l)}return k&&!v&&(e=i()(e).call(e,(function(e){return e[k]===k}))),!v&&Pe(A)&&Ke(s.queryModel)?i()(e).call(e,(function(e){var t=e._Type_;return Pe(t)?!("byapi"===e.queryModel):!De(t)})):e}),[v,r,M,k,A,P,O]),R=function(e){var t=e.value,n=e.label;(null==y?void 0:y(s,p,{value:t,label:n},c,[]))||!1||a.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[M,(0,f.c)((0,f.c)({},p,t),"_disp_",ml(ml({},S),{},(0,f.c)({},p,n)))]]))},F=(0,N.useMemo)((function(){return j(B,!0)}),[B]);return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:h,className:o,name:u,tips:d,required:b,title:w}),I().createElement(Za,{defaultExpandAll:!1,className:o,data:F,customSelectOptions:_,setPropsData:R,onClear:function(){R({value:"",label:""})},value:l,readonly:m}))}));El.displayName="VarSelectEditor";var bl=(0,T.ErrorBoundaryWrap)(El,"VarSelectEditor"),Cl=function(e){var t=e.fieldKey,n=(0,N.useContext)(D),r=n.batchInvoke,a=n.getControlText;return{baseUrl:n.baseUrl,batchInvoke:function(e,n){r(e,t,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[])},getControlText:a,addControlAction:function(e,t){return T.eventBus.on(e,t),function(){T.eventBus.off(e,t)}},batchInvokeListConfig:function(e){r("listconfig","nocodewfdesigner",[e])},batchInvokeQuery:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i()(t),a=void 0===n?"":n,l=t.search,o=void 0===l?"":l,c=t.order_by,u=void 0===c?"":c,d=t.select,s=void 0===d?"":d,f=t.page_size,p=void 0===f?10:f,v=t.page_no,m=void 0===v?1:v,y=t.ids,g={filter:a,search:o,order_by:u,page_size:p,page_no:m,ids:void 0===y?[]:y};s&&(g.select=s),r("query","nocodewfdesigner",[e,g])}}};function Nl(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Il(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nl(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Nl(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Tl=We.treeUtils||{},kl=Tl.dfs,xl=Tl.exludeTreeNodeByCallback,_l=Tl.getListConfigPure,wl=(0,N.memo)((function(e){var t=e.handleChange,n=e.className,r=e.editor,a=e.Name,l=e.Tips,o=e.field,c=e.readonly,u=e.value,d=void 0===u?[]:u,s=r.NameHidden,v=r.Required,m=r.Title,y=r.Source,h=r.ShowVar,b=void 0===h||h,C=o[y],k=o.id,x=o.key,_=(0,N.useContext)(D),w=_.invokeAction,S=_.getPreNodeVariablesById,A=_.compareType,P=(0,N.useState)(),O=(0,p.c)(P,2),j=O[0],B=O[1],R=(0,N.useState)(d),F=(0,p.c)(R,2),V=F[0],q=F[1],K=(0,N.useRef)(C),U=(0,N.useRef)(null),H=Cl({fieldKey:x});(0,N.useEffect)((function(){q((function(e){return(0,ie.isEqual)(e,d)?e:d}))}),[d,q]);var W=(0,N.useMemo)((function(){return sl(S(k),(function(e){return dl(e,"")}))}),[S,k]),L=Sa({formId:C,eventName:"setListTreeConfig",parser:function(e){var t=e.data,n=Et(t,t,A);return _l(n)},defaultValue:[]}),z=(0,N.useMemo)((function(){return It(o.queryModel)?xl(L,(function(e){return!e.onlyOrder})):L}),[L,o.queryModel]);(0,N.useEffect)((function(){C&&w("listtreeconfig",[C])}),[C]);var J=(0,N.useMemo)((function(){return Array.isArray(V)?g()(V).call(V,(function(e){if(kl(L,(function(t){return t.key===e.fieldName}))){var t,n=e.compareType;return E()(t=Fa()(Ee)).call(t,o.type)&&be[e.compareType]&&(n=be[e.compareType]),Il(Il({},e),{},{compareType:n,value:"string"==typeof e.value?JSON.parse(e.value):e.value||[]})}return Il(Il({},e),{},{compareType:void 0,fieldName:void 0,value:[]})})):[]}),[V,L]);(0,N.useEffect)((function(){K.current!==C&&(K.current=C,t([]))}),[C]);var G=(0,N.useCallback)((function(e){var t=e.args,n=e.data;if((null==t?void 0:t.formId)===C){var r=((null==t?void 0:t.param)||{}).enumField,a=i()(J).call(J,(function(e){return e.fieldName===r})),l=M()(L).call(L,(function(e){return e.key===r}));B((function(e){return Il(Il({},e),{},(0,f.c)({},r,{configuredFilter:{enumEqCompareType:"001",items:a},fieldFilterConfig:l,groupInfo:n.rows}))}))}}),[C,J,L]);(0,N.useEffect)((function(){return T.eventBus.on(fe,G),function(){T.eventBus.off(fe,G)}}),[G]);var $=(0,N.useCallback)((function(e){w("getFilterItemLook",[e,{getEnumData:"true",enumField:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",filterrows:[]}])}),[w]),Y=(0,N.useCallback)((function(e){$(C,e.fieldName)}),[C,$]),Q=(0,N.useCallback)((function(e){var t=e.value;if(null!=t&&t.length){var n,r=i()(n=g()(t).call(t,(function(e){return e.fieldValue}))).call(n,Boolean);return{expandKeys:fl(W,r)}}return{}}),[W]);return I().createElement("div",{className:"".concat(n,"-filter")},c?I().createElement("div",{className:pn()("".concat(n,"-display-viewitem"),"custom-title")},I().createElement("span",{className:"title",title:m},a)):I().createElement(T.NameTipWrapper,{nameHidden:s,className:n,name:a,tips:l,required:v,title:m}),!c||null!=d&&d.length?I().createElement(We.FilterEditor,{id:"filter",nameHidden:!0,name:a,tips:l,required:v,readonly:c,variablesTree:W||[],listFilterConfig:L||[],onGetFieldRecords:Y,fieldRecords:j||[],style:{marginTop:"0px"},value:J,refBillProps:H,onChange:function(e){var n,r=e;Array.isArray(e)&&(r=g()(e).call(e,(function(e){return Il(Il({},e),{},{value:"object"===(0,un.c)(e.value)?Qt()(e.value):e.value||""})}))),q(r),(n=r)!==d&&(U.current&&clearTimeout(U.current),U.current=setTimeout((function(){U.current=null,t(n)}),300))},fieldData:{fieldType:"treeSelect"},compareTypeData:{style:b?{}:{marginRight:12},disabled:It(o.queryModel)},valueData:{className:"".concat(n,"-filter_value")},filterFooterData:{listType:"tree",listData:z,triggerText:"添加筛选条件",treeProps:{defaultExpandAll:!1}},showVarSelect:b,getVarSelectProps:Q}):"-")}));wl.displayName="FilterEditor";var Ml=(0,T.ErrorBoundaryWrap)(wl,"FilterEditor");var Sl=(0,N.memo)((function(e){var t=e.title,n=(0,N.useContext)(D).prefixCls;return I().createElement("span",{className:"".concat(n,"-tree-title"),title:t},t)}));Sl.displayName="TreeNodeTitle";var Al=Sl;function Pl(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pl(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Pl(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Ol={assignment:{value:"$assignment",hideproperty:["customVarName","customVarType","decimalDataType","maxLength","scale"]},customVarType:{value:"number",hideproperty:["decimalDataType","maxLength","scale"]}},jl=(0,N.memo)((function(e){var t=e.onClick;return I().createElement(We.BtnField,{type:"text",size:"small",icon:{prefix:"designericon",type:"shanchu"},onClick:t},"删除")}));jl.displayName="ExtraComponent";var Bl=(0,N.memo)((function(e){var t=e.value;if(t)return I().createElement("div",{className:"assist"},I().createElement("span",null,"赋值对象："),I().createElement("span",{className:"assist_value",title:t},t))}));Bl.displayName="AssistComponent";var Rl=(0,N.memo)((function(e){var t,n=(0,N.useContext)(D),r=n.getKdesignerApi,a=n.getPreNodeVariablesById,l=n.isReadonly,o=n.getRefBillVarFormId,c=(0,N.useMemo)((function(){return r()}),[]),u=c.data,d=c.meta,s=e.handleChange,v=e.value,y=e.className,h=e.editor,b=(e.Name,e.Tips,e.field),k=e.propName,w=e.error,M=e.readonly,S=h.ChildProperty,A=h.Source,P=b.id,O=b._disp_,B=(b.refNodeId,(0,N.useMemo)((function(){return b[A]}),[b,A])),R=(0,N.useRef)(B),F=(0,N.useState)(g()(t=v||[]).call(t,(function(e){return e.calcId}))),V=(0,p.c)(F,2),q=V[0],K=V[1],U=(0,N.useState)([]),H=(0,p.c)(U,2),W=H[0],L=H[1],z=(0,N.useCallback)((function(e){K(e)}),[]),J=((0,N.useCallback)((function(e){var t=e.title;return I().createElement(Al,{title:t})}),[y]),(0,N.useMemo)((function(){var e=a(P)||[];return A&&(e=i()(e).call(e,(function(e){return e.id===B}))),e=i()(e).call(e,(function(e){var t=e._Type_,n=e.formId;if(Pe(t)){if("byfilter"===e.queryModel)n=e.formId;else{var r=d.getControlMetaEditor(t,"refbillField");n=o(e.id,e.refbillField,null==r?void 0:r.VarType)}return!E()(he).call(he,n)}return!0}))}),[a,P,A,B])),G=(0,N.useMemo)((function(){return S?Fe(S):{}}),[S]),$=(0,N.useMemo)((function(){var e=[];return null==v||v.forEach((function(t){e.push(t.assignment)})),L(e),v||[]}),[v]);(0,N.useEffect)((function(){if(R.current!==B){var e=Re(G),t=[e];K([e.calcId]),u.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[P,(0,f.c)((0,f.c)({},k,t),"_disp_",Dl(Dl({},O),{},(0,f.c)({},k,[])))]])),R.current=B}}),[B,P,k,O,S,G]);var Y=(0,N.useCallback)((function(e,t,n){if($[e]){var r=(0,ie.cloneDeep)($),a=Dl(Dl({},r[e]),{},(0,f.c)({},t,n));return r[e]=a,r}return{}}),[$]),Q=(0,N.useCallback)((function(e,t,n){var r=Y(e,t,n);s(r)}),[Y,$]),X=(0,N.useCallback)((function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n||[],l=(0,p.c)(a,3),o=l[1],i=l[2];if("assignment"===o&&"object"===(0,un.c)(i)){var c,d=i.label,s=i.value,v=[];if(O[k])(v=(0,ie.cloneDeep)(O[k]))[e]?v[e][o]=d:v=[(0,f.c)({},o,d)];else(v=tr()(c=new Array(e)).call(c,{}))[e]=(0,f.c)({},o,d);var m=Dl(Dl({},O),{},(0,f.c)({},k,v));u.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[P,(0,f.c)((0,f.c)({},k,Y(e,o,s)),"_disp_",m)]]))}else Q(e,o,i);return!0}),[Q,Y,k,O,P,$]),Z=(0,N.useCallback)((function(e){var t=(0,ie.cloneDeep)($),n=(0,ie.cloneDeep)(O[k]||[]);ee()(t).call(t,e,1),n.length>0&&ee()(n).call(n,e,1),u.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[P,(0,f.c)((0,f.c)({},k,t),"_disp_",Dl(Dl({},O),{},(0,f.c)({},k,n)))]]))}),[$]),te=(0,N.useCallback)((function(){var e,t,n,r,a=Re(G),l=(0,ie.cloneDeep)(O[k]||[{}]);K(m()(e=[]).call(e,(0,j.c)(q||[]),[a.calcId])),s(m()(t=[]).call(t,(0,j.c)($),[a])),u.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[P,(0,f.c)((0,f.c)({},k,m()(n=[]).call(n,(0,j.c)($),[a])),"_disp_",Dl(Dl({},O),{},(0,f.c)({},k,m()(r=[]).call(r,(0,j.c)(l),[{}]))))]]))}),[q,$]),ne=(0,N.useCallback)((function(e,t){return C()(Ol).some((function(n){var r,a;if(e[n]!==(null===(r=Ol[n])||void 0===r?void 0:r.value)&&(null!==(a=Ol[n])&&void 0!==a&&null!==(a=a.hideproperty)&&void 0!==a&&E()(a).call(a,t)))return!0;return!1}))}),[]);return I().createElement("div",{className:"".concat(y,"-calcsetting")},I().createElement(x.Collapse,{activeKey:q,onChange:z},g()($).call($,(function(e,t){var n,r,a=null==w||null===(n=w.msg)||void 0===n?void 0:n[e.calcId],o={};return a&&a.forEach((function(e){o[e.prop]=e.msg})),I().createElement(x.Collapse.Panel,{key:e.calcId,header:"运算".concat(t+1),panelKey:e.calcId,extra:$.length>1&&!l&&I().createElement(jl,{onClick:function(){return Z(t)}}),assist:I().createElement(Bl,{value:br(e.assignment)?e.customVarName:(null===(r=O[k])||void 0===r||null===(r=r[t])||void 0===r?void 0:r.assignment)||""})},I().createElement("div",{className:"".concat(y,"-calcsetting-panel")},g()(S).call(S,(function(n){var r,a=n.Config,i=n.Number,c=(n.Actions,Dl({},e));delete c._Type_;var u=(0,_.c)({id:P,_disp_:O},c);if(ne(u,i))return null;if(l){var d,s=(null==n||null===(d=n.Config)||void 0===d?void 0:d.Editor)||{},f=Dl(Dl({},n),{},{Editor:s,Id:n.Number});if(!E()(yn).call(yn,null==s?void 0:s.Type)||void 0===u[f.Id])return I().createElement(sn,{className:"kdesigner-right-view",displayData:u,propertyData:f})}return I().createElement("div",{className:"".concat(y,"-calcsetting-panel-item"),key:i},I().createElement(T.PropertyViewItem,(0,_.c)({},a,n,{Id:i,field:Dl(Dl({},b),u),value:u[i],className:"kdesigner-right-view",enableMutiSelect:!1,variablesTree:J,readonly:M,displayLabel:null===(r=O[k])||void 0===r||null===(r=r[t])||void 0===r?void 0:r[i],assignments:W,onPropertyChange:function(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return X.apply(void 0,m()(e=[t]).call(e,r))},renderCustomError:function(e,t){return!0}})),o[i]&&I().createElement("span",{className:"".concat(y,"-error-msg")},o[i]))}))))}))),!M&&I().createElement(We.BtnField,{major:!0,size:"small",icon:{prefix:"designericon",type:"zengjia-yuan2"},onClick:te},"新增一条"))}));Rl.displayName="CalcSettingEditor";var Fl=(0,T.ErrorBoundaryWrap)(Rl,"CalcSettingEditor");function Vl(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ql(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vl(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Vl(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Kl="formula",Ul=We.treeUtils.dfs,Hl=function e(t,n){var r=n;Array.isArray(n)||(r=[n]);for(var a=0;a<r.length;a++){var l=r[a];if(!l)return null;if(l.key===t)return l;var o=e(t,l.children);if(o)return o}return null},Wl=["refbill","user","org"],Ll=(0,N.memo)((function(e){var t=e.placeholder,n=e.fieldKey,r=e.value,a=e.displayLabel,l=e.readonly,o=e.fieldType,c=e.inputProps,u=e.className,d=e.variablesTree,s=void 0===d?[]:d,f=e.actionType,v=e.fieldTree,y=void 0===v?[]:v,h=e.fieldProps,b=void 0===h?{}:h,C=e.varSelectProps,k=void 0===C?{}:C,x=e.expressionTitle,w=e.hideFunc,S=(e.onInputBlur,e.onInputFocus,e.onInputKeyDown,e.onInputClick),A=e.onVarSelectClear,P=e.onVarSelectChange,O=e.onExpressionConfirm,j=e.onInputClear,B=e.onInputChange,R=(0,N.useContext)(D),F=R.baseUrl,V=R.expressionData,q=R.getBaseHooks,K=R.batchInvoke,U=R.getControlText,H=R.prefixCls,W=q("useKDRefBill"),L=(0,N.useState)(!1),z=(0,p.c)(L,2),J=z[0],G=z[1],$=null==r?void 0:E()(r).call(r,"@@"),Y=Ct.some((function(e){return e.test(r)}))&&!$,Q=kt(o)?"refbill":o,X=Y?"selectInput":$?"formula":Q,Z=(0,N.useMemo)((function(){if(Y){var e=function(e,t){if(!e||!t)return"";for(var n="",r="",a=0,l=e.length;a<l;a++){var o=e[a],i=o.title,c=o.children;if(o.key===t){r=i;break}if(null!=c&&c.length){n=i;for(var u=0,d=c.length;u<d;u++){var s=c[u];if(s.key===t){r=s.title;break}}}}return n||r?dt(t,{parentId:n,title:r}):""}(s,r);return["",e,1]}if(Array.isArray(r))return r;var t=r||"",n=t.split("@@");return n.length>1?n:["",t,1]}),[r,s,Y]),ee=(0,p.c)(Z,3),te=ee[1],ne=ee[2],re=(0,N.useState)(Y),ae=(0,p.c)(re,2),le=ae[0],oe=ae[1],ie=(0,N.useState)(r),ce=(0,p.c)(ie,2),ue=ce[0],de=ce[1],se=(0,N.useState)(!1),fe=(0,p.c)(se,2),pe=fe[0],ve=fe[1],me=(0,N.useRef)(null),ye=(0,N.useState)(null),ge=(0,p.c)(ye,2),he=ge[0],Ee=ge[1];(0,N.useEffect)((function(){oe(Y)}),[Y]),(0,N.useEffect)((function(){pe||r===ue||de(r)}),[r,pe]);var be=function(e){e!==r&&(me.current&&clearTimeout(me.current),me.current=setTimeout((function(){me.current=null,B(e)}),300))},Ce=function(e){B(e),setTimeout((function(){ve(!1)}),300)},Ne=(0,N.useCallback)((function(e,t){return T.eventBus.on(e,t),function(){T.eventBus.off(e,t)}}),[]),Ie=b.billEntityId,Te=function(e,t){if(e){var n=i()(t),r=void 0===n?"":n,a=t.search,l=void 0===a?"":a,o=t.order_by,c=void 0===o?"":o,u=t.select,d=void 0===u?"":u,s=t.page_size,f=void 0===s?10:s,p=t.page_no,v=void 0===p?1:p,m=t.ids,y={filter:r,search:l,order_by:c,page_size:f,page_no:v,ids:void 0===m?[]:m};d&&(y.select=d),Ee(y),K("query","nocodewfdesigner",[e,y])}};(0,N.useEffect)((function(){kt(X)&&Te(Ie,{page_size:10,page_no:1,search:"",select:b.displayProp,ids:b.isMulti?Array.isArray(r)?r:r?null==r?void 0:r.split(","):[]:r})}),[Ie,X,b]);var ke=(0,N.useMemo)((function(){return kt(X)?b.isMulti?r?Array.isArray(r)?r:(null==r?void 0:r.split(","))||[]:[]:r||"":""}),[b.isMulti,r,X]),xe=W({controlMeta:ql({allowClear:!0,entityId:Ie,queryParams:he},b),onChange:function(e){var t;"string"==typeof e?t=e:Array.isArray(e)&&(t=e.join(",")),B(t)},baseUrl:F,batchInvoke:function(e,t){K(e,n,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[])},getControlText:U,addControlAction:Ne,batchInvokeListConfig:function(){Ie&&K("listconfig","nocodewfdesigner",[Ie])},batchInvokeQuery:Te,value:ke},!0),_e=E()(Wl).call(Wl,X)?xe:{},we=(0,N.useMemo)((function(){return(null==V?void 0:V.expression).functionTypes}),[null==V?void 0:V.expression]),Me=(0,N.useMemo)((function(){var e=(null==V?void 0:V.expression).functionOperations;return Fa()(e)}),[null==V?void 0:V.expression]),Se=(0,N.useMemo)((function(){return $?{readOnly:!0,autofocus:!1,lang:ne,expressionData:we,fieldData:y,value:te}:{expressionData:[],fieldData:[]}}),[$,ne,we,y,te]),Ae=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];null==P||P.apply(void 0,t)},Pe=function(e){oe(e)},De=function(e){e.key===Kl&&G(!0)},Oe=function(e){return I().createElement(I().Fragment,null,I().createElement(Ya,{options:[{Id:Kl,Title:"运算公式",icon:"yunsuangongshi"}],onClick:De}),e)},je=function(){null==A||A()},Be=(0,N.useMemo)((function(){if($)return null;var e=Array.isArray(r)?r:r?[r]:[],t=i()(e).call(e,(function(e){return!!Ul(s,(function(t){return t.key===e}))}));return ql({type:"treeSelect",defaultExpandAll:!1,expandKeys:fl(s,t),showSearch:!0,data:s,varSelectActive:le,selectedKeys:t,isVar:Y,readonly:l,onSelect:Ae,onClear:je,onVarSelectActive:Pe,dropdownRender:Oe},k)}),[s,r,le,$,l,Y,k,Ae,Pe,Oe,je]),Re=(0,N.useMemo)((function(){return"date"===X&&ue&&!l?new Date(ue):"combo"===X&&null!=b&&b.isMulti&&ue&&!$?r?Array.isArray(ue)?ue:null==ue?void 0:ue.split(","):Array.isArray(r)?r:null==r?void 0:r.split(","):ue}),[ue,X,s,l]),Fe=(0,N.useMemo)((function(){return"textarea"===X?{autoSize:!0,style:{maxHeight:"480px"},className:"".concat(H,"-combineselector-textarea")}:{}}),[X]);if(l){if(Y){var Ve,qe=Hl(Re,s)||{},Ke=qe.title,Ue=qe.titlePrefix;return Ke&&Ue?m()(Ve="".concat(Ue)).call(Ve,Ke):""}if("combo"===X){var He=c.options;if(Array.isArray(He)){var Le;if(b.isMulti){var ze,Je=Array.isArray(Re)?Re:null==Re?void 0:Re.split(",");return(null==Je?void 0:Je.length)>0&&(null===(ze=i()(He).call(He,(function(e){return null==Je?void 0:E()(Je).call(Je,e.value)})))||void 0===ze?void 0:g()(ze).call(ze,(function(e){return e.label})).join(","))||"-"}return(null===(Le=M()(He).call(He,(function(e){return e.value===Re})))||void 0===Le?void 0:Le.label)||"-"}}if("formula"!==X)return I().createElement("span",{className:"".concat(H,"-combineselector-display")},void 0!==a?a:r||"-")}var Ge="combo"===X&&!0===(null==b?void 0:b.isMulti)?{mode:"multiple"}:{};return I().createElement(I().Fragment,null,I().createElement(We.InputCombo,(0,_.c)({isDefaultInput:!0,showVarSelect:!0,allowClear:!0,placeholder:t,fieldType:X,value:Re,varSelectProps:Be,onClick:function(){null==S||S(),G(!0)},onInputKeyDown:function(e){13===e.nativeEvent.keyCode&&Ce(e)},onInputFocus:function(){ve(!0)},onInputBlur:Ce,onChange:function(e){var t=null!=e&&e.target?e.target.value:e;de(t),be(t)},onClear:j,readonly:l,className:u,formulaClassName:X===Kl?"formula":""},b,c,Se,_e,Ge,Fe)),I().createElement(We.Condition,{value:$?te:"",language:ne,fieldData:y,defaultExpandAll:!1,expressionData:we,operations:Me,actionType:f,modalTitle:"变量赋值",editorTitle:x,hideFunc:w,visible:J,onClose:function(){return G(!1)},onConfirm:function(){G(!1);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];null==O||O.apply(void 0,t)}}))}));Ll.displayName="CombineSelector";var zl=Ll;function Jl(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Gl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jl(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Jl(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var $l=function e(t,n){var r=n;Array.isArray(n)||(r=[n]);for(var a=0;a<r.length;a++){var l=r[a];if(!l)return null;if(l.key===t)return l;var o=e(t,l.children);if(o)return o}return null},Yl=["user","org","refbill"],Ql=(0,N.memo)((function(e){var t,n,r=(0,N.useState)(!1),a=(0,p.c)(r,2),l=(a[0],a[1],(0,N.useContext)(D)),o=(l.invokeAction,l.getKdesignerApi,l.getPreNodeVariablesById),i=(l.expressionData,l.getControlText),c=e.handleChange,u=e.className,d=e.editor,s=e.Name,f=e.Tips,v=e.field,m=e.id,y=e.actionType,h=e.readonly,b=e.displayLabel,C=e.propName,k=(d.Enum,d.NameHidden),x=(d.Default,d.Required),_=d.Title,w=d.Placeholder,M=(v.id,v._disp_,v.assignment),S=v.customVarType,A=v._Type_,P=v.refNodeId,O=We.ListFilterUtil.filterVariablesTreeFlow,j=s,B=e.value,R=E()(t=["url","json","accessTokenUrl"]).call(t,C)?"textarea":"text",F=(0,N.useMemo)((function(){return o(m)}),[m,o]),V=function(e,t){if(e){var n=$l(t,e);if(n){var r=null==n?void 0:n.type;if(null!=r&&ae()(r).call(r,"combo")){var a,l=null==n||null===(a=n.option)||void 0===a||null===(a=a.valueItems)||void 0===a?void 0:g()(a).call(a,(function(e){var t="string"==typeof e.name?e.name:i(e.name);return Gl(Gl({},e),{},{label:t})}));return q.current=Gl(Gl({},q.current),{},{options:l}),Gl(Gl({},n),{},{type:"combo"})}return j=(null==n?void 0:n.label)||(null==n?void 0:n.title),n}}return"text"},q=(0,N.useRef)({}),K=(0,N.useRef)(M),U=(0,N.useState)({}),H=(0,p.c)(U,2),W=H[0],L=H[1];(0,N.useEffect)((function(){var e=sl((0,ie.cloneDeep)(F)),t=V(e,M);if(K.current!==M)if(K.current=M,Nt(B)){var n,r,a=O(F,{type:(null==t?void 0:t.type)||S||"text",canMulit:!0,id:M,entityId:null==t||null===(n=t.option)||void 0===n?void 0:n.billEntityId,isMulti:(null==t||null===(r=t.option)||void 0===r?void 0:r.isMulti)||!1}),l=!1;a.forEach((function(e){var t=null==e?void 0:e.children;t&&t.forEach((function(e){e.key===B&&(l=!0)})),e.key===B&&(l=!0)})),l||c(void 0)}else c(void 0);L(t)}),[M,F]);var z=(0,N.useCallback)((function(e,t){1===e.length&&c(e[0])}),[c]),J=(0,N.useCallback)((function(e){var t=null!=e&&e.target?e.target.value:e;null==c||c(Array.isArray(t)?t.join(","):t)}),[c]),G=function(){c(void 0)},$=(0,N.useMemo)((function(){return o(m)}),[m,o]),Y=(0,N.useCallback)((function(e,t){if(!e)return c("");var n=st(e,t);c(n)}),[c,B]),Q=(0,N.useMemo)((function(){var e,t;if(De(A)){var n=pl((0,ie.cloneDeep)(F),(function(e){var t;return!E()(Yl).call(Yl,null==e?void 0:e.type)||!(null!=e&&null!==(t=e.option)&&void 0!==t&&t.isMulti)}));return sl(n,(function(e){return dl(e,P)}))}var r=sl((0,ie.cloneDeep)(F),(function(e){return dl(e,P)}));return O(r,{type:(null==W?void 0:W.type)||S||"text",canMulit:!0,id:M,entityId:null==W||null===(e=W.option)||void 0===e?void 0:e.billEntityId,isMulti:(null==W||null===(t=W.option)||void 0===t?void 0:t.isMulti)||!1})}),[F,W,S,M,A,P]);return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:k,className:u,name:s,tips:f,required:x,title:_}),I().createElement(zl,{placeholder:w,value:void 0===B&&null!=W&&null!==(n=W.option)&&void 0!==n&&n.isMulti&&xt(null==W?void 0:W.type)?[]:B,fieldType:(null==W?void 0:W.type)||R,fieldProps:null==W?void 0:W.option,inputProps:q.current,variablesTree:Q,actionType:y,className:"".concat(u,"-newsetting-value"),fieldTree:$,readonly:h,displayLabel:b,expressionTitle:j,hideFunc:De(A),onInputChange:J,onInputClear:G,onVarSelectClear:G,onVarSelectChange:z,onExpressionConfirm:Y}))}));Ql.displayName="CombineSelectorEditor";var Xl=(0,T.ErrorBoundaryWrap)(Ql,"CombineSelectorEditor");function Zl(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function eo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zl(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Zl(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var to=(We.treeUtils||{}).dfs,no=(0,N.memo)((function(e){var t,n=e.className,r=e.assignment,a=e.expression,l=e.error,o=e.value,i=e.displayLabel,c=e.caption,u=e.id,d=e.option,s=void 0===d?{}:d,f=e.type,p=e.readonly,v=e.variablesTree,y=e.onInputChange,h=e.onInputClear,E=e.onVarSelectChange,b=e.onVarSelectClear,C=e.onExpressionConfirm,k=e.editorType,x=(0,N.useContext)(D).getControlText,_=We.ListFilterUtil.filterVariablesTreeFlow,w=s.required,S=f,A={};if(null!=f&&ae()(f).call(f,"combo")){var P,O=null==s||null===(P=s.valueItems)||void 0===P?void 0:g()(P).call(P,(function(e){return eo(eo({},e),{},{label:x(e.name)})}));A=eo(eo({},A),{},{options:O,allowClear:!0}),S="combo"}var j=Array.isArray(o)?M()(o).call(o,(function(e){return e[r]===u})):{},B=p?o:(null==j?void 0:j[a])||void 0,R=null==l?void 0:l[null==j?void 0:j.calcId];return I().createElement("div",{className:"".concat(n,"-newsetting-item"),key:u},I().createElement(T.NameTipWrapper,{className:n,name:c,required:w}),I().createElement(zl,{fieldKey:u,readonly:p,fieldType:S,value:B,displayLabel:i,inputProps:A,variablesTree:_(v,{type:f,id:u,entityId:null==s?void 0:s.billEntityId,canMulit:!0,isMulti:(null==s?void 0:s.isMulti)||!1,flowEditorType:k}),fieldTree:v,fieldProps:s,className:"".concat(n,"-newsetting-value"),expressionTitle:c,onInputClear:function(e){e&&(null==e||e.stopPropagation()),null==h||h(u)},onInputChange:function(e){null!=e&&e.target?null==y||y(u,e.target.value):null==y||y(u,e)},onVarSelectChange:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];null==E||E.apply(void 0,m()(e=[u]).call(e,n))},onVarSelectClear:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];null==b||b.apply(void 0,m()(e=[u]).call(e,n))},onExpressionConfirm:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];null==C||C.apply(void 0,m()(e=[u]).call(e,n))}}),R&&I().createElement("span",{className:"".concat(n,"-error-msg")},null===(t=R[0])||void 0===t?void 0:t.msg))}));no.displayName="NewsettingItem";var ro=(0,N.memo)((function(e){var t,n=e.field,r=e.id,a=e.propName,l=(e.actionType,e.modalTitle,e.locked,e.Name),o=e.handleChange,i=e.value,c=e.editor,u=e.Tips,d=e.className,s=e.error,v=e.readonly,m=c.NameHidden,y=c.Required,h=(c.HideFunc,c.HasCheck,c.Placeholder,c.ChildProperty),b=c.Title,C=n.formId,k=n._disp_,x=n.newMode,w=n.loopby,S=(0,N.useContext)(D),A=S.invokeAction,P=S.getPreNodeVariablesById,O=(0,N.useRef)(C),j=(0,N.useState)([]),B=(0,p.c)(j,2),R=B[0],F=B[1],V=(0,N.useRef)(w),q=(0,N.useRef)(x),K=(0,N.useMemo)((function(){var e;return null===(e=h[0])||void 0===e?void 0:e.Number}),[h]),U=(0,N.useMemo)((function(){var e;return null===(e=h[1])||void 0===e?void 0:e.Number}),[h]),H=(0,N.useMemo)((function(){var e=P(r);return sl(e,(function(e){return dl(e,w)}))}),[r,P,x,w]),W=(0,N.useCallback)((function(e){A("click",[r,"refbillProps",e,{}])}),[r,a]),L=(0,N.useCallback)((function(e){Array.isArray(e)&&(F(e),o(g()(e).call(e,(function(e){var t=e.id,n=M()(i).call(i,(function(e){return e[K]===t}))||{};return(0,f.c)((0,f.c)((0,f.c)({},K,t),U,null==n?void 0:n[U]),"calcId",(null==n?void 0:n.calcId)||(0,T.createUUid)())}))))}),[o,C,i]);(0,N.useEffect)((function(){return T.eventBus.on("setRefbillProps",L),function(){T.eventBus.off("setRefbillProps",L)}}),[L]),(0,N.useEffect)((function(){O.current!==C&&(O.current=C),C?W(C):F([])}),[C,O]);var z=function(){o(g()(i).call(i,(function(e){if(e[U]&&(Nt(e[U])||bt(e[U]))&&!to(H,(function(t){return Nt(e[U])?e[U]===t.key:!!bt(e[U])&&(null===(n=e[U])||void 0===n?void 0:E()(n).call(n,t.key));var n})))return eo(eo({},e),{},(0,f.c)({},U,void 0));return e})))};(0,N.useEffect)((function(){V.current!==w&&(V.current=w,z())}),[w]),(0,N.useEffect)((function(){q.current!==x&&(q.current=x,z())}),[x]);var J=function(e,t){o(g()(i).call(i,(function(n){return n[K]===e?Array.isArray(t)?eo(eo({},n),{},(0,f.c)({},U,t.join(","))):eo(eo({},n),{},(0,f.c)({},U,t)):n})))},G=function(e,t){1===t.length&&o(g()(i).call(i,(function(n){return n[K]===e?eo(eo({},n),{},(0,f.c)({},U,t[0])):n})))},$=(0,N.useCallback)((function(e,t,n){if(!t)return o(g()(i).call(i,(function(t){return t[K]===e?eo(eo({},t),{},(0,f.c)({},U,"")):t})));o(g()(i).call(i,(function(r){return r[K]===e?eo(eo({},r),{},(0,f.c)({},U,st(t,n))):r})))}),[o,i]),Y=function(e){o(g()(i).call(i,(function(t){return t[K]===e?eo(eo({},t),{},(0,f.c)({},U,void 0)):t})))};return I().createElement("div",{className:"".concat(d,"-newsetting")},I().createElement(T.NameTipWrapper,{nameHidden:m,className:d,name:l,tips:u,required:y,title:b}),I().createElement("div",null,v?null==k||null===(t=k[a])||void 0===t?void 0:g()(t).call(t,(function(e,t){return I().createElement(no,{key:t,className:"".concat(d),variablesTree:H,value:e[U],caption:e[K],readonly:v})})):g()(R).call(R,(function(e,t){var n,r,l;return I().createElement(no,(0,_.c)({key:null==e?void 0:e.id,className:"".concat(d),variablesTree:H,assignment:K,expression:U,value:i,error:(null==s?void 0:s.msg)||{},readonly:v,displayLabel:null===(n=k[a])||void 0===n||null===(n=n[t])||void 0===n?void 0:n.expression},e,{type:null!==(r=Ee[null===(l=e.option)||void 0===l?void 0:l.editorType])&&void 0!==r?r:e.type,onInputClear:Y,onInputChange:J,onVarSelectChange:G,onVarSelectClear:Y,onExpressionConfirm:$,editorType:c.type}))}))))}));ro.displayName="NewSettingEditor";var ao=(0,T.ErrorBoundaryWrap)(ro,"NewSettingEditor"),lo=n(52892),oo=n.n(lo);function io(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,n=(0,N.useRef)({fn:e,timer:null}).current;return(0,N.useEffect)((function(){n.fn=e}),[e]),(0,N.useCallback)((function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){n.fn.apply(n,r)}),t)}),[e])}function co(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function uo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?co(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):co(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var so=(0,N.memo)((function(e){var t=e.id,n=e.handleChange,r=e.className,a=e.editor,l=e.Name,o=e.Tips,c=e.field,u=e.readonly,d=e.value,s=void 0===d?[]:d,f=a.NameHidden,v=a.Required,m=a.Title,y=(0,N.useContext)(D),h=(y.getKdesignerApi,y.getPreNodeVariablesById),b=y.compareType,C=y.getControlText,T=(y.batchInvoke,y.baseUrl,(0,N.useRef)(new(oo()))),k=(0,N.useRef)({}),x=(0,N.useRef)({}),_=(0,N.useRef)(s),w=(0,N.useState)(s),M=(0,p.c)(w,2),S=M[0],A=M[1],P=io(n),O=c.Key,B=Cl({fieldKey:O});(0,N.useEffect)((function(){A((function(e){return(0,ie.isEqual)(e,s)?e:(_.current=s,s)}))}),[s]);var R=(0,N.useCallback)((function(e){e.forEach((function(e){var t,n,r=uo(uo({},e),{},{children:[]});if(x.current[r.key]=r,null!==(t=e.type)&&void 0!==t&&E()(t).call(t,"combo")){var a,l=null==e||null===(a=e.option)||void 0===a||null===(a=a.valueItems)||void 0===a?void 0:g()(a).call(a,(function(e){return{value:e.value,name:"string"==typeof e.name?{zh_CN:e.name}:e.name}}));x.current[e.value]=uo(uo({},e),{},{valueItems:l})}else x.current[e.value]=e;null!=e&&null!==(n=e.children)&&void 0!==n&&n.length&&R(e.children)}))}),[]),F=(0,N.useMemo)((function(){var e=h(t,"",(function(e){var t,n,r;return!(null!==(t=e.option)&&void 0!==t&&t.canJudge&&(null==e||null===(n=e.option)||void 0===n||null===(n=n.children)||void 0===n||!n.length))&&!1!==(null===(r=e.option)||void 0===r?void 0:r.canJudge)})),n=sl(e,(function(e){return dl(e,"")}));return x.current={},R(n),e}),[h,t,R]),V=(0,N.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e)return[];var n=null==e?void 0:e.toLocaleLowerCase(),r=null!=n&&E()(n).call(n,"combo")?"combo":n;return gt({compareTypesMap:b,type:r,entityId:t})}),[b]),q=(0,N.useMemo)((function(){return T.current=new(oo()),null==S?void 0:g()(S).call(S,(function(e){var t=x.current[e.fieldName];if(t){var n,r,a=e.compareType;E()(n=Fa()(Ee)).call(n,t.type)&&be[e.compareType]&&(a=be[e.compareType]);var l=JSON.parse(e.value),o=t||{},c=o.title,u=o.option,d=V(null==t?void 0:t.type,(null==u?void 0:u.billEntityId)||""),s=C(null===(r=i()(d).call(d,(function(t){return t.id===e.compareType}))[0])||void 0===r?void 0:r.name),f=x.current[e.fieldName].valueItems,p=uo(uo({},e),{},{compareType:a,value:l,compareTypes:d,fieldCaption:c,compareTypeCaption:s,items:f},u);return null!=u&&u.billEntityId&&(p=uo(uo(uo({},p),u),{},{entityId:null==u?void 0:u.billEntityId})),T.current.set(e.fieldName,p),p}return uo(uo({},e),{},{fieldName:"",compareType:"",compareTypes:[],value:[]})}))}),[S,V]),K=(0,N.useCallback)((function(e){var t,n="string"==typeof e?x.current[e]:e;if(n){var r=n.value,a=n.type;return{_Type_:"FilterItem",fieldName:r,compareType:(null===(t=V(a)[0])||void 0===t?void 0:t.id)||"",value:Qt()([])}}}),[b]),U=(0,N.useCallback)((function(e){var t=g()(e).call(e,(function(e,t){var n,r=(null===(n=_.current)||void 0===n?void 0:n[t])||{},a=e.compareType||"",l=Array.isArray(e.fieldName)?e.fieldName[0]:e.fieldName,o=Qt()(e.value);if(!a&&r.fieldName!==l){var i,c=(x.current[l]||{}).type;a=(null===(i=V(c))||void 0===i||null===(i=i[0])||void 0===i?void 0:i.id)||""}return l&&a||(o="[]"),uo(uo({},e),{},{fieldName:l,compareType:a,value:o})}));_.current=t,P(t),A(t)}),[P]),H=(0,N.useCallback)((function(e,t){t.checked;var n=t.node,r=(t.event,null==n?void 0:n.key);if(!r)return!1;var a=K(n),l=a._Type_,o=a.compareType,i=a.value,c=(0,j.c)(S)||[];return c.push({_Type_:l,fieldName:r,compareType:o,value:i}),P(c),A(c),!0}),[S,P,K]),W=(0,N.useCallback)((function(e){var t=e.value;if(null!=t&&t.length){var n,r=i()(n=g()(t).call(t,(function(e){return e.fieldValue}))).call(n,Boolean);return{expandKeys:fl(F,r)}}return{}}),[F]);return I().createElement("div",{className:"".concat(r,"-judge-filter-editor")},I().createElement(We.FilterEditor,{tips:o,readonly:u,name:l,required:v,nameHidden:f,title:m,value:q,variablesTree:F,fieldRecords:k.current,listFilterConfig:F,filterFooterData:{listType:"tree",triggerText:"添加判断条件",treeProps:{defaultExpandAll:!1},onChange:H},valueData:{allowExistValueNotInOption:!1,className:"".concat(r,"-filter_value")},fieldData:{fieldType:"treeSelect",enableFilterDataTransform:!1,flowEditorType:a.Type},refBillProps:B,onChange:U,getVarSelectProps:W}))}));so.displayName="JudgeEditor";var fo=(0,T.ErrorBoundaryWrap)(so,"JudgeEditor");function po(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function vo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?po(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):po(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}function mo(e,t){var n=void 0!==rl()&&ll()(e)||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return yo(e,t);var r=oe()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return tl()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yo(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,l=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw l}}}}function yo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var go=function(e,t,n){return I().createElement("div",{title:e,className:"table-cell-render"},e)},ho=function(e){switch(e){case"gender":return 60;case"phone":return 116;default:return 178}},Eo=(0,N.memo)((function(e){var t=e.value,n=e.onChange,r=e.activeMenu,a=r.id,l=r.type,o=r.formNumber,c=r.name,u=(0,N.useContext)(D),d=u.invokeAction,s=u.getDesignerDataRef,f=(0,N.useState)({page_size:10,page_no:1}),v=(0,p.c)(f,2),y=v[0],h=v[1],b=(0,N.useState)([]),C=(0,p.c)(b,2),k=C[0],_=C[1],w=(0,N.useState)(0),S=(0,p.c)(w,2),A=S[0],P=S[1],O=(0,N.useState)(""),B=(0,p.c)(O,2),R=B[0],F=B[1],V=(0,N.useState)(""),q=(0,p.c)(V,2),K=q[0],U=q[1],H=(0,N.useState)(t),W=(0,p.c)(H,2),L=W[0],z=W[1],J=(0,N.useRef)(!1),G=function(e,t){h({page_size:t,page_no:e})},$=function(e,t,r,u){var d;if(J.current){var s=M()(k).call(k,(function(e){return e.id===t}));switch(u){case"check-all":var f,p=(0,j.c)(L),v=mo(k);try{var y=function(){var e,t=f.value,n=t.id,r=t.name;M()(p).call(p,(function(e){return e.menuId===a&&e.id===n}))||p.push({menuId:a,formNumber:o,menuType:l,id:n,name:m()(e="[".concat(c,"] ")).call(e,r)})};for(v.s();!(f=v.n()).done;)y()}catch(e){v.e(e)}finally{v.f()}z(p),null==n||n(p);break;case"uncheck-all":var h=(null==k?void 0:g()(k).call(k,(function(e){return e.id})))||[],b=i()(L).call(L,(function(e){return e.menuId!==a||!E()(h).call(h,e.id)}));z(b),null==n||n(b);break;case"check":var C=m()(L).call(L,{menuId:a,formNumber:o,menuType:l,id:s.id,name:m()(d="[".concat(c,"] ")).call(d,s.name)});z(C),null==n||n(C);break;case"uncheck":var N=i()(L).call(L,(function(e){return e.menuId!==a||e.id!==s.id}));z(N),null==n||n(N)}}},Y=function(e){var t=e.data,n=void 0===t?{}:t,r=n.rows,a=void 0===r?[]:r,l=n.totalCount,o=void 0===l?0:l;_(a),P(o),J.current=!0},Q=(0,N.useCallback)((0,Jt.c)($t().mark((function e(){var t,n;return $t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l){e.next=2;break}return e.abrupt("return");case 2:t=[o,l,a,vo(vo({},y),{},{search:K})],n=[{nocodewfdesigner:s()}],d("queryApproverData",t,n);case 5:case"end":return e.stop()}}),e)}))),[K,l,y,o,a]),X=(0,N.useCallback)((function(e){U(e),h(vo(vo({},y),{},{page_no:1}))}),[U,h]),Z=(0,T.useDebounce)(X,500);(0,N.useEffect)((function(){(0,ie.isEqual)(t,L)||z(t)}),[t]),(0,N.useEffect)((function(){l&&(F(""),U(""),(0,ie.isEqual)(y,{page_no:1,page_size:10})||h({page_no:1,page_size:10}),J.current=!1)}),[l]),(0,N.useEffect)((function(){return T.eventBus.on("setQuery",Y),function(){T.eventBus.off("setQuery",Y)}}),[]),(0,N.useEffect)((function(){Q()}),[Q]);var ee=(0,N.useMemo)((function(){var e;return g()(e=i()(L).call(L,(function(e){return e.menuId===a}))).call(e,(function(e){return e.id}))}),[L,r]),te=(0,N.useMemo)((function(){var e;return g()(e=(null==r?void 0:r.listItemConfig)||[]).call(e,(function(e){var t=e.number;return{code:t,name:e.name,width:e.width||ho(t),render:go}}))}),[r]);return I().createElement("div",{className:"main-area"},I().createElement("div",{className:"table-search"},I().createElement(x.Input,{value:R,placeholder:"搜索",borderType:"bordered",prefix:I().createElement(x.Icon,{prefix:"nocodeplatformicon",type:"sousuo"}),size:"small",onChange:function(e){F(e.target.value),Z(e.target.value)},allowClear:!0})),I().createElement("div",{className:"table-body"},I().createElement(We.DataGrid,{style:{height:"100%"},columns:te,showSelected:!0,dataSource:k,onRowSelectChange:$,onPageChange:G,rowSelection:{type:"checkbox",value:ee||[],highlightRowWhenSelected:!0,column:{lock:!0},onChange:$,clickArea:"row"},primaryKey:"id"})),I().createElement("div",{className:"table-pagination"},I().createElement(x.Pagination,{pageType:"nicety",current:y.page_no,showQuickJumper:!1,pageSize:y.page_size,onChange:G,total:A||0,dropdownProps:{getPopupContainer:function(){return document.body}},showSizeChanger:!0})))}));Eo.displayName="ApproverDataGrid";var bo=Eo;function Co(){var e=(0,N.useState)((function(){var e=window;return{width:e.innerWidth,height:e.innerHeight}})),t=(0,p.c)(e,2),n=t[0],r=t[1],a=function(e){var t=e.width,n=e.height;r({width:t,height:n})};return(0,N.useEffect)((function(){var e,t,n,r=(e=document.body,t=a,(n=new ce.c((function(e){var n=e[0].contentRect,r=n.width,a=n.height;t&&t({hide:0===r&&0===a,width:r,height:a})}))).observe(e),{removeResizeObserve:function(){n.disconnect(e),n=null}});return function(){r&&r.removeResizeObserve()}}),[]),n}var No=function(e){var t=e.data,n=e.onDelete,r=e.onClearAll;return I().createElement("div",{className:"right-area"},I().createElement("header",{className:"list-header"},I().createElement("div",{className:"select-count"},"已选（","".concat((null==t?void 0:t.length)||0),"）"),I().createElement("div",{className:"clear-btn",onClick:r},"清空")),I().createElement("div",{className:"select-list"},null==t?void 0:g()(t).call(t,(function(e){var t,r=e.name,a=e.id,l=e.menuId,o=_t(r),i=o.title,c=o.titlePrefix;return I().createElement("div",{className:"select-item",key:m()(t="".concat(l,"-")).call(t,a)},I().createElement("div",{className:"user-name",title:r},I().createElement("span",{className:"name-prefix"},c),i),I().createElement("div",{className:"delete-btn",onClick:function(t){return n(e)}},I().createElement(x.Icon,{prefix:"designericon",type:"shanchu"})))}))))},Io=function(e){var t=e.menu,n=e.activeMenuId,r=e.onChange;return I().createElement("div",{className:"type-list"},null==t?void 0:g()(t).call(t,(function(e){var t,a=e.name,l=e.id,o=e.menuId;return I().createElement("div",{className:pn()("type-item",{"is-active":n===l}),key:m()(t="".concat(o,"-")).call(t,l),onClick:function(){return null==r?void 0:r(l)}},a)})))},To=function(e){var t=e.prefixCls,n=e.onCancel,r=e.onConfirm;return I().createElement("div",{className:"".concat(t,"-modal-footer")},I().createElement(x.Button,{onClick:n,type:"second",size:"small",className:"".concat(t,"-modal-cancel-btn")},"取消"),I().createElement(x.Button,{type:"primary",size:"small",style:{marginLeft:"12px"},onClick:r,className:"".concat(t,"-modal-ok-btn")},"确定"))},ko=(0,N.forwardRef)((function(e,t){var n,r=e.prefixCls,a=e.value,l=e.menu,o=(0,N.useState)(null===(n=l[0])||void 0===n?void 0:n.id),c=(0,p.c)(o,2),u=c[0],d=c[1],s=(0,N.useState)(a||[]),f=(0,p.c)(s,2),v=f[0],m=f[1];(0,N.useEffect)((function(){var e;d(null===(e=l[0])||void 0===e?void 0:e.id)}),[l]),(0,N.useImperativeHandle)(t,(function(){return{users:v}}),[v]);var y=(0,N.useMemo)((function(){return u?M()(l).call(l,(function(e){return e.id===u})):{}}),[u]);return I().createElement("div",{className:"".concat(r,"-modal-body")},I().createElement(x.SplitPanel,{className:"".concat(r,"_content_split"),defaultSplit:.2553191489361702,min:"240px",firstSlot:I().createElement(Io,{activeMenuId:u,menu:l,onChange:function(e){d(e)}}),secondSlot:I().createElement(bo,{activeMenu:y,value:v,onChange:m})}),I().createElement(No,{data:v,onDelete:function(e){var t=e.id,n=e.menuId;m((function(e){return i()(e).call(e,(function(e){return e.id!==t||e.menuId!==n}))}))},onClearAll:function(){m([])}}))})),xo=function(e){var t=e.height,n=e.min,r=e.max;return t>r?r:t<n?n:t},_o=function(e){var t=e.prefixCls,n=e.value,r=e.title,a=e.visible,l=e.setVisible,o=e.menu,i=e.onConfirm,c=Co().height,u=(0,N.useState)(xo({height:c-64,min:520,max:1080})),d=(0,p.c)(u,2),s=d[0],f=d[1],v=(0,N.useRef)(null),m=io(f),y=function(){l(!1)};return(0,N.useEffect)((function(){var e=xo({height:c-64,min:520,max:1080});e%2!=0&&m(e-1)}),[c]),I().createElement(x.Modal,{mask:!0,visible:a,body:I().createElement(ko,{ref:v,value:n,prefixCls:t,menu:o}),titleIcon:null,className:"".concat(t,"-modal"),footer:I().createElement(To,{prefixCls:t,onConfirm:function(){var e=v.current.users;null==i||i(e),l(!1)},onCancel:y}),maskClosable:!1,width:1180,height:s,keyboard:!1,title:r,closable:!0,draggable:!1,destroyOnClose:!0,onCancel:y,onOk:y})},wo=function(e){var t=e.readonly,n=e.prefixCls,r=e.value,a=e.placeholder,l=e.onClick,o=e.onRemove;return I().createElement("div",{className:pn()("".concat(n,"-editor-trigger"),(0,f.c)({},"".concat(n,"-editor-trigger-readonly"),t)),onClick:l},I().createElement("div",{className:"trigger-content"},(null==r?void 0:r.length)>0?g()(r).call(r,(function(e){var r,a,l=e.name,i=e.id,c=e.menuId,u=_t(l),d=u.title,s=u.titlePrefix;return I().createElement(x.Tooltip,{tip:m()(r="完整路径：".concat(s)).call(r,d),mouseEnterDelay:.3},I().createElement(x.Tag,{type:"edit",className:"".concat(n,"-select-tag"),key:m()(a="".concat(c,"-")).call(a,i),closable:!0,onClose:function(n){return function(e,n){e.preventDefault(),e.stopPropagation(),t||null==o||o(n)}(n,e)},"data-tag":i},I().createElement("span",{className:"".concat(n,"-select-tag-prefix")},s),d))})):I().createElement("span",{className:"trigger-placeholder"},a)),I().createElement("div",{className:"trigger-suffix"},I().createElement(x.Icon,{prefix:"designericon",type:"gengduo",style:t?{}:{cursor:"pointer"}})))};function Mo(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function So(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mo(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Mo(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Ao=(0,T.ErrorBoundaryWrap)((function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.editor,l=e.locked,o=e.Name,c=e.Tips,u=e.readonly,d=e.field,s=a.NameHidden,v=a.Required,m=a.Title,y=(0,N.useState)(!1),h=(0,p.c)(y,2),E=h[0],b=h[1],C=(0,N.useContext)(D),k=C.prefixCls,x=C.invokeApi,_=(0,N.useState)([]),w=(0,p.c)(_,2),S=w[0],A=w[1],P=(0,N.useState)({}),O=(0,p.c)(P,2),j=O[0],B=O[1],R=d.id,F=function(e){var r,a=e.data,l=void 0===a?[]:a;A(l);var o,c=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce((function(e,t){return So(So({},e),{},(0,f.c)({},t.id,t))}),{});return null==e?void 0:g()(e).call(e,(function(e){var n=t[e.menuId];return n?So(So({},e),{},{name:e.name.replace(/\S+（/,"[".concat(n.name,"（")).replace(/\S+\]/,"[".concat(n.name,"]"))}):e}))}((null===(o=n,r="[object Object]"===Object.prototype.toString.call(o)?o:{})||void 0===r?void 0:r.sourceData)||[],l),u=function(e,t){if(null==e||!e.sourceData)return e;var n=e.sourceData,r=void 0===n?[]:n,a=i()(r).call(r,(function(e){var n=e.menuId,r=e.formNumber;return M()(t).call(t,(function(e){return e.id===n&&e.formNumber===r}))}));return So(So({},e),{},{sourceData:a})}(So(So({},n),{},{sourceData:c}),l);(0,ie.isEqual)(u,j)||(B(u),t(u))};(0,N.useEffect)((function(){return x.getUserSelectMenu([R]),T.eventBus.on("approverMenu",F),function(){T.eventBus.off("approverMenu",F)}}),[]);var V="".concat(k,"-user-f7");return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:s,className:r,name:o,tips:c,required:v,title:m}),I().createElement(wo,{readonly:u,value:j.sourceData||[],prefixCls:k,placeholder:"请选择",onClick:function(){l||u||b(!0)},onRemove:function(e){var n=e.id,r=e.menuId,a=j.sourceData,l=i()(a).call(a,(function(e){return e.id!==n||e.menuId!==r})),o=So(So({},j),{},{sourceData:l});B(o),t(o)}}),I().createElement(_o,{prefixCls:V,value:j.sourceData||[],visible:E,setVisible:b,menu:S,onConfirm:function(e){var n=So(So({},j),{},{sourceData:e});(0,ie.isEqual)(n,j)||(B(n),t(n))},title:"请选择"}))}),"UserSelectEditor"),Po=n(28429),Do=n.n(Po),Oo=["label","value","children","icon"];function jo(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Bo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jo(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):jo(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Ro=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t?g()(t).call(t,(function(t){var r=t.label,a=t.value,l=t.children,o=t.icon,i=Bo(Bo({key:a,title:r},(0,Y.c)(t,Oo)),n);return o&&(i.icon=o),l?(l.length&&(i.children=e(l)),i.checkable=!1):i.isLeaf=!0,i})):t},Fo=We.treeUtils.dfs,Vo=[F],qo=(0,N.memo)((function(e){e.handleChange;var t=e.value,n=e.className,r=e.editor,a=(e.locked,e.Name),l=e.Tips,o=e.field,c=e.id,u=e.propName,d=r.NameHidden,s=r.Required,v=r.needsync,m=r.Title,y=r.Type,h=r.SubTitle,b=r.RefProp,C=r.Source,k=r.ExpandAll,_=o._disp_,w=o.id,M=o._Type_,S=o.published,A=o.SelectBillPid,P=o.setting,j=o[C],B=(0,N.useContext)(D),R=B.invokeAction,F=B.getKdesignerApi,V=B.prefixCls,q=(0,N.useContext)(O).sendSyncData,K=F().data,U="".concat(V,"-bill-type"),H=(0,N.useState)([]),W=(0,p.c)(H,2),L=W[0],z=W[1],J=(0,N.useRef)(null),G=(0,N.useRef)(null),$=(0,N.useRef)(j),Y=(0,N.useCallback)((function(e){var t=e.children,n=void 0===t?[]:t;if(E()(Vo).call(Vo,M))"bos_user"===n[0].value&&(n[0].icon=I().createElement(x.Icon,{prefix:"nocodeplatformicon",type:"gerenzhongxin",style:{color:"#3987ED"}})),"bos_adminorg"===n[1].value&&(n[1].icon=I().createElement(x.Icon,{prefix:"nocodeplatformicon",type:"zuzhi",style:{color:"#3987ED"}})),z(Ro(n));else{var r=i()(n).call(n,(function(e){return!E()(he).call(he,e.value)}));z(Ro(r))}}),[M]);(0,N.useEffect)((function(){!function(){if(!S){var e={showTree:"true",ignoreCosmicForm:"true"};"byapi"===j&&(e.isOpenApi="true"),Array.isArray(A)&&(e.parentId=A[A.length-1]),R("click",[c,y,u,e])}}()}),[j]),(0,N.useEffect)((function(){return T.eventBus.on(Sn,Y),T.eventBus.on(An,Q),function(){T.eventBus.off(Sn,Y),T.eventBus.off(An,Q)}}),[]);var Q=function(e){var t;z((function(t){return X(t,G.current,Ro(e,{isAsyncNode:!0}))})),null===(t=J.current)||void 0===t||t.call(J),J.current=null},X=function e(t,n,r){return g()(t).call(t,(function(t){return t.key===n?Bo(Bo({},t),{},{children:r}):t.children?Bo(Bo({},t),{},{children:e(t.children,n,r)}):t}))};(0,N.useEffect)((function(){$.current&&j!==$.current&&($.current=j,z([]))}),[j]);var Z=(0,N.useMemo)((function(){return Fo(L,(function(e){return e.key===t}))}),[L,t]),ee=(0,N.useMemo)((function(){return Z?t:t?_[u]:""}),[Z,_,t]);return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:d,className:n,name:a,tips:l,required:!S&&s,title:m,subTitle:h}),I().createElement("div",{className:"".concat(U,"-tree-select")},S?null==_?void 0:_[u]:I().createElement(x.ConfigProvider,{value:{prefixCls:"kd"}},I().createElement(We.KDTreeSelect,{allowClear:!0,value:ee,treeData:L,showTreeIcon:!0,treeIcon:function(e){return e.icon},onChange:function(e,n){if(e!==t){var r,a=(null==n||null===(r=n[0])||void 0===r?void 0:r.title)||"",l=""===e&&null!=P&&P.length?{setting:[]}:{};K.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[c,Bo((0,f.c)((0,f.c)((0,f.c)({},u,e),b,e),"_disp_",Bo(Bo({},_),{},(0,f.c)((0,f.c)({},u,a),b,a))),l)]])),v&&q([w])}},treeLoadData:function(e){var t=e.key,n=e.children,r=e.isLeaf;return new(Do())((function(e){n||r?e():(J.current=e,G.current=t,R("queryTreeNodeChildren",[t]))}))},treeDefaultExpandedKeys:A,treeDefaultExpandAll:k,virtual:!0,listHeight:360,scrollToKey:ee}))))}));qo.displayName="RefBillTypeEditor";var Ko=(0,T.ErrorBoundaryWrap)(qo,"RefBillTypeEditor");function Uo(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ho(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Uo(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Uo(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Wo=["NoCodeBillFormAp"],Lo=["","default","disabled","readonly","hidden","mustInput"],zo=Lo.reduce((function(e,t,n){return t?Ho(Ho({},e),{},(0,f.c)({},t,n)):e}),{}),Jo={1:4,3:3,2:2,4:1,5:4},Go=function(e,t){var n,r;return E()(n=["NoCodeBizButtonAp","BizBtnFlexPanelAp"]).call(n,e)||Ue(e)||E()(r=["NoCodeEntryEntity"]).call(r,t)},$o=(0,N.memo)((function(e){var t=e.handleChange,n=e.className,r=e.editor,a=e.Name,l=e.Tips,o=e.field,i=e.readonly,c=e.value,u=void 0===c?[]:c,d=r.NameHidden,s=r.Required,p=r.Title,v=o.refNodeId,m=(0,N.useContext)(D),y=m.customUtils,g=m.getKdesignerApi,h=(m.getPreNodeVariablesById,m.getRefBillVarFormId),b=(0,N.useMemo)((function(){return g()}),[]),C=b.data,k=b.meta,x=(0,N.useContext)(T.GlobalConfigContext).showMessage,_=(0,N.useRef)(null);(0,N.useEffect)((function(){C.getData().Items.forEach((function(e){e.id;var t=e._Type_;if(v===e.id)if(Pe(t))if("byfilter"===e.queryModel)_.current=e.formId;else{var n=k.getControlMetaEditor(t,"refbillField");_.current=h(e.id,e.refbillField,null==n?void 0:n.VarType)}else _.current=e.formId}))}),[v]);var w=function(e,n){var r=n.getDesignerRef,a=(((null==r?void 0:r())||{}).kdesignerApi||{}).data,l=a.getData().Items,o=Ho({},e);l.forEach((function(e){var t=e.Key,n=e.ParentId,r=e.Status,l=e._Type_,i=e.FieldRequired;e.Name;if(!o[t]&&!E()(Wo).call(Wo,l)&&"hidden"!==Lo[r]){if("NoCodeEntryAp"!==a.findControl(n)._Type_){var c=Lo[r]||"default";o[t]="default"===c&&"2"===i?"mustInput":c}Ue(l)&&(o[t]=Lo[3])}})),t(o)},M=function(e,t,n,r,a){var l=t.Id,o=t.Key,i=n.data,c=i.getAllSubControls(l),u=i.getAllParentControls(l),d=c.reduce((function(t,n){var r=n.Id,a=n._Type_,o=n.Key;return l!==r&&(Ue(a)||(t[o]=e)),t}),{}),s=u.reduce((function(t,n){var r=n._Type_,l=n.Key,o=n.Status,i=zo[a[l]||Lo[o]||"default"];return(He(r)||function(e){return"NoCodeRefBillTable"===e}(r))&&Number(Jo[i])<Number(Jo[zo[e]])&&(t[l]=He(r)?Lo[1]:e),t}),{});r(Ho(Ho(Ho({},d),s),{},(0,f.c)({},o,e)))};return i?null:I().createElement("div",{className:"".concat(n,"-userinputperm")},I().createElement(T.NameTipWrapper,{nameHidden:d,className:n,name:a,tips:l,required:s,title:p}),I().createElement("span",{className:"".concat(n,"-userinputperm-active"),onClick:function(){_.current?null==y||y.showFieldPermission({formId:_.current,value:null!=u?u:[],onChange:w,fieldStatusSettingOptions:{hideMenu:Go,onFieldStatusChange:M}}):x("录入表单不存在，请选择")}},"配置"))}));$o.displayName="UserInputPermEditor";var Yo=(0,T.ErrorBoundaryWrap)($o,"UserInputPermEditor"),Qo=["index","prefixClass","className","editorProps","name","message","showDelete","errorData","readonly","onChange","onDelete"];function Xo(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xo(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Xo(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var ei="auditMessageMustInput",ti="terminateFlow",ni="sendMessage",ri=[{key:ei,label:"审批意见必填"},{key:ti,label:"决策后结束流程(分支)"},{key:ni,label:"决策后发送消息"}],ai=(0,N.memo)((function(e){var t,n=e.index,r=e.prefixClass,a=e.className,l=e.editorProps,o=e.name,c=e.message,u=e.showDelete,d=e.errorData,s=e.readonly,v=e.onChange,m=e.onDelete,y=(0,Y.c)(e,Qo),h=(0,N.useState)(o),E=(0,p.c)(h,2),b=E[0],C=E[1],T=(0,N.useRef)(null);(0,N.useEffect)((function(){o!==b&&C(o)}),[o]);var k=function(e){v(n,e)},w=function(e){e!==o&&(T.current&&clearTimeout(T.current),T.current=setTimeout((function(){T.current=null,k({name:e})}),300))},M=l.readonly,S=null==d?void 0:d.message,A=null==d?void 0:d.name,P=(0,N.useMemo)((function(){var e;return s?i()(e=g()(ri).call(ri,(function(e){var t=e.key,n=e.label;return y[t]?n:""}))).call(e,(function(e){return e})):[]}),[]);return I().createElement(I().Fragment,null,s?I().createElement("div",{className:"".concat(a,"_readonly")},b,P.length>0?"：":"",P.join("，")):I().createElement("div",{className:a},I().createElement("div",{className:"".concat(a,"_main")},I().createElement("div",{className:"".concat(a,"_main_fieldlist")},I().createElement(x.Form.Item,{name:o,required:!0,validateTrigger:"onBlur",rules:[{required:!0,message:""}],className:(0,f.c)({},"".concat(a,"_error"),A)},I().createElement(x.Input,{className:"input",borderType:"bordered",placeholder:"请输入",disabled:M,value:b,maxLength:12,onChange:function(e){var t=e.target.value;C(t),w(t)}})),g()(ri).call(ri,(function(e){var t=e.key,n=e.label;return I().createElement(x.Checkbox,{className:"checkbox",key:t,checked:y[t],onChange:function(e){return function(e,t){k((0,f.c)({},e,t.target.checked))}(t,e)}},n)})),u&&I().createElement(x.Icon,{prefix:"nocodeplatformicon",type:"xingshanchu",className:"delete",title:"删除决策项",onClick:function(){m(n)}})),A&&I().createElement("span",{className:"".concat(r,"-error-msg")},d.name))),y[ni]&&I().createElement("div",{className:pn()("".concat(a,"_condiction"),(0,f.c)({},"".concat(a,"_error"),S))},I().createElement(Wa,(0,_.c)({},l,{Name:"决策后发送消息",editor:{HideFunc:!(null==l||null===(t=l.Editor)||void 0===t||!t.HideFunc),NameHidden:!0},value:c,hiddenTitle:!0,readonly:s,handleChange:function(e){k({message:e})}})),S&&I().createElement("span",{className:"".concat(r,"-error-msg")},d.message)))}));ai.displayName="ApprovalDecisionItem";var li=dt(ft.key,{title:ft.title}),oi=(0,N.memo)((function(e){var t=e.handleChange,n=e.className,r=e.editor,a=e.Name,l=e.Tips,o=e.field,i=e.readonly,c=e.error,u=e.value,d=void 0===u?[]:u,s=r.NameHidden,v=r.Required,y=r.Title,h=o.name,E=(0,N.useContext)(T.GlobalConfigContext).showMessage,b="".concat(n,"_approvaldecision"),C=x.Form.useForm(),k=(0,p.c)(C,1)[0];(0,N.useEffect)((function(){if(2===d.length){var e=g()(d).call(d,(function(e){var t,n,r,a,l,o,i=e.number;if(e.message)return e;var c="";switch(i){case"Consent":c=m()(t=m()(n=m()(r="您申请的【 ".concat(ft.key," 】在【 ")).call(r,h," 】节点审核通过@@您申请的【 ")).call(n,li," 】在【 ")).call(t,h," 】节点审核通过@@1");break;case"Terminate":c=m()(a=m()(l=m()(o="您申请的【 ".concat(ft.key," 】在【 ")).call(o,h," 】节点审核否决@@您申请的【 ")).call(l,li," 】在【 ")).call(a,h," 】节点审核否决@@1")}return Zo(Zo({},e),{},{message:c})}));t(e)}}),[]);var w=function(e,n){var r=(0,ie.cloneDeep)(d);r[e]=Zo(Zo({},r[e]),n),t(r)},M=function(e){var n=(0,ie.cloneDeep)(d);ee()(n).call(n,e,1),t(n)};return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:s,className:n,name:a,tips:l,required:v,title:y}),I().createElement("div",{className:b},I().createElement(x.Form,{form:k},null==d?void 0:g()(d).call(d,(function(t,r){var a,l=null==c||null===(a=c.msg)||void 0===a?void 0:a[t.number],o={};return l&&l.forEach((function(e){o[e.prop]=e.msg})),I().createElement(ai,(0,_.c)({key:t.number,index:r,prefixClass:n,className:"".concat(b,"_item"),editorProps:e,showDelete:d.length>2},t,{errorData:o,readonly:i,onChange:w,onDelete:M}))}))),!i&&I().createElement(We.BtnField,{major:!0,type:"text",text:"添加决策项",icon:{prefix:"designericon",type:"zengjia-yuan2"},onClick:function(){k.validateFields().then((function(e){var n,r,a=m()(n=[]).call(n,(0,j.c)(d),[Zo((0,f.c)((0,f.c)((0,f.c)({number:(0,T.createUUid)(),name:""},ei,!1),ti,!1),ni,!1),r)]);t(a)})).catch((function(e){E("请输入决策项名称")}))}})))}));oi.displayName="ApprovalDecisionEditor";var ii=(0,T.ErrorBoundaryWrap)(oi,"ApprovalDecisionEditor");function ci(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ui(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ci(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):ci(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var di=(0,N.memo)((function(e){var t=e.handleChange,n=e.className,r=e.editor,a=e.Name,l=e.Tips,o=e.field,i=e.value,c=r.NameHidden,u=r.Required,d=r.Title,s=r.RefProp,f=(o.refNodeId,o.itemId,(0,N.useContext)(D)),v=f.getKdesignerApi,m=f.batchInvoke,y=f.getRefBillVarFormId,h=(0,N.useMemo)((function(){return v()}),[]),b=h.data,C=h.meta,k=o[s],x=(0,N.useRef)(k),w=(0,N.useState)([]),M=(0,p.c)(w,2),S=M[0],A=M[1];(0,N.useEffect)((function(){if(k!==x.current&&(x.current=k,t("")),k){var e=k;if("formId"!==s)b.getData().Items.forEach((function(t){t.id;var n=t._Type_;if(k===t.id)if(Pe(n))if("byfilter"===t.queryModel)e=t.formId;else{var r=C.getControlMetaEditor(n,"refbillField");e=y(t.id,t.refbillField,null==r?void 0:r.VarType)}else e=t.formId}));e&&!E()(he).call(he,e)?m("getTriggerProcess","nocodewfdesigner",[e]):A([])}else A([])}),[k]),(0,N.useEffect)((function(){var e=T.eventBus.on("setTriggerProcess",(function(e){var t,n=(t=e,Array.isArray(t)&&(null==t?void 0:g()(t).call(t,(function(e){return ui(ui({},e),{},{label:e.name,value:e.id})})))||[]);A(n)}));return function(){T.eventBus.off("setTriggerProcess",e)}}),[]);var P=(0,N.useMemo)((function(){return ui(ui({},e),{},{editor:ui(ui({},e.Editor),{},{NameHidden:!0})})}),[e]);return I().createElement("div",{className:"".concat(n,"-pickwf")},I().createElement(T.NameTipWrapper,{nameHidden:c,className:n,name:a,tips:l,required:u,title:d}),I().createElement(T.EditorPropertySelect,(0,_.c)({},P,{multiple:!0,selectPlaceholder:"无",dropdownClassName:"".concat(n,"-pickwf-panel"),value:S.length?i:"",options:S||[],scrollHidden:!1,handleChange:t})))}));di.displayName="PickWfEditor";var si=(0,T.ErrorBoundaryWrap)(di,"PickWfEditor");function fi(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function pi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fi(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):fi(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var vi=(0,N.memo)((function(e){var t=e.type,n=e.value,r=e.className,a=e.onChange;if("day"===t)return null;var l=ir(t),o=function(e){if("year"!==t)a(e);else{var n=null==e?void 0:i()(e).call(e,(function(e){return"number"!=typeof e}));a(n)}};return"week"===t||"month"===t?I().createElement(x.Select,{allowClear:!0,placeholder:"请选择",mode:"multiple",borderType:"bordered",value:n,options:l,className:r,onChange:o}):I().createElement(x.ConfigProvider,{value:{prefixCls:"kd"}},I().createElement(We.KDTreeSelect,{allowClear:!0,mode:"multiple",value:n,treeData:l,showTreeIcon:!0,selectedKeys:n,className:r,onChange:o}))}));vi.displayName="DateTypePicker";var mi={date:[],time:""},yi=(0,N.memo)((function(e){var t=(0,N.useContext)(D).isReadonly,n=e.handleChange,r=e.value,a=void 0===r?mi:r,l=e.className,o=e.editor,i=(e.locked,e.Name),c=e.Tips,u=e.field,d=(e.id,e.propName,o.NameHidden),s=o.Required,f=o.Title,p=o.SubTitle,v=u.loopType,m="".concat(l,"-triggertime"),y=a||{},g=y.time,h=y.date,E=(0,N.useRef)(v),b=function(e){var t=e?vt("hh:mm:ss",e):"";n(pi(pi({},a||mi),{},{time:t}))},C=function(e){n(pi(pi({},a||mi),{},{date:e}))};return(0,N.useEffect)((function(){g||b()}),[g]),(0,N.useEffect)((function(){E.current!==v&&(C([]),E.current=v)}),[v]),t?I().createElement(I().Fragment,null,I().createElement("div",{className:pn()("".concat(l,"-display-viewitem"),"custom-title")},I().createElement("span",{className:"title",title:f},i)),I().createElement("span",null,dr(v,(null==a?void 0:a.date)||[])+(null==a?void 0:a.time))):I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:d,className:l,name:i,tips:c,required:s,title:f,subTitle:p}),I().createElement("div",{className:"".concat(m)},I().createElement(vi,{value:h,className:"".concat(m,"-date"),type:v,onChange:C}),I().createElement(x.DatePicker,{defaultValue:g?cr(g):void 0,className:"".concat(m,"-time"),allowClear:!1,picker:"time",borderType:"bordered",onOk:b})))}));yi.displayName="TriggerTimeEditor";var gi=(0,T.ErrorBoundaryWrap)(yi,"TriggerTimeEditor"),hi=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.editor,l=e.locked,o=e.picker,i=e.Name,c=e.Tips,u=e.Id,d=a.NameHidden,s=a.Required,f=a.AllowClear,p=a.BorderType,v=a.Placeholder,m=a.Title,y=a.Picker,g=a.Format,h=void 0===g?"yyyy-MM-dd hh:mm:ss":g,E=a.SubTitle,b="string"==typeof n&&n?new Date(n):n;return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:d,className:r,name:i,tips:c,required:s,title:m,subTitle:E}),I().createElement(x.DatePicker,{className:"".concat(r,"-datepicker-editor"),dropdownClassName:"".concat(r,"-datepickerpanel-editor"),disabled:l,borderType:p,allowClear:f,value:b,onChange:function(e){if(e){if(!(e instanceof Date))return;"startTime"===u?e.setHours(0,0,0):"endTime"===u&&e.setHours(23,59,59);var n=vt(h,e);t(n)}else t(e)},picker:y||o,placeholder:v}))},Ei=n(16428);function bi(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ci(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bi(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):bi(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Ni={assignment:{value:"$assignment",hideproperty:["customVarName","customVarType","decimalDataType","maxLength","scale"]},customVarType:{value:"number",hideproperty:["decimalDataType","maxLength","scale"]}},Ii=function(e){var t,n=e.prefixClass,r=e.className,a=e.data,l=e.parentField,o=(e.displayLabel,e.isReadonly),i=e.readonly,c=e.propertyData,u=e.nodeVariablesTree,d=e.error,s=e.handleChange,f=c.Config,p=c.Number,v=Ci({},a);delete v._Type_;var y=(0,_.c)(v,{id:l.id,_disp_:l._disp_,_Type_:l._Type_}),g=function(e,t){return C()(Ni).some((function(n){var r,a;return!(e[n]===(null===(r=Ni[n])||void 0===r?void 0:r.value)||null===(a=Ni[n])||void 0===a||null===(a=a.hideproperty)||void 0===a||!E()(a).call(a,t))}))}(y,p);if(g)return null;if(o){var h,b=(null==c||null===(h=c.Config)||void 0===h?void 0:h.Editor)||{},N=Ci(Ci({},c),{},{Editor:b,Id:c.Number});if(!E()(yn).call(yn,null==b?void 0:b.Type)||void 0===y[N.Id])return I().createElement(sn,{className:"kdesigner-right-view",displayData:y,propertyData:N})}var k={};return void 0!==f.Editor.Width&&(k.width=f.Editor.Width,k.flexGrow=0,k.flexShrink=0),I().createElement("div",{style:k,className:pn()(r,"".concat(n,"-parameter-item-property")),key:m()(t="".concat(v.id,"-")).call(t,p)},I().createElement(T.PropertyViewItem,(0,_.c)({},f,c,{Id:p,field:Ci({},y),value:y[p],className:"kdesigner-right-view",enableMutiSelect:!1,variablesTree:u,readonly:i,onPropertyChange:s,renderCustomError:function(e,t){return!0}})),"string"==typeof d&&I().createElement("span",{className:"".concat(n,"-error-msg")},d))};Ii.displayName="ChildPropertyViewItem";var Ti=(0,T.ErrorBoundaryWrap)(Ii,"ChildPropertyViewItem");function ki(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function xi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ki(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):ki(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var _i=(0,N.memo)((function(e){var t=(0,N.useContext)(D),n=t.getKdesignerApi,r=t.getPreNodeVariablesById,a=t.isReadonly,l=t.getRefBillVarFormId,o=(0,N.useMemo)((function(){return n()}),[]),c=(o.data,o.meta),u=e.handleChange,d=e.value,s=e.className,v=e.editor,y=e.Name,h=e.Tips,b=e.field,C=e.propName,k=e.error,_=e.readonly,w=v.NameHidden,M=v.Required,S=v.Title,A=v.ChildProperty,P=v.Source,O=v.SubTitle,B=b.id,R=b._disp_,F=(b.refNodeId,(0,N.useMemo)((function(){return A?Fe(A):{}}),[A])),V=(0,N.useState)([]),q=(0,p.c)(V,2),K=q[0],U=q[1];(0,N.useEffect)((function(){d&&U(d)}),[d]);var H=(0,N.useMemo)((function(){var e=r(B)||[];return e=i()(e).call(e,(function(e){var t=e._Type_,n=e.formId;if(Pe(t)){if("byfilter"===e.queryModel)n=e.formId;else{var r=c.getControlMetaEditor(t,"refbillField");n=l(e.id,e.refbillField,null==r?void 0:r.VarType)}return!E()(he).call(he,n)}return!0}))}),[r,B,P]),W=(0,N.useCallback)((function(e,t,n){if(K[e]){var r=(0,ie.cloneDeep)(K),a=xi(xi({},r[e]),{},(0,f.c)({},t,n));return r[e]=a,r}return{}}),[K]),L=(0,N.useCallback)((function(e,t,n){var r=W(e,t,n);(0,Ei.unstable_batchedUpdates)((function(){u(r),U(r)}))}),[W,K]),z=(0,N.useCallback)((function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n||[],l=(0,p.c)(a,3),o=l[1],i=l[2];return L(e,o,i),!0}),[L,W,C,R,B,K]),J=(0,N.useCallback)((function(e){var t=(0,ie.cloneDeep)(K);ee()(t).call(t,e,1),u(t)}),[K]),G=(0,N.useCallback)((function(){var e,t=Re(F,"id");u(m()(e=[]).call(e,(0,j.c)(K),[t]))}),[K]),$=(0,N.useCallback)((function(){u([])}),[]),Y=(0,N.useMemo)((function(){return a?g()(A).call(A,(function(e,t){return{code:e.Number,name:e.Name,width:120,features:t===A.length-1?{flex:1}:{},render:function(t,n,r){var l,o;return I().createElement("div",{className:"".concat(s,"-parameter-item-display"),key:m()(l="".concat(n.id,"-")).call(l,e.Number)},I().createElement(Ti,{key:m()(o="".concat(n.id,"-")).call(o,e.Number),prefixClass:s,data:n,parentField:b,nodeId:B,disp:R,isReadonly:a,readonly:_,propertyData:e,nodeVariablesTree:H}))}}})):[]}),[a,A]);return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:w,className:s,name:y,tips:h,required:M,title:S,subTitle:O}),a?null!=K&&K.length?I().createElement(We.DataGrid,{dataSource:K,columns:Y}):"-":I().createElement("div",{className:"".concat(s,"-parameter")},(null==K?void 0:K.length)>0&&I().createElement("div",{className:"".concat(s,"-parameter-list")},g()(K).call(K,(function(e,t){var n,r=null==k||null===(n=k.msg)||void 0===n?void 0:n[e.id],l={};return r&&r.forEach((function(e){l[e.prop]=e.msg})),I().createElement("div",{className:"".concat(s,"-parameter-item"),key:e.id},I().createElement("div",{className:"".concat(s,"-parameter-item-content")},g()(A).call(A,(function(n){var r,o=n.Number;return I().createElement(Ti,{key:m()(r="".concat(e.id,"-")).call(r,o),prefixClass:s,data:e,parentField:b,nodeId:B,disp:R,isReadonly:a,readonly:_,propertyData:n,nodeVariablesTree:H,error:l[o],handleChange:function(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return z.apply(void 0,m()(e=[t]).call(e,r))}})}))),I().createElement(x.Icon,{prefix:"nocodeplatformicon",type:"xingshanchu",className:"delete",title:"删除",onClick:function(){return J(t)}}))}))),!_&&I().createElement("div",{className:"".concat(s,"-parameter-footer")},I().createElement(We.BtnField,{major:!0,type:"text",className:"".concat(s,"-parameter-add"),icon:{prefix:"designericon",type:"zengjia-yuan"},onClick:G},"添加参数"),K.length>0&&I().createElement(We.BtnField,{type:"text",className:"".concat(s,"-parameter-clear"),onClick:$},"清空"))))}));_i.displayName="ParameterSettingEditor";var wi=(0,T.ErrorBoundaryWrap)(_i,"ParameterSettingEditor"),Mi=(0,N.memo)((function(e){var t=e.value,n=e.allowClear,r=void 0===n||n,a=e.onChange;return I().createElement(We.Text,{value:t,title:t,onChange:a,allowClear:r})}));Mi.displayName="GridInput";var Si=Mi;function Ai(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ai(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Ai(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Di=[{code:"name",name:"参数名",width:200},{code:"type",name:"类型",width:80},{code:"value",name:"参考值",features:{flex:1}}],Oi=[{code:"name",name:"变量名称",width:200},{code:"value",name:"变量值",features:{flex:1}}],ji=We.treeUtils.getTreeDataFlatten,Bi=We.treeUtils.transformTreeNodeTitle,Ri=function(e){var t={};return Nt(e)?t[e]=!1:t=function(e){var t={};return e?((e.match(Qe)||[]).forEach((function(e){var n=e.match(Ze),r=(0,p.c)(n,3),a=r[1];r[2],t[a]=!1})),t):t}(e),t},Fi=function(e){return g()(e).call(e,(function(e){return Pi(Pi({},e),{},{value:"object"===(0,un.c)(e.value)?Qt()(e.value):e.value})}))},Vi=(0,N.memo)((function(e){var t,n=e.handleChange,r=e.value,a=e.className,l=(e.editor,e.locked,e.Name,e.Tips,e.field),o=(e.id,e.propName,e.Id),i="".concat(a,"-testapi"),c=((0,N.useContext)(T.GlobalConfigContext).showMessage,(0,N.useContext)(D)),u=c.invokeAction,d=c.getPreNodeVariablesById,s=c.apiTestResults,v=(0,N.useState)(!1),m=(0,p.c)(v,2),y=m[0],h=m[1],E=(0,N.useState)([]),b=(0,p.c)(E,2),k=b[0],_=b[1],w=l.apiMode,M=l.url,S=(l.method,l.requestHeader),A=l.requestBody,P=l.id,O=l.accessTokenUrl,j=(0,N.useState)(null===(t=s.current)||void 0===t?void 0:t[P]),B=(0,p.c)(j,2),R=B[0],F=B[1];(0,N.useEffect)((function(){r||n("")}),[]);var V=(0,N.useMemo)((function(){return r?JSON.parse(r):{}}),[r]),q=(0,N.useMemo)((function(){return d(P)}),[P,d]),K=(0,N.useMemo)((function(){var e=Bi(sl(q));return ji(e)}),[q]),U=function(e){u("testApi",[e])};(0,N.useEffect)((function(){var e;F(null===(e=s.current)||void 0===e?void 0:e[P])}),[P]),(0,N.useEffect)((function(){var e=function(e){var t;if(e){var n=e||{},r=n.body,a=void 0===r?[]:r,l=n.header,o=void 0===l?[]:l,i=Fi(a),c=Fi(o),u=Pi(Pi({},e),{},{body:i,header:c});F(u),s.current[P]=u,null===(t=document.getElementById(Ce))||void 0===t||t.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}};return T.eventBus.on(Pn,e),function(){T.eventBus.off(Pn,e)}}),[]);var H=function(e,t){var n=g()(k).call(k,(function(n,r){return r===e?Pi(Pi({},n),{},{value:t}):n}));_(n)},W=(0,N.useMemo)((function(){return g()(Oi).call(Oi,(function(e,t){return"value"===e.code?Pi(Pi({},e),{},{width:558,render:function(t,n,r){return I().createElement(Si,{meta:e,value:t,record:n,rowIndex:r,onChange:function(e){return H(r,e)}})}}):"name"===e.code?Pi(Pi({},e),{},{render:function(e,t,n){if(!e)return"";var r=e||{},a=r.fullLabel,l=r.title;return I().createElement(x.Tooltip,{tip:"完整路径：".concat(a),mouseEnterDelay:.3},I().createElement("span",null,l))}}):e}))}),[H,Di]),L=R||{},z=L.body,J=L.requestInfo,G=void 0===J?{}:J,$=L.header;return I().createElement("div",{id:Ce},I().createElement(We.BtnField,{className:"".concat(i,"-btn"),major:!0,text:"测试",onClick:function(){var e=function(){var e,t={},n="request"===w?M:O;if(n){var r=Ri(n);t=Pi(Pi({},t),r)}return S&&S.forEach((function(e){t=Pi(Pi({},t),Ri(e.value))})),A&&("json"===A.enctype?A.json&&(t=Pi(Pi({},t),Ri(A.json))):A.formData&&A.formData.forEach((function(e){t=Pi(Pi({},t),Ri(e.value))}))),g()(e=C()(t)).call(e,(function(e,n){return{id:n,key:e,name:!1===t[e]?K[e]:t[e],value:V[e]}}))||[]}();0!==e.length?(_(e),h(!0)):U(l)}}),R&&I().createElement(I().Fragment,null,I().createElement("div",{className:"".concat(i,"-config")},I().createElement("span",null,"请求时间：",G.requestTime,"｜"),I().createElement("span",null,"耗时：",G.cost," 秒｜"),I().createElement("span",null,"HTTP状态码：",G.statusCode)),I().createElement("div",{className:"".concat(i,"-res")},I().createElement("div",{className:"".concat(i,"-res-title")},"响应头"),I().createElement(We.DataGrid,{dataSource:$,columns:Di})),I().createElement("div",{className:"".concat(i,"-res")},I().createElement("div",{className:"".concat(i,"-res-title")},"响应体"),I().createElement(We.DataGrid,{dataSource:z,columns:Di}))),I().createElement(We.Modal,{title:"以下变量赋值后才可进行测试",width:800,height:520,visible:y,body:I().createElement(We.DataGrid,{dataSource:k,columns:W}),onCancel:function(){h(!1)},onOk:function(){var e={};k.forEach((function(t){t.key&&(e[t.key]=t.value||"")}));var t=Qt()(e),r=Pi(Pi({},l),{},(0,f.c)({},o,t));n(t),U(r),h(!1)}}))}));Vi.displayName="TestApiEditor";var qi=(0,T.ErrorBoundaryWrap)(Vi,"TestApiEditor");function Ki(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ui(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ki(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Ki(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Hi=(0,N.memo)((function(e){var t=e.handleChange,n=e.className,r=e.editor,a=e.Name,l=e.Tips,o=e.field,i=e.error,c=e.value,u=void 0===c?{enctype:"formData"}:c,d=e.propName,s=r.NameHidden,v=r.Required,y=r.Title,h=(r.RefProp,r.ChildProperty),E=(o.id,o._disp_,o.id),b=(0,N.useContext)(D),k=b.getKdesignerApi,x=(b.batchInvoke,b.getRefBillVarFormId,b.isReadonly),_=(0,N.useMemo)((function(){return k()}),[]).error;(0,N.useEffect)((function(){if(null!=i&&i.msg){var e=_.getError(E)||{};try{delete e[d]}catch(e){}var t=(0,f.c)({},E,Ui(Ui({},e),{},(0,f.c)({},u.enctype,Ui(Ui({},i),{},{prop:[u.enctype]}))));_.setError(t)}}),[i]);var w=(0,N.useMemo)((function(){var e=Fe(h);return u?Ui(Ui({},e),u):e}),[u]),M=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var l=r||[],o=(0,p.c)(l,3),i=(o[1],o[2]),c=Ui(Ui({},w),{},(0,f.c)({},e,i));return t(c),!0},S=(0,T.getModelData)([{Nodes:g()(h).call(h,(function(e){var t,n,r=Ui(Ui(Ui({},e.Config),{},{Actions:null===(t=e.Config)||void 0===t||null===(t=t.Actions)||void 0===t?void 0:t.Enum},e),{},{Id:e.Number});if(null!==(n=e.Config)&&void 0!==n&&null!==(n=n.Actions)&&void 0!==n&&n.Enum){var a,l,o=null===(a=e.Config)||void 0===a||null===(a=a.Actions)||void 0===a?void 0:g()(l=a.Enum).call(l,(function(e){var t=e.Action,n=e.Condition,r={};return C()(t).forEach((function(e){r[null==e?void 0:e.toLocaleLowerCase()]=t[e]})),{action:r,condition:n}}));r.Actions=(0,T.transformActions)(o)}return r}))}],{field:w}),A=S[0].Nodes;return I().createElement("div",{className:"".concat(n,"-requestbody")},I().createElement(T.NameTipWrapper,{nameHidden:s,className:n,name:a,tips:l,required:v,title:y}),I().createElement("div",{className:pn()("".concat(n,"-requestbody-content"),(0,f.c)({},"".concat(n,"-requestbody-content-display"),x))},g()(A).call(A,(function(e){var t=e.Number;return!1===e.Visible?null:I().createElement(Ti,{key:t,prefixClass:"".concat(n,"-requestbody"),data:(0,f.c)({},t,u[t]),parentField:o,isReadonly:x,readonly:x,propertyData:e,handleChange:function(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return M.apply(void 0,m()(e=[t]).call(e,r))}})}))))}));Hi.displayName="RequestBodyEditor";var Wi=(0,T.ErrorBoundaryWrap)(Hi,"RequestBodyEditor"),Li=(0,N.memo)((function(e){var t=(0,N.useContext)(D),n=(t.isReadonly,t.invokeAction),r=(e.handleChange,e.value,e.className),a=e.editor,l=(e.locked,e.Name),o=e.Tips,i=(e.field,e.id,e.propName,a.NameHidden),c=a.Required,u=a.Title,d=a.SubTitle,s="".concat(r,"-whitelist"),f=(0,N.useState)(null),v=(0,p.c)(f,2),m=v[0],y=v[1];return(0,N.useEffect)((function(){n("getNoCodeIpList");var e=function(e){y(e)};return T.eventBus.on(Dn,e),function(){T.eventBus.off(Dn,e)}}),[]),I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:i,className:r,name:l,tips:o,required:c,title:u,subTitle:d}),I().createElement("div",{className:"".concat(s)},m))}));Li.displayName="WhiteLsitEditor";var zi=(0,T.ErrorBoundaryWrap)(Li,"WhiteLsitEditor"),Ji=(0,N.memo)((function(e){return I().createElement(T.InputPropertyEditor,(0,_.c)({},e,{InputTitle:e.value}))}));Ji.displayName="InputPropertyEditor";var Gi=Ji,$i=["title","children"];function Yi(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yi(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Yi(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Xi=We.treeUtils.dfs,Zi=(0,N.memo)((function(e){var t=(0,N.useContext)(D),n=t.getKdesignerApi,r=t.getPreNodeVariablesById,a=t.prefixCls,l=(0,N.useMemo)((function(){return n()}),[]).data,o=e.handleChange,c=e.value,u=e.className,d=e.editor,s=e.Name,p=e.Tips,v=e.field,y=e.propName,h=(e.error,e.variablesTree),E=e.readonly,b=(e.onPropertyChange,e.assignments,e.id),C=(d.Enum,d.NameHidden),k=d.Required,x=d.VarType,_=d.Source,w=(d.Custom,d.Title),M=v.id,S=v._disp_,A=v._Type_,P=v.refNodeId,O=v.loopby,j=function e(t,n,r){return t.reduce((function(t,a){var l,o,i=a.title,c=a.children,u=(0,Y.c)(a,$i),d=u.key,s=u.value,f=r?m()(l="".concat(r,"-")).call(l,i):i,p=Qi({fullName:f,title:i},u);return c&&(p.children=e(c,!1,f)),!(n&&(null==p||null===(o=p.children)||void 0===o?void 0:o.length)>0)&&n||ae()(d).call(d,"${proc.")&&(null!=s&&za()(s).call(s,"ExecuteResult.QueryResult}")||null!=s&&za()(s).call(s,"AuditNumber}")||null!=s&&za()(s).call(s,"NodeName}")||null!=d&&za()(d).call(d,".procName}"))?t:m()(t).call(t,p)}),[])},B=(0,N.useMemo)((function(){if(h)return Se(A)||Me(A)?sl(h,(function(e){return dl(e,P||O)})):we(A)?i()(h).call(h,(function(e){var t=e._Type_,n=e.queryModel;return!(Pe(t)&&It(n))})):h;var e=r(M,x,void 0,!0)||[];return _&&(e=i()(e).call(e,(function(e){return e[_]===_}))),Se(A)?sl(e,(function(e){return dl(e,P||O)})):e}),[h,r,M,_,A,P,O]),R=(0,N.useMemo)((function(){return"string"==typeof c&&""!==c?null==c?void 0:c.split(";"):[]}),[c]),F=(0,N.useMemo)((function(){return j(B,!0)}),[B]),V=(0,N.useMemo)((function(){var e=fl(F,R);return m()(e).call(e,c)}),[F,R]);return(0,N.useEffect)((function(){var e=i()(R).call(R,(function(e){return Xi(F,(function(t){return t.key===e}))}));(0,ie.isEqual)(e,R)||o(e.join(";"))}),[]),I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:C,className:u,name:s,tips:p,required:k,title:w}),I().createElement(We.KDTreeSelect,{value:R,disabled:E,allowClear:!0,defaultExpandAll:!0,defaultExpandKeys:V,onChange:function(e,t){var n=(e||[]).join(";"),r=g()(t).call(t,(function(e){return(null==e?void 0:e.label)||"-"})).join();l.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[b,(0,f.c)((0,f.c)({},y,n),"_disp_",Qi(Qi({},S),{},(0,f.c)({},y,r)))]]))},mode:"multiple",treeData:F,className:pn()((0,f.c)({},"".concat(a,"-multivarselect-readonly"),E)),showFullLabelTips:!0}))}));Zi.displayName="MultiVarSelectEditor";var ec=(0,T.ErrorBoundaryWrap)(Zi,"VarSelectEditor"),tc=function(){var e=[];return[[Ba,"orderby"],[Wa,"expression"],[Ko,"refbilltype"],[bl,"varselect"],[ec,"multivarselect"],[Ao,"userSelect"],[Ml,"filter"],[fo,"judgefilter"],[Fl,"calcSetting"],[Xl,"combineselector"],[Kr,"nodebilltype"],[ao,"newSetting"],[Yo,"userInputPerm"],[ii,"decisionOptions"],[si,"pickWf"],[gi,"triggerTime"],[hi,"DatePicker"],[qi,"testApi"],[wi,"parameterSetting"],[Wi,"requestBody"],[zi,"whiteList"],[Gi,"Input"]].forEach((function(t){var n=(0,p.c)(t,3),r=n[0],a=n[1],l=n[2];e.push([a,r,l])})),e};n(10936);function nc(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function rc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nc(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):nc(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var ac=(We.treeUtils||{}).dfs,lc="nocode-flow",oc=(0,N.memo)((0,N.forwardRef)((function(e,t){var n=e.data,r=void 0===n?[]:n,a=e.meta,l=void 0===a?{}:a,o=e.onData,i=e.showMessage,c=void 0===i?function(e){}:i,u=e.invokeAction,d=void 0===u?function(e,t,n){}:u,s=e.batchInvoke,f=(e.getEncodeValue,e.invokeApi),v=void 0===f?{}:f,y=e.onApi,h=e.flowStatus,b=e.compareType,k=e.getControlText,_=e.webMsg,w=e.baseHooks,M=e.baseUrl,S=e.customUtils,A=(0,p.c)(r,3),P=A[0],O=A[1],j=A[2],B=(0,N.useRef)(null),F=(0,N.useRef)(P),V=(0,N.useRef)(null),q=(0,N.useRef)(null),K=(0,N.useRef)({}),U=function(e){var t=e,n={};C()(t).forEach((function(e){t[e]&&ba[e]&&(n[ba[e]]=t[e])}));var r=t.nodes;if(1===r.length){var a=t.key,l=r[0];l.number=nt(l._Type_,0),l.id=rt(a,l._Type_,0),l.itemId=l.id,r[0]=l;var o=rt(a,R,0);if(nt(R,0),r.push({number:nt(R,0),id:o,_Type_:R,parentId:l.id}),!t.edges){var i=rt(a,$,0);n.edges=[{id:i,source:l.id,target:o,_Type_:$,number:nt($,0),itemId:i,data:{parentId:l.id,id:o}}]}}return n.Items=r,n}(P),H=(0,N.useMemo)((function(){return ha(l,U)}),[l,U]),W=(0,N.useMemo)((function(){return Mt((null==j?void 0:j.variables)||{})}),[]),L=(0,N.useState)(W),z=(0,p.c)(L,2),J=z[0],G=z[1],Y=(0,N.useCallback)((function(e){var t;if(!q.current&&Array.isArray(H.Categories)){var n=H.Categories.reduce((function(e,t){return m()(e).call(e,t.Controls)}),[]);q.current={},n.forEach((function(e){var t=e.Id,n=e.Icon,r=void 0===n?"liucheng":n,a=e.Bg,l=void 0===a?"#ffffff":a;q.current[t]={bgc:l,icon:r}}))}return(null===(t=q.current)||void 0===t?void 0:t[e])||{icon:"liucheng",bgc:"#ffffff"}}),[H]),Q=(0,N.useCallback)((function(e){if("main"===e)return{main:va}}),[H]),X=(0,N.useMemo)((function(){return{showMessage:c,getViews:Q,enableError:!0,keywordMapping:{id:"id",type:"type",name:"name",key:"key",parentId:"parentId",items:"Items"},dataPortalIdPrefix:"".concat(lc,"-top-view"),enableDiffDefaultData:!1,controlViewSetting:{hideItemView:!0},propertyViewSetting:{hideItemView:!0},preHandle:Ma,getPropertyEditors:tc,filterProperty:Ea,getOutlineItemIcon:function(e){return I().createElement(x.Icon,{prefix:"designericon",type:Y(e).icon,className:"rule-designer-control-icon"})}}}),[c,Ea,Q,tc]),Z=(0,N.useCallback)((function(e,t){T.eventBus.emit(e,t)}),[]),ee=(0,N.useCallback)((function(e){var t;(F.current=rc(rc({},F.current),e),at(h))&&(F.current.edges=(null===(t=F.current.edges)||void 0===t?void 0:g()(t).call(t,(function(e){return"smoothstep"===e._Type_?rc(rc({},e),{},{_Type_:$}):e})))||[]);o&&o(F.current)}),[F.current,h]),te=(0,N.useCallback)((function(e){null==e||e.views.setViewHideState("top")(!0),B.current=rc({},e),y({kdesignerApi:B.current,pubEvent:Z,setDesignerDataRef:ee})}),[y,ee]);(0,N.useEffect)((function(){y(rc(rc({},B.current),{},{setDesignerDataRef:ee,pubEvent:Z}))}),[ee]);var ne=(0,N.useCallback)((function(e){if(!e)return"";var t=B.current,n=t.data,r=t.meta,a=(n.findControl(e)||{})._Type_;return r.getControlMeta(a).Name||""}),[]),re=(0,N.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=B.current.data,l=(a.getData()||{}).Items,o=void 0===l?[]:l,i=null!=t&&t.replace("*","")?t.split(","):[],c=0===i.length||E()(i).call(i,ft.type)?[ft]:[],u=lt(e,o);return C()(J).forEach((function(e){if(E()(u).call(u,e)){var t=it(e,J[e],i,n,r);if(t.length>0){var l=a.findControl(e);c.push(rc(rc({},l),{},{nodeId:e,key:e,title:ct(l),formId:null==l?void 0:l.formId,children:t,selectable:!1,checkable:!1}))}}})),c}),[J]),ae=(0,N.useCallback)((function(e){return J[e]}),[J]),le=function(e,t,n){var r=re(e,n)||[],a=null;if(null!=r&&r.length){var l,o=ac(r,(function(e){return e.value===t}))||{};null!=o&&null!==(l=o.option)&&void 0!==l&&l.billEntityId&&(a=null==o?void 0:o.option.billEntityId)}return a},oe=(0,N.useRef)({getKdesignerApi:function(){return B.current},setDesignerDataRef:ee,getDesignerDataRef:function(){return F.current},getBaseHooks:function(e){return(null==w?void 0:w[e])||function(){}},getPrefixCls:function(e,t,n){var r;return n||(e=e||lc,t?m()(r="".concat(e,"-")).call(r,t):e)},getNodeMetaNameById:ne,prefixCls:lc,invokeAction:d,invokeApi:v,flowStatus:h,isReadonly:at(h),flowMetaData:r,setVariables:G,expressionData:O,getControlText:k,compareType:b,webMsg:_,baseUrl:M,batchInvoke:s,customUtils:S,apiTestResults:K}),ie=(0,N.useMemo)((function(){return rc(rc({},oe.current),{},{getPreNodeVariablesById:re,getNodeVariablesById:ae,getControlIconMap:Y,getRefBillVarFormId:le})}),[re,Y,ae]);return I().createElement(I().Fragment,null,I().createElement(x.ConfigProvider,{value:{prefixCls:"kd"}},I().createElement(D.Provider,{value:ie},I().createElement(ic,{ref:V,globalConfig:X,meta:H,data:U,onApi:te}))))}))),ic=I().memo(k());oc.displayName="NocodeFlow";var cc=oc}}]);