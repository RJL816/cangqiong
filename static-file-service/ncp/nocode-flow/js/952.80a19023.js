"use strict";(self.webpackChunknocode_flow=self.webpackChunknocode_flow||[]).push([[952],{15856:function(e,t,n){n.r(t),n.d(t,{NocodeFlow:function(){return Ec}});var r={};n.r(r),n.d(r,{O:function(){return Lt},$M:function(){return zt},W:function(){return Jt},uy:function(){return Gt},eO:function(){return Ht},E7:function(){return Wt}});var a=n(34716),l=n.n(a),o=n(70696),i=n.n(o),c=n(4884),u=n.n(c),d=n(3464),s=n.n(d),f=n(25376),p=n(30644),v=n(760),m=n.n(v),y=n(23992),g=n.n(y),h=n(50524),E=n.n(h),b=n(13939),C=n.n(b),N=n(65984),I=n.n(N),T=n(18040),k=n.n(T),x=n(63548),_=n(2664),w=n(38456),M=n.n(w),S=n(98752),A=n(84912),P=n.n(A),D=I().createContext({});D.displayName="DesignerContext";var O=I().createContext({});O.displayName="FlowViewContext";var j=n(65992),B="StartSignalEvent",R="EndNoneEvent",F="QueryDataAutoTask",V="NewBillAutoTask",q="UpdateBillAutoTask",K="DeleteBillAutoTask",U="NoCodeAuditTask",H="NoCodeUserTask",W="NoCodeGateway",L="NoCodeJudgeTask",z="CalculateAutoTask",J="NoCodeNotifyTask",G="NullNode",$="ApiInvokeAutoTask",Y="SequenceFlow",Q=n(34984),X=n(99308),Z=n.n(X),ee=n(61260),te=n.n(ee),ne=n(25288),re=n.n(ne),ae=n(11908),le=n.n(ae),oe=n(73980),ie=n.n(oe),ce=n(60644),ue=n(82504),de="nocodeflow-main",se="nocodeflow-main-end-node",fe="setSyncData",pe="filterItemLook",ve="done",me="todo",ye="terminate",ge="[文本]流程名称",he="${proc.procName}",Ee=["bos_adminorg","bos_user"],be={NoCodeTextAreaField:"textarea"},Ce={1301:"1601",102:"1602"},Ne="nocode_flow_testapi";function Ie(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var ke=function(e){return e===B},xe=function(e){var t=e._Type_,n=e.isNullNode;return t===W&&!n},_e=function(e){var t=e._Type_,n=e.isNullNode;return t===W&&n},we=function(e){return e._Type_===L},Me=function(e){return e===z},Se=function(e){return e===V},Ae=function(e){return e===q},Pe=function(e){return e===K},De=function(e){return e===U},Oe=function(e){return e===H},je=function(e){return e===F},Be=function(e){return e===$},Re=function(e){return(null==e?void 0:E()(e).call(e,"NoCodeRefBillField"))||(null==e?void 0:E()(e).call(e,"NoCodeMulRefBillField"))},Fe=function(e){var t;return E()(t=["NoCodeCreatorField","NoCodeModifierField"]).call(t,e)},Ve=function(e,t){var n=t.data,r=t.selection,a={},l=i()(e).call(e,(function(e,t){var r=n.findControl(e);return 0===t&&(a=r),!ke(r._Type_)}));if(l.length){var o=l[0],c=a.parentId,u=n.getPrevSibling(o).control,d=void 0===u?{}:u;n.deleteControl((0,T.createDeleteAction)(l)).then((function(){var e=n.findControl(c)||{};if(we(a)&&xe(e))if(_e(d)){var t=n.getSubControls(c),l=i()(t).call(t,(function(e){return we(e)}))||[],o=l[l.length-1];null!=o&&o.id&&r.setSelect([o.id])}else{var u=d.id;u&&r.setSelect([u])}else if(_e(e)){var s=e.parentIds.split(","),f=s[s.length-1];f&&r.setSelect([f])}else r.setSelect([c])}))}},qe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"calcId";return Te((0,f.c)({},t,(0,T.createUUid)()),e)},Ke=function(e){var t={};return e&&e.forEach((function(e){var n=e.Config,r=e.Number;if(n){var a=(n||{}).Editor,l=void 0===a?{}:a;t[r]=null==l?void 0:l.Default}})),t},Ue=function(e,t,n,r){if(null!=e&&e.length){for(var a=t.data,l=[],o=0;o<e.length;o++){var i=e[o],c=a.findControl(i);if(ke(c._Type_))return void n("触发节点不允许复制",1);l.push(c)}n("复制成功",0),r(l)}},He=function(e){return"byrela"===e},We=function(e){var t;return E()(t=["NoCodeCreatorField","NoCodeCreateDateField","NoCodeModifierField","NoCodeModifyDateField","NoCodeBillNoField"]).call(t,e)},Le=function(e){return"NoCodeGroupContainerAp"===e},ze=n(82416),Je=["id","rootKey","number","type"],Ge=["children"],$e=["children","valueItems","billEntityId","displayProp","isMulti","compareTypes","refSelf"];function Ye(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ye(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Xe=ze.Condition.constants,Ze=Xe.allFieldRegExp,et=Xe.allExpRegExp,tt=Xe.fieldRegExp,nt=Xe.createFiledExp,rt=Xe.expRegExp,at=function(e,t){var n;return m()(n="".concat(e)).call(n,t)},lt=function(e,t,n){var r;return m()(r="".concat(e,"_")).call(r,at(t,n))},ot=function(e){return function(e){return"view"===e}(e)||function(e){return"display"===e}(e)},it=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!t||0===n.length)return r;for(var a=(0,ce.cloneDeep)(n),l=a.length-1;l>0;l--){var o=a[l];if(o.id===t&&!E()(r).call(r,o.parentId)){if(!_e(o)){var i=o.parentId;return r.push(i),te()(a).call(a,l,1),e(i,a,r)}for(var c,u=null===(c=o.parentIds)||void 0===c?void 0:c.split(","),d=u.length,s=0;s<d;s++){var f=u[s];r.push(f),r=(0,j.c)(new(Z())(m()(r).call(r,e(f,a,r))))}}}return r},ct=function(e){if(!e)return{};var t={},n=function(){var n,a={};null===(n=e[r])||void 0===n||n.forEach((function(e){a[e.prop]=e})),t[r]=a};for(var r in e)n();return t},ut=function e(t){var n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce((function(l,o){var i=o.option,c=void 0===i?{}:i,u=c.children,d=void 0===u?[]:u,s=a||"pk"===o.type&&(null==c||!c.expendOnlyInExp)?e(o.value,d||[],n,r,a):[];if(0===n.length||E()(n).call(n,o.type)||null!=s&&s.length){var f=!0;if("function"==typeof r&&(f=r(o)),f){var p,v,m=Qe(Qe({},o),{},{parentKey:t,key:o.value,type:null!==(p=be[null===(v=o.option)||void 0===v?void 0:v.editorType])&&void 0!==p?p:o.type});null!=n&&n.length&&!E()(n).call(n,o.type)&&(m.selectable=!1,m.checkable=!1),null!=s&&s.length&&(m.children=s),l.push(m)}}return l}),[])},dt=function(e){var t;if(!e)return"";var n,r=e._disp_,a=void 0===r?{}:r,l=e._Type_;if(l===F){var o,i,c=e.queryModel;if(He(c))return m()(o="".concat(null==e?void 0:e.name)).call(o,a.refbillField?"（".concat(a.refbillField,"）"):"");if(kt(c))return m()(i="".concat(null==e?void 0:e.name)).call(i,a.apiId?"（".concat(a.apiId,"）"):"")}return l===q?m()(n="".concat(null==e?void 0:e.name)).call(n,a.refNodeId?"（".concat(a.refNodeId,"）"):""):m()(t="".concat(null==e?void 0:e.name)).call(t,a.formId?"（".concat(a.formId,"）"):"")};function st(){return(window.crypto||window.webkitCrypto||window.mozCrypto||window.oCrypto||window.msCrypto).getRandomValues(new Uint32Array(1))[0]}var ft=function(e,t){return nt(e,t)};function pt(e,t){var n,r,a=(e=e.replace(/）/g,")").replace(/（/g,"(").replace(/“/g,'"').replace(/”/g,'"').replace(/‘/g,"'").replace(/’/g,"'")).replace(/ {{/g,"{{").replace(/}} /g,"}}").replace(Ze,"$1");return a=a.replace(et,(function(e){var t;return((null===(t=e.match(rt))||void 0===t?void 0:t[1])||"").replace("YMDDATE","DATE")})),m()(n=m()(r="".concat(re()(a).call(a),"@@")).call(r,e,"@@")).call(n,t?1:0)}var vt={title:"流程名称",titlePrefix:"[文本]",nodeId:"${proc.procName}",key:"${proc.procName}",type:"text"},mt=["001"];function yt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=new Date(t),r={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};for(var a in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),r)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?r[a]:("00"+r[a]).substr((""+r[a]).length)));return e}var gt=function(e){return"time"===e},ht=function(e){var t=e.id,n=e.rootKey,r=e.number,a=e.type,l=(0,Q.c)(e,Je),o=st();return r=r||at(a,o),Qe({id:t=t||lt(n,a,o),_Type_:a,number:r,itemId:t},l)},Et=function(e){var t=e.compareTypesMap,n=e.type,r=e.entityId,a=t[n]||[];return"bos_user"===r?a="nocodecreatorfield":"bos_adminorg"===r&&(a="orgfield"),"string"==typeof a&&(a=t[a]),function(e){return(null==e?void 0:i()(e).call(e,(function(e){return!E()(mt).call(mt,e.id)})))||[]}(a)},bt=function e(t,n,r){return(t||[]).reduce((function(t,a){var l,o,i=a.id,c=a.option,u=void 0===c?{}:c,d=u.children,s=(0,Q.c)(u,Ge),f=m()(l="".concat(n,".")).call(l,i),p=null!=f&&E()(f).call(f,"fbasedataid")?i.split(".fbasedataid")[0]:f;if(((null==p||null===(o=p.split("."))||void 0===o?void 0:o.length)||0)>r)return t;var v=Qe({},s);d&&(v.children=e(d,n,r));var y=Qe(Qe({},a),{},{id:f,option:v||{}});return m()(t).call(t,y)}),[])},Ct=function e(t,n,r){var a,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return i()(a=(n||[]).reduce((function(n,a){var o,i,c=a.caption,u=a.type,d=a.id,s=a.option,f=void 0===s?{}:s,p=a.typeCaption,v=null!=d&&E()(d).call(d,"fbasedataid")?d.split(".fbasedataid")[0]:d;if(((null==v||null===(o=v.split("."))||void 0===o?void 0:o.length)||0)>l)return n;var y=f.children,g=f.valueItems,h=f.billEntityId,b=f.displayProp,C=f.isMulti,N=(f.compareTypes,f.refSelf),I=(0,Q.c)(f,$e),T=function(e){return null==e?void 0:e.split("-")[0]}(u).toLowerCase(),k=d,x=Qe({title:c,key:k,compareTypes:Et({compareTypesMap:r,type:T,entityId:h}),type:u,titlePrefix:p,selectable:"group"!==u},I);return Re(u)||Fe(u)?x=(0,_.c)(x,{displayProp:b,entityId:h,isMulti:C}):function(e){return"NoCodeSelectItemField"===e}(u)&&(x=(0,_.c)(x,{isMulti:C})),g&&(x.items=g),C||(y?x.children=e(t,y,r,l):!0===N&&(x.children=e(t,bt(t,k,l),r,l))),"group"!==u||null!==(i=x)&&void 0!==i&&null!==(i=i.children)&&void 0!==i&&i.length?m()(n).call(n,x):n}),[])).call(a,(function(e){var t=e.type,n=e.entityId;return!Re(t)&&!Fe(t)||null!==n}))},Nt=function(e){return tt.test(e)||rt.test(e)||(null==e?void 0:E()(e).call(e,"@@"))},It=[/^\$\{(.+?)\}/,/^disp\((.+?)\)/],Tt=function(e){return It.some((function(t){return t.test(e)}))&&!Nt(e)},kt=function(e){return"byapi"===e},xt=["refbill","user","org"],_t=function(e){return!!e&&E()(xt).call(xt,e)},wt=function(e){return!!e&&(null==e?void 0:le()(e).call(e,"combo"))},Mt=function(e){var t=e.match(/^(\[[^\[\]]+\])+/g),n=null!=t&&t.length?t[0]:"";return{title:ie()(e).call(e,n.length),titlePrefix:n}},St=function e(t){return t.reduce((function(t,n){var r=n.option,a=n.title,l=(r||{}).children,o=Mt(a),i=o.title,c=o.titlePrefix,u=Qe(Qe({},n),{},{title:i,titlePrefix:c});return l?(u.option=Qe(Qe({},r),{},{children:e(l)}),m()(t).call(t,u)):m()(t).call(t,u)}),[])},At=function(e){return C()(e).reduce((function(t,n){var r=e[n];return t[n]=St(r),t}),{})};function Pt(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pt(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Pt(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Ot={x:0,y:0},jt=function(e){return Dt({position:Ot},e)},Bt=function(e){return Dt({style:e.isDone?{stroke:"var(--kd-nc-primary-6)"}:{stroke:"#d9d9d9"},itemId:e.id},e)},Rt=function(e){return e?"smoothstep":Y},Ft=function(e,t){var n;return e&&E()(n=[ve,"doing",ye,"exception_terminate"]).call(n,t)},Vt={},qt=function(e,t){for(var n,r=e.getData(),a=r.Items,l=(r.edges,r.key),o=[],i=[],c=a.length,u=[],d={},s=ot(t),f=0;f<c;f++){var p=a[f],v=p.id,y=p.parentId,h=p._Type_,b=(p.number,p.isNullNode),C=p.handleStatus,N=Ft(s,C);if(N&&C!==ye&&(Vt[v]=N),h!==R){u.push(y);var I=b?G:h;if(o.push(jt({id:v,type:I,data:Dt({},p)})),h!==B)if(b){var T=p.parentIds.split(",");if((null==T?void 0:T.length)>0)for(var k=(null==T?void 0:T.length)||0,x=0;x<k;x++){var _=T[x];u.push(_);var w=st(),S=lt(l,Y,w),A=Vt[_];A&&(Vt[v]=A),i.push(Bt({number:at(Y,w),itemId:S,id:S,source:_,target:v,data:{parentId:_,id:v},type:Rt(s),isDone:A}))}}else{if(xe(p)){var P=e.getSubControls(v)||[];N=!!M()(P).call(P,(function(e){return we(e)&&e.handleStatus===ve}))}var D=lt(l,Y,f);i.push(Bt({number:at(Y,f),itemId:D,id:D,source:y,target:v,data:{parentId:y,id:v},type:Rt(s),isDone:N}))}}else d=p}var O=function(e,t){return(M()(e).call(e,(function(e){return!E()(t).call(t,e.id)}))||{}).id}(o,u),F=d,V=F.id,q=F.number,K=F.handleStatus,U=function(e,t,n){return jt({id:t,type:R,data:{id:t,itemId:t,number:e,parentId:n,_Type_:R}})}(q,V,O),H=g()(i).call(i,(function(e){var t=e.id.split(Y);return Number((null==t?void 0:t[1])||0)})),W=H.length>0?Math.max.apply(Math,(0,j.c)(H))+1:0,L=lt(l,Y,W),z=at(Y,W),J=Ft(s,K),$=function(e,t,n,r,a,l){return Bt({id:t,source:r,target:n,data:{parentId:r,id:n},type:a||Y,number:e,isDone:l})}(z,L,V,O,Rt(s),J);return o.push(U),i.push($),m()(n=[]).call(n,o,i)};function Kt(e,t,n){var r,a,l=e.data,o=document.createElement("div");o.setAttribute("style",m()(r=m()(a="".concat("line-height: 20px; word-break: break-all; font-size: 14px;"," width: ")).call(a,t,"px; max-width:")).call(r,t,"px;")),document.body.appendChild(o),o.innerText=(null==l?void 0:l.documentation)||"";var i=o.getBoundingClientRect().height;return document.body.removeChild(o),n+(i>40?40:i)}function Ut(){return{style:{background:"#F8FAFC"},panOnScroll:!0,zoomOnScroll:!1,preventScrolling:!1,nodesConnectable:!1,nodesDraggable:!1,panOnScrollMode:S.WY.Free,defaultZoom:1,minZoom:1/1.5/1.5/1.5,maxZoom:3.375,zoomOnDoubleClick:!1}}var Ht="_Type_",Wt="items",Lt="Controls",zt="Enum",Jt="Items",Gt="parentId",$t=n(85640),Yt=n(29052),Qt=n.n(Yt),Xt=n(24496),Zt=n.n(Xt),en=function(){var e=(0,$t.c)(Qt().mark((function e(t,n){return Qt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null==n){e.next=4;break}return window.localStorage.setItem(t,Zt()(n)),e.abrupt("return",!0);case 4:return e.abrupt("return",!1);case 7:e.prev=7,e.t0=e.catch(0),window.localStorage.clear();case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),tn="nocodeflow.CopyContent",nn=function(e){en(tn,e)},rn=function(){var e=window.localStorage.getItem(tn);return e&&(e=JSON.parse(e)),e},an=["id","itemId","number","_Type_"];function ln(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function on(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ln(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):ln(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var cn=function(e,t){var n=(0,N.useContext)(D),a=n.getKdesignerApi,l=n.flowStatus,o=(0,N.useContext)(T.GlobalConfigContext).showMessage,c=(0,N.useMemo)((function(){return a()}),[]),u=c.data,d=c.selection,s=d.getSelection,p=d.setSelect,v=d.getActiveSelectedId;(0,N.useEffect)((function(){var t=e.current;if(t&&!ot(l)){var n=function(e){if(e.target===t){e.stopPropagation();var n=e.keyCode;switch(n){case T.keyCode.BACKSPACE:case T.keyCode.DELETE:var a,l=s()[0],m=u.findControl(l),y=u.findControl(null==m?void 0:m.parentId);if(m._Type_===L&&null!=m&&null!==(a=m.parentId)&&void 0!==a&&E()(a).call(a,W)){var h=u.getAllSiblings(l);if(i()(h).call(h,(function(e){return e._Type_===L})).length<=2&&!y.isNullNode)break}!function(e){var t=(0,e.selection.getSelection)();1===t.length&&Ve(t,e)}(c);break;case T.keyCode.Z:var b=u.canUndo();(0,T.isCtrlActive)(e)&&b&&u.undo();break;case T.keyCode.Y:var C=u.canRedo();(0,T.isCtrlActive)(e)&&C&&u.redo();break;case T.keyCode.LEFT:case T.keyCode.RIGHT:case T.keyCode.UP:case T.keyCode.DOWN:var N=v({dataContext:u,selectionContext:d}),I=n===T.keyCode.LEFT||n===T.keyCode.UP?u.getPrevSibling(N):u.getNextSibling(N),k=I&&I.control;k&&p([k[r.ID]]);break;case T.keyCode.C:if(e.preventDefault(),e.ctrlKey){null==e||e.stopPropagation();var x=s();Ue(x,c,o,nn)}break;case T.keyCode.V:if(e.preventDefault(),e.ctrlKey){var _=rn();if(Array.isArray(_)){var w=s();if(0===w.length){o("请先选择一个节点，再进行粘贴操作",1);break}if(1===w.length){var M=w[0],S=u.findControlIndex(M),A=u.getData().key,P=g()(_).call(_,(function(e){e.id,e.itemId,e.number;var t=e._Type_,n=(0,Q.c)(e,an);return ht(on(on({},n),{},(0,f.c)((0,f.c)((0,f.c)({},Gt,M),"rootKey",A),"type",t)))}));if(!P.length)return;var D=P[P.length-1].id,O=u.findControlByCondition((function(e){var t;return e[Gt]===M||(null===(t=e.parentIds)||void 0===t?void 0:E()(t).call(t,M))})),j=g()(O).call(O,(function(e){return _e(e)?[e.id,{parentIds:e.parentIds.replace(M,D)}]:[e.id,(0,f.c)({},Gt,D)]}));u.addControl((0,T.createPasteAction)(P,{index:S+1})).then((function(e){u.batchUpdateControlPropertyValues((0,T.createUpdateAction)(j),!1),p(D),o("粘贴成功",0)}))}}}}}};return t.addEventListener("keydown",n),function(){t.removeEventListener("keydown",n)}}}),[])},un=n(24244),dn=n.n(un),sn=n(58496),fn=(0,N.memo)((function(e){var t=e.displayData,n=void 0===t?{}:t,r=e.propertyData,a=void 0===r?{}:r,l=e.className,o=(0,N.useMemo)((function(){var e=a||{},t=e.Editor,r=e.Id,l=t.Enum,o=t.DataType,i=t.Default,c=(t.Type,n[r||""]||i);if("Boolean"===o)return void 0!==c?c?"是":"否":i?"是":"否";if(l&&(null==l?void 0:l.length)>0){var u=(null==c?void 0:c.split(","))||[],d=[];return l.forEach((function(e){E()(u).call(u,e.Id)&&d.push(e.Name)})),d.join("，")||c||"-"}return c||"-"}),[a,n]),i=a.Editor.SubTitle;if(a.Editor.ChildProperty&&Array.isArray(o)){var c,u={};return null===(c=a.Editor)||void 0===c||null===(c=c.ChildProperty)||void 0===c||c.forEach((function(e){var t=e.Number,n=e.Name;u[t]=n})),null==o?void 0:g()(o).call(o,(function(e){var t=C()(e);return I().createElement("div",{className:"".concat(l,"-display-viewitem")},I().createElement("span",{className:"title"},a.Name,i&&I().createElement("span",{className:"subTitle"},i)),g()(t).call(t,(function(t,n){return u[t]?I().createElement("div",{key:n,className:"".concat(l,"-display-viewitem")},I().createElement("span",{className:"title"},u[t]),I().createElement("span",{className:"content"},"object"===(0,sn.c)(e[t])?Zt()(e[t]):e[t])):null})))}))}return I().createElement("div",{className:"".concat(l,"-display-viewitem")},I().createElement("span",{className:"title"},a.Name,i&&I().createElement("span",{className:"subTitle"},i)),I().createElement("span",{className:"content"},"object"===(0,sn.c)(o)?Zt()(o):o))}));fn.displayName="DisplayViewItem";var pn=(0,T.ErrorBoundaryWrap)(fn,"DisplayViewItem"),vn=n(71252),mn=n.n(vn);function yn(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function gn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yn(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):yn(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var hn=["content","expression","filter","orderby","newSetting","setting","calcSetting","userSelect","judgefilter","varselect","multivarselect","combineselector","userInputPerm","decisionOptions","triggerTime","parameterSetting","requestBody","Switch"],En=["setting","decisionOptions","requestHeader","responseParams","requestBody","sourceData"],bn=(0,N.memo)((function(e){var t,n=e.controlData,r=e.isLoading,a=(0,N.useContext)(D),l=a.getPrefixCls,o=a.prefixCls,c=a.getKdesignerApi,u=(a.flowStatus,a.isReadonly),d=(0,N.useContext)(T.GlobalConfigContext).filterProperty,s=(0,N.useMemo)((function(){return c()}),[]),p=(0,N.useMemo)((function(){if(!n)return{};var e=gn({},n._disp_||{});return C()(n||{}).forEach((function(t){!e[t]&&n[t]&&(e[t]=n[t])})),e}),[n]);if(!n||r)return null;var v=s.meta,m=s.data,y=n._Type_,h=v.getDefaultData(y),b=v.getControlMeta(y);if(b.Properties){var k,x,w,M,S=m.getData(),A=(0,T.getModelData)(b.Properties,gn(gn({},S),{},{field:gn(gn({},h),n)})),P=dn()((k=A,x=function(e){return!d(e)},w=function(e){var t,n,r;return!(0==(null==e||null===(t=e.Nodes)||void 0===t?void 0:t.length)||(null==e||null===(n=e.Nodes)||void 0===n?void 0:n.every((function(e){return!1===(null==e?void 0:e.Visible)})))||u&&E()(r=["NCPG_ApiTest"]).call(r,e.Key))},t=g()(M=i()(k).call(k,w)).call(M,(function(e){var t=e.Nodes,n=i()(t).call(t,(function(e){return!1!==e.Visible&&x(e)}));return gn(gn({},e),{},{Nodes:n})})))).call(t,(function(e,t){return void 0===e.Seq?-1:void 0===t.Seq?1:e.Seq-t.Seq})),O=l(o,"property-view");return I().createElement("div",{className:mn()(O,(0,f.c)({},"".concat(O,"-display"),u))},null==P?void 0:g()(P).call(P,(function(e){var t=e.Nodes,r=e.Id,a=e.Name,l=e._Type_;return I().createElement("div",{key:r,className:"".concat(O,"-group")},"PropertyGroup"===l&&I().createElement("div",{className:"".concat(O,"-group-title")},a),g()(t).call(t,(function(e){if(u){var t=(null==e?void 0:e.Editor)||{},r=t.Type,a=t.Default;if(!E()(hn).call(hn,r)||void 0===p[e.Id]&&"undefined"===a)return I().createElement(pn,{className:"kdesigner-right-view",displayData:p,propertyData:e})}return I().createElement(T.PropertyViewItem,(0,_.c)({},e,{key:e.Id,field:n,className:"kdesigner-right-view",enableMutiSelect:!1,readonly:u,renderCustomError:function(e){if(E()(En).call(En,e.prop))return!0}}))})))})))}}));bn.displayName="PropertyView";var Cn=bn;function Nn(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function In(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nn(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Nn(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Tn=(0,f.c)((0,f.c)((0,f.c)({},F,{desc:"查找结果",establish:"查找有结果",notEstablished:"查找无结果"}),U,{desc:"审批结果",establish:"审批通过",notEstablished:"审批否决"}),$,{desc:"响应状态"}),kn=function(e,t){return{_Type_:"FilterItem",compareType:"1001",value:Zt()(t),fieldName:e}},xn=(0,N.memo)((function(e){var t=e.Id,n=e.Name,r=e.className,a=(e.activedSelectId,e.Tips),l=e.Visible,o=void 0===l||l,i=e.parentId,c=e.rootKey,u=e.childId,d=(0,N.useState)(!1),s=(0,p.c)(d,2),f=s[0],v=s[1],y=(0,N.useContext)(D),h=y.getKdesignerApi,b=y.getControlIconMap,k=y.getNodeVariablesById,w=y.webMsg,S=y.getControlText,A=(0,N.useContext)(T.GlobalConfigContext).getOutlineItemIcon,P=(0,N.useMemo)((function(){return h()}),[]),O=P.data,j=P.selection,B=P.dataFactory,R=(0,N.useMemo)((function(){return O.findControl(i)}),[i]),F=function(e){var r=B({type:t,parentId:i,name:n}),a=(0,T.createAddAction)((0,_.c)(r,In({rootKey:c,childId:u},e)));O.addControl(a).then((function(e){if(e[0]){var t=e[0].value;if(xe(t)){var n=e[1].value;j.setSelect([null==n?void 0:n.id])}else j.setSelect(Array.isArray(t)?[t[0].id]:[t.id])}}))},V=(0,N.useCallback)((function(e){var t=k(e)||[];return M()(t).call(t,(function(e){var t;return null==e||null===(t=e.option)||void 0===t?void 0:t.isResult}))||{option:{}}}),[k]),q=(0,N.useCallback)((function(e){for(var t=[],n=V(e),r=n.option.valueItems,a=void 0===r?[]:r,l=0;l<a.length;l++){var o=a[l],i=o.name,c=o.value;t.push({name:"string"==typeof i?i:S(i),filter:[kn(n.value,[{fieldValue:c}])]})}return t}),[V]),K=function(e){var t,n=R.name,r=R._Type_,a=(R.id,Tn[r]||{});null==w||w.showConfirmModal({title:m()(t="是否添加【".concat(n||"","】")).call(t,a.desc||"","为判断条件？"),content:"分支条件默认配置为".concat(g()(e).call(e,(function(e){return e.name})).join("、"),"；"),actions:[{text:"不添加",key:"cancel"},{text:"添加",key:"confirm"}],onAction:function(t){return function(e,t){"confirm"===e?F({childActions:t}):"cancel"===e&&F()}(t,e)},type:"prompt"})},U=(0,N.useCallback)((function(e){v(e)}),[]);if(!o)return null;var H=I().createElement("div",{className:"".concat(r,"-control-main"),onClick:function(){if(xe({_Type_:t})){var e;if(!R)return;var n=null==R?void 0:R[Ht],r=q(R.id);if(E()(e=C()(Tn)).call(e,n)&&(null==r?void 0:r.length)>0)return void K(r)}F()}},I().createElement("div",{className:"icon",style:{backgroundColor:b(t).bgc}},A(t)),I().createElement("span",{className:"title"},n));return I().createElement("div",{className:"".concat(r,"-control")},a?I().createElement(x.Tooltip,{placement:"right",tip:a||"",visible:f,onVisibleChange:U},H):H)}));xn.displayName="ControlViewItem";var _n=function(e){var t=e.Categories,n=e.Controls;return g()(t).call(t,(function(e){var t=e.Id,r=i()(n).call(n,(function(e){return e.CategoryId===t&&!e.Hidden}));return In(In({},e),{},{Controls:r})}))},wn=(0,N.memo)((function(e){var t=e.controlData,n=e.parentId,r=e.childId,a=(0,N.useContext)(D),l=a.getPrefixCls,o=a.prefixCls,i=a.getKdesignerApi,c=(0,N.useMemo)((function(){return i()}),[]),u=c.meta,d=c.data.getData(),s=u.getMeta(),f=(0,N.useState)((function(){return _n(s)})),v=(0,p.c)(f,2),m=v[0],y=v[1],h=l(o,"control-view");return(0,N.useEffect)((function(){y((function(){return _n(s)}))}),[s]),I().createElement("div",{className:h},g()(m).call(m,(function(e,a){var l;return!1===e.Visible?null:I().createElement("div",{key:a,className:"".concat(h,"-container")},I().createElement("div",{key:a,className:"".concat(h,"-container-header")},e.Name),I().createElement("div",{className:"".concat(h,"-container-content")},g()(l=(null==e?void 0:e.Controls)||[]).call(l,(function(e){return I().createElement(xn,(0,_.c)({key:e.Id,rootKey:d.key,className:"".concat(h,"-container-content")},e,{parentId:n,childId:r,activedSelectId:t.id}))}))))})))}));wn.displayName="ControlView";var Mn=wn,Sn="clickAddNode",An="setRightPanel",Pn="setRefBillTreeData",Dn="setTreeNodeChildren",On="setTestApi",jn="setNoCodeIpList",Bn=(0,N.memo)((function(e){var t=e.prefixCls,n=e.isLoading,r=(0,N.useRef)(),a=(0,N.useContext)(D),l=a.getKdesignerApi,o=a.getControlIconMap,i=(0,N.useContext)(T.GlobalConfigContext).getOutlineItemIcon,c=(0,N.useState)(!1),u=(0,p.c)(c,2),d=u[0],s=u[1],v=(0,N.useState)(""),m=(0,p.c)(v,2),y=m[0],g=m[1],h=(0,N.useState)(!1),E=(0,p.c)(h,2),b=E[0],C=E[1],k=(0,N.useState)({}),w=(0,p.c)(k,2),M=w[0],S=w[1],A=(0,N.useState)(0),P=(0,p.c)(A,2),O=(P[0],P[1]),j=(0,N.useMemo)((function(){return l()}),[]),B=j.data,R=j.meta,F=j.selection,V=(B.getData(),B.getRootId()),q=B.findControl(y)||{},K=q._Type_,U=(0,N.useMemo)((function(){return R.getMeta()[Lt]}),[]),H=(0,N.useCallback)((function(e){S(e),C(!0),s(!0)}),[]),W=function(e){s(e.visible)};(0,N.useEffect)((function(){return T.eventBus.on(Sn,H),T.eventBus.on(An,W),function(){T.eventBus.off(Sn,H),T.eventBus.off(An,W)}}),[]);var L=(0,N.useCallback)((function(e){O((function(e){return e+1}))}),[]),z=(0,N.useCallback)((function(e){var t=e.value,n=(e.oldValue,t[0]);n&&n!==V&&C(!1),s(!!n),g(n)}),[]);(0,N.useEffect)((function(){var e=F.addSelectChangeListener(z),t=B.addDataChangeListener(L);return function(){null==e||e(),null==t||t()}}),[z]);var J=(0,N.useCallback)((function(){null==s||s(!1),F.setSelect([])}),[]),G=(0,N.useMemo)((function(){var e=(R.getControlMeta(K)||{}).Name;return gt(null==q?void 0:q.triggerMode)?"定时触发":e}),[K,null==q?void 0:q.triggerMode]),$=(0,N.useMemo)((function(){var e=!G;return I().createElement("div",{className:mn()("".concat(t,"_header"),(0,f.c)({},"".concat(t,"_header_add"),e)),style:{backgroundColor:o(K).bgc}},I().createElement("div",{className:"".concat(t,"_header_title")},e?I().createElement("span",{className:"addname"},"添加节点"):I().createElement(I().Fragment,null,I().createElement("span",{className:"".concat(t,"_header_title_icon")},i(K)),I().createElement("span",{className:"name"},G))),I().createElement(x.Icon,{className:"close",type:"close",onClick:J}))}),[q,U,K,G]);return I().createElement(x.Drawer,{ref:r,className:t,placement:"right",visible:d,onClose:function(){return null==s?void 0:s(!1)},mask:!1,title:$,width:640,closable:!1},b?I().createElement(Mn,(0,_.c)({controlData:q},M)):I().createElement(Cn,{isLoading:n,controlData:q}))}));Bn.displayName="RightPanel";var Rn=Bn,Fn=function(e){(0,N.useContext)(O).sendSyncData;var t=(0,N.useContext)(D),n=t.getKdesignerApi,r=(t.flowStatus,(0,N.useMemo)((function(){return n()}),[]).selection.setSelect);return(0,N.useCallback)((function(t){t.stopPropagation(),r([e])}),[])},Vn=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=(0,N.useRef)({fn:e,timer:null}).current;return(0,N.useEffect)((function(){r.fn=e}),[e]),(0,N.useCallback)((function(){if(!r.timer){var e,n;r.timer=setTimeout((function(){delete r.timer}),t);for(var a=arguments.length,l=new Array(a),o=0;o<a;o++)l[o]=arguments[o];(e=r.fn).call.apply(e,m()(n=[this]).call(n,l))}}),n)},qn=null,Kn=null,Un=function(e,t,n){var r=(0,N.useContext)(D),a=r.getKdesignerApi,l=r.flowStatus,o=(0,N.useRef)(document.querySelector("#".concat(de))),i=(0,S.o3)(),c=((0,S.CG)((function(e){return e.transform})),(0,S._s)()),u=Vn((function(e){var t=i.getState(),n=t.transform,r=(t.height,t.translateExtent,(0,p.c)(n,3)),a=r[0],l=r[1],u=r[2];if(e.clientY<100&&l<0){if(0===e.clientY)return;c.transform({x:a,y:l+200>0?0:l+200,zoom:u},300)}else if(o.current){var d,s=(null===(d=o.current)||void 0===d?void 0:d.getBoundingClientRect()).height;if(e.clientY<s&&e.clientY>s-100){var f=document.querySelector("#".concat(se));if(f){var v=f.getBoundingClientRect().top;if(v>s){var m=v-l-200>s?l-200:s-v;c.transform({x:a,y:m,zoom:u},300)}}}}}),300,[]),d=(0,ce.throttle)((function(t){t.preventDefault(),function(e){Kn=e}(e)}),200);return{dragEvent:{onDrag:u,onDragStart:function(n){!function(e){qn=e}(e),t&&t(n)},draggable:!ot(l)},dropEvent:{onDragOver:function(e){e.preventDefault(),e.persist(),d(e)},onDrop:function(e){var t,r;e.preventDefault(),r=Kn,(t=qn)&&r&&r!==t&&a().data.customUpdateState((0,T.createCustomUpdateAction)((function(e){for(var n=e.Items,a=null,l=null,o=null,i=null,c=null,u=0;u<n.length;u++){var d;if(a&&o&&c)break;var s=n[u];s.id===t?(a=s,l=u):s.id===r&&(o=s,i=u),(_e(s)&&null!==(d=s.parentIds)&&void 0!==d&&E()(d).call(d,r)||s.parentId===r)&&(c=s)}if(a.parentId!==r){var f,p,v=M()(n).call(n,(function(e){var n;return _e(e)?null===(n=e.parentIds)||void 0===n?void 0:E()(n).call(n,t):e.parentId===t}));v&&(_e(v)?v.parentIds=null===(f=v.parentIds)||void 0===f?void 0:f.replace(t,a.parentId):v.parentId=a.parentId),a.parentId=r,c&&(_e(c)?c.parentIds=null===(p=c.parentIds)||void 0===p?void 0:p.replace(r,t):c.parentId=t),l>i?(te()(n).call(n,l,1),te()(n).call(n,i+1,0,a)):(te()(n).call(n,i+1,0,a),te()(n).call(n,l,1))}}))),n&&n(e)}}}},Hn=function(e){var t=(0,N.useState)(!1),n=(0,p.c)(t,2),r=n[0],a=n[1],l=(0,N.useContext)(D).getKdesignerApi,o=(0,N.useMemo)((function(){return l()}),[]).selection,i=(0,N.useCallback)((function(t){var n=t.value,r=null==n?void 0:E()(n).call(n,e);a(r)}),[e]);return(0,N.useEffect)((function(){var t=o.getSelection(),n=null==t?void 0:E()(t).call(t,e);a(n);var r=o.addSelectChangeListener(i);return function(){r()}}),[]),r};function Wn(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wn(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Wn(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var zn=function(e,t){var n,r=(0,N.useContext)(D),a=r.getPrefixCls,l=r.prefixCls,o=r.getKdesignerApi,i=r.flowStatus,c=a&&a(l,t||"controls"),u=(o().data.findControl(e)||{}).handleStatus,d=void 0===u?me:u,s=Un(e),p=Fn(e),v=Hn(e),y=mn()("".concat(c),(0,f.c)({"node-selection":v},m()(n="".concat(c,"_")).call(n,d||me),ot(i)));return e?Ln(Ln({},s),{},(0,f.c)({isSelected:v,onClick:p,prefixClass:c,className:y},"data-node-id",e)):{}},Jn=function(e,t){var n=(0,N.useContext)(D).getKdesignerApi,r=(0,N.useMemo)((function(){return n()}),[]).meta,a=(0,N.useMemo)((function(){return r.getControlMetaEditor(e,t)}),[e,t]),l=(0,N.useMemo)((function(){return(null==a?void 0:a.Enum)||[]}),[a]);return(0,N.useCallback)((function(e){var t;void 0===e&&(e=a.Default||"");var n=(null===(t=e)||void 0===t?void 0:t.split(","))||[],r=[];return l.forEach((function(e){E()(n).call(n,e.Id)&&r.push(e.Name)})),r.join("，")}),[l])},Gn=[{key:"copy",name:"复制"},{key:"delete",name:"删除"}],$n=function(e){var t=e.data,n=e.close,r=e.onClick,a=e.panelRef,l=e.prefixCls,o=(0,N.useCallback)((function(e,t){e.stopPropagation(),null==r||r(t),null==n||n()}),[n,r]);return I().createElement("div",{className:l+"-list",ref:a},t&&(null==t?void 0:g()(t).call(t,(function(e,t){return I().createElement("div",{key:t,className:l+"-list-item",onClick:function(t){return o(t,e)}},e.name)}))))},Yn=(0,N.memo)((function(e){var t=e.prefix,n=e.id,r=(0,N.useContext)(D).getKdesignerApi,a=(0,N.useContext)(T.GlobalConfigContext).showMessage,l=(0,N.useMemo)((function(){return r()}),[]),o=(0,N.useState)(!1),i=(0,p.c)(o,2),c=i[0],u=i[1],d=((0,N.useRef)(null),(0,N.useRef)(null)),s=function(){u(!1)};(0,N.useEffect)((function(){return T.eventBus.on(An,s),function(){T.eventBus.off(An,s)}}),[]);var f=(0,N.useCallback)((function(){u(!1)}),[]);(0,T.useOnClickOutside)([d],(function(){f()}));var v=function(e){switch(e.key){case"delete":Ve([n],l);break;case"copy":Ue([n],l,a,nn)}u(!1)};(0,N.useMemo)((function(){return I().createElement(x.Dropdown.Menu,null,g()(Gn).call(Gn,(function(e){var t=e.key,n=e.name;return I().createElement(x.Dropdown.Item,{key:t,onClick:function(e){return v(e)}},n)})))}),[]);return I().createElement("div",{className:"".concat(t,"_header_more"),onClick:function(e){e.stopPropagation(),u(!c)}},I().createElement(x.Icon,{title:"点击更多操作：删除等",className:"".concat(t,"_header_more_icon"),prefix:"designericon",type:"gengduo3"}),c&&I().createElement($n,{prefixCls:"".concat(t,"_header_more"),data:Gn,panelRef:d,onClose:f,onClick:v}))}));Yn.displayName="MoreHandle";var Qn=Yn,Xn=(0,N.memo)((function(e){var t=e.className,n=e.name,r=e.id,a=e.prefix,l=e.showMoreBtn,o=void 0===l||l,i=e._Type_,c=(0,N.useContext)(D),u=c.getPrefixCls,d=c.prefixCls,s=c.flowStatus,f=c.getControlIconMap,p=(0,N.useContext)(T.GlobalConfigContext).getOutlineItemIcon,v=u&&u(d,"controls"),m=mn()("".concat(a||v,"_header"),t),y=(0,N.useMemo)((function(){return f(i).bgc}),[i]);return I().createElement("div",{className:m,style:{backgroundColor:y}},I().createElement("div",{className:"".concat(v,"_header_title"),title:n},I().createElement("span",{className:"".concat(v,"_header_title_icon")},p(i)),I().createElement("span",{className:"name"},n)),!ot(s)&&o&&I().createElement(Qn,{prefix:v,id:r}))}));Xn.displayName="NodeHeader";var Zn=Xn,er=(0,N.memo)((function(e){var t=e.children,n=e.id,r=(0,N.useContext)(D).getKdesignerApi,a=(0,N.useMemo)((function(){return r()}),[]).error,l=a.getError(),o=(0,N.useState)(l[n]||{}),i=(0,p.c)(o,2),c=i[0],u=i[1],d=(0,N.useState)(!1),s=(0,p.c)(d,2),f=(s[0],s[1]),v=(0,N.useRef)(null),m=(0,N.useRef)(!1),y=function(e){var t=a.getError(n)||{};u(t)};(0,N.useEffect)((function(){var e=a.addErrorChangeListener(y);return function(){e()}}),[]);(0,N.useEffect)((function(){}),[]);var g=(0,N.useMemo)((function(){var e=0;return C()(c).forEach((function(t){var n=c[t];n&&("string"==typeof n.msg?e+=1:C()((null==n?void 0:n.msg)||{}).forEach((function(t){var r=n.msg[t];e+=null==r?void 0:r.length})))})),e}),[c]),h=(0,N.useMemo)((function(){return"存在有".concat(g,"条错误，请修复后再发布！")}),[g]);if(0===g)return t;var E=mn()({"node-error":!!c});return I().createElement("div",{className:E},I().createElement("div",{className:"node-error-tips",onMouseEnter:function(){f(!0)},onMouseLeave:function(){setTimeout((function(){m.current||f(!1)}),1e3)}},I().createElement("div",{className:"node-error-tips-panel"},I().createElement("div",{ref:v,className:mn()("node-error-tips-panel-content")},I().createElement("span",null,h)),I().createElement("div",{className:"node-error-tips-panel-hot"})),I().createElement("div",{className:"node-error-tips-icon"},g)),t)}));er.displayName="ErrorNodeWrap";var tr=er,nr=n(31848),rr=n.n(nr),ar=function(e){return e<10?"0"+e:e},lr=[4,6,9,11],or=function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:31;return g()(e=rr()(t=new Array(n)).call(t,"")).call(e,(function(e,t){var n,a,l=t+1,o={key:l,title:"".concat(l,"月"),selectable:!1};return r=E()(lr).call(lr,l)?30:31,o.children=g()(n=rr()(a=new Array(2===l?29:r)).call(a,"")).call(n,(function(e,t){return function(e,t){var n,r,a=t+1;return{key:m()(n="".concat(ar(e),"-")).call(n,ar(a)),title:m()(r="".concat(e,"月")).call(r,a,"号")}}(l,t)})),o}))},ir=function(e){return"week"===e?(t=["一","二","三","四","五","六","日"],g()(t).call(t,(function(e,t){return{label:"周".concat(e),value:(t+1)%7+1+""}}))):"month"===e?function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:31;return g()(e=rr()(t=new Array(n)).call(t,"")).call(e,(function(e,t){return{label:"".concat(t+1,"号"),value:t+1+""}}))}():"year"===e?or():[];var t},cr={},ur=function(e){return cr[e]||(cr[e]=ir(e)),cr[e]},dr=function(e){var t,n=new Date;if(!e)return n;var r=g()(t=e.split(":")).call(t,Number),a=(0,p.c)(r,3),l=a[0],o=a[1],i=a[2];return n.setHours(l,o,i),n},sr={},fr=function(e,t){if("day"===e)return"";if(!sr[e]){var n=ur(e);sr[e]={},"year"===e?n.forEach((function(t){var n;null==t||null===(n=t.children)||void 0===n||n.forEach((function(t){sr[e][t.key]=t.title}))})):n.forEach((function(t){sr[e][t.value]=t.label}))}var r=sr[e];return t.reduce((function(e,t){var n,a;return m()(n=m()(a="".concat(e)).call(a,e?"、":"")).call(n,r[t]||"")}),"")},pr=["prefixClass"];function vr(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function mr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vr(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):vr(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var yr=/^\S+/,gr=function(e){var t;return null==e||null===(t=e.match(yr))||void 0===t?void 0:t[0]},hr=(0,T.ErrorBoundaryWrap)((function(e){var t,n=e.data,r=e.id,a=(0,(0,N.useContext)(D).getKdesignerApi)(),l=a.data,o=a.meta,i=zn(r),c=i.prefixClass,u=(0,Q.c)(i,pr),d=Jn(n._Type_,"fireKind"),s=Jn(n._Type_,"loopType"),f=mr(mr({},n),n._disp_),p=n.loopType,v=n.triggerTime,y=n.triggerMode,g=n.fireKind,h=n.startTime,E=n.endTime,b=gt(y),C=(0,N.useMemo)((function(){if(b)return fr(p,(null==v?void 0:v.date)||[])}),[b,p,v]);(0,N.useEffect)((function(){var e=n.name,t=o.getControlMeta(n._Type_).Name;e!==t&&"定时触发"!==e||(e=b?"定时触发":t,l.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[r,{name:e}]])))}),[b]);var k=m()(t="".concat(C," ")).call(t,null==v?void 0:v.time),x=gr(h),w=gr(E),M=d(g);return I().createElement(tr,{id:r},I().createElement("div",u,I().createElement(Zn,(0,_.c)({showMoreBtn:!1,prefix:c},n)),I().createElement("div",{className:"".concat(c,"_content")},b?I().createElement(I().Fragment,null,I().createElement("div",{title:x},I().createElement("span",null,"开始时间："),x),I().createElement("div",{title:w},I().createElement("span",null,"结束时间："),w),I().createElement("div",null,I().createElement("span",null,"循环："),s(p)),I().createElement("div",{title:k},I().createElement("span",null,"触发时间："),k)):I().createElement(I().Fragment,null,I().createElement("div",{title:f.formId},I().createElement("span",null,"触发表单："),f.formId),I().createElement("div",{title:M},I().createElement("span",null,"触发类型："),M))),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:"b"})))}),"StartSignalEvent"),Er=["dragEvent","prefixClass"];function br(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?br(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):br(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Nr=function(e){return"$assignment"===e},Ir=function(e,t){var n;return t?Nr(null==t?void 0:t.assignment)&&null!=t&&t.customVarName?null==t?void 0:t.customVarName:(null==t||null===(n=t._disp_)||void 0===n?void 0:n.assignment)||e:e},Tr=(0,T.ErrorBoundaryWrap)((function(e){var t=e.data,n=e.id,r=(e.selected,zn(n)),a=r.dragEvent,l=r.prefixClass,o=(0,Q.c)(r,Er),i=Jn(t._Type_,"customVarType"),c=Cr(Cr({},t),t._disp_||{}),u=(0,N.useMemo)((function(){var e;return null===(e=c.setting)||void 0===e?void 0:e.length}),[c]),d=(0,N.useMemo)((function(){var e,n,r;return u>1?"":Nr(null===(e=t.setting)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.assignment)?null===(n=t.setting)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.customVarName:null===(r=c.setting)||void 0===r||null===(r=r[0])||void 0===r?void 0:r.assignment}),[u,t,c]);return I().createElement(tr,{id:n},I().createElement("div",(0,_.c)({},a,o),I().createElement(S._2,{type:"target",position:S.JC.Top,id:n+"t"}),I().createElement(Zn,(0,_.c)({prefix:l},t)),I().createElement("div",{className:"".concat(l,"_content")},u>1?I().createElement("div",null,I().createElement("span",null,"运算："),u,"个"):I().createElement("div",{title:d},I().createElement("span",null,"赋值对象："),d),Nr(t.assignment)&&I().createElement("div",null,I().createElement("span",null,"对象类型："),i(t.customVarType)),I().createElement("div",{className:"".concat(l,"_content_des"),title:t.documentation||""},t.documentation||"")),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:n+"b"})))}),"flow-math-node"),kr=["dragEvent","prefixClass"],xr=function(e,t){var n=(e||{}).sourceData,r=null==n?void 0:g()(n).call(n,(function(e){var n=t.findControl(e.menuId);return n?e.name.replace(/\S+（/,"[".concat(n.name,"（")).replace(/\S+\]/,"[".concat(n.name,"]")):e.name}));return(null==r?void 0:r.join(","))||""},_r=(0,T.ErrorBoundaryWrap)((function(e){var t=e.data,n=e.id,r=zn(n),a=r.dragEvent,l=r.prefixClass,o=(0,Q.c)(r,kr),i=(0,N.useContext)(D).getKdesignerApi,c=(0,N.useMemo)((function(){return i()}),[]).data,u=t.documentation,d=void 0===u?"":u,s=(0,N.useMemo)((function(){return xr(t.participant,c)}),[t]);return I().createElement(tr,{id:n},I().createElement("div",(0,_.c)({},a,o),I().createElement(S._2,{type:"target",position:S.JC.Top,id:n+"t"}),I().createElement(Zn,(0,_.c)({prefix:l},t)),I().createElement("div",{className:"".concat(l,"_content")},I().createElement("div",{title:s},I().createElement("span",null,"审批人："),s),I().createElement("div",{title:d,className:"".concat(l,"_content_des")},d)),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:n+"b"})))}),"flow-action-node"),wr=["dragEvent","prefixClass"];function Mr(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Sr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mr(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Mr(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Ar=(0,T.ErrorBoundaryWrap)((function(e){var t=e.data,n=e.id,r=zn(n),a=r.dragEvent,l=r.prefixClass,o=(0,Q.c)(r,wr),i=Jn(t._Type_,"notifytype"),c=(0,N.useContext)(D).getKdesignerApi,u=(0,N.useMemo)((function(){return c()}),[]).data,d=(Sr(Sr({},t),t._disp_||{}),xr(t.receiver,u));return I().createElement(tr,{id:n},I().createElement("div",(0,_.c)({},a,o),I().createElement(S._2,{type:"target",position:S.JC.Top,id:n+"t"}),I().createElement(Zn,(0,_.c)({prefix:l},t)),I().createElement("div",{className:"".concat(l,"_content")},I().createElement("div",null,I().createElement("span",null,"消息类型："),i(t.notifytype)),I().createElement("div",{title:d},I().createElement("span",null,"通知对象："),xr(t.receiver,u)),I().createElement("div",{className:"".concat(l,"_content_des"),title:t.documentation||""},t.documentation||"")),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:n+"b"})))}),"flow-message-node"),Pr=["dragEvent","prefixClass"],Dr=(0,T.ErrorBoundaryWrap)((function(e){var t,n,r=e.data,a=e.id,l=zn(a),o=l.dragEvent,c=l.prefixClass,u=(0,Q.c)(l,Pr),d=(0,N.useContext)(D).getKdesignerApi,s=(0,N.useMemo)((function(){return d()}),[]).data,f=i()(t=s.getSubControls(r.parentId)).call(t,(function(e){return e._Type_===L})),p=(0,N.useMemo)((function(){return s.findControl(r.parentId)||{}}),[r.parentId]),v=(0,N.useMemo)((function(){return xe(p)}),[p]),m=(0,N.useMemo)((function(){return!v||f.length>2}),[f,v]);return I().createElement(tr,{id:a},I().createElement("div",(0,_.c)({},v?{}:o,u),I().createElement(S._2,{type:"target",position:S.JC.Top,id:a+"t"}),I().createElement(Zn,(0,_.c)({prefix:c,showMoreBtn:m},r)),I().createElement("div",{className:"".concat(c,"_content")},I().createElement("div",null,I().createElement("span",null,"判断条件："),(null==r||null===(n=i()(r))||void 0===n?void 0:n.length)||0,"项"),I().createElement("div",{className:"".concat(c,"_content_des")},r.documentation||"")),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:a+"b"})))}),"flow-branch-node"),Or=(0,T.ErrorBoundaryWrap)((function(e){var t,n=e.data,r=e.id,a=(e.selected,(0,N.useContext)(D)),l=a.getPrefixCls,o=a.prefixCls,c=a.getKdesignerApi,u=a.flowStatus,d=(0,N.useMemo)((function(){return c()}),[]),s=d.data,f=d.selection,p=d.dataFactory,v=l&&l(o,"controls-node"),y=ot(u),g=(0,N.useCallback)((function(){var e=s.getData(),t=s.getSubControls(r),n=i()(t).call(t,(function(e){return e.isNullNode}))[0],a=p({type:L,parentId:r});s.addControl((0,T.createAddAction)((0,_.c)(a,{rootKey:e.key,childId:n.id,name:"判断分支"}))).then((function(e){if(e[0]){var t=e[0].value;if("NoCodeGateway"===t._Type_){var n=e[1].value;f.setSelect([null==n?void 0:n.id])}else f.setSelect(Array.isArray(t)?[t[0].id]:[t.id])}}))}),[r,n,p,s,f]),h=(0,N.useCallback)((function(){for(var e=s.getSubControls(r)||[],t=[r],n=0;n<e.length;n++){var a=e[n].id;a&&t.push(a)}null==Ve||Ve(t,d)}),[r,d,s,Ve]),E=(0,N.useCallback)((function(){var e=n.leaveMode,t=void 0===e?"parallel":e;t="parallel"===t?"exclusion":"parallel";var a=[],l=s.getSubControls(r),o=0;l.forEach((function(e){e._Type_===L&&(o++,a.push([e.id,{seq:o}]))})),a.push([r,{leaveMode:t}]),s.batchUpdateControlPropertyValues((0,T.createUpdateAction)(a))}),[n,r,T.createUpdateAction,s]),b="exclusion"===(null==n?void 0:n.leaveMode),C=["兼容","唯一"],k=m()(t="切换为".concat(C[Number(!b)],"分支：")).call(t,["满足条件的分支依次执行","从左到右，只执行第一个满足条件"][Number(!b)]);return I().createElement("div",{className:"".concat(v,"-branch-start")},I().createElement(S._2,{type:"target",position:S.JC.Top}),I().createElement("div",{className:"diamond"},I().createElement("p",null)),y?I().createElement("div",{className:"change_readonly"},I().createElement("span",null,C[Number(b)])):I().createElement(I().Fragment,null,I().createElement("div",{className:"change",title:k,onClick:E},I().createElement(x.Icon,{type:"qiehuan",prefix:"nocodeplatformicon"}),I().createElement("span",null,C[Number(b)])),I().createElement("div",{className:"add",title:"添加新的分支",onClick:g},I().createElement(x.Icon,{type:"zengjia-yuan",prefix:"ncicon"})),I().createElement("div",{className:"delete",title:"删除当前分支",onClick:h},I().createElement(x.Icon,{type:"shanchu2",prefix:"nocodeplatformicon"}))),I().createElement(S._2,{type:"source",position:S.JC.Left}),I().createElement(S._2,{type:"source",position:S.JC.Right}))}),"flow-branch-node"),jr=(0,T.ErrorBoundaryWrap)((function(e){e.data,e.id,e.selected;return I().createElement("div",null,I().createElement(S._2,{type:"target",position:S.JC.Left,id:"111"}),I().createElement(S._2,{type:"target",position:S.JC.Right,id:"222"}),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:"333"}),I().createElement("div",{style:{width:2,height:1,backgroundColor:"#d9d9d9"}}))}),"flow-branch-node"),Br=(0,T.ErrorBoundaryWrap)((function(e){var t,n,r=e.data,a=(e.id,(0,N.useContext)(D)),l=a.getPrefixCls,o=a.prefixCls,i=l&&l(o,"controls-end-node");null===(t=r.size)||void 0===t||t.width,null===(n=r.size)||void 0===n||n.height;return I().createElement("div",{className:i,id:se},I().createElement("span",null,"结束"),I().createElement(S._2,{type:"target",position:S.JC.Top,id:"a"}))}),"flow-end-node");function Rr(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rr(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Rr(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Vr=[B,F,V],qr=[$],Kr=function(e,t,n){return It.some((function(e){return e.test(t)}))&&(t=n(e,t)),!!Ee.some((function(e){var n;return null===(n=t)||void 0===n?void 0:E()(n).call(n,e)}))},Ur=(0,N.memo)((function(e){var t=(0,N.useContext)(D),n=t.getKdesignerApi,r=t.getRefBillVarFormId,a=e.handleChange,l=e.value,o=e.className,i=e.editor,c=(e.locked,e.Name),u=e.propName,d=e.Tips,s=e.field,p=(e.id,e.readonly),v=i.NameHidden,m=i.Required,y=i.Title,g=s.id,h=s._disp_,b=s._Type_,C=n().data.getData(),k=(0,N.useMemo)((function(){return it(g,C[Jt])}),[g,C]),_=(0,N.useMemo)((function(){var e=C[Jt];if(Array.isArray(e)&&null!=e&&e.length){for(var t=[],n=0,o=e.length;n<o;n++){var i=e[n],c=i[Ht],u=i.id,d=i.formId,s=i.refbillField,f=(i.name,i._disp_,i.parentId,i.apiId),p=i.queryModel;if(E()(k).call(k,u)){var v=d||s;if(je(c)&&kt(p)){if(Ae(b)||Oe(b)||Pe(b))continue;v=f}if((Ae(b)||je(b)||Oe(b)||Pe(b))&&c===$)continue;if(E()(Vr).call(Vr,c)&&v||E()(qr).call(qr,c)){if(Oe(b)||Ae(b))if(Kr(u,v,r)){l===u&&a("");continue}t.push({key:u,title:dt(e[n])})}}}return t}return[]}),[C[Jt],g,k]);return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:v,className:o,name:c,tips:d,required:m,title:y}),I().createElement(ze.KDTreeSelect,{value:l,disabled:p,allowClear:!0,onChange:function(e,t){var n;a(e||"",{_disp_:Fr(Fr({},h),{},(0,f.c)({},u,(null==t||null===(n=t[0])||void 0===n?void 0:n.label)||""))})},treeData:_,treeDefaultExpandAll:!0,showFullLabelTips:!0,suffixIcon:I().createElement(x.Icon,{prefix:"designericon",type:"duixiangxuanze2"})}))}));Ur.displayName="NodeBillTypeEditor";var Hr=(0,T.ErrorBoundaryWrap)(Ur,"NodeBillTypeEditor"),Wr=function(e){var t=(0,N.useContext)(D),n=t.getKdesignerApi,r=t.getRefBillVarFormId,a=(0,N.useMemo)((function(){return n()}),[]).data,l=e.id,o=e.refNodeId;(0,N.useEffect)((function(){var e=a.findControl(o);if(e){var t=e[Ht],n=e.id,i=e.formId,c=e.refbillField,u=e.apiId,d=e.queryModel,s=i||c;if(je(t)&&kt(d)&&(s=u),Kr(n,s,r)){var f=[[l,{refNodeId:void 0}]];a.batchUpdateControlPropertyValues((0,T.createUpdateAction)(f))}}}),[])},Lr=["dragEvent","prefixClass"],zr=(0,T.ErrorBoundaryWrap)((function(e){var t=e.data,n=e.id,r=zn(n),a=r.dragEvent,l=r.prefixClass,o=(0,Q.c)(r,Lr),i=(0,N.useContext)(D).getKdesignerApi,c=(0,N.useMemo)((function(){return i()}),[]).data,u=(0,N.useMemo)((function(){var e;if(!t.refNodeId)return"";var n=(null==t||null===(e=t._disp_)||void 0===e?void 0:e.refNodeId)||"",r=c.findControl(t.refNodeId);if(r){var a,l,o=r.queryModel,i={byapi:"apiId",byrela:"refbillField",byfilter:"formId"},u=(null==i?void 0:i[o])||"formId";return m()(a="".concat(r.name,"（")).call(a,(null===(l=r._disp_)||void 0===l?void 0:l[u])||"","）")}return n}),[t]);Wr(t);var d=xr(t.inputUser,c);return I().createElement(tr,{id:n},I().createElement("div",(0,_.c)({},a,o),I().createElement(S._2,{type:"target",position:S.JC.Top,id:n+"t"}),I().createElement(Zn,(0,_.c)({prefix:l},t)),I().createElement("div",{className:"".concat(l,"_content")},I().createElement("div",{title:u},I().createElement("span",null,"录入表单："),u),I().createElement("div",{title:d},I().createElement("span",null,"录入人："),d)),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:n+"b"})))}),"flow-action-node"),Jr=["dragEvent","prefixClass"];function Gr(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function $r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gr(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Gr(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Yr=(0,T.ErrorBoundaryWrap)((function(e){var t=e.data,n=e.id,r=e.type,a=zn(n),l=a.dragEvent,o=a.prefixClass,i=(0,Q.c)(a,Jr),c=$r($r({},t),t._disp_),u=(0,N.useMemo)((function(){return He(t.queryModel)?"refbillField":kt(t.queryModel)?"apiId":"formId"}),[t.queryModel]);return I().createElement(tr,{id:n},I().createElement("div",(0,_.c)({},l,i),I().createElement(S._2,{type:"target",position:S.JC.Top,id:n+"t"}),I().createElement(Zn,(0,_.c)({prefix:o},t)),I().createElement("div",{className:"".concat(o,"_content")},I().createElement("div",{title:c[u]},I().createElement("span",null,je(r)?"查找":"新增","表单："),c[u]),I().createElement("div",{className:"".concat(o,"_content_des"),title:t.documentation||""},t.documentation||"")),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:n+"b"})))}),"QueryDataAutoTask"),Qr=["dragEvent","prefixClass"];function Xr(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xr(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Xr(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var ea=(0,T.ErrorBoundaryWrap)((function(e){var t=e.data,n=e.id,r=zn(n),a=r.dragEvent,l=r.prefixClass,o=(0,Q.c)(r,Qr),i=(0,N.useContext)(D),c=i.getKdesignerApi,u=(i.getRefBillVarFormId,(0,N.useMemo)((function(){return c()}),[]).data),d=(0,N.useMemo)((function(){return Zr(Zr({},t),t._disp_)}),[t]),s=(0,N.useMemo)((function(){if(!t.refNodeId)return"";var e=u.findControl(t.refNodeId);if(e){var n,r,a=e.queryModel,l={byapi:"apiId",byrela:"refbillField",byfilter:"formId"},o=(null==l?void 0:l[a])||"formId";return m()(n="".concat(e.name,"（")).call(n,(null===(r=e._disp_)||void 0===r?void 0:r[o])||"","）")}return d.refNodeId}),[d]);return Wr(t),I().createElement(tr,{id:n},I().createElement("div",(0,_.c)({},a,o),I().createElement(S._2,{type:"target",position:S.JC.Top,id:n+"t"}),I().createElement(Zn,(0,_.c)({prefix:l},t)),I().createElement("div",{className:"".concat(l,"_content")},I().createElement("div",{title:s},I().createElement("span",null,"修改表单："),s),I().createElement("div",{className:"".concat(l,"_content_des"),title:t.documentation||""},t.documentation||"")),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:n+"b"})))}),"UpdateBillAutoTask"),ta=["dragEvent","prefixClass"];function na(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ra(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?na(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):na(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var aa=(ze.treeUtils||{}).dfs,la=(0,T.ErrorBoundaryWrap)((function(e){var t=e.data,n=e.id,r=(0,N.useContext)(D),a=r.getPreNodeVariablesById,l=r.getKdesignerApi,o=(0,N.useMemo)((function(){return l()}),[]),i=o.data,c=o.meta,u=zn(n),d=u.dragEvent,s=u.prefixClass,f=(0,Q.c)(u,ta),p=ra(ra({},t),t._disp_||{}),v=(0,N.useCallback)((function(){return a(n)}),[n]),m=((0,N.useMemo)((function(){if(Tt(p.url)){var e,t=v();return(null===(e=aa(t,(function(e){return e.fieldName===p.url})))||void 0===e?void 0:e.title)||""}return p.url}),[v,p.url]),Jn(t._Type_,"apiMode")(t.apiMode,i)),y=Jn(t._Type_,"authMode")(t.authMode,i),g=(0,N.useMemo)((function(){var e;return(0,ce.isUndefined)(t.apiMode)?null===(e=c.getControlMetaEditor(t._Type_,"apiMode"))||void 0===e?void 0:e.Default:t.apiMode}),[t]),h=(0,N.useMemo)((function(){var e;return(0,ce.isUndefined)(t.authMode)?null===(e=c.getControlMetaEditor(t._Type_,"authMode"))||void 0===e?void 0:e.Default:t.authMode}),[t]),E=(0,N.useMemo)((function(){var e;return(0,ce.isUndefined)(t.method)?null===(e=c.getControlMetaEditor(t._Type_,"method"))||void 0===e?void 0:e.Default:t.method}),[t]);return I().createElement(tr,{id:n},I().createElement("div",(0,_.c)({},d,f),I().createElement(S._2,{type:"target",position:S.JC.Top,id:n+"t"}),I().createElement(Zn,(0,_.c)({prefix:s},t)),I().createElement("div",{className:"".concat(s,"_content")},I().createElement("div",null,I().createElement("span",null,"API模式："),m),"auth"===g&&I().createElement("div",null,I().createElement("span",null,"认证方式："),y),("request"===g||"oauth2"===h)&&I().createElement("div",null,I().createElement("span",null,"请求方式："),E),I().createElement("div",{className:"".concat(s,"_content_des")},t.documentation||"")),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:n+"b"})))}),"ApiInvokeAutoTask"),oa=(0,N.memo)((function(e){var t=e.id,n=e.sourceX,r=e.sourceY,a=e.targetX,l=e.targetY,o=e.sourcePosition,i=e.targetPosition,c=e.style,u=void 0===c?{}:c,d=e.markerEnd,s=e.data,f=(0,N.useContext)(D).getKdesignerApi,v=(0,N.useMemo)((function(){return f()}),[]),m=v.data,y=v.selection,g=s.parentId,h=zn(g).dropEvent,E=(0,N.useState)(!1),b=(0,p.c)(E,2),C=b[0],k=b[1],_=m.getRootId(),w=(0,N.useMemo)((function(){return m.findControl(g)}),[m,g]),M=(0,N.useCallback)((function(e){var t=e.value;t[0]&&t[0]===_||k(!1)}),[_]);(0,N.useEffect)((function(){var e=y.addSelectChangeListener(M);return function(){e()}}),[]);var A=(0,N.useCallback)((function(e){e.stopPropagation(),y.setSelect([]);var t=s||{},n=t.parentId,r=t.id;T.eventBus.emit(Sn,{parentId:n,childId:r}),k(!0)}),[_,s]),P={sourceX:n,sourceY:r,sourcePosition:o,targetX:a,targetY:l,targetPosition:i},O=(0,S.ym)(P),j=(0,N.useMemo)((function(){return!!w&&!(w._Type_===W&&!w.isNullNode)}),[w]),B=(0,N.useCallback)((function(e){e.persist(),y.setSelect([]),T.eventBus.emit(An,{visible:!1})}),[]);return I().createElement(I().Fragment,null,I().createElement("path",{id:t,style:u,className:"react-flow__edge-path",d:O,markerEnd:d}),j?I().createElement("foreignObject",{width:280,height:80,x:n-140,y:r+(l-r)/2-40,className:"add_node_foreignobject",onClick:B},I().createElement("div",h,I().createElement("div",{className:mn()("add_node",{add_node_active:C}),onClick:function(e){return A(e)}},I().createElement(x.Icon,{prefix:"nocodeplatformicon",type:"jia4"})))):null)}));oa.displayName="SequenceFlow";var ia=(0,T.ErrorBoundaryWrap)(oa,"SequenceFlow"),ca=["dragEvent","prefixClass"];function ua(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function da(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ua(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):ua(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var sa,fa=(0,T.ErrorBoundaryWrap)((function(e){var t=e.data,n=e.id,r=zn(n),a=r.dragEvent,l=r.prefixClass,o=(0,Q.c)(r,ca),i=(0,N.useContext)(D),c=i.getKdesignerApi,u=(i.getRefBillVarFormId,(0,N.useMemo)((function(){return c()}),[]).data),d=(0,N.useMemo)((function(){return da(da({},t),t._disp_)}),[t]),s=(0,N.useMemo)((function(){if(!t.refNodeId)return"";var e=u.findControl(t.refNodeId);if(e){var n,r,a=e.queryModel,l={byapi:"apiId",byrela:"refbillField",byfilter:"formId"},o=(null==l?void 0:l[a])||"formId";return m()(n="".concat(e.name,"（")).call(n,(null===(r=e._disp_)||void 0===r?void 0:r[o])||"","）")}return d.refNodeId}),[d]);return Wr(t),I().createElement(tr,{id:n},I().createElement("div",(0,_.c)({},a,o),I().createElement(S._2,{type:"target",position:S.JC.Top,id:n+"t"}),I().createElement(Zn,(0,_.c)({prefix:l},t)),I().createElement("div",{className:"".concat(l,"_content")},I().createElement("div",{title:s},I().createElement("span",null,"删除表单："),s),I().createElement("div",{className:"".concat(l,"_content_des"),title:t.documentation||""},t.documentation||"")),I().createElement(S._2,{type:"source",position:S.JC.Bottom,id:n+"b"})))}),"DeleteBillAutoTask"),pa=(sa={},(0,f.c)((0,f.c)((0,f.c)((0,f.c)((0,f.c)((0,f.c)((0,f.c)((0,f.c)((0,f.c)((0,f.c)(sa,B,hr),R,Br),W,Or),L,Dr),G,jr),F,Yr),V,Yr),q,ea),K,fa),U,_r),(0,f.c)((0,f.c)((0,f.c)((0,f.c)(sa,H,zr),J,Ar),z,Tr),$,la)),va=(0,f.c)({},Y,ia);function ma(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ya(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ma(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):ma(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var ga=document.body.offsetWidth/2-140,ha=(0,N.memo)((function(e){var t=(0,N.useContext)(D),n=t.getKdesignerApi,r=t.getPrefixCls,a=t.prefixCls,l=t.setDesignerDataRef,o=t.invokeApi,i=t.flowStatus,c=t.isReadonly,u=t.flowMetaData,d=void 0===u?{}:u,s=t.setVariables,f=n(),v=f.selection,y=f.data,g=(f.meta,f.error),h=(0,N.useState)(!1),E=(0,p.c)(h,2),b=E[0],C=E[1],k=(0,N.useState)([]),x=(0,p.c)(k,2),w=x[0],A=x[1],j=(0,N.useMemo)((function(){var e;return c?{}:(null===(e=d[2])||void 0===e?void 0:e.errors)||{}}),[c]);(0,N.useEffect)((function(){g.replaceError(ct(j))}),[]);var F=(0,N.useRef)(null),V=(0,N.useRef)(null),q=r&&r(a,"rightpanel"),K=(0,N.useRef)({x:0,y:0,zoom:1}),U=(0,N.useRef)(),L=(0,N.useRef)(null),z=(0,N.useRef)([]),Y=(0,N.useRef)(null),Q=(0,N.useCallback)((function(e){var t=new(P().graphlib.Graph);t.setDefaultEdgeLabel((function(){return{}})),t.setGraph({rankdir:"TB",nodesep:96,ranksep:96,edgesep:96,marginx:ga,marginy:40});var n=[],r=[];z.current.forEach((function(e){(0,S.yW)(e)?(e.data.size=function(e){switch(e.type){case B:return{width:280,height:gt(e.data.triggerMode)?180:112};case H:return{width:280,height:112};case R:return{width:80,height:40};case J:return{width:280,height:Kt(e,248,112)};case $:return{width:280,height:Kt(e,248,"oauth2"===e.data.authMode?132:112)};case W:return{width:36,height:36};case G:return{width:2,height:1};default:return{width:280,height:Kt(e,248,84)}}}(e),t.setNode(e.id,ya(ya({},e.data.size),{},{shape:"rect"}))):(n.push({id:e.id,target:e.target,source:e.source,_Type_:e.type,itemId:e.itemId,number:e.number}),t.setEdge(e.source,e.target))})),P().layout(t);var a=z.current.reduce((function(e,n){if((0,S.yW)(n)){var a=t.node(n.id);n.targetPosition=[S.JC.Top],n.sourcePosition=S.JC.Bottom,n.position={x:a.x-a.width/2,y:a.y-a.height/2},r.push(ya(ya({},n.data),{},{position:n.position}))}return m()(e).call(e,n)}),[]);l({edges:n,nodes:r}),A(a)}),[l]),X=(0,N.useCallback)((function(e){z.current=qt(y,i),Q(!0);for(var t=e.actions,n=void 0===t?[]:t,r=function(){var t=n[a],r=t.type;if("DELETE"===r){var l=(0,p.c)(t.value,1)[0],o=e.oldValue.Items,i=M()(o).call(o,(function(e){return e.id===l}));i&&te([i.parentId],!1)}else if("CUSTOMUPDATE"===r){var c=e.oldValue.Items,u=e.value.Items,d=M()(u).call(u,(function(e,t){return e.id!==c[t].id}));d&&te([d.id],!1)}else if("ADD"===r){var s=t.value.id;V.current=s}},a=0;a<n.length;a++)r()}),[Q]),Z=(0,N.useCallback)((function(e){var t=e.value,n=e.oldValue,r=t[0];if(r)(!V.current||V.current&&V.current!==r)&&(V.current=null,te(n,!1)),F.current=y.findControl(r);else{var a=n[0];y.findControl(a)&&(V.current=null,te(n,!1))}}),[]),ee=(0,N.useCallback)((function(e){var t=e.variables,n=void 0===t?{}:t,r=e.errors,a=void 0===r?{}:r;C(!1),a&&g.setError(ct(a)),n&&s((function(e){return ya(ya({},e),At(n))}))}),[]);(0,N.useEffect)((function(){var e,t=y.addDataChangeListener(X),n=v.addSelectChangeListener(Z);return c||(e=T.eventBus.on(fe,ee)),function(){t(),n(),c||T.eventBus.off(fe,e)}}),[X,Z,c]),(0,N.useEffect)((function(){z.current=qt(y,i),Q(!0)}),[]),cn(Y);var te=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!c)if((null==e?void 0:e.length)>0){var n=y.findControl(e[0]);if(!t||F.current&&!(0,ce.isEqual)(n,F.current)){var r=y.getAllSubControlIds(e[0]);o.saveSyncData([(null==r?void 0:r.length)>0?r:e,["variables","errors"],[],{}])}}else{var a=v.getSelection();if(1===a.length){var l=y.findControl(a[0]);if(F.current&&l&&!(0,ce.isEqual)(l,F.current)){var i=y.getAllSubControlIds(a[0]);o.saveSyncData([(null==i?void 0:i.length)>0?i:a,["variables","errors"],[],{}])}}}},ne=Ut(),re=(0,N.useMemo)((function(){return{sendSyncData:te}}),[te]);return I().createElement(O.Provider,{value:re},I().createElement(S.Mt,null,I().createElement(S.cp,(0,_.c)({id:de,elements:w,nodeTypes:pa,edgeTypes:va,onLoad:function(e){U.current=e;var t=y.getData().Items;if(2===t.length){var n=t[0];n.formId||setTimeout((function(){v.setSelect([n.id])}))}var r=M()(w).call(w,(function(e){return e.type===B}));setTimeout((function(){var t;return e.setTransform({x:ga-((null==r||null===(t=r.position)||void 0===t?void 0:t.x)||0),y:40,zoom:1})}),0)},onPaneClick:function(e){e.persist(),v.setSelect([]),T.eventBus.emit(An,{visible:!1})},ref:Y,tabIndex:-1,onMove:function(e){K.current=e}},ne),I().createElement(S.O,{showInteractive:!1}),I().createElement(Ea,{ref:L}))),I().createElement(Rn,{prefixCls:q,isLoading:b}))})),Ea=(0,N.forwardRef)((function(e,t){var n=(0,S._s)();return(0,N.useImperativeHandle)(t,(function(){return n})),I().createElement("div",null)}));ha.displayName="MainView",Ea.displayName="Operation";var ba=ha;function Ca(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Na(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ca(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Ca(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Ia={Id:"anonyoumsMockId",Name:"anonyoumsMockName",Key:"anonyoumsMockKey",DefaultGroup:!0},Ta=function(e,t){var n,r,a=Na(Na({},n=e),{},{PropertyGroups:m()(r=[Ia]).call(r,(0,j.c)(n.PropertyGroups||[]))});return(0,T.adaptorMeta)(a,(0,T.mergeTransformKeyMap)(T.transformKeyMap,(0,f.c)({},Wt,[zt])),t)},ka=function(e){var t=e.Hide;return!(!t||"object"!==(0,sn.c)(t))&&t.Hide},xa={name:"name",id:"id",key:"key",edges:"edges",parentId:"parentId"},_a=["type","parentId","childId","name","rootKey"];function wa(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ma(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wa(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):wa(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Sa=function(e,t,n){e.globalConfig;var r=e.dataContext,a=(e.selectionContext,e.action),l=(e.dataFactory,e.modelFactory,e.metaReader),o=(a.type,a.value),i=[a];if(Array.isArray(o))return i;var c=o.type,u=o.parentId,d=o.childId,s=o.name,f=o.rootKey,p=(0,Q.c)(o,_a),v=[],m=r.findControlIndex(u)+1,y=ht({rootKey:f,parentId:u,type:c,name:s}),h=y.id;if(c===W){var b=function(e,t,n){var r=e.name,a=e.rootKey,l=e.childActions,o=[],i=t.id;o.push((0,T.createAddAction)(Ma(Ma({},t),{},{leaveMode:"parallel"}),{index:n}));var c=3,u=[];if((null==l?void 0:l.length)>0){c=l.length+1;for(var d=0;d<l.length;d++){var s=l[d],f=ht(Ma({rootKey:a,type:L,parentId:t.id},s));u.push(f.id),o.push((0,T.createAddAction)(f,{index:n+d}))}}else for(var p=1;p<c;p++){var v=ht({rootKey:a,type:L,parentId:t.id,name:r,seq:p});u.push(v.id),o.push((0,T.createAddAction)(v,{index:n+p}))}var m=ht({parentId:i,name:"nullNode",rootKey:a,type:W,isNullNode:!0,parentIds:u.join(",")});return o.push((0,T.createAddAction)(m,{index:n+c})),o}(o,y,m)||[];h=(b[b.length-1]||{value:{}}).value.id,v.push.apply(v,(0,j.c)(b))}else if(c===L&&E()(u).call(u,W)){var C=r.getSubControls(u),N=[],I=g()(C).call(C,(function(e){return e._Type_===c&&N.push(e),(null==e?void 0:e.seq)||""}));v.push((0,T.createAddAction)(Ma(Ma({},y),{},{seq:Math.max.apply(Math,(0,j.c)(I))+1}),{index:m+N.length}))}else{var k=function(e,t){var n=t._Type_;if(Me(n)||Ae(n)){var r=(e.getControlMetaEditor(n,"setting")||{}).ChildProperty;if(!r)return t;var a=[qe(Ke(r))];return Te(Te({},t),{},{setting:a})}return De(n)||Oe(n)?Te(Te({},t),{},{taskSubject:pt(ft(he,{title:ge}),!0)}):t}(l,Ma(Ma(Ma({},p),y),{},{_disp_:{}}));v.push((0,T.createAddAction)(k,{index:m}))}var x=r.findControl(d),_={};if(x.isNullNode){var w,M=E()(w=x.parentIds).call(w,u)?x.parentIds.replace(u,h):[x.parentIds,h].join();_=(0,T.createUpdateAction)([[d,{parentIds:M}]])}else _=(0,T.createUpdateAction)([[d,{parentId:h}]]);return v.push(_),v},Aa=["type","value"],Pa=function(e,t){var n=[],r=t.parentId,a=t.id,l=e.findControl(r)||{};if(xe(l)){var o=e.getAllSubControlIds(a),c=function(e,t){var n=e.getSubControls(t);return M()(n).call(n,(function(e){return _e(e)}))}(e,r);if(c){var u,d,s=c.id,f=c.parentIds,p=null===(u=i()(d=f.split(",")).call(d,(function(e){return e!==o[o.length-1]})))||void 0===u?void 0:u.join(",");n.push((0,T.createDeleteAction)(ie()(o).call(o,1))),n.push((0,T.createUpdateAction)([[s,{parentIds:p}]]))}}else{var v=e.getSubControls(a);if(v[0]){var m=v[0];n.push((0,T.createUpdateAction)([[m.id,{parentId:r}]]))}}return n},Da=function(e,t,n){e.globalConfig;var r=e.dataContext,a=(e.selectionContext,e.action),l=(e.dataFactory,e.modelFactory,e.metaReader,a.type,a.value),o=((0,Q.c)(a,Aa),[]);if(Array.isArray(l)){var i=r.findControl(l[0]),c=(i._Type_,i.parentId),u=i.id;if(xe(i)){var d,s,f=r.getAllSubControls(u),p=[],v=M()(f).call(f,(function(e){e._Type_;var t=e.parentId;return _e(e)&&t===u})),y=null===(d=r.getSubControls(null==v?void 0:v.id))||void 0===d?void 0:d[0];if(!y||_e(y))null===(s=r.getData()[Jt])||void 0===s||s.forEach((function(e){var t=e.id;e.parentId;if(_e(e)&&t!==(null==v?void 0:v.id)){var n=e.parentIds;e.id;if(E()(n).call(n,v.id)){var r=n.split(","),a=[];r.forEach((function(e){e===(null==v?void 0:v.id)?a.push(c):a.push(e)})),p.push((0,T.createUpdateAction)([[t,{parentIds:a.join(",")}]]))}}}));else p.push((0,T.createUpdateAction)([[y.id,{parentId:c}]]));o.push.apply(o,p)}else{var g=r.findControl(c)||{};if(we(i)&&xe(g)){var h=Pa(r,i);o.push.apply(o,(0,j.c)(h))}else l.forEach((function(e){var t=r.findControl(e),n=t._Type_,a=t.parentId;if(!ke(n)){var l,i=[];null===(l=r.getData()[Jt])||void 0===l||l.forEach((function(t){var l=t.id,o=t.parentId;if(_e(t)){var c=t.parentIds;if(E()(c).call(c,e)){var u=c.split(","),d=[];u.forEach((function(t){if(t===e)if(n===L){var l=r.getParentControl(e);xe(l)||d.push(a)}else d.push(a);else d.push(t)})),i.push((0,T.createUpdateAction)([[l,{parentIds:null==d?void 0:d.join(",")}]]))}}else o===e&&i.push((0,T.createUpdateAction)([[l,{parentId:a}]]))})),o.push.apply(o,i)}}))}}return m()(o).call(o,[a])},Oa=(0,f.c)((0,f.c)({},T.ActionType.ADD,Sa),T.ActionType.DELETE,Da),ja=function(e,t){var n=e.action,r=e.dataContext,a=e.selectionContext,l=e.globalConfig,o=e.dataFactory,i=e.modelFactory,c=e.metaReader,u=e.success,d=e.fail,s=(l.dataRef,l.keywordMapping,[]),f=n.type,p=Oa[f];if(p){var v=p({globalConfig:l,dataContext:r,selectionContext:a,action:n,dataFactory:o,modelFactory:i,metaReader:c},u(s),d);v&&s.push.apply(s,(0,j.c)(v))}else s.push(n);s.length&&u(s)},Ba=function(e){var t=e.formId,n=e.eventName,r=e.parser,a=e.defaultValue,l=void 0===a?{}:a,o=(0,N.useState)(l),i=(0,p.c)(o,2),c=i[0],u=i[1];return(0,N.useEffect)((function(){var e=T.eventBus.on(n,(function(e){var n;if(null==e||!e.args||(null===(n=e.args)||void 0===n?void 0:n.formId)===t){var a="function"==typeof r?r(e):function(e){var t=e.data,n=e.args;return{data:t.rows,param:n.param}}(e);u(a)}}));return function(){T.eventBus.off(n,e)}}),[n,t,r]),(0,N.useEffect)((function(){t||u(l)}),[t]),c},Ra=ze.treeUtils||{},Fa=Ra.dfs,Va=Ra.exludeTreeNodeByCallback,qa=Ra.getListSortConfig,Ka=(0,N.memo)((function(e){var t=e.handleChange,n=e.className,r=e.editor,a=e.Name,l=e.Tips,o=e.field,c=e.readonly,u=e.value,d=void 0===u?[]:u,s=r.NameHidden,f=r.Required,p=r.Title,v=r.Source,m=o[v],y=(0,N.useContext)(D),g=y.compareType,h=y.invokeAction,E=(0,N.useRef)(m),b=Ba({formId:m,eventName:"setListTreeConfig",parser:function(e){var t=e.data;return kt(o.queryModel)?Va(Ct(t,t,g),(function(e){return e.canOrder})):Ct(t,t,g)},defaultValue:[]}),C=(0,N.useMemo)((function(){return qa(b)}),[b]);return(0,N.useEffect)((function(){m&&h("listtreeconfig",[m])}),[m]),(0,N.useEffect)((function(){E.current!==m&&(E.current=m,t([]))}),[m]),(0,N.useEffect)((function(){if(null!=d&&d.length&&C.length){var e=!1,n=i()(d).call(d,(function(t){var n=Fa(C,(function(e){return e.key===t.number}));return n||(e=!0),n}));e&&t(n)}}),[C]),I().createElement(I().Fragment,null,c?I().createElement("div",{className:mn()("".concat(n,"-display-viewitem"),"".concat(n,"-display-orderby"))},I().createElement("span",{className:"title",title:p},a)):I().createElement(T.NameTipWrapper,{nameHidden:s,className:n,name:a,tips:l,required:f,title:p}),!c||null!=d&&d.length?I().createElement(ze.OrderByEditor,{id:"filter",nameHidden:!0,readonly:c,style:{marginTop:"0px"},name:a,tips:l,required:f,treeData:C||[],value:d||[],onChange:t}):"-")}));Ka.displayName="OrderByEditor";var Ua=(0,T.ErrorBoundaryWrap)(Ka,"OrderByEditor"),Ha=n(72400),Wa=n.n(Ha),La=n(35680),za=n.n(La);function Ja(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ga(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ja(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Ja(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var $a=I().memo((function(e){var t=e.field,n=e.id,r=e.propName,a=e.actionType,l=(e.modalTitle,e.locked),o=e.Name,i=e.handleChange,c=e.value,u=e.editor,d=e.Tips,s=e.className,v=e.readonly,y=e.hiddenTitle,g=u.NameHidden,h=u.Required,E=u.HideFunc,b=u.HasCheck,C=u.Placeholder,k=u.Title,_=(0,N.useContext)(D),w=_.getPreNodeVariablesById,M=_.expressionData,S=t._Type_,A=t.name,P=(0,N.useState)(!1),O=(0,p.c)(P,2),j=O[0],B=O[1],R=(0,N.useMemo)((function(){return b?function(e){return e?"string"==typeof e?JSON.parse(e):e:{content:"",check:!1}}(c):c}),[c]),F=b?R.content:R,V=(0,N.useRef)(""),q=(0,N.useMemo)((function(){var e=F||"",t=e.split("@@");return t.length>1?t:["",e,1]}),[F]),K=(0,p.c)(q,3),H=K[1],W=K[2],L=(0,N.useMemo)((function(){return w(n)}),[n,w]),z=(0,N.useMemo)((function(){return(null==M?void 0:M.expression).functionTypes}),[null==M?void 0:M.expression]),J=(0,N.useMemo)((function(){var e=(null==M?void 0:M.expression).functionOperations;return Wa()(e)}),[null==M?void 0:M.expression]),G=function(e){i(Ga(Ga({},c),e))},$=(0,N.useCallback)((function(e,t){if(B(!1),!e)return b?G({content:""}):i("");var n=pt(e,t);b?G({content:n}):i(n)}),[i,c,b,pt]),Y=(0,N.useCallback)((function(e){e.preventDefault(),l||v||B(!0)}),[B,l,v]);(0,N.useEffect)((function(){if(V.current!==A&&S===U&&null!=c&&c.check){var e,t=null==c||null===(e=c.content)||void 0===e?void 0:za()(e).call(e,"【 ".concat(V.current," 】"),"【 ".concat(A," 】"));i(Ga(Ga({},c),{},{content:t||""})),V.current=A}}),[A,i,c,S]),(0,N.useEffect)((function(){var e,t,n,a,l,o;if(S===U&&null!=c&&c.check&&(null==c||!c.content)){var i="${proc.procName}",u=ft(i,{title:"[文本]流程名称"});switch(r){case"notifyInitiatorPassMsg":G({check:!0,content:m()(e=m()(t=m()(n="您申请的【 ".concat(i," 】在【 ")).call(n,A," 】节点审核通过@@您申请的【 ")).call(t,u," 】在【 ")).call(e,A," 】节点审核通过@@1")});break;case"notifyInitiatorRejectMsg":G({check:!0,content:m()(a=m()(l=m()(o="您申请的【 ".concat(i," 】在【 ")).call(o,A," 】节点审核否决@@您申请的【 ")).call(l,u," 】在【 ")).call(a,A," 】节点审核否决@@1")})}}}),[null==c?void 0:c.check,null==c?void 0:c.content,S,G]);var Q=!v&&h,X=mn()("".concat(s,"-condition"),(0,f.c)({},"".concat(s,"-nohover"),v));return I().createElement(I().Fragment,null,!y&&I().createElement("div",{className:mn()("".concat(s,"-condition-title"),(0,f.c)({},"".concat(s,"-readonly"),v))},I().createElement(T.NameTipWrapper,{name:o,className:s,nameHidden:g,tips:d,required:Q,title:k}),b&&I().createElement(x.Switch,{checked:null==R?void 0:R.check,disabled:v,onChange:function(e){if(b){var t={check:e};if(S===U&&e&&(null==c||!c.content)){var n,r="${proc.procName}",a=ft(r,{title:"[文本]流程名称"});t.content=m()(n="您有一个【 ".concat(r," 】待审批，请尽快处理@@您有一个【 ")).call(n,a," 】待审批，请尽快处理@@1")}G(t)}}})),(!b||(null==R?void 0:R.check))&&I().createElement(I().Fragment,null,I().createElement("div",{className:X,onMouseDown:Y},I().createElement("div",{className:"code-box"},I().createElement(ze.EditArea,{value:H,placeholder:C,expressionData:z,operations:J,language:W,fieldData:L,readOnly:"nocursor"})),I().createElement("div",{className:"fx"},"FX")),I().createElement(ze.Condition,{value:H,language:W,editorPlaceholder:C,hideFunc:E,fieldData:L,defaultExpandAll:!1,expressionData:z,operations:J,actionType:a,modalTitle:o,editorTitle:Ir(o,t),visible:j,onClose:function(){return B(!1)},onConfirm:$})))}));$a.displayName="ConditionEditor";var Ya=(0,T.ErrorBoundaryWrap)($a,"ConditionEditor"),Qa=n(68456),Xa=n.n(Qa);function Za(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function el(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Za(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Za(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var tl=(0,N.memo)((function(e){var t=e.value,n=e.options,r=e.onClick,a=(0,N.useContext)(D).prefixCls,l="".concat(a,"-right-view-customcontent"),o=(0,N.useMemo)((function(){return(null==n?void 0:g()(n).call(n,(function(e){return el(el({icon:"duixiangxuanze"},e),{},{title:e.Title,key:e.Id,type:e.Type})})))||[]}),[n]);return(null==o?void 0:o.length)>0&&I().createElement(I().Fragment,null,I().createElement("div",{className:l},g()(o).call(o,(function(e,n){return I().createElement("div",{key:e.key||n,className:mn()("".concat(l,"-item"),{"is-active":t===e.key}),onClick:function(){null==r||r(e)}},I().createElement(x.Icon,{className:"".concat(l,"-item-icon"),prefix:e.iconPrefix||"designericon",type:e.icon||"duixiangxuanze"}),I().createElement("span",null,e.title))}))))}));tl.displayName="CustomSelectContent";var nl=tl,rl=ze.treeUtils.dfs,al=(0,N.memo)((function(e){var t=e.data,n=e.className,r=e.value,a=e.defaultExpandAll,l=e.readonly,o=e.onClear,i=e.setPropsData,c=e.customSelectOptions,u=(0,N.useState)(!1),d=(0,p.c)(u,2),s=d[0],f=d[1],v="".concat(n,"-var-select-wrap"),y=(0,N.useMemo)((function(){var e=null==c?void 0:M()(c).call(c,(function(e){return e.Id===r}));return(null==e?void 0:e.Title)||r}),[r,c]),g=(0,N.useCallback)((function(e){if(e){var t=e.type,n=e.key,r=e.title;"custom"===t&&i({value:n,label:r}),f(!1)}}),[i]);if(l){var h,E=null==c?void 0:M()(c).call(c,(function(e){return e.Id===r}));if(E)return null==E?void 0:E.Title;var b=rl(t,(function(e){return e.key===y}))||{},C=b.title,T=void 0===C?"":C,k=b.titlePrefix,_=void 0===k?"":k;return m()(h="".concat(_)).call(h,T)}return I().createElement(ze.KDTreeSelect,{visible:s,value:y,allowClear:!0,onChange:function(e,t){if(!e)return null==o?void 0:o();var n=(null==t?void 0:t[0])||{};i({value:e,label:(null==n?void 0:n.label)||(null==n?void 0:n.title)||""})},onVisibleChange:function(e){e!==s&&f(e)},treeData:t,treeDefaultExpandAll:a,showFullLabelTips:!0,dropdownRender:function(e){return I().createElement(I().Fragment,null,I().createElement(nl,{prefixCls:v,options:c,onClick:g}),e)},suffixIcon:I().createElement(x.Icon,{prefix:"designericon",type:"duixiangxuanze2"})})}));al.displayName="VarSelectWrap";var ll=al,ol=n(13440),il=n.n(ol),cl=n(59992),ul=n.n(cl),dl=n(60600),sl=n.n(dl);function fl(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function pl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fl(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):fl(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}function vl(e,t){var n=void 0!==ul()&&sl()(e)||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return ml(e,t);var r=ie()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return il()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ml(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,l=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw l}}}}function ml(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var yl=function(e,t){var n,r=e||{},a=r.type,l=r.option,o=r.parentKey,i=E()(n=["refbill","user","org"]).call(n,a),c=i&&!(null!=l&&l.isMulti),u=i&&(null==l?void 0:l.isMulti)&&o===t;return("pk"===a||c||u)&&!(null!=l&&l.expendOnlyInExp)},gl=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return null==t?void 0:t.reduce((function(t,l){var o,i,c=l.type,u=l.option,d=l.children,s=l.key;if(be[null==u?void 0:u.editorType]&&(l.type=be[null==u?void 0:u.editorType]),(!n||(null==n?void 0:n(l)))&&null!=u&&null!==(o=u.children)&&void 0!==o&&o.length){var f;if(l.children=g()(f=u.children).call(f,(function(e){var t,n=be[null==e||null===(t=e.option)||void 0===t?void 0:t.editorType]||e.type;return pl(pl({},e),{},{key:e.value,parentKey:s,type:n})})),r||null!=u&&u.cannotSelect){var p=null==r?void 0:r(l),v="boolean"==typeof p?p:!(null!=u&&u.cannotSelect);l.selectable=v}"pk"===c&&a&&e(l.children,n,r,!1)}else null!=d&&d.length&&e(d,n,r,a);return m()(i=[]).call(i,(0,j.c)(t),[l])}),[])},hl=function(e,t){var n,r=[],a=0,l=t.length;function o(e,n){var i;if(E()(t).call(t,e.key)&&(a++,r.push.apply(r,(0,j.c)(n))),null!==(i=e.children)&&void 0!==i&&i.length){var c,u=vl(e.children);try{for(u.s();!(c=u.n()).done;){var d,s,f=c.value;if(a>=l)return(0,j.c)(new(Z())(m()(s=[]).call(s,r)));o(f,m()(d=[]).call(d,(0,j.c)(n),[e.key]))}}catch(e){u.e(e)}finally{u.f()}}}var i,c=vl(e);try{for(c.s();!(i=c.n()).done;){var u,d=i.value;if(a>=l)return(0,j.c)(new(Z())(m()(u=[]).call(u,r)));o(d,[])}}catch(e){c.e(e)}finally{c.f()}return(0,j.c)(new(Z())(m()(n=[]).call(n,r)))},El=function e(t,n){return t?t.reduce((function(t,r){var a=r.children,l=r.option,o=pl({},r);return l?o.option.children=e(o.option.children,n):a&&(o.children=e(o.children,n)),n?null!=n&&n(o)?m()(t).call(t,o):t:m()(t).call(t,o)}),[]):t};function bl(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bl(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):bl(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Nl=ze.ListFilterUtil.getFlowTypeByParam,Il=ze.ListFilterUtil.SystemFields,Tl=function(e){var t;return null===ze.treeUtils||void 0===ze.treeUtils||null===(t=ze.treeUtils.exludeTreeNodeByCallback)||void 0===t?void 0:t.call(ze.treeUtils,e,(function(e){var t=null==Il?void 0:M()(Il).call(Il,(function(t){var n;return null===(n=e.key)||void 0===n?void 0:E()(n).call(n,t)})),n=Nl(e);return!t&&(!n||e.children)}))},kl=(0,N.memo)((function(e){var t=(0,N.useContext)(D),n=t.getKdesignerApi,r=t.getPreNodeVariablesById,a=(0,N.useMemo)((function(){return n()}),[]).data,l=(e.handleChange,e.value),o=e.className,c=e.editor,u=e.Name,d=e.Tips,s=e.field,p=e.propName,v=(e.error,e.variablesTree),m=e.readonly,y=e.onPropertyChange,g=e.assignments,h=(c.Enum,c.NameHidden),b=c.Required,C=c.VarType,k=c.Source,x=c.Custom,_=void 0===x?[]:x,w=c.Title,M=s.id,S=s._disp_,A=s._Type_,P=s.refNodeId,O=s.loopby,j=function e(t,n){var r=(0,ce.cloneDeep)(t);return null==r||r.forEach((function(t){var n=t.children;return n&&(t.children=e(i()(n).call(n,(function(e){return(null==e?void 0:e.value)===l||!(null!=g&&E()(g).call(g,null==e?void 0:e.value))})),!1)),t})),null==r?void 0:i()(r).call(r,(function(e){var t,r,a,l,o,i,c;return(n&&(null===(t=e.children)||void 0===t?void 0:t.length)>0||!n)&&!(null!=e&&le()(r=e.key).call(r,"${proc.")&&(null!=e&&null!==(a=e.value)&&void 0!==a&&Xa()(a).call(a,"ExecuteResult.QueryResult}")||null!=e&&null!==(l=e.value)&&void 0!==l&&Xa()(l).call(l,"AuditNumber}")||null!=e&&null!==(o=e.value)&&void 0!==o&&Xa()(o).call(o,"NodeName}")||null!=e&&null!==(i=e.key)&&void 0!==i&&Xa()(i).call(i,".procName}")||null!=e&&null!==(c=e.key)&&void 0!==c&&Xa()(c).call(c,"Comment}")))}))},B=(0,N.useMemo)((function(){var e=null!=v&&v.length?v:r(M,C)||[],t=P||O;if(Ae(A)||Se(A)){var n=gl(e,(function(e){var n,r,a=e.parentKey===t&&(null==e||null===(n=e.option)||void 0===n?void 0:n.isMulti);return("pk"===e.type||a)&&!(null!=e&&null!==(r=e.option)&&void 0!==r&&r.expendOnlyInExp)}),(function(){return!1}));return Tl(n)}if(Me(A)){var a=i()(e).call(e,(function(e){var t=e._Type_,n=e.queryModel;return!(je(t)&&kt(n)||Be(t))})),l=gl(a,(function(e){var t;return"pk"===e.type&&!(null!=e&&null!==(t=e.option)&&void 0!==t&&t.expendOnlyInExp)}),(function(e){return!(null==Nl?void 0:Nl(e))}));return Tl(l)}return k&&!v&&(e=i()(e).call(e,(function(e){return e[k]===k}))),!v&&je(A)&&He(s.queryModel)?i()(e).call(e,(function(e){var t=e._Type_;return je(t)?!("byapi"===e.queryModel):!Be(t)})):e}),[v,r,M,k,A,P,O]),R=function(e){var t=e.value,n=e.label;(null==y?void 0:y(s,p,{value:t,label:n},c,[]))||!1||a.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[M,(0,f.c)((0,f.c)({},p,t),"_disp_",Cl(Cl({},S),{},(0,f.c)({},p,n)))]]))},F=(0,N.useMemo)((function(){return j(B,!0)}),[B]);return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:h,className:o,name:u,tips:d,required:b,title:w}),I().createElement(ll,{defaultExpandAll:!1,className:o,data:F,customSelectOptions:_,setPropsData:R,onClear:function(){R({value:"",label:""})},value:l,readonly:m}))}));kl.displayName="VarSelectEditor";var xl=(0,T.ErrorBoundaryWrap)(kl,"VarSelectEditor"),_l=function(e){var t=e.fieldKey,n=(0,N.useContext)(D),r=n.batchInvoke,a=n.getControlText;return{baseUrl:n.baseUrl,batchInvoke:function(e,n){r(e,t,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[])},getControlText:a,addControlAction:function(e,t){return T.eventBus.on(e,t),function(){T.eventBus.off(e,t)}},batchInvokeListConfig:function(e){r("listconfig","nocodewfdesigner",[e])},batchInvokeQuery:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i()(t),a=void 0===n?"":n,l=t.search,o=void 0===l?"":l,c=t.order_by,u=void 0===c?"":c,d=t.select,s=void 0===d?"":d,f=t.page_size,p=void 0===f?10:f,v=t.page_no,m=void 0===v?1:v,y=t.ids,g={filter:a,search:o,order_by:u,page_size:p,page_no:m,ids:void 0===y?[]:y};s&&(g.select=s),r("query","nocodewfdesigner",[e,g])}}};function wl(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ml(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wl(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):wl(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Sl=ze.treeUtils||{},Al=Sl.dfs,Pl=Sl.exludeTreeNodeByCallback,Dl=Sl.getListConfigPure,Ol=(0,N.memo)((function(e){var t=e.handleChange,n=e.className,r=e.editor,a=e.Name,l=e.Tips,o=e.field,c=e.readonly,u=e.value,d=void 0===u?[]:u,s=r.NameHidden,v=r.Required,m=r.Title,y=r.Source,h=r.ShowVar,b=void 0===h||h,C=o[y],k=o.id,x=o.key,_=(0,N.useContext)(D),w=_.invokeAction,S=_.getPreNodeVariablesById,A=_.compareType,P=(0,N.useState)(),O=(0,p.c)(P,2),j=O[0],B=O[1],R=(0,N.useState)(d),F=(0,p.c)(R,2),V=F[0],q=F[1],K=(0,N.useRef)(C),U=(0,N.useRef)(null),H=_l({fieldKey:x});(0,N.useEffect)((function(){q((function(e){return(0,ce.isEqual)(e,d)?e:d}))}),[d,q]);var W=(0,N.useMemo)((function(){return gl(S(k),(function(e){return yl(e,"")}))}),[S,k]),L=Ba({formId:C,eventName:"setListTreeConfig",parser:function(e){var t=e.data,n=Ct(t,t,A);return Dl(n)},defaultValue:[]}),z=(0,N.useMemo)((function(){return kt(o.queryModel)?Pl(L,(function(e){return!e.onlyOrder})):L}),[L,o.queryModel]);(0,N.useEffect)((function(){C&&w("listtreeconfig",[C])}),[C]);var J=(0,N.useMemo)((function(){return Array.isArray(V)?g()(V).call(V,(function(e){if(Al(L,(function(t){return t.key===e.fieldName}))){var t,n=e.compareType;return E()(t=Wa()(be)).call(t,o.type)&&Ce[e.compareType]&&(n=Ce[e.compareType]),Ml(Ml({},e),{},{compareType:n,value:"string"==typeof e.value?JSON.parse(e.value):e.value||[]})}return Ml(Ml({},e),{},{compareType:void 0,fieldName:void 0,value:[]})})):[]}),[V,L]);(0,N.useEffect)((function(){K.current!==C&&(K.current=C,t([]))}),[C]);var G=(0,N.useCallback)((function(e){var t=e.args,n=e.data;if((null==t?void 0:t.formId)===C){var r=((null==t?void 0:t.param)||{}).enumField,a=i()(J).call(J,(function(e){return e.fieldName===r})),l=M()(L).call(L,(function(e){return e.key===r}));B((function(e){return Ml(Ml({},e),{},(0,f.c)({},r,{configuredFilter:{enumEqCompareType:"001",items:a},fieldFilterConfig:l,groupInfo:n.rows}))}))}}),[C,J,L]);(0,N.useEffect)((function(){return T.eventBus.on(pe,G),function(){T.eventBus.off(pe,G)}}),[G]);var $=(0,N.useCallback)((function(e){w("getFilterItemLook",[e,{getEnumData:"true",enumField:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",filterrows:[]}])}),[w]),Y=(0,N.useCallback)((function(e){$(C,e.fieldName)}),[C,$]),Q=(0,N.useCallback)((function(e){var t=e.value;if(null!=t&&t.length){var n,r=i()(n=g()(t).call(t,(function(e){return e.fieldValue}))).call(n,Boolean);return{expandKeys:hl(W,r)}}return{}}),[W]);return I().createElement("div",{className:"".concat(n,"-filter")},c?I().createElement("div",{className:mn()("".concat(n,"-display-viewitem"),"custom-title")},I().createElement("span",{className:"title",title:m},a)):I().createElement(T.NameTipWrapper,{nameHidden:s,className:n,name:a,tips:l,required:v,title:m}),!c||null!=d&&d.length?I().createElement(ze.FilterEditor,{id:"filter",nameHidden:!0,name:a,tips:l,required:v,readonly:c,variablesTree:W||[],listFilterConfig:L||[],onGetFieldRecords:Y,fieldRecords:j||[],style:{marginTop:"0px"},value:J,refBillProps:H,onChange:function(e){var n,r=e;Array.isArray(e)&&(r=g()(e).call(e,(function(e){return Ml(Ml({},e),{},{value:"object"===(0,sn.c)(e.value)?Zt()(e.value):e.value||""})}))),q(r),(n=r)!==d&&(U.current&&clearTimeout(U.current),U.current=setTimeout((function(){U.current=null,t(n)}),300))},fieldData:{fieldType:"treeSelect"},compareTypeData:{style:b?{}:{marginRight:12},disabled:kt(o.queryModel)},valueData:{className:"".concat(n,"-filter_value")},filterFooterData:{listType:"tree",listData:z,triggerText:"添加筛选条件",treeProps:{defaultExpandAll:!1}},showVarSelect:b,getVarSelectProps:Q}):"-")}));Ol.displayName="FilterEditor";var jl=(0,T.ErrorBoundaryWrap)(Ol,"FilterEditor");var Bl=(0,N.memo)((function(e){var t=e.title,n=(0,N.useContext)(D).prefixCls;return I().createElement("span",{className:"".concat(n,"-tree-title"),title:t},t)}));Bl.displayName="TreeNodeTitle";var Rl=Bl;function Fl(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Vl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fl(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Fl(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var ql={assignment:{value:"$assignment",hideproperty:["customVarName","customVarType","decimalDataType","maxLength","scale"]},customVarType:{value:"number",hideproperty:["decimalDataType","maxLength","scale"]}},Kl=(0,N.memo)((function(e){var t=e.onClick;return I().createElement(ze.BtnField,{type:"text",size:"small",icon:{prefix:"designericon",type:"shanchu"},onClick:t},"删除")}));Kl.displayName="ExtraComponent";var Ul=(0,N.memo)((function(e){var t=e.value;if(t)return I().createElement("div",{className:"assist"},I().createElement("span",null,"赋值对象："),I().createElement("span",{className:"assist_value",title:t},t))}));Ul.displayName="AssistComponent";var Hl=(0,N.memo)((function(e){var t,n=(0,N.useContext)(D),r=n.getKdesignerApi,a=n.getPreNodeVariablesById,l=n.isReadonly,o=n.getRefBillVarFormId,c=(0,N.useMemo)((function(){return r()}),[]),u=c.data,d=c.meta,s=e.handleChange,v=e.value,y=e.className,h=e.editor,b=(e.Name,e.Tips,e.field),k=e.propName,w=e.error,M=e.readonly,S=h.ChildProperty,A=h.Source,P=b.id,O=b._disp_,B=(b.refNodeId,(0,N.useMemo)((function(){return b[A]}),[b,A])),R=(0,N.useRef)(B),F=(0,N.useState)(g()(t=v||[]).call(t,(function(e){return e.calcId}))),V=(0,p.c)(F,2),q=V[0],K=V[1],U=(0,N.useState)([]),H=(0,p.c)(U,2),W=H[0],L=H[1],z=(0,N.useCallback)((function(e){K(e)}),[]),J=((0,N.useCallback)((function(e){var t=e.title;return I().createElement(Rl,{title:t})}),[y]),(0,N.useMemo)((function(){var e=a(P)||[];return A&&(e=i()(e).call(e,(function(e){return e.id===B}))),e=i()(e).call(e,(function(e){var t=e._Type_,n=e.formId;if(je(t)){if("byfilter"===e.queryModel)n=e.formId;else{var r=d.getControlMetaEditor(t,"refbillField");n=o(e.id,e.refbillField,null==r?void 0:r.VarType)}return!E()(Ee).call(Ee,n)}return!0}))}),[a,P,A,B])),G=(0,N.useMemo)((function(){return S?Ke(S):{}}),[S]),$=(0,N.useMemo)((function(){var e=[];return null==v||v.forEach((function(t){e.push(t.assignment)})),L(e),v||[]}),[v]);(0,N.useEffect)((function(){if(R.current!==B){var e=qe(G),t=[e];K([e.calcId]),u.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[P,(0,f.c)((0,f.c)({},k,t),"_disp_",Vl(Vl({},O),{},(0,f.c)({},k,[])))]])),R.current=B}}),[B,P,k,O,S,G]);var Y=(0,N.useCallback)((function(e,t,n){if($[e]){var r=(0,ce.cloneDeep)($),a=Vl(Vl({},r[e]),{},(0,f.c)({},t,n));return r[e]=a,r}return{}}),[$]),Q=(0,N.useCallback)((function(e,t,n){var r=Y(e,t,n);s(r)}),[Y,$]),X=(0,N.useCallback)((function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n||[],l=(0,p.c)(a,3),o=l[1],i=l[2];if("assignment"===o&&"object"===(0,sn.c)(i)){var c,d=i.label,s=i.value,v=[];if(O[k])(v=(0,ce.cloneDeep)(O[k]))[e]?v[e][o]=d:v=[(0,f.c)({},o,d)];else(v=rr()(c=new Array(e)).call(c,{}))[e]=(0,f.c)({},o,d);var m=Vl(Vl({},O),{},(0,f.c)({},k,v));u.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[P,(0,f.c)((0,f.c)({},k,Y(e,o,s)),"_disp_",m)]]))}else Q(e,o,i);return!0}),[Q,Y,k,O,P,$]),Z=(0,N.useCallback)((function(e){var t=(0,ce.cloneDeep)($),n=(0,ce.cloneDeep)(O[k]||[]);te()(t).call(t,e,1),n.length>0&&te()(n).call(n,e,1),u.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[P,(0,f.c)((0,f.c)({},k,t),"_disp_",Vl(Vl({},O),{},(0,f.c)({},k,n)))]]))}),[$]),ee=(0,N.useCallback)((function(){var e,t,n,r,a=qe(G),l=(0,ce.cloneDeep)(O[k]||[{}]);K(m()(e=[]).call(e,(0,j.c)(q||[]),[a.calcId])),s(m()(t=[]).call(t,(0,j.c)($),[a])),u.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[P,(0,f.c)((0,f.c)({},k,m()(n=[]).call(n,(0,j.c)($),[a])),"_disp_",Vl(Vl({},O),{},(0,f.c)({},k,m()(r=[]).call(r,(0,j.c)(l),[{}]))))]]))}),[q,$]),ne=(0,N.useCallback)((function(e,t){return C()(ql).some((function(n){var r,a;if(e[n]!==(null===(r=ql[n])||void 0===r?void 0:r.value)&&(null!==(a=ql[n])&&void 0!==a&&null!==(a=a.hideproperty)&&void 0!==a&&E()(a).call(a,t)))return!0;return!1}))}),[]);return I().createElement("div",{className:"".concat(y,"-calcsetting")},I().createElement(x.Collapse,{activeKey:q,onChange:z},g()($).call($,(function(e,t){var n,r,a=null==w||null===(n=w.msg)||void 0===n?void 0:n[e.calcId],o={};return a&&a.forEach((function(e){o[e.prop]=e.msg})),I().createElement(x.Collapse.Panel,{key:e.calcId,header:"运算".concat(t+1),panelKey:e.calcId,extra:$.length>1&&!l&&I().createElement(Kl,{onClick:function(){return Z(t)}}),assist:I().createElement(Ul,{value:Nr(e.assignment)?e.customVarName:(null===(r=O[k])||void 0===r||null===(r=r[t])||void 0===r?void 0:r.assignment)||""})},I().createElement("div",{className:"".concat(y,"-calcsetting-panel")},g()(S).call(S,(function(n){var r,a=n.Config,i=n.Number,c=(n.Actions,Vl({},e));delete c._Type_;var u=(0,_.c)({id:P,_disp_:O},c);if(ne(u,i))return null;if(l){var d,s=(null==n||null===(d=n.Config)||void 0===d?void 0:d.Editor)||{},f=Vl(Vl({},n),{},{Editor:s,Id:n.Number});if(!E()(hn).call(hn,null==s?void 0:s.Type)||void 0===u[f.Id])return I().createElement(pn,{className:"kdesigner-right-view",displayData:u,propertyData:f})}return I().createElement("div",{className:"".concat(y,"-calcsetting-panel-item"),key:i},I().createElement(T.PropertyViewItem,(0,_.c)({},a,n,{Id:i,field:Vl(Vl({},b),u),value:u[i],className:"kdesigner-right-view",enableMutiSelect:!1,variablesTree:J,readonly:M,displayLabel:null===(r=O[k])||void 0===r||null===(r=r[t])||void 0===r?void 0:r[i],assignments:W,onPropertyChange:function(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return X.apply(void 0,m()(e=[t]).call(e,r))},renderCustomError:function(e,t){return!0}})),o[i]&&I().createElement("span",{className:"".concat(y,"-error-msg")},o[i]))}))))}))),!M&&I().createElement(ze.BtnField,{major:!0,size:"small",icon:{prefix:"designericon",type:"zengjia-yuan2"},onClick:ee},"新增一条"))}));Hl.displayName="CalcSettingEditor";var Wl=(0,T.ErrorBoundaryWrap)(Hl,"CalcSettingEditor");function Ll(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function zl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ll(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Ll(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Jl="formula",Gl="${reset}",$l=ze.treeUtils.dfs,Yl=[{Id:Jl,Title:"运算公式",icon:"yunsuangongshi"},{Id:Gl,Title:"清空",icon:"qingchu",iconPrefix:"ncicon"}],Ql=[{Id:Jl,Title:"运算公式",icon:"yunsuangongshi"}],Xl=function e(t,n){var r=n;Array.isArray(n)||(r=[n]);for(var a=0;a<r.length;a++){var l=r[a];if(!l)return null;if(l.key===t)return l;var o=e(t,l.children);if(o)return o}return null},Zl=["refbill","user","org"],eo=function(e){var t=e.prefixCls;return I().createElement("div",{className:"".concat(t,"-combineselector-clear-value")},I().createElement(x.Icon,{type:"qingchu",prefix:"ncicon"}),I().createElement("span",{style:{marginLeft:"4px"}},"清空"))},to=(0,N.memo)((function(e){var t=e.placeholder,n=e.fieldKey,r=e.value,a=e.displayLabel,l=e.readonly,o=e.fieldType,c=e.inputProps,u=e.className,d=e.variablesTree,s=void 0===d?[]:d,f=e.actionType,v=e.fieldTree,y=void 0===v?[]:v,h=e.fieldProps,b=void 0===h?{}:h,C=e.varSelectProps,k=void 0===C?{}:C,x=e.expressionTitle,w=e.hideFunc,S=void 0!==w&&w,A=e.hideClearValueOptions,P=void 0!==A&&A,O=(e.onInputBlur,e.onInputFocus,e.onInputKeyDown,e.onInputClick),j=e.onVarSelectClear,B=e.onVarSelectChange,R=e.onExpressionConfirm,F=e.onInputClear,V=e.onInputChange,q=(0,N.useContext)(D),K=q.baseUrl,U=q.expressionData,H=q.getBaseHooks,W=q.batchInvoke,L=q.getControlText,z=q.prefixCls,J=H("useKDRefBill"),G=(0,N.useRef)(null),$=(0,N.useState)(!1),Y=(0,p.c)($,2),Q=Y[0],X=Y[1],Z=null==r?void 0:E()(r).call(r,"@@"),ee=It.some((function(e){return e.test(r)}))&&!Z,te=_t(o)?"refbill":o,ne=ee?"selectInput":Z?"formula":te,re=(0,N.useMemo)((function(){if(ee){var e=function(e,t){if(!e||!t)return"";for(var n="",r="",a=0,l=e.length;a<l;a++){var o=e[a],i=o.title,c=o.children;if(o.key===t){r=i;break}if(null!=c&&c.length){n=i;for(var u=0,d=c.length;u<d;u++){var s=c[u];if(s.key===t){r=s.title;break}}}}return n||r?ft(t,{parentId:n,title:r}):""}(s,r);return["",e,1]}if(Array.isArray(r))return r;var t=r||"",n=t.split("@@");return n.length>1?n:["",t,1]}),[r,s,ee]),ae=(0,p.c)(re,3),le=ae[1],oe=ae[2],ie=(0,N.useState)(ee),ce=(0,p.c)(ie,2),ue=ce[0],de=ce[1],se=(0,N.useState)(r),fe=(0,p.c)(se,2),pe=fe[0],ve=fe[1],me=(0,N.useState)(!1),ye=(0,p.c)(me,2),ge=ye[0],he=ye[1],Ee=(0,N.useRef)(null),be=(0,N.useState)(null),Ce=(0,p.c)(be,2),Ne=Ce[0],Ie=Ce[1];(0,N.useEffect)((function(){de(ee)}),[ee]),(0,N.useEffect)((function(){ge||r===pe||ve(r)}),[r,ge]);var Te=function(e){e!==r&&(Ee.current&&clearTimeout(Ee.current),Ee.current=setTimeout((function(){Ee.current=null,V(e)}),300))},ke=function(e){V(e),setTimeout((function(){he(!1)}),300)},xe=(0,N.useCallback)((function(e,t){return T.eventBus.on(e,t),function(){T.eventBus.off(e,t)}}),[]),_e=b.billEntityId,we=function(e,t){if(e){var n=i()(t),r=void 0===n?"":n,a=t.search,l=void 0===a?"":a,o=t.order_by,c=void 0===o?"":o,u=t.select,d=void 0===u?"":u,s=t.page_size,f=void 0===s?10:s,p=t.page_no,v=void 0===p?1:p,m=t.ids,y={filter:r,search:l,order_by:c,page_size:f,page_no:v,ids:void 0===m?[]:m};d&&(y.select=d),Ie(y),W("query","nocodewfdesigner",[e,y])}};(0,N.useEffect)((function(){_t(ne)&&we(_e,{page_size:10,page_no:1,search:"",select:b.displayProp,ids:b.isMulti?Array.isArray(r)?r:r?null==r?void 0:r.split(","):[]:r})}),[_e,ne,b]);var Me=(0,N.useMemo)((function(){return _t(ne)?b.isMulti?r?Array.isArray(r)?r:(null==r?void 0:r.split(","))||[]:[]:r||"":""}),[b.isMulti,r,ne]),Se=J({controlMeta:zl({allowClear:!0,entityId:_e,queryParams:Ne},b),onChange:function(e){var t;"string"==typeof e?t=e:Array.isArray(e)&&(t=e.join(",")),V(t)},baseUrl:K,batchInvoke:function(e,t){W(e,n,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[])},getControlText:L,addControlAction:xe,batchInvokeListConfig:function(){_e&&W("listconfig","nocodewfdesigner",[_e])},batchInvokeQuery:we,value:Me},!0),Ae=E()(Zl).call(Zl,ne)?Se:{},Pe=(0,N.useMemo)((function(){return(null==U?void 0:U.expression).functionTypes}),[null==U?void 0:U.expression]),De=(0,N.useMemo)((function(){var e=(null==U?void 0:U.expression).functionOperations;return Wa()(e)}),[null==U?void 0:U.expression]),Oe=(0,N.useMemo)((function(){return Z?{readOnly:!0,autofocus:!1,lang:oe,expressionData:Pe,fieldData:y,value:le}:{expressionData:[],fieldData:[]}}),[Z,oe,Pe,y,le]),je=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];null==B||B.apply(void 0,t)},Be=function(e){de(e)},Re=function(e){var t=e.key;if(t===Jl)X(!0);else if(t===Gl){ve(t),Te(t);var n=(G.current||{}).setPopperVisible;null==n||n(!1)}},Fe=function(e){return I().createElement(I().Fragment,null,I().createElement(nl,{value:r,options:P?Ql:Yl,onClick:Re}),e)},Ve=function(){null==j||j()},qe=(0,N.useMemo)((function(){if(Z)return null;var e=Array.isArray(r)?r:r?[r]:[],t=r===Gl?[I().createElement(eo,{prefixCls:z,key:Gl})]:i()(e).call(e,(function(e){return!!$l(s,(function(t){return t.key===e}))}));return zl({type:"treeSelect",defaultExpandAll:!1,expandKeys:hl(s,t),showSearch:!0,data:s,varSelectActive:ue,selectedKeys:t,isVar:ee,readonly:l,onSelect:je,onClear:Ve,onVarSelectActive:Be,dropdownRender:Fe},k)}),[s,r,ue,Z,l,ee,k,je,Be,Fe,Ve]),Ke=(0,N.useMemo)((function(){return"date"===ne&&pe&&!l?new Date(pe):"combo"===ne&&null!=b&&b.isMulti&&pe&&!Z?r?Array.isArray(pe)?pe:null==pe?void 0:pe.split(","):Array.isArray(r)?r:null==r?void 0:r.split(","):pe}),[pe,ne,s,l]),Ue=(0,N.useMemo)((function(){return"textarea"===ne?{autoSize:!0,style:{maxHeight:"480px"},className:"".concat(z,"-combineselector-textarea")}:{}}),[ne]);if(l){if(ee){if(r===Gl)return I().createElement(eo,{prefixCls:z});var He,We=Xl(Ke,s)||{},Le=We.title,Je=We.titlePrefix;return Le&&Je?m()(He="".concat(Je)).call(He,Le):""}if("combo"===ne){var Ge=c.options;if(Array.isArray(Ge)){var $e;if(b.isMulti){var Ye,Qe=Array.isArray(Ke)?Ke:null==Ke?void 0:Ke.split(",");return(null==Qe?void 0:Qe.length)>0&&(null===(Ye=i()(Ge).call(Ge,(function(e){return null==Qe?void 0:E()(Qe).call(Qe,e.value)})))||void 0===Ye?void 0:g()(Ye).call(Ye,(function(e){return e.label})).join(","))||"-"}return(null===($e=M()(Ge).call(Ge,(function(e){return e.value===Ke})))||void 0===$e?void 0:$e.label)||"-"}}if("formula"!==ne)return I().createElement("span",{className:"".concat(z,"-combineselector-display")},void 0!==a?a:r||"-")}var Xe="combo"===ne&&!0===(null==b?void 0:b.isMulti)?{mode:"multiple"}:{};return I().createElement(I().Fragment,null,I().createElement(ze.InputCombo,(0,_.c)({ref:G,isDefaultInput:!0,showVarSelect:!0,allowClear:!0,placeholder:t,fieldType:ne,value:Ke,varSelectProps:qe,onClick:function(){null==O||O(),X(!0)},onInputKeyDown:function(e){13===e.nativeEvent.keyCode&&ke(e)},onInputFocus:function(){he(!0)},onInputBlur:ke,onChange:function(e){var t=null!=e&&e.target?e.target.value:e;ve(t),Te(t)},onClear:F,readonly:l,className:u,formulaClassName:ne===Jl?"formula":""},b,c,Oe,Ae,Xe,Ue)),I().createElement(ze.Condition,{value:Z?le:"",language:oe,fieldData:y,defaultExpandAll:!1,expressionData:Pe,operations:De,actionType:f,modalTitle:"变量赋值",editorTitle:x,hideFunc:S,visible:Q,onClose:function(){return X(!1)},onConfirm:function(){X(!1);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];null==R||R.apply(void 0,t)}}))}));to.displayName="CombineSelector";var no=to;function ro(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ao(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ro(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):ro(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var lo=function e(t,n){var r=n;Array.isArray(n)||(r=[n]);for(var a=0;a<r.length;a++){var l=r[a];if(!l)return null;if(l.key===t)return l;var o=e(t,l.children);if(o)return o}return null},oo=["user","org","refbill"],io=(0,N.memo)((function(e){var t,n,r=(0,N.useState)(!1),a=(0,p.c)(r,2),l=(a[0],a[1],(0,N.useContext)(D)),o=(l.invokeAction,l.getKdesignerApi,l.getPreNodeVariablesById),i=(l.expressionData,l.getControlText),c=e.handleChange,u=e.className,d=e.editor,s=e.Name,f=e.Tips,v=e.field,m=e.id,y=e.actionType,h=e.readonly,b=e.displayLabel,C=e.propName,k=(d.Enum,d.NameHidden),x=(d.Default,d.Required),_=d.Title,w=d.Placeholder,M=(v.id,v._disp_,v.assignment),S=v.customVarType,A=v._Type_,P=v.refNodeId,O=ze.ListFilterUtil.filterVariablesTreeFlow,j=s,B=e.value,R=E()(t=["url","json","accessTokenUrl"]).call(t,C)?"textarea":"text",F=(0,N.useMemo)((function(){return o(m)}),[m,o]),V=function(e,t){if(e){var n=lo(t,e);if(n){var r=null==n?void 0:n.type;if(null!=r&&le()(r).call(r,"combo")){var a,l=null==n||null===(a=n.option)||void 0===a||null===(a=a.valueItems)||void 0===a?void 0:g()(a).call(a,(function(e){var t="string"==typeof e.name?e.name:i(e.name);return ao(ao({},e),{},{label:t})}));return q.current=ao(ao({},q.current),{},{options:l}),ao(ao({},n),{},{type:"combo"})}return j=(null==n?void 0:n.label)||(null==n?void 0:n.title),n}}return"text"},q=(0,N.useRef)({}),K=(0,N.useRef)(M),U=(0,N.useState)({}),H=(0,p.c)(U,2),W=H[0],L=H[1];(0,N.useEffect)((function(){var e=gl((0,ce.cloneDeep)(F)),t=V(e,M);if(K.current!==M)if(K.current=M,Tt(B)){var n,r,a=O(F,{type:(null==t?void 0:t.type)||S||"text",canMulit:!0,id:M,entityId:null==t||null===(n=t.option)||void 0===n?void 0:n.billEntityId,isMulti:(null==t||null===(r=t.option)||void 0===r?void 0:r.isMulti)||!1}),l=!1;a.forEach((function(e){var t=null==e?void 0:e.children;t&&t.forEach((function(e){e.key===B&&(l=!0)})),e.key===B&&(l=!0)})),l||c(void 0)}else c(void 0);L(t)}),[M,F]);var z,J=(0,N.useCallback)((function(e,t){1===e.length&&c(e[0])}),[c]),G=(0,N.useCallback)((function(e){var t=null!=e&&e.target?e.target.value:e;null==c||c(Array.isArray(t)?t.join(","):t)}),[c]),$=function(){c(void 0)},Y=(0,N.useMemo)((function(){return o(m)}),[m,o]),Q=(0,N.useCallback)((function(e,t){if(!e)return c("");var n=pt(e,t);c(n)}),[c,B]),X=(0,N.useMemo)((function(){var e,t;if(Be(A)){var n=El((0,ce.cloneDeep)(F),(function(e){var t;return!E()(oo).call(oo,null==e?void 0:e.type)||!(null!=e&&null!==(t=e.option)&&void 0!==t&&t.isMulti)}));return gl(n,(function(e){return yl(e,P)}))}var r=gl((0,ce.cloneDeep)(F),(function(e){return yl(e,P)}));return O(r,{type:(null==W?void 0:W.type)||S||"text",canMulit:!0,id:M,entityId:null==W||null===(e=W.option)||void 0===e?void 0:e.billEntityId,isMulti:(null==W||null===(t=W.option)||void 0===t?void 0:t.isMulti)||!1})}),[F,W,S,M,A,P]);return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:k,className:u,name:s,tips:f,required:x,title:_}),I().createElement(no,{placeholder:w,value:void 0===B&&null!=W&&null!==(n=W.option)&&void 0!==n&&n.isMulti&&wt(null==W?void 0:W.type)?[]:B,fieldType:(null==W?void 0:W.type)||R,fieldProps:null==W?void 0:W.option,inputProps:q.current,variablesTree:X,actionType:y,className:"".concat(u,"-newsetting-value"),fieldTree:Y,readonly:h,displayLabel:b,expressionTitle:j,hideFunc:!1,hideClearValueOptions:Be(A)||(z=M,"$assignment"===z),onInputChange:G,onInputClear:$,onVarSelectClear:$,onVarSelectChange:J,onExpressionConfirm:Q}))}));io.displayName="CombineSelectorEditor";var co=(0,T.ErrorBoundaryWrap)(io,"CombineSelectorEditor");function uo(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function so(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uo(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):uo(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var fo=(ze.treeUtils||{}).dfs,po=(0,N.memo)((function(e){var t,n=e.className,r=e.assignment,a=e.expression,l=e.error,o=e.value,i=e.displayLabel,c=e.caption,u=e.id,d=e.option,s=void 0===d?{}:d,f=e.type,p=e.readonly,v=e.variablesTree,y=e.onInputChange,h=e.onInputClear,E=e.onVarSelectChange,b=e.onVarSelectClear,C=e.onExpressionConfirm,k=e.editorType,x=(0,N.useContext)(D).getControlText,_=ze.ListFilterUtil.filterVariablesTreeFlow,w=s.required,S=f,A={};if(null!=f&&le()(f).call(f,"combo")){var P,O=null==s||null===(P=s.valueItems)||void 0===P?void 0:g()(P).call(P,(function(e){return so(so({},e),{},{label:x(e.name)})}));A=so(so({},A),{},{options:O,allowClear:!0}),S="combo"}var j=Array.isArray(o)?M()(o).call(o,(function(e){return e[r]===u})):{},B=p?o:(null==j?void 0:j[a])||void 0,R=null==l?void 0:l[null==j?void 0:j.calcId];return I().createElement("div",{className:"".concat(n,"-newsetting-item"),key:u},I().createElement(T.NameTipWrapper,{className:n,name:c,required:w}),I().createElement(no,{fieldKey:u,readonly:p,fieldType:S,value:B,displayLabel:i,inputProps:A,variablesTree:_(v,{type:f,id:u,entityId:null==s?void 0:s.billEntityId,canMulit:!0,isMulti:(null==s?void 0:s.isMulti)||!1,flowEditorType:k}),fieldTree:v,fieldProps:s,className:"".concat(n,"-newsetting-value"),expressionTitle:c,hideClearValueOptions:!0,onInputClear:function(e){e&&(null==e||e.stopPropagation()),null==h||h(u)},onInputChange:function(e){null!=e&&e.target?null==y||y(u,e.target.value):null==y||y(u,e)},onVarSelectChange:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];null==E||E.apply(void 0,m()(e=[u]).call(e,n))},onVarSelectClear:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];null==b||b.apply(void 0,m()(e=[u]).call(e,n))},onExpressionConfirm:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];null==C||C.apply(void 0,m()(e=[u]).call(e,n))}}),R&&I().createElement("span",{className:"".concat(n,"-error-msg")},null===(t=R[0])||void 0===t?void 0:t.msg))}));po.displayName="NewsettingItem";var vo=(0,N.memo)((function(e){var t,n=e.field,r=e.id,a=e.propName,l=(e.actionType,e.modalTitle,e.locked,e.Name),o=e.handleChange,i=e.value,c=e.editor,u=e.Tips,d=e.className,s=e.error,v=e.readonly,m=c.NameHidden,y=c.Required,h=(c.HideFunc,c.HasCheck,c.Placeholder,c.ChildProperty),b=c.Title,C=n.formId,k=n._disp_,x=n.newMode,w=n.loopby,S=(0,N.useContext)(D),A=S.invokeAction,P=S.getPreNodeVariablesById,O=(0,N.useRef)(C),j=(0,N.useState)([]),B=(0,p.c)(j,2),R=B[0],F=B[1],V=(0,N.useRef)(w),q=(0,N.useRef)(x),K=(0,N.useMemo)((function(){var e;return null===(e=h[0])||void 0===e?void 0:e.Number}),[h]),U=(0,N.useMemo)((function(){var e;return null===(e=h[1])||void 0===e?void 0:e.Number}),[h]),H=(0,N.useMemo)((function(){var e=P(r);return gl(e,(function(e){return yl(e,w)}))}),[r,P,x,w]),W=(0,N.useCallback)((function(e){A("click",[r,"refbillProps",e,{}])}),[r,a]),L=(0,N.useCallback)((function(e){Array.isArray(e)&&(F(e),o(g()(e).call(e,(function(e){var t=e.id,n=M()(i).call(i,(function(e){return e[K]===t}))||{};return(0,f.c)((0,f.c)((0,f.c)({},K,t),U,null==n?void 0:n[U]),"calcId",(null==n?void 0:n.calcId)||(0,T.createUUid)())}))))}),[o,C,i]);(0,N.useEffect)((function(){return T.eventBus.on("setRefbillProps",L),function(){T.eventBus.off("setRefbillProps",L)}}),[L]),(0,N.useEffect)((function(){O.current!==C&&(O.current=C),C?W(C):F([])}),[C,O]);var z=function(){o(g()(i).call(i,(function(e){if(e[U]&&(Tt(e[U])||Nt(e[U]))&&!fo(H,(function(t){return Tt(e[U])?e[U]===t.key:!!Nt(e[U])&&(null===(n=e[U])||void 0===n?void 0:E()(n).call(n,t.key));var n})))return so(so({},e),{},(0,f.c)({},U,void 0));return e})))};(0,N.useEffect)((function(){V.current!==w&&(V.current=w,z())}),[w]),(0,N.useEffect)((function(){q.current!==x&&(q.current=x,z())}),[x]);var J=function(e,t){o(g()(i).call(i,(function(n){return n[K]===e?Array.isArray(t)?so(so({},n),{},(0,f.c)({},U,t.join(","))):so(so({},n),{},(0,f.c)({},U,t)):n})))},G=function(e,t){1===t.length&&o(g()(i).call(i,(function(n){return n[K]===e?so(so({},n),{},(0,f.c)({},U,t[0])):n})))},$=(0,N.useCallback)((function(e,t,n){if(!t)return o(g()(i).call(i,(function(t){return t[K]===e?so(so({},t),{},(0,f.c)({},U,"")):t})));o(g()(i).call(i,(function(r){return r[K]===e?so(so({},r),{},(0,f.c)({},U,pt(t,n))):r})))}),[o,i]),Y=function(e){o(g()(i).call(i,(function(t){return t[K]===e?so(so({},t),{},(0,f.c)({},U,void 0)):t})))};return I().createElement("div",{className:"".concat(d,"-newsetting")},I().createElement(T.NameTipWrapper,{nameHidden:m,className:d,name:l,tips:u,required:y,title:b}),I().createElement("div",null,v?null==k||null===(t=k[a])||void 0===t?void 0:g()(t).call(t,(function(e,t){return I().createElement(po,{key:t,className:"".concat(d),variablesTree:H,value:e[U],caption:e[K],readonly:v})})):g()(R).call(R,(function(e,t){var n,r,l;return I().createElement(po,(0,_.c)({key:null==e?void 0:e.id,className:"".concat(d),variablesTree:H,assignment:K,expression:U,value:i,error:(null==s?void 0:s.msg)||{},readonly:v,displayLabel:null===(n=k[a])||void 0===n||null===(n=n[t])||void 0===n?void 0:n.expression},e,{type:null!==(r=be[null===(l=e.option)||void 0===l?void 0:l.editorType])&&void 0!==r?r:e.type,onInputClear:Y,onInputChange:J,onVarSelectChange:G,onVarSelectClear:Y,onExpressionConfirm:$,editorType:c.type}))}))))}));vo.displayName="NewSettingEditor";var mo=(0,T.ErrorBoundaryWrap)(vo,"NewSettingEditor"),yo=n(52892),go=n.n(yo);function ho(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,n=(0,N.useRef)({fn:e,timer:null}).current;return(0,N.useEffect)((function(){n.fn=e}),[e]),(0,N.useCallback)((function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){n.fn.apply(n,r)}),t)}),[e])}function Eo(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function bo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Eo(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Eo(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Co=(0,N.memo)((function(e){var t=e.id,n=e.handleChange,r=e.className,a=e.editor,l=e.Name,o=e.Tips,c=e.field,u=e.readonly,d=e.value,s=void 0===d?[]:d,f=a.NameHidden,v=a.Required,m=a.Title,y=(0,N.useContext)(D),h=(y.getKdesignerApi,y.getPreNodeVariablesById),b=y.compareType,C=y.getControlText,T=(y.batchInvoke,y.baseUrl,(0,N.useRef)(new(go()))),k=(0,N.useRef)({}),x=(0,N.useRef)({}),_=(0,N.useRef)(s),w=(0,N.useState)(s),M=(0,p.c)(w,2),S=M[0],A=M[1],P=ho(n),O=c.Key,B=_l({fieldKey:O});(0,N.useEffect)((function(){A((function(e){return(0,ce.isEqual)(e,s)?e:(_.current=s,s)}))}),[s]);var R=(0,N.useCallback)((function(e){e.forEach((function(e){var t,n,r=bo(bo({},e),{},{children:[]});if(x.current[r.key]=r,null!==(t=e.type)&&void 0!==t&&E()(t).call(t,"combo")){var a,l=null==e||null===(a=e.option)||void 0===a||null===(a=a.valueItems)||void 0===a?void 0:g()(a).call(a,(function(e){return{value:e.value,name:"string"==typeof e.name?{zh_CN:e.name}:e.name}}));x.current[e.value]=bo(bo({},e),{},{valueItems:l})}else x.current[e.value]=e;null!=e&&null!==(n=e.children)&&void 0!==n&&n.length&&R(e.children)}))}),[]),F=(0,N.useMemo)((function(){var e=h(t,"",(function(e){var t,n,r;return!(null!==(t=e.option)&&void 0!==t&&t.canJudge&&(null==e||null===(n=e.option)||void 0===n||null===(n=n.children)||void 0===n||!n.length))&&!1!==(null===(r=e.option)||void 0===r?void 0:r.canJudge)})),n=gl(e,(function(e){return yl(e,"")}));return x.current={},R(n),e}),[h,t,R]),V=(0,N.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e)return[];var n=null==e?void 0:e.toLocaleLowerCase(),r=null!=n&&E()(n).call(n,"combo")?"combo":n;return Et({compareTypesMap:b,type:r,entityId:t})}),[b]),q=(0,N.useMemo)((function(){return T.current=new(go()),null==S?void 0:g()(S).call(S,(function(e){var t=x.current[e.fieldName];if(t){var n,r,a=e.compareType;E()(n=Wa()(be)).call(n,t.type)&&Ce[e.compareType]&&(a=Ce[e.compareType]);var l=JSON.parse(e.value),o=t||{},c=o.title,u=o.option,d=V(null==t?void 0:t.type,(null==u?void 0:u.billEntityId)||""),s=C(null===(r=i()(d).call(d,(function(t){return t.id===e.compareType}))[0])||void 0===r?void 0:r.name),f=x.current[e.fieldName].valueItems,p=bo(bo({},e),{},{compareType:a,value:l,compareTypes:d,fieldCaption:c,compareTypeCaption:s,items:f},u);return null!=u&&u.billEntityId&&(p=bo(bo(bo({},p),u),{},{entityId:null==u?void 0:u.billEntityId})),T.current.set(e.fieldName,p),p}return bo(bo({},e),{},{fieldName:"",compareType:"",compareTypes:[],value:[]})}))}),[S,V]),K=(0,N.useCallback)((function(e){var t,n="string"==typeof e?x.current[e]:e;if(n){var r=n.value,a=n.type;return{_Type_:"FilterItem",fieldName:r,compareType:(null===(t=V(a)[0])||void 0===t?void 0:t.id)||"",value:Zt()([])}}}),[b]),U=(0,N.useCallback)((function(e){var t=g()(e).call(e,(function(e,t){var n,r=(null===(n=_.current)||void 0===n?void 0:n[t])||{},a=e.compareType||"",l=Array.isArray(e.fieldName)?e.fieldName[0]:e.fieldName,o=Zt()(e.value);if(!a&&r.fieldName!==l){var i,c=(x.current[l]||{}).type;a=(null===(i=V(c))||void 0===i||null===(i=i[0])||void 0===i?void 0:i.id)||""}return l&&a||(o="[]"),bo(bo({},e),{},{fieldName:l,compareType:a,value:o})}));_.current=t,P(t),A(t)}),[P]),H=(0,N.useCallback)((function(e,t){t.checked;var n=t.node,r=(t.event,null==n?void 0:n.key);if(!r)return!1;var a=K(n),l=a._Type_,o=a.compareType,i=a.value,c=(0,j.c)(S)||[];return c.push({_Type_:l,fieldName:r,compareType:o,value:i}),P(c),A(c),!0}),[S,P,K]),W=(0,N.useCallback)((function(e){var t=e.value;if(null!=t&&t.length){var n,r=i()(n=g()(t).call(t,(function(e){return e.fieldValue}))).call(n,Boolean);return{expandKeys:hl(F,r)}}return{}}),[F]);return I().createElement("div",{className:"".concat(r,"-judge-filter-editor")},I().createElement(ze.FilterEditor,{tips:o,readonly:u,name:l,required:v,nameHidden:f,title:m,value:q,variablesTree:F,fieldRecords:k.current,listFilterConfig:F,filterFooterData:{listType:"tree",triggerText:"添加判断条件",treeProps:{defaultExpandAll:!1},onChange:H},valueData:{allowExistValueNotInOption:!1,className:"".concat(r,"-filter_value")},fieldData:{fieldType:"treeSelect",enableFilterDataTransform:!1,flowEditorType:a.Type},refBillProps:B,onChange:U,getVarSelectProps:W}))}));Co.displayName="JudgeEditor";var No=(0,T.ErrorBoundaryWrap)(Co,"JudgeEditor");function Io(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function To(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Io(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Io(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}function ko(e,t){var n=void 0!==ul()&&sl()(e)||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return xo(e,t);var r=ie()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return il()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xo(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,l=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw l}}}}function xo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var _o=function(e,t,n){return I().createElement("div",{title:e,className:"table-cell-render"},e)},wo=function(e){switch(e){case"gender":return 60;case"phone":return 116;default:return 178}},Mo=(0,N.memo)((function(e){var t=e.value,n=e.onChange,r=e.activeMenu,a=r.id,l=r.type,o=r.formNumber,c=r.name,u=(0,N.useContext)(D),d=u.invokeAction,s=u.getDesignerDataRef,f=(0,N.useState)({page_size:10,page_no:1}),v=(0,p.c)(f,2),y=v[0],h=v[1],b=(0,N.useState)([]),C=(0,p.c)(b,2),k=C[0],_=C[1],w=(0,N.useState)(0),S=(0,p.c)(w,2),A=S[0],P=S[1],O=(0,N.useState)(""),B=(0,p.c)(O,2),R=B[0],F=B[1],V=(0,N.useState)(""),q=(0,p.c)(V,2),K=q[0],U=q[1],H=(0,N.useState)(t),W=(0,p.c)(H,2),L=W[0],z=W[1],J=(0,N.useRef)(!1),G=function(e,t){h({page_size:t,page_no:e})},$=function(e,t,r,u){var d;if(J.current){var s=M()(k).call(k,(function(e){return e.id===t}));switch(u){case"check-all":var f,p=(0,j.c)(L),v=ko(k);try{var y=function(){var e,t=f.value,n=t.id,r=t.name;M()(p).call(p,(function(e){return e.menuId===a&&e.id===n}))||p.push({menuId:a,formNumber:o,menuType:l,id:n,name:m()(e="[".concat(c,"] ")).call(e,r)})};for(v.s();!(f=v.n()).done;)y()}catch(e){v.e(e)}finally{v.f()}z(p),null==n||n(p);break;case"uncheck-all":var h=(null==k?void 0:g()(k).call(k,(function(e){return e.id})))||[],b=i()(L).call(L,(function(e){return e.menuId!==a||!E()(h).call(h,e.id)}));z(b),null==n||n(b);break;case"check":var C=m()(L).call(L,{menuId:a,formNumber:o,menuType:l,id:s.id,name:m()(d="[".concat(c,"] ")).call(d,s.name)});z(C),null==n||n(C);break;case"uncheck":var N=i()(L).call(L,(function(e){return e.menuId!==a||e.id!==s.id}));z(N),null==n||n(N)}}},Y=function(e){var t=e.data,n=void 0===t?{}:t,r=n.rows,a=void 0===r?[]:r,l=n.totalCount,o=void 0===l?0:l;_(a),P(o),J.current=!0},Q=(0,N.useCallback)((0,$t.c)(Qt().mark((function e(){var t,n;return Qt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l){e.next=2;break}return e.abrupt("return");case 2:t=[o,l,a,To(To({},y),{},{search:K})],n=[{nocodewfdesigner:s()}],d("queryApproverData",t,n);case 5:case"end":return e.stop()}}),e)}))),[K,l,y,o,a]),X=(0,N.useCallback)((function(e){U(e),h(To(To({},y),{},{page_no:1}))}),[U,h]),Z=(0,T.useDebounce)(X,500);(0,N.useEffect)((function(){(0,ce.isEqual)(t,L)||z(t)}),[t]),(0,N.useEffect)((function(){l&&(F(""),U(""),(0,ce.isEqual)(y,{page_no:1,page_size:10})||h({page_no:1,page_size:10}),J.current=!1)}),[l]),(0,N.useEffect)((function(){return T.eventBus.on("setQuery",Y),function(){T.eventBus.off("setQuery",Y)}}),[]),(0,N.useEffect)((function(){Q()}),[Q]);var ee=(0,N.useMemo)((function(){var e;return g()(e=i()(L).call(L,(function(e){return e.menuId===a}))).call(e,(function(e){return e.id}))}),[L,r]),te=(0,N.useMemo)((function(){var e;return g()(e=(null==r?void 0:r.listItemConfig)||[]).call(e,(function(e){var t=e.number;return{code:t,name:e.name,width:e.width||wo(t),render:_o}}))}),[r]);return I().createElement("div",{className:"main-area"},I().createElement("div",{className:"table-search"},I().createElement(x.Input,{value:R,placeholder:"搜索",borderType:"bordered",prefix:I().createElement(x.Icon,{prefix:"nocodeplatformicon",type:"sousuo"}),size:"small",onChange:function(e){F(e.target.value),Z(e.target.value)},allowClear:!0})),I().createElement("div",{className:"table-body"},I().createElement(ze.DataGrid,{style:{height:"100%"},columns:te,showSelected:!0,dataSource:k,onRowSelectChange:$,onPageChange:G,rowSelection:{type:"checkbox",value:ee||[],highlightRowWhenSelected:!0,column:{lock:!0},onChange:$,clickArea:"row"},primaryKey:"id"})),I().createElement("div",{className:"table-pagination"},I().createElement(x.Pagination,{pageType:"nicety",current:y.page_no,showQuickJumper:!1,pageSize:y.page_size,onChange:G,total:A||0,dropdownProps:{getPopupContainer:function(){return document.body}},showSizeChanger:!0})))}));Mo.displayName="ApproverDataGrid";var So=Mo;function Ao(){var e=(0,N.useState)((function(){var e=window;return{width:e.innerWidth,height:e.innerHeight}})),t=(0,p.c)(e,2),n=t[0],r=t[1],a=function(e){var t=e.width,n=e.height;r({width:t,height:n})};return(0,N.useEffect)((function(){var e,t,n,r=(e=document.body,t=a,(n=new ue.c((function(e){var n=e[0].contentRect,r=n.width,a=n.height;t&&t({hide:0===r&&0===a,width:r,height:a})}))).observe(e),{removeResizeObserve:function(){n.disconnect(e),n=null}});return function(){r&&r.removeResizeObserve()}}),[]),n}var Po=function(e){var t=e.data,n=e.onDelete,r=e.onClearAll;return I().createElement("div",{className:"right-area"},I().createElement("header",{className:"list-header"},I().createElement("div",{className:"select-count"},"已选（","".concat((null==t?void 0:t.length)||0),"）"),I().createElement("div",{className:"clear-btn",onClick:r},"清空")),I().createElement("div",{className:"select-list"},null==t?void 0:g()(t).call(t,(function(e){var t,r=e.name,a=e.id,l=e.menuId,o=Mt(r),i=o.title,c=o.titlePrefix;return I().createElement("div",{className:"select-item",key:m()(t="".concat(l,"-")).call(t,a)},I().createElement("div",{className:"user-name",title:r},I().createElement("span",{className:"name-prefix"},c),i),I().createElement("div",{className:"delete-btn",onClick:function(t){return n(e)}},I().createElement(x.Icon,{prefix:"designericon",type:"shanchu"})))}))))},Do=function(e){var t=e.menu,n=e.activeMenuId,r=e.onChange;return I().createElement("div",{className:"type-list"},null==t?void 0:g()(t).call(t,(function(e){var t,a=e.name,l=e.id,o=e.menuId;return I().createElement("div",{className:mn()("type-item",{"is-active":n===l}),key:m()(t="".concat(o,"-")).call(t,l),onClick:function(){return null==r?void 0:r(l)}},a)})))},Oo=function(e){var t=e.prefixCls,n=e.onCancel,r=e.onConfirm;return I().createElement("div",{className:"".concat(t,"-modal-footer")},I().createElement(x.Button,{onClick:n,type:"second",size:"small",className:"".concat(t,"-modal-cancel-btn")},"取消"),I().createElement(x.Button,{type:"primary",size:"small",style:{marginLeft:"12px"},onClick:r,className:"".concat(t,"-modal-ok-btn")},"确定"))},jo=(0,N.forwardRef)((function(e,t){var n,r=e.prefixCls,a=e.value,l=e.menu,o=(0,N.useState)(null===(n=l[0])||void 0===n?void 0:n.id),c=(0,p.c)(o,2),u=c[0],d=c[1],s=(0,N.useState)(a||[]),f=(0,p.c)(s,2),v=f[0],m=f[1];(0,N.useEffect)((function(){var e;d(null===(e=l[0])||void 0===e?void 0:e.id)}),[l]),(0,N.useImperativeHandle)(t,(function(){return{users:v}}),[v]);var y=(0,N.useMemo)((function(){return u?M()(l).call(l,(function(e){return e.id===u})):{}}),[u]);return I().createElement("div",{className:"".concat(r,"-modal-body")},I().createElement(x.SplitPanel,{className:"".concat(r,"_content_split"),defaultSplit:.2553191489361702,min:"240px",firstSlot:I().createElement(Do,{activeMenuId:u,menu:l,onChange:function(e){d(e)}}),secondSlot:I().createElement(So,{activeMenu:y,value:v,onChange:m})}),I().createElement(Po,{data:v,onDelete:function(e){var t=e.id,n=e.menuId;m((function(e){return i()(e).call(e,(function(e){return e.id!==t||e.menuId!==n}))}))},onClearAll:function(){m([])}}))})),Bo=function(e){var t=e.height,n=e.min,r=e.max;return t>r?r:t<n?n:t},Ro=function(e){var t=e.prefixCls,n=e.value,r=e.title,a=e.visible,l=e.setVisible,o=e.menu,i=e.onConfirm,c=Ao().height,u=(0,N.useState)(Bo({height:c-64,min:520,max:1080})),d=(0,p.c)(u,2),s=d[0],f=d[1],v=(0,N.useRef)(null),m=ho(f),y=function(){l(!1)};return(0,N.useEffect)((function(){var e=Bo({height:c-64,min:520,max:1080});e%2!=0&&m(e-1)}),[c]),I().createElement(x.Modal,{mask:!0,visible:a,body:I().createElement(jo,{ref:v,value:n,prefixCls:t,menu:o}),titleIcon:null,className:"".concat(t,"-modal"),footer:I().createElement(Oo,{prefixCls:t,onConfirm:function(){var e=v.current.users;null==i||i(e),l(!1)},onCancel:y}),maskClosable:!1,width:1180,height:s,keyboard:!1,title:r,closable:!0,draggable:!1,destroyOnClose:!0,onCancel:y,onOk:y})},Fo=function(e){var t=e.readonly,n=e.prefixCls,r=e.value,a=e.placeholder,l=e.onClick,o=e.onRemove;return I().createElement("div",{className:mn()("".concat(n,"-editor-trigger"),(0,f.c)({},"".concat(n,"-editor-trigger-readonly"),t)),onClick:l},I().createElement("div",{className:"trigger-content"},(null==r?void 0:r.length)>0?g()(r).call(r,(function(e){var r,a,l=e.name,i=e.id,c=e.menuId,u=Mt(l),d=u.title,s=u.titlePrefix;return I().createElement(x.Tooltip,{tip:m()(r="完整路径：".concat(s)).call(r,d),mouseEnterDelay:.3},I().createElement(x.Tag,{type:"edit",className:"".concat(n,"-select-tag"),key:m()(a="".concat(c,"-")).call(a,i),closable:!0,onClose:function(n){return function(e,n){e.preventDefault(),e.stopPropagation(),t||null==o||o(n)}(n,e)},"data-tag":i},I().createElement("span",{className:"".concat(n,"-select-tag-prefix")},s),d))})):I().createElement("span",{className:"trigger-placeholder"},a)),I().createElement("div",{className:"trigger-suffix"},I().createElement(x.Icon,{prefix:"designericon",type:"gengduo",style:t?{}:{cursor:"pointer"}})))};function Vo(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function qo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vo(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Vo(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Ko=(0,T.ErrorBoundaryWrap)((function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.editor,l=e.locked,o=e.Name,c=e.Tips,u=e.readonly,d=e.field,s=a.NameHidden,v=a.Required,m=a.Title,y=(0,N.useState)(!1),h=(0,p.c)(y,2),E=h[0],b=h[1],C=(0,N.useContext)(D),k=C.prefixCls,x=C.invokeApi,_=(0,N.useState)([]),w=(0,p.c)(_,2),S=w[0],A=w[1],P=(0,N.useState)({}),O=(0,p.c)(P,2),j=O[0],B=O[1],R=d.id,F=function(e){var r,a=e.data,l=void 0===a?[]:a;A(l);var o,c=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce((function(e,t){return qo(qo({},e),{},(0,f.c)({},t.id,t))}),{});return null==e?void 0:g()(e).call(e,(function(e){var n=t[e.menuId];return n?qo(qo({},e),{},{name:e.name.replace(/\S+（/,"[".concat(n.name,"（")).replace(/\S+\]/,"[".concat(n.name,"]"))}):e}))}((null===(o=n,r="[object Object]"===Object.prototype.toString.call(o)?o:{})||void 0===r?void 0:r.sourceData)||[],l),u=function(e,t){if(null==e||!e.sourceData)return e;var n=e.sourceData,r=void 0===n?[]:n,a=i()(r).call(r,(function(e){var n=e.menuId,r=e.formNumber;return M()(t).call(t,(function(e){return e.id===n&&e.formNumber===r}))}));return qo(qo({},e),{},{sourceData:a})}(qo(qo({},n),{},{sourceData:c}),l);(0,ce.isEqual)(u,j)||(B(u),t(u))};(0,N.useEffect)((function(){return x.getUserSelectMenu([R]),T.eventBus.on("approverMenu",F),function(){T.eventBus.off("approverMenu",F)}}),[]);var V="".concat(k,"-user-f7");return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:s,className:r,name:o,tips:c,required:v,title:m}),I().createElement(Fo,{readonly:u,value:j.sourceData||[],prefixCls:k,placeholder:"请选择",onClick:function(){l||u||b(!0)},onRemove:function(e){var n=e.id,r=e.menuId,a=j.sourceData,l=i()(a).call(a,(function(e){return e.id!==n||e.menuId!==r})),o=qo(qo({},j),{},{sourceData:l});B(o),t(o)}}),I().createElement(Ro,{prefixCls:V,value:j.sourceData||[],visible:E,setVisible:b,menu:S,onConfirm:function(e){var n=qo(qo({},j),{},{sourceData:e});(0,ce.isEqual)(n,j)||(B(n),t(n))},title:"请选择"}))}),"UserSelectEditor"),Uo=n(28429),Ho=n.n(Uo),Wo=["label","value","children","icon"];function Lo(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function zo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lo(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Lo(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Jo=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t?g()(t).call(t,(function(t){var r=t.label,a=t.value,l=t.children,o=t.icon,i=zo(zo({key:a,title:r},(0,Q.c)(t,Wo)),n);return o&&(i.icon=o),l?(l.length&&(i.children=e(l)),i.checkable=!1):i.isLeaf=!0,i})):t},Go=ze.treeUtils.dfs,$o=[F],Yo=(0,N.memo)((function(e){e.handleChange;var t=e.value,n=e.className,r=e.editor,a=(e.locked,e.Name),l=e.Tips,o=e.field,c=e.id,u=e.propName,d=r.NameHidden,s=r.Required,v=r.needsync,m=r.Title,y=r.Type,h=r.SubTitle,b=r.RefProp,C=r.Source,k=r.ExpandAll,_=o._disp_,w=o.id,M=o._Type_,S=o.published,A=o.SelectBillPid,P=o.setting,j=o[C],B=(0,N.useContext)(D),R=B.invokeAction,F=B.getKdesignerApi,V=B.prefixCls,q=(0,N.useContext)(O).sendSyncData,K=F().data,U="".concat(V,"-bill-type"),H=(0,N.useState)([]),W=(0,p.c)(H,2),L=W[0],z=W[1],J=(0,N.useRef)(null),G=(0,N.useRef)(null),$=(0,N.useRef)(j),Y=(0,N.useCallback)((function(e){var t=e.children,n=void 0===t?[]:t;if(E()($o).call($o,M))"bos_user"===n[0].value&&(n[0].icon=I().createElement(x.Icon,{prefix:"nocodeplatformicon",type:"gerenzhongxin",style:{color:"#3987ED"}})),"bos_adminorg"===n[1].value&&(n[1].icon=I().createElement(x.Icon,{prefix:"nocodeplatformicon",type:"zuzhi",style:{color:"#3987ED"}})),z(Jo(n));else{var r=i()(n).call(n,(function(e){return!E()(Ee).call(Ee,e.value)}));z(Jo(r))}}),[M]);(0,N.useEffect)((function(){!function(){if(!S){var e={showTree:"true",ignoreCosmicForm:"true"};"byapi"===j&&(e.isOpenApi="true"),Array.isArray(A)&&(e.parentId=A[A.length-1]),R("click",[c,y,u,e])}}()}),[j]),(0,N.useEffect)((function(){return T.eventBus.on(Pn,Y),T.eventBus.on(Dn,Q),function(){T.eventBus.off(Pn,Y),T.eventBus.off(Dn,Q)}}),[]);var Q=function(e){var t;z((function(t){return X(t,G.current,Jo(e,{isAsyncNode:!0}))})),null===(t=J.current)||void 0===t||t.call(J),J.current=null},X=function e(t,n,r){return g()(t).call(t,(function(t){return t.key===n?zo(zo({},t),{},{children:r}):t.children?zo(zo({},t),{},{children:e(t.children,n,r)}):t}))};(0,N.useEffect)((function(){$.current&&j!==$.current&&($.current=j,z([]))}),[j]);var Z=(0,N.useMemo)((function(){return Go(L,(function(e){return e.key===t}))}),[L,t]),ee=(0,N.useMemo)((function(){return Z?t:t?_[u]:""}),[Z,_,t]);return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:d,className:n,name:a,tips:l,required:!S&&s,title:m,subTitle:h}),I().createElement("div",{className:"".concat(U,"-tree-select")},S?null==_?void 0:_[u]:I().createElement(x.ConfigProvider,{value:{prefixCls:"kd"}},I().createElement(ze.KDTreeSelect,{allowClear:!0,value:ee,treeData:L,showTreeIcon:!0,treeIcon:function(e){return e.icon},onChange:function(e,n){if(e!==t){var r,a=(null==n||null===(r=n[0])||void 0===r?void 0:r.title)||"",l=""===e&&null!=P&&P.length?{setting:[]}:{};K.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[c,zo((0,f.c)((0,f.c)((0,f.c)({},u,e),b,e),"_disp_",zo(zo({},_),{},(0,f.c)((0,f.c)({},u,a),b,a))),l)]])),v&&q([w])}},treeLoadData:function(e){var t=e.key,n=e.children,r=e.isLeaf;return new(Ho())((function(e){n||r?e():(J.current=e,G.current=t,R("queryTreeNodeChildren",[t]))}))},treeDefaultExpandedKeys:A,treeDefaultExpandAll:k,virtual:!0,listHeight:360,scrollToKey:ee}))))}));Yo.displayName="RefBillTypeEditor";var Qo=(0,T.ErrorBoundaryWrap)(Yo,"RefBillTypeEditor");function Xo(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xo(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Xo(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var ei=["NoCodeBillFormAp"],ti=["","default","disabled","readonly","hidden","mustInput"],ni=ti.reduce((function(e,t,n){return t?Zo(Zo({},e),{},(0,f.c)({},t,n)):e}),{}),ri={default:"1",disabled:"2",readonly:"3",hidden:"4"},ai={1:4,3:3,2:2,4:1,5:4},li=function(e,t){var n,r;return E()(n=["NoCodeBizButtonAp","BizBtnFlexPanelAp"]).call(n,e)||We(e)||E()(r=["NoCodeEntryEntity"]).call(r,t)},oi=(0,N.memo)((function(e){var t=e.handleChange,n=e.className,r=e.editor,a=e.Name,l=e.Tips,o=e.field,i=e.readonly,c=e.value,u=void 0===c?[]:c,d=r.NameHidden,s=r.Required,p=r.Title,v=r.InitStatus,m=void 0===v?"default":v,y=o.refNodeId,g=o._Type_,h=(0,N.useContext)(D),b=h.customUtils,C=h.getKdesignerApi,k=(h.getPreNodeVariablesById,h.getRefBillVarFormId),x=(0,N.useMemo)((function(){return C()}),[]),_=x.data,w=x.meta,M=(0,N.useContext)(T.GlobalConfigContext).showMessage,S=(0,N.useRef)(null);(0,N.useEffect)((function(){var e=_.getData().Items;if(y)e.forEach((function(e){e.id;var t=e._Type_;if(y===e.id)if(je(t))if("byfilter"===e.queryModel)S.current=e.formId;else{var n=w.getControlMetaEditor(t,"refbillField");S.current=k(e.id,e.refbillField,null==n?void 0:n.VarType)}else S.current=e.formId}));else if(De(g)){var t=_.findControlByCondition((function(e){return ke(e._Type_)}))[0];null!=t&&t.formId&&(S.current=null==t?void 0:t.formId)}}),[y]);var A=function(e,n){var r=n.getDesignerRef,a=(((null==r?void 0:r())||{}).kdesignerApi||{}).data,l=a.getData().Items,o=Zo({},e);l.forEach((function(e){var t=e.Key,n=e.ParentId,r=e.Status,l=e._Type_,i=e.FieldRequired;e.Name;if(!o[t]&&!E()(ei).call(ei,l)&&"hidden"!==ti[r]){if("NoCodeEntryAp"!==a.findControl(n)._Type_){var c=ti[r]||"default";o[t]="default"===c&&"2"===i?"mustInput":c}We(l)&&(o[t]=ti[3])}})),t(o)},P=function(e,t,n,r,a){var l=t.Id,o=t.Key,i=n.data,c=i.getAllSubControls(l),u=i.getAllParentControls(l),d=c.reduce((function(t,n){var r=n.Id,a=n._Type_,o=n.Key;return l!==r&&(We(a)||(t[o]=e)),t}),{}),s=u.reduce((function(t,n){var r=n._Type_,l=n.Key,o=n.Status,i=ni[a[l]||ti[o]||"default"];return(Le(r)||function(e){return"NoCodeRefBillTable"===e}(r))&&Number(ai[i])<Number(ai[ni[e]])&&(t[l]=Le(r)?ti[1]:e),t}),{});r(Zo(Zo(Zo({},d),s),{},(0,f.c)({},o,e)))};return i?null:I().createElement("div",{className:"".concat(n,"-userinputperm")},I().createElement(T.NameTipWrapper,{nameHidden:d,className:n,name:a,tips:l,required:s,title:p}),I().createElement("span",{className:"".concat(n,"-userinputperm-active"),onClick:function(){S.current?null==b||b.showFieldPermission({title:"审批内容",fieldDefaultStatus:ri[m],formId:S.current,value:null!=u?u:[],onChange:A,fieldStatusSettingOptions:{hideMenu:li,onFieldStatusChange:P}}):M("录入表单不存在，请选择")}},"配置"))}));oi.displayName="UserInputPermEditor";var ii=(0,T.ErrorBoundaryWrap)(oi,"UserInputPermEditor"),ci=["index","prefixClass","className","editorProps","name","message","showDelete","errorData","readonly","onChange","onDelete"];function ui(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function di(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ui(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):ui(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var si="auditMessageMustInput",fi="terminateFlow",pi="sendMessage",vi=[{key:si,label:"审批意见必填"},{key:fi,label:"决策后结束流程(分支)"},{key:pi,label:"决策后发送消息"}],mi=(0,N.memo)((function(e){var t,n=e.index,r=e.prefixClass,a=e.className,l=e.editorProps,o=e.name,c=e.message,u=e.showDelete,d=e.errorData,s=e.readonly,v=e.onChange,m=e.onDelete,y=(0,Q.c)(e,ci),h=(0,N.useState)(o),E=(0,p.c)(h,2),b=E[0],C=E[1],T=(0,N.useRef)(null);(0,N.useEffect)((function(){o!==b&&C(o)}),[o]);var k=function(e){v(n,e)},w=function(e){e!==o&&(T.current&&clearTimeout(T.current),T.current=setTimeout((function(){T.current=null,k({name:e})}),300))},M=l.readonly,S=null==d?void 0:d.message,A=null==d?void 0:d.name,P=(0,N.useMemo)((function(){var e;return s?i()(e=g()(vi).call(vi,(function(e){var t=e.key,n=e.label;return y[t]?n:""}))).call(e,(function(e){return e})):[]}),[]);return I().createElement(I().Fragment,null,s?I().createElement("div",{className:"".concat(a,"_readonly")},b,P.length>0?"：":"",P.join("，")):I().createElement("div",{className:a},I().createElement("div",{className:"".concat(a,"_main")},I().createElement("div",{className:"".concat(a,"_main_fieldlist")},I().createElement(x.Form.Item,{name:o,required:!0,validateTrigger:"onBlur",rules:[{required:!0,message:""}],className:(0,f.c)({},"".concat(a,"_error"),A)},I().createElement(x.Input,{className:"input",borderType:"bordered",placeholder:"请输入",disabled:M,value:b,maxLength:12,onChange:function(e){var t=e.target.value;C(t),w(t)}})),g()(vi).call(vi,(function(e){var t=e.key,n=e.label;return I().createElement(x.Checkbox,{className:"checkbox",key:t,checked:y[t],onChange:function(e){return function(e,t){k((0,f.c)({},e,t.target.checked))}(t,e)}},n)})),u&&I().createElement(x.Icon,{prefix:"nocodeplatformicon",type:"xingshanchu",className:"delete",title:"删除决策项",onClick:function(){m(n)}})),A&&I().createElement("span",{className:"".concat(r,"-error-msg")},d.name))),y[pi]&&I().createElement("div",{className:mn()("".concat(a,"_condiction"),(0,f.c)({},"".concat(a,"_error"),S))},I().createElement(Ya,(0,_.c)({},l,{Name:"决策后发送消息",editor:{HideFunc:!(null==l||null===(t=l.Editor)||void 0===t||!t.HideFunc),NameHidden:!0},value:c,hiddenTitle:!0,readonly:s,handleChange:function(e){k({message:e})}})),S&&I().createElement("span",{className:"".concat(r,"-error-msg")},d.message)))}));mi.displayName="ApprovalDecisionItem";var yi=ft(vt.key,{title:vt.title}),gi=(0,N.memo)((function(e){var t=e.handleChange,n=e.className,r=e.editor,a=e.Name,l=e.Tips,o=e.field,i=e.readonly,c=e.error,u=e.value,d=void 0===u?[]:u,s=r.NameHidden,v=r.Required,y=r.Title,h=o.name,E=(0,N.useContext)(T.GlobalConfigContext).showMessage,b="".concat(n,"_approvaldecision"),C=x.Form.useForm(),k=(0,p.c)(C,1)[0];(0,N.useEffect)((function(){if(2===d.length){var e=g()(d).call(d,(function(e){var t,n,r,a,l,o,i=e.number;if(e.message)return e;var c="";switch(i){case"Consent":c=m()(t=m()(n=m()(r="您申请的【 ".concat(vt.key," 】在【 ")).call(r,h," 】节点审核通过@@您申请的【 ")).call(n,yi," 】在【 ")).call(t,h," 】节点审核通过@@1");break;case"Terminate":c=m()(a=m()(l=m()(o="您申请的【 ".concat(vt.key," 】在【 ")).call(o,h," 】节点审核否决@@您申请的【 ")).call(l,yi," 】在【 ")).call(a,h," 】节点审核否决@@1")}return di(di({},e),{},{message:c})}));t(e)}}),[]);var w=function(e,n){var r=(0,ce.cloneDeep)(d);r[e]=di(di({},r[e]),n),t(r)},M=function(e){var n=(0,ce.cloneDeep)(d);te()(n).call(n,e,1),t(n)};return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:s,className:n,name:a,tips:l,required:v,title:y}),I().createElement("div",{className:b},I().createElement(x.Form,{form:k},null==d?void 0:g()(d).call(d,(function(t,r){var a,l=null==c||null===(a=c.msg)||void 0===a?void 0:a[t.number],o={};return l&&l.forEach((function(e){o[e.prop]=e.msg})),I().createElement(mi,(0,_.c)({key:t.number,index:r,prefixClass:n,className:"".concat(b,"_item"),editorProps:e,showDelete:d.length>2},t,{errorData:o,readonly:i,onChange:w,onDelete:M}))}))),!i&&I().createElement(ze.BtnField,{major:!0,type:"text",text:"添加决策项",icon:{prefix:"designericon",type:"zengjia-yuan2"},onClick:function(){k.validateFields().then((function(e){var n,r,a=m()(n=[]).call(n,(0,j.c)(d),[di((0,f.c)((0,f.c)((0,f.c)({number:(0,T.createUUid)(),name:""},si,!1),fi,!1),pi,!1),r)]);t(a)})).catch((function(e){E("请输入决策项名称")}))}})))}));gi.displayName="ApprovalDecisionEditor";var hi=(0,T.ErrorBoundaryWrap)(gi,"ApprovalDecisionEditor");function Ei(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function bi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ei(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Ei(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Ci=(0,N.memo)((function(e){var t=e.handleChange,n=e.className,r=e.editor,a=e.Name,l=e.Tips,o=e.field,i=e.value,c=r.NameHidden,u=r.Required,d=r.Title,s=r.RefProp,f=(o.refNodeId,o.itemId,(0,N.useContext)(D)),v=f.getKdesignerApi,m=f.batchInvoke,y=f.getRefBillVarFormId,h=(0,N.useMemo)((function(){return v()}),[]),b=h.data,C=h.meta,k=o[s],x=(0,N.useRef)(k),w=(0,N.useState)([]),M=(0,p.c)(w,2),S=M[0],A=M[1];(0,N.useEffect)((function(){if(k!==x.current&&(x.current=k,t("")),k){var e=k;if("formId"!==s)b.getData().Items.forEach((function(t){t.id;var n=t._Type_;if(k===t.id)if(je(n))if("byfilter"===t.queryModel)e=t.formId;else{var r=C.getControlMetaEditor(n,"refbillField");e=y(t.id,t.refbillField,null==r?void 0:r.VarType)}else e=t.formId}));e&&!E()(Ee).call(Ee,e)?m("getTriggerProcess","nocodewfdesigner",[e]):A([])}else A([])}),[k]),(0,N.useEffect)((function(){var e=T.eventBus.on("setTriggerProcess",(function(e){var t,n=(t=e,Array.isArray(t)&&(null==t?void 0:g()(t).call(t,(function(e){return bi(bi({},e),{},{label:e.name,value:e.id})})))||[]);A(n)}));return function(){T.eventBus.off("setTriggerProcess",e)}}),[]);var P=(0,N.useMemo)((function(){return bi(bi({},e),{},{editor:bi(bi({},e.Editor),{},{NameHidden:!0})})}),[e]);return I().createElement("div",{className:"".concat(n,"-pickwf")},I().createElement(T.NameTipWrapper,{nameHidden:c,className:n,name:a,tips:l,required:u,title:d}),I().createElement(T.EditorPropertySelect,(0,_.c)({},P,{multiple:!0,selectPlaceholder:"无",dropdownClassName:"".concat(n,"-pickwf-panel"),value:S.length?i:"",options:S||[],scrollHidden:!1,handleChange:t})))}));Ci.displayName="PickWfEditor";var Ni=(0,T.ErrorBoundaryWrap)(Ci,"PickWfEditor");function Ii(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ti(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ii(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Ii(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var ki=(0,N.memo)((function(e){var t=e.type,n=e.value,r=e.className,a=e.onChange;if("day"===t)return null;var l=ur(t),o=function(e){if("year"!==t)a(e);else{var n=null==e?void 0:i()(e).call(e,(function(e){return"number"!=typeof e}));a(n)}};return"week"===t||"month"===t?I().createElement(x.Select,{allowClear:!0,placeholder:"请选择",mode:"multiple",borderType:"bordered",value:n,options:l,className:r,onChange:o}):I().createElement(x.ConfigProvider,{value:{prefixCls:"kd"}},I().createElement(ze.KDTreeSelect,{allowClear:!0,mode:"multiple",value:n,treeData:l,showTreeIcon:!0,selectedKeys:n,className:r,onChange:o}))}));ki.displayName="DateTypePicker";var xi={date:[],time:""},_i=(0,N.memo)((function(e){var t=(0,N.useContext)(D).isReadonly,n=e.handleChange,r=e.value,a=void 0===r?xi:r,l=e.className,o=e.editor,i=(e.locked,e.Name),c=e.Tips,u=e.field,d=(e.id,e.propName,o.NameHidden),s=o.Required,f=o.Title,p=o.SubTitle,v=u.loopType,m="".concat(l,"-triggertime"),y=a||{},g=y.time,h=y.date,E=(0,N.useRef)(v),b=function(e){var t=e?yt("hh:mm:ss",e):"";n(Ti(Ti({},a||xi),{},{time:t}))},C=function(e){n(Ti(Ti({},a||xi),{},{date:e}))};return(0,N.useEffect)((function(){g||b()}),[g]),(0,N.useEffect)((function(){E.current!==v&&(C([]),E.current=v)}),[v]),t?I().createElement(I().Fragment,null,I().createElement("div",{className:mn()("".concat(l,"-display-viewitem"),"custom-title")},I().createElement("span",{className:"title",title:f},i)),I().createElement("span",null,fr(v,(null==a?void 0:a.date)||[])+(null==a?void 0:a.time))):I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:d,className:l,name:i,tips:c,required:s,title:f,subTitle:p}),I().createElement("div",{className:"".concat(m)},I().createElement(ki,{value:h,className:"".concat(m,"-date"),type:v,onChange:C}),I().createElement(x.DatePicker,{defaultValue:g?dr(g):void 0,className:"".concat(m,"-time"),allowClear:!1,picker:"time",borderType:"bordered",onOk:b})))}));_i.displayName="TriggerTimeEditor";var wi=(0,T.ErrorBoundaryWrap)(_i,"TriggerTimeEditor"),Mi=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.editor,l=e.locked,o=e.picker,i=e.Name,c=e.Tips,u=e.Id,d=a.NameHidden,s=a.Required,f=a.AllowClear,p=a.BorderType,v=a.Placeholder,m=a.Title,y=a.Picker,g=a.Format,h=void 0===g?"yyyy-MM-dd hh:mm:ss":g,E=a.SubTitle,b="string"==typeof n&&n?new Date(n):n;return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:d,className:r,name:i,tips:c,required:s,title:m,subTitle:E}),I().createElement(x.DatePicker,{className:"".concat(r,"-datepicker-editor"),dropdownClassName:"".concat(r,"-datepickerpanel-editor"),disabled:l,borderType:p,allowClear:f,value:b,onChange:function(e){if(e){if(!(e instanceof Date))return;"startTime"===u?e.setHours(0,0,0):"endTime"===u&&e.setHours(23,59,59);var n=yt(h,e);t(n)}else t(e)},picker:y||o,placeholder:v}))},Si=n(16428);function Ai(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ai(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Ai(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Di={assignment:{value:"$assignment",hideproperty:["customVarName","customVarType","decimalDataType","maxLength","scale"]},customVarType:{value:"number",hideproperty:["decimalDataType","maxLength","scale"]}},Oi=function(e){var t,n=e.prefixClass,r=e.className,a=e.data,l=e.parentField,o=(e.displayLabel,e.isReadonly),i=e.readonly,c=e.propertyData,u=e.nodeVariablesTree,d=e.error,s=e.handleChange,f=c.Config,p=c.Number,v=Pi({},a);delete v._Type_;var y=(0,_.c)(v,{id:l.id,_disp_:l._disp_,_Type_:l._Type_}),g=function(e,t){return C()(Di).some((function(n){var r,a;return!(e[n]===(null===(r=Di[n])||void 0===r?void 0:r.value)||null===(a=Di[n])||void 0===a||null===(a=a.hideproperty)||void 0===a||!E()(a).call(a,t))}))}(y,p);if(g)return null;if(o){var h,b=(null==c||null===(h=c.Config)||void 0===h?void 0:h.Editor)||{},N=Pi(Pi({},c),{},{Editor:b,Id:c.Number});if(!E()(hn).call(hn,null==b?void 0:b.Type)||void 0===y[N.Id])return I().createElement(pn,{className:"kdesigner-right-view",displayData:y,propertyData:N})}var k={};return void 0!==f.Editor.Width&&(k.width=f.Editor.Width,k.flexGrow=0,k.flexShrink=0),I().createElement("div",{style:k,className:mn()(r,"".concat(n,"-parameter-item-property")),key:m()(t="".concat(v.id,"-")).call(t,p)},I().createElement(T.PropertyViewItem,(0,_.c)({},f,c,{Id:p,field:Pi({},y),value:y[p],className:"kdesigner-right-view",enableMutiSelect:!1,variablesTree:u,readonly:i,onPropertyChange:s,renderCustomError:function(e,t){return!0}})),"string"==typeof d&&I().createElement("span",{className:"".concat(n,"-error-msg")},d))};Oi.displayName="ChildPropertyViewItem";var ji=(0,T.ErrorBoundaryWrap)(Oi,"ChildPropertyViewItem");function Bi(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ri(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bi(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Bi(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Fi=(0,N.memo)((function(e){var t=(0,N.useContext)(D),n=t.getKdesignerApi,r=t.getPreNodeVariablesById,a=t.isReadonly,l=t.getRefBillVarFormId,o=(0,N.useMemo)((function(){return n()}),[]),c=(o.data,o.meta),u=e.handleChange,d=e.value,s=e.className,v=e.editor,y=e.Name,h=e.Tips,b=e.field,C=e.propName,k=e.error,_=e.readonly,w=v.NameHidden,M=v.Required,S=v.Title,A=v.ChildProperty,P=v.Source,O=v.SubTitle,B=b.id,R=b._disp_,F=(b.refNodeId,(0,N.useMemo)((function(){return A?Ke(A):{}}),[A])),V=(0,N.useState)([]),q=(0,p.c)(V,2),K=q[0],U=q[1];(0,N.useEffect)((function(){d&&U(d)}),[d]);var H=(0,N.useMemo)((function(){var e=r(B)||[];return e=i()(e).call(e,(function(e){var t=e._Type_,n=e.formId;if(je(t)){if("byfilter"===e.queryModel)n=e.formId;else{var r=c.getControlMetaEditor(t,"refbillField");n=l(e.id,e.refbillField,null==r?void 0:r.VarType)}return!E()(Ee).call(Ee,n)}return!0}))}),[r,B,P]),W=(0,N.useCallback)((function(e,t,n){if(K[e]){var r=(0,ce.cloneDeep)(K),a=Ri(Ri({},r[e]),{},(0,f.c)({},t,n));return r[e]=a,r}return{}}),[K]),L=(0,N.useCallback)((function(e,t,n){var r=W(e,t,n);(0,Si.unstable_batchedUpdates)((function(){u(r),U(r)}))}),[W,K]),z=(0,N.useCallback)((function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n||[],l=(0,p.c)(a,3),o=l[1],i=l[2];return L(e,o,i),!0}),[L,W,C,R,B,K]),J=(0,N.useCallback)((function(e){var t=(0,ce.cloneDeep)(K);te()(t).call(t,e,1),u(t)}),[K]),G=(0,N.useCallback)((function(){var e,t=qe(F,"id");u(m()(e=[]).call(e,(0,j.c)(K),[t]))}),[K]),$=(0,N.useCallback)((function(){u([])}),[]),Y=(0,N.useMemo)((function(){return a?g()(A).call(A,(function(e,t){return{code:e.Number,name:e.Name,width:120,features:t===A.length-1?{flex:1}:{},render:function(t,n,r){var l,o;return I().createElement("div",{className:"".concat(s,"-parameter-item-display"),key:m()(l="".concat(n.id,"-")).call(l,e.Number)},I().createElement(ji,{key:m()(o="".concat(n.id,"-")).call(o,e.Number),prefixClass:s,data:n,parentField:b,nodeId:B,disp:R,isReadonly:a,readonly:_,propertyData:e,nodeVariablesTree:H}))}}})):[]}),[a,A]);return I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:w,className:s,name:y,tips:h,required:M,title:S,subTitle:O}),a?null!=K&&K.length?I().createElement(ze.DataGrid,{dataSource:K,columns:Y}):"-":I().createElement("div",{className:"".concat(s,"-parameter")},(null==K?void 0:K.length)>0&&I().createElement("div",{className:"".concat(s,"-parameter-list")},g()(K).call(K,(function(e,t){var n,r=null==k||null===(n=k.msg)||void 0===n?void 0:n[e.id],l={};return r&&r.forEach((function(e){l[e.prop]=e.msg})),I().createElement("div",{className:"".concat(s,"-parameter-item"),key:e.id},I().createElement("div",{className:"".concat(s,"-parameter-item-content")},g()(A).call(A,(function(n){var r,o=n.Number;return I().createElement(ji,{key:m()(r="".concat(e.id,"-")).call(r,o),prefixClass:s,data:e,parentField:b,nodeId:B,disp:R,isReadonly:a,readonly:_,propertyData:n,nodeVariablesTree:H,error:l[o],handleChange:function(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return z.apply(void 0,m()(e=[t]).call(e,r))}})}))),I().createElement(x.Icon,{prefix:"nocodeplatformicon",type:"xingshanchu",className:"delete",title:"删除",onClick:function(){return J(t)}}))}))),!_&&I().createElement("div",{className:"".concat(s,"-parameter-footer")},I().createElement(ze.BtnField,{major:!0,type:"text",className:"".concat(s,"-parameter-add"),icon:{prefix:"designericon",type:"zengjia-yuan"},onClick:G},"添加参数"),K.length>0&&I().createElement(ze.BtnField,{type:"text",className:"".concat(s,"-parameter-clear"),onClick:$},"清空"))))}));Fi.displayName="ParameterSettingEditor";var Vi=(0,T.ErrorBoundaryWrap)(Fi,"ParameterSettingEditor"),qi=(0,N.memo)((function(e){var t=e.value,n=e.allowClear,r=void 0===n||n,a=e.onChange;return I().createElement(ze.Text,{value:t,title:t,onChange:a,allowClear:r})}));qi.displayName="GridInput";var Ki=qi;function Ui(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Hi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ui(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Ui(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var Wi=[{code:"name",name:"参数名",width:200},{code:"type",name:"类型",width:80},{code:"value",name:"参考值",features:{flex:1}}],Li=[{code:"name",name:"变量名称",width:200},{code:"value",name:"变量值",features:{flex:1}}],zi=ze.treeUtils.getTreeDataFlatten,Ji=ze.treeUtils.transformTreeNodeTitle,Gi=function(e){var t={};return Tt(e)?t[e]=!1:t=function(e){var t={};return e?((e.match(Ze)||[]).forEach((function(e){var n=e.match(tt),r=(0,p.c)(n,3),a=r[1];r[2],t[a]=!1})),t):t}(e),t},$i=function(e){return g()(e).call(e,(function(e){return Hi(Hi({},e),{},{value:"object"===(0,sn.c)(e.value)?Zt()(e.value):e.value})}))},Yi=(0,N.memo)((function(e){var t,n=e.handleChange,r=e.value,a=e.className,l=(e.editor,e.locked,e.Name,e.Tips,e.field),o=(e.id,e.propName,e.Id),i="".concat(a,"-testapi"),c=(0,N.useContext)(T.GlobalConfigContext).showMessage,u=(0,N.useContext)(D),d=u.invokeAction,s=u.getPreNodeVariablesById,v=u.apiTestResults,m=(0,N.useState)(!1),y=(0,p.c)(m,2),h=y[0],E=y[1],b=(0,N.useState)([]),k=(0,p.c)(b,2),_=k[0],w=k[1],M=l.apiMode,S=l.url,A=(l.method,l.requestHeader),P=l.requestBody,O=l.id,j=l.accessTokenUrl,B=(0,N.useState)(null===(t=v.current)||void 0===t?void 0:t[O]),R=(0,p.c)(B,2),F=R[0],V=R[1];(0,N.useEffect)((function(){r||n("")}),[]);var q=(0,N.useMemo)((function(){return r?JSON.parse(r):{}}),[r]),K=(0,N.useMemo)((function(){return s(O)}),[O,s]),U=(0,N.useMemo)((function(){var e=Ji(gl(K));return zi(e)}),[K]),H=function(e){d("testApi",[e])};(0,N.useEffect)((function(){var e;V(null===(e=v.current)||void 0===e?void 0:e[O])}),[O]),(0,N.useEffect)((function(){var e=function(e){var t;if(e){var n=e||{},r=n.body,a=void 0===r?[]:r,l=n.header,o=void 0===l?[]:l,i=$i(a),c=$i(o),u=Hi(Hi({},e),{},{body:i,header:c});V(u),v.current[O]=u,null===(t=document.getElementById(Ne))||void 0===t||t.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}};return T.eventBus.on(On,e),function(){T.eventBus.off(On,e)}}),[]);var W=function(e,t){var n=g()(_).call(_,(function(n,r){return r===e?Hi(Hi({},n),{},{value:t}):n}));w(n)},L=(0,N.useMemo)((function(){return g()(Li).call(Li,(function(e,t){return"value"===e.code?Hi(Hi({},e),{},{width:558,render:function(t,n,r){return I().createElement(Ki,{meta:e,value:t,record:n,rowIndex:r,onChange:function(e){return W(r,e)}})}}):"name"===e.code?Hi(Hi({},e),{},{render:function(e,t,n){if(!e)return"";var r=e||{},a=r.fullLabel,l=r.title;return I().createElement(x.Tooltip,{tip:"完整路径：".concat(a),mouseEnterDelay:.3},I().createElement("span",null,l))}}):e}))}),[W,Wi]),z=F||{},J=z.body,G=z.requestInfo,$=void 0===G?{}:G,Y=z.header;return I().createElement("div",{id:Ne},I().createElement(ze.BtnField,{className:"".concat(i,"-btn"),major:!0,text:"测试",onClick:function(){var e=function(){var e,t={},n="request"===M?S:j;if(n){var r=Gi(n);t=Hi(Hi({},t),r)}return A&&A.forEach((function(e){t=Hi(Hi({},t),Gi(e.value))})),P&&("json"===P.enctype?P.json&&(t=Hi(Hi({},t),Gi(P.json))):P.formData&&P.formData.forEach((function(e){t=Hi(Hi({},t),Gi(e.value))}))),g()(e=C()(t)).call(e,(function(e,n){return{id:n,key:e,name:!1===t[e]?U[e]:t[e],value:q[e]}}))||[]}();0!==e.length?(w(e),E(!0)):H(l)}}),F&&I().createElement(I().Fragment,null,I().createElement("div",{className:"".concat(i,"-config")},I().createElement("span",null,"请求时间：",$.requestTime,"｜"),I().createElement("span",null,"耗时：",$.cost," 秒｜"),I().createElement("span",null,"HTTP状态码：",$.statusCode)),I().createElement("div",{className:"".concat(i,"-res")},I().createElement("div",{className:"".concat(i,"-res-title")},"响应头"),I().createElement(ze.DataGrid,{dataSource:Y,columns:Wi})),I().createElement("div",{className:"".concat(i,"-res")},I().createElement("div",{className:"".concat(i,"-res-title")},"响应体"),I().createElement(ze.DataGrid,{dataSource:J,columns:Wi}))),I().createElement(ze.Modal,{title:"以下变量赋值后才可进行测试",width:800,height:520,visible:h,body:I().createElement(ze.DataGrid,{dataSource:_,columns:L}),onCancel:function(){E(!1)},onOk:function(){var e={};if(null!=_&&_.some((function(e){return null==e||!e.value})))return c("变量值不能为空。");_.forEach((function(t){t.key&&(e[t.key]=t.value||"")}));var t=Zt()(e),r=Hi(Hi({},l),{},(0,f.c)({},o,t));n(t),H(r),E(!1)}}))}));Yi.displayName="TestApiEditor";var Qi=(0,T.ErrorBoundaryWrap)(Yi,"TestApiEditor");function Xi(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xi(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):Xi(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var ec=(0,N.memo)((function(e){var t=e.handleChange,n=e.className,r=e.editor,a=e.Name,l=e.Tips,o=e.field,i=e.error,c=e.value,u=void 0===c?{enctype:"formData"}:c,d=e.propName,s=r.NameHidden,v=r.Required,y=r.Title,h=(r.RefProp,r.ChildProperty),E=(o.id,o._disp_,o.id),b=(0,N.useContext)(D),k=b.getKdesignerApi,x=(b.batchInvoke,b.getRefBillVarFormId,b.isReadonly),_=(0,N.useMemo)((function(){return k()}),[]).error;(0,N.useEffect)((function(){if(null!=i&&i.msg){var e=_.getError(E)||{};try{delete e[d]}catch(e){}var t=(0,f.c)({},E,Zi(Zi({},e),{},(0,f.c)({},u.enctype,Zi(Zi({},i),{},{prop:[u.enctype]}))));_.setError(t)}}),[i]);var w=(0,N.useMemo)((function(){var e=Ke(h);return u?Zi(Zi({},e),u):e}),[u]),M=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var l=r||[],o=(0,p.c)(l,3),i=(o[1],o[2]),c=Zi(Zi({},w),{},(0,f.c)({},e,i));return t(c),!0},S=(0,T.getModelData)([{Nodes:g()(h).call(h,(function(e){var t,n,r=Zi(Zi(Zi({},e.Config),{},{Actions:null===(t=e.Config)||void 0===t||null===(t=t.Actions)||void 0===t?void 0:t.Enum},e),{},{Id:e.Number});if(null!==(n=e.Config)&&void 0!==n&&null!==(n=n.Actions)&&void 0!==n&&n.Enum){var a,l,o=null===(a=e.Config)||void 0===a||null===(a=a.Actions)||void 0===a?void 0:g()(l=a.Enum).call(l,(function(e){var t=e.Action,n=e.Condition,r={};return C()(t).forEach((function(e){r[null==e?void 0:e.toLocaleLowerCase()]=t[e]})),{action:r,condition:n}}));r.Actions=(0,T.transformActions)(o)}return r}))}],{field:w}),A=S[0].Nodes;return I().createElement("div",{className:"".concat(n,"-requestbody")},I().createElement(T.NameTipWrapper,{nameHidden:s,className:n,name:a,tips:l,required:v,title:y}),I().createElement("div",{className:mn()("".concat(n,"-requestbody-content"),(0,f.c)({},"".concat(n,"-requestbody-content-display"),x))},g()(A).call(A,(function(e){var t=e.Number;return!1===e.Visible?null:I().createElement(ji,{key:t,prefixClass:"".concat(n,"-requestbody"),data:(0,f.c)({},t,u[t]),parentField:o,isReadonly:x,readonly:x,propertyData:e,handleChange:function(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return M.apply(void 0,m()(e=[t]).call(e,r))}})}))))}));ec.displayName="RequestBodyEditor";var tc=(0,T.ErrorBoundaryWrap)(ec,"RequestBodyEditor"),nc=(0,N.memo)((function(e){var t=(0,N.useContext)(D),n=(t.isReadonly,t.invokeAction),r=(e.handleChange,e.value,e.className),a=e.editor,l=(e.locked,e.Name),o=e.Tips,i=(e.field,e.id,e.propName,a.NameHidden),c=a.Required,u=a.Title,d=a.SubTitle,s="".concat(r,"-whitelist"),f=(0,N.useState)(null),v=(0,p.c)(f,2),m=v[0],y=v[1];return(0,N.useEffect)((function(){n("getNoCodeIpList");var e=function(e){y(e)};return T.eventBus.on(jn,e),function(){T.eventBus.off(jn,e)}}),[]),I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:i,className:r,name:l,tips:o,required:c,title:u,subTitle:d}),I().createElement("div",{className:"".concat(s)},m))}));nc.displayName="WhiteLsitEditor";var rc=(0,T.ErrorBoundaryWrap)(nc,"WhiteLsitEditor"),ac=(0,N.memo)((function(e){return I().createElement(T.InputPropertyEditor,(0,_.c)({},e,{InputTitle:e.value}))}));ac.displayName="InputPropertyEditor";var lc=ac,oc=["title","children"];function ic(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function cc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ic(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):ic(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var uc=ze.treeUtils.dfs,dc=(0,N.memo)((function(e){var t=(0,N.useContext)(D),n=t.getKdesignerApi,r=t.getPreNodeVariablesById,a=t.prefixCls,l=(0,N.useMemo)((function(){return n()}),[]).data,o=e.handleChange,c=e.value,u=e.className,d=e.editor,s=e.Name,p=e.Tips,v=e.field,y=e.propName,h=(e.error,e.variablesTree),E=e.readonly,b=(e.onPropertyChange,e.assignments,e.id),C=(d.Enum,d.NameHidden),k=d.Required,x=d.VarType,_=d.Source,w=(d.Custom,d.Title),M=v.id,S=v._disp_,A=v._Type_,P=v.refNodeId,O=v.loopby,j=function e(t,n,r){return t.reduce((function(t,a){var l,o,i=a.title,c=a.children,u=(0,Q.c)(a,oc),d=u.key,s=u.value,f=r?m()(l="".concat(r,"-")).call(l,i):i,p=cc({fullName:f,title:i},u);return c&&(p.children=e(c,!1,f)),!(n&&(null==p||null===(o=p.children)||void 0===o?void 0:o.length)>0)&&n||le()(d).call(d,"${proc.")&&(null!=s&&Xa()(s).call(s,"ExecuteResult.QueryResult}")||null!=s&&Xa()(s).call(s,"AuditNumber}")||null!=s&&Xa()(s).call(s,"NodeName}")||null!=d&&Xa()(d).call(d,".procName}"))?t:m()(t).call(t,p)}),[])},B=(0,N.useMemo)((function(){if(h)return Ae(A)||Se(A)?gl(h,(function(e){return yl(e,P||O)})):Me(A)?i()(h).call(h,(function(e){var t=e._Type_,n=e.queryModel;return!(je(t)&&kt(n))})):h;var e=r(M,x,void 0,!0)||[];return _&&(e=i()(e).call(e,(function(e){return e[_]===_}))),Ae(A)?gl(e,(function(e){return yl(e,P||O)})):e}),[h,r,M,_,A,P,O]),R=(0,N.useMemo)((function(){return"string"==typeof c&&""!==c?null==c?void 0:c.split(";"):[]}),[c]),F=(0,N.useMemo)((function(){return j(B,!0)}),[B]),V=(0,N.useMemo)((function(){var e=hl(F,R);return m()(e).call(e,c)}),[F,R]);return(0,N.useEffect)((function(){var e=i()(R).call(R,(function(e){return uc(F,(function(t){return t.key===e}))}));(0,ce.isEqual)(e,R)||o(e.join(";"))}),[]),I().createElement(I().Fragment,null,I().createElement(T.NameTipWrapper,{nameHidden:C,className:u,name:s,tips:p,required:k,title:w}),I().createElement(ze.KDTreeSelect,{value:R,disabled:E,allowClear:!0,defaultExpandAll:!0,defaultExpandKeys:V,onChange:function(e,t){var n=(e||[]).join(";"),r=g()(t).call(t,(function(e){return(null==e?void 0:e.label)||"-"})).join();l.batchUpdateControlPropertyValues((0,T.createUpdateAction)([[b,(0,f.c)((0,f.c)({},y,n),"_disp_",cc(cc({},S),{},(0,f.c)({},y,r)))]]))},mode:"multiple",treeData:F,className:mn()((0,f.c)({},"".concat(a,"-multivarselect-readonly"),E)),showFullLabelTips:!0}))}));dc.displayName="MultiVarSelectEditor";var sc=(0,T.ErrorBoundaryWrap)(dc,"VarSelectEditor"),fc=function(){var e=[];return[[Ua,"orderby"],[Ya,"expression"],[Qo,"refbilltype"],[xl,"varselect"],[sc,"multivarselect"],[Ko,"userSelect"],[jl,"filter"],[No,"judgefilter"],[Wl,"calcSetting"],[co,"combineselector"],[Hr,"nodebilltype"],[mo,"newSetting"],[ii,"userInputPerm"],[hi,"decisionOptions"],[Ni,"pickWf"],[wi,"triggerTime"],[Mi,"DatePicker"],[Qi,"testApi"],[Vi,"parameterSetting"],[tc,"requestBody"],[rc,"whiteList"],[lc,"Input"]].forEach((function(t){var n=(0,p.c)(t,3),r=n[0],a=n[1],l=n[2];e.push([a,r,l])})),e};n(10936);function pc(e,t){var n=C()(e);if(l()){var r=l()(e);t&&(r=i()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function vc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pc(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):s()?Object.defineProperties(e,s()(n)):pc(Object(n)).forEach((function(t){Object.defineProperty(e,t,u()(n,t))}))}return e}var mc=(ze.treeUtils||{}).dfs,yc="nocode-flow",gc=(0,N.memo)((0,N.forwardRef)((function(e,t){var n=e.data,r=void 0===n?[]:n,a=e.meta,l=void 0===a?{}:a,o=e.onData,i=e.showMessage,c=void 0===i?function(e){}:i,u=e.invokeAction,d=void 0===u?function(e,t,n){}:u,s=e.batchInvoke,f=(e.getEncodeValue,e.invokeApi),v=void 0===f?{}:f,y=e.onApi,h=e.flowStatus,b=e.compareType,k=e.getControlText,_=e.webMsg,w=e.baseHooks,M=e.baseUrl,S=e.customUtils,A=(0,p.c)(r,3),P=A[0],O=A[1],j=A[2],B=(0,N.useRef)(null),F=(0,N.useRef)(P),V=(0,N.useRef)(null),q=(0,N.useRef)(null),K=(0,N.useRef)({}),U=function(e){var t=e,n={};C()(t).forEach((function(e){t[e]&&xa[e]&&(n[xa[e]]=t[e])}));var r=t.nodes;if(1===r.length){var a=t.key,l=r[0];l.number=at(l._Type_,0),l.id=lt(a,l._Type_,0),l.itemId=l.id,r[0]=l;var o=lt(a,R,0);if(at(R,0),r.push({number:at(R,0),id:o,_Type_:R,parentId:l.id}),!t.edges){var i=lt(a,Y,0);n.edges=[{id:i,source:l.id,target:o,_Type_:Y,number:at(Y,0),itemId:i,data:{parentId:l.id,id:o}}]}}return n.Items=r,n}(P),H=(0,N.useMemo)((function(){return Ta(l,U)}),[l,U]),W=(0,N.useMemo)((function(){return At((null==j?void 0:j.variables)||{})}),[]),L=(0,N.useState)(W),z=(0,p.c)(L,2),J=z[0],G=z[1],$=(0,N.useCallback)((function(e){var t;if(!q.current&&Array.isArray(H.Categories)){var n=H.Categories.reduce((function(e,t){return m()(e).call(e,t.Controls)}),[]);q.current={},n.forEach((function(e){var t=e.Id,n=e.Icon,r=void 0===n?"liucheng":n,a=e.Bg,l=void 0===a?"#ffffff":a;q.current[t]={bgc:l,icon:r}}))}return(null===(t=q.current)||void 0===t?void 0:t[e])||{icon:"liucheng",bgc:"#ffffff"}}),[H]),Q=(0,N.useCallback)((function(e){if("main"===e)return{main:ba}}),[H]),X=(0,N.useMemo)((function(){return{showMessage:c,getViews:Q,enableError:!0,keywordMapping:{id:"id",type:"type",name:"name",key:"key",parentId:"parentId",items:"Items"},dataPortalIdPrefix:"".concat(yc,"-top-view"),enableDiffDefaultData:!1,controlViewSetting:{hideItemView:!0},propertyViewSetting:{hideItemView:!0},preHandle:ja,getPropertyEditors:fc,filterProperty:ka,getOutlineItemIcon:function(e){return I().createElement(x.Icon,{prefix:"designericon",type:$(e).icon,className:"rule-designer-control-icon"})}}}),[c,ka,Q,fc]),Z=(0,N.useCallback)((function(e,t){T.eventBus.emit(e,t)}),[]),ee=(0,N.useCallback)((function(e){var t;(F.current=vc(vc({},F.current),e),ot(h))&&(F.current.edges=(null===(t=F.current.edges)||void 0===t?void 0:g()(t).call(t,(function(e){return"smoothstep"===e._Type_?vc(vc({},e),{},{_Type_:Y}):e})))||[]);o&&o(F.current)}),[F.current,h]),te=(0,N.useCallback)((function(e){null==e||e.views.setViewHideState("top")(!0),B.current=vc({},e),y({kdesignerApi:B.current,pubEvent:Z,setDesignerDataRef:ee})}),[y,ee]);(0,N.useEffect)((function(){y(vc(vc({},B.current),{},{setDesignerDataRef:ee,pubEvent:Z}))}),[ee]);var ne=(0,N.useCallback)((function(e){if(!e)return"";var t=B.current,n=t.data,r=t.meta,a=(n.findControl(e)||{})._Type_;return r.getControlMeta(a).Name||""}),[]),re=(0,N.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=B.current.data,l=(a.getData()||{}).Items,o=void 0===l?[]:l,i=null!=t&&t.replace("*","")?t.split(","):[],c=0===i.length||E()(i).call(i,vt.type)?[vt]:[],u=it(e,o);return C()(J).forEach((function(e){if(E()(u).call(u,e)){var t=ut(e,J[e],i,n,r);if(t.length>0){var l=a.findControl(e);c.push(vc(vc({},l),{},{nodeId:e,key:e,title:dt(l),formId:null==l?void 0:l.formId,children:t,selectable:!1,checkable:!1}))}}})),c}),[J]),ae=(0,N.useCallback)((function(e){return J[e]}),[J]),le=function(e,t,n){var r=re(e,n)||[],a=null;if(null!=r&&r.length){var l,o=mc(r,(function(e){return e.value===t}))||{};null!=o&&null!==(l=o.option)&&void 0!==l&&l.billEntityId&&(a=null==o?void 0:o.option.billEntityId)}return a},oe=(0,N.useRef)({getKdesignerApi:function(){return B.current},setDesignerDataRef:ee,getDesignerDataRef:function(){return F.current},getBaseHooks:function(e){return(null==w?void 0:w[e])||function(){}},getPrefixCls:function(e,t,n){var r;return n||(e=e||yc,t?m()(r="".concat(e,"-")).call(r,t):e)},getNodeMetaNameById:ne,prefixCls:yc,invokeAction:d,invokeApi:v,flowStatus:h,isReadonly:ot(h),flowMetaData:r,setVariables:G,expressionData:O,getControlText:k,compareType:b,webMsg:_,baseUrl:M,batchInvoke:s,customUtils:S,apiTestResults:K}),ie=(0,N.useMemo)((function(){return vc(vc({},oe.current),{},{getPreNodeVariablesById:re,getNodeVariablesById:ae,getControlIconMap:$,getRefBillVarFormId:le})}),[re,$,ae]);return I().createElement(I().Fragment,null,I().createElement(x.ConfigProvider,{value:{prefixCls:"kd"}},I().createElement(D.Provider,{value:ie},I().createElement(hc,{ref:V,globalConfig:X,meta:H,data:U,onApi:te}))))}))),hc=I().memo(k());gc.displayName="NocodeFlow";var Ec=gc}}]);