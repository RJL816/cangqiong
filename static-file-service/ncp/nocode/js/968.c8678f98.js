"use strict";(self.webpackChunknocode_platform=self.webpackChunknocode_platform||[]).push([[968],{96284:function(e,t,n){n.r(t),t.default={pop_bill:"mrjeIgpz_pop_bill",nav:"HWXWWyC8_nav",title:"_34mQ3R0Y_title",actions:"ZOf3XMTL_actions",actions_item:"F6AdVGn9_actions_item",main:"bcs4S9SC_main",bill:"_3PCGZ4TB_bill",flow:"Dv90iuBK_flow",footer:"_4hA9JCjW_footer",btns:"PkPDiNTc_btns",footer_tips:"vVuF264G_footer_tips",footer_pagination:"_9SKW9ac8_footer_pagination",footer_pagination_btn:"avKRPJXg_footer_pagination_btn",footer_pagination_btn_icon:"qUNKHdZU_footer_pagination_btn_icon",mr12:"MEE0puNt_mr12"}},51508:function(e,t,n){n.r(t),t.default={bill_turnpage:"UT7zcNAA_bill_turnpage",bill_turnpage_btn:"NXUfFYtE_bill_turnpage_btn",bill_turnpage_btn_icon:"uGhzCxyl_bill_turnpage_btn_icon"}},54348:function(e,t,n){var a=n(13568),l=n(13939),u=n(34716),i=n(70696),o=n(4884),r=n(3464),c=n(51400),f=n(25028),d=n(93252),s=n(9564);f(t,"__esModule",{value:!0}),t.default=void 0;var p=s(n(760)),m=s(n(38456)),v=s(n(96631)),_=s(n(78912)),b=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=P(t);if(n&&n.has(e))return n.get(e);var l={__proto__:null},u=f&&o;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var r=u?o(e,i):null;r&&(r.get||r.set)?f(l,i,r):l[i]=e[i]}return l.default=e,n&&n.set(e,l),l}(n(65984)),g=n(57264),h=s(n(96284)),k=n(63548),y=s(n(12992)),C=n(82416),N=s(n(40892)),w=s(n(49148)),E=s(n(3308)),I=n(98464),S=s(n(64004)),A=s(n(70072)),x=s(n(40436)),L=n(57056),M=s(n(21044));function P(e){if("function"!=typeof d)return null;var t=new d,n=new d;return(P=function(e){return e?n:t})(e)}function B(e,t){var n=l(e);if(u){var a=u(e);t&&(a=i(a).call(a,(function(t){return o(e,t).enumerable}))),n.push.apply(n,a)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){(0,v.default)(e,t,n[t])})):r?c(e,r(n)):B(Object(n)).forEach((function(t){f(e,t,o(n,t))}))}return e}var T=(0,b.memo)((function(e){var t=e.config,n=e.onRefresh,a=e.disabled,l=e.disabledMsg,u=e.billList,i=e.visible,o=e.showDelete,r=e.showEdit,c=e.showCopy,f=e.viewAuth,d=e.close,s=e.editShare,v=e.detailShareReqireLogin,P=e.detailShareNotReqireLogin,B=e.inputShareReqireLogin,T=e.inputShareNotReqireLogin,R=((0,b.useRef)(null),t.appId),D=t.targetFormId,q=t.pkId,z=t.Status,O=t.procInstId,j=t.userTaskActivityId,U=t.userTaskBusinessKey,K=t.userTaskCurrentUserId,W=t.taskId,G=(0,b.useState)(q),X=(0,_.default)(G,2),Y=X[0],Z=X[1],H=(0,b.useState)(z),J=(0,_.default)(H,2),V=J[0],Q=J[1],$=(0,b.useState)(!1),ee=(0,_.default)($,2),te=ee[0],ne=ee[1],ae=(0,b.useState)([]),le=(0,_.default)(ae,2),ue=le[0],ie=le[1],oe=(0,b.useState)(!1),re=(0,_.default)(oe,2),ce=re[0],fe=re[1],de=(0,b.useRef)(!1),se=(0,b.useState)(null),pe=(0,_.default)(se,2),me=pe[0],ve=pe[1],_e=(0,b.useState)(!1),be=(0,_.default)(_e,2),ge=(be[0],be[1]),he=(0,b.useCallback)((function(e){var t,n;return(0,p.default)(t=(0,p.default)(n="".concat(R,"|")).call(n,D,"|")).call(t,e)}),[R,D]),ke=(0,b.useMemo)((function(){if(j&&U&&K){var e,t=(0,m.default)(ue).call(ue,(function(e){return e.procInstId===O})),n=null==t||null===(e=t.approvalInfo)||void 0===e?void 0:(0,m.default)(e).call(e,(function(e){return e.taskId===W}));return null==n?void 0:n.nodeEntityNumber}return D}),[ue,O,W,D,j,U,K]),ye=(0,E.default)(ke),Ce=(0,b.useMemo)((function(){return ue.length>0}),[ue]),Ne=(0,x.default)(),we=Ne.state,Ee=Ne.sendUiData,Ie=(0,A.default)(D),Se=(0,b.useRef)(),Ae=(((0,b.useContext)(L.AuthorizeContext)||{}).authList||{}).printAuth;(0,b.useEffect)((function(){Se.current=Ie}),[Ie]),(0,b.useEffect)((function(){Z(q)}),[q]),(0,b.useEffect)((function(){var e;null==me||null===(e=me.loadPage)||void 0===e||e.call(me,F(F({},t),{},{pkId:Y}))}),[Y]),(0,b.useEffect)((function(){Q(t.Status)}),[t.Status]);var xe=(0,b.useMemo)((function(){return(0,g.isEditStatus)(V||"")}),[g.isEditStatus,V]),Le=(0,b.useMemo)((function(){return"addNew"===V}),[V]),Me=(0,b.useCallback)((function(){ge(!0),(0,I.getApprovalInfo)({entityNumber:D,businessKey:Y}).then((function(e){ge(!1),ie((null==e?void 0:e.rows)||[])})).catch((function(){ge(!1)}))}),[D,Y]);(0,b.useEffect)((function(){D&&Y&&Me()}),[D,Y,i,Me]);var Pe=(0,b.useCallback)((function(){null==n||n(),null==d||d()}),[n]),Be=(0,b.useCallback)((function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];document.body.removeAttribute("style"),de.current&&e&&("edit"===V||"addNew"===V)?ne(!0):null==d||d()}),[V,d]),Fe=(0,b.useCallback)((function(e,t,n,a,l,u,i){var o,r,c,f,d;if("print"===i)return(0,p.default)(o=(0,p.default)(r="/".concat(e,"/print/")).call(r,t,"/")).call(o,n,"/view");if(!n||Le)return(0,p.default)(c="/".concat(e,"/detail/")).call(c,t);if(a){var s,m,v;if(l){var _,b,g,h,k,y=(0,p.default)(_=(0,p.default)(b=(0,p.default)(g=(0,p.default)(h="/".concat(e,"/detail/")).call(h,t,"/")).call(g,n,"/")).call(b,a,"/flow/")).call(_,l);return u?(0,p.default)(k="".concat(y,"/task/")).call(k,u):y}return(0,p.default)(s=(0,p.default)(m=(0,p.default)(v="/".concat(e,"/detail/")).call(v,t,"/")).call(m,n,"/")).call(s,a)}return(0,p.default)(f=(0,p.default)(d="/".concat(e,"/detail/")).call(d,t,"/")).call(f,n)}),[Le]),Te=(0,b.useCallback)((function(){return(0,g.showNotice)("error",l)}),[]),Re=a?Te:void 0,De=Fe(R,D,Y,V,O,W,""),qe=Fe(R,D,Y,V,O,W,"print"),ze=(0,b.useMemo)((function(){return Y?xe?"编辑":"详情":""}),[Y,xe]),Oe=(0,b.useMemo)((function(){return xe?Le?T||B:s:v||P}),[Le,xe,s,v,P,T,B]),je=(0,b.useMemo)((function(){return Ae&&"view"===V&&!O}),[V,Ae]),Ue=(0,b.useMemo)((function(){return"view"===V||Le}),[V,Le]),Ke=(0,b.useCallback)((function(){(0,g.openner)(De),Be(!1)}),[De,l,Be]),We=(0,b.useCallback)((function(e){switch(e){case"ok":ne(!1);break;case"cancel":ne(!1),null==d||d()}}),[d]),Ge=function(){if(a)return(0,g.showNotice)("error",l);(0,g.openner)(qe),Be(!1)},Xe=(0,b.useMemo)((function(){return xe?Le||j&&U&&K?"录入":"编辑":"详情"}),[xe,Le]),Ye=(0,b.useMemo)((function(){var e,n,u;return b.default.createElement("div",{className:h.default.nav},b.default.createElement("div",{className:h.default.title},Xe),b.default.createElement("div",{className:h.default.actions},je&&b.default.createElement(C.BtnField,{className:h.default.actions_item,type:"text","data-nc-action":(0,p.default)(e="".concat(R,"|")).call(e,D,"|tb_enterprint"),onClick:Ge,text:"打印",icon:{prefix:"nocodeplatformicon",type:"dayin"}}),Oe&&b.default.createElement(y.default,{config:F(F({},t),{},{pkId:Y,Status:V}),allowNoAuth:Ue,shareLink:["/","nocode",De,window.location.search].join(""),modalTitle:ze,iconType:"fenxiang-xian",className:h.default.actions_item,onClick:Re,shareReqireLogin:xe?Le?B:s:v,shareNotReqireLogin:xe?Le?T:s:P,isDetail:!0}),O?null:a?b.default.createElement(C.BtnField,{onClick:function(){return(0,g.showNotice)("error",l)},"data-nc-action":(0,p.default)(n="".concat(R,"|")).call(n,D,"|tb_np"),type:"text",className:h.default.actions_item,text:"在新页面打开",icon:{prefix:"nocodeplatformicon",type:"zhankai2"}}):b.default.createElement(C.BtnField,{onClick:Ke,"data-nc-action":(0,p.default)(u="".concat(R,"|")).call(u,D,"|tb_np"),type:"text",className:h.default.actions_item,text:"在新页面打开",icon:{prefix:"nocodeplatformicon",type:"zhankai2"}})))}),[De,xe,Xe,Le,t,Y,Ce,Be,Oe,Ue,z]),Ze=(0,b.useCallback)((function(e){if(e){ve(e);var t=null==e?void 0:e.getPageStatus();t&&Q(t)}}),[]),He=(0,b.useCallback)((function(e,t){!t&&Be(!1),de.current=!1,null==n||n()}),[n,Be]),Je=(0,b.useCallback)((function(){Be(!1),null==n||n({type:"delete",params:{pkId:Y}})}),[n,Be,Y]),Ve=(0,b.useCallback)((function(){ie([]),de.current=!1}),[n,Be,Y]),Qe=(0,b.useCallback)((function(e){Q(e)}),[]),$e=(0,b.useMemo)((function(){var e=F(F({},t),{},{pkId:Y});return W&&(e.taskId=W),e}),[t,Y]),et=(0,b.useMemo)((function(){return"addNew"===V?{title:"您录入的内容未提交，是否返回提交？",submitBtnTxt:"返回提交"}:{title:"您编辑的内容未保存，是否返回保存？",submitBtnTxt:"返回保存"}}),[V]);return b.default.createElement(b.default.Fragment,null,b.default.createElement(k.Drawer,{placement:"right",visible:i,keyboard:!1,onClose:Be,title:Ye,width:Ce?1180:860,destroyOnClose:!0,className:h.default.pop_bill},b.default.createElement("div",{className:h.default.main,style:{background:ye}},b.default.createElement("div",{className:h.default.bill,onFocusCapture:function(){de.current=!0}},b.default.createElement(M.default,{onRef:Ze,config:$e,options:{onStatusChange:Qe,sendUiData:Ee,rootConfig:we.rootConfig}})),b.default.createElement("div",{className:h.default.flow},Ce?b.default.createElement(w.default,{data:ue,taskId:W,config:$e,setFormLock:fe,onSubmit:Pe,bosApi:me}):null)),b.default.createElement(S.default,{status:V,disabled:a,disabledCb:Te,bosApi:me,authList:{deleteAuth:o,inputAuth:c,editAuth:r,viewAuth:f},config:$e,isSharePage:!1,formLock:ce,newPkId:Y,extraButton:function(){return b.default.createElement(N.default,{billList:u,curPkId:Y,setCurPkId:Z,createUiActionDataStr:he})},setStatus:Q,copyCallback:Ve,delCallback:Je,saveCallback:He})),te&&b.default.createElement(C.ConfirmModal,{type:"warning",visible:te,title:et.title,actions:[{key:"cancel",text:"直接退出"},{key:"ok",text:et.submitBtnTxt}],onAction:We}))}));T.displayName="PopBill";t.default=T},40892:function(e,t,n){var a=n(13568),l=n(93252),u=n(25028),i=n(4884),o=n(9564);u(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n(23992)),c=o(n(33260)),f=o(n(78912)),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var l={__proto__:null},o=u&&i;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var c=o?i(e,r):null;c&&(c.get||c.set)?u(l,r,c):l[r]=e[r]}return l.default=e,n&&n.set(e,l),l}(n(65984)),s=n(63548),p=n(82416),m=o(n(51508));function v(e){if("function"!=typeof l)return null;var t=new l,n=new l;return(v=function(e){return e?n:t})(e)}var _=function(e){var t=e.billList,n=void 0===t?[]:t,a=e.curPkId,l=void 0===a?"":a,u=e.setCurPkId,i=void 0===u?function(){}:u,o=e.createUiActionDataStr,v=(0,d.useState)((0,r.default)(n).call(n,(function(e){return e.id}))),_=(0,f.default)(v,2),b=_[0],g=_[1],h=b.length;(0,d.useEffect)((function(){n.length>0&&g((0,r.default)(n).call(n,(function(e){return e.id})))}),[n]);var k=[{icon:"zuiqian",desc:"第一条表单详情",disabled:h<=1||l===b[0],userActionName:"fu_fo_first",onClick:function(){if(h>1){0!==(0,c.default)(b).call(b,l)&&i(b[0])}}},{icon:"fangxiangzuo",desc:"上一条详情",disabled:h<=1||l===b[0],userActionName:"fu_fo_prev",onClick:function(){if(h>1){var e=(0,c.default)(b).call(b,l)-1;-1!==e&&i(b[e])}}},{icon:"fangxiangyou",desc:"下一条详情",disabled:h<=1||l===b[h-1],userActionName:"fu_fo_next",onClick:function(){if(h>1){var e=(0,c.default)(b).call(b,l)+1;e!==h&&i(b[e])}}},{icon:"zuihou",desc:"最后一条详情",disabled:h<=1||l===b[h-1],userActionName:"fu_fo_last",onClick:function(){if(h>1){var e=(0,c.default)(b).call(b,l),t=h-1;e!==t&&i(b[t])}}}];return d.default.createElement("div",{className:m.default.bill_turnpage},(0,r.default)(k).call(k,(function(e){var t=e.disabled,n=e.desc,a=e.icon,l=e.userActionName,u=e.onClick;return d.default.createElement(p.BtnField,{key:a,disabled:t,onClick:u,className:m.default.bill_turnpage_btn,size:"small",title:n,"data-nc-action":o(l)},d.default.createElement(s.Icon,{prefix:"nocodeplatformicon",className:m.default.bill_turnpage_btn_icon,type:a}))})))};_.displayName="PopBillTurnPage";t.default=_},12992:function(e,t,n){var a=n(13568),l=n(93252),u=n(25028),i=n(4884),o=n(9564);u(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n(29052)),c=o(n(760)),f=o(n(73980)),d=o(n(94924)),s=o(n(78912)),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=N(t);if(n&&n.has(e))return n.get(e);var l={__proto__:null},o=u&&i;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var c=o?i(e,r):null;c&&(c.get||c.set)?u(l,r,c):l[r]=e[r]}return l.default=e,n&&n.set(e,l),l}(n(65984)),m=n(39392),v=o(n(1524)),_=n(4440),b=n(82416),g=n(25096),h=n(6940),k=n(80672),y=n(63516),C=o(n(40436));function N(e){if("function"!=typeof l)return null;var t=new l,n=new l;return(N=function(e){return e?n:t})(e)}var w=(0,p.memo)((function(e){var t,n=e.config,a=e.className,l=e.size,u=void 0===l?"middle":l,i=e.shareLink,o=e.modalTitle,N=void 0===o?"列表页":o,w=e.iconType,E=void 0===w?"fenxiang":w,I=e.onClick,S=e.allowNoAuth,A=e.shareReqireLogin,x=e.shareNotReqireLogin,L=(0,C.default)(),M=L.state,P=L.dispatch,B=n.appId,F=n.targetFormId,T=n.Status,R=n.pkId,D=M.userInfo,q=M.appsList[B],z=M.fileServer,O=M.selectedFormData,j=(0,m.useTranslation)().t,U=(0,p.useState)(O||{}),K=(0,s.default)(U,2),W=K[0],G=K[1],X=(0,p.useState)(!1),Y=(0,s.default)(X,2),Z=Y[0],H=Y[1];(0,p.useEffect)((function(){if(!q){var e="nocode/v2/nocode_sys/app/".concat(B);(0,y.getWithPriority)((0,h.getStoreData)(e,""),(0,g.getAppInfoById)(B).then((function(t){return(0,h.setStoreData)(e,"",t),t})),(function(e){var t,n=null==e||null===(t=e.rows)||void 0===t?void 0:t[0];n&&P({type:k.UPDATE_APP_INFO_BY_ID,payload:{id:B,value:n}})}))}}),[q,B]);var J=(0,p.useMemo)((function(){var e,t;return(0,c.default)(e="".concat(null===(t=W.name)||void 0===t?void 0:(0,f.default)(t).call(t,0,50-N.length))).call(e,N)}),[W,N,T]),V=function(){var e=(0,d.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!I){e.next=2;break}return e.abrupt("return",I());case 2:(0,_.getFormData)({appId:B,targetFormId:F}).then((function(e){var t,n=(null==e||null===(t=e.rows)||void 0===t?void 0:t[0])||{};G(n),H(!0)})).catch((function(e){}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Q=(0,p.useCallback)((function(){H(!1)}),[]);return p.default.createElement(p.default.Fragment,null,p.default.createElement(b.BtnField,{size:u,type:"text","data-nc-action":(0,c.default)(t="".concat(B,"|")).call(t,F,"|tb_share"),onClick:V,className:a,text:j("apps.share"),icon:{prefix:"nocodeplatformicon",type:E}}),Z&&p.default.createElement(v.default,{visible:Z,title:"分享",onCancel:Q,onOk:Q,shareTitle:J,needLoginLink:i,shareByPeople:null==D?void 0:D.name,shareAppImage:null==q?void 0:q.image,formid:R||W.formId,fileServer:z,allowNoAuth:S,formData:W,config:n,shareReqireLogin:A,shareNotReqireLogin:x}))}));w.displayName="ShareButton";t.default=w}}]);