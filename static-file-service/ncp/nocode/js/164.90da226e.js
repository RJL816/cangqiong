"use strict";(self.webpackChunknocode_platform=self.webpackChunknocode_platform||[]).push([[164],{12520:function(e,t,n){n.r(t),t.default={statCard:"ImFi+SK4_statCard"}},48088:function(e,t,n){n.r(t),t.default={"statistics-setting-modal":"Zqnm+uFS_statistics-setting-modal","statistics-setting-modal-form-item-checkbox":"XEWz+Ixc_statistics-setting-modal-form-item-checkbox","statistics-setting-modal-footer":"pkgnqvI4_statistics-setting-modal-footer","statistics-setting-modal-body":"SLVI63xV_statistics-setting-modal-body","form-item-row":"v6VzcB10_form-item-row","form-item-row-50":"O1KTVDth_form-item-row-50","form-item-vertical":"Yhbgz058_form-item-vertical","form-title":"_011rxes1_form-title",filter:"_0vojJeKi_filter","is-active":"Hr4i7Apt_is-active","filter-label-bar":"_2S-gIQ-6_filter-label-bar","sync-filter-setting":"_3L66tnD7_sync-filter-setting"}},34912:function(e,t,n){n.r(t),t.default={drawer:"ge4-TjAI_drawer",title:"ByDmoXK4_title","title-desc":"mJUSmbno_title-desc",add:"UduWhfDy_add",icon:"s77pvofM_icon",card_empty:"UcdA4c8o_card_empty",empty_content:"rjPmWQiu_empty_content",empty_text:"BuobLxbD_empty_text"}},44164:function(e,t,n){n.r(t),t.default={title:"O8Hm+nQz_title","title-name":"OuZ9o325_title-name","title-icon":"_3Q38LMSO_title-icon","title-drag":"bnA7BGaC_title-drag","title-more":"cbPfkWhG_title-more","tree-node-item-hover":"jQdR1264_tree-node-item-hover",popper:"tzoheLQL_popper"}},68592:function(e,t,n){n.r(t),t.default={custom:"_73PhxGtV_custom",custom_main:"X58ucWuM_custom_main",addcardmark:"+jDUwFlb_addcardmark"}},94958:function(e,t,n){n.r(t),t.default={header_nav:"GWucqz0j_header_nav",header_nav_container:"Ovudhbpp_header_nav_container",header_nav_menu:"q2r5C6zu_header_nav_menu",header_nav_menu_item:"i1eYlHah_header_nav_menu_item",header_nav_menu_item_divider:"_4rcXUi6A_header_nav_menu_item_divider"}},28980:function(e,t,n){var a=n(73980),r=n(13440),l=n(59992),u=n(60600);n(25028)(t,"__esModule",{value:!0}),t.default=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];(0,o.useEffect)((function(){var o=function(n){var o,d=function(e,t){var n=void 0!==l&&u(e)||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return i(e,t);var l=a(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===l&&e.constructor&&(l=e.constructor.name);if("Map"===l||"Set"===l)return r(e);if("Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,d=function(){};return{s:d,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:d}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,f=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return f=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){s=!0,c=e})),f:function(){try{f||null==n.return||n.return()}finally{if(s)throw c}}}}(e);try{for(d.s();!(o=d.n()).done;){var c,f=o.value;if(null!=f&&null!==(c=f.current)&&void 0!==c&&c.contains(n.target))return}}catch(e){d.e(e)}finally{d.f()}t(n)};return document.addEventListener("mousedown",o,n),document.addEventListener("touchstart",o),function(){document.removeEventListener("mousedown",o,n),document.removeEventListener("touchstart",o)}}),[e,t])};var o=n(65984);function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}},33856:function(e,t,n){var a=n(25028),r=n(9564);a(t,"__esModule",{value:!0}),t.default=void 0;var l=r(n(67584)),u=r(n(78912)),o=n(65984);t.default=function(e,t){var n=(0,o.useState)(!1),a=(0,u.default)(n,2),r=a[0],i=a[1],d=(0,o.useState)(!1),c=(0,u.default)(d,2),f=c[0],s=c[1],m=(0,o.useRef)();return(0,o.useEffect)((function(){var n;m.current=(0,l.default)((function(){i(!0)}),[t]),null===(n=e())||void 0===n||n.then((function(e){clearTimeout(m.current),s(!0),i(!1)}))}),[]),[r,f]}},89208:function(e,t,n){var a=n(13568),r=n(13939),l=n(34716),u=n(70696),o=n(4884),i=n(3464),d=n(51400),c=n(25028),f=n(93252),s=n(9564);c(t,"__esModule",{value:!0}),t.loopEditName=t.loopAddMenu=t.getTreeFirstFormNode=t.getNodeKeyByFormId=t.getNodeById=t.getNodeByFormId=t.getMenuTreeData=t.getGroupNodes=t.getFormNodes=void 0,t.transformTreeData=function e(t,n,a,r){var l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5?arguments[5]:void 0,o=l+1,i=!0;o>=r&&(i=!1);return t.forEach((function(t){var l=t.key,d=t.id,c=t.children,f=t.formId,s=t.name,m=t.parentId,v=t.seq,p=t.image,h=t.type;t.key=l||d||"",t.title=n?n({name:s,key:t.key,formId:f,parentId:m,seq:v,image:p,canAddChildGroup:i,type:h}):s,t.children=c&&c.length>0&&e(c,n,a,r,o,u),t.selectable=u?u():!!f,a&&(t.icon=a(I(I({},t),{},{hasChild:c&&c.length>0})))})),t};var m=s(n(61260)),v=s(n(28429)),p=s(n(96631)),h=(function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=E(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},l=c&&o;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=l?o(e,u):null;i&&(i.get||i.set)?c(r,u,i):r[u]=e[u]}r.default=e,n&&n.set(e,r)}(n(65984)),n(63548),n(66200),n(6940)),g=n(25960),y=n(63516),_=n(98464),b=n(25096);function E(e){if("function"!=typeof f)return null;var t=new f,n=new f;return(E=function(e){return e?n:t})(e)}function C(e,t){var n=r(e);if(l){var a=l(e);t&&(a=u(a).call(a,(function(t){return o(e,t).enumerable}))),n.push.apply(n,a)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){(0,p.default)(e,t,n[t])})):i?d(e,i(n)):C(Object(n)).forEach((function(t){c(e,t,o(n,t))}))}return e}t.getTreeFirstFormNode=function e(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=0;a<t.length;){var r=t[a];if(r.formId)return n=n||{formId:r.formId,key:r.key,name:r.name,type:r.type};r.children&&!n&&(n=e(r.children)),a++}return n};t.getNodeKeyByFormId=function(e,t){var n;return null===(n=w(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:""))||void 0===n?void 0:n.key};var w=t.getNodeByFormId=function e(t,n){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=0;r<t.length;){var l=t[r];if(l.formId===n)return a=a||l;l.children&&!a&&(a=e(l.children,n,a)),r++}return a};t.getNodeById=function e(t,n){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=0;r<t.length;){var l=t[r];if(l.id===n)return a=a||l;l.children&&!a&&(a=e(l.children,n,a)),r++}return a},t.getGroupNodes=function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return t.forEach((function(t){if(!t.formId&&r<n&&a.push(t),t.children){var l=r+1;e(t.children,n,a,l)}})),a},t.getFormNodes=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.forEach((function(t){!t.children&&t.formId&&n.push(t),t.children&&e(t.children,n)})),n},t.loopAddMenu=function e(t,n,a,r){for(var l=!1,u=!1,o=0;o<(null==t?void 0:t.length);o++){if(t[o].formId===r){(0,m.default)(t).call(t,o+1,0,a),l=!0;break}if(!r&&t[o].key===n){t[o].children=t[o].children||[],t[o].children.push(a),l=!0;break}if(t[o].children){var i=e(t[o].children,n,a,r);i&&(u=i)}}return l||u},t.loopEditName=function e(t,n,a){for(var r=0;r<(null==t?void 0:t.length);r++){if(t[r].id===n){t[r].name=a;break}e(t[r].children,n)}},t.getMenuTreeData=function(e,t){var n=(0,_.getReqUrl)(e),a=v.default.all([(0,h.getStoreData)(g.GET_LINEICON_COLOR,""),(0,h.getStoreData)(n,"")]),r=v.default.all([(0,b.getLineIconAndColor)(),(0,_.getFormList)(e)]).then((function(e){return(0,h.setStoreData)(g.GET_LINEICON_COLOR,"",I({},e[0])),(0,h.setStoreData)(n,"",I({},e[1])),e}));return(0,y.getWithPriority)(a,r,t)}},21724:function(e,t,n){var a=n(13568),r=n(93252),l=n(25028),u=n(4884),o=n(9564);l(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n(760)),d=n(57264),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=s(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},o=l&&u;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var d=o?u(e,i):null;d&&(d.get||d.set)?l(r,i,d):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}(n(65984)),f=o(n(12520));function s(e){if("function"!=typeof r)return null;var t=new r,n=new r;return(s=function(e){return e?n:t})(e)}t.default=function(e){var t,n,a=e.cardId,r=e.title,l=e.onClick,u=(0,c.useRef)(null),o=(0,i.default)(t=(0,i.default)(n="".concat(window.__domainurl__,"qing/qingNoCodeCardEntrance.do?cardId=")).call(n,a,"&cardName=")).call(t,encodeURIComponent(r));return c.default.createElement("div",{className:f.default.statCard,onClick:l},c.default.createElement("iframe",{id:"stat_iframe_card_".concat(a),ref:u,src:(0,d.getUrlWithDataCenter)(o),frameBorder:"0",width:"100%",height:"100%",onLoad:function(){var e,t=document.documentElement.getAttribute("style");t&&(null===(e=u.current)||void 0===e||e.contentWindow.document.documentElement.setAttribute("style",t))}}))}},32196:function(e,t,n){var a=n(13568),r=n(13939),l=n(34716),u=n(70696),o=n(4884),i=n(3464),d=n(51400),c=n(25028),f=n(93252),s=n(9564);c(t,"__esModule",{value:!0}),t.default=void 0;var m=s(n(70696)),v=s(n(28429)),p=s(n(73020)),h=s(n(67584)),g=s(n(72400)),y=s(n(23992)),_=s(n(38456)),b=s(n(96631)),E=s(n(78912)),C=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=j(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},l=c&&o;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=l?o(e,u):null;i&&(i.get||i.set)?c(r,u,i):r[u]=e[u]}return r.default=e,n&&n.set(e,r),r}(n(65984)),I=n(63548),w=s(n(11264)),k=n(12700),N=s(n(39792)),F=s(n(39372)),x=n(69400),S=n(66028),O=s(n(48088)),A=s(n(71252)),M=n(82416),L=s(n(36060));function j(e){if("function"!=typeof f)return null;var t=new f,n=new f;return(j=function(e){return e?n:t})(e)}function D(e,t){var n=r(e);if(l){var a=l(e);t&&(a=u(a).call(a,(function(t){return o(e,t).enumerable}))),n.push.apply(n,a)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){(0,b.default)(e,t,n[t])})):i?d(e,i(n)):D(Object(n)).forEach((function(t){c(e,t,o(n,t))}))}return e}var R="statistics-setting",B={KPI:{dimension:0,measure:2},Column:{dimension:2,measure:3},StackedColumn:{dimension:2,measure:3},Bar:{dimension:2,measure:3},StackedBar:{dimension:2,measure:3},Line:{dimension:2,measure:3},Pie:{dimension:1,measure:1},Ring:{dimension:1,measure:1}},P=(0,C.forwardRef)((function(e,t){var n,a,r=e.prefixCls,l=e.statSetting,u=e.formOptions,o=e.listFilterConfig,i=e.statField,d=e.getEnumFilterValue,c=e.syncFilterSettings,f=e.schemaList,s=void 0===f?[]:f,y=I.Form.useForm(),_=(0,E.default)(y,1)[0],j=(0,C.useReducer)(S.assignDataReducer,l),D=(0,E.default)(j,2),R=D[0],P=D[1],q=(0,C.useState)(!1),V=(0,E.default)(q,2),z=V[0],W=V[1],G=(0,C.useState)((null==l?void 0:l.filters)||[]),U=(0,E.default)(G,2),H=U[0],K=U[1],Q=(0,C.useState)(),X=(0,E.default)(Q,2),J=X[0],Y=X[1],Z=(0,C.useRef)(),$=(0,C.useCallback)((function(){W(!1)}),[]),ee=(0,C.useCallback)((function(e){var t=(0,x.getEffectiveFilterItems)(e);K(t),W(!1)}),[K]),te=(0,C.useCallback)((function(e){var t=null==H?void 0:(0,m.default)(H).call(H,(function(t,n){return e!==n}));K(t)}),[H,K]),ne=(0,C.useCallback)((function(e,t){d({fieldName:null==e?void 0:e.fieldName,compareType:null==e?void 0:e.compareType,value:null==e?void 0:e.value},t).then((function(t){Y((function(n){return T(T({},n),{},(0,b.default)({},null==e?void 0:e.fieldName,t))}))}))}),[d]),ae=(0,C.useMemo)((function(){return B[R.chartType]||{}}),[R.chartType]);(0,C.useImperativeHandle)(t,(function(){return{validateFields:re,filters:H,setConfiguredFilterItems:K}}));var re=function(){return new v.default((function(e,t){_.validateFields().then((function(t){var n=(0,p.default)(t);e(n)})).catch((function(e){return t(e)}))}))},le=(0,C.useMemo)((function(){return(0,k.getTransferFilters)((0,k.getFilters)(H,o))}),[H,o]);return C.default.createElement("div",{className:O.default["".concat(r,"-modal-body")]},C.default.createElement(I.Form,{layout:"vertical",form:_,labelWidth:"100%",wrapperWidth:"100%",onValuesChange:function(e,t){}},C.default.createElement("div",{className:O.default["form-item-row"]},C.default.createElement(I.Form.Item,{label:"统计卡片名称",name:"title",required:!0,validateTrigger:"onBlur",rules:[{required:!0,message:"请输入统计卡片名称"}]},C.default.createElement(I.Input,{type:"text",value:R.title,borderType:"bordered",size:"large",placeholder:"请输入统计卡片名称",maxLength:50,onChange:function(e){return P({title:e.target.value})}})),C.default.createElement(I.Form.Item,{label:"分析的表单",name:"formId"},C.default.createElement(I.Select,{disabled:!0,value:R.formId,options:u,borderType:"bordered",size:"large",placeholder:"请选择分析的表单",onChange:function(e){return P({formId:e})}}))),C.default.createElement("div",{className:O.default["form-item-vertical"]},C.default.createElement("div",{className:O.default["form-title"]},C.default.createElement("div",{className:O.default["title-left"]},"筛选条件"),C.default.createElement("div",{className:O.default["title-right"]},C.default.createElement(L.default,{title:"筛选",titleRight:C.default.createElement("div",{className:O.default["sync-filter-setting"],onClick:c},C.default.createElement(I.Icon,{prefix:"nocodeplatformicon",type:"qiehuan",rotate:90}),"同步表单列表筛选条件"),onClose:$,onConfirm:ee,data:o||[],configuredFilterItems:H,style:{width:"640px",height:"332px"},maskClosable:!0,maskStyle:{opacity:0},draggable:!0,showClearAll:!0,onDelete:te,onColHeadFilterVisibleChange:ne,colHeadFilter:J,visible:z,onDropdownVisibleChange:function(e){Z.current=e},onVisibleChange:function(e){(0,h.default)((function(){Z.current||W(e)}))}},C.default.createElement("p",{className:(0,A.default)([(0,m.default)(O.default),(0,b.default)({},O.default["is-active"],z)])},C.default.createElement(I.Icon,{prefix:"nocodeplatformicon",type:"shaixuan"}),"筛选")))),C.default.createElement(M.FilterLabelBar,{maxLabelCount:3,filters:le,onDelete:te,className:O.default["filter-label-bar"]})),C.default.createElement(I.Form.Item,{label:"图表类型",name:"chartType"},C.default.createElement(w.default,{value:R.chartType,onChange:function(e){P({chartType:e})}})),C.default.createElement("div",{className:O.default["form-item-row"]},"KPI"!==R.chartType&&C.default.createElement(I.Form.Item,{label:"维度",name:"dimensions",required:!0,rules:[{type:"array",validator:function(e,t,n,a,r){return null!=t&&t.length?t.every((function(e){return(0,g.default)(e).every((function(e){return""!==e}))}))?[]:[new Error("请选择维度")]:[new Error("请添加维度")]}}]},C.default.createElement(N.default,{value:R.dimensions,addText:"添加维度",fieldsData:i.dimensionsField||[],maxCount:(null===(n=R.measures)||void 0===n?void 0:n.length)>1?1:ae.dimension,onChange:function(e){return P({dimensions:e})},onAdd:function(e){P({dimensions:e}),_.setFieldValue("dimensions",e)}})),C.default.createElement(I.Form.Item,{label:"度量",name:"measures",required:!0,rules:[{type:"array",validator:function(e,t,n,a,r){return null!=t&&t.length?t.every((function(e){return(0,g.default)(e).every((function(e){return""!==e}))}))?[]:[new Error("请选择度量")]:[new Error("请添加度量")]}}]},C.default.createElement(F.default,{value:R.measures,addText:"添加度量",fieldsData:i.measuresField||[],maxCount:(null===(a=R.dimensions)||void 0===a?void 0:a.length)>1?1:ae.measure,onChange:function(e){return P({measures:e})},onAdd:function(e){P({measures:e}),_.setFieldValue("measures",e)}}))),C.default.createElement("div",{className:O.default["form-item-row-50"]},C.default.createElement(I.Form.Item,{label:"添加至",name:"schemaIds",required:!0,rules:[{type:"array",required:!0,message:"请选择视图"}]},C.default.createElement(I.Select,{mode:"multiple",value:R.schemaIds,options:s,borderType:"bordered",placeholder:"请选择视图",onChange:function(e){return P({schemaIds:e})}})))))})),q=function(e){var t=e.prefixCls,n=e.onCancel,a=e.onConfirm;return C.default.createElement("div",{className:O.default["".concat(t,"-modal-footer")]},C.default.createElement(I.Button,{onClick:n,type:"second",size:"small",className:O.default["".concat(t,"-modal-cancel-btn")]},"取消"),C.default.createElement(I.Button,{type:"primary",size:"small",style:{marginLeft:"12px"},onClick:a,className:O.default["".concat(t,"-modal-ok-btn")]},"确定"))},V=(0,C.memo)((function(e){var t=e.visible,n=e.setVisible,a=e.statSetting,r=e.formOptions,l=void 0===r?[]:r,u=e.listFilterConfig,o=e.statField,i=e.getEnumFilterValue,d=(e.listFilters,e.getListFilters),c=e.onConfirm,f=e.schemaList,s=(0,C.useState)(window.innerHeight-64-96),m=(0,E.default)(s,2),v=m[0],p=m[1],h=(0,C.useRef)(null),g=function(e,t,n,a){var r;n[e]&&(t[e]=(0,y.default)(r=n[e]).call(r,(function(e){var t,n=e.fieldId,r=null===(t=(0,_.default)(a).call(a,(function(e){return e.number===n})))||void 0===t?void 0:t.name;return r?T(T({},e),{},{fieldName:r}):e})))},b=function(){var e=h.current,t=e.validateFields,a=e.filters;t().then((function(e){var t=o.measuresField,r=o.dimensionsField,l=T({},e);g("measures",l,e,t),g("dimensions",l,e,r),n(!1),null==c||c(T(T({},l),{},{filters:a}))})).catch((function(e){}))},w=function(){n(!1)};return(0,C.useEffect)((function(){v%2!=0&&p(v-1)}),[]),C.default.createElement(I.Modal,{mask:!0,visible:t,keyboard:!1,body:C.default.createElement(P,{prefixCls:R,ref:h,statSetting:a,formOptions:l,listFilterConfig:u,statField:o,getEnumFilterValue:i,syncFilterSettings:function(){var e=(null==d?void 0:d())||[],t=h.current.setConfiguredFilterItems;null==t||t(e)},schemaList:f}),bodyStyle:{maxHeight:v},titleIcon:null,className:O.default["".concat(R,"-modal")],footer:C.default.createElement(q,{prefixCls:R,onConfirm:b,onCancel:w}),maskClosable:!1,width:960,height:520,title:"设置统计卡片",closable:!0,destroyOnClose:!0,onCancel:w,onOk:b})}));t.default=V},64668:function(e,t,n){var a=n(13568),r=n(13939),l=n(34716),u=n(70696),o=n(4884),i=n(3464),d=n(51400),c=n(25028),f=n(93252),s=n(9564);c(t,"__esModule",{value:!0}),t.default=void 0;var m=s(n(38456)),v=s(n(23992)),p=s(n(760)),h=s(n(67584)),g=s(n(29052)),y=s(n(13568)),_=s(n(94924)),b=s(n(96631)),E=s(n(78912)),C=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=D(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},l=c&&o;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=l?o(e,u):null;i&&(i.get||i.set)?c(r,u,i):r[u]=e[u]}return r.default=e,n&&n.set(e,r),r}(n(65984)),I=n(63548),w=s(n(34912)),k=n(98464),N=n(41936),F=s(n(32196)),x=s(n(21724)),S=s(n(28980)),O=n(57264),A=n(82416),M=n(66028),L=s(n(26124)),j=n(78016);function D(e){if("function"!=typeof f)return null;var t=new f,n=new f;return(D=function(e){return e?n:t})(e)}function T(e,t){var n=r(e);if(l){var a=l(e);t&&(a=u(a).call(a,(function(t){return o(e,t).enumerable}))),n.push.apply(n,a)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){(0,b.default)(e,t,n[t])})):i?d(e,i(n)):T(Object(n)).forEach((function(t){c(e,t,o(n,t))}))}return e}var B=function(e){var t=e.handleAdd;return C.default.createElement("div",{className:w.default.card_empty},C.default.createElement("div",{className:w.default.empty_content},C.default.createElement("img",{src:L.default,alt:"暂无卡片",width:320,height:160}),C.default.createElement("div",{className:w.default.empty_text},"暂无卡片，点击下方按钮添加"),C.default.createElement(I.Button,{type:"primary",icon:C.default.createElement(I.Icon,{prefix:"nocodeplatformicon",type:"zengjia-yuan"}),onClick:t},"添加卡片")))},P={title:"",formId:"",chartType:"Column",measures:[],dimensions:[],filters:[]};t.default=function(e){var t=e.visible,n=e.setVisible,a=e.formName,r=void 0===a?"":a,l=e.env,u=void 0===l?"0":l,o=e.title,i=void 0===o?"统计":o,d=e.listFilterConfig,c=e.configuredFilterItems,f=e.getConfiguredFilterItems,s=e.viewInfo,b=e.activeSchemaId,L=e.getEnumFilterValue,D=e.disabled,T=e.disabledAction,q=(0,N.useParams)(),V=q.appId,z=q.targetFormId,W=(0,C.useState)(null),G=(0,E.default)(W,2),U=G[0],H=G[1],K=(0,C.useState)(!1),Q=(0,E.default)(K,2),X=Q[0],J=Q[1],Y=(0,C.useReducer)(M.assignDataReducer,R(R({},P),{},{formId:z})),Z=(0,E.default)(Y,2),$=Z[0],ee=Z[1],te=(0,C.useState)({}),ne=(0,E.default)(te,2),ae=ne[0],re=ne[1],le=(0,C.useRef)(null),ue=(0,C.useRef)(""),oe=(0,C.useRef)("");(0,S.default)([le],(function(e){var a=document.getElementById("app");(!a||null!=a&&a.contains(e.target))&&t&&!X&&n(!1)}));var ie=(0,C.useCallback)(function(){var e=(0,_.default)(g.default.mark((function e(t){var n,a,r;return g.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,k.getStartCard)(V,z,u);case 3:n=e.sent,a=(n||{}).rows,H(void 0===a?[]:a),t&&t(),e.next=15;break;case 9:e.prev=9,e.t0=e.catch(0),r=e.t0.message,(0,O.showNotice)("error",r),H([]);case 15:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),[H,V,z]),de=function(){var e=(0,_.default)(g.default.mark((function e(){var t,n,a,r;return g.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,k.getStatField)(z);case 3:t=e.sent,n=(t||{}).rows,re((null==(a=void 0===n?[]:n)?void 0:a[0])||{}),e.next=14;break;case 8:e.prev=8,e.t0=e.catch(0),r=e.t0.message,(0,O.showNotice)("error",r),re({});case 14:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),ce=(0,C.useCallback)(function(){var e=(0,_.default)(g.default.mark((function e(t){var n,a,r;return g.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!D){e.next=2;break}return e.abrupt("return",T());case 2:return n={formId:z,appId:V,env:u,cardIds:t},e.prev=3,e.next=6,(0,k.deleteStatCard)(n);case 6:a=e.sent,(a||{}).successCount>0&&((0,O.showNotice)("success","删除成功"),ie()),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(3),r=e.t0.message,(0,O.showNotice)("error",r||"删除失败");case 16:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}(),[ie,D,T]);(0,C.useEffect)((function(){t&&(ie(),de())}),[t]);var fe=(0,C.useCallback)((function(){if(D)return T();ue.current="";var e="新建统计卡片".concat(null!=U&&U.length?(null==U?void 0:U.length)+1:1);ee(R(R({},P),{},{title:e,formId:z,schemaIds:[b]})),J(!0)}),[D,T,J,U,z,b]),se=(0,C.useCallback)(function(){var e=(0,_.default)(g.default.mark((function e(t,n){var a,r,l,u,o,i,d,c,f;return g.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.title,r=n.schemaIds,e.prev=1,e.next=4,(0,k.getQingCardParams)(t);case 4:l=e.sent,u=l.rows,o=(void 0===u?[]:u)[0]||{},i=o.qingCardParams,d=o.filters,c=o.formId,ee(R({title:a,filters:d,formId:c,schemaIds:r},i)),J(!0),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(1),f=e.t0.message,(0,O.showNotice)("error",f);case 17:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t,n){return e.apply(this,arguments)}}(),[ee]),me=(0,C.useCallback)((function(e){if(D)return T();ue.current=e;var t=(0,m.default)(U).call(U,(function(t){return t.cardId===e}))||{};se(e,t)}),[se,U,D,T]),ve=function(e,t){var n=document.getElementById("stat_iframe_card_".concat(e));if(n){var a,r,l=(0,p.default)(a=(0,p.default)(r="".concat(window.__domainurl__,"qing/qingNoCodeCardEntrance.do?cardId=")).call(r,e,"&cardName=")).call(a,encodeURIComponent(t));n.src=(0,O.getUrlWithDataCenter)(l)}},pe=function(){var e=(0,_.default)(g.default.mark((function e(t){var n,a,r,l,o,i,d,c,f,s,m,v,p;return g.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,j.publishClickUserEvent)({formId:z,appId:V,action:"setc_ana_comf"}),n=t.title,a=t.chartType,r=t.measures,l=t.dimensions,o=t.filters,t.assignOrgs,t.assignUsers,i=t.schemaIds,d={title:n,cardPath:V,formId:z,filters:o,qingCardParams:{chartType:a,measures:r,dimensions:l},schemaIds:i},ue.current&&(d.cardId=ue.current),c={data:[d]},e.prev=6,e.next=9,(0,k.saveStatSetting)(c,u);case 9:f=e.sent,s=f.result,m=void 0===s?[]:s,(0,O.showNotice)("success","保存成功"),ue.current?ie((function(){ve(ue.current,n)})):(v=m[0].id,oe.current=v,ie()),e.next=21;break;case 16:e.prev=16,e.t0=e.catch(6),p=e.t0.message,(0,O.showNotice)("error",p);case 21:case"end":return e.stop()}}),e,null,[[6,16]])})));return function(t){return e.apply(this,arguments)}}(),he=(0,C.useMemo)((function(){return[{label:r,value:z}]}),[z,r]),ge=(0,C.useMemo)((function(){return(null==s?void 0:(0,v.default)(s).call(s,(function(e){return{label:e.name,value:e.id}})))||[]}),[s]),ye=(0,C.useCallback)((function(e){var t=e.data;if(t&&"object"===(0,y.default)(t)){var n=t.methodName,a=t.cardId;"openSettingDialog"===n?me(a):"deleteCard"===n&&function(e){var t=((0,m.default)(U).call(U,(function(t){return t.cardId===e}))||{}).title;null===A.WebMsg||void 0===A.WebMsg||A.WebMsg.showConfirmModal({title:"确定删除".concat(t,"吗？"),type:"delete",onAction:function(t){"ok"===t&&ce([e])}})}(a)}}),[me,ce]);return(0,C.useEffect)((function(){return window.addEventListener("message",ye,!1),function(){window.removeEventListener("message",ye,!1)}}),[ye]),(0,C.useEffect)((function(){oe.current&&(0,h.default)((function(){var e=document.getElementById("stat_iframe_card_".concat(oe.current));null==e||e.scrollIntoView(),oe.current=""}),0)}),[U]),C.default.createElement(C.default.Fragment,null,C.default.createElement(I.Drawer,{key:b,mask:!1,visible:t,onClose:function(){return n(!1)},getContainer:function(){return document.body},ref:le,width:480,keyboard:!1,className:w.default.drawer,forceRender:!0,title:C.default.createElement("div",{className:w.default.title},C.default.createElement("div",{className:w.default["title-desc"]},i),!(null==U||!U.length)&&C.default.createElement("span",{className:w.default.add,onClick:fe},C.default.createElement(I.Icon,{type:"zengjia-yuan",prefix:"nocodeplatformicon",className:w.default.icon}),"添加"))},U&&(U.length?null==U?void 0:(0,v.default)(U).call(U,(function(e){var t=e.cardId,n=e.title;return C.default.createElement(x.default,{key:t,cardId:t,title:n})})):C.default.createElement(B,{handleAdd:fe}))),C.default.createElement(F.default,{visible:X,setVisible:J,statSetting:$,formOptions:he,listFilterConfig:d||[],statField:ae,getEnumFilterValue:L,listFilters:c,getListFilters:f,schemaList:ge,onConfirm:pe}))}},84140:function(e,t,n){var a=n(25028),r=n(9564);a(t,"__esModule",{value:!0}),t.default=void 0;var l=r(n(65984));t.default=function(){return l.default.createElement("div",null)}},66200:function(e,t,n){var a=n(13568),r=n(13939),l=n(34716),u=n(70696),o=n(4884),i=n(3464),d=n(51400),c=n(25028),f=n(93252),s=n(9564);c(t,"__esModule",{value:!0}),t.TreeNodeTitle=void 0;var m=s(n(760)),v=s(n(70696)),p=s(n(23992)),h=s(n(50524)),g=s(n(25288)),y=s(n(96631)),_=s(n(26048)),b=s(n(78912)),E=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=N(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},l=c&&o;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=l?o(e,u):null;i&&(i.get||i.set)?c(r,u,i):r[u]=e[u]}return r.default=e,n&&n.set(e,r),r}(n(65984)),C=n(63548),I=n(82416),w=s(n(44164)),k=n(57264);function N(e){if("function"!=typeof f)return null;var t=new f,n=new f;return(N=function(e){return e?n:t})(e)}function F(e,t){var n=r(e);if(l){var a=l(e);t&&(a=u(a).call(a,(function(t){return o(e,t).enumerable}))),n.push.apply(n,a)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){(0,y.default)(e,t,n[t])})):i?d(e,i(n)):F(Object(n)).forEach((function(t){c(e,t,o(n,t))}))}return e}t.TreeNodeTitle=function(e){var t=e.isGroupNode,n=e.title,a=e.formId,r=e.appId,l=e.nodeKey,u=e.parentId,o=e.seq,i=e.image,d=e.hideDrag,c=e.onDelete,f=e.onEditName,s=e.onAddChildGroup,y=e.onCopy,N=e.canAddChildGroup,F=e.onSave,S=e.handleEditing,O=e.type,A=(0,E.useState)(!1),M=(0,b.default)(A,2),L=M[0],j=M[1],D=(0,E.useState)(!1),T=(0,b.default)(D,2),R=T[0],B=T[1],P=(0,E.useState)(n),q=(0,b.default)(P,2),V=q[0],z=q[1],W=(0,E.useState)(n),G=(0,b.default)(W,2),U=G[0],H=G[1],K=(0,E.useRef)(),Q=(0,E.useRef)(),X=(0,E.useCallback)((function(e){var t,n;return(0,m.default)(t=(0,m.default)(n="".concat(r||"","|")).call(n,a||"","|")).call(t,e)}),[r,a]);(0,E.useEffect)((function(){var e;R&&(null===(e=Q.current)||void 0===e||e.focus()),null==S||S(R)}),[R]),(0,E.useEffect)((function(){z(n),H(n)}),[n]),(0,E.useEffect)((function(){z(n)}),[n]);var J,Y,Z=[{name:"修改名称",key:"editName",hidden:!f},{name:"复制",key:"copy",hidden:!y,useActionName:{"data-nc-action":X("sa_fm_copy")}},{name:"删除",key:"delete",hidden:!c}],$=[{name:"修改名称",key:"editName"},{name:"新建子分组",key:"addChildGroup",useActionName:{"data-nc-action":X("sa_fm_csg")}},{name:"删除",key:"delete"}],ee=[{name:"修改名称",key:"editName"},{name:"删除",key:"delete"}],te={id:l,formId:a,name:V,parentId:u,seq:o,image:i,type:O},ne=function(e){for(;e;){if((0,h.default)(Array.prototype).apply(e.classList,["kd-tree-node-item"]))return e;e=e.parentElement}},ae=function(e,t){var n,r=(null==e||null===(n=e.target)||void 0===n?void 0:n.value)||t;if(r&&r!==U){var u=(0,k.showLoadingMessage)("正在修改名称，请稍候...");null==F||F(x(x({},te),{},{name:r})).then((function(e){B(!1),H(r),f&&f(a,l,r),u({type:"success",content:"修改名称成功"})})).catch((function(e){u({type:"error",content:null==e?void 0:e.message})}))}else B(!1)};return E.default.createElement("span",{className:w.default.title,ref:K,"data-tree-node-key":l},R?E.default.createElement(I.Text,{ref:Q,value:V,onChange:function(e){z((0,g.default)(e).call(e))},onBlur:ae,onPressEnter:function(e,t){ae(t,e)},maxLength:50,size:"small",allowClear:!0}):E.default.createElement(E.default.Fragment,null,E.default.createElement("span",{className:w.default["title-name"],title:n},n),E.default.createElement("span",{className:w.default["title-icon"],"data-menu-btn":"true"},E.default.createElement("span",{className:w.default["title-more"],onClick:function(e){e.stopPropagation()}},E.default.createElement(C.Dropdown,{menu:(Y=t?N?$:ee:Z,E.default.createElement(C.Dropdown.Menu,null,null===(J=(0,v.default)(Y).call(Y,(function(e){return!e.hidden})))||void 0===J?void 0:(0,p.default)(J).call(J,(function(e){return E.default.createElement(C.Dropdown.Item,(0,_.default)({key:e.key},null==e?void 0:e.useActionName),E.default.createElement("span",null,e.name))})))),popperClassName:w.default.popper,visible:L,onItemClick:function(e){j(!1);var t=ne(K.current);switch(null==t||t.setAttribute("data-node-visible",!1),e){case"editName":B(!0);break;case"delete":c&&c(l,a);break;case"addChildGroup":s&&s(l);break;case"copy":y&&y(te)}},onVisibleChange:function(e){if(j(e),K.current){var t=ne(K.current);null==t||t.setAttribute("data-node-visible",e),e?null==t||t.classList.add(w.default["tree-node-item-hover"]):null==t||t.classList.remove(w.default["tree-node-item-hover"])}},trigger:"hover"},E.default.createElement(I.BtnField,{type:"text"},E.default.createElement(C.Icon,{prefix:"nocodeplatformicon",type:"gengduo3"})))),!d&&E.default.createElement(I.BtnField,{type:"text",className:w.default["title-drag"]},E.default.createElement(C.Icon,{prefix:"nocodeplatformicon",type:"tuozhuai"})))))}},78932:function(e,t,n){var a=n(13568),r=n(13939),l=n(34716),u=n(70696),o=n(4884),i=n(3464),d=n(51400),c=n(25028),f=n(93252),s=n(9564);c(t,"__esModule",{value:!0}),t.default=void 0;var m=s(n(96631)),v=s(n(78912)),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=w(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},l=c&&o;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=l?o(e,u):null;i&&(i.get||i.set)?c(r,u,i):r[u]=e[u]}return r.default=e,n&&n.set(e,r),r}(n(65984)),h=s(n(64236)),g=n(16756),y=n(95936),_=n(97400),b=n(57264),E=n(60644),C=n(41532),I=s(n(68592));function w(e){if("function"!=typeof f)return null;var t=new f,n=new f;return(w=function(e){return e?n:t})(e)}function k(e,t){var n=r(e);if(l){var a=l(e);t&&(a=u(a).call(a,(function(t){return o(e,t).enumerable}))),n.push.apply(n,a)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,m.default)(e,t,n[t])})):i?d(e,i(n)):k(Object(n)).forEach((function(t){c(e,t,o(n,t))}))}return e}var F=(0,p.memo)((function(e){var t,n=e.pageId,a=e.appId,r=e.readonly,l=(0,p.useReducer)(g.reducer,g.initState),u=(0,v.default)(l,2),o=u[0],i=void 0===o?{}:o,d=u[1],c=(0,p.useState)(!1),f=(0,v.default)(c,2),s=f[0],m=f[1],w=(0,p.useRef)(),k=(0,p.useContext)(y.Context).state||{},F=k.userInfo,x=k.appsList,S=null==F?void 0:F.id,O=(x[a]||{}).istemplate,A=(0,p.useCallback)((function(e){var t=e.type,n=e.payload;d({type:t,payload:N({userId:S},n)})}),[S]),M=(0,p.useCallback)((function(e){var t=e||(null==i?void 0:i.viewId);s&&m(!1);var n={};(0,C.getCardBySchmeId)({pageId:t}).then((function(e){var a,r=(null==e||null===(a=e.rows)||void 0===a?void 0:a[0])||{};m(!0);var l={cardInfo:null==n?void 0:n.cardInfo,layout:null==n?void 0:n.layout};(0,E.isEqual)(l,r)||A({type:g.UPDATE_CARDINFO,payload:N({viewId:t},r)})})).catch((function(e){(0,b.showNotice)("error",e.message)}))}),[s,i.viewId,A,S]);(0,p.useEffect)((function(){M(n)}),[n]);var L=(0,p.useCallback)((function(){return i.layout}),[i.layout]),j=(0,p.useCallback)((function(){return i.cardInfo}),[i.cardInfo]),D=(0,p.useCallback)((function(e,t){A({type:g.ADD_CARD,payload:{newCardInfo:e,newCardLayout:t}})}),[null==i?void 0:i.cardInfo]);return p.default.createElement(_.HomeCardContext.Provider,{value:{schemaId:n,getHomeCardInfo:j,getHomeCardLayout:L,onRefreshHomeCard:M,handleAddCard:D}},p.default.createElement("div",{className:I.default.custom,ref:w},p.default.createElement(h.default,{wrapperRef:w,pageId:n,layoutWidth:null===(t=w.current)||void 0===t?void 0:t.offsetWidth,init:s,state:i,readonly:r,istemplate:O,className:I.default.custom_main,dispatch:A})))}));F.displayName="CustomPage";t.default=F},48864:function(e,t,n){var a=n(13568),r=n(93252),l=n(25028),u=n(4884),o=n(9564);l(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n(760)),d=o(n(23992)),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=y(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},o=l&&u;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var d=o?u(e,i):null;d&&(d.get||d.set)?l(r,i,d):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}(n(65984)),f=o(n(732)),s=n(41936),m=n(63548),v=n(39392),p=o(n(94958)),h=n(95936),g=n(57264);function y(e){if("function"!=typeof r)return null;var t=new r,n=new r;return(y=function(e){return e?n:t})(e)}var _=(0,c.lazy)((function(){return n.e(0).then(n.t.bind(n,51e3,23))})),b="businessManage";t.default=function(e){var t=e.onItemClick,n=e.openNewPage,a=void 0===n||n,r=(0,v.useTranslation)().t,l=(0,f.default)(),u=(0,s.useParams)(),o=u.appId,y=u.targetFormId,E=(0,c.useContext)(h.Context).dispatch,C=(0,c.useCallback)((function(e){var t,n;return(0,i.default)(t=(0,i.default)(n="".concat(o||"","|")).call(n,y||"","|")).call(t,e)}),[o,y]),I=[{path:"/home",title:r("designer.key0004"),icon:"qiyeguanli",useActionName:"tb_h_bn"},{path:"/app",title:r("designer.key0005"),icon:"quanbuyingyong",key:"allApp",useActionName:"tb_as_bn"},{path:"/template",title:r("designer.key0006"),icon:"moban2",useActionName:"tb_ts_bn"},{path:"/flow",title:r("designer.key0008"),icon:"liucheng-xian",useActionName:"tb_fs_bn"},{type:"divider"},{title:r("designer.key0007"),icon:"jichushezhi",key:b,useActionName:"tb_em_bn"}],w=c.default.createElement(m.Dropdown.Menu,{className:p.default.header_nav_menu},(0,d.default)(I).call(I,(function(e,t){var n=e.title,a=(e.path,e.icon),r=e.type,l=e.useActionName;return"divider"===r?c.default.createElement("li",{key:t,className:p.default.header_nav_menu_item_divider}):c.default.createElement(m.Dropdown.Item,{key:t,className:p.default.header_nav_menu_item,"data-nc-action":C(l)},c.default.createElement(c.default.Fragment,null,c.default.createElement(m.Icon,{prefix:"nocodeplatformicon",type:a}),n))})));return c.default.createElement(c.default.Fragment,null,c.default.createElement(m.Dropdown,{placement:"topLeft",menu:w,onItemClick:function(e){if("function"==typeof t&&t(e))return;var n=I[e];if(n){var r=n.path;if(r)a?(0,g.openner)(r):l(r);else if(n.key===b){var u=(0,g.autoModalHeight)(520,768);m.Modal.confirm({title:"企业管理",showline:!0,titleIcon:null,footer:null,width:960,height:u,type:"normal",bodyStyle:{padding:0,display:"flex",overflow:"hidden",flexBasis:0},body:c.default.createElement(c.Suspense,{fallback:c.default.createElement(c.default.Fragment,null)}," ",c.default.createElement(_,{dispatch:E})," "),closable:!0,maskClosable:!1})}}}},c.default.createElement("div",{className:p.default.header_nav},c.default.createElement("div",{className:p.default.header_nav_container},c.default.createElement(m.Icon,{prefix:"nocodeplatformicon",type:"9gedian"})))))}}}]);