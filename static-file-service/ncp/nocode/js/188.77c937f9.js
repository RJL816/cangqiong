"use strict";(self.webpackChunknocode_platform=self.webpackChunknocode_platform||[]).push([[188],{50964:function(e,t,n){n.r(t),t.default={modal:"f8WfEosd_modal",modal_footer:"JiAfxMHU_modal_footer",modal_footer_action_btn:"FwTepbwW_modal_footer_action_btn"}},69944:function(e,t,n){n.r(t),t.default={"org-authorize":"J6bVHvb3_org-authorize",tag:"dw3GBV+b_tag","tag-name":"_4XEKNogc_tag-name","is-disabled":"qdcI8wtn_is-disabled"}},48972:function(e,t,n){n.r(t),t.default={orgselectmodal:"ZL3WO-hk_orgselectmodal",orgselectmodal_content:"hBbKWn6U_orgselectmodal_content",orgselectmodal_content_table:"NVMLjB9o_orgselectmodal_content_table",orgselectmodal_content_table_search:"XGAGmE64_orgselectmodal_content_table_search",orgselectmodal_content_table_pagination:"TjSbOL7x_orgselectmodal_content_table_pagination",orgselectmodal_content_main:"OGGVcqsd_orgselectmodal_content_main",selected:"Ax+b5arS_selected",selected_nav:"_12TRQ0zb_selected_nav",nav_title:"vw2bD5An_nav_title",selected_list:"o3Qx9NXw_selected_list",selected_item:"_32kPu4lj_selected_item",item_info:"KxyxG+r1_item_info",item_title:"Y0cv0Jaw_item_title",item_btn:"_04hGZK2L_item_btn",orgselectmodal_content_org:"I4Az9g3B_orgselectmodal_content_org"}},90852:function(e,t,n){n.r(t),t.default={"person-authorize":"FyP8co7a_person-authorize",tag:"yL0YFjlX_tag","tag-name":"TYyu6fu9_tag-name","is-disabled":"_0iSTplxR_is-disabled"}},61600:function(e,t,n){n.r(t),t.default={personselectmodal:"HGlNqBFr_personselectmodal",personselectmodal_content:"sXPPz0hX_personselectmodal_content",personselectmodal_content_split:"_3He0YspH_personselectmodal_content_split",personselectmodal_content_table:"OyjZeCml_personselectmodal_content_table",personselectmodal_content_table_search:"e1gRkhuA_personselectmodal_content_table_search",personselectmodal_content_table_body:"uAO89pXS_personselectmodal_content_table_body",personselectmodal_content_table_pagination:"haH5RFyp_personselectmodal_content_table_pagination",personselectmodal_content_main:"c0FDJMk2_personselectmodal_content_main",selected:"X9lpCJN+_selected",selected_nav:"jdbdcZJY_selected_nav",nav_title:"_8laBEki1_nav_title",selected_list:"B8WNd4lN_selected_list",selected_item:"gZ7hi2SU_selected_item",item_info:"XoNo+42c_item_info",item_title:"_0OqyiCj8_item_title",item_btn:"_1VMDY+-I_item_btn",personselectmodal_content_org:"-bqlqx0H_personselectmodal_content_org"}},63176:function(e,t,n){var a=n(13939),l=n(34716),r=n(70696),u=n(4884),o=n(3464),c=n(51400),i=n(25028),d=n(9564);i(t,"__esModule",{value:!0}),t.default=void 0;var f=d(n(29052)),s=d(n(96631)),m=d(n(94924)),p=d(n(78912)),v=n(65984),_=(d(n(60584)),n(98464)),h=n(41936),b=n(90568);function g(e,t){var n=a(e);if(l){var o=l(e);t&&(o=r(o).call(o,(function(t){return u(e,t).enumerable}))),n.push.apply(n,o)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):o?c(e,o(n)):g(Object(n)).forEach((function(t){i(e,t,u(n,t))}))}return e}t.default=function(e){var t=e||{},n=t.appId,a=t.defaultQueryParams,l=t.queryCallback,r=(a||{}).pageSize,u=void 0===r?20:r,o=(0,h.useParams)().appId,c=n||o,i=(0,v.useState)(),d=(0,p.default)(i,2),s=d[0],g=d[1],w=function(){var e=(0,m.default)(f.default.mark((function e(t,n){var a,r;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=y({env:"1",page_size:(null==n?void 0:n.page_size)||u||20,page_no:(null==n?void 0:n.page_no)||1},n),g(a),e.next=4,(0,_.loadFormDataList)(c,t,a);case 4:r=e.sent,null==l||l(),(0,b.publishEvent)("setQuery",{args:{formId:t,param:a},data:r});case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),E=function(){var e=(0,m.default)(f.default.mark((function e(t){var n;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,_.queryEntryData)(null==t?void 0:t.appId,null==t?void 0:t.formId,null==t?void 0:t.pkId,{page_size:(null==t?void 0:t.page_size)||10,page_no:(null==t?void 0:t.page_no)||1,entry:null==t?void 0:t.entry});case 3:n=e.sent,null==t||t.callback(n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=(0,m.default)(f.default.mark((function e(t,n){var a;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_.getFormDataListSetting)(c,t,n.env,{selects:n.displayProp});case 2:a=e.sent,(0,b.publishEvent)("setListConfig",{args:{formId:t},data:a});case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return{batchInvokeQuery:w,addControlAction:b.addEventListener,baseUrl:window.__nocode_file_host__,batchInvoke:function(){},batchInvokeTable:E,batchInvokeListConfig:k,getControlText:function(e){return(null==e?void 0:e.zh_CN)||""},queryParams:s}}},29588:function(e,t,n){var a=n(25028),l=n(9564);a(t,"__esModule",{value:!0}),t.useWindowSize=function(){var e=(0,u.useState)((function(){var e=window;return{width:e.innerWidth,height:e.innerHeight}})),t=(0,r.default)(e,2),n=t[0],a=t[1],l=function(e){var t=e.width,n=e.height;a({width:t,height:n})};return(0,u.useEffect)((function(){var e=(0,o.addResizeObserve)(document.body,l);return function(){e&&e.removeResizeObserve()}}),[]),n};var r=l(n(78912)),u=n(65984),o=n(57264)},36060:function(e,t,n){var a=n(13568),l=n(93252),r=n(25028),u=n(4884),o=n(9564);r(t,"__esModule",{value:!0}),t.default=void 0;var c=o(n(26048)),i=o(n(35256)),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var l={__proto__:null},o=r&&u;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var i=o?u(e,c):null;i&&(i.get||i.set)?r(l,c,i):l[c]=e[c]}return l.default=e,n&&n.set(e,l),l}(n(65984)),f=n(82416),s=o(n(63176)),m=["appId"];function p(e){if("function"!=typeof l)return null;var t=new l,n=new l;return(p=function(e){return e?n:t})(e)}var v=(0,d.memo)((function(e){var t=e.appId,n=(0,i.default)(e,m),a=(0,s.default)({appId:t});return d.default.createElement(f.ListFilterSettingDropdown,(0,c.default)({refBillProps:a},n))}));v.displayName="ListFilterSetting";t.default=v},86360:function(e,t,n){var a=n(13568),l=n(93252),r=n(25028),u=n(4884),o=n(9564);r(t,"__esModule",{value:!0}),t.default=void 0;var c=o(n(26048)),i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var l={__proto__:null},o=r&&u;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var i=o?u(e,c):null;i&&(i.get||i.set)?r(l,c,i):l[c]=e[c]}return l.default=e,n&&n.set(e,l),l}(n(65984)),d=n(82416),f=n(63548),s=o(n(71252)),m=o(n(50964));function p(e){if("function"!=typeof l)return null;var t=new l,n=new l;return(p=function(e){return e?n:t})(e)}var v=(0,i.memo)((function(e){var t=e.cancelText,n=e.okText,a=e.onOk,l=e.onCancel,r=e.cancelButtonProps,u=e.okButtonProps;return i.default.createElement("div",{className:m.default.modal_footer},i.default.createElement("div",{className:m.default.modal_footer_action},i.default.createElement(d.BtnField,(0,c.default)({onClick:l,size:"small",className:m.default.modal_footer_action_btn},r),t||"取消"),i.default.createElement(d.BtnField,(0,c.default)({onClick:a,size:"small",type:"primary",className:m.default.modal_footer_action_btn},u),n||"确定")))}));v.displayName="ModalFooter";var _=(0,i.memo)((function(e){var t=e.cancelText,n=e.okText,a=e.onOk,l=e.onCancel,r=e.cancelButtonProps,u=e.okButtonProps;return i.default.createElement(f.Modal,(0,c.default)({showline:!1,footer:i.default.createElement(v,{cancelText:t,okText:n,onOk:a,onCancel:l,cancelButtonProps:r,okButtonProps:u})},e,{className:(0,s.default)(m.default.modal,e.className)}))}));_.displayName="CustomModal";t.default=_},68692:function(e,t,n){var a=n(13568),l=n(93252),r=n(25028),u=n(4884),o=n(9564);r(t,"__esModule",{value:!0}),t.default=void 0;var c=o(n(26048)),i=o(n(78912)),d=o(n(35256)),f=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var l={__proto__:null},o=r&&u;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var i=o?u(e,c):null;i&&(i.get||i.set)?r(l,c,i):l[c]=e[c]}return l.default=e,n&&n.set(e,l),l}(n(65984)),s=n(82416),m=["onChange","value"];function p(e){if("function"!=typeof l)return null;var t=new l,n=new l;return(p=function(e){return e?n:t})(e)}t.default=function(e){var t=e.onChange,n=e.value,a=(0,d.default)(e,m),l=(0,f.useState)(n||""),r=(0,i.default)(l,2),u=r[0],o=r[1],p=(0,f.useRef)(!1),v=(0,f.useRef)(/firefox/i.test(window.navigator.userAgent));(0,f.useEffect)((function(){o(n)}),[n]);var _=(0,f.useCallback)((function(e){o(e),!p.current&&t&&t(e)}),[t]),h=(0,f.useCallback)((function(){p.current=!0}),[]),b=(0,f.useCallback)((function(e){p.current=!1,!v.current&&t&&t(u)}),[u,t]);return f.default.createElement("div",{className:"kd-nc-search-input"},f.default.createElement(s.Text,(0,c.default)({value:u,onCompositionStart:h,onCompositionEnd:b,onChange:_},a)))}},72492:function(e,t,n){var a=n(13568),l=n(93252),r=n(25028),u=n(4884),o=n(9564);r(t,"__esModule",{value:!0}),t.default=void 0;var c=o(n(50524)),i=o(n(70696)),d=o(n(23992)),f=o(n(96631)),s=o(n(78912)),m=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=g(t);if(n&&n.has(e))return n.get(e);var l={__proto__:null},o=r&&u;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var i=o?u(e,c):null;i&&(i.get||i.set)?r(l,c,i):l[c]=e[c]}return l.default=e,n&&n.set(e,l),l}(n(65984)),p=n(63548),v=n(60644),_=o(n(8236)),h=o(n(71252)),b=o(n(69944));function g(e){if("function"!=typeof l)return null;var t=new l,n=new l;return(g=function(e){return e?n:t})(e)}t.default=function(e){var t=e.value,n=e.onChange,a=e.disabledIds,l=void 0===a?[]:a,r=e.withScope,u=(0,m.useState)(t||[]),o=(0,s.default)(u,2),g=o[0],y=o[1],w=(0,m.useState)(!1),E=(0,s.default)(w,2),k=E[0],C=E[1],S=(0,m.useCallback)((function(){C(!0)}),[]),N=(0,m.useCallback)((function(){C(!1)}),[]);return(0,m.useEffect)((function(){(0,v.isEqual)(t,g)||y(t||[])}),[t]),m.default.createElement(m.default.Fragment,null,m.default.createElement("div",{className:b.default["org-authorize"]},(0,d.default)(g).call(g,(function(e){var t=e.id,a=e.name;return m.default.createElement("span",{className:(0,h.default)(b.default.tag,(0,f.default)({},b.default["is-disabled"],null==l?void 0:(0,c.default)(l).call(l,t))),key:t},m.default.createElement("span",{className:b.default["tag-name"]},a),m.default.createElement(p.Icon,{prefix:"nocodeplatformicon",type:"guanbi",onClick:function(){return function(e){if(!(0,c.default)(l).call(l,e)){var t=(0,i.default)(g).call(g,(function(t){return t.id!==e}));y(t),null==n||n(t)}}(t)}}))})),m.default.createElement(p.Button,{size:"small",type:"ghost",icon:m.default.createElement(p.Icon,{prefix:"nocodeplatformicon",type:"zengjia-yuan"}),onClick:S},"新增")),k&&m.default.createElement(_.default,{selectedList:g,visible:k,onConfirm:function(e){y(e),null==n||n(e),N()},onClose:N,withScope:r}))}},8236:function(e,t,n){var a=n(13568),l=n(13939),r=n(34716),u=n(70696),o=n(4884),c=n(3464),i=n(51400),d=n(25028),f=n(73980),s=n(13440),m=n(59992),p=n(60600),v=n(93252),_=n(9564);d(t,"__esModule",{value:!0}),t.default=void 0;var h=_(n(29052)),b=_(n(94924)),g=_(n(99148)),y=_(n(78912)),w=_(n(96631)),E=_(n(59992)),k=_(n(23992)),C=_(n(38456)),S=_(n(70696)),N=_(n(50524)),x=_(n(760)),O=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=A(t);if(n&&n.has(e))return n.get(e);var l={__proto__:null},r=d&&o;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var c=r?o(e,u):null;c&&(c.get||c.set)?d(l,u,c):l[u]=e[u]}return l.default=e,n&&n.set(e,l),l}(n(65984)),L=_(n(86360)),I=n(63548),M=n(25096),j=n(82416),z=_(n(68692)),P=n(57264),T=_(n(48972)),B=_(n(75020));function A(e){if("function"!=typeof v)return null;var t=new v,n=new v;return(A=function(e){return e?n:t})(e)}function F(e,t){var n=void 0!==m&&p(e)||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return R(e,t);var a=f(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return s(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return R(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,l=function(){};return{s:l,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,u=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){o=!0,r=e},f:function(){try{u||null==n.return||n.return()}finally{if(o)throw r}}}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function D(e,t){var n=l(e);if(r){var a=r(e);t&&(a=u(a).call(a,(function(t){return o(e,t).enumerable}))),n.push.apply(n,a)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):c?i(e,c(n)):D(Object(n)).forEach((function(t){d(e,t,o(n,t))}))}return e}var q="orgselectmodal",W=(0,E.default)("更新当前选中的组织列表"),X={selectedList:[]},H=function(e,t){var n=t.type,a=t.payload;if(n===W)return G(G({},e),{},{selectedList:a.selectedList});throw new Error},J=(0,O.memo)((function(e){var t=e.state,n=e.dispatch,a=e.disabledIds,l=void 0===a?[]:a,r=e.withScope,u=t.selectedList,o=(0,O.useState)({page_size:10,page_no:1}),c=(0,y.default)(o,2),i=c[0],d=c[1],f=(0,O.useState)([]),s=(0,y.default)(f,2),m=s[0],p=s[1],v=(0,O.useState)(0),_=(0,y.default)(v,2),w=_[0],E=_[1],L=(0,O.useState)(""),A=(0,y.default)(L,2),R=A[0],D=A[1],X=(0,O.useMemo)((function(){return(0,k.default)(u).call(u,(function(e){return e.id}))}),[u]),H=function(e,t,a,r){var o=(0,C.default)(m).call(m,(function(e){return e.id===t}));switch(r){case"check-all":var c,i=(0,g.default)(u),d=F(m);try{var f=function(){var e=c.value,t=e.id,n=e.name,a=e.number;(0,C.default)(i).call(i,(function(e){return e.id===t}))||i.push({id:t,name:n,number:a})};for(d.s();!(c=d.n()).done;)f()}catch(e){d.e(e)}finally{d.f()}n({type:W,payload:{selectedList:i}});break;case"uncheck-all":var s=(null==m?void 0:(0,k.default)(m).call(m,(function(e){return e.id})))||[];s=(0,S.default)(s).call(s,(function(e){return!(null!=l&&(0,N.default)(l).call(l,e))})),n({type:W,payload:{selectedList:(0,S.default)(u).call(u,(function(e){return!(0,N.default)(s).call(s,e.id)}))}});break;case"check":if(!o)return;n({type:W,payload:{selectedList:(0,x.default)(u).call(u,{id:o.id,name:o.name,number:o.number})}});break;case"uncheck":if(null!=l&&(0,N.default)(l).call(l,o.id))return;var p=(0,S.default)(u).call(u,(function(e){return e.id!==o.id}));n({type:W,payload:{selectedList:p}})}},J=(0,O.useMemo)((function(){return[{code:"name",name:"组织名称",width:400},{code:"number",name:"组织编号",width:200}]}),[]),K=(0,O.useCallback)((0,b.default)(h.default.mark((function e(){var t,n,a,l,u,o,c,d;return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=G(G({},i),{},{select:"id,name,number",search:R,withScope:r}),e.prev=1,e.next=4,(0,M.getFlattenOrg)(t);case 4:n=e.sent,a=n.rows,l=void 0===a?[]:a,u=n.totalCount,o=void 0===u?0:u,c=(0,k.default)(l).call(l,(function(e){var t=e.parent;return G(G({},e),{},{parentName:t})})),p(c),E(o),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(1),d=e.t0.message,(0,P.showNotice)("error",d);case 19:case"end":return e.stop()}}),e,null,[[1,14]])}))),[i,R,r]),Q=(0,B.default)(K,500),U=function(e,t){d({page_size:t,page_no:e}),Q()};(0,O.useEffect)((function(){K()}),[]);var Y=function(e,t){if(null==l||!(0,N.default)(l).call(l,e.id)){var a=(0,S.default)(u).call(u,(function(t){return t.id!==e.id}));n({type:W,payload:{selectedList:a}})}},V=(0,O.useCallback)((function(){return null==u?void 0:(0,k.default)(u).call(u,(function(e,t){return O.default.createElement("div",{key:e.value,className:T.default.selected_item},O.default.createElement("div",{className:T.default.item_info},O.default.createElement("div",{className:T.default.item_title},e.name||"-"),O.default.createElement("div",null,e.number||"-")),O.default.createElement(j.BtnField,{type:"text",className:T.default.item_btn,onClick:function(){null==Y||Y(e)}},O.default.createElement(I.Icon,{type:"delete"})))}))}),[u]);return O.default.createElement("div",{className:T.default["".concat(q,"_content_main")]},O.default.createElement("div",{className:T.default["".concat(q,"_content_table")]},O.default.createElement("div",{className:T.default["".concat(q,"_content_table_header")]},O.default.createElement("div",{className:T.default["".concat(q,"_content_table_search")]},O.default.createElement(z.default,{placeholder:"搜索",borderType:"bordered",prefix:O.default.createElement(I.Icon,{prefix:"nocodeplatformicon",type:"sousuo"}),size:"small",onChange:function(e){D(e),d(G(G({},i),{},{page_no:1})),Q()},allowClear:!0}))),O.default.createElement("div",null,O.default.createElement(j.DataGrid,{style:{height:"308px"},columns:J,showSelected:!0,dataSource:m,onRowSelectChange:H,onPageChange:U,rowSelection:{type:"checkbox",value:X||[],highlightRowWhenSelected:!0,column:{lock:!0},onChange:H,clickArea:"row"},primaryKey:"id"})),O.default.createElement("div",{className:T.default["".concat(q,"_content_table_pagination")]},O.default.createElement(I.Pagination,{pageType:"nicety",current:i.page_no,showQuickJumper:!1,pageSize:i.page_size,onChange:U,total:w||0,dropdownProps:{getPopupContainer:function(){return document.body}},showSizeChanger:!0}))),O.default.createElement("div",{className:T.default.selected},O.default.createElement("div",{className:T.default.selected_nav},O.default.createElement("div",{className:T.default.nav_title},"已选(",null==u?void 0:u.length,")"),O.default.createElement("div",null,O.default.createElement(j.BtnField,{onClick:function(){var e=(0,S.default)(u).call(u,(function(e){return null==l?void 0:(0,N.default)(l).call(l,e.id)}));n({type:W,payload:{selectedList:e}})},type:"text",major:!0},"清空"))),O.default.createElement("div",{className:T.default.selected_list},V())))}));J.displayName="PersonDataGrid";var K=(0,O.memo)((function(e){var t=e.visible,n=e.disabledIds,a=void 0===n?[]:n,l=e.selectedList,r=e.onClose,u=e.onConfirm,o=e.withScope,c=(0,O.useReducer)(H,X),i=(0,y.default)(c,2),d=i[0],f=i[1];(0,O.useEffect)((function(){f({type:W,payload:{selectedList:l}})}),[l]);var s=(0,O.useMemo)((function(){return O.default.createElement("div",{className:T.default["".concat(q,"_content")]},O.default.createElement(J,{state:d,dispatch:f,disabledIds:a,withScope:o}))}),[d,f,l,a]),m=(0,O.useCallback)((function(){u(d.selectedList)}),[d.selectedList,u]);return O.default.createElement(L.default,{title:"请选择",width:1180,height:524,visible:t,keyboard:!1,maskClosable:!1,closable:!0,body:s,className:T.default[q],onCancel:r,onOk:m})}));K.displayName="OrgSelectModal";t.default=K},85744:function(e,t,n){var a=n(13568),l=n(93252),r=n(25028),u=n(4884),o=n(9564);r(t,"__esModule",{value:!0}),t.default=void 0;var c=o(n(50524)),i=o(n(70696)),d=o(n(23992)),f=o(n(96631)),s=o(n(78912)),m=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=g(t);if(n&&n.has(e))return n.get(e);var l={__proto__:null},o=r&&u;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var i=o?u(e,c):null;i&&(i.get||i.set)?r(l,c,i):l[c]=e[c]}return l.default=e,n&&n.set(e,l),l}(n(65984)),p=n(63548),v=o(n(96696)),_=o(n(90852)),h=o(n(71252)),b=n(60644);function g(e){if("function"!=typeof l)return null;var t=new l,n=new l;return(g=function(e){return e?n:t})(e)}t.default=function(e){var t=e.value,n=e.onChange,a=e.disabledIds,l=void 0===a?[]:a,r=e.isMulti,u=void 0===r||r,o=e.buttonOption,g=e.withScope,y=(0,m.useState)(t||[]),w=(0,s.default)(y,2),E=w[0],k=w[1],C=(0,m.useState)(!1),S=(0,s.default)(C,2),N=S[0],x=S[1],O=(0,m.useCallback)((function(){x(!0)}),[]),L=(0,m.useCallback)((function(){x(!1)}),[]);return(0,m.useEffect)((function(){(0,b.isEqual)(t,E)||k(t)}),[t]),m.default.createElement(m.default.Fragment,null,m.default.createElement("div",{className:_.default["person-authorize"]},(0,d.default)(E).call(E,(function(e){var t=e.id,a=e.name;return m.default.createElement("span",{className:(0,h.default)(_.default.tag,(0,f.default)({},_.default["is-disabled"],null==l?void 0:(0,c.default)(l).call(l,t))),key:t},m.default.createElement("span",{className:_.default["tag-name"]},a),u&&m.default.createElement(p.Icon,{prefix:"nocodeplatformicon",type:"guanbi",onClick:function(){return function(e){if(!(0,c.default)(l).call(l,e)){var t=(0,i.default)(E).call(E,(function(t){return t.id!==e}));k(t),null==n||n(t)}}(t)}}))})),!(null!=o&&o.hide)&&m.default.createElement(p.Button,{size:"small",type:"ghost",icon:m.default.createElement(p.Icon,{prefix:"nocodeplatformicon",type:(null==o?void 0:o.icon)||"zengjia-yuan"}),onClick:O},(null==o?void 0:o.text)||"新增")),N&&m.default.createElement(v.default,{disabledIds:l,selectedList:E,visible:N,isMulti:u,onConfirm:function(e){k(e),null==n||n(e),L()},onClose:L,withScope:g}))}},96696:function(e,t,n){var a=n(13568),l=n(13939),r=n(34716),u=n(70696),o=n(4884),c=n(3464),i=n(51400),d=n(25028),f=n(73980),s=n(13440),m=n(59992),p=n(60600),v=n(93252),_=n(9564);d(t,"__esModule",{value:!0}),t.default=void 0;var h=_(n(29052)),b=_(n(94924)),g=_(n(99148)),y=_(n(78912)),w=_(n(96631)),E=_(n(59992)),k=_(n(23992)),C=_(n(38456)),S=_(n(70696)),N=_(n(50524)),x=_(n(760)),O=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=R(t);if(n&&n.has(e))return n.get(e);var l={__proto__:null},r=d&&o;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var c=r?o(e,u):null;c&&(c.get||c.set)?d(l,u,c):l[u]=e[u]}return l.default=e,n&&n.set(e,l),l}(n(65984)),L=_(n(86360)),I=n(63548),M=n(25096),j=n(57264),z=n(82416),P=_(n(68692)),T=n(57264),B=n(29588),A=_(n(61600)),F=_(n(75020));function R(e){if("function"!=typeof v)return null;var t=new v,n=new v;return(R=function(e){return e?n:t})(e)}function D(e,t){var n=void 0!==m&&p(e)||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return G(e,t);var a=f(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return s(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return G(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,l=function(){};return{s:l,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,u=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){o=!0,r=e},f:function(){try{u||null==n.return||n.return()}finally{if(o)throw r}}}}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function q(e,t){var n=l(e);if(r){var a=r(e);t&&(a=u(a).call(a,(function(t){return o(e,t).enumerable}))),n.push.apply(n,a)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):c?i(e,c(n)):q(Object(n)).forEach((function(t){d(e,t,o(n,t))}))}return e}var X="personselectmodal",H=(0,E.default)("更新当前选中的组织"),J=(0,E.default)("更新当前选中的人员列表"),K={currentOrg:null,selectedList:[]},Q=function(e,t){var n=t.type,a=t.payload;switch(n){case H:return W(W({},e),{},{currentOrg:a.currentOrg});case J:return W(W({},e),{},{selectedList:a.selectedList});default:throw new Error}},U=(0,O.memo)((function(e){var t=e.dispatch,n=e.defaultExpandRoot,a=e.withScope,l=(0,O.useState)([]),r=(0,y.default)(l,2),u=r[0],o=r[1],c=(0,O.useState)([]),i=(0,y.default)(c,2),d=i[0],f=i[1],s=(0,O.useState)([]),m=(0,y.default)(s,2),p=m[0],v=m[1],_=(0,O.useCallback)((function(e,t,n){return e.some((function(e){return e.key===n?(e.children=t,!0):(_(e.children,t,n),!1)})),e}),[]),h=(0,O.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;(0,M.getCompanyOrg)({id:e,withScope:a},!1).then((function(e){var a=(0,j.formateTreeData)(e.rows,!1);if(""===t)o(a);else{var l=_(u,a,t);o((0,g.default)(l))}n&&n(a[0])}))}),[u,a]);(0,O.useEffect)((function(){h("","",(function(e){return t({type:H,payload:{currentOrg:e}})}))}),[]);var b=(0,O.useCallback)((function(e,t){f(e)}),[u]);return O.default.createElement("div",{className:A.default["".concat(X,"_content_org")]},O.default.createElement(I.Tree,{defaultExpandRoot:n,name:"Tree",treeData:u,expandedKeys:d,onExpand:b,selectedKeys:p,onSelect:function(e,n){t({type:H,payload:{currentOrg:n.node}}),v(e)},height:"100%",virtual:!0,selectable:!0}))}));U.displayName="OrgTree";var Y=(0,O.memo)((function(e){var t=e.state,n=e.dispatch,a=e.disabledIds,l=e.isMulti,r=void 0===l||l,u=e.withScope,o=t.currentOrg,c=t.selectedList,i=(0,O.useRef)({page_size:20,page_no:1}),d=(0,O.useState)({}),f=(0,y.default)(d,2),s=f[0],m=f[1],p=(0,O.useState)(""),v=(0,y.default)(p,2),_=v[0],w=v[1],E=(0,O.useMemo)((function(){return(0,k.default)(c).call(c,(function(e){return e.id}))}),[c]),L=function(e,t,l,u){var o,i=r?t:e[0],d=(0,C.default)(o=s.rows).call(o,(function(e){return e.id===i}));if(r)switch(u){case"check-all":var f,m=(0,g.default)(c),p=D(s.rows);try{var v=function(){var e=f.value,t=e.id,n=e.name,a=e.number;(0,C.default)(m).call(m,(function(e){return e.id===t}))||m.push({id:t,name:n,number:a})};for(p.s();!(f=p.n()).done;)v()}catch(e){p.e(e)}finally{p.f()}n({type:J,payload:{selectedList:m}});break;case"uncheck-all":var _,h=(null===(_=s.rows)||void 0===_?void 0:(0,k.default)(_).call(_,(function(e){return e.id})))||[];h=(0,S.default)(h).call(h,(function(e){return!(null!=a&&(0,N.default)(a).call(a,e))})),n({type:J,payload:{selectedList:(0,S.default)(c).call(c,(function(e){return!(0,N.default)(h).call(h,e.id)}))}});break;case"check":n({type:J,payload:{selectedList:(0,x.default)(c).call(c,{id:d.id,name:d.name,number:d.number})}});break;case"uncheck":if(null!=a&&(0,N.default)(a).call(a,d.id))return;var b=(0,S.default)(c).call(c,(function(e){return e.id!==d.id}));n({type:J,payload:{selectedList:b}})}else n({type:J,payload:{selectedList:[{id:d.id,name:d.name,number:d.number}]}})},j=(0,O.useMemo)((function(){return[{code:"number",name:"员工编号",width:178},{code:"name",name:"员工姓名",width:178},{code:"gender",name:"性别",width:178},{code:"phone",name:"手机号",width:178},{code:"email",name:"邮箱",width:178}]}),[]),B=(0,O.useCallback)((0,b.default)(h.default.mark((function e(){var t,n,a;return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=2;break}return e.abrupt("return");case 2:return t=W(W({},i.current),{},{deptId:null==o?void 0:o.id,search:_,withScope:u}),e.prev=3,e.next=6,(0,M.getOrgUsers)(t,!1);case 6:n=e.sent,m(n),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(3),a=e.t0.message,(0,T.showNotice)("error",a);case 15:case"end":return e.stop()}}),e,null,[[3,10]])}))),[o,_,u]),R=function(e,t){i.current={page_size:t,page_no:e},B()},G=(0,F.default)(B,500);(0,O.useEffect)((function(){B()}),[o]);var q=function(e,t){if(null==a||!(0,N.default)(a).call(a,e.id)){var l=(0,S.default)(c).call(c,(function(t){return t.id!==e.id}));n({type:J,payload:{selectedList:l}})}},H=(0,O.useCallback)((function(){return null==c?void 0:(0,k.default)(c).call(c,(function(e,t){return O.default.createElement("div",{key:e.value,className:A.default.selected_item},O.default.createElement("div",{className:A.default.item_info},O.default.createElement("div",{className:A.default.item_title},e.name||"-"),O.default.createElement("div",null,e.number||"-")),O.default.createElement(z.BtnField,{type:"text",className:A.default.item_btn,disabled:null==a?void 0:(0,N.default)(a).call(a,e.id),onClick:function(){null==q||q(e)}},O.default.createElement(I.Icon,{type:"delete"})))}))}),[c,a]);return O.default.createElement("div",{className:A.default["".concat(X,"_content_main")]},O.default.createElement("div",{className:A.default["".concat(X,"_content_table")]},O.default.createElement("div",{className:A.default["".concat(X,"_content_table_header")]},O.default.createElement("div",{className:A.default["".concat(X,"_content_table_search")]},O.default.createElement(P.default,{placeholder:"搜索",borderType:"bordered",prefix:O.default.createElement(I.Icon,{prefix:"nocodeplatformicon",type:"sousuo"}),size:"small",onChange:function(e){w(e),i.current=W(W({},i.current),{},{page_no:1}),G()},allowClear:!0}))),O.default.createElement("div",{className:A.default["".concat(X,"_content_table_body")]},O.default.createElement(z.DataGrid,{columns:j,showSelected:!0,dataSource:s.rows,onRowSelectChange:L,onPageChange:R,rowSelection:{type:r?"checkbox":"radio",value:E||[],highlightRowWhenSelected:!0,column:{lock:!0},onChange:L,clickArea:"row"},primaryKey:"id"})),O.default.createElement("div",{className:A.default["".concat(X,"_content_table_pagination")]},O.default.createElement(I.Pagination,{pageType:"nicety",current:i.current.page_no,showQuickJumper:!1,pageSize:i.current.page_size,onChange:R,total:(null==s?void 0:s.totalCount)||0,dropdownProps:{getPopupContainer:function(){return document.body}},showSizeChanger:!0}))),r?O.default.createElement("div",{className:A.default.selected},O.default.createElement("div",{className:A.default.selected_nav},O.default.createElement("div",{className:A.default.nav_title},"已选(",null==c?void 0:c.length,")"),O.default.createElement("div",null,O.default.createElement(z.BtnField,{onClick:function(){var e=(0,S.default)(c).call(c,(function(e){return null==a?void 0:(0,N.default)(a).call(a,e.id)}));n({type:J,payload:{selectedList:e}})},type:"text",major:!0},"清空"))),O.default.createElement("div",{className:A.default.selected_list},H())):null)}));Y.displayName="PersonDataGrid";var V=function(e){var t=e.height,n=e.min,a=e.max;return t>a?a:t<n?n:t},Z=(0,O.memo)((function(e){var t=e.visible,n=e.disabledIds,a=void 0===n?[]:n,l=e.selectedList,r=e.onClose,u=e.onConfirm,o=e.isMulti,c=e.withScope,i=(0,B.useWindowSize)().height,d=(0,O.useState)(V({height:i-64,min:520,max:1080})),f=(0,y.default)(d,2),s=f[0],m=f[1],p=(0,O.useReducer)(Q,K),v=(0,y.default)(p,2),_=v[0],h=v[1];(0,O.useEffect)((function(){h({type:J,payload:{selectedList:l}})}),[l]);var b=(0,O.useMemo)((function(){return O.default.createElement("div",{className:A.default["".concat(X,"_content")]},O.default.createElement(I.SplitPanel,{className:A.default["".concat(X,"_content_split")],defaultSplit:.2033898305084746,min:"240px",firstSlot:O.default.createElement(U,{dispatch:h,withScope:c}),secondSlot:O.default.createElement(Y,{state:_,dispatch:h,isMulti:o,disabledIds:a,withScope:c})}))}),[_,h,l,a]),g=(0,O.useCallback)((function(){u(_.selectedList)}),[_.selectedList,u]),w=(0,F.default)(m);return(0,O.useEffect)((function(){var e=V({height:i-64,min:520,max:1080});e%2!=0&&w(e-1)}),[i]),O.default.createElement(L.default,{title:"请选择",width:1244,height:s,visible:t,keyboard:!1,maskClosable:!1,closable:!0,body:b,className:A.default[X],onCancel:r,onOk:g})}));Z.displayName="PersonSelectModal";t.default=Z}}]);