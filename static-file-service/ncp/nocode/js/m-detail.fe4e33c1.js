"use strict";(self.webpackChunknocode_platform=self.webpackChunknocode_platform||[]).push([[488],{27552:function(e,t,a){a.r(t),t.default={success:"_9XUh7nPh_success",dot:"jKJFoPe6_dot",title:"NRcsuMJh_title",state:"NKFmk0JX_state",info:"GGIhTJYm_info",flag:"E6aBzt3v_flag",error:"iyFH6FMi_error",warning:"XUizVfz5_warning",going:"pynC4FIZ_going",reject:"rVwSA6gf_reject",item:"AOlOJisH_item",usr:"+5G4IBAL_usr",editor:"sXJFkmaL_editor",icon:"bNyqF9pn_icon",Auditor:"CWsTQG3Z_Auditor",handler:"OV6hQAAD_handler",des:"+xnDFcZn_des",node:"OZnUlsId_node",launch:"ybdbi0Um_launch",finish:"BlWVwbIL_finish"}},38760:function(e,t,a){a.r(t),t.default={footerbtns:"P4JiD7Lg_footerbtns",button:"KSTYsSPi_button"}},30728:function(e,t,a){a.r(t),t.default={modal:"ZL0DkNTK_modal",modal_content:"wAB3h9mZ_modal_content",model_abs:"mHqH2Si5_model_abs"}},87184:function(e,t,a){a.r(t),t.default={share_button:"DHzbpUGb_share_button",with_background_img:"hxraoRYV_with_background_img"}},58808:function(e,t,a){a.r(t),t.default={shareModal:"x7UMSaHx_shareModal",shareModal_body:"YAT8e0Zi_shareModal_body",fieldItem:"GZqdIVpL_fieldItem",radio:"CNfkRPgV_radio",datePicker:"_1ydgkl+X_datePicker",content:"f+4DeF24_content",header:"u1njDPh-_header",backgroundImg:"lj8bPiCR_backgroundImg",QRCodeBox:"XpcL6+oX_QRCodeBox",appInfo:"QRz66C7h_appInfo",appImg:"+dFIXB+H_appImg",appDesc:"aGr1uZlL_appDesc",appName:"_3GMznPQf_appName",helpWords:"WZbj8hM0_helpWords",bottom_toobar:"TCLc9o1W_bottom_toobar",shareItems_box:"ZciSo0Q0_shareItems_box",shareItem:"_4jT5ay24_shareItem",iconBox:"_5shteH1h_iconBox",icon:"q5A2e7Fv_icon",share_text:"_39DpVkUF_share_text",toobar_cancel:"_8c4S6HCQ_toobar_cancel"}},40879:function(e,t,a){a.r(t),t.default={flow_pop:"rgzi6rPV_flow_pop",process_item:"t0P75obP_process_item",tag:"-w7GUqea_tag",success:"rn9zLWin_success",error:"xTl3lHIg_error",warning:"ucWNRW4V_warning",going:"LuDWXsMN_going",reject:"YWgJILMn_reject"}},62964:function(e,t,a){a.r(t),t.default={apply:"aWVKeVfC_apply",list:"_2PNIUhVY_list",node:"_5AM5dhQY_node"}},29584:function(e,t,a){a.r(t),t.default={footer:"XQatMAc8_footer"}},68140:function(e,t,a){a.r(t),t.default={flow_btn:"ow7EE-RU_flow_btn",container:"T+o-EPHA_container",title:"M7bNehME_title",main:"uONZ4Sr7_main",shareButton:"vOsy-7UN_shareButton"}},70812:function(e,t,a){a.r(t),t.default={turnpage:"MFLFqEHz_turnpage",turnpage_btn:"D3yGHU7a_turnpage_btn",turnpage_btn_icon:"bmmadA6y_turnpage_btn_icon"}},20456:function(e,t,a){var l=a(13568),n=a(93252),u=a(25028),r=a(4884),d=a(9564);u(t,"__esModule",{value:!0}),t.UserInputItem=t.LaunchItem=t.FlowItem=t.FinishItem=t.AuditItem=void 0;var o=d(a(760)),i=d(a(23992)),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=h(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},d=u&&r;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=d?r(e,o):null;i&&(i.get||i.set)?u(n,o,i):n[o]=e[o]}return n.default=e,a&&a.set(e,n),n}(a(65984)),f=a(63548),s=d(a(71252)),m=a(57264),v=a(65873),p=d(a(27552));function h(e){if("function"!=typeof n)return null;var t=new n,a=new n;return(h=function(e){return e?a:t})(e)}var g={willApproval:p.default.warning,willHandled:p.default.warning,approve:p.default.success,handled:p.default.success,done:p.default.success,launch:p.default.success,pass:p.default.success,terminate:p.default.reject,withdraw:p.default.reject,reject:p.default.error,exception_terminate:p.default.error},_={withdraw:"yichexiao",exception_terminate:"cuowushibai",terminate:"foujue2",approve:"tongyi",handled:"tongyi",launch:"tongyi",pass:"tongyi",done:"tongyi"},E=t.FinishItem=(0,c.memo)((function(e){var t=e.item,a=(0,s.default)(p.default.item,p.default.finish,g[t.handleState]||g.handled),l=_[t.handleState]||"right-bold";return c.default.createElement("div",{className:a},c.default.createElement("div",{className:(0,s.default)(p.default.dot,"kdm-nc-flow-dot")},c.default.createElement("p",null,c.default.createElement(f.Icon,{prefix:"nocodeplatformicon",type:l}))),c.default.createElement("div",{className:p.default.info},c.default.createElement("div",{className:p.default.title,style:{marginBottom:0}},c.default.createElement("div",null,c.default.createElement("p",null,t.nodeName)),c.default.createElement("div",{className:p.default.state},t.handleStateDesc),c.default.createElement("div",null,t.message))))})),b=t.LaunchItem=(0,c.memo)((function(e){var t,a,l=e.item;return c.default.createElement("div",{className:(0,s.default)(p.default.item,p.default.launch)},c.default.createElement("div",{className:(0,s.default)(p.default.dot,"kdm-nc-flow-dot")},c.default.createElement("p",null)),c.default.createElement("div",{className:p.default.info},c.default.createElement("div",{className:p.default.editor},c.default.createElement("div",{className:p.default.icon,style:{background:l.bg}},c.default.createElement(v.Avatar,{src:(null===(t=l.approverInfos)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.handlerAvatar)||""})),c.default.createElement("div",{className:p.default.handler},c.default.createElement("div",{className:p.default.usr},c.default.createElement("p",null,(null==l||null===(a=l.approverInfos)||void 0===a||null===(a=a[0])||void 0===a?void 0:a.handlerName)||""),c.default.createElement("span",null,l.handleTime?(0,m.dateFormat)("MM-dd hh:mm",l.handleTime):"")),c.default.createElement("div",null,(null==l?void 0:l.handleStateDesc)||"")))))})),y=t.AuditItem=(0,c.memo)((function(e){var t,a,l=e.item,n=e.className,u=e.config,r=e.curNode,d=l.taskId,h=l.handleTime,E=l.handleState,b=l.nodeName,y=l.handleStateDesc,N=l.approverInfos,I=l.message,w=(0,s.default)(p.default.item,n,g[E]||g.willHandled),k=_[E],C=(0,c.useMemo)((function(){return(null==l?void 0:l.canHandle)&&d!==r.taskId&&"willApproval"===E}),[l,E,r,d]),M=(0,c.useCallback)((function(){var e,t,a,n,r=u.appId,d=u.targetFormId,i=u.pkId;(0,m.openner)((0,o.default)(e=(0,o.default)(t=(0,o.default)(a=(0,o.default)(n="/m/".concat(r,"/detail/")).call(n,d,"/")).call(a,i,"/view/flow/")).call(t,l.procInstId,"/task/")).call(e,l.taskId))}),[l,u]);return c.default.createElement("div",{className:w},c.default.createElement("div",{className:(0,s.default)(p.default.dot,"kdm-nc-flow-dot")},c.default.createElement("p",null)),c.default.createElement("div",{className:p.default.info},c.default.createElement("div",{className:p.default.title},c.default.createElement("div",null,c.default.createElement("p",null,b),C&&c.default.createElement(v.BtnField,{type:"text",major:!0,onClick:M,style:{flex:"none"},icon:{prefix:"nocodeplatformicon",type:"daishenpi"}},"审批")),c.default.createElement("div",{className:p.default.state},y)),"willApproval"===E?c.default.createElement("div",{className:p.default.Auditor},(0,i.default)(N).call(N,(function(e){return c.default.createElement("p",{key:null==e?void 0:e.handlerId},c.default.createElement(v.Avatar,{src:(null==e?void 0:e.handlerAvatar)||""}),c.default.createElement("span",null,(null==e?void 0:e.handlerName)||""))}))):c.default.createElement("div",{className:p.default.editor},c.default.createElement("div",{className:p.default.icon},c.default.createElement(v.Avatar,{src:(null==N||null===(t=N[0])||void 0===t?void 0:t.handlerAvatar)||""}),k&&c.default.createElement(f.Icon,{className:p.default.flag,prefix:"nocodeplatformicon",type:k})),c.default.createElement("div",{className:p.default.handler},c.default.createElement("div",{className:p.default.usr},c.default.createElement("p",null,(null==N||null===(a=N[0])||void 0===a?void 0:a.handlerName)||""),c.default.createElement("span",null,h?(0,m.dateFormat)("MM-dd hh:mm",h):"")),c.default.createElement("div",{className:p.default.des},I||"")))))})),N=t.UserInputItem=(0,c.memo)((function(e){var t,a,l=e.item,n=e.className,u=e.config,r=l.procInstId,d=l.nodeBusinessKey,h=l.nodeId,E=(l.nodeType,l.handleState),b=l.approverInfos,y=l.canInputOrView,N=u||{},I=N.appId,w=N.targetFormId,k=N.pkId,C=N.userTaskActivityId,M=N.userTaskBusinessKey,x=(0,s.default)(p.default.item,n,g[l.handleState]||g.willHandled),S=_[l.handleState],A=(0,c.useMemo)((function(){return(0,i.default)(b).call(b,(function(e){return e.handlerId})).join()}),[b]),F=(0,c.useCallback)((function(e){var t,a,l,n,u,i,c,f=(0,o.default)(t=(0,o.default)(a=(0,o.default)(l=(0,o.default)(n=(0,o.default)(u=(0,o.default)(i=(0,o.default)(c="/m/".concat(I,"/detail/")).call(c,w,"/")).call(i,k,"/")).call(u,e,"/flow/")).call(n,r,"/")).call(l,h,"/")).call(a,d,"/")).call(t,A);(0,m.openner)(f)}),[A,I,w,k,r,h,d,M]),T=(0,c.useMemo)((function(){return!C&&!M&&y}),[C,y,M]);return c.default.createElement("div",{className:x},c.default.createElement("div",{className:(0,s.default)(p.default.dot,"kdm-nc-flow-dot")},c.default.createElement("p",null)),c.default.createElement("div",{className:p.default.info},c.default.createElement("div",{className:p.default.title},c.default.createElement("div",null,c.default.createElement("p",null,l.nodeName),T?"handled"===E?c.default.createElement(v.BtnField,{type:"text",major:!0,style:{flex:"none"},onClick:function(){return F("view")},icon:{prefix:"ncicon",type:"yanjing"}},"查看"):c.default.createElement(v.BtnField,{type:"text",major:!0,style:{flex:"none"},onClick:function(){return F("edit")},icon:{prefix:"nocodeplatformicon",type:"bianji"}},"录入"):null),c.default.createElement("div",{className:p.default.state},l.handleStateDesc)),"willHandled"!==l.handleState&&c.default.createElement("div",{className:p.default.editor},c.default.createElement("div",{className:p.default.icon,style:{background:l.bg}},c.default.createElement(v.Avatar,{src:(null===(t=l.approverInfos)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.handlerAvatar)||""}),S&&c.default.createElement(f.Icon,{className:p.default.flag,prefix:"nocodeplatformicon",type:S})),c.default.createElement("div",{className:p.default.handler},c.default.createElement("div",{className:p.default.usr},c.default.createElement("p",null,(null==l||null===(a=l.approverInfos)||void 0===a||null===(a=a[0])||void 0===a?void 0:a.handlerName)||""),c.default.createElement("span",null,l.handleTime?(0,m.dateFormat)("MM-dd hh:mm",l.handleTime):"")),c.default.createElement("div",{className:p.default.des},(null==l?void 0:l.message)||"")))))})),I=t.FlowItem=(0,c.memo)((function(e){var t=e.item,a=e.className,l=(0,s.default)(p.default.item,a,g[t.handleState]||g.willHandled),n=_[t.handleState];return c.default.createElement("div",{className:l},c.default.createElement("div",{className:(0,s.default)(p.default.dot,"kdm-nc-flow-dot")},c.default.createElement("p",null)),c.default.createElement("div",{className:p.default.info},c.default.createElement("div",{className:p.default.title},c.default.createElement("div",null,c.default.createElement("p",null,t.nodeName)),c.default.createElement("div",{className:p.default.state},t.handleStateDesc)),c.default.createElement("div",{className:p.default.editor},c.default.createElement("div",{className:p.default.icon,style:{background:t.bg}},c.default.createElement(f.Icon,{prefix:"nocodeplatformicon",type:t.icon}),n&&c.default.createElement(f.Icon,{className:p.default.flag,prefix:"nocodeplatformicon",type:n})),c.default.createElement("div",{className:p.default.handler},c.default.createElement("div",{className:p.default.usr},c.default.createElement("p",null,t.handlerName||t.nodeTypeName),c.default.createElement("span",null,t.handleTime?(0,m.dateFormat)("MM-dd hh:mm",t.handleTime):"")),c.default.createElement("div",{className:p.default.des},(null==t?void 0:t.message)||"")))))}));N.displayName="UserInputItem",y.displayName="AuditItem",I.displayName="FlowItem",E.displayName="FinishItem",b.displayName="LaunchItem"},19084:function(e,t,a){var l=a(25028),n=a(9564);l(t,"__esModule",{value:!0}),t.default=void 0;var u=n(a(23992)),r=n(a(65984)),d=n(a(71252)),o=n(a(38760)),i=a(18656);t.default=function(e){var t=e.className,a=e.btns;return r.default.createElement("div",{className:(0,d.default)(o.default.footerbtns,t)},(0,u.default)(a).call(a,(function(e,t){var l=e.text,n=e.handleClick;return r.default.createElement(i.Button,{className:o.default.button,onClick:n,type:t<a.length-1?"second":"primary"},l)})))}},88388:function(e,t,a){var l=a(13568),n=a(93252),u=a(25028),r=a(4884),d=a(9564);u(t,"__esModule",{value:!0}),t.default=void 0;var o=d(a(96631)),i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=v(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},d=u&&r;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=d?r(e,o):null;i&&(i.get||i.set)?u(n,o,i):n[o]=e[o]}return n.default=e,a&&a.set(e,n),n}(a(65984)),c=d(a(16428)),f=a(18656),s=d(a(30728)),m=d(a(71252));function v(e){if("function"!=typeof n)return null;var t=new n,a=new n;return(v=function(e){return e?a:t})(e)}t.default=function(e){var t=e.visible,a=e.setVisible,l=e.mask,n=void 0===l||l,u=e.width,r=e.height,d=e.top,v=e.handleMaskClick,p=e.children,h=(0,i.useCallback)((function(){a&&a(!1),v&&v()}),[v]);return t?c.default.createPortal(i.default.createElement("div",{className:s.default.modal},i.default.createElement("div",{className:(0,m.default)((0,o.default)((0,o.default)({},s.default.modal_content,!0),s.default.model_abs,Boolean(d))),style:{width:u,height:r,top:d}},p),i.default.createElement(f.Mask,{visible:n,onMaskClick:h})),document.body):null}},32172:function(e,t,a){var l=a(13568),n=a(93252),u=a(25028),r=a(4884),d=a(9564);u(t,"__esModule",{value:!0}),t.default=void 0;var o=d(a(760)),i=d(a(26048)),c=d(a(96631)),f=d(a(78912)),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=_(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},d=u&&r;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=d?r(e,o):null;i&&(i.get||i.set)?u(n,o,i):n[o]=e[o]}return n.default=e,a&&a.set(e,n),n}(a(65984)),m=a(39392),v=d(a(87184)),p=d(a(53688)),h=a(82416),g=d(a(71252));function _(e){if("function"!=typeof n)return null;var t=new n,a=new n;return(_=function(e){return e?a:t})(e)}t.default=function(e){var t,a=e.style,l=e.className,n=e.withCustomBg,u=e.shareReqireLogin,r=e.shareNotReqireLogin,d=e.config,_=d.appId,E=d.targetFormId,b=(0,s.useState)(!1),y=(0,f.default)(b,2),N=y[0],I=y[1],w=(0,m.useTranslation)().t,k=(0,s.useCallback)((function(){I(!0)}),[]);return s.default.createElement(s.default.Fragment,null,s.default.createElement(h.BtnField,{type:"text","data-nc-action":(0,o.default)(t="".concat(_,"|")).call(t,E,"|m_fu_tb_share"),style:a,onClick:k,className:(0,g.default)((0,c.default)((0,c.default)((0,c.default)({},l,!0),v.default.share_button,!0),v.default.with_background_img,n)),text:w("apps.share"),icon:{prefix:"nocodeplatformicon",type:"fenxiang"}}),s.default.createElement(p.default,(0,i.default)({visible:N,setVisible:I,shareReqireLogin:u,shareNotReqireLogin:r},e)))}},53688:function(e,t,a){var l=a(13568),n=a(93252),u=a(25028),r=a(4884),d=a(9564);u(t,"__esModule",{value:!0}),t.default=t.ShareContentModal=t.BottomToolBar=void 0;var o=d(a(29052)),i=d(a(94924)),c=d(a(78912)),f=d(a(26048)),s=d(a(23992)),m=d(a(50524)),v=d(a(760)),p=d(a(73980)),h=d(a(35680)),g=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=P(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},d=u&&r;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=d?r(e,o):null;i&&(i.get||i.set)?u(n,o,i):n[o]=e[o]}return n.default=e,a&&a.set(e,n),n}(a(65984)),_=d(a(58808)),E=a(18656),b=a(65873),y=d(a(19084)),N=a(57264),I=d(a(71252)),w=d(a(88388)),k=d(a(21363)),C=a(98464),M=a(67368),x=a(1524),S=a(10832),A=d(a(52276)),F=a(16428),T=a(18956),B=a(88268),L=d(a(40436));function P(e){if("function"!=typeof n)return null;var t=new n,a=new n;return(P=function(e){return e?a:t})(e)}t.ShareContentModal=function(e){var t=e.appName,a=void 0===t?"标题":t,l=e.backgroundImg,n=e.appImg,u=e.sharePeople,r=e.validateTime,d=e.link;return g.default.createElement("div",{className:_.default.content},g.default.createElement("div",{className:_.default.header},g.default.createElement("div",{className:_.default.backgroundImg},g.default.createElement("img",{src:(0,N.getUrlWithDataCenter)((0,N.getFullUrl)(l))||A.default})),g.default.createElement("div",{className:_.default.QRCodeBox},g.default.createElement(k.default,{className:_.default.QRCode,value:d,size:48}))),g.default.createElement("div",{className:_.default.appInfo},g.default.createElement("div",{className:_.default.appImg},g.default.createElement("img",{src:(0,N.getUrlWithDataCenter)(n)})),g.default.createElement("div",{className:_.default.appDesc},g.default.createElement("div",{className:_.default.appName},a),g.default.createElement("div",{className:_.default.helpWords},"分享人：",u),r&&g.default.createElement("div",{className:_.default.helpWords},"二维码有效期至：",r))))};var j=t.BottomToolBar=function(e){var t=e.className,a=e.visible,l=e.onClose,n=e.iconInfo;return g.default.createElement(E.Popup,{className:(0,I.default)(_.default.bottom_toobar,t),placement:"bottom",visible:a,destroyOnClose:!0,radius:!0,title:null,onMaskClick:l},g.default.createElement("div",{className:_.default.shareItems_box},(0,s.default)(n).call(n,(function(e){var t=e.icon,a=void 0===t?{}:t,l=e.text,n=e.handleClick;return g.default.createElement("div",{className:_.default.shareItem},g.default.createElement("div",{className:_.default.iconBox,onClick:n},g.default.createElement(E.Icon,(0,f.default)({className:_.default.icon},a))),g.default.createElement("div",{className:_.default.share_text},l))}))),g.default.createElement("button",{className:_.default.toobar_cancel,onClick:l},"取消"))};t.default=function(e){var t=e.className,a=e.needLoginLink,l=e.shareTitle,n=void 0===l?"":l,u=e.shareByPeople,r=e.shareAppImage,d=e.backgroundImg,f=e.visible,s=e.setVisible,P=e.hasNoLogingSetting,R=e.shareReqireLogin,D=e.shareNotReqireLogin,O=e.config,U=(0,L.default)().state,H=void 0===U?{}:U,W=(0,g.useState)(""),z=(0,c.default)(W,2),V=z[0],q=z[1],K=(0,g.useState)("noLogin"),Q=(0,c.default)(K,2),G=Q[0],Z=Q[1],X=(0,g.useState)(1),J=(0,c.default)(X,2),Y=J[0],$=J[1],ee=(0,N.getTimeAfterDay)(1),te=(0,g.useState)(ee),ae=(0,c.default)(te,2),le=ae[0],ne=ae[1],ue=(0,g.useState)(!1),re=(0,c.default)(ue,2),de=re[0],oe=re[1],ie=(0,g.useState)(!1),ce=(0,c.default)(ie,2),fe=ce[0],se=ce[1],me=(0,g.useState)({}),ve=(0,c.default)(me,2),pe=ve[0],he=ve[1],ge=(0,g.useState)("0"),_e=(0,c.default)(ge,2),Ee=_e[0],be=_e[1],ye=(0,g.useRef)(),Ne=(0,g.useRef)(""),Ie=(0,g.useRef)(0),we=H.fileServer||{},ke=[{label:"免登录",value:"noLogin",disabled:!D},{label:"需要登录",value:"needLogin",disabled:!R}],Ce=(0,g.useMemo)((function(){var e,t=window.location.origin+(0,N.getFullUrl)(pe.url||a);return(0,m.default)(t).call(t,"?")?t:(0,v.default)(e="".concat(t)).call(e,Ne.current?"?"+Ne.current:"")}),[pe.url,a]),Me=O.appId,xe=O.targetFormId,Se=O.Status,Ae=(0,g.useCallback)((function(){q((0,p.default)(n).call(n,0,50))}),[n]);(0,g.useEffect)((function(){Ae()}),[n]),(0,g.useEffect)((function(){f?P?oe(P):se(!P):(Ae(),Z("noLogin"),$(1),he({}),ne(ee))}),[f]),(0,g.useEffect)((function(){-1===Y&&(Ie.current=new Date)}),[Y]);var Fe=(0,g.useCallback)((function(e){q(e)}),[]),Te=(0,g.useCallback)((function(e){null!=e&&e.target&&Z(e.target.value)}),[]),Be=(0,g.useCallback)((function(){(0,F.unstable_batchedUpdates)((function(){$(1),Z("noLogin"),ne(ee),oe(!1),s(!1)}))}),[]),Le=(0,g.useCallback)((function(){se(!1),s(!1)}),[]),Pe=(0,g.useCallback)((function(){oe(!1),se(!0)}),[]),je=function(){if("needLogin"===G)he({url:a}),Pe();else{var e;if(-1===Y&&+le<+Ie.current)return void(0,N.showNotice)("error","自定义有效期不能早于当前时间");var t=(0,T.encryptByBase64)((0,N.getTimeDiff)(le)+"");if(null!==(e=a)&&void 0!==e&&(0,m.default)(e).call(e,"?")){var l=a.split("?");a=l[0],Ne.current=l[1]}var n={title:V,bgImage:d,icon:r,url:a,validTime:t,appId:Me,formId:xe,type:Se};"noLogin"===G&&(0,N.isAddStatus)(Se)&&(n.inputMode=Ee),(0,C.sendShareData)(n).then((function(e){he(null==e?void 0:e.row),Pe()})).catch((function(e){var t,a=e.errorCode,l=e.message;(a||l)&&(0,N.showNotice)("error",(0,v.default)(t="生成链接失败: ".concat(a,",")).call(t,l))}))}},Re=function(){var e=(0,i.default)(o.default.mark((function e(){var t;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t=(0,x.getShareContent)({shareLink:Ce,shareTitle:V,shareByPeople:u,expiration:pe.validTime}),(0,S.copy2Clipboard)(t,(function(){(0,N.showNotice)("success","已复制链接到剪贴板")}))}catch(e){(0,N.showNotice)("error","复制链接到剪贴板失败")}case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),De=function(){var e=(0,i.default)(o.default.mark((function e(){var t,a;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(null==n?void 0:(0,h.default)(n).call(n,".",""))||"表单分享海报",e.next=3,(0,M.convertDomToImage)(ye.current);case 3:a=e.sent,(0,N.download)(a,t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Oe=(0,g.useMemo)((function(){return[{text:"取消",handleClick:Be},{text:"生成链接",handleClick:je}]}),[Be,je]),Ue=(0,g.useMemo)((function(){return[{icon:{prefix:"ncicon",type:"weishibiefujian"},text:"复制链接",handleClick:Re}]}),[Re,De]),He=(0,g.useMemo)((function(){return(0,N.getBackImageUrl)(we.imageUrl,d)}),[we.imageUrl,d]),We=-1!==Y;return f&&g.default.createElement(g.default.Fragment,null,g.default.createElement(E.Popup,{className:(0,I.default)(_.default.shareModal,t),placement:"bottom",visible:de,onClose:Be,radius:!0,title:"分享设置"},g.default.createElement(g.default.Fragment,null,g.default.createElement("div",{className:_.default.shareModal_body},g.default.createElement(b.FieldItem,{className:_.default.fieldItem,labelText:"标题",showTitle:!0},g.default.createElement(b.Text,{placeholder:"请输入",value:V,onChange:Fe,maxLength:50})),g.default.createElement(b.FieldItem,{className:_.default.fieldItem,labelText:"允许免登录",showTitle:!0,required:!0},g.default.createElement(E.Radio.Group,{defaultValue:D?"noLogin":"needLogin",className:_.default.radio,size:"middle",options:ke,vertical:!1,onChange:Te})),"noLogin"===G&&g.default.createElement(b.FieldItem,{className:_.default.fieldItem,labelText:"有效期",showTitle:!0,required:!0},g.default.createElement(g.default.Fragment,null,g.default.createElement(E.Radio.Group,{value:Y,className:_.default.radio,size:"middle",options:B.SHARE_TIME_OPTIONS,vertical:!1,onChange:function(e){var t,a=null==e||null===(t=e.target)||void 0===t?void 0:t.value;a&&($(Number(a)),ne((0,N.getTimeAfterDay)(Math.abs(a))))}}),g.default.createElement(b.DatePicker,{placeholder:"请选择时间",value:le,readOnly:We,disabled:We,className:_.default.datePicker,icon:{prefix:"kdicon",type:"date"},allowClear:!0,picker:"second",onConfirm:function(e){ne(e)}}))),"noLogin"===G&&(0,N.isAddStatus)(Se)&&g.default.createElement(b.FieldItem,{className:_.default.fieldItem,labelText:"同一设备（手机、电脑）",showTitle:!0},g.default.createElement(E.Radio.Group,{value:Ee,size:"middle",onChange:function(e){var t=e.target.value;be(t)}},g.default.createElement(E.Radio,{value:"0"},"允许多次填写"),g.default.createElement(E.Radio,{value:"1"},"只能填写一次"),g.default.createElement(E.Radio,{value:"2"},"只能填写一次，但允许修改")))),g.default.createElement(y.default,{btns:Oe}))),g.default.createElement(w.default,{mask:!1,top:233,visible:fe},g.default.createElement("div",{className:_.default.content,ref:ye},g.default.createElement("div",{className:_.default.header},g.default.createElement("div",{className:_.default.backgroundImg},g.default.createElement("img",{src:He||A.default})),g.default.createElement("div",{className:_.default.QRCodeBox},g.default.createElement(k.default,{className:_.default.QRCode,value:Ce,size:48}))),g.default.createElement("div",{className:_.default.appInfo},g.default.createElement("div",{className:_.default.appImg},g.default.createElement("img",{src:(0,N.getUrlWithDataCenter)(window.location.origin+(0,N.getFullUrl)(r))})),g.default.createElement("div",{className:_.default.appDesc},g.default.createElement("div",{className:_.default.appName},V),g.default.createElement("div",{className:_.default.helpWords},"分享人：",u||"用户"),pe.validTime&&g.default.createElement("div",{className:_.default.helpWords},"二维码有效期至：",pe.validTime))))),g.default.createElement(j,{visible:fe,onClose:Le,iconInfo:Ue}))}},74984:function(e,t,a){var l=a(13568),n=a(93252),u=a(25028),r=a(4884);u(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=i(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},d=u&&r;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var c=d?r(e,o):null;c&&(c.get||c.set)?u(n,o,c):n[o]=e[o]}return n.default=e,a&&a.set(e,n),n}(a(65984)),o=a(41936);function i(e){if("function"!=typeof n)return null;var t=new n,a=new n;return(i=function(e){return e?a:t})(e)}var c=(0,d.memo)((function(){return d.default.createElement(o.Outlet,null)}));t.default=c},77964:function(e,t,a){var l=a(13568),n=a(93252),u=a(25028),r=a(4884),d=a(9564);u(t,"__esModule",{value:!0}),t.default=void 0;var o=d(a(26048)),i=d(a(78912)),c=d(a(760)),f=d(a(38456)),s=d(a(23992)),m=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=_(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},d=u&&r;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=d?r(e,o):null;i&&(i.get||i.set)?u(n,o,i):n[o]=e[o]}return n.default=e,a&&a.set(e,n),n}(a(65984)),v=a(18656),p=d(a(732)),h=d(a(97668)),g=d(a(40879));function _(e){if("function"!=typeof n)return null;var t=new n,a=new n;return(_=function(e){return e?a:t})(e)}var E={willApproval:g.default.warning,approve:g.default.success,handled:g.default.success,done:g.default.success,end:g.default.success,terminate:g.default.reject,withdraw:g.default.reject,exception_terminate:g.default.error,willHandled:g.default.going,launch:g.default.going,running:g.default.going},b=(0,m.memo)((function(e){var t,a=e.data,l=e.onItemClick,n=e.config,u=a.approvalInfo,r=a.processStatus,d=n.appId,o=n.targetFormId,i=E[r.handleState];return m.default.createElement("div",{className:g.default.process_item,"data-nc-action":(0,c.default)(t="".concat(d,"|")).call(t,o,"|m_fu_fr_open"),onClick:l},m.default.createElement("div",null,a.processName),m.default.createElement("div",{className:i},u[0].handleStateDesc))})),y=function(e){var t=e.data,a=e.visible,l=e.config,n=e.onClose,u=l.procInstId,r=l.userTaskActivityId,d=l.userTaskBusinessKey,_=(0,m.useState)({}),E=(0,i.default)(_,2),y=E[0],N=E[1],I=(0,m.useState)({}),w=(0,i.default)(I,2),k=w[0],C=w[1],M=(0,p.default)(),x=(0,m.useMemo)((function(){return!!r&&!!d}),[r,d]),S=(0,m.useCallback)((function(e){var t,a,u,r=e.procInstId,d=e.businessKey,o=l.appId,i=l.targetFormId;M((0,c.default)(t=(0,c.default)(a=(0,c.default)(u="/m/".concat(o,"/detail/")).call(u,i,"/")).call(a,d,"/view/flow/")).call(t,r)),n&&n()}),[n,l]);(0,m.useEffect)((function(){if(x){var e,a=(0,f.default)(t).call(t,(function(e){return e.procInstId===u})),l=null==a||null===(e=a.approvalInfo)||void 0===e?void 0:(0,f.default)(e).call(e,(function(e){return e.nodeBusinessKey===d&&e.nodeId===r}));N(a||{}),C(l||{})}}),[u,t,x,d,r]);var A={visible:a,placement:"bottom",title:x?"流程记录":"请选择",footer:null,onClose:n};return m.default.createElement(v.Popup,(0,o.default)({className:g.default.flow_pop},A),x?m.default.createElement(h.default,{data:y,curNode:k,config:l}):(0,s.default)(t).call(t,(function(e){return m.default.createElement(b,{key:e.procInstId,data:e,config:l,onItemClick:function(){return S(e)}})})))};b.displayName="ProcessItem",y.displayName="FlowPopLayout";t.default=(0,m.memo)(y)},82808:function(e,t,a){var l=a(13568),n=a(13939),u=a(34716),r=a(70696),d=a(4884),o=a(3464),i=a(51400),c=a(25028),f=a(93252),s=a(9564);c(t,"__esModule",{value:!0}),t.default=void 0;var m=s(a(23992)),v=s(a(38456)),p=s(a(96631)),h=s(a(78912)),g=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=y(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},u=c&&d;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=u?d(e,r):null;o&&(o.get||o.set)?c(n,r,o):n[r]=e[r]}return n.default=e,a&&a.set(e,n),n}(a(65984)),_=a(63548),E=a(65873),b=a(98464);function y(e){if("function"!=typeof f)return null;var t=new f,a=new f;return(y=function(e){return e?a:t})(e)}function N(e,t){var a=n(e);if(u){var l=u(e);t&&(l=r(l).call(l,(function(t){return d(e,t).enumerable}))),a.push.apply(a,l)}return a}function I(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?N(Object(a),!0).forEach((function(t){(0,p.default)(e,t,a[t])})):o?i(e,o(a)):N(Object(a)).forEach((function(t){c(e,t,d(a,t))}))}return e}var w=function(e){var t=e.tips,a=e.placement,l=e.children;return t?g.default.createElement(_.Tooltip,{tip:t,placement:a},l):l},k=(0,g.memo)((function(e){var t=e.pkId,a=e.formId,l=e.appId,n=e.bosApi,u=(e.className,(0,g.useState)([])),r=(0,h.default)(u,2),d=r[0],o=r[1];(0,g.useEffect)((function(){t&&(0,b.getBizButtonList)({appId:l,formId:a,pkId:t}).then((function(e){var t=e.rows;Array.isArray(t)&&o((0,m.default)(t).call(t,(function(e){return I(I({},e),{},{text:e.text.zh_CN})})))})).catch((function(e){}))}),[t]);var i=(0,g.useCallback)((function(e){n.invokeHandle("click",e,[],[])}),[n]),c=(0,g.useCallback)((function(e){var t=e.SecondConfirm,a=e.opk,l=e.text;t?E.WebMsg.showModalConfirm({title:"确定对记录执行".concat(l,"操作吗？"),actions:[{text:"取消",key:"cancel"},{text:"确定",key:"confirm",primary:!0}],onAction:function(e){"confirm"===e.key&&i(a)},type:"prompt"}):i(a)}),[i]),f=function(e){var t=(0,v.default)(d).call(d,(function(t){return t.opk===e}));t&&c(t)},s=(0,g.useMemo)((function(){return g.default.createElement(_.Dropdown.Menu,{onClick:f},(0,m.default)(d).call(d,(function(e,t){return g.default.createElement(_.Dropdown.Item,{key:e.opk},g.default.createElement(w,{tips:null==e?void 0:e.HelpTips,placement:"right"},e.text))})))}),[d,f]);return null!=d&&d.length?g.default.createElement(_.Dropdown,{menu:s,trigger:"click"},g.default.createElement(E.BtnField,null,"更多")):null}));k.displayName="MobileBizButtonList";t.default=k},97668:function(e,t,a){var l=a(13568),n=a(93252),u=a(25028),r=a(4884),d=a(9564);u(t,"__esModule",{value:!0}),t.default=void 0;var o=d(a(23992)),i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=s(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},d=u&&r;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=d?r(e,o):null;i&&(i.get||i.set)?u(n,o,i):n[o]=e[o]}return n.default=e,a&&a.set(e,n),n}(a(65984)),c=a(20456),f=d(a(62964));function s(e){if("function"!=typeof n)return null;var t=new n,a=new n;return(s=function(e){return e?a:t})(e)}var m={NoCodeWfNodeUserInput:c.UserInputItem,NoCodeWfNodeEnd:c.FinishItem,NoCodeWfNodeStart:c.LaunchItem,NoCodeWfNodeAudit:c.AuditItem},v=(0,i.memo)((function(e){var t=e.data,a=e.config,l=e.curNode,n=(t||{}).approvalInfo;return i.default.createElement(i.default.Fragment,null,i.default.createElement("div",{className:f.default.apply},i.default.createElement("div",{className:f.default.list},null==n?void 0:(0,o.default)(n).call(n,(function(e,n){var u=m[e.nodeType]||c.FlowItem;return i.default.createElement(u,{key:e.taskId,curNode:l,className:n===t.length-2?f.default.node:"",item:e,config:a})})))))}));v.displayName="MobileFlowListLayout";t.default=v},98516:function(e,t,a){var l=a(13568),n=a(93252),u=a(25028),r=a(4884),d=a(9564);u(t,"__esModule",{value:!0}),t.default=void 0;var o=d(a(760)),i=d(a(67584)),c=d(a(78912)),f=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=b(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},d=u&&r;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=d?r(e,o):null;i&&(i.get||i.set)?u(n,o,i):n[o]=e[o]}return n.default=e,a&&a.set(e,n),n}(a(65984)),s=a(65873),m=a(57264),v=d(a(732)),p=d(a(82808)),h=d(a(29584)),g=a(78016),_=d(a(75020)),E=a(66028);function b(e){if("function"!=typeof n)return null;var t=new n,a=new n;return(b=function(e){return e?a:t})(e)}var y={save:!1,saveAndNew:!1,copy:!1,delete:!1,edit:!1},N=(0,f.memo)((function(e){var t=e.status,a=e.bosApi,l=e.authList,n=e.config,u=e.isSharePage,r=e.inputAuthFixed,d=e.formLock,b=e.extraButton,N=e.setStatus,I=e.fetchFlowList,w=l||{},k=w.deleteAuth,C=w.inputAuth,M=w.editAuth,x=w.viewAuth,S=n||{},A=S.appId,F=S.pkId,T=S.targetFormId,B=(S.procInstId,S.userTaskActivityId),L=S.userTaskBusinessKey,P=S.userTaskCurrentUserId,j=(0,v.default)(),R=(0,f.useRef)(null),D=(0,f.useRef)(!1),O=(0,f.useRef)(""),U=(0,f.useRef)(F),H=(0,f.useRef)(!1),W=(0,f.useRef)(Boolean(B&&L&&P)),z=(0,f.useReducer)(E.assignDataReducer,y),V=(0,c.default)(z,2),q=V[0],K=V[1],Q=(0,f.useCallback)((function(e){var t,a=(0,m.getBosActions)(e.data);return 0===(null==a||null===(t=a.ShowNotificationMsg)||void 0===t?void 0:t[0].type)}),[]),G=(0,f.useCallback)((function(){if(!q.saveAndNew){K({saveAndNew:!0});var e=R.current.checked?"btncopy":"btnnew";(0,g.publishClickUserEvent)({appId:A,formId:T,action:R.current.checked?"m_fu_fo_kc":"m_fu_fo_cfill"}),a.invokeHandle("click",e,[],[],(function(e,t){K({saveAndNew:!1})})),N("addNew")}}),[a,R.current,A,T,q.saveAndNew]),Z=(0,f.useCallback)((function(){q.copy||(K({copy:!0}),a.invokeHandle("click","btncopy",[],[],(function(e,t){N("addNew"),a.setFormStatus("addNew",t),K({copy:!1})})))}),[a,q.copy]),X=(0,f.useCallback)((function(){q.delete||(K({delete:!0}),(0,g.publishClickUserEvent)({appId:A,formId:T,action:"m_fu_fo_del_comf"}),a.invokeHandle("click","btndel",[],[],(function(e){K({delete:!1}),Q(e)&&te()})))}),[a,A,T,q.delete]),J=(0,f.useCallback)((function(){q.edit||(K({edit:!0}),a.invokeHandle("click","btnedit",[],[],(function(e){var t;K({edit:!1});var a=(0,m.getBosActions)(e.data);1===(null==a||null===(t=a.setFormStatus)||void 0===t?void 0:t[0])&&N("edit")})))}),[N,a,q.edit]),Y=(0,_.default)(G),$=(0,_.default)(J),ee=(0,_.default)(Z),te=(0,f.useCallback)((function(){var e;j((0,o.default)(e="/m/".concat(A,"/home/")).call(e,T),{replace:!0})}),[A,T]),ae=(0,f.useCallback)((function(e){switch(e.key){case"view":if(H.current){var t=["m",A,"detail",T,U.current,"view"].join("/");window.location.href=(0,m.getFullPathName)(t)}else N("view"),null==I||I(U.current),a.setFormStatus("view");(0,g.publishClickUserEvent)({appId:A,formId:T,action:"m_fu_fo_detail"});break;case"continue":Y();break;case"back":te();break;case"delete":X()}}),[Y,te,X,N,a,I,A,T]),le=(0,f.useCallback)((function(){s.WebMsg.showModalConfirm({type:3,title:"确定删除该记录吗？",actions:[{key:"cancle",text:"取消"},{key:"delete",text:"确定",primary:!0}],onAction:ae})}),[ae]),ne=(0,f.useCallback)((function(){q.save||(K({save:!0}),a.invokeHandle("click","btnsave",[],[],(function(e,l){D.current=!1;var n=(0,m.getBosActions)(e.data),r=n.mobSaveSuccess,d=n.setPkId;if(O.current=l,r){if(W.current)return void(0,i.default)((function(){return window.history.go(-1)}),2e3);if(H.current=U.current&&d[0]!==U.current,U.current=d[0],u)return void s.WebMsg.showToast({duration:1e3,type:0,content:"edit"===t?"保存成功":"提交成功",afterClose:function(){N("view"),a.setFormStatus("view",l),K({save:!1})}});var o={type:0,onAction:ae};"edit"===t?(o.title="保存成功",o.actions=[{key:"back",text:"返回列表"},{key:"view",text:"查看详情",primary:!0}]):(o.title="提交成功",o.content=f.default.createElement(s.Checkbox,{ref:R},"继续录入时，保留本次提交内容"),o.actions=[{key:"view",text:"查看详情"},{key:"continue",text:"继续录入",primary:!0}]),s.WebMsg.showModalConfirm(o)}K({save:!1})})))}),[a,t,ae]);(0,f.useEffect)((function(){F&&F!==U.current&&(U.current=F)}),[F]);var ue=(0,_.default)(ne),re=(0,f.useMemo)((function(){return M?f.default.createElement(f.default.Fragment,null,null==b?void 0:b(),f.default.createElement(s.BtnField,{disabled:!a,type:"primary",loading:q.save,onClick:ue,text:"保存"})):null}),[ue,a,b,M,q.save]),de=(0,f.useMemo)((function(){return C?f.default.createElement(s.BtnField,{disabled:!a,type:"primary",loading:q.save,onClick:ue,text:"提交"}):null}),[ue,a,C,q.save]),oe=(0,f.useMemo)((function(){var e,t,l;return x?f.default.createElement(f.default.Fragment,null,null==b?void 0:b(),f.default.createElement(p.default,{bosApi:a,appId:A,formId:T,pkId:U.current}),!d&&k&&f.default.createElement(s.BtnField,{"data-nc-action":(0,o.default)(e="".concat(A,"|")).call(e,T,"|m_fu_fo_del"),disabled:!a,loading:q.delete,onClick:le},"删除"),!r&&C&&f.default.createElement(s.BtnField,{"data-nc-action":(0,o.default)(t="".concat(A,"|")).call(t,T,"|m_fu_fo_copy"),disabled:!a,loading:q.copy,onClick:ee},"复制"),!d&&M&&f.default.createElement(s.BtnField,{"data-nc-action":(0,o.default)(l="".concat(A,"|")).call(l,T,"|m_fu_fo_edit"),disabled:!a,loading:q.edit,type:"primary",onClick:$},"编辑")):null}),[k,C,M,d,x,F,U.current,a,le,ee,$,b,q.delete,q.copy,q.edit]),ie=(0,f.useMemo)((function(){return"addNew"===t?f.default.createElement(s.BtnField,{disabled:!a,type:"primary",loading:q.save,onClick:ue,text:"提交"}):"edit"===t?re:"view"===t?oe:null}),[t,a,ue,q.save,re,oe]),ce=(0,f.useMemo)((function(){return{view:oe,edit:re,copy:de,addNew:de}[t||"addNew"]}),[t,oe,re,de]);return f.default.createElement("div",{className:h.default.footer},u?ie:ce)}));t.default=N},94356:function(e,t,a){var l=a(13568),n=a(93252),u=a(25028),r=a(4884),d=a(9564);u(t,"__esModule",{value:!0}),t.default=void 0;var o=d(a(67584)),i=d(a(760)),c=d(a(29052)),f=d(a(26048)),s=d(a(94924)),m=d(a(78912)),v=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=M(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},d=u&&r;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=d?r(e,o):null;i&&(i.get||i.set)?u(n,o,i):n[o]=e[o]}return n.default=e,a&&a.set(e,n),n}(a(65984)),p=a(41936),h=a(4440),g=a(98464),_=d(a(11144)),E=d(a(68140)),b=a(18656),y=d(a(77964)),N=d(a(32172)),I=d(a(70072)),w=d(a(40436)),k=d(a(98516)),C=a(85040);function M(e){if("function"!=typeof n)return null;var t=new n,a=new n;return(M=function(e){return e?a:t})(e)}var x=(0,v.lazy)((function(){return a.e(168).then(a.t.bind(a,87168,23))}));t.default=function(e){var t,a=(0,v.useState)(e.title||""),l=(0,m.default)(a,2),n=l[0],u=l[1],r=(0,p.useParams)(),d=r.appId,M=r.targetFormId,S=r.pkId,A=r.Status,F=r.shareId,T=r.procInstId,B=r.userTaskActivityId,L=r.userTaskBusinessKey,P=r.userTaskCurrentUserId,j=(0,w.default)(),R=j.state,D=j.sendUiData,O=R.userInfo,U=R.rootConfig,H=(0,v.useState)(A),W=(0,m.default)(H,2),z=W[0],V=W[1],q=(0,v.useState)(!1),K=(0,m.default)(q,2),Q=K[0],G=K[1],Z=(0,v.useState)([]),X=(0,m.default)(Z,2),J=X[0],Y=X[1],$=(0,v.useState)(!1),ee=(0,m.default)($,2),te=ee[0],ae=ee[1],le=(0,v.useRef)(null),ne=(0,v.useRef)(null),ue=(0,v.useState)({}),re=(0,m.default)(ue,2),de=re[0],oe=re[1],ie=(0,v.useState)({}),ce=(0,m.default)(ie,2),fe=ce[0],se=ce[1],me=(0,v.useState)(!1),ve=(0,m.default)(me,2),pe=ve[0],he=ve[1],ge=(0,v.useState)({}),_e=(0,m.default)(ge,2),Ee=_e[0],be=_e[1],ye=Ee.add,Ne=void 0===ye||ye,Ie=Ee.edit,we=void 0===Ie||Ie,ke=Ee.view,Ce=void 0===ke||ke,Me=Ee.delete,xe=void 0===Me||Me,Se=Ee["edit-001"],Ae=Ee["view-004"],Fe=Ee["view-005"],Te=Ee["add-002"],Be=Ee["add-003"],Le=Ee.add_fixed,Pe=void 0!==Le&&Le,je=J.length>0,Re=(0,v.useMemo)((function(){return"addNew"===z||"copy"===z}),[z]),De=(0,v.useMemo)((function(){return"edit"===z||"addNew"===z}),[z]),Oe=(0,v.useMemo)((function(){return"view"===z}),[z]),Ue=(0,v.useMemo)((function(){var e;return"1"===(null===(e=J[0])||void 0===e?void 0:e.lockStatus)}),[J]);(0,v.useEffect)((function(){V(A)}),[A]);var He=(0,v.useCallback)((0,s.default)(c.default.mark((function e(){var t,a;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,C.getFormAuth)(d,M,S,T,B,L,P);case 3:t=e.sent,a=t.rows,be((void 0===a?[]:a)[0]||[]),he(!0),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),[d,M,S,T,B,L,P]);(0,v.useEffect)((function(){He()}),[He]);var We=(0,v.useMemo)((function(){return!!(pe&&fe&&O)&&(!(Ne||!function(e){return"addNew"===e}(z))||(!(Ce||!function(e){return"view"===e}(z)||je||!te)||!(we||!function(e){return"edit"===e}(z)||je||!te)))}),[pe,fe,O,Ee,je,te]),ze=(0,v.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S;ae(!1),(0,g.getApprovalInfo)({entityNumber:M,businessKey:e}).then((function(e){Y((null==e?void 0:e.rows)||[]),ae(!0)}))}),[M,S]);(0,v.useEffect)((function(){M&&S&&ze()}),[M,S,ze]),(0,v.useEffect)((function(){n||(0,h.getFormData)({appId:d,targetFormId:M}).then((function(e){var t,a=(null==e||null===(t=e.rows)||void 0===t?void 0:t[0])||{},l=a.name,n=a.backImage,r=a.image;u(l),oe({shareAppImage:r,backgroundImg:n})})).catch((function(e){}))}),[]),(0,v.useEffect)((function(){if(document.title="view"===z?"详情":"录入",le.current&&"view"===z){var e=function(){"none"!==a.style.display&&(a.style.display="none"),window.clearTimeout(l),l=(0,o.default)((function(){a.style.display="flex"}),300)},t=ne.current,a=le.current,l=null;return null==t||t.addEventListener("scroll",e,!0),function(){null==t||t.removeEventListener("scroll",e,!0)}}}),[z,ne.current,le.current]);var Ve=(0,v.useCallback)((function(e){if(e){se(e);var t=null==e?void 0:e.getPageStatus();t&&V(t)}}),[]),qe=(0,v.useCallback)((function(e){V(e)}),[V]),Ke=(0,v.useMemo)((function(){var e,t,a,l,n,u;return S&&"addNew"!==z?z?(0,i.default)(a=(0,i.default)(l=(0,i.default)(n="/".concat(d,"/detail/")).call(n,M,"/")).call(l,S,"/")).call(a,z):(0,i.default)(e=(0,i.default)(t="/".concat(d,"/detail/")).call(t,M,"/")).call(e,S):(0,i.default)(u="/".concat(d,"/detail/")).call(u,M)}),[d,M,S,z]),Qe=(0,v.useMemo)((function(){return De?Re?Te||Be:Se:Ae||Fe}),[z,Ae,Fe,Be,Te]),Ge=(0,v.useMemo)((function(){var e={formId:"bos_nocode_bill",targetFormId:M,Status:A||"addNew",pkId:S,appId:d,procInstId:T};return B&&L&&(e.userTaskActivityId=B,e.userTaskBusinessKey=L,e.userTaskCurrentUserId=P),e}),[S]);(0,v.useEffect)((function(){var e;null==fe||null===(e=fe.loadPage)||void 0===e||e.call(fe,Ge)}),[Ge]);var Ze=(null===(t=(0,I.default)(M))||void 0===t?void 0:t.customStyle)&&(null==de?void 0:de.backgroundImg);return null!=U&&U.pageId?We?v.default.createElement(p.Navigate,{to:"/noPermission",replace:!0}):v.default.createElement(v.default.Fragment,null,v.default.createElement("div",{className:E.default.container,ref:ne},v.default.createElement("div",{className:E.default.main},!F&&Qe&&v.default.createElement(N.default,(0,f.default)({style:{top:Ze?23:18},withCustomBg:Ze,targetFormId:M,className:E.default.shareButton,shareTitle:n,shareByPeople:null==O?void 0:O.name,needLoginLink:["nocode","/m",Ke,window.location.search].join(""),hasNoLogingSetting:!("edit"===z&&!Re&&S),shareReqireLogin:De&&!Re?Se:Oe?Ae:Te,shareNotReqireLogin:De&&!Re?Se:Oe?Fe:Be,config:{appId:d,targetFormId:M,Status:z||"addNew"}},de)),v.default.createElement(v.Suspense,{fallback:v.default.createElement("div",null)},v.default.createElement(x,{onRef:Ve,config:Ge,device:"mobile",options:{onStatusChange:qe,sendUiData:D,rootConfig:U}}))),v.default.createElement(k.default,{status:z,bosApi:fe,authList:{deleteAuth:xe,inputAuth:Ne,editAuth:we,viewAuth:Ce},config:Ge,isSharePage:!O,formLock:Ue,inputAuthFixed:Pe,fetchFlowList:ze,extraButton:function(){var e;return!!J.length&&v.default.createElement("div",{className:E.default.flow_btn,"data-nc-action":(0,i.default)(e="".concat(d,"|")).call(e,M,"|m_fu_fr"),onClick:function(){return G(!0)}},v.default.createElement(b.Badge,{dot:!0},v.default.createElement(b.Icon,{type:"liucheng",prefix:"nocodeplatformicon"})),v.default.createElement("p",null,"流程记录"))},setStatus:V})),"view"===z&&v.default.createElement(_.default,{ref:le,viewAuth:Ce}),!!J.length&&v.default.createElement(y.default,{data:J,visible:Q,config:Ge,onClose:function(){return G(!1)}})):null}},11144:function(e,t,a){var l=a(13568),n=a(13939),u=a(34716),r=a(70696),d=a(4884),o=a(3464),i=a(51400),c=a(25028),f=a(93252),s=a(9564);c(t,"__esModule",{value:!0}),t.default=void 0;var m=s(a(29052)),v=s(a(96631)),p=s(a(94924)),h=s(a(78912)),g=s(a(23992)),_=s(a(760)),E=s(a(33260)),b=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=S(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},u=c&&d;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=u?d(e,r):null;o&&(o.get||o.set)?c(n,r,o):n[r]=e[r]}return n.default=e,a&&a.set(e,n),n}(a(65984)),y=a(18656),N=a(41936),I=a(55867),w=a(71120),k=a(80672),C=s(a(732)),M=a(95936),x=s(a(70812));function S(e){if("function"!=typeof f)return null;var t=new f,a=new f;return(S=function(e){return e?a:t})(e)}function A(e,t){var a=n(e);if(u){var l=u(e);t&&(l=r(l).call(l,(function(t){return d(e,t).enumerable}))),a.push.apply(a,l)}return a}function F(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?A(Object(a),!0).forEach((function(t){(0,v.default)(e,t,a[t])})):o?i(e,o(a)):A(Object(a)).forEach((function(t){c(e,t,d(a,t))}))}return e}var T=function(e){return void 0===e},B=function(e){return e&&0!==(null==e?void 0:e.length)?(0,g.default)(e).call(e,(function(e){return e.id})):[]},L=(0,b.memo)((0,b.forwardRef)((function(e,t){var a,l,n=e.viewAuth,u=(0,N.useParams)(),r=u.targetFormId,d=u.appId,o=u.pkId,i=void 0===o?"":o,c=(0,C.default)(),f=(0,b.useContext)(M.Context),s=f.state,v=void 0===s?{}:s,g=f.dispatch,S=t||(0,b.useRef)(null),A=v.mobileAppHomeData,L=void 0===A?{}:A,P=L.data,j=L.pageNo,R=L.pageSize,D=L.lastPage,O=L.listItemConfig,U=L.listFilters,H=L.searchKeywords,W=(0,b.useState)(B(P)),z=(0,h.default)(W,2),V=z[0],q=z[1],K=V.length;if(!i||K<=1||T(P)&&T(j)&&T(R))return null;var Q=function(e){var t,a;c((0,_.default)(t=(0,_.default)(a="/m/".concat(d,"/detail/")).call(a,r,"/")).call(t,e,"/view"),{replace:!0})},G=function(){var e=(0,p.default)(m.default.mark((function e(){var t,a,l,u,o,i,c;return m.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,I.loadFormListWithParams)({appId:d,formId:r,env:w.ENV_APP,pageNo:j+1,pageSize:R,listItemConfig:O,listFilters:U,searchKeywords:H,viewAuth:n});case 3:t=e.sent,a=t.dataSource,l=t.pageSize,u=t.pageNo,o=t.lastPage,a.length>0&&(i=(0,_.default)(P).call(P,a),g({type:k.UPDATE_MOBILE_APPHOMEDATA,payload:F(F({},L),{},{pageNo:u+1,pageSize:l,data:i,lastPage:o})}),c=B(a),Q(c[0]),q((0,_.default)(V).call(V,c))),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();return b.default.createElement("div",{className:x.default.turnpage,ref:S},b.default.createElement(y.Button,{disabled:0===(0,E.default)(V).call(V,i),onClick:function(){if(K>1){var e=(0,E.default)(V).call(V,i)-1;-1!==e&&Q(V[e])}},className:x.default.turnpage_btn,size:"large",type:"primary",shape:"circle","data-nc-action":(0,_.default)(a="".concat(d,"|")).call(a,r,"|m_fu_fo_prev")},b.default.createElement(y.Icon,{className:x.default.turnpage_btn_icon,prefix:"nocodeplatformicon",type:"shuangjiantoushang"})),b.default.createElement(y.Button,{disabled:D&&(0,E.default)(V).call(V,i)===K-1,onClick:function(){if(K>1){var e=(0,E.default)(V).call(V,i)+1;e!==K?Q(V[e]):D||G()}},className:x.default.turnpage_btn,size:"large",type:"primary",shape:"circle","data-nc-action":(0,_.default)(l="".concat(d,"|")).call(l,r,"|m_fu_fo_next")},b.default.createElement(y.Icon,{className:x.default.turnpage_btn_icon,prefix:"nocodeplatformicon",type:"shuangjiantouxia"})))})));L.displayName="MobileDetailTurnPage";t.default=L}}]);