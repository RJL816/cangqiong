"use strict";(self.webpackChunknocode_platform=self.webpackChunknocode_platform||[]).push([[656],{15296:function(e,t,a){a.r(t),t.default={company_info:"BDww5rnK_company_info",tree:"DZdyrpay_tree",search:"nacWuu6V_search",table:"gxoTPP9t_table",organization:"WXhdZRGq_organization",item:"_1A0DpeE5_item",managers:"avu5yVG7_managers",title:"NlOGNlbM_title",list:"_0BnofMH+_list",page:"_2FqD4aKG_page",avatar:"YK0gKCh4_avatar",loading:"OIbBwdKG_loading"}},51e3:function(e,t,a){var n=a(13568),l=a(13939),r=a(34716),u=a(70696),d=a(4884),c=a(3464),o=a(51400),i=a(25028),f=a(93252),s=a(9564);i(t,"__esModule",{value:!0}),t.renderMore=t.renderAvatar=t.default=void 0;var m=s(a(23992)),p=s(a(29052)),v=s(a(96631)),g=s(a(94924)),E=s(a(78912)),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=n(e)&&"function"!=typeof e)return{default:e};var a=R(t);if(a&&a.has(e))return a.get(e);var l={__proto__:null},r=i&&d;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var c=r?d(e,u):null;c&&(c.get||c.set)?i(l,u,c):l[u]=e[u]}return l.default=e,a&&a.set(e,l),l}(a(65984)),h=a(63548),b=a(82416),y=s(a(15296)),N=a(25096),w=a(57264),C=s(a(86920)),S=s(a(40072)),k=a(63516),O=s(a(68692)),x=s(a(75020));function R(e){if("function"!=typeof f)return null;var t=new f,a=new f;return(R=function(e){return e?a:t})(e)}function z(e,t){var a=l(e);if(r){var n=r(e);t&&(n=u(n).call(n,(function(t){return d(e,t).enumerable}))),a.push.apply(a,n)}return a}function M(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?z(Object(a),!0).forEach((function(t){(0,v.default)(e,t,a[t])})):c?o(e,c(a)):z(Object(a)).forEach((function(t){i(e,t,d(a,t))}))}return e}var D=t.renderAvatar=function(e){return _.default.createElement(b.Avatar,{className:y.default.avatar,src:e,alt:""})},T=t.renderMore=function(e,t,a){return _.default.createElement(b.BtnField,{type:"text",major:!0,onClick:function(){return G(t)}},"详情")},G=function(e){var t=(0,w.autoModalHeight)(520,640,640,_.default.createElement(C.default,{data:e}));h.Modal.confirm({title:"员工信息",showline:!0,footer:null,titleIcon:null,width:640,height:t,type:"normal",bodyStyle:{padding:0,overflow:"hidden"},body:_.default.createElement(C.default,{data:e}),closable:!0,maskClosable:!1})};t.default=_.default.memo((function(){var e=(0,_.useState)([]),t=(0,E.default)(e,2),a=t[0],n=t[1],l=(0,_.useState)([]),r=(0,E.default)(l,2),u=r[0],d=r[1],c=(0,_.useState)([]),o=(0,E.default)(c,2),i=o[0],f=o[1],s=(0,_.useState)([]),v=(0,E.default)(s,2),C=v[0],R=v[1],z=(0,_.useState)(null),G=(0,E.default)(z,2),P=G[0],K=G[1],j=(0,_.useState)(0),A=(0,E.default)(j,2),B=A[0],I=A[1],H=(0,_.useState)(""),Q=(0,E.default)(H,2),V=Q[0],Y=Q[1],q=(0,_.useState)(""),F=(0,E.default)(q,2),W=F[0],Z=F[1],J=(0,_.useState)(200),U=(0,E.default)(J,2),X=U[0],L=U[1],$=(0,_.useState)(!1),ee=(0,E.default)($,2),te=ee[0],ae=ee[1],ne=(0,_.useRef)({page_size:10,page_no:1}),le=(0,_.useRef)(null),re=(0,_.useRef)([{code:"number",name:"员工编号",width:178},{code:"name",name:"员工姓名",width:178},{code:"avatar",name:"员工头像",align:"center",width:178,render:D},{code:"opera",name:"操作",width:100,render:T}]),ue=(0,_.useCallback)((0,g.default)(p.default.mark((function e(){var t,a;return p.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={tree_deep:-1,id:""},ae(!0),e.next=4,(0,k.getStorage)("NOCODE_COMPANY_ORG_TREE");case 4:(a=e.sent)&&(ae(!1),de(a)),(0,N.getCompanyOrg)(t).then((function(e){ae(!1),de(e),(0,k.setStorage)("NOCODE_COMPANY_ORG_TREE",e)}));case 7:case"end":return e.stop()}}),e)}))),[a]),de=(0,_.useCallback)((function(e){var t,a,l=(0,w.formateTreeData)(e.rows);(n(l),K(l[0]),null!==(t=l[0])&&void 0!==t&&t.id)&&(ne.current.page_no=1,ne.current.filter="entryentity.dpt.number EQ ".concat(null===(a=l[0])||void 0===a?void 0:a.number),oe(ne.current))}),[]),ce=(0,_.useCallback)((function(e,t,a){return e.some((function(e){return e.key===a?(e.children=t,!0):(ce(e.children,t,a),!1)})),e}),[]),oe=(0,_.useCallback)((function(e){(0,N.getOrgUsers)(e).then((function(e){var t;I(e.totalCount),d(e.rows);var a=null===(t=e.extra)||void 0===t||null===(t=t.managers)||void 0===t?void 0:(0,m.default)(t).call(t,(function(e){return e.name}));Z(a.join("、"))}))}),[]),ie=(0,_.useCallback)((function(e,t){f(e)}),[a]),fe=(0,_.useCallback)((function(e,t){ne.current=M(M({},ne.current),{},{page_size:t,page_no:e}),oe(ne.current)}),[]),se=(0,_.useCallback)((function(e){return new RegExp(V,"i").test(e.title)}),[V]);(0,S.default)(le.current,(function(e){L(e[0].contentRect.height-50)}));var me=(0,x.default)(Y);return(0,_.useEffect)((function(){ue()}),[]),te?_.default.createElement("div",{className:y.default.loading},_.default.createElement(h.Spin,{name:"Spin",type:"container"})):_.default.createElement("div",{className:y.default.company_info},_.default.createElement("div",{className:y.default.tree},_.default.createElement("div",{className:y.default.search},_.default.createElement(O.default,{prefix:_.default.createElement(h.Icon,{prefix:"nocodeplatformicon",type:"sousuo"}),onChange:function(e){return me(e)},placeholder:"搜索",size:"small",borderType:"bordered"})),_.default.createElement(h.Tree,{name:"Tree",treeData:a,expandedKeys:i,onExpand:ie,filterTreeNode:se,filterValue:V,selectedKeys:C,onSelect:function(e,t){var a=t.node;ne.current.page_no=1,ne.current.filter="entryentity.dpt.number EQ ".concat(null==a?void 0:a.number),oe(ne.current),K(a),R(e)},defaultExpandRoot:!0,height:"100%",virtual:!0,selectable:!0,estimatedItemSize:36})),_.default.createElement("div",{className:y.default.table},_.default.createElement("div",{className:y.default.organization},_.default.createElement("div",{className:y.default.item},_.default.createElement("div",{className:y.default.title},"组织编号"),_.default.createElement("div",null,(null==P?void 0:P.number)||"-")),_.default.createElement("div",{className:y.default.item},_.default.createElement("div",{className:y.default.title},"组织名称"),_.default.createElement("div",null,(null==P?void 0:P.name)||"-")),_.default.createElement("div",{className:y.default.item},_.default.createElement("div",{className:y.default.title},"上级组织"),_.default.createElement("div",null,(null==P?void 0:P.parentname)||"-")),_.default.createElement("div",{className:y.default.item},_.default.createElement("div",{className:y.default.title},"组织负责人"),_.default.createElement("div",{className:y.default.managers},W||"-"))),_.default.createElement("div",{ref:le,className:y.default.list},_.default.createElement(b.DataGrid,{emptyCellHeight:X,style:{height:"100%"},columns:re.current,dataSource:u})),_.default.createElement("div",{className:y.default.page},_.default.createElement(h.Pagination,{pageType:"nicety",current:ne.current.page_no,showQuickJumper:!1,showSizeChanger:!0,pageSize:ne.current.page_size,dropdownProps:{getPopupContainer:function(){return document.body}},onChange:fe,total:B}))))}))}}]);