"use strict";(self.webpackChunknocode_platform=self.webpackChunknocode_platform||[]).push([[280],{69088:function(e,t,a){a.r(t),t.default={success:"_9-Aion8h_success",dot:"ZVMmASGJ_dot",title:"KaeMBu2m_title",state:"Z-CvAj4c_state",info:"GvzLXVo7_info",flag:"TBFeJiu+_flag",error:"KKDLfIhb_error",warning:"jnwNwgma_warning",going:"_5Fdia0us_going",reject:"SFYzHxjl_reject",item:"QO80lXi8_item",usr:"veevljfh_usr",editor:"XVWU8JJb_editor",icon:"_3ioEKe+f_icon",Auditor:"F7A5dz-7_Auditor",handler:"vsH04h6N_handler",des:"hGNfFjvv_des",node:"Nh28D1ks_node",launch:"OQk0QbW4_launch",finish:"KvvJwUIM_finish"}},89244:function(e,t,a){a.r(t),t.default={apply:"RlXB8RId_apply",mb:"SpCsExEE_mb",nav:"DAh5OVTO_nav",title:"Iu79-u2b_title",node_name:"FbedzwWE_node_name",err:"uaIt0zoF_err",btns:"qQqKgw2a_btns",list:"g5DwPN+R_list",node:"dkH4oigt_node",confirm:"Orrq7fn8_confirm",body:"GHdNFZHJ_body",footer:"HHqqCqoD_footer"}},28996:function(e,t,a){a.r(t),t.default={form_footer:"L+3T9ft1_form_footer",form_footer_main:"WRUJUeKF_form_footer_main",form_footer_main_tips:"-anEDyDY_form_footer_main_tips",btns:"xiAX4YhX_btns",bizbtns:"Btg5+xYQ_bizbtns"}},34964:function(e,t,a){a(25028)(t,"__esModule",{value:!0}),t.FLOW_ACTION_TYPES=void 0;t.FLOW_ACTION_TYPES={consent:"Consent",terminate:"Terminate",reject:"Reject",cancel:"TaskCancel"}},3308:function(e,t,a){var l=a(25028),n=a(9564);l(t,"__esModule",{value:!0}),t.default=void 0;var u=n(a(29052)),d=n(a(94924)),i=n(a(78912)),r=a(65984),o=a(63516);t.default=function(e){var t=(0,r.useState)(""),a=(0,i.default)(t,2),l=a[0],n=a[1],c=(0,r.useCallback)((0,d.default)(u.default.mark((function t(){var a,l,d,i,r;return u.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,(0,o.getStorage)("bos-core-"+e);case 4:if(t.t0=t.sent,t.t0){t.next=7;break}t.t0={};case 7:l=t.t0,d=(null==l||null===(a=l.items)||void 0===a?void 0:a[0])||{},i=d.bc,r=d.customStyle,n(r?i:"#F8FAFC");case 11:case"end":return t.stop()}}),t)}))),[e]);return(0,r.useLayoutEffect)((function(){return window.addEventListener("storage",(function(){return c()}),!1),function(){window.removeEventListener("storage",(function(){}))}}),[]),(0,r.useEffect)((function(){c()}),[e]),l}},48552:function(e,t,a){var l=a(13568),n=a(93252),u=a(25028),d=a(4884),i=a(9564);u(t,"__esModule",{value:!0}),t.UserInputItem=t.LaunchItem=t.FlowItem=t.FinishItem=t.AuditItem=void 0;var r=i(a(760)),o=i(a(23992)),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=h(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},i=u&&d;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=i?d(e,r):null;o&&(o.get||o.set)?u(n,r,o):n[r]=e[r]}return n.default=e,a&&a.set(e,n),n}(a(65984)),f=a(63548),s=i(a(71252)),m=a(57264),p=a(82416),v=i(a(69088));function h(e){if("function"!=typeof n)return null;var t=new n,a=new n;return(h=function(e){return e?a:t})(e)}var g={willApproval:v.default.warning,willHandled:v.default.warning,approve:v.default.success,handled:v.default.success,done:v.default.success,launch:v.default.success,pass:v.default.success,terminate:v.default.reject,withdraw:v.default.reject,reject:v.default.error,exception_terminate:v.default.error},x={withdraw:"yichexiao",exception_terminate:"cuowushibai",terminate:"foujue2",approve:"tongyi",handled:"tongyi",launch:"tongyi",pass:"tongyi",done:"tongyi"},E=t.FinishItem=(0,c.memo)((function(e){var t=e.item,a=(0,s.default)(v.default.item,v.default.finish,g[t.handleState]||g.handled),l=x[t.handleState]||"right-bold";return c.default.createElement("div",{className:a},c.default.createElement("div",{className:(0,s.default)(v.default.dot,"kd-nc-flow-dot")},c.default.createElement("p",null,c.default.createElement(f.Icon,{prefix:"nocodeplatformicon",type:l}))),c.default.createElement("div",{className:v.default.info},c.default.createElement("div",{className:v.default.title,style:{marginBottom:0}},c.default.createElement("div",null,c.default.createElement("p",null,t.nodeName)),c.default.createElement("div",{className:v.default.state},t.handleStateDesc),c.default.createElement("div",null,t.message))))})),N=t.LaunchItem=(0,c.memo)((function(e){var t,a=e.item;return c.default.createElement("div",{className:(0,s.default)(v.default.item,v.default.launch)},c.default.createElement("div",{className:(0,s.default)(v.default.dot,"kd-nc-flow-dot")},c.default.createElement("p",null)),c.default.createElement("div",{className:v.default.info},c.default.createElement("div",{className:v.default.editor},c.default.createElement("div",{className:v.default.icon,style:{background:a.bg}},c.default.createElement(p.Avatar,{src:a.approverInfos[0].handlerAvatar})),c.default.createElement("div",{className:v.default.handler},c.default.createElement("div",{className:v.default.usr},c.default.createElement("p",null,(null==a||null===(t=a.approverInfos)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.handlerName)||""),c.default.createElement("span",null,a.handleTime?(0,m.dateFormat)("MM-dd hh:mm",a.handleTime):"")),c.default.createElement("div",null,(null==a?void 0:a.handleStateDesc)||"")))))})),w=t.AuditItem=(0,c.memo)((function(e){var t,a,l,n=e.item,u=e.className,d=e.curNode,i=e.config,h=n.taskId,E=n.procInstId,N=n.handleTime,w=n.handleState,_=n.nodeName,y=n.handleStateDesc,I=n.approverInfos,b=n.message,k=i.appId,C=i.targetFormId,F=i.pkId,S=(0,s.default)(v.default.item,u,g[w]||g.willHandled),T=x[w],A=(0,c.useMemo)((function(){return(null==n?void 0:n.canHandle)&&h!==d.taskId&&"willApproval"===w}),[w,d,n,h]),M=(0,c.useCallback)((function(){var e,t,a,l;(0,m.openner)((0,r.default)(e=(0,r.default)(t=(0,r.default)(a=(0,r.default)(l="/".concat(k,"/detail/")).call(l,C,"/")).call(a,F,"/view/flow/")).call(t,E,"/task/")).call(e,h))}),[k,C,F,h,E]);return c.default.createElement("div",{className:S},c.default.createElement("div",{className:(0,s.default)(v.default.dot,"kd-nc-flow-dot")},c.default.createElement("p",null)),c.default.createElement("div",{className:v.default.info},c.default.createElement("div",{className:v.default.title},c.default.createElement("div",null,c.default.createElement("p",null,_),A&&c.default.createElement(p.BtnField,{type:"text",major:!0,"data-nc-action":(0,r.default)(t="".concat(k,"|")).call(t,C,"|fu_fr_audit"),onClick:M,icon:{prefix:"nocodeplatformicon",type:"daishenpi"}},"审批")),c.default.createElement("div",{className:v.default.state},y)),"willApproval"===w?c.default.createElement("div",{className:v.default.Auditor},(0,o.default)(I).call(I,(function(e){return c.default.createElement("p",{key:e.handlerId},c.default.createElement(p.Avatar,{src:e.handlerAvatar}),c.default.createElement("span",{title:(null==e?void 0:e.handlerName)||""},(null==e?void 0:e.handlerName)||""))}))):c.default.createElement("div",{className:v.default.editor},c.default.createElement("div",{className:v.default.icon},c.default.createElement(p.Avatar,{src:(null==I||null===(a=I[0])||void 0===a?void 0:a.handlerAvatar)||""}),T&&c.default.createElement(f.Icon,{className:v.default.flag,prefix:"nocodeplatformicon",type:T})),c.default.createElement("div",{className:v.default.handler},c.default.createElement("div",{className:v.default.usr},c.default.createElement("p",null,(null==I||null===(l=I[0])||void 0===l?void 0:l.handlerName)||""),c.default.createElement("span",null,N?(0,m.dateFormat)("MM-dd hh:mm",N):"")),c.default.createElement("div",{className:v.default.des},b||"")))))})),_=t.UserInputItem=(0,c.memo)((function(e){var t,a,l,n,u=e.item,d=e.className,i=e.config,h=u.procInstId,E=u.nodeBusinessKey,N=u.nodeId,w=(u.nodeType,u.handleState),_=u.canInputOrView,y=u.approverInfos,I=i||{},b=I.appId,k=I.targetFormId,C=I.pkId,F=I.userTaskActivityId,S=I.userTaskBusinessKey,T=(0,s.default)(v.default.item,d,g[u.handleState]||g.willHandled),A=x[u.handleState],M=(0,c.useMemo)((function(){return(0,o.default)(y).call(y,(function(e){return e.handlerId})).join()}),[]),B=(0,c.useCallback)((function(e){var t,a,l,n,u,d,i,o=(0,r.default)(t=(0,r.default)(a=(0,r.default)(l=(0,r.default)(n=(0,r.default)(u=(0,r.default)(d=(0,r.default)(i="/".concat(b,"/detail/")).call(i,k,"/")).call(d,C,"/")).call(u,e,"/flow/")).call(n,h,"/")).call(l,N,"/")).call(a,E,"/")).call(t,M);(0,m.openner)(o)}),[M,b,k,C,h,N,E,S]),P=(0,c.useMemo)((function(){return!F&&!S&&_}),[F,_,S]);return c.default.createElement("div",{className:T},c.default.createElement("div",{className:(0,s.default)(v.default.dot,"kd-nc-flow-dot")},c.default.createElement("p",null)),c.default.createElement("div",{className:v.default.info},c.default.createElement("div",{className:v.default.title},c.default.createElement("div",null,c.default.createElement("p",null,u.nodeName),P?"handled"===w?c.default.createElement(p.BtnField,{type:"text",major:!0,"data-nc-action":(0,r.default)(t="".concat(b,"|")).call(t,k,"|fu_fr_check"),onClick:function(){return B("view")},icon:{prefix:"ncicon",type:"yanjing"}},"查看"):c.default.createElement(p.BtnField,{type:"text",major:!0,"data-nc-action":(0,r.default)(a="".concat(b,"|")).call(a,k,"|fu_fr_fill"),onClick:function(){return B("edit")},icon:{prefix:"nocodeplatformicon",type:"bianji"}},"录入"):null),c.default.createElement("div",{className:v.default.state},u.handleStateDesc)),"willHandled"!==u.handleState&&c.default.createElement("div",{className:v.default.editor},c.default.createElement("div",{className:v.default.icon,style:{background:u.bg}},c.default.createElement(p.Avatar,{src:null===(l=u.approverInfos)||void 0===l?void 0:l[0].handlerAvatar}),A&&c.default.createElement(f.Icon,{className:v.default.flag,prefix:"nocodeplatformicon",type:A})),c.default.createElement("div",{className:v.default.handler},c.default.createElement("div",{className:v.default.usr},c.default.createElement("p",null,(null==u||null===(n=u.approverInfos)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.handlerName)||""),c.default.createElement("span",null,u.handleTime?(0,m.dateFormat)("MM-dd hh:mm",u.handleTime):"")),c.default.createElement("div",{className:v.default.des},(null==u?void 0:u.message)||"")))))})),y=t.FlowItem=(0,c.memo)((function(e){var t=e.item,a=e.className,l=(0,s.default)(v.default.item,a,g[t.handleState]||g.willHandled),n=x[t.handleState];return c.default.createElement("div",{className:l},c.default.createElement("div",{className:(0,s.default)(v.default.dot,"kd-nc-flow-dot")},c.default.createElement("p",null)),c.default.createElement("div",{className:v.default.info},c.default.createElement("div",{className:v.default.title},c.default.createElement("div",null,c.default.createElement("p",null,t.nodeName)),c.default.createElement("div",{className:v.default.state},t.handleStateDesc)),c.default.createElement("div",{className:v.default.editor},c.default.createElement("div",{className:v.default.icon,style:{background:t.bg}},c.default.createElement(f.Icon,{prefix:"nocodeplatformicon",type:t.icon}),n&&c.default.createElement(f.Icon,{className:v.default.flag,prefix:"nocodeplatformicon",type:n})),c.default.createElement("div",{className:v.default.handler},c.default.createElement("div",{className:v.default.usr},c.default.createElement("p",null,t.handlerName||t.nodeTypeName),c.default.createElement("span",null,t.handleTime?(0,m.dateFormat)("MM-dd hh:mm",t.handleTime):"")),c.default.createElement("div",{className:v.default.des},(null==t?void 0:t.message)||"")))))}));_.displayName="UserInputItem",w.displayName="AuditItem",y.displayName="FlowItem",E.displayName="FinishItem",N.displayName="LaunchItem"},21044:function(e,t,a){var l=a(13568),n=a(93252),u=a(25028),d=a(4884);u(t,"__esModule",{value:!0}),t.default=void 0;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=c(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},i=u&&d;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=i?d(e,r):null;o&&(o.get||o.set)?u(n,r,o):n[r]=e[r]}return n.default=e,a&&a.set(e,n),n}(a(65984)),r=a(82416),o=a(28808);function c(e){if("function"!=typeof n)return null;var t=new n,a=new n;return(c=function(e){return e?a:t})(e)}var f=(0,i.lazy)((function(){return a.e(168).then(a.t.bind(a,87168,23))})),s=(0,i.memo)((function(e){var t=e.onRef,a=e.config,l=e.options,n=e.device,u=void 0===n?"pc":n;return i.default.createElement(i.Suspense,{fallback:i.default.createElement(r.Skeleton,{options:o.PopBillSkeleton})},i.default.createElement(f,{device:u,onRef:t,config:a,options:l}))}));s.displayName="NocodeEntry";t.default=s},28808:function(e,t,a){a(25028)(t,"__esModule",{value:!0}),t.PopBillSkeleton=void 0;t.PopBillSkeleton=[{width:"100%",height:"100%",flexDirection:"column",background:"#f2f9ff",child:[{width:"auto",height:"100%",margin:"12px 16px 12px 16px",type:"CONCENT",child:[{width:"auto",height:"auto",margin:"4px 12px 12px 12px",flexDirection:"column",child:[{width:"200px",height:"24px",margin:"0px",type:"INPUT"},{width:"auto",height:"auto",margin:"32px 0px 0px 0px",child:[{width:"50%",height:"auto",margin:"0px",flexDirection:"column",child:[{width:"28px",height:"16px",margin:"0px 0px 8px 0px",type:"INPUT"},{width:"100%",height:"36px",margin:"0px",type:"INPUT"},{width:"56px",height:"16px",margin:"24px 0px 0px 0px",type:"INPUT"},{width:"auto",height:"20px",margin:"16px 0px 28px 0px",child:[{width:"80px",height:"20px",margin:"0px",type:"INPUT"},{width:"56px",height:"20px",margin:"0px 0px 0px 24px",type:"INPUT"}]},{width:"96px",height:"16px",margin:"0px",type:"INPUT"},{width:"100%",height:"36px",margin:"8px 0px 0px 0px",type:"INPUT"}]},{width:"50%",height:"auto",margin:"0px 0px 0px 24px",flexDirection:"column",child:[{width:"56px",height:"16px",margin:"0px 0px 8px 0px",type:"INPUT"},{width:"100%",height:"36px",margin:"0px",type:"INPUT"},{width:"80px",height:"16px",margin:"24px 0px 0px 0px",type:"INPUT"},{width:"auto",height:"20px",margin:"16px 0px 28px 0px",child:[{width:"56px",height:"20px",margin:"0px",type:"INPUT"},{width:"160px",height:"20px",margin:"0px 0px 0px 24px",type:"INPUT"}]},{width:"120px",height:"16px",margin:"0px",type:"INPUT"},{width:"auto",height:"20px",margin:"16px 0px 0px 0px",child:[{width:"80px",height:"20px",margin:"0px",type:"INPUT"},{width:"56px",height:"20px",margin:"0px 0px 0px 24px",type:"INPUT"}]}]}]},{width:"56px",height:"16px",margin:"28px 0px 0px 0px",type:"INPUT"},{width:"100%",height:"76px",margin:"8px 0px 28px 0px",type:"INPUT"},{width:"56px",height:"16px",margin:"0px",type:"INPUT"},{width:"auto",height:"28px",margin:"8px 0px 8px 0px",child:[{width:"92px",height:"28px",margin:"0px",type:"INPUT"},{width:"72px",height:"28px",type:"INPUT"}]},{width:"100%",height:"176px",margin:"0px",type:"INPUT"},{width:"100%",height:"28px",margin:"8px 0px 0px 0px",justifyContent:"flex-end",child:[{width:"280px",height:"28px",margin:"0px",type:"INPUT"}]}]}]}]}]},84856:function(e,t,a){var l=a(13568),n=a(13939),u=a(34716),d=a(70696),i=a(4884),r=a(3464),o=a(51400),c=a(25028),f=a(93252),s=a(9564);c(t,"__esModule",{value:!0}),t.default=void 0;var m=s(a(23992)),p=s(a(38456)),v=s(a(96631)),h=s(a(78912)),g=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=_(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},u=c&&i;for(var d in e)if("default"!==d&&Object.prototype.hasOwnProperty.call(e,d)){var r=u?i(e,d):null;r&&(r.get||r.set)?c(n,d,r):n[d]=e[d]}return n.default=e,a&&a.set(e,n),n}(a(65984)),x=a(63548),E=a(82416),N=a(98464),w=a(57264);function _(e){if("function"!=typeof f)return null;var t=new f,a=new f;return(_=function(e){return e?a:t})(e)}function y(e,t){var a=n(e);if(u){var l=u(e);t&&(l=d(l).call(l,(function(t){return i(e,t).enumerable}))),a.push.apply(a,l)}return a}function I(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(Object(a),!0).forEach((function(t){(0,v.default)(e,t,a[t])})):r?o(e,r(a)):y(Object(a)).forEach((function(t){c(e,t,i(a,t))}))}return e}var b=function(e){var t=e.tips,a=e.placement,l=e.children;return t?g.default.createElement(x.Tooltip,{tip:t,placement:a},l):l},k=(0,g.memo)((function(e){var t=e.pkId,a=e.formId,l=e.appId,n=e.bosApi,u=e.className,d=(0,g.useState)([]),i=(0,h.default)(d,2),r=i[0],o=i[1],c=(0,g.useState)([]),f=(0,h.default)(c,2),s=f[0],v=f[1],_=(0,g.useRef)(null),y=(0,g.useRef)(!1),k=(0,g.useState)(!1),C=(0,h.default)(k,2),F=C[0],S=C[1];(0,g.useEffect)((function(){if(n){var e=270;v((0,m.default)(r).call(r,(function(t,a){var l=null==n?void 0:n.getControlText(t.text),u=l.length;return e>=0&&(e-=u>4?90+14*(u-4):90),a===r.length-1&&u<=2&&e<0&&(e+=90),e<0&&(y.current=!0),I(I({},t),{},{text:l,isMoreBtn:0===e&&a<r.length-1||e<0})})))}}),[r,n]),(0,g.useEffect)((function(){t&&(0,N.getBizButtonList)({appId:l,formId:a,pkId:t}).then((function(e){var t=e.rows;Array.isArray(t)&&o(t)})).catch((function(e){}))}),[t]);var T=(0,g.useCallback)((function(e){n.invokeHandle("click",e,[],[],A)}),[n]),A=function(){S(!1)},M=(0,g.useCallback)((function(e){var t=e.SecondConfirm,a=e.opk,l=e.text;S(!0),t?(0,w.showConfirmModal)({title:"确定对记录执行".concat(l,"操作吗？"),actions:[{text:"取消",key:"cancel"},{text:"确定",key:"confirm"}],onAction:function(e){"confirm"===e?T(a):S(!1)},type:"prompt"}):T(a)}),[T]),B=g.default.createElement(x.Dropdown.Menu,{onClick:function(e){var t=(0,p.default)(s).call(s,(function(t){return t.opk===e}));t&&M(t)}},(0,m.default)(s).call(s,(function(e,t){return e.isMoreBtn?g.default.createElement(x.Dropdown.Item,{disabled:F,key:e.opk},g.default.createElement(b,{tips:null==e?void 0:e.HelpTips,placement:"right"},e.text)):null})));return null!=s&&s.length?g.default.createElement("div",{ref:_,className:u},(0,m.default)(s).call(s,(function(e,t){return e.isMoreBtn?null:g.default.createElement(b,{key:e.opk,tips:null==e?void 0:e.HelpTips},g.default.createElement(E.BtnField,{disabled:F,onClick:function(){M(e)}},e.text))})),y.current&&g.default.createElement(x.Dropdown,{menu:B,trigger:"click"},g.default.createElement(E.BtnField,null,"更多"))):null}));k.displayName="BizButtonList";t.default=k},49148:function(e,t,a){var l=a(13568),n=a(13939),u=a(34716),d=a(70696),i=a(4884),r=a(3464),o=a(51400),c=a(25028),f=a(93252),s=a(9564);c(t,"__esModule",{value:!0}),t.default=void 0;var m=s(a(52892)),p=s(a(38456)),v=s(a(25288)),h=s(a(50524)),g=s(a(760)),x=s(a(23992)),E=s(a(96631)),N=s(a(78912)),w=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=M(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},u=c&&i;for(var d in e)if("default"!==d&&Object.prototype.hasOwnProperty.call(e,d)){var r=u?i(e,d):null;r&&(r.get||r.set)?c(n,d,r):n[d]=e[d]}return n.default=e,a&&a.set(e,n),n}(a(65984)),_=a(16428),y=a(82416),I=a(57264),b=a(48552),k=s(a(89244)),C=a(98464),F=a(34964),S=a(63548),T=s(a(71252)),A=a(78016);function M(e){if("function"!=typeof f)return null;var t=new f,a=new f;return(M=function(e){return e?a:t})(e)}function B(e,t){var a=n(e);if(u){var l=u(e);t&&(l=d(l).call(l,(function(t){return i(e,t).enumerable}))),a.push.apply(a,l)}return a}var P={NoCodeWfNodeUserInput:b.UserInputItem,NoCodeWfNodeEnd:b.FinishItem,NoCodeWfNodeStart:b.LaunchItem,NoCodeWfNodeAudit:b.AuditItem},j=(0,w.memo)((function(e){var t,a,l,n=e.taskId,u=e.data,d=e.config,f=void 0===d?{}:d,s=e.onSubmit,M=e.setFormLock,j=f.procInstId,U=f.appId,O=f.targetFormId,L=(0,w.useState)([]),D=(0,N.default)(L,2),H=D[0],z=D[1],R=(0,w.useState)([]),W=(0,N.default)(R,2),K=W[0],J=W[1],Y=(0,w.useState)([]),q=(0,N.default)(Y,2),X=q[0],Q=q[1],V=(0,w.useState)(""),G=(0,N.default)(V,2),Z=G[0],$=G[1],ee=(0,w.useState)(""),te=(0,N.default)(ee,2),ae=te[0],le=te[1],ne=(0,w.useState)(!1),ue=(0,N.default)(ne,2),de=ue[0],ie=ue[1],re=(0,w.useRef)(new m.default),oe=(0,w.useState)(!1),ce=(0,N.default)(oe,2),fe=ce[0],se=ce[1],me=(null===(t=re.current)||void 0===t?void 0:t.get(Z))||{},pe=me.approvalInfo,ve=void 0===pe?[]:pe,he=me.canWithdraw;(0,w.useEffect)((function(){j&&$(j)}),[j]);var ge=(0,w.useMemo)((function(){return(n&&ve?(0,p.default)(ve).call(ve,(function(e){return e.taskId===n})):{})||{}}),[n,ve]),xe=(0,w.useCallback)((function(e){return(0,v.default)(e).call(e)?(se(!1),!0):(se(!0),!1)}),[se]),Ee=(0,w.useCallback)((function(e){le(e)}),[le,xe]),Ne=(0,w.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(arguments.length>2&&void 0!==arguments[2]&&arguments[2])){var a,l=(null===(a=re.current)||void 0===a?void 0:a.get(Z)).notifyMsgMustInput;if(null!=l&&(0,h.default)(l).call(l,e.toLowerCase())&&!xe(ae))return}(0,C.taskApply)(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?B(Object(a),!0).forEach((function(t){(0,E.default)(e,t,a[t])})):r?o(e,r(a)):B(Object(a)).forEach((function(t){c(e,t,i(a,t))}))}return e}({action:e,taskId:null==ge?void 0:ge.taskId,message:ae},t)).then((function(){(0,I.showNotice)("success","审批意见提交成功"),null==s||s()})).catch((function(e){return(0,I.showNotice)("error","审批意见提交审批失败，".concat(e.message))}))}),[Z,ae,ge,s,xe]),we=(0,w.useCallback)((function(){Ne(F.FLOW_ACTION_TYPES.reject,{nextNodeId:X}),ie(!1)}),[X,Ne]),_e=(0,w.useCallback)((function(){var e=ge.disAllowNodeList,t=(0,x.default)(e).call(e,(function(e){return{label:e.name,value:e.nodeId}}));(0,_.unstable_batchedUpdates)((function(){Q(t[0].value),J(t),ie(!0)}))}),[ge]),ye=(0,w.useCallback)((function(){(0,C.taskCancel)({procInstId:Z}).then((function(){(0,I.showNotice)("success","撤回提交成功"),null==s||s()})).catch((function(e){return(0,I.showNotice)("error","".concat(e.message))}))}),[Z,s]),Ie=(0,w.useCallback)((function(){var e,t;if(window.isIE){(0,I.showConfirm)("该功能暂不支持IE浏览器，\n请尝试使用其他浏览器（推荐Chrome）。","",4)}else{var a=(null===(e=re.current)||void 0===e?void 0:e.get(Z))||{},l=a.procInstId,n=a.businessKey;(0,I.openner)((0,g.default)(t="/flow/".concat(l,"/")).call(t,n))}}),[Z]);(0,w.useEffect)((function(){var e,t=[];null==u||u.forEach((function(e){re.current.set(e.procInstId,e),t.push({label:e.processName||"流程",value:e.procInstId})}));var a=j||(null===(e=t[0])||void 0===e?void 0:e.value);(0,_.unstable_batchedUpdates)((function(){var e;j||$(a),null==M||M("1"===(null===(e=re.current.get(a))||void 0===e?void 0:e.lockStatus)),z(t)}))}),[u,j,M]);var be=(0,w.useMemo)((function(){return(null==ge?void 0:ge.canHandle)&&(null==ge?void 0:ge.taskId)&&"willApproval"===(null==ge?void 0:ge.handleState)}),[ge]),ke=(0,w.useCallback)((function(e){$(e),(0,A.publishClickUserEvent)({appId:U,formId:O,action:"fu_fr_open"})}),[$]);return w.default.createElement(w.default.Fragment,null,w.default.createElement("div",{className:(0,T.default)(k.default.apply,"kd-nc-flow-list")},w.default.createElement("div",{className:k.default.nav},w.default.createElement("div",{className:k.default.title},"流程记录"),w.default.createElement("div",null,w.default.createElement(y.BtnField,{major:!0,"data-nc-action":(0,g.default)(a="".concat(U,"|")).call(a,O,"|fu_fr_fc"),type:"text",onClick:Ie,disabled:!H.length},"流程图"))),H.length>1&&w.default.createElement("div",{className:k.default.mb},w.default.createElement(y.Select,{value:Z,onChange:ke,options:H})),be&&w.default.createElement("div",null,w.default.createElement("div",{className:k.default.node_name},(null==ge?void 0:ge.nodeName)||""),w.default.createElement(y.Textarea,{value:ae,placeholder:"请输入审批意见",onChange:Ee,maxLength:245,showCount:!0,autoSize:{minRows:3,maxRows:3}}),fe&&w.default.createElement("div",{className:k.default.err},"审批意见为必填项")),w.default.createElement("div",{className:k.default.btns},w.default.createElement(w.default.Fragment,null,be&&w.default.createElement(w.default.Fragment,null,null===(l=ge.decisionOptions)||void 0===l?void 0:(0,x.default)(l).call(l,(function(e,t){var a=e.number,l=e.name;return w.default.createElement(y.BtnField,{key:a,size:"small",type:0===t&&"primary",onClick:function(){return function(e){var t=e||{},a=t.number;t.name,(!t.auditMessageMustInput||xe(ae))&&a&&Ne(a,{},!0)}(e)}},l)})),ge.canDisallow&&w.default.createElement(y.BtnField,{size:"small",onClick:_e},"驳回")),he&&w.default.createElement(y.BtnField,{size:"small",onClick:ye},"撤回"))),w.default.createElement("div",{className:k.default.list},(0,x.default)(ve).call(ve,(function(e,t){var a=P[e.nodeType]||b.FlowItem;return w.default.createElement(a,{key:e.id,curNode:ge,config:f,className:t===ve.length-2?k.default.node:"",item:e})})))),w.default.createElement(S.Modal,{className:k.default.confirm,title:"驳回",showline:!0,visible:de,onCancel:function(){return ie(!1)},destroyOnClose:!0,height:208,width:480,body:w.default.createElement("div",{className:k.default.body},"驳回至",w.default.createElement(y.Select,{placeholder:"请选择",value:X,onChange:Q,options:K})),footer:w.default.createElement("div",{className:k.default.footer},w.default.createElement(y.BtnField,{size:"small",onClick:function(){return ie(!1)}},"取消"),w.default.createElement(y.BtnField,{type:"primary",onClick:we,size:"small"},"确认"))}))}));j.displayName="FlowListLayout";t.default=j},64004:function(e,t,a){var l=a(13568),n=a(93252),u=a(25028),d=a(4884),i=a(9564);u(t,"__esModule",{value:!0}),t.default=void 0;var r=i(a(760)),o=i(a(78912)),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=l(e)&&"function"!=typeof e)return{default:e};var a=x(t);if(a&&a.has(e))return a.get(e);var n={__proto__:null},i=u&&d;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=i?d(e,r):null;o&&(o.get||o.set)?u(n,r,o):n[r]=e[r]}return n.default=e,a&&a.set(e,n),n}(a(65984)),f=a(82416),s=a(57264),m=i(a(84856)),p=a(78016),v=i(a(28996)),h=i(a(75020)),g=a(66028);function x(e){if("function"!=typeof n)return null;var t=new n,a=new n;return(x=function(e){return e?a:t})(e)}var E={save:!1,saveAndNew:!1,copy:!1,delete:!1,edit:!1},N=(0,c.memo)((function(e){var t=e.status,a=e.disabled,l=void 0!==a&&a,n=e.disabledCb,u=e.bosApi,d=e.authList,i=e.config,x=e.origin,N=e.isSharePage,w=e.inputAuthFixed,_=void 0!==w&&w,y=e.formLock,I=e.newPkId,b=e.extraButton,k=(e.setStatus,e.copyCallback),C=e.delCallback,F=e.saveCallback,S=d||{},T=S.deleteAuth,A=S.inputAuth,M=S.editAuth,B=S.viewAuth,P=i||{},j=P.appId,U=(P.pkId,P.targetFormId),O=(P.procInstId,(0,c.useRef)(null)),L=(0,c.useReducer)(g.assignDataReducer,E),D=(0,o.default)(L,2),H=D[0],z=D[1],R=(0,c.useCallback)((function(e){var t,a;return(0,r.default)(t=(0,r.default)(a="".concat(j,"|")).call(a,U,"|")).call(t,e)}),[j,U]),W=(0,c.useCallback)((function(e){var t,a,l=(0,s.getBosActions)(e.data)||{};return{isSuccess:0===(null==l||null===(t=l.ShowNotificationMsg)||void 0===t?void 0:t[0].type),formStatus:null==l||null===(a=l.setFormStatus)||void 0===a?void 0:a[0],actions:l}}),[]),K=(0,c.useCallback)((function(){if(l)return null==n?void 0:n();"view"!==t&&(z({save:!0}),u.invokeHandle("click","btnsave",[],[],(function(e,t){if("1001"===e.errorCode)return(0,s.showNotice)("warnning","表单加载中，请稍候"),void z({save:!1});var a=W(e),l=a.isSuccess,n=a.actions;l&&F(n,!1,t),z({save:!1})})))}),[t,u,F,l,n,H.save]),J=(0,c.useCallback)((function(){if(l)return null==n?void 0:n();if("addNew"===t){var e=O.current.checked?"btnsaveandcopy":"btnsaveandnew";z({saveAndNew:!0}),u.invokeHandle("click",e,[],[],(function(e,t){if(z({saveAndNew:!1}),"1001"!==e.errorCode){var a=W(e),l=a.isSuccess,n=a.actions;l&&F(n,!0,t)}else(0,s.showNotice)("warnning","表单加载中，请稍候")}))}}),[t,u,l,n,H.saveAndNew]),Y=(0,c.useCallback)((function(){if(l)return null==n?void 0:n();(0,s.showDeleteConfirmModal)({title:"",message:"确定删除该记录吗？",detail:"",onOk:function(){(0,p.publishUserEvent)({appId:j,formId:U,action:"au_fo_del_comf"}),z({delete:!0}),u.invokeHandle("click","btndel",[],[],(function(e){z({delete:!1}),"1001"!==e.errorCode?W(e).isSuccess&&(null==C||C()):(0,s.showNotice)("warnning","表单加载中，请稍候")}))},onCancel:function(){}})}),[j,U,u,l,n,H.delete]),q=(0,c.useCallback)((function(){if(l)return null==n?void 0:n();"view"===t&&(z({edit:!0}),u.invokeHandle("click","btnedit",[],[],(function(e){if(z({edit:!1}),"1001"===e.errorCode)return(0,s.showNotice)("warnning","表单加载中，请稍候"),!1})))}),[t,u,l,n,H.edit]),X=(0,c.useCallback)((function(){if(l)return null==n?void 0:n();"view"===t&&(z({copy:!0}),u.invokeHandle("click","btncopy",[],[],(function(e,t){var a;z({copy:!1}),"1001"!==e.errorCode?0===(null===(a=W(e))||void 0===a?void 0:a.formStatus)&&(null==k||k()):(0,s.showNotice)("warnning","表单加载中，请稍候")})))}),[t,W,k,u,l,n,H.copy]),Q=(0,h.default)(X),V=(0,h.default)(q),G=(0,h.default)(Y),Z=(0,h.default)(J),$=(0,h.default)(K),ee=(0,c.useMemo)((function(){return"cosmic"!==x&&B?c.default.createElement(c.default.Fragment,null,b&&b(),c.default.createElement("div",{className:v.default.btns},c.default.createElement(m.default,{className:v.default.bizbtns,bosApi:u,appId:j,formId:U,pkId:I}),!y&&T&&c.default.createElement(f.BtnField,{disabled:!u,"data-nc-action":R("fu_fo_del"),loading:H.delete,onClick:G},"删除"),!_&&A&&c.default.createElement(f.BtnField,{disabled:!u,"data-nc-action":R("fu_fo_copy"),loading:H.copy,onClick:Q},"复制"),!y&&M&&c.default.createElement(f.BtnField,{disabled:!u,"data-nc-action":R("fu_fo_edit"),type:"primary",loading:H.edit,onClick:V},"编辑"))):null}),[B,T,A,M,j,U,y,I,u,G,Q,V,R,H.copy,H.delete,H.edit]),te=(0,c.useMemo)((function(){return M?c.default.createElement(c.default.Fragment,null,c.default.createElement("div",null),c.default.createElement("div",{className:v.default.btns},c.default.createElement(f.BtnField,{disabled:!u,type:"primary",loading:H.save,onClick:$},"保存"))):null}),[$,u,M,H.save]),ae=(0,c.useMemo)((function(){var e;return A?c.default.createElement(c.default.Fragment,null,c.default.createElement("div",null,c.default.createElement(f.Checkbox,{ref:O,"data-nc-action":(0,r.default)(e="".concat(j,"|")).call(e,U,"|fu_fo_kc"),className:v.default.footer_main_tips},"继续录入时，保留本次提交内容")),c.default.createElement("div",{className:v.default.btns},c.default.createElement(f.BtnField,{disabled:!u,loading:H.saveAndNew,onClick:Z},"提交并新增"),c.default.createElement(f.BtnField,{disabled:!u,type:"primary",loading:H.save,onClick:$},"提交"))):null}),[Z,$,u,A,j,U,H.saveAndNew,H.save]),le=(0,c.useMemo)((function(){return"addNew"===t?c.default.createElement("div",{className:v.default.btns},c.default.createElement(f.BtnField,{type:"primary",disabled:!u,loading:H.save,onClick:$},"提交")):"edit"===t?te:"view"===t?ee:null}),[t,$,u,H.save,te,ee]),ne=(0,c.useMemo)((function(){return{view:ee,edit:te,addNew:ae}[t||"addNew"]}),[t,ee,te,ae]);return c.default.createElement("div",{className:v.default.form_footer},c.default.createElement("div",{className:v.default.form_footer_main},N?le:ne))}));N.displayName="FormDetailFooterLayout";t.default=N}}]);