"use strict";(self.webpackChunknocode_platform=self.webpackChunknocode_platform||[]).push([[599],{21980:function(e,t,n){var r=n(13568),a=n(13939),o=n(34716),l=n(70696),u=n(4884),i=n(3464),c=n(51400),s=n(25028),f=n(93252),d=n(9564);s(t,"__esModule",{value:!0}),t.default=t.SELECT_ACTIONS=void 0;var p=d(n(23992)),g=d(n(760)),v=d(n(70696)),C=d(n(50524)),m=d(n(38456)),h=d(n(29052)),I=d(n(96631)),S=d(n(94924)),b=d(n(78912)),F=n(65984),k=n(69400),w=n(71120),y=n(57264),D=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=r(e)&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var a={__proto__:null},o=s&&u;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var i=o?u(e,l):null;i&&(i.get||i.set)?s(a,l,i):a[l]=e[l]}return a.default=e,n&&n.set(e,a),a}(n(20948)),x=n(82416),N=d(n(40436)),E=n(78016),L=n(55867),P=n(67112);function _(e){if("function"!=typeof f)return null;var t=new f,n=new f;return(_=function(e){return e?n:t})(e)}function H(e,t){var n=a(e);if(o){var r=o(e);t&&(r=l(r).call(r,(function(t){return u(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){(0,I.default)(e,t,n[t])})):i?c(e,i(n)):H(Object(n)).forEach((function(t){s(e,t,u(n,t))}))}return e}var K="数据加载中...",T=t.SELECT_ACTIONS={check_all:"check-all",uncheck_all:"uncheck-all",check:"check",uncheck:"uncheck"};t.default=function(e,t,n){var r=(0,N.default)().state,a=void 0===r?{}:r,o=a.compareTypes,l=a.defaultAdminFormId,u=a.defaultAppsFormId,i=e.appId,c=e.formId,s=e.env,f=e.viewAuth,d=void 0===f||f,_=e.pending,H=void 0!==_&&_,B=e.setPending,M=t.needSerial,z=void 0!==M&&M,O=t.loadMore,V=void 0!==O&&O,R=t.loadData,W=void 0===R||R,j=t.updateFooter,U=void 0!==j&&j,q=t.isMob,Q=void 0!==q&&q,G=t.horizontal,J=void 0!==G&&G,X=t.operateCol,Y=t.columnsDataTranform,Z=void 0===Y?k.columnsDataTranform:Y,$=n.sendFooterDataSource,ee=n.getColHeadFilterConfig,te=n.getColHeadFilters,ne=n.getInitFormDataList,re=n.loadFormListWithParams,ae=n.onSaveFormListSetting,oe=n.getEnumFilterValue,le=n.getStatInfo,ue=n.getUpdateFooterDataSource,ie=n.getNewFilters,ce=n.onDeleteFormDataListItem,se=n.onSavePageSize,fe=n.getOrderBy,de=n.getFormDataListSetting,pe=(0,D.default)(),ge=(0,b.default)(pe,2),ve=ge[0],Ce=ge[1],me=ve.dataSource,he=ve.footerDataSource,Ie=ve.pageNo,Se=ve.pageSize,be=ve.totalCount,Fe=ve.listItemConfig,ke=ve.listFilterConfig,we=ve.configuredFilterItems,ye=(ve.bizButtons,ve.listFilters),De=ve.searchKeywords,xe=ve.orderBy,Ne=ve.orderInfo,Ee=ve.colHeadFilter,Le=ve.enumFilterValue,Pe=ve.stateInfo,_e=ve.schemaId,He=ve.selectedIds,Ae=ve.selectStatus,Ke=ve.notInSelectedIds,Te=ve.selectedCount,Be=s===w.ENV_APP?u:s===w.ENV_ADMIN?l:"",Me=(0,F.useMemo)((function(){return{appId:i,formId:c,env:s,listItemConfig:Fe,listFilters:ye,pageNo:Ie,pageSize:Se,searchKeywords:De,updateFooter:!0,orderBy:xe,orderInfo:Ne,viewAuth:d,schemaId:_e}}),[i,c,s,Fe,ye,Ie,Se,De,xe,Ne,d,_e]),ze=(0,F.useCallback)(function(){var e=(0,S.default)(h.default.mark((function e(t,n,r){var a;return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!U){e.next=6;break}return e.next=3,null==ue?void 0:ue(i,c,s,Ie,Se,n,r,Fe,he);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=he;case 7:a=e.t0,Ce(A(A({},t),{},{footerDataSource:a}));case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),[i,c,s,Ie,Se,Fe,he,U,Ce]),Oe=(0,F.useCallback)((function(e){var t=e.status,n=void 0===t?Ae:t,r=e.info||{},a=r.newDataSource,o=void 0===a?me:a,l=r.newNotInIds,u=void 0===l?Ke:l,i=r.newSelectedIds,c=void 0===i?He:i;switch(n){case D.CHECK:return c;case D.CHECK_ALL:return(0,p.default)(o).call(o,(function(e){return e.id}));case D.CHECK_CANCEL:return(0,k.getSelectedIdByInfo)(o,u);default:return[]}}),[me,Ke,Ae,He]),Ve=(0,F.useCallback)((function(e){var t=e.config,n=e.noPreData,r=void 0!==n&&n,a=e.callback,o=e.updateFooter,l=e.clearSelectInfo,u=void 0!==l&&l,i=o?ze:Ce,c=t.listFilters,s=t.searchKeywords,f=u?P.initSelectInfo:{},d=r?[]:me;return function(){var e=(0,S.default)(h.default.mark((function e(n){var r;return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(t);case 2:(r=e.sent)?(i(V?A(A({},r),{},{dataSource:(0,g.default)(d).call(d,r.dataSource)},f):A(A({},r),f),c,s),null==a||a(r)):i(A({dataSource:[],footerDataSource:[],lastPage:!1},f),c,s);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),[Ce,ze,V,me]),Re=(0,F.useCallback)((function(e){var t=e.config,n=e.noPreData,r=void 0!==n&&n,a=e.callback,o=e.clearSelectInfo;return Ve({config:t,noPreData:r,callback:a,updateFooter:!0,clearSelectInfo:void 0!==o&&o})}),[Ve]),We=(0,F.useCallback)((function(e){var t=Z(e,{primaryKey:"number",isMob:Q,needSerial:z,horizontal:J,operateCol:X},i,c);return{columns:t,visibleColumnKeys:(0,k.getVisibleColumnKeys)(t)}}),[Q,z,J,X,i,c,Z]),je=(0,F.useCallback)((function(e){var t=(0,y.showLoadingMessage)(K);return function(){var n=(0,S.default)(h.default.mark((function n(r){var a,o,l,u,i,c;return h.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return null==B||B(!0),n.next=3,r(e);case 3:if(!(a=n.sent)){n.next=13;break}return o=(0,k.getColHeadFilterByConfigured)(a.configuredFilterItems),l=We(a.listItemConfig),u=l.columns,i=l.visibleColumnKeys,c=A(A({},a),{},{colHeadFilters:o,columns:u,visibleColumnKeys:i,schemaId:e.schemaId||""}),Ce(c),t(),n.abrupt("return",c);case 13:return Ce({dataSource:[],footerDataSource:[],lastPage:!0}),t(),n.abrupt("return",{});case 16:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}),[Ce,We,B]),Ue=(0,F.useCallback)((function(e){null===x.WebMsg||void 0===x.WebMsg||x.WebMsg.showNotificationMsg({pageId:"",param:[{type:"success",content:"筛选出".concat(e,"条记录。")}]})}),[x.WebMsg]),qe=function(e,t,n,r,a){return je({appId:e,formId:t,schemaId:a,env:n,viewAuth:r,compareTypes:o,searchKeywords:De})(ne)},Qe=(0,F.useCallback)((function(e){Re({config:A(A({},Me),{},{pageNo:e})})(re)}),[Re,Me]),Ge=(0,F.useCallback)((function(e){Ce({dataSource:e})}),[Ce]),Je=(0,F.useCallback)(function(){var e=(0,S.default)(h.default.mark((function e(t,n,r){var a,o;return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=he[0][t],!(0,k.isSameField)(a,n)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,$(i,c,s,t,n,r);case 5:o=(0,k.prevHandFooterDataSource)(t,n,r,he),Ce({footerDataSource:o});case 7:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),[i,c,s,he,Ce]),Xe=(0,F.useCallback)(function(){var e=(0,S.default)(h.default.mark((function e(t){return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==le?void 0:le({appId:i,formId:c,env:s,fieldName:t,listFilters:ye,pageSize:Se,pageNo:Ie,searchKeywords:De,schemaId:_e});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[i,c,s,ye,Se,Ie,De,_e]),Ye=(0,F.useCallback)(function(){var e=(0,S.default)(h.default.mark((function e(t){var n;return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xe(t);case 2:n=e.sent,Ce({stateInfo:n});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Xe,Pe,Ce]),Ze=(0,F.useCallback)(function(){var e=(0,S.default)(h.default.mark((function e(t){var n,r,a;return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,k.getEffectiveFilterItems)(t),r=(0,k.getColHeadFilterByConfigured)(n),e.next=4,null==ie?void 0:ie(i,c,s,n);case 4:a=e.sent,Ce({colHeadFilters:r,listFilters:a,configuredFilterItems:n,showFilterSettingPop:!1}),Re({config:A(A({},Me),{},{pageNo:1,colHeadFilters:r,listFilters:a,configuredFilterItems:n,showFilterSettingPop:!1}),noPreData:!0,callback:function(e){null==Ue||Ue(null==e?void 0:e.totalCount)},clearSelectInfo:!0})(re);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Me,Re,i,c,s,Ce]),$e=(0,F.useCallback)(function(){var e=(0,S.default)(h.default.mark((function e(t,n){var r,a,o,l;return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,k.getOtherFieldsFilters)(n,we,ke),a=(0,k.mergeFilterItems)(r,t),a=(0,k.getEffectiveFilterItems)(a),o=(0,k.getColHeadFilterByConfigured)(a),e.next=6,null==te?void 0:te(i,c,s,a,n);case 6:l=e.sent,Ce({colHeadFilters:o,listFilters:l,configuredFilterItems:a}),Re({config:A(A({},Me),{},{pageNo:1,colHeadFilters:o,listFilters:l,configuredFilterItems:a}),callback:function(e){null==Ue||Ue(null==e?void 0:e.totalCount)},clearSelectInfo:!0})(re);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[Me,Re,Ue,Ce,we,ke]),et=(0,F.useCallback)((function(e){var t=V?(0,g.default)(me).call(me,e.dataSource||[]):e.dataSource,n=Oe({info:{newDataSource:t}});Ce({selectedIds:n})}),[Oe,V,me]),tt=(0,F.useCallback)((function(e,t){Re({config:A(A({},Me),{},{pageSize:t||Se,pageNo:e}),callback:et})(re),t&&(null==se||se(i,c,s,t))}),[Me,Re,se,s,et,Se]),nt=(0,F.useCallback)((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Array.isArray(t)?t:[t],a=be-r.length;if(Ae===D.CHECK_CANCEL){var o=(0,k.filterAndCount)(r,Ke),l=(0,b.default)(o,2),u=l[0],i=0===l[1]?Te-r.length:Te,c=Oe({info:{newDataSource:e,newNotInIds:u}});Ce({selectedIds:c,notInSelectedIds:u,selectedCount:(0,k.getResonableCount)(i),totalCount:a})}else{var s=(0,k.filterAndCount)(r,He),f=(0,b.default)(s,2),d=f[0],p=f[1],g=n?Te-p:Te-r.length;Ce({selectedIds:d,selectedCount:(0,k.getResonableCount)(g),totalCount:a})}}),[Ke,He,Te,Ae,Oe,be]),rt=(0,F.useCallback)((function(e,t){return function(n){nt(n.dataSource,e,t)}}),[nt]),at=(0,F.useCallback)((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a=Array.isArray(e)?e:[e],o=a.length,l=((0,k.calTotalPage)(Se,be),be-o),u=(0,k.calTotalPage)(Se,l),i=r||rt(a,n);return Ce({dataSource:t}),o>=me.length?Re({config:A(A({},Me),{},{pageNo:u>=Ie?Ie:u}),callback:i})(re):Re({config:Me,callback:i})(re)}),[Me,Re,Se,Ie,be,me,rt]),ot=(0,F.useCallback)((function(){return Re({config:Me})(re)}),[Me,Re]),lt=(0,F.useCallback)((function(){var e=be+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1),t=(0,k.calTotalPage)(Se,e);Re({config:A(A({},Me),{},{pageNo:t}),clearSelectInfo:!0})(re)}),[Me,Re]),ut=(0,F.useCallback)(function(){var e=(0,S.default)(h.default.mark((function e(t,n){var r,a;return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,E.publishUserEvent)({appId:i,formId:c,action:"au_lo_del_comf"}),e.prev=1,e.next=4,ce(i,c,t);case 4:r=e.sent,a=(0,v.default)(me).call(me,(function(e){return e.id!==t})),at(t,a,!0),null==n||n(r),(0,y.showNotice)("success","删除成功"),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),(0,y.showNotice)("error",e.t0.message);case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t,n){return e.apply(this,arguments)}}(),[i,c,me,at,ce]),it=(0,F.useCallback)((function(e,t){(0,E.publishUserEvent)({appId:i,formId:c,action:"au_lo_del"}),(0,y.showDeleteConfirmModal)({title:"",message:"确定删除该记录吗？",detail:"",onOk:function(){return ut(e,t)},onCancel:function(){}})}),[i,c,ut]),ct=(0,F.useCallback)((function(){return(0,k.getSelectedSQL)({status:Ae,selectedIds:He,notInIds:Ke,filter:null==ye?void 0:ye[0]})}),[Ae,He,Ke,ye]),st=(0,F.useCallback)((function(){Ce({selectedIds:arguments.length>0&&void 0!==arguments[0]?arguments[0]:He,selectStatus:arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ae,notInSelectedIds:arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ke,selectedCount:arguments.length>3&&void 0!==arguments[3]?arguments[3]:Te})}),[Ae,He,Ke,Te]),ft=(0,F.useCallback)((0,S.default)(h.default.mark((function e(){var t,n,r,a,o,l,u,f,d,g,m,I,S,b,F,w,D,x;return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,y.showLoadingMessage)(K),e.prev=1,e.next=4,de({schemaId:_e});case 4:if(n=e.sent,a=(r=n||{}).listFilterConfig,o=void 0===a?[]:a,l=r.listItemConfig,u=void 0===l?[]:l,f=r.listTreeConfig,d=void 0===f?[]:f,g=(0,p.default)(o).call(o,(function(e){return e.fieldName})),m=(0,v.default)(we).call(we,(function(e){return(0,C.default)(g).call(g,e.fieldName)})),I={},m.length===we.length){e.next=15;break}return S=(0,k.getColHeadFilterByConfigured)(m),e.next=13,null==ie?void 0:ie(i,c,s,m);case 13:b=e.sent,I={colHeadFilters:S,configuredFilterItems:m,listFilters:b};case 15:if(F=(0,p.default)(u).call(u,(function(e){return e.number})),w=(0,v.default)(Ne).call(Ne,(function(e){return(0,C.default)(F).call(F,e.number)})),D={},w.length===Ne.length){e.next=23;break}return e.next=21,fe(i,c,s,Ne);case 21:x=e.sent,D={orderBy:x,orderInfo:w};case 23:return Ce(A(A({listFilterConfig:o,listItemConfig:u,listTreeConfig:d},I),D)),delete D.orderInfo,e.next=27,Re({config:A(A(A({},Me),I),D),noPreData:!0})(re);case 27:t(),e.next=33;break;case 30:e.prev=30,e.t0=e.catch(1),t({type:"error",content:(null===e.t0||void 0===e.t0?void 0:e.t0.message)||"刷新失败"});case 33:case"end":return e.stop()}}),e,null,[[1,30]])}))),[i,c,s,we,Ne]),dt=(0,F.useCallback)((function(e){if(e){var t=(0,k.getDelData)(e),n={selectStatus:D.CHECK,selectedIds:t,notInSelectedIds:[],selectedCount:t.length};Ce(n)}}),[]),pt=(0,F.useCallback)((function(){var e={filter:ct(),queryFilter:(null==ye?void 0:ye[0])||""};return(0,L.onDeleteItemsWithFilter)(i,c,_e,De,e,xe).then((function(e){var t=e.successCount,n=e.result,r=be-t,a=(0,k.getDelData)(n,!1);if(V){var o=(0,k.filterData)(a,me);Ce({selectedIds:[],notInSelectedIds:[],selectStatus:D.CHECK,selectedCount:0,dataSource:o,totalCount:r})}else at(a,(0,k.filterData)(a,me)),Ce(A({},P.initSelectInfo));return e})).catch((function(e){var t,n=(e.data||{}).result,r=(0,k.getDelData)(n,!1);return V?(dt(n),t=Re({config:A(A({},Me),{},{pageNo:1}),noPreData:!0})(re)):t=at(r,(0,k.filterData)(r,me),!1),t.then((function(t){throw dt(n),e}))}))}),[i,c,De,me,at,V,be,xe,ye,_e]),gt=(0,F.useCallback)((function(e,t,n){var r,a={};Fe.forEach((function(e){a[e.number]=e}));var o=null==n?void 0:(0,p.default)(n).call(n,(function(t){return A(A({},a[t.key]),{},{display:!!(0,m.default)(e).call(e,(function(e){return e===t.key}))})}));void 0!==t&&(null==o||o.forEach((function(e,n){e.locked=n<=t})));var l=null==o?void 0:(0,p.default)(r=(0,v.default)(o).call(o,(function(e){return e.locked}))).call(r,(function(e){return e.number}));Ce({showListSettingPop:!1,listItemConfig:o||Fe}),null==ae||ae(i,c,s,e,l)}),[Ce,Fe,i,c,s]),vt=(0,F.useCallback)(function(){var e=(0,S.default)(h.default.mark((function e(t){var n;return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=null==we?void 0:(0,v.default)(we).call(we,(function(e,n){return t!==n})),Ze(n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[we,Ze]),Ct=(0,F.useCallback)((function(e){Ce({colHeadFilters:e})}),[Ce]),mt=(0,F.useCallback)((function(){return qe(i,c||Be,s,d)}),[i,c,Be,s,qe,d]),ht=(0,F.useCallback)((function(e){Ce({searchKeywords:e,pageNo:1})}),[Ce]),It=(0,F.useCallback)(function(){var e=(0,S.default)(h.default.mark((function e(t){var n;return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe(i,c,s,t);case 2:n=e.sent,Ce({orderInfo:t,orderBy:n}),Ve({config:A(A({},Me),{},{orderBy:n})})(re);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[i,c,s,Me,Ce,Ve]),St=(0,F.useCallback)((function(e){Ce({showListSettingPop:e})}),[Ce]),bt=(0,F.useCallback)((function(e){Ce({showFilterSettingPop:e})}),[Ce]),Ft=(0,F.useCallback)((function(e){Ce({showSortSettingPop:e})}),[Ce]),kt=(0,F.useMemo)((function(){return{appId:i,formId:c,schemaId:_e,env:s,listItemConfig:Fe,listFilters:ye,pageNo:Ie,pageSize:Se,updateFooter:!0,orderBy:xe,orderInfo:Ne,viewAuth:d}}),[i,c,_e,s,Fe,ye,Ie,Se,xe,Ne,d]),wt=(0,F.useCallback)(function(){var e=(0,S.default)(h.default.mark((function e(t){return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Re({config:A(A({},kt),{},{searchKeywords:t}),noPreData:!0,clearSelectInfo:!0})(re);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[kt,Re]),yt=(0,F.useMemo)((function(){return(0,y.debounce)(wt,500)}),[wt]),Dt=(0,F.useCallback)(function(){var e=(0,S.default)(h.default.mark((function e(t){return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:yt(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[yt]),xt=(0,F.useCallback)((function(e){var t=(0,k.getFiltersExceptFieldEnumType)(e,we);return ee(i,c,s,e,t,_e)}),[i,c,s,we,_e]),Nt=(0,F.useCallback)((function(e){null==xt||xt(e).then((function(t){var n=(0,m.default)(Fe).call(Fe,(function(t){return t.number===e}))||{};Ce({colHeadFilter:A(A({},Ee),{},(0,I.default)({},e,{fieldFilterConfig:A(A({},t.fieldFilterConfig),n),groupInfo:t.groupInfo,configuredFilter:{items:(0,k.getConfiguredFilter)(we,e,n.type),enumEqCompareType:"001"}}))})}))}),[xt,Ee,we,Fe]),Et=(0,F.useCallback)(function(){var e=(0,S.default)(h.default.mark((function e(t,n){var r,a,o=arguments;return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]&&o[2],a={fieldName:null==t?void 0:t.fieldName,compareType:null==t?void 0:t.compareType,value:null==t?void 0:t.value},e.next=4,oe(i,c,s,n||we,ke,a,"",r&&_e);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[i,c,s,we,ke,_e]),Lt=(0,F.useCallback)(function(){var e=(0,S.default)(h.default.mark((function e(t,n){var r,a=arguments;return h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]&&a[2],e.next=3,Et({fieldName:null==t?void 0:t.fieldName,compareType:null==t?void 0:t.compareType,value:null==t?void 0:t.value},n,r).then((function(e){Ce({enumFilterValue:A(A({},Le),{},(0,I.default)({},null==t?void 0:t.fieldName,e))})}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[Et,Le]);(0,F.useEffect)((function(){var e=We(Fe),t=e.columns,n=e.visibleColumnKeys;Ce({columns:t,visibleColumnKeys:n})}),[Fe,We]),(0,F.useEffect)((function(){Ce({searchKeywords:null,selectedIds:[],selectStatus:D.CHECK,notInSelectedIds:[],selectedCount:0});try{W&&!H&&qe(i,c||Be,s,d)}catch(e){Ce({dataSource:[],footerDataSource:[],pageNo:1,pageSize:20,totalCount:0,lastPage:!0,formName:"",loading:!1,listItemConfig:[],listFilterConfig:[],listTreeConfig:[],listStatInfo:[],configuredFilterItems:[],listFilters:[]})}}),[Ce,i,c,Be,s,W,d,H]),(0,F.useEffect)((function(){"string"==typeof De&&Dt(De)}),[De]);var Pt=(0,F.useCallback)((function(e){var t=e.next,n=e.key,r=void 0===n?"":n,a=e.action,o=(0,k.getIds)(r);switch(a){case T.check_all:st(t||Oe({status:D.CHECK_ALL}),D.CHECK_ALL,[],be);break;case T.uncheck_all:st([],D.CHECK,[],0);break;case T.check:if(Ae===D.CHECK)Ce({selectedIds:(0,g.default)(He).call(He,o),selectedCount:Te+1});else{var l=(0,k.filterId)(o,Ke);Ce({selectedIds:t||Oe({info:{newNotInIds:l}}),notInSelectedIds:l,selectedCount:Te+1})}break;case T.uncheck:if(Ae===D.CHECK)Ce({selectedIds:(0,k.filterId)(o,He),selectedCount:Te-1});else{var u=(0,g.default)(Ke).call(Ke,o);st(t||Oe({status:D.CHECK_CANCEL,info:{newNotInIds:u}}),D.CHECK_CANCEL,u,Te-1)}}}),[Ae,He,Ke,st,be,Te,Oe]),_t={onAfterAddRows:lt,onAfterDeleteRows:at,onAfterSave:ot,onPaginationChange:tt,onListSettingConfirm:gt,onFilterItemDelete:vt,onFilterConfirm:Ze,onRefresh:mt,onRefreshWithSetting:ft,onSearch:ht,onChangeFilters:Ct,onSetShowFilterSettingPop:bt,onSetShowListSettingPop:St,onSetShowSortSettingPop:Ft,onAggCellChange:Je,getColHeadFilter:xt,onColHeadFilterVisibleChange:Nt,getEnumFilterValue:Et,getStatInfo:Xe,onColFilterConfirm:$e,handleRowDelete:ut,onRowDelete:it,onLoadMoreData:Qe,onLoadInitData:qe,onLoadSetting:function(e,t,n,r,a){return je({appId:e,formId:t,schemaId:a,env:n,viewAuth:r,compareTypes:o})(de)},onUpdateDataSource:Ge,onColSort:It,onGetEnumFilterValue:Lt,onAggVisibleChange:Ye,setFormDataListState:Ce,onSelectChange:Pt,onBatchDelete:pt,getSelectedQueryString:ct,setSelectedInfo:st,handleDeleteSelectedId:nt,keepErrSelect:dt};return[ve,_t,x.TableContext]}},67112:function(e,t,n){var r=n(13939),a=n(34716),o=n(70696),l=n(4884),u=n(3464),i=n(51400),c=n(25028),s=n(9564);c(t,"__esModule",{value:!0}),t.initSelectInfo=t.getInitFormDataList=t.getFormDataListSetting=void 0;var f=s(n(29052)),d=s(n(96631)),p=s(n(35256)),g=s(n(94924)),v=n(98464),C=n(69400),m=n(12700),h=n(57264),I=n(20948),S=["listItemConfig","configuredFilterItems","listFilters","listFilterConfig","listStatInfo","formName","configuredPageSize","orderBy","orderInfo","name"];function b(e,t){var n=r(e);if(a){var u=a(e);t&&(u=o(u).call(u,(function(t){return l(e,t).enumerable}))),n.push.apply(n,u)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){(0,d.default)(e,t,n[t])})):u?i(e,u(n)):b(Object(n)).forEach((function(t){c(e,t,l(n,t))}))}return e}var k=t.initSelectInfo={selectedIds:[],selectStatus:I.CHECK,notInSelectedIds:[],selectedCount:0},w=(t.getInitFormDataList=function(){var e=(0,g.default)(f.default.mark((function e(t){var n,r,a,o,l,u,i,c,s,d,g,m,I,b,y,D,x,N,E,L,P,_,H,A,K,T;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.appId,r=t.formId,a=t.schemaId,o=t.env,l=t.viewAuth,u=t.compareTypes,i=t.searchKeywords,n&&r&&a){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,w({appId:n,formId:r,env:o,schemaId:a,compareTypes:u});case 6:if(e.t0=e.sent,e.t0){e.next=9;break}e.t0={};case 9:if(c=e.t0,s=c.listItemConfig,d=c.configuredFilterItems,g=c.listFilters,m=c.listFilterConfig,I=c.listStatInfo,b=c.formName,y=c.configuredPageSize,D=c.orderBy,x=c.orderInfo,c.name,N=(0,p.default)(c,S),l){e.next=23;break}return e.abrupt("return",{dataSource:[],footerDataSource:[],pageSize:20,pageNo:1,totalCount:0,lastPage:!0,formName:b,loading:!1,listItemConfig:s,listFilterConfig:m,listStatInfo:I,configuredFilterItems:[],listFilters:g,orderBy:D,orderInfo:x});case 23:return E=(0,C.getArgs)(null==g?void 0:g[0],{env:o,page_size:y,order_by:D,schemaId:a,search:i}),e.next=26,(0,v.getFormDataList)(n,r,E);case 26:return L=e.sent,P=L.rows,_=L.pageSize,H=L.totalCount,A=L.pageNo,K=L.lastPage,T=(0,C.getInitFooterDataSource)(s,I),e.abrupt("return",F(F({dataSource:P,footerDataSource:T,pageSize:_,pageNo:A,totalCount:H,lastPage:K,formName:b,loading:!1,listItemConfig:s,listFilterConfig:m,listStatInfo:I,configuredFilterItems:[],schemaConfiguredFilterItems:d,listFilters:g,orderBy:D,orderInfo:x},N),k));case 32:e.prev=32,e.t1=e.catch(3),(0,h.showNotice)("error",e.t1.message||"表单已被删除");case 36:case"end":return e.stop()}}),e,null,[[3,32]])})));return function(t){return e.apply(this,arguments)}}(),t.getFormDataListSetting=function(){var e=(0,g.default)(f.default.mark((function e(t){var n,r,a,o;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.appId,t.formId,t.env,n=t.schemaId,t.compareTypes,e.next=3,(0,v.getFormDataListSettingBySchemaId)(n);case 3:return r=e.sent,a=null==r?void 0:r.rows[0],o=(0,m.getListFilterConfig)(a.listItemConfig,a.listFilterConfig),e.abrupt("return",F(F({},a),{},{listFilterConfig:o,listFilters:a.filters}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}]);