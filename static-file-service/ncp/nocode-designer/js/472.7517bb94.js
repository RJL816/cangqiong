"use strict";(self.webpackChunknocode_designer=self.webpackChunknocode_designer||[]).push([[472],{9472:function(e,n,r){r.r(n),r.d(n,{NoCodeDesigner:function(){return Kf}});var a={};r.r(a),r.d(a,{addCache:function(){return _o},addControlCache:function(){return Lo},clearCache:function(){return jo},deleteControlCache:function(){return Vo},getControlCache:function(){return Ko},hasCache:function(){return Oo},hasControlCache:function(){return Uo}});var l=r(4716),o=r.n(l),i=r(4884),c=r.n(i),u=r(7435),d=r.n(u),s=r(8264),f=r(2992),p=r(3939),m=r.n(p),v=r(696),g=r.n(v),y=r(1908),C=r.n(y),h=r(760),b=r.n(h),E=r(2581),I=r.n(E),N=r(3992),T=r.n(N),x=r(2400),A=r.n(x),F=r(524),S=r.n(F),D=r(5984),k=r.n(D),M=r(8040),w=r.n(M),P=r(3548),R=r(5992),B=r(2664),_="Id",O="FieldType",j="FieldId",L="EntryId",K="_Type_",U="Value",V="Label",G="ParentId",z="Items",H="Bgc",q="data-control-id",Y="data-drag-id",W="data-drag-over",X="data-selection",Q="data-mouse-over",Z="data-cut-control",J="data-is-dragging",$="data-right-drag-style",ee="data-drag-direction",te="data-outline-drag-tree-node",ne="data-change-name",re=function(e){return e?(0,f.c)({},q,null==e?void 0:e[_]):{}},ae=r(6428),le=r.n(ae),oe=k().createContext({});oe.displayName="DesignerContext";var ie=function(e){var t=(0,D.useContext)(oe),n=(t.prefixCls,t.getKdesignerApi),r=(t.invokeAction,t.fieldStatusSettingMode),a=(0,D.useMemo)((function(){return n()}),[]),l=a.selection,o=a.data,i=l.setSelect,c=(0,D.useMemo)((function(){return o.getRootId()}),[]),u=((0,D.useRef)(null),(0,D.useRef)(null),(0,D.useCallback)((function(e){var t;e.stopPropagation();var n=e.currentTarget.dataset,a=n.controlId,l=n.enableClick;if(!r||c!==a&&"false"!==l){var o=document.querySelectorAll(b()(t="[".concat(q,'="')).call(t,a,'"]'))[0];null==o||o.setAttribute(Q,"true")}}),[r])),d=(0,D.useCallback)((function(e){var t;e.stopPropagation();var n=e.currentTarget.dataset.controlId;document.querySelectorAll(b()(t="[".concat(q,'="')).call(t,n,'"]'))[0].removeAttribute(Q)}),[]);return{onMouseOver:u,onMouseOut:d,onContextMenu:function(e){e.stopPropagation();var t=e.currentTarget.dataset,n=t.controlId,a=t.selection;if(o.getRootId()!==n){var l=o.findControl(n);r||(e.preventDefault(),a||i([n]),M.eventBus.emit("contextmenu",{event:e,field:l}))}}}},ce=r(1260),ue=r.n(ce);function de(e){var t=e||window.event;return M.OS===M.MAC?t.metaKey:t.ctrlKey}var se,fe,pe=r(3440),me=r.n(pe),ve=r(9992),ge=r.n(ve),ye=r(600),Ce=r.n(ye),he=r(4984),be=r(8496),Ee=r(7348),Ie=r.n(Ee),Ne=r(2272),Te=r.n(Ne),xe=r(8456),Ae=r.n(xe),Fe=r(3980),Se=r.n(Fe),De=r(644),ke=r.n(De),Me=function(e){return e.DEFAULT="1",e.DISABLED="2",e.READONLY="3",e.HIDDEN="4",e}({}),we=r(2892),Pe=r.n(we),Re="nocode-designer",Be=["ParentId","Id"],_e="entity",Oe="all",je="nocode-designer-main-root",Le="System_",Ke="NoCodeGroupContainerAp",Ue="NoCodeBizButtonAp",Ve="BizBtnFlexPanelAp",Ge="NoCodeBillFormAp",ze="NoCodeEntryEntity",He="NoCodeRefBillTable",qe=[Ue,Ke],Ye=b()(se=[He,ze,Ke,Ue]).call(se,["NoCodeBillNoField","NoCodeCreateDateField","NoCodeCreatorField","NoCodeModifyDateField","NoCodeModifierField"]),We={"#276FF5":"#F2F9FF","#16AFF1":"#F2FDFF","#16B8B0":"#F2FFFC","#FDC200":"#FFFDE6","#77C404":"#FAFFEB","#1BA854":"#F2FFF5","#FF991C":"#FFFBF2","#FF5F1F":"#FFF8F2","#FB2323":"#FFF4F2","#F90D58":"#FFF2F4","#701DF0":"#F9F2FF","#0E5FD8":"#F2F9FF"},Xe=[{name:"经典",primaryColor:"#276FF5"},{name:"都市",primaryColor:"#701DF0"},{name:"夜幕",primaryColor:"#0E5FD8"},{name:"沙漠",primaryColor:"#FF5F1F"},{name:"雪山",primaryColor:"#276FF5"},{name:"港湾",primaryColor:"#F90D58"},{name:"高尔夫",primaryColor:"#1BA854"},{name:"乡野",primaryColor:"#16B8B0"}],Qe=["UploadDefValue","PictureDefValue","NoCodeDefValue","FieldRequired","Status","Visibility"],Ze=function(e){return e.DEFAULT="1",e.DISABLED="2",e.READONLY="3",e.HIDDEN="4",e}({}),Je=function(e){return"NoCodeDateRangeField"===e},$e=function(e){return"NoCodeDateField"===e},et=function(e){return(null==e?void 0:S()(e).call(e,"NoCodeRefBillField"))||(null==e?void 0:S()(e).call(e,"NoCodeMulRefBillField"))},tt=function(e){var t;return S()(t=["NoCodeCreatorField","NoCodeModifierField"]).call(t,e)},nt=function(e){var t;return S()(t=["NoCodeCreatorField","NoCodeCreateDateField","NoCodeModifierField","NoCodeModifyDateField","NoCodeBillNoField"]).call(t,e)},rt=function(e){var t;return S()(t=["NoCodeCreatorField","NoCodeCreateDateField","NoCodeModifierField","NoCodeModifyDateField"]).call(t,e)},at=function(e){return"NoCodeImageUploadField"===e},lt=function(e){return"NoCodeAttachmentUploadField"===e},ot=function(e){return"NoCodeEntryEntity"===e},it=function(e){return"NoCodeRefBillTable"===e},ct=function(e){return"NoCodeBillFormAp"===e||"NoCodeBillEntity"===e},ut=function(e){return e===Ue||e===Ve},dt=function(e){return"NoCodeSelectItemField"===e},st=function(e){return"NoCodeRichTextField"===e},ft=function(e){return"NoCodeGraphicDisplayField"===e},pt=function(e){return e&&Date.parse(e)?new Date(e):null},mt=function(e){if(!e)return null;var t=(e=function(e){return e?m()(e).reduce((function(t,n){return t[(0,De.lowerFirst)(n)]=e[n],t}),{}):e}(e))||[],n=t.start,r=void 0===n?"":n,a=t.end,l=void 0===a?"":a;return[pt(r),pt(l)]},vt=function(e){return"hide"===e},gt=function(e,t){if(!t)return"";var n,r=t._Type_;return dt(r)?b()(n="".concat(e,"[")).call(n,Pt(t.SelectItemType)?"多选":"单选","]"):et(r)?function(e,t){var n;return b()(n="".concat(e,"[")).call(n,t?"多条":"单条","]")}(e,Pt(t.Multi)):e},yt=function(e){return"NoCodeGroupContainerAp"===e},Ct=r(9480),ht=r.n(Ct),bt=r(2504),Et=["children"],It=["children","valueItems","billEntityId","displayProp","isMulti","compareTypes","refSelf"];function Nt(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nt(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Nt(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}function xt(e,t){var n=void 0!==ge()&&Ce()(e)||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return At(e,t);var r=Se()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return me()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return At(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,l=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw l}}}}function At(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ft=["FieldName","TableName","Key"],St=function(e){return e?Array.isArray(e)?e:[e]:[]},Dt=function(e,t){var n=(0,De.cloneDeep)(e),r=n._Type_,a=n.EntityData;n[G]=t;var l=(0,M.createUUid)();if(n[_]=l,a&&(n.EntityData[_]=l,n.EntityData[G]=t,n[j]&&(n[j]=l),n[L]&&(n[L]=l)),Je(r)){Ie()(n,"EndDateFieldKey"),Ie()(n,"EndDateFieldName"),Ie()(n,"StartDateFieldKey"),Ie()(n,"StartDateFieldName");var o=ht()(a,(function(e){Ie()(e,"EndDateFieldKey"),Ie()(e,"EndDateFieldName"),Ie()(e,"StartDateFieldKey"),Ie()(e,"StartDateFieldName")}));Te()(n,"EntityData",o)}if(ot(r)){Ie()(n,"TableName");var i=ht()(a,(function(e){Ie()(e,"TableName")}));Te()(n,"EntityData",i)}return Vt(r)&&(Number(n.GroupIndex)>0?n.GroupIndex=Number(n.GroupIndex)+1:(n.GroupParentId=(0,M.createUUid)(),n.GroupIndex=0)),n.Inherit&&(n.Inherit=!1),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ft;return null==t||t.forEach((function(t){e[t]&&delete e[t],e.EntityData&&e.EntityData[t]&&Ie()(e.EntityData,t)})),e}(n)},kt=function e(t,n,r){var a,l,o=n.Id,i=Dt(n,r),c=g()(a=t[z]).call(a,(function(e){return e[G]===o}));return b()(l=[i]).call(l,(0,De.flattenDeep)(T()(c).call(c,(function(n){return e(t,n,i[_])}))))},Mt=function(e){var t;return S()(t=["default","hidden","disabled","readonly","mustInput"]).call(t,e)},wt=function(e){var t=e.SelectItemType,n=e.CustomContent,r=e.DefValue;if(!Array.isArray(n))return"";if("0"===t){var a=Ae()(n).call(n,(function(e){return e.Value===r}));return(null==a?void 0:a.Label)||""}if("1"===t){var l=[],o=r.split(",");return n.forEach((function(e){null!=o&&S()(o).call(o,null==e?void 0:e.Value)&&l.push(e.Label)})),l.join(",")}return""},Pt=function(e){return"1"===(0,De.toString)(e)},Rt=function(e){if(!e)return"Select";var t=e.DropDownOrTilePc,n=e.SelectItemType;return"1"===(0,De.toString)(t)?Pt(n)?"Checkbox":"Radio":"Select"},Bt=function(e){var t,n=e.CustomContent;if(!n)return[];var r=Array.isArray(n)?n:(null==n?void 0:n.ops)||[];return g()(t=(null==r?void 0:T()(r).call(r,(function(e){return{label:null==e?void 0:e[V],value:null==e?void 0:e[U],color:null==e?void 0:e[H]}})))||[]).call(t,(function(e){return e.label}))||[]},_t=function(e){var t=e.CustomContent;return!!t&&(!Array.isArray(t)&&(null==t?void 0:t.bgcSwitch))},Ot=function(e){var t=e.SelectItemType,n=e.NoCodeDefValue;return Pt(t)?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return e?null==e?void 0:e.split(t||","):[]}(n,","):n},jt=function(e){return void 0!==e&&0==+e},Lt=function(e,t){var n,r=e.formmeta,a=null==r||null===(n=r.Items)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.SysSetting;return a?JSON.parse(a):function(e){var t=e.Categories,n=void 0===t?[]:t;return g()(n).call(n,(function(e){var t;return null==e||null===(t=e.Id)||void 0===t?void 0:C()(t).call(t,Le)})).reduce((function(e,t){return e[t.Id]=!1,e}),{})}(t)},Kt=function(e,t){return null==e?void 0:e[t]},Ut=function(e,t){var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),n)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?n[r]:("00"+n[r]).substr((""+n[r]).length)));return t},Vt=function(e){return e===Ke},Gt=function(e){var t=e.split("."),n=/\B(?=(\d{3})+(?!\d))/g;if(2===t.length){var r,a=(0,s.c)(t,2),l=a[0],o=a[1];return b()(r="".concat(l.replace(n,","),".")).call(r,o)}return t[0].replace(n,",")},zt=null===(fe=window.location.search)||void 0===fe||null===(fe=fe.match(/(^|&|\?)kdcdc=([^&]*)(&|$)/i))||void 0===fe?void 0:fe[2],Ht=function(e){return e?!S()(e).call(e,"kdcdc")&&zt?e+(S()(e).call(e,"?")?"&":"?")+"kdcdc="+zt:e:""},qt=function(e){if(e)return window.__domainurl__+("/"===e[0]?Se()(e).call(e,1):e)},Yt=function(e,t){return t?t.indexOf("background")>-1?qt(t):e+t:t};function Wt(e,t){var n=new bt.c((function(e){var n=e[0].contentRect,r=n.width,a=n.height;t&&t({hide:0===r&&0===a,width:r,height:a})}));return n.observe(e),{removeResizeObserve:function(){n.disconnect(e),n=null}}}var Xt=function(e){if("string"!=typeof e)return!1;try{var t=JSON.parse(e);return!("object"!=(0,be.c)(t)||!t)}catch(e){return!1}},Qt=function(e){return e&&Xt(e)?0===(e=JSON.parse(e)).valueType&&e.value||"":e},Zt=function(e){if(!(0,De.isUndefined)(e)){var t=e.start,n=e.end;return{start:Qt(t),end:Qt(n)}}},Jt=function(e){return Xt(e)?JSON.parse(e):{}},$t=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"NoCodeDefValue",r=Tt({},e);return r[n]&&(r=Tt(Tt({},r),{},(0,f.c)({},n,"DateRangeDefValue"===n?Zt(r[n]):Qt(r[n])))),null!==(t=r.EntityData)&&void 0!==t&&t[n]&&(r=Tt(Tt({},r),{},{EntityData:Tt(Tt({},r.EntityData),{},(0,f.c)({},n,"DateRangeDefValue"===n?Zt(r[n]):Qt(r[n])))})),r},en=function(e,t){var n=e.PropsDisplay,r=e.DataRange,a=e.BillEntityIdEx,l=e.Multi,o=e._Type_,i=(e.Status,e.MustInput),c=(e.EmptyText,e.Key),u=e.Name,d=e.DefaultDisplay,s=e.Id,f=e.FieldType,p=1===parseInt(l),m=tt(o)?"bos_user":a||t.getControlPropertyDefaultValue(f,"BillEntityIdEx");return{displayProp:n||t.getControlPropertyDefaultValue(f,"PropsDisplay"),dataRange:r,isMulti:p,entityId:m,type:(et(o)||it(o)?"NoCodeMulRefBillField":o).toLowerCase(),id:s,allowClear:!0,mustInput:i,key:c,name:u,defaultDisplay:d,showSelected:!0,disabled:!1,readonly:!1,hidden:!1}},tn=function e(t,n,r){return(t||[]).reduce((function(t,a){var l,o,i=a.id,c=a.option,u=void 0===c?{}:c,d=u.children,s=(0,he.c)(u,Et),f=b()(l="".concat(n,".")).call(l,i),p=null!=f&&S()(f).call(f,"fbasedataid")?i.split(".fbasedataid")[0]:f;if(((null==p||null===(o=p.split("."))||void 0===o?void 0:o.length)||0)>r)return t;var m=Tt({},s);d&&(m.children=e(d,n,r));var v=Tt(Tt({},a),{},{id:f,option:m||{}});return b()(t).call(t,v)}),[])},nn=function e(t,n,r){var a,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return g()(a=(n||[]).reduce((function(n,a){var o,i,c=a.caption,u=a.type,d=a.id,s=a.option,f=void 0===s?{}:s,p=a.typeCaption,m=null!=d&&S()(d).call(d,"fbasedataid")?d.split(".fbasedataid")[0]:d,v=(null==m||null===(o=m.split("."))||void 0===o?void 0:o.length)||0;if("group"!==u&&v>l)return n;var g=f.children,y=f.valueItems,C=f.billEntityId,h=f.displayProp,E=f.isMulti,I=(f.compareTypes,f.refSelf),N=(0,he.c)(f,It),T=function(e){return null==e?void 0:e.split("-")[0]}(u).toLowerCase(),x=function(e){var t=e.compareTypesMap,n=e.type,r=e.entityId,a=t[n]||[];return"bos_user"===r?a="nocodecreatorfield":"bos_adminorg"===r&&(a="orgfield"),"string"==typeof a&&(a=t[a]),a}({compareTypesMap:r,type:T,entityId:C}),A=d,F=Tt({title:c,key:A,compareTypes:x,type:u,titlePrefix:p,selectable:"group"!==u},N);return et(u)||tt(u)||it(u)?F=(0,B.c)(F,{displayProp:h,entityId:C,isMulti:E}):dt(u)&&(F=(0,B.c)(F,{isMulti:E})),y&&(F.items=y),g?F.children=e(t,g,r,l):!0===I&&(F.children=e(t,tn(t,A,l),r,l)),"group"!==u||null!==(i=F)&&void 0!==i&&null!==(i=i.children)&&void 0!==i&&i.length?b()(n).call(n,F):n}),[])).call(a,(function(e){var t=e.type,n=e.entityId;return!et(t)&&!tt(t)||null!==n}))},rn=function(e,t,n){var r,a=document.querySelector(b()(r="[".concat(q,'="')).call(r,e,'"]'));a&&(a.setAttribute(q,t),null==n||n(a))},an=function(e,t,n){if(t){var r=t.GroupParentId,a=t.GroupIndex,l=t.Id,o="forward"===n?-1:1,i=e.findControlByCondition((function(e){return e.GroupParentId===r}));if("forward"!==n||0!==Number(a))if("back"!==n||Number(a)!==i.length-1){var c=Ae()(i).call(i,(function(e){return Number(e.GroupIndex)===Number(a)+o}));if(c){var u=Tt(Tt({},t),{},{GroupIndex:c.GroupIndex});e.insertControl((0,M.createInsertAction)({targetId:c.Id,values:[u],isPre:"forward"===n})).then((function(t){var n=[[c.Id,{GroupIndex:a}]];e.batchUpdateControlPropertyValues((0,M.createUpdateAction)(n))}))}}else{var d=e.getNextSibling(l).control;if(!d)return;if(Vt(d._Type_)){var s,f=e.findControlByCondition((function(e){return e.GroupParentId===d.GroupParentId}));if(null!=f&&f.length)e.insertControl((0,M.createInsertAction)({targetId:null===(s=f[f.length-1])||void 0===s?void 0:s.Id,values:i,isPre:!1}))}else e.insertControl((0,M.createInsertAction)({targetId:d.Id,values:i,isPre:!1}))}else{var p=e.getPrevSibling(l).control;if(!p)return;if(Vt(p._Type_)){var m,v=e.findControlByCondition((function(e){return e.GroupParentId===p.GroupParentId}));if(null!=v&&v.length)e.insertControl((0,M.createInsertAction)({targetId:null===(m=v[0])||void 0===m?void 0:m.Id,values:i,isPre:!0}))}else e.insertControl((0,M.createInsertAction)({targetId:p.Id,values:i,isPre:!0}))}}},ln={NoCodeTextField:"文本",NoCodeTextAreaField:"文本",NoCodeCreateDateField:"日期",NoCodeModifyDateField:"日期",NoCodeBillNoField:"文本"},on=function(e,t,n,r){var a,l,o=e._Type_,i=e.Multi,c=e.SelectItemType,u=e.Name,d=e.Key,s=e.BillEntityIdEx;if(et(o)){var f,p,v=Ae()(f=m()(t)).call(f,(function(e){return S()(d).call(d,e)}));if(v)return t[v]||"";var g=s||n.getControlPropertyDefaultValue(o,"BillEntityIdEx");return b()(p="[".concat(r[g]||"","]")).call(p,1==i?"[多条]":"[单条]")}if(it(o))return b()(l="[".concat(u||"-","]")).call(l,1==i?"[多条]":"[单条]");if(dt(o))return"[选项]".concat(Pt(c)?"[多选]":"[单选]");if("NoCodeCreatorField"===o||"NoCodeModifierField"===o)return"[人员][单条]";var y=ln[o]||(null===(a=n.getControlMeta(o))||void 0===a?void 0:a.Name);return"[".concat(y,"]")},cn=function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=xt(t);try{for(a.s();!(n=a.n()).done;){var l=n.value,o=l.titlePrefix,i=l.key,c=l.children,u=l.type;if(c&&e(c,r),et(u))r[i.split(".").pop()]=o||""}}catch(e){a.e(e)}finally{a.f()}return r},un=function(e,t){var n,r=T()(n=g()(e).call(e,(function(e){return Vt(null==e?void 0:e._Type_)}))).call(n,(function(e){return e.Id}));return r.length&&e.forEach((function(e){if(S()(r).call(r,e.ParentId)&&e.EntityData){var n=Tt(Tt({},e.EntityData),{},{ParentId:t});e.EntityData=n}})),e},dn=function(){var e,t;return Se()(e=Math.random().toString()).call(e,-9)+Se()(t=Math.random().toString()).call(t,-9)},sn=function(){var e=(0,D.useContext)(oe),t=e.getKdesignerApi,n=e.fieldStatusSettingMode,r=(0,D.useMemo)((function(){return t()}),[]),a=r.data,l=r.selection,o=l.setSelect,i=l.appendSelect,c=l.getSelection,u=(0,D.useCallback)((function(e){e.stopPropagation();var t=a.getRootId(),r=c(),l=function(e){for(;!e.dataset.controlId&&"ui-designer-root"!==e.id;)e=e.parentNode;return e}(e.target).dataset,u=l.controlId,d=l.enableClick;if(!n||t!==u&&"false"!==d){var s=!0;if(r.length>0&&(s=a.isSiblings(r[0],u)),s||!de(e))if(de(e)){var f=r.indexOf(u);if(f>=0){var p=(0,R.c)(r);ue()(p).call(p,f,1),p.length>0&&o(p)}else i([u])}else o([u])}}),[n]);return u},fn="zidingyifuwu",pn={NoCodeTextField:"wenben",NoCodeTextAreaField:"duoxingwenben",NoCodeDateField:"riqi4",NoCodeDecimalField:"shuzhi",NoCodeSelectItemField:"xuanxiang",NoCodeRefBillField:"duoxuanjichuziliao",NoCodeMulRefBillField:"duoxuanjichuziliao",NoCodeAddressFormatField:"dizhi",NoCodeDateRangeField:"riqi4",NoCodeEntryEntity:"biaoge16",NoCodeRefBillTable:"biaoge16",NoCodeRichTextField:"fuwenbenbianjiqi",NoCodeGEOField:"dizhi",NoCodeImageUploadField:"tupian3",NoCodeAttachmentUploadField:"fujian2",NoCodeGraphicDisplayAp:"tuwen",NoCodeBillListAp:"biaodanliebiao",NoCodeCountDownAp:"daojishi",NoCodeMapAp:"ditu",NoCodeCreateDateField:"chuangjianriqi2",NoCodeCreatorField:"chuangjianren2",NoCodeModifyDateField:"xiugairiqi2",NoCodeModifierField:"xiugairen2",NoCodeBillNoField:"bianma",EntryEntity:"biaodanliebiao",GridContainerAp:"zhagerongqi",MessageCarouselContainerAp:"lunborongqi",TabPageAp:"yeqian2",ButtonAp:"anniu3",VectorAp:"zititubiao",ToolbarAp:"gongjulan",NoCodeBizButtonAp:"anniu3",NoCodeGraphicDisplayField:"tuwen",NoCodeGroupContainerAp:"fenzurongqi"};function mn(e,t){return et(e)?"duoxuanjichuziliao":pn[e]||t||fn}var vn=null;function gn(e,t){var n;!function(){vn&&document.body.removeChild(vn);vn=null}(),vn=document.createElement("div");var r=mn(e),a=b()(n='\n    <i class="designericon designericon-'.concat(r,'" style="font-size:20px;vertical-align: -3px"></i>\n    ')).call(n,t,"\n  ");return vn.innerHTML=a,vn.style.cssText="position:absolute;top:-9999px;left:-9999px;opacity:1!important;width: 124px;height: 32px;line-height: 32px;padding: 0 8px;background: #fff;box-shadow: '0px 4px 12px 0px rgba(40,50,70,0.2)';border-radius: 4px;box-sizing: border-box;",document.body.appendChild(vn),vn}var yn=function(e,t,n){e.dataTransfer&&e.dataTransfer.setDragImage&&(e.dataTransfer.dropEffect="move",e.dataTransfer.setDragImage(gn(t,n),-20,-24))},Cn=r(9308),hn=r.n(Cn),bn=r(4244),En=r.n(bn),In=function(e){for(var t=null;;){var n;if(e.dataset.dragId){t=e;break}if(!("kd-nc-grid-panel"!==e.className||null!==(n=e)&&void 0!==n&&null!==(n=n.dataset)&&void 0!==n&&n.groupContainerItem))break;e=e.parentNode}return t},Nn=function(e){for(;!e.dataset.groupBarItemId&&"ui-designer-root"!==e.id;)e=e.parentNode;return e},Tn=["data-left-drag-style",$,"data-top-drag-style","data-bottom-drag-style",ee],xn=function(e){Tn.forEach((function(t){return e.removeAttribute(t)}))},An=function(){setTimeout((function(){var e,t=(0,R.c)(new(hn())(b()(e=[]).call(e,(0,R.c)(document.querySelectorAll("[".concat(ee,"]"))),(0,R.c)(document.querySelectorAll("[".concat(W,"]"))))));t.length&&t.forEach((function(e){xn(e),e.removeAttribute(W)}))}),200)},Fn=null,Sn="",Dn=!1,kn=function(e){Sn=e},Mn=function(e){Fn=e},wn=function(){var e=(0,D.useContext)(oe),t=e.getKdesignerApi,n=e.pubUIAction,r=t(),a=r.data,l=r.selection,o=r.meta,i=r.dataFactory,c=(0,D.useContext)(M.GlobalConfigContext),u=c.env,d=c.showMessage,s=a.getRootId(),f=document.querySelector(".kd-row"),p=function(e,t){var n=Array.isArray(e)?e:[e];return a.getAllParentControlIds(t).some((function(e){return S()(n).call(n,e)}))},m=(0,D.useCallback)((function(e,t,r){var c=(r||{}).isPrev,d=void 0!==c&&c,f=u[M.CONTROL_DRAG_DATA].data,p=(void 0===f?{}:f).Id,m=a.findControl(e),v=-1;if(e===s)v=d?1:-1;else{var g=a.findControlIndex(e);if(d)v=g;else{var y,C=a.getSubControls(e),h=C.length;if(h>0)v=a.findControlIndex(null===(y=C[h-1])||void 0===y?void 0:y[_])+1;else v=g+1}}var b=m[K],E=o.getControlMeta(b).IsContainer,I=void 0!==E&&E?e:a.getParentControlId(e)||s,N=a.findControl(I)[K],T=o.canAdd(p,N);if(T&&!1!==(null==T?void 0:T.success)){if(n({eventName:"drag",action:"fd_add_drag"}),Vt(b))return function(e,t){var n,r,o=u[M.CONTROL_DRAG_DATA].data,c=(void 0===o?{}:o).Id,d=t.Id,s=(t.ParentId,null===(n=Nn(e))||void 0===n?void 0:n.getAttribute("data-group-bar-item-id"));if(Vt(c)){if(s){(r=i({type:c,parentId:a.getParentControlId(d),transferData:{Key:"nc_".concat((0,M.createUUid)().toLowerCase())}})).GroupParentId=t.GroupParentId,r.GroupIndex=Number(t.GroupIndex)+1;var f=s;if(e.getAttribute("data-group-bar-item-id"))f=e.getAttribute("data-group-bar-item-id");else{var p,m=En()(p=a.findControlByCondition((function(e){return e.GroupParentId===t.GroupParentId}))).call(p,(function(e,t){return Number(e.GroupIndex)-Number(t.GroupIndex)}));f=m[m.length-1].Id}return void a.insertControl((0,M.createInsertAction)({targetId:f,values:[r],isPre:!1},{isInstrucAdd:!0})).then((function(e){l.setSelect(r.Id)}))}(r=i({type:c,parentId:d})).GroupParentId=(0,M.createUUid)(),r.GroupIndex=0}else r=i(s?{type:c,parentId:s}:{type:c,parentId:d});a.addControl((0,M.createAddAction)(r)).then((function(e){l.setSelect(r.Id)})),delete u[M.CONTROL_DRAG_DATA]}(t,m);var x=i({type:p,parentId:I});a.addControl((0,M.createAddAction)(x,{index:v})).then((function(e){var t=e[0].value;l.setSelect(Array.isArray(t)?[t[0][_]]:[t[_]])})),delete u[M.CONTROL_DRAG_DATA]}}),[u[M.CONTROL_DRAG_DATA],n]),v=(0,D.useCallback)((function(e){var t,n,r,l,i;e.stopPropagation();var c=document.querySelector(b()(t="[".concat(q,"='")).call(t,s,"']")),v=u[M.CONTROL_DRAG_DATA];if(c&&(Fn||v)){var g=Fn||[];null==e||e.currentTarget.removeAttribute(J),Mn(null),kn("");var y=e.target,C=g[0],h=a.findControl(C),E=e.target,I=(E=null!==(n=e.target)&&void 0!==n&&null!==(n=n.dataset)&&void 0!==n&&n.tabsHeader&&Vt(C?null==h?void 0:h._Type_:null===(r=v.data)||void 0===r?void 0:r.Id)?E.lastChild:In(e.target)).dataset.dragId||"";if(!(g&&(null==g?void 0:g.length)>0&&p(g,I))){var N=(null===(l=E.dataset)||void 0===l?void 0:l.dragDirection)||"right",x=!1;if(xn(E),S()(i=["top","left"]).call(i,N)&&(x=!0),!(S()(g).call(g,I)||I===s&&null!=f&&f.contains(y))){if(null!=g&&g.length){var A=a.findControl(I),F=A._Type_;if(Vt(F))return function(e,t){for(var n,r=e.dropControl,a=e.dragControlIds,l=e.dataContext,i=(r.ParentId,r.Id),c=r._Type_,u=Nn(t).getAttribute("data-group-bar-item-id"),s=i,f=[],m=[],v=[],g=function(){var e=a[y],t=l.findControl(e),n=l.findControl(t.ParentId);if(n&&it(n._Type_))return d("表格的内容无法移动到表格之外"),{v:void 0};if(p(e,i))return{v:void 0};var g=l.findControl(e),C=g._Type_,h=(g.ParentId,g.GroupIndex),b=g.GroupParentId,E=o.canAdd(C,c);if("object"===(0,be.c)(E)&&!E.success)return{v:d(E.message)};if(Vt(C))if(u){if(g.GroupParentId!==r.GroupParentId){var I,N,x={GroupParentId:r.GroupParentId,GroupIndex:Number(r.GroupIndex)+1,ParentId:r.ParentId};m.push([g.Id,x]);var A=En()(I=l.findControlByCondition((function(e){return e.GroupParentId===r.GroupParentId}))).call(I,(function(e,t){return Number(e.GroupIndex)-Number(t.GroupIndex)}));ue()(A).call(A,Number(r.GroupIndex)+1,0,g),null==A||A.forEach((function(e,t){Number(e.GroupIndex)!==t&&m.push([e.Id,{GroupIndex:t}])}));var F=En()(N=l.findControlByCondition((function(e){return e.GroupParentId===g.GroupParentId&&e.Id!==g.Id}))).call(N,(function(e,t){return Number(e.GroupIndex)-Number(t.GroupIndex)}));null==F||F.forEach((function(e,t){Number(e.GroupIndex)!==t&&m.push([e.Id,{GroupIndex:t}])}))}else{var S,D=En()(S=l.findControlByCondition((function(e){return e.GroupParentId===r.GroupParentId&&e.Id!==g.Id}))).call(S,(function(e,t){return Number(e.GroupIndex)-Number(t.GroupIndex)}));Number(r.GroupIndex)<Number(g.GroupIndex)?ue()(D).call(D,Number(r.GroupIndex)+1,0,g):ue()(D).call(D,Number(r.GroupIndex),0,g),null==D||D.forEach((function(e,t){Number(e.GroupIndex)!==t&&m.push([e.Id,{GroupIndex:t}])}))}v.push({Id:e})}else{v.push({Id:e,ParentId:i});var k=l.findControl(s).Status;if(void 0!==k){var w=l.getAllSubControlIds(e);f.push.apply(f,(0,R.c)(T()(w).call(w,(function(e){return[e,{Status:k}]}))))}if(1===a.length&&void 0!==h&&b){var P=l.findControlByCondition((function(t){return t.GroupParentId===b&&t.Id!==e}));if(P.length>0&&(f.push([e,{GroupIndex:0,GroupParentId:(0,M.createUUid)()}]),0===Number(h))){var B=T()(P).call(P,(function(e,t){return[e.Id,{GroupIndex:t}]}));f.push.apply(f,(0,R.c)(B))}}}else u?f.push([e,{ParentId:u}]):f.push([e,{ParentId:i}])},y=0;y<a.length;y++)if(n=g())return n.v;m.length>0&&l.batchUpdateControlPropertyValues((0,M.createUpdateAction)(m),!1),v.length>0&&l.insertControl((0,M.createInsertAction)({targetId:s,values:v,isPre:!1})),f.length>0&&l.batchUpdateControlPropertyValues((0,M.createUpdateAction)(f)),An()}({dropControl:A,dragControlIds:g,dataContext:a},E);a.swapControl((0,M.createSwapAction)({origin:g,target:I,isPrev:x})).then((function(e){}))}else m(I,E,{isPrev:x});An()}}}}),[]),g=(0,D.useCallback)((function(e){var t,n,r,l,i;e.preventDefault(),null==e||e.currentTarget.setAttribute(J,"true");var c=u[M.CONTROL_DRAG_DATA];if(Fn||c){var d=Fn||[],s=In(e.target),f=(null==s||null===(t=s.dataset)||void 0===t?void 0:t.dragId)||null;if(f){var p=Sn;if(p&&f&&p!==f){var m,v=document.querySelectorAll(b()(m="[".concat(Y,"='")).call(m,p,"']"));v&&v.forEach((function(e){return xn(e)})),kn(f)}else if(""===p)kn(f);else if(p&&f&&p===f){var g;if(null!==(g=e.target)&&void 0!==g&&null!==(g=g.dataset)&&void 0!==g&&g.tabsHeader)Dn=!0;else if(Dn){var y,C;Dn=!1;var h=document.querySelectorAll(b()(y=b()(C="[".concat(Y,"='")).call(C,p,"'] [")).call(y,ee,"]"));h&&h.forEach((function(e){return xn(e)}))}}var E=d[0],I=a.findControl(E),N=null==s||null===(n=s.dataset)||void 0===n?void 0:n.groupBarItemId;if(null!==(r=e.target)&&void 0!==r&&null!==(r=r.dataset)&&void 0!==r&&r.tabsHeader&&Vt(E?null==I?void 0:I._Type_:null===(l=c.data)||void 0===l?void 0:l.Id)){var T=e.target.lastChild;null==T||T.setAttribute($,"true"),null==T||T.setAttribute(ee,"right"),kn(null==T?void 0:T.dataset.dragId)}if(!f||null==d||!S()(d).call(d,f))if(N)Vt(E?null==I?void 0:I._Type_:null===(i=c.data)||void 0===i?void 0:i.Id)&&(null==s||s.setAttribute($,"true"),null==s||s.setAttribute(ee,"right"));else{var x=a.findControl(f)._Type_,A=o.getControlMeta(x).IsContainer;if(void 0!==A&&A)return;var F=function(e,t,n){var r=e.getBoundingClientRect(),a=r.x,l=r.y,o=a+r.width,i=l+r.height,c=(a+o)/2,u="";return a<t&&t<o&&l<=n&&n<=l+8?u="left":a<t&&t<o&&i-8<=n&&n<i?u="right":a<=t&&t<=c&&l<n&&n<i?u="left":c<t&&t<o&&l<n&&n<i&&(u="right"),u}(s,e.clientX,e.clientY),D=s.dataset.dragDirection;F&&F!==D&&(D&&(s.removeAttribute("data-".concat(D,"-drag-style")),s.removeAttribute(ee)),null==s||s.setAttribute("data-".concat(F,"-drag-style"),"true"),null==s||s.setAttribute(ee,F))}}else kn("")}}),[s]);return{onDragOver:g,onDragEnd:(0,D.useCallback)((function(e){e.preventDefault(),An(),Mn(null),kn(""),null==e||e.currentTarget.removeAttribute(J)}),[s]),onDrop:v,onDragLeave:(0,D.useCallback)((function(e){var t;null!==(t=e.currentTarget)&&void 0!==t&&t.contains(e.relatedTarget)||(An(),null==e||e.currentTarget.removeAttribute(J))}),[])}};function Pn(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pn(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Pn(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Bn=function(e){for(var t=null;;){var n,r;if(null!==(n=e)&&void 0!==n&&null!==(n=n.dataset)&&void 0!==n&&n.dragId&&(null===(r=e)||void 0===r||null===(r=r.dataset)||void 0===r||!r.groupBarItemId)){t=e;break}if("ui-designer-root"===e.id)break;e=e.parentNode}return t},_n=function(e){var t=(0,D.useContext)(oe),n=t.getKdesignerApi,r=t.fieldStatusSettingMode,a=(0,D.useMemo)((function(){return n()}),[]),l=a.data,o=a.meta,i=l.getRootId(),c=i===e[_],u=l.findControl(e[_]),d=null==u?void 0:u._Type_,s=(o.getControlMeta(d)||{}).IsContainer,p=void 0!==s&&s,m=(0,D.useCallback)((function(e){var t;e.stopPropagation();var n,r=e.currentTarget,a=(r=In(r)).dataset.dragId||null,o=[a],i=l.findControl(a),c=i._Type_,u=i.GroupParentId;!Vt(c)||null!==(t=r)&&void 0!==t&&null!==(t=t.dataset)&&void 0!==t&&t.groupBarItemId||(o=T()(n=l.findControlByCondition((function(e){return e.GroupParentId===u}))).call(n,(function(e){return e.Id})));Mn(o);var d=l.findControl(a),s=d._Type_,f=d.Name;yn(e,s,f)}),[i]),v=(0,D.useCallback)((function(e){var t,n=Bn(e.currentTarget);!n||null!=n&&null!==(t=n.dataset)&&void 0!==t&&t.dragOver||n.setAttribute(W,"true")}),[]),g=(0,D.useCallback)((function(e){var t=Bn(e.currentTarget);if(null!=t&&t.contains(e.relatedTarget)){var n=In(e.currentTarget);null!=n&&n.dataset.groupBarItemId&&null!=n&&n.dataset.dragDirection&&xn(n)}else null!=t&&t.dataset.dragOver&&t.removeAttribute(W)}),[]),y=p?{onDragEnter:v,onDragLeave:g}:{};return Rn(Rn((0,f.c)({},Y,e[_]),y),{},{onDragStart:m,draggable:!c&&!r})},On=function(e){if(!e)return{};e.Id;var t=e.Status,n=e.Visibility,r=e.Key,a=(0,D.useContext)(oe),l=a.fieldStatusSettingMode,o=a.isPC,i=a.fieldStatusMap,c=null==i?void 0:i[r];return(t!==Ze.HIDDEN||l&&c)&&function(e,t){return e&&"mob"!==t||!e&&"pc"!==t}(o,n)&&"hidden"!==c?{}:(0,f.c)({},"data-hidden",!0)};function jn(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jn(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):jn(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Kn=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=ie(e),r=sn();if(!e)return Ln({onMouseDown:r},n);var a=re(e),l=_n(e),o=On(e);return t?Ln(Ln(Ln({},a),n),{},{onMouseDown:r,dragEvent:l},o):Ln(Ln(Ln({},a),n),{},{onMouseDown:r})},Un=r(1252),Vn=r.n(Un),Gn=function(e){var t=e.field,n=Kn(t),r=(t._Type_,t.Id),a=t.Name||r,l=Vn()(["undefined-control-root","text-omit"]);return k().createElement("div",(0,B.c)({},n,{className:l}),a)},zn=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.isPC,a=void 0===r||r,l=n.excludeType,o=void 0===l?"":l,i=n.ctrlType,c=void 0===i?"":i,u=e[_],d=[],s=t[z].length,f=0;f<s;f++){var p=t[z][f],m=p[K];if(!(p[G]!==u||o&&o===m||c&&c!==m)){if(Vt(m)&&0!==Number(p.GroupIndex))continue;var v=Ol(p,{isPC:a});v&&d.push(v)}}return d},Hn=r.p+"images/34cd7b92da1639c0f67b4f2cb967347a.png",qn=r(2416),Yn=r(5873),Wn=(0,D.memo)((function(e){var t,n=e.field,r=(0,D.useContext)(oe),a=r.isPC,l=r.getKdesignerApi,o=r.prefixCls,i=r.baseUrl,c=l().data,u=n.ColumnSpan,d=n.Gutter,s=n.BackColor,p=n.BackImage,m=n.CustomStyle,v=c.getData(),g=c.getRootId(),y=c.findControl,C=Kn(n,!1),h=zn(n,v,{isPC:a,excludeType:Ve},y),E=Vn()("".concat(o,"-root-panel"),(0,f.c)({},b()(t="".concat(o,"-root-panel-")).call(t,a?"isPC":"isMb"),!0)),I=(0,D.useMemo)((function(){var e;return k().createElement("div",{className:b()(e="".concat(o,"-root-panel-")).call(e,a?"isPC":"isMb","-empty")},k().createElement("img",{src:Hn,alt:"暂无数据",className:"empty-img"}),k().createElement("div",{className:"empty-desc"},"您还没有内容，点击或拖拽左侧内容新建"))}),[a]),N=(0,D.useCallback)((function(){return k().createElement("div",{className:"".concat(o,"-root-panel-content"),style:a?{padding:"24px"}:{}},a?k().createElement(qn.GridPanel,{column:u,gutter:d||[24,24],id:"root-grid-panel"},null==h?void 0:T()(h).call(h,(function(e,t){var n,r;return k().cloneElement(e,{itemKey:e.key||(null==e||null===(n=e.props)||void 0===n||null===(n=n.field)||void 0===n?void 0:n.key),columnSpan:null==e||null===(r=e.props)||void 0===r||null===(r=r.field)||void 0===r?void 0:r.ColumnSpan})}))):h)}),[a,h,u,d,qn.GridPanel]),x=null==v?void 0:v.name,A=a?qn.FormBanner:Yn.FormBanner,F=(0,D.useMemo)((function(){return m&&k().createElement(A,{title:x,image:Yt(i.picture,p)})}),[m,x,i.picture,p,A,Yt]),S=wn();return k().createElement("div",{className:"".concat(o,"-root-panel-wrapper"),style:{backgroundColor:m&&s},"data-drag-id":g},k().createElement("div",(0,B.c)({id:"ui-designer-root"},C,{className:E},S),h.length?k().createElement("div",{className:"".concat(o,"-root-panel-scroll")},F,N()):k().createElement(k().Fragment,null,F,I)))}));Wn.displayName="RootPanel";var Xn=Wn,Qn=(0,D.forwardRef)((function(e,t){var n=e.prefixCls,r=e.value,a=e.maxLength,l=e.style,o=e.onBlur,i=(0,D.useState)(r),c=(0,s.c)(i,2),u=c[0],d=c[1];(0,D.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.select()}),[]);var f=(0,D.useCallback)((function(e){var t=e.target.value;d(t)}),[d]),p=function(){var e,n=document.getElementById(je);null==t||null===(e=t.current)||void 0===e||e.blur(),setTimeout((function(){null==n||n.focus()}),0)},m=(0,D.useCallback)((function(e){e.stopPropagation(),e.ctrlKey&&(e.preventDefault(),p()),e.keyCode===M.keyCode.ENTER&&p()}),[]);return k().createElement("input",{ref:t,style:l,type:"text",value:u,maxLength:a,className:"".concat(n,"-global-edit-control-name"),onBlur:o,onChange:f,onKeyDown:m})})),Zn=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=(0,D.useContext)(oe),r=n.prefixCls,a=n.getKdesignerApi,l=(0,D.useContext)(M.GlobalConfigContext).showMessage,o=a(),i=o.data,c=o.meta,u=e.Id,d=(0,D.useRef)(null),s=(0,D.useRef)(null),p=(0,D.useRef)(null),m=(0,D.useRef)(null),v=(0,D.useCallback)((function(){var e;s.current&&d.current&&(null==m||null===(e=m.current)||void 0===e||e.blur())}),[]),g=(0,D.useCallback)((function(){p.current=window.requestAnimationFrame(v)}),[]),y=(0,D.useCallback)((function(){le().unmountComponentAtNode(d.current),document.body.removeChild(d.current),d.current=null,s.current=null;var e=document.getElementById("ui-designer-root");null==e||e.removeEventListener("scroll",g,!0),p.current&&window.cancelAnimationFrame(p.current)}),[]),C=(0,D.useCallback)((function(e){var t=(i.findControl(u)||{}).Name;e.target.value||l("控件名称不能为空");var n=e.target.value||t;n!==t&&i.batchUpdateControlPropertyValues((0,M.createUpdateAction)([[u,{Name:n}]])),y()}),[]),h=(0,D.useCallback)((function(e){s.current=e;var t,n,a,l=(null==e?void 0:e.getBoundingClientRect())||{},o=l.left,f=l.top,p=l.width,v=l.height,y=i.findControl(u),h=y.Name,E=y._Type_,I=c.getControlMetaEditor(E,"Name").MaxLength;d.current||(d.current=document.createElement("div"),d.current.style.cssText=b()(t=b()(n=b()(a="position: fixed;z-index: 0;left: ".concat(o+1,"px;top: ")).call(a,f,"px;width: ")).call(n,p-2,"px;height: ")).call(t,v,"px;background: transparent;"));le().render(k().createElement(Qn,{ref:m,prefixCls:r,value:h,maxLength:I,style:{width:"100%",height:"".concat(v-1,"px")},onBlur:C}),d.current),document.body.appendChild(d.current);var N=document.getElementById("ui-designer-root");null==N||N.addEventListener("scroll",g,!0)}),[]),E=(0,D.useCallback)((function(e){var t=e.currentTarget;h(t)}),[]),I=(0,D.useCallback)((function(e){if(d.current&&e!==u)y(),M.eventBus.off("add-control-id",I);else if(t&&e===u){var n,r,a=document.querySelector(b()(n=b()(r="[".concat(q,'="')).call(r,u,'"] [')).call(n,ne,'="true"]'));if(!a)return;h(a)}}),[]);return(0,D.useEffect)((function(){return M.eventBus.on("add-control-id",I),function(){M.eventBus.off("add-control-id",I)}}),[]),(0,f.c)({onDoubleClick:E},ne,!0)},Jn=["field","children","tipsTrigger","dragEvent","wrapperStyle"],$n=function(e,t){var n=e.Key;return function(e){var t=e.MustInput,n=e.FieldRequired;return e.Status===Ze.DEFAULT&&(t||"2"===n||"3"===n)}(e)&&!Mt(t[n])||"mustInput"===t[n]},er=function(e){var t,n,r=(0,D.useContext)(oe),a=r.isPC,l=r.prefixCls,o=r.fieldStatusMap,i=e.field,c=e.children,u=e.tipsTrigger,d=e.dragEvent,s=void 0===d?{}:d,p=e.wrapperStyle,m=void 0===p?{}:p,v=(0,he.c)(e,Jn),g=i.Name,y=i.LabelWidth,C=(i.ShowTitle,i.HelpTips),h=i.TitleArea,E=(i.MustInput,i.Status,i.FieldRequired,i.Key),I=!vt(h),N=(0,B.c)({width:y},e.labelStyle),T=Zn(i),x=$n(i,o),A=(0,B.c)({padding:"0 12px",margin:"0 -12px"},m);return a?k().createElement("div",(0,B.c)({style:A},s),k().createElement(qn.FieldItem,(0,B.c)({className:Vn()((0,f.c)({},b()(n="".concat(l,"-item-")).call(n,o[E]),o[E])),labelClassName:"".concat(l,"-designer-field-item"),labelProps:T,labelText:g,required:x,labelStyle:N,showTitle:I,tips:C,tipsTrigger:a?u:"click",tipsDisabled:!0},v),c)):k().createElement(qn.FieldItem,(0,B.c)({className:Vn()((0,f.c)({},b()(t="".concat(l,"-item-")).call(t,o[E]),o[E])),labelClassName:"".concat(l,"-designer-field-item"),labelProps:T,labelText:g,required:x,labelStyle:N,showTitle:I,tips:C,tipsTrigger:a?u:"click",tipsDisabled:!0},v,s),c)},tr=(0,D.memo)((function(e){var t=e.value,n=(0,D.useContext)(oe).prefixCls;return k().createElement("p",{className:"".concat(n,"-readonly-text")},""===t||null==t?"-":t)})),nr=function(e){var t=e.type,n=e.field,r=void 0===n?{}:n,a=e.props,l=void 0===a?{}:a,o=e.isMb,i=void 0!==o&&o,c=r.Status,u=r.Key,d=(0,D.useContext)(oe),s=d.fieldStatusMap,f=d.fieldStatusSettingMode;if(c===Me.READONLY&&!Mt(s[u])||"readonly"===s[u])return k().createElement(tr,{value:l.readonlyValue||(null==r?void 0:r.DefValue)});var p=(0,D.useMemo)((function(){return i?Yn[t]:qn[t]}),[t]),m=function(e,t){var n,r=t.fieldStatusMap,a=e.EmptyText,l=e.NoCodeDefValue,o=e.ShowClearButton,i=e.Status,c=e.MaxLength,u=e.MinLength,d=e._Type_,s=e.DateRangeEmptyText,f=e.DateRangeDefValue,p=e.Key,m={readOnly:!0,disabled:(n=i,n===Me.DISABLED&&!Mt(r[p])||"disabled"===r[p])};if((0,De.isUndefined)(l)||et(d)||($e(d)?m.value=l&&Date.parse(l)?new Date(l):void 0:m.value=l),(0,De.isUndefined)(f)||(m.value=mt(f)),(0,De.isUndefined)(a)||(m.placeholder=a),Je(d)&&s){var v=s.start,g=void 0===v?"":v,y=s.end,C=void 0===y?"":y;m.placeholder=[g,C]}return(0,De.isUndefined)(o)||(m.allowClear=o),(0,De.isUndefined)(c)||(m.maxLength=c),(0,De.isUndefined)(u)||(m.mixLength=u),m}(r,{fieldStatusSettingMode:f,fieldStatusMap:s});return k().createElement(p,(0,B.c)({},m,l))},rr=function(e){return k().createElement(nr,(0,B.c)({isMb:!0},e))},ar=(0,D.memo)((function(e){var t=e.field,n=Kn(t),r={borderType:"bordered"};return k().createElement(er,(0,B.c)({},n,{field:t}),k().createElement(nr,{type:"Text",field:t,props:r}))}));ar.displayName="TextFieldAp";var lr=ar,or=function(e){var t,n=e.field,r=Kn(n),a=Rt(n),l=Ot(n),o={readonlyValue:wt(n),options:Bt(n),defaultValue:l,value:l,mode:Pt(null==n?void 0:n.SelectItemType)?"multiple":"single",showBgcBlock:_t(n)};return S()(t=["Checkbox","Radio"]).call(t,a)&&(o.vertical=jt(null==n?void 0:n.TileTypePc)),k().createElement(er,(0,B.c)({},r,{field:n}),k().createElement(nr,{type:a,field:n,props:o}))},ir="setListTreeConfig",cr="setFormRules",ur="setBizRules",dr="setRefBillTreeData",sr="setTreeNodeChildren",fr="setInputForm",pr="setRefPropDisp",mr="getSvgLine",vr="setSwitchFieldTypes",gr="showDesignerError",yr="setAvailableAssociationFields",Cr="updateAssociation",hr="loadDesignerMetadata",br=["field"];function Er(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ir(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Er(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Er(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Nr=function(e){var t,n=e.field,r=((0,he.c)(e,br),(0,D.useState)([])),a=(0,s.c)(r,2),l=a[0],o=a[1],i=(0,D.useContext)(oe).getKdesignerApi,c=Kn(n),u=((0,D.useMemo)((function(){return i()}),[]).data.getData(),n.EmptyText,n.DataRage,n.showClearButton,n.Status),d=n.ShowType,f=n.PropsDisplay;n.Visibility;(0,D.useEffect)((function(){return M.eventBus.on(pr,p),function(){M.eventBus.off(pr,p)}}),[]);Ze.DISABLED;var p=(0,D.useCallback)((function(e){var t=T()(e).call(e,(function(e){return{fieldCaption:e.PropCap,fieldName:e.PropKey,items:e.items,type:e.type}}));o(t||[])}),[]);f&&(null===(t=f.split(","))||void 0===t||T()(t).call(t,(function(e){var t=(null==l?void 0:Ae()(l).call(l,(function(t){return t.fieldName===e})))||{},n=t.fieldCaption;t.type;return{ApType:"NoCodeTextFieldAp",FieldType:"NoCodeTextField",Id:t.fieldName,Name:n,_Type_:"NoCodeTextField"}}))),Ir({ShowSeqField:!0,SeqName:"序号",ShowBatExportBtn:!1,ShowBatImportBtn:!1,showAddRowBtn:!1,EntityData:Ir(Ir({},n.EntityData),{},{_Type_:"NoCodeEntryEntity"}),operations:["取消"]},n);return"1"===d?k().createElement(er,(0,B.c)({},c,{field:n}),k().createElement(nr,{type:"RefBill",field:n})):null},Tr=function(e){var t=e.field,n=Kn(t),r=t.CounterDisplay,a=t.DefaultLines,l={showCount:!!(0,De.isUndefined)(r)||r,autoSize:{minRows:a||1,maxRows:a||1},style:{pointerEvents:"none"}};return k().createElement(er,(0,B.c)({},n,{field:t}),k().createElement(nr,{type:"Textarea",field:t,props:l}))},xr=function(e){var t=e.field,n=Kn(t),r=(t.EmptyText,t.DefValue,t.showClearButton,t.Status,t.ThousandsSeparator),a=t.Scale,l=t.Precision,o=t.Stepper,i={borderType:"bordered",readOnly:!0,allowClear:!1,formatter:(0,D.useCallback)((function(e){return r?Gt("".concat(e)):String(e)}),[r]),decimalLength:a,maxLength:l,showStepper:o};return k().createElement(er,(0,B.c)({},n,{field:t}),k().createElement(nr,{type:"Number",field:t,props:i}))},Ar=new(Pe())([["2","month"],["3","year"]]),Fr=function(e){var t=e.field,n=Kn(t),r=t.FormatType,a={borderType:"bordered",showTime:"0"===r,readOnly:!0,allowClear:!1,picker:Ar.get(r)||"date"};return k().createElement(er,(0,B.c)({},n,{field:t}),k().createElement(nr,{type:"DatePicker",field:t,props:a}))},Sr=function(e){var t=e.field,n=Kn(t),r={borderType:"bordered",showTime:"0"===t.FormatType,readOnly:!0,allowClear:!1};return t=$t(t,"DateRangeDefValue"),k().createElement(er,(0,B.c)({},n,{field:t}),k().createElement(nr,{type:"DateRangePicker",field:t,props:r}))},Dr=r(1848),kr=r.n(Dr),Mr=["ShowSelChexkbox","ShowSeqField","SeqName","ShowBatExportBtn","ShowBatImportBtn"],wr=["field","className","showSeqField","showSelChexkbox","seqName","operations","subControls","showBatImportBtn","showBatExportBtn","showAddRowBtn"],Pr=function(e){var t=e.field,n=Kn(t),r=t.ShowSelChexkbox,a=t.ShowSeqField,l=t.SeqName,o=void 0===l?"序号":l,i=t.ShowBatExportBtn,c=t.ShowBatImportBtn,u=(0,he.c)(t,Mr),d=(0,D.useRef)(null);return"1"===u.ShowType?null:k().createElement(er,(0,B.c)({field:t,tipsTrigger:"click"},n,{wrapperStyle:{margin:0,padding:0}}),k().createElement(Rr,(0,B.c)({showSeqField:a,showSelChexkbox:r,seqName:o,ref:d,field:t,showBatExportBtn:i,showBatImportBtn:c},u)))},Rr=(0,D.forwardRef)((function(e,t){var n,r,a,l=e.field,o=e.className,i=(e.showSeqField,e.showSelChexkbox,e.seqName),c=e.operations,u=void 0===c?["复制","删除","更多"]:c,d=e.subControls,s=(e.showBatImportBtn,e.showBatExportBtn,e.showAddRowBtn,(0,he.c)(e,wr),(0,D.useContext)(M.ConfigContext)),p=s.getPrefixCls,m=(s.prefixCls,(0,D.useContext)(oe).getKdesignerApi),v=(0,D.useMemo)((function(){return m()}),[]).data,g=p("nocode-designer-entry"),y=v.getData(),C=d||zn(l,y,{},v.findControl),h=Vn()((0,f.c)((0,f.c)({},"".concat(g,"-body"),!0),o,o)),E=kr()(n=new Array(1)).call(n,"");return C.length?k().createElement("div",{className:"".concat(g),ref:t},k().createElement("div",{className:"".concat(g,"-toolbar")},k().createElement("div",{className:"".concat(g,"-toolbar-btns")},k().createElement(P.Button,{size:"small",className:"add-btn",icon:k().createElement(P.Icon,{prefix:"ncicon",type:"zengjia-yuan"}),type:"ghost"},"新增"),k().createElement(P.Button,{size:"small",className:"import-btn",icon:k().createElement(P.Icon,{prefix:"ncicon",type:"daoru"})},"导入"))),k().createElement("div",{className:h},k().createElement("div",{className:"".concat(g,"-grid-view")},k().createElement("ul",{className:b()(r="".concat(g,"-checkbox-col ")).call(r,g,"-sticky"),style:{left:0}},k().createElement("li",{className:"thead"},k().createElement("span",{className:"checkbox"})),k().createElement("li",null,k().createElement("span",{className:"checkbox"}))),k().createElement("ul",{className:b()(a="".concat(g,"-seqcol ")).call(a,g,"-sticky"),style:{left:40}},k().createElement("li",{className:"thead",title:i},i),k().createElement("li",null,"1")),k().createElement("div",{className:"".concat(g,"-main")},C),((null==C?void 0:C.length)>0||u.length>0)&&k().createElement("ul",{className:"".concat(g,"-sticky-right")},k().createElement("li",{className:"thead"},"操作"),T()(E).call(E,(function(e,t){return k().createElement("li",{key:t},T()(u).call(u,(function(e,t){return k().createElement("div",{key:t,className:"op"},e)})))})))))):k().createElement("div",{className:"".concat(g,"-empty")},"拖拽或点击添加内容")})),Br=r(2796),_r=r.n(Br),Or=r(8429),jr=r.n(Or),Lr=r(1900),Kr=r.n(Lr),Ur="INIT_FORM_DATA",Vr="UPDATE_FORM_DATA",Gr="UPDATE_CONTROL_PROPS",zr="ADD_CONTROL",Hr="DEL_CONTROL",qr="UPDATE_APP_FORM_LIST",Yr=(0,D.memo)((function(e){var t=e.prefixClass,n=e.defaultBatchValue,r=e.handleAddOption,a=(0,D.useState)(!1),l=(0,s.c)(a,2),o=l[0],i=l[1],c=(0,D.useState)(n),u=(0,s.c)(c,2),d=u[0],f=u[1];(0,D.useEffect)((function(){f(n)}),[n]);var p=k().createElement("div",{className:"".concat(t,"_batchaddpanel_form")},k().createElement("label",{className:"".concat(t,"_batchaddpanel_form_label")},"每行对应一个选项"),k().createElement(P.TextArea,{className:"".concat(t,"_batchaddpanel_form_textarea"),defaultValue:d,value:d,placeholder:"请输入",borderType:"bordered",count:!1,autoSize:{minRows:19,maxRows:19},maxLength:2e3,onChange:function(e){f(e.target.value)}})),m=(0,D.useCallback)((function(){var e,t=null==d?void 0:g()(e=d.split(/[\r\n\t]/)).call(e,Boolean),n=(0,R.c)(new(hn())(t));f(n.join("\n")),r(n),i(!1)}),[d,r]),v=(0,D.useCallback)((function(){f(n),i(!1)}),[n]),y=(0,D.useMemo)((function(){var e="".concat(t,"_batchaddpanel_footer");return k().createElement("div",{className:e},k().createElement("div",{className:"".concat(e,"_action")},k().createElement(P.Button,{size:"small",className:Vn()("".concat(e,"_action_btn"),"".concat(e,"_action_cancel")),onClick:v},"取消"),k().createElement(P.Button,{size:"small",type:"primary",className:Vn()("".concat(e,"_action_btn"),"".concat(e,"_action_copy")),onClick:m},"确定")))}),[m]);return k().createElement(k().Fragment,null,k().createElement("div",{className:"".concat(t,"-handle-batchadd"),onClick:function(){i(!0)}},"批量编辑"),o&&k().createElement(P.Modal,{className:"".concat(t,"_batchaddpanel"),bodyClassName:"".concat(t,"_batchaddpanel_body"),body:p,title:"批量编辑",onCancel:function(){return i(!1)},onOk:function(){return i(!1)},visible:o,height:560,footer:y}))})),Wr=r(5288),Xr=r.n(Wr),Qr=(0,D.memo)((function(e){var t=e.className,n=e.value,r=e.colorList,a=void 0===r?[]:r,l=e.onChange,o=e.renderIcon,i=(0,D.useContext)(oe),c=i.getPrefixCls,u=i.prefixCls,d=c&&c(u,"colorpicker-content"),f=(0,D.useState)(n),p=(0,s.c)(f,2),m=p[0],v=p[1];(0,D.useEffect)((function(){!(0,De.isUndefined)(n)&&v(n)}),[n]);return k().createElement("ul",{className:Vn()("".concat(d),t)},null==a?void 0:T()(a).call(a,(function(e){return k().createElement("li",{onClick:function(){return function(e){v(e),null==l||l(e)}(e)},key:e,className:"".concat(d,"-item"),style:{backgroundColor:e}},m===e&&("function"==typeof o?o():k().createElement(P.Icon,{className:Vn()("".concat(d,"-item-light")),prefix:"designericon",type:"shuzhankaibeifen"})))})))})),Zr=Qr,Jr=["#E0EFFF","#CFF7FF","#D6FFF8","#DCFAE4","#EDFFBD","#FFF8B8","#FFF1D4","#FFE7D6","#FFDBE0","#FFC4CF","#ECD6FF","#C7E5FF","#E5E5E5"],$r=["#276FF5","#16B0F1","#16B8B1","#1BA854","#77C404","#FDC200","#FF991C","#FF5F1F","#FB2323","#F90D58","#701DF0","#0E5FD8","#999999"],ea=function(e){var t=e.prefixClass,n=e.value,r=e.onChange,a=(0,D.useState)(!1),l=(0,s.c)(a,2),o=l[0],i=l[1],c=(0,D.useState)(n),u=(0,s.c)(c,2),d=u[0],p=u[1];(0,D.useEffect)((function(){!(0,De.isUndefined)(n)&&p(n)}),[n]);var m="".concat(t,"-colorpicker"),v=function(e){p(e),null==r||r(e),i(!1)},g=k().createElement(P.Dropdown.Menu,{style:{width:380,padding:8}},k().createElement("div",{className:"".concat(m,"-content")},k().createElement(Zr,{colorList:Jr,onChange:v,value:d}),k().createElement(Zr,{renderIcon:function(){return k().createElement(P.Icon,{className:Vn()("".concat(m,"-content-list-item-dark")),prefix:"designericon",type:"shuzhankaibeifen"})},colorList:$r,onChange:v,value:d})));return k().createElement(P.Dropdown,{popperClassName:"".concat(m,"-popup"),placement:"bottomLeft",menu:g,trigger:"click",visible:o,onVisibleChange:function(e){return i(e)}},k().createElement("div",{style:{backgroundColor:d},className:m},k().createElement(P.Icon,{className:Vn()("".concat(m,"-arrow"),(0,f.c)((0,f.c)({},"".concat(m,"-arrow-up"),o),"".concat(m,"-arrow-light"),S()($r).call($r,d))),prefix:"designericon",type:"zhankai3"})))};function ta(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function na(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ta(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):ta(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var ra=(0,D.memo)((function(e){var t=e.index,n=e.option,r=e.options,a=e.prefixClass,l=e.isNewOptionEdit,o=e.onDrop,i=e.handleEditOption,c=e.handleDeleteOption,u=e.bgcolorChecked,d=(0,D.useState)(!1),p=(0,s.c)(d,2),m=(p[0],p[1]),v=(0,D.useState)(l),g=(0,s.c)(v,2),y=g[0],C=g[1],h=(0,D.useState)(na({},n)),b=(0,s.c)(h,2),E=b[0],I=b[1],N=(0,D.useRef)(null),T=(0,D.useRef)(null),x=(0,D.useRef)(null),A="".concat(a,"-item");(0,D.useEffect)((function(){I(na({},n))}),[n]),(0,D.useEffect)((function(){T.current&&y&&T.current.select()}),[T,y]);var F=(0,D.useCallback)((function(e){e.persist();var t=e.target.value,n=na(na({},E),{},(0,f.c)((0,f.c)({},V,t),U,fa(t)));I(n)}),[E]),S=(0,D.useCallback)((function(e){e.persist(),I((function(t){return na(na({},t),{},(0,f.c)({},U,e.target.value))}))}),[]),M=(P.Dropdown.Menu,"".concat(A,"-detail-item"),P.Input,n[V],E[V],"".concat(A,"-detail-input"),"".concat(A,"-detail-item"),P.Input,n[U],E[U],"".concat(A,"-detail-input"),function(){var e;if(C(!1),E[V]&&null!==(e=E[V])&&void 0!==e&&Xr()(e).call(e)){var t=Ae()(r).call(r,(function(e){return e[V]===E[V]}));t&&E[_]!==t[_]?c(n[_]):i(E)}else c(n[_])});return k().createElement(qn.Draggable,{index:t,onDrop:o},k().createElement("div",{className:"".concat(A,"-wrapper")},k().createElement("div",{className:A},u&&k().createElement(ea,{value:n[H],prefixClass:a,onChange:function(e){var t=na(na({},E),{},(0,f.c)({},H,e));I(t),i(t)}}),k().createElement("div",{title:"双击修改显示值",className:"".concat(A,"-content"),onDoubleClick:function(){C(!0),m(!1)}},y?k().createElement(P.Input,{ref:T,className:"".concat(A,"-content_edit"),borderType:"bordered",size:"large",defaultValue:n[V],onBlur:M,onPressEnter:M,onChange:function(e){e.persist();var t=e.target.value;I((function(e){return na(na({},e),{},(0,f.c)((0,f.c)({},V,t),U,fa(t)))}))}}):k().createElement("p",null,n[V])),k().createElement("div",{className:"".concat(A,"-operate")},!y&&-1===n[_].indexOf(ca)&&k().createElement(P.Icon,{className:"".concat(A,"-operate-edit"),prefix:"designericon",type:"bianji3",onClick:function(){C(!0)},ref:N}),k().createElement(P.Icon,{className:"".concat(A,"-operate-drag"),prefix:"designericon",type:"tuozhuailiebiao"}))),k().createElement("div",{title:"删除选项",className:"".concat(A,"-delete"),onClick:function(){return c(n[_])}},k().createElement(P.Icon,{prefix:"designericon",type:"xingshanchu"}))))})),aa=ra;function la(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function oa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?la(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):la(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var ia=r(7136).hooks.useOnDrop,ca="other",ua=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=g()(e).call(e,(function(e){return!S()(t).call(t,e)})),r=0;r<n.length;r++){var a=r+Math.floor(Math.random()*(n.length-r)),l=[n[a],n[r]];n[r]=l[0],n[a]=l[1]}return b()(t).call(t,n)},da=(0,R.c)(Se()($r).call($r,0,-1)),sa=function(e){return e&&Array.isArray(e)&&0!==e.length?T()(e).call(e,(function(e){return e[_]?e:oa(oa({},e),{},(0,f.c)({},_,(0,M.createUUid)()))})):e},fa=function(e){return encodeURIComponent(e)},pa=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.editor,l=(e.locked,e.Name),o=e.Tips,i=(e.field,a.Enum,a.NameHidden),c=a.Default,u=a.Required,d=a.Title,p="".concat(r,"-custom-option"),m=(0,D.useState)((0,De.isUndefined)(n)?[]:sa(function(e){return Array.isArray(e)?e:null==e?void 0:e.ops}(n||c))||[]),v=(0,s.c)(m,2),y=v[0],C=v[1],h=(0,D.useState)(""),E=(0,s.c)(h,2),I=E[0],N=E[1],x=(0,D.useState)((0,De.isUndefined)(null==n?void 0:n.bgcSwitch)?null==c?void 0:c.bgcSwitch:null==n?void 0:n.bgcSwitch),A=(0,s.c)(x,2),F=A[0],w=A[1],R=(0,D.useRef)(null==y?void 0:y.some((function(e){return e[_].indexOf(ca)>-1}))),B=(0,D.useRef)(null),O=(0,D.useRef)({});(0,D.useEffect)((function(){var e="";O.current={},null==y||y.forEach((function(t){var n,r=null==t?void 0:t[V];r&&(e="".concat(e?e+"\n"+r:r),((null===(n=t[_])||void 0===n?void 0:n.indexOf(ca))>-1||"其他"===t[V]||"其他"===t[U])&&(R.current=!0))})),N(e)}),[y]),(0,D.useLayoutEffect)((function(){F||(da=ua(g()(da).call(da,(function(e){return!S()(Jr).call(Jr,e)}))))}),[F]),(0,D.useEffect)((function(){var e,t=g()(e=T()(y).call(y,(function(e){return e[H]}))).call(e,Boolean);da=ua(da,t)}),[]);var j=function(e){var n=[];if(Array.isArray(e))n=T()(e).call(e,(function(e,t){var n=(0,f.c)((0,f.c)((0,f.c)({},V,e),U,fa(e)),_,(0,M.createUUid)());return F&&(n[H]=da[t%da.length]),n})),function(e){Array.isArray(e)&&(C(e),t({bgcSwitch:F,ops:e}))}(n);else{var r=(0,f.c)((0,f.c)((0,f.c)({},_,(0,M.createUUid)()),V,""),U,"");F&&(r[H]=da[((null==y?void 0:y.length)||0)%da.length]),B.current=r,n=y?null==y?void 0:b()(y).call(y,r):[r],C(n)}},L=function(e){if(null!=e&&e[_]){var n=null==y?void 0:T()(y).call(y,(function(t){return t[_]===e[_]?e:t}));C(n),t({bgcSwitch:F,ops:n})}},K=function(e){if(e){var n=g()(y).call(y,(function(t){return t[_]!==e}));C(n),0===n.length&&F===(null==c?void 0:c.bgcSwitch)?t({bgcSwitch:F,empty:!0}):t({bgcSwitch:F,ops:n})}},G=(0,D.useCallback)((function(e){if(e){var n=e.sourceIndex,r=e.destinationIndex,a=(0,De.cloneDeep)(y),l=ue()(a).call(a,n,1)[0];ue()(a).call(a,r,0,l),t({bgcSwitch:F,ops:a}),C(a)}}),[y,F,t]),z=ia(G);return k().createElement("div",{className:p},k().createElement("div",{className:"".concat(p,"-title")},k().createElement(M.NameTipWrapper,{nameHidden:i,className:r,name:l,tips:o,required:u,title:d}),k().createElement("div",{className:"".concat(p,"-title-colorswitch")},k().createElement("span",{className:"".concat(p,"-title-colorswitch-text")},"彩色"),k().createElement(P.Switch,{checked:F,onChange:function(e){w(e);var n=null==y?void 0:T()(y).call(y,(function(t,n){if(e&&(0,De.isUndefined)(t.Bgc)){var r=da[n%da.length];return oa((0,f.c)({},H,r),t)}var a=(0,De.cloneDeep)(t);return delete a[H],a}));C(n),t({bgcSwitch:e,ops:n})}}))),k().createElement(qn.DragContainer,null,k().createElement("div",{className:Vn()("".concat(p,"-list"))},null==y?void 0:T()(y).call(y,(function(e,t){var n;return k().createElement(aa,{key:e[_],index:t,options:y,option:e,prefixClass:p,handleDeleteOption:K,handleEditOption:L,isNewOptionEdit:(null===(n=B.current)||void 0===n?void 0:n[_])===e[_],bgcolorChecked:F,onDrop:z})})))),k().createElement("div",{className:Vn()("".concat(p,"-handle"))},k().createElement("div",{className:Vn()("".concat(p,"-handle-addoption")),onClick:function(){return j()}},k().createElement(P.Icon,{prefix:"designericon",type:"zengjia-yuan"}),k().createElement("span",null,"添加选项")),k().createElement(Yr,{prefixClass:p,defaultBatchValue:I,handleAddOption:j})))};function ma(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function va(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ma(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):ma(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var ga=(0,R.c)(Se()($r).call($r,0,-1)),ya=function(e){return S()(qe).call(qe,e)},Ca=function(e,t,n){var r=t._Type_,a=t.EntityData,l=void 0===a?{}:a,o=[],i=m()(e).reduce((function(t,a){var l=n.getControlMetaProperty(r,a),i=n.getControlPropertyDefaultValue(r,a),c=l.Tag;return c!==_e&&c!==Oe||(t[a]=e[a],(0,De.isEqual)(e[a],i)&&o.push(a)),t}),{});return(0,Ct.produce)(l,(function(e){(0,B.c)(e,i),o.forEach((function(t){delete e[t]}))}))},ha=function(e,t,n,r){r.globalConfig,r.dataContext,r.selectionContext,r.action,r.dataFactory,r.modelFactory;var a=r.metaReader;if(!n)return!1;var l=n._Type_,o=n.EntityData,i=void 0===o?{}:o;if(ya(l))return!1;var c=[],u=m()(t).reduce((function(e,n){var r=a.getControlMetaProperty(l,n),o=a.getControlPropertyDefaultValue(l,n),i=r.Tag;return i!==_e&&i!==Oe||(e[n]=t[n],(0,De.isEqual)(t[n],o)&&c.push(n)),e}),{}),d=(0,Ct.produce)(i,(function(e){(0,B.c)(e,u),c.forEach((function(t){delete e[t]}))}));return m()(u).length?(0,M.createUpdateAction)([[e,{EntityData:d}]]):void 0},ba=["ApType","EntityData",j,O,_,"Index","Features","FieldName",G],Ea=function(e,t){return"string"==typeof e?e:(null==e?void 0:e[t])||(null==e?void 0:e.Default)},Ia=function(e,t){var n=t.dataContext,r=t.metaReader,a=e._Type_,l=e.Id,o=e.ParentId,i=n.getRootId();if(ut(a))return e;var c=n.findControl(o),u=c._Type_,d=c.Status,s=r.getControlMeta(a),f=s.ApType,p=s.BaseType,v=r.getControlMeta(u).BaseType;if(f&&!ya(a)){var g,y=m()(e).reduce((function(t,n){var l=r.getControlMetaProperty(a,n).Tag;return(l===_e||l===Oe||S()(Be).call(Be,n))&&(t[n]=e[n]),t}),{});Vt(u)&&(y.ParentId=i);var C="".concat(p,"Id");if(e[C]=l,e.FieldType=a,e.ApType=Ea(f,v),dt(a)&&(null==y||null===(g=y.CustomContent)||void 0===g||null===(g=g.ops)||void 0===g||!g.length)){var h;ga=ua(ga);var b=r.getControlPropertyDefaultValue(a,"CustomContent"),E=T()(h=b.ops).call(h,(function(e,t){return va(va({},e),{},{Bgc:ga[t]})})),I={bgcSwitch:!0,ops:sa(E)};e.CustomContent=I,(0,B.c)(y,{CustomContent:I})}e.EntityData=y}return(ot(u)||it(u))&&(e._isEntryField_=!0),Vt(u)&&d&&(e.Status=d),e};function Na(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ta(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Na(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Na(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var xa=function(e,t){var n,r=e.SourceForm,a=e.BillEntityIdEx,l=new(hn())(t);return"1"===r||!(!a||S()(n=["bos_user","bos_adminorg"]).call(n,a))&&l.has(a)},Aa=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return t?[T()(t).call(t,(function(t){var l=t||{},o=l.label,i=l.value,c=l.children,u=l.icon,d=l.customParams,s=Ta({key:i,title:o},n);return u&&(s.icon=u),c?(c.length&&(s.children=e(c,{},null==d?void 0:d.currentApp,a)[0]),s.checkable=!1,s.selectable=!1):s.isLeaf=!0,r&&a.push(i),s})),a]:t},Fa=function(e){var t=(null==e?void 0:e.FieldType)||e._Type_;return it(t)&&"1"===e.ShowType||et(t)&&"2"===e.ShowType},Sa=function(e){var t;return S()(t=["NoCodeCreatorField","NoCodeCreateDateField","NoCodeModifierField","NoCodeModifyDateField","NoCodeBillNoField"]).call(t,e)},Da=function(e,t){var n=["NoCodeRefBillTable","NoCodeRichTextField","NoCodeGroupContainerAp","NoCodeGraphicDisplayField"];return S()(n).call(n,e)},ka=function(e,t){var n={},r="string"==typeof t?t:(0,R.c)(t).join(),a=S()(r).call(r,"_startdate")?r.replace("_startdate","").replace("_enddate",""):r,l=new(hn())(a.split(",")),o=[];return e.forEach((function(e){l.add(e.Key),n[e.Key]=e})),l.forEach((function(e){null!=n&&n[e]&&o.push(n[e])})),o},Ma=function(e,t){var n,r;return e.EntityData=t,e.ApType=nt(t._Type_)?"NoCodeSystemAp":e._Type_,e._Type_=t._Type_,e.FieldType=t._Type_,n=e,r=t,m()(r).forEach((function(e){_r()(n,e)||(0,B.c)(n,(0,f.c)({},e,r[e]))})),e},wa=function(e,t){var n,r,a,l,o=t||{},i=o.Id,c=o.SourceForm,u=o.PropsDisplay,d=o.inner2Outer,s=o.BillEntityIdEx,f=(0,De.cloneDeep)(e),p=new(hn())(u?u.split(","):[]),m=s||"".concat(i,"_table"),v=(null==f||null===(n=f.entitymeta)||void 0===n?void 0:n.Items)||[],g=(null==f||null===(r=f.formmeta)||void 0===r?void 0:r.Items)||[],y={},C=[],h=S()(a=["bos_user","bos_adminorg"]).call(a,m),b=new(hn());return null==f||null===(l=f.formmeta)||void 0===l||null===(l=l.Items)||void 0===l||l.forEach((function(e){y[e.Id]=e})),v.length&&(g.forEach((function(e){(Vt(e._Type_)||ct(e._Type_))&&b.add(e.Id)})),v.forEach((function(e){var t,n,r=Ma((null==y?void 0:y[e.Id])||{},e);if(r._isEntryField_=!0,"1"===c)!(d||!Sa(e._Type_))||Da(e._Type_)||Vt(e._Type_)||ct(e._Type_)||(r.isShow=!d||p.has(e.Key),C.push(r));else if(h||(Sa(e._Type_)||b.has(null==r?void 0:r.ParentId))&&!Da(r._Type_)){var a=p.has(e.Key);Je(e._Type_)&&(t=e.Key,n=p,a=(0,R.c)(n).some((function(e){return S()(e).call(e,t)}))),r.isShow=a,C.push(r)}}))),C},Pa=function(e,t,n,r,a,l,o){var i=[],c=e.reduce((function(e,l){var o,c=r.findControl(l)||{},u=c.ParentId,d=c.Key,s=c.RefTableId,f=c.RefBillId,p=c._Type_,m=r.findControl(u)||{},v=m._Type_,g=m.SourceForm,y=m.BillEntityIdEx,C=m.PropsDisplay;if(it(v)){var h,E="1"!==g||y?y:"".concat(u,"_table"),I=l.replace("_".concat(u),"");"1"!==g&&S()(h=t[E].ids).call(h,I)||n({key:Hr,payload:{form:E,id:I}});var N=new(hn())(C?C.split(","):[]),T=d.toLowerCase().replace("_".concat(u.toLowerCase()),"");Je(p)?(N.delete("".concat(T,"_startdate")),N.delete("".concat(T,"_enddate"))):N.delete(T);var x=(0,R.c)(N).join();i=[[u,{PropsDisplay:x}]]}return f&&delete a[f],s&&A()(a).forEach((function(e){e.Id!==s&&e.ParentId!==s||delete a[e.Id]})),b()(o=[]).call(o,(0,R.c)(e),[l])}),[]);l(a),jr().all([r.deleteControl((0,M.createDeleteAction)(c)),r.batchUpdateControlPropertyValues((0,M.createUpdateAction)(i))]).then((function(){null==o||o()})).catch((function(e){}))},Ra=function(e,t){var n,r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[{},{}],l=e.Id,o=e.Key,i=e._Type_,c=e.EntityData,u=(0,De.cloneDeep)(e),d=t.toLowerCase(),s=o.toLowerCase(),f=S()(s).call(s,d)?s:b()(n="".concat(s,"_")).call(n,d),p=S()(l).call(l,t)?l:b()(r="".concat(l,"_")).call(r,t);return["isShow","UploadDefValue","PictureDefValue","NoCodeDefValue","FieldRequired","Status","Visibility"].forEach((function(e){delete u[e],delete c[e]})),Je(i)&&(u.StartDateFieldKey="".concat(f,"_startdate"),u.EndDateFieldKey="".concat(f,"_enddate"),u.EntityData.StartDateFieldKey="".concat(f,"_startdate"),u.EntityData.EndDateFieldKey="".concat(f,"_enddate")),Ta(Ta(Ta({},u),{},{Id:p,Key:f,ParentId:t,FieldId:p},a[0]),{},{EntityData:Ta(Ta({},c),{},{Id:p,Key:f,ParentId:t},a[1]),_isEntryField_:!0})},Ba=function(e,t,n,r){var a=t.reduce((function(e,t){return Ta(Ta({},e),{},(0,f.c)({},t.Id,t))}),{}),l=[],o=e.reduce((function(e,t){var o=Ta({},t);if(t.isShow){var i,c;l.push(o.Key),delete o.isShow;var u=function(e,t,n){if(t){var r=n.getDefaultData(e._Type_),a=[{},{}];return Qe.forEach((function(l){var o=n.getControlMetaProperty(e._Type_,l).Tag,i=o===_e||o===Oe,c=t[l]||r[l];i?(c&&(a[1][l]=c),c&&(a[0][l]=c)):c&&(a[0][l]=c)})),a}}(t,a[b()(i="".concat(o.Id,"_")).call(i,n)],r);return b()(c=[]).call(c,(0,R.c)(e),[Ra(o,n,u)])}return e}),[]);return[o,l]},_a=["dragEvent"];function Oa(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ja(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oa(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Oa(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var La=function(e){var t,n=e.field,r=(e.rootWidth,e.rowHeight),a=e.headHeight,l=e.isMb,o=void 0!==l&&l,i=e.autoRowHeight,c=n.Id,u=n.Key,d=n.Name,s=n.ListFieldId,p=n.HelpTips,m=n.Status,v=Kn(n),g=v.dragEvent,y=(0,he.c)(v,_a),C=(0,D.useContext)(oe),h=C.prefixCls,E=C.fieldStatusMap,I=C.getKdesignerApi,N=C.billPropsData,T=C.fieldStatusSettingMode,x=(I()||{}).data,A=(0,D.useMemo)((function(){var e=x.getParentControl(c),t=x.findControl(c);return e.BillEntityIdEx!==x.getRootId()&&(!(null!=t&&t.RefBillId)&&!(null!=t&&t.RefTableId)&&it(e._Type_)&&xa(e,(null==N?void 0:N.innerForm)||[]))}),[N,c]),F=A?Zn(n):{},S=Vn()(["".concat(h,"-entry-field"),(0,f.c)({"item-mb":o,"item-hidden":m===Ze.HIDDEN},b()(t="".concat(h,"-item-")).call(t,E[u]),E[u])]),M=d,w={};return!i&&(w={height:r}),k().createElement("div",(0,B.c)({className:S},y,g,{"data-entry-field":n.Key,"data-enable-click":"permission"!==T||A}),k().createElement("div",(0,B.c)({className:"cellHead",style:{height:a}},F),k().createElement(qn.FieldItem.Label,{value:"fseq"===s?"#":M,required:$n(n,E),tips:p,prefixCls:"nc-field-item",style:{marginBottom:"0",fontWeight:"bold"}})),k().createElement("div",{className:"cellContent",style:ja({},w)}))},Ka=function(e){var t,n,r,a,l=e.field,o=l.FieldType,i=l.FileMaxSize,c=l.UploadNum,u=l.ImageFileType,d=l.UploadPrompt,s=l.ButtonText,f=(0,D.useContext)(oe).getKdesignerApi,p=Kn(l),m=f().meta,v=m.getControlPropertyDefaultValue,y=(0,m.getControlMetaEditor)(o,"ImageFileType").Enum,C=v(o,"FileMaxSize"),h=v(o,"ImageFileType"),E=u||h,I=T()(t=E.split(",")).call(t,(function(e){return g()(y).call(y,(function(t){return t.Id===e}))[0].Name})),N=d?b()(n=b()(r=b()(a="请上传小于".concat(i||C,"M的")).call(a,I.join("，"),"文件，文件个数不少于")).call(r,(null==c?void 0:c.min)||0,"个，不多于")).call(n,(null==c?void 0:c.max)||1,"个。"):"";return k().createElement(er,(0,B.c)({},p,{field:l}),k().createElement(qn.Picture,(0,B.c)({style:{fontSize:"12px",textAlign:"left",pointerEvents:"none"},noticeInfo:N,buttonText:s,pasteThumbnail:!1},{})))},Ua=r(5680),Va=r.n(Ua),Ga=function(e){var t,n,r,a=e.field,l=a.FieldType,o=a.FileMaxSize,i=a.UploadNum,c=a.UploadModel,u=(a.UploadPrompt,a.ButtonText),d=a.AttachmentFileType,s=(0,D.useContext)(oe).getKdesignerApi,f=Kn(a),p=s().meta,m=p.getControlPropertyDefaultValue,v=(p.getControlMetaEditor,m(l,"FileMaxSize")),g=b()(t=b()(n=b()(r="请上传小于".concat(o||v,"M的")).call(r,null==d?void 0:Va()(d).call(d,".",""),"文件，文件个数不少于")).call(n,(null==i?void 0:i.min)||0,"个，不多于")).call(t,(null==i?void 0:i.max)||1,"个。");return k().createElement(er,(0,B.c)({},f,{field:a}),k().createElement(qn.Attachment,(0,B.c)({style:{fontSize:"12px",textAlign:"left",pointerEvents:"none"},fileList:[],mode:c,uploadNum:i,noticeInfo:g,buttonText:u,pasteThumbnail:!1},{})))},za=function(e){var t=e.field,n=Kn(t),r=window.__kd_cdnPath__||window.__domainurl__,a=t.NoCodeDefValue,l=t.DefaultHeight,o=t.Status,i=t.AutoHeight,c=o===Ze.READONLY,u=o===Ze.DISABLED;return k().createElement(er,(0,B.c)({},n,{field:t}),k().createElement(qn.RichText,{height:l,autoHeight:i,content:a,srcUrl:r,readOnly:c,disabled:u,isDesigner:!0}))},Ha=function(e){var t=e.field,n=Kn(t),r=t.Content,a=t.Margin,l=t.DefaultHeight,o=t.AutoHeight,i=Jt(a),c=i.margin,u=i.marginTop,d=i.marginRight,s=i.marginBottom,f=i.marginLeft,p={marginTop:"".concat(u,"px"),marginRight:"".concat(d,"px"),marginBottom:"".concat(s,"px"),marginLeft:"".concat(f,"px")},m=-1===c?p:{margin:"".concat(c,"px")};return k().createElement("div",{className:"graphic-display-ap",style:"0"!==c?m:{}},k().createElement(er,(0,B.c)({},n,{field:t}),k().createElement(qn.GraphicDisplay,{content:r,autoHeight:o,defaultHeight:l})))},qa=r(1184),Ya=function(e){var t,n=(0,D.useContext)(oe),r=(n.isPC,n.getKdesignerApi),a=(0,D.useMemo)((function(){return r()}),[]).data,l=(a.getData(),e.ParentId),o=e.GroupParentId,i=a.getSubControls(l);return En()(t=g()(i).call(i,(function(e){return e.GroupParentId===o}))).call(t,(function(e,t){return Number(e.GroupIndex)-Number(t.GroupIndex)}))};function Wa(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wa(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Wa(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Qa=function(e){if(!e)return{};var t=ie({Id:e}),n=sn(),r=re({Id:e}),a=_n({Id:e});return Xa(Xa(Xa({},t),{},{onMouseDown:n},r),a)},Za=["controlId","parentColumn","className"];function Ja(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function $a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ja(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Ja(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var el=function(e){var t=e.controlId,n=e.parentColumn,r=e.className,a=(0,he.c)(e,Za),l=(0,D.useContext)(oe),o=l.prefixCls,i=l.getKdesignerApi,c=l.isPC,u=i().data,d=u.getData(),s=u.findControl,f=zn({Id:t},d,{isPC:c,excludeType:Ve},s);return k().createElement(qn.GridPanel,(0,B.c)({column:0===f.length?1:n},a),f.length>0?T()(f).call(f,(function(e){var t,r,a,l=(null==e||null===(t=e.props)||void 0===t?void 0:t.field)||{},o=l.ColumnSpan,i=l.key,c=l.id,u=(a=o,Math.min(n,Number(a)||4));return null!=e&&null!==(r=e.props)&&void 0!==r&&null!==(r=r.field)&&void 0!==r&&r.ColumnSpan&&(e.props.field.ColumnSpan=u),k().cloneElement(e,{key:c,itemKey:e.key||i,columnSpan:u})})):k().createElement("div",(0,B.c)({className:Vn()(r,"".concat(o,"_group_item_dropbox")),columnSpan:4},a),"拖拽内容到这里"))},tl=(0,D.memo)((function(e){var t=e.id,n=e.hidden,r=e.defaultBar,a=e.handleItemClick,l=(0,D.useContext)(oe),o=l.getKdesignerApi,i=l.fieldStatusMap,c=(l.prefixCls,l.fieldStatusSettingMode),u=(0,D.useMemo)((function(){return o()}),[]).data.findControl(t),d=u.Status,s=u.Key,f=Qa(t),p=(0,B.c)({},((0,qa.c)(f),f)),m=Zn({Id:t},!1),v=null==i?void 0:i[s];return k().cloneElement(r,$a($a($a({id:t,"data-group-bar-item-id":t},p),m),{},{"data-enable-click":"permission"!==c,style:{color:n?"#cccccc":"inherit",opacity:(d!==Ze.HIDDEN||c&&v)&&"hidden"!==v?"1":"0.5"},onClick:function(e){a(t)}}))}));tl.displayName="TabBar";var nl=function(e){var t,n=e.id,r=e.columnSpan,a=(0,D.useContext)(oe),l=a.getKdesignerApi,o=a.fieldStatusMap,i=a.prefixCls,c=(0,D.useMemo)((function(){return l()}),[]).data.findControl(n),u=(c.Status,c.Key),d=On(c);return k().createElement(el,(0,B.c)({key:n,controlId:n,parentColumn:r,"data-group-container-item":n,className:Vn()((0,f.c)({},b()(t="".concat(i,"-item-")).call(t,o[u]),o[u]))},d))},rl=function(e){var t,n=e.field,r=e.columnSpan,a=(0,D.useContext)(oe),l=a.getKdesignerApi,o=a.fieldStatusMap,i=a.prefixCls,c=a.fieldStatusSettingMode,u=(0,D.useMemo)((function(){return l()}),[]),d=u.selection,p=(u.data,n.Id),m=n.Key,v=(n.Name,n.TitleArea,n.Collapse),g=(n.HelpTips,n.ColumnSpan,(0,D.useState)(p)),y=(0,s.c)(g,2),C=y[0],h=y[1],E=(0,D.useRef)([]),I=(0,D.useRef)(null),N=(0,D.useReducer)((function(e){return e+1}),0),T=(0,s.c)(N,2);T[0],T[1];(0,D.useEffect)((function(){if(I.current){var e=I.current.querySelector("[data-tabs-header]");null==e||e.setAttribute("data-group-bar",p)}}),[]);var x=Ya(n).reduce((function(e,t){var n=t.Id,a=t.Name,l=t.TitleArea,o=t.HelpTips;return e.push({id:n,name:a,titleHidden:vt(l),tips:o,key:n,label:a,children:k().createElement(nl,{id:n,columnSpan:r})}),e}),[]);E.current=x,(0,D.useEffect)((function(){var e=d.getSelection()||[],t=e[0];if(t){var n,r=Ae()(x).call(x,(function(e){return e.id===t}))?null==e?void 0:e[0]:null==x||null===(n=x[0])||void 0===n?void 0:n.id;h(r),document.querySelectorAll("[".concat(X,"=true]")).forEach((function(t){S()(e).call(e,t[q])||null==t||t.removeAttribute(X)}))}}),[x.length]);var A=function(e){"permission"!==c&&C!==e&&(rn(C,e),h(e),d.setSelect(e))},F=function(){var e,t=d.getActiveSelectedId();(null===(e=E.current)||void 0===e?void 0:Ae()(e).call(e,(function(e){return e.id===t})))&&C!==t&&h(t)};(0,D.useEffect)((function(){var e=d.addSelectChangeListener(F);return function(){e()}}),[F]);var M=Qa(C),w=(0,B.c)({},((0,qa.c)(M),M)),P=On(n),R=1===x.length?P:{};return k().createElement(qn.Tabs,(0,B.c)({ref:I,activeKey:C,allowCollapse:v,onChange:A,"data-group-container":p},w,R,{"data-enable-click":"permission"!==c,renderTabBar:function(e,t){return k().createElement(tl,(0,B.c)({},e,{defaultBar:t,handleItemClick:A}))},items:x,className:Vn()((0,f.c)({},b()(t="".concat(i,"-item-")).call(t,o[m]),1===x.length&&o[m]))}))},al=["dragEvent"],ll=(0,D.memo)((function(e){var t=e.field,n=(0,D.useContext)(oe).prefixCls,r=Kn(t),a=r.dragEvent,l=(0,he.c)(r,al),o=t.Name;t.EmptyText,t.DataRage,t.showClearButton,t.Status,t.Visibility;return k().createElement("div",(0,B.c)({className:"".concat(n,"-bizbutton")},l,a),k().createElement(qn.BtnField,null,o))}));ll.displayName="NoCodeBizButtonAp";var ol={NoCodeTextField:lr,NoCodeSelectItemField:or,NoCodeRefBillField:Nr,NoCodeMulRefBillField:Nr,NoCodeTextAreaField:Tr,NoCodeDecimalField:xr,NoCodeDateField:Fr,NoCodeDateRangeField:Sr,NoCodeEntryEntity:Pr,NoCodeRefBillTable:Pr,NoCodeEntryFieldAp:La,NoCodeImageUploadField:Ka,NoCodeAttachmentUploadField:Ga,NoCodeCreateDateField:lr,NoCodeCreatorField:lr,NoCodeModifyDateField:lr,NoCodeModifierField:lr,NoCodeBillNoField:lr,NoCodeGroupContainerAp:rl,NoCodeBizButtonAp:ll,NoCodeRichTextField:za,NoCodeGraphicDisplayField:Ha},il=function(e){var t=e.field,n=Kn(t);return k().createElement(er,(0,B.c)({},n,{field:t}),k().createElement(rr,{type:"Text",field:t,props:{}}))},cl=function(e){var t,n=e.field,r=n._Type_,a=n.ShowType,l=Kn(n),o=Rt(n),i=Ot(n),c={readonlyValue:wt(n),options:Bt(n),defaultValue:i,value:i,multiple:Pt(null==n?void 0:n.SelectItemType),showBgcBlock:_t(n)};return S()(t=["Checkbox","Radio"]).call(t,o)&&(c.vertical=jt(null==n?void 0:n.TileTypePc)),et(r)&&"2"===a?null:k().createElement(er,(0,B.c)({},l,{field:n}),k().createElement(rr,{type:o,field:n,props:c}))},ul=function(e){var t=e.field,n=Kn(t),r=t.CounterDisplay,a=t.DefaultLines,l={showCount:!!(0,De.isUndefined)(r)||r,autoSize:{minRows:a,maxRows:a}};return k().createElement(er,(0,B.c)({},n,{field:t}),k().createElement(rr,{type:"Textarea",field:t,props:l}))},dl=function(e){var t=e.field,n=Kn(t),r=(t.EmptyText,t.DefValue,t.showClearButton,t.Status,t.ThousandsSeparator),a=t.Scale,l=t.Precision,o=t.Stepper,i={borderType:"bordered",readOnly:!0,allowClear:!1,formatter:(0,D.useCallback)((function(e){return r?"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","):String(e)}),[r]),decimalLength:a,showStepper:o,maxLength:l};return k().createElement(er,(0,B.c)({},n,{field:t}),k().createElement(rr,{type:"Number",field:t,props:i}))},sl={0:"second",1:"day"},fl=function(e){var t=e.field,n=Kn(t),r={borderType:"bordered",picker:sl[t.FormatType||"1"]};return k().createElement(er,(0,B.c)({},n,{field:t}),k().createElement(rr,{type:"DatePicker",field:t,props:r}))},pl={0:"second",1:"day"},ml=function(e){var t=e.field,n=Kn(t),r={borderType:"bordered",picker:pl[t.FormatType||"1"]};return k().createElement(er,(0,B.c)({},n,{field:t}),k().createElement(rr,{type:"DateRangePicker",field:t,props:r}))},vl=function(e){var t,n,r,a,l=e.field,o=(0,D.useContext)(oe).getKdesignerApi,i=l.FieldType,c=l.FileMaxSize,u=l.UploadNum,d=l.ImageFileType,s=o().meta,f=s.getControlPropertyDefaultValue,p=(0,s.getControlMetaEditor)(i,"ImageFileType").Enum,m=f(i,"FileMaxSize"),v=f(i,"ImageFileType"),y=d||v,C=T()(t=y.split(",")).call(t,(function(e){return g()(p).call(p,(function(t){return t.Id===e}))[0].Name})),h=Kn(l),E={disabled:!0,noticeInfo:b()(n=b()(r=b()(a="请上传小于".concat(c||m,"M的")).call(a,C.join(),"文件，文件个数不少于")).call(r,(null==u?void 0:u.min)||0,"个，不多于")).call(n,(null==u?void 0:u.max)||1,"个。")};return k().createElement(er,(0,B.c)({},h,{field:l}),k().createElement(rr,{type:"Picture",field:l,props:E}))},gl=function(e){var t,n,r,a=e.field,l=a.FieldType,o=a.FileMaxSize,i=a.UploadNum,c=a.UploadModel,u=a.UploadPrompt,d=a.ButtonText,s=a.AttachmentFileType,f=(0,D.useContext)(oe).getKdesignerApi,p=Kn(a),m=(0,f().meta.getControlPropertyDefaultValue)(l,"FileMaxSize"),v=u?b()(t=b()(n=b()(r="请上传小于".concat(o||m,"M的")).call(r,null==s?void 0:Va()(s).call(s,".",""),"文件，文件个数不少于")).call(n,(null==i?void 0:i.min)||0,"个，不多于")).call(t,(null==i?void 0:i.max)||1,"个。"):"";return k().createElement(er,(0,B.c)({},p,{field:a}),k().createElement(Yn.Attachment,(0,B.c)({style:{fontSize:"12px",textAlign:"left"},fileList:[],mode:c,uploadNum:i,noticeInfo:v,buttonText:d},{disabled:!0})))},yl=function(e){var t=e.field,n=Kn(t),r=t.NoCodeDefValue,a=t.DefaultHeight,l=t.AutoHeight,o=t.Status===Ze.READONLY,i=Jt(r);return k().createElement(er,(0,B.c)({},n,{field:t}),k().createElement(Yn.RichText,{readOnly:o,content:(null==i?void 0:i.value)||"",height:a,autoHeight:l}))},Cl=function(e){var t=e.field,n=Kn(t),r=t.Content,a=t.Margin,l=t.DefaultHeight,o=t.AutoHeight,i=Jt(a),c=i.margin,u=i.marginTop,d=i.marginRight,s=i.marginBottom,f=i.marginLeft,p={marginTop:"".concat(u,"px"),marginRight:"".concat(d,"px"),marginBottom:"".concat(s,"px"),marginLeft:"".concat(f,"px")},m=-1===c?p:{margin:"".concat(c,"px")};return k().createElement("div",{className:"graphic-display-ap",style:"0"!==c?m:{}},k().createElement(er,(0,B.c)({},n,{field:t}),k().createElement(qn.GraphicDisplay,{content:r,autoHeight:o,defaultHeight:l})))},hl=["controlId"],bl=["defaultBar","handleItemClick"];function El(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Il(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?El(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):El(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Nl=function(e){var t=e.controlId,n=(0,he.c)(e,hl),r=(0,D.useContext)(oe),a=r.prefixCls,l=r.getKdesignerApi,o=r.isPC,i=l().data,c=i.getData(),u=i.findControl,d=zn({Id:t},c,{isPC:o,excludeType:Ve},u);return k().createElement(Yn.GridPanel,(0,B.c)({gutter:[24,24]},n),d.length>0?d:k().createElement("div",(0,B.c)({className:"".concat(a,"_group_item_dropbox")},n),"拖拽内容到这里"))},Tl=(0,D.memo)((function(e){var t=e.defaultBar,n=e.handleItemClick,r=(0,he.c)(e,bl),a=r.id,l=r.tips,o=Qa(a),i=Zn({Id:a},!1);return k().cloneElement(t,Il(Il(Il({id:a,"data-group-bar-item-id":a,tips:l},o),i),{},{onClick:function(e){n(a),o.onClick(e)}}))}));Tl.displayName="TabBar";var xl=function(e){var t=e.id;return k().createElement(Nl,{key:t,controlId:t,"data-group-container-item":t})},Al=function(e){var t=e.field,n=(0,D.useContext)(oe),r=n.getKdesignerApi,a=(n.prefixCls,r().selection),l=t.Id,o=(t.Name,t.TitleArea,t.HelpTips,t.Collapse),i=(0,D.useState)(l),c=(0,s.c)(i,2),u=c[0],d=c[1],f=(0,D.useRef)([]),p=(0,D.useRef)(null);(0,D.useEffect)((function(){if(p.current){var e=p.current.querySelector("[data-tabs-header]");null==e||e.setAttribute("data-group-bar",l)}}),[]);var m=Ya(t).reduce((function(e,t){var n=t.Id,r=t.Name,a=t.TitleArea,l=t.HelpTips;return e.push({id:n,name:r,titleHidden:vt(a),tips:l,key:n,label:r,children:k().createElement(xl,{id:n})}),e}),[]);f.current=m;var v=function(){var e,t=a.getActiveSelectedId();(null===(e=f.current)||void 0===e?void 0:Ae()(e).call(e,(function(e){return e.id===t})))&&d(t)};(0,D.useEffect)((function(){var e=a.getSelection();null!=e&&e[0]&&(Ae()(m).call(m,(function(t){return t.id===(null==e?void 0:e[0])}))&&d(null==e?void 0:e[0]))}),[m.length]),(0,D.useEffect)((function(){var e=a.getSelection();if((null==e?void 0:e[0])===u&&!Ae()(m).call(m,(function(e){return e.id===u}))){var t=null==m?void 0:m[0].id;rn(u,t,(function(e){e.removeAttribute(X)})),d(t)}}),[m,u]),(0,D.useEffect)((function(){v();var e=a.addSelectChangeListener(v);return function(){e()}}),[]);var g=function(e){a.setSelect([e]),d(e)},y=Qa(u);return k().createElement(Yn.Tabs,(0,B.c)({ref:p,activeKey:u,allowCollapse:o,onChange:g,"data-group-container":l,items:m,renderTabBar:function(e,t){return k().createElement(Tl,(0,B.c)({},e,{defaultBar:t,handleItemClick:g}))}},y))},Fl=["NoCodeImageUploadField","NoCodeAttachmentUploadField"],Sl=function(e){var t=e.field,n=t._Type_,r=(t.ShowBatImportBtn,t.ShowBatExportBtn,t.ShowSeqField),a=(t.ShowType,(0,D.useContext)(oe)),l=a.getKdesignerApi,o=a.prefixCls,i=l(),c=i.data,u=i.meta,d=c.getData(),s=c.findControl,f=u.getControlPropertyDefaultValue(n,"SeqName"),p=t.SeqName,m=void 0===p?f:p,v=zn(t,d,{isPC:!1},s),g=(0,D.useMemo)((function(){var e,t;if(r)return"".concat(m,"：1");var n=Ae()(v).call(v,(function(e){var t,n=(null==e||null===(t=e.props)||void 0===t?void 0:t.field)._Type_;return!S()(Fl).call(Fl,n)}));if(!n)return"-";var a=null==n||null===(e=n.props)||void 0===e?void 0:e.field,l=a.Name,o=a.DefValue;return b()(t="".concat(l,"：")).call(t,o||"-")}),[r,m,v]);return v.length?k().createElement(k().Fragment,null,k().createElement("div",{className:"".concat(o,"-entry-mb-operator")},k().createElement(P.Button,{type:"ghost",size:"small",icon:k().createElement(P.Icon,{prefix:"ncicon",type:"zengjia-yuan"})},"新增"),k().createElement(P.Button,{size:"small",icon:k().createElement(P.Icon,{prefix:"ncicon",type:"xuanze"})},"选择")),k().createElement("div",{className:"".concat(o,"-entry-mb-item")},k().createElement(Yn.CollapsePanel,{isOpen:!0,title:g,extra:k().createElement(P.Icon,{prefix:"designericon",type:"shanchu"}),transitionDuration:0},T()(v).call(v,(function(e,t){return k().createElement("div",{className:"".concat(o,"-entry-mb-sub-control"),key:t},e)}))))):k().createElement("div",{className:"".concat(o,"-entry-mb-empty")},"拖拽或点击添加内容")},Dl=function(e){var t=e.field,n=t._Type_,r=t.ShowType,a=Kn(t);return it(n)&&"1"===r?null:k().createElement(er,(0,B.c)({field:t,tipsTrigger:"click"},a),k().createElement(Sl,{field:t}))},kl={NoCodeTextField:il,NoCodeSelectItemField:cl,NoCodeDecimalField:dl,NoCodeRefBillField:cl,NoCodeMulRefBillField:cl,NoCodeTextAreaField:ul,NoCodeGroupContainerAp:Al,NoCodeEntryEntity:Dl,NoCodeRefBillTable:Dl,NoCodeCreateDateField:il,NoCodeCreatorField:il,NoCodeModifyDateField:il,NoCodeModifierField:il,NoCodeBillNoField:il,NoCodeDateField:fl,NoCodeDateRangeField:ml,NoCodeAttachmentUploadField:gl,NoCodeImageUploadField:vl,NoCodeRichTextField:yl,NoCodeGraphicDisplayField:Cl};function Ml(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function wl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ml(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Ml(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Pl={UndefinedControl:Gn,RootPanel:Xn},Rl=wl(wl(wl({},ol),kl),Pl);function Bl(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function _l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bl(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Bl(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Ol=function(e){var t,n,r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).isPC,a=void 0===r||r,l=e.ParentId,o=e._Type_,i=e.Id,c=e._isEntryField_,u=(0,k().useContext(oe).getKdesignerApi)(),d=u.meta,s=(u.data.getSubControls(i).length,null===(t=d.getControlMeta(o))||void 0===t?void 0:t.IsContainer),f=_l(_l({},d.getDefaultData(o)),e),p=b()(n="".concat(s?"".concat(i):i,"-")).call(n,f.Visibility),m={field:$t(f),key:p,_IsContainer:s};if(!l)return k().createElement(Rl.RootPanel,m);var v,g,y=(g=a,v=et(v=a&&c?"NoCodeEntryFieldAp":o)?"NoCodeRefBillField":v,g?ol[v]:kl[v]);return y?k().createElement(y,m):k().createElement(Rl.UndefinedControl,m)},jl=function(e){var t=e.value;e.oldValue.forEach((function(e){var t;document.querySelectorAll(b()(t="[".concat(q,'="')).call(t,e,'"]')).forEach((function(e){return null==e?void 0:e.removeAttribute(X)}))})),t.forEach((function(e){var t;document.querySelectorAll(b()(t="[".concat(q,'="')).call(t,e,'"]')).forEach((function(e){null==e||e.setAttribute(X,"true"),e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded():e.scrollIntoView({block:"nearest"})}))}))},Ll=r(4496),Kl=r.n(Ll),Ul="nocodedesigner.CopyContent",Vl="nocodedesigner.CopyIds",Gl=function(e){window.sessionStorage.setItem(Ul,Kl()(e))},zl=function(){var e=window.sessionStorage.getItem(Ul);return e&&(e=JSON.parse(e)),e},Hl=function(e){window.sessionStorage.setItem(Vl,Kl()(e))},ql=function(){var e=window.sessionStorage.getItem(Vl);return e&&(e=JSON.parse(e)),e},Yl=function(){window.sessionStorage.removeItem(Ul),window.sessionStorage.removeItem(Vl)},Wl=function(){var e=(0,D.useContext)(oe).getKdesignerApi,t=(0,D.useMemo)((function(){return e()}),[]).selection.getSelection;return{setCopyContent:Gl,getCopyContent:zl,setCopyIds:Hl,getCopyIds:ql,setDatasetCutControl:function(){t().forEach((function(e){var t;document.querySelectorAll(b()(t="[".concat(q,'="')).call(t,e,'"]')).forEach((function(e){e.setAttribute(Z,"true")}))}))},removeDatasetCutControl:function(){var e=document.querySelectorAll("[".concat(Z,"]"));return e.length&&e.forEach((function(e){e.removeAttribute(Z)})),e.length},clearCopyContent:Yl}},Xl=function(e,t,n,r,a,l,o,i){var c=e.getSelection,u=e.setSelect,d=(e.getActiveSelectedId,c());if(d.length>0){if(S()(d).call(d,r))return n("禁止删除根节点");var s=g()(d).call(d,(function(e){return e!==r})),f=t.getData().Items,p=Ae()(f).call(f,(function(e){return S()(s).call(s,e.Id)}));if(!p)return;var m=p.Id,v=p.ParentId,y=p._Type_,C=(p.RefBillId,p.RefTableId,p.GroupIndex);if(1===s.length){var h=t.getNextSelectedControlId(m),b=t.findControl(h);h===v&&ut(y)?v=r:!b||h===m||Fa(b)||yt(y)&&0===Number(C)&&1===Number(b.GroupIndex)||(v=h)}else if(ut(y)){var E=t.findControlByCondition((function(e){return e.ParentId===v&&!S()(s).call(s,e.Id)}));v=E.length?E[0].Id:r}else{var I=t.getPrevSibling(m).control;I&&(v=I.Id)}Pa(s,a,l,t,o,i,(function(){u([v])}))}},Ql=function(e,n){var r=(0,D.useContext)(oe),a=r.getKdesignerApi,l=(r.invokeSaveAction,r.fieldStatusSettingMode),o=r.pubUIAction,i=r.billPropsData,c=r.dispatchBillData,u=r.getHideFieldRef,d=r.setHideFieldRef,s=(0,D.useMemo)((function(){return a()}),[]),f=s.data,p=s.selection,m=s.meta,v=f.getRootId(),y=p.getSelection,C=p.setSelect,h=p.getActiveSelectedId,E=(0,D.useContext)(M.GlobalConfigContext),I=E.showMessage,N=E.keywordMapping,x=Wl(),A=x.setCopyContent,F=x.getCopyContent,k=x.setCopyIds,w=x.getCopyIds,P=x.setDatasetCutControl,B=x.removeDatasetCutControl,O=x.clearCopyContent;(0,D.useEffect)((function(){var n=e.current;if(n&&!l){var r=function(e){var r=(e.target||{}).className;if("nocode-designer-designer-field-item-edit"!==(void 0===r?"":r)){var a=y(),l=h(),x=e.keyCode;switch(x){case M.keyCode.BACKSPACE:case M.keyCode.DELETE:e.preventDefault(),Xl(p,f,I,v,i,c,u(),d),a.length>0&&setTimeout((function(){return n.focus()}),50);break;case M.keyCode.ESC:e.preventDefault();var D=s.selection.getActiveSelectedId();if(D!==s.data.getRootId()){var j=s.data.findControl(D),L=s.data.findControlByCondition((function(e){return e.Id===j.ParentId}))[0];if(L._Root_)return;C(L.Id)}break;case M.keyCode.C:if(e.preventDefault(),e.ctrlKey){null==e||e.stopPropagation();var U=y().reduce((function(e,t){var n,r,a=f.findControl(t),l=m.getControlMeta((null==a?void 0:a.FieldType)||a[K]),o=l.Inside,i=l.CategoryId,c=l.Name;if(o)return e;if(S()(i).call(i,Le))return I("".concat(c,"只能在画布中添加一次，不能复制")),e;if(yt(a[K])&&(null===(r=f.getAllSubControls(a.Id))||void 0===r?void 0:g()(r).call(r,(function(e){return et(e[K])||it(e[K])||nt(e[K])}))).length>0)return I("分组内包含关联表单、表格、或系统字段，不能复制。"),e;return et(a[K])||it(a[K])||nt(a[K])?(I("无法复制关联表单、表格控件、系统字段。"),e):b()(n=[]).call(n,(0,R.c)(e),[a])}),[]);A(U),k(U.reduce((function(e,t){var n=f.getAllSubControlIds(null==t?void 0:t.Id)||[];return b()(e).call(e,n)}),[]))}break;case M.keyCode.V:if(e.preventDefault(),e.ctrlKey){var V=F();if(Array.isArray(V)){var z,H=B()>0;f.getData();if(H){var q=V.reduce((function(e,t){var n;return b()(n=[t[_]]).call(n,(0,R.c)(e))}),[]);if(S()(q).call(q,l))return;return f.getAllParentControlIds(l).some((function(e){return S()(q).call(q,e)}))?void I("当【源控件】是【目标控件】的父级时，无法剪切/粘贴"):void f.swapControl((0,M.createSwapAction)({origin:q,target:l})).then((function(e){p.setSelect([q[0]]),O()}))}var Y=f.findControl(l),W=Y.FieldType,X=Y[K],Q=l,Z=m.getControlMeta(W||X).IsContainer;Z&&!it(X)||(Q=f.getParentControlId(l));var J=w(),$={Items:f.findControlByCondition((function(e){return null==J?void 0:S()(J).call(J,e.Id)}))},ee=V.reduce((function(e,t){var n=kt($,t,Q);return b()(e).call(e,un(n,v))}),[]),te=f.findControlIndex(l);if(Z){var ne=f.getSubControls(l),re=ne.length;re>0&&(te=f.findControlIndex(ne[re-1][_]))}var ae=g()(z=T()(ee).call(ee,(function(e){return f.findControl(e.ParentId)?e.Id:null}))).call(z,Boolean);f.addControl((0,M.createPasteAction)(ee,{index:te+1})).then((function(e){var t=g()(ae).call(ae,(function(e){return f.findControl(e)}));C(t)}))}}break;case M.keyCode.X:if(e.preventDefault(),e.ctrlKey){null==e||e.stopPropagation();var le=y(),oe=[],ie=[];le.forEach((function(e){var t=f.findControl(e);it(t[K])||et(t[K])||(oe.push(t),ie.push(e))})),k(ie),A(oe),P()}break;case M.keyCode.ENTER:var ce,ue;e.preventDefault();var de=h({dataContext:f,selectionContext:p}),se=f.findControl(de);se=f.getContainerControl(se);var fe=m.canAdd("NoCodeTextField",se[N.type]);if(!(!0===fe||"object"===(0,be.c)(fe)&&fe.success))return;o({eventName:"enter",action:"fd_add_enter"});var pe=null===(ce=m.getControlMeta(null===(ue=se)||void 0===ue?void 0:ue[N.type]))||void 0===ce?void 0:ce.IsContainer,me=(0,M.createControlData)(f.getMeta(),E)({type:"NoCodeTextField",parentId:pe?se[N.id]:v}),ve=se[N.id]===de?-1:f.findControlIndex(de)+1;f.addControl((0,M.createAddAction)(me,{index:ve})).then((function(e){if(null!=e&&e.length){var t=e[0].value;p.setSelect(Array.isArray(t)?[t[0][N.id]]:[t[N.id]])}}));break;case M.keyCode.D:if(e.preventDefault(),x===M.keyCode.D&&!e.ctrlKey)return;var ge=f.getData(),ye=p.getSelection(),Ce=function(e){var n=m.getControlMeta(e[K]),r=n.CategoryId,a=n.Name;return!S()(r).call(r,Le)||(I(t({key:"nocode.designer.00040",variables:{name:a}})),!1)};if(ye.length>1){var he=ye.reduce((function(e,t){var n=f.findControl(t);if(!Ce(n))return e;var r=kt(ge,n,n[G]);return b()(e).call(e,un(r,v))}),[]);f.addControl((0,M.createPasteAction)(he)).then((function(){}))}else{var Ee=f.findControl(l);if(!Ce(Ee))return;var Ie=un(kt(ge,Ee,Ee[G]),v),Ne=f.findControlIndex(Ee[_])+1;f.addControl((0,M.createPasteAction)(Ie,{index:Ne})).then((function(){p.setSelect([Ie[0][_]])}))}break;case M.keyCode.Z:case M.keyCode.Y:e.preventDefault();break;case M.keyCode.LEFT:case M.keyCode.RIGHT:case M.keyCode.UP:case M.keyCode.DOWN:e.preventDefault();var Te=x===M.keyCode.LEFT||x===M.keyCode.UP?f.getPrevSibling(l):f.getNextSibling(l),xe=Te&&Te.control;xe&&C([xe[_]])}}};return n.addEventListener("keydown",r,!0),function(){n.removeEventListener("keydown",r,!0)}}}),[i])},Zl=function(e,t){var n=t.selection,r=e.Id,a=(0,D.useContext)(oe).fieldStatusSettingMode,l=n.setSelect;(0,D.useEffect)((function(){a||l([r])}),[])},Jl=(0,M.isMac)(),$l=function(){var e=(0,D.useReducer)((function(e){return e+1}),0),t=(0,s.c)(e,2)[1],n=(0,D.useContext)(oe),r=n.getKdesignerApi,a=n.getPrefixCls,l=n.prefixCls,o=n.billPropsData,i=n.dispatchBillData,c=n.getHideFieldRef,u=n.setHideFieldRef,d=(0,D.useMemo)((function(){return r()}),[]),p=d.data,m=d.selection,v=d.meta,y=(0,D.useContext)(M.GlobalConfigContext).showMessage,C=Wl(),h=C.setCopyContent,E=C.getCopyIds,I=C.setCopyIds,N=C.getCopyContent,x=C.setDatasetCutControl,A=C.removeDatasetCutControl,F=C.clearCopyContent,w=(0,D.useRef)(null),B=a&&a(l,"nav-tool"),O=m.getSelection,j=m.setSelect,L=m.getActiveSelectedId,U=m.addSelectChangeListener,V=p.getRootId(),z=p.canUndo(),H=p.canRedo(),Y=L(),W=p.findControl(Y)[K],X=v.getControlMeta(W).CategoryId,Q=O();(0,D.useEffect)((function(){var e=U(t);return function(){e()}}),[]);var Z=(0,D.useCallback)((function(e){return ut(W)?"back"===e?"forward":"back":e}),[W]),J=(0,D.useMemo)((function(){var e,t=Vt(W),n=null===(e=p.getAllSubControls(Y))||void 0===e?void 0:g()(e).call(e,(function(e){return it(e._Type_)||et(e._Type_)}));return!!(Y===V||S()(X).call(X,Le)||it(W)||et(W)||t&&n.length)}),[V,Y,W]),$=(0,D.useMemo)((function(){return Y===V}),[V,Y]),ee=$||Q.length>1,te=((0,D.useCallback)((function(){H&&p.redo()}),[H]),(0,D.useCallback)((function(){z&&p.undo()}),[z]),function(e){var t=setTimeout((function(){!function(e){var t,n=document.querySelector(b()(t="[".concat(q,'="')).call(t,e,'"]'));n&&(n.scrollIntoViewIfNeeded?n.scrollIntoViewIfNeeded():n.scrollIntoView({block:"nearest"}))}(e),clearTimeout(t),t=null}))}),ne=(0,D.useCallback)((function(){var e=O();if(1===e.length){var t=p.findControl(e[0]),n=t.Key,r=t._Type_;if(Vt(r))return void an(p,t,"forward");var a=p.getPrevSibling(e[0]).control;if(a&&Vt(a._Type_))return void an(p,a,"back");var l=p.getParentControl(e[0]),o=l.Id,i=l._Type_,c=l.PropsDisplay;if(it(i)){var u=c.split(","),d=n.toLowerCase().replace("_".concat(o.toLowerCase()),""),s=Kr()(u).call(u,(function(e){return e===d}));if(u.length>1&&0!==s){var f=ue()(u).call(u,s,1);ue()(u).call(u,s-1,0,f[0]),p.batchUpdateControlPropertyValues((0,M.createUpdateAction)([[o,{PropsDisplay:u.join()}]]))}}p.moveControl(e[0],Z("forward")),te(e[0])}}),[Z]),re=(0,D.useCallback)((function(){var e=O();if(1===e.length){var t=p.findControl(e[0]),n=t.Key,r=t._Type_;if(Vt(r))return void an(p,t,"back");var a=p.getNextSibling(e[0]).control;if(a&&Vt(a._Type_))return void an(p,a,"forward");var l=p.getParentControl(e[0]),o=l.Id,i=l._Type_,c=l.PropsDisplay;if(it(i)){var u=c.split(","),d=n.toLowerCase().replace("_".concat(o.toLowerCase()),""),s=Kr()(u).call(u,(function(e){return e===d}));if(u.length>1&&s!==u.length-1){var f=ue()(u).call(u,s,1);ue()(u).call(u,s+1,0,f[0]),p.batchUpdateControlPropertyValues((0,M.createUpdateAction)([[o,{PropsDisplay:u.join()}]]))}}p.moveControl(e[0],Z("back")),te(e[0])}}),[Z]),ae=(0,D.useCallback)((function(e){null==e||e.stopPropagation();var t=O();if(1!==t.length||V!==t[0]){var n=T()(t).call(t,(function(e){return p.findControl(e)}));I(t),h(n),x()}}),[]),le=(0,D.useCallback)((function(e){null==e||e.stopPropagation();var t=O();if(1===t.length&&V===t[0])return y("禁止复制根节点");var n=t.reduce((function(e,t){var n,r,a=p.findControl(t),l=v.getControlMeta((null==a?void 0:a.FieldType)||a[K]),o=l.Inside,i=l.CategoryId,c=l.Name;if(o)return e;if(S()(i).call(i,Le))return y("".concat(c,"只能在画布中添加一次，不能复制")),e;if(Vt(a[K])&&(null===(r=p.getAllSubControls(a.Id))||void 0===r?void 0:g()(r).call(r,(function(e){return et(e[K])||it(e[K])||nt(e[K])}))).length>0)return y("分组内包含关联表单、表格、或系统字段，不能复制。"),e;return it(a[K])||et(a[K])?(y("关联表单与表格控件，不能复制"),e):b()(n=[]).call(n,(0,R.c)(e),[a])}),[]);h(n),I(n.reduce((function(e,t){var n=p.getAllSubControlIds(t.Id)||[];return b()(e).call(e,n)}),[]))}),[]),ie=(0,D.useCallback)((function(){var e=N();if(Array.isArray(e)){var t,n=A()>0;p.getData();if(n){var r=e.reduce((function(e,t){var n;return b()(n=[t[_]]).call(n,(0,R.c)(e))}),[]);if(S()(r).call(r,Y))return;return p.getAllParentControlIds(Y).some((function(e){return S()(r).call(r,e)}))?void y("当【源控件】是【目标控件】的父级时，无法剪切/粘贴"):void p.swapControl((0,M.createSwapAction)({origin:r,target:Y})).then((function(e){m.setSelect([r[0]]),F()}))}var a=p.findControl(Y),l=a.FieldType,o=a[K],i=Y,c=v.getControlMeta(l||o).IsContainer;c||(i=p.getParentControlId(Y));var u=E(),d={Items:p.findControlByCondition((function(e){return null==u?void 0:S()(u).call(u,e.Id)}))},s=e.reduce((function(e,t){var n=kt(d,t,i);return b()(e).call(e,un(n,V))}),[]),f=p.findControlIndex(Y);if(c){var C=p.getSubControls(Y),h=C.length;h>0&&(f=p.findControlIndex(C[h-1][_]))}var I=g()(t=T()(s).call(s,(function(e){return p.findControl(e.ParentId)?e.Id:null}))).call(t,Boolean);p.addControl((0,M.createPasteAction)(s,{index:f+1})).then((function(e){var t=g()(I).call(I,(function(e){return p.findControl(e)}));j(t)}))}}),[Y]),ce=(0,D.useCallback)((function(e){e.stopPropagation();var t=m.getSelection(),n=p.getData();if(1!==t.length||V!==t[0]){var r=function(e){if(Vt(e[K])){var t,n,r=null===(t=p.getAllSubControls(e.Id))||void 0===t||null===(n=g()(t))||void 0===n?void 0:n.call(t,(function(e){return et(e[K])||it(e[K])||nt(e[K])}));if((null==r?void 0:r.length)>0)return y("分组内包含关联表单、表格或系统字段，不能重复。"),!1}var a=v.getControlMeta(e[K]),l=a.CategoryId,o=a.Name;return!S()(l).call(l,Le)||(y("".concat(o,"只能在画布中添加一次，不能重复")),!1)};if(t.length>1){var a=t.reduce((function(e,t){var a=p.findControl(t);if(!r(a)||et(a[K])||it(a[K]))return e;var l=kt(n,a,a[G]);return b()(e).call(e,un(l,V))}),[]);p.addControl((0,M.createPasteAction)(a)).then((function(){}))}else{var l=p.findControl(Y);if(!r(l)||et(l[K])||it(l[K]))return;var o=un(kt(n,l,l[G]),V),i=p.findControlIndex(l[_])+1;p.addControl((0,M.createPasteAction)(o,{index:i})).then((function(){m.setSelect([o[0][_]])}))}}}),[Y]),de=Vn()("".concat(B,"-operation-btn"));return k().createElement("div",{className:B,ref:w},k().createElement("div",{title:"前移",onClick:ne,className:Vn()((0,f.c)({},"".concat(B,"-operation-disable"),ee),de)},k().createElement(P.Icon,{prefix:"designericon",type:"qianyi"})),k().createElement("div",{title:"后移",onClick:re,className:Vn()((0,f.c)((0,f.c)({},"".concat(B,"-last-operation"),!0),"".concat(B,"-operation-disable"),ee),de)},k().createElement(P.Icon,{prefix:"designericon",type:"houyi"})),k().createElement("div",{title:"剪切\n".concat(Jl?"⌘+X":"Ctrl+X"),onClick:J?void 0:ae,className:Vn()((0,f.c)({},"".concat(B,"-operation-disable"),J),de)},k().createElement(P.Icon,{prefix:"designericon",type:"jianqie"})),k().createElement("div",{title:"复制\n".concat(Jl?"⌘+C":"Ctrl+C"),onClick:J?void 0:le,className:Vn()((0,f.c)({},"".concat(B,"-operation-disable"),J),de)},k().createElement(P.Icon,{prefix:"designericon",type:"fuzhi"})),k().createElement("div",{title:"粘贴\n".concat(Jl?"⌘+V":"Ctrl+V"),onClick:ie,className:Vn()((0,f.c)({},"".concat(B,"-last-operation"),!0),de)},k().createElement(P.Icon,{prefix:"designericon",type:"zhantie"})),k().createElement("div",{title:"重复",onClick:J?void 0:ce,className:Vn()((0,f.c)({},"".concat(B,"-operation-disable"),J),de)},k().createElement(P.Icon,{prefix:"designericon",type:"zhongfu"})),k().createElement("div",{title:"删除\nDelete",onClick:$?void 0:function(){Xl(m,p,y,V,o,i,c(),u)},key:"Delete",className:Vn()((0,f.c)({},"".concat(B,"-operation-disable"),$),de)},k().createElement(P.Icon,{prefix:"designericon",type:"shanchu"})))},eo=function(){var e=(0,D.useContext)(oe),t=e.getPrefixCls,n=e.prefixCls,r=e.isPC,a=e.setIsPC,l=t&&t(n,"nav-deviceswitch"),o=function(e){a(e)};return k().createElement("div",{className:l},k().createElement("div",{className:"".concat(l,"-container")},k().createElement("div",{className:Vn()("".concat(l,"-container-item"),{actived:r}),onClick:function(){return o(!0)},title:"PC端"},k().createElement("div",{className:"".concat(l,"-container-item-icon")},k().createElement(P.Icon,{prefix:"designericon",type:"PC"}))),k().createElement("div",{className:Vn()("".concat(l,"-container-item"),{actived:!r}),onClick:function(){return o(!1)},title:"移动端"},k().createElement("div",{className:"".concat(l,"-container-item-icon")},k().createElement(P.Icon,{prefix:"designericon",type:"shouji2"})))))},to=[{name:"1列",id:"1",icon:"1lie"},{name:"2列",id:"2",icon:"2lie"},{name:"3列",id:"3",icon:"3lie"},{name:"4列",id:"4",icon:"4lie"}],no="ColumnSpan",ro=function(){var e=(0,D.useContext)(oe),t=e.prefixCls,n=e.getKdesignerApi,r=e.isPC,a=n(),l=a.data,o=a.meta,i=l.getRootId(),c=l.findControl(i),u=c[no],d=c._Type_,s=o.getControlPropertyDefaultValue(d,no),p=String(u||s);return(0,M.useDataChangeForceUpdateEffect)(a),k().createElement("div",{className:Vn()("".concat(t,"-column-switch"),{hide:!r})},k().createElement("div",{className:"".concat(t,"-column-switch-wrapper")},T()(to).call(to,(function(e){var n=e.id,r=e.icon;return k().createElement("div",{className:Vn()("".concat(t,"-column-item"),{"is-active":p===n}),onClick:function(){var e;p!==(e=n)&&l.batchUpdateControlPropertyValues((0,M.createUpdateAction)([[i,(0,f.c)({},no,e)]]))},key:n,title:"".concat(n,"列")},k().createElement("div",{className:"".concat(t,"-column-item-icon")},k().createElement(P.Icon,{prefix:"designericon",type:r})))}))))},ao=function(){var e=(0,D.useContext)(oe),t=e.getPrefixCls,n=e.prefixCls,r=t&&t(n),a="".concat(r,"-top-view-main"),l=k().createElement("div",{className:a},k().createElement($l,null),k().createElement(ro,null),k().createElement(eo,null));return k().createElement(M.ViewHeader,{content:l,portalId:a})},lo=function(e){var t=e.Id,n=(0,D.useContext)(oe).getKdesignerApi,r=(0,D.useMemo)((function(){return n()}),[]),a=r.meta,l=r.data.findControl(t)||{},o=l._Type_,i=l.Key,c=l.Multi,u=void 0===c?"0":c,d=l.SelectItemType,f=(a.getControlMeta(o)||{}).Name,p=(0,D.useRef)(null),m=(0,D.useState)(gt(f,l)),v=(0,s.c)(m,2),g=v[0],y=v[1];return(0,M.useDataChangeForceUpdateEffect)(r),(0,D.useEffect)((function(){var e=gt(f,{SelectItemType:d,Multi:u,_Type_:o});y(e)}),[t,o,d,u]),(0,D.useEffect)((function(){if(et(o))return M.eventBus.on("".concat(i,"_refbill"),(function(e){p.current=e.formName,y(gt(p.current,l))})),function(){M.eventBus.off("".concat(i,"_refbill"))}}),[i]),g};function oo(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function io(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oo(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):oo(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var co=(0,D.memo)((function(e){var t=e.field,n=e.className,r=t.Id,a=t._Type_,l=t.BillEntityId,o=t.Id,i=t.Name,c=(0,D.useContext)(oe),u=c.prefixCls,d=c.getKdesignerApi,p=c.invokeAction,m=c.fieldStatusSettingMode,v=c.getHideFieldRef,y=c.setHideFieldRef,C=(0,D.useMemo)((function(){return d()}),[]),h=C.data,E=C.selection,I=C.meta,N=C.error,x=C.controlCacheApi,F=I.getMeta(),w=(h.getParentControl(r)||{})._Type_,B=(0,D.useRef)(),j=(0,D.useRef)([]),L=(0,D.useState)([]),U=(0,s.c)(L,2),V=U[0],z=U[1],H=(0,D.useState)(!1),q=(0,s.c)(H,2),Y=q[0],W=q[1],X=(0,D.useState)(!1),Q=(0,s.c)(X,2),Z=Q[0],J=Q[1],$=x.hasCache("controlId",r);(0,M.useOnClickOutside)([B],(function(e){W(!1)})),(0,D.useEffect)((function(){if(W(!1),J(!1),r&&!S()(Ye).call(Ye,a)&&!m&&!it(w)){if($){var e;if(F.Controls){var n,l,o=h.findControl(t[G]),i=I.getControlMeta(a),c=b()(n=[]).call(n,(0,R.c)(Ye),[a,"HiddenControl"]);j.current=g()(l=F.Controls||[]).call(l,(function(e){if(S()(c).call(c,e[_])||!1===e.Visible||(null==i?void 0:i.BaseType)!==(null==e?void 0:e.BaseType))return!1;var t=I.canAdd(e.Id,o[K]);return!0===t||"object"===(0,be.c)(t)&&t.success}))}return z(j.current),void((null===(e=j.current)||void 0===e?void 0:e.length)>0&&J(!0))}var u=t.Key;p("canSwitchFieldTypes",[[u,t.FieldType]],[]);var d=function(e){var t=e[u]||[];0!==t.length?(z(t),(null==t?void 0:t.length)>0&&J(!0)):W(!1)};return M.eventBus.on(vr,d),function(){M.eventBus.off(vr,d)}}}),[o,a,$]);var ee=lo(t),te=(0,D.useMemo)((function(){if(a)return mn(a)}),[a,mn]),ne="".concat(u,"_contextmenu_panel");return k().createElement("div",{className:Vn()(n,"switchfield")},k().createElement("div",{className:"switchfield_content"},te&&k().createElement(P.Icon,{prefix:"designericon",type:te,className:"switchfield_content_icon"}),k().createElement("span",{className:"switchfield_content_name"},a?ee||"":"批量编辑")),Z&&k().createElement(M.DropDownPanel,{scrollHidden:!0,popperClassName:"".concat(u,"_contextmenu"),visible:Y,onVisibleChange:function(e){return W(e)},placement:"bottomLeft",content:Y&&k().createElement("div",{ref:B,className:ne},T()(V).call(V,(function(e){var n,r="",c="";"object"===(0,be.c)(e)?(r=e.Id,c=e.Name):(r=e,c=null===(n=I.getControlMeta(r))||void 0===n?void 0:n.Name);return k().createElement("div",{key:r,title:c,className:"".concat(ne,"_item"),onClick:function(){return function(e){if(e){var n,r="";if(et(a)){if(r=I.getControlMeta(b()(n="".concat(a,"_")).call(n,l)).Name,null!=t&&t.RefTableId){var c=io({},v()),u=A()(c).reduce((function(e,n){return n.ParentId!==(null==t?void 0:t.RefTableId)&&n.Id!==(null==t?void 0:t.RefTableId)?io(io({},e),{},(0,f.c)({},n.Id,n)):e}),{});y(u)}}else r=I.getControlMeta(a).Name;var d=(r||i)===i,s=I.getControlMeta(e).Name,p=d?{Name:s}:{};h.batchUpdateControlPropertyValues((0,M.createUpdateAction)([[o,io((0,f.c)({},O,e),p)]])).then((function(){E.setSelect([o]),N.getError(o)&&N.deleteError([o]),W(!1)})).catch((function(e){}))}}(r)}},k().createElement(P.Icon,{prefix:"designericon",type:mn(r),className:"nocode-designer-control-icon"}),k().createElement("p",{className:"".concat(ne,"_item_text")},c))})))},k().createElement("div",{className:"switchfield_action"},k().createElement(P.Icon,{prefix:"designericon",type:"qiehuan",className:"operation-bar-name-icon"}),k().createElement("span",{className:"switchfield_action_text"},"转换"))))}));co.displayName="SwitchField";var uo=co,so=function(e,t){var n=t.Hide;return!(!n||"object"!==(0,be.c)(n))&&n.Hide},fo=(0,D.memo)((function(){var e=(0,D.useContext)(oe).prefixCls,t=(0,D.useState)(!1),n=(0,s.c)(t,2),r=n[0],a=n[1],l=(0,D.useRef)({}),o=(0,D.useRef)({}),i=(0,D.useRef)(null);return(0,M.useOnClickOutside)([i],(function(e){a(!1)})),(0,D.useEffect)((function(){var e=function(e){var t,n=e.event,r=e.field,i=n.pageX,c=n.pageY;l.current.style.cssText+=b()(t=";left: ".concat(i,"px;top: ")).call(t,c,"px;"),o.current=r,a(!0)};return M.eventBus.on("contextmenu",e),function(){M.eventBus.off("contextmenu",e)}}),[]),(0,D.useEffect)((function(){var e=function(e){var t=document.getElementById("app");(!t||null!=t&&t.contains(e.target))&&r&&a(!1)};return window.addEventListener("scroll",e,!0),function(){window.removeEventListener("scroll",e,!0)}}),[r]),(0,ae.createPortal)(k().createElement("div",{ref:l,className:"".concat(e,"_contextmenu")},k().createElement(M.DropDownPanel,{popperClassName:"".concat(e,"-quick-setting-dropdown"),visible:r,onVisibleChange:function(e){return a(e)},placement:"bottomLeft",content:k().createElement(go,{ref:i,controlId:o.current.Id,field:o.current,prefixCls:e})})),document.body)})),po=fo;function mo(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function vo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mo(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):mo(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var go=(0,D.memo)((0,D.forwardRef)((function(e,t){var n,r=e.prefixCls,a=e.controlId,l=(0,D.useContext)(oe).getKdesignerApi,o=(0,D.useMemo)((function(){return l()}),[]),i=o.meta,c=o.data,u=c.findControl(a),d=(u||{})._Type_,s=c.getData(),f=i.getDefaultData(d),p=i.getControlMeta(d),m=(0,D.useMemo)((function(){return vo(vo({},f),u)}),[f,u]),v=(0,M.getModelData)(p.Properties,vo(vo({},s),{},{field:m}))||[],g=En()(n=function(e,t,n){var r,a=[],l=xt(e);try{for(l.s();!(r=l.n()).done;){var o=r.value,i=o.Nodes,c=void 0===i?[]:i,u=o.Key;if(0===t.length||S()(t).call(t,u)){var d,s=xt(c);try{for(s.s();!(d=s.n()).done;){var f=d.value;!1!==f.Visible&&n(f)&&a.push(f)}}catch(e){s.e(e)}finally{s.f()}}}}catch(e){l.e(e)}finally{l.f()}return a}(v,[],(function(e){var t;return!so(0,e)&&(null==e||null===(t=e.Editor)||void 0===t?void 0:t.EnableQuickSetting)}))).call(n,(function(e,t){return e.GroupSubSeq-t.GroupSubSeq}));return(0,M.useDataChangeForceUpdateEffect)(o),null!=u&&u.Id?k().createElement("div",{className:"setting-panel",ref:t},k().createElement(uo,{field:m}),(null==g?void 0:g.length)>0&&k().createElement("div",{className:"basic-setting ".concat(r,"-property-view")},T()(g).call(g,(function(e){return k().createElement(M.PropertyViewItem,(0,B.c)({},e,{key:e.Id,field:m,className:"kdesigner-right-view",enableMutiSelect:!1}))})))):null}))),yo=(0,D.memo)((function(e){var t=e.field,n=e.mainViewDom,r=e.prefixCls,a=(0,D.useState)(!1),l=(0,s.c)(a,2),o=l[0],i=l[1],c=(0,D.useContext)(oe).getKdesignerApi,u=((0,D.useMemo)((function(){return c()}),[]),(0,D.useRef)(null)),d=(0,D.useRef)(null);return(0,M.useOnClickOutside)([u,d],(function(e){var t=document.getElementById("app");(!t||null!=t&&t.contains(e.target))&&o&&(i(!1),n.focus())})),(0,D.useEffect)((function(){var e=function(e){var t=document.getElementById("app");(!t||null!=t&&t.contains(e.target))&&o&&i(!1)};return window.addEventListener("scroll",e,!0),function(){window.removeEventListener("scroll",e,!0)}}),[o]),k().createElement(M.DropDownPanel,{gap:2,ref:d,visible:o,placement:"bottomLeft",popperClassName:"".concat(r,"-quick-setting-dropdown"),content:o?!!t.Id&&k().createElement(go,{ref:u,controlId:t.Id,field:t,prefixCls:r}):k().createElement("div",null)},k().createElement("span",{className:"operation-bar-item",onClick:function(e){e.stopPropagation(),i((function(e){return!e})),n.focus()},title:"设置"},k().createElement(P.Icon,{prefix:"designericon",type:"shezhi"})))}),(function(e,t){return(0,De.isEqual)(e.field,t.field)&&e.mainViewDom===t.mainViewDom})),Co="ui-designer-root",ho="1050",bo="-1";function Eo(e,t){if(t){var n=0,r=new window.IntersectionObserver((function(e){e.forEach((function(e){if(e.intersectionRatio!==n){if(e.intersectionRatio<1&&e.intersectionRatio>0){var r=e.boundingClientRect,a=e.intersectionRect;n>e.intersectionRatio&&r.top<a.top||r.bottom==a.bottom&&r.top<a.top?(t.setAttribute("data-visible","true"),t.style.zIndex=bo):(t.setAttribute("data-visible","true"),t.style.zIndex=ho)}else e.intersectionRatio>0?(t.setAttribute("data-visible","true"),t.style.zIndex=ho):(t.setAttribute("data-visible","false"),t.style.zIndex=bo);n=e.intersectionRatio}}))}),{threshold:[1e-6,.999999]});return r.observe(e),r}}var Io=(0,D.memo)((function(e){var t=e.prefixCls,n=e.field,r=e.kdesignerApi,a=e.mainViewDom,l=e.rootDom,o=e.billPropsData,i=e.dispatchBillData,c=e.getHideField,u=e.setHideField,d=n.Id,f=n._Type_,p=n.SourceForm,m=n.ColumnSpan,v=void 0===m?1:m,y=n.Status,C=n.Margin,h=(0,D.useContext)(M.GlobalConfigContext).showMessage,b=r.data,E=r.selection,I=r.meta,N=(0,D.useRef)(null),T=b.getData(),x=b.getRootId(),A=b.findControl(x).ColumnSpan,F=void 0===A?2:A,w=I.getControlMeta(f),R=w.Inside,B=w.CategoryId,O=w.Name,j=S()(B).call(B,Le),L=document.querySelector('[data-control-id="'.concat(d,'"]')),K=(0,D.useReducer)((function(e){return e+1}),0),U=(0,s.c)(K,2)[1];(0,D.useEffect)((function(){var e=N.current;if(e){var t=Eo(L,e);return function(){t.disconnect()}}}),[N.current,L]);var V=(0,D.useCallback)((function(e){var t=N.current;if(t&&l&&e){var n=l.getBoundingClientRect(),r=t.getBoundingClientRect().width,a=e.left,o=e.top,i=(e.width,n.left),c=n.top,u=n.width,d=n.height,s=a<i?i:a;a+r>i+u&&(s=i+u-r);var f=o-24-2;t.style.left="".concat(s,"px"),t.style.top="".concat(f,"px");var p=f>=c-24-2&&f<=c+d;"true"===t.dataset.visible&&(p&&t.style.zIndex===bo?t.style.zIndex=ho:p||t.style.zIndex!==ho||(t.style.zIndex=bo))}}),[N.current,l,L]);(0,M.useTraceElementPosition)({selectedCtrlNode:L,callback:V,depth:[v,y,F,C]});var z=lo(n),H=(0,D.useMemo)((function(){return mn(f)}),[f,mn]);(0,D.useEffect)((function(){var e=function(){V(null==L?void 0:L.getBoundingClientRect())},t=document.getElementById("nocode-designer-main-root");if(L){var n=Wt(L,e),r=Wt(t,e);return function(){n&&n.removeResizeObserve(),r&&r.removeResizeObserve()}}}),[]),(0,D.useEffect)((function(){var e=b.addDataChangeListener((function(){e&&U()}));return function(){e&&e(),e=null}}),[U]);var q=(0,D.useMemo)((function(){var e=b.getParentControl(d);return!!it(null==e?void 0:e._Type_)&&"2"===e.SourceForm}),[d,o,p]),Y=(0,D.useMemo)((function(){return it(f)||et(f)}),[f]);return L&&L.getAttribute("id")!==Co&&a&&!R?k().createElement("div",{ref:N,className:"".concat(t,"-operation-bar-wrap")},k().createElement("div",{className:"operation-bar-name mr-2"},k().createElement(P.Icon,{prefix:"designericon",type:H,className:"operation-bar-name-icon"}),k().createElement("span",null,z||"")),k().createElement("div",{className:"operation-bar-left"},!q&&!Y&&k().createElement("span",{className:Vn()(["operation-bar-item"]),onClick:function(e){if(a.focus(),j)return h("".concat(O,"只能在画布中添加一次，不能重复。"));e.stopPropagation();var t=E.getSelection(),r=b.findControl(t[0]),l=un(kt(T,n,n[G]),x),o=g()(l).call(l,(function(e){return et(e._Type_)||it(e._Type_)}));if(yt(r._Type_)){var i,c,u=null===(i=b.getAllSubControls(r.Id))||void 0===i||null===(c=g()(i))||void 0===c?void 0:c.call(i,(function(e){return nt(null==e?void 0:e._Type_)}));if(o.length||null!=u&&u.length)return void h("分组内包含关联表单、表格或系统字段，不能重复。")}var s=b.findControlIndex(d)+1;b.addControl((0,M.createPasteAction)(l,{index:s})).then((function(){E.setSelect([l[0][_]])}))},title:"重复"},k().createElement(P.Icon,{prefix:"designericon",type:"zhongfu"})),k().createElement("span",{className:Vn()(["operation-bar-item"]),onClick:function(e){a.focus(),e.stopPropagation();var t=b.getNextSelectedControlId(d),r=c();Pa([d],o,i,b,r,u,(function(){var e=t,r=b.findControl(t);ut(f)&&!r?e=x:r&&!Fa(r)||(e=n[G]),E.setSelect([e])}))},title:"删除"},k().createElement(P.Icon,{prefix:"designericon",type:"shanchu"}))),!q&&k().createElement(yo,{mainViewDom:a,field:n,prefixCls:t})):null})),No=function(e){var t=(0,D.useContext)(oe),n=t.getKdesignerApi,r=t.prefixCls,a=t.isPC,l=t.billPropsData,o=t.dispatchBillData,i=t.getHideFieldRef,c=t.setHideFieldRef,u=(0,D.useMemo)((function(){return n()}),[]),d=u.data,f=u.selection,p=u.meta,m=f.getSelection(),v=d.getRootId(),g=(d.findControl(v).ColumnSpan,document.getElementById(je)),y=document.getElementById(Co),C=(0,D.useReducer)((function(e){return e+1}),0),h=(0,s.c)(C,2),E=h[0],I=h[1];(0,D.useRef)("");return(0,M.useSelectionChangeForceUpdateEffect)(u),(0,D.useLayoutEffect)((function(){I()}),[a]),k().createElement(k().Fragment,null,T()(m).call(m,(function(e){var t,n,a,s=d.findControl(e)||{},f=s.ColumnSpan,m=void 0===f?1:f,v=s._Type_,C=vo(vo({},p.getDefaultData(v)),s),h=ut(v)?document.getElementById("biz-button-panel"):y,I=d.findControlIndex(e),N=b()(t=b()(n=b()(a="operation-bar-item-".concat(e,"-")).call(a,I,"-")).call(n,m,"-")).call(t,E);return k().createElement(Io,{key:N,prefixCls:r,billPropsData:l,dispatchBillData:o,getHideField:i,setHideField:c,field:C,mainViewDom:g,rootDom:h,kdesignerApi:u})})),k().createElement(po,null))},To={1:"default",2:"disabled",3:"readonly",4:"hidden"},xo=function(e,t){return ot(t)||ut(e)},Ao=(0,D.memo)((function(e){var t=e.prefixCls,n=e.field,r=e.rootDom,a=e.kdesignerApi,l=e.containerDom,o=e.floatMenu,i=e.fieldStatusMap,c=e.fieldStatusSettingOptions,u=void 0===c?{}:c,d=e.dispatchFieldStatus,p=n.Id,m=n._Type_,v=n.Key,g=n.Status,y=n.FieldRequired,C=n.ParentId,h=a.data,b=(a.selection,a.meta),E=(0,D.useRef)(null),I=r.getBoundingClientRect(),N=b.getControlMeta(m),x=N.Inside,A=(N.CategoryId,N.Name,N.IsContainer),F=h.findControl(C)._Type_,S=u.defaultStatus,w=void 0===S?"default":S,R=u.hideMenu,_=void 0===R?xo:R,O=u.onFieldStatusChange,j=b.getControlMetaEditor(m,"Status"),L=(0,D.useState)(!1),K=(0,s.c)(L,2),U=K[0],V=K[1],G=(0,D.useMemo)((function(){if(null!=i&&i[v])return i[v];if(!o||null==o||!o.length){var e=To[g]||w;return e===w&&"2"===y?"mustInput":e}return w}),[v,i,o,g,y,u]),z=(0,D.useMemo)((function(){if(!(0,De.isUndefined)(o))return o;var e=(j||{}).Enum,t=[];return null==e||e.forEach((function(e){t.push({key:To[e.Id],label:e.Name})})),A&&!it(m)||!t.length||t.push({key:"mustInput",label:"必填"}),t}),[j,A,o,m]);(0,D.useEffect)((function(){var e=E.current;if(e){var t=Eo(l,e);return function(){t.disconnect()}}}),[E.current,l]);var H=(0,D.useCallback)((function(e){var t=E.current;if(t&&r){t.getBoundingClientRect().width;var n=e.left,a=e.top,l=(e.width,I.left),o=I.top,i=(I.width,I.height),c=n<l?l:n,u=a-24-2;t.style.left="".concat(c,"px"),t.style.top="".concat(u,"px");var d=u>=o-24-2&&u<=o+i;"true"===t.dataset.visible&&(d&&t.style.zIndex===bo?t.style.zIndex=ho:d||t.style.zIndex!==ho||(t.style.zIndex=bo))}}),[E.current,r,I]);(0,M.useTraceElementPosition)({selectedCtrlNode:l,callback:H});var q=(0,D.useMemo)((function(){var e,t;return(null===(e=Ae()(z).call(z,(function(e){return e.key===G})))||void 0===e?void 0:e.label)||(null===(t=z[0])||void 0===t?void 0:t.label)}),[z,G]),Y=function(e){if(V(!1),"function"!=typeof O)if(it(m)){var t=(h.findControlByCondition((function(e){return e.ParentId===p}))||[]).reduce((function(t,n){return(0,B.c)(t,(0,f.c)({},n.Key,e))}),(0,f.c)({},v,e));d(t)}else d((0,f.c)({},v,e));else null==O||O(e,n,a,d,i)},W=(0,D.useMemo)((function(){return k().createElement(P.Dropdown.Menu,{onClick:Y},T()(z).call(z,(function(e){return k().createElement(P.Dropdown.Item,{key:e.key},k().createElement("span",{className:"".concat(t,"-permission-setting-panel-item")},e.label||e.key))})))}),[z]);return!l||l.getAttribute("id")===Co||!r||null!=_&&_(m,F)||x?null:k().createElement("div",{ref:E,className:"".concat(t,"-permission-setting-wrap")},k().createElement(P.Dropdown,{selectable:!0,popperClassName:"".concat(t,"-permission-setting-panel"),trigger:"click",visible:U,onVisibleChange:V,selectedKey:G,menu:W},k().createElement("div",{className:"permission-setting-label"},k().createElement("span",{className:"permission-setting-label-text"},q),k().createElement(P.Icon,{className:"permission-setting-label-icon",prefix:"designericon",type:U?"xialajiantoufanxiang":"xialajiantou"}))))}));Ao.displayName="PermissionSettingItem";var Fo=function(e){var t=(0,D.useContext)(oe),n=t.getKdesignerApi,r=t.prefixCls,a=t.floatMenu,l=t.fieldStatusMap,o=t.dispatchFieldStatus,i=t.fieldStatusSettingOptions,c=(0,D.useMemo)((function(){return n()}),[]),u=c.data,d=c.selection.getSelection(),f=u.getRootId(),p=document.querySelector('[data-control-id="'.concat(f,'"]')),m=(0,D.useReducer)((function(e){return e+1}),0);(0,s.c)(m,2)[1];return(0,M.useSelectionChangeForceUpdateEffect)(c),(0,M.useDataChangeForceUpdateEffect)(c),k().createElement(k().Fragment,null,T()(d).call(d,(function(e){var t,n,d=u.findControl(e),s=d.ColumnSpan,f=void 0===s?1:s,m=(d._Type_,u.findControlIndex(e)),v=document.querySelector('[data-control-id="'.concat(e,'"]'));return k().createElement(Ao,{key:b()(t=b()(n="permission-setting-item-".concat(e,"-")).call(n,m,"-")).call(t,f),prefixCls:r,field:d,rootDom:p,containerDom:v,kdesignerApi:c,floatMenu:a,fieldStatusMap:l,fieldStatusSettingOptions:i,dispatchFieldStatus:o})})))},So=function(e){var t=(0,(0,D.useContext)(oe).getKdesignerApi)(),n=e.name,r=e.id,a=e.onSelect,l=e.getClassName,o=e.isActive,i=t.data.findControl(r)._Root_;return k().createElement("div",{className:Vn()(l("item"),(0,f.c)((0,f.c)({},l("active-item"),o),l("item-disabled"),i)),onClick:function(){a({name:n,id:r,disabled:i})}},k().createElement("div",{className:l("item-text")},k().createElement("span",null,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return e?me()(e).length>t?Se()(e).call(e,0,t)+"...":e:""}(n))),k().createElement("div",{className:l("item-text-dumb-node")}))},Do=function(e){var t=e.items,n=e.onSelect,r=e.prefixCls,a=void 0===r?"":r,l=(0,D.useState)(!1),o=(0,s.c)(l,2),i=o[0],c=o[1],u=(0,D.useState)(!1),d=(0,s.c)(u,2),f=d[0],p=d[1],m=(0,D.useRef)(null),v=(0,D.useRef)(null),g=(0,D.useCallback)((function(e){var t;return b()(t="".concat(a,"-")).call(t,e)}),[]),y=(0,D.useCallback)((function(e,t){var n=e.offsetWidth,r=t.offsetWidth;if(r>n){var a=e.scrollLeft;a>0?a+n>=r?(p(!1),c(!0)):(p(!0),c(!0)):(c(!1),p(!0))}else c(!1),p(!1)}),[]);(0,D.useEffect)((function(){var e=new bt.c((function(e){var t=(0,s.c)(e,1)[0],n=t.target.parentElement;M.console.log("resize-----"),y(n,t.target)}));return e.observe(v.current),function(){e.disconnect()}}),[]);var C=function(e){M.console.log("Scroll resize-----");var t=m.current,n=v.current;y(t,n)},h=function(e){var t=m.current.offsetWidth;m.current.scrollLeft=Math.max(0,m.current.scrollLeft+("left"===e?-t:t))},E=function(e,t){t.stopPropagation();M.console.log(t,t.deltaY,t.deltaMode);var n=.4*t.deltaY;m.current.scrollLeft=Math.max(0,m.current.scrollLeft+("left"===e?-n:n))};return(0,D.useEffect)((function(){var e=m.current,t=v.current,n=e.offsetWidth,r=t.offsetWidth;r>n&&(e.scrollLeft=r-n)}),[t]),k().createElement("div",{className:g("container-box"),onScroll:C},i&&k().createElement("div",{className:g("left-arrow"),onClick:function(){return h("left")},onWheel:function(e){return E("left",e)}},k().createElement(P.Icon,{type:"zuoqie",prefix:"designericon"})),k().createElement("div",{className:g("container"),ref:m,onScroll:C},k().createElement("div",{className:g("list"),ref:v},T()(t).call(t,(function(e,r){return k().createElement(So,(0,B.c)({},e,{onSelect:n,getClassName:g,key:e.id,isActive:r===t.length-1}))})))),f&&k().createElement("div",{className:g("right-arrow"),onClick:function(){return h("right")},onWheel:function(e){return E("right",e)}},k().createElement(P.Icon,{type:"youqie",prefix:"designericon"})))},ko=function(){var e=(0,D.useContext)(oe),t=e.prefixCls,n=e.getKdesignerApi,r=e.getPrefixCls,a=n(),l=(0,D.useCallback)((function(){var e,t=a.selection.getActiveSelectedId(),n=a.data.getAllParentControls(t,!0);return T()(e=n.reverse()).call(e,(function(e){return{id:e.Id,name:e.Name}}))}),[]),o=(0,D.useState)(l),i=(0,s.c)(o,2),c=i[0],u=i[1];(0,D.useEffect)((function(){var e=function(){var e=l();u(e)},t=a.selection.addSelectChangeListener(e),n=a.data.addDataChangeListener(e);return function(){t(),n()}}),[]);var d=(0,D.useCallback)((function(e){var t=e.id;e.disabled||a.selection.setSelect([t])}),[]);return k().createElement(Do,{items:c,onSelect:d,prefixCls:r(t,"breadcrumb")})},Mo=(0,D.memo)((0,D.forwardRef)((function(e,t){var n=e.className,r=(0,D.useContext)(oe).prefixCls,a=t||(0,D.useRef)(null);return k().createElement("div",{ref:a,className:Vn()("".concat(r,"_erroricon"),n)},k().createElement("div",{className:"".concat(r,"_erroricon_content")},k().createElement(P.Icon,{className:"".concat(r,"_erroricon_gantanhao"),prefix:"designericon",type:"gantanhao"})))})));Mo.displayName="ErrorIcon";var wo=Mo,Po=function(e){var t=e.prefixCls,n=e.id,r=(e.rootDom,e.nodeErrorData),a=document.querySelector('[data-control-id="'.concat(n,'"]')),l=(0,D.useRef)(),o=(0,D.useMemo)((function(){var e;return(null===(e=m()(r||{}))||void 0===e?void 0:e.length)||0}),[r]),i=(0,D.useMemo)((function(){return 0===o?"":"存在有".concat(o,"条错误，请修复后再发布！")}),[r,o]);return a?o>0?(null==a||a.setAttribute("data-control-error",n),(0,ae.createPortal)(k().createElement(P.Tooltip,{tip:i},k().createElement(wo,{ref:l,className:"".concat(t,"-error-tips")})),a)):(null==a||a.removeAttribute("data-control-error"),null):null};Po.displayName="ErrorTips";var Ro=Po,Bo=new(Pe()),_o=function(e,t){if(null!=Bo&&Bo.has(e)){var n=Bo.get(e);n.set(t,!0),Bo.set(e,n)}else{var r=new(Pe());r.set(t,!0),Bo.set(e,r)}},Oo=function(e,t){return!(null==Bo||!Bo.has(e))&&Bo.get(e).has(t)},jo=function(e){if(e){var t=Bo.get(e);t&&(t.clear(),Bo.set(e,t))}},Lo=function(e,t){Bo.set(e,t)},Ko=function(e){return e?Bo.get(e):Bo},Uo=function(e){return Bo.has(e)},Vo=function(e){return!!Uo(e)&&Bo.delete(e)},Go=function(e){var t=e.data,n=(e.selection,e.error),r=n.getError();(0,M.useErrorChangeForceUpdateEffect)(e);var a=(0,D.useCallback)((function(e){var t;if(n){var a=e;m()(a||{}).length||jo("controlId");var l={};m()(a).forEach((function(e){var t;a[e]&&(l[e]={},null===(t=a[e])||void 0===t||t.forEach((function(t){var n,r=t.propertyName,a=t.error;l[e][r]?l[e][r]=b()(n=[]).call(n,(0,R.c)(l[e][r]),[{msg:a}]):l[e][r]={msg:[a]}})))})),(null===(t=m()(r))||void 0===t?void 0:t.length)>0&&m()(r).forEach((function(e){if(!l[e]){var t=document.querySelector('[data-control-error="'.concat(e,'"]'));t&&t.removeAttribute("data-control-error")}})),n.replaceError(l)}}),[n,r]);(0,D.useEffect)((function(){return M.eventBus.on(gr,a),function(){M.eventBus.off(gr,a)}}),[a,r]);var l=(0,D.useCallback)((function(e){e.type,e.value;var t=e.actions;if((null==t?void 0:t.length)>0){for(var a=[],l=0;l<t.length;l++){var o=t[l]||{},i=o.type,c=o.value;"DELETE"===i&&r[c]&&a.push(c)}a.length>0&&n.deleteError(a)}}),[r]);(0,D.useEffect)((function(){var e=t.addDataChangeListener(l);return function(){e()}}),[r])},zo=function(e){if(e){var t=document.querySelector('[data-control-id="'.concat(e,'"]'));t&&(null!=t&&t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():null==t||t.scrollIntoView({block:"center"}))}},Ho=function(e){var t=e.isPC,n=e.errorControlIdList,r=e.error,a=e.root,l=e.prefixCls,o=(0,D.useState)([]),i=(0,s.c)(o,2),c=i[0],u=i[1],d=(0,D.useState)([]),f=(0,s.c)(d,2),p=f[0],v=f[1],y=(0,D.useMemo)((function(){return{root:a,rootMargin:"0px 0px 0px 0px",threshold:[0,.25,.5,.75,1],trackVisibility:!0,delay:200}}),[a]),C=(0,D.useCallback)((function(e,t){var n,r=window.IntersectionObserver;if(r&&e)return n=new r((function(e){t(e)}),y),n.observe(e),n}),[y]),h=function(e,t){return S()(e).call(e,t)?g()(e).call(e,(function(e){return e!==t})):e},E=(0,D.useCallback)((function(e,t,n){t.forEach((function(t){var n=t.rootBounds,r=n.top,a=n.height;if(t.isIntersecting)v((function(t){return h(t,e)})),u((function(t){return h(t,e)}));else{var l=t.boundingClientRect.y>a,o=t.boundingClientRect.y<r;l?v((function(){var t;return S()(p).call(p,e)?p:b()(t=[]).call(t,(0,R.c)(p),[e])})):o&&u((function(){var t;return S()(c).call(c,e)?c:b()(t=[]).call(t,(0,R.c)(c),[e])}))}}))}),[p,c]);(0,D.useEffect)((function(){if((null==n?void 0:n.length)>0){for(var e={},t=function(){var t,l=n[a];if(r[l]&&null!==(t=m()(r[l]))&&void 0!==t&&t.length){var o=document.querySelector('[data-control-id="'.concat(l,'"]'));e[l]=C(o,(function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];E.apply(void 0,b()(e=[l]).call(e,n))}))}else{var i;null===(i=e[l])||void 0===i||i.disconnect(),v((function(e){return h(e,l)})),u((function(e){return h(e,l)}))}},a=0;a<(null==n?void 0:n.length);a++)t();return function(){m()(e).forEach((function(t){var n;null===(n=e[t])||void 0===n||n.disconnect()}))}}}),[t,n,p,c]),(0,D.useEffect)((function(){null!=n&&n.length||(v([]),u([]))}),[n]);return k().createElement(k().Fragment,null,c.length>0&&k().createElement("div",{className:Vn()("".concat(l,"_errorguide"),"".concat(l,"_errorguide_top")),title:"定位到错误的字段",onClick:function(){if(c.length>0){var e=c[0];zo(e)}}},k().createElement(P.Icon,{className:"".concat(l,"_errorguide_shuidi"),prefix:"designericon",type:"shuidizhixiang"}),k().createElement(wo,{className:"".concat(l,"_errorguide_icon")})),p.length>0&&k().createElement("div",{className:Vn()("".concat(l,"_errorguide"),"".concat(l,"_errorguide_bottom")),title:"定位到错误的字段",onClick:function(){if(p.length>0){var e=p[0];zo(e)}}},k().createElement(P.Icon,{className:"".concat(l,"_errorguide_shuidi"),prefix:"designericon",type:"shuidizhixiang"}),k().createElement(wo,{className:"".concat(l,"_errorguide_icon")})))},qo=function(e){var t=(0,D.useContext)(oe),n=t.getKdesignerApi,r=t.prefixCls,a=t.isPC,l=(0,D.useMemo)((function(){return n()}),[]),o=l.data,i=(l.selection,l.error),c=o.getRootId(),u=i.getError(),d=(0,D.useMemo)((function(){return m()(u)}),[u]),f=o.getData(),p=document.getElementById(je),v=document.querySelector('[data-control-id="'.concat(c,'"]')),g=(0,D.useReducer)((function(e){return e+1}),0),y=(0,s.c)(g,2)[1];return(0,M.useErrorChangeForceUpdateEffect)(l),Go(l),(0,D.useLayoutEffect)((function(){y()}),[a,f.Items.length]),k().createElement(k().Fragment,null,T()(d).call(d,(function(e){return k().createElement(Ro,{key:e,prefixCls:r,id:e,nodeErrorData:u[e],rootDom:v})})),v&&(0,ae.createPortal)(k().createElement(Ho,{isPC:a,prefixCls:r,errorControlIdList:d,error:u,root:p}),v))},Yo=(0,D.memo)((function(e){e.field;var t,n=(0,D.useContext)(oe),r=n.prefixCls,a=n.getKdesignerApi,l=(0,D.useMemo)((function(){return"".concat(r,"-bizbuttonpanel")}),[r]),o=(0,D.useReducer)((function(e){return e+1}),0),i=(0,s.c)(o,2)[1],c=a(),u=c.data,d=c.selection;(0,D.useEffect)((function(){var e=u.addDataChangeListener(g);return function(){e()}}),[]);var f=u.findControl,p=u.getData(),m=Ae()(t=p[z]).call(t,(function(e){return e[K]===Ve}))||{},v=zn(m,p,{ctrlType:Ue},f),g=(0,D.useCallback)((function(e){e.type;var t=e.value;if(Array.isArray(null==t?void 0:t.Items)){for(var n=null,r=!1,a=t.Items,l=0;l<a.length;l++){var o=a[l],c=o[K];if(c===Ve)n=o;else if(c===Ue){r=!0;break}}if(!r&&n){var s=n.Id,f=u.getRootId();u.deleteControl((0,M.createDeleteAction)([s])).then((function(){d.setSelect([f])}))}}i()}),[]),y=re(m),C=wn();if(0!==(null==v?void 0:v.length))return k().createElement("div",(0,B.c)({className:l},y,{"data-drag-id":m.Id},C),k().createElement("div",{className:"".concat(l,"-main"),id:"biz-button-panel"},k().createElement("div",{className:"".concat(l,"-main-content")},k().createElement("div",{className:"".concat(l,"-main-scroll")},v))))}));Yo.displayName="BizButtonPanel";var Wo=Yo,Xo=(0,D.memo)((function(e){var t=(0,D.useContext)(oe),n=t.getKdesignerApi,r=t.prefixCls,a=t.isPC,l=t.fieldStatusSettingMode,o=t.floatMenu,i=(0,D.useReducer)((function(e){return e+1}),0),c=(0,s.c)(i,2)[1],u=(0,D.useMemo)((function(){return n()}),[]),d=u.data,f=u.selection,p=d.getRootId(),m=d.findControl(p),v=Ol(m),g=(0,D.useRef)(null),y=sn(),C=(0,D.useCallback)((function(){f.getSelection().forEach((function(e){var t;return(0,R.c)(document.querySelectorAll(b()(t="[".concat(q,'="')).call(t,e,'"]'))).forEach((function(e){e.getAttribute(X)||e.setAttribute(X,"true")}))}))}),[]),h=(0,D.useCallback)((function(e){e.type,e.value;c(),setTimeout((function(){C()}),100)}),[]);(0,D.useEffect)((function(){var e=f.addSelectChangeListener(jl),t=d.addDataChangeListener(h);return function(){e(),t()}}),[]),(0,D.useLayoutEffect)((function(){C()}),[a]),Ql(g),Zl(m,u);var E=(0,D.useMemo)((function(){return{prefixCls:"kd"}}),[]);return k().createElement(k().Fragment,null,k().createElement(ao,null),k().createElement(P.ConfigProvider,{value:E},k().createElement("div",{className:"".concat(r,"-main-view-container"),ref:g,id:je,tabIndex:-1},k().cloneElement(v,{onClick:y}),k().createElement(Wo,{field:m})),!l&&k().createElement(ko,null)),l?k().createElement(Fo,{floatMenu:o}):k().createElement(No,null),k().createElement(qo,null))}));Xo.tabKey="MainView",Xo.tabName="主视图",Xo.displayName="MainView";var Qo=Xo,Zo="kdesigner-tree-node-drag-line-by-control",Jo="control",$o="",ei=["\\"],ti=function(e){e.preventDefault()},ni=function(){var e=(0,D.useContext)(oe).getKdesignerApi,t=(0,D.useMemo)((function(){return e()}),[]),n=t.data,r=t.views,a=t.selection,l=(t.meta,n.getRootId()),o=(0,D.useContext)(M.GlobalConfigContext).showMessage,i=(0,D.useCallback)((function(e){!function(e,t){"outline"!==(Jo=null==t?void 0:t.getViewActiveKey("left"))&&t&&t.setViewActiveKey("left")("outline"),$o=$o||Jo}(0,r)}),[]),c=(0,D.useCallback)((function(e){!function(e){var t;if(!ei.some((function(t){return e.indexOf(t)>=0}))){var n=e.replace("/","\\/").replace("=","\\="),r=document.querySelector(".kdesigner-tree-node-item-id".concat(n," .kdesigner-tree-node-root"));if(r){var a=null==r?void 0:r.className;S()(a).call(a,Zo)||(r.className=b()(t="".concat(a," ")).call(t,Zo))}}}(e)}),[]),u=(0,D.useCallback)((function(e){var t;ti(e);var n=document.querySelector(b()(t="[".concat(q,"='")).call(t,l,"']"));null==n||n.removeAttribute(te)}),[]);(0,D.useEffect)((function(){return M.eventBus.on("drag-control-tab",i),M.eventBus.on("drag-control_".concat(l),c),document.body.addEventListener("dragend",u),function(){M.eventBus.off("drag-control-tab",i),M.eventBus.off("drag-control_".concat(l),c),document.body.removeEventListener("dragend",u)}}),[]);var d=(0,D.useCallback)((function(e){var t,r=e.event,a=e.node;r.stopPropagation();var o=a.nodeKey;(o=o.substr(2))===l&&ti(r);var i=document.querySelector(b()(t="[".concat(q,"='")).call(t,l,"']"));null==i||i.setAttribute(te,o);var c=n.findControl(o),u=c._Type_,d=c.Name;yn(r,u,d)}),[l]),s=(0,D.useCallback)((function(e){e.event,e.node}),[]),f=(0,D.useCallback)((0,De.debounce)((function(e){e.event;var t=e.node;M.eventBus.emit("drag-tree-node",t.key)}),100),[]),p=(0,D.useCallback)((function(e){e.event,e.node}),[]),m=(0,D.useCallback)((function(e){e.event;var t,r=e.node,i=e.dropPosition,c=r.key,u=document.querySelector(b()(t="[".concat(q,"='")).call(t,l,"']")).dataset.outlineDragTreeNode,d=Se()(c).call(c,2),s=n.findControl(u),f=n.findControl(d);d===l&&0!==i||(s.Id!==f.ParentId?n.swapControl((0,M.createSwapAction)({origin:u,target:Se()(c).call(c,2),isPrev:-1===i&&d!==l,dropPosition:i})).then((function(e){a.setSelect([u])})):o("控件类型不符合，不能添加。"))}),[]);return{onDragStart:d,onDragEnter:s,onDragOver:f,onDragLeave:p,onDrop:m,onDragEnd:(0,D.useCallback)((function(e){e.event;var t,n=e.node,r=document.querySelector(b()(t="[".concat(q,"='")).call(t,l,"']"));null==r||r.removeAttribute(te),M.eventBus.emit("drag-tree-node",n.key)}),[])}};function ri(e,t){var n=void 0!==ge()&&Ce()(e)||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return ai(e,t);var r=Se()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return me()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ai(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,l=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw l}}}}function ai(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function li(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function oi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?li(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):li(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var ii=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=(0,R.c)(e),a=[],l={},o=[];return r.forEach((function(e,r){var i,c=e.Id,u=e.Name,d=e.ParentId,s=e.Key,f=e._Type_,p=e.Multi,m=e.SelectItemType,v=t.getControlMeta(f).Name,g=d?b()(i="[".concat(v,"]")).call(i,u||s||c):"".concat(u||s||c),y={key:n?"${"+"model.".concat(s)+"}":s,title:g,parentId:d,id:c,type:f,isLeaf:!0};if(Vt(f)&&(y.selectable=!1,y.isLeaf=null),dt(f)&&(y.title+="（".concat(1==m?"多选":"单选","）")),et(f)){var C=t.getControlPropertyDefaultValue(f,"BillEntityIdEx"),h=oi({BillEntityId:C,BillEntityIdEx:C},e),E=h.BillEntityId,I=h.BillEntityIdEx;y.title+="（".concat("1"===p?"多条":"单条","）"),y.children=[],y.isAsyncNode=!0,y.isLeaf=null,y.BillEntityId=E,y.BillEntityIdEx=I}var N=n?"${"+"model.".concat(s,"_startdate")+"}":"".concat(s,"_startdate"),T=n?"${"+"model.".concat(s,"_enddate")+"}":"".concat(s,"_enddate");Je(f)?(a.push(oi(oi({},y),{},{key:N,title:g+".开始"})),a.push(oi(oi({},y),{},{key:T,title:g+".结束"}))):a.push(y),y.parentId?Je(f)?(o.push(oi(oi({},y),{},{key:N,title:g+".开始"})),o.push(oi(oi({},y),{},{key:T,title:g+".结束"}))):o.push(y):l=oi(oi({},y),{},{isLeaf:!1})})),function e(t,n,r){var a=(0,R.c)(n),l=0;n.forEach((function(n,o){if((null==n?void 0:n.parentId)===t.id){var i,c=b()(i="".concat(r,"_")).call(i,l++);ue()(a).call(a,o,1,void 0),t.children?t.children.push(n):t.children=[n],e(n,a,c)}}))}(l,o,"0"),[l]},ci=function(e){return"${"+"model.".concat(e)+"}"},ui=function e(t){var n=t.options,r=t.currRefbillTableKey,a=void 0===r?"":r,l=t.needFormatKey,o=void 0!==l&&l;return n?n.reduce((function(t,n){var r=n.key,l=n.title,i=n.titlePrefix,c=n.children,u=n.type,d=n.entityId,s=n.isMulti,f=a===r?i.replace("[多条]","[循环中：单条]"):i,p={key:o?ci(r):r,title:l,titlePrefix:f,type:u,isMulti:s,selectable:!0};return"group"===u&&(p.selectable=!1),et(u)&&(p.BillEntityId=d,p.BillEntityIdEx=d),c&&(p.children=e({options:c,needFormatKey:o})),b()(t).call(t,p)}),[]):n},di=function e(t){var n=t.metaApi,r=t.options;return r?r.reduce((function(t,r){var a,l=r.key,o=r.title,i=r.children,c=r.type,u=r.entityId,d=r.isMulti,s=r.titlePrefix,f=null!=l&&S()(l).call(l,"fbasedataid")?l.split(".fbasedataid")[0]:l,p=(null==f||null===(a=f.split("."))||void 0===a?void 0:a.length)||0;if(!Vt(c)&&p>1)return t;var m={key:"${"+"model.".concat(l)+"}",title:o,titlePrefix:s,type:c,isMulti:d};return(Vt(c)||ot(c))&&(m.selectable=!1,m.isLeaf=null),u&&(m.entityId=u),i&&(m.children=e({options:i,metaApi:n})),b()(t).call(t,m)}),[]):r},si=function e(t){var n=t.options;return n?n.reduce((function(t,n){var r,a=n.key,l=n.title,o=n.titlePrefix,i=n.children,c=n.type,u=n.isMulti,d=n.sourceForm,s={key:a,title:l,titlePrefix:o};return i&&!u&&(s.children=e({options:i})),"1"===d||a.split(".").length>1&&void 0!==d?t:et(c)||tt(c)||it(c)?b()(t).call(t,s):(s.selectable=!1,null!=s&&null!==(r=s.children)&&void 0!==r&&r.length?b()(t).call(t,s):t)}),[]):n},fi=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key";return t.reduce((function(t,r){var a=[];return r[n]&&a.push(r[n]),r.children&&a.push.apply(a,(0,R.c)(e(r.children,n))),b()(t).call(t,a)}),[])},pi=function(e){var t,n=[],r={},a=ri(e);try{for(a.s();!(t=a.n()).done;){var l=t.value;r[l.Id]=oi(oi({},l),{},{children:[]})}}catch(e){a.e(e)}finally{a.f()}var o,i=ri(e);try{for(i.s();!(o=i.n()).done;){var c=o.value;c.ParentId?r[c.ParentId]&&r[c.ParentId].children.push(r[c.Id]):n.push(r[c.Id])}}catch(e){i.e(e)}finally{i.f()}return n},mi={},vi="id",gi="",yi=(0,D.memo)((0,D.forwardRef)((function(e,t){var n=e.data,r=(0,D.useContext)(oe),a=r.getKdesignerApi,l=r.prefixCls,o=r.getPrefixCls,i=(0,D.useMemo)((function(){return a()}),[]),c=i.data,u=i.selection,d=c.getRootId(),f=(0,D.useState)(!0),p=(0,s.c)(f,2),v=p[0],y=p[1],C=(0,D.useState)(!1),h=(0,s.c)(C,2),E=h[0],I=h[1],N=(0,D.useState)([d]),x=(0,s.c)(N,2),A=x[0],F=x[1],w=(0,D.useState)(600),B=(0,s.c)(w,2),O=B[0],j=B[1],L=(0,D.useState)(void 0),U=(0,s.c)(L,2),V=U[0],G=U[1],H=(0,D.useRef)(null),q=(0,D.useRef)(null),Y=(0,D.useState)(n),W=(0,s.c)(Y,2),X=W[0],Q=W[1],Z=(0,D.useRef)(null);Ql(H,!0);var J=ni(),$=J.onDragStart,ee=J.onDragEnter,te=J.onDragOver,ne=J.onDragLeave,re=J.onDrop,ae=J.onDragEnd,le=o&&o(l,"outline"),ie=(0,D.useState)([]),ce=(0,s.c)(ie,2),de=ce[0],se=ce[1],fe=(0,D.useMemo)((function(){var e="".concat(le,"-search-prefix-icon");return k().createElement(P.Icon,{prefix:"designericon",type:"sousuo",className:e})}),[le]),pe=(0,D.useCallback)((function(e){var t=e.value,n=t.reduce((function(e,t){var n,r;return b()(n=[]).call(n,(0,R.c)(e),[b()(r="".concat(vi)).call(r,t)])}),[]);F(n);var r=(0,R.c)(de);t.forEach((function(e){for(var t,n=e;n!==d&&""!==n;){var a,l=b()(a="".concat(vi)).call(a,n);!S()(r).call(r,l)&&r.unshift(l),n=c.getParentControlId(n)}var o=b()(t="".concat(vi)).call(t,d);!S()(r).call(r,o)&&r.unshift(o)})),se(r)}),[d,de]),ve=(0,D.useCallback)((function(e){var t=e.value;Q(t)}),[]);(0,D.useEffect)((function(){var e=u.addSelectChangeListener(pe),t=c.addDataChangeListener(ve);return function(){e(),t()}}),[pe]),(0,D.useEffect)((function(){var e=(0,De.debounce)((function(){var e=document.body.clientHeight-30-80-20;j(e),Z.current&&(Z.current.style.height="".concat(e,"px"))}),100);return window.addEventListener("resize",e),function(){mi={},window.removeEventListener("resize",e)}}),[]),(0,D.useEffect)((function(){var e=document.body.clientHeight-30-80-20;j(e),Z.current&&(Z.current.style.height="".concat(e,"px"))}),[Z]);var ge=(0,D.useCallback)((function(e){var t;if(gi!==e){var n=(0,R.c)(de),r=c.getParentControlId(e),a=b()(t="".concat(vi)).call(t,e);for(!S()(n).call(n,a)&&n.push(a);e&&r&&r!==d;){var l;r=c.getParentControlId(r);var o=b()(l="".concat(vi)).call(l,r);S()(n).call(n,o)||n.push(o)}gi=e,se(n)}}),[de]);(0,D.useEffect)((function(){return M.eventBus.on("drag-control_".concat(d),ge),function(){M.eventBus.off("drag-control_".concat(d),ge)}}),[ge]);var ye=(0,D.useCallback)((function(){var e=!v;if(y(e),e)se([]),Z.current&&(Z.current.scrollTop=0);else{var t,n=T()(t=X[z]).call(t,(function(e){var t;return b()(t="".concat(vi)).call(t,e[_])}));se(n)}}),[v,X,Z.current]),Ce=(0,D.useCallback)((function(){I(!E)}),[E]),he=(0,D.useCallback)((function(e){var t=T()(e).call(e,(function(e){return e.substr(2)}));u.setSelect(t);var n=e[0],r=Kr()(de).call(de,(function(e){return n===e})),a=(0,R.c)(de);r>=0?ue()(a).call(a,r,1):a.push(n),se(a)}),[de]),be=(0,D.useMemo)((function(){return function(e,t,n){var r=(0,R.c)(e[z]),a=[],l=[],o={},i=[];return r.forEach((function(e,r){var l,c,u,d=e.Id,s=e.Name,f=e.ParentId,p=e.Key,v={key:d,title:s||p||d,parentId:f,Hidden:"4"===e.Status,disabled:e._Root_};null!=n&&n.prefix&&(v=oi(oi({},v),{},{key:b()(c="".concat(n.prefix)).call(c,d),parentId:f?b()(u="".concat(n.prefix)).call(u,f):f})),t&&(v.title=b()(l="".concat(s,"（")).call(l,p,"）")),n&&r>0&&m()(n).forEach((function(t){v[t]=e[K]})),a.push(v),(it(e[K])&&"1"===e.ShowType||et(e[K])&&null!=e&&e.RefTableId&&"2"===(null==e?void 0:e.ShowType))&&(v.Hidden=!0),v.parentId?i.push(v):o=oi({},v)})),function e(t,n,r){var a=(0,R.c)(n),o=0;t.parentId||l.push(oi(oi({},t),{},{level:r})),n.forEach((function(n,i){if((null==n?void 0:n.parentId)===t.key){var c,u=b()(c="".concat(r,"_")).call(c,o++);t.Hidden&&(n.Hidden=!0),l.push(oi(oi({},n),{},{level:u})),ue()(a).call(a,i,1,void 0),t.children?t.children.push(n):t.children=[n],e(n,a,u)}}))}(o,i,"0"),o.searchData=l,[o]}(X,E,{prefix:vi})}),[X,E]),Ee=(0,D.useCallback)((function(e){var t,n,r,a,l,o=(0,R.c)((null==be||null===(t=be[0])||void 0===t?void 0:t.searchData)||[]),i=Xr()(n=e.target.value).call(n),c=T()(r=En()(a=T()(l=g()(o).call(o,(function(e){var t,n,r;return(null===(t=e.key)||void 0===t?void 0:S()(n=Se()(t).call(t,2)).call(n,i))||S()(r=e.title).call(r,i)}))).call(l,(function(e){var t;return{id:null===(t=e.key)||void 0===t?void 0:Se()(t).call(t,2),level:e.level}}))).call(a,(function(e){return e.level}))).call(r,(function(e){return e.id}));mi[i]=(0,R.c)(c),G(i)}),[be]),Ie=(0,D.useCallback)((function(){if(!V||!mi[V])return null;var e=mi[V],t=e.length;if(t<=0)return d;var n=u.getActiveSelectedId();if(!S()(e).call(e,n))return e[0];var r=e.indexOf(n);return r===t-1?r=0:r++,e[r]}),[V]),Ne=(0,D.useCallback)((function(){q.current&&q.current.focus();var e=Ie(),t=c.findControl(e);e&&u.setSelect([t?e:d])}),[q,Ie]),Te=function(e,t){e.stopPropagation(),e.preventDefault();var n=(0,R.c)(de),r=n.indexOf(t);r>=0?ue()(n).call(n,r,1):n.push(t),se(n)},xe=[function(e){return k().createElement(P.Icon,{prefix:"designericon",type:"shouqi3",onClick:function(t){return Te(t,e.nodeKey)}})},function(e){return k().createElement(P.Icon,{prefix:"designericon",type:"zhankai3",onClick:function(t){return Te(t,e.nodeKey)}})}],Ae=(0,D.useCallback)((function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).nodeKey;if(!e)return k().createElement(P.Icon,{prefix:"designericon",type:"Flexmianban"});var t=mn((c.findControl(Se()(e).call(e,2))||{})[K],"Flexmianban");return k().createElement(P.Icon,{prefix:"designericon",type:t})}),[]),Fe=(0,D.useCallback)((function(e){return e.Hidden?"kdesigner-form-designer-outline-tree-node-disabled":""}),[]);return k().createElement("div",{className:"".concat(le,"-wrap")},k().createElement("div",{className:"".concat(le,"-search")},k().createElement(P.Input,{size:"small",prefix:fe,placeholder:"搜索大纲",borderType:"bordered",className:"".concat(le,"-search-input"),onChange:Ee,onPressEnter:Ne,value:V,ref:q,allowClear:!0}),k().createElement(P.Icon,{prefix:"designericon",className:"".concat(le,"-search-icon"),onClick:ye,type:v?"shouqiquanbu":"zhankaiquanbu",title:v?"全部展开":"全部收起"}),k().createElement(P.Icon,{prefix:"designericon",className:"".concat(le,"-search-icon"),onClick:Ce,type:E?"zhanshi":"yincang",title:E?"隐藏标识":"显示标识"})),k().createElement("div",{ref:H,className:"".concat(le,"-tree"),tabIndex:-1},k().createElement(P.Tree,{name:"OutlineTree",treeData:be,height:O,width:280,onExpand:function(e,t){var n,r=t.expanded,a=t.node.key,l=g()(e).call(e,Boolean);l=r?b()(n=[a]).call(n,(0,R.c)(l)):g()(l).call(l,(function(e){return e!==a})),l=me()(new(hn())(l)),se(l)},expandedKeys:de,className:le,virtual:!1,draggable:!0,icon:Ae,showIcon:!0,selectedKeys:A,onSelect:he,onDragStart:$,onDragEnter:ee,onDragOver:te,onDragLeave:ne,onDrop:re,onDragEnd:ae,ref:Z,setTreeNodeClassName:Fe,switcherIcon:xe})))})));yi.tabKey="Outline",yi.tabName="大纲",yi.displayName="Outline";var Ci=yi,hi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALgAAABoCAMAAAB108raAAAAb1BMVEUAAADX3unW2ebX3ujY3+nk6OnW3OjZ3urX3eXX3OjZ3unX3efX3ejX3ujZ3uvY3eje3u/X3OfX3ejX3unX3ejW3ejX3ejY3ujX3ejh5/Pf5e/X3OjX3enX3enY3ejW3OjY3eji6PPW3OfK0NvQ1uBUAKD9AAAAIXRSTlMADgcbKgQgFSQnGDQ8QxI4CzE/LkdJ+Evo+si0aH1e2o9Ktf8OAAADNElEQVR42u3a21KrMBSA4ZVAoJwpKm2BHqB9/2fcTG0qrUAOpu7FmE9mqOjFL7MIOAO8BN2c6uO2LLfH+rShsBDpoS67gbI+pIBfvufVA+U+B9xYs+1GbRsGiDlVN6lyAK1s283YZoDUoexmlQdA6dAJoSzPyoclsCkCQoKiqR8OI5wWZztcQgjckWb4E3RXKKuGi/b00l5hWxWbweIxu9w0gEp+LzuG8wv8Ftc9dH/v8kSXwB4QSUs+35Fw0SkxPXEdJE7nHuNiXn8NsPgyqAENWsosGQ2fFTz/WWykxpfwP28DWJz4EMgN1AmwqOVuLg26IT/eihKYVfB7FGDB1wsPZgV87QEs+FXHYBbh1zBg0d1I/x4WNlzAhttwSTbchkuy4TZckg234ZL+cHhS7VpDdlUCvyZpjXpNOaMk9AmFocpseAXGkSDe3MQrAtzObPgODHOKjweFA59aw8CosHj/JvbRhzP3fdQbwx2ex8mEjGIOp3EyKc7xhtOsmJFRtOHrYtYb1nAvFkAaTuKFhruZyAvDaegF67XrORRU5RkXZdFVFvHvPz9HxsOHTxhc4RJQ4kUcz372onASfTyJVNLZOhJ4TTh1J27Ussha7AXhpEhGxanMgzehDMI3MfPhYTLJma/2PfdqFbhixsOdiegi6YUwLRXkaoTvusv5fOl2rQRSzPJhiuO6psO7803XimVFERfxgyIeHKNT3YEiccrlfHdphWIBF0b5q2DVb8EV/zzYc1/H5c4314nDswdxFvfbfd8LYQRdKRPO9/mBcM4zkTWMcDxlEidc6ZRH2chdOrt+3aTwDfXUSU24wpRHQiNTThx1opDzk1ZgLcbgmb+McALPQked6VF5E3NY2peGKfsK12D64nQVeISPigbTy6GrxGPa4aZvQIGaFYVeqsH0LT9QLWcAQDSYfshaqfK0w8V4eGs0nCMP4TnJ++0/hHvqGOQaEITnQDWYDnfUpUsN94FpMB0ealhuuA7T4b4GHOHplZ/63/QH+43vsYWnGlCEEw02/CfhuQa9cMOoBhv+J8OZBhv+E6DBhtvwARtuw385fDEvTA4t7BXVJb8UjPU17H+K3WpesHGw6wAAAABJRU5ErkJggg==",bi=["NCPG_Hide"],Ei=function(e){var t=(0,D.useContext)(oe),n=t.getKdesignerApi,r=t.prefixCls,a=t.billPropsData,l=t.dispatchBillData,o=t.invokeAction,i=(0,D.useMemo)((function(){return n()}),[]),c=i.selection,u=i.data,d=(0,D.useState)(null),f=(0,s.c)(d,2),p=f[0],m=f[1],v=u.getRootId(),y=function(){var e=c.getSelection();if(1===(null==e?void 0:e.length)){var t=u.findControl(e[0]),n=u.getParentControl(e[0])||{},r=n._Type_,l=n.BillEntityIdEx;!l||!it(r)||null!=a&&a[l]||o("getDesignerMetadata",[l]),m(t)}else m({})},C=(0,M.useActivedSelectedId)({dataContext:u,selectionContext:c}).activedSelectId,h=(0,D.useMemo)((function(){return u.getParentControl(C)}),[C]),b=(0,D.useCallback)((function(e){var t;if(null!=e&&e.data){var n=(null==e?void 0:e.data)||{},r=T()(t=n.entitymeta.Items).call(t,(function(e){return e.Id}));l({key:Vr,payload:{form:e.billEntityIdEx||n.id,info:{data:n,ids:r}}})}}),[]);if((0,D.useEffect)((function(){return M.eventBus.on(hr,b),function(){M.eventBus.off(hr,b)}}),[b]),(0,D.useEffect)((function(){var e=c.addSelectChangeListener(y);return function(){e()}}),[y]),(0,D.useEffect)((function(){y()}),[]),null!=h&&h.BillEntityIdEx&&it(null==h?void 0:h._Type_)){if(!xa(h,(null==a?void 0:a.innerForm)||[]))return k().createElement(qn.EmptyData,{src:hi,desc:"无法编辑应用外表单内容的属性"});if((null==h?void 0:h.BillEntityIdEx)===u.getRootId())return k().createElement(qn.EmptyData,{src:hi,desc:"表格为当前表单时无法编辑内容属性"});if(p.RefTableId||p.RefBillId)return k().createElement(qn.EmptyData,{src:hi,desc:"无法编辑属性，请于原单编辑"})}return k().createElement(k().Fragment,null,(null==p?void 0:p.Id)&&v!==p.Id&&k().createElement(uo,{field:p,className:"".concat(r,"_property_switchfield")}),k().createElement(M.PropertyView,(0,B.c)({},e,{filterPropertyHandler:function(e){return(0,Ct.produce)(e,(function(e){return g()(e).call(e,(function(e){return!S()(bi).call(bi,e.Key)}))}))}})))};Ei.tabKey="property",Ei.tabName="属性";var Ii=Ei,Ni=r(3020),Ti=r.n(Ni);function xi(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ai(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xi(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):xi(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Fi=[{label:"4",value:4},{label:"5",value:5},{label:"6",value:6},{label:"7",value:7},{label:"8",value:8},{label:"9",value:9},{label:"10",value:10}],Si=function(e,t){return Ai(Ai({},e),t)},Di=(0,D.forwardRef)((function(e,t){var n=e.className,r=(0,D.useContext)(oe),a=r.getBillnoSetting,l=r.setBillnoSetting,o=P.Form.useForm(),i=(0,s.c)(o,1)[0],c=(0,D.useReducer)(Si,a()),u=(0,s.c)(c,2),d=u[0],p=u[1],m=d.billNoPreview,v=d.billNoYMD,g=d.billNoHMS,y=d.billNoPrefix,C=d.billNoRandomNum,h=(0,D.useCallback)((function(e){e.billNoPreview;var t=e.billNoYMD,n=e.billNoHMS,r=e.billNoPrefix,a=e.billNoRandomNum,l=r||"";t&&(l+="".concat(Ut(new Date,"yyyyMMdd"))),n&&(l+="".concat(Ut(new Date,"hhmmss"))),a&&(l+="".concat(function(e){for(var t=[];t.length<e;)t.push(Math.floor(10*Math.random()));return t.join("")}(a))),p({billNoPreview:l})}),[v,g,y,C]),b=(0,D.useCallback)((function(e){var t=e.target.value;p({billNoPrefix:t}),h(Ai(Ai({},d),{},{billNoPrefix:t}))}),[p,h]),E=(0,D.useCallback)((function(e){var t=!d[e];p((0,f.c)({},e,t)),h(Ai(Ai({},d),{},(0,f.c)({},e,t)))}),[d,p,h]),I=(0,D.useCallback)((function(e){p({billNoRandomNum:e}),h(Ai(Ai({},d),{},{billNoRandomNum:e}))}),[p,h]),N=(0,D.useCallback)((function(){return new(jr())((function(e,t){i.validateFields().then((function(t){Ti()(t);l(d),e(!0)})).catch((function(e){return t(e)}))}))}),[l,d]);return(0,D.useImperativeHandle)(t,(function(){return{saveForm:N}}),[N]),k().createElement("div",{className:"".concat(n,"-modal-body")},k().createElement(P.Form,{layout:"vertical",form:i,labelWidth:100,wrapperWidth:"100%",onValuesChange:function(e,t){}},k().createElement("div",{className:Vn()("".concat(n,"-form-item"),"".concat(n,"-form-item-vertical"))},k().createElement("div",{className:"".concat(n,"-form-item-label")},"编码示意"),k().createElement("div",{className:"".concat(n,"-form-item-desc")},m||"-")),k().createElement(P.Form.Item,{label:"前缀字符",name:"billNoPrefix",required:!0,validateTrigger:"onChange",className:"".concat(n,"-form-item-validate-nowrap"),rules:[{required:!0,message:"请输入前缀字符"},{type:"string",pattern:/^([a-zA-Z]|[-@#$%^&*_]|\[|\])+$/,message:"仅支持输入大小写字母、特殊字符（-@#$%^&*[]_）"}]},k().createElement(P.Input,{type:"text",borderType:"bordered",size:"middle",value:d.billNoPrefix,placeholder:"最多不超过8位",maxLength:8,onChange:b})),k().createElement("div",{className:Vn()("".concat(n,"-form-item"),"".concat(n,"-form-item-horizontal"))},k().createElement("div",{className:"".concat(n,"-form-item-label")},"年月日"),k().createElement(P.Switch,{checked:d.billNoYMD,onClick:function(){return E("billNoYMD")}})),k().createElement("div",{className:Vn()("".concat(n,"-form-item"),"".concat(n,"-form-item-horizontal"))},k().createElement("div",{className:"".concat(n,"-form-item-label")},"时分秒"),k().createElement(P.Switch,{checked:d.billNoHMS,onClick:function(){return E("billNoHMS")}})),k().createElement(P.Form.Item,{label:"n位随机数",name:"billNoRandomNum",required:!0,rules:[{required:!0,message:"请选择n位随机数"}]},k().createElement(P.Select,{placeholder:"请选择",borderType:"bordered",value:d.billNoRandomNum,options:Fi,onChange:I}))))})),ki=function(e){var t=e.className,n=e.onCancel,r=e.onConfirm;return k().createElement("div",{className:"".concat(t,"-modal-footer")},k().createElement(P.Button,{onClick:n,type:"second",size:"small",className:"".concat(t,"-modal-cancel-btn")},"取消"),k().createElement(P.Button,{type:"primary",size:"small",style:{marginLeft:"12px"},onClick:r,className:"".concat(t,"-modal-ok-btn")},"确定"))},Mi=function(e){var t=e.className,n=e.visible,r=e.setVisible,a=e.onConfirm,l=(0,D.useRef)(null),o=function(){r(!1)};return k().createElement(P.Modal,{mask:!0,visible:n,body:k().createElement(Di,{className:t,ref:l}),bodyStyle:{justifyContent:"start",alignItems:"start",overflowX:"hidden",overflowY:"auto",flexDirection:"column"},titleIcon:null,className:"".concat(t,"-modal"),footer:k().createElement(ki,{className:t,onConfirm:function(){(0,l.current.saveForm)().then((function(){null==a||a(),r(!1)})).catch((function(e){}))},onCancel:o}),maskClosable:!1,width:320,height:438,title:"设置表单编号格式",closable:!0,destroyOnClose:!0,onCancel:o,onOk:o})};function wi(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wi(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):wi(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Ri="System_CategoryBillNo",Bi=["NoCodeBillNoField"],_i=["NoCodeCreateDateField","NoCodeCreatorField","NoCodeModifyDateField","NoCodeModifierField"],Oi=function(e){var t=e.prefixCls,n=e.data,r=(0,D.useContext)(M.DataFactoryContext).dataFactory,a=(0,D.useContext)(M.GlobalConfigContext),l=a.env,o=a.keywordMapping,i=(0,D.useContext)(oe),c=i.getKdesignerApi,u=i.showMessage,d=c(),s=d.data,f=d.selection,p=d.meta,m=n.Name,v=n.Id,g=(0,(0,D.useContext)(M.GlobalConfigContext).getOutlineItemIcon)(v),y=(0,D.useCallback)((function(){var e,t,n=s.getRootId(),a=f.getActiveSelectedId(),l=s.findControl(a);l=s.getContainerControl(l);var i=p.canAdd(v,l[o.type]);if(!(!0===i||"object"===(0,be.c)(i)&&i.success))return(null==i?void 0:i.message)&&u(i.message),!1;var c=null===(e=p.getControlMeta(null===(t=l)||void 0===t?void 0:t[o.type]))||void 0===e?void 0:e.IsContainer,d=r({type:v,parentId:c?l[o.id]:n}),m=l[o.id]===a?-1:s.findControlIndex(a)+1;s.addControl((0,M.createAddAction)(d,{index:m})).then((function(e){if(null!=e&&e.length){var t=e[0].value;f.setSelect(Array.isArray(t)?[t[0][o.id]]:[t[o.id]])}}))}),[v]),C=(0,D.useCallback)((function(e){var t={type:"control",data:n};l[M.CONTROL_DRAG_DATA]=t}),[n]);return k().createElement("div",{className:"".concat(t,"-control-item"),draggable:!0,onDragStart:C,onClick:y},g,k().createElement("div",{className:"".concat(t,"-control-name")},m))},ji=(0,D.forwardRef)((function(e,t){var n=e.data,r=e.prefixCls,a=e.titleSuffix,l=e.showSwitch,o=void 0===l||l,i=e.onSwitchChange,c=(0,D.useContext)(oe),u=c.setSystemSetting,d=c.getSystemSetting,p=((0,c.getKdesignerApi)().data,n.Name),m=n.Controls,v=n.Id,g=(0,D.useState)((function(){var e,t=d();return(null==t?void 0:t[v])||(null==t||null===(e=t[v])||void 0===e?void 0:e.value)||!1})),y=(0,s.c)(g,2),C=y[0],h=y[1],b=(0,D.useCallback)((function(e){var t=Pi(Pi({},d()),{},(0,f.c)({},v,e));h(e),u(t)}),[C,h,u]);return(0,D.useImperativeHandle)(t,(function(){return{isOpen:C,setIsOpen:b}}),[C,b]),k().createElement("div",{className:"".concat(r,"-category-group")},k().createElement("div",{className:"".concat(r,"-category-group-title")},k().createElement("div",{className:"group-name"},p,k().createElement("div",{className:"group-title-suffix"},a)),o&&k().createElement(P.Switch,{checked:C,onClick:function(){return function(){var e=!C;if(!1!==i(v,e)){var t=Pi(Pi({},d()),{},(0,f.c)({},v,e));h(e),u(t)}}()}})),k().createElement("div",{className:"".concat(r,"-category-list")},C&&T()(m).call(m,(function(e){return k().createElement(Oi,{key:e.Id,prefixCls:r,data:e})}))))})),Li=function(e){var t=e.meta,n=(0,D.useContext)(oe),r=n.prefixCls,a=(0,n.getKdesignerApi)(),l=a.data,o=(a.selection,(0,D.useState)((function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.Controls,n=void 0===t?[]:t,r=e.Categories,a=void 0===r?[]:r,l=g()(a).call(a,(function(e){var t;return null==e||null===(t=e.Id)||void 0===t?void 0:C()(t).call(t,Le)}));return T()(l).call(l,(function(e){var t=g()(n).call(n,(function(t){return(null==t?void 0:t.CategoryId)===(null==e?void 0:e.Id)}));return Pi(Pi({},e),{},{Controls:t})}))}(t||[])}))),i=(0,s.c)(o,2),c=i[0],u=(i[1],(0,D.useState)(!1)),d=(0,s.c)(u,2),f=d[0],p=d[1],m=(0,D.useRef)(null),v=function(){p(!0)},y=function(e,t){if(e===Ri&&t&&!1===f)return p(!0),!1;if(e===Ri&&!t){var n,r=T()(n=l.findControlByCondition((function(e){return S()(Bi).call(Bi,e._Type_)}))).call(n,(function(e){return e.Id}));r.length&&l.deleteControl((0,M.createDeleteAction)(r),!1)}if("System_CategoryRecordInfo"===e&&!t){var a,o=T()(a=l.findControlByCondition((function(e){return S()(_i).call(_i,e._Type_)}))).call(a,(function(e){return e.Id}));o.length&&l.deleteControl((0,M.createDeleteAction)(o),!1)}};return k().createElement(k().Fragment,null,k().createElement("div",{className:"".concat(r,"-system-categories")},T()(c).call(c,(function(e){var t=e.Id;return t===Ri?k().createElement(ji,{ref:m,prefixCls:r,key:t,data:e,onSwitchChange:y,titleSuffix:k().createElement(P.Icon,{prefix:"designericon",type:"shezhi",onClick:v})}):k().createElement(ji,{prefixCls:r,key:t,data:e,showSwitch:!1,onSwitchChange:y})}))),k().createElement(Mi,{className:"".concat(r,"-billno-setting"),visible:f,setVisible:p,onConfirm:function(){var e=m.current,t=e.isOpen,n=e.setIsOpen;!1===t&&n(!0)}}))};Li.tabKey="CategorySystem",Li.tabName="系统功能",Li.displayName="CategorySystem";var Ki=Li,Ui=["type","value"],Vi=["Name","_Type_","RefBillId","RefTableId","EntityData","ParentId","Key"];function Gi(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function zi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gi(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Gi(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Hi=function(e,t,n,r){var a,l=e.globalConfig,o=e.dataContext,i=e.selectionContext,c=e.action,u=e.dataFactory,d=e.modelFactory,p=e.metaReader,v=(c.type,c.value),g=((0,he.c)(c,Ui),r.controlCacheApi),y=r.dispatchBillData,C=r.billPropsData,h=r.getHideFieldRef,E=r.setHideFieldRef,N=[],x=h();return v.forEach((function(e){var t,n=(0,s.c)(e,2),r=n[0],a=n[1],v=o.findControl(r),h=o.findControlIndex(r),E=v?p.getDefaultData(null===(t=v)||void 0===t?void 0:t._Type_):{},F=(v=zi(zi({},E),v))||{},D=F.Name,k=F._Type_,w=F.RefBillId,P=F.RefTableId,_=F.EntityData,j=F.ParentId,L=(F.Key,(0,he.c)(F,Vi)),U=o.findControl(j)||{},V=U._Type_,G=U.BillEntityIdEx,z=U.SourceForm;if("Status"in a){var H=function(e,t,n,r){var a=(0,s.c)(e,2),l=a[0],o=a[1],i=n.getAllSubControls(l),c=n.getAllParentControls(l),u=i.reduce((function(e,n){var a=n.Id;if(n._Type_,l!==n.Id){var i,c=b()(i=[]).call(i,(0,R.c)(e),[[a,o]]),u=ha(a,o,n,{metaReader:r});return u&&c.push(u),c}if(null!=n&&n.RefBillId||null!=n&&n.RefTableId){var d=(null==n?void 0:n.RefBillId)||(null==n?void 0:n.RefTableId),f=t[d],p=Ca(o,f,r);t[d]=Ta(Ta(Ta({},f),o),{},{EntityData:p}),null!=n&&n.RefTableId&&I()(t).forEach((function(e){var a=(0,s.c)(e,2),l=a[0],i=a[1];if(i.ParentId===(null==n?void 0:n.RefTableId)){var c=Ca(o,f,r);t[l]=Ta(Ta(Ta({},i),o),{},{EntityData:c})}}))}return e}),[]),d=c.reduce((function(e,n){var a=n.Id,l=n._Type_,i=n.Status;if((Vt(l)||it(l))&&Number(i)>Number(o.Status)){var c,u=[[a,Vt(l)?{Status:"1"}:o]],d=ha(a,o,n,{metaReader:r});!Vt(l)&&d&&u.push(d);var s=t[null==n?void 0:n.RefBillId];if(s){var f=Ca(o,s,r);t[null==n?void 0:n.RefBillId]=Ta(Ta(Ta({},s),o),{},{EntityData:f})}return b()(c=[]).call(c,(0,R.c)(e),u)}return e}),[]),f=b()(u).call(u,d);return f.length&&(0,M.createUpdateAction)(f)}(e,x,o,p);H&&N.push(H)}if("FormatType"in a){var q=v,Y=q.DateRangeDefValue,W=q.NoCodeDefValue;Y&&Je(k)&&(0,B.c)(a,{DateRangeDefValue:void 0}),W&&$e(k)&&(0,B.c)(a,{NoCodeDefValue:void 0})}if("ParentId"in a){var X=o.findControl(a.ParentId),Q=X.Status,Z=X._Type_;if(Vt(Z)&&void 0!==Q){var J=o.getAllSubControlIds(r);N.push((0,M.createUpdateAction)(T()(J).call(J,(function(e){return[e,{Status:Q}]}))))}}if(et(k)){if("ShowType"in a){var $=a.ShowType;if(v=zi(zi(zi({},v),a),{},{EntityData:zi(zi({},v.EntityData),a)}),N.push((0,M.createDeleteAction)([r])),x[r]=v,P||"2"!==$){if(P&&"2"===$){var ee=A()(x).reduce((function(e,t){if(t.Id===P||t.ParentId===P){var n;delete x[t.Id];var r=t.Id===P?zi(zi(zi({},t),a),{},{EntityData:zi(zi({},t.EntityData),a)}):t;return b()(n=[]).call(n,(0,R.c)(e),[r])}return e}),[]);N.push((0,M.createAddAction)(ee,{index:h})),setTimeout((function(){return i.setSelect([P])}),100)}}else{var te,ne,re=(0,M.createUUid)(3);delete L.FieldType,delete L.FieldId,delete L.EntryId;var ae=Ia(u({type:He,parentId:j,transferData:zi(zi({},L),{},{Name:D,RefBillId:r,Id:re,ShowType:"2",SourceForm:"2",Key:"nc_".concat((0,M.createUUid)().toLowerCase())})}),{dataContext:o,metaReader:p});g.addCache("controlId",ae.Id);var le=wa((null==C||null===(te=C[null==L?void 0:L.BillEntityIdEx])||void 0===te?void 0:te.data)||[],ae);le=(le=ka(le,ae.PropsDisplay)).reduce((function(e,t){var n;return t.isShow?b()(n=[]).call(n,(0,R.c)(e),[Ra(t,ae.Id)]):e}),[]),N.push((0,M.createAddAction)(b()(ne=[ae]).call(ne,(0,R.c)(le)),{index:h})),v.RefTableId=re,v.EntityData.RefTableId=re,x[r]=v,setTimeout((function(){return i.setSelect([re])}),100)}}if(P&&!(O in a)&&!("ShowType"in a)&&!it(V)){var oe=x[P];x[P]=zi(zi({},oe),a),x[P].EntityData=zi(zi({},oe.EntityData),a)}}if(it(k)){var ie=x[w];x[w]=zi(zi({},ie),a),x[w].EntityData=zi(zi({},ie.EntityData),a),"inner2Outer"in a&&N.push((0,M.createUpdateAction)([[r,{EntityData:zi(zi({},_),{},{inner2Outer:!0})}]])),"ShowType"in a&&(N.push((0,M.createDeleteAction)([r])),N.push((0,M.createAddAction)([zi({},x[w])],{index:h})),delete x[w],o.findControlByCondition((function(e){e.Id===r&&(v=zi(zi(zi({},v),a),{},{EntityData:zi(zi({},v.EntityData),a)}),x[e.Id]=v),e.ParentId===r&&(x[e.Id]=e)})),setTimeout((function(){return i.setSelect([w])}),100))}if(j&&it(V)){var ce=G||"1"!==z?G:j+"_table",ue=r.replace("_".concat(j),""),de=m()(a).reduce((function(e,t){return function(e){var t;return S()(t=["Status","DisplayRules","FieldRequired","NoCodeDefValue","QueryFormValue","FormulaValue","UploadDefValue","PictureDefValue","Visibility"]).call(t,e)}(t)?e:zi(zi({},e),{},(0,f.c)({},t,a[t]))}),{});m()(de).length&&(y({key:Gr,payload:{form:ce,id:ue,data:de}}),o.findControlByCondition((function(e){var t;e.Id.split("_").length>1&&S()(t=e.Id).call(t,ue)&&e.Id!==r&&N.push((0,M.createUpdateAction)([[e.Id,zi(zi({},a),{},{EntityData:zi(zi({},e.EntityData),a)})]]))})),A()(x).forEach((function(e){var t;if(S()(t=e.Id).call(t,ue)){var n=x[e.Id];x[e.Id]=zi(zi({},n),a),x[e.Id].EntityData=zi(zi({},n.EntityData),a)}})))}var se=ha(r,a,v,{globalConfig:l,dataContext:o,selectionContext:i,action:c,dataFactory:u,modelFactory:d,metaReader:p});if(se&&N.push(se),O in a){var fe=a[O],pe=p.getControlMeta(fe).ApType,me=p.getControlMeta(V).BaseType,ve=function(e,t,n,r,a){var l=n.EntityData,o=n.Id,i=m()(l).reduce((function(t,n){if(n===K)return t[n]=e,t;var r=a.getControlMetaProperty(e,n).Tag;return(r===_e||r===Oe||S()(Be).call(Be,n))&&(t[n]=l[n]),t}),{}),c={};if(dt(e)){var u;ga=ua(ga);var d=a.getControlPropertyDefaultValue(e,"CustomContent"),s=null==d||null===(u=d.ops)||void 0===u?void 0:T()(u).call(u,(function(e,t){return va(va({},e),{},{Bgc:ga[t]})})),f={bgcSwitch:!0,ops:sa(s)};c.CustomContent=f,i.CustomContent=f}return null!=r&&r.Name&&(i.Name=null==r?void 0:r.Name),(0,M.createUpdateAction)([[o,va({ApType:t,_Type_:e,FieldType:e,EntityData:i},c)]])}(fe,Ea(pe,me),v,a,p);N.push(ve);var ge=function(e,t,n){var r=[];if(m()(t).forEach((function(t){var a;if(!S()(ba).call(ba,t)){var l=n.getControlMetaProperty(e,t);l&&0!==(null===(a=m()(l))||void 0===a?void 0:a.length)||r.push(t)}})),r.length>0)return(0,M.createRemovePropAction)([null==t?void 0:t.Id,r])}(fe,v,p);ge&&N.push(ge)}})),E(x),b()(a=[c]).call(a,N)};function qi(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qi(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):qi(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Wi="1",Xi=(0,D.memo)((function(e){var t=(0,D.useReducer)((function(e){return e+1}),0),n=(0,s.c)(t,2)[1],r=(0,(0,D.useContext)(M.ConfigContext).getPrefixCls)("nocode-designer-entry"),a=(0,D.useCallback)((function(e){Wi=e,n()}),[Wi]);return k().createElement("div",{className:"".concat(r,"-modal-body")},k().createElement("div",{className:"".concat(r,"-modal-body-menu")},k().createElement("div",{className:Vn()({cur:"1"===Wi}),onClick:function(){return a("1")}},k().createElement("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZgAAAEACAMAAAC50JBJAAAAZlBMVEUAAADf39/o6Oj////k5OTc3Nzd3d3y8vLi4uL////6+vrZ2dmZmZnz8/Ompqbo6Oifn5/4+PicnJz19fXU1NTCwsK4uLjj4+PGxsbb29upqamurq6ioqKxsbHu7u6+vr7Pz8/Kyso7+HZuAAAACXRSTlMA/tAL7dLNTk5icRcsAAAF4UlEQVR42uzdXW7iQBBFYWB+Mq6uxhhswDgEsv9NTpJ5yZM7zEjMreacFdTVJ9ESQmLx3tNqOSaSaFyunhZ/+rZKJNXq24fL95Ta3NlflZKFKcatXW5T+v4us0pjrnxssFvzmH68vS8p5QcYG+rWnNKvxSq1DzE21K1t+rlYpvwYYyPdmlNajKl7jLGRbu3eYFJ6kLHBbgVGMmBEA0Y0YEQDRjRgRANGNGBEA0Y0YEQDRjRgRANGtCLM6Xlntn9u6xhrYSrBvPjazDbe1THWwlSCGX1v1vqpkrEWphLM0a9mvV8qGWthKsGc/WA2eF/JWAvTHMxuGIatX4Zh7fth6GoYa2Gag1n6p56rGGthmoNp+/7ix74/+7rvxyrGWpgKb8zRs9nZh1rGWpgKMOeTWbf1vpaxFqYCzOZi1rq3tYy1MM3AdDkf/DXnq29fcq5jrIVpBubqnzrXMdbCNAPzOk0bP03T2tfTdK1jrIVp/o2ZvDW7eKpmrIVpFqbbbjuzk79UM9bCNAtz8LNZ9ud6xlqYZmGufjRb+r6esRamWZi9Lz+++K9nrIVpFuYw7sza8aWesRYmfowhGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEjGjCivcOQZMCI9gbT/EMpNWGKdSswkgEjGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEj2hdg8qGtZmwTpjJMd/J1NWObMJVh9g7M/SvDDA7M3SvDtJMDc+/KMN3R3Y8bYO5bGWZy3ywbYO5cGea0HXYNMPeuDHPNTQPMf6j8+APz5YABBphbAgYYYG4JGGCAuSVggAHmloABBphbuj9MzrtqxjZh4lcyogEjGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEjGn9TIhswovFRJhkwogEjGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEj2u/27m03bSiIwrBdkjTjvXw2NhAD8fu/ZB3c9nLvSJXcmWF917nw0q8AQkiTClPcpvzmZ6yYEQ/TLg1W3VI4GStmRMP0FX67FD7GihnRMBdgrKUPM3DyMVbMiIXJgVG+1MDsY6yYEQszAqU8VEDpYqyYEQsj9SCbD6B2MVbM2MIktA3/Y5L+R5gjMPoYK2Z8J8wCdLWPsWLGN8IcgW5yMlbMSIYpP4C59jJWzEiFuVXA2LoZK2YkwtQzcHI0VsyIh5kadMHTWDEjGqZcu0yuxooZ0TBXYPA1VsyIhfkExvKPwsVYMSMSpu/wF78rS9ovzA0M82/4YwyXz8owKjGMUgyjFMMoxTBKMYxSDKMUwyjFMEoxjFIMoxTDKMUwSjGMUgyjFMMoxTBKMYxSDKMUwyjFMyVqMYxSfClTiWGUYhilGEYphlGKYZRiGKUYRimGUYphlGIYpRhGKYZRimGUYhilGEYphlGKYZRiGKUYRimGUSoVpqh5P2Z36TD9qcGqWVonY8WM5P2Y7tLwfsy+0mE+gGMhRX7h/Zi0HcPUwHX7I6DyMVbMiIUJFc7ypWiA3sVYMSPx5l/IQ4fOx1gxYwuTkPNMyX6+H6YYGlSlj7FiRirM6TID3bF3MlbMSIW5Y1UtDJO0c5hpGE5XYObFpZ1tYRKmDnPrYqyYsYVJWYDBxVgxIx6mlE0O3F2MFTNiYe4zWnkYgJOLsWJGNAzwKQ8jcHYxVsyIham77RBWsQAV3/wTdgwjAUA1XhseKN1Z+njcFV+6e+lkrJiR+rhcTiG/FW7Gihn8lYxSDKMUwyjFMEoxjFIMoxTDKMUwSjGMUgyjFMMoxTBKMYxSDKPUGubMMAqtYfLQPs1YsaJdw/wI9XOMtfSsdXjLfp5D/xRjDT1rH8J7lv0Ief8EYw09a5+H1yzLDi8h1K33sXaeta1DeDlkq8NrIFVeD9nm/S2QGm/v2eoXDlT1L9hoSkAAAAAASUVORK5CYII="}),k().createElement("p",null,"添加空白表格")),k().createElement("div",{className:Vn()({cur:"2"===Wi}),onClick:function(){return a("2")}},k().createElement("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZgAAAEACAMAAAC50JBJAAAAb1BMVEUAAADi4uLo6Ojd3d3////y8vLi4uL////6+vrZ2dmZmZm1tbX4+PidnZ3Nzc2wsLDAwMCrq6u5ubnS0tLw8PDl5eW9vb2oqKilpaXExMTKysrt7e3r6+vz8/OioqKfn5/19fXi4uLU1NTe3t7o6OiHDuK7AAAAB3RSTlMA89DQC05Omgim0gAAB5ZJREFUeNrs2t1u2kAQhmGgSfvt5/W/E4PLUgf7/q+xkFZKjkqcTrSzZt6DiDlAmtGjYA7YXHvcbZ2lpO3ucfOnh52zVLV7eHXZOjcHj0/lHJIpjV19mJ3bXmV2bgorPzaxXcPkvl2eL86FOzg2qV2Dc983OzffxbFJ7Tpf/mW2LtzHsSntGpzbOOfv49iUdvWvMHdybGK7GozKDEZpBqM0g1GawSjNYJRmMEozGKUZjNIMRmkGozSDUZrBKO0mTH0ageb0tI5jkUy3YDruAeT06zgWyXQLxrEBjqxXciyS6RbMgQVwZrWSY5FMt2AyPgEVzys5Fsn0L5ixqqqclz97NlXlP3psyMpsxDXflOUsOMrDRNhGAGbiu04fPhYFWb29EBzFYSJsIwEzt+0zD21bsm/bacHHQ0ZOAI5k7QVHeZgI2wg9Yw4MQMlq2bHhxP0I1MyPkqM4TIRtpGDKHvA5z8uOxURWKMiz5CgOE2EbMZj8GZjJeeGxOJBtzkZyFIeJsI0MjO+6Fw5dVzDvurDsWF+T7EfBUR4mwjYyMAXfVS47FhnJ0guO8jARtpGBGer6F/u63nNf18WyYweyISvBUR4mwjZiz5iaM/BM94kHaoaKdIKjPEyEbYRgPHMP9Py58NhjzlOAr5nPgqM8TIRtZGCeWAKBp4XHjj35AmAm+yA4ysNE2EYEpuABmNgsPLYhh7/vZyY4ysNE2EYEpuEEDCyWHTu8fW0pyUFwlIeJsI0EzMs0AvPULTvWX3r3UnCUh/mibezHGGve1WBUZjBKMxilGYzSDEZpBqM0g1GawSjNYJRmMEozGKUZjNIMRmkGozSDUZrBKM1glGYwSjMYpV1hLJUZjNIuMD/+o8u7kymtXQ1GZQajNINRmsEozWCUZjBKMxilGYzSDEZpBvObXTPITRgIguCxTa9tMGCMAw6Q/P+PUSJFHMmoo9kBTd3q1qu6jTYoGSYoGSYoGSYoGSYoGSYoGSYoGSYoGSYoGSYoGSYofwiz3MaXeSyehsdh2onHl3ksnobHYQozjAG3MDMzjAGvMOeBGcaAU5h2JjlfMowBlzBr8vIJa5i2lNLgh0MpZ5NCR9nqpmKYqZuvMIfBjtzgm57cGFVH2OqnYph+AWAPg0KOAPYdh8aoOsJWN1XC3LGHad95bIA1u71VdYStblorDEZygx25MquOsNVL64XBG/nR8WBXHWGrk9YMgzXJqbGrjrDVR+uG2ZJcw646wlYfrRqmJw/kbFcdYauP1gxzIwtmcmVWHWGrk9YLs7/w2KIZ2J2sqiNs9dJaYZqBHAGcOk6tUXWErW5aKcyW7H/vHVuj6ghb3bROmJ4s93tHb1LoKFvd9F/CLMv1ZU7peBryl0xQMkxQMkxQMkxQMkxQMkxQvti7YxoAAAAGYf5dY4OjtUCyd8JMCTMlzJQwU8JMCTMlzJQwU8JMCTMlzJQwU8JMCTPlpmRLmClTtiTMlDBTwkwJMyXMlDBTwkwJMyXMlDBTwkwJMyXMlDBTwkwJMyXMlDBTwkwJM1V795acNhAFYRgHx6NpJBsbMBcjEJb2v8ZI5ILzwOghxaTPof8VnKkv8a1c7jGYYnlql34eG8yUhil3R/RVu8LJY4OZkjDNGr96LXw8NpgpCfMKvH2EJh6ArY/HBjOlYNreJQytgIOPxwYzpWDegGU4twGWLh4bzJSCCd3i8ie29y42WfLdmuX7mPII1C42WfLdmgVmDsx8bLJkuzULzA6o9j42WbLdmgNmDuDkZJMl160ZYOpX4LDyssmS6dYMMMsNMCvdbLLkuTUDzP4IbB1tsoRL//2af4FZVaiip02WPLfeHKY+AidXmyyZbs2wHLvwtcmS69bbwjwDs/p3hYtNlmy33hKmwddWLjZZst16S5jl3zAuNlny3apfxnB7q2AoEwxpgiFNMKQJhjTBkCYY0gRDmmBIEwxpgiFNMKQJhjTBkCYY0gRDmmBIEwxpgiFNMKRppoQ2wZCmD2WUCYY0wZAmGNIEQ5pgSBMMaYIhTTCkCYY0wZAmGNIEQ5pgSBMMaYIhTTCkCYY0wZAmGNIEQ9oYTPGh/ZjsjcM02wp91a508thgptH9mGpdaT8me+P7MfMiFO1a+zGZS8N0wCwMRWDj47HBTCmYuEYbhooKaFw8Nphp5JN/Ec5VgI9NFku3foVJbGL52GSxdOsoTLGosKl9bLJYujUNs10fgWreONlksXRrGuYdfevnxskmi6Vb0zCrz8XuBTisfGyyWLr1ApMaxTiULjZZLN2ahrn8S3CxyWLp1hRMffl6ee5ik8XSrddh3g8ow7lPYOtik8XSrddh5n+2A2ZA62KTxdKt12H2+Ilf7IBN6WKTxdKt12FCBLCZzY5A1fnYZLF0awImnF5wbl472WSxdGsCpq9exfajcPOj9GAm/ZYMaYIhTTCkCYY0wZAmGNIEQ5pgSBMMaYIhTTCkCYY0wZAmGNJ6mFYwhPUwD7G8m8cGK5U9zLfY3cdjLd3axenke4zNXTzW0K1NjE+T/r9M29zBYw3d2rRxOplMHh9i7Ervj7Vza9nF+PA4GWSmUVE1HVyGnkRD1PRpMPkBXitvH6PdbmgAAAAASUVORK5CYII="}),k().createElement("p",null,"添加已有表单"))))})),Qi=function(e){P.Modal.confirm({title:"添加表格",width:480,height:304,className:"nocode-designer-entry-modal",showline:!0,maskClosable:!1,titleIcon:null,body:k().createElement(Xi,null),okButtonProps:{size:"small"},cancelButtonProps:{size:"small"},bodyStyle:{padding:24},destroyOnClose:!0,onOk:function(){return function(e){var t=e.dataContext,n=e.dataFactory,r=e.action,a=e.metaReader,l=e.handleConfig,o=l.controlCacheApi,i=l.getHideFieldRef,c=l.setHideFieldRef,u=(r||{}).value,d=Ia(n({type:He,parentId:u.ParentId,transferData:{Name:"表格",Id:(0,M.createUUid)(3),Key:"nc_".concat((0,M.createUUid)().toLowerCase()),SourceForm:Wi,ShowType:"2",Multi:"1",DataRange:{max:"100",min:"0"}}}),{dataContext:t,metaReader:a}),s=Ia(n({type:"NoCodeMulRefBillField",parentId:u.ParentId,transferData:{Name:"表格",Key:"nc_".concat((0,M.createUUid)().toLowerCase()),SourceForm:Wi,ShowType:"2",Multi:"1",DataRange:{max:"100",min:"0"}}}),{dataContext:t,metaReader:a});d.RefBillId=s.Id,d.EntityData.RefBillId=s.Id,s.RefTableId=d.Id,s.EntityData.RefTableId=d.Id;var p=[(0,M.createAddAction)([d])];o.addCache("controlId",d.Id),c(Yi(Yi({},i()),{},(0,f.c)({},s.Id,s))),t.batchActions(p),setTimeout((function(){return l.selection.setSelect([d.Id])}),300)}(e)}})},Zi=["type","value"];function Ji(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function $i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ji(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Ji(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var ec=function(e,t,n,r){var a=e.globalConfig,l=e.dataContext,o=e.selectionContext,i=e.action,c=e.dataFactory,u=(e.modelFactory,e.metaReader),d=l.getRootId(),s=i.type,p=i.value,m=(0,he.c)(i,Zi),v=a.showMessage,y=St(p),C=r.dispatchBillData,h=r.billPropsData,E=r.getHideFieldRef,I=r.setHideFieldRef,N=o.getSelection(),T=[],x=[],A=E();if(it(p._Type_))return Qi({dataContext:l,dataFactory:c,action:i,metaReader:u,handleConfig:r}),n("自定义插入关联表单表格事件"),!1;var F=setTimeout((function(){if(1===y.length){var e=l.getParentControl(y[0].Id),t=l.findControl(N[0]);it(null==e?void 0:e[K])&&it(null==t?void 0:t[K])||M.eventBus.emit("add-control-id",y[0].Id)}clearTimeout(F),F=null}),0),D=l.getData(),k=y.reduce((function(e,t){var r,a,o,c=t,s=c._Type_,p=(c.Id,c.ParentId);if(ut(s)&&p===d){var m,y=Ae()(m=D[z]).call(m,(function(e){return e[K]===Ve}));if(y)t[G]=y[_];else{var E=(0,M.createUUid)(),I=u.getControlMeta(Ve);T.push((0,f.c)((0,f.c)((0,f.c)((0,f.c)((0,f.c)({},G,d),K,Ve),_,E),"_Root_",!0),"Name",null==I?void 0:I.Name)),t[G]=E}}var F=u.getControlMeta(s).Name,k=l.findControl(t[G]),w=k||{},P=w._Type_,B=w.Status;if(nt(s)&&!it(P)){var O=l.findControlByCondition((function(e){return e._Type_===s}));g()(O).call(O,(function(e){var t=l.findControl(e.ParentId);return!it(t._Type_)})).length>0&&(v("".concat(F,"只能在画布中添加一次")),n("".concat(F,"只能在画布中添加一次")))}if(!t||null!==(r=t)&&void 0!==r&&r.FieldName||null!==(a=t)&&void 0!==a&&a.StartDateFieldName||(t=Ia(t,{dataContext:l,metaReader:u})),it(P)){var j,L,U,V=$i($i({},u.getDefaultData(P)),k)||{},H=V.BillEntityIdEx,q=V.SourceForm,Y=V.PropsDisplay,W=V.RefBillId,X=V.EntityData;if(!H&&"2"===q)return n("请先选择需要关联的表单"),!1;if(H&&(null==h||!h[H]))return v("数据加载中，请稍后"),n("数据加载中，请稍后"),!1;if(t.Key=null!==(j=t)&&void 0!==j&&j.Key?t.Key.toLowerCase():"nc_".concat((0,M.createUUid)().toLowerCase()),null===(L=t)||void 0===L||null===(L=L.Key)||void 0===L||!S()(L).call(L,p.toLowerCase())){if(!xa(k,(null==h?void 0:h.innerForm)||[]))return v("应用外表单无法编辑"),n("应用外表单无法编辑"),!1;if((null==k?void 0:k.BillEntityIdEx)===d)return v("表格为当前表单时无法编辑"),n("表格为当前表单时无法编辑"),!1;t.EntityData=$i($i({},t.EntityData),{},{Key:t.Key});var Q=H||"1"!==q?H:p+"_table",Z=N[N.length-1],J=t[G]===Z,$={form:Q,data:$i({},t)};if(C({key:zr,payload:$}),!J)$.prevId=Z.replace("_".concat(p),""),U=(l.findControl(Z)||{}).Key.toLowerCase().replace("_".concat(p.toLowerCase()),"");if(i.index>0){var ee=l.getData().Items;ee[i.index-1]&&(U=ee[i.index-1].Key.toLowerCase().replace("_".concat(p.toLowerCase()),""))}t=Ra(t,p)}B&&(t.Status=B);var te=t.Key.toLowerCase().replace("_".concat(p.toLowerCase()),""),ne=function(e,t,n){var r=e?e.split(","):[],a=Array.isArray(t)?t:[t];if(n){var l,o,i=Kr()(r).call(r,(function(e){return e===n}));i>-1?ue()(l=r).apply(l,b()(o=[i+1,0]).call(o,(0,R.c)(a))):r=b()(r).call(r,a)}else r=b()(r).call(r,a);return r.join()}(Y,Je(t._Type_)?["".concat(te,"_startdate"),"".concat(te,"_enddate")]:te,U);A[W].PropsDisplay=ne,A[W].EntityData.PropsDisplay=ne,x.push((0,M.createUpdateAction)([[p,{PropsDisplay:ne}],[p,{EntityData:$i($i({},X),{},{PropsDisplay:ne})}]]))}return Vt(s)&&!t.GroupParentId&&(t.GroupParentId=(0,M.createUUid)(),t.GroupIndex=0),b()(o=[]).call(o,(0,R.c)(e),[t])}),[]),w=[$i({type:s,value:b()(k).call(k,T)},m)];return I(A),b()(w).call(w,x)},tc=function(e,t,n,r){e.globalConfig;var a=e.dataContext,l=(e.selectionContext,e.action),o=(e.dataFactory,e.modelFactory,e.metaReader,[l]),i=[],c=l.value;return(Array.isArray(c)?c:[c]).forEach((function(e){var t=a.findControl(e)||{},n=t._Type_;if(Vt(n)){var r=t.GroupIndex,l=t.GroupParentId;if(0===Number(r)){var o=a.findControlByCondition((function(e){return Vt(e._Type_)&&e.GroupParentId===l&&void 0!==e.GroupIndex&&0!==Number(e.GroupIndex)}));o.length&&i.push((0,M.createDeleteAction)(T()(o).call(o,(function(e){return e.Id}))))}}})),b()(o).call(o,i)};function nc(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function rc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nc(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):nc(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var ac=[Ue],lc=function(e,t,n,r){var a,l=e.globalConfig,o=e.dataContext,i=(e.selectionContext,e.action),c=(e.dataFactory,e.modelFactory,e.metaReader),u=(r.billPropsData,r.getHideFieldRef),d=r.setHideFieldRef,s=l.showMessage,f=i.type,p=i.value,m=p,v=p.origin,g=p.target,y=p.isPrev,C=p.dropPosition,h=g,E=Array.isArray(v)?v:[v],I=o.getData().Items,N=o.getRootId(),x=E[0],A=N,F=[],D={},k=!1,w=I.length,P=C&&0!==C,B=o.findControl(h),j=o.getParentControl(h)||{},L=o.getParentControl(x);if(it(j._Type_)&&it(L._Type_)&&B._isEntryField_){if(L.Id!==j.Id)return s("表格内容无法移动到其它表格");var U=j||{},V=U.EntityData,z=U.RefBillId,H=o.findControl(Array.isArray(v)?v:[v]),q=o.getAllSiblings(h).reduce((function(e,t){var n,r,a;return S()(v).call(v,t.Id)?e:t.Id===h?y?b()(r=[]).call(r,(0,R.c)(e),(0,R.c)(H),[t]):b()(a=[]).call(a,(0,R.c)(e),[t],(0,R.c)(H)):b()(n=[]).call(n,(0,R.c)(e),[t])}),[]),Y=T()(q).call(q,(function(e){var t,n="".concat(e.Key.toLowerCase().replace("_".concat(e.ParentId.toLowerCase()),""));return Je(e._Type_)?b()(t="".concat(n,"_startdate,")).call(t,n,"_enddate"):n}),[]).join();F.push((0,M.createUpdateAction)([[B.ParentId,{PropsDisplay:Y}],[B.ParentId,{EntityData:rc(rc({},V),{},{PropsDisplay:Y})}]]));var W=u(),X=(null==W?void 0:W[z])||{},Q=rc(rc({},null==X?void 0:X.EntityData),{},{PropsDisplay:Y});W[z]=rc(rc({},X),{},{PropsDisplay:Y,EntityData:Q}),d(W)}if(y){var Z=o.findControl(h),J=Z[K];Z[G];if(!c.getControlMeta(J).IsContainer||P)((o.getPrevSibling(h)||{}).control||{})[_]||(k=!0)}for(var $=0,ee=-1,te=function(){var e=I[$],t=e[_];if(t===h){D=e,ee=$;var n=e[K],r=e[G],a=c.getControlMeta(n).IsContainer;if(y){if(ee=ee<=0?0:ee-1,A=r,a&&(A=t),P&&(A=r),k){var l=o.getSubControls(A);ee=(ee=o.findControlIndex(l[0][_])-1)<0?$:ee}return $=w,1}if(r&&!a||P)A=r;else if(a){A=e[_];var i=o.getSubControls(t),u=i.length;u>0&&(ee=Kr()(I).call(I,(function(e){var t;return e[_]===(null===(t=i[u-1])||void 0===t?void 0:t[_])})))}$=w}else $++};$<w&&!te(););D[K];var ne=o.findControl(A)||{},re=o.findControl(x),ae=re.ApType,le=ne[K],oe=re[O]||re[K],ie=re.ParentId,ce=re.EntityData,ue=re._isEntryField_,de=re.GroupIndex,se=re.GroupParentId,fe=o.findControl(ie);(fe||{})._Type_;if(le===Ge&&S()(ac).call(ac,oe))return s("控件类型不符合，不能添加。");var pe=c.canAdd(oe,le);if(!("object"!==(0,be.c)(pe)||pe.success||it(le)&&nt(oe)))return s(pe.message);if(1===E.length&&Vt(oe)&&void 0!==de&&se){var me=o.findControlByCondition((function(e){return e.GroupParentId===se&&e.Id!==x}));if(me.length>0&&(F.push((0,M.createUpdateAction)([[x,{GroupIndex:0,GroupParentId:(0,M.createUUid)()}]])),0===Number(de))){var ve=T()(me).call(me,(function(e,t){return[e.Id,{GroupIndex:t}]}));F.push((0,M.createUpdateAction)(ve))}}if(ut(oe)&&(y?ee+=1:ee-=1),m=rc(rc({},m),{},{origin:E,targetIndex:ee,targetParentId:A}),(ot(le)||it(le))&&!ue)return s("表格之外的内容无法移动到表格内");if((!ot(le)||!it(le)||!Vt(le))&&ue&&fe.Id!==ne.Id)return s("表格的内容无法移动到表格之外");if(ae){var ge=c.getControlMeta(oe).ApType,ye=c.getControlMeta(le).BaseType,Ce=Ea(ge,ye);ae!==Ce&&F.push((0,M.createUpdateAction)([[x,{ApType:Ce}]]))}return ie!==A&&ce&&F.push((0,M.createUpdateAction)([[x,{EntityData:rc(rc({},ce),{},{ParentId:A})}]])),b()(a=[{type:f,value:m}]).call(a,F)},oc=["globalConfig","dataContext","selectionContext","action","dataFactory","modelFactory","metaReader"],ic=["type","value"];function cc(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function uc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cc(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):cc(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var dc=function(e,t,n,r){var a=e.globalConfig,l=e.dataContext,o=(e.selectionContext,e.action),i=(e.dataFactory,e.modelFactory,e.metaReader),c=((0,he.c)(e,oc),o.type),u=o.value,d=(0,he.c)(o,ic),s=St(u),f=a.showMessage,p=r.controlCacheApi,m=g()(s).call(s,(function(e){var t=e._Type_,n=e._isEntryField_,r=l.findControl(e.ParentId);if(r){var a=r._Type_,o=i.canAdd(t,r);return"object"!==(0,be.c)(o)||o.success?!ot(a)&&n?(f("父容器控件类型不符合，不能添加。"),!1):!(ot(a)&&!n)||(f("父容器控件类型不符合，不能添加。"),!1):(f(o.message),!1)}return!1})),v=T()(m).call(m,(function(e){return e.Id}));s=T()(s).call(s,(function(e){if(S()(v).call(v,e.Id)){var t=e._Type_,n=e.ApType,r=(e.NoCodeDefValue,e.DateRangeDefValue,uc({},e)),a=l.findControl(e.ParentId)._Type_;if(n){var o=i.getControlMeta(t).ApType,c=i.getControlMeta(a).BaseType;r.ApType=Ea(o,c)}return r}return e}));var y=function e(t){var n,r=[];(n=r).push.apply(n,(0,R.c)(g()(s).call(s,(function(e){return S()(t).call(t,e.Id)}))));var a=g()(s).call(s,(function(e){return S()(t).call(t,e.ParentId)}));a.length>0&&(r=T()(a).call(a,(function(e){return e.Id})).reduce((function(t,n){var r;return b()(r=[]).call(r,(0,R.c)(t),(0,R.c)(e([n])))}),r));return r}(v);setTimeout((function(){1===v.length&&M.eventBus.emit("add-control-id",v[0])}),0),p.addCache("controlId",v[0]);var C=[uc({type:c,value:y},d)];return g()(C).call(C,(function(e){var t;return 0!==(null===(t=e.value)||void 0===t?void 0:t.length)}))},sc=["type","value"],fc=(0,f.c)((0,f.c)((0,f.c)((0,f.c)((0,f.c)({},M.ActionType.ADD,ec),M.ActionType.UPDATE,Hi),M.ActionType.DELETE,tc),M.ActionType.DRAG,lc),M.ActionType.PASTE,dc),pc={NoCodeCreatorField:"nocodecreatorfield",NoCodeCreateDateField:"nocodecreatedatefield",NoCodeModifierField:"nocodemodifierfield",NoCodeModifyDateField:"nocodemodifydatefield",NoCodeBillNoField:"nocodebillnofield"},mc=function(e,t){var n=e.action,r=e.dataContext,a=e.selectionContext,l=e.globalConfig,o=e.dataFactory,i=e.modelFactory,c=e.metaReader,u=e.success,d=e.fail,s=(l.dataRef,l.keywordMapping),f=[],p=function(e){var n=[],r=t.controlCacheApi;return jr().all(T()(e).call(e,(function(e){var t=e.type,n=e.value;(0,he.c)(e,sc);if(t===M.ActionType.ADD||t===M.ActionType.PASTE){var a=St(n);return jr().all(T()(a).call(a,(function(e){var t,n=pc[e[s.type]];n?null!=e&&null!==(t=e.Key)&&void 0!==t&&S()(t).call(t,e.ParentId.toLowerCase())||(e[s.key]=n):e[s.key]=e[s.key]||"nc_".concat((0,M.createUUid)().toLowerCase());return r.addCache("controlId",e.Id),e}))).then((function(t){return e.value=t,e}))}return jr().resolve(e)}))).then((function(e){return u(b()(e).call(e,n))}))},m=n.type,v=fc[m];if(v){var g=v({globalConfig:l,dataContext:r,selectionContext:a,action:n,dataFactory:o,modelFactory:i,metaReader:c},p,d,t);g&&f.push.apply(f,(0,R.c)(g))}else f.push(n);f.length&&p(f)},vc="none",gc=function(e){var t,n,r=e.handleChange,a=e.value,l=e.className,o=e.editor,i=e.locked,c=e.Name,u=e.Tips,d=o.Enum,s=o.NameHidden,f=o.Default,p=o.Required,m=o.Title,v=T()(t=g()(d).call(d,(function(e){return e.Id!==vc}))).call(t,(function(e){return(0,B.c)({},e,{Value:e.Value||e.Id})})),y=(0,De.isUndefined)(a)?f||(null===(n=v[0])||void 0===n?void 0:n.Value):String(a),C=y===vc;return k().createElement("div",{className:"".concat(l,"-switch-select")},k().createElement("div",{className:"".concat(l,"-switch-wrap")},k().createElement(M.NameTipWrapper,{nameHidden:s,className:l,name:c,tips:u,required:p,title:m}),k().createElement(P.Switch,{checked:y!==vc,size:"large",disabled:i,onClick:function(){return function(){if(!i){var e=y!==vc?vc:v[0].Value||"";r(e)}}()}})),k().createElement("div",{className:Vn()("".concat(l,"-tab-wrap"),{"is-hidden":C})},T()(v).call(v,(function(e){return k().createElement("div",{key:e.Value,className:Vn()(["".concat(l,"-tab-item"),{"is-active":y===e.Value}]),onClick:function(){return t=e.Value,void r(t);var t}},e.Name)}))))},yc=function(e,t){if(!t)return!0;var n=(t||{}).formId,r=void 0===n?"":n;return e.formId===r},Cc=function(e){e.id;var t=e.formId,n=e.enableListener,r=void 0===n?yc:n,a=e.eventName,l=e.parser,o=e.defaultValue,i=void 0===o?{}:o,c=(0,D.useState)(i),u=(0,s.c)(c,2),d=u[0],f=u[1],p=(0,D.useCallback)((function(e){var n=e.args;if(null==r?void 0:r({formId:t},n)){var a="function"==typeof l?l(e):function(e){var t=e.data,n=e.args;return{data:t.rows,param:n.param}}(e);f(a)}}),[f,l,t,r]);return(0,D.useEffect)((function(){return M.eventBus.on(a,p),function(){M.eventBus.off(a,p)}}),[a,t,p]),d},hc=function(e){var t=e.api,n=e.parser,r=t.isVersionEqual,a=t.getData,l=(0,D.useState)((function(){return r()?n(a()):[]})),o=(0,s.c)(l,2),i=o[0],c=o[1],u=(0,D.useCallback)((function(e){var t=e.value,r=n(t);c(r)}),[]);return(0,D.useEffect)((function(){var e=t.addDataChangeListener(u);return function(){e()}}),[]),i};function bc(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ec(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bc(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):bc(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Ic=qn.treeUtils.dfs,Nc=function(e,t){var n=t.type,r=t.data;return Tc[n]?Tc[n](e,r):e},Tc={updateRelationFormId:function(e,t){return Ec(Ec({},e),{},{relationFormId:t})},updateFilterInfos:function(e,t){return Ec(Ec({},e),{},{filterInfos:t})},updateSortInfos:function(e,t){return Ec(Ec({},e),{},{sortInfos:t})},updateResult:function(e,t){return Ec(Ec({},e),{},{result:t})},updateState:function(e,t){return t}},xc=function(e){var t=P.Form.useForm(),n=(0,s.c)(t,1)[0],r=e.visible,a=e.onClose,l=e.invokeActions,o=e.queryFormValue,i=e.refBillData,c=e.onConfirm,u=e.field,d=e.compareTypesMap,p=e.formId,m=(0,D.useContext)(oe),v=m.prefixCls,y=m.baseUrl,C=m.onDownLoad,h=m.getControlText,b=m.batchInvoke,E=m.getKdesignerApi,I=m.curListTreeApi,N=m.fetchListTree,x=(0,D.useState)(r),A=(0,s.c)(x,2),F=A[0],S=A[1],w=(0,D.useState)({}),R=(0,s.c)(w,2),B=R[0],_=R[1],O=(0,D.useReducer)(Nc,o),j=(0,s.c)(O,2),L=j[0],K=j[1],U=u.Key,V=E(),G=V.data,z=V.meta,H=G.getRootId(),q=(0,D.useState)({}),Y=(0,s.c)(q,2),W=Y[0],X=Y[1],Q=(0,D.useRef)(),Z={baseUrl:y,batchInvoke:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];b(e,u.Key,t,n)},getControlText:h,addControlAction:function(e,t){M.eventBus.on(e,t)},onDownLoad:C,batchInvokeListConfig:function(e){b("listconfig","nocodeformdesigner",[e])},batchInvokeQuery:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=g()(t),r=void 0===n?"":n,a=t.search,l=void 0===a?"":a,o=t.order_by,i=void 0===o?"":o,c=t.select,u=void 0===c?"":c,d=t.page_size,s=void 0===d?10:d,f=t.page_no,m=void 0===f?1:f,v=t.ids,y=void 0===v?[]:v;if(L.relationFormId===p){var C=Ic($,(function(t){return t.entityId===e}));if(null!=C&&C.isDraftField)return}b("query","nocodeformdesigner",[e,{filter:r,search:l,order_by:i,select:u,page_size:s,page_no:m,ids:y}])}},J=Cc({id:U,formId:L.relationFormId,eventName:"setListTreeConfig",parser:function(e){var t=e.data;return nn(t,t,d)},defaultValue:[]}),$=hc({api:I,parser:function(e){return nn(e,e,d)}}),ee=(0,D.useMemo)((function(){return L.relationFormId?L.relationFormId===p?$:J:[]}),[L.relationFormId,p,$,J]),te=(0,D.useMemo)((function(){var e=G.findControl(H);return[{key:e.Key,title:e.Name,selectable:!1,children:di({metaApi:z,options:$})}]}),[$,H]),ne=Cc({id:U,formId:L.relationFormId,eventName:"filterItemLook"}),re=(0,D.useMemo)((function(){var e;return Array.isArray(L.filterInfos)?T()(e=L.filterInfos).call(e,(function(e){return Ec(Ec({},e),{},{value:"string"==typeof e.value?JSON.parse(e.value):e.value||[]})})):[]}),[L.filterInfos]);(0,D.useEffect)((function(){var e=ne.data,t=ne.param,n=(void 0===t?{}:t).enumField;if(n){var r=null==re?void 0:g()(re).call(re,(function(e){return e.fieldName===n})),a=Ic(ee,(function(e){return e.key===n}));_((function(t){return Ec(Ec({},t),{},(0,f.c)({},n,{configuredFilter:{enumEqCompareType:"001",items:r},fieldFilterConfig:a,groupInfo:e}))}))}}),[ne,re,ee]);(0,D.useEffect)((function(){F&&L.relationFormId&&l.invokeGetListConfig(L.relationFormId)}),[L.relationFormId,F]),(0,D.useEffect)((function(){F&&N()}),[F]),(0,D.useEffect)((function(){S(r)}),[r]);var ae=function(){S(!1),null==a||a()},le=function(){return new(jr())((function(e,t){n.validateFields().then((function(t){var n=Ti()(t);e(n)})).catch((function(e){return t(e)}))}))},ie=k().createElement(P.ConfigProvider,{value:{prefixCls:"kd"}},k().createElement(P.Form,{layout:"vertical",form:n,labelWidth:"100%",wrapperWidth:"100%",onValuesChange:function(e,t){}},k().createElement(qn.BillQuickFinder,{ref:Q,refBillData:i,validData:W,configuredFilterItems:re,listFilterConfig:ee||[],onGetFieldRecords:function(e){l.invokeGetFieldRecords(L.relationFormId,e.fieldName)},fieldRecords:B||{},variablesTree:te,field:u,onFilterChange:function(e){K({type:"updateFilterInfos",data:e})},relationFormId:L.relationFormId,result:L.result,sortInfos:L.sortInfos,onSortChange:function(e){K({type:"updateSortInfos",data:e})},onRelationFormChange:function(e){X({relationForm:!e}),K({type:"updateRelationFormId",data:e})},onResultChange:function(e){K({type:"updateResult",data:e})},refBillProps:Z})));return k().createElement(P.Modal,{visible:F,className:"".concat(v,"-def-editor-modal"),body:ie,bodyClassName:"".concat(v,"-def-editor-modal-body"),width:640,maskClosable:!1,destroyOnClose:!0,closable:!0,onCancel:ae,title:"查找表单记录",footer:k().createElement("div",null,k().createElement(P.Button,{size:"small",style:{marginRight:"12px"},onClick:ae},"取消"),k().createElement(P.Button,{size:"small",type:"primary",onClick:function(){le().then((function(e){var t,n;if(!(null===(t=(n=Q.current).updateVerifyAndGetMsg)||void 0===t?void 0:t.call(n)).length){var r={valueType:2,value:L};if(!L.relationFormId)return void X({relationForm:!0});l.invokeSaveBizRule(r),null==c||c(r)}})).catch((function(e){}))}},"确定"))})};function Ac(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ac(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Ac(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Sc=qn.Condition.constants,Dc=Sc.allFieldRegExp,kc=Sc.allExpRegExp,Mc={textDef:[0,1,2],decimalDef:[0,1,2],richEditorDef:[0,1],geoDef:[0,1],addressDef:[0,1],selectDef:[0,1,2],refBillDef:[0,1],dateRangeDef:[0,1],dateDef:[0,1,2],imageDef:[0,1],attachmentDef:[0,1],groupContainerDef:[],entryEntityDef:[],graphicDisplay:[]},wc=[{label:"查找表单记录",key:"search",id:1,icon:"chazhaobiaodanjilu-xian"},{label:"运算公式",key:"formula",id:2,icon:"yunsuangongshi"}],Pc={valueType:2,value:{relationFormId:"",filterInfos:[],sortInfos:[],result:[]}},Rc={valueType:0,value:""},Bc=function(e){var t,n=e.handleChange,r=e.value,a=e.className,l=e.locked,o=e.Editor,i=e.Name,c=e.Tips,u=e.field,d=(e.id,e.propName,e.inputFieldProps),f=e.editorType,p=e.getRenderValue,m=o.NameHidden,v=o.Required,y=o.minPlaceholder,C=void 0===y?"请输入":y,h=(o.maxPlaceholder,o.Title),E=(0,D.useContext)(oe),I=E.prefixCls,N=E.invokeAction,x=E.getKdesignerApi,F=E.getExpressionData,w=E.getRefBillData,R=E.getDataRef,B=E.getCompareTypes,_=(0,D.useState)(!1),O=(0,s.c)(_,2),j=O[0],L=O[1],K=(0,D.useState)(!1),U=(0,s.c)(K,2),V=U[0],G=U[1],z=(0,D.useState)(null),H=(0,s.c)(z,2),q=(H[0],H[1],(0,D.useState)(null)),Y=(0,s.c)(q,2),W=Y[0],X=Y[1],Q=x(),Z=Q.data,J=Q.meta,$=B(),ee=Z.getRootId(),te=u.ParentId,ne=Z.findControl(te)._Type_,re=(0,D.useState)(r),ae=(0,s.c)(re,2),le=ae[0],ie=ae[1],ce=(0,D.useState)(!1),ue=(0,s.c)(ce,2),de=ue[0],se=ue[1],fe=(0,D.useReducer)((function(e){return e+1}),0),pe=(0,s.c)(fe,2),me=(pe[0],pe[1]),ve=(0,D.useRef)(null),ge=(0,D.useRef)(null);(0,D.useEffect)((function(){var e=Z.addDataChangeListener((function(){me()}));return function(){e()}}),[]),(0,D.useEffect)((function(){(0,De.isEqual)(le,r)||ie(r)}),[r]);var ye=(0,M.useDebounce)(n),Ce=R(),he=Cc({id:u.Key,eventName:"setDefValueForQueryForm",parser:function(e){return{data:e.bizRule,param:{}}}}).data,be=function(e,t){try{if(e&&"string"==typeof e){var n=JSON.parse(e);return n.valueType===t?n.value:""}if("dateRangeDef"===f){var r=e.start,a=e.end,l=r&&"string"==typeof r&&JSON.parse(r),o=a&&"string"==typeof a&&JSON.parse(a);if(0===t)return{start:(null==l?void 0:l.valueType)===t?null==l?void 0:l.value:"",end:(null==o?void 0:o.valueType)===t?null==o?void 0:o.value:""};if(2===t)return(null==l?void 0:l.valueType)===t?null==l?void 0:l.value:""}}catch(e){}},Ee=(0,D.useMemo)((function(){try{return"string"==typeof he?be(he,2):null==he?void 0:he.value}catch(e){}}),[he]),Ie=(0,D.useMemo)((function(){return F()}),[F]),Ne=(0,D.useMemo)((function(){return w()}),[w]);(0,D.useEffect)((function(){return M.eventBus.on(pr,Xe),function(){M.eventBus.off(pr,Xe)}}),[]);var Te=(0,D.useMemo)((function(){return Z.findControlByCondition((function(e){var t=e._Type_,n=e.ParentId,r=(n&&Z.findControl(n)||{})._Type_;return!ot(r)&&!ot(t)}))}),[]);(0,D.useEffect)((function(){var e=ii(Te,J,!1);X(e)}),[Te]);var xe,Fe,Se=(xe=Ie.functionOperations,A()(xe)),ke=(Fe=Mc[f],null==wc?void 0:g()(wc).call(wc,(function(e){return null==Fe?void 0:S()(Fe).call(Fe,e.id)}))),Me=function(e){e.stopPropagation(),N("deleteBizRule",[{formId:Ce.id,fieldKey:u.Key}],[]),Pe(Rc),se(!1)},we={invokeGetListConfig:function(e){e!==ee&&N("listtreeconfig",[e])},invokeGetFieldRecords:function(e){N("getFilterItemLook",[e,{getEnumData:"true",enumField:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",filterrows:[]}])},invokeSaveBizRule:function(e){N("saveBizRule",[{formId:Ce.id,fieldKey:u.Key,ruleInfo:Kl()(e)}])}},Pe=function(e){e=Kl()(e),ie(e),ye(e)},Re=function(e,t){var r=(0,s.c)(e,2),a=r[0],l=void 0===a?"":a,o=r[1],i=void 0===o?"":o,c={start:Kl()({valueType:t,value:l}),end:Kl()({valueType:t,value:i})};ie(c),n(c)},Be=function(e,t){var n,r,a=Ae()(n=e[0].data).call(n,(function(e){return e.value===t}));return a=a||Ae()(r=e[1].data).call(r,(function(e){return e.value===t}))},_e=function(e){var t;if("string"==typeof e)t=e;else if(Array.isArray(e)){if("dateRangeDef"===f)return void Re(e,0);t=e.join(",")}else t=null!=e&&e.target?e.target.value:e;Pe({valueType:0,value:t})},Oe={prefixCls:"kd"},je=Fc(Fc({},d),{},{value:null!==(t=null==d?void 0:d.value)&&void 0!==t?t:"function"==typeof p?p(be(le,0)):be(le,0),onChange:_e}),Le={fieldType:"findForm",borderType:"bordered",value:be(le,2),onChange:_e,disabled:l,placeholder:C,onClear:Me,onClick:function(){return Ye("search")}},Ke=function(e){var t=e?e.split("@@"):["","",null],n=(0,s.c)(t,3);return[n[1],n[2]]}(be(le,1)),Ue={fieldType:"formula",onClick:function(){return Ye("formula")},value:Ke[0],expressionData:Ie.functionTypes,fieldData:W,onClear:Me,lang:Number(Ke[1]||1),readOnly:!0,autofocus:!1},Ve=function(e){try{if(e&&"string"==typeof e)return JSON.parse(e).valueType||0;if("dateRangeDef"===f){var t=e.start,n=(e.end,t&&"string"==typeof t&&JSON.parse(t));return(null==n?void 0:n.valueType)||0}}catch(e){}}(le),Ge={1:Ue,2:Le}[Ve],ze=(0,D.useMemo)((function(){return"fileDef"===f}),[f]),He=(ot(ne)||ze||Fc({data:ke,popperClassName:"".concat(I,"-def-editor-var-select-panel"),type:"dropdownSelect",onSelect:function(e){return Ye(e[0])},varSelectActive:de,onVarSelectActive:se},Ge),function(){L(!0)}),qe=function(){N("getBizRule",[{formId:Ce.id,fieldKey:u.Key}],[]),G(!0)},Ye=(0,D.useCallback)((function(e){var t,n={search:qe,formula:He};if("formula"===e&&!W){var r=ii(Te,J,!1);X(r)}null===(t=n[e])||void 0===t||t.call(n)}),[Te,qe,He]),We=function e(t,n,r){return null==t?void 0:T()(t).call(t,(function(t){return t.key===n?Fc(Fc({},t),{},{children:r}):t.children?Fc(Fc({},t),{},{children:e(t.children,n,r)}):t}))},Xe=function(e){var t;X((function(t){var n;return We(t,null===(n=ge.current)||void 0===n?void 0:n.Key,function(e,t){var n=t||{},r=(n.Name,n.Key),a=n.ParentId;return n.controlType,null==e?void 0:T()(e).call(e,(function(e){var t,n,l=e.PropCap,o=e.PropKey,i=(e.isMulti,e.items,e.type,l);return{key:b()(t="".concat(r,".")).call(t,o),title:i,parentId:a,id:b()(n="".concat(r,".")).call(n,o),isLeaf:!0}}))}(e,ge.current))})),null===(t=ve.current)||void 0===t||t.call(ve),ve.current=null};return k().createElement(k().Fragment,null,!ze&&k().createElement(M.NameTipWrapper,{nameHidden:m,className:a,name:i,tips:c,required:v,title:h}),k().createElement("div",{onClick:function(){ze&&Ye("search")},className:"".concat(I,"-def-editor")},k().createElement(P.ConfigProvider,{value:Oe},k().createElement(qn.InputCombo,je))),k().createElement(P.ConfigProvider,{value:Oe},j&&k().createElement(qn.Condition,{loadData:function(e){e.children,e.isLeaf;var t,n=e.key,r=e.isAsyncNode,a=(null===(t=Z.findControlByCondition((function(e){return e.Key===n})))||void 0===t?void 0:t[0])||{},l=J.getControlMeta(a._Type_).Name;return ge.current=Fc({controlType:l},a),new(jr())((function(e){if(r){ve.current=e;var t=function(e){return"NoCodeMulRefBillField_bos_adminorg"===e}(a._Type_)||function(e){return"NoCodeMulRefBillField_bos_user"===e}(a._Type_)?J.getControlMetaEditor(a._Type_,"BillEntityIdEx").Default:a.EntityData.BillEntityIdEx;N("click",[a.Id,"entitymeta","PropsDisplay",{BillEntityIdEx:t,itemKey:a.Key}],[])}else e()}))},value:Ke[0],language:Number(Ke[1]||1),modalTitle:"编辑运算公式",editorTitle:u.Name,visible:j,editorPlaceholder:"请编辑运算公式",fieldData:W,fieldTitle:"表单内容",expressionData:Ie.functionTypes,operations:Se,onClose:function(){L(!1),se(0!==Ve&&!(null==Ge||!Ge.value))},onConfirm:function(e,t){e=function(e,t){var n,r;if(!e)return"";var a=(e=e.replace(/）/g,")").replace(/（/g,"(").replace(/“/g,'"').replace(/”/g,'"').replace(/‘/g,"'").replace(/’/g,"'")).replace(Dc,"$1").replace(kc,"$1");return b()(n=b()(r="".concat(a,"@@")).call(r,e,"@@")).call(n,t?1:0)}(e,t),we.invokeSaveBizRule({valueType:1,value:e}),L(!1),!e&&se(!1),Pe(e?{valueType:1,value:e}:Rc)}})),V&&k().createElement(xc,{visible:V,onClose:function(){G(!1),se(0!==Ve&&!(null==Ge||!Ge.value))},invokeActions:we,queryFormValue:Ee||Pc.value,refBillData:Ne,field:u,compareTypesMap:$,formId:Ce.id,onConfirm:function(e){G(!1),!e.value.relationFormId&&se(!1);var t=function(e,t){var n,r=(null===(n=Be(e,t))||void 0===n?void 0:n.label)||"";return r?"查找：".concat(r):""}(Ne,e.value.relationFormId);"dateRangeDef"===f?Re([t,t],e.valueType):e.value.relationFormId?Pe({valueType:e.valueType,value:t}):Pe(Rc)}}))},_c=(0,D.memo)((function(e){var t=e.locked,n=e.editor,r=e.field,a=e.handleChange,l=e.value,o=e.className,i=n.Relationproperty,c=r||{},u=c[void 0===i?"CustomContent":i],d=c.SelectItemType,s=c.AllowClear,p=void 0===s||s,m=Array.isArray(u)?u:(null==u?void 0:u.ops)||[],v=(0,D.useMemo)((function(){var e;return g()(e=(null==m?void 0:T()(m).call(m,(function(e){return{label:e.Label,value:e.Value}})))||[]).call(e,(function(e){return e.label}))}),[m]),y=1==d,C=function(e){t||a(e)};(0,D.useEffect)((function(){if(l&&v.length){var e=JSON.parse(l)||{},t=e.value,n=(null==t?void 0:t.split(","))||[];if(n.length){var r=T()(v).call(v,(function(e){return e.value}));if((n=g()(n).call(n,(function(e){return S()(r).call(r,e)}))).length){var a=n.join(",");t!==a&&(e.value=a,C(Kl()(e)))}else C("")}}}),[v]);var h=(0,f.c)({className:"".concat(o,"-select-def-editor"),scrollHidden:!1,disabled:t,placeholder:"请选择",borderType:"bordered",allowClear:p,onChange:C,mode:y?"multiple":"single",options:v,fieldType:"combo"},"placeholder","请选择");return k().createElement(Bc,(0,B.c)({},e,{handleChange:C,getRenderValue:function(e){return y?(0,De.isEmpty)(e)?[]:null==e?void 0:e.split(","):(0,De.isEmpty)(e)?"":e},editorType:"selectDef",inputFieldProps:h}))}));_c.displayName="SelectOptionEditor";var Oc=_c;function jc(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jc(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):jc(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Kc="min",Uc="max",Vc=function(e){return{type:Kc,value:e}},Gc=function(e){return{type:Uc,value:e}},zc=function(e,t){var n=t.type,r=t.value;switch(n){case Kc:return Lc(Lc({},e),{},{min:r});case Uc:return Lc(Lc({},e),{},{max:r});default:return e}},Hc=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.locked,l=e.Editor,o=e.Name,i=e.Tips,c=l.NameHidden,u=l.Required,d=l.minPlaceholder,p=void 0===d?"最小值":d,m=l.maxPlaceholder,v=void 0===m?"最大值":m,g=l.Min,y=l.Title,C=(0,D.useReducer)(zc,{min:!1,max:!1}),h=(0,s.c)(C,2),b=h[0],E=h[1],I=(0,D.useReducer)(zc,{min:String((null==n?void 0:n.min)||""),max:String((null==n?void 0:n.max)||"")}),N=(0,s.c)(I,2),T=N[0],x=N[1];(0,D.useEffect)((function(){var e=String((null==n?void 0:n.min)||""),t=String((null==n?void 0:n.max)||""),r=b.min,a=b.max;r||e===T.min||x(Vc(e)),a||t===T.max||x(Gc(t))}),[n,b]);var A=function(e,n){var r=Lc(Lc({},T),{},(0,f.c)({},n,e));t(r)},F=(0,M.useDebounce)(A,300),S=function(e){E({type:e,value:!0})};return k().createElement(k().Fragment,null,k().createElement(M.NameTipWrapper,{nameHidden:c,className:r,name:o,tips:i,required:u,title:y}),k().createElement("div",{className:"".concat(r,"-datascope-editor")},k().createElement(P.Stepper,{type:"embed",value:T.min,zeroShow:!0,onChange:function(e){var t=e.target.value||"",n=T.max;!e.nativeEvent&&!ke()(g)&&t<g&&(t=g),t&&n&&t>Number(n)&&(t=n),x(Vc(t)),t&&!ke()(g)&&t<g||"-"===t||F(t,Kc)},onFocus:function(){return S(Kc)},onBlur:function(e){E(Vc(!1));var t=T.min;!ke()(g)&&(Number(t)<g||""===t)&&(x(Vc(String(g))),A(String(g),Kc))},disabled:a,placeholder:p}),k().createElement("div",{className:"".concat(r,"-seperator")},"-"),k().createElement(P.Stepper,{type:"embed",value:T.max,zeroShow:!0,onFocus:function(){return S(Uc)},onBlur:function(e){E(Gc(!1));var t=T.min,n=T.max;if(""!==t&&n<=Number(t)||!ke()(g)&&Number(n)<=g){var r="";""!==n&&""!==t&&n<Number(t)&&(r=t),!ke()(g)&&Number(n)<=g&&(r=g),""!==r&&(x(Gc(r)),A(r,Uc))}},onChange:function(e){var t=e.target.value||"",n=T.min;!e.nativeEvent&&t&&(!ke()(g)&&t<g&&(t=g),n&&t<Number(n)&&(t=n)),x(Gc(t)),(t&&n&&t>=Number(n)||""===n&&"-"!==t||""===t)&&(!ke()(g)&&t&&t>=g||ke()(g))&&F(t,Uc)},disabled:a,placeholder:v})))};var qc=(0,D.memo)((function(e){var t=e.item,n=e.index,r=e.prefixClass,a=e.isSysControl,l=e.fieldInfo,o=e.innerForm,i=e.isNew,c=e.disabled,u=e.isRefSelf,d=e.onDrop,f=e.onTitleChange,p=e.onShowField,m=e.onDelectField,v=e.showMessage,g=(0,D.useState)((null==t?void 0:t.Name)||""),y=(0,s.c)(g,2),C=y[0],h=y[1],b=(0,D.useState)(!1),E=(0,s.c)(b,2),I=E[0],N=E[1],T=(0,D.useRef)(null),x=l.inner2Outer,A=l.SourceForm,F=(0,D.useMemo)((function(){return!c&&(x||o)}),[x,o,c]),S=(0,D.useMemo)((function(){return!i&&("1"===A&&x||"1"!==A)}),[x,o,A,i]),M=(0,D.useMemo)((function(){return!c&&(!u&&("1"===A||F))}),[x,F,c]);(0,D.useEffect)((function(){t.Name&&h(t.Name)}),[t.Name]);var w=(0,D.useCallback)((function(){var e;C||(null==v||v("控件名不能为空"),h(null==t?void 0:t.Name)),N(!1),null===(e=T.current)||void 0===e||e.blur(),C&&f(C,n,t)}),[C,f]),P=(0,D.useCallback)((function(){F&&!a&&m(n,t,i)}),[t,n,m,F,i,a]),R=(0,D.useCallback)((function(){N(!0),setTimeout((function(){var e;return null===(e=T.current)||void 0===e?void 0:e.focus()}),200)}),[]),B=(0,D.useCallback)((function(e,t){!c&&(null==d||d(e,t))}),[d,c]);return k().createElement(qn.Draggable,{index:n,onDrop:B,disabled:c},k().createElement("div",{className:"".concat(r,"-list-drag-item")},k().createElement("div",null,k().createElement("div",{className:"".concat(r,"-list-drag-item-title")},k().createElement("i",{className:"designericon designericon-".concat((null==pn?void 0:pn[t._Type_])||"wenben")}),I?k().createElement(qn.Text,{ref:T,value:C,size:"small",onChange:h,onPressEnter:w,onBlur:w}):k().createElement("span",{title:C},C)),k().createElement("div",{className:"".concat(r,"-list-drag-item-btns")},M&&!(null!=t&&t.RefBillId)&&!(null!=t&&t.RefTableId)&&k().createElement("i",{className:"designericon designericon-bianji3",onClick:R}),S&&k().createElement("i",{className:Vn()("designericon",{"designericon-zhanshi":t.isShow},{"designericon-yincang":!(null!=t&&t.isShow)}),onClick:function(){return p(n,t)}}),k().createElement("i",{className:"designericon designericon-tuozhuailiebiao"}))),M&&k().createElement("i",{className:Vn()("nocodeplatformicon","nocodeplatformicon-xingshanchu",{gray:!(F&&!a)}),onClick:P})))}));qc.displayName="BillFieldItem";var Yc=qc;function Wc(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wc(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Wc(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Qc="refreshPropsDisplayList",Zc=k().memo((function(e){e.handleChange;var t=e.value,n=e.className,r=e.editor,a=(e.locked,e.Name),l=e.Tips,o=e.field,i=e.id,c=e.propName,u=e.rootId,d=r.NameHidden,p=r.Required,m=r.Title,v=(0,D.useContext)(oe),y=v.invokeAction,C=v.billPropsData,h=v.dispatchBillData,E=v.getKdesignerApi,I=v.getHideFieldRef,N=v.setHideFieldRef,x=(0,D.useContext)(M.GlobalConfigContext).showMessage,A=E(),F=A.data,w=A.selection,B=A.meta,_=(A.controlCacheApi,o.BillEntityIdEx),O=o.RefTableId,j=o.RefBillId,L=o._Type_,K=o.SourceForm,U=o.inner2Outer,V=o.ShowType,G="".concat(n,"-bill-props"),z=(0,D.useState)([]),H=(0,s.c)(z,2),q=H[0],Y=H[1],W=(0,D.useRef)(t),X=(0,D.useRef)({fieldId:i,tableId:O,refId:j,code:c}),Q=(0,D.useRef)(Xc({},C)||{}),Z=et(L)&&O?O:i,J=(0,D.useRef)(Z),$=(0,D.useRef)(_||"1"!==K?_:"".concat(Z,"_table")),ee=(0,D.useRef)(new(hn())(t?t.split(","):[])),te=(0,D.useRef)([]),ne=(0,D.useMemo)((function(){return xa(o,C.innerForm||[])}),[o,U,null==C?void 0:C.innerForm]),re=(0,D.useCallback)((function(e){if(W.current!==e){var t=X.current,n=t.fieldId,r=t.code,a=[[n,(0,f.c)({},r,e)]];F.batchUpdateControlPropertyValues((0,M.createUpdateAction)(a))}}),[]),ae=(0,D.useCallback)((function(e,t){var n=[],r=t||{},a=r.Key,l=r.isShow;if(F.findControlByCondition((function(r){var a;r.Id.split("_").length>1&&S()(a=r.Id).call(a,t.Id)&&n.push([r.Id,{Name:e}])})),"1"!==K&&(!l||"1"===V)){var o=(F.findControl(u)||{}).refFieldEdit,i=void 0===o?{}:o,c="string"==typeof i?JSON.parse(i||"{}"):(0,De.cloneDeep)(i);c[$.current]=c[$.current]||{},c[$.current][a]={title:e,status:"edit"},n.push([u,{refFieldEdit:c}])}F.batchUpdateControlPropertyValues((0,M.createUpdateAction)(n))}),[K,u,V]),le=(0,D.useCallback)((function(e,t){var n=t.sourceIndex,r=t.destinationIndex,a=(0,De.cloneDeep)(q),l=ue()(a).call(a,n,1)[0];ue()(a).call(a,r,0,l),Y((0,R.c)(a)),Ce(a),te.current=a,M.eventBus.emit(Qc,{id:X.current.fieldId,data:(0,R.c)(a)})}),[q,Y]),ie=(0,D.useCallback)((function(e,t,n){h({key:Gr,payload:{form:$.current,id:n.Id,data:{Name:e}}}),ae(e,n)}),[h,q]),ce=(0,D.useCallback)((function(e){return e.reduce((function(e,t){var n,r;return t.isShow?Je(t._Type_)?b()(n=[]).call(n,(0,R.c)(e),["".concat(t.Key,"_startdate"),"".concat(t.Key,"_enddate")]):b()(r=[]).call(r,(0,R.c)(e),[t.Key]):e}),[])}),[]),de=(0,D.useCallback)((function(e,t){var n=(0,De.cloneDeep)(q);if(n[e].isShow=!n[e].isShow,"2"===V)if(n[e].isShow)F.addControl((0,M.createAddAction)(Ra(n[e],i)));else{var r,a=I();Pa([b()(r="".concat(t.Id,"_")).call(r,i)],C,h,F,a,N)}var l=ce(n);"1"===V&&re(l.join());var o=new(hn())(l);n=ka(n,o),te.current=n,Y(n)}),[q,i,C,V]),se=(0,D.useCallback)((function(e,t){if(_&&!(arguments.length>2&&void 0!==arguments[2]&&arguments[2])){var n=(F.findControl(u)||{}).refFieldEdit,r=void 0===n?{}:n,a="string"==typeof r?JSON.parse(r||"{}"):(0,De.cloneDeep)(r);a[$.current]=a[$.current]||{},a[$.current][t.Key]={status:"delete"},F.batchUpdateControlPropertyValues((0,M.createUpdateAction)([[u,{refFieldEdit:a}]]))}if("2"===V&&null!=t&&t.isShow){var l=[];F.findControlByCondition((function(e){var n;S()(n=e.Id).call(n,t.Id)&&l.push(e.Id)}));var o=I();Pa(l,Q.current,h,F,o,N)}else{var i,c=g()(i=(0,R.c)(ee.current)).call(i,(function(e){return!S()(e).call(e,t.Key)}));re(c.join())}h({key:Hr,payload:{form:$.current,id:t.Id}})}),[V,_,u]),fe=(0,D.useCallback)((function(e,t,n){var r,a=window.sessionStorage.getItem("nocode-d-del-modal");if(!_||a||n||"1"===K)return se(e,t);qn.WebMsg.showConfirmModal({title:"确认删除“".concat(t.Name,"”吗？"),content:"会在表单“".concat((null===(r=Q.current[_])||void 0===r||null===(r=r.data)||void 0===r?void 0:r.caption)||"","”中同步删除"),actions:[{key:"delete",text:"删除"},{key:"ok",text:"再想想"}],onAction:function(r){"delete"===r&&se(e,t,n)},type:"delete",extra:k().createElement(P.Checkbox,{style:{marginTop:32},onChange:function(e){return e.target.checked&&window.sessionStorage.setItem("nocode-d-del-modal","true")}},"下次不再提醒")})}),[_,K,se]),pe=(0,D.useCallback)((function(e,t,n){if(e.length){var r=X.current.fieldId,a=F.findControlIndex(r),l=Ba(e,t,J.current,B),o=(0,s.c)(l,2),i=o[0],c=o[1];F.addControl((0,M.createAddAction)(i,{index:a+1})).then((function(){w.setSelect([r]),null==n||n(c.join())})).catch((function(e){}))}}),[]),me=(0,D.useCallback)((function(e,t){F.deleteControl((0,M.createDeleteAction)(e)).then((function(e){null==t||t(e)})).catch((function(e){}))}),[]),ve=(0,D.useCallback)((function(e,t){var n=wa(e,o);ee.current.size&&(n=ka(n,ee.current)),Y(n),te.current=n,null==t||t(n)}),[o]),ge=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,n=(0,D.useRef)({fn:e,timer:null}).current;return(0,D.useEffect)((function(){n.fn=e}),[e]),(0,D.useCallback)((function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){n.fn.apply(n,r)}),t)}),[e])}(ve,100),ye=(0,D.useCallback)((function(e){var t;if(null!=e&&e.data){var n=(null==e?void 0:e.data)||{},r=T()(t=n.entitymeta.Items).call(t,(function(e){return e.Id}));h({key:Vr,payload:{form:e.billEntityIdEx||n.id,info:{data:n,ids:r}}})}}),[]),Ce=(0,D.useCallback)((function(e){var t=X.current.fieldId,n=F.getParentControl(t)._Type_;if(!it(n))if("2"===V){var r=F.getAllSubControls(t),a=r.reduce((function(e,n){var r;return n.Id===t?e:b()(r=[]).call(r,(0,R.c)(e),[n.Id])}),[]);me(a,(function(){pe(e,r,(function(e){return re(e)}))}))}else re(ce(e).join())}),[V,K]);(0,D.useEffect)((function(){var e,t=((null==C?void 0:C[$.current])||{}).data,n=((null===(e=Q.current)||void 0===e?void 0:e[$.current])||{}).data;t&&!(0,De.isEqual)(n,t)&&$.current&&ge(t),Q.current=Xc({},C)}),[C]),(0,D.useEffect)((function(){var e;W.current=t,ee.current=new(hn())(t?t.split(","):[]);var n=((null===(e=Q.current)||void 0===e?void 0:e[$.current])||{}).data;n&&(U||"1"!==K)&&ge(n)}),[t]),(0,D.useEffect)((function(){if($.current!==_&&"1"!==K&&($.current=_,W.current="",ee.current=new(hn()),Y([])),_){var e,t=((null===(e=Q.current)||void 0===e?void 0:e[_])||{}).data;t?ge(t):y("getDesignerMetadata",[_]),y("click",[i,"entitymeta",c,{BillEntityIdEx:_,itemKey:o.Key}],[])}if(!_&&"1"!==K){var n,r=Se()(n=F.getAllSubControlIds(J.current)).call(n,1);r.length&&me(r),te.current=[]}}),[_]),(0,D.useEffect)((function(){if(U){var e,t=((null===(e=Q.current)||void 0===e?void 0:e[$.current])||{}).data;t&&ge(t)}}),[U]);var he=(0,D.useCallback)((function(e){var t=e.id,n=e.data;t!==X.current.fieldId||(0,De.isEqual)(n,te.current)||(te.current=n,Y(n))}),[]);(0,D.useEffect)((function(){var e,t=((null===(e=Q.current)||void 0===e?void 0:e[$.current])||{}).data;return t&&ve(t),M.eventBus.on(Qc,he),function(){M.eventBus.off(Qc,he)}}),[]),(0,D.useEffect)((function(){return M.eventBus.on(hr,ye),function(){M.eventBus.off(hr,ye)}}),[ye]);var be=(0,D.useMemo)((function(){return et(L)&&"2"===V}),[L,V]);return k().createElement("div",{className:G},k().createElement("div",{className:"".concat(G,"-title")},k().createElement(M.NameTipWrapper,{nameHidden:d,className:n,name:a,tips:l,required:p,title:m})),k().createElement("div",{className:"".concat(G,"-list")},null!=q&&q.length?k().createElement(qn.DragContainer,null,k().createElement("div",{className:"".concat(G,"-list-drag")},T()(q).call(q,(function(e,t){var n;return k().createElement(Yc,{key:e.Id,item:e,index:t,prefixClass:G,fieldInfo:o,disabled:be,isNew:!_||!(null!=C&&null!==(n=C[$.current])&&void 0!==n&&null!==(n=n.ids)&&void 0!==n&&S()(n).call(n,e.Id)),innerForm:ne,showMessage:x,isRefSelf:_===u,isSysControl:Sa(e._Type_),onDrop:le,onTitleChange:ie,onShowField:de,onDelectField:fe})})))):k().createElement("div",{className:"".concat(G,"-empty")},k().createElement(qn.EmptyData,{desc:"暂无内容"}))))}));function Jc(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function $c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jc(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Jc(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var eu=(0,D.memo)((function(e){var t,n,r,a,l=e.handleChange,o=e.value,i=e.className,c=e.editor,u=(e.locked,e.Name),d=e.Tips,f=e.field,p=(e.id,e.propName,c.NameHidden),m=c.Required,v=c.Title,y=f.FileMaxSize,C=f.UploadNum,h=f.ImageFileType,E=f.FieldType,I=f.ButtonText,N=(0,D.useContext)(oe),x=N.getKdesignerApi,A=N.baseUrl,F=(0,D.useState)([]),S=(0,s.c)(F,2),w=S[0],B=S[1],_=x(),O=(_.data,_.meta),j=O.getControlPropertyDefaultValue,L=(0,O.getControlMetaEditor)(E,"ImageFileType").Enum,K=j(E,"FileMaxSize"),U=j(E,"ImageFileType"),V="".concat(i,"-pic"),G=(0,D.useState)(""),z=(0,s.c)(G,2),H=z[0],q=z[1],Y=(0,D.useRef)(new(Pe())),W=(0,D.useCallback)((function(e){qn.WebMsg.showNotificationMsg({param:[{type:2,content:e,duration:2e3}]})}),[]),X=(0,D.useCallback)((function(e,t){return null!=C&&C.max&&t.length>C.max?(W("最多只能上传".concat(C.max,"个图片，请重新选择")),!1):!(y&&e.size/1024/1024>y)||(W("请上传小于".concat(y,"M的图片")),!1)}),[C.max,y,Y.current]),Q=(0,D.useCallback)((function(e){var t=e.file,n=e.fileList;if(t.response&&"0"===t.response.errorCode){var r,a=t.uid,o=t.name,i=t.size,c={url:t.response.data.url,status:"success",uploadTime:Date.now()};Y.current.set(t.uid,$c({uid:a,name:o,size:i},c)),l(Kl()((0,R.c)(Ti()(r=Y.current).call(r)))),n.forEach((function(e){e.uid===t.uid&&(e.url=A.picture+t.response.data.url)}))}B((0,R.c)(n))}),[w,Y.current,l]),Z=(0,D.useCallback)((function(e){var t,n=Kr()(w).call(w,(function(t){return t.uid===e.uid}));ue()(w).call(w,n,1),B((0,R.c)(w)),Y.current.get(e.uid)&&Y.current.delete(e.uid);var r=Y.current.size>0?Kl()((0,R.c)(Ti()(t=Y.current).call(t))):"";l(r)}),[w,Y.current,l]);(0,D.useEffect)((function(){if(o&&Xt(o)){var e=JSON.parse(o);(0,De.isArray)(e)?(Y.current=new(Pe()),e=T()(e).call(e,(function(e){Y.current.set(e.uid,$c({},e));var t=A.picture+e.url;return $c($c({},e),{},{url:t})})),B(e)):q(e.value)}else(0,ae.unstable_batchedUpdates)((function(){B([]),q("")}))}),[o]);var J=h||U,$=T()(t=J.split(",")).call(t,(function(e){return g()(L).call(L,(function(t){return t.Id===e}))[0].Name}));return k().createElement("div",{className:V},k().createElement("div",{style:{marginBottom:"8px"}},k().createElement(M.NameTipWrapper,{nameHidden:p,className:i,name:u,tips:d,required:m,title:v})),!H&&k().createElement("div",null,k().createElement(P.ConfigProvider,{value:{prefixCls:"kd"}},k().createElement(qn.Picture,{fileList:w,action:Ht(window.__domainurl__+"nocode/v2/nocode_sys/image"),data:{action:"upload",tempstorage:!1},accept:T()($).call($,(function(e){return"."+e})).join(","),multiple:!0,buttonText:I,onChange:Q,onRemove:Z,beforeUpload:X,noticeInfo:b()(n=b()(r=b()(a="请上传小于".concat(y||K,"M的")).call(a,$.join("、"),"文件，文件个数不少于")).call(r,(null==C?void 0:C.min)||0,"个，不多于")).call(n,(null==C?void 0:C.max)||1,"个。")}))))})),tu=function(e){var t=e.formVisible,n=e.prefixCls,r=e.refFldOptions,a=e.currFldOptions,l=e.refFldKey,o=e.currFldKey,i=e.handleChange;return t?k().createElement("div",{className:"".concat(n,"-form")},k().createElement("div",{className:"".concat(n,"-form-item")},k().createElement("div",{className:"".concat(n,"-form-item-label")},"关联表单内容"),k().createElement(P.Select,{className:"".concat(n,"-form-item-select"),borderType:"bordered",value:l,options:r,placeholder:"请选择",onChange:function(e){return i(e,"RefFldKey")}})),k().createElement("div",{className:"".concat(n,"-form-seperator")},"的值填充到"),k().createElement("div",{className:"".concat(n,"-form-item")},k().createElement("div",{className:"".concat(n,"-form-item-label")},"当前表单内容"),k().createElement(P.Select,{className:"".concat(n,"-form-item-select"),borderType:"bordered",value:o,options:a,placeholder:"请选择",onChange:function(e){return i(e,"CurrFldKey")}}))):null},nu=function(e){var t,n=e.prefixCls,r=e.data,a=e.index,l=e.isNewOption,o=e.handleDelete,i=e.handleUpdate,c=e.currFldOptions,u=e.refFldOptions,d=r.RefFldKey,f=r.CurrFldKey,p=(null===(t=Ae()(u).call(u,(function(e){return e.value===d})))||void 0===t?void 0:t.label)||"",m=(0,D.useState)(!!l),v=(0,s.c)(m,2),g=v[0],y=v[1],C=(0,D.useRef)(null),h=(0,D.useRef)(null),b=(0,D.useCallback)((function(e,t){e.stopPropagation(),o(t)}),[o]),E=(0,D.useCallback)((function(){y(!0)}),[y]),I=(0,D.useCallback)((function(e,t){i(e,a,t)}),[i,a]),N=(0,D.useCallback)((function(){return k().createElement("div",{ref:C},k().createElement(tu,{formVisible:g,prefixCls:n,currFldOptions:c,refFldOptions:u,refFldKey:d,currFldKey:f,handleChange:I}))}),[n,c,u,d,f,I,g]);return(0,M.useOnClickOutside)([C],(function(e){var t=document.getElementById("app");if((!t||null!=t&&t.contains(e.target))&&g){var n;if(null!==(n=h.current)&&void 0!==n&&n.contains(e.target))return;y(!1)}})),k().createElement(P.Tooltip,{trigger:"click",placement:"leftTop",popperStyle:{width:"636px"},popperClassName:"".concat(n,"-dropdown"),tip:N(),visible:g},k().createElement("div",{className:"".concat(n,"-option"),onClick:E,ref:h},k().createElement("div",{className:"".concat(n,"-option-name")},p),k().createElement("div",{className:"".concat(n,"-option-right-btns")},k().createElement(P.Icon,{prefix:"designericon",type:"bianji3"}),k().createElement(P.Icon,{prefix:"designericon",type:"shanchu",onClick:function(e){return b(e,a)}}))))};function ru(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function au(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ru(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):ru(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var lu={CurrFldKey:"",RefFldKey:""},ou="DELETE",iu="UPDATE",cu="MERGE",uu=function(e,t){var n=t.type,r=t.index,a=t.payload;return ht()(e,(function(e){switch(n){case"ADD":e.push(a);break;case iu:e[r]=au(au({},e[r]),a);break;case ou:ue()(e).call(e,r,1);break;case cu:e=a}return e}))},du=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.editor,l=(e.locked,e.Name),o=e.Tips,i=e.field,c=a.NameHidden,u=a.Required,d=a.Title,p=i.Id,m=(0,D.useContext)(oe),v=m.prefixCls,g=m.getKdesignerApi,y=m.getCurrentRefBillPropsData,C=g(),h=C.data,E=C.meta,I=(0,D.useReducer)(uu,n||[]),N=(0,s.c)(I,2),x=N[0],A=N[1],F=(0,D.useState)((function(){var e=h.findControlByCondition((function(e){var t=e._Type_,n=e.ParentId,r=h.getRootId(),a=(n&&h.findControl(n)||{})._Type_;return!(ot(a)||ot(t)||function(e){return"NoCodeGEOField"===e}(t)||at(t)||lt(t)||e.Id===p||e.Id===r)})).reduce((function(e,t){var n=t._Type_;return"NoCodeDateRangeField"===E.getControlMeta(n).Id?b()(e).call(e,[{label:"".concat(t.Name,".开始"),value:"".concat(t.Key,"_startdate")},{label:"".concat(t.Name,".结束"),value:"".concat(t.Key,"_enddate")}]):b()(e).call(e,{label:t.Name,value:t.Key})}),[]);return e})),S=(0,s.c)(F,1)[0],w=(0,D.useState)([]),R=(0,s.c)(w,2),B=R[0],_=R[1],O=(0,D.useState)(null),j=(0,s.c)(O,2),L=j[0],K=j[1],U=(0,D.useCallback)((function(){K(x.length),A({type:"ADD",payload:lu})}),[x,A]),V=(0,D.useCallback)((function(e,t,n){A({type:iu,index:t,payload:(0,f.c)({},n,e)})}),[A]),G=(0,D.useCallback)((function(e){K(null),A({type:ou,index:e})}),[A]),z=(0,D.useCallback)((function(e){var t=T()(e).call(e,(function(e){return{label:e.PropCap,value:e.PropKey}}));_(t)}),[]);return(0,D.useEffect)((function(){return z(y()),M.eventBus.on(pr,z),function(){M.eventBus.off(pr,z)}}),[]),(0,D.useEffect)((function(){(0,De.isEqual)(n,x)||t(x)}),[x]),(0,D.useEffect)((function(){(0,De.isEqual)(n||[],x)||A({type:cu,payload:n})}),[n]),k().createElement(k().Fragment,null,k().createElement(M.NameTipWrapper,{nameHidden:c,className:r,name:l,tips:o,required:u,title:d}),k().createElement("div",{className:"".concat(v,"-relate-field")},T()(x).call(x,(function(e,t){return k().createElement(nu,{key:t,prefixCls:"".concat(v,"-relate-field"),data:e,index:t,isNewOption:L===t,handleUpdate:V,handleDelete:G,currFldOptions:S,refFldOptions:B})}))),k().createElement("div",{className:"".concat(v,"-relate-field-add")},k().createElement("div",{className:"add-btn",onClick:U},k().createElement(P.Icon,{type:"zengjia-yuan",prefix:"designericon"}),k().createElement("span",{className:"".concat(v,"-relate-field-add-option-desc")},"添加"))))};function su(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function fu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?su(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):su(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var pu="start",mu="end",vu=function(e,t){return fu(fu({},e),t)},gu=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.locked,l=e.Editor,o=e.Name,i=e.Tips,c=l.NameHidden,u=l.Required,d=l.minPlaceholder,p=void 0===d?"请输入":d,m=l.maxPlaceholder,v=void 0===m?"请输入":m,g=l.Title,y=(0,D.useReducer)(vu,(0,f.c)((0,f.c)({},pu,!1),mu,!1)),C=(0,s.c)(y,2),h=C[0],b=C[1],E=(0,D.useReducer)(vu,(0,f.c)((0,f.c)({},pu,String((null==n?void 0:n[pu])||"")),mu,String((null==n?void 0:n[mu])||""))),I=(0,s.c)(E,2),N=I[0],T=I[1];(0,D.useEffect)((function(){var e=String((null==n?void 0:n[pu])||""),t=String((null==n?void 0:n[mu])||""),r=h[pu],a=h[mu];r||e===N[pu]||T((0,f.c)({},pu,e)),a||t===N[mu]||T((0,f.c)({},mu,t))}),[n,h]);var x=(0,M.useDebounce)((function(e,n){var r=fu(fu({},N),{},(0,f.c)({},n,e));t(r)}),300),A=function(e){b((0,f.c)({},e,!0))},F=function(e){b((0,f.c)({},e,!0))};return k().createElement(k().Fragment,null,k().createElement(M.NameTipWrapper,{nameHidden:c,className:r,name:o,tips:i,required:u,title:g}),k().createElement("div",{className:"".concat(r,"-datascope-editor")},k().createElement(P.Input,{borderType:"bordered",value:N[pu],onChange:function(e){var t=e.target.value||"";T((0,f.c)({},pu,t)),x(t,pu)},onFocus:function(){return A(pu)},onBlur:function(){return F(mu)},disabled:a,placeholder:p}),k().createElement("div",{className:"".concat(r,"-seperator")},"-"),k().createElement(P.Input,{borderType:"bordered",value:N[mu],onFocus:function(){return A(mu)},onBlur:function(){return F(mu)},onChange:function(e){var t=e.target.value||"";T((0,f.c)({},mu,t)),x(t,mu)},disabled:a,placeholder:v})))},yu=function(e){e.handleChange;var t=e.value,n=(e.className,e.locked),r=e.field.FormatType,a=(0,D.useContext)(oe).prefixCls,l={className:"".concat(a,"-daterange-editor"),popperClassName:"".concat(a,"-range-picker-dropdown"),disabled:n,placeholder:["起始日期","结束日期"],formatType:r,allowClear:!0,fieldType:"dateRange"};return k().createElement(Bc,(0,B.c)({},e,{getRenderValue:function(e){return mt(e)},editorType:"dateRangeDef",value:t,inputFieldProps:l}))},Cu=new(Pe())([["2","month"],["3","year"]]),hu=function(e){var t=e.handleChange,n=e.value,r=(e.className,e.locked),a=e.field.FormatType,l=(0,D.useContext)(oe).prefixCls,o=((0,D.useMemo)((function(){return{picker:Cu.get(a)||"date"}}),[a]),{className:"".concat(l,"-date-editor"),disabled:r,placeholde:"请选择",formatType:a,allowClear:!0,fieldType:"date",placeholder:"请选择"});return k().createElement(Bc,(0,B.c)({},e,{editorType:"dateDef",value:n,getRenderValue:function(e){return e&&Date.parse(e)?new Date(e):void 0},handleChange:function(e){t(e)},inputFieldProps:o}))};function bu(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Eu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bu(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):bu(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Iu=(0,D.memo)((function(e){var t,n,r,a=e.handleChange,l=e.value,o=e.className,i=e.editor,c=e.Name,u=e.Tips,d=e.field,p=i.NameHidden,m=i.Required,v=i.Title,y=d.FileMaxSize,C=d.UploadNum,h=d.UploadModel,E=d.AttachmentFileType,I=d.FieldType,N=d.ButtonText,x=(0,D.useContext)(oe),A=x.getKdesignerApi,F=x.baseUrl,S=x.invokeAction,w=(0,D.useState)(""),P=(0,s.c)(w,2),B=P[0],_=P[1],O=(0,D.useState)([]),j=(0,s.c)(O,2),L=j[0],K=j[1],U=(0,D.useState)(""),V=(0,s.c)(U,2),G=V[0],z=V[1],H=A(),q=(H.data,H.meta.getControlPropertyDefaultValue),Y=q(I,"AttachmentFileType"),W=q(I,"FileMaxSize"),X=y||W,Q=E||Y,Z=(0,D.useRef)(new(Pe())),J=(0,D.useCallback)((function(e){if(!e||"{}"===e)return[];if(Xt(e)){var t=JSON.parse(e);return Array.isArray(t)?T()(t).call(t,(function(e){return Z.current.set(e.uid,e),Eu(Eu({},e),{},{url:F.attachment+e.url})})):t.value}return""}),[]);(0,D.useEffect)((function(){Z.current=new(Pe());var e=J(l);Array.isArray(e)?(K(e),z("")):z(e)}),[J,l,K]);var $=(0,D.useCallback)((function(e){qn.WebMsg.showNotificationMsg({param:[{type:2,content:e,duration:2e3}]})}),[]),ee=(0,D.useCallback)((function(e,t){return null!=C&&C.max&&t.length>C.max?($("最多只能上传".concat(C.max,"个文件，请重新选择")),!1):!(X&&e.size/1024/1024>X)||($("请上传小于".concat(X,"M的文件")),!1)}),[null==C?void 0:C.max,X]),te=(0,D.useCallback)((function(e){var t=e.file,n=e.fileList;if("done"===t.status&&t.response.status){var r,l=t.lastModified,o=t.uid,i=t.name,c=t.type,u=t.size,d=(t.response,{status:"success",url:t.response.data.url,uploadTime:Date.now()});Z.current.set(t.uid,Eu({lastModified:l,uid:o,name:i,type:c,size:u},d)),a(Kl()((0,R.c)(Ti()(r=Z.current).call(r))));var s=T()(n).call(n,(function(e){return e.uid===t.uid?Z.current.get(t.uid):e}));K(s)}else K((0,R.c)(n))}),[a]),ne=(0,D.useCallback)((function(e){var t=g()(L).call(L,(function(t){return t.uid!==e.uid})),n=Z.current.get(e.uid);if(n){var r;Z.current.delete(e.uid);var l=Z.current.size>0?Kl()((0,R.c)(Ti()(r=Z.current).call(r))):"";a(l),S("beforeRemove",[{url:n.url}],[])}return K((0,R.c)(t)),!0}),[L,a,S]),re=(0,D.useCallback)((function(e){var t,n=Z.current.get(e.uid);n&&(n.name=e.name,Z.current.set(e.uid,n),a(Kl()((0,R.c)(Ti()(t=Z.current).call(t)))));K(ht()((function(t){t.forEach((function(t){t.uid===e.uid&&(t.name=e.name)}))})))}),[L,a]);return(0,D.useEffect)((function(){var e,t;_(b()(e=b()(t="".concat(c,"(")).call(t,Z.current.size,"/")).call(e,(null==C?void 0:C.max)||1,")"))}),[C,L]),k().createElement("div",{className:"".concat(o,"-attachment-editor")},k().createElement("div",{style:{marginBottom:"8px"}},k().createElement(M.NameTipWrapper,{nameHidden:p,className:o,name:B,tips:u,required:m,title:v})),!G&&k().createElement("div",null,k().createElement(qn.Attachment,(0,f.c)({multiple:!0,action:Ht(window.__domainurl__+"nocode/v2/nocode_sys/attachment"),data:{action:"upload",tempstorage:!1,isDesigner:!0},fileList:L,buttonText:N,mode:h,onChange:te,beforeUpload:ee,onRemove:ne,onChangeFileName:re,accept:Q||"",uploadNum:C,noticeInfo:b()(t=b()(n=b()(r="请上传小于".concat(X,"M的")).call(r,null==Q?void 0:Va()(Q).call(Q,".",""),"文件，文件个数不少于")).call(n,(null==C?void 0:C.min)||0,"个，不多于")).call(t,(null==C?void 0:C.max)||1,"个")},"mode",1))))}));function Nu(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Tu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nu(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Nu(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var xu,Au,Fu,Su=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.field,l=a.Precision,o=a.Scale,i=a.DataRange,c=a.ThousandsSeparator,u=(0,D.useMemo)((function(){var e={},t=i||{},n=t.min,r=t.max;return(0,De.isUndefined)(n)||""===n||(e.min=Number(n)),(0,De.isUndefined)(r)||""===r||(e.max=Number(r)),e}),[i]),d=(0,D.useCallback)((function(e){return c?Gt("".concat(e)):String(e)}),[c]),s=Tu(Tu({className:"".concat(r,"-number-def-editor")},u),{},{showStepper:!0,decimalLength:o,formatter:d,maxLength:l,fieldType:"number",placeholder:"请输入"});return k().createElement(Bc,(0,B.c)({},e,{editorType:"decimalDef",value:"".concat(n),onChange:function(e){t(e)},inputFieldProps:s}))},Du="#F8FAFC",ku=(0,R.c)(new(hn())(T()(xu=m()(We)).call(xu,(function(e){return We[e]})))),Mu=b()(Au=[Du]).call(Au,ku),wu=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.editor,l=e.locked,o=e.field,i=e.Name,c=e.Tips,u=a.NameHidden,d=a.Default,s=a.Required,f=a.Title,p=o.BackImage,m=(0,D.useRef)(!0),v=(0,De.isUndefined)(n)?d:String(n),g=function(e){l||t(e)};return(0,D.useEffect)((function(){!v&&g(ku[0])}),[]),(0,D.useEffect)((function(){if(p&&!m.current){var e=Ae()(Xe).call(Xe,(function(e,t){return S()(p).call(p,"background_".concat(t+1))}));g(e?We[e.primaryColor]:Du)}m.current=!1}),[p,Xe]),k().createElement(k().Fragment,null,k().createElement(M.NameTipWrapper,{nameHidden:u,className:r,name:i,tips:c,required:s,title:f}),k().createElement(Zr,{className:"".concat(r,"-colorpicker-content"),colorList:Mu,prefixClass:r,onChange:g,value:v}))},Pu=r(3872),Ru=r.n(Pu),Bu=Ht((Fu="nocode/v2/nocode_sys/image",window.__domainurl__+Fu)),_u=["image/png","image/jpeg","image/jpg"],Ou=function(e){var t=(0,D.useContext)(oe),n=t.baseUrl,r=t.showMessage,a=e.handleChange,l=e.value,o=e.className,i=e.editor,c=e.locked,u=e.Name,d=e.Tips,p=i.NameHidden,m=i.Default,v=i.Required,g=i.Images,y=void 0===g?[]:g,C=i.Title,h=(0,De.isUndefined)(l)?m:String(l),b="".concat(o,"-bgimage"),E=(0,D.useState)(!1),I=(0,s.c)(E,2),N=I[0],x=I[1],A=(0,D.useState)(""),F=(0,s.c)(A,2),w=F[0],R=F[1],_=k().useState(null!=h?h:Yt(n.picture,h)),O=(0,s.c)(_,2),j=O[0],L=O[1];(0,D.useEffect)((function(){h&&L(Yt(n.picture,h))}),[h]),(0,D.useEffect)((function(){!h&&K(m)}),[]);var K=function(e){c||a(e)},U=k().createElement("div",null,k().createElement(P.Icon,{className:"".concat(b,"-content-upload-add"),type:"add"}),k().createElement("p",{className:"".concat(b,"-content-upload-text")},"上传自定义图片")),V={data:{action:"upload",tempstorage:!0},name:"file",action:"nocode/v2/nocode_sys/image",showUploadList:!1,listType:"picture",accept:_u.toString(),onChange:function(e){e.file},beforeUpload:function(e){if(S()(_u).call(_u,e.type)){w&&Ru().revokeObjectURL(w);var t=Ru().createObjectURL(e);return R(t),x(!0),!1}}};return k().createElement(k().Fragment,null,k().createElement(M.NameTipWrapper,{nameHidden:p,className:o,name:u,tips:d,required:v,title:C}),k().createElement("div",{className:"".concat(b,"-content")},T()(Xe).call(Xe,(function(e,t){var n=y[t]||y[0],r=qt(n);return k().createElement("div",{key:t,className:"".concat(b,"-content-item"),onClick:function(){return K(n)}},k().createElement("img",{className:"".concat(b,"-content-image"),src:r,alt:e.name}),k().createElement("div",{className:"".concat(b,"-content-handle")},k().createElement("span",{className:"".concat(b,"-content-text")},e.name),k().createElement("span",{className:Vn()("".concat(b,"-content-uncheck"),(0,f.c)({},"".concat(b,"-content-check"),n===h))})))})),k().createElement(P.Upload,(0,B.c)({className:"".concat(b,"-content-upload")},V),j&&!S()(y).call(y,h)?k().createElement("img",{src:Ht(j),alt:"avatar",style:{width:"100%"}}):U),k().createElement(P.ImageCropper,{autoCropArea:1,imageMaxSize:20,containerWidth:800,containerHeight:588,aspectRatio:6,visible:N,title:"图片裁剪",image:w,onClose:function(){x(!1)},onCropSuccess:function(e){var t=new FileReader;t.readAsDataURL(e),t.addEventListener("load",(function(){var t;(t=e,new(jr())((function(e,n){var r=new FormData;r.append("file",t),r.append("action","upload"),r.append("tempstorage","true");var a=new XMLHttpRequest;a.open("POST",Bu),a.onload=function(t){200===this.status&&t.target.response?e(JSON.parse(t.target.response)):n(t)},a.onerror=function(e){n(e)},a.send(r)}))).then((function(e){var t=e.data;if("0"===e.errorCode){var l=(t||{}).url;if(!l)return;var o=Yt(n.picture,l);L(o),a(l)}else r("裁剪图片失败，请稍后重试")})).catch((function(e){r("裁剪图片失败，请稍后重试")})).finally((function(){return x(!1)}))}))},dragMode:"move",cropBoxMovable:!1,className:"".concat(b,"-content-cropper"),okText:"确定裁剪"})))};function ju(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ju(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):ju(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Ku=qn.treeUtils.exludeTreeNodeByCallback,Uu=[{value:1,label:"编辑"},{value:2,label:"禁用"},{value:3,label:"只读"},{value:4,label:"隐藏"},{value:5,label:"必录"},{value:6,label:"非必录"}],Vu=new(Pe())([[1,["NoCodeGraphicDisplayField"]],[2,["NoCodeGraphicDisplayField","NoCodeGroupContainerAp"]],[3,["NoCodeGroupContainerAp"]],[4,[]],[5,["NoCodeGraphicDisplayField","NoCodeGroupContainerAp"]],[6,["NoCodeGraphicDisplayField","NoCodeGroupContainerAp"]]]),Gu=function(e){var t,n=e.value,r=e.onChange,a=e.fieldOptions,l=(0,D.useState)(n||[]),o=(0,s.c)(l,2),i=o[0],c=o[1],u=(0,(0,D.useContext)(oe).getKdesignerApi)().data,d=(0,D.useRef)(T()(t=new Array((null==i?void 0:i.length)||0)).call(t,M.createUUid)),f=function(e,t){var n=Ae()(i).call(i,(function(e,n){return n===t})).actionType;if(e!==n){var a=n<5&&e>4||e<5&&n>4,l=T()(i).call(i,(function(n,r){if(t===r){var l=n.fieldName,o=Vu.get(e)||[],i=St(l),c=g()(i).call(i,(function(e){var t,n=((null===(t=u.findControlByCondition((function(t){return t.Key===e})))||void 0===t?void 0:t[0])||{})._Type_;return S()(o).call(o,n)}));return a?{fieldName:[],actionType:e}:c.length?{fieldName:g()(i).call(i,(function(e){return!S()(c).call(c,e)})),actionType:e}:Lu(Lu({},n),{},{actionType:e})}return n}));c(l),r(l)}},p=function(e,t){var n=T()(i).call(i,(function(n,r){return t===r?Lu(Lu({},n),{},{fieldName:e}):n}));c(n),r(n)};return(0,D.useEffect)((function(){var e,t=n||[];(0,De.isEqual)(t,i)||(c(t),d.current=T()(e=new Array((null==t?void 0:t.length)||0)).call(e,M.createUUid))}),[n]),k().createElement("div",{className:"display-rule-true-actions"},k().createElement(P.ConfigProvider,{value:{prefixCls:"kd"}},T()(i).call(i,(function(e,t){var n,l=e.actionType,o=e.fieldName,u=Vu.get(l)||[],s=Ku(a,(function(e){var t=e.type,n=e.children;return!S()(u).call(u,t)||!!n.length})),m=fi(s,"key"),v=g()(n=St(o)).call(n,(function(e){return S()(m).call(m,e)}));return k().createElement("div",{className:"row_item",key:d.current[t]},k().createElement(P.Select,{className:"action-type-select",value:l,options:Uu,placeholder:"请选择",borderType:"bordered",size:"middle",onChange:function(e){return f(e,t)}}),k().createElement(qn.KDTreeSelect,{mode:"multiple",className:"field-name-select",virtual:!1,value:v,treeData:s,showFullLabelTips:!0,treeCheckStrictly:l>4,onChange:function(e){return p(e,t)}}),k().createElement(P.Icon,{className:"delete_icon",prefix:"ncicon",type:"xingshanchu",onClick:function(){return function(e){var t,n=(0,R.c)(i);ue()(n).call(n,e,1),ue()(t=d.current).call(t,e,1),c(n),r(n)}(t)}}))}))),k().createElement("div",{className:"footer-btns"},k().createElement("div",{className:"add-btn",onClick:function(){var e,t=b()(e=[]).call(e,(0,R.c)(i),[{actionType:"",fieldName:[]}]);c(t),d.current.push((0,M.createUUid)()),r(t)}},k().createElement(P.Icon,{prefix:"nocodeplatformicon",type:"zengjia-yuan"}),"添加规则效果"),!!i.length&&k().createElement("div",{className:"clear-all",onClick:function(){c([]),r([]),d.current=[]}},"清空")))};function zu(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Hu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zu(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):zu(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var qu=qn.treeUtils.dfs,Yu=qn.treeUtils.getListConfigPure,Wu=qn.ListFilterUtil.getVarSelectDisabled,Xu=function(e,t){return Hu(Hu({},e),t)},Qu=function(e){var t=e.prefixCls,n=e.value,r=e.fieldKey,a=e.ruleId,l=e.listFilterConfig,o=e.fieldOptions,i=e.onChange,c=e.onSave,u=P.Form.useForm(),d=(0,s.c)(u,1)[0],p=(0,D.useContext)(oe),m=p.invokeAction,v=p.getKdesignerApi,y=p.baseUrl,C=p.batchInvoke,h=p.getControlText,b=p.onDownLoad,E=v(),I=E.data,N=E.meta,T=I.getRootId(),x=(0,D.useReducer)(Xu,n),F=(0,s.c)(x,2),w=F[0],R=F[1],B=(0,D.useState)({}),_=(0,s.c)(B,2),O=_[0],j=_[1],L=(0,D.useRef)(),K=Cc({id:r,formId:T,eventName:"filterItemLook"}),U=(0,D.useMemo)((function(){return Yu(l)}),[l]),V=(0,D.useMemo)((function(){return di({metaApi:N,options:l})}),[l]);(0,D.useEffect)((function(){var e=K.data,t=K.param,n=(void 0===t?{}:t).enumField;if(n){var r,a=null===(r=w.preCondition)||void 0===r?void 0:g()(r).call(r,(function(e){return e.fieldName===n})),o=qu(l,(function(e){return e.key===n}));j((function(t){return Hu(Hu({},t),{},(0,f.c)({},n,{configuredFilter:{enumEqCompareType:"001",items:a},fieldFilterConfig:o,groupInfo:e}))}))}}),[K,w.preCondition,l]);var G=(0,D.useMemo)((function(){var e;return!(null!=a&&null!==(e=S()(a))&&void 0!==e&&e.call(a,"new_rule_"))}),[n]),z={baseUrl:y,batchInvoke:function(e,t){C(e,r,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[])},getControlText:h,addControlAction:function(e,t){return M.eventBus.on(e,t),function(){M.eventBus.off(e,t)}},onDownLoad:b,batchInvokeListConfig:function(e){C("listconfig","nocodeformdesigner",[e])},batchInvokeQuery:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=g()(t),r=void 0===n?"":n,a=t.search,o=void 0===a?"":a,i=t.order_by,c=void 0===i?"":i,u=t.select,d=void 0===u?"":u,s=t.page_size,f=void 0===s?10:s,p=t.page_no,m=void 0===p?1:p,v=t.ids,y=void 0===v?[]:v,h=qu(l,(function(t){return t.entityId===e}));null!=h&&h.isDraftField||C("query","nocodeformdesigner",[e,{filter:r,search:o,order_by:c,select:d,page_size:f,page_no:m,ids:y}])}},H=(0,D.useCallback)((function(){var e,t,n=null===(e=L.current)||void 0===e||null===(t=e.updateVerifyAndGetMsg)||void 0===t?void 0:t.call(e);new(jr())((function(e,t){d.validateFields().then((function(t){var n=Ti()(t);e(n)})).catch((function(e){return t(e)}))})).then((function(e){var t=e,r=t.name,l=t.trueAction;e=Hu(Hu({},e),{},{name:Xr()(r).call(r)});var o=Hu(Hu({},e),{},{formId:T,ruleType:"0"});G&&(o.ruleId=a);var i=Kl()(l).length;if(i>2e3)return qn.WebMsg.showNotificationMsg("你输入的执行内容长度为[".concat(i,"]，超出了最大长度2000字符。请精简内容后再次尝试保存。"));n.length||c(o)})).catch((function(e){}))}),[T,a,G]),q=(0,M.useDebounce)(H),Y=function(e,t){R((0,f.c)({},e,t)),i((0,f.c)({},e,t))};return k().createElement("div",{className:"display-rules-setting"},k().createElement("div",{className:"setting-form"},k().createElement(P.Form,{layout:"vertical",form:d,labelWidth:"100%",wrapperWidth:"100%",onValuesChange:function(e,t){}},k().createElement(P.Form.Item,{label:"规则名称",name:"name",required:!0,validateTrigger:"onBlur",rules:[{required:!0,message:"请输入规则名称"},{type:"string",validator:function(e,t,n,r,a){return null!=t&&Xr()(t).call(t)?[]:[new Error("请输入规则名称")]}}]},k().createElement(P.Input,{type:"text",borderType:"bordered",size:"middle",placeholder:"请输入规则名称",maxLength:50,value:w.name,onChange:function(e){return Y("name",e.target.value)}})),k().createElement(P.Form.Item,{label:"当满足以下条件时",name:"preCondition",rules:[{type:"array",required:!0,message:"请添加判断条件"}]},k().createElement(qn.FilterEditor,{id:"filter",ref:L,valueRequired:!0,name:"添加判断条件",tips:"",variablesTree:V||[],listFilterConfig:U||[],onGetFieldRecords:function(e){!function(e){m("getFilterItemLook",[e,{getEnumData:"true",enumField:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",filterrows:[]}])}(T,e.fieldName)},fieldRecords:O,nameHidden:!0,style:{marginTop:"0px"},getVarSelectDisabled:Wu,fieldData:{fieldType:"treeSelect",style:{width:"184px"}},filterFooterData:{listType:"tree",triggerText:"添加判断条件"},value:w.preCondition||[],refBillProps:z,onChange:function(e){d.setFieldValue("preCondition",e),Y("preCondition",e)}})),k().createElement(P.Form.Item,{label:"则执行",name:"trueAction",rules:[{type:"array",required:!0,validator:function(e,t,n,r,a){return null!=t&&t.length&&t.every((function(e){return A()(e).every((function(e){return"string"==typeof e?""!==e:!Array.isArray(e)||0!==e.length}))}))?[]:[new Error("请添加规则效果")]}}]},k().createElement(Gu,{prefixCls:t,value:w.trueAction,fieldOptions:o,onChange:function(e){return Y("trueAction",e)}})))),k().createElement("div",{className:"setting-footer"},k().createElement(P.Button,{size:"small",type:"primary",onClick:q},"保存")))},Zu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcAAAAEACAMAAAATE1b1AAACQ1BMVEUAAADb3eja4uzZ3ejY3efg5OfY3enW3una3unV4unY3+nb5O3X3enY3ejb3ufX3ejX4ebN2OTW2+fX3OfY3OnX2+jY3enX3ejX3OfX3enW3ObV3efX3ejV3OXW3ePY3unX3OfX3OZloPrY3efX3ejW3u8AHWDd5O80Rm76zMJCU3kSKWItP2s8TXTr1tQnOmmLl7ItQGktQGktcvQoOmf8z8XY3en20sobMGYjOGk9e/MuQGm01v//zsIsP2jj6vXx1M8mN2r9z8JDU3r40cjz1M8mO2knWLkscvYCHV8zd/b7zsQsP2l3nOzW3OjW3Oe11v8DHl/d4+4zd/UAHF4MJGD/wrVQfuO01v8AHF612P+DneYncPf/v7Iscfri6PNriOJGT3fpraN4jt5TY4UocPdseZiDtvx3luS01/+MlbEocPbi6POz1f/W3Ocnb/UsPmiFuP/K0Nv/zcAAHF7Y5PWq0P+XxP97rPy92fzV2uXe5O+hyf+y0/3O1OD/s6tlc5OOvv+Wwf2z0PkrRHgjMVP21M6ZufNXlv0wdPVda43Q1+JAUHjv2tr+yL0/gvjY3+ojZeD80MV8iaVYZ4omNlrk5vBnnvro4uc0Rm3+wrdtephSYYQpOmKss8vE0fEnbO7m5OvFzd4hXs9LW39Ni/e0vNSircXrtrb/ubCVhZrS3vRkkOzr4OO7xNWbpbyHrfR2ovRWfuaLo+KpmsvcssCSnbbdrKq5maF3bIliXYAXLGeuwu+Di9bLts52htdyg6mPG3iNAAAAbHRSTlMAEgsaJgYiGB0PKwQhLxYpDgkfLTQVOD89SEMzRTclOzoyW0FLH4b9d/SRTMmFUTT88d3Ss7CSjSkS/vzz256SbR/HnIBcQAnu47Oei4nz1cm/vZ6AaVby4NBpX1A5IdXJtbKhhHdsaDSrUjldQMwIAAAMu0lEQVR42uzZQY3EMAxAUV96KZEwKIxWGhyRCQyJQt5dqVpNh4Hd9yh8WYmTAAAAAAAAAAAAAAAAAAAAAACAb+t27NnMfmxrPMOyZVPbEg+wvLKt1xMKtp2/P1u0t2Zr/c/B1gP4hBE8srUjumu3P9zt0V02co75a5z5IbrLPsa8DAEres9/77wIWMeYH4aA1Zzz5joHBSxjzJshYDHzi4DFCFicgMUJWJxLTHHWiOos8tV5SqvOY3Z1vpMaiu6yuegum4vusrno7oddu3tRIgrjOP5U9mZFQZRuSQXbTXRRN90sdFFERdFVVEQv9ELQxdOe9MzCprRzUahDOZIXJl5UtlTrtkGv9LK9/WnNzKozo44Fe5DOrz74Mnouv5zjOeo4OEI3Do7QjYMjdOPgCB2DI3QMjtAxOELH4AgdgyN0DI7QMThCx+AIHYMjdAyO0DE4QsfgCB2DI3QMjtAxOELH4AgdgyN0DI7QMThCx6ievnj0Yu/PvXsIHGN6et9oOXuYoDGk3F3Dd4qQMaLarBG0m4Axnmpe3jeCzhIwhlOrSDlvhBwgXIzG7Wcbxj+zhjKYV04/OeNE+3L/f0ANlaTro2HM75KfjTbkwyAjaeSlyzYNY9Z57uxFjxAuBlKSC+rmzc/S9Wn+/y5UH9W8bMnv+jwjPfan2dmPXy4TMEbh7l48lQaXPtrS9+UKAWMMgelXZea6DPh0moAxhFol1I8bMgB6AmIELMm2Ei/Iy46DBI3118j7/XqTSugFFCFgoNUrbqvKtv2EjTUXmH6VGvs6b18gbKy3kvT7NUIDtvQcJ3Css5r05avhsqZ7lLCb4J+AgwPmslOZzFQ2p2Zcvar0VWockjdNs9k0TegVdMParSmOls20ZJWMq5eXHfW6fDdXeBwM6EIOuDo2utPBke5lOu6pHVcfsG5L+VYIYc29+/qSHS8LM6br+QmCtGatU88zaP75sirH1Qe03YaWaBmbm3szmU5/MM2ZQjp98tr5iwRmaTw10sYRcpmQnNpx9XsY+UEEFdPp9He336RwHD128hzBWB4fCYiegCFZtePqDxH2exFkpZ12D52HZ515ibKYrkiN/EnAqUzIlNLxiUUJ/QhRkQua34TrgWh5mC4Wi88mJ4XvKgFYkhwJ4wiZLurGJ27dWJTbdzio+sqNaJtvwwGtslUslq2y8I0tJd2tWZ/qNvSAEzcW6Xb6DneplWzTCgT0uAFFiPaL6NJkqsfQl9Bbiw/oF/Q9Fq4nkQHdvpdIbyu3pHoNfRNzQ0HAPgULCxNw4Aw8Q1qLpfoZ9jFiQknA3oKFMS/gtPCVy5YIGSOdxbf0NayDvOKAvQX58euymJ4WUZ44902kr3Vb+hvSV2mKA/oFww3fnRkYUOPTvN+vy3C+zFYbMLogvxRRHmh9EoyPRhnKz0nKA0YXjA6o8zZ0W8Ixmhj1OBcBPATqA0YXtCIDarwNXZUIQwnYr2A56iPQ3d5YpKXVCdSAfQo+GxRQXCcNLd+c9CSSCefmPTu8awf/xt8dsLfgw6gVdPrtt/cftPyHzMZkFICAPQXfiP5+mM26lIdIPyuT0AG7C74W/b23pWMfaWf55u0D8W/89QG7ChZEf4/af9PesGxFLL4uHluxcgPpIOZl2rF9h8e5aL/2rncABAwX/NXOff0qDcUBHP9RNsLFgTiuuPeece+9Emdi1GhM3P4UTN0rzjgTTdQY44xxvKlPPhn/Ng8t0IJtT738xB74fW5Dlz59Q8s55d6fRWe/dMOg0XbDsoGfXEsOl0AJBQLWFXxXdDZBNywb3WBIJtiPeVN5CZRQIaAoKJ1L001zB/2pOwmBlcx3REB7waKjdbppziAnuRAEVCpfKOQL+ToF41h1jd4UCWgruKDoZJZumjDIWRYCqXdB5v8FvHrO7m8C3nRy0XsqZoNeMcjFsEDeCmOFXEEsuVxlbag79v8CXjltc+Nks2oBX0gCDnGTgMDplZNDCeUCOk/FbF6sm6YOdhW8y2i8EwN+dw44VzctG+wuAgGT6pZDCeUCOk/F7Jmqm1aN8hCwgtHuTgx4q+hkyIAJlYHgAC8xCJKuET6ghHIB3zkOAwcMWKEbNg7wFIYAiWV8QAnlAp51HAYOHDi3MpIf6GlYHwiOTEcGxPfOAZfphhUDvWUgMLTODPj5toPJw4YN1g2Lh0kk4L/RQl3xcDgeD2lQFupXL9MvkxEvDVBCuYAPSk4ODx9ujgQnDJfIa/A/JMMRM5AZKhbXIGHsN8Zr94BPFpacHMjn5+iGgXmJCLScFk79WSb157FOCPi55GhmPr9KN0y15vMF+3Z1PwqtpaVTTUAJ1QJ+KTkrFCpD+dUFmb7QSr0SqZSSAUlZAaeXnB3P5cyh/LKcTHcvaJ1kNsUB7QGflpwdzuXMofzcnFQcWiaebRZKqBbwVcnZwe7ujeZUTLdUFlolkeWADQGvuwUcMcIcys8ZIReFlojGIjLZSFYsXsdQQrWAD0rOJmYyo8ypmIxcCFoiFmlCuwZ8XXK2UnQxhvKLM3IJaIVEhAP+XUBjKD8hIxeBPl3pSLZfKhJLhOAf6YpwQIeAz9wCikkL84FErp9c1r6T/icNk0OrIkMjYjHWgve2/d+b0C/6b6WR8B1QDJlW62WDUn9tqAbUojEi6Bf9TAyJvwmYMadiUp6yqaxYUg36ArEwB5QHXGgPmBXMgWC2J4ZGgZIW44DygC/twwhxExloPlCK9IxG/QZMx9IGsSGW+rUgVm7naucFlFA54KNS6Y094FTdMDXSI5TvQS1Not0Dfiw9v+MQcFmkZ9JAJs4Bq7xmYl7fufO8FlB84q4EnDvUTWxorEysHPfDQGVM3zF9/yAOisVaN5wTnM6jhMoBH9gDig6r9VWrywFjPaUBjd61MIm+CbH42xYvgrFdk2jrgK8aAk7VB8ZW6PqqWE+FgUZXgg76Qx/w3HkSXgGf3rljfYgRt4sRc9LpVWIgmO4xDUgk2iEgEa+AP+wB+5pGiWFE3x6LA4Vo2FMinBBL2CeUUDngW3vA6h1kzjLrjmJpPOZ2DihoIpL7jxVS/tPeAV9+tQWckiCh0XwH1Ad+B5YeXbtzp1QLGCYRAgKhcFPaO+B12zj+SVADxgmhhMIBn+Fz8oBdHFASgjDgdXxpCxinwQElIQgDPsVHz4MZsOsP8a64WBz2pZAO/UC+2YCvbQG7aNAEbE4wAvqYSrvRXMAfeN0WsD8NkoD9CaGEwgG/4Ssr4PgQDSCQDNXpH+ovFqd992MWlFA44Ft8qkTAv9YpAb/idA6ICgf8gN/eWAGTNIBAbw7oK+AlfPsXAXsne4vFbZsD/oeAiJ9tAXvTIAmYJIQS6gZ8ifihZAXUaAABrS0CXj0n11TAR4gPAxqw8QJtrk3WfuPaOmf//+iDmlNprxEvBzYgHZRQLaD1K9YPEPGlFbAPDZKAlFBC3YCvEPGRFTBKAwj04YB+LqFPEfEjB0SlAz6zAvbyIdorGhUvXvgSKglBF3C6sWcFpAEE+pi0PppYnLcFsbKOOzDPtV3AB9bDiLo74ngIjmgfQiijbMAvdX+3aQoER5QSyigW0Lrrva0LuAmCgwP6CvgZEadzQNUCvrY9DkT8EciAvTign4AfEPFbMANSQhnFAlpD94d1f/51CQQHB/QV8Akivg1kQFIooVpAa/YTha8cEFUN+BKFDxwQVQ34CIVrHFCVgCcbA35E4VSpaja0qXHoTdmAr7Gs/QPuR2+qBXxpPZA3dts+4FL0pmzA61g2o+0D9kMZtQIutH2jQpjZ9gH9vAVVClj3QB6XTq7uToZ2Fd2GXpQOuC3aAQEhuhTdqRbwsv0bFUujMLsDAgL0W7p/HP5jd6suNOO8LOA4K+DSfgCwpCMCtkKRxAXXfovAML9UNQmAA6ofcFN1dyYwtQKugbLxHFCtgMtLVdM4IKl1RQov/AdcDmU7OSCRWf844K7GgPOhbFJ1dwawpmwoUrjnGnALGOaVqtZC2RoOSORQkcL9q24BdzcEXAiGaRyQyL4iCddfm9ecg83jgMG6Cd7zvoJaAWc23BMXAmvOiSIJl8m0iEtAa1wIrEnbixQ+Od4Fj0HFmsapMw5IZu2/G0nsglrAGQ0PcBdWrqB8D2zevn9VcJcGNcvXnxG2TpsHpmlrzAPAmreWaDB41fEDjGnrGcMkqBprHhgLjMBekjfhggv2ObTdYLPjjGk2VK0/U03KSBJup5gVffzi5lWj3pbdYDfvTMX6P4+sBUZj7dGRFI4c6Y5Cg61nquaBaafY5ouoKiadqZlk3QKr5gMLuPk7xlbsqNaaVzu0ExhjjDHGGGOMMcYYY4wxxhhjjDHGGGN/7zcWyc9ypV5uJAAAAABJRU5ErkJggg==";function Ju(e,t){var n=void 0!==ge()&&Ce()(e)||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return $u(e,t);var r=Se()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return me()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,l=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw l}}}}function $u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ed(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function td(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ed(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):ed(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var nd=qn.treeUtils.exludeTreeNodeByCallback,rd=function(e){var t=e.handleAdd;return k().createElement("div",{className:"rule-empty"},k().createElement("img",{src:Zu,alt:"暂无卡片",width:224,height:128}),k().createElement("div",{className:"empty-text"},"暂无规则，点击下方按钮添加"),k().createElement(P.Button,{type:"primary",icon:k().createElement(P.Icon,{prefix:"nocodeplatformicon",type:"zengjia-yuan"}),onClick:t},"添加规则"))},ad=function e(t,n,r,a){return t.reduce((function(t,l){var o=l._Type_,i=l.Name,c=l.Key,u=l.BillEntityIdEx,d=l.SelectItemType,s=l.Multi,f=l.children,p={title:i,titlePrefix:on(l,n,r,a),key:c,type:o,entityId:u,isMulti:1===d||1===s};return f&&(p.children=e(f,n,r,a)),b()(t).call(t,p)}),[])},ld=function(e){var t=cd(e);return td({affectfldkeys:t.affectfldkeys,depfldkeys:t.depfldkeys},e)},od=(0,D.forwardRef)((function(e,t){var n=e.prefixCls,r=e.field,a=e.refreshEditorDisplay,l=(0,D.useContext)(oe),o=(l.invokeAction,l.getDisplayRules),i=l.setDisplayRules,c=l.getCompareTypes,u=l.getKdesignerApi,d=l.curListTreeApi,f=l.getRefBillNameMap,p=(0,D.useState)((function(){var e,t=o(),n=T()(t).call(t,ld);if((null==n?void 0:n.length)<=1)return n;var r,a=[],l=[],i=[],c=Ju(n);try{for(c.s();!(r=c.n()).done;){var u=r.value,d=u.depfldkeys,s=u.affectfldkeys;S()(d).call(d,M)&&S()(s).call(s,M)?a.push(u):S()(d).call(d,M)||S()(s).call(s,M)?l.push(u):i.push(u)}}catch(e){c.e(e)}finally{c.f()}return b()(e=[]).call(e,a,l,i)})),m=(0,s.c)(p,2),v=m[0],y=m[1],C=(0,D.useState)((function(){var e;if(v.length)return null===(e=v[0])||void 0===e?void 0:e.ruleId})),h=(0,s.c)(C,2),E=h[0],I=h[1],N=u(),x=N.data,A=N.meta,F=c(),M=r.Key,w=(x.getRootId(),hc({api:d,parser:function(e){return nn(e,e,F)}})),R=(0,D.useMemo)((function(){return cn(w)}),[w]),B=(0,D.useMemo)((function(){var e,t=x.getData().Items||[],n=nd((null===(e=pi(t)[0])||void 0===e?void 0:e.children)||[],(function(e){var t=e._Type_,n=e.BillEntityIdEx,r=e.showType,a=e.children;return!(!Vt(t)||null==a||!a.length)||(it(t)?"1"!==r:et(t)?!(null!=e&&e.RefTableId&&"2"===(null==e?void 0:e.ShowType)):!(ut(t)||("NoCodeMulRefBillField"===t||"NoCodeRefBillField"===t)&&void 0===n))}));return ad(n,R,A,f())}),[R,f]),_=(0,D.useCallback)((function(){var e=(null==v?void 0:v.length)||0,t="new_rule_".concat(dn()),n={ruleId:t,name:"规则".concat(e+1),depfldkeys:"",affectfldkeys:"",preCondition:[],trueAction:[]};y(v?b()(v).call(v,n):[n]),I(t)}),[v]),O=function(e){var t=function(e){var t=(null==v?void 0:Kr()(v).call(v,(function(t){return t.ruleId===e})))||0,n=E;if(E===e){var r=t>0?v[t-1]:void 0,a=v[t+1];r?n=r.ruleId:a&&(n=a.ruleId)}return n}(e);I(t),y((function(t){return null==t?void 0:g()(t).call(t,(function(t){return t.ruleId!==e}))})),L(e)},j=((0,D.useCallback)((function(e){y(e),e.length&&I(e[0].ruleId)}),[]),function(e){y((function(t){return null==t?void 0:T()(t).call(t,(function(t){return t.ruleId===E?td(td({},t),e):t}))}))}),L=function(e){var t=o();i(null==t?void 0:g()(t).call(t,(function(t){return t.ruleId!==e}))),a()},K=function(e){var t=o(),n=td(td({},(null==t?void 0:Ae()(t).call(t,(function(e){return e.ruleId===E})))||{}),e),r=cd(n),l=r.affectfldkeys,c=r.depfldkeys;if(null!=E&&S()(E).call(E,"new_rule_")){var u=null==E?void 0:Se()(E).call(E,9);n.ruleId=u,j({ruleId:u,affectfldkeys:l,depfldkeys:c}),I(u)}j({affectfldkeys:l,depfldkeys:c});var d=null!=E&&S()(E).call(E,"new_rule_")?b()(t).call(t,n):T()(t).call(t,(function(e){return e.ruleId===E?n:e}));i(d),a(),qn.WebMsg.showNotificationMsg({param:[{type:0,content:"保存成功。",duration:2e3}]})},U=(0,D.useMemo)((function(){return E?null==v?void 0:Ae()(v).call(v,(function(e){return e.ruleId===E})):{}}),[E,v]);return v?k().createElement("div",{className:"".concat(n,"-main")},v.length?k().createElement(k().Fragment,null,k().createElement("div",{className:"left-area"},k().createElement("div",{className:"rule-list"},null==v?void 0:T()(v).call(v,(function(e){var t=e.name,n=e.ruleId,r=e.depfldkeys,a=e.affectfldkeys;return k().createElement("div",{className:Vn()("rule-item",{"is-active":E===n}),key:n,onClick:function(){return I(n)}},k().createElement("div",{className:"rule-name"},t,k().createElement(P.Icon,{prefix:"ncicon",type:"jingshi",className:Vn()("warning-icon",{show:!1})})),k().createElement("div",{className:"tags"},S()(r).call(r,M)&&k().createElement("span",{className:"tag-item"},"触发"),S()(a).call(a,M)&&k().createElement("span",{className:"tag-item"},"受影响的")),k().createElement("div",{className:"delete-btn",onClick:function(e){return function(e,t,n){e.stopPropagation(),null===qn.WebMsg||void 0===qn.WebMsg||qn.WebMsg.showConfirmModal({title:"确定删除“".concat(t,"”吗？"),type:"delete",onAction:function(e){"ok"===e&&O(n)}})}(e,t,n)}},k().createElement(P.Icon,{prefix:"designericon",type:"shanchu"})))}))),k().createElement("div",{className:"add-rule",onClick:_},k().createElement("span",{className:"add-btn"},k().createElement(P.Icon,{prefix:"designericon",type:"zengjia-yuan"}),"新增规则"))),k().createElement("div",{className:"right-area"},k().createElement(Qu,{key:E,prefixCls:n,value:U,fieldKey:M,ruleId:E,listFilterConfig:w,fieldOptions:B,onChange:j,onSave:K}))):k().createElement(rd,{handleAdd:_})):null})),id=function(e){var t=e.prefixCls,n=e.title,r=e.visible,a=e.setVisible,l=e.field,o=e.refreshEditorDisplay,i=(0,D.useRef)(null),c=function(){a(!1)};return k().createElement(P.Modal,{mask:!0,visible:r,body:k().createElement(od,{ref:i,prefixCls:t,field:l,refreshEditorDisplay:o}),titleIcon:null,className:"".concat(t,"-modal"),footer:null,maskClosable:!1,width:960,height:520,keyboard:!1,title:k().createElement("span",{title:n},n),closable:!0,draggable:!1,destroyOnClose:!0,onCancel:c,onOk:c})},cd=function(e){var t=e.preCondition,n=void 0===t?[]:t,r=e.trueAction,a=void 0===r?[]:r,l=Kl()(n),o=(a||[]).reduce((function(e,t){return b()(e).call(e,t.fieldName||[])}),[]).join(),i=null==l?void 0:l.match(/\${model\.[\w_]+}/g);return{affectfldkeys:o,depfldkeys:(null==i?void 0:T()(i).call(i,(function(e){return e.replace(/\${model\.([\w_]+)}/,"$1")})))||""}},ud=function(e){var t=e.locked,n=e.field,r=n.Name,a=n.Key,l=(0,D.useState)(!1),o=(0,s.c)(l,2),i=o[0],c=o[1],u=(0,D.useContext)(oe),d=(u.invokeAction,u.prefixCls),f=u.getKdesignerApi,p=u.getDisplayRules,m=u.fetchListTree,v=(f().data.getRootId(),p()),g=(0,D.useReducer)((function(e){return e+1}),0),y=(0,s.c)(g,2)[1],C=function(){m(),c(!0)},h=(0,D.useMemo)((function(){var e=v.reduce((function(e,t){var n=cd(t),r=n.affectfldkeys,l=n.depfldkeys;return null!=r&&S()(r).call(r,a)||S()(l).call(l,a)?e+1:e}),0);return 0!==e?"".concat(e,"条规则"):""}),[v,a]),b="".concat(d,"-displayrules");return k().createElement(k().Fragment,null,k().createElement(M.CustomInputTrigger,(0,B.c)({},e,{placeholder:"请选择",disabled:t,value:h,onClick:C,onInputClick:C})),k().createElement(id,{prefixCls:b,visible:i,setVisible:c,field:n,title:"".concat(r,"-显示规则"),refreshEditorDisplay:y}))},dd=function(e){var t=e.value,n=e.className,r=e.field,a=r._Type_,l=r.DefaultLines,o=r.MaxLength,i={className:"".concat(n,"-text-def-editor"),fieldType:"text",placeholder:"请输入",maxLength:o};return function(e){return"NoCodeTextAreaField"===e}(a)&&(i.fieldType="textarea",i.autoSize={minRows:l||1,maxRows:l||1}),k().createElement(Bc,(0,B.c)({},e,{editorType:"textDef",value:t,inputFieldProps:i}))};function sd(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function fd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sd(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):sd(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var pd={},md=(0,D.memo)((function(e){var t,n,r=(0,D.useContext)(oe),a=r.invokeAction,l=r.getKdesignerApi,o=e.handleChange,i=e.value,c=e.className,u=e.editor,d=(e.locked,e.Name),s=e.Tips,f=e.field,p=(e.id,u.Enum,u.NameHidden),m=u.Default,v=u.Required,g=u.HasCheck,y=u.Title,C=l().data.getRootId(),h=i;try{g&&"object"===(0,be.c)(JSON.parse(i))&&(h=JSON.parse(i))}catch(e){g&&(h={})}var b=void 0===(null===(t=h)||void 0===t?void 0:t.enable)?null==m?void 0:m.enable:h.enable,E=(0,D.useCallback)((function(e){return Array.isArray(e)&&(null==e?void 0:T()(e).call(e,(function(e){return fd(fd({},e),{},{label:e.name,value:e.id})})))||[]}),[]),I=Cc({id:f.Key,formId:C,eventName:"setTriggerProcess",parser:E});null!=I&&I.length&&(pd[C]=I),(0,D.useEffect)((function(){pd[C]||a("getTriggerProcess",[])}),[C]);var N=(0,D.useCallback)((function(e){if(g){var t=fd(fd({},h),{},{value:e});o(Kl()(t))}else o(e)}),[o,h,g]),x=(0,D.useMemo)((function(){return{name:d,className:c,nameHidden:p,tips:s,required:v,title:y}}),[d,c,p,s,v,y]),A=(0,D.useMemo)((function(){return fd(fd({},e),{},{editor:fd(fd({},e.Editor),{},{NameHidden:!0})})}),[e]);return k().createElement("div",{className:"".concat(c,"-trigger-process")},g?k().createElement(M.NameTipSwitchWrapper,(0,B.c)({switchValue:b,onSwitchChange:function(e){var t=fd(fd({},h),{},{enable:e});o(Kl()(t))}},x)):k().createElement(M.NameTipWrapper,x),(!g||b)&&k().createElement(M.EditorPropertySelect,(0,B.c)({},A,{value:g?null===(n=h)||void 0===n?void 0:n.value:i,options:Array.isArray(pd[C])?pd[C]:[],scrollHidden:!1,onChange:N,handleChange:N})))}));md.displayName="TriggerProcessEditor";var vd=(0,M.ErrorBoundaryWrap)(md,"TriggerProcessEditor");function gd(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function yd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gd(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):gd(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Cd=qn.treeUtils.getListConfigPure,hd=qn.treeUtils.treeNodeTransform,bd=qn.treeUtils.dfs,Ed=qn.ListFilterUtil.getVarSelectDisabled,Id=(0,D.forwardRef)((function(e,t){var n,r,a=e.prefixCls,l=e.field,o=e.formId,i=e.value,c=e.onChange,u=(0,D.useContext)(oe),d=u.invokeAction,p=u.baseUrl,m=u.onDownLoad,v=(u.getBaseHooks,u.getKdesignerApi),y=u.getCompareTypes,C=u.getControlText,h=u.batchInvoke,E=u.curListTreeApi,I=u.getHideFieldRef,N=v(),x=N.data,A=N.meta,F=I(),w=l.Key,R=l._Type_,B=l.ParentId,_=null===(n=F[l.RefBillId])||void 0===n?void 0:n.Key,O=x.findControl(B),j=O.RefBillId,L=O._Type_,K=null===(r=F[j])||void 0===r?void 0:r.Key,U=(x.getRootId(),(0,D.useState)({})),V=(0,s.c)(U,2),G=V[0],z=V[1],H=(0,D.useRef)(null),q=(0,D.useRef)(null),Y=(0,D.useRef)([]),W=y();(0,D.useImperativeHandle)(t,(function(){return{updateVerifyAndGetMsg:function(){return q.current.updateVerifyAndGetMsg()}}}),[]);var X=Cc({id:w,formId:o,eventName:"filterItemLook"}),Q=(0,D.useMemo)((function(){return Array.isArray(i)?T()(i).call(i,(function(e){return yd(yd({},e),{},{value:"string"==typeof e.value?JSON.parse(e.value):e.value||[]})})):[]}),[i]),Z=(0,D.useCallback)((function(e){d("getFilterItemLook",[e,{getEnumData:"true",enumField:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",filterrows:[]}])}),[d]),J=(0,D.useCallback)((function(e){Z(o,e.fieldName)}),[Z]),$=hc({api:E,parser:function(e){return nn(e,e,W)}}),ee=hc({api:E,parser:function(e){var t,n,r=nn(e,e,W,4),a=_||w,l=it(L)?Se()(t=b()(n="".concat(K,".")).call(n,w)).call(t,0,-4):a,o=bd(r,(function(e){return e.key===l}));return hd((null==o?void 0:o.children)||[],(function(e){var t=e.key,n=l.replace(/\./g,"\\."),r=t.replace(new RegExp("^"+n+"\\.(\\S+)"),"$1");return!((null!=r&&S()(r).call(r,"fbasedataid")?r.split(".fbasedataid")[0]:r).split(".").length>2)&&yd(yd({},e),{},{key:r})}))}}),te=(0,D.useMemo)((function(){return ut(R)?$:ee}),[R,$,ee]),ne=(0,D.useMemo)((function(){return di({metaApi:A,options:$})}),[$]),re=(0,D.useMemo)((function(){return Cd(te)}),[te]);(0,D.useEffect)((function(){var e=X.data,t=X.param,n=(void 0===t?{}:t).enumField;if(n){var r=null==Q?void 0:g()(Q).call(Q,(function(e){return e.fieldName===n})),a=bd(te,(function(e){return e.key===n}));z((function(t){return yd(yd({},t),{},(0,f.c)({},n,{configuredFilter:{enumEqCompareType:"001",items:r},fieldFilterConfig:a,groupInfo:e}))}))}}),[X,Q,te]);var ae=(0,D.useCallback)((function(e){Y.current.length<e.length&&e.length>7&&setTimeout((function(){return H.current.scrollTo(0,1e4)}),100),Y.current=e}),[]),le={baseUrl:p,batchInvoke:function(e,t){h(e,w,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[])},getControlText:C,addControlAction:function(e,t){return M.eventBus.on(e,t),function(){M.eventBus.off(e,t)}},onDownLoad:m,batchInvokeListConfig:function(e){h("listconfig","nocodeformdesigner",[e])},batchInvokeQuery:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=bd(te,(function(t){return t.entityId===e}));if(null==n||!n.isDraftField){var r=g()(t),a=void 0===r?"":r,l=t.search,o=void 0===l?"":l,i=t.order_by,c=void 0===i?"":i,u=t.select,d=void 0===u?"":u,s=t.page_size,f=void 0===s?10:s,p=t.page_no,m=void 0===p?1:p,v=t.ids;h("query","nocodeformdesigner",[e,{filter:a,search:o,order_by:c,select:d,page_size:f,page_no:m,ids:void 0===v?[]:v}])}}};return k().createElement("div",{className:"".concat(a,"-modal-body"),ref:H},k().createElement(P.ConfigProvider,{value:{prefixCls:"kd"}},k().createElement(qn.FilterEditor,{ref:q,valueRequired:!0,nameHidden:!0,id:"filter",name:"配置筛选条件",tips:"",style:{marginTop:"0px"},fieldData:{fieldType:"treeSelect",style:{width:"184px"}},filterFooterData:{listType:"tree",triggerText:"添加筛选条件",treeProps:{defaultExpandAll:!1}},variablesTree:ne||[],listFilterConfig:re||[],fieldRecords:G||[],value:Q,refBillProps:le,onChange:function(e){var t=e;Array.isArray(e)&&(t=T()(e).call(e,(function(e){return yd(yd({},e),{},{value:"object"===(0,be.c)(e.value)?Kl()(e.value):e.value||""})}))),c(t),ae(e)},onGetFieldRecords:J,getVarSelectDisabled:Ed})))})),Nd=function(e){var t=e.prefixCls,n=e.onCancel,r=e.onConfirm;return k().createElement("div",{className:"".concat(t,"-modal-footer")},k().createElement("div",{className:"".concat(t,"-modal-footer-right")},k().createElement(P.Button,{size:"small",className:"".concat(t,"-modal-footer-btn"),onClick:n},"取消"),k().createElement(P.Button,{size:"small",type:"primary",className:"".concat(t,"-modal-footer-btn"),onClick:r},"确定")))},Td=(0,D.memo)((function(e){var t=e.prefixCls,n=e.title,r=e.value,a=e.formId,l=e.field,o=(e.fieldData,e.visible),i=e.setVisible,c=e.onChange,u=(0,D.useState)(r),d=(0,s.c)(u,2),f=d[0],p=d[1],m=(0,D.useRef)();(0,D.useEffect)((function(){p(r)}),[r]);var v=function(){i(!1),p(r)};return k().createElement(P.Modal,{mask:!0,visible:o,body:k().createElement(Id,{ref:m,prefixCls:t,field:l,formId:a,value:f,onChange:function(e){p(e)}}),titleIcon:null,className:"".concat(t,"-modal"),footer:k().createElement(Nd,{prefixCls:t,onCancel:v,onConfirm:function(){var e,t,n=null===(e=(t=m.current).updateVerifyAndGetMsg)||void 0===e?void 0:e.call(t);null!=n&&n.length||(null==c||c(f),v())}}),maskClosable:!1,width:640,height:520,keyboard:!1,bodyStyle:{padding:0,overflow:"hidden"},title:n,closable:!0,draggable:!1,destroyOnClose:!0,onCancel:v,onOk:v})}));Td.displayName="LimitSelectRangeModal";var xd=Td;function Ad(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ad(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Ad(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Sd=(0,D.memo)((function(e){var t,n=e.handleChange,r=e.value,a=e.className,l=e.editor,o=e.locked,i=e.Name,c=e.Tips,u=e.field,d=l.NameHidden,f=l.Required,p=l.Default,m=l.Title,v=p.showEnable,g=u._Type_,y=(0,D.useState)(!1),C=(0,s.c)(y,2),h=C[0],b=C[1],E=void 0===r.enable?p.enable:r.enable,I=(0,D.useContext)(oe),N=I.prefixCls,T=I.getKdesignerApi,x=I.fetchListTree,A=T(),F=A.data,S=A.meta,w=(0,D.useMemo)((function(){return et(g)||it(g)?u.BillEntityIdEx||S.getControlPropertyDefaultValue(u.FieldType,"BillEntityIdEx"):F.getRootId()}),[g,F,null==u?void 0:u.BillEntityIdEx]),P=(0,D.useCallback)((function(e){n({enable:E,value:e})}),[n,E]),R="".concat(N,"-enablefilter-editor"),_=Fd(Fd({},l),{},{NameHidden:!0}),O=(0,D.useMemo)((function(){return{name:i,className:a,nameHidden:d,tips:c,required:f,title:m}}),[i,a,d,c,f,m]);return k().createElement("div",{className:R},v?k().createElement(M.NameTipSwitchWrapper,(0,B.c)({switchValue:E,onSwitchChange:function(e){var t=Fd(Fd({},r),{},{enable:e});n(t)}},O)):k().createElement("div",{className:"".concat(a,"-nav")},k().createElement(M.NameTipWrapper,O)),E&&k().createElement(k().Fragment,null,k().createElement(M.CustomInputTrigger,(0,B.c)({},e,{editor:_,disabled:o,value:(null==r||null===(t=r.value)||void 0===t?void 0:t.length)>0?"".concat(r.value.length,"个条件"):"",onClick:function(){b(!0),x()}})),k().createElement(xd,{formId:w,field:u,prefixCls:R,visible:h,setVisible:b,value:(null==r?void 0:r.value)||[],title:i,onChange:P})))}));Sd.displayName="EnableFilterEditor";var Dd=(0,M.ErrorBoundaryWrap)(Sd,"EnableFilterEditor"),kd=window.__kd_cdnPath__||window.__domainurl__,Md=Ht(window.__domainurl__+"nocode/v2/nocode_sys/image"),wd=(0,D.memo)((function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.editor,l=e.Name,o=e.Tips,i=e.field,c=a.NameHidden,u=a.Required,d=a.Title,f=i.FieldType,p=(0,D.useContext)(oe).baseUrl,m=void 0===p?{}:p,v=(0,D.useRef)(""),g=(0,D.useState)(!1),y=(0,s.c)(g,2),C=y[0],h=y[1],b="".concat(r,"-richtext-def-editor"),E=(0,D.useMemo)((function(){return st(f)}),[f]),I=E&&Xt(n)?Qt(n):n,N=(0,D.useCallback)((function(e){v.current=e}),[]);(0,D.useEffect)((function(){v.current=I}),[I]);var T=function(){h(!1)},x=(0,D.useMemo)((function(){return k().createElement("div",null,k().createElement(qn.RichText,{width:780,toobarMode:"scrolling",content:I,srcUrl:kd,imageUrlPrefix:window.origin,imagesUploadUrl:Md,pictureServer:m.picture,onChange:N,resize:!1,hasFullScreen:!1}))}),[I,m.picture,N]);return k().createElement("div",{className:b},k().createElement("div",{className:"".concat(b,"-name-tip")},k().createElement(M.NameTipWrapper,{nameHidden:c,className:r,name:l,tips:o,required:u,title:d})),k().createElement(qn.BtnField,{className:"".concat(b,"-edit-btn"),type:"primary",text:"编辑默认值",onClick:function(){h(!0)}}),C&&k().createElement(P.Modal,{width:780,height:482,className:"".concat(b,"-modal"),visible:C,title:"".concat(E?"富文本":"图文展示","-默认值"),body:x,onCancel:T,footer:k().createElement("div",{className:"".concat(b,"-footer")},k().createElement(qn.BtnField,{size:"small",style:{marginRight:"12px"},onClick:T},"取消"),k().createElement(qn.BtnField,{size:"small",type:"primary",onClick:function(){var e=v.current,n=Kl()({value:e,valueType:0});e!==n&&t(E?n:e),h(!1)}},"确定"))}))}));function Pd(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pd(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Pd(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Bd=qn.treeUtils.dfs,_d=k().memo((function(e){e.handleChange;var t=e.value,n=e.className,r=e.editor,a=(e.locked,e.Name),l=e.Tips,o=e.field,i=e.id,c=e.propName,u=r.NameHidden,d=r.Required,p=r.Title,m=o||{},v=(m.DataFill,m.Name),y=m.SelectBillPid,C=m.RefTableId,h=m.RefBillId,b=m.ShowType,E=m.SourceForm,I=m.inner2Outer,N=m.Key,x=(0,D.useContext)(oe),A=x.invokeAction,F=x.getKdesignerApi,S=(x.prefixCls,x.billPropsData),w=x.dispatchBillData,B=F(),_=B.data,O=B.controlCacheApi,j="".concat(n,"-bill-type"),L=(0,D.useState)((0,R.c)((null==S?void 0:S.appFormList)||[])),K=(0,s.c)(L,2),U=K[0],V=K[1],G=(0,D.useRef)(null),z=(0,D.useRef)(null),H=(0,D.useRef)(O.hasCache("controlId",i)),q=(0,D.useState)(!0),Y=(0,s.c)(q,2),W=Y[0],X=Y[1],Q=(0,D.useCallback)((function(e){var t=e.children,n=void 0===t?[]:t;n[0].icon=k().createElement(P.Icon,{prefix:"nocodeplatformicon",type:"gerenzhongxin",style:{color:"#3987ED"}}),n[1].icon=k().createElement(P.Icon,{prefix:"nocodeplatformicon",type:"zuzhi",style:{color:"#3987ED"}});var r=Aa(n),a=(0,s.c)(r,2),l=a[0],o=a[1];w({key:qr,payload:{data:l,innerForm:o}}),V(l)}),[]),Z=(0,D.useCallback)((function(){var e={showTree:"true",ignoreCosmicForm:"true"};Array.isArray(y)&&(e.parentId=y[y.length-1]),"2"===E&&A("click",[i,"entitymeta",c,e])}),[E]),J=(0,D.useCallback)((function(e){var t=e[o.Key]||[];0===t.length||"1"===E?X(!0):(null==t?void 0:t.length)>0&&X(!1)}),[]);(0,D.useEffect)((function(){return"1"!==E&&Z(),H.current&&"1"!==E&&X(!1),H.current||M.eventBus.on(vr,J),M.eventBus.on(dr,Q),M.eventBus.on(sr,$),function(){H.current||M.eventBus.off(vr,J),M.eventBus.off(dr,Q),M.eventBus.off(sr,$)}}),[]),(0,D.useEffect)((function(){var e,n=t&&(null===(e=Bd(U,(function(e){return e.key===t})))||void 0===e?void 0:e.title)||"关联表单";M.eventBus.emit("".concat(N,"_refbill"),{formName:n})}),[t,U]);var $=function(e){var t;V((function(t){return ee(t,z.current,Aa(e,{isAsyncNode:!0})[0])})),null===(t=G.current)||void 0===t||t.call(G),G.current=null},ee=function e(t,n,r){return T()(t).call(t,(function(t){return t.key===n?null!=r&&r.length?Rd(Rd({},t),{},{children:r,isLeaf:!0}):Rd(Rd({},t),{},{isLeaf:!0}):t.children?Rd(Rd({},t),{},{children:e(t.children,n,r)}):t}))},te=(0,D.useCallback)((function(e,t){var n=Rd((0,f.c)((0,f.c)({},c,e),"PropsDisplay",""),t),r=[[i,n]];if("2"===b){var a,l=g()(a=_.getAllSubControlIds(i)).call(a,(function(e){return e!==i}));_.deleteControl((0,M.createDeleteAction)(l))}_.batchUpdateControlPropertyValues((0,M.createUpdateAction)(r))}),[c,C,h,i,b]),ne=(0,D.useCallback)((function(){var e=[[i,{inner2Outer:!0}]];_.batchUpdateControlPropertyValues((0,M.createUpdateAction)(e))}),[i,t,v]);return(0,D.useEffect)((function(){I&&V([{key:t,title:v,isLeaf:!0}])}),[v,I]),(0,D.useEffect)((function(){"1"===E&&V([{key:t||"",title:I?v:"内部表单",isLeaf:!0}])}),[]),k().createElement("div",{className:j},k().createElement(M.NameTipWrapper,{nameHidden:u,className:n,name:a,tips:l,required:d,title:p}),"1"===E&&!I&&k().createElement("div",{className:"".concat(j,"-title-btn")},k().createElement(qn.BtnField,{type:"text",major:!0,onClick:ne},"转化为外部表单")),k().createElement("div",{className:"".concat(j,"-tree-select")},k().createElement(P.ConfigProvider,{value:{prefixCls:"kd"}},k().createElement(qn.KDTreeSelect,{allowClear:!0,value:t,treeData:U,showTreeIcon:!0,disabled:W,treeIcon:function(e){return e.icon},onChange:function(e,n){if(e!==t){var r,a={};if((t?null===(r=Bd(U,(function(e){return e.key===t})))||void 0===r?void 0:r.title:"关联表单")===v)if(e){var l=n[0]||{},o=l.title,i=void 0===o?"":o,c=l.parentKeys,u=l.isAsyncNode;a.Name=i,a.SelectBillPid=u?c:void 0}else e||(a.Name="关联表单",a.SelectBillPid=void 0);else{var d=n[0]||{},s=d.title,f=d.parentKeys,p=d.isAsyncNode;a.Name=s,a.SelectBillPid=p?f:void 0}te(e,a)}},treeLoadData:function(e){var t=e.key,n=e.children,r=e.isLeaf;return new(jr())((function(e){n||r?e():(G.current=e,z.current=t,A("queryTreeNodeChildren",[t]))}))},treeDefaultExpandedKeys:y,dropdownStyle:{width:"320px"}}))))})),Od=[{label:"大 (24px)",value:"24"},{label:"中 (16px)",value:"16"},{label:"小 (8px)",value:"8"},{label:"无 (0px)",value:"0"}],jd=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.editor,l=e.locked,o=e.Name,i=e.Tips,c=(e.field,e.id,e.propName,Jt(n)),u=c.margin,d=void 0===u?"0":u,f=c.marginTop,p=c.marginRight,m=c.marginBottom,v=c.marginLeft,g=(0,D.useState)(d),y=(0,s.c)(g,2),C=y[0],h=y[1],b=(0,D.useState)(f||0),E=(0,s.c)(b,2),I=E[0],N=E[1],T=(0,D.useState)(p||0),x=(0,s.c)(T,2),A=x[0],F=x[1],S=(0,D.useState)(m||0),w=(0,s.c)(S,2),P=w[0],R=w[1],B=(0,D.useState)(v||0),_=(0,s.c)(B,2),O=_[0],j=_[1],L="".concat(r,"-margin");(0,D.useEffect)((function(){var e=-1===C?{marginTop:I,marginRight:A,marginBottom:P,marginLeft:O}:{margin:C};t(Kl()(e))}),[C,I,A,P,O]);var K=(0,D.useCallback)((function(e){h(e)}),[]),U=(0,D.useCallback)((function(e){N(e)}),[]),V=(0,D.useCallback)((function(e){F(e)}),[]),G=(0,D.useCallback)((function(e){R(e)}),[]),z=(0,D.useCallback)((function(e){j(e)}),[]);return k().createElement("div",{className:L},k().createElement("div",{className:Vn()("".concat(L,"-item"),"".concat(L,"-select"))},k().createElement(M.EditorPropertySelect,{options:Od,editor:a,value:C,handleChange:K,className:L,Name:o,locked:l,tips:i})),"-1"===C&&k().createElement(k().Fragment,null,k().createElement("div",{className:"".concat(L,"-item")},k().createElement(M.NameTipWrapper,{className:r,name:"上间距"}),k().createElement(qn.Number,{value:I,onChange:U,showStepper:!1,placeholder:"请输入"})),k().createElement("div",{className:"".concat(L,"-item")},k().createElement(M.NameTipWrapper,{className:r,name:"下间距"}),k().createElement(qn.Number,{value:P,onChange:G,showStepper:!1,placeholder:"请输入"})),k().createElement("div",{className:"".concat(L,"-item")},k().createElement(M.NameTipWrapper,{className:r,name:"左间距"}),k().createElement(qn.Number,{value:O,onChange:z,showStepper:!1,placeholder:"请输入"})),k().createElement("div",{className:"".concat(L,"-item")},k().createElement(M.NameTipWrapper,{className:r,name:"右间距"}),k().createElement(qn.Number,{value:A,onChange:V,showStepper:!1,placeholder:"请输入"}))))};function Ld(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Kd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ld(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Ld(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Ud=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t?T()(t).call(t,(function(t){var r=t.label,a=t.value,l=t.children,o=t.selectable,i=t.icon,c=Kd({key:a,title:r},n);return(0,De.isUndefined)(o)||(c.selectable=o),i&&(c.icon=i),l?(l.length&&(c.children=e(l)),c.checkable=!1):c.isLeaf=!0,c})):t},Vd=k().memo((function(e){e.handleChange;var t=e.value,n=e.className,r=e.editor,a=(e.locked,e.Name),l=e.Tips,o=e.field,i=e.id,c=e.propName,u=r.NameHidden,d=r.Required,p=r.needPathValue,m=r.Title,v=(o.DataFill,o.Name,o.SelectBillPid),g=(0,D.useContext)(oe),y=g.invokeAction,C=g.getKdesignerApi,h=g.prefixCls,b=g.getDataRef,E=C().data,I="".concat(h,"-bill-type"),N=(0,D.useState)([]),x=(0,s.c)(N,2),A=x[0],F=x[1],S=(0,D.useRef)(null),w=(0,D.useRef)(null),R=(0,D.useCallback)((function(e){var t=null;t=Array.isArray(e)?e:[e],F(Ud(t))}),[p]),B=(0,D.useCallback)((function(){var e={showTree:"true"},t={nocodeformdesigner:b()};Array.isArray(v)&&(e.parentId=v[v.length-1]),y("click",[i,"entitymeta",c,e],[t])}),[]);(0,D.useEffect)((function(){B()}),[]),(0,D.useEffect)((function(){return M.eventBus.on(fr,R),M.eventBus.on(sr,_),function(){M.eventBus.off(fr,R),M.eventBus.off(sr,_)}}),[]);var _=function(e){var t;F((function(t){return O(t,w.current,Ud(e,{isAsyncNode:!0}))})),null===(t=S.current)||void 0===t||t.call(S),S.current=null},O=function e(t,n,r){return T()(t).call(t,(function(t){return t.key===n?null!=r&&r.length?Kd(Kd({},t),{},{children:r,isLeaf:!0}):Kd(Kd({},t),{},{isLeaf:!0}):t.children?Kd(Kd({},t),{},{children:e(t.children,n,r)}):t}))};return k().createElement(k().Fragment,null,k().createElement(M.NameTipWrapper,{nameHidden:u,className:n,name:a,tips:l,required:d,title:m}),k().createElement("div",{className:"".concat(I,"-tree-select")},k().createElement(P.ConfigProvider,{value:{prefixCls:"kd"}},k().createElement(qn.KDTreeSelect,{allowClear:!0,value:t,treeData:A,showTreeIcon:!0,treeIcon:function(e){return e.icon},onChange:function(e,n){e!==t&&E.batchUpdateControlPropertyValues((0,M.createUpdateAction)([[i,(0,f.c)({},c,e)]]))},treeLoadData:function(e){var t=e.key,n=e.children,r=e.isLeaf;return new(jr())((function(e){n||r?e():(S.current=e,w.current=t,y("queryTreeNodeChildren",[t]))}))},treeDefaultExpandedKeys:v}))))}));Vd.displayName="InputFormEditor";var Gd=Vd;function zd(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Hd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zd(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):zd(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var qd=function(e){var t=e.value,n=(e.className,e.handleChange),r=e.field,a=(e.rootId,(0,D.useContext)(oe)),l=a.baseUrl,o=a.onDownLoad,i=a.prefixCls,c=a.getControlText,u=a.batchInvoke,d=a.getBaseHooks,s=a.getKdesignerApi,f=r.SelectScope,p=f?{rawFilter:f.value}:{},m=s().meta,v=d("useKDRefBill"),y=r.BillEntityIdEx||m.getControlPropertyDefaultValue(r.FieldType,"BillEntityIdEx"),C=function(e,t){try{if(e&&"string"==typeof e){var n=JSON.parse(e);return n.valueType===t?n.value:""}}catch(e){}}(t,0),h=function(e,t){var n=g()(t),r=void 0===n?"":n,a=t.search,l=void 0===a?"":a,o=t.order_by,i=void 0===o?"":o,c=t.page_size,d=void 0===c?10:c,s=t.page_no,f=void 0===s?1:s,m=t.ids;e&&u("query","nocodeformdesigner",[e,Hd({filter:r,search:l,order_by:i,select:"",page_size:d,page_no:f,ids:void 0===m?[]:m},p)])},b=1===parseInt(r.Multi),E={controlMeta:en(r,m),onChange:function(e){var t;"string"==typeof e?t=e:Array.isArray(e)&&(t=e.join(",")),n(Kl()({valueType:0,value:t}))},baseUrl:l,batchInvoke:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];u(e,r.Key,t,n)},getControlText:c,addControlAction:function(e,t){M.eventBus.on(e,t)},onDownLoad:o,batchInvokeListConfig:function(){y&&u("listconfig","nocodeformdesigner",[y])},batchInvokeQuery:h,value:C},I=v(E,!0),N=I.searchKeywords;(0,D.useEffect)((function(){h(y,{page_size:10,page_no:1,search:N,select:r.PropsDisplay,ids:C?C.split(","):[]})}),[t,r.PropsDisplay,y]);var T=Hd(Hd({className:"".concat(i,"-refbill-def-editor-input"),fieldType:"refbill"},I),{},{value:b?C?C.split(","):[]:C||"",placeholder:"请选择",showSelected:!1});return k().createElement(Bc,(0,B.c)({},e,{editorType:"refBillDef",inputFieldProps:T}))},Yd=function(e){var t,n=e.handleChange,r=e.value,a=e.className,l=e.editor,o=e.Name,i=e.Tips,c=e.renderItem,u=e.field,d=e.id,f=l.Enum,p=l.NameHidden,m=l.Default,v=l.Required,g=l.Title,y=(0,(0,D.useContext)(oe).getKdesignerApi)().controlCacheApi,C=T()(f).call(f,(function(e){return(0,B.c)({},e,{Value:e.Value||e.Id})})),h=(0,De.isUndefined)(r)?m||(null===(t=C[0])||void 0===t?void 0:t.Value):String(r),b=y.hasCache("controlId",d),E=(0,D.useState)(!("Multi"!==e.Id||b)),I=(0,s.c)(E,2),N=I[0],x=I[1],A=(0,D.useCallback)((function(e){var t=e[u.Key]||[];0!==t.length?(null==t?void 0:t.length)>0&&x(!1):x(!0)}),[]);(0,D.useEffect)((function(){if("Multi"===e.Id&&!b)return M.eventBus.on(vr,A),function(){M.eventBus.off(vr,A)}}),[]);return k().createElement(k().Fragment,null,k().createElement(M.NameTipWrapper,{nameHidden:p,className:a,name:o,tips:i,required:v,title:g}),k().createElement("div",{className:"".concat(a,"-tab-editor")},T()(C).call(C,(function(e){var t=e.IconClassName,r=e.IconTitle;return k().createElement("div",{key:e.Value,disabled:N,className:Vn()(["".concat(a,"-tab-editor-item"),{"is-active":h===e.Value,"is-disabled":!0===N}]),onClick:function(){return t=e.Value,void(N||n(t));var t},title:t&&r},c?c(e):t?k().createElement("i",{className:t}):e.Name)}))))},Wd=r(6076),Xd=r.n(Wd),Qd=["compareTypes","compareType","compareTypeCaption","fieldName","fieldCaption","items","value"];function Zd(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Jd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zd(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Zd(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var $d=qn.Condition.constants,es=$d.allFieldRegExp,ts=$d.allExpRegExp,ns=qn.treeUtils.exludeTreeNodeByCallback,rs=qn.treeUtils.transformTreeToListConfig,as=[{id:"edit",name:{zh_CN:"编辑"}},{id:"mustinput",name:{zh_CN:"必填"}},{id:"readonly",name:{zh_CN:"只读"}},{id:"disabled",name:{zh_CN:"禁用"}}],ls=function e(t,n,r,a){return t.reduce((function(t,l){var o,i=l._Type_,c=l.Key,u=l.Name,d=l.FormatType,s=l.SelectItemType,f=l.Multi,p=l.children;if(nt(i)||st(i)||ft(i))return t;var m=et(i)||it(i)?"NoCodeMulRefBillField":i,v=null==m?void 0:m.toLowerCase();if(Je(i)){var y=[{title:"".concat(u,".开始"),titlePrefix:"[日期]",key:"".concat(c,"_startdate"),formatType:d,type:"nocodedatefield",compareTypes:as,checkable:!0,selectable:!1},{title:"".concat(u,".结束"),titlePrefix:"[日期]",key:"".concat(c,"_enddate"),formatType:d,type:"nocodedatefield",compareTypes:as,checkable:!0,selectable:!1}];return b()(t).call(t,y)}var C={};if(et(i)||tt(i)||it(i))C=en(l,r);else if(at(i)){var h,E=r.getControlMetaEditor(i,"ImageFileType").Enum,I=r.getControlPropertyDefaultValue(i,"FileMaxSize"),N=r.getControlPropertyDefaultValue(i,"ImageFileType"),x=(null==l?void 0:l.ImageFileType)||N,A=T()(h=x.split(",")).call(h,(function(e){return g()(E).call(E,(function(t){return t.Id===e}))[0].Name}));C={UploadNum:(null==l?void 0:l.UploadNum)||{max:9,min:0},FileMaxSize:l.FileMaxSize||I,typeArr:A}}else if(lt(i)){var F=r.getControlPropertyDefaultValue(i,"AttachmentFileType"),S=r.getControlPropertyDefaultValue(i,"FileMaxSize"),D=(null==l?void 0:l.AttachmentFileType)||F;C={UploadNum:(null==l?void 0:l.UploadNum)||{max:9,min:0},maxSize:l.FileMaxSize||S,fileType:D}}var k=l.CustomContent?null===(o=l.CustomContent.ops)||void 0===o?void 0:T()(o).call(o,(function(e){return{name:{zh_CN:e.Label},value:e.Value,bgc:e.Bgc}})):void 0,M=Jd({title:u,titlePrefix:on(l,n,r,a),key:c,type:v,isMulti:Pt(s)||Pt(f),items:k,formatType:d,compareTypes:as,checkable:!0,selectable:!1},C);return Vt(i)&&p&&(p&&(M.children=e(p,n,r,a)),M.checkable=!1),b()(t).call(t,M)}),[])},os=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(t||[]).reduce((function(t,a){var l,o=a.caption,i=a.type,c=a.id,u=a.option,d=void 0===u?{}:u,s=a.typeCaption,f=(d.sourceForm,(null==c||null===(l=c.split("."))||void 0===l?void 0:l.length)||0);if("group"!==i&&f>r)return t;if(nt(i)||st(i)||ft(i))return t;var p=null==i?void 0:i.toLowerCase();"nocodedaterangefield"===p?p="nocodedatefield":(et(i)||tt(i)||it(i))&&(p="nocodemulrefbillfield");var m,v=d.children,y=d.valueItems,C=d.billEntityId,h=d.displayProp,E=d.isMulti,I=d.formatType,N={title:o,titlePrefix:s,key:c,compareTypes:as,type:p,formatType:I,selectable:!1,checkable:!0};if(et(i)||tt(i)||it(i)){if(!C)return t;N=(0,B.c)(N,{displayProp:h,entityId:C,isMulti:E})}else if(dt(i))N=(0,B.c)(N,{isMulti:E});else if(at(i)){var x,A=d.ImageFileType,F=d.FileMaxSize,S=d.UploadNum,D=n.getControlMetaEditor(i,"ImageFileType").Enum,k=n.getControlPropertyDefaultValue(i,"FileMaxSize"),M=n.getControlPropertyDefaultValue(i,"ImageFileType"),w=n.getControlPropertyDefaultValue(i,"UploadNum"),P=A||M,R=T()(x=P.split(",")).call(x,(function(e){return g()(D).call(D,(function(t){return t.Id===e}))[0].Name}));N=(0,B.c)(N,{UploadNum:S||w,FileMaxSize:F||k,typeArr:R})}else if(lt(i)){var _=d.AttachmentFileType,O=d.FileMaxSize,j=d.UploadNum,L=n.getControlPropertyDefaultValue(i,"AttachmentFileType"),K=n.getControlPropertyDefaultValue(i,"FileMaxSize"),U=_||L,V=n.getControlPropertyDefaultValue(i,"UploadNum");N=(0,B.c)(N,{UploadNum:j||V,maxSize:O||K,fileType:U})}if((y&&(N.items=y),v&&(N.children=e(v,n,r)),"group"===i)&&(N.checkable=!1,null===(m=N)||void 0===m||null===(m=m.children)||void 0===m||!m.length))return t;return b()(t).call(t,N)}),[])},is=(0,D.memo)((function(e){var t=e.item,n=e.index,r=e.filterOptions,a=e.fieldTree,l=e.prefixCls,o=e.handleCompareTypeChange,i=e.refBillProps,c=e.fieldRecords,u=e.handleValChange,d=e.handleVarSelect,f=e.handleDelete,p=e.verifyData,v=e.formId,y=t.compareTypes,C=t.compareType,h=(t.compareTypeCaption,t.fieldName),E=(t.fieldCaption,t.items),I=t.value,N=(0,he.c)(t,Qd),T=qn.ListFilterUtil.getCompareTypeOptions,x=qn.ListFilterUtil.getVarSelectedKeysInfo,F=qn.ListFilterUtil.getValueTypeByType,M=qn.ListFilterUtil.getNewValue,w=qn.ListFilterUtil.transform2Options,R=qn.ListFilterUtil.VALUE_EMPTY_COMPARE_TYPE,B=(0,D.useContext)(oe),_=B.getBaseHooks,O=B.invokeAction,j=B.getKdesignerApi,L=B.getExpressionData,K=B.getRefBillData,U=B.getCompareTypes,V=B.batchInvoke,G=B.baseUrl,z=j().data,H=_("useKDRefBill"),q=(0,D.useState)(!1),Y=(0,s.c)(q,2),W=Y[0],X=Y[1],Q=N||{},Z=Q.entityId,J=Q.formatType,$=Q.type,ee=Q.displayProp,te=F(N),ne="refbill"===te?i?te:"text":"select"===te&&!0===t.isMulti?"multiSelect":te,re=M(ne,I,null==c?void 0:c[h]),ae=(0,D.useState)(!1),le=(0,s.c)(ae,2),ie=le[0],ce=le[1],ue=(0,D.useState)(!1),de=(0,s.c)(ue,2),se=de[0],fe=de[1],pe=(0,D.useState)(!1),me=(0,s.c)(pe,2),ve=me[0],ge=me[1],ye=U(),Ce=z.getRootId(),Ee={name:"field",value:h,options:r,fieldType:"treeSelect",disabled:!0,borderType:"bordered",className:"".concat(l,"-modal-body-fielddata")},Ie={name:"compareType",value:C,options:T(y)||[],className:"".concat(l,"-modal-body-infoType"),fieldType:"select",onChange:function(e){return o(e,n,ne)},borderType:"bordered"},Ne=x(I),Te=(0,D.useMemo)((function(){return L()}),[L]),xe={valueType:0,fieldValue:""};(0,D.useEffect)((function(){!function(e,t){var n=g()(t),r=void 0===n?"":n,a=t.search,l=void 0===a?"":a,o=t.order_by,i=void 0===o?"":o,c=t.select,u=void 0===c?"":c,d=t.page_size,s=void 0===d?10:d,f=t.page_no,p=void 0===f?1:f,m=t.ids;"refbill"===te&&e&&V("query","nocodeformdesigner",[e,{filter:r,search:l,order_by:i,select:u,page_size:s,page_no:p,ids:void 0===m?[]:m}])}(Z,{page_size:10,page_no:1,search:"",select:ee,ids:re||[]})}),[I,Z]);var Ae,Fe,Se=[{label:"查找表单记录",key:"search",id:1,icon:"chazhaobiaodanjilu-xian"},{label:"运算公式",key:"formula",id:2,icon:"yunsuangongshi"}],De={valueType:2,value:{relationFormId:"",filterInfos:[],sortInfos:[],result:[]}},ke=(Ae={nocodetextfield:[0,1,2],nocodetextareafield:[0,1,2],nocodedecimalfield:[0,1,2],nocoderichtextfield:[0,1],nocodegeofield:[0,1],nocodeaddressfield:[0,1],nocodeselectitemfield:[0,1,2],nocodemulrefbillfield:[0,1,2],nocodedaterangefield:[0,1],nocodedatefield:[0,1,2],nocodeimageuploadfield:[0,1],nocodeattachmentuploadfield:[0,1],nocodegroupcontainerfield:[],nocodeentryentityfield:[],nocodegraphicdisplayfield:[0,1],nocodebillnofield:[0,1,2]}[$],null==Se?void 0:g()(Se).call(Se,(function(e){return null==Ae?void 0:S()(Ae).call(Ae,e.id)}))),Me=H(Jd(Jd({},i),{},{batchInvokeListConfig:function(){return i.batchInvokeListConfig(Z)},controlMeta:N,onChange:function(e){return u(Array.isArray(e)?e:""===e?[]:null==e?void 0:e.split(","),n,ne)}}),!0),we="refbill"===ne?Jd(Jd({className:"".concat(l,"-modal-body-refbill")},Me),{},{value:1===N.multi?re:re[0]}):"picture"===ne?{UploadNum:t.UploadNum,FileMaxSize:t.FileMaxSize,typeArr:t.typeArr}:"attachment"===ne?{UploadNum:t.UploadNum,maxSize:t.maxSize,fileType:t.fileType}:{},Pe=function(e){try{if(Xt(e)){var t=JSON.parse(e);return(null==t?void 0:t.valueType)||0}var n;if(e&&"object"===(0,be.c)(e))return(null===(n=e[0])||void 0===n?void 0:n.valueType)||0}catch(e){}}(I),Re=function(e,t){try{if(Xt(e)){var n=JSON.parse(e);return(null==n?void 0:n.valueType)===t?n.value:""}var r,a;if(e&&"object"===(0,be.c)(e))return 2===t?null===(a=e[0])||void 0===a?void 0:a.fieldValue:(null===(r=e[0])||void 0===r?void 0:r.valueType)===t?e[0].fieldValue:""}catch(e){}},Be=function(e){var t=e?e.split("@@"):["","",null],n=(0,s.c)(t,3);return[n[1],n[2]]}(Re(I,1)),_e=function(e){e.stopPropagation(),d(t.fieldName,xe,ne),ge(!1)},Oe=(Fe=Te.functionOperations,A()(Fe)),je={fieldType:"formula",onClick:function(){return Ge("formula")},value:Be[0],expressionData:Te.functionTypes,fieldData:a,onClear:_e,lang:Number(Be[1]||1),readOnly:!0,autofocus:!1},Le={fieldType:"findForm",borderType:"bordered",value:Re(I,2),onChange:function(e){var n;n="string"==typeof e?e:Array.isArray(e)?e.join(","):null!=e&&e.target?e.target.value:e,d(t.fieldName,{valueType:0,fieldValue:n},ne)},placeholder:"请输入",onClear:_e,onClick:function(){return Ge("search")}},Ke={1:je,2:Le}[Pe],Ue=function(){ce(!0)},Ve=function(){fe(!0)},Ge=(0,D.useCallback)((function(e){var t,n={search:Ve,formula:Ue};null===(t=n[e])||void 0===t||t.call(n)}),[Ve,Ue]),ze=function(e,t){var n,r=(null===(n=He(e,t))||void 0===n?void 0:n.label)||"";return r=r?"查找：".concat(r):""},He=function e(t,n){var r;return t.children.forEach((function(t){if(t.value===n&&(r=t),t.children){var a=e(t,n);a&&(r=a)}})),r},qe=(0,D.useMemo)((function(){var e;return 2===Pe&&(null===(e=I[0])||void 0===e||null===(e=e.rule)||void 0===e?void 0:e.value)||De.value}),[I]),Ye={invokeGetListConfig:function(e){e!==Ce&&O("listtreeconfig",[e])},invokeGetFieldRecords:function(e){O("getFilterItemLook",[e,{getEnumData:"true",enumField:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",filterrows:[]}])},invokeSaveBizRule:function(e){}},We=(0,D.useMemo)((function(){var e=K();return e.children[0].icon=k().createElement(P.Icon,{prefix:"nocodeplatformicon",type:"gerenzhongxin",style:{color:"#3987ED"}}),e.children[1].icon=k().createElement(P.Icon,{prefix:"nocodeplatformicon",type:"zuzhi",style:{color:"#3987ED"}}),e}),[K]),Xe=Jd(Jd({name:"value",options:w(E),className:"".concat(l,"-modal-body-infoValue"),fieldType:ne,borderType:"bordered",placeholder:S()(R).call(R,C)?"":void 0,colHeadFilter:null==c?void 0:c[h],formatType:J,baseUrl:G,isMulti:t.isMulti,varSelectProps:Jd({showSearch:!0,defaultExpandAll:!0,className:"".concat(l,"-modal-body-var"),visible:W,disabled:"none"===te||"001"===C,value:A()(Ne).join(),popperClassName:"".concat(l,"-def-editor-var-select-panel"),type:"dropdownSelect",selectedKeys:m()(Ne),data:ke,varSelectActive:ve,onVarSelectActive:ge,onVisibleChange:X,onSelect:function(e){return Ge(e[0])}},Ke)},we),{},{onChange:function(e){return u(e,n,ne)},allowClear:"number"!==ne,value:t.isMulti?re:"refbill"===ne?we.value:re});return k().createElement(k().Fragment,{key:h+C+n},k().createElement(P.ConfigProvider,{value:{prefixCls:"kd"}},k().createElement(qn.ConditionFilterItem,{onDelete:function(){return f(n)},data:[Ee,Ie,Xe],customInput:[{type:"notInput",render:function(e){var t=e.value,n=e.className;return k().createElement("span",{className:n},t)}}],valueRequired:!0,className:"".concat(l,"-item"),verifyData:p}),ie&&k().createElement(qn.Condition,{value:Be[0],language:Number(Be[1]||1),modalTitle:"编辑运算公式",editorTitle:t.fieldCaption,visible:ie,editorPlaceholder:"请编辑运算公式",fieldData:a,fieldTitle:"表单内容",expressionData:Te.functionTypes,operations:Oe,defaultExpandAll:!1,onClose:function(){ce(!1),ge(0!==Pe&&!(null==Ke||!Ke.value))},onConfirm:function(e,n){e=function(e,t){var n,r;if(!e)return"";var a=(e=e.replace(/）/g,")").replace(/（/g,"(").replace(/“/g,'"').replace(/”/g,'"').replace(/‘/g,"'").replace(/’/g,"'")).replace(es,"$1").replace(ts,"$1");return b()(n=b()(r="".concat(a,"@@")).call(r,e,"@@")).call(n,t?1:0)}(e,n),ce(!1),d(t.fieldName,e?{valueType:1,fieldValue:e}:xe,ne)}})),se&&k().createElement(xc,{visible:se,onClose:function(){fe(!1),ge(0!==Pe&&!(null==Ke||!Ke.value))},invokeActions:Ye,queryFormValue:qe||De.value,refBillData:We,field:t,compareTypesMap:ye,formId:v,onConfirm:function(e){fe(!1);var n=ze(We,e.value.relationFormId);d(t.fieldName,e?{valueType:e.valueType,fieldValue:n,rule:e}:xe,ne)}}))}));is.displayName="ChildrenItem";var cs=(0,D.forwardRef)((function(e,t){var n=e.prefixCls,r=e.fieldKey,a=e.formId,l=e.inputFormId,o=e.value,i=e.onChange,c=e.onConfirm,u=(0,D.useContext)(oe),d=u.baseUrl,f=u.onDownLoad,p=u.getControlText,m=u.batchInvoke,v=u.getCompareTypes,y=u.getKdesignerApi,h=u.curFormulaTreeApi,E=u.getRefBillNameMap,I=(0,D.useRef)(null),N=(0,D.useRef)(null),x=(0,D.useRef)([]),A=y(),F=A.data,S=A.meta,w=v(),B=F.getRootId();(0,D.useImperativeHandle)(t,(function(){return{updateVerifyAndGetMsg:function(){return N.current.updateVerifyAndGetMsg()}}}),[]);var _=Cc({id:r,formId:a,eventName:"filterItemLook"}),O=(0,D.useMemo)((function(){if(Array.isArray(o)){var e=[];return o.forEach((function(t){e.push(Jd(Jd({},t),{},{value:"string"==typeof t.value?JSON.parse(t.value):t.value||[]}))})),e}return[]}),[o]),j=hc({api:h,parser:function(e){return nn(e,e,w)}}),L=Cc({id:r,formId:l,eventName:"setListTreeConfig",parser:function(e){var t=e.data;return os(t,S)},defaultValue:[]}),K=(0,D.useMemo)((function(){return cn(j)}),[j]),U=(0,D.useMemo)((function(){var e,t,n=T()(e=F.getData().Items||[]).call(e,(function(e){var t=e._Type_;return Jd(Jd({},S.getDefaultData(t)),e)})),r=ns((null===(t=pi(n)[0])||void 0===t?void 0:t.children)||[],(function(e){var t=e._Type_,n=e.BillEntityIdEx,r=e.showType;return it(t)?"1"!==r:!(ut(t)||rt(t)||("NoCodeMulRefBillField"===t||"NoCodeRefBillField"===t)&&void 0===n)}));return ls(r,K,S,E())}),[K,E]),V=(0,D.useMemo)((function(){return l?l!==B?L:U:[]}),[U,L,l,B]),G=(0,D.useMemo)((function(){return rs(V)}),[V]),z=(0,D.useMemo)((function(){return T()(O).call(O,(function(e){return e.fieldName}))}),[O]),H=(0,D.useMemo)((function(){return ui({options:j})}),[j]),q=(0,D.useCallback)((function(e){x.current.length<e.length&&e.length>7&&setTimeout((function(){return I.current.scrollTo(0,1e4)}),100),x.current=e}),[]),Y=function(e){var t=e;if(Array.isArray(e)){var n=[];e.forEach((function(e){n.push(Jd(Jd({},e),{},{value:"object"===(0,be.c)(e.value)?Kl()(e.value):e.value||""}))})),t=n}i(t),q(e)},W={baseUrl:d,batchInvoke:function(e,t){m(e,r,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[])},getControlText:p,addControlAction:function(e,t){M.eventBus.on(e,t)},onDownLoad:f,batchInvokeListConfig:function(e){m("listconfig","nocodeformdesigner",[e])},batchInvokeQuery:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=g()(t),r=void 0===n?"":n,a=t.search,l=void 0===a?"":a,o=t.order_by,i=void 0===o?"":o,c=t.select,u=void 0===c?"":c,d=t.page_size,s=void 0===d?10:d,f=t.page_no,p=void 0===f?1:f,v=t.ids;m("query","nocodeformdesigner",[e,{filter:r,search:l,order_by:i,select:u,page_size:s,page_no:p,ids:void 0===v?[]:v}])}},X=qn.ListFilterUtil.filterDataTransform,Q=qn.ListFilterUtil.filterNoValue,Z=qn.ListFilterUtil.getNewDefaultFilterDataExcept,J=(qn.ListFilterUtil.getFilterOptions,qn.ListFilterUtil.createNewValue),$=(0,D.useState)([]),ee=(0,s.c)($,2),te=ee[0],ne=ee[1],re=(0,D.useMemo)((function(){return ne([]),X(O,G)||[]}),[O,G]);(0,D.useImperativeHandle)(t,(function(){return{updateVerifyAndGetMsg:function(){var e=Q(re);return ne(e),g()(e).call(e,(function(e){return!e.verifyStatus}))}}}),[re]);var ae=(0,D.useCallback)((function(e){return Jd(Jd({},e),{},{value:e.value||[]})}),[]),le=(0,D.useCallback)((function(){(null==O?void 0:O.length)>0&&Y([])}),[O,Y]),ie=(0,D.useCallback)((function(e,t,n){var r=[],a=Ae()(O).call(O,(function(e,n){return t===n})).fieldName,l=-1;if(null!=a&&Xd()(a).call(a,"_startdate")||null!=a&&Xd()(a).call(a,"_enddate")){var o=a.replace(/^(\S+)(_startdate|_enddate)/g,"$1");l=Kr()(O).call(O,(function(e,n){var r;return(null===(r=e.fieldName)||void 0===r?void 0:C()(r).call(r,o))&&t!==n}))}O.forEach((function(a,o){t===o||l===o?r.push(ae({fieldName:a.fieldName,compareType:e,value:a.value,fieldType:n})):r.push(ae({fieldName:a.fieldName,compareType:a.compareType,value:a.value,fieldType:n}))})),Y(r)}),[O,Y]),ce=function(e){var t=(0,R.c)(O);ue()(t).call(t,e,1),Y(t)},de=function(e,t,n,r){var a=[];O.forEach((function(n,l){if(n.fieldName===e){var o=[];o.push(t),a.push(ae({fieldName:n.fieldName,compareType:n.compareType,value:o,fieldType:r}))}else a.push(ae({fieldName:n.fieldName,compareType:n.compareType,value:n.value,fieldType:r}))})),Y(a)},se=function(e,t,n){!function(e,t,n){var r=[];O.forEach((function(a,l){t===l?r.push(ae({fieldName:a.fieldName,compareType:a.compareType,value:e,fieldType:n})):r.push(ae({fieldName:a.fieldName,compareType:a.compareType,value:a.value}))})),Y(r)}(J(e,n),t,n)};return k().createElement("div",{className:"".concat(n,"-modal"),ref:I},k().createElement("div",{className:"".concat(n,"-modal-body"),style:{marginTop:"0px"}},re.length>0&&k().createElement("div",{style:{width:"100%"}},T()(re).call(re,(function(e,t){return k().createElement(is,{key:(null==e?void 0:e.key)||(null==e?void 0:e.fieldName),item:e,index:t,filterOptions:V,fieldTree:H,prefixCls:n,handleCompareTypeChange:ie,refBillProps:W,fieldRecords:_,handleValChange:se,handleVarSelect:de,handleDelete:ce,verifyData:te,formId:a})})))),k().createElement("div",{className:"".concat(n,"-modal-footer")},k().createElement("div",{className:"".concat(n,"-modal-footer-left")},k().createElement(P.ConfigProvider,{value:{prefixCls:"kd"}},k().createElement(qn.AddTreeItem,{treeData:V,triggerText:"添加录入内容",onCheck:function(e,t){var n=[],r=O.reduce((function(e,t){var n=t.fieldName,r=t.compareType;(null!=n&&Xd()(n).call(n,"_startdate")||null!=n&&Xd()(n).call(n,"_enddate"))&&(e[n.replace(/^(\S+)(_startdate|_enddate)/g,"$1")]=r);return e}),{});e.forEach((function(e,t){var a=Ae()(O).call(O,(function(t){return t.fieldName===e}));if(a)n.push(a);else{var l=Z(G,e,re);if(l){if(null!=e&&Xd()(e).call(e,"_startdate")||null!=e&&Xd()(e).call(e,"_enddate")){var o=e.replace(/^(\S+)(_startdate|_enddate)/g,"$1");r[o]&&(l.compareType=r[o])}n=b()(n).call(n,ae(l))}}})),Y(n)},checkedKeys:z}))),k().createElement("div",{className:"".concat(n,"-modal-footer-right")},k().createElement(P.Button,{size:"small",className:"".concat(n,"-modal-footer-btn"),onClick:le},"清空"),k().createElement(P.Button,{size:"small",type:"primary",className:"".concat(n,"-modal-footer-btn"),onClick:c},"确定"))))})),us=(0,D.memo)((function(e){var t=e.prefixCls,n=e.title,r=e.value,a=e.formId,l=e.inputFormId,o=e.visible,i=e.setVisible,c=e.fieldKey,u=e.onChange,d=(0,D.useState)(r),f=(0,s.c)(d,2),p=f[0],m=f[1],v=(0,D.useRef)(),g=function(){i(!1)};return(0,D.useEffect)((function(){o&&((0,De.isEqual)(r,p)||m(r))}),[o]),k().createElement(P.Modal,{mask:!0,visible:o,body:k().createElement(cs,{ref:v,prefixCls:t,fieldKey:c,formId:a,inputFormId:l,value:p,onChange:function(e){m(e)},onConfirm:function(){null==u||u(p),g()}}),titleIcon:null,className:"".concat(t,"-modal"),maskClosable:!1,footer:k().createElement(k().Fragment,null),width:640,height:520,keyboard:!1,bodyStyle:{padding:0,overflow:"hidden"},footerStyle:{display:"none"},title:n,closable:!0,draggable:!1,destroyOnClose:!0,onCancel:g,onOk:g})}));us.displayName="InputContentModal";var ds=us;function ss(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function fs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ss(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):ss(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var ps=(0,D.memo)((function(e){var t,n,r=e.handleChange,a=e.className,l=e.editor,o=e.locked,i=e.Name,c=e.Tips,u=e.field,d=e.rootId,f=l.NameHidden,p=l.Required,m=l.Title,v=u.Key,g=u._Type_,y=u.InputForm,C=(0,D.useState)(!1),h=(0,s.c)(C,2),b=h[0],E=h[1],I=(0,D.useContext)(oe),N=I.invokeAction,T=I.prefixCls,x=I.getKdesignerApi,A=I.fetchListTree,F=x().data,w="string"==typeof(n=e.value)&&""!=n?JSON.parse(n):n,P=(0,D.useMemo)((function(){return"nocodemulrefbillfield"===g.toLocaleLowerCase()?u.BillEntityIdEx:F.getRootId()}),[g,F,null==u?void 0:u.BillEntityIdEx]),R=(0,D.useMemo)((function(){if(y){var e=y.lastIndexOf(".")+1,t=y.lastIndexOf("["),n=e>0&&t>-1?y.substring(e,t):y;return S()(n).call(n,d)?d:n}return""}),[y]);(0,D.useEffect)((function(){var e=null==w?void 0:w.targetId;e&&e!=y&&r("")}),[y]);var _,O=(0,D.useCallback)((function(e){var t=Kl()({value:e,targetId:y});r(t)}),[r]),j="".concat(T,"-inputContnet-editor"),L=fs(fs({},l),{},{NameHidden:!0}),K=(0,D.useMemo)((function(){return{name:i,className:a,nameHidden:f,tips:c,required:p,title:m}}),[i,a,f,c,p,m]);return k().createElement("div",{className:j},k().createElement("div",{className:"".concat(a,"-nav")},k().createElement(M.NameTipWrapper,K)),k().createElement(M.CustomInputTrigger,(0,B.c)({},e,{editor:L,disabled:o,value:(null==w||null===(t=w.value)||void 0===t?void 0:t.length)>0?(_=w.value,"".concat(_.length,"个内容")):"",onClick:function(){E(!0),A("formula"),R&&N("listtreeconfig",[R,"formula"])}})),k().createElement(ds,{formId:P,inputFormId:R,prefixCls:j,visible:b,setVisible:E,fieldKey:v,value:(null==w?void 0:w.value)||[],title:i,onChange:O}))}));ps.displayName="InputContentEditor";var ms=(0,M.ErrorBoundaryWrap)(ps,"InputContentEditor");function vs(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function gs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vs(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):vs(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var ys=qn.treeUtils.exludeTreeNodeByCallback,Cs=qn.treeUtils.dfs,hs=function e(t,n,r,a,l){return t.reduce((function(t,o){var i,c=o._Type_,u=o.Name,d=o.Key,s=o.BillEntityIdEx,f=o.SelectItemType,p=o.Multi,m=o.children,v=o.selectable;if(Je(c)){var g,y,C=[{title:"".concat(u,".开始"),titlePrefix:"[日期]",key:l?b()(g="".concat(l,".")).call(g,d,"_startdate"):"".concat(d,"_startdate"),type:c,entityId:s},{title:"".concat(u,".结束"),titlePrefix:"[日期]",key:l?b()(y="".concat(l,".")).call(y,d,"_enddate"):"".concat(d,"_enddate"),type:c,entityId:s}];return b()(t).call(t,C)}var h=void 0!==v?v:!Vt(c),E={title:u,titlePrefix:on(o,n,r,a),key:l?b()(i="".concat(l,".")).call(i,d):d,type:c,entityId:s,isMulti:1===f||1==p,selectable:h};if(1!=p&&m){var I=it(c)?d:void 0;E.children=e(m,n,r,a,I)}return Vt(c)&&(E.selectable=!1),b()(t).call(t,E)}),[])},bs=function(e){var t=e.value,n=e.isMultiMode,r=void 0!==n&&n,a=e.sourceFieldOptions,l=e.relationFieldId,o=e.selBillValue,i=e.onChange,c=e.curListFilterConfig,u=(0,D.useState)(t||[]),d=(0,s.c)(u,2),f=d[0],p=d[1],m=(0,D.useContext)(oe),v=m.getKdesignerApi,g=m.getRefBillNameMap,y=v(),C=y.data,h=y.meta,E=qn.ListFilterUtil.filterTreeData,I=qn.ListFilterUtil.canClearSourceField,N=(0,D.useMemo)((function(){return cn(c)}),[c]),x=(0,D.useMemo)((function(){var e,t,n=T()(e=C.getData().Items||[]).call(e,(function(e){var t=e._Type_;return gs(gs({},h.getDefaultData(t)),e)})),a=ys((null===(t=pi(n)[0])||void 0===t?void 0:t.children)||[],(function(e){var t=e._Type_,n=e.BillEntityIdEx,a=e.showType,i=e.Multi,c=e.children,u=e.Key,d=e.RefBillKey;return r?(!d||d!==l)&&(!(!it(t)&&!et(t)||n!==o||u===l||1!=i)||!(1==i||!c.length)&&(e.selectable=!1,!0)):(!l||u!==l&&d!==l)&&(it(t)?"1"!==a:!(ut(t)||rt(t)||("NoCodeMulRefBillField"===t||"NoCodeRefBillField"===t)&&void 0===n))}));return hs(a,N,h,g())}),[r,o,l,N,g]),A=function(e,t){var n=Ae()(f).call(f,(function(e,n){return n===t})).fieldId;if(e!==n){var r=T()(f).call(f,(function(n,r){return t===r?gs(gs({},n),{},{sourceField:e}):n}));p(r),i(r)}},F=function(e,t){var n=T()(f).call(f,(function(n,r){if(t===r){var l=E(a,Cs(x,(function(t){return t.key===e})));return I(l,n.sourceField)?gs(gs({},n),{},{targetField:e}):gs(gs({},n),{},{targetField:e,sourceField:""})}return n}));p(n),i(n)};(0,D.useEffect)((function(){var e=t||[];(0,De.isEqual)(e,f)||p(e)}),[t]);return k().createElement("div",{className:"bill-finder-actions"},T()(f).call(f,(function(e,t){var n=e.sourceField,r=e.targetField,l=Cs(x,(function(e){return e.key===r}))||{},c=E(a,gs({selBillValue:o},l));return k().createElement("div",{className:"row_item",key:t},k().createElement("span",{className:"txt"},"将"),k().createElement(qn.KDTreeSelect,{className:"target-field-select",virtual:!1,allowClear:!0,value:r,treeData:x,showFullLabelTips:!0,onChange:function(e){return F(e,t)},suffixIcon:k().createElement(P.Icon,{prefix:"designericon",type:"duixiangxuanze2"})}),k().createElement("span",{className:"txt"},"的值赋为"),k().createElement(qn.KDTreeSelect,{className:"source-field-select",virtual:!1,disabled:""===r||void 0===r,value:n,treeData:c,showFullLabelTips:!0,treeCheckStrictly:!0,onChange:function(e){return A(e,t)},suffixIcon:k().createElement(P.Icon,{prefix:"designericon",type:"duixiangxuanze2"})}),k().createElement(P.Icon,{className:"delete_icon",prefix:"ncicon",type:"xingshanchu",onClick:function(){return function(e){var t=(0,R.c)(f);ue()(t).call(t,e,1),p(t),i(t)}(t)}}))})),k().createElement("div",{className:"footer-btns"},k().createElement("div",{className:"add-btn",onClick:function(){var e,t=b()(e=[]).call(e,(0,R.c)(f),[{sourceField:"",targetField:""}]);p(t),i(t)}},k().createElement(P.Icon,{prefix:"nocodeplatformicon",type:"zengjia-yuan"}),"添加写入规则"),!!f.length&&k().createElement("div",{className:"clear-all",onClick:function(){p([]),i([])}},"清空")))},Es=["children"];function Is(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ns(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Is(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Is(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Ts=qn.treeUtils.dfs,xs=qn.treeUtils.getListConfigPure,As=qn.treeUtils.treeNodeTransform,Fs=qn.treeUtils.getListSortConfig,Ss=qn.treeUtils.getMultiRefChildrenExclude,Ds=qn.ListFilterUtil.getVarSelectDisabled,ks={key:"currentRecord",title:"本记录"},Ms={key:"currentRecord",title:"查询结果",isMulti:!0},ws=[{label:"单条",value:"0"},{label:"多条",value:"1"}],Ps=[{type:"array",required:!0,validator:function(e,t,n,r,a){return null!=t&&t.length&&t.every((function(e){return A()(e).every((function(e){return"string"==typeof e?""!==e:!Array.isArray(e)||0!==e.length}))}))?[]:[new Error("请添加写入规则")]}}],Rs=function(e,t){return Ns(Ns({},e),t)},Bs=function(e){var t,n=e.value,r=e.refBillData,a=e.field,l=e.ruleId,o=e.compareTypesMap,i=e.formId,c=e.listFilterConfig,u=e.curFormFieldTree,d=e.onChange,p=e.onSave,m=(0,D.useContext)(oe),v=m.prefixCls,y=m.baseUrl,C=m.onDownLoad,h=m.getControlText,E=m.batchInvoke,I=m.invokeAction,N=(m.getDataRef,m.getKdesignerApi),x=P.Form.useForm(),A=(0,s.c)(x,1)[0],F=(0,D.useState)({}),w=(0,s.c)(F,2),B=w[0],_=w[1],O=a.Key,j=a.ParentId,L=N(),K=L.data,U=L.meta,V=K.getRootId(),G=(0,D.useReducer)(Rs,n),z=(0,s.c)(G,2),H=z[0],q=z[1],Y=(0,D.useRef)(),W=(0,D.useRef)(),X={baseUrl:y,batchInvoke:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];E(e,a.Key,t,n)},getControlText:h,addControlAction:function(e,t){return M.eventBus.on(e,t),function(){M.eventBus.off(e,t)}},onDownLoad:C,batchInvokeListConfig:function(e){E("listconfig","nocodeformdesigner",[e])},batchInvokeQuery:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=g()(t),r=void 0===n?"":n,a=t.search,l=void 0===a?"":a,o=t.order_by,u=void 0===o?"":o,d=t.select,s=void 0===d?"":d,f=t.page_size,p=void 0===f?10:f,m=t.page_no,v=void 0===m?1:m,y=t.ids,C=void 0===y?[]:y;if(H.relationFormId===i){var h=Ts(c,(function(t){return t.entityId===e}));if(null!=h&&h.isDraftField)return}E("query","nocodeformdesigner",[e,{filter:r,search:l,order_by:u,select:s,page_size:p,page_no:v,ids:C}])}},Q=(0,D.useMemo)((function(){var e=r.children,t=void 0===e?[]:e;return t[0].icon=k().createElement(P.Icon,{prefix:"nocodeplatformicon",type:"gerenzhongxin",style:{color:"#3987ED"}}),t[1].icon=k().createElement(P.Icon,{prefix:"nocodeplatformicon",type:"zuzhi",style:{color:"#3987ED"}}),Aa(t)[0]}),[r]),Z=Cc({id:O,formId:H.relationFormId,eventName:"setListTreeConfig",parser:function(e){var t=e.data;return nn(t,t,o)},defaultValue:[]}),J=(0,D.useMemo)((function(){if(2===H.valueType)return""===H.relationFormId?[]:H.relationFormId===i?c:Z;if(3===H.valueType){var e;if(""===H.relationFieldId)return[];var t=(null===(e=Ts(u,(function(e){return e.key===H.relationFieldId})))||void 0===e?void 0:e.children)||[];return As(t,(function(e){var t=e.compareTypes,n=void 0===t?[]:t,r=e.key,a=H.relationFieldId.replace(/\./g,"\\."),l=r.replace(new RegExp("^"+a+"\\.(\\S+)"),"$1");if((null!=l&&S()(l).call(l,"fbasedataid")?l.split(".fbasedataid")[0]:l).split(".").length>2)return!1;var o=g()(n).call(n,(function(e){return"001"!==e.id}));return Ns(Ns({},e),{},{compareTypes:o,key:l})}))}return[]}),[H.relationFormId,H.relationFieldId,H.valueType,i,c,Z,u]),$=(0,D.useMemo)((function(){return xs(J)}),[J]),ee=(0,D.useMemo)((function(){return Fs(J)}),[J]),te=(0,D.useMemo)((function(){var e;return"1"===H.valueType2Multi?[Ms]:b()(e=[ks]).call(e,(0,R.c)(Ss(J)))}),[J,H.valueType2Multi]),ne=(0,D.useMemo)((function(){if(!H.relationFieldId)return!1;var e=Ts(u,(function(e){return e.key===H.relationFieldId}));return null==e?void 0:e.isMulti}),[H.relationFieldId,u]),re=(0,D.useMemo)((function(){var e;if(""===H.relationFieldId)return[];if(3===H.valueType&&ne&&"1"===H.valueType3Multi)return[Ms];var t=Ts(u,(function(e){return e.key===H.relationFieldId})),n=As((null==t?void 0:t.children)||[],(function(e){var t=e.children,n=(0,he.c)(e,Es),r=n.isMulti,a=n.key,l=H.relationFieldId.replace(/\./g,"\\."),o=a.replace(new RegExp("^"+l+"\\.(\\S+)"),"$1");return!((null!=o&&S()(o).call(o,"fbasedataid")?o.split(".fbasedataid")[0]:o).split(".").length>2)&&Ns(Ns({},!r&&t?e:n),{},{key:o})}));return b()(e=[ks]).call(e,(0,R.c)(n))}),[H.relationFieldId,u,H.valueType3Multi,ne]),ae=(0,D.useMemo)((function(){return di({metaApi:U,options:c})}),[c]),le=(0,D.useMemo)((function(){return si({options:c})}),[c,V]),ie=(null===(t=Ts(u,(function(e){return e.key===H.relationFieldId})))||void 0===t?void 0:t.entityId)||"",ce=Cc({id:O,formId:H.relationFormId,eventName:"filterItemLook"}),ue=(0,D.useMemo)((function(){var e;return Array.isArray(H.filterInfos)?T()(e=H.filterInfos).call(e,(function(e){return Ns(Ns({},e),{},{value:"string"==typeof e.value?JSON.parse(e.value):e.value||[]})})):[]}),[H.filterInfos]);(0,D.useEffect)((function(){var e=ce.data,t=ce.param,n=(void 0===t?{}:t).enumField;if(n){var r=null==ue?void 0:g()(ue).call(ue,(function(e){return e.fieldName===n})),a=Ts(J,(function(e){return e.key===n}));_((function(t){return Ns(Ns({},t),{},(0,f.c)({},n,{configuredFilter:{enumEqCompareType:"001",items:r},fieldFilterConfig:a,groupInfo:e}))}))}}),[ce,ue,J]),(0,D.useEffect)((function(){var e;H.relationFormId&&((e=H.relationFormId)!==V&&I("listtreeconfig",[e]))}),[H.relationFormId]),(0,D.useEffect)((function(){if(2===H.valueType){var e=H.filterInfos,t=H.sortInfos,n=H.relationFormId,r=H.valueType2Result,a=H.valueType2Multi,l=H.valueType2Top;A.setFieldsValue({filterInfos:e,sortInfos:t,relationFormId:n,valueType2Result:r,valueType2Multi:a,valueType2Top:l})}else if(3===H.valueType){var o=H.relationFieldId,i=H.valueType3Result,c=H.valueType3FilterInfos,u=H.valueType3SortInfos,d=H.valueType3Multi,s=H.valueType3Top;A.setFieldsValue({relationFieldId:o,valueType3Result:i,valueType3FilterInfos:c,valueType3SortInfos:u,valueType3Multi:d,valueType3Top:s})}}),[H.valueType]),(0,D.useEffect)((function(){var e=H.valueType2Top;A.setFieldsValue({valueType2Top:e})}),[H.valueType2Multi]),(0,D.useEffect)((function(){var e=H.valueType3Top;A.setFieldsValue({valueType3Top:e})}),[H.valueType3Multi]);var de=(0,D.useMemo)((function(){return!(null!=l&&S()(l).call(l,"new_rule_"))}),[n]),se=(0,D.useMemo)((function(){return 2===H.valueType?"1"===H.valueType2Multi:3===H.valueType&&(ne&&"1"===H.valueType3Multi)}),[H.valueType,H.valueType2Multi,H.valueType3Multi,ne]),fe=function(e){!function(e){I("getFilterItemLook",[e,{getEnumData:"true",enumField:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",filterrows:[]}])}(H.relationFormId,e.fieldName)},pe=function(e,t){q((0,f.c)({},e,t)),d((0,f.c)({},e,t))},me=function(e){q(e),d(e)};(0,D.useEffect)((function(){(0,De.isEqual)(n,H)||(q(n),A.setFieldsValue(n))}),[n]);return k().createElement("div",{className:"bill-finder-setting",key:l},k().createElement("div",{className:"setting-form"},k().createElement(P.ConfigProvider,{value:{prefixCls:"kd"}},k().createElement(P.Form,{layout:"vertical",form:A,labelWidth:"100%",wrapperWidth:"100%",onValuesChange:function(e,t){}},k().createElement(P.Form.Item,{label:"规则名称",name:"ruleName",required:!0,validateTrigger:"onBlur",rules:[{required:!0,message:"请输入规则名称"},{type:"string",validator:function(e,t,n,r,a){return null!=t&&Xr()(t).call(t)?[]:[new Error("请输入规则名称")]}}]},k().createElement(P.Input,{type:"text",borderType:"bordered",size:"middle",placeholder:"请输入规则名称",maxLength:50,value:H.ruleName,onChange:function(e){return pe("ruleName",e.target.value)}})),k().createElement(P.Form.Item,{label:"查找方式",name:"valueType",rules:[{required:!0,message:"请输入规则名称",type:"number"}]},k().createElement(qn.Sectioner,{defaultValue:2,value:H.valueType,options:[{label:"通过筛选条件",value:2},{label:"通过关联表单",value:3}],onChange:function(e){return pe("valueType",e)}})),2===H.valueType&&k().createElement(k().Fragment,null,k().createElement(P.Form.Item,{label:"查找表单",name:"relationFormId",required:!0},k().createElement(qn.KDTreeSelect,{allowClear:!0,value:H.relationFormId||"",treeData:Q,showTreeIcon:!0,treeIcon:function(e){return e.icon},onChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";(e=e||"")!==H.relationFormId&&(me({relationFormId:e,filterInfos:[],sortInfos:[],valueType2Result:[]}),A.setFieldsValue({relationFormId:e,filterInfos:null,sortInfos:null,valueType2Result:null}))}})),k().createElement(P.Form.Item,{label:"配置筛选条件",name:"filterInfos",rules:[{type:"array",required:!0,message:"请配置筛选条件"}]},k().createElement(qn.FilterEditor,{id:"filter",ref:Y,valueRequired:!0,name:"配置筛选条件",tips:"",variablesTree:ae||[],listFilterConfig:$,onGetFieldRecords:fe,fieldRecords:B,nameHidden:!0,style:{marginTop:"0px"},getVarSelectDisabled:Ds,fieldData:{fieldType:"treeSelect",style:{width:"184px"}},filterFooterData:{listType:"tree",triggerText:"添加筛选条件",treeProps:{defaultExpandAll:!1}},value:H.filterInfos||[],refBillProps:X,onChange:function(e){A.setFieldValue("filterInfos",e),pe("filterInfos",e)}})),k().createElement(P.Form.Item,{label:"配置排序条件",name:"sortInfos"},k().createElement(qn.OrderByEditor,{id:"filter",name:"配置排序条件",nameHidden:!0,tips:"",style:{marginTop:"0px"},treeData:ee||[],value:H.sortInfos||[],onChange:function(e){return pe("sortInfos",e)}})),k().createElement(P.Form.Item,{label:"查找数量",name:"valueType2Multi"},k().createElement(qn.Sectioner,{defaultValue:"0",value:H.valueType2Multi,options:ws,onChange:function(e){me({valueType2Multi:e,valueType2Result:[]}),A.setFieldsValue({valueType2Multi:e,valueType2Result:null})}})),"1"===H.valueType2Multi&&k().createElement(P.Form.Item,{label:"数量上限（最多1000条）",name:"valueType2Top",required:!0},k().createElement(P.InputNumber,{borderType:"bordered",value:H.valueType2Top,min:0,max:1e3,mustInScope:!0,decimalLength:0,onChange:function(e){var t;return pe("valueType2Top",(null===(t=e.target)||void 0===t?void 0:t.value)||"")}})),k().createElement(P.Form.Item,{label:"查找到记录后",name:"valueType2Result",rules:Ps},k().createElement(bs,{prefixCls:v,isMultiMode:se,selBillValue:H.relationFormId||"",sourceFieldOptions:te,value:H.valueType2Result||[],onChange:function(e){return pe("valueType2Result",e)},curListFilterConfig:c}))),3===H.valueType&&k().createElement(k().Fragment,null,k().createElement(P.Form.Item,{label:"选择关联表单",name:"relationFieldId",required:!0},k().createElement(qn.KDTreeSelect,{className:"suffix-icon-no-animation",allowClear:!0,value:H.relationFieldId,treeData:le,suffixIcon:k().createElement(P.Icon,{prefix:"designericon",type:"duixiangxuanze2"}),onChange:function(e){e!==H.relationFieldId&&(me({relationFieldId:e,valueType3Result:[],valueType3FilterInfos:[],valueType3SortInfos:[]}),A.setFieldsValue({relationFieldId:e,valueType3Result:null,valueType3FilterInfos:null,valueType3SortInfos:null}))},showFullLabelTips:!0})),ne&&k().createElement(k().Fragment,null,k().createElement(P.Form.Item,{label:"配置筛选条件",name:"valueType3FilterInfos",rules:[{type:"array",required:!0,message:"请配置筛选条件"}]},k().createElement(qn.FilterEditor,{id:"filter",ref:W,valueRequired:!0,name:"配置筛选条件",tips:"",variablesTree:ae||[],listFilterConfig:$,onGetFieldRecords:fe,fieldRecords:B,nameHidden:!0,style:{marginTop:"0px"},getVarSelectDisabled:Ds,fieldData:{fieldType:"treeSelect",style:{width:"184px"}},filterFooterData:{listType:"tree",triggerText:"添加筛选条件",treeProps:{defaultExpandAll:!1}},value:H.valueType3FilterInfos||[],refBillProps:X,onChange:function(e){A.setFieldValue("valueType3FilterInfos",e),pe("valueType3FilterInfos",e)}})),k().createElement(P.Form.Item,{label:"配置排序条件",name:"valueType3SortInfos"},k().createElement(qn.OrderByEditor,{id:"filter",name:"配置排序条件",nameHidden:!0,tips:"",style:{marginTop:"0px"},treeData:ee||[],value:H.valueType3SortInfos||[],onChange:function(e){return pe("valueType3SortInfos",e)}})),k().createElement(P.Form.Item,{label:"查找数量",name:"valueType3Multi"},k().createElement(qn.Sectioner,{defaultValue:"0",value:H.valueType3Multi,options:ws,onChange:function(e){me({valueType3Multi:e,valueType3Result:[]}),A.setFieldsValue({valueType3Multi:e,valueType3Result:null})}})),"1"===H.valueType3Multi&&k().createElement(P.Form.Item,{label:"数量上限（最多1000条）",name:"valueType3Top",required:!0},k().createElement(P.InputNumber,{borderType:"bordered",value:H.valueType3Top,min:0,max:1e3,mustInScope:!0,decimalLength:0,onChange:function(e){var t;return pe("valueType3Top",(null===(t=e.target)||void 0===t?void 0:t.value)||"")}}))),k().createElement(P.Form.Item,{label:"查找到记录后",name:"valueType3Result",rules:Ps},k().createElement(bs,{prefixCls:v,isMultiMode:se,selBillValue:ie||"",relationFieldId:H.relationFieldId,sourceFieldOptions:re,value:H.valueType3Result||[],onChange:function(e){return pe("valueType3Result",e)},curListFilterConfig:c})))))),k().createElement("div",{className:"setting-footer"},k().createElement(P.Button,{size:"small",type:"primary",onClick:function(){var e,t=K.findControl(j),n=t._Type_,r=t.Key,o=it(n)?b()(e="".concat(r,".")).call(e,a.Key):a.Key;new(jr())((function(e,t){A.validateFields().then((function(t){var n=Ti()(t);e(n)})).catch((function(e){return t(e)}))})).then((function(e){var t,n,r=e.ruleName,a=e.valueType,i=e.valueType2Result,c=e.valueType3Result,u=e.relationFormId,d=e.relationFieldId,s=e.filterInfos,f=e.valueType2Multi,m=e.valueType2Top,v=e.valueType3FilterInfos,g=e.valueType3SortInfos,y=e.valueType3Multi,C=e.valueType3Top,h=e.sortInfos||[],b=2===a&&(null===(t=Y.current)||void 0===t||null===(n=t.updateVerifyAndGetMsg)||void 0===n?void 0:n.call(t)),E={result:2===a?i:c,relationFormId:2===a?u:d};if(2===a)E.filterInfos=s,E.sortInfos=h,E.multi=f,"1"===f&&(E.top=m);else if(3===a){var I,N;if(ne)if(E.multi=y,E.filterInfos=v,E.sortInfos=g,"1"===y&&(E.top=C),(null===(I=W.current)||void 0===I||null===(N=I.updateVerifyAndGetMsg)||void 0===N?void 0:N.call(I)).length)return}var T={ruleName:Xr()(r).call(r),valueType:a,value:E},x={formId:V,fieldKey:o,ruleInfo:Kl()(T)};de&&(x.ruleId=l),b.length||p(x)})).catch((function(e){}))}},"保存")))};function _s(e,t){var n=void 0!==ge()&&Ce()(e)||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return Os(e,t);var r=Se()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return me()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Os(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,l=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw l}}}}function Os(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function js(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ls(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?js(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):js(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var Ks=function(e){var t=e.handleAdd;return k().createElement("div",{className:"rule-empty"},k().createElement("img",{src:Zu,alt:"暂无卡片",width:224,height:128}),k().createElement("div",{className:"empty-text"},"暂无规则，点击下方按钮添加"),k().createElement(P.Button,{type:"primary",icon:k().createElement(P.Icon,{prefix:"nocodeplatformicon",type:"zengjia-yuan"}),onClick:t},"添加规则"))},Us={valueType:2,relationFormId:"",relationFieldId:"",filterInfos:[],sortInfos:[],valueType2Result:[],valueType3Result:[],valueType3FilterInfos:[],valueType3SortInfos:[],valueType2Multi:"0",valueType3Multi:"0",valueType2Top:"100",valueType3Top:"100"},Vs=function(e){var t=e.ruleInfo,n=e.ruleId,r=t&&Xt(t)?JSON.parse(t):{},a=r.ruleName,l=r.valueType,o=r.value,i=void 0===o?{}:o,c=Hs(e),u=c.affectfldkeys,d=c.depfldkeys,s=Ls(Ls({},Us),{},{affectfldkeys:u,depfldkeys:d,ruleId:n,ruleName:a,valueType:l});if(2===l){var p=i.filterInfos,m=void 0===p?[]:p,v=i.sortInfos,g=void 0===v?[]:v,y=i.result,C=void 0===y?[]:y,h=i.relationFormId,b=void 0===h?"":h,E=i.multi,I=i.top;(0,B.c)(s,{filterInfos:m,sortInfos:g,valueType2Multi:E,valueType2Result:C,relationFormId:b}),I&&(0,B.c)(s,{valueType2Top:I})}else if(3===l){var N=i.result,T=void 0===N?[]:N,x=i.relationFormId,A=void 0===x?"":x;(0,B.c)(s,{valueType3Result:T,relationFieldId:A}),["filterInfos","sortInfos","multi","top"].forEach((function(e){var t=i[e];t&&(0,B.c)(s,(0,f.c)({},"valueType3".concat((0,De.upperFirst)(e)),t))}))}return s},Gs=(0,D.forwardRef)((function(e,t){var n=e.prefixCls,r=e.field,a=e.refreshEditorDisplay,l=(0,D.useContext)(oe),o=(l.invokeAction,l.getKdesignerApi),i=l.getRefBillData,c=l.getCompareTypes,u=l.getBizRules,d=l.setBizRules,f=l.curListTreeApi,p=r.Key,m=(0,D.useState)((function(){var e,t=u(),n=T()(t).call(t,Vs);if((null==n?void 0:n.length)<=1)return n;var r,a=[],l=[],o=[],i=_s(n);try{for(i.s();!(r=i.n()).done;){var c=r.value,d=c.depfldkeys,s=c.affectfldkeys;S()(d).call(d,p)&&S()(s).call(s,p)?a.push(c):S()(d).call(d,p)||S()(s).call(s,p)?l.push(c):o.push(c)}}catch(e){i.e(e)}finally{i.f()}return b()(e=[]).call(e,a,l,o)})),v=(0,s.c)(m,2),y=v[0],C=v[1],h=(0,D.useState)((function(){var e;if(y.length)return null===(e=y[0])||void 0===e?void 0:e.ruleId})),E=(0,s.c)(h,2),I=E[0],N=E[1],x=o().data.getRootId(),A=c(),F=hc({api:f,parser:function(e){return nn(e,e,A)}}),M=hc({api:f,parser:function(e){return nn(e,e,A,4)}}),w=(0,D.useCallback)((function(){null==y||y.length;var e="new_rule_".concat(dn()),t=Ls({ruleId:e,ruleName:"未命名规则",depfldkeys:"",affectfldkeys:""},Us);C(y?b()(y).call(y,t):[t]),N(e)}),[y]),R=function(e){var t=function(e){var t=(null==y?void 0:Kr()(y).call(y,(function(t){return t.ruleId===e})))||0,n=I;if(I===e){var r=t>0?y[t-1]:void 0,a=y[t+1];r?n=r.ruleId:a&&(n=a.ruleId)}return n}(e);N(t),C((function(t){return null==t?void 0:g()(t).call(t,(function(t){return t.ruleId!==e}))})),_(e)},B=((0,D.useCallback)((function(e){C(T()(e).call(e,Vs)),e.length&&N(e[0].ruleId)}),[]),function(e){C((function(t){return null==t?void 0:T()(t).call(t,(function(t){return t.ruleId===I?Ls(Ls({},t),e):t}))}))}),_=function(e){var t=u();d(null==t?void 0:g()(t).call(t,(function(t){return t.ruleId!==e}))),a()},O=(0,D.useMemo)((function(){return i()}),[i]);(0,D.useImperativeHandle)(t,(function(){return{getRules:function(){return null==y?void 0:T()(y).call(y,(function(e){var t="null"===e.depfldkeys?"":e.depfldkeys,n="null"===e.affectfldkeys?"":e.affectfldkeys;return Ls(Ls({},e),{},{depfldkeys:t,affectfldkeys:n})}))}}}),[y]);var j=(0,D.useMemo)((function(){return I?null==y?void 0:Ae()(y).call(y,(function(e){return e.ruleId===I})):{}}),[I,y]);return y?y.length?k().createElement("div",{className:"".concat(n,"-main")},k().createElement("div",{className:"left-area"},k().createElement("div",{className:"rule-list"},null==y?void 0:T()(y).call(y,(function(e){var t=e.ruleName,n=e.ruleId,r=e.depfldkeys,a=e.affectfldkeys;return k().createElement("div",{className:Vn()("rule-item",{"is-active":I===n}),key:n,onClick:function(){return N(n)}},k().createElement("div",{className:"rule-name"},t,k().createElement(P.Icon,{prefix:"ncicon",type:"jingshi",className:Vn()("warning-icon",{show:!1})})),k().createElement("div",{className:"tags"},S()(r).call(r,p)&&k().createElement("span",{className:"tag-item"},"触发"),S()(a).call(a,p)&&k().createElement("span",{className:"tag-item"},"受影响的")),k().createElement("div",{className:"delete-btn",onClick:function(e){return function(e,t,n){e.stopPropagation(),null===qn.WebMsg||void 0===qn.WebMsg||qn.WebMsg.showConfirmModal({title:"确定删除“".concat(t,"”吗？"),type:"delete",onAction:function(e){"ok"===e&&R(n)}})}(e,t,n)}},k().createElement(P.Icon,{prefix:"designericon",type:"shanchu"})))}))),k().createElement("div",{className:"add-rule",onClick:w},k().createElement("span",{className:"add-btn"},k().createElement(P.Icon,{prefix:"designericon",type:"zengjia-yuan"}),"新增规则"))),k().createElement("div",{className:"right-area"},k().createElement(Bs,{value:j,refBillData:O,field:r,ruleId:I,compareTypesMap:A,formId:x,listFilterConfig:F,curFormFieldTree:M,onChange:B,onSave:function(e){var t=u(),n=Ls(Ls({},(null==t?void 0:Ae()(t).call(t,(function(e){return e.ruleId===I})))||{}),e),r=Hs(n),l=r.affectfldkeys,o=r.depfldkeys;if(null!=I&&S()(I).call(I,"new_rule_")){var i=null==I?void 0:Se()(I).call(I,9);n.ruleId=i,B({ruleId:i,affectfldkeys:l,depfldkeys:o}),N(i)}B({affectfldkeys:l,depfldkeys:o});var c=null!=I&&S()(I).call(I,"new_rule_")?b()(t).call(t,n):T()(t).call(t,(function(e){return e.ruleId===I?n:e}));d(c),a(),qn.WebMsg.showNotificationMsg({param:[{type:0,content:"保存成功。",duration:2e3}]})}}))):k().createElement("div",{className:"".concat(n,"-main")},k().createElement(Ks,{handleAdd:w})):null})),zs=function(e){var t=e.prefixCls,n=e.title,r=e.visible,a=e.setVisible,l=e.field,o=e.listFilterConfig,i=e.refreshEditorDisplay,c=(0,D.useRef)(null),u=function(){a(!1)};return k().createElement(P.Modal,{mask:!0,visible:r,body:k().createElement(Gs,{ref:c,prefixCls:t,field:l,listFilterConfig:o,refreshEditorDisplay:i}),titleIcon:null,className:"".concat(t,"-modal"),footer:null,maskClosable:!1,width:960,height:644,keyboard:!1,title:k().createElement("span",{title:n},n),closable:!0,draggable:!1,destroyOnClose:!0,onCancel:u,onOk:u})},Hs=function(e){var t,n=e.ruleInfo,r=(n&&Xt(n)?JSON.parse(n):{}).value,a=void 0===r?{}:r,l=T()(t=(null==a?void 0:a.result)||[]).call(t,(function(e){return e.targetField})).join(),o=null==n?void 0:n.match(/\${model\.[\w_]+}/g);return{affectfldkeys:l,depfldkeys:(null==o?void 0:T()(o).call(o,(function(e){return e.replace(/\${model\.([\w_]+)}/,"$1")})))||""}},qs=function(e){var t=e.locked,n=e.field,r=n.Name,a=n.Key,l=n.ParentId,o=(0,D.useState)(!1),i=(0,s.c)(o,2),c=i[0],u=i[1],d=(0,D.useContext)(oe),f=(d.invokeAction,d.prefixCls),p=d.getKdesignerApi,m=(d.getDataRef,d.getBizRules),v=d.fetchListTree,g=p().data,y=(g.getRootId(),m()||[]),C=(0,D.useReducer)((function(e){return e+1}),0),h=(0,s.c)(C,2)[1],b=function(){var e=g.findControl(l);e._Type_,e.Key;v(),u(!0)},E=(0,D.useMemo)((function(){var e=y.reduce((function(e,t){var n=Hs(t),r=n.affectfldkeys,l=n.depfldkeys;return null!=r&&S()(r).call(r,a)||null!=l&&S()(l).call(l,a)?e+1:e}),0);return 0!==e?"".concat(e,"条规则"):""}),[y,a]),I="".concat(f,"-billFinder");return k().createElement(k().Fragment,null,k().createElement(M.CustomInputTrigger,(0,B.c)({},e,{placeholder:"请选择",disabled:t,value:E,onClick:b,onInputClick:b})),k().createElement(zs,{prefixCls:I,visible:c,setVisible:u,field:n,title:"".concat(r,"-查找表单记录"),refreshEditorDisplay:h}))},Ys=qn.Condition.constants,Ws=Ys.allFieldRegExp,Xs=Ys.allExpRegExp,Qs=Ys.expRegExp,Zs={valueType:1,value:""},Js=Kl()(Zs),$s={prefixCls:"kd"},ef=function(e){var t,n=e.className,r=e.locked,a=e.Editor,l=e.Name,o=e.Tips,i=e.field,c=a.NameHidden,u=a.Required,d=a.Title,p=(0,D.useContext)(oe),m=p.invokeAction,v=p.getKdesignerApi,g=p.getExpressionData,y=p.getCompareTypes,C=p.curFormulaTreeApi,h=p.fetchListTree,E=p.setFormulaRules,I=p.getFormulaRules,N=i.ParentId,T=i.Name,x=i.Key,F=(0,D.useState)(!1),S=(0,s.c)(F,2),w=S[0],R=S[1],_=v(),O=_.data,j=(_.meta,O.findControl(N)),L=j._Type_,K=j.Key,U=it(L)?b()(t="".concat(K,".")).call(t,x):x,V=O.getRootId(),G=I(),z=(0,D.useState)((null==G?void 0:G[U])||Js),H=(0,s.c)(z,2),q=H[0],Y=H[1],W=y(),X=(0,D.useMemo)((function(){return g()}),[g]),Q=(0,D.useMemo)((function(){return A()(X.functionOperations)}),[X]),Z=hc({api:C,parser:function(e){return nn(e,e,W)}}),J=(0,D.useMemo)((function(){var e=it(L)?K:void 0;return ui({options:Z,currRefbillTableKey:e})}),[Z,V,K]);(0,D.useEffect)((function(){h("formula")}),[T]);var $=function(e){var t=Kl()(e),n=(0,B.c)(G||{},(0,f.c)({},U,t));Y(t),E(n)},ee=(0,D.useMemo)((function(){return e=function(e){try{if(Xt(e)){var t=JSON.parse(e);return(null==t?void 0:t.value)||""}return""}catch(e){}}(q),t=e?e.split("@@"):["","",null],[(n=(0,s.c)(t,3))[1],n[2]];var e,t,n}),[q]),te=(0,D.useCallback)((function(){R(!0)}),[R]),ne=(0,D.useCallback)((function(){R(!1)}),[R]),re=(0,D.useCallback)((function(){te()}),[te]);return k().createElement(k().Fragment,null,k().createElement(M.NameTipWrapper,{nameHidden:c,className:n,name:l,tips:o,required:u,title:d}),k().createElement(P.ConfigProvider,{value:$s},k().createElement(qn.InputCombo,{fieldType:"formula",placeholder:"请输入",disabled:r,onClick:re,value:ee[0],expressionData:X.functionTypes,fieldData:J,onClear:function(e){e.stopPropagation(),m("deleteBizRule",[{formId:V,fieldKey:U}],[]),$(Zs)},lang:Number(ee[1]||1),readOnly:!0,autofocus:!1})),k().createElement(P.ConfigProvider,{value:$s},w&&k().createElement(qn.Condition,{value:ee[0],language:Number(ee[1]||1),modalTitle:"编辑运算公式",editorTitle:i.Name,visible:w,editorPlaceholder:"请编辑运算公式",fieldData:J,fieldTitle:"表单内容",expressionData:X.functionTypes,operations:Q,defaultExpandAll:!1,onClose:ne,onConfirm:function(e,t){e=function(e,t){var n,r;if(!e)return"";var a=(e=e.replace(/）/g,")").replace(/（/g,"(").replace(/“/g,'"').replace(/”/g,'"').replace(/‘/g,"'").replace(/’/g,"'")).replace(/ {{/g,"{{").replace(/}} /g,"}}").replace(Ws,"$1");return a=a.replace(Xs,(function(e){var t;return((null===(t=e.match(Qs))||void 0===t?void 0:t[1])||"").replace("YMDDATE","DATE")})),b()(n=b()(r="".concat(a,"@@")).call(r,e,"@@")).call(n,t?1:0)}(e,t),$({valueType:1,value:e}),R(!1),qn.WebMsg.showNotificationMsg({param:[{type:0,content:"保存成功。",duration:2e3}]})}})))},tf=k().memo((function(e){var t,n=e.data,r=e.iconIndex,a=e.onSelect,l=e.isLineIconStyle,o=e.prefixClass,i=(0,D.useState)(0),c=(0,s.c)(i,2),u=c[0],d=c[1],p=(0,D.useRef)(null);(0,D.useEffect)((function(){d(r)}),[r]);var m=(0,D.useCallback)((function(e){d(e),null==a||a(e)}),[a,n]);return(0,D.useLayoutEffect)((function(){var e,t,n=null===(e=p.current)||void 0===e?void 0:e.getElementsByTagName("path");n&&(Array.prototype.forEach.call(n,(function(e){return e.removeAttribute("style")})),null===(t=n[u])||void 0===t||t.setAttribute("style","fill:#212121"))}),[u,p.current]),k().createElement("div",{className:"".concat(o,"-popmain")},k().createElement("div",{ref:p,className:"".concat(o,"-icons")},null==n?void 0:T()(t=n.svgs).call(t,(function(e,t){var n=u===t?"#212121":"";return k().createElement("div",{key:t,onClick:function(){return m(t)},className:Vn()((0,f.c)((0,f.c)({},"".concat(o,"-iconf"),l),"".concat(o,"-iconf-active"),l&&u===t)),style:{color:n},dangerouslySetInnerHTML:{__html:e.content}})}))))})),nf=(0,D.memo)((function(e){var t=e.handleChange,n=e.className,r=e.editor,a=e.Name,l=e.Tips,o=e.value,i=r.NameHidden,c=r.Required,u=(0,D.useContext)(oe),d=u.invokeAction,f=u.prefixCls,p=(u.getKdesignerApi,"".concat(f,"-iconPicker-editor")),m=(0,D.useState)({iconIndex:void 0}),v=(0,s.c)(m,2),g=v[0],y=v[1],C=(0,D.useRef)(null),h=(0,D.useState)({}),E=(0,s.c)(h,2),I=E[0],N=E[1];(0,D.useEffect)((function(){d("getSvgLine",[])}),[]);var T=(0,D.useCallback)((function(e){var t,n;N(null==e||null===(t=e.data)||void 0===t?void 0:t.row),S(o,null==e||null===(n=e.data)||void 0===n?void 0:n.row)}),[]);(0,D.useEffect)((function(){return M.eventBus.on(mr,T),function(){M.eventBus.off(mr,T)}}),[]);var x=(0,D.useMemo)((function(){return{name:a,className:n,nameHidden:i,tips:l,required:c}}),[a,n,i,l,c]),A=function(e){var n,r;y({iconIndex:e});var a=encodeURIComponent("#666666"),l=null==I||null===(n=I.svgs)||void 0===n?void 0:n[e].label,o=b()(r="nocode/v2/nocode_sys/common/svgs/create_svg_line?color=".concat(a,"&svg=")).call(r,l);null==t||t(o)},F=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.href).split("?")[1],n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),r=null==t?void 0:t.match(n);return null!=r?unescape(r[2]):null},S=(0,D.useCallback)((function(e,t){var n,r=F("svg",e),a=r&&"undefined"!==r?null==t||null===(n=t.svgs)||void 0===n?void 0:Kr()(n).call(n,(function(e){return e.label===r})):0;y({iconIndex:a})}),[]);(0,D.useLayoutEffect)((function(){var e;if(I&&C.current){null===(e=C.current.getElementsByTagName("path"))||void 0===e||null===(e=e[0])||void 0===e||e.setAttribute("style","fill:".concat("#212121"," "))}}),[I,g,C.current]);var w=(0,D.useMemo)((function(){return k().createElement(tf,{data:I,iconIndex:g.iconIndex,onSelect:A,prefixClass:p,isLineIconStyle:!0})}),[I,g]),R=(0,D.useCallback)((function(e){if(e)S(o,I);else{var n,r,a=encodeURIComponent("#666666"),l=null==I||null===(n=I.svgs)||void 0===n?void 0:n[g.iconIndex].label,i=b()(r="nocode/v2/nocode_sys/common/svgs/create_svg_line?color=".concat(a,"&svg=")).call(r,l);null==t||t(i)}}),[I,g,t]),B=(0,D.useMemo)((function(){var e,t,n=F("svg",o),r=n&&"undefined"!==n?null==I||null===(e=I.svgs)||void 0===e?void 0:Kr()(e).call(e,(function(e){return e.label===n})):0;return k().createElement("div",{ref:C,className:"".concat(p,"-avatar"),dangerouslySetInnerHTML:{__html:(null==I||null===(t=I.svgs)||void 0===t||null===(t=t[r])||void 0===t?void 0:t.content)||""}})}),[I,g,o]);return k().createElement("div",{className:p},k().createElement("div",{className:"".concat(p,"-nav")},k().createElement(M.NameTipWrapper,x)),k().createElement("div",null,k().createElement(P.ConfigProvider,{value:{prefixCls:"kd"}},k().createElement(P.Tooltip,{placement:"bottomLeft",arrow:!1,popperClassName:"".concat(p,"-pop"),gap:0,tip:w,trigger:"click",onVisibleChange:R},B))))}));nf.displayName="IconPickerEditor";var rf=(0,M.ErrorBoundaryWrap)(nf,"IconPickerEditor"),af=(0,D.memo)((function(e){e.handleChange;var t=e.className,n=e.editor,r=(e.locked,e.Name),a=e.Tips,l=e.field,o=(e.id,e.propName,e.rootId),i=n.NameHidden,c=n.Required,u=n.Title,d=(0,D.useContext)(oe),f=d.invokeAction,p=d.getHideFieldRef,m=(0,D.useContext)(M.GlobalConfigContext).showMessage,v=(0,D.useState)(""),g=(0,s.c)(v,2),y=g[0],C=g[1],h=(0,D.useState)([]),b=(0,s.c)(h,2),E=b[0],I=b[1],N=(0,D.useState)({}),x=(0,s.c)(N,2),A=x[0],F=x[1],S=l.BillEntityIdEx,w=l.Key,P=l._Type_,R=l.RefBillId,B="".concat(t,"-association"),_=(0,D.useMemo)((function(){var e,t,n;R&&it(P)&&(t=null===(n=p())||void 0===n?void 0:n[R]);return(null===(e=t)||void 0===e?void 0:e.Key)||w}),[w,P,R]),O=(0,D.useCallback)((function(e){return T()(e).call(e,(function(e){var t=e||{};return{value:t.id,label:t.caption}}))}),[]),j=(0,D.useCallback)((function(e){var t=e||{},n=t.selected,r=t.data,a=O(r||[]);I(a||[]),C(n||"")}),[O]),L=(0,D.useCallback)((function(e,t){f(Cr,[o,_,S,e||""]),C(e)}),[o,_,S,f,C]),K=(0,D.useCallback)((function(e){"failure"===(null==e?void 0:e.state)&&(m((null==e?void 0:e.message)||"双向关联失败","error"),C(""))}),[]);(0,D.useEffect)((function(){o&&_&&S&&f("getAvailableAssociationFields",[o,_,S])}),[S,_,o,f]),(0,D.useEffect)((function(){return M.eventBus.on(yr,j),M.eventBus.on(Cr,K),M.eventBus.on(vr,F),function(){M.eventBus.off(yr,j),M.eventBus.off(Cr,K),M.eventBus.off(vr,F)}}),[]);(0,D.useMemo)((function(){var e=null==A?void 0:A[l.Key];return!S||0===(null==e?void 0:e.length)}),[S,A,l]);return k().createElement("div",{className:"".concat(B,"-box")},k().createElement(M.NameTipWrapper,{nameHidden:i,className:t,name:r,tips:a,required:c,title:u}),k().createElement(qn.Select,{allowClear:!0,value:y,disabled:!1,options:E,onChange:L,placeholder:""}))}));af.displayName="AssociationEditor";var lf=af,of=qn.Condition.constants,cf=of.allFieldRegExp,uf=of.allExpRegExp,df=of.expRegExp,sf={prefixCls:"kd"},ff=function(e){var t=e.className,n=e.locked,r=e.Editor,a=e.Name,l=e.Tips,o=e.field,i=e.handleChange,c=e.value,u=r.NameHidden,d=r.Required,f=r.Title,p=r.HideFunc,m=(r.Type,(0,D.useContext)(oe)),v=m.getKdesignerApi,g=m.getExpressionData,y=m.getCompareTypes,C=m.curFormulaTreeApi,h=m.fetchListTree,E=o.ParentId,I=o.Name,N=(0,D.useState)(!1),T=(0,s.c)(N,2),x=T[0],F=T[1],S=v().data,w=S.findControl(E),R=w._Type_,B=w.Key,_=S.getRootId(),O=y(),j=(0,D.useMemo)((function(){return g()}),[g]),L=(0,D.useMemo)((function(){return A()(j.functionOperations)}),[j]),K=hc({api:C,parser:function(e){return nn(e,e,O)}}),U=(0,D.useMemo)((function(){var e=it(R)?B:void 0;return ui({options:K,currRefbillTableKey:e,needFormatKey:!0})}),[K,_,B]);(0,D.useEffect)((function(){h("formula")}),[I]);var V=(0,D.useMemo)((function(){return t=(e=c)?e.split("@@"):["","",null],[(n=(0,s.c)(t,3))[1],n[2]];var e,t,n}),[c]),G=(0,D.useCallback)((function(){F(!0)}),[F]),z=(0,D.useCallback)((function(){F(!1)}),[F]),H=(0,D.useCallback)((function(){G()}),[G]);return k().createElement(k().Fragment,null,k().createElement(M.NameTipWrapper,{nameHidden:u,className:t,name:a,tips:l,required:d,title:f}),k().createElement(P.ConfigProvider,{value:sf},k().createElement(qn.InputCombo,{fieldType:"formula",placeholder:"请输入",disabled:n,onClick:H,value:V[0],expressionData:j.functionTypes,fieldData:U,onClear:function(e){e.stopPropagation(),i("")},lang:Number(V[1]||1),readOnly:!0,autofocus:!1})),k().createElement(P.ConfigProvider,{value:sf},x&&k().createElement(qn.Condition,{value:V[0],language:Number(V[1]||1),modalTitle:"编辑目标链接",editorTitle:"目标链接",visible:x,hideFunc:p,editorPlaceholder:"请输入完整链接，以 http:// 或 https:// 开头",fieldData:U,fieldTitle:"表单内容",expressionData:j.functionTypes,operations:L,defaultExpandAll:!1,onClose:z,onConfirm:function(e,t){e=function(e,t){var n,r;if(!e)return"";var a=(e=e.replace(/）/g,")").replace(/（/g,"(").replace(/“/g,'"').replace(/”/g,'"').replace(/‘/g,"'").replace(/’/g,"'")).replace(/ {{/g,"{{").replace(/}} /g,"}}").replace(cf,"$1");return a=a.replace(uf,(function(e){var t;return((null===(t=e.match(df))||void 0===t?void 0:t[1])||"").replace("YMDDATE","DATE")})),b()(n=b()(r="".concat(a,"@@")).call(r,e,"@@")).call(n,t?1:0)}(e,t),i(e),F(!1)}})))},pf=function(){var e=[];return[[gc,"switchtabsel",""],[pa,"customoption",""],[Oc,"selectoption",""],[Hc,"datascope",""],[Yd,"Tab",""],[eu,"picturedef",""],[_d,"refbilltype",""],[Zc,"refbillprops",""],[du,"dataFill",""],[gu,"inputrange",""],[yu,"DateRange",""],[hu,"date",""],[Su,"decimaldef",""],[Iu,"attachdef",""],[wu,"backcolor"],[Ou,"backimage"],[ud,"displayrule"],[qs,"bizrule"],[ef,"formularule"],[ff,"expression"],[dd,"textdef",""],[vd,"triggerprocess"],[Dd,"enablefilter"],[ms,"inputContent"],[wd,"richtextdef"],[jd,"margin"],[Gd,"inputForm"],[qd,"mulrefbilldef"],[rf,"iconPicker",""],[lf,"association"]].forEach((function(t){var n=(0,s.c)(t,3),r=n[0],a=n[1],l=n[2];e.push([a,r,l])})),e};function mf(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function vf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mf(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):mf(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var gf={BizappId:"bizappId",Name:"name",Id:"id",appNum:"formId",Key:"key",EntityId:"rootEntityId"},yf=function(e,t){m()(t).forEach((function(n){_r()(e,n)||(0,B.c)(e,(0,f.c)({},n,t[n]))}))},Cf=function(e){return(0,Ct.produce)(e,(function(e){e.forEach((function(t){(function(e){return e._Type_===Ke&&!e.GroupParentId&&!e.GroupIndex&&!e.isTab})(t)&&(t.GroupParentId=(0,M.createUUid)(),t.GroupIndex=0,g()(e).call(e,(function(e){return e.ParentId===t.Id&&function(e){return e._Type_===Ke&&!e.GroupParentId&&!e.GroupIndex&&e.isTab}(e)})).forEach((function(e,n){e.GroupParentId=t.GroupParentId,e.GroupIndex=n+1,e.ParentId=t.ParentId})))}))}))},hf=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,De.cloneDeep)(e),r=n.formmeta,a=n.entitymeta,l={},o={},i=r.Items[0].Id,c=[i],u=new(Pe()),d={},p=I()(t).reduce((function(e,t){return vf(vf({},e),(n=t,l=(0,s.c)(n,2),o=l[0],i=l[1],c=null==i||null===(r=i.formmeta)||void 0===r||null===(r=r.Items)||void 0===r?void 0:r.reduce((function(e,t){return Ta(Ta({},e),{},(0,f.c)({},t.Id,t))}),{}),null==i||null===(a=i.entitymeta)||void 0===a||null===(a=a.Items)||void 0===a?void 0:a.reduce((function(e,t){var n;return Ta(Ta({},e),{},(0,f.c)({},b()(n="".concat(t.Key,"_")).call(n,o),Ma((null==c?void 0:c[t.Id])||{},t)))}),{})));var n,r,a,l,o,i,c}),{});m()(r).forEach((function(e){r[e]&&gf[e]&&(l[gf[e]]=r[e])}));var v=r.Items.reduce((function(e,t){var n,r=t||{},a=r._Type_,l=r.Id,o=r.FieldType;return Vt(a)&&c.push(l),ot(o)||it(o)?b()(n=[]).call(n,(0,R.c)(e),[l]):e}),[]),y=a.Items.reduce((function(e,t){var n,r=t||{},a=r._Type_,l=r.Id,o=r.SourceForm,s=r.ParentId||i;return d[l]=t,it(a)&&"2"===o&&u.set(l,t),it(a)&&Fa(t)&&S()(c).call(c,s)?b()(n=[]).call(n,(0,R.c)(e),[t.Id]):e}),[]);return l[z]=Cf(r.Items.reduce((function(e,t){var n=vf({},t);if(null!=n&&n.ParentId){var l=n.FieldId||n.EntryId||n.CardEntryId,s=null==d?void 0:d[l];s&&(n.EntityData=s,n.ApType=n._Type_,n._Type_=s._Type_,n.FieldType=s._Type_,yf(n,s))}else{var f,m=Ae()(f=a.Items).call(f,(function(e){return(null==e?void 0:e.Id)===n.Id}));m&&(n.EntityData=m,yf(n,m))}var C=n.ParentId,h=n.Key,E=n.EntityData;n._isEntryField_&&delete n._isEntryField_,S()(v).call(v,C)&&(n._isEntryField_=!0);var I,N=n.ParentId||i;if(S()(c).call(c,N)&&Fa(n)||S()(y).call(y,N))return o[n.Id]=n,e;if(u.has(C)){var T,x,A=h.toLowerCase().replace("_".concat(C.toLowerCase()),"")+"_"+u.get(C).BillEntityIdEx,F=p[A];if(F){var D,k=[{},{}];Qe.forEach((function(e){n[e]&&(k[0][e]=n[e]),E[e]&&(k[1][e]=E[e])}));var M=Ra(F,C,k);return delete(t=vf({},M)).EntityData,d[M.Id]=M.EntityData,b()(D=[]).call(D,(0,R.c)(e),[M])}return a[z]=g()(T=a[z]).call(T,(function(e){return e.Id!==n.Id})),r[z]=g()(x=r[z]).call(x,(function(e){return e.Id!==n.Id})),e}return b()(I=[]).call(I,(0,R.c)(e),[n])}),[])),a.Items=A()(d),[l,o,n]},bf=function(e,t){var n,r,a=e||{},l=a._Type_,o=a.EntityData,i=void 0===o?{}:o,c=a.ApType,u=vf({},e);c&&(u._Type_=c);var d=b()(n=g()(r=m()(i)).call(r,(function(e){return t.getControlMetaProperty(l,e).Tag===_e}))).call(n,["EntityData","ApType","_isEntryField_"]);return d.forEach((function(e){delete u[e]})),u},Ef=function e(t,n){return t.reduce((function(t,r){var a,l=r.Id;return n[l]?b()(t).apply(t,b()(a=[r]).call(a,(0,R.c)(e(n[l],n)))):b()(t).call(t,r)}),[])},If=function(e,t,n,r){var a=n.meta,l=e.entitymeta,o=e.formmeta,i=t.Items,c=void 0===i?[]:i,u=c.reduce((function(e,t){var n=t.ParentId;return void 0!==n&&(void 0===e[n]?e[n]=[t]:e[n].push(t)),e}),{}),d=Ef([c[0]],u),s=d.reduce((function(e,t){var n=t.Key,a=t.EntityData;t.Id;if(a){var l,o,i=vf(vf({},a),{},{Key:n});if(it(i._Type_)){var c,u,d,s=vf({},null===(c=r[i.RefBillId])||void 0===c?void 0:c.EntityData);return s.Key=null===(u=r[i.RefBillId])||void 0===u?void 0:u.Key,b()(d=[]).call(d,(0,R.c)(e),[i,s])}var f=null==r||null===(l=r[null==i?void 0:i.RefTableId])||void 0===l?void 0:l.EntityData;if(et(i._Type_)&&null!=i&&i.RefTableId&&f){var p,m=A()(r).reduce((function(e,t){var n;return t.ParentId===(null==i?void 0:i.RefTableId)?b()(n=[]).call(n,(0,R.c)(e),[t.EntityData]):e}),[]);return b()(p=[]).call(p,(0,R.c)(e),[i,f],(0,R.c)(m))}return b()(o=[]).call(o,(0,R.c)(e),[i])}return e}),[]),f=d.reduce((function(e,t){var n,l=t||{},o=l.RefTableId,i=l.FieldType,c=l.RefBillId,u=bf(t,a);if(it(i)){var d,s=bf(r[c],a);return b()(d=[]).call(d,(0,R.c)(e),[u,s])}var f=null==r?void 0:r[o];if(et(i)&&o&&f){var p,m=A()(r).reduce((function(e,t){var n;return t.ParentId===o?b()(n=[]).call(n,(0,R.c)(e),[bf(t,a)]):e}),[]);return b()(p=[]).call(p,(0,R.c)(e),[u,bf(f,a)],(0,R.c)(m))}return b()(n=[]).call(n,(0,R.c)(e),[u])}),[]),p=vf(vf({},o),{},{Items:f}),m=vf(vf({},l),{},{Items:s});return(0,B.c)(e,{formmeta:p,entitymeta:m})},Nf=function(e){var t=e.kdesignerApi,n=e.keywordMapping;return function(e,r,a,l){var o=t.current.meta,i="string"==typeof r?r:r[n.type],c=o.getControlMeta(i)||{},u=c.BaseType,d=c.ApType,s=null==d?void 0:d.Default,f="string"==typeof e?e:e[n.type],p=o.getControlMeta(f)||{},m=p.BaseType,v=p.ApType,g=p.Id,y=v?(null==v?void 0:v[u])||(null==v?void 0:v.Default):g;if(!l.IsContainer)return!1;var C=function(e){var t=o.getControlMeta(e).NotAccept;if(t){var n=t.Ids;return null==n?void 0:S()(n).call(n,y)}}(i);if(C)return{message:"控件类型不符合，不能添加。",success:!1};if(!(C=function(e){var t=o.getControlMeta(e).Accept;if(!t)return!0;if(t){var n=t.Basetypes,r=t.Ids;return(null==r?void 0:S()(r).call(r,y))&&(null==n?void 0:S()(n).call(n,m))}}(i)))return{message:"控件类型不符合，不能添加。",success:!1};return!!(C=function(e){var t=o.getControlMeta(e).AcceptParent;if(!t)return!0;if(t){var n=t.Basetypes,r=t.Ids;return(null==r?void 0:S()(r).call(r,s))||(null==n?void 0:S()(n).call(n,u))}}(f))||{message:"父容器类型不符合,不能添加。",success:!1}}},Tf=["property"],xf={},Af=(0,D.memo)((function(e){var t=e.tabName,n=e.tabKey;if(!S()(Tf).call(Tf,n))return t;var r=(0,D.useContext)(oe),a=r.getKdesignerApi,l=r.prefixCls,o=(0,D.useMemo)((function(){return a()}),[]),i=o.error,c=o.meta,u=o.data,d=o.selection,f=i.getError(),p=d.getSelection(),v=(0,D.useState)(!1),g=(0,s.c)(v,2),y=g[0],C=g[1],h=(0,D.useState)([]),b=(0,s.c)(h,2),E=b[0],I=b[1];(0,M.useErrorChangeForceUpdateEffect)(o),(0,M.useSelectionChangeForceUpdateEffect)(o),(0,D.useEffect)((function(){var e;if((null==p?void 0:p.length)>0&&(null===(e=m()(f))||void 0===e?void 0:e.length)>0){var t=p.some((function(e){var t=u.findControl(e)._Type_,n=c.getControlMetaPropertyGroups(t);if(f[e]){var r=m()(f[e]);if(I(r),r.length>0){var a=xf[t];a||(a=[],n.forEach((function(e){null!=e&&e.Nodes&&(null==e||e.Nodes.forEach((function(e){a.push(e.Id)})))})),xf[t]=a);var l=r[0];return S()(a).call(a,l)}}return!1}));C(t)}else y&&C(!1)}),[p,f]);var N=(0,D.useMemo)((function(){return 0===(null==E?void 0:E.length)?"":"存在有".concat(null==E?void 0:E.length,"条错误，请修复后再发布！")}),[E]);return k().createElement("div",{className:"".concat(l,"_customtab")},k().createElement("span",{className:"".concat(l,"_customtab_name")},t),y&&k().createElement(P.Tooltip,{tip:N},k().createElement(wo,{className:"".concat(l,"_customtab_icon")})))}));Af.displayName="CustomTab";var Ff=Af;r(3192);function Sf(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Df(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sf(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Sf(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}var kf={appFormList:[],innerForm:[]},Mf=(0,Ct.produce)((function(e,t){var n,r,a=t.key,l=t.payload,o=(null==e?void 0:e[null==l?void 0:l.form])||{},i=o.data,c=void 0===i?{}:i,u=o.ids,d=void 0===u?[]:u,s=c||{},f=s.entitymeta,p=void 0===f?{Items:[]}:f,m=s.formmeta,v=void 0===m?{Items:[]}:m;switch(a){case Ur:for(var y in l){var C;if(Object.prototype.hasOwnProperty.call(l,y))e[y]={data:l[y],ids:T()(C=l[y].entitymeta.Items).call(C,(function(e){return e.Id}))}}break;case Vr:e[l.form]=l.info;break;case zr:if(null==d||!S()(d).call(d,l.data.Id)){var h,b;l.data.ParentId=S()(h=l.form).call(h,"_table")?l.data.ParentId:l.form,l.data.EntityData.ParentId=S()(b=l.form).call(b,"_table")?l.data.EntityData.ParentId:l.form;var E=Df({},l.data);delete E.EntityData,null!=e&&e[null==l?void 0:l.form]?(p.Items.push(l.data.EntityData),v.Items.push(E)):e[l.form]={data:{entitymeta:{Items:[l.data.EntityData]},formmeta:{Items:[E]}},ids:[]}}break;case Hr:p.Items=g()(n=p.Items).call(n,(function(e){return e.Id!==l.id})),v.Items=g()(r=v.Items).call(r,(function(e){return e.Id!==l.id}));break;case Gr:p.Items.some((function(e){return e.Id===l.id&&(e=(0,B.c)(e,l.data),!0)})),v.Items.some((function(e){return e.Id===l.id&&(e=(0,B.c)(e,l.data),!0)}));break;case qr:e.appFormList=l.data,e.innerForm=l.innerForm;break;case"COPY_FORM_DATA":e[l.form]=Df({},e[l.source])}}));function wf(){var e=[],t=[],n=1,r=0,a={setData:function(e){if(e){var n=t;t=e,a.fireEvent({value:t,oldValue:n})}},getData:function(){return t},getDataVersion:function(){return r},setDataVersion:function(e){r=e},increaseVersion:function(){n++},getVersion:function(){return n},isVersionEqual:function(){return n===r},addDataChangeListener:function(t){return e.push(t),function(){e=g()(e).call(e,(function(e){return e!==t}))}},fireEvent:function(t){e.forEach((function(e){try{e(t)}catch(e){}}))}};return a}function Pf(e,t){var n=m()(e);if(o()){var r=o()(e);t&&(r=g()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pf(Object(n),!0).forEach((function(t){(0,f.c)(e,t,n[t])})):d()?Object.defineProperties(e,d()(n)):Pf(Object(n)).forEach((function(t){Object.defineProperty(e,t,c()(n,t))}))}return e}(0,Ct.enableES5)(),M.ControlView.tabName="内容";var Bf={id:"Id",type:"_Type_",name:"Name",key:"Key",parentId:"ParentId",items:"Items",fieldType:"FieldType",EntityData:"EntityData"},_f=function(e,t){return Rf(Rf({},e),t)},Of=function e(t){return t.reduce((function(t,n){var r=n.selectable,a=n.children,l=n.value,o=n.label;return!1!==r&&(t[l]=o),null!=a&&a.length?Rf(Rf({},t),e(a)):t}),{})},jf=(0,D.memo)((0,D.forwardRef)((function(e,t){var n=e.data,r=void 0===n?{}:n,l=e.meta,o=void 0===l?{}:l,i=e.onData,c=e.settingData,u=e.showMessage,d=void 0===u?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warning";P.Message[t]({content:e,closable:"error"===t,duration:2e3,style:{background:"#fff",borderColor:"#fff",color:"#212121",boxShadow:"0 4px 10px 1px rgba(0,0,0,0.12)"}})}:u,p=(e.handleCustomInputEditor,e.invokeAction),v=void 0===p?function(e,t,n){}:p,y=e.enforceInvokeAction,h=void 0===y?function(e,t,n){}:y,E=e.baseHooks,N=e.baseUrl,x=e.onApi,F=e.onDownLoad,w=e.addControlAction,R=e.getControlText,B=e.batchInvoke,_=e.floatMenu,O=e.defaultFieldStatusMap,j=void 0===O?{}:O,L=e.fieldStatusSettingMode,K=void 0!==L&&L,U=e.fieldStatusSettingOptions,V=e.expression,G=void 0===V?[]:V,z=e.refBillData,H=void 0===z?[]:z,q=e.tableMetas,Y=void 0===q?[]:q,W=e.compareTypes,X=void 0===W?{}:W,Q=e.ncpToolKits,Z=void 0===Q?{}:Q,J=(0,D.useState)(!0),$=(0,s.c)(J,2),ee=$[0],te=$[1],ne=(0,D.useRef)(null),re=(0,D.useRef)(r),ae=(0,D.useRef)({}),le=(0,D.useRef)([]),ie=(0,D.useReducer)(Mf,kf),ce=(0,s.c)(ie,2),ue=ce[0],de=ce[1],se=(0,D.useRef)({}),fe=(0,D.useRef)(null),pe=(0,D.useRef)(Lt(r,o)),me=(0,D.useRef)(function(e){var t,n=e.formmeta,r=null==n||null===(t=n.Items)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.BillNoSetting;return r?JSON.parse(r):{}}(r)),ve=(0,D.useRef)(Kt(r,"displayRules")||[]),ge=(0,D.useRef)(Kt(r,"bizRules")||[]),ye=(0,D.useRef)(Kt(r,"formulaRules")||{}),Ce=(0,D.useReducer)(_f,j||{}),he=(0,s.c)(Ce,2),be=he[0],Ee=he[1],Ie=(0,D.useRef)(wf()),Ne=(0,D.useRef)(wf()),Te=(0,D.useCallback)((function(e){return e}),[]),xe=(0,D.useMemo)((function(){return function(e,t){return(0,M.adaptorMeta)(e,(0,M.mergeTransformKeyMap)(M.transformKeyMap,(0,f.c)({},"items",["Enum"])),t)}(o,r.formmeta)}),[]),Ae=(0,D.useMemo)((function(){var e=Y.reduce((function(e,t){return null!=t&&t.billEntityIdEx?Rf(Rf({},e),{},(0,f.c)({},t.billEntityIdEx,t.data)):e}),{}),t=hf(r,(0,De.cloneDeep)(e)),n=(0,s.c)(t,3),a=n[0],l=n[1],o=n[2];return ae.current=l,re.current=o,null==i||i(o),m()(e).length&&de({key:Ur,payload:e}),a}),[r,Y]);(0,D.useEffect)((function(){se.current=ue}),[ue]);var Fe=(0,D.useCallback)((function(){return(0,De.cloneDeep)(ae.current)}),[]),Se=(0,D.useCallback)((function(e){ae.current=e}),[]),ke=(0,D.useCallback)((function(e){var t=(null==c?void 0:c[e])||{},n=t.value,r=t.items,a=void 0===r?[]:r;return!n||m()(a).reduce((function(e,t){return!1===a[t].value&&e.push(t),e}),[])}),[c]),Me=(0,D.useCallback)((function(e){(0,Z.publishUserEvent)(Rf({appId:Ae.bizappId,formId:Ae.id},e))}),[Z]),we=(0,D.useCallback)((function(e){switch(e){case"main":return{main:Qo};case"left":return{control:M.ControlView,systemCategories:Ki,outline:Ci};case"right":return{property:Ii};default:return{}}}),[]),Pe=(0,D.useMemo)((function(){return{showMessage:d,getViews:we,processPropertyName:Te,keywordMapping:Bf,enableSearch:!0,enableError:!0,dataPortalIdPrefix:"nocode-designer-top-view",controlViewSetting:{className:"".concat(Re,"-control-view"),hideHelpIcon:!0,hideAnchorIcon:!0,hideTitleTips:!0,searchInputPlaceholder:"内容",filterCategories:function(e){return g()(e).call(e,(function(e){var t;return!(null!=e&&null!==(t=e.Id)&&void 0!==t&&C()(t).call(t,"System_"))}))},handleItemClick:function(){Me({eventName:"click",action:"fd_add_click"})},getEmptyView:function(){return k().createElement(k().Fragment,null,k().createElement("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOAAAACACAMAAAAlB5WJAAAAjVBMVEUAAADh4uvY3+rZ3erb3enY3+rX3ufZ3e3X3OfZ3Ord3uTX3efY3urX4uvX3efW3OjZ4Onb4Ovj6fPj6fPX3ejn7/bk6PPi5/Tj6fTj6fPj6fTk6fXj6PTi6PTi6PTj5/Ti6fPj6fTk6PTj6fPh5fLj6fPj6vPi6PPk6fXL0NzX3Oji6PPi6PPK0NvX3ehGj5HoAAAALHRSTlMAGhcSJSwiCTIOBj4oDDlENUbD7UoreU7ixq6gh1vMPd3SkfFmgG2ZZvD3u03m2McAAAUISURBVHja7NgLjpswFAVQvxlCKoiSgMdg/oSQTKTe/a+vlaoKw5BOAFV6RpwdWLbv+4jNZrPZbDb/hYqjLLxoCUh9CbMoVmI91D2V+EKm91Uc0rnVeKq+OcJuRYJvJIWwlveo8YL64QkrFRov0jbeogoxQWhb3ng5JsqteqdOiclKiwI1lphBxsISEWaKhBUazNYI/rwUo2Sat8F557q7c9DmqcSolH/UpBhRRhUNVFGJEalgrsEX16aiUVVzte6VRhiS+YGeOuTSrqSJMZQp+ieVYYhxtXAk+nRM34o1+iTbiu+V6EsUvUAl6Cu5RmmOvsyll7gZ+nLBkkJfRC+L0MdztgjRU9AEBXpCwVAxcn+z75DhBOxpmDKaKINJ88uZB0yJSxO5CUwPwU0Ng1Y0mdIw1IKZAqaYZohZ/8Jk5AMu+oaJYMWBQSqaRUkYeDVsNxhymimH4SY4MSPmeqCZDleuMaNgaGi2hmu/doehotkqGO6CjxSdkhYoma5n5PMmdH5LKgUbatELNVU8P2GMjqRFJMvlTIROSoukLPdr2ViVX17rM8FFiE5Li7Qs5/oLOgEtEqBzEVxodM60yBkdLbiQ6OxokR3LQgiDS4u4MAguVn/AdT/R/fvbekPm3Tl+/KZXWibI//jjsspC/+YHf/1cY6u2Czqf62u298eToTemumsYl/b+yVTA0Dr2D7z7o99zuqLz+eFav7L44Q+EZrjHJ9uXTq4/1MDQxke714a/2rn73kZBOIDjPx5EFLWP197tMb3dXdOO7v2/vMOwNLhpCxQWR/xgNPOvfdPELRWoRSPU0TTvV+VRGu62W/qtv/itms/M/2VetmsR7av7HLOK84qhHGLJ5z320nC/XtMoL18KKtZnoiogCsZNcz5XB9/K7kfYRHh9VvD1B5xABCqqM7SdNNwtZsFfgJbZokdWQmg177WRpn8zGvgVdiFmvQSBYPKiyAFw1ov/7E7C42EnIWAxG4IhCMJ0CK2yfn+l6UkEnUaCZmImhDp16HtBCkmVXcNX0nQXciIQERcRuBWqLGyiTeXKG3FZHrtPe4o1GS8TlzUZ3ARTO9tI0ylJcxWGG+TU1j7OhNisuYrDDRCzRXcxpjSTuQUC3nLGkO14fokwKZ1yCxV4IwgxpOjzleufCMsKuBXwhhHSn49xGfwZPdy+MOTIwUS4FeIfiDHCSB3nqzZw//7WpT1vp0OnEGVWUEna34KU7oGOvBZnmX2nbiHL3LA6ciDyWl5n9rWFz6+r3QZaNHPFwAlxtpdedJ92lK1l3QZWzmgeN5A8SE/Hk/Ym5bmQ+ihdAgvnQR49Fynzg9mnC6kPBvYKHz88l5nzg+4zCinzGQSs1V7Ib+lIbxSgClWfWZgxL2At9+S51QM/yq6niiGPkUcP9Nys41lqZiFSGHI7Y7BVevLcbuVVfvKLIifhAqEEUKdevhvmrGRfIXYHXuJvebSTg4UIu5zBS/xNqzb9HzPDCsFE0ResxxnB7T3jCn7ibzu2HCg8R+lIQ/8dGKt6oBCRy75N4HBhYSLqUEPruw/jNVxobdyBg4W4dgBjNlC4xLk9GLWhQpJK4HBhaWl8y9QtC0f8+A9UOOrHY5DCcT8fp0KLwj0kY6AQQzL6CxeQjt7CChLyXjjiXS6CF64ySMuHwtUcUlMv0+5rC9PuawvT7msL0+5Thfv270Nqz88OvEjq7/tkMplMJl/uP6GQwUEv7e1KAAAAAElFTkSuQmCC",alt:"搜索无结果",className:"".concat(Re,"-control-empty-img")}),k().createElement("span",{className:"".concat(Re,"-control-empty-img")},"暂无搜索结果"))},hideItemView:ke("Categories"),onDragStart:function(e,t,n){yn(e,t,n)}},propertyViewSetting:{className:"".concat(Re,"-property-view"),hideItemView:ke("Property")},getOutlineItemIcon:function(e){return k().createElement(P.Icon,{prefix:"designericon",type:mn(e),className:"nocode-designer-control-icon"})},canAddCallback:Nf({showMessage:d,kdesignerApi:ne,keywordMapping:Bf}),preHandle:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return mc.apply(void 0,b()(t).call(t,[Rf(Rf({},ne.current||{}),{},{billPropsData:se.current,invokeAction:v,getHideFieldRef:Fe,setHideFieldRef:Se,dispatchBillData:de})]))},getPropertyEditors:pf,filterProperty:so,renderCustomTab:function(e,t){return k().createElement(Ff,t)}}}),[d,we,Te,pf,ke,Fe,Se,de]),Be=(0,D.useCallback)((function(){return pe.current}),[]),_e=(0,D.useCallback)((function(e){pe.current=e,re.current.sysSetting=e;var t=Ie.current.increaseVersion,n=Ne.current.increaseVersion;t(),n()}),[]),Oe=(0,D.useCallback)((function(){return me.current}),[]),je=(0,D.useCallback)((function(e){me.current=e,re.current.billNoSetting=e;var t=Ie.current.increaseVersion,n=Ne.current.increaseVersion;t(),n()}),[]),Le=(0,D.useCallback)((function(){return ve.current}),[]),Ke=(0,D.useCallback)((function(e){ve.current=e}),[]),Ue=(0,D.useCallback)((function(){return ge.current}),[]),Ve=(0,D.useCallback)((function(e){ge.current=e}),[]),Ge=(0,D.useCallback)((function(){return ye.current}),[]),ze=(0,D.useCallback)((function(e){ye.current=e}),[]),He=(0,D.useCallback)((function(){return ee?"pc":"mobile"}),[ee]),qe=(0,D.useCallback)((function(e,t){var n=(0,De.cloneDeep)(se.current),r=I()(n).reduce((function(e,t){var n;return null!==(n=t[1])&&void 0!==n&&n.data?Rf(Rf({},e),{},(0,f.c)({},t[0],t[1].data)):e}),{}),a=hf(e,r),l=(0,s.c)(a,3),o=l[0],i=l[1],c=l[2];ae.current=i,re.current=c,null==t||t.data.resetData(o,!1)}),[]),Ye=(0,D.useCallback)((function(e,t){M.eventBus.emit(e,t)}),[]),We=(0,D.useCallback)((function(e){ne.current=Rf(Rf({},e),{},{originApi:e,selection:Rf(Rf({},e.selection),{},{getActiveSelectedId:function(){return e.selection.getActiveSelectedId()||e.data.getRootId()}}),controlCacheApi:a}),x({kdesignerApi:ne.current,getDesignerClientType:He,fieldStatusMap:be,resetDesignerData:qe,getSystemSetting:Be,getBillnoSetting:Oe,getDisplayRules:Le,getBizRules:Ue,getFormulaRules:Ge,pubEvent:Ye})}),[x,He,be]),Xe=(0,D.useCallback)((function(e,t){re.current=If(re.current,e,ne.current,ae.current),re.current.sysSetting=Be(),re.current.billNoSetting=Oe(),re.current.setting=c,i&&i(re.current,t);var n=Ie.current.increaseVersion,r=Ne.current.increaseVersion;n(),r()}),[c]);(0,D.useEffect)((function(){x({kdesignerApi:ne.current,fieldStatusMap:be,getDesignerClientType:He,resetDesignerData:qe,getSystemSetting:Be,getBillnoSetting:Oe,getBizRules:Ue,getDisplayRules:Le,getFormulaRules:Ge,pubEvent:Ye})}),[He,be]),(0,D.useEffect)((function(){var e=null==Ae?void 0:Ae.id;h("listtreeconfig",[e,"formula"])}),[]),(0,D.useEffect)((function(){return M.eventBus.on(cr,Ke),M.eventBus.on(ur,Ve),function(){M.eventBus.off(cr,Ke),M.eventBus.off(ur,Ve)}}),[]);var Qe=function(e){var t=null==Ae?void 0:Ae.id,n=e.args,r=e.data,a=n||{},l=a.formId,o=a.param,i=(void 0===o?{}:o).sourceType;if(""===l||l===t){var c="formula"===i?Ie.current:Ne.current,u=c.setData,d=c.setDataVersion,s=c.getVersion;u(r),d(s())}};(0,D.useEffect)((function(){return M.eventBus.on(ir,Qe),function(){M.eventBus.off(ir,Qe)}}),[]);var Ze=(0,D.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";window.requestAnimationFrame((function(){var t="formula"===e?Ie.current:Ne.current,n=t.isVersionEqual,r=t.getVersion;if(!n()){var a=null==Ae?void 0:Ae.id;if(1!==r()){var l="formula"===e?["","formula"]:[""],o=[{nocodeformdesigner:re.current}];v("listtreeconfig",l,o)}else{v("listtreeconfig","formula"===e?[a,"formula"]:[a])}}}))}),[]);(0,D.useEffect)((function(){if(null!=H&&H.children){var e=H.children,t=void 0===e?[]:e;t[0].icon=k().createElement(P.Icon,{prefix:"nocodeplatformicon",type:"gerenzhongxin",style:{color:"#3987ED"}}),t[1].icon=k().createElement(P.Icon,{prefix:"nocodeplatformicon",type:"zuzhi",style:{color:"#3987ED"}});var n=Aa(t),r=(0,s.c)(n,2),a=r[0],l=r[1];de({key:qr,payload:{data:a,innerForm:l}})}}),[H]);var Je=(0,D.useMemo)((function(){return Of((null==H?void 0:H.children)||[])}),[H]),$e=(0,D.useRef)({getKdesignerApi:function(){return ne.current},getExpressionData:function(){return G},getRefBillData:function(){return H},getRefBillNameMap:function(){return Je},getCompareTypes:function(){return X},getDataRef:function(){return re.current},getCurrentRefBillPropsData:function(){return le.current},getDisplayRules:Le,getBizRules:Ue,getFormulaRules:Ge,setCurrentRefBillPropsData:function(e,t){le.current[e]=t},fetchListTree:Ze,curFormulaTreeApi:Ie.current,curListTreeApi:Ne.current,getSystemSetting:Be,setSystemSetting:_e,getBillnoSetting:Oe,setBillnoSetting:je,setDisplayRules:Ke,setBizRules:Ve,setFormulaRules:ze,getHideFieldRef:Fe,setHideFieldRef:Se,showMessage:d,invokeAction:v,baseUrl:N,prefixCls:Re,getPrefixCls:function(e,t,n){var r;return n||(e=e||Re,t?b()(r="".concat(e,"-")).call(r,t):e)},getBaseHooks:function(e){return(null==E?void 0:E[e])||function(){}},onDownLoad:F,addControlAction:w,getControlText:R,batchInvoke:B}),et=(0,D.useMemo)((function(){return Rf({isPC:ee,setIsPC:te,floatMenu:_,fieldStatusSettingMode:K,fieldStatusSettingOptions:U,fieldStatusMap:be,billPropsData:ue,pubUIAction:Me,dispatchFieldStatus:Ee,dispatchBillData:de},$e.current)}),[ee,K,_,U,be,ue,Me,de]),tt=(0,D.useCallback)((function(){var e,t=T()(e=A()(we("right"))).call(e,(function(e){return(null==e?void 0:e.tabKey)||""})),n=ke("Property");return ne.current&&!0!==n?g()(t).call(t,(function(e){return!0})):t}),[ke]),nt=(0,D.useCallback)((function(){var e,t=T()(e=A()(we("left"))).call(e,(function(e){return(null==e?void 0:e.tabKey)||""})),n=ke("Categories");return!0===n?t:g()(t).call(t,(function(e){return null==n||!S()(n).call(n,e)}))}),[ke]);return(0,D.useEffect)((function(){var e=function(){var e=ne.current.views,t=e.getViewVisibleKeys("left"),n=e.getViewVisibleKeys("right"),r=nt(),a=tt();(0,De.isEqual)(r,t)||e.setViewsVisibleSetting("left")(r),(0,De.isEqual)(a,n)||e.setViewsVisibleSetting("right")(a)},t=ne.current.selection.addSelectChangeListener(e);return e(),function(){t&&t()}}),[c]),k().createElement(k().Fragment,null,k().createElement(P.ConfigProvider,{value:{prefixCls:"kdesigner"}},k().createElement(oe.Provider,{value:et},k().createElement(Lf,{className:"".concat(Re,"-root"),ref:fe,globalConfig:Pe,onData:Xe,meta:xe,data:Ae,onApi:We}))))}))),Lf=w();jf.displayName="NoCodeDesigner";var Kf=jf}}]);