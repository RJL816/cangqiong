"use strict";(self.webpackChunknocode_designer=self.webpackChunknocode_designer||[]).push([[724],{5724:function(e,t,n){n.r(t),n.d(t,{NoCodeDesigner:function(){return Df}});var r={};n.r(r),n.d(r,{addCache:function(){return _o},addControlCache:function(){return Lo},clearCache:function(){return jo},deleteControlCache:function(){return Uo},getControlCache:function(){return Ko},hasCache:function(){return Oo},hasControlCache:function(){return Vo}});var a=n(4716),l=n.n(a),o=n(4884),i=n.n(o),c=n(7435),u=n.n(c),d=n(8264),s=n(2992),f=n(3939),p=n.n(f),m=n(696),v=n.n(m),g=n(1908),y=n.n(g),C=n(760),h=n.n(C),E=n(2581),b=n.n(E),I=n(3992),N=n.n(I),T=n(2400),x=n.n(T),A=n(524),F=n.n(A),S=n(5984),D=n.n(S),k=n(8040),M=n.n(k),w=n(3548),P=n(5992),R=n(2664),B="Id",_="FieldType",O="FieldId",j="EntryId",L="_Type_",K="Value",V="Label",U="ParentId",G="Items",z="Bgc",H="data-control-id",q="data-drag-id",Y="data-drag-over",W="data-selection",X="data-mouse-over",Z="data-cut-control",Q="data-is-dragging",J="data-right-drag-style",$="data-drag-direction",ee="data-outline-drag-tree-node",te="data-change-name",ne=function(e){return e?(0,s.c)({},H,null==e?void 0:e[B]):{}},re=n(6428),ae=n.n(re),le=D().createContext({});le.displayName="DesignerContext";var oe=function(e){var t=(0,S.useContext)(le),n=(t.prefixCls,t.getKdesignerApi),r=(t.invokeAction,t.fieldStatusSettingMode),a=(0,S.useMemo)((function(){return n()}),[]),l=a.selection,o=a.data,i=l.setSelect,c=(0,S.useMemo)((function(){return o.getRootId()}),[]),u=((0,S.useRef)(null),(0,S.useRef)(null),(0,S.useCallback)((function(e){var t;e.stopPropagation();var n=e.currentTarget.dataset,a=n.controlId,l=n.enableClick;if(!r||c!==a&&"false"!==l){var o=document.querySelectorAll(h()(t="[".concat(H,'="')).call(t,a,'"]'))[0];null==o||o.setAttribute(X,"true")}}),[r])),d=(0,S.useCallback)((function(e){var t;e.stopPropagation();var n=e.currentTarget.dataset.controlId;document.querySelectorAll(h()(t="[".concat(H,'="')).call(t,n,'"]'))[0].removeAttribute(X)}),[]);return{onMouseOver:u,onMouseOut:d,onContextMenu:function(e){e.stopPropagation();var t=e.currentTarget.dataset,n=t.controlId,a=t.selection;if(o.getRootId()!==n){var l=o.findControl(n);r||(e.preventDefault(),a||i([n]),k.eventBus.emit("contextmenu",{event:e,field:l}))}}}},ie=n(1260),ce=n.n(ie);function ue(e){var t=e||window.event;return k.OS===k.MAC?t.metaKey:t.ctrlKey}var de,se,fe=n(3440),pe=n.n(fe),me=n(9992),ve=n.n(me),ge=n(600),ye=n.n(ge),Ce=n(4984),he=n(8496),Ee=n(7348),be=n.n(Ee),Ie=n(2272),Ne=n.n(Ie),Te=n(8456),xe=n.n(Te),Ae=n(3980),Fe=n.n(Ae),Se=n(644),De=n.n(Se),ke=function(e){return e.DEFAULT="1",e.DISABLED="2",e.READONLY="3",e.HIDDEN="4",e}({}),Me=n(2892),we=n.n(Me),Pe="nocode-designer",Re=["ParentId","Id"],Be="entity",_e="all",Oe="nocode-designer-main-root",je="System_",Le="NoCodeGroupContainerAp",Ke="NoCodeBizButtonAp",Ve="BizBtnFlexPanelAp",Ue="NoCodeBillFormAp",Ge="NoCodeEntryEntity",ze="NoCodeRefBillTable",He=[Ke,Le],qe=h()(de=[ze,Ge,Le,Ke]).call(de,["NoCodeBillNoField","NoCodeCreateDateField","NoCodeCreatorField","NoCodeModifyDateField","NoCodeModifierField"]),Ye={"#276FF5":"#F2F9FF","#16AFF1":"#F2FDFF","#16B8B0":"#F2FFFC","#FDC200":"#FFFDE6","#77C404":"#FAFFEB","#1BA854":"#F2FFF5","#FF991C":"#FFFBF2","#FF5F1F":"#FFF8F2","#FB2323":"#FFF4F2","#F90D58":"#FFF2F4","#701DF0":"#F9F2FF","#0E5FD8":"#F2F9FF"},We=[{name:"经典",primaryColor:"#276FF5"},{name:"都市",primaryColor:"#701DF0"},{name:"夜幕",primaryColor:"#0E5FD8"},{name:"沙漠",primaryColor:"#FF5F1F"},{name:"雪山",primaryColor:"#276FF5"},{name:"港湾",primaryColor:"#F90D58"},{name:"高尔夫",primaryColor:"#1BA854"},{name:"乡野",primaryColor:"#16B8B0"}],Xe=["UploadDefValue","PictureDefValue","NoCodeDefValue","FieldRequired","Status","Visibility"],Ze=function(e){return e.DEFAULT="1",e.DISABLED="2",e.READONLY="3",e.HIDDEN="4",e}({}),Qe=function(e){return"NoCodeDateRangeField"===e},Je=function(e){return"NoCodeDateField"===e},$e=function(e){return(null==e?void 0:F()(e).call(e,"NoCodeRefBillField"))||(null==e?void 0:F()(e).call(e,"NoCodeMulRefBillField"))},et=function(e){var t;return F()(t=["NoCodeCreatorField","NoCodeModifierField"]).call(t,e)},tt=function(e){var t;return F()(t=["NoCodeCreatorField","NoCodeCreateDateField","NoCodeModifierField","NoCodeModifyDateField","NoCodeBillNoField"]).call(t,e)},nt=function(e){var t;return F()(t=["NoCodeCreatorField","NoCodeCreateDateField","NoCodeModifierField","NoCodeModifyDateField"]).call(t,e)},rt=function(e){return"NoCodeImageUploadField"===e},at=function(e){return"NoCodeAttachmentUploadField"===e},lt=function(e){return"NoCodeEntryEntity"===e},ot=function(e){return"NoCodeRefBillTable"===e},it=function(e){return"NoCodeBillFormAp"===e||"NoCodeBillEntity"===e},ct=function(e){return e===Ke||e===Ve},ut=function(e){return"NoCodeSelectItemField"===e},dt=function(e){return"NoCodeRichTextField"===e},st=function(e){return"NoCodeGraphicDisplayField"===e},ft=function(e){return e&&Date.parse(e)?new Date(e):null},pt=function(e){if(!e)return null;var t=(e=function(e){return e?p()(e).reduce((function(t,n){return t[(0,Se.lowerFirst)(n)]=e[n],t}),{}):e}(e))||[],n=t.start,r=void 0===n?"":n,a=t.end,l=void 0===a?"":a;return[ft(r),ft(l)]},mt=function(e){return"hide"===e},vt=function(e,t){if(!t)return"";var n,r=t._Type_;return ut(r)?h()(n="".concat(e,"[")).call(n,wt(t.SelectItemType)?"多选":"单选","]"):$e(r)?function(e,t){var n;return h()(n="".concat(e,"[")).call(n,t?"多条":"单条","]")}(e,wt(t.Multi)):e},gt=function(e){return"NoCodeGroupContainerAp"===e},yt=n(9480),Ct=n.n(yt),ht=n(2504),Et=["children"],bt=["children","valueItems","billEntityId","displayProp","isMulti","compareTypes","refSelf"];function It(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?It(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):It(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}function Tt(e,t){var n=void 0!==ve()&&ye()(e)||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return xt(e,t);var r=Fe()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return pe()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,l=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw l}}}}function xt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var At=["FieldName","TableName","Key"],Ft=function(e){return e?Array.isArray(e)?e:[e]:[]},St=function(e,t){var n=(0,Se.cloneDeep)(e),r=n._Type_,a=n.EntityData;n[U]=t;var l=(0,k.createUUid)();if(n[B]=l,a&&(n.EntityData[B]=l,n.EntityData[U]=t,n[O]&&(n[O]=l),n[j]&&(n[j]=l)),Qe(r)){be()(n,"EndDateFieldKey"),be()(n,"EndDateFieldName"),be()(n,"StartDateFieldKey"),be()(n,"StartDateFieldName");var o=Ct()(a,(function(e){be()(e,"EndDateFieldKey"),be()(e,"EndDateFieldName"),be()(e,"StartDateFieldKey"),be()(e,"StartDateFieldName")}));Ne()(n,"EntityData",o)}if(lt(r)){be()(n,"TableName");var i=Ct()(a,(function(e){be()(e,"TableName")}));Ne()(n,"EntityData",i)}return Kt(r)&&(Number(n.GroupIndex)>0?n.GroupIndex=Number(n.GroupIndex)+1:(n.GroupParentId=(0,k.createUUid)(),n.GroupIndex=0)),n.Inherit&&(n.Inherit=!1),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:At;return null==t||t.forEach((function(t){e[t]&&delete e[t],e.EntityData&&e.EntityData[t]&&be()(e.EntityData,t)})),e}(n)},Dt=function e(t,n,r){var a,l,o=n.Id,i=St(n,r),c=v()(a=t[G]).call(a,(function(e){return e[U]===o}));return h()(l=[i]).call(l,(0,Se.flattenDeep)(N()(c).call(c,(function(n){return e(t,n,i[B])}))))},kt=function(e){var t;return F()(t=["default","hidden","disabled","readonly","mustInput"]).call(t,e)},Mt=function(e){var t=e.SelectItemType,n=e.CustomContent,r=e.DefValue;if(!Array.isArray(n))return"";if("0"===t){var a=xe()(n).call(n,(function(e){return e.Value===r}));return(null==a?void 0:a.Label)||""}if("1"===t){var l=[],o=r.split(",");return n.forEach((function(e){null!=o&&F()(o).call(o,null==e?void 0:e.Value)&&l.push(e.Label)})),l.join(",")}return""},wt=function(e){return"1"===(0,Se.toString)(e)},Pt=function(e){if(!e)return"Select";var t=e.DropDownOrTilePc,n=e.SelectItemType;return"1"===(0,Se.toString)(t)?wt(n)?"Checkbox":"Radio":"Select"},Rt=function(e){var t,n=e.CustomContent;if(!n)return[];var r=Array.isArray(n)?n:(null==n?void 0:n.ops)||[];return v()(t=(null==r?void 0:N()(r).call(r,(function(e){return{label:null==e?void 0:e[V],value:null==e?void 0:e[K],color:null==e?void 0:e[z]}})))||[]).call(t,(function(e){return e.label}))||[]},Bt=function(e){var t=e.CustomContent;return!!t&&(!Array.isArray(t)&&(null==t?void 0:t.bgcSwitch))},_t=function(e){var t=e.SelectItemType,n=e.NoCodeDefValue;return wt(t)?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return e?null==e?void 0:e.split(t||","):[]}(n,","):n},Ot=function(e){return void 0!==e&&0==+e},jt=function(e,t){var n,r=e.formmeta,a=null==r||null===(n=r.Items)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.SysSetting;return a?JSON.parse(a):function(e){var t=e.Categories,n=void 0===t?[]:t;return v()(n).call(n,(function(e){var t;return null==e||null===(t=e.Id)||void 0===t?void 0:y()(t).call(t,je)})).reduce((function(e,t){return e[t.Id]=!1,e}),{})}(t)},Lt=function(e,t){var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),n)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?n[r]:("00"+n[r]).substr((""+n[r]).length)));return t},Kt=function(e){return e===Le},Vt=function(e){var t=e.split("."),n=/\B(?=(\d{3})+(?!\d))/g;if(2===t.length){var r,a=(0,d.c)(t,2),l=a[0],o=a[1];return h()(r="".concat(l.replace(n,","),".")).call(r,o)}return t[0].replace(n,",")},Ut=null===(se=window.location.search)||void 0===se||null===(se=se.match(/(^|&|\?)kdcdc=([^&]*)(&|$)/i))||void 0===se?void 0:se[2],Gt=function(e){return e?!F()(e).call(e,"kdcdc")&&Ut?e+(F()(e).call(e,"?")?"&":"?")+"kdcdc="+Ut:e:""},zt=function(e){if(e)return window.__domainurl__+("/"===e[0]?Fe()(e).call(e,1):e)},Ht=function(e,t){return t?t.indexOf("background")>-1?zt(t):e+t:t};var qt=function(e){if("string"!=typeof e)return!1;try{var t=JSON.parse(e);return!("object"!=(0,he.c)(t)||!t)}catch(e){return!1}},Yt=function(e){return e&&qt(e)?0===(e=JSON.parse(e)).valueType&&e.value||"":e},Wt=function(e){if(!(0,Se.isUndefined)(e)){var t=e.start,n=e.end;return{start:Yt(t),end:Yt(n)}}},Xt=function(e){return qt(e)?JSON.parse(e):{}},Zt=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"NoCodeDefValue",r=Nt({},e);return r[n]&&(r=Nt(Nt({},r),{},(0,s.c)({},n,"DateRangeDefValue"===n?Wt(r[n]):Yt(r[n])))),null!==(t=r.EntityData)&&void 0!==t&&t[n]&&(r=Nt(Nt({},r),{},{EntityData:Nt(Nt({},r.EntityData),{},(0,s.c)({},n,"DateRangeDefValue"===n?Wt(r[n]):Yt(r[n])))})),r},Qt=function(e,t){var n=e.PropsDisplay,r=e.DataRange,a=e.BillEntityIdEx,l=e.Multi,o=e._Type_,i=(e.Status,e.MustInput),c=(e.EmptyText,e.Key),u=e.Name,d=e.DefaultDisplay,s=e.Id,f=e.FieldType,p=1===parseInt(l),m=et(o)?"bos_user":a||t.getControlPropertyDefaultValue(f,"BillEntityIdEx");return{displayProp:n||t.getControlPropertyDefaultValue(f,"PropsDisplay"),dataRange:r,isMulti:p,entityId:m,type:($e(o)||ot(o)?"NoCodeMulRefBillField":o).toLowerCase(),id:s,allowClear:!0,mustInput:i,key:c,name:u,defaultDisplay:d,showSelected:!0,disabled:!1,readonly:!1,hidden:!1}},Jt=function e(t,n,r){return(t||[]).reduce((function(t,a){var l,o,i=a.id,c=a.option,u=void 0===c?{}:c,d=u.children,s=(0,Ce.c)(u,Et),f=h()(l="".concat(n,".")).call(l,i),p=null!=f&&F()(f).call(f,"fbasedataid")?i.split(".fbasedataid")[0]:f;if(((null==p||null===(o=p.split("."))||void 0===o?void 0:o.length)||0)>r)return t;var m=Nt({},s);d&&(m.children=e(d,n,r));var v=Nt(Nt({},a),{},{id:f,option:m||{}});return h()(t).call(t,v)}),[])},$t=function e(t,n,r){var a,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return v()(a=(n||[]).reduce((function(n,a){var o,i,c=a.caption,u=a.type,d=a.id,s=a.option,f=void 0===s?{}:s,p=a.typeCaption,m=null!=d&&F()(d).call(d,"fbasedataid")?d.split(".fbasedataid")[0]:d,v=(null==m||null===(o=m.split("."))||void 0===o?void 0:o.length)||0;if("group"!==u&&v>l)return n;var g=f.children,y=f.valueItems,C=f.billEntityId,E=f.displayProp,b=f.isMulti,I=(f.compareTypes,f.refSelf),N=(0,Ce.c)(f,bt),T=function(e){return null==e?void 0:e.split("-")[0]}(u).toLowerCase(),x=function(e){var t=e.compareTypesMap,n=e.type,r=e.entityId,a=t[n]||[];return"bos_user"===r?a="nocodecreatorfield":"bos_adminorg"===r&&(a="orgfield"),"string"==typeof a&&(a=t[a]),a}({compareTypesMap:r,type:T,entityId:C}),A=d,S=Nt({title:c,key:A,compareTypes:x,type:u,titlePrefix:p,selectable:"group"!==u},N);return $e(u)||et(u)||ot(u)?S=(0,R.c)(S,{displayProp:E,entityId:C,isMulti:b}):ut(u)&&(S=(0,R.c)(S,{isMulti:b})),y&&(S.items=y),g?S.children=e(t,g,r,l):!0===I&&(S.children=e(t,Jt(t,A,l),r,l)),"group"!==u||null!==(i=S)&&void 0!==i&&null!==(i=i.children)&&void 0!==i&&i.length?h()(n).call(n,S):n}),[])).call(a,(function(e){var t=e.type,n=e.entityId;return!$e(t)&&!et(t)||null!==n}))},en=function(e,t,n){var r,a=document.querySelector(h()(r="[".concat(H,'="')).call(r,e,'"]'));a&&(a.setAttribute(H,t),null==n||n(a))},tn=function(e,t,n){if(t){var r=t.GroupParentId,a=t.GroupIndex,l=t.Id,o="forward"===n?-1:1,i=e.findControlByCondition((function(e){return e.GroupParentId===r}));if("forward"!==n||0!==Number(a))if("back"!==n||Number(a)!==i.length-1){var c=xe()(i).call(i,(function(e){return Number(e.GroupIndex)===Number(a)+o}));if(c){var u=Nt(Nt({},t),{},{GroupIndex:c.GroupIndex});e.insertControl((0,k.createInsertAction)({targetId:c.Id,values:[u],isPre:"forward"===n})).then((function(t){var n=[[c.Id,{GroupIndex:a}]];e.batchUpdateControlPropertyValues((0,k.createUpdateAction)(n))}))}}else{var d=e.getNextSibling(l).control;if(!d)return;if(Kt(d._Type_)){var s,f=e.findControlByCondition((function(e){return e.GroupParentId===d.GroupParentId}));if(null!=f&&f.length)e.insertControl((0,k.createInsertAction)({targetId:null===(s=f[f.length-1])||void 0===s?void 0:s.Id,values:i,isPre:!1}))}else e.insertControl((0,k.createInsertAction)({targetId:d.Id,values:i,isPre:!1}))}else{var p=e.getPrevSibling(l).control;if(!p)return;if(Kt(p._Type_)){var m,v=e.findControlByCondition((function(e){return e.GroupParentId===p.GroupParentId}));if(null!=v&&v.length)e.insertControl((0,k.createInsertAction)({targetId:null===(m=v[0])||void 0===m?void 0:m.Id,values:i,isPre:!0}))}else e.insertControl((0,k.createInsertAction)({targetId:p.Id,values:i,isPre:!0}))}}},nn={NoCodeTextField:"文本",NoCodeTextAreaField:"文本",NoCodeCreateDateField:"日期",NoCodeModifyDateField:"日期",NoCodeBillNoField:"文本"},rn=function(e,t,n,r){var a,l,o=e._Type_,i=e.Multi,c=e.SelectItemType,u=e.Name,d=e.Key,s=e.BillEntityIdEx;if($e(o)){var f,m,v=xe()(f=p()(t)).call(f,(function(e){return F()(d).call(d,e)}));if(v)return t[v]||"";var g=s||n.getControlPropertyDefaultValue(o,"BillEntityIdEx");return h()(m="[".concat(r[g]||"","]")).call(m,1==i?"[多条]":"[单条]")}if(ot(o))return h()(l="[".concat(u||"-","]")).call(l,1==i?"[多条]":"[单条]");if(ut(o))return"[选项]".concat(1===c?"[多选]":"[单选]");if("NoCodeCreatorField"===o||"NoCodeModifierField"===o)return"[人员][单条]";var y=nn[o]||(null===(a=n.getControlMeta(o))||void 0===a?void 0:a.Name);return"[".concat(y,"]")},an=function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Tt(t);try{for(a.s();!(n=a.n()).done;){var l=n.value,o=l.titlePrefix,i=l.key,c=l.children,u=l.type;if(c&&e(c,r),$e(u))r[i.split(".").pop()]=o||""}}catch(e){a.e(e)}finally{a.f()}return r},ln=function(e,t){var n,r=N()(n=v()(e).call(e,(function(e){return Kt(null==e?void 0:e._Type_)}))).call(n,(function(e){return e.Id}));return r.length&&e.forEach((function(e){if(F()(r).call(r,e.ParentId)&&e.EntityData){var n=Nt(Nt({},e.EntityData),{},{ParentId:t});e.EntityData=n}})),e},on=function(){var e=(0,S.useContext)(le),t=e.getKdesignerApi,n=e.fieldStatusSettingMode,r=(0,S.useMemo)((function(){return t()}),[]),a=r.data,l=r.selection,o=l.setSelect,i=l.appendSelect,c=l.getSelection,u=(0,S.useCallback)((function(e){e.stopPropagation();var t=a.getRootId(),r=c(),l=function(e){for(;!e.dataset.controlId&&"ui-designer-root"!==e.id;)e=e.parentNode;return e}(e.target).dataset,u=l.controlId,d=l.enableClick;if(!n||t!==u&&"false"!==d){var s=!0;if(r.length>0&&(s=a.isSiblings(r[0],u)),s||!ue(e))if(ue(e)){var f=r.indexOf(u);if(f>=0){var p=(0,P.c)(r);ce()(p).call(p,f,1),p.length>0&&o(p)}else i([u])}else o([u])}}),[n]);return u},cn="zidingyifuwu",un={NoCodeTextField:"wenben",NoCodeTextAreaField:"duoxingwenben",NoCodeDateField:"riqi4",NoCodeDecimalField:"shuzhi",NoCodeSelectItemField:"xuanxiang",NoCodeRefBillField:"duoxuanjichuziliao",NoCodeMulRefBillField:"duoxuanjichuziliao",NoCodeAddressFormatField:"dizhi",NoCodeDateRangeField:"riqi4",NoCodeEntryEntity:"biaoge16",NoCodeRefBillTable:"biaoge16",NoCodeRichTextField:"fuwenbenbianjiqi",NoCodeGEOField:"dizhi",NoCodeImageUploadField:"tupian3",NoCodeAttachmentUploadField:"fujian2",NoCodeGraphicDisplayAp:"tuwen",NoCodeBillListAp:"biaodanliebiao",NoCodeCountDownAp:"daojishi",NoCodeMapAp:"ditu",NoCodeCreateDateField:"chuangjianriqi2",NoCodeCreatorField:"chuangjianren2",NoCodeModifyDateField:"xiugairiqi2",NoCodeModifierField:"xiugairen2",NoCodeBillNoField:"bianma",EntryEntity:"biaodanliebiao",GridContainerAp:"zhagerongqi",MessageCarouselContainerAp:"lunborongqi",TabPageAp:"yeqian2",ButtonAp:"anniu3",VectorAp:"zititubiao",ToolbarAp:"gongjulan",NoCodeBizButtonAp:"anniu3",NoCodeGraphicDisplayField:"tuwen",NoCodeGroupContainerAp:"fenzurongqi"};function dn(e,t){return $e(e)?"duoxuanjichuziliao":un[e]||t||cn}var sn=null;function fn(e,t){var n;!function(){sn&&document.body.removeChild(sn);sn=null}(),sn=document.createElement("div");var r=dn(e),a=h()(n='\n    <i class="designericon designericon-'.concat(r,'" style="font-size:20px;vertical-align: -3px"></i>\n    ')).call(n,t,"\n  ");return sn.innerHTML=a,sn.style.cssText="position:absolute;top:-9999px;left:-9999px;opacity:1!important;width: 124px;height: 32px;line-height: 32px;padding: 0 8px;background: #fff;box-shadow: '0px 4px 12px 0px rgba(40,50,70,0.2)';border-radius: 4px;box-sizing: border-box;",document.body.appendChild(sn),sn}var pn=function(e,t,n){e.dataTransfer&&e.dataTransfer.setDragImage&&(e.dataTransfer.dropEffect="move",e.dataTransfer.setDragImage(fn(t,n),-20,-24))},mn=n(9308),vn=n.n(mn),gn=n(4244),yn=n.n(gn),Cn=function(e){for(var t=null;;){var n;if(e.dataset.dragId){t=e;break}if(!("kd-nc-grid-panel"!==e.className||null!==(n=e)&&void 0!==n&&null!==(n=n.dataset)&&void 0!==n&&n.groupContainerItem))break;e=e.parentNode}return t},hn=function(e){for(;!e.dataset.groupBarItemId&&"ui-designer-root"!==e.id;)e=e.parentNode;return e},En=["data-left-drag-style",J,"data-top-drag-style","data-bottom-drag-style",$],bn=function(e){En.forEach((function(t){return e.removeAttribute(t)}))},In=function(){setTimeout((function(){var e,t=(0,P.c)(new(vn())(h()(e=[]).call(e,(0,P.c)(document.querySelectorAll("[".concat($,"]"))),(0,P.c)(document.querySelectorAll("[".concat(Y,"]"))))));t.length&&t.forEach((function(e){bn(e),e.removeAttribute(Y)}))}),200)},Nn=null,Tn="",xn=!1,An=function(e){Tn=e},Fn=function(e){Nn=e},Sn=function(){var e=(0,S.useContext)(le),t=e.getKdesignerApi,n=e.pubUIAction,r=t(),a=r.data,l=r.selection,o=r.meta,i=r.dataFactory,c=(0,S.useContext)(k.GlobalConfigContext),u=c.env,d=c.showMessage,s=a.getRootId(),f=document.querySelector(".kd-row"),p=function(e,t){var n=Array.isArray(e)?e:[e];return a.getAllParentControlIds(t).some((function(e){return F()(n).call(n,e)}))},m=(0,S.useCallback)((function(e,t,r){var c=(r||{}).isPrev,d=void 0!==c&&c,f=u[k.CONTROL_DRAG_DATA].data,p=(void 0===f?{}:f).Id,m=a.findControl(e),v=-1;if(e===s)v=d?1:-1;else{var g=a.findControlIndex(e);if(d)v=g;else{var y,C=a.getSubControls(e),h=C.length;if(h>0)v=a.findControlIndex(null===(y=C[h-1])||void 0===y?void 0:y[B])+1;else v=g+1}}var E=m[L],b=o.getControlMeta(E).IsContainer,I=void 0!==b&&b?e:a.getParentControlId(e)||s,N=a.findControl(I)[L],T=o.canAdd(p,N);if(T&&!1!==(null==T?void 0:T.success)){if(n({eventName:"drag",action:"fd_add_drag"}),Kt(E))return function(e,t){var n,r,o=u[k.CONTROL_DRAG_DATA].data,c=(void 0===o?{}:o).Id,d=t.Id,s=(t.ParentId,null===(n=hn(e))||void 0===n?void 0:n.getAttribute("data-group-bar-item-id"));if(Kt(c)){if(s){(r=i({type:c,parentId:a.getParentControlId(d),transferData:{Key:"nc_".concat((0,k.createUUid)().toLowerCase())}})).GroupParentId=t.GroupParentId,r.GroupIndex=Number(t.GroupIndex)+1;var f=s;if(e.getAttribute("data-group-bar-item-id"))f=e.getAttribute("data-group-bar-item-id");else{var p,m=yn()(p=a.findControlByCondition((function(e){return e.GroupParentId===t.GroupParentId}))).call(p,(function(e,t){return Number(e.GroupIndex)-Number(t.GroupIndex)}));f=m[m.length-1].Id}return void a.insertControl((0,k.createInsertAction)({targetId:f,values:[r],isPre:!1},{isInstrucAdd:!0})).then((function(e){l.setSelect(r.Id)}))}(r=i({type:c,parentId:d})).GroupParentId=(0,k.createUUid)(),r.GroupIndex=0}else r=i(s?{type:c,parentId:s}:{type:c,parentId:d});a.addControl((0,k.createAddAction)(r)).then((function(e){l.setSelect(r.Id)})),delete u[k.CONTROL_DRAG_DATA]}(t,m);var x=i({type:p,parentId:I});a.addControl((0,k.createAddAction)(x,{index:v})).then((function(e){var t=e[0].value;l.setSelect(Array.isArray(t)?[t[0][B]]:[t[B]])})),delete u[k.CONTROL_DRAG_DATA]}}),[u[k.CONTROL_DRAG_DATA],n]),v=(0,S.useCallback)((function(e){var t,n,r,l,i;e.stopPropagation();var c=document.querySelector(h()(t="[".concat(H,"='")).call(t,s,"']")),v=u[k.CONTROL_DRAG_DATA];if(c&&(Nn||v)){var g=Nn||[];null==e||e.currentTarget.removeAttribute(Q),Fn(null),An("");var y=e.target,C=g[0],E=a.findControl(C),b=e.target,I=(b=null!==(n=e.target)&&void 0!==n&&null!==(n=n.dataset)&&void 0!==n&&n.tabsHeader&&Kt(C?null==E?void 0:E._Type_:null===(r=v.data)||void 0===r?void 0:r.Id)?b.lastChild:Cn(e.target)).dataset.dragId||"";if(!(g&&(null==g?void 0:g.length)>0&&p(g,I))){var T=(null===(l=b.dataset)||void 0===l?void 0:l.dragDirection)||"right",x=!1;if(bn(b),F()(i=["top","left"]).call(i,T)&&(x=!0),!(F()(g).call(g,I)||I===s&&null!=f&&f.contains(y))){if(null!=g&&g.length){var A=a.findControl(I),S=A._Type_;if(Kt(S))return function(e,t){for(var n,r=e.dropControl,a=e.dragControlIds,l=e.dataContext,i=(r.ParentId,r.Id),c=r._Type_,u=hn(t).getAttribute("data-group-bar-item-id"),s=i,f=[],m=[],v=[],g=function(){var e=a[y],t=l.findControl(e),n=l.findControl(t.ParentId);if(n&&ot(n._Type_))return d("表格的内容无法移动到表格之外"),{v:void 0};if(p(e,i))return{v:void 0};var g=l.findControl(e),C=g._Type_,h=(g.ParentId,g.GroupIndex),E=g.GroupParentId,b=o.canAdd(C,c);if("object"===(0,he.c)(b)&&!b.success)return{v:d(b.message)};if(Kt(C))if(u){if(g.GroupParentId!==r.GroupParentId){var I,T,x={GroupParentId:r.GroupParentId,GroupIndex:Number(r.GroupIndex)+1,ParentId:r.ParentId};m.push([g.Id,x]);var A=yn()(I=l.findControlByCondition((function(e){return e.GroupParentId===r.GroupParentId}))).call(I,(function(e,t){return Number(e.GroupIndex)-Number(t.GroupIndex)}));ce()(A).call(A,Number(r.GroupIndex)+1,0,g),null==A||A.forEach((function(e,t){Number(e.GroupIndex)!==t&&m.push([e.Id,{GroupIndex:t}])}));var F=yn()(T=l.findControlByCondition((function(e){return e.GroupParentId===g.GroupParentId&&e.Id!==g.Id}))).call(T,(function(e,t){return Number(e.GroupIndex)-Number(t.GroupIndex)}));null==F||F.forEach((function(e,t){Number(e.GroupIndex)!==t&&m.push([e.Id,{GroupIndex:t}])}))}else{var S,D=yn()(S=l.findControlByCondition((function(e){return e.GroupParentId===r.GroupParentId&&e.Id!==g.Id}))).call(S,(function(e,t){return Number(e.GroupIndex)-Number(t.GroupIndex)}));Number(r.GroupIndex)<Number(g.GroupIndex)?ce()(D).call(D,Number(r.GroupIndex)+1,0,g):ce()(D).call(D,Number(r.GroupIndex),0,g),null==D||D.forEach((function(e,t){Number(e.GroupIndex)!==t&&m.push([e.Id,{GroupIndex:t}])}))}v.push({Id:e})}else{v.push({Id:e,ParentId:i});var M=l.findControl(s).Status;if(void 0!==M){var w=l.getAllSubControlIds(e);f.push.apply(f,(0,P.c)(N()(w).call(w,(function(e){return[e,{Status:M}]}))))}if(1===a.length&&void 0!==h&&E){var R=l.findControlByCondition((function(t){return t.GroupParentId===E&&t.Id!==e}));if(R.length>0&&(f.push([e,{GroupIndex:0,GroupParentId:(0,k.createUUid)()}]),0===Number(h))){var B=N()(R).call(R,(function(e,t){return[e.Id,{GroupIndex:t}]}));f.push.apply(f,(0,P.c)(B))}}}else u?f.push([e,{ParentId:u}]):f.push([e,{ParentId:i}])},y=0;y<a.length;y++)if(n=g())return n.v;m.length>0&&l.batchUpdateControlPropertyValues((0,k.createUpdateAction)(m),!1),v.length>0&&l.insertControl((0,k.createInsertAction)({targetId:s,values:v,isPre:!1})),f.length>0&&l.batchUpdateControlPropertyValues((0,k.createUpdateAction)(f)),In()}({dropControl:A,dragControlIds:g,dataContext:a},b);a.swapControl((0,k.createSwapAction)({origin:g,target:I,isPrev:x})).then((function(e){}))}else m(I,b,{isPrev:x});In()}}}}),[]),g=(0,S.useCallback)((function(e){var t,n,r,l,i;e.preventDefault(),null==e||e.currentTarget.setAttribute(Q,"true");var c=u[k.CONTROL_DRAG_DATA];if(Nn||c){var d=Nn||[],s=Cn(e.target),f=(null==s||null===(t=s.dataset)||void 0===t?void 0:t.dragId)||null;if(f){var p=Tn;if(p&&f&&p!==f){var m,v=document.querySelectorAll(h()(m="[".concat(q,"='")).call(m,p,"']"));v&&v.forEach((function(e){return bn(e)})),An(f)}else if(""===p)An(f);else if(p&&f&&p===f){var g;if(null!==(g=e.target)&&void 0!==g&&null!==(g=g.dataset)&&void 0!==g&&g.tabsHeader)xn=!0;else if(xn){var y,C;xn=!1;var E=document.querySelectorAll(h()(y=h()(C="[".concat(q,"='")).call(C,p,"'] [")).call(y,$,"]"));E&&E.forEach((function(e){return bn(e)}))}}var b=d[0],I=a.findControl(b),N=null==s||null===(n=s.dataset)||void 0===n?void 0:n.groupBarItemId;if(null!==(r=e.target)&&void 0!==r&&null!==(r=r.dataset)&&void 0!==r&&r.tabsHeader&&Kt(b?null==I?void 0:I._Type_:null===(l=c.data)||void 0===l?void 0:l.Id)){var T=e.target.lastChild;null==T||T.setAttribute(J,"true"),null==T||T.setAttribute($,"right"),An(null==T?void 0:T.dataset.dragId)}if(!f||null==d||!F()(d).call(d,f))if(N)Kt(b?null==I?void 0:I._Type_:null===(i=c.data)||void 0===i?void 0:i.Id)&&(null==s||s.setAttribute(J,"true"),null==s||s.setAttribute($,"right"));else{var x=a.findControl(f)._Type_,A=o.getControlMeta(x).IsContainer;if(void 0!==A&&A)return;var S=function(e,t,n){var r=e.getBoundingClientRect(),a=r.x,l=r.y,o=a+r.width,i=l+r.height,c=(a+o)/2,u="";return a<t&&t<o&&l<=n&&n<=l+8?u="left":a<t&&t<o&&i-8<=n&&n<i?u="right":a<=t&&t<=c&&l<n&&n<i?u="left":c<t&&t<o&&l<n&&n<i&&(u="right"),u}(s,e.clientX,e.clientY),D=s.dataset.dragDirection;S&&S!==D&&(D&&(s.removeAttribute("data-".concat(D,"-drag-style")),s.removeAttribute($)),null==s||s.setAttribute("data-".concat(S,"-drag-style"),"true"),null==s||s.setAttribute($,S))}}else An("")}}),[s]);return{onDragOver:g,onDragEnd:(0,S.useCallback)((function(e){e.preventDefault(),In(),Fn(null),An(""),null==e||e.currentTarget.removeAttribute(Q)}),[s]),onDrop:v,onDragLeave:(0,S.useCallback)((function(e){var t;null!==(t=e.currentTarget)&&void 0!==t&&t.contains(e.relatedTarget)||(In(),null==e||e.currentTarget.removeAttribute(Q))}),[])}};function Dn(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function kn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dn(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Dn(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Mn=function(e){for(var t=null;;){var n,r;if(null!==(n=e)&&void 0!==n&&null!==(n=n.dataset)&&void 0!==n&&n.dragId&&(null===(r=e)||void 0===r||null===(r=r.dataset)||void 0===r||!r.groupBarItemId)){t=e;break}if("ui-designer-root"===e.id)break;e=e.parentNode}return t},wn=function(e){var t=(0,S.useContext)(le),n=t.getKdesignerApi,r=t.fieldStatusSettingMode,a=(0,S.useMemo)((function(){return n()}),[]),l=a.data,o=a.meta,i=l.getRootId(),c=i===e[B],u=l.findControl(e[B]),d=null==u?void 0:u._Type_,f=(o.getControlMeta(d)||{}).IsContainer,p=void 0!==f&&f,m=(0,S.useCallback)((function(e){var t;e.stopPropagation();var n,r=e.currentTarget,a=(r=Cn(r)).dataset.dragId||null,o=[a],i=l.findControl(a),c=i._Type_,u=i.GroupParentId;!Kt(c)||null!==(t=r)&&void 0!==t&&null!==(t=t.dataset)&&void 0!==t&&t.groupBarItemId||(o=N()(n=l.findControlByCondition((function(e){return e.GroupParentId===u}))).call(n,(function(e){return e.Id})));Fn(o);var d=l.findControl(a),s=d._Type_,f=d.Name;pn(e,s,f)}),[i]),v=(0,S.useCallback)((function(e){var t,n=Mn(e.currentTarget);!n||null!=n&&null!==(t=n.dataset)&&void 0!==t&&t.dragOver||n.setAttribute(Y,"true")}),[]),g=(0,S.useCallback)((function(e){var t=Mn(e.currentTarget);if(null!=t&&t.contains(e.relatedTarget)){var n=Cn(e.currentTarget);null!=n&&n.dataset.groupBarItemId&&null!=n&&n.dataset.dragDirection&&bn(n)}else null!=t&&t.dataset.dragOver&&t.removeAttribute(Y)}),[]),y=p?{onDragEnter:v,onDragLeave:g}:{};return kn(kn((0,s.c)({},q,e[B]),y),{},{onDragStart:m,draggable:!c&&!r})},Pn=function(e){if(!e)return{};e.Id;var t=e.Status,n=e.Visibility,r=e.Key,a=(0,S.useContext)(le),l=a.fieldStatusSettingMode,o=a.isPC,i=a.fieldStatusMap,c=null==i?void 0:i[r];return(t!==Ze.HIDDEN||l&&c)&&function(e,t){return e&&"mob"!==t||!e&&"pc"!==t}(o,n)&&"hidden"!==c?{}:(0,s.c)({},"data-hidden",!0)};function Rn(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Bn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rn(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Rn(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var _n=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=oe(e),r=on();if(!e)return Bn({onMouseDown:r},n);var a=ne(e),l=wn(e),o=Pn(e);return t?Bn(Bn(Bn({},a),n),{},{onMouseDown:r,dragEvent:l},o):Bn(Bn(Bn({},a),n),{},{onMouseDown:r})},On=n(1252),jn=n.n(On),Ln=function(e){var t=e.field,n=_n(t),r=(t._Type_,t.Id),a=t.Name||r,l=jn()(["undefined-control-root","text-omit"]);return D().createElement("div",(0,R.c)({},n,{className:l}),a)},Kn=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.isPC,a=void 0===r||r,l=n.excludeType,o=void 0===l?"":l,i=n.ctrlType,c=void 0===i?"":i,u=e[B],d=[],s=t[G].length,f=0;f<s;f++){var p=t[G][f],m=p[L];if(!(p[U]!==u||o&&o===m||c&&c!==m)){if(Kt(m)&&0!==Number(p.GroupIndex))continue;var v=Ol(p,{isPC:a});v&&d.push(v)}}return d},Vn=n.p+"images/34cd7b92da1639c0f67b4f2cb967347a.png",Un=n(2416),Gn=n(5873),zn=(0,S.memo)((function(e){var t,n=e.field,r=(0,S.useContext)(le),a=r.isPC,l=r.getKdesignerApi,o=r.prefixCls,i=r.baseUrl,c=l().data,u=n.ColumnSpan,d=n.Gutter,f=n.BackColor,p=n.BackImage,m=n.CustomStyle,v=c.getData(),g=c.getRootId(),y=c.findControl,C=_n(n,!1),E=Kn(n,v,{isPC:a,excludeType:Ve},y),b=jn()("".concat(o,"-root-panel"),(0,s.c)({},h()(t="".concat(o,"-root-panel-")).call(t,a?"isPC":"isMb"),!0)),I=(0,S.useMemo)((function(){var e;return D().createElement("div",{className:h()(e="".concat(o,"-root-panel-")).call(e,a?"isPC":"isMb","-empty")},D().createElement("img",{src:Vn,alt:"暂无数据",className:"empty-img"}),D().createElement("div",{className:"empty-desc"},"您还没有内容，点击或拖拽左侧内容新建"))}),[a]),T=(0,S.useCallback)((function(){return D().createElement("div",{className:"".concat(o,"-root-panel-content"),style:a?{padding:"24px"}:{}},a?D().createElement(Un.GridPanel,{column:u,gutter:d||[24,24],id:"root-grid-panel"},null==E?void 0:N()(E).call(E,(function(e,t){var n,r;return D().cloneElement(e,{itemKey:e.key||(null==e||null===(n=e.props)||void 0===n||null===(n=n.field)||void 0===n?void 0:n.key),columnSpan:null==e||null===(r=e.props)||void 0===r||null===(r=r.field)||void 0===r?void 0:r.ColumnSpan})}))):E)}),[a,E,u,d,Un.GridPanel]),x=null==v?void 0:v.name,A=a?Un.FormBanner:Gn.FormBanner,F=(0,S.useMemo)((function(){return m&&D().createElement(A,{title:x,image:Ht(i.picture,p)})}),[m,x,i.picture,p,A,Ht]),k=Sn();return D().createElement("div",{className:"".concat(o,"-root-panel-wrapper"),style:{backgroundColor:m&&f},"data-drag-id":g},D().createElement("div",(0,R.c)({id:"ui-designer-root"},C,{className:b},k),E.length?D().createElement("div",{className:"".concat(o,"-root-panel-scroll")},F,T()):D().createElement(D().Fragment,null,F,I)))}));zn.displayName="RootPanel";var Hn=zn,qn=(0,S.forwardRef)((function(e,t){var n=e.prefixCls,r=e.value,a=e.maxLength,l=e.style,o=e.onBlur,i=(0,S.useState)(r),c=(0,d.c)(i,2),u=c[0],s=c[1];(0,S.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.select()}),[]);var f=(0,S.useCallback)((function(e){var t=e.target.value;s(t)}),[s]),p=function(){var e,n=document.getElementById(Oe);null==t||null===(e=t.current)||void 0===e||e.blur(),setTimeout((function(){null==n||n.focus()}),0)},m=(0,S.useCallback)((function(e){e.stopPropagation(),e.ctrlKey&&(e.preventDefault(),p()),e.keyCode===k.keyCode.ENTER&&p()}),[]);return D().createElement("input",{ref:t,style:l,type:"text",value:u,maxLength:a,className:"".concat(n,"-global-edit-control-name"),onBlur:o,onChange:f,onKeyDown:m})})),Yn=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=(0,S.useContext)(le),r=n.prefixCls,a=n.getKdesignerApi,l=(0,S.useContext)(k.GlobalConfigContext).showMessage,o=a(),i=o.data,c=o.meta,u=e.Id,d=(0,S.useRef)(null),f=(0,S.useRef)(null),p=(0,S.useRef)(null),m=(0,S.useRef)(null),v=(0,S.useCallback)((function(){var e;f.current&&d.current&&(null==m||null===(e=m.current)||void 0===e||e.blur())}),[]),g=(0,S.useCallback)((function(){p.current=window.requestAnimationFrame(v)}),[]),y=(0,S.useCallback)((function(){ae().unmountComponentAtNode(d.current),document.body.removeChild(d.current),d.current=null,f.current=null;var e=document.getElementById("ui-designer-root");null==e||e.removeEventListener("scroll",g,!0),p.current&&window.cancelAnimationFrame(p.current)}),[]),C=(0,S.useCallback)((function(e){var t=(i.findControl(u)||{}).Name;e.target.value||l("控件名称不能为空");var n=e.target.value||t;n!==t&&i.batchUpdateControlPropertyValues((0,k.createUpdateAction)([[u,{Name:n}]])),y()}),[]),E=(0,S.useCallback)((function(e){f.current=e;var t,n,a,l=(null==e?void 0:e.getBoundingClientRect())||{},o=l.left,s=l.top,p=l.width,v=l.height,y=i.findControl(u),E=y.Name,b=y._Type_,I=c.getControlMetaEditor(b,"Name").MaxLength;d.current||(d.current=document.createElement("div"),d.current.style.cssText=h()(t=h()(n=h()(a="position: fixed;z-index: 0;left: ".concat(o+1,"px;top: ")).call(a,s,"px;width: ")).call(n,p-2,"px;height: ")).call(t,v,"px;background: transparent;"));ae().render(D().createElement(qn,{ref:m,prefixCls:r,value:E,maxLength:I,style:{width:"100%",height:"".concat(v-1,"px")},onBlur:C}),d.current),document.body.appendChild(d.current);var N=document.getElementById("ui-designer-root");null==N||N.addEventListener("scroll",g,!0)}),[]),b=(0,S.useCallback)((function(e){var t=e.currentTarget;E(t)}),[]),I=(0,S.useCallback)((function(e){if(d.current&&e!==u)y(),k.eventBus.off("add-control-id",I);else if(t&&e===u){var n,r,a=document.querySelector(h()(n=h()(r="[".concat(H,'="')).call(r,u,'"] [')).call(n,te,'="true"]'));if(!a)return;E(a)}}),[]);return(0,S.useEffect)((function(){return k.eventBus.on("add-control-id",I),function(){k.eventBus.off("add-control-id",I)}}),[]),(0,s.c)({onDoubleClick:b},te,!0)},Wn=["field","children","tipsTrigger","dragEvent","wrapperStyle"],Xn=function(e,t){var n=e.Key;return function(e){var t=e.MustInput,n=e.FieldRequired;return e.Status===Ze.DEFAULT&&(t||"2"===n||"3"===n)}(e)&&!kt(t[n])||"mustInput"===t[n]},Zn=function(e){var t,n,r=(0,S.useContext)(le),a=r.isPC,l=r.prefixCls,o=r.fieldStatusMap,i=e.field,c=e.children,u=e.tipsTrigger,d=e.dragEvent,f=void 0===d?{}:d,p=e.wrapperStyle,m=void 0===p?{}:p,v=(0,Ce.c)(e,Wn),g=i.Name,y=i.LabelWidth,C=(i.ShowTitle,i.HelpTips),E=i.TitleArea,b=(i.MustInput,i.Status,i.FieldRequired,i.Key),I=!mt(E),N=(0,R.c)({width:y},e.labelStyle),T=Yn(i),x=Xn(i,o),A=(0,R.c)({padding:"0 12px",margin:"0 -12px"},m);return a?D().createElement("div",(0,R.c)({style:A},f),D().createElement(Un.FieldItem,(0,R.c)({className:jn()((0,s.c)({},h()(n="".concat(l,"-item-")).call(n,o[b]),o[b])),labelClassName:"".concat(l,"-designer-field-item"),labelProps:T,labelText:g,required:x,labelStyle:N,showTitle:I,tips:C,tipsTrigger:a?u:"click",tipsDisabled:!0},v),c)):D().createElement(Un.FieldItem,(0,R.c)({className:jn()((0,s.c)({},h()(t="".concat(l,"-item-")).call(t,o[b]),o[b])),labelClassName:"".concat(l,"-designer-field-item"),labelProps:T,labelText:g,required:x,labelStyle:N,showTitle:I,tips:C,tipsTrigger:a?u:"click",tipsDisabled:!0},v,f),c)},Qn=(0,S.memo)((function(e){var t=e.value,n=(0,S.useContext)(le).prefixCls;return D().createElement("p",{className:"".concat(n,"-readonly-text")},""===t||null==t?"-":t)})),Jn=function(e){var t=e.type,n=e.field,r=void 0===n?{}:n,a=e.props,l=void 0===a?{}:a,o=e.isMb,i=void 0!==o&&o,c=r.Status,u=r.Key,d=(0,S.useContext)(le),s=d.fieldStatusMap,f=d.fieldStatusSettingMode;if(c===ke.READONLY&&!kt(s[u])||"readonly"===s[u])return D().createElement(Qn,{value:l.readonlyValue||(null==r?void 0:r.DefValue)});var p=(0,S.useMemo)((function(){return i?Gn[t]:Un[t]}),[t]),m=function(e,t){var n,r=t.fieldStatusMap,a=e.EmptyText,l=e.NoCodeDefValue,o=e.ShowClearButton,i=e.Status,c=e.MaxLength,u=e.MinLength,d=e._Type_,s=e.DateRangeEmptyText,f=e.DateRangeDefValue,p=e.Key,m={readOnly:!0,disabled:(n=i,n===ke.DISABLED&&!kt(r[p])||"disabled"===r[p])};if((0,Se.isUndefined)(l)||$e(d)||(Je(d)?m.value=l&&Date.parse(l)?new Date(l):void 0:m.value=l),(0,Se.isUndefined)(f)||(m.value=pt(f)),(0,Se.isUndefined)(a)||(m.placeholder=a),Qe(d)&&s){var v=s.start,g=void 0===v?"":v,y=s.end,C=void 0===y?"":y;m.placeholder=[g,C]}return(0,Se.isUndefined)(o)||(m.allowClear=o),(0,Se.isUndefined)(c)||(m.maxLength=c),(0,Se.isUndefined)(u)||(m.mixLength=u),m}(r,{fieldStatusSettingMode:f,fieldStatusMap:s});return D().createElement(p,(0,R.c)({},m,l))},$n=function(e){return D().createElement(Jn,(0,R.c)({isMb:!0},e))},er=(0,S.memo)((function(e){var t=e.field,n=_n(t),r={borderType:"bordered"};return D().createElement(Zn,(0,R.c)({},n,{field:t}),D().createElement(Jn,{type:"Text",field:t,props:r}))}));er.displayName="TextFieldAp";var tr=er,nr=function(e){var t,n=e.field,r=_n(n),a=Pt(n),l=_t(n),o={readonlyValue:Mt(n),options:Rt(n),defaultValue:l,value:l,mode:wt(null==n?void 0:n.SelectItemType)?"multiple":"single",showBgcBlock:Bt(n)};return F()(t=["Checkbox","Radio"]).call(t,a)&&(o.vertical=Ot(null==n?void 0:n.TileTypePc)),D().createElement(Zn,(0,R.c)({},r,{field:n}),D().createElement(Jn,{type:a,field:n,props:o}))},rr="setListTreeConfig",ar="setFormRules",lr="setRuleInfo",or="deleteFormRule",ir="setBizRules",cr="deleteBizRule",ur="setRefBillTreeData",dr="setTreeNodeChildren",sr="setInputForm",fr="setRefPropDisp",pr="getSvgLine",mr="setSwitchFieldTypes",vr="showDesignerError",gr="setDefValueForFormula",yr="setAvailableAssociationFields",Cr="updateAssociation",hr="loadDesignerMetadata",Er=["field"];function br(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ir(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?br(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):br(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Nr=function(e){var t,n=e.field,r=((0,Ce.c)(e,Er),(0,S.useState)([])),a=(0,d.c)(r,2),l=a[0],o=a[1],i=(0,S.useContext)(le).getKdesignerApi,c=_n(n),u=((0,S.useMemo)((function(){return i()}),[]).data.getData(),n.EmptyText,n.DataRage,n.showClearButton,n.Status),s=n.ShowType,f=n.PropsDisplay;n.Visibility;(0,S.useEffect)((function(){return k.eventBus.on(fr,p),function(){k.eventBus.off(fr,p)}}),[]);Ze.DISABLED;var p=(0,S.useCallback)((function(e){var t=N()(e).call(e,(function(e){return{fieldCaption:e.PropCap,fieldName:e.PropKey,items:e.items,type:e.type}}));o(t||[])}),[]);f&&(null===(t=f.split(","))||void 0===t||N()(t).call(t,(function(e){var t=(null==l?void 0:xe()(l).call(l,(function(t){return t.fieldName===e})))||{},n=t.fieldCaption;t.type;return{ApType:"NoCodeTextFieldAp",FieldType:"NoCodeTextField",Id:t.fieldName,Name:n,_Type_:"NoCodeTextField"}}))),Ir({ShowSeqField:!0,SeqName:"序号",ShowBatExportBtn:!1,ShowBatImportBtn:!1,showAddRowBtn:!1,EntityData:Ir(Ir({},n.EntityData),{},{_Type_:"NoCodeEntryEntity"}),operations:["取消"]},n);return"1"===s?D().createElement(Zn,(0,R.c)({},c,{field:n}),D().createElement(Jn,{type:"RefBill",field:n})):null},Tr=function(e){var t=e.field,n=_n(t),r=t.CounterDisplay,a=t.DefaultLines,l={showCount:!!(0,Se.isUndefined)(r)||r,autoSize:{minRows:a||1,maxRows:a||1},style:{pointerEvents:"none"}};return D().createElement(Zn,(0,R.c)({},n,{field:t}),D().createElement(Jn,{type:"Textarea",field:t,props:l}))},xr=function(e){var t=e.field,n=_n(t),r=(t.EmptyText,t.DefValue,t.showClearButton,t.Status,t.ThousandsSeparator),a=t.Scale,l=t.Precision,o=t.Stepper,i={borderType:"bordered",readOnly:!0,allowClear:!1,formatter:(0,S.useCallback)((function(e){return r?Vt("".concat(e)):String(e)}),[r]),decimalLength:a,maxLength:l,showStepper:o};return D().createElement(Zn,(0,R.c)({},n,{field:t}),D().createElement(Jn,{type:"Number",field:t,props:i}))},Ar=new(we())([["2","month"],["3","year"]]),Fr=function(e){var t=e.field,n=_n(t),r=t.FormatType,a={borderType:"bordered",showTime:"0"===r,readOnly:!0,allowClear:!1,picker:Ar.get(r)||"date"};return D().createElement(Zn,(0,R.c)({},n,{field:t}),D().createElement(Jn,{type:"DatePicker",field:t,props:a}))},Sr=function(e){var t=e.field,n=_n(t),r={borderType:"bordered",showTime:"0"===t.FormatType,readOnly:!0,allowClear:!1};return t=Zt(t,"DateRangeDefValue"),D().createElement(Zn,(0,R.c)({},n,{field:t}),D().createElement(Jn,{type:"DateRangePicker",field:t,props:r}))},Dr=n(1848),kr=n.n(Dr),Mr=["ShowSelChexkbox","ShowSeqField","SeqName","ShowBatExportBtn","ShowBatImportBtn"],wr=["field","className","showSeqField","showSelChexkbox","seqName","operations","subControls","showBatImportBtn","showBatExportBtn","showAddRowBtn"],Pr=function(e){var t=e.field,n=_n(t),r=t.ShowSelChexkbox,a=t.ShowSeqField,l=t.SeqName,o=void 0===l?"序号":l,i=t.ShowBatExportBtn,c=t.ShowBatImportBtn,u=(0,Ce.c)(t,Mr),d=(0,S.useRef)(null);return"1"===u.ShowType?null:D().createElement(Zn,(0,R.c)({field:t,tipsTrigger:"click"},n,{wrapperStyle:{margin:0,padding:0}}),D().createElement(Rr,(0,R.c)({showSeqField:a,showSelChexkbox:r,seqName:o,ref:d,field:t,showBatExportBtn:i,showBatImportBtn:c},u)))},Rr=(0,S.forwardRef)((function(e,t){var n,r,a,l=e.field,o=e.className,i=(e.showSeqField,e.showSelChexkbox,e.seqName),c=e.operations,u=void 0===c?["复制","删除","更多"]:c,d=e.subControls,f=(e.showBatImportBtn,e.showBatExportBtn,e.showAddRowBtn,(0,Ce.c)(e,wr),(0,S.useContext)(k.ConfigContext)),p=f.getPrefixCls,m=(f.prefixCls,(0,S.useContext)(le).getKdesignerApi),v=(0,S.useMemo)((function(){return m()}),[]).data,g=p("nocode-designer-entry"),y=v.getData(),C=d||Kn(l,y,{},v.findControl),E=jn()((0,s.c)((0,s.c)({},"".concat(g,"-body"),!0),o,o)),b=kr()(n=new Array(1)).call(n,"");return C.length?D().createElement("div",{className:"".concat(g),ref:t},D().createElement("div",{className:"".concat(g,"-toolbar")},D().createElement("div",{className:"".concat(g,"-toolbar-btns")},D().createElement(w.Button,{size:"small",className:"add-btn",icon:D().createElement(w.Icon,{prefix:"ncicon",type:"zengjia-yuan"}),type:"ghost"},"新增"),D().createElement(w.Button,{size:"small",className:"import-btn",icon:D().createElement(w.Icon,{prefix:"ncicon",type:"daoru"})},"导入"))),D().createElement("div",{className:E},D().createElement("div",{className:"".concat(g,"-grid-view")},D().createElement("ul",{className:h()(r="".concat(g,"-checkbox-col ")).call(r,g,"-sticky"),style:{left:0}},D().createElement("li",{className:"thead"},D().createElement("span",{className:"checkbox"})),D().createElement("li",null,D().createElement("span",{className:"checkbox"}))),D().createElement("ul",{className:h()(a="".concat(g,"-seqcol ")).call(a,g,"-sticky"),style:{left:40}},D().createElement("li",{className:"thead",title:i},i),D().createElement("li",null,"1")),D().createElement("div",{className:"".concat(g,"-main")},C),((null==C?void 0:C.length)>0||u.length>0)&&D().createElement("ul",{className:"".concat(g,"-sticky-right")},D().createElement("li",{className:"thead"},"操作"),N()(b).call(b,(function(e,t){return D().createElement("li",{key:t},N()(u).call(u,(function(e,t){return D().createElement("div",{key:t,className:"op"},e)})))})))))):D().createElement("div",{className:"".concat(g,"-empty")},"拖拽或点击添加内容")})),Br=n(2796),_r=n.n(Br),Or=n(8429),jr=n.n(Or),Lr=n(1900),Kr=n.n(Lr),Vr="INIT_FORM_DATA",Ur="UPDATE_FORM_DATA",Gr="UPDATE_CONTROL_PROPS",zr="ADD_CONTROL",Hr="DEL_CONTROL",qr="UPDATE_APP_FORM_LIST",Yr=(0,S.memo)((function(e){var t=e.prefixClass,n=e.defaultBatchValue,r=e.handleAddOption,a=(0,S.useState)(!1),l=(0,d.c)(a,2),o=l[0],i=l[1],c=(0,S.useState)(n),u=(0,d.c)(c,2),s=u[0],f=u[1];(0,S.useEffect)((function(){f(n)}),[n]);var p=D().createElement("div",{className:"".concat(t,"_batchaddpanel_form")},D().createElement("label",{className:"".concat(t,"_batchaddpanel_form_label")},"每行对应一个选项"),D().createElement(w.TextArea,{className:"".concat(t,"_batchaddpanel_form_textarea"),defaultValue:s,value:s,placeholder:"请输入",borderType:"bordered",count:!1,autoSize:{minRows:19,maxRows:19},maxLength:2e3,onChange:function(e){f(e.target.value)}})),m=(0,S.useCallback)((function(){var e,t=null==s?void 0:v()(e=s.split(/[\r\n\t]/)).call(e,Boolean),n=(0,P.c)(new(vn())(t));f(n.join("\n")),r(n),i(!1)}),[s,r]),g=(0,S.useCallback)((function(){f(n),i(!1)}),[n]),y=(0,S.useMemo)((function(){var e="".concat(t,"_batchaddpanel_footer");return D().createElement("div",{className:e},D().createElement("div",{className:"".concat(e,"_action")},D().createElement(w.Button,{size:"small",className:jn()("".concat(e,"_action_btn"),"".concat(e,"_action_cancel")),onClick:g},"取消"),D().createElement(w.Button,{size:"small",type:"primary",className:jn()("".concat(e,"_action_btn"),"".concat(e,"_action_copy")),onClick:m},"确定")))}),[m]);return D().createElement(D().Fragment,null,D().createElement("div",{className:"".concat(t,"-handle-batchadd"),onClick:function(){i(!0)}},"批量编辑"),o&&D().createElement(w.Modal,{className:"".concat(t,"_batchaddpanel"),bodyClassName:"".concat(t,"_batchaddpanel_body"),body:p,title:"批量编辑",onCancel:function(){return i(!1)},onOk:function(){return i(!1)},visible:o,height:560,footer:y}))})),Wr=n(5288),Xr=n.n(Wr),Zr=(0,S.memo)((function(e){var t=e.className,n=e.value,r=e.colorList,a=void 0===r?[]:r,l=e.onChange,o=e.renderIcon,i=(0,S.useContext)(le),c=i.getPrefixCls,u=i.prefixCls,s=c&&c(u,"colorpicker-content"),f=(0,S.useState)(n),p=(0,d.c)(f,2),m=p[0],v=p[1];(0,S.useEffect)((function(){!(0,Se.isUndefined)(n)&&v(n)}),[n]);return D().createElement("ul",{className:jn()("".concat(s),t)},null==a?void 0:N()(a).call(a,(function(e){return D().createElement("li",{onClick:function(){return function(e){v(e),null==l||l(e)}(e)},key:e,className:"".concat(s,"-item"),style:{backgroundColor:e}},m===e&&("function"==typeof o?o():D().createElement(w.Icon,{className:jn()("".concat(s,"-item-light")),prefix:"designericon",type:"shuzhankaibeifen"})))})))})),Qr=Zr,Jr=["#E0EFFF","#CFF7FF","#D6FFF8","#DCFAE4","#EDFFBD","#FFF8B8","#FFF1D4","#FFE7D6","#FFDBE0","#FFC4CF","#ECD6FF","#C7E5FF","#E5E5E5"],$r=["#276FF5","#16B0F1","#16B8B1","#1BA854","#77C404","#FDC200","#FF991C","#FF5F1F","#FB2323","#F90D58","#701DF0","#0E5FD8","#999999"],ea=function(e){var t=e.prefixClass,n=e.value,r=e.onChange,a=(0,S.useState)(!1),l=(0,d.c)(a,2),o=l[0],i=l[1],c=(0,S.useState)(n),u=(0,d.c)(c,2),f=u[0],p=u[1];(0,S.useEffect)((function(){!(0,Se.isUndefined)(n)&&p(n)}),[n]);var m="".concat(t,"-colorpicker"),v=function(e){p(e),null==r||r(e),i(!1)},g=D().createElement(w.Dropdown.Menu,{style:{width:380,padding:8}},D().createElement("div",{className:"".concat(m,"-content")},D().createElement(Qr,{colorList:Jr,onChange:v,value:f}),D().createElement(Qr,{renderIcon:function(){return D().createElement(w.Icon,{className:jn()("".concat(m,"-content-list-item-dark")),prefix:"designericon",type:"shuzhankaibeifen"})},colorList:$r,onChange:v,value:f})));return D().createElement(w.Dropdown,{popperClassName:"".concat(m,"-popup"),placement:"bottomLeft",menu:g,trigger:"click",visible:o,onVisibleChange:function(e){return i(e)}},D().createElement("div",{style:{backgroundColor:f},className:m},D().createElement(w.Icon,{className:jn()("".concat(m,"-arrow"),(0,s.c)((0,s.c)({},"".concat(m,"-arrow-up"),o),"".concat(m,"-arrow-light"),F()($r).call($r,f))),prefix:"designericon",type:"zhankai3"})))};function ta(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function na(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ta(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):ta(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var ra=(0,S.memo)((function(e){var t=e.index,n=e.option,r=e.options,a=e.prefixClass,l=e.isNewOptionEdit,o=e.onDrop,i=e.handleEditOption,c=e.handleDeleteOption,u=e.bgcolorChecked,f=(0,S.useState)(!1),p=(0,d.c)(f,2),m=(p[0],p[1]),v=(0,S.useState)(l),g=(0,d.c)(v,2),y=g[0],C=g[1],h=(0,S.useState)(na({},n)),E=(0,d.c)(h,2),b=E[0],I=E[1],N=(0,S.useRef)(null),T=(0,S.useRef)(null),x=(0,S.useRef)(null),A="".concat(a,"-item");(0,S.useEffect)((function(){I(na({},n))}),[n]),(0,S.useEffect)((function(){T.current&&y&&T.current.select()}),[T,y]);var F=(0,S.useCallback)((function(e){e.persist();var t=e.target.value,n=na(na({},b),{},(0,s.c)((0,s.c)({},V,t),K,fa(t)));I(n)}),[b]),k=(0,S.useCallback)((function(e){e.persist(),I((function(t){return na(na({},t),{},(0,s.c)({},K,e.target.value))}))}),[]),M=(w.Dropdown.Menu,"".concat(A,"-detail-item"),w.Input,n[V],b[V],"".concat(A,"-detail-input"),"".concat(A,"-detail-item"),w.Input,n[K],b[K],"".concat(A,"-detail-input"),function(){var e;if(C(!1),b[V]&&null!==(e=b[V])&&void 0!==e&&Xr()(e).call(e)){var t=xe()(r).call(r,(function(e){return e[V]===b[V]}));t&&b[B]!==t[B]?c(n[B]):i(b)}else c(n[B])});return D().createElement(Un.Draggable,{index:t,onDrop:o},D().createElement("div",{className:"".concat(A,"-wrapper")},D().createElement("div",{className:A},u&&D().createElement(ea,{value:n[z],prefixClass:a,onChange:function(e){var t=na(na({},b),{},(0,s.c)({},z,e));I(t),i(t)}}),D().createElement("div",{title:"双击修改显示值",className:"".concat(A,"-content"),onDoubleClick:function(){C(!0),m(!1)}},y?D().createElement(w.Input,{ref:T,className:"".concat(A,"-content_edit"),borderType:"bordered",size:"large",defaultValue:n[V],onBlur:M,onPressEnter:M,onChange:function(e){e.persist();var t=e.target.value;I((function(e){return na(na({},e),{},(0,s.c)((0,s.c)({},V,t),K,fa(t)))}))}}):D().createElement("p",null,n[V])),D().createElement("div",{className:"".concat(A,"-operate")},!y&&-1===n[B].indexOf(ca)&&D().createElement(w.Icon,{className:"".concat(A,"-operate-edit"),prefix:"designericon",type:"bianji3",onClick:function(){C(!0)},ref:N}),D().createElement(w.Icon,{className:"".concat(A,"-operate-drag"),prefix:"designericon",type:"tuozhuailiebiao"}))),D().createElement("div",{title:"删除选项",className:"".concat(A,"-delete"),onClick:function(){return c(n[B])}},D().createElement(w.Icon,{prefix:"designericon",type:"xingshanchu"}))))})),aa=ra;function la(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function oa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?la(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):la(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var ia=n(7136).hooks.useOnDrop,ca="other",ua=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=v()(e).call(e,(function(e){return!F()(t).call(t,e)})),r=0;r<n.length;r++){var a=r+Math.floor(Math.random()*(n.length-r)),l=[n[a],n[r]];n[r]=l[0],n[a]=l[1]}return h()(t).call(t,n)},da=(0,P.c)(Fe()($r).call($r,0,-1)),sa=function(e){return e&&Array.isArray(e)&&0!==e.length?N()(e).call(e,(function(e){return e[B]?e:oa(oa({},e),{},(0,s.c)({},B,(0,k.createUUid)()))})):e},fa=function(e){return encodeURIComponent(e)},pa=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.editor,l=(e.locked,e.Name),o=e.Tips,i=(e.field,a.Enum,a.NameHidden),c=a.Default,u=a.Required,f=a.Title,p="".concat(r,"-custom-option"),m=(0,S.useState)((0,Se.isUndefined)(n)?[]:sa(function(e){return Array.isArray(e)?e:null==e?void 0:e.ops}(n||c))||[]),g=(0,d.c)(m,2),y=g[0],C=g[1],E=(0,S.useState)(""),b=(0,d.c)(E,2),I=b[0],T=b[1],x=(0,S.useState)((0,Se.isUndefined)(null==n?void 0:n.bgcSwitch)?null==c?void 0:c.bgcSwitch:null==n?void 0:n.bgcSwitch),A=(0,d.c)(x,2),M=A[0],P=A[1],R=(0,S.useRef)(null==y?void 0:y.some((function(e){return e[B].indexOf(ca)>-1}))),_=(0,S.useRef)(null),O=(0,S.useRef)({});(0,S.useEffect)((function(){var e="";O.current={},null==y||y.forEach((function(t){var n,r=null==t?void 0:t[V];r&&(e="".concat(e?e+"\n"+r:r),((null===(n=t[B])||void 0===n?void 0:n.indexOf(ca))>-1||"其他"===t[V]||"其他"===t[K])&&(R.current=!0))})),T(e)}),[y]),(0,S.useLayoutEffect)((function(){M||(da=ua(v()(da).call(da,(function(e){return!F()(Jr).call(Jr,e)}))))}),[M]),(0,S.useEffect)((function(){var e,t=v()(e=N()(y).call(y,(function(e){return e[z]}))).call(e,Boolean);da=ua(da,t)}),[]);var j=function(e){var n=[];if(Array.isArray(e))n=N()(e).call(e,(function(e,t){var n=(0,s.c)((0,s.c)((0,s.c)({},V,e),K,fa(e)),B,(0,k.createUUid)());return M&&(n[z]=da[t%da.length]),n})),function(e){Array.isArray(e)&&(C(e),t({bgcSwitch:M,ops:e}))}(n);else{var r=(0,s.c)((0,s.c)((0,s.c)({},B,(0,k.createUUid)()),V,""),K,"");M&&(r[z]=da[((null==y?void 0:y.length)||0)%da.length]),_.current=r,n=y?null==y?void 0:h()(y).call(y,r):[r],C(n)}},L=function(e){if(null!=e&&e[B]){var n=null==y?void 0:N()(y).call(y,(function(t){return t[B]===e[B]?e:t}));C(n),t({bgcSwitch:M,ops:n})}},U=function(e){if(e){var n=v()(y).call(y,(function(t){return t[B]!==e}));C(n),0===n.length&&M===(null==c?void 0:c.bgcSwitch)?t({bgcSwitch:M,empty:!0}):t({bgcSwitch:M,ops:n})}},G=(0,S.useCallback)((function(e){if(e){var n=e.sourceIndex,r=e.destinationIndex,a=(0,Se.cloneDeep)(y),l=ce()(a).call(a,n,1)[0];ce()(a).call(a,r,0,l),t({bgcSwitch:M,ops:a}),C(a)}}),[y,M,t]),H=ia(G);return D().createElement("div",{className:p},D().createElement("div",{className:"".concat(p,"-title")},D().createElement(k.NameTipWrapper,{nameHidden:i,className:r,name:l,tips:o,required:u,title:f}),D().createElement("div",{className:"".concat(p,"-title-colorswitch")},D().createElement("span",{className:"".concat(p,"-title-colorswitch-text")},"彩色"),D().createElement(w.Switch,{checked:M,onChange:function(e){P(e);var n=null==y?void 0:N()(y).call(y,(function(t,n){if(e&&(0,Se.isUndefined)(t.Bgc)){var r=da[n%da.length];return oa((0,s.c)({},z,r),t)}var a=(0,Se.cloneDeep)(t);return delete a[z],a}));C(n),t({bgcSwitch:e,ops:n})}}))),D().createElement(Un.DragContainer,null,D().createElement("div",{className:jn()("".concat(p,"-list"))},null==y?void 0:N()(y).call(y,(function(e,t){var n;return D().createElement(aa,{key:e[B],index:t,options:y,option:e,prefixClass:p,handleDeleteOption:U,handleEditOption:L,isNewOptionEdit:(null===(n=_.current)||void 0===n?void 0:n[B])===e[B],bgcolorChecked:M,onDrop:H})})))),D().createElement("div",{className:jn()("".concat(p,"-handle"))},D().createElement("div",{className:jn()("".concat(p,"-handle-addoption")),onClick:function(){return j()}},D().createElement(w.Icon,{prefix:"designericon",type:"zengjia-yuan"}),D().createElement("span",null,"添加选项")),D().createElement(Yr,{prefixClass:p,defaultBatchValue:I,handleAddOption:j})))};function ma(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function va(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ma(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):ma(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var ga=(0,P.c)(Fe()($r).call($r,0,-1)),ya=function(e){return F()(He).call(He,e)},Ca=function(e,t,n){var r=t._Type_,a=t.EntityData,l=void 0===a?{}:a,o=[],i=p()(e).reduce((function(t,a){var l=n.getControlMetaProperty(r,a),i=n.getControlPropertyDefaultValue(r,a),c=l.Tag;return c!==Be&&c!==_e||(t[a]=e[a],(0,Se.isEqual)(e[a],i)&&o.push(a)),t}),{});return(0,yt.produce)(l,(function(e){(0,R.c)(e,i),o.forEach((function(t){delete e[t]}))}))},ha=function(e,t,n,r){r.globalConfig,r.dataContext,r.selectionContext,r.action,r.dataFactory,r.modelFactory;var a=r.metaReader;if(!n)return!1;var l=n._Type_,o=n.EntityData,i=void 0===o?{}:o;if(ya(l))return!1;var c=[],u=p()(t).reduce((function(e,n){var r=a.getControlMetaProperty(l,n),o=a.getControlPropertyDefaultValue(l,n),i=r.Tag;return i!==Be&&i!==_e||(e[n]=t[n],(0,Se.isEqual)(t[n],o)&&c.push(n)),e}),{}),d=(0,yt.produce)(i,(function(e){(0,R.c)(e,u),c.forEach((function(t){delete e[t]}))}));return p()(u).length?(0,k.createUpdateAction)([[e,{EntityData:d}]]):void 0},Ea=["ApType","EntityData",O,_,B,"Index","Features","FieldName",U],ba=function(e,t){return"string"==typeof e?e:(null==e?void 0:e[t])||(null==e?void 0:e.Default)},Ia=function(e,t){var n=t.dataContext,r=t.metaReader,a=e._Type_,l=e.Id,o=e.ParentId,i=n.getRootId();if(ct(a))return e;var c=n.findControl(o),u=c._Type_,d=c.Status,s=r.getControlMeta(a),f=s.ApType,m=s.BaseType,v=r.getControlMeta(u).BaseType;if(f&&!ya(a)){var g,y=p()(e).reduce((function(t,n){var l=r.getControlMetaProperty(a,n).Tag;return(l===Be||l===_e||F()(Re).call(Re,n))&&(t[n]=e[n]),t}),{});Kt(u)&&(y.ParentId=i);var C="".concat(m,"Id");if(e[C]=l,e.FieldType=a,e.ApType=ba(f,v),ut(a)&&(null==y||null===(g=y.CustomContent)||void 0===g||null===(g=g.ops)||void 0===g||!g.length)){var h;ga=ua(ga);var E=r.getControlPropertyDefaultValue(a,"CustomContent"),b=N()(h=E.ops).call(h,(function(e,t){return va(va({},e),{},{Bgc:ga[t]})})),I={bgcSwitch:!0,ops:sa(b)};e.CustomContent=I,(0,R.c)(y,{CustomContent:I})}e.EntityData=y}return(lt(u)||ot(u))&&(e._isEntryField_=!0),Kt(u)&&d&&(e.Status=d),e};function Na(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ta(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Na(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Na(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var xa=function(e,t){var n,r=e.SourceForm,a=e.BillEntityIdEx,l=new(vn())(t);return"1"===r||!(!a||F()(n=["bos_user","bos_adminorg"]).call(n,a))&&l.has(a)},Aa=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return t?[N()(t).call(t,(function(t){var l=t||{},o=l.label,i=l.value,c=l.children,u=l.icon,d=l.customParams,s=Ta({key:i,title:o},n);return u&&(s.icon=u),c?(c.length&&(s.children=e(c,{},null==d?void 0:d.currentApp,a)[0]),s.checkable=!1,s.selectable=!1):s.isLeaf=!0,r&&a.push(i),s})),a]:t},Fa=function(e){var t=(null==e?void 0:e.FieldType)||e._Type_;return ot(t)&&"1"===e.ShowType||$e(t)&&"2"===e.ShowType},Sa=function(e){var t;return F()(t=["NoCodeCreatorField","NoCodeCreateDateField","NoCodeModifierField","NoCodeModifyDateField","NoCodeBillNoField"]).call(t,e)},Da=function(e,t){var n=["NoCodeRefBillTable","NoCodeRichTextField","NoCodeGroupContainerAp","NoCodeGraphicDisplayField"];return F()(n).call(n,e)},ka=function(e,t){var n={},r="string"==typeof t?t:(0,P.c)(t).join(),a=F()(r).call(r,"_startdate")?r.replace("_startdate","").replace("_enddate",""):r,l=new(vn())(a.split(",")),o=[];return e.forEach((function(e){l.add(e.Key),n[e.Key]=e})),l.forEach((function(e){null!=n&&n[e]&&o.push(n[e])})),o},Ma=function(e,t){var n,r;return e.EntityData=t,e.ApType=tt(t._Type_)?"NoCodeSystemAp":e._Type_,e._Type_=t._Type_,e.FieldType=t._Type_,n=e,r=t,p()(r).forEach((function(e){_r()(n,e)||(0,R.c)(n,(0,s.c)({},e,r[e]))})),e},wa=function(e,t){var n,r,a,l,o=t||{},i=o.Id,c=o.SourceForm,u=o.PropsDisplay,d=o.inner2Outer,s=o.BillEntityIdEx,f=(0,Se.cloneDeep)(e),p=new(vn())(u?u.split(","):[]),m=s||"".concat(i,"_table"),v=(null==f||null===(n=f.entitymeta)||void 0===n?void 0:n.Items)||[],g=(null==f||null===(r=f.formmeta)||void 0===r?void 0:r.Items)||[],y={},C=[],h=F()(a=["bos_user","bos_adminorg"]).call(a,m),E=new(vn());return null==f||null===(l=f.formmeta)||void 0===l||null===(l=l.Items)||void 0===l||l.forEach((function(e){y[e.Id]=e})),v.length&&(g.forEach((function(e){(Kt(e._Type_)||it(e._Type_))&&E.add(e.Id)})),v.forEach((function(e){var t,n,r=Ma((null==y?void 0:y[e.Id])||{},e);if(r._isEntryField_=!0,"1"===c)!(d||!Sa(e._Type_))||Da(e._Type_)||Kt(e._Type_)||it(e._Type_)||(r.isShow=!d||p.has(e.Key),C.push(r));else if(h||(Sa(e._Type_)||E.has(null==r?void 0:r.ParentId))&&!Da(r._Type_)){var a=p.has(e.Key);Qe(e._Type_)&&(t=e.Key,n=p,a=(0,P.c)(n).some((function(e){return F()(e).call(e,t)}))),r.isShow=a,C.push(r)}}))),C},Pa=function(e,t,n,r,a,l,o){var i=[],c=e.reduce((function(e,l){var o,c=r.findControl(l)||{},u=c.ParentId,d=c.Key,s=c.RefTableId,f=c.RefBillId,p=c._Type_,m=r.findControl(u)||{},v=m._Type_,g=m.SourceForm,y=m.BillEntityIdEx,C=m.PropsDisplay;if(ot(v)){var E,b="1"!==g||y?y:"".concat(u,"_table"),I=l.replace("_".concat(u),"");"1"!==g&&F()(E=t[b].ids).call(E,I)||n({key:Hr,payload:{form:b,id:I}});var N=new(vn())(C?C.split(","):[]),T=d.toLowerCase().replace("_".concat(u.toLowerCase()),"");Qe(p)?(N.delete("".concat(T,"_startdate")),N.delete("".concat(T,"_enddate"))):N.delete(T);var A=(0,P.c)(N).join();i=[[u,{PropsDisplay:A}]]}return f&&delete a[f],s&&x()(a).forEach((function(e){e.Id!==s&&e.ParentId!==s||delete a[e.Id]})),h()(o=[]).call(o,(0,P.c)(e),[l])}),[]);l(a),jr().all([r.deleteControl((0,k.createDeleteAction)(c)),r.batchUpdateControlPropertyValues((0,k.createUpdateAction)(i))]).then((function(){null==o||o()})).catch((function(e){}))},Ra=function(e,t){var n,r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[{},{}],l=e.Id,o=e.Key,i=e._Type_,c=e.EntityData,u=(0,Se.cloneDeep)(e),d=t.toLowerCase(),s=o.toLowerCase(),f=F()(s).call(s,d)?s:h()(n="".concat(s,"_")).call(n,d),p=F()(l).call(l,t)?l:h()(r="".concat(l,"_")).call(r,t);return["isShow","UploadDefValue","PictureDefValue","NoCodeDefValue","FieldRequired","Status","Visibility"].forEach((function(e){delete u[e],delete c[e]})),Qe(i)&&(u.StartDateFieldKey="".concat(f,"_startdate"),u.EndDateFieldKey="".concat(f,"_enddate"),u.EntityData.StartDateFieldKey="".concat(f,"_startdate"),u.EntityData.EndDateFieldKey="".concat(f,"_enddate")),Ta(Ta(Ta({},u),{},{Id:p,Key:f,ParentId:t,FieldId:p},a[0]),{},{EntityData:Ta(Ta({},c),{},{Id:p,Key:f,ParentId:t},a[1]),_isEntryField_:!0})},Ba=function(e,t,n,r){var a=t.reduce((function(e,t){return Ta(Ta({},e),{},(0,s.c)({},t.Id,t))}),{}),l=[],o=e.reduce((function(e,t){var o=Ta({},t);if(t.isShow){var i,c;l.push(o.Key),delete o.isShow;var u=function(e,t,n){if(t){var r=n.getDefaultData(e._Type_),a=[{},{}];return Xe.forEach((function(l){var o=n.getControlMetaProperty(e._Type_,l).Tag,i=o===Be||o===_e,c=t[l]||r[l];i?(c&&(a[1][l]=c),c&&(a[0][l]=c)):c&&(a[0][l]=c)})),a}}(t,a[h()(i="".concat(o.Id,"_")).call(i,n)],r);return h()(c=[]).call(c,(0,P.c)(e),[Ra(o,n,u)])}return e}),[]);return[o,l]},_a=["dragEvent"];function Oa(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ja(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oa(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Oa(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var La=function(e){var t,n=e.field,r=(e.rootWidth,e.rowHeight),a=e.headHeight,l=e.isMb,o=void 0!==l&&l,i=e.autoRowHeight,c=n.Id,u=n.Key,d=n.Name,f=n.ListFieldId,p=n.HelpTips,m=n.Status,v=_n(n),g=v.dragEvent,y=(0,Ce.c)(v,_a),C=(0,S.useContext)(le),E=C.prefixCls,b=C.fieldStatusMap,I=C.getKdesignerApi,N=C.billPropsData,T=C.fieldStatusSettingMode,x=(I()||{}).data,A=(0,S.useMemo)((function(){var e=x.getParentControl(c),t=x.findControl(c);return e.BillEntityIdEx!==x.getRootId()&&(!(null!=t&&t.RefBillId)&&!(null!=t&&t.RefTableId)&&ot(e._Type_)&&xa(e,(null==N?void 0:N.innerForm)||[]))}),[N,c]),F=A?Yn(n):{},k=jn()(["".concat(E,"-entry-field"),(0,s.c)({"item-mb":o,"item-hidden":m===Ze.HIDDEN},h()(t="".concat(E,"-item-")).call(t,b[u]),b[u])]),M=d,w={};return!i&&(w={height:r}),D().createElement("div",(0,R.c)({className:k},y,g,{"data-entry-field":n.Key,"data-enable-click":"permission"!==T||A}),D().createElement("div",(0,R.c)({className:"cellHead",style:{height:a}},F),D().createElement(Un.FieldItem.Label,{value:"fseq"===f?"#":M,required:Xn(n,b),tips:p,prefixCls:"nc-field-item",style:{marginBottom:"0",fontWeight:"bold"}})),D().createElement("div",{className:"cellContent",style:ja({},w)}))},Ka=function(e){var t,n,r,a,l=e.field,o=l.FieldType,i=l.FileMaxSize,c=l.UploadNum,u=l.ImageFileType,d=l.UploadPrompt,s=l.ButtonText,f=(0,S.useContext)(le).getKdesignerApi,p=_n(l),m=f().meta,g=m.getControlPropertyDefaultValue,y=(0,m.getControlMetaEditor)(o,"ImageFileType").Enum,C=g(o,"FileMaxSize"),E=g(o,"ImageFileType"),b=u||E,I=N()(t=b.split(",")).call(t,(function(e){return v()(y).call(y,(function(t){return t.Id===e}))[0].Name})),T=d?h()(n=h()(r=h()(a="请上传小于".concat(i||C,"M的")).call(a,I.join("，"),"文件，文件个数不少于")).call(r,(null==c?void 0:c.min)||0,"个，不多于")).call(n,(null==c?void 0:c.max)||1,"个。"):"";return D().createElement(Zn,(0,R.c)({},p,{field:l}),D().createElement(Un.Picture,(0,R.c)({style:{fontSize:"12px",textAlign:"left",pointerEvents:"none"},noticeInfo:T,buttonText:s,pasteThumbnail:!1},{})))},Va=n(5680),Ua=n.n(Va),Ga=function(e){var t,n,r,a=e.field,l=a.FieldType,o=a.FileMaxSize,i=a.UploadNum,c=a.UploadModel,u=(a.UploadPrompt,a.ButtonText),d=a.AttachmentFileType,s=(0,S.useContext)(le).getKdesignerApi,f=_n(a),p=s().meta,m=p.getControlPropertyDefaultValue,v=(p.getControlMetaEditor,m(l,"FileMaxSize")),g=h()(t=h()(n=h()(r="请上传小于".concat(o||v,"M的")).call(r,null==d?void 0:Ua()(d).call(d,".",""),"文件，文件个数不少于")).call(n,(null==i?void 0:i.min)||0,"个，不多于")).call(t,(null==i?void 0:i.max)||1,"个。");return D().createElement(Zn,(0,R.c)({},f,{field:a}),D().createElement(Un.Attachment,(0,R.c)({style:{fontSize:"12px",textAlign:"left",pointerEvents:"none"},fileList:[],mode:c,uploadNum:i,noticeInfo:g,buttonText:u,pasteThumbnail:!1},{})))},za=function(e){var t=e.field,n=_n(t),r=window.__kd_cdnPath__||window.__domainurl__,a=t.NoCodeDefValue,l=t.DefaultHeight,o=t.Status,i=t.AutoHeight,c=o===Ze.READONLY,u=o===Ze.DISABLED;return D().createElement(Zn,(0,R.c)({},n,{field:t}),D().createElement(Un.RichText,{height:l,autoHeight:i,content:a,srcUrl:r,readOnly:c,disabled:u,isDesigner:!0}))},Ha=function(e){var t=e.field,n=_n(t),r=t.Content,a=t.Margin,l=t.DefaultHeight,o=t.AutoHeight,i=Xt(a),c=i.margin,u=i.marginTop,d=i.marginRight,s=i.marginBottom,f=i.marginLeft,p={marginTop:"".concat(u,"px"),marginRight:"".concat(d,"px"),marginBottom:"".concat(s,"px"),marginLeft:"".concat(f,"px")},m=-1===c?p:{margin:"".concat(c,"px")};return D().createElement("div",{className:"graphic-display-ap",style:"0"!==c?m:{}},D().createElement(Zn,(0,R.c)({},n,{field:t}),D().createElement(Un.GraphicDisplay,{content:r,autoHeight:o,defaultHeight:l})))},qa=n(1184),Ya=function(e){var t,n=(0,S.useContext)(le),r=(n.isPC,n.getKdesignerApi),a=(0,S.useMemo)((function(){return r()}),[]).data,l=(a.getData(),e.ParentId),o=e.GroupParentId,i=a.getSubControls(l);return yn()(t=v()(i).call(i,(function(e){return e.GroupParentId===o}))).call(t,(function(e,t){return Number(e.GroupIndex)-Number(t.GroupIndex)}))};function Wa(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wa(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Wa(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Za=function(e){if(!e)return{};var t=oe({Id:e}),n=on(),r=ne({Id:e}),a=wn({Id:e});return Xa(Xa(Xa({},t),{},{onMouseDown:n},r),a)},Qa=["controlId","parentColumn","className"];function Ja(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function $a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ja(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Ja(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var el=function(e){var t=e.controlId,n=e.parentColumn,r=e.className,a=(0,Ce.c)(e,Qa),l=(0,S.useContext)(le),o=l.prefixCls,i=l.getKdesignerApi,c=l.isPC,u=i().data,d=u.getData(),s=u.findControl,f=Kn({Id:t},d,{isPC:c,excludeType:Ve},s);return D().createElement(Un.GridPanel,(0,R.c)({column:0===f.length?1:n},a),f.length>0?N()(f).call(f,(function(e){var t,r,a,l=(null==e||null===(t=e.props)||void 0===t?void 0:t.field)||{},o=l.ColumnSpan,i=l.key,c=l.id,u=(a=o,Math.min(n,Number(a)||4));return null!=e&&null!==(r=e.props)&&void 0!==r&&null!==(r=r.field)&&void 0!==r&&r.ColumnSpan&&(e.props.field.ColumnSpan=u),D().cloneElement(e,{key:c,itemKey:e.key||i,columnSpan:u})})):D().createElement("div",(0,R.c)({className:jn()(r,"".concat(o,"_group_item_dropbox")),columnSpan:4},a),"拖拽内容到这里"))},tl=(0,S.memo)((function(e){var t=e.id,n=e.hidden,r=e.defaultBar,a=e.handleItemClick,l=(0,S.useContext)(le),o=l.getKdesignerApi,i=l.fieldStatusMap,c=(l.prefixCls,l.fieldStatusSettingMode),u=(0,S.useMemo)((function(){return o()}),[]).data.findControl(t),d=u.Status,s=u.Key,f=Za(t),p=(0,R.c)({},((0,qa.c)(f),f)),m=Yn({Id:t},!1),v=null==i?void 0:i[s];return D().cloneElement(r,$a($a($a({id:t,"data-group-bar-item-id":t},p),m),{},{"data-enable-click":"permission"!==c,style:{color:n?"#cccccc":"inherit",opacity:(d!==Ze.HIDDEN||c&&v)&&"hidden"!==v?"1":"0.5"},onClick:function(e){a(t)}}))}));tl.displayName="TabBar";var nl=function(e){var t,n=e.id,r=e.columnSpan,a=(0,S.useContext)(le),l=a.getKdesignerApi,o=a.fieldStatusMap,i=a.prefixCls,c=(0,S.useMemo)((function(){return l()}),[]).data.findControl(n),u=(c.Status,c.Key),d=Pn(c);return D().createElement(el,(0,R.c)({key:n,controlId:n,parentColumn:r,"data-group-container-item":n,className:jn()((0,s.c)({},h()(t="".concat(i,"-item-")).call(t,o[u]),o[u]))},d))},rl=function(e){var t,n=e.field,r=e.columnSpan,a=(0,S.useContext)(le),l=a.getKdesignerApi,o=a.fieldStatusMap,i=a.prefixCls,c=a.fieldStatusSettingMode,u=(0,S.useMemo)((function(){return l()}),[]),f=u.selection,p=(u.data,n.Id),m=n.Key,v=(n.Name,n.TitleArea,n.Collapse),g=(n.HelpTips,n.ColumnSpan,(0,S.useState)(p)),y=(0,d.c)(g,2),C=y[0],E=y[1],b=(0,S.useRef)([]),I=(0,S.useRef)(null),N=(0,S.useReducer)((function(e){return e+1}),0),T=(0,d.c)(N,2);T[0],T[1];(0,S.useEffect)((function(){if(I.current){var e=I.current.querySelector("[data-tabs-header]");null==e||e.setAttribute("data-group-bar",p)}}),[]);var x=Ya(n).reduce((function(e,t){var n=t.Id,a=t.Name,l=t.TitleArea,o=t.HelpTips;return e.push({id:n,name:a,titleHidden:mt(l),tips:o,key:n,label:a,children:D().createElement(nl,{id:n,columnSpan:r})}),e}),[]);b.current=x,(0,S.useEffect)((function(){var e=f.getSelection()||[],t=e[0];if(t){var n,r=xe()(x).call(x,(function(e){return e.id===t}))?null==e?void 0:e[0]:null==x||null===(n=x[0])||void 0===n?void 0:n.id;E(r),document.querySelectorAll("[".concat(W,"=true]")).forEach((function(t){F()(e).call(e,t[H])||null==t||t.removeAttribute(W)}))}}),[x.length]);var A=function(e){"permission"!==c&&C!==e&&(en(C,e),E(e),f.setSelect(e))},k=function(){var e,t=f.getActiveSelectedId();(null===(e=b.current)||void 0===e?void 0:xe()(e).call(e,(function(e){return e.id===t})))&&C!==t&&E(t)};(0,S.useEffect)((function(){var e=f.addSelectChangeListener(k);return function(){e()}}),[k]);var M=Za(C),w=(0,R.c)({},((0,qa.c)(M),M)),P=Pn(n),B=1===x.length?P:{};return D().createElement(Un.Tabs,(0,R.c)({ref:I,activeKey:C,allowCollapse:v,onChange:A,"data-group-container":p},w,B,{"data-enable-click":"permission"!==c,renderTabBar:function(e,t){return D().createElement(tl,(0,R.c)({},e,{defaultBar:t,handleItemClick:A}))},items:x,className:jn()((0,s.c)({},h()(t="".concat(i,"-item-")).call(t,o[m]),1===x.length&&o[m]))}))},al=["dragEvent"],ll=(0,S.memo)((function(e){var t=e.field,n=(0,S.useContext)(le).prefixCls,r=_n(t),a=r.dragEvent,l=(0,Ce.c)(r,al),o=t.Name;t.EmptyText,t.DataRage,t.showClearButton,t.Status,t.Visibility;return D().createElement("div",(0,R.c)({className:"".concat(n,"-bizbutton")},l,a),D().createElement(Un.BtnField,null,o))}));ll.displayName="NoCodeBizButtonAp";var ol={NoCodeTextField:tr,NoCodeSelectItemField:nr,NoCodeRefBillField:Nr,NoCodeMulRefBillField:Nr,NoCodeTextAreaField:Tr,NoCodeDecimalField:xr,NoCodeDateField:Fr,NoCodeDateRangeField:Sr,NoCodeEntryEntity:Pr,NoCodeRefBillTable:Pr,NoCodeEntryFieldAp:La,NoCodeImageUploadField:Ka,NoCodeAttachmentUploadField:Ga,NoCodeCreateDateField:tr,NoCodeCreatorField:tr,NoCodeModifyDateField:tr,NoCodeModifierField:tr,NoCodeBillNoField:tr,NoCodeGroupContainerAp:rl,NoCodeBizButtonAp:ll,NoCodeRichTextField:za,NoCodeGraphicDisplayField:Ha},il=function(e){var t=e.field,n=_n(t);return D().createElement(Zn,(0,R.c)({},n,{field:t}),D().createElement($n,{type:"Text",field:t,props:{}}))},cl=function(e){var t,n=e.field,r=n._Type_,a=n.ShowType,l=_n(n),o=Pt(n),i=_t(n),c={readonlyValue:Mt(n),options:Rt(n),defaultValue:i,value:i,multiple:wt(null==n?void 0:n.SelectItemType),showBgcBlock:Bt(n)};return F()(t=["Checkbox","Radio"]).call(t,o)&&(c.vertical=Ot(null==n?void 0:n.TileTypePc)),$e(r)&&"2"===a?null:D().createElement(Zn,(0,R.c)({},l,{field:n}),D().createElement($n,{type:o,field:n,props:c}))},ul=function(e){var t=e.field,n=_n(t),r=t.CounterDisplay,a=t.DefaultLines,l={showCount:!!(0,Se.isUndefined)(r)||r,autoSize:{minRows:a,maxRows:a}};return D().createElement(Zn,(0,R.c)({},n,{field:t}),D().createElement($n,{type:"Textarea",field:t,props:l}))},dl=function(e){var t=e.field,n=_n(t),r=(t.EmptyText,t.DefValue,t.showClearButton,t.Status,t.ThousandsSeparator),a=t.Scale,l=t.Precision,o=t.Stepper,i={borderType:"bordered",readOnly:!0,allowClear:!1,formatter:(0,S.useCallback)((function(e){return r?"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","):String(e)}),[r]),decimalLength:a,showStepper:o,maxLength:l};return D().createElement(Zn,(0,R.c)({},n,{field:t}),D().createElement($n,{type:"Number",field:t,props:i}))},sl={0:"second",1:"day"},fl=function(e){var t=e.field,n=_n(t),r={borderType:"bordered",picker:sl[t.FormatType||"1"]};return D().createElement(Zn,(0,R.c)({},n,{field:t}),D().createElement($n,{type:"DatePicker",field:t,props:r}))},pl={0:"second",1:"day"},ml=function(e){var t=e.field,n=_n(t),r={borderType:"bordered",picker:pl[t.FormatType||"1"]};return D().createElement(Zn,(0,R.c)({},n,{field:t}),D().createElement($n,{type:"DateRangePicker",field:t,props:r}))},vl=function(e){var t,n,r,a,l=e.field,o=(0,S.useContext)(le).getKdesignerApi,i=l.FieldType,c=l.FileMaxSize,u=l.UploadNum,d=l.ImageFileType,s=o().meta,f=s.getControlPropertyDefaultValue,p=(0,s.getControlMetaEditor)(i,"ImageFileType").Enum,m=f(i,"FileMaxSize"),g=f(i,"ImageFileType"),y=d||g,C=N()(t=y.split(",")).call(t,(function(e){return v()(p).call(p,(function(t){return t.Id===e}))[0].Name})),E=_n(l),b={disabled:!0,noticeInfo:h()(n=h()(r=h()(a="请上传小于".concat(c||m,"M的")).call(a,C.join(),"文件，文件个数不少于")).call(r,(null==u?void 0:u.min)||0,"个，不多于")).call(n,(null==u?void 0:u.max)||1,"个。")};return D().createElement(Zn,(0,R.c)({},E,{field:l}),D().createElement($n,{type:"Picture",field:l,props:b}))},gl=function(e){var t,n,r,a=e.field,l=a.FieldType,o=a.FileMaxSize,i=a.UploadNum,c=a.UploadModel,u=a.UploadPrompt,d=a.ButtonText,s=a.AttachmentFileType,f=(0,S.useContext)(le).getKdesignerApi,p=_n(a),m=(0,f().meta.getControlPropertyDefaultValue)(l,"FileMaxSize"),v=u?h()(t=h()(n=h()(r="请上传小于".concat(o||m,"M的")).call(r,null==s?void 0:Ua()(s).call(s,".",""),"文件，文件个数不少于")).call(n,(null==i?void 0:i.min)||0,"个，不多于")).call(t,(null==i?void 0:i.max)||1,"个。"):"";return D().createElement(Zn,(0,R.c)({},p,{field:a}),D().createElement(Gn.Attachment,(0,R.c)({style:{fontSize:"12px",textAlign:"left"},fileList:[],mode:c,uploadNum:i,noticeInfo:v,buttonText:d},{disabled:!0})))},yl=function(e){var t=e.field,n=_n(t),r=t.NoCodeDefValue,a=t.DefaultHeight,l=t.AutoHeight,o=t.Status===Ze.READONLY,i=Xt(r);return D().createElement(Zn,(0,R.c)({},n,{field:t}),D().createElement(Gn.RichText,{readOnly:o,content:(null==i?void 0:i.value)||"",height:a,autoHeight:l}))},Cl=function(e){var t=e.field,n=_n(t),r=t.Content,a=t.Margin,l=t.DefaultHeight,o=t.AutoHeight,i=Xt(a),c=i.margin,u=i.marginTop,d=i.marginRight,s=i.marginBottom,f=i.marginLeft,p={marginTop:"".concat(u,"px"),marginRight:"".concat(d,"px"),marginBottom:"".concat(s,"px"),marginLeft:"".concat(f,"px")},m=-1===c?p:{margin:"".concat(c,"px")};return D().createElement("div",{className:"graphic-display-ap",style:"0"!==c?m:{}},D().createElement(Zn,(0,R.c)({},n,{field:t}),D().createElement(Un.GraphicDisplay,{content:r,autoHeight:o,defaultHeight:l})))},hl=["controlId"],El=["defaultBar","handleItemClick"];function bl(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Il(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bl(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):bl(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Nl=function(e){var t=e.controlId,n=(0,Ce.c)(e,hl),r=(0,S.useContext)(le),a=r.prefixCls,l=r.getKdesignerApi,o=r.isPC,i=l().data,c=i.getData(),u=i.findControl,d=Kn({Id:t},c,{isPC:o,excludeType:Ve},u);return D().createElement(Gn.GridPanel,(0,R.c)({gutter:[24,24]},n),d.length>0?d:D().createElement("div",(0,R.c)({className:"".concat(a,"_group_item_dropbox")},n),"拖拽内容到这里"))},Tl=(0,S.memo)((function(e){var t=e.defaultBar,n=e.handleItemClick,r=(0,Ce.c)(e,El),a=r.id,l=r.tips,o=Za(a),i=Yn({Id:a},!1);return D().cloneElement(t,Il(Il(Il({id:a,"data-group-bar-item-id":a,tips:l},o),i),{},{onClick:function(e){n(a),o.onClick(e)}}))}));Tl.displayName="TabBar";var xl=function(e){var t=e.id;return D().createElement(Nl,{key:t,controlId:t,"data-group-container-item":t})},Al=function(e){var t=e.field,n=(0,S.useContext)(le),r=n.getKdesignerApi,a=(n.prefixCls,r().selection),l=t.Id,o=(t.Name,t.TitleArea,t.HelpTips,t.Collapse),i=(0,S.useState)(l),c=(0,d.c)(i,2),u=c[0],s=c[1],f=(0,S.useRef)([]),p=(0,S.useRef)(null);(0,S.useEffect)((function(){if(p.current){var e=p.current.querySelector("[data-tabs-header]");null==e||e.setAttribute("data-group-bar",l)}}),[]);var m=Ya(t).reduce((function(e,t){var n=t.Id,r=t.Name,a=t.TitleArea,l=t.HelpTips;return e.push({id:n,name:r,titleHidden:mt(a),tips:l,key:n,label:r,children:D().createElement(xl,{id:n})}),e}),[]);f.current=m;var v=function(){var e,t=a.getActiveSelectedId();(null===(e=f.current)||void 0===e?void 0:xe()(e).call(e,(function(e){return e.id===t})))&&s(t)};(0,S.useEffect)((function(){var e=a.getSelection();null!=e&&e[0]&&(xe()(m).call(m,(function(t){return t.id===(null==e?void 0:e[0])}))&&s(null==e?void 0:e[0]))}),[m.length]),(0,S.useEffect)((function(){var e=a.getSelection();if((null==e?void 0:e[0])===u&&!xe()(m).call(m,(function(e){return e.id===u}))){var t=null==m?void 0:m[0].id;en(u,t,(function(e){e.removeAttribute(W)})),s(t)}}),[m,u]),(0,S.useEffect)((function(){v();var e=a.addSelectChangeListener(v);return function(){e()}}),[]);var g=function(e){a.setSelect([e]),s(e)},y=Za(u);return D().createElement(Gn.Tabs,(0,R.c)({ref:p,activeKey:u,allowCollapse:o,onChange:g,"data-group-container":l,items:m,renderTabBar:function(e,t){return D().createElement(Tl,(0,R.c)({},e,{defaultBar:t,handleItemClick:g}))}},y))},Fl=["NoCodeImageUploadField","NoCodeAttachmentUploadField"],Sl=function(e){var t=e.field,n=t._Type_,r=(t.ShowBatImportBtn,t.ShowBatExportBtn,t.ShowSeqField),a=(t.ShowType,(0,S.useContext)(le)),l=a.getKdesignerApi,o=a.prefixCls,i=l(),c=i.data,u=i.meta,d=c.getData(),s=c.findControl,f=u.getControlPropertyDefaultValue(n,"SeqName"),p=t.SeqName,m=void 0===p?f:p,v=Kn(t,d,{isPC:!1},s),g=(0,S.useMemo)((function(){var e,t;if(r)return"".concat(m,"：1");var n=xe()(v).call(v,(function(e){var t,n=(null==e||null===(t=e.props)||void 0===t?void 0:t.field)._Type_;return!F()(Fl).call(Fl,n)}));if(!n)return"-";var a=null==n||null===(e=n.props)||void 0===e?void 0:e.field,l=a.Name,o=a.DefValue;return h()(t="".concat(l,"：")).call(t,o||"-")}),[r,m,v]);return v.length?D().createElement(D().Fragment,null,D().createElement("div",{className:"".concat(o,"-entry-mb-operator")},D().createElement(w.Button,{type:"ghost",size:"small",icon:D().createElement(w.Icon,{prefix:"ncicon",type:"zengjia-yuan"})},"新增"),D().createElement(w.Button,{size:"small",icon:D().createElement(w.Icon,{prefix:"ncicon",type:"xuanze"})},"选择")),D().createElement("div",{className:"".concat(o,"-entry-mb-item")},D().createElement(Gn.CollapsePanel,{isOpen:!0,title:g,extra:D().createElement(w.Icon,{prefix:"designericon",type:"shanchu"}),transitionDuration:0},N()(v).call(v,(function(e,t){return D().createElement("div",{className:"".concat(o,"-entry-mb-sub-control"),key:t},e)}))))):D().createElement("div",{className:"".concat(o,"-entry-mb-empty")},"拖拽或点击添加内容")},Dl=function(e){var t=e.field,n=t._Type_,r=t.ShowType,a=_n(t);return ot(n)&&"1"===r?null:D().createElement(Zn,(0,R.c)({field:t,tipsTrigger:"click"},a),D().createElement(Sl,{field:t}))},kl={NoCodeTextField:il,NoCodeSelectItemField:cl,NoCodeDecimalField:dl,NoCodeRefBillField:cl,NoCodeMulRefBillField:cl,NoCodeTextAreaField:ul,NoCodeGroupContainerAp:Al,NoCodeEntryEntity:Dl,NoCodeRefBillTable:Dl,NoCodeCreateDateField:il,NoCodeCreatorField:il,NoCodeModifyDateField:il,NoCodeModifierField:il,NoCodeBillNoField:il,NoCodeDateField:fl,NoCodeDateRangeField:ml,NoCodeAttachmentUploadField:gl,NoCodeImageUploadField:vl,NoCodeRichTextField:yl,NoCodeGraphicDisplayField:Cl};function Ml(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function wl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ml(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Ml(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Pl={UndefinedControl:Ln,RootPanel:Hn},Rl=wl(wl(wl({},ol),kl),Pl);function Bl(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function _l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bl(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Bl(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Ol=function(e){var t,n,r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).isPC,a=void 0===r||r,l=e.ParentId,o=e._Type_,i=e.Id,c=e._isEntryField_,u=(0,D().useContext(le).getKdesignerApi)(),d=u.meta,s=(u.data.getSubControls(i).length,null===(t=d.getControlMeta(o))||void 0===t?void 0:t.IsContainer),f=_l(_l({},d.getDefaultData(o)),e),p=h()(n="".concat(s?"".concat(i):i,"-")).call(n,f.Visibility),m={field:Zt(f),key:p,_IsContainer:s};if(!l)return D().createElement(Rl.RootPanel,m);var v,g,y=(g=a,v=$e(v=a&&c?"NoCodeEntryFieldAp":o)?"NoCodeRefBillField":v,g?ol[v]:kl[v]);return y?D().createElement(y,m):D().createElement(Rl.UndefinedControl,m)},jl=function(e){var t=e.value;e.oldValue.forEach((function(e){var t;document.querySelectorAll(h()(t="[".concat(H,'="')).call(t,e,'"]')).forEach((function(e){return null==e?void 0:e.removeAttribute(W)}))})),t.forEach((function(e){var t;document.querySelectorAll(h()(t="[".concat(H,'="')).call(t,e,'"]')).forEach((function(e){null==e||e.setAttribute(W,"true"),e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded():e.scrollIntoView({block:"nearest"})}))}))},Ll=n(4496),Kl=n.n(Ll),Vl="nocodedesigner.CopyContent",Ul="nocodedesigner.CopyIds",Gl=function(e){window.sessionStorage.setItem(Vl,Kl()(e))},zl=function(){var e=window.sessionStorage.getItem(Vl);return e&&(e=JSON.parse(e)),e},Hl=function(e){window.sessionStorage.setItem(Ul,Kl()(e))},ql=function(){var e=window.sessionStorage.getItem(Ul);return e&&(e=JSON.parse(e)),e},Yl=function(){window.sessionStorage.removeItem(Vl),window.sessionStorage.removeItem(Ul)},Wl=function(){var e=(0,S.useContext)(le).getKdesignerApi,t=(0,S.useMemo)((function(){return e()}),[]).selection.getSelection;return{setCopyContent:Gl,getCopyContent:zl,setCopyIds:Hl,getCopyIds:ql,setDatasetCutControl:function(){t().forEach((function(e){var t;document.querySelectorAll(h()(t="[".concat(H,'="')).call(t,e,'"]')).forEach((function(e){e.setAttribute(Z,"true")}))}))},removeDatasetCutControl:function(){var e=document.querySelectorAll("[".concat(Z,"]"));return e.length&&e.forEach((function(e){e.removeAttribute(Z)})),e.length},clearCopyContent:Yl}},Xl=function(e,t,n,r,a,l,o,i){var c=e.getSelection,u=e.setSelect,d=(e.getActiveSelectedId,c());if(d.length>0){if(F()(d).call(d,r))return n("禁止删除根节点");var s=v()(d).call(d,(function(e){return e!==r})),f=t.getData().Items,p=xe()(f).call(f,(function(e){return F()(s).call(s,e.Id)}));if(!p)return;var m=p.Id,g=p.ParentId,y=p._Type_,C=(p.RefBillId,p.RefTableId,p.GroupIndex);if(1===s.length){var h=t.getNextSelectedControlId(m),E=t.findControl(h);h===g&&ct(y)?g=r:!E||h===m||Fa(E)||gt(y)&&0===Number(C)&&1===Number(E.GroupIndex)||(g=h)}else if(ct(y)){var b=t.findControlByCondition((function(e){return e.ParentId===g&&!F()(s).call(s,e.Id)}));g=b.length?b[0].Id:r}else{var I=t.getPrevSibling(m).control;I&&(g=I.Id)}Pa(s,a,l,t,o,i,(function(){u([g])}))}},Zl=function(e,t){var n=(0,S.useContext)(le),r=n.getKdesignerApi,a=(n.invokeSaveAction,n.fieldStatusSettingMode),l=n.pubUIAction,o=n.billPropsData,i=n.dispatchBillData,c=n.getHideFieldRef,u=n.setHideFieldRef,d=(0,S.useMemo)((function(){return r()}),[]),s=d.data,f=d.selection,p=d.meta,m=s.getRootId(),g=f.getSelection,y=f.setSelect,C=f.getActiveSelectedId,E=(0,S.useContext)(k.GlobalConfigContext),b=E.showMessage,I=E.keywordMapping,T=Wl(),x=T.setCopyContent,A=T.getCopyContent,D=T.setCopyIds,M=T.getCopyIds,w=T.setDatasetCutControl,R=T.removeDatasetCutControl,_=T.clearCopyContent;(0,S.useEffect)((function(){var t=e.current;if(t&&!a){var n=function(e){var n=(e.target||{}).className;if("nocode-designer-designer-field-item-edit"!==(void 0===n?"":n)){var r=g(),a=C(),T=e.keyCode;switch(T){case k.keyCode.BACKSPACE:case k.keyCode.DELETE:e.preventDefault(),Xl(f,s,b,m,o,i,c(),u),r.length>0&&setTimeout((function(){return t.focus()}),50);break;case k.keyCode.ESC:e.preventDefault();var S=d.selection.getActiveSelectedId();if(S!==d.data.getRootId()){var O=d.data.findControl(S),j=d.data.findControlByCondition((function(e){return e.Id===O.ParentId}))[0];if(j._Root_)return;y(j.Id)}break;case k.keyCode.C:if(e.preventDefault(),e.ctrlKey){null==e||e.stopPropagation();var K=g().reduce((function(e,t){var n,r,a=s.findControl(t),l=p.getControlMeta((null==a?void 0:a.FieldType)||a[L]),o=l.Inside,i=l.CategoryId,c=l.Name;if(o)return e;if(F()(i).call(i,je))return b("".concat(c,"只能在画布中添加一次，不能复制")),e;if(gt(a[L])&&(null===(r=s.getAllSubControls(a.Id))||void 0===r?void 0:v()(r).call(r,(function(e){return $e(e[L])||ot(e[L])}))).length>0)return b("分组内包含关联表单或表格，不能复制"),e;return $e(a[L])||ot(a[L])?(b("无法复制关联表单与表格控件"),e):h()(n=[]).call(n,(0,P.c)(e),[a])}),[]);x(K),D(K.reduce((function(e,t){var n=s.getAllSubControlIds(null==t?void 0:t.Id)||[];return h()(e).call(e,n)}),[]))}break;case k.keyCode.V:if(e.preventDefault(),e.ctrlKey){var V=A();if(Array.isArray(V)){var G,z=R()>0;s.getData();if(z){var H=V.reduce((function(e,t){var n;return h()(n=[t[B]]).call(n,(0,P.c)(e))}),[]);if(F()(H).call(H,a))return;return s.getAllParentControlIds(a).some((function(e){return F()(H).call(H,e)}))?void b("当【源控件】是【目标控件】的父级时，无法剪切/粘贴"):void s.swapControl((0,k.createSwapAction)({origin:H,target:a})).then((function(e){f.setSelect([H[0]]),_()}))}var q=s.findControl(a),Y=q.FieldType,W=q[L],X=a,Z=p.getControlMeta(Y||W).IsContainer;Z&&!ot(W)||(X=s.getParentControlId(a));var Q=M(),J={Items:s.findControlByCondition((function(e){return null==Q?void 0:F()(Q).call(Q,e.Id)}))},$=V.reduce((function(e,t){var n=Dt(J,t,X);return h()(e).call(e,ln(n,m))}),[]),ee=s.findControlIndex(a);if(Z){var te=s.getSubControls(a),ne=te.length;ne>0&&(ee=s.findControlIndex(te[ne-1][B]))}var re=v()(G=N()($).call($,(function(e){return s.findControl(e.ParentId)?e.Id:null}))).call(G,Boolean);s.addControl((0,k.createPasteAction)($,{index:ee+1})).then((function(e){var t=v()(re).call(re,(function(e){return s.findControl(e)}));y(t)}))}}break;case k.keyCode.X:if(e.preventDefault(),e.ctrlKey){null==e||e.stopPropagation();var ae=g(),le=[],oe=[];ae.forEach((function(e){var t=s.findControl(e);ot(t[L])||$e(t[L])||(le.push(t),oe.push(e))})),D(oe),x(le),w()}break;case k.keyCode.ENTER:var ie,ce;e.preventDefault();var ue=C({dataContext:s,selectionContext:f}),de=s.findControl(ue);de=s.getContainerControl(de);var se=p.canAdd("NoCodeTextField",de[I.type]);if(!(!0===se||"object"===(0,he.c)(se)&&se.success))return;l({eventName:"enter",action:"fd_add_enter"});var fe=null===(ie=p.getControlMeta(null===(ce=de)||void 0===ce?void 0:ce[I.type]))||void 0===ie?void 0:ie.IsContainer,pe=(0,k.createControlData)(s.getMeta(),E)({type:"NoCodeTextField",parentId:fe?de[I.id]:m}),me=de[I.id]===ue?-1:s.findControlIndex(ue)+1;s.addControl((0,k.createAddAction)(pe,{index:me})).then((function(e){if(null!=e&&e.length){var t=e[0].value;f.setSelect(Array.isArray(t)?[t[0][I.id]]:[t[I.id]])}}));break;case k.keyCode.D:if(e.preventDefault(),T===k.keyCode.D&&!e.ctrlKey)return;var ve=s.getData(),ge=f.getSelection(),ye=function(e){var t=p.getControlMeta(e[L]),n=t.CategoryId,r=t.Name;return!F()(n).call(n,je)||(b("".concat(r,"只能在画布中添加一次，不能重复")),!1)};if(ge.length>1){var Ce=ge.reduce((function(e,t){var n=s.findControl(t);if(!ye(n))return e;var r=Dt(ve,n,n[U]);return h()(e).call(e,ln(r,m))}),[]);s.addControl((0,k.createPasteAction)(Ce)).then((function(){}))}else{var Ee=s.findControl(a);if(!ye(Ee))return;var be=ln(Dt(ve,Ee,Ee[U]),m),Ie=s.findControlIndex(Ee[B])+1;s.addControl((0,k.createPasteAction)(be,{index:Ie})).then((function(){f.setSelect([be[0][B]])}))}break;case k.keyCode.Z:case k.keyCode.Y:e.preventDefault();break;case k.keyCode.LEFT:case k.keyCode.RIGHT:case k.keyCode.UP:case k.keyCode.DOWN:e.preventDefault();var Ne=T===k.keyCode.LEFT||T===k.keyCode.UP?s.getPrevSibling(a):s.getNextSibling(a),Te=Ne&&Ne.control;Te&&y([Te[B]])}}};return t.addEventListener("keydown",n,!0),function(){t.removeEventListener("keydown",n,!0)}}}),[o])},Ql=function(e,t){var n=t.selection,r=e.Id,a=(0,S.useContext)(le).fieldStatusSettingMode,l=n.setSelect;(0,S.useEffect)((function(){a||l([r])}),[])},Jl=(0,k.isMac)(),$l=function(){var e=(0,S.useReducer)((function(e){return e+1}),0),t=(0,d.c)(e,2)[1],n=(0,S.useContext)(le),r=n.getKdesignerApi,a=n.getPrefixCls,l=n.prefixCls,o=n.billPropsData,i=n.dispatchBillData,c=n.getHideFieldRef,u=n.setHideFieldRef,f=(0,S.useMemo)((function(){return r()}),[]),p=f.data,m=f.selection,g=f.meta,y=(0,S.useContext)(k.GlobalConfigContext).showMessage,C=Wl(),E=C.setCopyContent,b=C.getCopyIds,I=C.setCopyIds,T=C.getCopyContent,x=C.setDatasetCutControl,A=C.removeDatasetCutControl,M=C.clearCopyContent,R=(0,S.useRef)(null),_=a&&a(l,"nav-tool"),O=m.getSelection,j=m.setSelect,K=m.getActiveSelectedId,V=m.addSelectChangeListener,G=p.getRootId(),z=p.canUndo(),q=p.canRedo(),Y=K(),W=p.findControl(Y)[L],X=g.getControlMeta(W).CategoryId,Z=O();(0,S.useEffect)((function(){var e=V(t);return function(){e()}}),[]);var Q=(0,S.useCallback)((function(e){return ct(W)?"back"===e?"forward":"back":e}),[W]),J=(0,S.useMemo)((function(){var e,t=Kt(W),n=null===(e=p.getAllSubControls(Y))||void 0===e?void 0:v()(e).call(e,(function(e){return ot(e._Type_)||$e(e._Type_)}));return!!(Y===G||F()(X).call(X,je)||ot(W)||$e(W)||t&&n.length)}),[G,Y,W]),$=(0,S.useMemo)((function(){return Y===G}),[G,Y]),ee=$||Z.length>1,te=((0,S.useCallback)((function(){q&&p.redo()}),[q]),(0,S.useCallback)((function(){z&&p.undo()}),[z]),function(e){var t=setTimeout((function(){!function(e){var t,n=document.querySelector(h()(t="[".concat(H,'="')).call(t,e,'"]'));n&&(n.scrollIntoViewIfNeeded?n.scrollIntoViewIfNeeded():n.scrollIntoView({block:"nearest"}))}(e),clearTimeout(t),t=null}))}),ne=(0,S.useCallback)((function(){var e=O();if(1===e.length){var t=p.findControl(e[0]),n=t.Key,r=t._Type_;if(Kt(r))return void tn(p,t,"forward");var a=p.getPrevSibling(e[0]).control;if(a&&Kt(a._Type_))return void tn(p,a,"back");var l=p.getParentControl(e[0]),o=l.Id,i=l._Type_,c=l.PropsDisplay;if(ot(i)){var u=c.split(","),d=n.toLowerCase().replace("_".concat(o.toLowerCase()),""),s=Kr()(u).call(u,(function(e){return e===d}));if(u.length>1&&0!==s){var f=ce()(u).call(u,s,1);ce()(u).call(u,s-1,0,f[0]),p.batchUpdateControlPropertyValues((0,k.createUpdateAction)([[o,{PropsDisplay:u.join()}]]))}}p.moveControl(e[0],Q("forward")),te(e[0])}}),[Q]),re=(0,S.useCallback)((function(){var e=O();if(1===e.length){var t=p.findControl(e[0]),n=t.Key,r=t._Type_;if(Kt(r))return void tn(p,t,"back");var a=p.getNextSibling(e[0]).control;if(a&&Kt(a._Type_))return void tn(p,a,"forward");var l=p.getParentControl(e[0]),o=l.Id,i=l._Type_,c=l.PropsDisplay;if(ot(i)){var u=c.split(","),d=n.toLowerCase().replace("_".concat(o.toLowerCase()),""),s=Kr()(u).call(u,(function(e){return e===d}));if(u.length>1&&s!==u.length-1){var f=ce()(u).call(u,s,1);ce()(u).call(u,s+1,0,f[0]),p.batchUpdateControlPropertyValues((0,k.createUpdateAction)([[o,{PropsDisplay:u.join()}]]))}}p.moveControl(e[0],Q("back")),te(e[0])}}),[Q]),ae=(0,S.useCallback)((function(e){null==e||e.stopPropagation();var t=O();if(1!==t.length||G!==t[0]){var n=N()(t).call(t,(function(e){return p.findControl(e)}));I(t),E(n),x()}}),[]),oe=(0,S.useCallback)((function(e){null==e||e.stopPropagation();var t=O();if(1===t.length&&G===t[0])return y("禁止复制根节点");var n=t.reduce((function(e,t){var n,r=p.findControl(t),a=g.getControlMeta((null==r?void 0:r.FieldType)||r[L]),l=a.Inside,o=a.CategoryId,i=a.Name;return l?e:F()(o).call(o,je)?(y("".concat(i,"只能在画布中添加一次，不能复制")),e):ot(r[L])||$e(r[L])?(y("关联表单与表格控件，不能复制"),e):h()(n=[]).call(n,(0,P.c)(e),[r])}),[]);E(n),I(n.reduce((function(e,t){var n=p.getAllSubControlIds(t.Id)||[];return h()(e).call(e,n)}),[]))}),[]),ie=(0,S.useCallback)((function(){var e=T();if(Array.isArray(e)){var t,n=A()>0;p.getData();if(n){var r=e.reduce((function(e,t){var n;return h()(n=[t[B]]).call(n,(0,P.c)(e))}),[]);if(F()(r).call(r,Y))return;return p.getAllParentControlIds(Y).some((function(e){return F()(r).call(r,e)}))?void y("当【源控件】是【目标控件】的父级时，无法剪切/粘贴"):void p.swapControl((0,k.createSwapAction)({origin:r,target:Y})).then((function(e){m.setSelect([r[0]]),M()}))}var a=p.findControl(Y),l=a.FieldType,o=a[L],i=Y,c=g.getControlMeta(l||o).IsContainer;c||(i=p.getParentControlId(Y));var u=b(),d={Items:p.findControlByCondition((function(e){return null==u?void 0:F()(u).call(u,e.Id)}))},s=e.reduce((function(e,t){var n=Dt(d,t,i);return h()(e).call(e,ln(n,G))}),[]),f=p.findControlIndex(Y);if(c){var C=p.getSubControls(Y),E=C.length;E>0&&(f=p.findControlIndex(C[E-1][B]))}var I=v()(t=N()(s).call(s,(function(e){return p.findControl(e.ParentId)?e.Id:null}))).call(t,Boolean);p.addControl((0,k.createPasteAction)(s,{index:f+1})).then((function(e){var t=v()(I).call(I,(function(e){return p.findControl(e)}));j(t)}))}}),[Y]),ue=(0,S.useCallback)((function(e){e.stopPropagation();var t=m.getSelection(),n=p.getData();if(1!==t.length||G!==t[0]){var r=function(e){var t=g.getControlMeta(e[L]),n=t.CategoryId,r=t.Name;return!F()(n).call(n,je)||(y("".concat(r,"只能在画布中添加一次，不能重复")),!1)};if(t.length>1){var a=t.reduce((function(e,t){var a=p.findControl(t);if(!r(a)||$e(a[L])||ot(a[L]))return e;var l=Dt(n,a,a[U]);return h()(e).call(e,ln(l,G))}),[]);p.addControl((0,k.createPasteAction)(a)).then((function(){}))}else{var l=p.findControl(Y);if(!r(l)||$e(l[L])||ot(l[L]))return;var o=ln(Dt(n,l,l[U]),G),i=p.findControlIndex(l[B])+1;p.addControl((0,k.createPasteAction)(o,{index:i})).then((function(){m.setSelect([o[0][B]])}))}}}),[Y]),de=jn()("".concat(_,"-operation-btn"));return D().createElement("div",{className:_,ref:R},D().createElement("div",{title:"前移",onClick:ne,className:jn()((0,s.c)({},"".concat(_,"-operation-disable"),ee),de)},D().createElement(w.Icon,{prefix:"designericon",type:"qianyi"})),D().createElement("div",{title:"后移",onClick:re,className:jn()((0,s.c)((0,s.c)({},"".concat(_,"-last-operation"),!0),"".concat(_,"-operation-disable"),ee),de)},D().createElement(w.Icon,{prefix:"designericon",type:"houyi"})),D().createElement("div",{title:"剪切\n".concat(Jl?"⌘+X":"Ctrl+X"),onClick:J?void 0:ae,className:jn()((0,s.c)({},"".concat(_,"-operation-disable"),J),de)},D().createElement(w.Icon,{prefix:"designericon",type:"jianqie"})),D().createElement("div",{title:"复制\n".concat(Jl?"⌘+C":"Ctrl+C"),onClick:J?void 0:oe,className:jn()((0,s.c)({},"".concat(_,"-operation-disable"),J),de)},D().createElement(w.Icon,{prefix:"designericon",type:"fuzhi"})),D().createElement("div",{title:"粘贴\n".concat(Jl?"⌘+V":"Ctrl+V"),onClick:ie,className:jn()((0,s.c)({},"".concat(_,"-last-operation"),!0),de)},D().createElement(w.Icon,{prefix:"designericon",type:"zhantie"})),D().createElement("div",{title:"重复",onClick:J?void 0:ue,className:jn()((0,s.c)({},"".concat(_,"-operation-disable"),J),de)},D().createElement(w.Icon,{prefix:"designericon",type:"zhongfu"})),D().createElement("div",{title:"删除\nDelete",onClick:$?void 0:function(){Xl(m,p,y,G,o,i,c(),u)},key:"Delete",className:jn()((0,s.c)({},"".concat(_,"-operation-disable"),$),de)},D().createElement(w.Icon,{prefix:"designericon",type:"shanchu"})))},eo=function(){var e=(0,S.useContext)(le),t=e.getPrefixCls,n=e.prefixCls,r=e.isPC,a=e.setIsPC,l=t&&t(n,"nav-deviceswitch"),o=function(e){a(e)};return D().createElement("div",{className:l},D().createElement("div",{className:"".concat(l,"-container")},D().createElement("div",{className:jn()("".concat(l,"-container-item"),{actived:r}),onClick:function(){return o(!0)},title:"PC端"},D().createElement("div",{className:"".concat(l,"-container-item-icon")},D().createElement(w.Icon,{prefix:"designericon",type:"PC"}))),D().createElement("div",{className:jn()("".concat(l,"-container-item"),{actived:!r}),onClick:function(){return o(!1)},title:"移动端"},D().createElement("div",{className:"".concat(l,"-container-item-icon")},D().createElement(w.Icon,{prefix:"designericon",type:"shouji2"})))))},to=[{name:"1列",id:"1",icon:"1lie"},{name:"2列",id:"2",icon:"2lie"},{name:"3列",id:"3",icon:"3lie"},{name:"4列",id:"4",icon:"4lie"}],no="ColumnSpan",ro=function(){var e=(0,S.useContext)(le),t=e.prefixCls,n=e.getKdesignerApi,r=e.isPC,a=n(),l=a.data,o=a.meta,i=l.getRootId(),c=l.findControl(i),u=c[no],d=c._Type_,f=o.getControlPropertyDefaultValue(d,no),p=String(u||f);return(0,k.useDataChangeForceUpdateEffect)(a),D().createElement("div",{className:jn()("".concat(t,"-column-switch"),{hide:!r})},D().createElement("div",{className:"".concat(t,"-column-switch-wrapper")},N()(to).call(to,(function(e){var n=e.id,r=e.icon;return D().createElement("div",{className:jn()("".concat(t,"-column-item"),{"is-active":p===n}),onClick:function(){var e;p!==(e=n)&&l.batchUpdateControlPropertyValues((0,k.createUpdateAction)([[i,(0,s.c)({},no,e)]]))},key:n,title:"".concat(n,"列")},D().createElement("div",{className:"".concat(t,"-column-item-icon")},D().createElement(w.Icon,{prefix:"designericon",type:r})))}))))},ao=function(){var e=(0,S.useContext)(le),t=e.getPrefixCls,n=e.prefixCls,r=t&&t(n),a="".concat(r,"-top-view-main"),l=D().createElement("div",{className:a},D().createElement($l,null),D().createElement(ro,null),D().createElement(eo,null));return D().createElement(k.ViewHeader,{content:l,portalId:a})},lo=function(e){var t=e.Id,n=(0,S.useContext)(le).getKdesignerApi,r=(0,S.useMemo)((function(){return n()}),[]),a=r.meta,l=r.data.findControl(t)||{},o=l._Type_,i=l.Key,c=l.Multi,u=void 0===c?"0":c,s=l.SelectItemType,f=(a.getControlMeta(o)||{}).Name,p=(0,S.useRef)(null),m=(0,S.useState)(vt(f,l)),v=(0,d.c)(m,2),g=v[0],y=v[1];return(0,k.useDataChangeForceUpdateEffect)(r),(0,S.useEffect)((function(){var e=vt(f,{SelectItemType:s,Multi:u,_Type_:o});y(e)}),[t,o,s,u]),(0,S.useEffect)((function(){if($e(o))return k.eventBus.on("".concat(i,"_refbill"),(function(e){p.current=e.formName,y(vt(p.current,l))})),function(){k.eventBus.off("".concat(i,"_refbill"))}}),[i]),g};function oo(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function io(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oo(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):oo(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var co=(0,S.memo)((function(e){var t=e.field,n=e.className,r=t.Id,a=t._Type_,l=t.BillEntityId,o=t.Id,i=t.Name,c=(0,S.useContext)(le),u=c.prefixCls,f=c.getKdesignerApi,p=c.invokeAction,m=c.fieldStatusSettingMode,g=c.getHideFieldRef,y=c.setHideFieldRef,C=(0,S.useMemo)((function(){return f()}),[]),E=C.data,b=C.selection,I=C.meta,T=C.error,A=C.controlCacheApi,M=I.getMeta(),R=(E.getParentControl(r)||{})._Type_,O=(0,S.useRef)(),j=(0,S.useRef)([]),K=(0,S.useState)([]),V=(0,d.c)(K,2),G=V[0],z=V[1],H=(0,S.useState)(!1),q=(0,d.c)(H,2),Y=q[0],W=q[1],X=(0,S.useState)(!1),Z=(0,d.c)(X,2),Q=Z[0],J=Z[1],$=A.hasCache("controlId",r);(0,k.useOnClickOutside)([O],(function(e){W(!1)})),(0,S.useEffect)((function(){if(W(!1),J(!1),r&&!F()(qe).call(qe,a)&&!m&&!ot(R)){if($){var e;if(M.Controls){var n,l,o=E.findControl(t[U]),i=I.getControlMeta(a),c=h()(n=[]).call(n,(0,P.c)(qe),[a,"HiddenControl"]);j.current=v()(l=M.Controls||[]).call(l,(function(e){if(F()(c).call(c,e[B])||!1===e.Visible||(null==i?void 0:i.BaseType)!==(null==e?void 0:e.BaseType))return!1;var t=I.canAdd(e.Id,o[L]);return!0===t||"object"===(0,he.c)(t)&&t.success}))}return z(j.current),void((null===(e=j.current)||void 0===e?void 0:e.length)>0&&J(!0))}var u=t.Key;p("canSwitchFieldTypes",[[u,t.FieldType]],[]);var d=function(e){var t=e[u]||[];0!==t.length?(z(t),(null==t?void 0:t.length)>0&&J(!0)):W(!1)};return k.eventBus.on(mr,d),function(){k.eventBus.off(mr,d)}}}),[o,a,$]);var ee=lo(t),te=(0,S.useMemo)((function(){if(a)return dn(a)}),[a,dn]),ne="".concat(u,"_contextmenu_panel");return D().createElement("div",{className:jn()(n,"switchfield")},D().createElement("div",{className:"switchfield_content"},te&&D().createElement(w.Icon,{prefix:"designericon",type:te,className:"switchfield_content_icon"}),D().createElement("span",{className:"switchfield_content_name"},a?ee||"":"批量编辑")),Q&&D().createElement(k.DropDownPanel,{scrollHidden:!0,popperClassName:"".concat(u,"_contextmenu"),visible:Y,onVisibleChange:function(e){return W(e)},placement:"bottomLeft",content:Y&&D().createElement("div",{ref:O,className:ne},N()(G).call(G,(function(e){var n,r="",c="";"object"===(0,he.c)(e)?(r=e.Id,c=e.Name):(r=e,c=null===(n=I.getControlMeta(r))||void 0===n?void 0:n.Name);return D().createElement("div",{key:r,title:c,className:"".concat(ne,"_item"),onClick:function(){return function(e){if(e){var n,r="";if($e(a)){if(r=I.getControlMeta(h()(n="".concat(a,"_")).call(n,l)).Name,null!=t&&t.RefTableId){var c=io({},g()),u=x()(c).reduce((function(e,n){return n.ParentId!==(null==t?void 0:t.RefTableId)&&n.Id!==(null==t?void 0:t.RefTableId)?io(io({},e),{},(0,s.c)({},n.Id,n)):e}),{});y(u)}}else r=I.getControlMeta(a).Name;var d=(r||i)===i,f=I.getControlMeta(e).Name,p=d?{Name:f}:{};E.batchUpdateControlPropertyValues((0,k.createUpdateAction)([[o,io((0,s.c)({},_,e),p)]])).then((function(){b.setSelect([o]),T.getError(o)&&T.deleteError([o]),W(!1)})).catch((function(e){}))}}(r)}},D().createElement(w.Icon,{prefix:"designericon",type:dn(r),className:"nocode-designer-control-icon"}),D().createElement("p",{className:"".concat(ne,"_item_text")},c))})))},D().createElement("div",{className:"switchfield_action"},D().createElement(w.Icon,{prefix:"designericon",type:"qiehuan",className:"operation-bar-name-icon"}),D().createElement("span",{className:"switchfield_action_text"},"转换"))))}));co.displayName="SwitchField";var uo=co,so=function(e,t){var n=t.Hide;return!(!n||"object"!==(0,he.c)(n))&&n.Hide},fo=(0,S.memo)((function(){var e=(0,S.useContext)(le).prefixCls,t=(0,S.useState)(!1),n=(0,d.c)(t,2),r=n[0],a=n[1],l=(0,S.useRef)({}),o=(0,S.useRef)({}),i=(0,S.useRef)(null);return(0,k.useOnClickOutside)([i],(function(e){a(!1)})),(0,S.useEffect)((function(){var e=function(e){var t,n=e.event,r=e.field,i=n.pageX,c=n.pageY;l.current.style.cssText+=h()(t=";left: ".concat(i,"px;top: ")).call(t,c,"px;"),o.current=r,a(!0)};return k.eventBus.on("contextmenu",e),function(){k.eventBus.off("contextmenu",e)}}),[]),(0,S.useEffect)((function(){var e=function(e){var t=document.getElementById("app");(!t||null!=t&&t.contains(e.target))&&r&&a(!1)};return window.addEventListener("scroll",e,!0),function(){window.removeEventListener("scroll",e,!0)}}),[r]),(0,re.createPortal)(D().createElement("div",{ref:l,className:"".concat(e,"_contextmenu")},D().createElement(k.DropDownPanel,{popperClassName:"".concat(e,"-quick-setting-dropdown"),visible:r,onVisibleChange:function(e){return a(e)},placement:"bottomLeft",content:D().createElement(go,{ref:i,controlId:o.current.Id,field:o.current,prefixCls:e})})),document.body)})),po=fo;function mo(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function vo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mo(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):mo(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var go=(0,S.memo)((0,S.forwardRef)((function(e,t){var n,r=e.prefixCls,a=e.controlId,l=(0,S.useContext)(le).getKdesignerApi,o=(0,S.useMemo)((function(){return l()}),[]),i=o.meta,c=o.data,u=c.findControl(a),d=(u||{})._Type_,s=c.getData(),f=i.getDefaultData(d),p=i.getControlMeta(d),m=(0,S.useMemo)((function(){return vo(vo({},f),u)}),[f,u]),v=(0,k.getModelData)(p.Properties,vo(vo({},s),{},{field:m}))||[],g=yn()(n=function(e,t,n){var r,a=[],l=Tt(e);try{for(l.s();!(r=l.n()).done;){var o=r.value,i=o.Nodes,c=void 0===i?[]:i,u=o.Key;if(0===t.length||F()(t).call(t,u)){var d,s=Tt(c);try{for(s.s();!(d=s.n()).done;){var f=d.value;!1!==f.Visible&&n(f)&&a.push(f)}}catch(e){s.e(e)}finally{s.f()}}}}catch(e){l.e(e)}finally{l.f()}return a}(v,[],(function(e){var t;return!so(0,e)&&(null==e||null===(t=e.Editor)||void 0===t?void 0:t.EnableQuickSetting)}))).call(n,(function(e,t){return e.GroupSubSeq-t.GroupSubSeq}));return(0,k.useDataChangeForceUpdateEffect)(o),null!=u&&u.Id?D().createElement("div",{className:"setting-panel",ref:t},D().createElement(uo,{field:m}),(null==g?void 0:g.length)>0&&D().createElement("div",{className:"basic-setting ".concat(r,"-property-view")},N()(g).call(g,(function(e){return D().createElement(k.PropertyViewItem,(0,R.c)({},e,{key:e.Id,field:m,className:"kdesigner-right-view",enableMutiSelect:!1}))})))):null}))),yo=(0,S.memo)((function(e){var t=e.field,n=e.mainViewDom,r=e.prefixCls,a=(0,S.useState)(!1),l=(0,d.c)(a,2),o=l[0],i=l[1],c=(0,S.useContext)(le).getKdesignerApi,u=((0,S.useMemo)((function(){return c()}),[]),(0,S.useRef)(null)),s=(0,S.useRef)(null);return(0,k.useOnClickOutside)([u,s],(function(e){var t=document.getElementById("app");(!t||null!=t&&t.contains(e.target))&&o&&(i(!1),n.focus())})),(0,S.useEffect)((function(){var e=function(e){var t=document.getElementById("app");(!t||null!=t&&t.contains(e.target))&&o&&i(!1)};return window.addEventListener("scroll",e,!0),function(){window.removeEventListener("scroll",e,!0)}}),[o]),D().createElement(k.DropDownPanel,{gap:2,ref:s,visible:o,placement:"bottomLeft",popperClassName:"".concat(r,"-quick-setting-dropdown"),aaa:"快捷面板",content:o?!!t.Id&&D().createElement(go,{ref:u,controlId:t.Id,field:t,prefixCls:r}):D().createElement("div",null)},D().createElement("span",{className:"operation-bar-item",onClick:function(e){e.stopPropagation(),i((function(e){return!e})),n.focus()},title:"设置"},D().createElement(w.Icon,{prefix:"designericon",type:"shezhi"})))}),(function(e,t){return(0,Se.isEqual)(e.field,t.field)&&e.mainViewDom===t.mainViewDom})),Co="ui-designer-root",ho="1050",Eo="-1";function bo(e,t){if(t){var n=0,r=new window.IntersectionObserver((function(e){e.forEach((function(e){if(e.intersectionRatio!==n){if(e.intersectionRatio<1&&e.intersectionRatio>0){var r=e.boundingClientRect,a=e.intersectionRect;n>e.intersectionRatio&&r.top<a.top||r.bottom==a.bottom&&r.top<a.top?(t.setAttribute("data-visible","true"),t.style.zIndex=Eo):(t.setAttribute("data-visible","true"),t.style.zIndex=ho)}else e.intersectionRatio>0?(t.setAttribute("data-visible","true"),t.style.zIndex=ho):(t.setAttribute("data-visible","false"),t.style.zIndex=Eo);n=e.intersectionRatio}}))}),{threshold:[1e-6,.999999]});return r.observe(e),r}}var Io=(0,S.memo)((function(e){var t=e.prefixCls,n=e.field,r=e.kdesignerApi,a=e.mainViewDom,l=e.rootDom,o=e.billPropsData,i=e.dispatchBillData,c=e.getHideField,u=e.setHideField,s=n.Id,f=n._Type_,p=n.SourceForm,m=n.ColumnSpan,g=void 0===m?1:m,y=n.Status,C=n.Margin,h=(0,S.useContext)(k.GlobalConfigContext).showMessage,E=r.data,b=r.selection,I=r.meta,N=(0,S.useRef)(null),T=E.getData(),x=E.getRootId(),A=E.findControl(x).ColumnSpan,M=void 0===A?2:A,P=I.getControlMeta(f),R=P.Inside,_=P.CategoryId,O=P.Name,j=F()(_).call(_,je),L=document.querySelector('[data-control-id="'.concat(s,'"]')),K=(0,S.useReducer)((function(e){return e+1}),0),V=(0,d.c)(K,2)[1];(0,S.useEffect)((function(){var e=N.current;if(e){var t=bo(L,e);return function(){t.disconnect()}}}),[N.current,L]);var G=(0,S.useCallback)((function(e){var t=N.current;if(t&&l&&e){var n=l.getBoundingClientRect(),r=t.getBoundingClientRect().width,a=e.left,o=e.top,i=(e.width,n.left),c=n.top,u=n.width,d=n.height,s=a<i?i:a;a+r>i+u&&(s=i+u-r);var f=o-24-2;t.style.left="".concat(s,"px"),t.style.top="".concat(f,"px");var p=f>=c-24-2&&f<=c+d;"true"===t.dataset.visible&&(p&&t.style.zIndex===Eo?t.style.zIndex=ho:p||t.style.zIndex!==ho||(t.style.zIndex=Eo))}}),[N.current,l,L]);(0,k.useTraceElementPosition)({selectedCtrlNode:L,callback:G,depth:[g,y,M,C]});var z=lo(n),H=(0,S.useMemo)((function(){return dn(f)}),[f,dn]);(0,S.useEffect)((function(){var e=E.addDataChangeListener((function(){e&&V()}));return function(){e&&e(),e=null}}),[V]);var q=(0,S.useMemo)((function(){var e=E.getParentControl(s);return!!ot(null==e?void 0:e._Type_)&&"2"===e.SourceForm}),[s,o,p]),Y=(0,S.useMemo)((function(){return ot(f)||$e(f)}),[f]);return L&&L.getAttribute("id")!==Co&&a&&!R?D().createElement("div",{ref:N,className:"".concat(t,"-operation-bar-wrap")},D().createElement("div",{className:"operation-bar-name mr-2"},D().createElement(w.Icon,{prefix:"designericon",type:H,className:"operation-bar-name-icon"}),D().createElement("span",null,z||"")),D().createElement("div",{className:"operation-bar-left"},!q&&!Y&&D().createElement("span",{className:jn()(["operation-bar-item"]),onClick:function(e){if(a.focus(),j)return h("".concat(O,"只能在画布中添加一次，不能重复"));e.stopPropagation();var t=b.getSelection(),r=E.findControl(t[0]),l=ln(Dt(T,n,n[U]),x);if(v()(l).call(l,(function(e){return $e(e._Type_)||ot(e._Type_)})).length&&gt(r._Type_))h("分组内包含关联表单或表格，不能重复");else{var o=E.findControlIndex(s)+1;E.addControl((0,k.createPasteAction)(l,{index:o})).then((function(){b.setSelect([l[0][B]])}))}},title:"重复"},D().createElement(w.Icon,{prefix:"designericon",type:"zhongfu"})),D().createElement("span",{className:jn()(["operation-bar-item"]),onClick:function(e){a.focus(),e.stopPropagation();var t=E.getNextSelectedControlId(s),r=c();Pa([s],o,i,E,r,u,(function(){var e=t,r=E.findControl(t);ct(f)&&!r?e=x:r&&!Fa(r)||(e=n[U]),b.setSelect([e])}))},title:"删除"},D().createElement(w.Icon,{prefix:"designericon",type:"shanchu"}))),!q&&D().createElement(yo,{mainViewDom:a,field:n,prefixCls:t})):null})),No=function(e){var t=(0,S.useContext)(le),n=t.getKdesignerApi,r=t.prefixCls,a=t.isPC,l=t.billPropsData,o=t.dispatchBillData,i=t.getHideFieldRef,c=t.setHideFieldRef,u=(0,S.useMemo)((function(){return n()}),[]),s=u.data,f=u.selection,p=u.meta,m=f.getSelection(),v=s.getRootId(),g=(s.findControl(v).ColumnSpan,document.getElementById(Oe)),y=document.getElementById(Co),C=(0,S.useReducer)((function(e){return e+1}),0),E=(0,d.c)(C,2),b=E[0],I=E[1];(0,S.useRef)("");return(0,k.useSelectionChangeForceUpdateEffect)(u),(0,S.useLayoutEffect)((function(){I()}),[a]),D().createElement(D().Fragment,null,N()(m).call(m,(function(e){var t,n,a,d=s.findControl(e)||{},f=d.ColumnSpan,m=void 0===f?1:f,v=d._Type_,C=vo(vo({},p.getDefaultData(v)),d),E=ct(v)?document.getElementById("biz-button-panel"):y,I=s.findControlIndex(e),N=h()(t=h()(n=h()(a="operation-bar-item-".concat(e,"-")).call(a,I,"-")).call(n,m,"-")).call(t,b);return D().createElement(Io,{key:N,prefixCls:r,billPropsData:l,dispatchBillData:o,getHideField:i,setHideField:c,field:C,mainViewDom:g,rootDom:E,kdesignerApi:u})})),D().createElement(po,null))},To={1:"default",2:"disabled",3:"readonly",4:"hidden"},xo=function(e,t){return lt(t)||ct(e)},Ao=(0,S.memo)((function(e){var t=e.prefixCls,n=e.field,r=e.rootDom,a=e.kdesignerApi,l=e.containerDom,o=e.floatMenu,i=e.fieldStatusMap,c=e.fieldStatusSettingOptions,u=void 0===c?{}:c,f=e.dispatchFieldStatus,p=n.Id,m=n._Type_,v=n.Key,g=n.Status,y=n.FieldRequired,C=n.ParentId,h=a.data,E=(a.selection,a.meta),b=(0,S.useRef)(null),I=r.getBoundingClientRect(),T=E.getControlMeta(m),x=T.Inside,A=(T.CategoryId,T.Name,T.IsContainer),F=h.findControl(C)._Type_,M=u.defaultStatus,P=void 0===M?"default":M,B=u.hideMenu,_=void 0===B?xo:B,O=u.onFieldStatusChange,j=E.getControlMetaEditor(m,"Status"),L=(0,S.useState)(!1),K=(0,d.c)(L,2),V=K[0],U=K[1],G=(0,S.useMemo)((function(){if(null!=i&&i[v])return i[v];if(!o||null==o||!o.length){var e=To[g]||P;return e===P&&"2"===y?"mustInput":e}return P}),[v,i,o,g,y,u]),z=(0,S.useMemo)((function(){if(!(0,Se.isUndefined)(o))return o;var e=(j||{}).Enum,t=[];return null==e||e.forEach((function(e){t.push({key:To[e.Id],label:e.Name})})),A&&!ot(m)||!t.length||t.push({key:"mustInput",label:"必填"}),t}),[j,A,o,m]);(0,S.useEffect)((function(){var e=b.current;if(e){var t=bo(l,e);return function(){t.disconnect()}}}),[b.current,l]);var H=(0,S.useCallback)((function(e){var t=b.current;if(t&&r){t.getBoundingClientRect().width;var n=e.left,a=e.top,l=(e.width,I.left),o=I.top,i=(I.width,I.height),c=n<l?l:n,u=a-24-2;t.style.left="".concat(c,"px"),t.style.top="".concat(u,"px");var d=u>=o-24-2&&u<=o+i;"true"===t.dataset.visible&&(d&&t.style.zIndex===Eo?t.style.zIndex=ho:d||t.style.zIndex!==ho||(t.style.zIndex=Eo))}}),[b.current,r,I]);(0,k.useTraceElementPosition)({selectedCtrlNode:l,callback:H});var q=(0,S.useMemo)((function(){var e,t;return(null===(e=xe()(z).call(z,(function(e){return e.key===G})))||void 0===e?void 0:e.label)||(null===(t=z[0])||void 0===t?void 0:t.label)}),[z,G]),Y=function(e){if(U(!1),"function"!=typeof O)if(ot(m)){var t=(h.findControlByCondition((function(e){return e.ParentId===p}))||[]).reduce((function(t,n){return(0,R.c)(t,(0,s.c)({},n.Key,e))}),(0,s.c)({},v,e));f(t)}else f((0,s.c)({},v,e));else null==O||O(e,n,a,f,i)},W=(0,S.useMemo)((function(){return D().createElement(w.Dropdown.Menu,{onClick:Y},N()(z).call(z,(function(e){return D().createElement(w.Dropdown.Item,{key:e.key},D().createElement("span",{className:"".concat(t,"-permission-setting-panel-item")},e.label||e.key))})))}),[z]);return!l||l.getAttribute("id")===Co||!r||null!=_&&_(m,F)||x?null:D().createElement("div",{ref:b,className:"".concat(t,"-permission-setting-wrap")},D().createElement(w.Dropdown,{selectable:!0,popperClassName:"".concat(t,"-permission-setting-panel"),trigger:"click",visible:V,onVisibleChange:U,selectedKey:G,menu:W},D().createElement("div",{className:"permission-setting-label"},D().createElement("span",{className:"permission-setting-label-text"},q),D().createElement(w.Icon,{className:"permission-setting-label-icon",prefix:"designericon",type:V?"xialajiantoufanxiang":"xialajiantou"}))))}));Ao.displayName="PermissionSettingItem";var Fo=function(e){var t=(0,S.useContext)(le),n=t.getKdesignerApi,r=t.prefixCls,a=t.floatMenu,l=t.fieldStatusMap,o=t.dispatchFieldStatus,i=t.fieldStatusSettingOptions,c=(0,S.useMemo)((function(){return n()}),[]),u=c.data,s=c.selection.getSelection(),f=u.getRootId(),p=document.querySelector('[data-control-id="'.concat(f,'"]')),m=(0,S.useReducer)((function(e){return e+1}),0);(0,d.c)(m,2)[1];return(0,k.useSelectionChangeForceUpdateEffect)(c),(0,k.useDataChangeForceUpdateEffect)(c),D().createElement(D().Fragment,null,N()(s).call(s,(function(e){var t,n,d=u.findControl(e),s=d.ColumnSpan,f=void 0===s?1:s,m=(d._Type_,u.findControlIndex(e)),v=document.querySelector('[data-control-id="'.concat(e,'"]'));return D().createElement(Ao,{key:h()(t=h()(n="permission-setting-item-".concat(e,"-")).call(n,m,"-")).call(t,f),prefixCls:r,field:d,rootDom:p,containerDom:v,kdesignerApi:c,floatMenu:a,fieldStatusMap:l,fieldStatusSettingOptions:i,dispatchFieldStatus:o})})))},So=function(e){var t=(0,(0,S.useContext)(le).getKdesignerApi)(),n=e.name,r=e.id,a=e.onSelect,l=e.getClassName,o=e.isActive,i=t.data.findControl(r)._Root_;return D().createElement("div",{className:jn()(l("item"),(0,s.c)((0,s.c)({},l("active-item"),o),l("item-disabled"),i)),onClick:function(){a({name:n,id:r,disabled:i})}},D().createElement("div",{className:l("item-text")},D().createElement("span",null,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return e?pe()(e).length>t?Fe()(e).call(e,0,t)+"...":e:""}(n))),D().createElement("div",{className:l("item-text-dumb-node")}))},Do=function(e){var t=e.items,n=e.onSelect,r=e.prefixCls,a=void 0===r?"":r,l=(0,S.useState)(!1),o=(0,d.c)(l,2),i=o[0],c=o[1],u=(0,S.useState)(!1),s=(0,d.c)(u,2),f=s[0],p=s[1],m=(0,S.useRef)(null),v=(0,S.useRef)(null),g=(0,S.useCallback)((function(e){var t;return h()(t="".concat(a,"-")).call(t,e)}),[]),y=(0,S.useCallback)((function(e,t){var n=e.offsetWidth,r=t.offsetWidth;if(r>n){var a=e.scrollLeft;a>0?a+n>=r?(p(!1),c(!0)):(p(!0),c(!0)):(c(!1),p(!0))}else c(!1),p(!1)}),[]);(0,S.useEffect)((function(){var e=new ht.c((function(e){var t=(0,d.c)(e,1)[0],n=t.target.parentElement;k.console.log("resize-----"),y(n,t.target)}));return e.observe(v.current),function(){e.disconnect()}}),[]);var C=function(e){k.console.log("Scroll resize-----");var t=m.current,n=v.current;y(t,n)},E=function(e){var t=m.current.offsetWidth;m.current.scrollLeft=Math.max(0,m.current.scrollLeft+("left"===e?-t:t))},b=function(e,t){t.stopPropagation();k.console.log(t,t.deltaY,t.deltaMode);var n=.4*t.deltaY;m.current.scrollLeft=Math.max(0,m.current.scrollLeft+("left"===e?-n:n))};return(0,S.useEffect)((function(){var e=m.current,t=v.current,n=e.offsetWidth,r=t.offsetWidth;r>n&&(e.scrollLeft=r-n)}),[t]),D().createElement("div",{className:g("container-box"),onScroll:C},i&&D().createElement("div",{className:g("left-arrow"),onClick:function(){return E("left")},onWheel:function(e){return b("left",e)}},D().createElement(w.Icon,{type:"zuoqie",prefix:"designericon"})),D().createElement("div",{className:g("container"),ref:m,onScroll:C},D().createElement("div",{className:g("list"),ref:v},N()(t).call(t,(function(e,r){return D().createElement(So,(0,R.c)({},e,{onSelect:n,getClassName:g,key:e.id,isActive:r===t.length-1}))})))),f&&D().createElement("div",{className:g("right-arrow"),onClick:function(){return E("right")},onWheel:function(e){return b("right",e)}},D().createElement(w.Icon,{type:"youqie",prefix:"designericon"})))},ko=function(){var e=(0,S.useContext)(le),t=e.prefixCls,n=e.getKdesignerApi,r=e.getPrefixCls,a=n(),l=(0,S.useCallback)((function(){var e,t=a.selection.getActiveSelectedId(),n=a.data.getAllParentControls(t,!0);return N()(e=n.reverse()).call(e,(function(e){return{id:e.Id,name:e.Name}}))}),[]),o=(0,S.useState)(l),i=(0,d.c)(o,2),c=i[0],u=i[1];(0,S.useEffect)((function(){var e=function(){var e=l();u(e)},t=a.selection.addSelectChangeListener(e),n=a.data.addDataChangeListener(e);return function(){t(),n()}}),[]);var s=(0,S.useCallback)((function(e){var t=e.id;e.disabled||a.selection.setSelect([t])}),[]);return D().createElement(Do,{items:c,onSelect:s,prefixCls:r(t,"breadcrumb")})},Mo=(0,S.memo)((0,S.forwardRef)((function(e,t){var n=e.className,r=(0,S.useContext)(le).prefixCls,a=t||(0,S.useRef)(null);return D().createElement("div",{ref:a,className:jn()("".concat(r,"_erroricon"),n)},D().createElement("div",{className:"".concat(r,"_erroricon_content")},D().createElement(w.Icon,{className:"".concat(r,"_erroricon_gantanhao"),prefix:"designericon",type:"gantanhao"})))})));Mo.displayName="ErrorIcon";var wo=Mo,Po=function(e){var t=e.prefixCls,n=e.id,r=(e.rootDom,e.nodeErrorData),a=document.querySelector('[data-control-id="'.concat(n,'"]')),l=(0,S.useRef)(),o=(0,S.useMemo)((function(){var e;return(null===(e=p()(r||{}))||void 0===e?void 0:e.length)||0}),[r]),i=(0,S.useMemo)((function(){return 0===o?"":"存在有".concat(o,"条错误，请修复后再发布！")}),[r,o]);return a?o>0?(null==a||a.setAttribute("data-control-error",n),(0,re.createPortal)(D().createElement(w.Tooltip,{tip:i},D().createElement(wo,{ref:l,className:"".concat(t,"-error-tips")})),a)):(null==a||a.removeAttribute("data-control-error"),null):null};Po.displayName="ErrorTips";var Ro=Po,Bo=new(we()),_o=function(e,t){if(null!=Bo&&Bo.has(e)){var n=Bo.get(e);n.set(t,!0),Bo.set(e,n)}else{var r=new(we());r.set(t,!0),Bo.set(e,r)}},Oo=function(e,t){return!(null==Bo||!Bo.has(e))&&Bo.get(e).has(t)},jo=function(e){if(e){var t=Bo.get(e);t&&(t.clear(),Bo.set(e,t))}},Lo=function(e,t){Bo.set(e,t)},Ko=function(e){return e?Bo.get(e):Bo},Vo=function(e){return Bo.has(e)},Uo=function(e){return!!Vo(e)&&Bo.delete(e)},Go=function(e){var t=e.data,n=(e.selection,e.error),r=n.getError();(0,k.useErrorChangeForceUpdateEffect)(e);var a=(0,S.useCallback)((function(e){var t;if(n){var a=e;p()(a||{}).length||jo("controlId");var l={};p()(a).forEach((function(e){var t;a[e]&&(l[e]={},null===(t=a[e])||void 0===t||t.forEach((function(t){var n,r=t.propertyName,a=t.error;l[e][r]?l[e][r]=h()(n=[]).call(n,(0,P.c)(l[e][r]),[{msg:a}]):l[e][r]={msg:[a]}})))})),(null===(t=p()(r))||void 0===t?void 0:t.length)>0&&p()(r).forEach((function(e){if(!l[e]){var t=document.querySelector('[data-control-error="'.concat(e,'"]'));t&&t.removeAttribute("data-control-error")}})),n.replaceError(l)}}),[n,r]);(0,S.useEffect)((function(){return k.eventBus.on(vr,a),function(){k.eventBus.off(vr,a)}}),[a,r]);var l=(0,S.useCallback)((function(e){e.type,e.value;var t=e.actions;if((null==t?void 0:t.length)>0){for(var a=[],l=0;l<t.length;l++){var o=t[l]||{},i=o.type,c=o.value;"DELETE"===i&&r[c]&&a.push(c)}a.length>0&&n.deleteError(a)}}),[r]);(0,S.useEffect)((function(){var e=t.addDataChangeListener(l);return function(){e()}}),[r])},zo=function(e){if(e){var t=document.querySelector('[data-control-id="'.concat(e,'"]'));t&&(null!=t&&t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():null==t||t.scrollIntoView({block:"center"}))}},Ho=function(e){var t=e.isPC,n=e.errorControlIdList,r=e.error,a=e.root,l=e.prefixCls,o=(0,S.useState)([]),i=(0,d.c)(o,2),c=i[0],u=i[1],s=(0,S.useState)([]),f=(0,d.c)(s,2),m=f[0],g=f[1],y=(0,S.useMemo)((function(){return{root:a,rootMargin:"0px 0px 0px 0px",threshold:[0,.25,.5,.75,1],trackVisibility:!0,delay:200}}),[a]),C=(0,S.useCallback)((function(e,t){var n,r=window.IntersectionObserver;if(r&&e)return n=new r((function(e){t(e)}),y),n.observe(e),n}),[y]),E=function(e,t){return F()(e).call(e,t)?v()(e).call(e,(function(e){return e!==t})):e},b=(0,S.useCallback)((function(e,t,n){t.forEach((function(t){var n=t.rootBounds,r=n.top,a=n.height;if(t.isIntersecting)g((function(t){return E(t,e)})),u((function(t){return E(t,e)}));else{var l=t.boundingClientRect.y>a,o=t.boundingClientRect.y<r;l?g((function(){var t;return F()(m).call(m,e)?m:h()(t=[]).call(t,(0,P.c)(m),[e])})):o&&u((function(){var t;return F()(c).call(c,e)?c:h()(t=[]).call(t,(0,P.c)(c),[e])}))}}))}),[m,c]);(0,S.useEffect)((function(){if((null==n?void 0:n.length)>0){for(var e={},t=function(){var t,l=n[a];if(r[l]&&null!==(t=p()(r[l]))&&void 0!==t&&t.length){var o=document.querySelector('[data-control-id="'.concat(l,'"]'));e[l]=C(o,(function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];b.apply(void 0,h()(e=[l]).call(e,n))}))}else{var i;null===(i=e[l])||void 0===i||i.disconnect(),g((function(e){return E(e,l)})),u((function(e){return E(e,l)}))}},a=0;a<(null==n?void 0:n.length);a++)t();return function(){p()(e).forEach((function(t){var n;null===(n=e[t])||void 0===n||n.disconnect()}))}}}),[t,n,m,c]),(0,S.useEffect)((function(){null!=n&&n.length||(g([]),u([]))}),[n]);return D().createElement(D().Fragment,null,c.length>0&&D().createElement("div",{className:jn()("".concat(l,"_errorguide"),"".concat(l,"_errorguide_top")),title:"定位到错误的字段",onClick:function(){if(c.length>0){var e=c[0];zo(e)}}},D().createElement(w.Icon,{className:"".concat(l,"_errorguide_shuidi"),prefix:"designericon",type:"shuidizhixiang"}),D().createElement(wo,{className:"".concat(l,"_errorguide_icon")})),m.length>0&&D().createElement("div",{className:jn()("".concat(l,"_errorguide"),"".concat(l,"_errorguide_bottom")),title:"定位到错误的字段",onClick:function(){if(m.length>0){var e=m[0];zo(e)}}},D().createElement(w.Icon,{className:"".concat(l,"_errorguide_shuidi"),prefix:"designericon",type:"shuidizhixiang"}),D().createElement(wo,{className:"".concat(l,"_errorguide_icon")})))},qo=function(e){var t=(0,S.useContext)(le),n=t.getKdesignerApi,r=t.prefixCls,a=t.isPC,l=(0,S.useMemo)((function(){return n()}),[]),o=l.data,i=(l.selection,l.error),c=o.getRootId(),u=i.getError(),s=(0,S.useMemo)((function(){return p()(u)}),[u]),f=o.getData(),m=document.getElementById(Oe),v=document.querySelector('[data-control-id="'.concat(c,'"]')),g=(0,S.useReducer)((function(e){return e+1}),0),y=(0,d.c)(g,2)[1];return(0,k.useErrorChangeForceUpdateEffect)(l),Go(l),(0,S.useLayoutEffect)((function(){y()}),[a,f.Items.length]),D().createElement(D().Fragment,null,N()(s).call(s,(function(e){return D().createElement(Ro,{key:e,prefixCls:r,id:e,nodeErrorData:u[e],rootDom:v})})),v&&(0,re.createPortal)(D().createElement(Ho,{isPC:a,prefixCls:r,errorControlIdList:s,error:u,root:m}),v))},Yo=(0,S.memo)((function(e){e.field;var t,n=(0,S.useContext)(le),r=n.prefixCls,a=n.getKdesignerApi,l=(0,S.useMemo)((function(){return"".concat(r,"-bizbuttonpanel")}),[r]),o=(0,S.useReducer)((function(e){return e+1}),0),i=(0,d.c)(o,2)[1],c=a(),u=c.data,s=c.selection;(0,S.useEffect)((function(){var e=u.addDataChangeListener(g);return function(){e()}}),[]);var f=u.findControl,p=u.getData(),m=xe()(t=p[G]).call(t,(function(e){return e[L]===Ve}))||{},v=Kn(m,p,{ctrlType:Ke},f),g=(0,S.useCallback)((function(e){e.type;var t=e.value;if(Array.isArray(null==t?void 0:t.Items)){for(var n=null,r=!1,a=t.Items,l=0;l<a.length;l++){var o=a[l],c=o[L];if(c===Ve)n=o;else if(c===Ke){r=!0;break}}if(!r&&n){var d=n.Id,f=u.getRootId();u.deleteControl((0,k.createDeleteAction)([d])).then((function(){s.setSelect([f])}))}}i()}),[]),y=ne(m),C=Sn();if(0!==(null==v?void 0:v.length))return D().createElement("div",(0,R.c)({className:l},y,{"data-drag-id":m.Id},C),D().createElement("div",{className:"".concat(l,"-main"),id:"biz-button-panel"},D().createElement("div",{className:"".concat(l,"-main-content")},D().createElement("div",{className:"".concat(l,"-main-scroll")},v))))}));Yo.displayName="BizButtonPanel";var Wo=Yo,Xo=(0,S.memo)((function(e){var t=(0,S.useContext)(le),n=t.getKdesignerApi,r=t.prefixCls,a=t.isPC,l=t.fieldStatusSettingMode,o=t.floatMenu,i=(0,S.useReducer)((function(e){return e+1}),0),c=(0,d.c)(i,2)[1],u=(0,S.useMemo)((function(){return n()}),[]),s=u.data,f=u.selection,p=s.getRootId(),m=s.findControl(p),v=Ol(m),g=(0,S.useRef)(null),y=on(),C=(0,S.useCallback)((function(){f.getSelection().forEach((function(e){var t;return(0,P.c)(document.querySelectorAll(h()(t="[".concat(H,'="')).call(t,e,'"]'))).forEach((function(e){e.getAttribute(W)||e.setAttribute(W,"true")}))}))}),[]),E=(0,S.useCallback)((function(e){e.type,e.value;c(),setTimeout((function(){C()}),100)}),[]);(0,S.useEffect)((function(){var e=f.addSelectChangeListener(jl),t=s.addDataChangeListener(E);return function(){e(),t()}}),[]),(0,S.useLayoutEffect)((function(){C()}),[a]),Zl(g),Ql(m,u);var b=(0,S.useMemo)((function(){return{prefixCls:"kd"}}),[]);return D().createElement(D().Fragment,null,D().createElement(ao,null),D().createElement(w.ConfigProvider,{value:b},D().createElement("div",{className:"".concat(r,"-main-view-container"),ref:g,id:Oe,tabIndex:-1},D().cloneElement(v,{onClick:y}),D().createElement(Wo,{field:m})),!l&&D().createElement(ko,null)),l?D().createElement(Fo,{floatMenu:o}):D().createElement(No,null),D().createElement(qo,null))}));Xo.tabKey="MainView",Xo.tabName="主视图",Xo.displayName="MainView";var Zo=Xo,Qo="kdesigner-tree-node-drag-line-by-control",Jo="control",$o="",ei=["\\"],ti=function(e){e.preventDefault()},ni=function(){var e=(0,S.useContext)(le).getKdesignerApi,t=(0,S.useMemo)((function(){return e()}),[]),n=t.data,r=t.views,a=t.selection,l=(t.meta,n.getRootId()),o=(0,S.useContext)(k.GlobalConfigContext).showMessage,i=(0,S.useCallback)((function(e){!function(e,t){"outline"!==(Jo=null==t?void 0:t.getViewActiveKey("left"))&&t&&t.setViewActiveKey("left")("outline"),$o=$o||Jo}(0,r)}),[]),c=(0,S.useCallback)((function(e){!function(e){var t;if(!ei.some((function(t){return e.indexOf(t)>=0}))){var n=e.replace("/","\\/").replace("=","\\="),r=document.querySelector(".kdesigner-tree-node-item-id".concat(n," .kdesigner-tree-node-root"));if(r){var a=null==r?void 0:r.className;F()(a).call(a,Qo)||(r.className=h()(t="".concat(a," ")).call(t,Qo))}}}(e)}),[]),u=(0,S.useCallback)((function(e){var t;ti(e);var n=document.querySelector(h()(t="[".concat(H,"='")).call(t,l,"']"));null==n||n.removeAttribute(ee)}),[]);(0,S.useEffect)((function(){return k.eventBus.on("drag-control-tab",i),k.eventBus.on("drag-control_".concat(l),c),document.body.addEventListener("dragend",u),function(){k.eventBus.off("drag-control-tab",i),k.eventBus.off("drag-control_".concat(l),c),document.body.removeEventListener("dragend",u)}}),[]);var d=(0,S.useCallback)((function(e){var t,r=e.event,a=e.node;r.stopPropagation();var o=a.nodeKey;(o=o.substr(2))===l&&ti(r);var i=document.querySelector(h()(t="[".concat(H,"='")).call(t,l,"']"));null==i||i.setAttribute(ee,o);var c=n.findControl(o),u=c._Type_,d=c.Name;pn(r,u,d)}),[l]),s=(0,S.useCallback)((function(e){e.event,e.node}),[]),f=(0,S.useCallback)((0,Se.debounce)((function(e){e.event;var t=e.node;k.eventBus.emit("drag-tree-node",t.key)}),100),[]),p=(0,S.useCallback)((function(e){e.event,e.node}),[]),m=(0,S.useCallback)((function(e){e.event;var t,r=e.node,i=e.dropPosition,c=r.key,u=document.querySelector(h()(t="[".concat(H,"='")).call(t,l,"']")).dataset.outlineDragTreeNode,d=Fe()(c).call(c,2),s=n.findControl(u),f=n.findControl(d);d===l&&0!==i||(s.Id!==f.ParentId?n.swapControl((0,k.createSwapAction)({origin:u,target:Fe()(c).call(c,2),isPrev:-1===i&&d!==l,dropPosition:i})).then((function(e){a.setSelect([u])})):o("控件类型不符合，不能添加。"))}),[]);return{onDragStart:d,onDragEnter:s,onDragOver:f,onDragLeave:p,onDrop:m,onDragEnd:(0,S.useCallback)((function(e){e.event;var t,n=e.node,r=document.querySelector(h()(t="[".concat(H,"='")).call(t,l,"']"));null==r||r.removeAttribute(ee),k.eventBus.emit("drag-tree-node",n.key)}),[])}};function ri(e,t){var n=void 0!==ve()&&ye()(e)||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return ai(e,t);var r=Fe()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return pe()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ai(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,l=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw l}}}}function ai(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function li(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function oi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?li(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):li(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var ii=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=(0,P.c)(e),a=[],l={},o=[];return r.forEach((function(e,r){var i,c=e.Id,u=e.Name,d=e.ParentId,s=e.Key,f=e._Type_,p=e.Multi,m=e.SelectItemType,v=t.getControlMeta(f).Name,g=d?h()(i="[".concat(v,"]")).call(i,u||s||c):"".concat(u||s||c),y={key:n?"${"+"model.".concat(s)+"}":s,title:g,parentId:d,id:c,type:f,isLeaf:!0};if(Kt(f)&&(y.selectable=!1,y.isLeaf=null),ut(f)&&(y.title+="（".concat(1==m?"多选":"单选","）")),$e(f)){var C=t.getControlPropertyDefaultValue(f,"BillEntityIdEx"),E=oi({BillEntityId:C,BillEntityIdEx:C},e),b=E.BillEntityId,I=E.BillEntityIdEx;y.title+="（".concat("1"===p?"多条":"单条","）"),y.children=[],y.isAsyncNode=!0,y.isLeaf=null,y.BillEntityId=b,y.BillEntityIdEx=I}var N=n?"${"+"model.".concat(s,"_startdate")+"}":"".concat(s,"_startdate"),T=n?"${"+"model.".concat(s,"_enddate")+"}":"".concat(s,"_enddate");Qe(f)?(a.push(oi(oi({},y),{},{key:N,title:g+".开始"})),a.push(oi(oi({},y),{},{key:T,title:g+".结束"}))):a.push(y),y.parentId?Qe(f)?(o.push(oi(oi({},y),{},{key:N,title:g+".开始"})),o.push(oi(oi({},y),{},{key:T,title:g+".结束"}))):o.push(y):l=oi(oi({},y),{},{isLeaf:!1})})),function e(t,n,r){var a=(0,P.c)(n),l=0;n.forEach((function(n,o){if((null==n?void 0:n.parentId)===t.id){var i,c=h()(i="".concat(r,"_")).call(i,l++);ce()(a).call(a,o,1,void 0),t.children?t.children.push(n):t.children=[n],e(n,a,c)}}))}(l,o,"0"),[l]},ci=function e(t){var n=t.options,r=t.currRefbillTableKey,a=void 0===r?"":r;return n?n.reduce((function(t,n){var r=n.key,l=n.title,o=n.titlePrefix,i=n.children,c=n.type,u=n.entityId,d=n.isMulti,s={key:r,title:l,titlePrefix:a===r?o.replace("[多条]","[循环中：单条]"):o,type:c,isMulti:d,selectable:!0};return"group"===c&&(s.selectable=!1),$e(c)&&(s.BillEntityId=u,s.BillEntityIdEx=u),i&&(s.children=e({options:i})),h()(t).call(t,s)}),[]):n},ui=function e(t){var n=t.metaApi,r=t.options;return r?r.reduce((function(t,r){var a,l=r.key,o=r.title,i=r.children,c=r.type,u=r.entityId,d=r.isMulti,s=r.titlePrefix,f=null!=l&&F()(l).call(l,"fbasedataid")?l.split(".fbasedataid")[0]:l,p=(null==f||null===(a=f.split("."))||void 0===a?void 0:a.length)||0;if(!Kt(c)&&p>1)return t;var m={key:"${"+"model.".concat(l)+"}",title:o,titlePrefix:s,type:c,isMulti:d};return(Kt(c)||lt(c))&&(m.selectable=!1,m.isLeaf=null),u&&(m.entityId=u),i&&(m.children=e({options:i,metaApi:n})),h()(t).call(t,m)}),[]):r},di=function e(t){var n=t.options;return n?n.reduce((function(t,n){var r,a=n.key,l=n.title,o=n.titlePrefix,i=n.children,c=n.type,u=n.isMulti,d=n.sourceForm,s={key:a,title:l,titlePrefix:o};return i&&!u&&(s.children=e({options:i})),"1"===d||a.split(".").length>1&&void 0!==d?t:$e(c)||et(c)||ot(c)?h()(t).call(t,s):(s.selectable=!1,null!=s&&null!==(r=s.children)&&void 0!==r&&r.length?h()(t).call(t,s):t)}),[]):n},si=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key";return t.reduce((function(t,r){var a=[];return r[n]&&a.push(r[n]),r.children&&a.push.apply(a,(0,P.c)(e(r.children,n))),h()(t).call(t,a)}),[])},fi=function(e){var t,n=[],r={},a=ri(e);try{for(a.s();!(t=a.n()).done;){var l=t.value;r[l.Id]=oi(oi({},l),{},{children:[]})}}catch(e){a.e(e)}finally{a.f()}var o,i=ri(e);try{for(i.s();!(o=i.n()).done;){var c=o.value;c.ParentId?r[c.ParentId]&&r[c.ParentId].children.push(r[c.Id]):n.push(r[c.Id])}}catch(e){i.e(e)}finally{i.f()}return n},pi={},mi="id",vi="",gi=(0,S.memo)((0,S.forwardRef)((function(e,t){var n=e.data,r=(0,S.useContext)(le),a=r.getKdesignerApi,l=r.prefixCls,o=r.getPrefixCls,i=(0,S.useMemo)((function(){return a()}),[]),c=i.data,u=i.selection,s=c.getRootId(),f=(0,S.useState)(!0),m=(0,d.c)(f,2),g=m[0],y=m[1],C=(0,S.useState)(!1),E=(0,d.c)(C,2),b=E[0],I=E[1],T=(0,S.useState)([s]),x=(0,d.c)(T,2),A=x[0],M=x[1],R=(0,S.useState)(600),_=(0,d.c)(R,2),O=_[0],j=_[1],K=(0,S.useState)(void 0),V=(0,d.c)(K,2),U=V[0],z=V[1],H=(0,S.useRef)(null),q=(0,S.useRef)(null),Y=(0,S.useState)(n),W=(0,d.c)(Y,2),X=W[0],Z=W[1],Q=(0,S.useRef)(null);Zl(H,!0);var J=ni(),$=J.onDragStart,ee=J.onDragEnter,te=J.onDragOver,ne=J.onDragLeave,re=J.onDrop,ae=J.onDragEnd,oe=o&&o(l,"outline"),ie=(0,S.useState)([]),ue=(0,d.c)(ie,2),de=ue[0],se=ue[1],fe=(0,S.useMemo)((function(){var e="".concat(oe,"-search-prefix-icon");return D().createElement(w.Icon,{prefix:"designericon",type:"sousuo",className:e})}),[oe]),me=(0,S.useCallback)((function(e){var t=e.value,n=t.reduce((function(e,t){var n,r;return h()(n=[]).call(n,(0,P.c)(e),[h()(r="".concat(mi)).call(r,t)])}),[]);M(n);var r=(0,P.c)(de);t.forEach((function(e){for(var t,n=e;n!==s&&""!==n;){var a,l=h()(a="".concat(mi)).call(a,n);!F()(r).call(r,l)&&r.unshift(l),n=c.getParentControlId(n)}var o=h()(t="".concat(mi)).call(t,s);!F()(r).call(r,o)&&r.unshift(o)})),se(r)}),[s,de]),ve=(0,S.useCallback)((function(e){var t=e.value;Z(t)}),[]);(0,S.useEffect)((function(){var e=u.addSelectChangeListener(me),t=c.addDataChangeListener(ve);return function(){e(),t()}}),[me]),(0,S.useEffect)((function(){var e=(0,Se.debounce)((function(){var e=document.body.clientHeight-30-80-20;j(e),Q.current&&(Q.current.style.height="".concat(e,"px"))}),100);return window.addEventListener("resize",e),function(){pi={},window.removeEventListener("resize",e)}}),[]),(0,S.useEffect)((function(){var e=document.body.clientHeight-30-80-20;j(e),Q.current&&(Q.current.style.height="".concat(e,"px"))}),[Q]);var ge=(0,S.useCallback)((function(e){var t;if(vi!==e){var n=(0,P.c)(de),r=c.getParentControlId(e),a=h()(t="".concat(mi)).call(t,e);for(!F()(n).call(n,a)&&n.push(a);e&&r&&r!==s;){var l;r=c.getParentControlId(r);var o=h()(l="".concat(mi)).call(l,r);F()(n).call(n,o)||n.push(o)}vi=e,se(n)}}),[de]);(0,S.useEffect)((function(){return k.eventBus.on("drag-control_".concat(s),ge),function(){k.eventBus.off("drag-control_".concat(s),ge)}}),[ge]);var ye=(0,S.useCallback)((function(){var e=!g;if(y(e),e)se([]),Q.current&&(Q.current.scrollTop=0);else{var t,n=N()(t=X[G]).call(t,(function(e){var t;return h()(t="".concat(mi)).call(t,e[B])}));se(n)}}),[g,X,Q.current]),Ce=(0,S.useCallback)((function(){I(!b)}),[b]),he=(0,S.useCallback)((function(e){var t=N()(e).call(e,(function(e){return e.substr(2)}));u.setSelect(t);var n=e[0],r=Kr()(de).call(de,(function(e){return n===e})),a=(0,P.c)(de);r>=0?ce()(a).call(a,r,1):a.push(n),se(a)}),[de]),Ee=(0,S.useMemo)((function(){return function(e,t,n){var r=(0,P.c)(e[G]),a=[],l=[],o={},i=[];return r.forEach((function(e,r){var l,c,u,d=e.Id,s=e.Name,f=e.ParentId,m=e.Key,v={key:d,title:s||m||d,parentId:f,Hidden:"4"===e.Status,disabled:e._Root_};null!=n&&n.prefix&&(v=oi(oi({},v),{},{key:h()(c="".concat(n.prefix)).call(c,d),parentId:f?h()(u="".concat(n.prefix)).call(u,f):f})),t&&(v.title=h()(l="".concat(s,"（")).call(l,m,"）")),n&&r>0&&p()(n).forEach((function(t){v[t]=e[L]})),a.push(v),(ot(e[L])&&"1"===e.ShowType||$e(e[L])&&null!=e&&e.RefTableId&&"2"===(null==e?void 0:e.ShowType))&&(v.Hidden=!0),v.parentId?i.push(v):o=oi({},v)})),function e(t,n,r){var a=(0,P.c)(n),o=0;t.parentId||l.push(oi(oi({},t),{},{level:r})),n.forEach((function(n,i){if((null==n?void 0:n.parentId)===t.key){var c,u=h()(c="".concat(r,"_")).call(c,o++);t.Hidden&&(n.Hidden=!0),l.push(oi(oi({},n),{},{level:u})),ce()(a).call(a,i,1,void 0),t.children?t.children.push(n):t.children=[n],e(n,a,u)}}))}(o,i,"0"),o.searchData=l,[o]}(X,b,{prefix:mi})}),[X,b]),be=(0,S.useCallback)((function(e){var t,n,r,a,l,o=(0,P.c)((null==Ee||null===(t=Ee[0])||void 0===t?void 0:t.searchData)||[]),i=Xr()(n=e.target.value).call(n),c=N()(r=yn()(a=N()(l=v()(o).call(o,(function(e){var t,n,r;return(null===(t=e.key)||void 0===t?void 0:F()(n=Fe()(t).call(t,2)).call(n,i))||F()(r=e.title).call(r,i)}))).call(l,(function(e){var t;return{id:null===(t=e.key)||void 0===t?void 0:Fe()(t).call(t,2),level:e.level}}))).call(a,(function(e){return e.level}))).call(r,(function(e){return e.id}));pi[i]=(0,P.c)(c),z(i)}),[Ee]),Ie=(0,S.useCallback)((function(){if(!U||!pi[U])return null;var e=pi[U],t=e.length;if(t<=0)return s;var n=u.getActiveSelectedId();if(!F()(e).call(e,n))return e[0];var r=e.indexOf(n);return r===t-1?r=0:r++,e[r]}),[U]),Ne=(0,S.useCallback)((function(){q.current&&q.current.focus();var e=Ie(),t=c.findControl(e);e&&u.setSelect([t?e:s])}),[q,Ie]),Te=function(e,t){e.stopPropagation(),e.preventDefault();var n=(0,P.c)(de),r=n.indexOf(t);r>=0?ce()(n).call(n,r,1):n.push(t),se(n)},xe=[function(e){return D().createElement(w.Icon,{prefix:"designericon",type:"shouqi3",onClick:function(t){return Te(t,e.nodeKey)}})},function(e){return D().createElement(w.Icon,{prefix:"designericon",type:"zhankai3",onClick:function(t){return Te(t,e.nodeKey)}})}],Ae=(0,S.useCallback)((function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).nodeKey;if(!e)return D().createElement(w.Icon,{prefix:"designericon",type:"Flexmianban"});var t=dn((c.findControl(Fe()(e).call(e,2))||{})[L],"Flexmianban");return D().createElement(w.Icon,{prefix:"designericon",type:t})}),[]),De=(0,S.useCallback)((function(e){return e.Hidden?"kdesigner-form-designer-outline-tree-node-disabled":""}),[]);return D().createElement("div",{className:"".concat(oe,"-wrap")},D().createElement("div",{className:"".concat(oe,"-search")},D().createElement(w.Input,{size:"small",prefix:fe,placeholder:"搜索大纲",borderType:"bordered",className:"".concat(oe,"-search-input"),onChange:be,onPressEnter:Ne,value:U,ref:q,allowClear:!0}),D().createElement(w.Icon,{prefix:"designericon",className:"".concat(oe,"-search-icon"),onClick:ye,type:g?"shouqiquanbu":"zhankaiquanbu",title:g?"全部展开":"全部收起"}),D().createElement(w.Icon,{prefix:"designericon",className:"".concat(oe,"-search-icon"),onClick:Ce,type:b?"zhanshi":"yincang",title:b?"隐藏标识":"显示标识"})),D().createElement("div",{ref:H,className:"".concat(oe,"-tree"),tabIndex:-1},D().createElement(w.Tree,{name:"OutlineTree",treeData:Ee,height:O,width:280,onExpand:function(e,t){var n,r=t.expanded,a=t.node.key,l=v()(e).call(e,Boolean);l=r?h()(n=[a]).call(n,(0,P.c)(l)):v()(l).call(l,(function(e){return e!==a})),l=pe()(new(vn())(l)),se(l)},expandedKeys:de,className:oe,virtual:!1,draggable:!0,icon:Ae,showIcon:!0,selectedKeys:A,onSelect:he,onDragStart:$,onDragEnter:ee,onDragOver:te,onDragLeave:ne,onDrop:re,onDragEnd:ae,ref:Q,setTreeNodeClassName:De,switcherIcon:xe})))})));gi.tabKey="Outline",gi.tabName="大纲",gi.displayName="Outline";var yi=gi,Ci="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALgAAABoCAMAAAB108raAAAAb1BMVEUAAADX3unW2ebX3ujY3+nk6OnW3OjZ3urX3eXX3OjZ3unX3efX3ejX3ujZ3uvY3eje3u/X3OfX3ejX3unX3ejW3ejX3ejY3ujX3ejh5/Pf5e/X3OjX3enX3enY3ejW3OjY3eji6PPW3OfK0NvQ1uBUAKD9AAAAIXRSTlMADgcbKgQgFSQnGDQ8QxI4CzE/LkdJ+Evo+si0aH1e2o9Ktf8OAAADNElEQVR42u3a21KrMBSA4ZVAoJwpKm2BHqB9/2fcTG0qrUAOpu7FmE9mqOjFL7MIOAO8BN2c6uO2LLfH+rShsBDpoS67gbI+pIBfvufVA+U+B9xYs+1GbRsGiDlVN6lyAK1s283YZoDUoexmlQdA6dAJoSzPyoclsCkCQoKiqR8OI5wWZztcQgjckWb4E3RXKKuGi/b00l5hWxWbweIxu9w0gEp+LzuG8wv8Ftc9dH/v8kSXwB4QSUs+35Fw0SkxPXEdJE7nHuNiXn8NsPgyqAENWsosGQ2fFTz/WWykxpfwP28DWJz4EMgN1AmwqOVuLg26IT/eihKYVfB7FGDB1wsPZgV87QEs+FXHYBbh1zBg0d1I/x4WNlzAhttwSTbchkuy4TZckg234ZL+cHhS7VpDdlUCvyZpjXpNOaMk9AmFocpseAXGkSDe3MQrAtzObPgODHOKjweFA59aw8CosHj/JvbRhzP3fdQbwx2ex8mEjGIOp3EyKc7xhtOsmJFRtOHrYtYb1nAvFkAaTuKFhruZyAvDaegF67XrORRU5RkXZdFVFvHvPz9HxsOHTxhc4RJQ4kUcz372onASfTyJVNLZOhJ4TTh1J27Ussha7AXhpEhGxanMgzehDMI3MfPhYTLJma/2PfdqFbhixsOdiegi6YUwLRXkaoTvusv5fOl2rQRSzPJhiuO6psO7803XimVFERfxgyIeHKNT3YEiccrlfHdphWIBF0b5q2DVb8EV/zzYc1/H5c4314nDswdxFvfbfd8LYQRdKRPO9/mBcM4zkTWMcDxlEidc6ZRH2chdOrt+3aTwDfXUSU24wpRHQiNTThx1opDzk1ZgLcbgmb+McALPQked6VF5E3NY2peGKfsK12D64nQVeISPigbTy6GrxGPa4aZvQIGaFYVeqsH0LT9QLWcAQDSYfshaqfK0w8V4eGs0nCMP4TnJ++0/hHvqGOQaEITnQDWYDnfUpUsN94FpMB0ealhuuA7T4b4GHOHplZ/63/QH+43vsYWnGlCEEw02/CfhuQa9cMOoBhv+J8OZBhv+E6DBhtvwARtuw385fDEvTA4t7BXVJb8UjPU17H+K3WpesHGw6wAAAABJRU5ErkJggg==",hi=["NCPG_Hide"],Ei=function(e){var t=(0,S.useContext)(le),n=t.getKdesignerApi,r=t.prefixCls,a=t.billPropsData,l=t.dispatchBillData,o=t.invokeAction,i=(0,S.useMemo)((function(){return n()}),[]),c=i.selection,u=i.data,s=(0,S.useState)(null),f=(0,d.c)(s,2),p=f[0],m=f[1],g=u.getRootId(),y=function(){var e=c.getSelection();if(1===(null==e?void 0:e.length)){var t=u.findControl(e[0]),n=u.getParentControl(e[0])||{},r=n._Type_,l=n.BillEntityIdEx;!l||!ot(r)||null!=a&&a[l]||o("getDesignerMetadata",[l]),m(t)}else m({})},C=(0,k.useActivedSelectedId)({dataContext:u,selectionContext:c}).activedSelectId,h=(0,S.useMemo)((function(){return u.getParentControl(C)}),[C]),E=(0,S.useCallback)((function(e){var t;if(null!=e&&e.data){var n=(null==e?void 0:e.data)||{},r=N()(t=n.entitymeta.Items).call(t,(function(e){return e.Id}));l({key:Ur,payload:{form:e.billEntityIdEx||n.id,info:{data:n,ids:r}}})}}),[]);if((0,S.useEffect)((function(){return k.eventBus.on(hr,E),function(){k.eventBus.off(hr,E)}}),[E]),(0,S.useEffect)((function(){var e=c.addSelectChangeListener(y);return function(){e()}}),[y]),(0,S.useEffect)((function(){y()}),[]),null!=h&&h.BillEntityIdEx&&ot(null==h?void 0:h._Type_)){if(!xa(h,(null==a?void 0:a.innerForm)||[]))return D().createElement(Un.EmptyData,{src:Ci,desc:"无法编辑应用外表单内容的属性"});if((null==h?void 0:h.BillEntityIdEx)===u.getRootId())return D().createElement(Un.EmptyData,{src:Ci,desc:"表格为当前表单时无法编辑内容属性"});if(p.RefTableId||p.RefBillId)return D().createElement(Un.EmptyData,{src:Ci,desc:"无法编辑属性，请于原单编辑"})}return D().createElement(D().Fragment,null,(null==p?void 0:p.Id)&&g!==p.Id&&D().createElement(uo,{field:p,className:"".concat(r,"_property_switchfield")}),D().createElement(k.PropertyView,(0,R.c)({},e,{filterPropertyHandler:function(e){return(0,yt.produce)(e,(function(e){return v()(e).call(e,(function(e){return!F()(hi).call(hi,e.Key)}))}))}})))};Ei.tabKey="property",Ei.tabName="属性";var bi=Ei,Ii=n(3020),Ni=n.n(Ii);function Ti(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function xi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ti(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Ti(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Ai=[{label:"4",value:4},{label:"5",value:5},{label:"6",value:6},{label:"7",value:7},{label:"8",value:8},{label:"9",value:9},{label:"10",value:10}],Fi=/^[a-zA-Z]+$/,Si=function(e,t){return xi(xi({},e),t)},Di=(0,S.forwardRef)((function(e,t){var n=e.className,r=(0,S.useContext)(le),a=r.getBillnoSetting,l=r.setBillnoSetting,o=w.Form.useForm(),i=(0,d.c)(o,1)[0],c=(0,S.useReducer)(Si,a()),u=(0,d.c)(c,2),f=u[0],p=u[1],m=f.billNoPreview,v=f.billNoYMD,g=f.billNoHMS,y=f.billNoPrefix,C=f.billNoRandomNum,h=(0,S.useCallback)((function(e){var t=e.billNoPreview,n=e.billNoYMD,r=e.billNoHMS,a=e.billNoPrefix,l=e.billNoRandomNum,o=t?t.replace(/^([a-zA-Z]+)\d+$/g,"$1"):"";a&&Fi.test(a)&&(o=a,n&&(o+="".concat(Lt(new Date,"yyyyMMdd"))),r&&(o+="".concat(Lt(new Date,"hhmmss"))),l&&(o+="".concat(function(e){for(var t=[];t.length<e;)t.push(Math.floor(10*Math.random()));return t.join("")}(l))),p({billNoPreview:o}))}),[v,g,y,C]),E=(0,S.useCallback)((function(e){var t=e.target.value;p({billNoPrefix:t}),h(xi(xi({},f),{},{billNoPrefix:t}))}),[p,h]),b=(0,S.useCallback)((function(e){var t=!f[e];p((0,s.c)({},e,t)),h(xi(xi({},f),{},(0,s.c)({},e,t)))}),[f,p,h]),I=(0,S.useCallback)((function(e){p({billNoRandomNum:e}),h(xi(xi({},f),{},{billNoRandomNum:e}))}),[p,h]),N=(0,S.useCallback)((function(){return new(jr())((function(e,t){i.validateFields().then((function(t){Ni()(t);l(f),e(!0)})).catch((function(e){return t(e)}))}))}),[l,f]);return(0,S.useImperativeHandle)(t,(function(){return{saveForm:N}}),[N]),D().createElement("div",{className:"".concat(n,"-modal-body")},D().createElement(w.Form,{layout:"vertical",form:i,labelWidth:100,wrapperWidth:"100%",onValuesChange:function(e,t){}},D().createElement("div",{className:jn()("".concat(n,"-form-item"),"".concat(n,"-form-item-vertical"))},D().createElement("div",{className:"".concat(n,"-form-item-label")},"编码示意"),D().createElement("div",{className:"".concat(n,"-form-item-desc")},m||"-")),D().createElement(w.Form.Item,{label:"前缀字母",name:"billNoPrefix",required:!0,validateTrigger:"onChange",rules:[{required:!0,message:"请输入前缀字母"},{type:"string",pattern:/^[a-zA-Z]+$/,message:"格式错误，只能输入大小写字母"}]},D().createElement(w.Input,{type:"text",borderType:"bordered",size:"middle",value:f.billNoPrefix,placeholder:"最多不超过8位",maxLength:8,onChange:E})),D().createElement("div",{className:jn()("".concat(n,"-form-item"),"".concat(n,"-form-item-horizontal"))},D().createElement("div",{className:"".concat(n,"-form-item-label")},"年月日"),D().createElement(w.Switch,{checked:f.billNoYMD,onClick:function(){return b("billNoYMD")}})),D().createElement("div",{className:jn()("".concat(n,"-form-item"),"".concat(n,"-form-item-horizontal"))},D().createElement("div",{className:"".concat(n,"-form-item-label")},"时分秒"),D().createElement(w.Switch,{checked:f.billNoHMS,onClick:function(){return b("billNoHMS")}})),D().createElement(w.Form.Item,{label:"n位随机数",name:"billNoRandomNum",required:!0,rules:[{required:!0,message:"请选择n位随机数"}]},D().createElement(w.Select,{placeholder:"请选择",borderType:"bordered",value:f.billNoRandomNum,options:Ai,onChange:I}))))})),ki=function(e){var t=e.className,n=e.onCancel,r=e.onConfirm;return D().createElement("div",{className:"".concat(t,"-modal-footer")},D().createElement(w.Button,{onClick:n,type:"second",size:"small",className:"".concat(t,"-modal-cancel-btn")},"取消"),D().createElement(w.Button,{type:"primary",size:"small",style:{marginLeft:"12px"},onClick:r,className:"".concat(t,"-modal-ok-btn")},"确定"))},Mi=function(e){var t=e.className,n=e.visible,r=e.setVisible,a=e.onConfirm,l=(0,S.useRef)(null),o=function(){r(!1)};return D().createElement(w.Modal,{mask:!0,visible:n,body:D().createElement(Di,{className:t,ref:l}),bodyStyle:{justifyContent:"start",alignItems:"start",overflowX:"hidden",overflowY:"auto",flexDirection:"column"},titleIcon:null,className:"".concat(t,"-modal"),footer:D().createElement(ki,{className:t,onConfirm:function(){(0,l.current.saveForm)().then((function(){null==a||a(),r(!1)})).catch((function(e){}))},onCancel:o}),maskClosable:!1,width:320,height:438,title:"设置表单编号格式",closable:!0,destroyOnClose:!0,onCancel:o,onOk:o})};function wi(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wi(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):wi(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Ri="System_CategoryBillNo",Bi=["NoCodeBillNoField"],_i=["NoCodeCreateDateField","NoCodeCreatorField","NoCodeModifyDateField","NoCodeModifierField"],Oi=function(e){var t=e.prefixCls,n=e.data,r=(0,S.useContext)(k.DataFactoryContext).dataFactory,a=(0,S.useContext)(k.GlobalConfigContext),l=a.env,o=a.keywordMapping,i=(0,S.useContext)(le),c=i.getKdesignerApi,u=i.showMessage,d=c(),s=d.data,f=d.selection,p=d.meta,m=n.Name,v=n.Id,g=(0,(0,S.useContext)(k.GlobalConfigContext).getOutlineItemIcon)(v),y=(0,S.useCallback)((function(){var e,t,n=s.getRootId(),a=f.getActiveSelectedId(),l=s.findControl(a);l=s.getContainerControl(l);var i=p.canAdd(v,l[o.type]);if(!(!0===i||"object"===(0,he.c)(i)&&i.success))return(null==i?void 0:i.message)&&u(i.message),!1;var c=null===(e=p.getControlMeta(null===(t=l)||void 0===t?void 0:t[o.type]))||void 0===e?void 0:e.IsContainer,d=r({type:v,parentId:c?l[o.id]:n}),m=l[o.id]===a?-1:s.findControlIndex(a)+1;s.addControl((0,k.createAddAction)(d,{index:m})).then((function(e){if(null!=e&&e.length){var t=e[0].value;f.setSelect(Array.isArray(t)?[t[0][o.id]]:[t[o.id]])}}))}),[v]),C=(0,S.useCallback)((function(e){var t={type:"control",data:n};l[k.CONTROL_DRAG_DATA]=t}),[n]);return D().createElement("div",{className:"".concat(t,"-control-item"),draggable:!0,onDragStart:C,onClick:y},g,D().createElement("div",{className:"".concat(t,"-control-name")},m))},ji=(0,S.forwardRef)((function(e,t){var n=e.data,r=e.prefixCls,a=e.titleSuffix,l=e.showSwitch,o=void 0===l||l,i=e.onSwitchChange,c=(0,S.useContext)(le),u=c.setSystemSetting,f=c.getSystemSetting,p=((0,c.getKdesignerApi)().data,n.Name),m=n.Controls,v=n.Id,g=(0,S.useState)((function(){var e,t=f();return(null==t?void 0:t[v])||(null==t||null===(e=t[v])||void 0===e?void 0:e.value)||!1})),y=(0,d.c)(g,2),C=y[0],h=y[1],E=(0,S.useCallback)((function(e){var t=Pi(Pi({},f()),{},(0,s.c)({},v,e));h(e),u(t)}),[C,h,u]);return(0,S.useImperativeHandle)(t,(function(){return{isOpen:C,setIsOpen:E}}),[C,E]),D().createElement("div",{className:"".concat(r,"-category-group")},D().createElement("div",{className:"".concat(r,"-category-group-title")},D().createElement("div",{className:"group-name"},p,D().createElement("div",{className:"group-title-suffix"},a)),o&&D().createElement(w.Switch,{checked:C,onClick:function(){return function(){var e=!C;if(!1!==i(v,e)){var t=Pi(Pi({},f()),{},(0,s.c)({},v,e));h(e),u(t)}}()}})),D().createElement("div",{className:"".concat(r,"-category-list")},C&&N()(m).call(m,(function(e){return D().createElement(Oi,{key:e.Id,prefixCls:r,data:e})}))))})),Li=function(e){var t=e.meta,n=(0,S.useContext)(le),r=n.prefixCls,a=(0,n.getKdesignerApi)(),l=a.data,o=(a.selection,(0,S.useState)((function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.Controls,n=void 0===t?[]:t,r=e.Categories,a=void 0===r?[]:r,l=v()(a).call(a,(function(e){var t;return null==e||null===(t=e.Id)||void 0===t?void 0:y()(t).call(t,je)}));return N()(l).call(l,(function(e){var t=v()(n).call(n,(function(t){return(null==t?void 0:t.CategoryId)===(null==e?void 0:e.Id)}));return Pi(Pi({},e),{},{Controls:t})}))}(t||[])}))),i=(0,d.c)(o,2),c=i[0],u=(i[1],(0,S.useState)(!1)),s=(0,d.c)(u,2),f=s[0],p=s[1],m=(0,S.useRef)(null),g=function(){p(!0)},C=function(e,t){if(e===Ri&&t&&!1===f)return p(!0),!1;if(e===Ri&&!t){var n,r=N()(n=l.findControlByCondition((function(e){return F()(Bi).call(Bi,e._Type_)}))).call(n,(function(e){return e.Id}));r.length&&l.deleteControl((0,k.createDeleteAction)(r),!1)}if("System_CategoryRecordInfo"===e&&!t){var a,o=N()(a=l.findControlByCondition((function(e){return F()(_i).call(_i,e._Type_)}))).call(a,(function(e){return e.Id}));o.length&&l.deleteControl((0,k.createDeleteAction)(o),!1)}};return D().createElement(D().Fragment,null,D().createElement("div",{className:"".concat(r,"-system-categories")},N()(c).call(c,(function(e){var t=e.Id;return t===Ri?D().createElement(ji,{ref:m,prefixCls:r,key:t,data:e,onSwitchChange:C,titleSuffix:D().createElement(w.Icon,{prefix:"designericon",type:"shezhi",onClick:g})}):D().createElement(ji,{prefixCls:r,key:t,data:e,showSwitch:!1,onSwitchChange:C})}))),D().createElement(Mi,{className:"".concat(r,"-billno-setting"),visible:f,setVisible:p,onConfirm:function(){var e=m.current,t=e.isOpen,n=e.setIsOpen;!1===t&&n(!0)}}))};Li.tabKey="CategorySystem",Li.tabName="系统功能",Li.displayName="CategorySystem";var Ki=Li,Vi=["type","value"],Ui=["Name","_Type_","RefBillId","RefTableId","EntityData","ParentId","Key"];function Gi(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function zi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gi(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Gi(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Hi=function(e,t,n,r){var a,l=e.globalConfig,o=e.dataContext,i=e.selectionContext,c=e.action,u=e.dataFactory,f=e.modelFactory,m=e.metaReader,v=(c.type,c.value),g=((0,Ce.c)(c,Vi),r.controlCacheApi),y=r.dispatchBillData,C=r.billPropsData,E=r.getHideFieldRef,I=r.setHideFieldRef,T=[],A=E();return v.forEach((function(e){var t,n=(0,d.c)(e,2),r=n[0],a=n[1],v=o.findControl(r),E=o.findControlIndex(r),I=v?m.getDefaultData(null===(t=v)||void 0===t?void 0:t._Type_):{},S=(v=zi(zi({},I),v))||{},D=S.Name,M=S._Type_,w=S.RefBillId,B=S.RefTableId,O=S.EntityData,j=S.ParentId,K=(S.Key,(0,Ce.c)(S,Ui)),V=o.findControl(j)||{},U=V._Type_,G=V.BillEntityIdEx,z=V.SourceForm;if("Status"in a){var H=function(e,t,n,r){var a=(0,d.c)(e,2),l=a[0],o=a[1],i=n.getAllSubControls(l),c=n.getAllParentControls(l),u=i.reduce((function(e,n){var a=n.Id;if(n._Type_,l!==n.Id){var i,c=h()(i=[]).call(i,(0,P.c)(e),[[a,o]]),u=ha(a,o,n,{metaReader:r});return u&&c.push(u),c}if(null!=n&&n.RefBillId||null!=n&&n.RefTableId){var s=(null==n?void 0:n.RefBillId)||(null==n?void 0:n.RefTableId),f=t[s],p=Ca(o,f,r);t[s]=Ta(Ta(Ta({},f),o),{},{EntityData:p}),null!=n&&n.RefTableId&&b()(t).forEach((function(e){var a=(0,d.c)(e,2),l=a[0],i=a[1];if(i.ParentId===(null==n?void 0:n.RefTableId)){var c=Ca(o,f,r);t[l]=Ta(Ta(Ta({},i),o),{},{EntityData:c})}}))}return e}),[]),s=c.reduce((function(e,n){var a=n.Id,l=n._Type_,i=n.Status;if((Kt(l)||ot(l))&&Number(i)>Number(o.Status)){var c,u=[[a,Kt(l)?{Status:"1"}:o]],d=ha(a,o,n,{metaReader:r});!Kt(l)&&d&&u.push(d);var s=t[null==n?void 0:n.RefBillId];if(s){var f=Ca(o,s,r);t[null==n?void 0:n.RefBillId]=Ta(Ta(Ta({},s),o),{},{EntityData:f})}return h()(c=[]).call(c,(0,P.c)(e),u)}return e}),[]),f=h()(u).call(u,s);return f.length&&(0,k.createUpdateAction)(f)}(e,A,o,m);H&&T.push(H)}if("FormatType"in a){var q=v,Y=q.DateRangeDefValue,W=q.NoCodeDefValue;Y&&Qe(M)&&(0,R.c)(a,{DateRangeDefValue:void 0}),W&&Je(M)&&(0,R.c)(a,{NoCodeDefValue:void 0})}if("ParentId"in a){var X=o.findControl(a.ParentId),Z=X.Status,Q=X._Type_;if(Kt(Q)&&void 0!==Z){var J=o.getAllSubControlIds(r);T.push((0,k.createUpdateAction)(N()(J).call(J,(function(e){return[e,{Status:Z}]}))))}}if($e(M)){if("ShowType"in a){var $=a.ShowType;if(v=zi(zi(zi({},v),a),{},{EntityData:zi(zi({},v.EntityData),a)}),T.push((0,k.createDeleteAction)([r])),A[r]=v,B||"2"!==$){if(B&&"2"===$){var ee=x()(A).reduce((function(e,t){if(t.Id===B||t.ParentId===B){var n;delete A[t.Id];var r=t.Id===B?zi(zi(zi({},t),a),{},{EntityData:zi(zi({},t.EntityData),a)}):t;return h()(n=[]).call(n,(0,P.c)(e),[r])}return e}),[]);T.push((0,k.createAddAction)(ee,{index:E})),setTimeout((function(){return i.setSelect([B])}),100)}}else{var te,ne,re=(0,k.createUUid)(3);delete K.FieldType,delete K.FieldId,delete K.EntryId;var ae=Ia(u({type:ze,parentId:j,transferData:zi(zi({},K),{},{Name:D,RefBillId:r,Id:re,ShowType:"2",SourceForm:"2",Key:"nc_".concat((0,k.createUUid)().toLowerCase())})}),{dataContext:o,metaReader:m});g.addCache("controlId",ae.Id);var le=wa((null==C||null===(te=C[null==K?void 0:K.BillEntityIdEx])||void 0===te?void 0:te.data)||[],ae);le=(le=ka(le,ae.PropsDisplay)).reduce((function(e,t){var n;return t.isShow?h()(n=[]).call(n,(0,P.c)(e),[Ra(t,ae.Id)]):e}),[]),T.push((0,k.createAddAction)(h()(ne=[ae]).call(ne,(0,P.c)(le)),{index:E})),v.RefTableId=re,v.EntityData.RefTableId=re,A[r]=v,setTimeout((function(){return i.setSelect([re])}),100)}}if(B&&!(_ in a)&&!("ShowType"in a)&&!ot(U)){var oe=A[B];A[B]=zi(zi({},oe),a),A[B].EntityData=zi(zi({},oe.EntityData),a)}}if(ot(M)){var ie=A[w];A[w]=zi(zi({},ie),a),A[w].EntityData=zi(zi({},ie.EntityData),a),"inner2Outer"in a&&T.push((0,k.createUpdateAction)([[r,{EntityData:zi(zi({},O),{},{inner2Outer:!0})}]])),"ShowType"in a&&(T.push((0,k.createDeleteAction)([r])),T.push((0,k.createAddAction)([zi({},A[w])],{index:E})),delete A[w],o.findControlByCondition((function(e){e.Id===r&&(v=zi(zi(zi({},v),a),{},{EntityData:zi(zi({},v.EntityData),a)}),A[e.Id]=v),e.ParentId===r&&(A[e.Id]=e)})),setTimeout((function(){return i.setSelect([w])}),100))}if(j&&ot(U)){var ce=G||"1"!==z?G:j+"_table",ue=r.replace("_".concat(j),""),de=p()(a).reduce((function(e,t){return function(e){var t;return F()(t=["Status","DisplayRules","FieldRequired","NoCodeDefValue","QueryFormValue","FormulaValue","UploadDefValue","PictureDefValue","Visibility"]).call(t,e)}(t)?e:zi(zi({},e),{},(0,s.c)({},t,a[t]))}),{});p()(de).length&&(y({key:Gr,payload:{form:ce,id:ue,data:de}}),o.findControlByCondition((function(e){var t;e.Id.split("_").length>1&&F()(t=e.Id).call(t,ue)&&e.Id!==r&&T.push((0,k.createUpdateAction)([[e.Id,zi(zi({},a),{},{EntityData:zi(zi({},e.EntityData),a)})]]))})),x()(A).forEach((function(e){var t;if(F()(t=e.Id).call(t,ue)){var n=A[e.Id];A[e.Id]=zi(zi({},n),a),A[e.Id].EntityData=zi(zi({},n.EntityData),a)}})))}var se=ha(r,a,v,{globalConfig:l,dataContext:o,selectionContext:i,action:c,dataFactory:u,modelFactory:f,metaReader:m});if(se&&T.push(se),_ in a){var fe=a[_],pe=m.getControlMeta(fe).ApType,me=m.getControlMeta(U).BaseType,ve=function(e,t,n,r,a){var l=n.EntityData,o=n.Id,i=p()(l).reduce((function(t,n){if(n===L)return t[n]=e,t;var r=a.getControlMetaProperty(e,n).Tag;return(r===Be||r===_e||F()(Re).call(Re,n))&&(t[n]=l[n]),t}),{}),c={};if(ut(e)){var u;ga=ua(ga);var d=a.getControlPropertyDefaultValue(e,"CustomContent"),s=null==d||null===(u=d.ops)||void 0===u?void 0:N()(u).call(u,(function(e,t){return va(va({},e),{},{Bgc:ga[t]})})),f={bgcSwitch:!0,ops:sa(s)};c.CustomContent=f,i.CustomContent=f}return null!=r&&r.Name&&(i.Name=null==r?void 0:r.Name),(0,k.createUpdateAction)([[o,va({ApType:t,_Type_:e,FieldType:e,EntityData:i},c)]])}(fe,ba(pe,me),v,a,m);T.push(ve);var ge=function(e,t,n){var r=[];if(p()(t).forEach((function(t){var a;if(!F()(Ea).call(Ea,t)){var l=n.getControlMetaProperty(e,t);l&&0!==(null===(a=p()(l))||void 0===a?void 0:a.length)||r.push(t)}})),r.length>0)return(0,k.createRemovePropAction)([null==t?void 0:t.Id,r])}(fe,v,m);ge&&T.push(ge)}})),I(A),h()(a=[c]).call(a,T)};function qi(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qi(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):qi(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Wi="1",Xi=(0,S.memo)((function(e){var t=(0,S.useReducer)((function(e){return e+1}),0),n=(0,d.c)(t,2)[1],r=(0,(0,S.useContext)(k.ConfigContext).getPrefixCls)("nocode-designer-entry"),a=(0,S.useCallback)((function(e){Wi=e,n()}),[Wi]);return D().createElement("div",{className:"".concat(r,"-modal-body")},D().createElement("div",{className:"".concat(r,"-modal-body-menu")},D().createElement("div",{className:jn()({cur:"1"===Wi}),onClick:function(){return a("1")}},D().createElement("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZgAAAEACAMAAAC50JBJAAAAZlBMVEUAAADf39/o6Oj////k5OTc3Nzd3d3y8vLi4uL////6+vrZ2dmZmZnz8/Ompqbo6Oifn5/4+PicnJz19fXU1NTCwsK4uLjj4+PGxsbb29upqamurq6ioqKxsbHu7u6+vr7Pz8/Kyso7+HZuAAAACXRSTlMA/tAL7dLNTk5icRcsAAAF4UlEQVR42uzdXW7iQBBFYWB+Mq6uxhhswDgEsv9NTpJ5yZM7zEjMreacFdTVJ9ESQmLx3tNqOSaSaFyunhZ/+rZKJNXq24fL95Ta3NlflZKFKcatXW5T+v4us0pjrnxssFvzmH68vS8p5QcYG+rWnNKvxSq1DzE21K1t+rlYpvwYYyPdmlNajKl7jLGRbu3eYFJ6kLHBbgVGMmBEA0Y0YEQDRjRgRANGNGBEA0Y0YEQDRjRgRANGtCLM6Xlntn9u6xhrYSrBvPjazDbe1THWwlSCGX1v1vqpkrEWphLM0a9mvV8qGWthKsGc/WA2eF/JWAvTHMxuGIatX4Zh7fth6GoYa2Gag1n6p56rGGthmoNp+/7ix74/+7rvxyrGWpgKb8zRs9nZh1rGWpgKMOeTWbf1vpaxFqYCzOZi1rq3tYy1MM3AdDkf/DXnq29fcq5jrIVpBubqnzrXMdbCNAPzOk0bP03T2tfTdK1jrIVp/o2ZvDW7eKpmrIVpFqbbbjuzk79UM9bCNAtz8LNZ9ud6xlqYZmGufjRb+r6esRamWZi9Lz+++K9nrIVpFuYw7sza8aWesRYmfowhGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEjGjCivcOQZMCI9gbT/EMpNWGKdSswkgEjGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEj2hdg8qGtZmwTpjJMd/J1NWObMJVh9g7M/SvDDA7M3SvDtJMDc+/KMN3R3Y8bYO5bGWZy3ywbYO5cGea0HXYNMPeuDHPNTQPMf6j8+APz5YABBphbAgYYYG4JGGCAuSVggAHmloABBphbuj9MzrtqxjZh4lcyogEjGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEjGn9TIhswovFRJhkwogEjGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEjGjCiASMaMKIBIxowogEj2u/27m03bSiIwrBdkjTjvXw2NhAD8fu/ZB3c9nLvSJXcmWF917nw0q8AQkiTClPcpvzmZ6yYEQ/TLg1W3VI4GStmRMP0FX67FD7GihnRMBdgrKUPM3DyMVbMiIXJgVG+1MDsY6yYEQszAqU8VEDpYqyYEQsj9SCbD6B2MVbM2MIktA3/Y5L+R5gjMPoYK2Z8J8wCdLWPsWLGN8IcgW5yMlbMSIYpP4C59jJWzEiFuVXA2LoZK2YkwtQzcHI0VsyIh5kadMHTWDEjGqZcu0yuxooZ0TBXYPA1VsyIhfkExvKPwsVYMSMSpu/wF78rS9ovzA0M82/4YwyXz8owKjGMUgyjFMMoxTBKMYxSDKMUwyjFMEoxjFIMoxTDKMUwSjGMUgyjFMMoxTBKMYxSDKMUwyjFMyVqMYxSfClTiWGUYhilGEYphlGKYZRiGKUYRimGUYphlGIYpRhGKYZRimGUYhilGEYphlGKYZRiGKUYRimGUSoVpqh5P2Z36TD9qcGqWVonY8WM5P2Y7tLwfsy+0mE+gGMhRX7h/Zi0HcPUwHX7I6DyMVbMiIUJFc7ypWiA3sVYMSPx5l/IQ4fOx1gxYwuTkPNMyX6+H6YYGlSlj7FiRirM6TID3bF3MlbMSIW5Y1UtDJO0c5hpGE5XYObFpZ1tYRKmDnPrYqyYsYVJWYDBxVgxIx6mlE0O3F2MFTNiYe4zWnkYgJOLsWJGNAzwKQ8jcHYxVsyIham77RBWsQAV3/wTdgwjAUA1XhseKN1Z+njcFV+6e+lkrJiR+rhcTiG/FW7Gihn8lYxSDKMUwyjFMEoxjFIMoxTDKMUwSjGMUgyjFMMoxTBKMYxSDKPUGubMMAqtYfLQPs1YsaJdw/wI9XOMtfSsdXjLfp5D/xRjDT1rH8J7lv0Ief8EYw09a5+H1yzLDi8h1K33sXaeta1DeDlkq8NrIFVeD9nm/S2QGm/v2eoXDlT1L9hoSkAAAAAASUVORK5CYII="}),D().createElement("p",null,"添加空白表格")),D().createElement("div",{className:jn()({cur:"2"===Wi}),onClick:function(){return a("2")}},D().createElement("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZgAAAEACAMAAAC50JBJAAAAb1BMVEUAAADi4uLo6Ojd3d3////y8vLi4uL////6+vrZ2dmZmZm1tbX4+PidnZ3Nzc2wsLDAwMCrq6u5ubnS0tLw8PDl5eW9vb2oqKilpaXExMTKysrt7e3r6+vz8/OioqKfn5/19fXi4uLU1NTe3t7o6OiHDuK7AAAAB3RSTlMA89DQC05Omgim0gAAB5ZJREFUeNrs2t1u2kAQhmGgSfvt5/W/E4PLUgf7/q+xkFZKjkqcTrSzZt6DiDlAmtGjYA7YXHvcbZ2lpO3ucfOnh52zVLV7eHXZOjcHj0/lHJIpjV19mJ3bXmV2bgorPzaxXcPkvl2eL86FOzg2qV2Dc983OzffxbFJ7Tpf/mW2LtzHsSntGpzbOOfv49iUdvWvMHdybGK7GozKDEZpBqM0g1GawSjNYJRmMEozGKUZjNIMRmkGozSDUZrBKO0mTH0ageb0tI5jkUy3YDruAeT06zgWyXQLxrEBjqxXciyS6RbMgQVwZrWSY5FMt2AyPgEVzys5Fsn0L5ixqqqclz97NlXlP3psyMpsxDXflOUsOMrDRNhGAGbiu04fPhYFWb29EBzFYSJsIwEzt+0zD21bsm/bacHHQ0ZOAI5k7QVHeZgI2wg9Yw4MQMlq2bHhxP0I1MyPkqM4TIRtpGDKHvA5z8uOxURWKMiz5CgOE2EbMZj8GZjJeeGxOJBtzkZyFIeJsI0MjO+6Fw5dVzDvurDsWF+T7EfBUR4mwjYyMAXfVS47FhnJ0guO8jARtpGBGer6F/u63nNf18WyYweyISvBUR4mwjZiz5iaM/BM94kHaoaKdIKjPEyEbYRgPHMP9Py58NhjzlOAr5nPgqM8TIRtZGCeWAKBp4XHjj35AmAm+yA4ysNE2EYEpuABmNgsPLYhh7/vZyY4ysNE2EYEpuEEDCyWHTu8fW0pyUFwlIeJsI0EzMs0AvPULTvWX3r3UnCUh/mibezHGGve1WBUZjBKMxilGYzSDEZpBqM0g1GawSjNYJRmMEozGKUZjNIMRmkGozSDUZrBKM1glGYwSjMYpV1hLJUZjNIuMD/+o8u7kymtXQ1GZQajNINRmsEozWCUZjBKMxilGYzSDEZpBvObXTPITRgIguCxTa9tMGCMAw6Q/P+PUSJFHMmoo9kBTd3q1qu6jTYoGSYoGSYoGSYoGSYoGSYoGSYoGSYoGSYoGSYoGSYofwiz3MaXeSyehsdh2onHl3ksnobHYQozjAG3MDMzjAGvMOeBGcaAU5h2JjlfMowBlzBr8vIJa5i2lNLgh0MpZ5NCR9nqpmKYqZuvMIfBjtzgm57cGFVH2OqnYph+AWAPg0KOAPYdh8aoOsJWN1XC3LGHad95bIA1u71VdYStblorDEZygx25MquOsNVL64XBG/nR8WBXHWGrk9YMgzXJqbGrjrDVR+uG2ZJcw646wlYfrRqmJw/kbFcdYauP1gxzIwtmcmVWHWGrk9YLs7/w2KIZ2J2sqiNs9dJaYZqBHAGcOk6tUXWErW5aKcyW7H/vHVuj6ghb3bROmJ4s93tHb1LoKFvd9F/CLMv1ZU7peBryl0xQMkxQMkxQMkxQMkxQMkxQvti7YxoAAAAGYf5dY4OjtUCyd8JMCTMlzJQwU8JMCTMlzJQwU8JMCTMlzJQwU8JMCTPlpmRLmClTtiTMlDBTwkwJMyXMlDBTwkwJMyXMlDBTwkwJMyXMlDBTwkwJMyXMlDBTwkwJM1V795acNhAFYRgHx6NpJBsbMBcjEJb2v8ZI5ILzwOghxaTPof8VnKkv8a1c7jGYYnlql34eG8yUhil3R/RVu8LJY4OZkjDNGr96LXw8NpgpCfMKvH2EJh6ArY/HBjOlYNreJQytgIOPxwYzpWDegGU4twGWLh4bzJSCCd3i8ie29y42WfLdmuX7mPII1C42WfLdmgVmDsx8bLJkuzULzA6o9j42WbLdmgNmDuDkZJMl160ZYOpX4LDyssmS6dYMMMsNMCvdbLLkuTUDzP4IbB1tsoRL//2af4FZVaiip02WPLfeHKY+AidXmyyZbs2wHLvwtcmS69bbwjwDs/p3hYtNlmy33hKmwddWLjZZst16S5jl3zAuNlny3apfxnB7q2AoEwxpgiFNMKQJhjTBkCYY0gRDmmBIEwxpgiFNMKQJhjTBkCYY0gRDmmBIEwxpgiFNMKRppoQ2wZCmD2WUCYY0wZAmGNIEQ5pgSBMMaYIhTTCkCYY0wZAmGNIEQ5pgSBMMaYIhTTCkCYY0wZAmGNIEQ9oYTPGh/ZjsjcM02wp91a508thgptH9mGpdaT8me+P7MfMiFO1a+zGZS8N0wCwMRWDj47HBTCmYuEYbhooKaFw8Nphp5JN/Ec5VgI9NFku3foVJbGL52GSxdOsoTLGosKl9bLJYujUNs10fgWreONlksXRrGuYdfevnxskmi6Vb0zCrz8XuBTisfGyyWLr1ApMaxTiULjZZLN2ahrn8S3CxyWLp1hRMffl6ee5ik8XSrddh3g8ow7lPYOtik8XSrddh5n+2A2ZA62KTxdKt12H2+Ilf7IBN6WKTxdKt12FCBLCZzY5A1fnYZLF0awImnF5wbl472WSxdGsCpq9exfajcPOj9GAm/ZYMaYIhTTCkCYY0wZAmGNIEQ5pgSBMMaYIhTTCkCYY0wZAmGNJ6mFYwhPUwD7G8m8cGK5U9zLfY3cdjLd3axenke4zNXTzW0K1NjE+T/r9M29zBYw3d2rRxOplMHh9i7Ervj7Vza9nF+PA4GWSmUVE1HVyGnkRD1PRpMPkBXitvH6PdbmgAAAAASUVORK5CYII="}),D().createElement("p",null,"添加已有表单"))))})),Zi=function(e){w.Modal.confirm({title:"添加表格",width:480,height:304,className:"nocode-designer-entry-modal",showline:!0,maskClosable:!1,titleIcon:null,body:D().createElement(Xi,null),okButtonProps:{size:"small"},cancelButtonProps:{size:"small"},bodyStyle:{padding:24},destroyOnClose:!0,onOk:function(){return function(e){var t=e.dataContext,n=e.dataFactory,r=e.action,a=e.metaReader,l=e.handleConfig,o=l.controlCacheApi,i=l.getHideFieldRef,c=l.setHideFieldRef,u=(r||{}).value,d=Ia(n({type:ze,parentId:u.ParentId,transferData:{Name:"表格",Id:(0,k.createUUid)(3),Key:"nc_".concat((0,k.createUUid)().toLowerCase()),SourceForm:Wi,ShowType:"2",Multi:"1",DataRange:{max:"100",min:"0"}}}),{dataContext:t,metaReader:a}),f=Ia(n({type:"NoCodeMulRefBillField",parentId:u.ParentId,transferData:{Name:"表格",Key:"nc_".concat((0,k.createUUid)().toLowerCase()),SourceForm:Wi,ShowType:"2",Multi:"1",DataRange:{max:"100",min:"0"}}}),{dataContext:t,metaReader:a});d.RefBillId=f.Id,d.EntityData.RefBillId=f.Id,f.RefTableId=d.Id,f.EntityData.RefTableId=d.Id;var p=[(0,k.createAddAction)([d])];o.addCache("controlId",d.Id),c(Yi(Yi({},i()),{},(0,s.c)({},f.Id,f))),t.batchActions(p),setTimeout((function(){return l.selection.setSelect([d.Id])}),300)}(e)}})},Qi=["type","value"];function Ji(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function $i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ji(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Ji(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var ec=function(e,t,n,r){var a=e.globalConfig,l=e.dataContext,o=e.selectionContext,i=e.action,c=e.dataFactory,u=(e.modelFactory,e.metaReader),d=l.getRootId(),f=i.type,p=i.value,m=(0,Ce.c)(i,Qi),g=a.showMessage,y=Ft(p),C=r.dispatchBillData,E=r.billPropsData,b=r.getHideFieldRef,I=r.setHideFieldRef,N=o.getSelection(),T=[],x=[],A=b();if(ot(p._Type_))return Zi({dataContext:l,dataFactory:c,action:i,metaReader:u,handleConfig:r}),n("自定义插入关联表单表格事件"),!1;var S=setTimeout((function(){if(1===y.length){var e=l.getParentControl(y[0].Id),t=l.findControl(N[0]);ot(null==e?void 0:e[L])&&ot(null==t?void 0:t[L])||k.eventBus.emit("add-control-id",y[0].Id)}clearTimeout(S),S=null}),0),D=l.getData(),M=y.reduce((function(e,t){var r,a,o,c=t,f=c._Type_,p=(c.Id,c.ParentId);if(ct(f)&&p===d){var m,y=xe()(m=D[G]).call(m,(function(e){return e[L]===Ve}));if(y)t[U]=y[B];else{var b=(0,k.createUUid)(),I=u.getControlMeta(Ve);T.push((0,s.c)((0,s.c)((0,s.c)((0,s.c)((0,s.c)({},U,d),L,Ve),B,b),"_Root_",!0),"Name",null==I?void 0:I.Name)),t[U]=b}}var S=u.getControlMeta(f).Name,M=l.findControl(t[U]),w=M||{},R=w._Type_,_=w.Status;if(tt(f)&&!ot(R)){var O=l.findControlByCondition((function(e){return e._Type_===f}));v()(O).call(O,(function(e){var t=l.findControl(e.ParentId);return!ot(t._Type_)})).length>0&&(g("".concat(S,"只能在画布中添加一次")),n("".concat(S,"只能在画布中添加一次")))}if(!t||null!==(r=t)&&void 0!==r&&r.FieldName||null!==(a=t)&&void 0!==a&&a.StartDateFieldName||(t=Ia(t,{dataContext:l,metaReader:u})),ot(R)){var j,K,V,z=$i($i({},u.getDefaultData(R)),M)||{},H=z.BillEntityIdEx,q=z.SourceForm,Y=z.PropsDisplay,W=z.RefBillId,X=z.EntityData;if(!H&&"2"===q)return n("请先选择需要关联的表单"),!1;if(H&&(null==E||!E[H]))return g("数据加载中，请稍后"),n("数据加载中，请稍后"),!1;if(t.Key=null!==(j=t)&&void 0!==j&&j.Key?t.Key.toLowerCase():"nc_".concat((0,k.createUUid)().toLowerCase()),null===(K=t)||void 0===K||null===(K=K.Key)||void 0===K||!F()(K).call(K,p.toLowerCase())){if(!xa(M,(null==E?void 0:E.innerForm)||[]))return g("应用外表单无法编辑"),n("应用外表单无法编辑"),!1;if((null==M?void 0:M.BillEntityIdEx)===d)return g("表格为当前表单时无法编辑"),n("表格为当前表单时无法编辑"),!1;t.EntityData=$i($i({},t.EntityData),{},{Key:t.Key});var Z=H||"1"!==q?H:p+"_table",Q=N[N.length-1],J=t[U]===Q,$={form:Z,data:$i({},t)};if(C({key:zr,payload:$}),!J)$.prevId=Q.replace("_".concat(p),""),V=(l.findControl(Q)||{}).Key.toLowerCase().replace("_".concat(p.toLowerCase()),"");if(i.index>0){var ee=l.getData().Items;ee[i.index-1]&&(V=ee[i.index-1].Key.toLowerCase().replace("_".concat(p.toLowerCase()),""))}t=Ra(t,p)}_&&(t.Status=_);var te=t.Key.toLowerCase().replace("_".concat(p.toLowerCase()),""),ne=function(e,t,n){var r=e?e.split(","):[],a=Array.isArray(t)?t:[t];if(n){var l,o,i=Kr()(r).call(r,(function(e){return e===n}));i>-1?ce()(l=r).apply(l,h()(o=[i+1,0]).call(o,(0,P.c)(a))):r=h()(r).call(r,a)}else r=h()(r).call(r,a);return r.join()}(Y,Qe(t._Type_)?["".concat(te,"_startdate"),"".concat(te,"_enddate")]:te,V);A[W].PropsDisplay=ne,A[W].EntityData.PropsDisplay=ne,x.push((0,k.createUpdateAction)([[p,{PropsDisplay:ne}],[p,{EntityData:$i($i({},X),{},{PropsDisplay:ne})}]]))}return Kt(f)&&!t.GroupParentId&&(t.GroupParentId=(0,k.createUUid)(),t.GroupIndex=0),h()(o=[]).call(o,(0,P.c)(e),[t])}),[]),w=[$i({type:f,value:h()(M).call(M,T)},m)];return I(A),h()(w).call(w,x)},tc=function(e,t,n,r){e.globalConfig;var a=e.dataContext,l=(e.selectionContext,e.action),o=(e.dataFactory,e.modelFactory,e.metaReader,[l]),i=[],c=l.value;return(Array.isArray(c)?c:[c]).forEach((function(e){var t=a.findControl(e)||{},n=t._Type_;if(Kt(n)){var r=t.GroupIndex,l=t.GroupParentId;if(0===Number(r)){var o=a.findControlByCondition((function(e){return Kt(e._Type_)&&e.GroupParentId===l&&void 0!==e.GroupIndex&&0!==Number(e.GroupIndex)}));o.length&&i.push((0,k.createDeleteAction)(N()(o).call(o,(function(e){return e.Id}))))}}})),h()(o).call(o,i)};function nc(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function rc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nc(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):nc(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var ac=[Ke],lc=function(e,t,n,r){var a,l=e.globalConfig,o=e.dataContext,i=(e.selectionContext,e.action),c=(e.dataFactory,e.modelFactory,e.metaReader),u=(r.billPropsData,r.getHideFieldRef),d=r.setHideFieldRef,s=l.showMessage,f=i.type,p=i.value,m=p,v=p.origin,g=p.target,y=p.isPrev,C=p.dropPosition,E=g,b=Array.isArray(v)?v:[v],I=o.getData().Items,T=o.getRootId(),x=b[0],A=T,S=[],D={},M=!1,w=I.length,R=C&&0!==C,O=o.findControl(E),j=o.getParentControl(E)||{},K=o.getParentControl(x);if(ot(j._Type_)&&ot(K._Type_)&&O._isEntryField_){if(K.Id!==j.Id)return s("表格内容无法移动到其它表格");var V=j||{},G=V.EntityData,z=V.RefBillId,H=o.findControl(Array.isArray(v)?v:[v]),q=o.getAllSiblings(E).reduce((function(e,t){var n,r,a;return F()(v).call(v,t.Id)?e:t.Id===E?y?h()(r=[]).call(r,(0,P.c)(e),(0,P.c)(H),[t]):h()(a=[]).call(a,(0,P.c)(e),[t],(0,P.c)(H)):h()(n=[]).call(n,(0,P.c)(e),[t])}),[]),Y=N()(q).call(q,(function(e){var t,n="".concat(e.Key.toLowerCase().replace("_".concat(e.ParentId.toLowerCase()),""));return Qe(e._Type_)?h()(t="".concat(n,"_startdate,")).call(t,n,"_enddate"):n}),[]).join();S.push((0,k.createUpdateAction)([[O.ParentId,{PropsDisplay:Y}],[O.ParentId,{EntityData:rc(rc({},G),{},{PropsDisplay:Y})}]]));var W=u(),X=(null==W?void 0:W[z])||{},Z=rc(rc({},null==X?void 0:X.EntityData),{},{PropsDisplay:Y});W[z]=rc(rc({},X),{},{PropsDisplay:Y,EntityData:Z}),d(W)}if(y){var Q=o.findControl(E),J=Q[L];Q[U];if(!c.getControlMeta(J).IsContainer||R)((o.getPrevSibling(E)||{}).control||{})[B]||(M=!0)}for(var $=0,ee=-1,te=function(){var e=I[$],t=e[B];if(t===E){D=e,ee=$;var n=e[L],r=e[U],a=c.getControlMeta(n).IsContainer;if(y){if(ee=ee<=0?0:ee-1,A=r,a&&(A=t),R&&(A=r),M){var l=o.getSubControls(A);ee=(ee=o.findControlIndex(l[0][B])-1)<0?$:ee}return $=w,1}if(r&&!a||R)A=r;else if(a){A=e[B];var i=o.getSubControls(t),u=i.length;u>0&&(ee=Kr()(I).call(I,(function(e){var t;return e[B]===(null===(t=i[u-1])||void 0===t?void 0:t[B])})))}$=w}else $++};$<w&&!te(););D[L];var ne=o.findControl(A)||{},re=o.findControl(x),ae=re.ApType,le=ne[L],oe=re[_]||re[L],ie=re.ParentId,ce=re.EntityData,ue=re._isEntryField_,de=re.GroupIndex,se=re.GroupParentId,fe=o.findControl(ie);(fe||{})._Type_;if(le===Ue&&F()(ac).call(ac,oe))return s("控件类型不符合，不能添加。");var pe=c.canAdd(oe,le);if(!("object"!==(0,he.c)(pe)||pe.success||ot(le)&&tt(oe)))return s(pe.message);if(1===b.length&&Kt(oe)&&void 0!==de&&se){var me=o.findControlByCondition((function(e){return e.GroupParentId===se&&e.Id!==x}));if(me.length>0&&(S.push((0,k.createUpdateAction)([[x,{GroupIndex:0,GroupParentId:(0,k.createUUid)()}]])),0===Number(de))){var ve=N()(me).call(me,(function(e,t){return[e.Id,{GroupIndex:t}]}));S.push((0,k.createUpdateAction)(ve))}}if(ct(oe)&&(y?ee+=1:ee-=1),m=rc(rc({},m),{},{origin:b,targetIndex:ee,targetParentId:A}),(lt(le)||ot(le))&&!ue)return s("表格之外的内容无法移动到表格内");if((!lt(le)||!ot(le)||!Kt(le))&&ue&&fe.Id!==ne.Id)return s("表格的内容无法移动到表格之外");if(ae){var ge=c.getControlMeta(oe).ApType,ye=c.getControlMeta(le).BaseType,Ce=ba(ge,ye);ae!==Ce&&S.push((0,k.createUpdateAction)([[x,{ApType:Ce}]]))}return ie!==A&&ce&&S.push((0,k.createUpdateAction)([[x,{EntityData:rc(rc({},ce),{},{ParentId:A})}]])),h()(a=[{type:f,value:m}]).call(a,S)},oc=["globalConfig","dataContext","selectionContext","action","dataFactory","modelFactory","metaReader"],ic=["type","value"];function cc(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function uc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cc(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):cc(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var dc=function(e,t,n,r){var a=e.globalConfig,l=e.dataContext,o=(e.selectionContext,e.action),i=(e.dataFactory,e.modelFactory,e.metaReader),c=((0,Ce.c)(e,oc),o.type),u=o.value,d=(0,Ce.c)(o,ic),s=Ft(u),f=a.showMessage,p=r.controlCacheApi,m=v()(s).call(s,(function(e){var t=e._Type_,n=e._isEntryField_,r=l.findControl(e.ParentId);if(r){var a=r._Type_,o=i.canAdd(t,r);return"object"!==(0,he.c)(o)||o.success?!lt(a)&&n?(f("父容器控件类型不符合，不能添加。"),!1):!(lt(a)&&!n)||(f("父容器控件类型不符合，不能添加。"),!1):(f(o.message),!1)}return!1})),g=N()(m).call(m,(function(e){return e.Id}));s=N()(s).call(s,(function(e){if(F()(g).call(g,e.Id)){var t=e._Type_,n=e.ApType,r=(e.NoCodeDefValue,e.DateRangeDefValue,uc({},e)),a=l.findControl(e.ParentId)._Type_;if(n){var o=i.getControlMeta(t).ApType,c=i.getControlMeta(a).BaseType;r.ApType=ba(o,c)}return r}return e}));var y=function e(t){var n,r=[];(n=r).push.apply(n,(0,P.c)(v()(s).call(s,(function(e){return F()(t).call(t,e.Id)}))));var a=v()(s).call(s,(function(e){return F()(t).call(t,e.ParentId)}));a.length>0&&(r=N()(a).call(a,(function(e){return e.Id})).reduce((function(t,n){var r;return h()(r=[]).call(r,(0,P.c)(t),(0,P.c)(e([n])))}),r));return r}(g);setTimeout((function(){1===g.length&&k.eventBus.emit("add-control-id",g[0])}),0),p.addCache("controlId",g[0]);var C=[uc({type:c,value:y},d)];return v()(C).call(C,(function(e){var t;return 0!==(null===(t=e.value)||void 0===t?void 0:t.length)}))},sc=["type","value"],fc=(0,s.c)((0,s.c)((0,s.c)((0,s.c)((0,s.c)({},k.ActionType.ADD,ec),k.ActionType.UPDATE,Hi),k.ActionType.DELETE,tc),k.ActionType.DRAG,lc),k.ActionType.PASTE,dc),pc={NoCodeCreatorField:"nocodecreatorfield",NoCodeCreateDateField:"nocodecreatedatefield",NoCodeModifierField:"nocodemodifierfield",NoCodeModifyDateField:"nocodemodifydatefield",NoCodeBillNoField:"nocodebillnofield"},mc=function(e,t){var n=e.action,r=e.dataContext,a=e.selectionContext,l=e.globalConfig,o=e.dataFactory,i=e.modelFactory,c=e.metaReader,u=e.success,d=e.fail,s=(l.dataRef,l.keywordMapping),f=[],p=function(e){var n=[],r=t.controlCacheApi;return jr().all(N()(e).call(e,(function(e){var t=e.type,n=e.value;(0,Ce.c)(e,sc);if(t===k.ActionType.ADD||t===k.ActionType.PASTE){var a=Ft(n);return jr().all(N()(a).call(a,(function(e){var t,n=pc[e[s.type]];n?null!=e&&null!==(t=e.Key)&&void 0!==t&&F()(t).call(t,e.ParentId.toLowerCase())||(e[s.key]=n):e[s.key]=e[s.key]||"nc_".concat((0,k.createUUid)().toLowerCase());return r.addCache("controlId",e.Id),e}))).then((function(t){return e.value=t,e}))}return jr().resolve(e)}))).then((function(e){return u(h()(e).call(e,n))}))},m=n.type,v=fc[m];if(v){var g=v({globalConfig:l,dataContext:r,selectionContext:a,action:n,dataFactory:o,modelFactory:i,metaReader:c},p,d,t);g&&f.push.apply(f,(0,P.c)(g))}else f.push(n);f.length&&p(f)},vc="none",gc=function(e){var t,n,r=e.handleChange,a=e.value,l=e.className,o=e.editor,i=e.locked,c=e.Name,u=e.Tips,d=o.Enum,s=o.NameHidden,f=o.Default,p=o.Required,m=o.Title,g=N()(t=v()(d).call(d,(function(e){return e.Id!==vc}))).call(t,(function(e){return(0,R.c)({},e,{Value:e.Value||e.Id})})),y=(0,Se.isUndefined)(a)?f||(null===(n=g[0])||void 0===n?void 0:n.Value):String(a),C=y===vc;return D().createElement("div",{className:"".concat(l,"-switch-select")},D().createElement("div",{className:"".concat(l,"-switch-wrap")},D().createElement(k.NameTipWrapper,{nameHidden:s,className:l,name:c,tips:u,required:p,title:m}),D().createElement(w.Switch,{checked:y!==vc,size:"large",disabled:i,onClick:function(){return function(){if(!i){var e=y!==vc?vc:g[0].Value||"";r(e)}}()}})),D().createElement("div",{className:jn()("".concat(l,"-tab-wrap"),{"is-hidden":C})},N()(g).call(g,(function(e){return D().createElement("div",{key:e.Value,className:jn()(["".concat(l,"-tab-item"),{"is-active":y===e.Value}]),onClick:function(){return t=e.Value,void r(t);var t}},e.Name)}))))},yc=function(e,t){if(!t)return!0;var n=(t||{}).formId,r=void 0===n?"":n;return e.formId===r},Cc=function(e){e.id;var t=e.formId,n=e.enableListener,r=void 0===n?yc:n,a=e.eventName,l=e.parser,o=e.defaultValue,i=void 0===o?{}:o,c=(0,S.useState)(i),u=(0,d.c)(c,2),s=u[0],f=u[1],p=(0,S.useCallback)((function(e){var n=e.args;if(null==r?void 0:r({formId:t},n)){var a="function"==typeof l?l(e):function(e){var t=e.data,n=e.args;return{data:t.rows,param:n.param}}(e);f(a)}}),[f,l,t,r]);return(0,S.useEffect)((function(){return k.eventBus.on(a,p),function(){k.eventBus.off(a,p)}}),[a,t,p]),s},hc=function(e){var t=e.api,n=e.parser,r=t.isVersionEqual,a=t.getData,l=(0,S.useState)((function(){return r()?n(a()):[]})),o=(0,d.c)(l,2),i=o[0],c=o[1],u=(0,S.useCallback)((function(e){var t=e.value,r=n(t);c(r)}),[]);return(0,S.useEffect)((function(){var e=t.addDataChangeListener(u);return function(){e()}}),[]),i};function Ec(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function bc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ec(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Ec(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Ic=Un.treeUtils.dfs,Nc=function(e,t){var n=t.type,r=t.data;return Tc[n]?Tc[n](e,r):e},Tc={updateRelationFormId:function(e,t){return bc(bc({},e),{},{relationFormId:t})},updateFilterInfos:function(e,t){return bc(bc({},e),{},{filterInfos:t})},updateSortInfos:function(e,t){return bc(bc({},e),{},{sortInfos:t})},updateResult:function(e,t){return bc(bc({},e),{},{result:t})},updateState:function(e,t){return t}},xc=function(e){var t=w.Form.useForm(),n=(0,d.c)(t,1)[0],r=e.visible,a=e.onClose,l=e.invokeActions,o=e.queryFormValue,i=e.refBillData,c=e.onConfirm,u=e.field,f=e.compareTypesMap,p=e.formId,m=(0,S.useContext)(le),g=m.prefixCls,y=m.baseUrl,C=m.onDownLoad,h=m.getControlText,E=m.batchInvoke,b=m.getKdesignerApi,I=m.curListTreeApi,T=m.fetchListTree,x=(0,S.useState)(r),A=(0,d.c)(x,2),F=A[0],M=A[1],P=(0,S.useState)({}),R=(0,d.c)(P,2),B=R[0],_=R[1],O=(0,S.useReducer)(Nc,o),j=(0,d.c)(O,2),L=j[0],K=j[1],V=u.Key,U=b(),G=U.data,z=U.meta,H=G.getRootId(),q=(0,S.useState)({}),Y=(0,d.c)(q,2),W=Y[0],X=Y[1],Z=(0,S.useRef)(),Q={baseUrl:y,batchInvoke:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];E(e,u.Key,t,n)},getControlText:h,addControlAction:function(e,t){k.eventBus.on(e,t)},onDownLoad:C,batchInvokeListConfig:function(e){E("listconfig","nocodeformdesigner",[e])},batchInvokeQuery:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=v()(t),r=void 0===n?"":n,a=t.search,l=void 0===a?"":a,o=t.order_by,i=void 0===o?"":o,c=t.select,u=void 0===c?"":c,d=t.page_size,s=void 0===d?10:d,f=t.page_no,p=void 0===f?1:f,m=t.ids;E("query","nocodeformdesigner",[e,{filter:r,search:l,order_by:i,select:u,page_size:s,page_no:p,ids:void 0===m?[]:m}])}},J=Cc({id:V,formId:L.relationFormId,eventName:"setListTreeConfig",parser:function(e){var t=e.data;return $t(t,t,f)},defaultValue:[]}),$=hc({api:I,parser:function(e){return $t(e,e,f)}}),ee=(0,S.useMemo)((function(){return L.relationFormId?L.relationFormId===p?$:J:[]}),[L.relationFormId,p,$,J]),te=(0,S.useMemo)((function(){var e=G.findControl(H);return[{key:e.Key,title:e.Name,selectable:!1,children:ui({metaApi:z,options:$})}]}),[$,H]),ne=Cc({id:V,formId:L.relationFormId,eventName:"filterItemLook"}),re=(0,S.useMemo)((function(){var e;return Array.isArray(L.filterInfos)?N()(e=L.filterInfos).call(e,(function(e){return bc(bc({},e),{},{value:"string"==typeof e.value?JSON.parse(e.value):e.value||[]})})):[]}),[L.filterInfos]);(0,S.useEffect)((function(){var e=ne.data,t=ne.param,n=(void 0===t?{}:t).enumField;if(n){var r=null==re?void 0:v()(re).call(re,(function(e){return e.fieldName===n})),a=Ic(ee,(function(e){return e.key===n}));_((function(t){return bc(bc({},t),{},(0,s.c)({},n,{configuredFilter:{enumEqCompareType:"001",items:r},fieldFilterConfig:a,groupInfo:e}))}))}}),[ne,re,ee]);(0,S.useEffect)((function(){F&&L.relationFormId&&l.invokeGetListConfig(L.relationFormId)}),[L.relationFormId,F]),(0,S.useEffect)((function(){F&&T()}),[F]),(0,S.useEffect)((function(){M(r)}),[r]);var ae=function(){M(!1),null==a||a()},oe=function(){return new(jr())((function(e,t){n.validateFields().then((function(t){var n=Ni()(t);e(n)})).catch((function(e){return t(e)}))}))},ie=D().createElement(w.ConfigProvider,{value:{prefixCls:"kd"}},D().createElement(w.Form,{layout:"vertical",form:n,labelWidth:"100%",wrapperWidth:"100%",onValuesChange:function(e,t){}},D().createElement(Un.BillQuickFinder,{ref:Z,refBillData:i,validData:W,configuredFilterItems:re,listFilterConfig:ee||[],onGetFieldRecords:function(e){l.invokeGetFieldRecords(L.relationFormId,e.fieldName)},fieldRecords:B||{},variablesTree:te,field:u,onFilterChange:function(e){K({type:"updateFilterInfos",data:e})},relationFormId:L.relationFormId,result:L.result,sortInfos:L.sortInfos,onSortChange:function(e){K({type:"updateSortInfos",data:e})},onRelationFormChange:function(e){X({relationForm:!e}),K({type:"updateRelationFormId",data:e})},onResultChange:function(e){K({type:"updateResult",data:e})},refBillProps:Q})));return D().createElement(w.Modal,{visible:F,className:"".concat(g,"-def-editor-modal"),body:ie,bodyClassName:"".concat(g,"-def-editor-modal-body"),width:640,maskClosable:!1,destroyOnClose:!0,closable:!0,onCancel:ae,title:"查找表单记录",footer:D().createElement("div",null,D().createElement(w.Button,{size:"small",style:{marginRight:"12px"},onClick:ae},"取消"),D().createElement(w.Button,{size:"small",type:"primary",onClick:function(){oe().then((function(e){var t,n;if(!(null===(t=(n=Z.current).updateVerifyAndGetMsg)||void 0===t?void 0:t.call(n)).length){var r={valueType:2,value:L};if(!L.relationFormId)return void X({relationForm:!0});l.invokeSaveBizRule(r),null==c||c(r)}})).catch((function(e){}))}},"确定"))})};function Ac(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ac(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Ac(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Sc=Un.Condition.constants,Dc=Sc.allFieldRegExp,kc=Sc.allExpRegExp,Mc={textDef:[0,1,2],decimalDef:[0,1,2],richEditorDef:[0,1],geoDef:[0,1],addressDef:[0,1],selectDef:[0,1,2],refBillDef:[0,1],dateRangeDef:[0,1],dateDef:[0,1,2],imageDef:[0,1],attachmentDef:[0,1],groupContainerDef:[],entryEntityDef:[],graphicDisplay:[]},wc=[{label:"查找表单记录",key:"search",id:1,icon:"chazhaobiaodanjilu-xian"},{label:"运算公式",key:"formula",id:2,icon:"yunsuangongshi"}],Pc={valueType:2,value:{relationFormId:"",filterInfos:[],sortInfos:[],result:[]}},Rc={valueType:0,value:""},Bc=function(e){var t,n=e.handleChange,r=e.value,a=e.className,l=e.locked,o=e.Editor,i=e.Name,c=e.Tips,u=e.field,s=(e.id,e.propName,e.inputFieldProps),f=e.editorType,p=e.getRenderValue,m=o.NameHidden,g=o.Required,y=o.minPlaceholder,C=void 0===y?"请输入":y,E=(o.maxPlaceholder,o.Title),b=(0,S.useContext)(le),I=b.prefixCls,T=b.invokeAction,A=b.getKdesignerApi,M=b.getExpressionData,P=b.getRefBillData,R=b.getDataRef,B=b.getCompareTypes,_=(0,S.useState)(!1),O=(0,d.c)(_,2),j=O[0],L=O[1],K=(0,S.useState)(!1),V=(0,d.c)(K,2),U=V[0],G=V[1],z=(0,S.useState)(null),H=(0,d.c)(z,2),q=(H[0],H[1],(0,S.useState)(null)),Y=(0,d.c)(q,2),W=Y[0],X=Y[1],Z=A(),Q=Z.data,J=Z.meta,$=B(),ee=Q.getRootId(),te=u.ParentId,ne=Q.findControl(te)._Type_,re=(0,S.useState)(r),ae=(0,d.c)(re,2),oe=ae[0],ie=ae[1],ce=(0,S.useState)(!1),ue=(0,d.c)(ce,2),de=ue[0],se=ue[1],fe=(0,S.useReducer)((function(e){return e+1}),0),pe=(0,d.c)(fe,2),me=(pe[0],pe[1]),ve=(0,S.useRef)(null),ge=(0,S.useRef)(null);(0,S.useEffect)((function(){var e=Q.addDataChangeListener((function(){me()}));return function(){e()}}),[]),(0,S.useEffect)((function(){(0,Se.isEqual)(oe,r)||ie(r)}),[r]);var ye=(0,k.useDebounce)(n),Ce=R(),he=Cc({id:u.Key,eventName:"setDefValueForQueryForm",parser:function(e){return{data:e.bizRule,param:{}}}}).data,Ee=function(e,t){try{if(e&&"string"==typeof e){var n=JSON.parse(e);return n.valueType===t?n.value:""}if("dateRangeDef"===f){var r=e.start,a=e.end,l=r&&"string"==typeof r&&JSON.parse(r),o=a&&"string"==typeof a&&JSON.parse(a);if(0===t)return{start:(null==l?void 0:l.valueType)===t?null==l?void 0:l.value:"",end:(null==o?void 0:o.valueType)===t?null==o?void 0:o.value:""};if(2===t)return(null==l?void 0:l.valueType)===t?null==l?void 0:l.value:""}}catch(e){}},be=(0,S.useMemo)((function(){try{return"string"==typeof he?Ee(he,2):null==he?void 0:he.value}catch(e){}}),[he]),Ie=(0,S.useMemo)((function(){return M()}),[M]),Ne=(0,S.useMemo)((function(){return P()}),[P]);(0,S.useEffect)((function(){return k.eventBus.on(fr,Xe),function(){k.eventBus.off(fr,Xe)}}),[]);var Te=(0,S.useMemo)((function(){return Q.findControlByCondition((function(e){var t=e._Type_,n=e.ParentId,r=(n&&Q.findControl(n)||{})._Type_;return!lt(r)&&!lt(t)}))}),[]);(0,S.useEffect)((function(){var e=ii(Te,J,!1);X(e)}),[Te]);var Ae,Fe,De=(Ae=Ie.functionOperations,x()(Ae)),ke=(Fe=Mc[f],null==wc?void 0:v()(wc).call(wc,(function(e){return null==Fe?void 0:F()(Fe).call(Fe,e.id)}))),Me=function(e){e.stopPropagation(),T("deleteBizRule",[{formId:Ce.id,fieldKey:u.Key}],[]),Pe(Rc),se(!1)},we={invokeGetListConfig:function(e){e!==ee&&T("listtreeconfig",[e])},invokeGetFieldRecords:function(e){T("getFilterItemLook",[e,{getEnumData:"true",enumField:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",filterrows:[]}])},invokeSaveBizRule:function(e){T("saveBizRule",[{formId:Ce.id,fieldKey:u.Key,ruleInfo:Kl()(e)}])}},Pe=function(e){e=Kl()(e),ie(e),ye(e)},Re=function(e,t){var r=(0,d.c)(e,2),a=r[0],l=void 0===a?"":a,o=r[1],i=void 0===o?"":o,c={start:Kl()({valueType:t,value:l}),end:Kl()({valueType:t,value:i})};ie(c),n(c)},Be=function(e,t){var n,r,a=xe()(n=e[0].data).call(n,(function(e){return e.value===t}));return a=a||xe()(r=e[1].data).call(r,(function(e){return e.value===t}))},_e=function(e){var t;if("string"==typeof e)t=e;else if(Array.isArray(e)){if("dateRangeDef"===f)return void Re(e,0);t=e.join(",")}else t=null!=e&&e.target?e.target.value:e;Pe({valueType:0,value:t})},Oe={prefixCls:"kd"},je=Fc(Fc({},s),{},{value:null!==(t=null==s?void 0:s.value)&&void 0!==t?t:"function"==typeof p?p(Ee(oe,0)):Ee(oe,0),onChange:_e}),Le={fieldType:"findForm",borderType:"bordered",value:Ee(oe,2),onChange:_e,disabled:l,placeholder:C,onClear:Me,onClick:function(){return Ye("search")}},Ke=function(e){var t=e?e.split("@@"):["","",null],n=(0,d.c)(t,3);return[n[1],n[2]]}(Ee(oe,1)),Ve={fieldType:"formula",onClick:function(){return Ye("formula")},value:Ke[0],expressionData:Ie.functionTypes,fieldData:W,onClear:Me,lang:Number(Ke[1]||1),readOnly:!0,autofocus:!1},Ue=function(e){try{if(e&&"string"==typeof e)return JSON.parse(e).valueType||0;if("dateRangeDef"===f){var t=e.start,n=(e.end,t&&"string"==typeof t&&JSON.parse(t));return(null==n?void 0:n.valueType)||0}}catch(e){}}(oe),Ge={1:Ve,2:Le}[Ue],ze=(0,S.useMemo)((function(){return"fileDef"===f}),[f]),He=(lt(ne)||ze||Fc({data:ke,popperClassName:"".concat(I,"-def-editor-var-select-panel"),type:"dropdownSelect",onSelect:function(e){return Ye(e[0])},varSelectActive:de,onVarSelectActive:se},Ge),function(){L(!0)}),qe=function(){T("getBizRule",[{formId:Ce.id,fieldKey:u.Key}],[]),G(!0)},Ye=(0,S.useCallback)((function(e){var t,n={search:qe,formula:He};if("formula"===e&&!W){var r=ii(Te,J,!1);X(r)}null===(t=n[e])||void 0===t||t.call(n)}),[Te,qe,He]),We=function e(t,n,r){return null==t?void 0:N()(t).call(t,(function(t){return t.key===n?Fc(Fc({},t),{},{children:r}):t.children?Fc(Fc({},t),{},{children:e(t.children,n,r)}):t}))},Xe=function(e){var t;X((function(t){var n;return We(t,null===(n=ge.current)||void 0===n?void 0:n.Key,function(e,t){var n=t||{},r=(n.Name,n.Key),a=n.ParentId;return n.controlType,null==e?void 0:N()(e).call(e,(function(e){var t,n,l=e.PropCap,o=e.PropKey,i=(e.isMulti,e.items,e.type,l);return{key:h()(t="".concat(r,".")).call(t,o),title:i,parentId:a,id:h()(n="".concat(r,".")).call(n,o),isLeaf:!0}}))}(e,ge.current))})),null===(t=ve.current)||void 0===t||t.call(ve),ve.current=null};return D().createElement(D().Fragment,null,!ze&&D().createElement(k.NameTipWrapper,{nameHidden:m,className:a,name:i,tips:c,required:g,title:E}),D().createElement("div",{onClick:function(){ze&&Ye("search")},className:"".concat(I,"-def-editor")},D().createElement(w.ConfigProvider,{value:Oe},D().createElement(Un.InputCombo,je))),D().createElement(w.ConfigProvider,{value:Oe},j&&D().createElement(Un.Condition,{loadData:function(e){e.children,e.isLeaf;var t,n=e.key,r=e.isAsyncNode,a=(null===(t=Q.findControlByCondition((function(e){return e.Key===n})))||void 0===t?void 0:t[0])||{},l=J.getControlMeta(a._Type_).Name;return ge.current=Fc({controlType:l},a),new(jr())((function(e){if(r){ve.current=e;var t=function(e){return"NoCodeMulRefBillField_bos_adminorg"===e}(a._Type_)||function(e){return"NoCodeMulRefBillField_bos_user"===e}(a._Type_)?J.getControlMetaEditor(a._Type_,"BillEntityIdEx").Default:a.EntityData.BillEntityIdEx;T("click",[a.Id,"entitymeta","PropsDisplay",{BillEntityIdEx:t,itemKey:a.Key}],[])}else e()}))},value:Ke[0],language:Number(Ke[1]||1),modalTitle:"编辑运算公式",editorTitle:u.Name,visible:j,editorPlaceholder:"请编辑运算公式",fieldData:W,fieldTitle:"表单内容",expressionData:Ie.functionTypes,operations:De,onClose:function(){L(!1),se(0!==Ue&&!(null==Ge||!Ge.value))},onConfirm:function(e,t){e=function(e,t){var n,r;if(!e)return"";var a=(e=e.replace(/）/g,")").replace(/（/g,"(").replace(/“/g,'"').replace(/”/g,'"').replace(/‘/g,"'").replace(/’/g,"'")).replace(Dc,"$1").replace(kc,"$1");return h()(n=h()(r="".concat(a,"@@")).call(r,e,"@@")).call(n,t?1:0)}(e,t),we.invokeSaveBizRule({valueType:1,value:e}),L(!1),!e&&se(!1),Pe(e?{valueType:1,value:e}:Rc)}})),U&&D().createElement(xc,{visible:U,onClose:function(){G(!1),se(0!==Ue&&!(null==Ge||!Ge.value))},invokeActions:we,queryFormValue:be||Pc.value,refBillData:Ne,field:u,compareTypesMap:$,formId:Ce.id,onConfirm:function(e){G(!1),!e.value.relationFormId&&se(!1);var t=function(e,t){var n,r=(null===(n=Be(e,t))||void 0===n?void 0:n.label)||"";return r?"查找：".concat(r):""}(Ne,e.value.relationFormId);"dateRangeDef"===f?Re([t,t],e.valueType):e.value.relationFormId?Pe({valueType:e.valueType,value:t}):Pe(Rc)}}))},_c=(0,S.memo)((function(e){var t=e.locked,n=e.editor,r=e.field,a=e.handleChange,l=e.value,o=e.className,i=n.Relationproperty,c=r||{},u=c[void 0===i?"CustomContent":i],d=c.SelectItemType,f=c.AllowClear,p=void 0===f||f,m=Array.isArray(u)?u:(null==u?void 0:u.ops)||[],g=(0,S.useMemo)((function(){var e;return v()(e=(null==m?void 0:N()(m).call(m,(function(e){return{label:e.Label,value:e.Value}})))||[]).call(e,(function(e){return e.label}))}),[m]),y=1==d,C=function(e){t||a(e)};(0,S.useEffect)((function(){if(l&&g.length){var e=JSON.parse(l)||{},t=e.value,n=(null==t?void 0:t.split(","))||[];if(n.length){var r=N()(g).call(g,(function(e){return e.value}));if((n=v()(n).call(n,(function(e){return F()(r).call(r,e)}))).length){var a=n.join(",");t!==a&&(e.value=a,C(Kl()(e)))}else C("")}}}),[g]);var h=(0,s.c)({className:"".concat(o,"-select-def-editor"),scrollHidden:!1,disabled:t,placeholder:"请选择",borderType:"bordered",allowClear:p,onChange:C,mode:y?"multiple":"single",options:g,fieldType:"combo"},"placeholder","请选择");return D().createElement(Bc,(0,R.c)({},e,{handleChange:C,getRenderValue:function(e){return y?(0,Se.isEmpty)(e)?[]:null==e?void 0:e.split(","):(0,Se.isEmpty)(e)?"":e},editorType:"selectDef",inputFieldProps:h}))}));_c.displayName="SelectOptionEditor";var Oc=_c;function jc(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jc(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):jc(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Kc="min",Vc="max",Uc=function(e){return{type:Kc,value:e}},Gc=function(e){return{type:Vc,value:e}},zc=function(e,t){var n=t.type,r=t.value;switch(n){case Kc:return Lc(Lc({},e),{},{min:r});case Vc:return Lc(Lc({},e),{},{max:r});default:return e}},Hc=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.locked,l=e.Editor,o=e.Name,i=e.Tips,c=l.NameHidden,u=l.Required,f=l.minPlaceholder,p=void 0===f?"最小值":f,m=l.maxPlaceholder,v=void 0===m?"最大值":m,g=l.Min,y=l.Title,C=(0,S.useReducer)(zc,{min:!1,max:!1}),h=(0,d.c)(C,2),E=h[0],b=h[1],I=(0,S.useReducer)(zc,{min:String((null==n?void 0:n.min)||""),max:String((null==n?void 0:n.max)||"")}),N=(0,d.c)(I,2),T=N[0],x=N[1];(0,S.useEffect)((function(){var e=String((null==n?void 0:n.min)||""),t=String((null==n?void 0:n.max)||""),r=E.min,a=E.max;r||e===T.min||x(Uc(e)),a||t===T.max||x(Gc(t))}),[n,E]);var A=function(e,n){var r=Lc(Lc({},T),{},(0,s.c)({},n,e));t(r)},F=(0,k.useDebounce)(A,300),M=function(e){b({type:e,value:!0})};return D().createElement(D().Fragment,null,D().createElement(k.NameTipWrapper,{nameHidden:c,className:r,name:o,tips:i,required:u,title:y}),D().createElement("div",{className:"".concat(r,"-datascope-editor")},D().createElement(w.Stepper,{type:"embed",value:T.min,zeroShow:!0,onChange:function(e){var t=e.target.value||"",n=T.max;!e.nativeEvent&&!De()(g)&&t<g&&(t=g),t&&n&&t>Number(n)&&(t=n),x(Uc(t)),t&&!De()(g)&&t<g||"-"===t||F(t,Kc)},onFocus:function(){return M(Kc)},onBlur:function(e){b(Uc(!1));var t=T.min;!De()(g)&&(Number(t)<g||""===t)&&(x(Uc(String(g))),A(String(g),Kc))},disabled:a,placeholder:p}),D().createElement("div",{className:"".concat(r,"-seperator")},"-"),D().createElement(w.Stepper,{type:"embed",value:T.max,zeroShow:!0,onFocus:function(){return M(Vc)},onBlur:function(e){b(Gc(!1));var t=T.min,n=T.max;if(""!==t&&n<=Number(t)||!De()(g)&&Number(n)<=g){var r="";""!==n&&""!==t&&n<Number(t)&&(r=t),!De()(g)&&Number(n)<=g&&(r=g),""!==r&&(x(Gc(r)),A(r,Vc))}},onChange:function(e){var t=e.target.value||"",n=T.min;!e.nativeEvent&&t&&(!De()(g)&&t<g&&(t=g),n&&t<Number(n)&&(t=n)),x(Gc(t)),(t&&n&&t>=Number(n)||""===n&&"-"!==t||""===t)&&(!De()(g)&&t&&t>=g||De()(g))&&F(t,Vc)},disabled:a,placeholder:v})))};var qc=(0,S.memo)((function(e){var t=e.item,n=e.index,r=e.prefixClass,a=e.isSysControl,l=e.fieldInfo,o=e.innerForm,i=e.isNew,c=e.disabled,u=e.isRefSelf,s=e.onDrop,f=e.onTitleChange,p=e.onShowField,m=e.onDelectField,v=e.showMessage,g=(0,S.useState)((null==t?void 0:t.Name)||""),y=(0,d.c)(g,2),C=y[0],h=y[1],E=(0,S.useState)(!1),b=(0,d.c)(E,2),I=b[0],N=b[1],T=(0,S.useRef)(null),x=l.inner2Outer,A=l.SourceForm,F=(0,S.useMemo)((function(){return!c&&(x||o)}),[x,o,c]),k=(0,S.useMemo)((function(){return!i&&("1"===A&&x||"1"!==A)}),[x,o,A,i]),M=(0,S.useMemo)((function(){return!c&&(!u&&("1"===A||F))}),[x,F,c]);(0,S.useEffect)((function(){t.Name&&h(t.Name)}),[t.Name]);var w=(0,S.useCallback)((function(){var e;C||(null==v||v("控件名不能为空"),h(null==t?void 0:t.Name)),N(!1),null===(e=T.current)||void 0===e||e.blur(),C&&f(C,n,t)}),[C,f]),P=(0,S.useCallback)((function(){F&&!a&&m(n,t,i)}),[t,n,m,F,i,a]),R=(0,S.useCallback)((function(){N(!0),setTimeout((function(){var e;return null===(e=T.current)||void 0===e?void 0:e.focus()}),200)}),[]),B=(0,S.useCallback)((function(e,t){!c&&(null==s||s(e,t))}),[s,c]);return D().createElement(Un.Draggable,{index:n,onDrop:B,disabled:c},D().createElement("div",{className:"".concat(r,"-list-drag-item")},D().createElement("div",null,D().createElement("div",{className:"".concat(r,"-list-drag-item-title")},D().createElement("i",{className:"designericon designericon-".concat((null==un?void 0:un[t._Type_])||"wenben")}),I?D().createElement(Un.Text,{ref:T,value:C,size:"small",onChange:h,onPressEnter:w,onBlur:w}):D().createElement("span",{title:C},C)),D().createElement("div",{className:"".concat(r,"-list-drag-item-btns")},M&&!(null!=t&&t.RefBillId)&&!(null!=t&&t.RefTableId)&&D().createElement("i",{className:"designericon designericon-bianji3",onClick:R}),k&&D().createElement("i",{className:jn()("designericon",{"designericon-zhanshi":t.isShow},{"designericon-yincang":!(null!=t&&t.isShow)}),onClick:function(){return p(n,t)}}),D().createElement("i",{className:"designericon designericon-tuozhuailiebiao"}))),M&&D().createElement("i",{className:jn()("nocodeplatformicon","nocodeplatformicon-xingshanchu",{gray:!(F&&!a)}),onClick:P})))}));qc.displayName="BillFieldItem";var Yc=qc;function Wc(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wc(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Wc(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Zc="refreshPropsDisplayList",Qc=D().memo((function(e){e.handleChange;var t=e.value,n=e.className,r=e.editor,a=(e.locked,e.Name),l=e.Tips,o=e.field,i=e.id,c=e.propName,u=e.rootId,f=r.NameHidden,p=r.Required,m=r.Title,g=(0,S.useContext)(le),y=g.invokeAction,C=g.billPropsData,E=g.dispatchBillData,b=g.getKdesignerApi,I=g.getHideFieldRef,T=g.setHideFieldRef,x=(0,S.useContext)(k.GlobalConfigContext).showMessage,A=b(),M=A.data,R=A.selection,B=A.meta,_=(A.controlCacheApi,o.BillEntityIdEx),O=o.RefTableId,j=o.RefBillId,L=o._Type_,K=o.SourceForm,V=o.inner2Outer,U=o.ShowType,G="".concat(n,"-bill-props"),z=(0,S.useState)([]),H=(0,d.c)(z,2),q=H[0],Y=H[1],W=(0,S.useRef)(t),X=(0,S.useRef)({fieldId:i,tableId:O,refId:j,code:c}),Z=(0,S.useRef)(Xc({},C)||{}),Q=$e(L)&&O?O:i,J=(0,S.useRef)(Q),$=(0,S.useRef)(_||"1"!==K?_:"".concat(Q,"_table")),ee=(0,S.useRef)(new(vn())(t?t.split(","):[])),te=(0,S.useRef)([]),ne=(0,S.useMemo)((function(){return xa(o,C.innerForm||[])}),[o,V,null==C?void 0:C.innerForm]),re=(0,S.useCallback)((function(e){if(W.current!==e){var t=X.current,n=t.fieldId,r=t.code,a=[[n,(0,s.c)({},r,e)]];M.batchUpdateControlPropertyValues((0,k.createUpdateAction)(a))}}),[]),ae=(0,S.useCallback)((function(e,t){var n=[],r=t||{},a=r.Key,l=r.isShow;if(M.findControlByCondition((function(r){var a;r.Id.split("_").length>1&&F()(a=r.Id).call(a,t.Id)&&n.push([r.Id,{Name:e}])})),"1"!==K&&(!l||"1"===U)){var o=(M.findControl(u)||{}).refFieldEdit,i=void 0===o?{}:o,c="string"==typeof i?JSON.parse(i||"{}"):(0,Se.cloneDeep)(i);c[$.current]=c[$.current]||{},c[$.current][a]={title:e,status:"edit"},n.push([u,{refFieldEdit:c}])}M.batchUpdateControlPropertyValues((0,k.createUpdateAction)(n))}),[K,u,U]),oe=(0,S.useCallback)((function(e,t){var n=t.sourceIndex,r=t.destinationIndex,a=(0,Se.cloneDeep)(q),l=ce()(a).call(a,n,1)[0];ce()(a).call(a,r,0,l),Y((0,P.c)(a)),Ce(a),te.current=a,k.eventBus.emit(Zc,{id:X.current.fieldId,data:(0,P.c)(a)})}),[q,Y]),ie=(0,S.useCallback)((function(e,t,n){E({key:Gr,payload:{form:$.current,id:n.Id,data:{Name:e}}}),ae(e,n)}),[E,q]),ue=(0,S.useCallback)((function(e){return e.reduce((function(e,t){var n,r;return t.isShow?Qe(t._Type_)?h()(n=[]).call(n,(0,P.c)(e),["".concat(t.Key,"_startdate"),"".concat(t.Key,"_enddate")]):h()(r=[]).call(r,(0,P.c)(e),[t.Key]):e}),[])}),[]),de=(0,S.useCallback)((function(e,t){var n=(0,Se.cloneDeep)(q);if(n[e].isShow=!n[e].isShow,"2"===U)if(n[e].isShow)M.addControl((0,k.createAddAction)(Ra(n[e],i)));else{var r,a=I();Pa([h()(r="".concat(t.Id,"_")).call(r,i)],C,E,M,a,T)}var l=ue(n);"1"===U&&re(l.join());var o=new(vn())(l);n=ka(n,o),te.current=n,Y(n)}),[q,i,C,U]),se=(0,S.useCallback)((function(e,t){if(_&&!(arguments.length>2&&void 0!==arguments[2]&&arguments[2])){var n=(M.findControl(u)||{}).refFieldEdit,r=void 0===n?{}:n,a="string"==typeof r?JSON.parse(r||"{}"):(0,Se.cloneDeep)(r);a[$.current]=a[$.current]||{},a[$.current][t.Key]={status:"delete"},M.batchUpdateControlPropertyValues((0,k.createUpdateAction)([[u,{refFieldEdit:a}]]))}if("2"===U&&null!=t&&t.isShow){var l=[];M.findControlByCondition((function(e){var n;F()(n=e.Id).call(n,t.Id)&&l.push(e.Id)}));var o=I();Pa(l,Z.current,E,M,o,T)}else{var i,c=v()(i=(0,P.c)(ee.current)).call(i,(function(e){return!F()(e).call(e,t.Key)}));re(c.join())}E({key:Hr,payload:{form:$.current,id:t.Id}})}),[U,_,u]),fe=(0,S.useCallback)((function(e,t,n){var r,a=window.sessionStorage.getItem("nocode-d-del-modal");if(!_||a||n||"1"===K)return se(e,t);Un.WebMsg.showConfirmModal({title:"确认删除“".concat(t.Name,"”吗？"),content:"会在表单“".concat((null===(r=Z.current[_])||void 0===r||null===(r=r.data)||void 0===r?void 0:r.caption)||"","”中同步删除"),actions:[{key:"delete",text:"删除"},{key:"ok",text:"再想想"}],onAction:function(r){"delete"===r&&se(e,t,n)},type:"delete",extra:D().createElement(w.Checkbox,{style:{marginTop:32},onChange:function(e){return e.target.checked&&window.sessionStorage.setItem("nocode-d-del-modal","true")}},"下次不再提醒")})}),[_,K,se]),pe=(0,S.useCallback)((function(e,t,n){if(e.length){var r=X.current.fieldId,a=M.findControlIndex(r),l=Ba(e,t,J.current,B),o=(0,d.c)(l,2),i=o[0],c=o[1];M.addControl((0,k.createAddAction)(i,{index:a+1})).then((function(){R.setSelect([r]),null==n||n(c.join())})).catch((function(e){}))}}),[]),me=(0,S.useCallback)((function(e,t){M.deleteControl((0,k.createDeleteAction)(e)).then((function(e){null==t||t(e)})).catch((function(e){}))}),[]),ve=(0,S.useCallback)((function(e,t){var n=wa(e,o);ee.current.size&&(n=ka(n,ee.current)),Y(n),te.current=n,null==t||t(n)}),[o]),ge=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,n=(0,S.useRef)({fn:e,timer:null}).current;return(0,S.useEffect)((function(){n.fn=e}),[e]),(0,S.useCallback)((function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){n.fn.apply(n,r)}),t)}),[e])}(ve,100),ye=(0,S.useCallback)((function(e){var t;if(null!=e&&e.data){var n=(null==e?void 0:e.data)||{},r=N()(t=n.entitymeta.Items).call(t,(function(e){return e.Id}));E({key:Ur,payload:{form:e.billEntityIdEx||n.id,info:{data:n,ids:r}}})}}),[]),Ce=(0,S.useCallback)((function(e){var t=X.current.fieldId,n=M.getParentControl(t)._Type_;if(!ot(n))if("2"===U){var r=M.getAllSubControls(t),a=r.reduce((function(e,n){var r;return n.Id===t?e:h()(r=[]).call(r,(0,P.c)(e),[n.Id])}),[]);me(a,(function(){pe(e,r,(function(e){return re(e)}))}))}else re(ue(e).join())}),[U,K]);(0,S.useEffect)((function(){var e,t=((null==C?void 0:C[$.current])||{}).data,n=((null===(e=Z.current)||void 0===e?void 0:e[$.current])||{}).data;t&&!(0,Se.isEqual)(n,t)&&$.current&&ge(t),Z.current=Xc({},C)}),[C]),(0,S.useEffect)((function(){var e;W.current=t,ee.current=new(vn())(t?t.split(","):[]);var n=((null===(e=Z.current)||void 0===e?void 0:e[$.current])||{}).data;n&&(V||"1"!==K)&&ge(n)}),[t]),(0,S.useEffect)((function(){if($.current!==_&&"1"!==K&&($.current=_,W.current="",ee.current=new(vn()),Y([])),_){var e,t=((null===(e=Z.current)||void 0===e?void 0:e[_])||{}).data;t?ge(t):y("getDesignerMetadata",[_]),y("click",[i,"entitymeta",c,{BillEntityIdEx:_,itemKey:o.Key}],[])}if(!_&&"1"!==K){var n,r=Fe()(n=M.getAllSubControlIds(J.current)).call(n,1);r.length&&me(r),te.current=[]}}),[_]),(0,S.useEffect)((function(){if(V){var e,t=((null===(e=Z.current)||void 0===e?void 0:e[$.current])||{}).data;t&&ge(t)}}),[V]);var he=(0,S.useCallback)((function(e){var t=e.id,n=e.data;t!==X.current.fieldId||(0,Se.isEqual)(n,te.current)||(te.current=n,Y(n))}),[]);(0,S.useEffect)((function(){var e,t=((null===(e=Z.current)||void 0===e?void 0:e[$.current])||{}).data;return t&&ve(t),k.eventBus.on(Zc,he),function(){k.eventBus.off(Zc,he)}}),[]),(0,S.useEffect)((function(){return k.eventBus.on(hr,ye),function(){k.eventBus.off(hr,ye)}}),[ye]);var Ee=(0,S.useMemo)((function(){return $e(L)&&"2"===U}),[L,U]);return D().createElement("div",{className:G},D().createElement("div",{className:"".concat(G,"-title")},D().createElement(k.NameTipWrapper,{nameHidden:f,className:n,name:a,tips:l,required:p,title:m})),D().createElement("div",{className:"".concat(G,"-list")},null!=q&&q.length?D().createElement(Un.DragContainer,null,D().createElement("div",{className:"".concat(G,"-list-drag")},N()(q).call(q,(function(e,t){var n;return D().createElement(Yc,{key:e.Id,item:e,index:t,prefixClass:G,fieldInfo:o,disabled:Ee,isNew:!_||!(null!=C&&null!==(n=C[$.current])&&void 0!==n&&null!==(n=n.ids)&&void 0!==n&&F()(n).call(n,e.Id)),innerForm:ne,showMessage:x,isRefSelf:_===u,isSysControl:Sa(e._Type_),onDrop:oe,onTitleChange:ie,onShowField:de,onDelectField:fe})})))):D().createElement("div",{className:"".concat(G,"-empty")},D().createElement(Un.EmptyData,{desc:"暂无内容"}))))}));function Jc(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function $c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jc(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Jc(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var eu=(0,S.memo)((function(e){var t,n,r,a,l=e.handleChange,o=e.value,i=e.className,c=e.editor,u=(e.locked,e.Name),s=e.Tips,f=e.field,p=(e.id,e.propName,c.NameHidden),m=c.Required,g=c.Title,y=f.FileMaxSize,C=f.UploadNum,E=f.ImageFileType,b=f.FieldType,I=f.ButtonText,T=(0,S.useContext)(le),x=T.getKdesignerApi,A=T.baseUrl,F=(0,S.useState)([]),M=(0,d.c)(F,2),R=M[0],B=M[1],_=x(),O=(_.data,_.meta),j=O.getControlPropertyDefaultValue,L=(0,O.getControlMetaEditor)(b,"ImageFileType").Enum,K=j(b,"FileMaxSize"),V=j(b,"ImageFileType"),U="".concat(i,"-pic"),G=(0,S.useState)(""),z=(0,d.c)(G,2),H=z[0],q=z[1],Y=(0,S.useRef)(new(we())),W=(0,S.useCallback)((function(e){Un.WebMsg.showNotificationMsg({param:[{type:2,content:e,duration:2e3}]})}),[]),X=(0,S.useCallback)((function(e,t){return null!=C&&C.max&&t.length>C.max?(W("最多只能上传".concat(C.max,"个图片，请重新选择")),!1):!(y&&e.size/1024/1024>y)||(W("请上传小于".concat(y,"M的图片")),!1)}),[C.max,y,Y.current]),Z=(0,S.useCallback)((function(e){var t=e.file,n=e.fileList;if(t.response&&"0"===t.response.errorCode){var r,a=t.uid,o=t.name,i=t.size,c={url:t.response.data.url,status:"success",uploadTime:Date.now()};Y.current.set(t.uid,$c({uid:a,name:o,size:i},c)),l(Kl()((0,P.c)(Ni()(r=Y.current).call(r)))),n.forEach((function(e){e.uid===t.uid&&(e.url=A.picture+t.response.data.url)}))}B((0,P.c)(n))}),[R,Y.current,l]),Q=(0,S.useCallback)((function(e){var t,n=Kr()(R).call(R,(function(t){return t.uid===e.uid}));ce()(R).call(R,n,1),B((0,P.c)(R)),Y.current.get(e.uid)&&Y.current.delete(e.uid);var r=Y.current.size>0?Kl()((0,P.c)(Ni()(t=Y.current).call(t))):"";l(r)}),[R,Y.current,l]);(0,S.useEffect)((function(){if(o&&qt(o)){var e=JSON.parse(o);(0,Se.isArray)(e)?(Y.current=new(we()),e=N()(e).call(e,(function(e){Y.current.set(e.uid,$c({},e));var t=A.picture+e.url;return $c($c({},e),{},{url:t})})),B(e)):q(e.value)}else(0,re.unstable_batchedUpdates)((function(){B([]),q("")}))}),[o]);var J=E||V,$=N()(t=J.split(",")).call(t,(function(e){return v()(L).call(L,(function(t){return t.Id===e}))[0].Name}));return D().createElement("div",{className:U},D().createElement("div",{style:{marginBottom:"8px"}},D().createElement(k.NameTipWrapper,{nameHidden:p,className:i,name:u,tips:s,required:m,title:g})),!H&&D().createElement("div",null,D().createElement(w.ConfigProvider,{value:{prefixCls:"kd"}},D().createElement(Un.Picture,{fileList:R,action:Gt(window.__domainurl__+"nocode/v2/nocode_sys/image"),data:{action:"upload",tempstorage:!1},accept:N()($).call($,(function(e){return"."+e})).join(","),multiple:!0,buttonText:I,onChange:Z,onRemove:Q,beforeUpload:X,noticeInfo:h()(n=h()(r=h()(a="请上传小于".concat(y||K,"M的")).call(a,$.join("、"),"文件，文件个数不少于")).call(r,(null==C?void 0:C.min)||0,"个，不多于")).call(n,(null==C?void 0:C.max)||1,"个。")}))))})),tu=function(e){var t=e.formVisible,n=e.prefixCls,r=e.refFldOptions,a=e.currFldOptions,l=e.refFldKey,o=e.currFldKey,i=e.handleChange;return t?D().createElement("div",{className:"".concat(n,"-form")},D().createElement("div",{className:"".concat(n,"-form-item")},D().createElement("div",{className:"".concat(n,"-form-item-label")},"关联表单内容"),D().createElement(w.Select,{className:"".concat(n,"-form-item-select"),borderType:"bordered",value:l,options:r,placeholder:"请选择",onChange:function(e){return i(e,"RefFldKey")}})),D().createElement("div",{className:"".concat(n,"-form-seperator")},"的值填充到"),D().createElement("div",{className:"".concat(n,"-form-item")},D().createElement("div",{className:"".concat(n,"-form-item-label")},"当前表单内容"),D().createElement(w.Select,{className:"".concat(n,"-form-item-select"),borderType:"bordered",value:o,options:a,placeholder:"请选择",onChange:function(e){return i(e,"CurrFldKey")}}))):null},nu=function(e){var t,n=e.prefixCls,r=e.data,a=e.index,l=e.isNewOption,o=e.handleDelete,i=e.handleUpdate,c=e.currFldOptions,u=e.refFldOptions,s=r.RefFldKey,f=r.CurrFldKey,p=(null===(t=xe()(u).call(u,(function(e){return e.value===s})))||void 0===t?void 0:t.label)||"",m=(0,S.useState)(!!l),v=(0,d.c)(m,2),g=v[0],y=v[1],C=(0,S.useRef)(null),h=(0,S.useRef)(null),E=(0,S.useCallback)((function(e,t){e.stopPropagation(),o(t)}),[o]),b=(0,S.useCallback)((function(){y(!0)}),[y]),I=(0,S.useCallback)((function(e,t){i(e,a,t)}),[i,a]),N=(0,S.useCallback)((function(){return D().createElement("div",{ref:C},D().createElement(tu,{formVisible:g,prefixCls:n,currFldOptions:c,refFldOptions:u,refFldKey:s,currFldKey:f,handleChange:I}))}),[n,c,u,s,f,I,g]);return(0,k.useOnClickOutside)([C],(function(e){var t=document.getElementById("app");if((!t||null!=t&&t.contains(e.target))&&g){var n;if(null!==(n=h.current)&&void 0!==n&&n.contains(e.target))return;y(!1)}})),D().createElement(w.Tooltip,{trigger:"click",placement:"leftTop",popperStyle:{width:"636px"},popperClassName:"".concat(n,"-dropdown"),tip:N(),visible:g},D().createElement("div",{className:"".concat(n,"-option"),onClick:b,ref:h},D().createElement("div",{className:"".concat(n,"-option-name")},p),D().createElement("div",{className:"".concat(n,"-option-right-btns")},D().createElement(w.Icon,{prefix:"designericon",type:"bianji3"}),D().createElement(w.Icon,{prefix:"designericon",type:"shanchu",onClick:function(e){return E(e,a)}}))))};function ru(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function au(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ru(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):ru(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var lu={CurrFldKey:"",RefFldKey:""},ou="DELETE",iu="UPDATE",cu="MERGE",uu=function(e,t){var n=t.type,r=t.index,a=t.payload;return Ct()(e,(function(e){switch(n){case"ADD":e.push(a);break;case iu:e[r]=au(au({},e[r]),a);break;case ou:ce()(e).call(e,r,1);break;case cu:e=a}return e}))},du=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.editor,l=(e.locked,e.Name),o=e.Tips,i=e.field,c=a.NameHidden,u=a.Required,f=a.Title,p=i.Id,m=(0,S.useContext)(le),v=m.prefixCls,g=m.getKdesignerApi,y=m.getCurrentRefBillPropsData,C=g(),E=C.data,b=C.meta,I=(0,S.useReducer)(uu,n||[]),T=(0,d.c)(I,2),x=T[0],A=T[1],F=(0,S.useState)((function(){var e=E.findControlByCondition((function(e){var t=e._Type_,n=e.ParentId,r=E.getRootId(),a=(n&&E.findControl(n)||{})._Type_;return!(lt(a)||lt(t)||function(e){return"NoCodeGEOField"===e}(t)||rt(t)||at(t)||e.Id===p||e.Id===r)})).reduce((function(e,t){var n=t._Type_;return"NoCodeDateRangeField"===b.getControlMeta(n).Id?h()(e).call(e,[{label:"".concat(t.Name,".开始"),value:"".concat(t.Key,"_startdate")},{label:"".concat(t.Name,".结束"),value:"".concat(t.Key,"_enddate")}]):h()(e).call(e,{label:t.Name,value:t.Key})}),[]);return e})),M=(0,d.c)(F,1)[0],P=(0,S.useState)([]),R=(0,d.c)(P,2),B=R[0],_=R[1],O=(0,S.useState)(null),j=(0,d.c)(O,2),L=j[0],K=j[1],V=(0,S.useCallback)((function(){K(x.length),A({type:"ADD",payload:lu})}),[x,A]),U=(0,S.useCallback)((function(e,t,n){A({type:iu,index:t,payload:(0,s.c)({},n,e)})}),[A]),G=(0,S.useCallback)((function(e){K(null),A({type:ou,index:e})}),[A]),z=(0,S.useCallback)((function(e){var t=N()(e).call(e,(function(e){return{label:e.PropCap,value:e.PropKey}}));_(t)}),[]);return(0,S.useEffect)((function(){return z(y()),k.eventBus.on(fr,z),function(){k.eventBus.off(fr,z)}}),[]),(0,S.useEffect)((function(){(0,Se.isEqual)(n,x)||t(x)}),[x]),(0,S.useEffect)((function(){(0,Se.isEqual)(n||[],x)||A({type:cu,payload:n})}),[n]),D().createElement(D().Fragment,null,D().createElement(k.NameTipWrapper,{nameHidden:c,className:r,name:l,tips:o,required:u,title:f}),D().createElement("div",{className:"".concat(v,"-relate-field")},N()(x).call(x,(function(e,t){return D().createElement(nu,{key:t,prefixCls:"".concat(v,"-relate-field"),data:e,index:t,isNewOption:L===t,handleUpdate:U,handleDelete:G,currFldOptions:M,refFldOptions:B})}))),D().createElement("div",{className:"".concat(v,"-relate-field-add")},D().createElement("div",{className:"add-btn",onClick:V},D().createElement(w.Icon,{type:"zengjia-yuan",prefix:"designericon"}),D().createElement("span",{className:"".concat(v,"-relate-field-add-option-desc")},"添加"))))};function su(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function fu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?su(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):su(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var pu="start",mu="end",vu=function(e,t){return fu(fu({},e),t)},gu=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.locked,l=e.Editor,o=e.Name,i=e.Tips,c=l.NameHidden,u=l.Required,f=l.minPlaceholder,p=void 0===f?"请输入":f,m=l.maxPlaceholder,v=void 0===m?"请输入":m,g=l.Title,y=(0,S.useReducer)(vu,(0,s.c)((0,s.c)({},pu,!1),mu,!1)),C=(0,d.c)(y,2),h=C[0],E=C[1],b=(0,S.useReducer)(vu,(0,s.c)((0,s.c)({},pu,String((null==n?void 0:n[pu])||"")),mu,String((null==n?void 0:n[mu])||""))),I=(0,d.c)(b,2),N=I[0],T=I[1];(0,S.useEffect)((function(){var e=String((null==n?void 0:n[pu])||""),t=String((null==n?void 0:n[mu])||""),r=h[pu],a=h[mu];r||e===N[pu]||T((0,s.c)({},pu,e)),a||t===N[mu]||T((0,s.c)({},mu,t))}),[n,h]);var x=(0,k.useDebounce)((function(e,n){var r=fu(fu({},N),{},(0,s.c)({},n,e));t(r)}),300),A=function(e){E((0,s.c)({},e,!0))},F=function(e){E((0,s.c)({},e,!0))};return D().createElement(D().Fragment,null,D().createElement(k.NameTipWrapper,{nameHidden:c,className:r,name:o,tips:i,required:u,title:g}),D().createElement("div",{className:"".concat(r,"-datascope-editor")},D().createElement(w.Input,{borderType:"bordered",value:N[pu],onChange:function(e){var t=e.target.value||"";T((0,s.c)({},pu,t)),x(t,pu)},onFocus:function(){return A(pu)},onBlur:function(){return F(mu)},disabled:a,placeholder:p}),D().createElement("div",{className:"".concat(r,"-seperator")},"-"),D().createElement(w.Input,{borderType:"bordered",value:N[mu],onFocus:function(){return A(mu)},onBlur:function(){return F(mu)},onChange:function(e){var t=e.target.value||"";T((0,s.c)({},mu,t)),x(t,mu)},disabled:a,placeholder:v})))},yu=function(e){e.handleChange;var t=e.value,n=(e.className,e.locked),r=e.field.FormatType,a=(0,S.useContext)(le).prefixCls,l={className:"".concat(a,"-daterange-editor"),popperClassName:"".concat(a,"-range-picker-dropdown"),disabled:n,placeholder:["起始日期","结束日期"],formatType:r,allowClear:!0,fieldType:"dateRange"};return D().createElement(Bc,(0,R.c)({},e,{getRenderValue:function(e){return pt(e)},editorType:"dateRangeDef",value:t,inputFieldProps:l}))},Cu=new(we())([["2","month"],["3","year"]]),hu=function(e){var t=e.handleChange,n=e.value,r=(e.className,e.locked),a=e.field.FormatType,l=(0,S.useContext)(le).prefixCls,o=((0,S.useMemo)((function(){return{picker:Cu.get(a)||"date"}}),[a]),{className:"".concat(l,"-date-editor"),disabled:r,placeholde:"请选择",formatType:a,allowClear:!0,fieldType:"date",placeholder:"请选择"});return D().createElement(Bc,(0,R.c)({},e,{editorType:"dateDef",value:n,getRenderValue:function(e){return e&&Date.parse(e)?new Date(e):void 0},handleChange:function(e){t(e)},inputFieldProps:o}))};function Eu(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function bu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Eu(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Eu(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Iu=(0,S.memo)((function(e){var t,n,r,a=e.handleChange,l=e.value,o=e.className,i=e.editor,c=e.Name,u=e.Tips,f=e.field,p=i.NameHidden,m=i.Required,g=i.Title,y=f.FileMaxSize,C=f.UploadNum,E=f.UploadModel,b=f.AttachmentFileType,I=f.FieldType,T=f.ButtonText,x=(0,S.useContext)(le),A=x.getKdesignerApi,F=x.baseUrl,M=(0,S.useState)(""),w=(0,d.c)(M,2),R=w[0],B=w[1],_=(0,S.useState)([]),O=(0,d.c)(_,2),j=O[0],L=O[1],K=(0,S.useState)(""),V=(0,d.c)(K,2),U=V[0],G=V[1],z=A(),H=(z.data,z.meta.getControlPropertyDefaultValue),q=H(I,"AttachmentFileType"),Y=H(I,"FileMaxSize"),W=y||Y,X=b||q,Z=(0,S.useRef)(new(we())),Q=(0,S.useCallback)((function(e){if(!e||"{}"===e)return[];if(qt(e)){var t=JSON.parse(e);return Array.isArray(t)?N()(t).call(t,(function(e){return Z.current.set(e.uid,e),bu(bu({},e),{},{url:F.attachment+e.url})})):t.value}return""}),[]);(0,S.useEffect)((function(){Z.current=new(we());var e=Q(l);Array.isArray(e)?(L(e),G("")):G(e)}),[Q,l,L]);var J=(0,S.useCallback)((function(e){Un.WebMsg.showNotificationMsg({param:[{type:2,content:e,duration:2e3}]})}),[]),$=(0,S.useCallback)((function(e,t){return null!=C&&C.max&&t.length>C.max?(J("最多只能上传".concat(C.max,"个文件，请重新选择")),!1):!(W&&e.size/1024/1024>W)||(J("请上传小于".concat(W,"M的文件")),!1)}),[null==C?void 0:C.max,W]),ee=(0,S.useCallback)((function(e){var t=e.file,n=e.fileList;if("done"===t.status&&t.response.status){var r,l=t.lastModified,o=t.uid,i=t.name,c=t.type,u=t.size,d={status:"success",url:t.response.data.url,uploadTime:Date.now()};Z.current.set(t.uid,bu({lastModified:l,uid:o,name:i,type:c,size:u},d)),a(Kl()((0,P.c)(Ni()(r=Z.current).call(r))));var s=N()(n).call(n,(function(e){return e.uid===t.uid?Z.current.get(t.uid):e}));L(s)}else L((0,P.c)(n))}),[a]),te=(0,S.useCallback)((function(e){var t=v()(j).call(j,(function(t){return t.uid!==e.uid}));if(Z.current.get(e.uid)){var n;Z.current.delete(e.uid);var r=Z.current.size>0?Kl()((0,P.c)(Ni()(n=Z.current).call(n))):"";a(r)}return L((0,P.c)(t)),!0}),[j,a]),ne=(0,S.useCallback)((function(e){var t,n=Z.current.get(e.uid);n&&(n.name=e.name,Z.current.set(e.uid,n),a(Kl()((0,P.c)(Ni()(t=Z.current).call(t)))));L(Ct()((function(t){t.forEach((function(t){t.uid===e.uid&&(t.name=e.name)}))})))}),[j,a]);return(0,S.useEffect)((function(){var e,t;B(h()(e=h()(t="".concat(c,"(")).call(t,Z.current.size,"/")).call(e,(null==C?void 0:C.max)||1,")"))}),[C,j]),D().createElement("div",{className:"".concat(o,"-attachment-editor")},D().createElement("div",{style:{marginBottom:"8px"}},D().createElement(k.NameTipWrapper,{nameHidden:p,className:o,name:R,tips:u,required:m,title:g})),!U&&D().createElement("div",null,D().createElement(Un.Attachment,(0,s.c)({multiple:!0,action:Gt(window.__domainurl__+"nocode/v2/nocode_sys/attachment"),data:{action:"upload",tempstorage:!1},fileList:j,buttonText:T,mode:E,onChange:ee,beforeUpload:$,onRemove:te,onChangeFileName:ne,accept:X||"",uploadNum:C,noticeInfo:h()(t=h()(n=h()(r="请上传小于".concat(W,"M的")).call(r,null==X?void 0:Ua()(X).call(X,".",""),"文件，文件个数不少于")).call(n,(null==C?void 0:C.min)||0,"个，不多于")).call(t,(null==C?void 0:C.max)||1,"个")},"mode",1))))}));function Nu(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Tu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nu(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Nu(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var xu,Au,Fu,Su=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.field,l=a.Precision,o=a.Scale,i=a.DataRange,c=a.ThousandsSeparator,u=(0,S.useMemo)((function(){var e={},t=i||{},n=t.min,r=t.max;return(0,Se.isUndefined)(n)||""===n||(e.min=Number(n)),(0,Se.isUndefined)(r)||""===r||(e.max=Number(r)),e}),[i]),d=(0,S.useCallback)((function(e){return c?Vt("".concat(e)):String(e)}),[c]),s=Tu(Tu({className:"".concat(r,"-number-def-editor")},u),{},{showStepper:!0,decimalLength:o,formatter:d,maxLength:l,fieldType:"number",placeholder:"请输入"});return D().createElement(Bc,(0,R.c)({},e,{editorType:"decimalDef",value:"".concat(n),onChange:function(e){t(e)},inputFieldProps:s}))},Du="#F8FAFC",ku=(0,P.c)(new(vn())(N()(xu=p()(Ye)).call(xu,(function(e){return Ye[e]})))),Mu=h()(Au=[Du]).call(Au,ku),wu=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.editor,l=e.locked,o=e.field,i=e.Name,c=e.Tips,u=a.NameHidden,d=a.Default,s=a.Required,f=a.Title,p=o.BackImage,m=(0,S.useRef)(!0),v=(0,Se.isUndefined)(n)?d:String(n),g=function(e){l||t(e)};return(0,S.useEffect)((function(){!v&&g(ku[0])}),[]),(0,S.useEffect)((function(){if(p&&!m.current){var e=xe()(We).call(We,(function(e,t){return F()(p).call(p,"background_".concat(t+1))}));g(e?Ye[e.primaryColor]:Du)}m.current=!1}),[p,We]),D().createElement(D().Fragment,null,D().createElement(k.NameTipWrapper,{nameHidden:u,className:r,name:i,tips:c,required:s,title:f}),D().createElement(Qr,{className:"".concat(r,"-colorpicker-content"),colorList:Mu,prefixClass:r,onChange:g,value:v}))},Pu=n(3872),Ru=n.n(Pu),Bu=Gt((Fu="nocode/v2/nocode_sys/image",window.__domainurl__+Fu)),_u=["image/png","image/jpeg","image/jpg"],Ou=function(e){var t=(0,S.useContext)(le),n=t.baseUrl,r=t.showMessage,a=e.handleChange,l=e.value,o=e.className,i=e.editor,c=e.locked,u=e.Name,f=e.Tips,p=i.NameHidden,m=i.Default,v=i.Required,g=i.Images,y=void 0===g?[]:g,C=i.Title,h=(0,Se.isUndefined)(l)?m:String(l),E="".concat(o,"-bgimage"),b=(0,S.useState)(!1),I=(0,d.c)(b,2),T=I[0],x=I[1],A=(0,S.useState)(""),M=(0,d.c)(A,2),P=M[0],B=M[1],_=D().useState(null!=h?h:Ht(n.picture,h)),O=(0,d.c)(_,2),j=O[0],L=O[1];(0,S.useEffect)((function(){h&&L(Ht(n.picture,h))}),[h]),(0,S.useEffect)((function(){!h&&K(m)}),[]);var K=function(e){c||a(e)},V=D().createElement("div",null,D().createElement(w.Icon,{className:"".concat(E,"-content-upload-add"),type:"add"}),D().createElement("p",{className:"".concat(E,"-content-upload-text")},"上传自定义图片")),U={data:{action:"upload",tempstorage:!0},name:"file",action:"nocode/v2/nocode_sys/image",showUploadList:!1,listType:"picture",accept:_u.toString(),onChange:function(e){e.file},beforeUpload:function(e){if(F()(_u).call(_u,e.type)){P&&Ru().revokeObjectURL(P);var t=Ru().createObjectURL(e);return B(t),x(!0),!1}}};return D().createElement(D().Fragment,null,D().createElement(k.NameTipWrapper,{nameHidden:p,className:o,name:u,tips:f,required:v,title:C}),D().createElement("div",{className:"".concat(E,"-content")},N()(We).call(We,(function(e,t){var n=y[t]||y[0],r=zt(n);return D().createElement("div",{key:t,className:"".concat(E,"-content-item"),onClick:function(){return K(n)}},D().createElement("img",{className:"".concat(E,"-content-image"),src:r,alt:e.name}),D().createElement("div",{className:"".concat(E,"-content-handle")},D().createElement("span",{className:"".concat(E,"-content-text")},e.name),D().createElement("span",{className:jn()("".concat(E,"-content-uncheck"),(0,s.c)({},"".concat(E,"-content-check"),n===h))})))})),D().createElement(w.Upload,(0,R.c)({className:"".concat(E,"-content-upload")},U),j&&!F()(y).call(y,h)?D().createElement("img",{src:Gt(j),alt:"avatar",style:{width:"100%"}}):V),D().createElement(w.ImageCropper,{autoCropArea:1,imageMaxSize:20,containerWidth:800,containerHeight:588,aspectRatio:6,visible:T,title:"图片裁剪",image:P,onClose:function(){x(!1)},onCropSuccess:function(e){var t=new FileReader;t.readAsDataURL(e),t.addEventListener("load",(function(){var t;(t=e,new(jr())((function(e,n){var r=new FormData;r.append("file",t),r.append("action","upload"),r.append("tempstorage","true");var a=new XMLHttpRequest;a.open("POST",Bu),a.onload=function(t){200===this.status&&t.target.response?e(JSON.parse(t.target.response)):n(t)},a.onerror=function(e){n(e)},a.send(r)}))).then((function(e){var t=e.data;if("0"===e.errorCode){var l=(t||{}).url;if(!l)return;var o=Ht(n.picture,l);L(o),a(l)}else r("裁剪图片失败，请稍后重试")})).catch((function(e){r("裁剪图片失败，请稍后重试")})).finally((function(){return x(!1)}))}))},dragMode:"move",cropBoxMovable:!1,className:"".concat(E,"-content-cropper"),okText:"确定裁剪"})))};function ju(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ju(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):ju(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Ku=Un.treeUtils.exludeTreeNodeByCallback,Vu=[{value:1,label:"编辑"},{value:2,label:"禁用"},{value:3,label:"只读"},{value:4,label:"隐藏"},{value:5,label:"必录"},{value:6,label:"非必录"}],Uu=new(we())([[1,["NoCodeGraphicDisplayField"]],[2,["NoCodeGraphicDisplayField","NoCodeGroupContainerAp"]],[3,["NoCodeGroupContainerAp"]],[4,[]],[5,["NoCodeGraphicDisplayField","NoCodeGroupContainerAp"]],[6,["NoCodeGraphicDisplayField","NoCodeGroupContainerAp"]]]),Gu=function(e){var t=e.value,n=e.onChange,r=e.fieldOptions,a=(0,S.useState)(t||[]),l=(0,d.c)(a,2),o=l[0],i=l[1],c=(0,(0,S.useContext)(le).getKdesignerApi)().data,u=function(e,t){var r=xe()(o).call(o,(function(e,n){return n===t})).actionType;if(e!==r){var a=r<5&&e>4||e<5&&r>4,l=N()(o).call(o,(function(n,r){if(t===r){var l=n.fieldName,o=Uu.get(e)||[],i=Ft(l),u=v()(i).call(i,(function(e){var t,n=((null===(t=c.findControlByCondition((function(t){return t.Key===e})))||void 0===t?void 0:t[0])||{})._Type_;return F()(o).call(o,n)}));return a?{fieldName:[],actionType:e}:u.length?{fieldName:v()(i).call(i,(function(e){return!F()(u).call(u,e)})),actionType:e}:Lu(Lu({},n),{},{actionType:e})}return n}));i(l),n(l)}},s=function(e,t){var r=N()(o).call(o,(function(n,r){return t===r?Lu(Lu({},n),{},{fieldName:e}):n}));i(r),n(r)};return(0,S.useEffect)((function(){var e=t||[];(0,Se.isEqual)(e,o)||i(e)}),[t]),D().createElement("div",{className:"display-rule-true-actions"},D().createElement(w.ConfigProvider,{value:{prefixCls:"kd"}},N()(o).call(o,(function(e,t){var a,l=e.actionType,c=e.fieldName,d=Uu.get(l)||[],f=Ku(r,(function(e){var t=e.type,n=e.children;return!F()(d).call(d,t)||!!n.length})),p=si(f,"key"),m=v()(a=Ft(c)).call(a,(function(e){return F()(p).call(p,e)}));return D().createElement("div",{className:"row_item",key:t},D().createElement(w.Select,{className:"action-type-select",value:l,options:Vu,placeholder:"请选择",borderType:"bordered",size:"middle",onChange:function(e){return u(e,t)}}),D().createElement(Un.KDTreeSelect,{mode:"multiple",className:"field-name-select",virtual:!1,value:m,treeData:f,showFullLabelTips:!0,treeCheckStrictly:l>4,onChange:function(e){return s(e,t)}}),D().createElement(w.Icon,{className:"delete_icon",prefix:"ncicon",type:"xingshanchu",onClick:function(){return function(e){var t=(0,P.c)(o);ce()(t).call(t,e,1),i(t),n(t)}(t)}}))}))),D().createElement("div",{className:"footer-btns"},D().createElement("div",{className:"add-btn",onClick:function(){var e,t=h()(e=[]).call(e,(0,P.c)(o),[{actionType:"",fieldName:[]}]);i(t),n(t)}},D().createElement(w.Icon,{prefix:"nocodeplatformicon",type:"zengjia-yuan"}),"添加规则效果"),!!o.length&&D().createElement("div",{className:"clear-all",onClick:function(){i([]),n([])}},"清空")))};function zu(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Hu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zu(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):zu(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var qu=Un.treeUtils.dfs,Yu=Un.treeUtils.getListConfigPure,Wu=Un.ListFilterUtil.getVarSelectDisabled,Xu=function(e,t){return Hu(Hu({},e),t)},Zu=function(e){var t=e.prefixCls,n=e.value,r=e.fieldKey,a=e.ruleId,l=e.listFilterConfig,o=e.fieldOptions,i=e.onChange,c=w.Form.useForm(),u=(0,d.c)(c,1)[0],f=(0,S.useContext)(le),p=f.invokeAction,m=f.getKdesignerApi,g=f.baseUrl,y=f.batchInvoke,C=f.getControlText,h=f.onDownLoad,E=m(),b=E.data,I=E.meta,N=b.getRootId(),T=(0,S.useReducer)(Xu,n),A=(0,d.c)(T,2),M=A[0],P=A[1],R=(0,S.useState)({}),B=(0,d.c)(R,2),_=B[0],O=B[1],j=(0,S.useRef)(),L=Cc({id:r,formId:N,eventName:"filterItemLook"}),K=(0,S.useMemo)((function(){return Yu(l)}),[l]),V=(0,S.useMemo)((function(){return ui({metaApi:I,options:l})}),[l]);(0,S.useEffect)((function(){var e=L.data,t=L.param,n=(void 0===t?{}:t).enumField;if(n){var r,a=null===(r=M.preCondition)||void 0===r?void 0:v()(r).call(r,(function(e){return e.fieldName===n})),o=qu(l,(function(e){return e.key===n}));O((function(t){return Hu(Hu({},t),{},(0,s.c)({},n,{configuredFilter:{enumEqCompareType:"001",items:a},fieldFilterConfig:o,groupInfo:e}))}))}}),[L,M.preCondition,l]);var U=(0,S.useMemo)((function(){return!(null!=a&&F()(a).call(a,"new_rule_"))}),[n]),G={baseUrl:g,batchInvoke:function(e,t){y(e,r,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[])},getControlText:C,addControlAction:function(e,t){return k.eventBus.on(e,t),function(){k.eventBus.off(e,t)}},onDownLoad:h,batchInvokeListConfig:function(e){y("listconfig","nocodeformdesigner",[e])},batchInvokeQuery:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=v()(t),r=void 0===n?"":n,a=t.search,l=void 0===a?"":a,o=t.order_by,i=void 0===o?"":o,c=t.select,u=void 0===c?"":c,d=t.page_size,s=void 0===d?10:d,f=t.page_no,p=void 0===f?1:f,m=t.ids;y("query","nocodeformdesigner",[e,{filter:r,search:l,order_by:i,select:u,page_size:s,page_no:p,ids:void 0===m?[]:m}])}},z=(0,S.useCallback)((function(){var e,t,n=null===(e=j.current)||void 0===e||null===(t=e.updateVerifyAndGetMsg)||void 0===t?void 0:t.call(e);new(jr())((function(e,t){u.validateFields().then((function(t){var n=Ni()(t);e(n)})).catch((function(e){return t(e)}))})).then((function(e){var t=e.name;e=Hu(Hu({},e),{},{name:Xr()(t).call(t)});var r=Hu(Hu({},e),{},{formId:N,ruleType:"0"});U&&(r.ruleId=a),!n.length&&p("saveFormRule",[r])})).catch((function(e){}))}),[N,a,U]),H=(0,k.useDebounce)(z),q=function(e,t){P((0,s.c)({},e,t));var n=new(we())([["name","ruleName"],["preCondition","expression"],["trueAction","trueaction"]]).get(e)||e;i((0,s.c)({},n,t))};return D().createElement("div",{className:"display-rules-setting"},D().createElement("div",{className:"setting-form"},D().createElement(w.Form,{layout:"vertical",form:u,labelWidth:"100%",wrapperWidth:"100%",onValuesChange:function(e,t){}},D().createElement(w.Form.Item,{label:"规则名称",name:"name",required:!0,validateTrigger:"onBlur",rules:[{required:!0,message:"请输入规则名称"},{type:"string",validator:function(e,t,n,r,a){return null!=t&&Xr()(t).call(t)?[]:[new Error("请输入规则名称")]}}]},D().createElement(w.Input,{type:"text",borderType:"bordered",size:"middle",placeholder:"请输入规则名称",maxLength:50,value:M.name,onChange:function(e){return q("name",e.target.value)}})),D().createElement(w.Form.Item,{label:"当满足以下条件时",name:"preCondition",rules:[{type:"array",required:!0,message:"请添加判断条件"}]},D().createElement(Un.FilterEditor,{id:"filter",ref:j,valueRequired:!0,name:"添加判断条件",tips:"",variablesTree:V||[],listFilterConfig:K||[],onGetFieldRecords:function(e){!function(e){p("getFilterItemLook",[e,{getEnumData:"true",enumField:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",filterrows:[]}])}(N,e.fieldName)},fieldRecords:_,nameHidden:!0,style:{marginTop:"0px"},getVarSelectDisabled:Wu,fieldData:{fieldType:"treeSelect",style:{width:"184px"}},filterFooterData:{listType:"tree",triggerText:"添加判断条件"},value:M.preCondition||[],refBillProps:G,onChange:function(e){u.setFieldValue("preCondition",e),q("preCondition",e)}})),D().createElement(w.Form.Item,{label:"则执行",name:"trueAction",rules:[{type:"array",required:!0,validator:function(e,t,n,r,a){return null!=t&&t.length&&t.every((function(e){return x()(e).every((function(e){return"string"==typeof e?""!==e:!Array.isArray(e)||0!==e.length}))}))?[]:[new Error("请添加规则效果")]}}]},D().createElement(Gu,{prefixCls:t,value:M.trueAction,fieldOptions:o,onChange:function(e){return q("trueAction",e)}})))),D().createElement("div",{className:"setting-footer"},D().createElement(w.Button,{size:"small",type:"primary",onClick:H},"保存")))},Qu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcAAAAEACAMAAAATE1b1AAACQ1BMVEUAAADb3eja4uzZ3ejY3efg5OfY3enW3una3unV4unY3+nb5O3X3enY3ejb3ufX3ejX4ebN2OTW2+fX3OfY3OnX2+jY3enX3ejX3OfX3enW3ObV3efX3ejV3OXW3ePY3unX3OfX3OZloPrY3efX3ejW3u8AHWDd5O80Rm76zMJCU3kSKWItP2s8TXTr1tQnOmmLl7ItQGktQGktcvQoOmf8z8XY3en20sobMGYjOGk9e/MuQGm01v//zsIsP2jj6vXx1M8mN2r9z8JDU3r40cjz1M8mO2knWLkscvYCHV8zd/b7zsQsP2l3nOzW3OjW3Oe11v8DHl/d4+4zd/UAHF4MJGD/wrVQfuO01v8AHF612P+DneYncPf/v7Iscfri6PNriOJGT3fpraN4jt5TY4UocPdseZiDtvx3luS01/+MlbEocPbi6POz1f/W3Ocnb/UsPmiFuP/K0Nv/zcAAHF7Y5PWq0P+XxP97rPy92fzV2uXe5O+hyf+y0/3O1OD/s6tlc5OOvv+Wwf2z0PkrRHgjMVP21M6ZufNXlv0wdPVda43Q1+JAUHjv2tr+yL0/gvjY3+ojZeD80MV8iaVYZ4omNlrk5vBnnvro4uc0Rm3+wrdtephSYYQpOmKss8vE0fEnbO7m5OvFzd4hXs9LW39Ni/e0vNSircXrtrb/ubCVhZrS3vRkkOzr4OO7xNWbpbyHrfR2ovRWfuaLo+KpmsvcssCSnbbdrKq5maF3bIliXYAXLGeuwu+Di9bLts52htdyg6mPG3iNAAAAbHRSTlMAEgsaJgYiGB0PKwQhLxYpDgkfLTQVOD89SEMzRTclOzoyW0FLH4b9d/SRTMmFUTT88d3Ss7CSjSkS/vzz256SbR/HnIBcQAnu47Oei4nz1cm/vZ6AaVby4NBpX1A5IdXJtbKhhHdsaDSrUjldQMwIAAAMu0lEQVR42uzZQY3EMAxAUV96KZEwKIxWGhyRCQyJQt5dqVpNh4Hd9yh8WYmTAAAAAAAAAAAAAAAAAAAAAACAb+t27NnMfmxrPMOyZVPbEg+wvLKt1xMKtp2/P1u0t2Zr/c/B1gP4hBE8srUjumu3P9zt0V02co75a5z5IbrLPsa8DAEres9/77wIWMeYH4aA1Zzz5joHBSxjzJshYDHzi4DFCFicgMUJWJxLTHHWiOos8tV5SqvOY3Z1vpMaiu6yuegum4vusrno7oddu3tRIgrjOP5U9mZFQZRuSQXbTXRRN90sdFFERdFVVEQv9ELQxdOe9MzCprRzUahDOZIXJl5UtlTrtkGv9LK9/WnNzKozo44Fe5DOrz74Mnouv5zjOeo4OEI3Do7QjYMjdOPgCB2DI3QMjtAxOELH4AgdgyN0DI7QMThCx+AIHYMjdAyO0DE4QsfgCB2DI3QMjtAxOELH4AgdgyN0DI7QMThCx6ievnj0Yu/PvXsIHGN6et9oOXuYoDGk3F3Dd4qQMaLarBG0m4Axnmpe3jeCzhIwhlOrSDlvhBwgXIzG7Wcbxj+zhjKYV04/OeNE+3L/f0ANlaTro2HM75KfjTbkwyAjaeSlyzYNY9Z57uxFjxAuBlKSC+rmzc/S9Wn+/y5UH9W8bMnv+jwjPfan2dmPXy4TMEbh7l48lQaXPtrS9+UKAWMMgelXZea6DPh0moAxhFol1I8bMgB6AmIELMm2Ei/Iy46DBI3118j7/XqTSugFFCFgoNUrbqvKtv2EjTUXmH6VGvs6b18gbKy3kvT7NUIDtvQcJ3Css5r05avhsqZ7lLCb4J+AgwPmslOZzFQ2p2Zcvar0VWockjdNs9k0TegVdMParSmOls20ZJWMq5eXHfW6fDdXeBwM6EIOuDo2utPBke5lOu6pHVcfsG5L+VYIYc29+/qSHS8LM6br+QmCtGatU88zaP75sirH1Qe03YaWaBmbm3szmU5/MM2ZQjp98tr5iwRmaTw10sYRcpmQnNpx9XsY+UEEFdPp9He336RwHD128hzBWB4fCYiegCFZtePqDxH2exFkpZ12D52HZ515ibKYrkiN/EnAqUzIlNLxiUUJ/QhRkQua34TrgWh5mC4Wi88mJ4XvKgFYkhwJ4wiZLurGJ27dWJTbdzio+sqNaJtvwwGtslUslq2y8I0tJd2tWZ/qNvSAEzcW6Xb6DneplWzTCgT0uAFFiPaL6NJkqsfQl9Bbiw/oF/Q9Fq4nkQHdvpdIbyu3pHoNfRNzQ0HAPgULCxNw4Aw8Q1qLpfoZ9jFiQknA3oKFMS/gtPCVy5YIGSOdxbf0NayDvOKAvQX58euymJ4WUZ44902kr3Vb+hvSV2mKA/oFww3fnRkYUOPTvN+vy3C+zFYbMLogvxRRHmh9EoyPRhnKz0nKA0YXjA6o8zZ0W8Ixmhj1OBcBPATqA0YXtCIDarwNXZUIQwnYr2A56iPQ3d5YpKXVCdSAfQo+GxRQXCcNLd+c9CSSCefmPTu8awf/xt8dsLfgw6gVdPrtt/cftPyHzMZkFICAPQXfiP5+mM26lIdIPyuT0AG7C74W/b23pWMfaWf55u0D8W/89QG7ChZEf4/af9PesGxFLL4uHluxcgPpIOZl2rF9h8e5aL/2rncABAwX/NXOff0qDcUBHP9RNsLFgTiuuPeece+9Emdi1GhM3P4UTN0rzjgTTdQY44xxvKlPPhn/Ng8t0IJtT738xB74fW5Dlz59Q8s55d6fRWe/dMOg0XbDsoGfXEsOl0AJBQLWFXxXdDZBNywb3WBIJtiPeVN5CZRQIaAoKJ1L001zB/2pOwmBlcx3REB7waKjdbppziAnuRAEVCpfKOQL+ToF41h1jd4UCWgruKDoZJZumjDIWRYCqXdB5v8FvHrO7m8C3nRy0XsqZoNeMcjFsEDeCmOFXEEsuVxlbag79v8CXjltc+Nks2oBX0gCDnGTgMDplZNDCeUCOk/FbF6sm6YOdhW8y2i8EwN+dw44VzctG+wuAgGT6pZDCeUCOk/F7Jmqm1aN8hCwgtHuTgx4q+hkyIAJlYHgAC8xCJKuET6ghHIB3zkOAwcMWKEbNg7wFIYAiWV8QAnlAp51HAYOHDi3MpIf6GlYHwiOTEcGxPfOAZfphhUDvWUgMLTODPj5toPJw4YN1g2Lh0kk4L/RQl3xcDgeD2lQFupXL9MvkxEvDVBCuYAPSk4ODx9ujgQnDJfIa/A/JMMRM5AZKhbXIGHsN8Zr94BPFpacHMjn5+iGgXmJCLScFk79WSb157FOCPi55GhmPr9KN0y15vMF+3Z1PwqtpaVTTUAJ1QJ+KTkrFCpD+dUFmb7QSr0SqZSSAUlZAaeXnB3P5cyh/LKcTHcvaJ1kNsUB7QGflpwdzuXMofzcnFQcWiaebRZKqBbwVcnZwe7ujeZUTLdUFlolkeWADQGvuwUcMcIcys8ZIReFlojGIjLZSFYsXsdQQrWAD0rOJmYyo8ypmIxcCFoiFmlCuwZ8XXK2UnQxhvKLM3IJaIVEhAP+XUBjKD8hIxeBPl3pSLZfKhJLhOAf6YpwQIeAz9wCikkL84FErp9c1r6T/icNk0OrIkMjYjHWgve2/d+b0C/6b6WR8B1QDJlW62WDUn9tqAbUojEi6Bf9TAyJvwmYMadiUp6yqaxYUg36ArEwB5QHXGgPmBXMgWC2J4ZGgZIW44DygC/twwhxExloPlCK9IxG/QZMx9IGsSGW+rUgVm7naucFlFA54KNS6Y094FTdMDXSI5TvQS1Not0Dfiw9v+MQcFmkZ9JAJs4Bq7xmYl7fufO8FlB84q4EnDvUTWxorEysHPfDQGVM3zF9/yAOisVaN5wTnM6jhMoBH9gDig6r9VWrywFjPaUBjd61MIm+CbH42xYvgrFdk2jrgK8aAk7VB8ZW6PqqWE+FgUZXgg76Qx/w3HkSXgGf3rljfYgRt4sRc9LpVWIgmO4xDUgk2iEgEa+AP+wB+5pGiWFE3x6LA4Vo2FMinBBL2CeUUDngW3vA6h1kzjLrjmJpPOZ2DihoIpL7jxVS/tPeAV9+tQWckiCh0XwH1Ad+B5YeXbtzp1QLGCYRAgKhcFPaO+B12zj+SVADxgmhhMIBn+Fz8oBdHFASgjDgdXxpCxinwQElIQgDPsVHz4MZsOsP8a64WBz2pZAO/UC+2YCvbQG7aNAEbE4wAvqYSrvRXMAfeN0WsD8NkoD9CaGEwgG/4Ssr4PgQDSCQDNXpH+ovFqd992MWlFA44Ft8qkTAv9YpAb/idA6ICgf8gN/eWAGTNIBAbw7oK+AlfPsXAXsne4vFbZsD/oeAiJ9tAXvTIAmYJIQS6gZ8ifihZAXUaAABrS0CXj0n11TAR4gPAxqw8QJtrk3WfuPaOmf//+iDmlNprxEvBzYgHZRQLaD1K9YPEPGlFbAPDZKAlFBC3YCvEPGRFTBKAwj04YB+LqFPEfEjB0SlAz6zAvbyIdorGhUvXvgSKglBF3C6sWcFpAEE+pi0PppYnLcFsbKOOzDPtV3AB9bDiLo74ngIjmgfQiijbMAvdX+3aQoER5QSyigW0Lrrva0LuAmCgwP6CvgZEadzQNUCvrY9DkT8EciAvTign4AfEPFbMANSQhnFAlpD94d1f/51CQQHB/QV8Akivg1kQFIooVpAa/YTha8cEFUN+BKFDxwQVQ34CIVrHFCVgCcbA35E4VSpaja0qXHoTdmAr7Gs/QPuR2+qBXxpPZA3dts+4FL0pmzA61g2o+0D9kMZtQIutH2jQpjZ9gH9vAVVClj3QB6XTq7uToZ2Fd2GXpQOuC3aAQEhuhTdqRbwsv0bFUujMLsDAgL0W7p/HP5jd6suNOO8LOA4K+DSfgCwpCMCtkKRxAXXfovAML9UNQmAA6ofcFN1dyYwtQKugbLxHFCtgMtLVdM4IKl1RQov/AdcDmU7OSCRWf844K7GgPOhbFJ1dwawpmwoUrjnGnALGOaVqtZC2RoOSORQkcL9q24BdzcEXAiGaRyQyL4iCddfm9ecg83jgMG6Cd7zvoJaAWc23BMXAmvOiSIJl8m0iEtAa1wIrEnbixQ+Od4Fj0HFmsapMw5IZu2/G0nsglrAGQ0PcBdWrqB8D2zevn9VcJcGNcvXnxG2TpsHpmlrzAPAmreWaDB41fEDjGnrGcMkqBprHhgLjMBekjfhggv2ObTdYLPjjGk2VK0/U03KSBJup5gVffzi5lWj3pbdYDfvTMX6P4+sBUZj7dGRFI4c6Y5Cg61nquaBaafY5ouoKiadqZlk3QKr5gMLuPk7xlbsqNaaVzu0ExhjjDHGGGOMMcYYY4wxxhhjjDHGGGN/7zcWyc9ypV5uJAAAAABJRU5ErkJggg==";function Ju(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function $u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ju(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Ju(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var ed=Un.treeUtils.exludeTreeNodeByCallback,td=function(e){var t=e.handleAdd;return D().createElement("div",{className:"rule-empty"},D().createElement("img",{src:Qu,alt:"暂无卡片",width:224,height:128}),D().createElement("div",{className:"empty-text"},"暂无规则，点击下方按钮添加"),D().createElement(w.Button,{type:"primary",icon:D().createElement(w.Icon,{prefix:"nocodeplatformicon",type:"zengjia-yuan"}),onClick:t},"添加规则"))},nd=function e(t,n,r,a){return t.reduce((function(t,l){var o=l._Type_,i=l.Name,c=l.Key,u=l.BillEntityIdEx,d=l.SelectItemType,s=l.Multi,f=l.children,p={title:i,titlePrefix:rn(l,n,r,a),key:c,type:o,entityId:u,isMulti:1===d||1===s};return f&&(p.children=e(f,n,r,a)),h()(t).call(t,p)}),[])},rd=(0,S.forwardRef)((function(e,t){var n=e.prefixCls,r=e.field,a=e.refreshEditorDisplay,l=(0,S.useState)(),o=(0,d.c)(l,2),i=o[0],c=o[1],u=(0,S.useState)(null),s=(0,d.c)(u,2),f=s[0],p=s[1],m=(0,S.useContext)(le),g=m.invokeAction,y=m.getDisplayRules,C=m.setDisplayRules,E=m.getCompareTypes,b=m.getKdesignerApi,I=m.curListTreeApi,T=m.getRefBillNameMap,x=b(),A=x.data,M=x.meta,R=E(),B=r.Key,_=(A.getRootId(),hc({api:I,parser:function(e){return $t(e,e,R)}})),O=(0,S.useMemo)((function(){return an(_)}),[_]),j=(0,S.useMemo)((function(){var e,t=A.getData().Items||[],n=ed((null===(e=fi(t)[0])||void 0===e?void 0:e.children)||[],(function(e){var t=e._Type_,n=e.BillEntityIdEx,r=e.showType,a=e.children;return!(!Kt(t)||null==a||!a.length)||(ot(t)?"1"!==r:$e(t)?!(null!=e&&e.RefTableId&&"2"===(null==e?void 0:e.ShowType)):!(ct(t)||("NoCodeMulRefBillField"===t||"NoCodeRefBillField"===t)&&void 0===n))}));return nd(n,O,M,T())}),[O,T]),L=(0,S.useCallback)((function(){var e=(null==f?void 0:f.length)||0,t="new_rule_".concat((0,k.createUUid)()),n={ruleId:t,ruleName:"规则".concat(e+1),depfldkeys:"",affectfldkeys:"",expression:[],trueaction:[]};p(f?h()(f).call(f,n):[n]),c(t)}),[f]),K=function(e){var t=(null==f?void 0:Kr()(f).call(f,(function(t){return t.ruleId===e})))||0,n=i;if(i===e){var r=t>0?f[t-1]:void 0,a=f[t+1];r?n=r.ruleId:a&&(n=a.ruleId)}return n},V=function(e,t,n){e.stopPropagation(),null===Un.WebMsg||void 0===Un.WebMsg||Un.WebMsg.showConfirmModal({title:"确定删除".concat(t,"吗？"),type:"delete",onAction:function(e){if("ok"===e)!function(e){if("string"==typeof e&&F()(e).call(e,"new_rule_")){var t=K(e);c(t),p((function(t){return null==t?void 0:v()(t).call(t,(function(t){return t.ruleId!==e}))}))}else g("deleteFormRule",[e])}(n)}})},U=(0,S.useCallback)((function(e){p(e),e.length&&c(e[0].ruleId)}),[]),G=function(e){p((function(t){return null==t?void 0:N()(t).call(t,(function(t){return t.ruleId===i?$u($u({},t),e):t}))}))};(0,S.useEffect)((function(){var e=function(e){U(e),a()};return k.eventBus.on(ar,e),function(){k.eventBus.off(ar,e)}}),[]),(0,S.useEffect)((function(){var e=function(e){var t=K(e);c(t),p((function(t){return null==t?void 0:v()(t).call(t,(function(t){return t.ruleId!==e}))})),function(e){var t=y();C(null==t?void 0:v()(t).call(t,(function(t){return t.ruleId!==e}))),a()}(e)};return k.eventBus.on(or,e),function(){k.eventBus.off(or,e)}}),[p,i]),(0,S.useEffect)((function(){var e=function(e){G(e),c(e.ruleId),function(e){var t=y(),n=$u($u({},(null==f?void 0:xe()(f).call(f,(function(e){return e.ruleId===i})))||{}),e),r=null!=i&&F()(i).call(i,"new_rule_")?h()(t).call(t,n):N()(t).call(t,(function(e){return e.ruleId===i?n:e}));C(r),a()}(e)};return k.eventBus.on(lr,e),function(){k.eventBus.off(lr,e)}}),[p,i]),(0,S.useImperativeHandle)(t,(function(){return{getRules:function(){return null==f?void 0:N()(f).call(f,(function(e){var t="null"===e.depfldkeys?"":e.depfldkeys,n="null"===e.affectfldkeys?"":e.affectfldkeys;return $u($u({},e),{},{depfldkeys:t,affectfldkeys:n})}))}}}),[f]);var z=(0,S.useMemo)((function(){var e=(i?null==f?void 0:xe()(f).call(f,(function(e){return e.ruleId===i})):{})||{},t=e.ruleName,n=void 0===t?"":t,r=e.expression,a=void 0===r?[]:r,l=e.trueaction;return{name:n,preCondition:a,trueAction:void 0===l?[]:l}}),[i,f]);return f?D().createElement("div",{className:"".concat(n,"-main")},f.length?D().createElement(D().Fragment,null,D().createElement("div",{className:"left-area"},D().createElement("div",{className:"rule-list"},null==f?void 0:N()(f).call(f,(function(e){var t,n,r=e.ruleName,a=e.ruleId,l=e.depfldkeys,o=e.affectfldkeys;return v()(t=(0,P.c)(new(vn())(h()(n=[]).call(n,(0,P.c)(l.split(",")),(0,P.c)(o.split(",")))))).call(t,Boolean),D().createElement("div",{className:jn()("rule-item",{"is-active":i===a}),key:a,onClick:function(){return c(a)}},D().createElement("div",{className:"rule-name"},r,D().createElement(w.Icon,{prefix:"ncicon",type:"jingshi",className:jn()("warning-icon",{show:!1})})),D().createElement("div",{className:"tags"},F()(l).call(l,B)&&D().createElement("span",{className:"tag-item"},"触发"),F()(o).call(o,B)&&D().createElement("span",{className:"tag-item"},"受影响的")),D().createElement("div",{className:"delete-btn",onClick:function(e){return V(e,r,a)}},D().createElement(w.Icon,{prefix:"designericon",type:"shanchu"})))}))),D().createElement("div",{className:"add-rule",onClick:L},D().createElement("span",{className:"add-btn"},D().createElement(w.Icon,{prefix:"designericon",type:"zengjia-yuan"}),"新增规则"))),D().createElement("div",{className:"right-area"},D().createElement(Zu,{key:i,prefixCls:n,value:z,fieldKey:B,ruleId:i,listFilterConfig:_,fieldOptions:j,onChange:G}))):D().createElement(td,{handleAdd:L})):null})),ad=function(e){var t=e.prefixCls,n=e.title,r=e.visible,a=e.setVisible,l=e.field,o=e.refreshEditorDisplay,i=(0,S.useRef)(null),c=function(){a(!1)};return D().createElement(w.Modal,{mask:!0,visible:r,body:D().createElement(rd,{ref:i,prefixCls:t,field:l,refreshEditorDisplay:o}),titleIcon:null,className:"".concat(t,"-modal"),footer:null,maskClosable:!1,width:960,height:520,keyboard:!1,title:D().createElement("span",{title:n},n),closable:!0,draggable:!1,destroyOnClose:!0,onCancel:c,onOk:c})},ld=function(e){var t=e.locked,n=e.field,r=n.Name,a=n.Key,l=(0,S.useState)(!1),o=(0,d.c)(l,2),i=o[0],c=o[1],u=(0,S.useContext)(le),s=u.invokeAction,f=u.prefixCls,p=u.getKdesignerApi,m=u.getDisplayRules,v=u.fetchListTree,g=p().data.getRootId(),y=m(),C=(0,S.useReducer)((function(e){return e+1}),0),h=(0,d.c)(C,2)[1],E=function(){s("getFormRules",[{formId:g,fieldKey:a}]),v(),c(!0)},b=(0,S.useMemo)((function(){var e=y.reduce((function(e,t){var n=t.affectfldkeys,r=t.depfldkeys;return null!=n&&F()(n).call(n,a)||F()(r).call(r,a)?e+1:e}),0);return 0!==e?"".concat(e,"条规则"):""}),[y,a]),I="".concat(f,"-displayrules");return D().createElement(D().Fragment,null,D().createElement(k.CustomInputTrigger,(0,R.c)({},e,{placeholder:"请选择",disabled:t,value:b,onClick:E,onInputClick:E})),D().createElement(ad,{prefixCls:I,visible:i,setVisible:c,field:n,title:"".concat(r,"-显示规则"),refreshEditorDisplay:h}))},od=function(e){var t=e.value,n=e.className,r=e.field,a=r._Type_,l=r.DefaultLines,o=r.MaxLength,i={className:"".concat(n,"-text-def-editor"),fieldType:"text",placeholder:"请输入",maxLength:o};return function(e){return"NoCodeTextAreaField"===e}(a)&&(i.fieldType="textarea",i.autoSize={minRows:l||1,maxRows:l||1}),D().createElement(Bc,(0,R.c)({},e,{editorType:"textDef",value:t,inputFieldProps:i}))};function id(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function cd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?id(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):id(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var ud={},dd=(0,S.memo)((function(e){var t,n,r=(0,S.useContext)(le),a=r.invokeAction,l=r.getKdesignerApi,o=e.handleChange,i=e.value,c=e.className,u=e.editor,d=(e.locked,e.Name),s=e.Tips,f=e.field,p=(e.id,u.Enum,u.NameHidden),m=u.Default,v=u.Required,g=u.HasCheck,y=u.Title,C=l().data.getRootId(),h=i;try{g&&"object"===(0,he.c)(JSON.parse(i))&&(h=JSON.parse(i))}catch(e){g&&(h={})}var E=void 0===(null===(t=h)||void 0===t?void 0:t.enable)?null==m?void 0:m.enable:h.enable,b=(0,S.useCallback)((function(e){return Array.isArray(e)&&(null==e?void 0:N()(e).call(e,(function(e){return cd(cd({},e),{},{label:e.name,value:e.id})})))||[]}),[]),I=Cc({id:f.Key,formId:C,eventName:"setTriggerProcess",parser:b});null!=I&&I.length&&(ud[C]=I),(0,S.useEffect)((function(){ud[C]||a("getTriggerProcess",[])}),[C]);var T=(0,S.useCallback)((function(e){if(g){var t=cd(cd({},h),{},{value:e});o(Kl()(t))}else o(e)}),[o,h,g]),x=(0,S.useMemo)((function(){return{name:d,className:c,nameHidden:p,tips:s,required:v,title:y}}),[d,c,p,s,v,y]),A=(0,S.useMemo)((function(){return cd(cd({},e),{},{editor:cd(cd({},e.Editor),{},{NameHidden:!0})})}),[e]);return D().createElement("div",{className:"".concat(c,"-trigger-process")},g?D().createElement(k.NameTipSwitchWrapper,(0,R.c)({switchValue:E,onSwitchChange:function(e){var t=cd(cd({},h),{},{enable:e});o(Kl()(t))}},x)):D().createElement(k.NameTipWrapper,x),(!g||E)&&D().createElement(k.EditorPropertySelect,(0,R.c)({},A,{value:g?null===(n=h)||void 0===n?void 0:n.value:i,options:Array.isArray(ud[C])?ud[C]:[],scrollHidden:!1,onChange:T,handleChange:T})))}));dd.displayName="TriggerProcessEditor";var sd=(0,k.ErrorBoundaryWrap)(dd,"TriggerProcessEditor");function fd(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function pd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fd(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):fd(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var md=Un.treeUtils.getListConfigPure,vd=Un.treeUtils.treeNodeTransform,gd=Un.treeUtils.dfs,yd=Un.ListFilterUtil.getVarSelectDisabled,Cd=(0,S.forwardRef)((function(e,t){var n,r,a=e.prefixCls,l=e.field,o=e.formId,i=e.value,c=e.onChange,u=(0,S.useContext)(le),f=u.invokeAction,p=u.baseUrl,m=u.onDownLoad,g=(u.getBaseHooks,u.getKdesignerApi),y=u.getCompareTypes,C=u.getControlText,E=u.batchInvoke,b=u.curListTreeApi,I=u.getHideFieldRef,T=g(),x=T.data,A=T.meta,M=I(),P=l.Key,R=l._Type_,B=l.ParentId,_=null===(n=M[l.RefBillId])||void 0===n?void 0:n.Key,O=x.findControl(B),j=O.RefBillId,L=O._Type_,K=null===(r=M[j])||void 0===r?void 0:r.Key,V=(x.getRootId(),(0,S.useState)({})),U=(0,d.c)(V,2),G=U[0],z=U[1],H=(0,S.useRef)(null),q=(0,S.useRef)(null),Y=(0,S.useRef)([]),W=y();(0,S.useImperativeHandle)(t,(function(){return{updateVerifyAndGetMsg:function(){return q.current.updateVerifyAndGetMsg()}}}),[]);var X=Cc({id:P,formId:o,eventName:"filterItemLook"}),Z=(0,S.useMemo)((function(){return Array.isArray(i)?N()(i).call(i,(function(e){return pd(pd({},e),{},{value:"string"==typeof e.value?JSON.parse(e.value):e.value||[]})})):[]}),[i]),Q=(0,S.useCallback)((function(e){f("getFilterItemLook",[e,{getEnumData:"true",enumField:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",filterrows:[]}])}),[f]),J=(0,S.useCallback)((function(e){Q(o,e.fieldName)}),[Q]),$=hc({api:b,parser:function(e){return $t(e,e,W)}}),ee=hc({api:b,parser:function(e){var t,n,r=$t(e,e,W,4),a=_||P,l=ot(L)?Fe()(t=h()(n="".concat(K,".")).call(n,P)).call(t,0,-4):a,o=gd(r,(function(e){return e.key===l}));return vd((null==o?void 0:o.children)||[],(function(e){var t=e.key,n=l.replace(/\./g,"\\."),r=t.replace(new RegExp("^"+n+"\\.(\\S+)"),"$1");return!((null!=r&&F()(r).call(r,"fbasedataid")?r.split(".fbasedataid")[0]:r).split(".").length>2)&&pd(pd({},e),{},{key:r})}))}}),te=(0,S.useMemo)((function(){return ct(R)?$:ee}),[R,$,ee]),ne=(0,S.useMemo)((function(){return ui({metaApi:A,options:$})}),[$]),re=(0,S.useMemo)((function(){return md(te)}),[te]);(0,S.useEffect)((function(){var e=X.data,t=X.param,n=(void 0===t?{}:t).enumField;if(n){var r=null==Z?void 0:v()(Z).call(Z,(function(e){return e.fieldName===n})),a=gd(te,(function(e){return e.key===n}));z((function(t){return pd(pd({},t),{},(0,s.c)({},n,{configuredFilter:{enumEqCompareType:"001",items:r},fieldFilterConfig:a,groupInfo:e}))}))}}),[X,Z,te]);var ae=(0,S.useCallback)((function(e){Y.current.length<e.length&&e.length>7&&setTimeout((function(){return H.current.scrollTo(0,1e4)}),100),Y.current=e}),[]),oe={baseUrl:p,batchInvoke:function(e,t){E(e,P,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[])},getControlText:C,addControlAction:function(e,t){return k.eventBus.on(e,t),function(){k.eventBus.off(e,t)}},onDownLoad:m,batchInvokeListConfig:function(e){E("listconfig","nocodeformdesigner",[e])},batchInvokeQuery:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=v()(t),r=void 0===n?"":n,a=t.search,l=void 0===a?"":a,o=t.order_by,i=void 0===o?"":o,c=t.select,u=void 0===c?"":c,d=t.page_size,s=void 0===d?10:d,f=t.page_no,p=void 0===f?1:f,m=t.ids;E("query","nocodeformdesigner",[e,{filter:r,search:l,order_by:i,select:u,page_size:s,page_no:p,ids:void 0===m?[]:m}])}};return D().createElement("div",{className:"".concat(a,"-modal-body"),ref:H},D().createElement(w.ConfigProvider,{value:{prefixCls:"kd"}},D().createElement(Un.FilterEditor,{ref:q,valueRequired:!0,nameHidden:!0,id:"filter",name:"配置筛选条件",tips:"",style:{marginTop:"0px"},fieldData:{fieldType:"treeSelect",style:{width:"184px"}},filterFooterData:{listType:"tree",triggerText:"添加筛选条件",treeProps:{defaultExpandAll:!1}},variablesTree:ne||[],listFilterConfig:re||[],fieldRecords:G||[],value:Z,refBillProps:oe,onChange:function(e){var t=e;Array.isArray(e)&&(t=N()(e).call(e,(function(e){return pd(pd({},e),{},{value:"object"===(0,he.c)(e.value)?Kl()(e.value):e.value||""})}))),c(t),ae(e)},onGetFieldRecords:J,getVarSelectDisabled:yd})))})),hd=function(e){var t=e.prefixCls,n=e.onCancel,r=e.onConfirm;return D().createElement("div",{className:"".concat(t,"-modal-footer")},D().createElement("div",{className:"".concat(t,"-modal-footer-right")},D().createElement(w.Button,{size:"small",className:"".concat(t,"-modal-footer-btn"),onClick:n},"取消"),D().createElement(w.Button,{size:"small",type:"primary",className:"".concat(t,"-modal-footer-btn"),onClick:r},"确定")))},Ed=(0,S.memo)((function(e){var t=e.prefixCls,n=e.title,r=e.value,a=e.formId,l=e.field,o=(e.fieldData,e.visible),i=e.setVisible,c=e.onChange,u=(0,S.useState)(r),s=(0,d.c)(u,2),f=s[0],p=s[1],m=(0,S.useRef)();(0,S.useEffect)((function(){p(r)}),[r]);var v=function(){i(!1),p(r)};return D().createElement(w.Modal,{mask:!0,visible:o,body:D().createElement(Cd,{ref:m,prefixCls:t,field:l,formId:a,value:f,onChange:function(e){p(e)}}),titleIcon:null,className:"".concat(t,"-modal"),footer:D().createElement(hd,{prefixCls:t,onCancel:v,onConfirm:function(){var e,t,n=null===(e=(t=m.current).updateVerifyAndGetMsg)||void 0===e?void 0:e.call(t);null!=n&&n.length||(null==c||c(f),v())}}),maskClosable:!1,width:640,height:520,keyboard:!1,bodyStyle:{padding:0,overflow:"hidden"},title:n,closable:!0,draggable:!1,destroyOnClose:!0,onCancel:v,onOk:v})}));Ed.displayName="LimitSelectRangeModal";var bd=Ed;function Id(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Nd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Id(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Id(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Td=(0,S.memo)((function(e){var t,n=e.handleChange,r=e.value,a=e.className,l=e.editor,o=e.locked,i=e.Name,c=e.Tips,u=e.field,s=l.NameHidden,f=l.Required,p=l.Default,m=l.Title,v=p.showEnable,g=u._Type_,y=(0,S.useState)(!1),C=(0,d.c)(y,2),h=C[0],E=C[1],b=void 0===r.enable?p.enable:r.enable,I=(0,S.useContext)(le),N=I.prefixCls,T=I.getKdesignerApi,x=I.fetchListTree,A=T(),F=A.data,M=A.meta,w=(0,S.useMemo)((function(){return $e(g)||ot(g)?u.BillEntityIdEx||M.getControlPropertyDefaultValue(u.FieldType,"BillEntityIdEx"):F.getRootId()}),[g,F,null==u?void 0:u.BillEntityIdEx]),P=(0,S.useCallback)((function(e){n({enable:b,value:e})}),[n,b]),B="".concat(N,"-enablefilter-editor"),_=Nd(Nd({},l),{},{NameHidden:!0}),O=(0,S.useMemo)((function(){return{name:i,className:a,nameHidden:s,tips:c,required:f,title:m}}),[i,a,s,c,f,m]);return D().createElement("div",{className:B},v?D().createElement(k.NameTipSwitchWrapper,(0,R.c)({switchValue:b,onSwitchChange:function(e){var t=Nd(Nd({},r),{},{enable:e});n(t)}},O)):D().createElement("div",{className:"".concat(a,"-nav")},D().createElement(k.NameTipWrapper,O)),b&&D().createElement(D().Fragment,null,D().createElement(k.CustomInputTrigger,(0,R.c)({},e,{editor:_,disabled:o,value:(null==r||null===(t=r.value)||void 0===t?void 0:t.length)>0?"".concat(r.value.length,"个条件"):"",onClick:function(){E(!0),x()}})),D().createElement(bd,{formId:w,field:u,prefixCls:B,visible:h,setVisible:E,value:(null==r?void 0:r.value)||[],title:i,onChange:P})))}));Td.displayName="EnableFilterEditor";var xd=(0,k.ErrorBoundaryWrap)(Td,"EnableFilterEditor"),Ad=window.__kd_cdnPath__||window.__domainurl__,Fd=Gt(window.__domainurl__+"nocode/v2/nocode_sys/image"),Sd=(0,S.memo)((function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.editor,l=e.Name,o=e.Tips,i=e.field,c=a.NameHidden,u=a.Required,s=a.Title,f=i.FieldType,p=(0,S.useContext)(le).baseUrl,m=void 0===p?{}:p,v=(0,S.useRef)(""),g=(0,S.useState)(!1),y=(0,d.c)(g,2),C=y[0],h=y[1],E="".concat(r,"-richtext-def-editor"),b=(0,S.useMemo)((function(){return dt(f)}),[f]),I=b&&qt(n)?Yt(n):n,N=(0,S.useCallback)((function(e){v.current=e}),[]);(0,S.useEffect)((function(){v.current=I}),[I]);var T=function(){h(!1)},x=(0,S.useMemo)((function(){return D().createElement("div",null,D().createElement(Un.RichText,{width:780,toobarMode:"scrolling",content:I,srcUrl:Ad,imageUrlPrefix:window.origin,imagesUploadUrl:Fd,pictureServer:m.picture,onChange:N,resize:!1,hasFullScreen:!1}))}),[I,m.picture,N]);return D().createElement("div",{className:E},D().createElement("div",{className:"".concat(E,"-name-tip")},D().createElement(k.NameTipWrapper,{nameHidden:c,className:r,name:l,tips:o,required:u,title:s})),D().createElement(Un.BtnField,{className:"".concat(E,"-edit-btn"),type:"primary",text:"编辑默认值",onClick:function(){h(!0)}}),C&&D().createElement(w.Modal,{width:780,height:482,className:"".concat(E,"-modal"),visible:C,title:"".concat(b?"富文本":"图文展示","-默认值"),body:x,onCancel:T,footer:D().createElement("div",{className:"".concat(E,"-footer")},D().createElement(Un.BtnField,{size:"small",style:{marginRight:"12px"},onClick:T},"取消"),D().createElement(Un.BtnField,{size:"small",type:"primary",onClick:function(){var e=v.current,n=Kl()({value:e,valueType:0});e!==n&&t(b?n:e),h(!1)}},"确定"))}))}));function Dd(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function kd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dd(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Dd(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Md=Un.treeUtils.dfs,wd=D().memo((function(e){e.handleChange;var t=e.value,n=e.className,r=e.editor,a=(e.locked,e.Name),l=e.Tips,o=e.field,i=e.id,c=e.propName,u=r.NameHidden,f=r.Required,p=r.Title,m=o||{},g=(m.DataFill,m.Name),y=m.SelectBillPid,C=m.RefTableId,h=m.RefBillId,E=m.ShowType,b=m.SourceForm,I=m.inner2Outer,T=m.Key,x=(0,S.useContext)(le),A=x.invokeAction,F=x.getKdesignerApi,M=(x.prefixCls,x.billPropsData),R=x.dispatchBillData,B=F(),_=B.data,O=B.controlCacheApi,j="".concat(n,"-bill-type"),L=(0,S.useState)((0,P.c)((null==M?void 0:M.appFormList)||[])),K=(0,d.c)(L,2),V=K[0],U=K[1],G=(0,S.useRef)(null),z=(0,S.useRef)(null),H=(0,S.useRef)(O.hasCache("controlId",i)),q=(0,S.useState)(!0),Y=(0,d.c)(q,2),W=Y[0],X=Y[1],Z=(0,S.useCallback)((function(e){var t=e.children,n=void 0===t?[]:t;n[0].icon=D().createElement(w.Icon,{prefix:"nocodeplatformicon",type:"gerenzhongxin",style:{color:"#3987ED"}}),n[1].icon=D().createElement(w.Icon,{prefix:"nocodeplatformicon",type:"zuzhi",style:{color:"#3987ED"}});var r=Aa(n),a=(0,d.c)(r,2),l=a[0],o=a[1];R({key:qr,payload:{data:l,innerForm:o}}),U(l)}),[]),Q=(0,S.useCallback)((function(){var e={showTree:"true",ignoreCosmicForm:"true"};Array.isArray(y)&&(e.parentId=y[y.length-1]),"2"===b&&A("click",[i,"entitymeta",c,e])}),[b]),J=(0,S.useCallback)((function(e){var t=e[o.Key]||[];0===t.length||"1"===b?X(!0):(null==t?void 0:t.length)>0&&X(!1)}),[]);(0,S.useEffect)((function(){return"1"!==b&&Q(),H.current&&"1"!==b&&X(!1),H.current||k.eventBus.on(mr,J),k.eventBus.on(ur,Z),k.eventBus.on(dr,$),function(){H.current||k.eventBus.off(mr,J),k.eventBus.off(ur,Z),k.eventBus.off(dr,$)}}),[]),(0,S.useEffect)((function(){var e,n=t&&(null===(e=Md(V,(function(e){return e.key===t})))||void 0===e?void 0:e.title)||"关联表单";k.eventBus.emit("".concat(T,"_refbill"),{formName:n})}),[t,V]);var $=function(e){var t;U((function(t){return ee(t,z.current,Aa(e,{isAsyncNode:!0})[0])})),null===(t=G.current)||void 0===t||t.call(G),G.current=null},ee=function e(t,n,r){return N()(t).call(t,(function(t){return t.key===n?null!=r&&r.length?kd(kd({},t),{},{children:r,isLeaf:!0}):kd(kd({},t),{},{isLeaf:!0}):t.children?kd(kd({},t),{},{children:e(t.children,n,r)}):t}))},te=(0,S.useCallback)((function(e,t){var n=kd((0,s.c)((0,s.c)({},c,e),"PropsDisplay",""),t),r=[[i,n]];if("2"===E){var a,l=v()(a=_.getAllSubControlIds(i)).call(a,(function(e){return e!==i}));_.deleteControl((0,k.createDeleteAction)(l))}_.batchUpdateControlPropertyValues((0,k.createUpdateAction)(r))}),[c,C,h,i,E]),ne=(0,S.useCallback)((function(){var e=[[i,{inner2Outer:!0}]];_.batchUpdateControlPropertyValues((0,k.createUpdateAction)(e))}),[i,t,g]);return(0,S.useEffect)((function(){I&&U([{key:t,title:g,isLeaf:!0}])}),[g,I]),(0,S.useEffect)((function(){"1"===b&&U([{key:t||"",title:I?g:"内部表单",isLeaf:!0}])}),[]),D().createElement("div",{className:j},D().createElement(k.NameTipWrapper,{nameHidden:u,className:n,name:a,tips:l,required:f,title:p}),"1"===b&&!I&&D().createElement("div",{className:"".concat(j,"-title-btn")},D().createElement(Un.BtnField,{type:"text",major:!0,onClick:ne},"转化为外部表单")),D().createElement("div",{className:"".concat(j,"-tree-select")},D().createElement(w.ConfigProvider,{value:{prefixCls:"kd"}},D().createElement(Un.KDTreeSelect,{allowClear:!0,value:t,treeData:V,showTreeIcon:!0,disabled:W,treeIcon:function(e){return e.icon},onChange:function(e,n){if(e!==t){var r,a={};if((t?null===(r=Md(V,(function(e){return e.key===t})))||void 0===r?void 0:r.title:"关联表单")===g)if(e){var l=n[0]||{},o=l.title,i=void 0===o?"":o,c=l.parentKeys,u=l.isAsyncNode;a.Name=i,a.SelectBillPid=u?c:void 0}else e||(a.Name="关联表单",a.SelectBillPid=void 0);else{var d=n[0]||{},s=d.title,f=d.parentKeys,p=d.isAsyncNode;a.Name=s,a.SelectBillPid=p?f:void 0}te(e,a)}},treeLoadData:function(e){var t=e.key,n=e.children,r=e.isLeaf;return new(jr())((function(e){n||r?e():(G.current=e,z.current=t,A("queryTreeNodeChildren",[t]))}))},treeDefaultExpandedKeys:y,dropdownStyle:{width:"320px"}}))))})),Pd=[{label:"大 (24px)",value:"24"},{label:"中 (16px)",value:"16"},{label:"小 (8px)",value:"8"},{label:"无 (0px)",value:"0"}],Rd=function(e){var t=e.handleChange,n=e.value,r=e.className,a=e.editor,l=e.locked,o=e.Name,i=e.Tips,c=(e.field,e.id,e.propName,Xt(n)),u=c.margin,s=void 0===u?"0":u,f=c.marginTop,p=c.marginRight,m=c.marginBottom,v=c.marginLeft,g=(0,S.useState)(s),y=(0,d.c)(g,2),C=y[0],h=y[1],E=(0,S.useState)(f||0),b=(0,d.c)(E,2),I=b[0],N=b[1],T=(0,S.useState)(p||0),x=(0,d.c)(T,2),A=x[0],F=x[1],M=(0,S.useState)(m||0),w=(0,d.c)(M,2),P=w[0],R=w[1],B=(0,S.useState)(v||0),_=(0,d.c)(B,2),O=_[0],j=_[1],L="".concat(r,"-margin");(0,S.useEffect)((function(){var e=-1===C?{marginTop:I,marginRight:A,marginBottom:P,marginLeft:O}:{margin:C};t(Kl()(e))}),[C,I,A,P,O]);var K=(0,S.useCallback)((function(e){h(e)}),[]),V=(0,S.useCallback)((function(e){N(e)}),[]),U=(0,S.useCallback)((function(e){F(e)}),[]),G=(0,S.useCallback)((function(e){R(e)}),[]),z=(0,S.useCallback)((function(e){j(e)}),[]);return D().createElement("div",{className:L},D().createElement("div",{className:jn()("".concat(L,"-item"),"".concat(L,"-select"))},D().createElement(k.EditorPropertySelect,{options:Pd,editor:a,value:C,handleChange:K,className:L,Name:o,locked:l,tips:i})),"-1"===C&&D().createElement(D().Fragment,null,D().createElement("div",{className:"".concat(L,"-item")},D().createElement(k.NameTipWrapper,{className:r,name:"上间距"}),D().createElement(Un.Number,{value:I,onChange:V,showStepper:!1,placeholder:"请输入"})),D().createElement("div",{className:"".concat(L,"-item")},D().createElement(k.NameTipWrapper,{className:r,name:"下间距"}),D().createElement(Un.Number,{value:P,onChange:G,showStepper:!1,placeholder:"请输入"})),D().createElement("div",{className:"".concat(L,"-item")},D().createElement(k.NameTipWrapper,{className:r,name:"左间距"}),D().createElement(Un.Number,{value:O,onChange:z,showStepper:!1,placeholder:"请输入"})),D().createElement("div",{className:"".concat(L,"-item")},D().createElement(k.NameTipWrapper,{className:r,name:"右间距"}),D().createElement(Un.Number,{value:A,onChange:U,showStepper:!1,placeholder:"请输入"}))))};function Bd(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function _d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bd(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Bd(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Od=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t?N()(t).call(t,(function(t){var r=t.label,a=t.value,l=t.children,o=t.selectable,i=t.icon,c=_d({key:a,title:r},n);return(0,Se.isUndefined)(o)||(c.selectable=o),i&&(c.icon=i),l?(l.length&&(c.children=e(l)),c.checkable=!1):c.isLeaf=!0,c})):t},jd=D().memo((function(e){e.handleChange;var t=e.value,n=e.className,r=e.editor,a=(e.locked,e.Name),l=e.Tips,o=e.field,i=e.id,c=e.propName,u=r.NameHidden,f=r.Required,p=r.needPathValue,m=r.Title,v=(o.DataFill,o.Name,o.SelectBillPid),g=(0,S.useContext)(le),y=g.invokeAction,C=g.getKdesignerApi,h=g.prefixCls,E=g.getDataRef,b=C().data,I="".concat(h,"-bill-type"),T=(0,S.useState)([]),x=(0,d.c)(T,2),A=x[0],F=x[1],M=(0,S.useRef)(null),P=(0,S.useRef)(null),R=(0,S.useCallback)((function(e){var t=null;t=Array.isArray(e)?e:[e],F(Od(t))}),[p]),B=(0,S.useCallback)((function(){var e={showTree:"true"},t={nocodeformdesigner:E()};Array.isArray(v)&&(e.parentId=v[v.length-1]),y("click",[i,"entitymeta",c,e],[t])}),[]);(0,S.useEffect)((function(){B()}),[]),(0,S.useEffect)((function(){return k.eventBus.on(sr,R),k.eventBus.on(dr,_),function(){k.eventBus.off(sr,R),k.eventBus.off(dr,_)}}),[]);var _=function(e){var t;F((function(t){return O(t,P.current,Od(e,{isAsyncNode:!0}))})),null===(t=M.current)||void 0===t||t.call(M),M.current=null},O=function e(t,n,r){return N()(t).call(t,(function(t){return t.key===n?null!=r&&r.length?_d(_d({},t),{},{children:r,isLeaf:!0}):_d(_d({},t),{},{isLeaf:!0}):t.children?_d(_d({},t),{},{children:e(t.children,n,r)}):t}))};return D().createElement(D().Fragment,null,D().createElement(k.NameTipWrapper,{nameHidden:u,className:n,name:a,tips:l,required:f,title:m}),D().createElement("div",{className:"".concat(I,"-tree-select")},D().createElement(w.ConfigProvider,{value:{prefixCls:"kd"}},D().createElement(Un.KDTreeSelect,{allowClear:!0,value:t,treeData:A,showTreeIcon:!0,treeIcon:function(e){return e.icon},onChange:function(e,n){e!==t&&b.batchUpdateControlPropertyValues((0,k.createUpdateAction)([[i,(0,s.c)({},c,e)]]))},treeLoadData:function(e){var t=e.key,n=e.children,r=e.isLeaf;return new(jr())((function(e){n||r?e():(M.current=e,P.current=t,y("queryTreeNodeChildren",[t]))}))},treeDefaultExpandedKeys:v}))))}));jd.displayName="InputFormEditor";var Ld=jd;function Kd(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Vd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kd(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Kd(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Ud=function(e){var t=e.value,n=(e.className,e.handleChange),r=e.field,a=(e.rootId,(0,S.useContext)(le)),l=a.baseUrl,o=a.onDownLoad,i=a.prefixCls,c=a.getControlText,u=a.batchInvoke,d=a.getBaseHooks,s=a.getKdesignerApi,f=r.SelectScope,p=f?{rawFilter:f.value}:{},m=s().meta,g=d("useKDRefBill"),y=r.BillEntityIdEx||m.getControlPropertyDefaultValue(r.FieldType,"BillEntityIdEx"),C=function(e,t){try{if(e&&"string"==typeof e){var n=JSON.parse(e);return n.valueType===t?n.value:""}}catch(e){}}(t,0),h=function(e,t){var n=v()(t),r=void 0===n?"":n,a=t.search,l=void 0===a?"":a,o=t.order_by,i=void 0===o?"":o,c=t.page_size,d=void 0===c?10:c,s=t.page_no,f=void 0===s?1:s,m=t.ids;e&&u("query","nocodeformdesigner",[e,Vd({filter:r,search:l,order_by:i,select:"",page_size:d,page_no:f,ids:void 0===m?[]:m},p)])},E=1===parseInt(r.Multi),b={controlMeta:Qt(r,m),onChange:function(e){var t;"string"==typeof e?t=e:Array.isArray(e)&&(t=e.join(",")),n(Kl()({valueType:0,value:t}))},baseUrl:l,batchInvoke:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];u(e,r.Key,t,n)},getControlText:c,addControlAction:function(e,t){k.eventBus.on(e,t)},onDownLoad:o,batchInvokeListConfig:function(){y&&u("listconfig","nocodeformdesigner",[y])},batchInvokeQuery:h,value:C},I=g(b,!0),N=I.searchKeywords;(0,S.useEffect)((function(){h(y,{page_size:10,page_no:1,search:N,select:r.PropsDisplay,ids:C?C.split(","):[]})}),[t,r.PropsDisplay,y]);var T=Vd(Vd({className:"".concat(i,"-refbill-def-editor-input"),fieldType:"refbill"},I),{},{value:E?C?C.split(","):[]:C||"",placeholder:"请选择",showSelected:!1});return D().createElement(Bc,(0,R.c)({},e,{editorType:"refBillDef",inputFieldProps:T}))},Gd=function(e){var t,n=e.handleChange,r=e.value,a=e.className,l=e.editor,o=e.Name,i=e.Tips,c=e.renderItem,u=e.field,s=e.id,f=l.Enum,p=l.NameHidden,m=l.Default,v=l.Required,g=l.Title,y=(0,(0,S.useContext)(le).getKdesignerApi)().controlCacheApi,C=N()(f).call(f,(function(e){return(0,R.c)({},e,{Value:e.Value||e.Id})})),h=(0,Se.isUndefined)(r)?m||(null===(t=C[0])||void 0===t?void 0:t.Value):String(r),E=y.hasCache("controlId",s),b=(0,S.useState)(!("Multi"!==e.Id||E)),I=(0,d.c)(b,2),T=I[0],x=I[1],A=(0,S.useCallback)((function(e){var t=e[u.Key]||[];0!==t.length?(null==t?void 0:t.length)>0&&x(!1):x(!0)}),[]);(0,S.useEffect)((function(){if("Multi"===e.Id&&!E)return k.eventBus.on(mr,A),function(){k.eventBus.off(mr,A)}}),[]);return D().createElement(D().Fragment,null,D().createElement(k.NameTipWrapper,{nameHidden:p,className:a,name:o,tips:i,required:v,title:g}),D().createElement("div",{className:"".concat(a,"-tab-editor")},N()(C).call(C,(function(e){var t=e.IconClassName,r=e.IconTitle;return D().createElement("div",{key:e.Value,disabled:T,className:jn()(["".concat(a,"-tab-editor-item"),{"is-active":h===e.Value,"is-disabled":!0===T}]),onClick:function(){return t=e.Value,void(T||n(t));var t},title:t&&r},c?c(e):t?D().createElement("i",{className:t}):e.Name)}))))},zd=n(6076),Hd=n.n(zd),qd=["compareTypes","compareType","compareTypeCaption","fieldName","fieldCaption","items","value"];function Yd(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Wd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yd(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Yd(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Xd=Un.Condition.constants,Zd=Xd.allFieldRegExp,Qd=Xd.allExpRegExp,Jd=Un.treeUtils.exludeTreeNodeByCallback,$d=Un.treeUtils.transformTreeToListConfig,es=function(e){try{return decodeURIComponent(e)}catch(t){return e}},ts=function(e){return null==e?void 0:N()(e).call(e,(function(e){return Wd(Wd({},e),{},{value:es(e.value)})}))},ns=[{id:"edit",name:{zh_CN:"编辑"}},{id:"mustinput",name:{zh_CN:"必填"}},{id:"readonly",name:{zh_CN:"只读"}},{id:"disabled",name:{zh_CN:"禁用"}}],rs=function e(t,n,r,a){return t.reduce((function(t,l){var o,i=l._Type_,c=l.Key,u=l.Name,d=l.FormatType,s=l.SelectItemType,f=l.Multi,p=l.children;if(tt(i)||ot(i)||dt(i)||st(i))return t;var m=$e(i)||ot(i)?"NoCodeMulRefBillField":i,g=null==m?void 0:m.toLowerCase();if(Qe(i)){var y=[{title:"".concat(u,".开始"),titlePrefix:"[日期]",key:"".concat(c,"_startdate"),formatType:d,type:"nocodedatefield",compareTypes:ns,checkable:!0,selectable:!1},{title:"".concat(u,".结束"),titlePrefix:"[日期]",key:"".concat(c,"_enddate"),formatType:d,type:"nocodedatefield",compareTypes:ns,checkable:!0,selectable:!1}];return h()(t).call(t,y)}var C={};if($e(i)||et(i)||ot(i))C=Qt(l,r);else if(rt(i)){var E,b=r.getControlMetaEditor(i,"ImageFileType").Enum,I=r.getControlPropertyDefaultValue(i,"FileMaxSize"),T=r.getControlPropertyDefaultValue(i,"ImageFileType"),x=(null==l?void 0:l.ImageFileType)||T,A=N()(E=x.split(",")).call(E,(function(e){return v()(b).call(b,(function(t){return t.Id===e}))[0].Name}));C={UploadNum:(null==l?void 0:l.UploadNum)||{max:9,min:0},FileMaxSize:l.FileMaxSize||I,typeArr:A}}else if(at(i)){var F=r.getControlPropertyDefaultValue(i,"AttachmentFileType"),S=r.getControlPropertyDefaultValue(i,"FileMaxSize"),D=(null==l?void 0:l.AttachmentFileType)||F;C={UploadNum:(null==l?void 0:l.UploadNum)||{max:9,min:0},maxSize:l.FileMaxSize||S,fileType:D}}var k=l.CustomContent?null===(o=l.CustomContent.ops)||void 0===o?void 0:N()(o).call(o,(function(e){return{name:{zh_CN:e.Label},value:e.Value,bgc:e.Bgc}})):void 0,M=Wd({title:u,titlePrefix:rn(l,n,r,a),key:c,type:g,isMulti:1===s||1===f,items:k,formatType:d,compareTypes:ns,checkable:!0,selectable:!1},C);return Kt(i)&&p&&(p&&(M.children=e(p,n,r,a)),M.checkable=!1),h()(t).call(t,M)}),[])},as=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(t||[]).reduce((function(t,a){var l,o=a.caption,i=a.type,c=a.id,u=a.option,d=void 0===u?{}:u,s=a.typeCaption,f=d.sourceForm,p=(null==c||null===(l=c.split("."))||void 0===l?void 0:l.length)||0;if("group"!==i&&p>r)return t;if(tt(i)||ot(i)||void 0!==f||dt(i)||st(i))return t;var m=null==i?void 0:i.toLowerCase();"nocodedaterangefield"===m?m="nocodedatefield":($e(i)||et(i)||ot(i))&&(m="nocodemulrefbillfield");var g,y=d.children,C=d.valueItems,E=d.billEntityId,b=d.displayProp,I=d.isMulti,T=d.formatType,x={title:o,titlePrefix:s,key:c,compareTypes:ns,type:m,formatType:T,selectable:!1,checkable:!0};if($e(i)||et(i)||ot(i)){if(!E)return t;x=(0,R.c)(x,{displayProp:b,entityId:E,isMulti:I})}else if(ut(i))x=(0,R.c)(x,{isMulti:I});else if(rt(i)){var A,F=d.ImageFileType,S=d.FileMaxSize,D=d.UploadNum,k=n.getControlMetaEditor(i,"ImageFileType").Enum,M=n.getControlPropertyDefaultValue(i,"FileMaxSize"),w=n.getControlPropertyDefaultValue(i,"ImageFileType"),P=n.getControlPropertyDefaultValue(i,"UploadNum"),B=F||w,_=N()(A=B.split(",")).call(A,(function(e){return v()(k).call(k,(function(t){return t.Id===e}))[0].Name}));x=(0,R.c)(x,{UploadNum:D||P,FileMaxSize:S||M,typeArr:_})}else if(at(i)){var O=d.AttachmentFileType,j=d.FileMaxSize,L=d.UploadNum,K=n.getControlPropertyDefaultValue(i,"AttachmentFileType"),V=n.getControlPropertyDefaultValue(i,"FileMaxSize"),U=O||K,G=n.getControlPropertyDefaultValue(i,"UploadNum");x=(0,R.c)(x,{UploadNum:L||G,maxSize:j||V,fileType:U})}if((C&&(x.items=C),y&&(x.children=e(y,n,r)),"group"===i)&&(x.checkable=!1,null===(g=x)||void 0===g||null===(g=g.children)||void 0===g||!g.length))return t;return h()(t).call(t,x)}),[])},ls=(0,S.memo)((function(e){var t=e.item,n=e.index,r=e.filterOptions,a=e.fieldTree,l=e.prefixCls,o=e.handleCompareTypeChange,i=e.refBillProps,c=e.fieldRecords,u=e.handleValChange,s=e.handleVarSelect,f=e.handleDelete,m=e.verifyData,g=e.formId,y=t.compareTypes,C=t.compareType,E=(t.compareTypeCaption,t.fieldName),b=(t.fieldCaption,t.items),I=t.value,N=(0,Ce.c)(t,qd),T=Un.ListFilterUtil.getCompareTypeOptions,A=Un.ListFilterUtil.getVarSelectedKeysInfo,k=Un.ListFilterUtil.getValueTypeByType,M=Un.ListFilterUtil.getNewValue,P=Un.ListFilterUtil.transform2Options,R=Un.ListFilterUtil.VALUE_EMPTY_COMPARE_TYPE,B=(0,S.useContext)(le),_=B.getBaseHooks,O=B.invokeAction,j=B.getKdesignerApi,L=B.getExpressionData,K=B.getRefBillData,V=B.getCompareTypes,U=B.batchInvoke,G=B.baseUrl,z=j().data,H=_("useKDRefBill"),q=(0,S.useState)(!1),Y=(0,d.c)(q,2),W=Y[0],X=Y[1],Z=N||{},Q=Z.entityId,J=Z.formatType,$=Z.type,ee=Z.displayProp,te=k(N),ne="refbill"===te?i?te:"text":"select"===te&&!0===t.isMulti?"multiSelect":te,re=M(ne,I,null==c?void 0:c[E]),ae=(0,S.useState)(!1),oe=(0,d.c)(ae,2),ie=oe[0],ce=oe[1],ue=(0,S.useState)(!1),de=(0,d.c)(ue,2),se=de[0],fe=de[1],pe=(0,S.useState)(!1),me=(0,d.c)(pe,2),ve=me[0],ge=me[1],ye=V(),Ee=z.getRootId(),be={name:"field",value:E,options:r,fieldType:"treeSelect",disabled:!0,borderType:"bordered",className:"".concat(l,"-modal-body-fielddata")},Ie={name:"compareType",value:C,options:T(y)||[],className:"".concat(l,"-modal-body-infoType"),fieldType:"select",onChange:function(e){return o(e,n,ne)},borderType:"bordered"},Ne=A(I),Te=(0,S.useMemo)((function(){return L()}),[L]),xe={valueType:0,fieldValue:""};(0,S.useEffect)((function(){!function(e,t){var n=v()(t),r=void 0===n?"":n,a=t.search,l=void 0===a?"":a,o=t.order_by,i=void 0===o?"":o,c=t.select,u=void 0===c?"":c,d=t.page_size,s=void 0===d?10:d,f=t.page_no,p=void 0===f?1:f,m=t.ids;"refbill"===te&&e&&U("query","nocodeformdesigner",[e,{filter:r,search:l,order_by:i,select:u,page_size:s,page_no:p,ids:void 0===m?[]:m}])}(Q,{page_size:10,page_no:1,search:"",select:ee,ids:re||[]})}),[I,Q]);var Ae,Fe,Se=[{label:"查找表单记录",key:"search",id:1,icon:"chazhaobiaodanjilu-xian"}],De={valueType:2,value:{relationFormId:"",filterInfos:[],sortInfos:[],result:[]}},ke=(Ae={nocodetextfield:[0,1,2],nocodetextareafield:[0,1,2],nocodedecimalfield:[0,1,2],nocoderichtextfield:[0,1],nocodegeofield:[0,1],nocodeaddressfield:[0,1],nocodeselectitemfield:[0,1,2],nocodemulrefbillfield:[0,1],nocodedaterangefield:[0,1],nocodedatefield:[0,1,2],nocodeimageuploadfield:[0,1],nocodeattachmentuploadfield:[0,1],nocodegroupcontainerfield:[],nocodeentryentityfield:[],nocodegraphicdisplayfield:[0,1],nocodebillnofield:[0,1,2]}[$],null==Se?void 0:v()(Se).call(Se,(function(e){return null==Ae?void 0:F()(Ae).call(Ae,e.id)}))),Me=H(Wd(Wd({},i),{},{batchInvokeListConfig:function(){return i.batchInvokeListConfig(Q)},controlMeta:N,onChange:function(e){return u(Array.isArray(e)?e:""===e?[]:null==e?void 0:e.split(","),n,ne)}}),!0),we="refbill"===ne?Wd(Wd({className:"".concat(l,"-modal-body-refbill")},Me),{},{value:1===N.multi?re:re[0]}):"picture"===ne?{UploadNum:t.UploadNum,FileMaxSize:t.FileMaxSize,typeArr:t.typeArr}:"attachment"===ne?{UploadNum:t.UploadNum,maxSize:t.maxSize,fileType:t.fileType}:{},Pe=function(e){try{if(qt(e)){var t=JSON.parse(e);return(null==t?void 0:t.valueType)||0}var n;if(e&&"object"===(0,he.c)(e))return(null===(n=e[0])||void 0===n?void 0:n.valueType)||0}catch(e){}}(I),Re=function(e,t){try{if(qt(e)){var n=JSON.parse(e);return(null==n?void 0:n.valueType)===t?n.value:""}var r,a;if(e&&"object"===(0,he.c)(e))return 2===t?null===(a=e[0])||void 0===a?void 0:a.fieldValue:(null===(r=e[0])||void 0===r?void 0:r.valueType)===t?e[0].fieldValue:""}catch(e){}},Be=function(e){var t=e?e.split("@@"):["","",null],n=(0,d.c)(t,3);return[n[1],n[2]]}(Re(I,1)),_e=function(e){e.stopPropagation(),s(t.fieldName,xe,ne),ge(!1)},Oe=(Fe=Te.functionOperations,x()(Fe)),je={fieldType:"formula",onClick:function(){return Ge("formula")},value:Be[0],expressionData:Te.functionTypes,fieldData:a,onClear:_e,lang:Number(Be[1]||1),readOnly:!0,autofocus:!1},Le={fieldType:"findForm",borderType:"bordered",value:Re(I,2),onChange:function(e){var n;n="string"==typeof e?e:Array.isArray(e)?e.join(","):null!=e&&e.target?e.target.value:e,s(t.fieldName,{valueType:0,fieldValue:n},ne)},placeholder:"请输入",onClear:_e,onClick:function(){return Ge("search")}},Ke={1:je,2:Le}[Pe],Ve=function(){ce(!0)},Ue=function(){fe(!0)},Ge=(0,S.useCallback)((function(e){var t,n={search:Ue,formula:Ve};null===(t=n[e])||void 0===t||t.call(n)}),[Ue,Ve]),ze=function(e,t){var n,r=(null===(n=He(e,t))||void 0===n?void 0:n.label)||"";return r=r?"查找：".concat(r):""},He=function e(t,n){var r;return t.children.forEach((function(t){if(t.value===n&&(r=t),t.children){var a=e(t,n);a&&(r=a)}})),r},qe=(0,S.useMemo)((function(){var e;return 2===Pe&&(null===(e=I[0])||void 0===e||null===(e=e.rule)||void 0===e?void 0:e.value)||De.value}),[I]),Ye={invokeGetListConfig:function(e){e!==Ee&&O("listtreeconfig",[e])},invokeGetFieldRecords:function(e){O("getFilterItemLook",[e,{getEnumData:"true",enumField:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",filterrows:[]}])},invokeSaveBizRule:function(e){}},We=(0,S.useMemo)((function(){var e=K();return e.children[0].icon=D().createElement(w.Icon,{prefix:"nocodeplatformicon",type:"gerenzhongxin",style:{color:"#3987ED"}}),e.children[1].icon=D().createElement(w.Icon,{prefix:"nocodeplatformicon",type:"zuzhi",style:{color:"#3987ED"}}),e}),[K]),Xe=Wd(Wd({name:"value",options:P(ts(b)),className:"".concat(l,"-modal-body-infoValue"),fieldType:ne,borderType:"bordered",placeholder:F()(R).call(R,C)?"":void 0,colHeadFilter:null==c?void 0:c[E],formatType:J,baseUrl:G,isMulti:t.isMulti,varSelectProps:Wd({showSearch:!0,defaultExpandAll:!0,className:"".concat(l,"-modal-body-var"),visible:W,disabled:"none"===te||"001"===C,value:x()(Ne).join(),popperClassName:"".concat(l,"-def-editor-var-select-panel"),type:"dropdownSelect",selectedKeys:p()(Ne),data:ke,varSelectActive:ve,onVarSelectActive:ge,onVisibleChange:X,onSelect:function(e){return Ge(e[0])}},Ke)},we),{},{onChange:function(e){return u(e,n,ne)},allowClear:"number"!==ne,value:t.isMulti?re:"refbill"===ne?we.value:re});return D().createElement(D().Fragment,{key:E+C+n},D().createElement(w.ConfigProvider,{value:{prefixCls:"kd"}},D().createElement(Un.ConditionFilterItem,{onDelete:function(){return f(n)},data:[be,Ie,Xe],customInput:[{type:"notInput",render:function(e){var t=e.value,n=e.className;return D().createElement("span",{className:n},t)}}],valueRequired:!0,className:"".concat(l,"-item"),verifyData:m}),ie&&D().createElement(Un.Condition,{value:Be[0],language:Number(Be[1]||1),modalTitle:"编辑运算公式",editorTitle:t.name,visible:ie,editorPlaceholder:"请编辑运算公式",fieldData:a,fieldTitle:"表单内容",expressionData:Te.functionTypes,operations:Oe,onClose:function(){ce(!1),ge(0!==Pe&&!(null==Ke||!Ke.value))},onConfirm:function(e,n){e=function(e,t){var n,r;if(!e)return"";var a=(e=e.replace(/）/g,")").replace(/（/g,"(").replace(/“/g,'"').replace(/”/g,'"').replace(/‘/g,"'").replace(/’/g,"'")).replace(Zd,"$1").replace(Qd,"$1");return h()(n=h()(r="".concat(a,"@@")).call(r,e,"@@")).call(n,t?1:0)}(e,n),ce(!1),s(t.fieldName,e?{valueType:1,fieldValue:e}:xe,ne)}})),se&&D().createElement(xc,{visible:se,onClose:function(){fe(!1),ge(0!==Pe&&!(null==Ke||!Ke.value))},invokeActions:Ye,queryFormValue:qe||De.value,refBillData:We,field:t,compareTypesMap:ye,formId:g,onConfirm:function(e){fe(!1);var n=ze(We,e.value.relationFormId);s(t.fieldName,e?{valueType:e.valueType,fieldValue:n,rule:e}:xe,ne)}}))}));ls.displayName="ChildrenItem";var os=(0,S.forwardRef)((function(e,t){var n=e.prefixCls,r=e.fieldKey,a=e.formId,l=e.inputFormId,o=e.value,i=e.onChange,c=e.onConfirm,u=(0,S.useContext)(le),s=u.baseUrl,f=u.onDownLoad,p=u.getControlText,m=u.batchInvoke,g=u.getCompareTypes,C=u.getKdesignerApi,E=u.curFormulaTreeApi,b=u.getRefBillNameMap,I=(0,S.useRef)(null),T=(0,S.useRef)(null),x=(0,S.useRef)([]),A=C(),F=A.data,M=A.meta,R=g(),B=F.getRootId();(0,S.useImperativeHandle)(t,(function(){return{updateVerifyAndGetMsg:function(){return T.current.updateVerifyAndGetMsg()}}}),[]);var _=Cc({id:r,formId:a,eventName:"filterItemLook"}),O=(0,S.useMemo)((function(){if(Array.isArray(o)){var e=[];return o.forEach((function(t){e.push(Wd(Wd({},t),{},{value:"string"==typeof t.value?JSON.parse(t.value):t.value||[]}))})),e}return[]}),[o]),j=hc({api:E,parser:function(e){return $t(e,e,R)}}),L=Cc({id:r,formId:l,eventName:"setListTreeConfig",parser:function(e){var t=e.data;return as(t,M)},defaultValue:[]}),K=(0,S.useMemo)((function(){return an(j)}),[j]),V=(0,S.useMemo)((function(){var e,t,n=N()(e=F.getData().Items||[]).call(e,(function(e){var t=e._Type_;return Wd(Wd({},M.getDefaultData(t)),e)})),r=Jd((null===(t=fi(n)[0])||void 0===t?void 0:t.children)||[],(function(e){var t=e._Type_,n=e.BillEntityIdEx,r=e.showType;return ot(t)?"1"!==r:!(ct(t)||nt(t)||("NoCodeMulRefBillField"===t||"NoCodeRefBillField"===t)&&void 0===n)}));return rs(r,K,M,b())}),[K,b]),U=(0,S.useMemo)((function(){return l?l!==B?L:V:[]}),[V,L,l,B]),G=(0,S.useMemo)((function(){return $d(U)}),[U]),z=(0,S.useMemo)((function(){return N()(O).call(O,(function(e){return e.fieldName}))}),[O]),H=(0,S.useMemo)((function(){return ci({options:j})}),[j]),q=(0,S.useCallback)((function(e){x.current.length<e.length&&e.length>7&&setTimeout((function(){return I.current.scrollTo(0,1e4)}),100),x.current=e}),[]),Y=function(e){var t=e;if(Array.isArray(e)){var n=[];e.forEach((function(e){n.push(Wd(Wd({},e),{},{value:"object"===(0,he.c)(e.value)?Kl()(e.value):e.value||""}))})),t=n}i(t),q(e)},W={baseUrl:s,batchInvoke:function(e,t){m(e,r,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[])},getControlText:p,addControlAction:function(e,t){k.eventBus.on(e,t)},onDownLoad:f,batchInvokeListConfig:function(e){m("listconfig","nocodeformdesigner",[e])},batchInvokeQuery:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=v()(t),r=void 0===n?"":n,a=t.search,l=void 0===a?"":a,o=t.order_by,i=void 0===o?"":o,c=t.select,u=void 0===c?"":c,d=t.page_size,s=void 0===d?10:d,f=t.page_no,p=void 0===f?1:f,g=t.ids;m("query","nocodeformdesigner",[e,{filter:r,search:l,order_by:i,select:u,page_size:s,page_no:p,ids:void 0===g?[]:g}])}},X=Un.ListFilterUtil.filterDataTransform,Z=Un.ListFilterUtil.filterNoValue,Q=Un.ListFilterUtil.getNewDefaultFilterDataExcept,J=(Un.ListFilterUtil.getFilterOptions,Un.ListFilterUtil.createNewValue),$=(0,S.useState)([]),ee=(0,d.c)($,2),te=ee[0],ne=ee[1],re=(0,S.useMemo)((function(){return ne([]),X(O,G)||[]}),[O,G]);(0,S.useImperativeHandle)(t,(function(){return{updateVerifyAndGetMsg:function(){var e=Z(re);return ne(e),v()(e).call(e,(function(e){return!e.verifyStatus}))}}}),[re]);var ae=(0,S.useCallback)((function(e){return Wd(Wd({},e),{},{value:e.value||[]})}),[]),oe=(0,S.useCallback)((function(){(null==O?void 0:O.length)>0&&Y([])}),[O,Y]),ie=(0,S.useCallback)((function(e,t,n){var r=[],a=xe()(O).call(O,(function(e,n){return t===n})).fieldName,l=-1;if(null!=a&&Hd()(a).call(a,"_startdate")||null!=a&&Hd()(a).call(a,"_enddate")){var o=a.replace(/^(\S+)(_startdate|_enddate)/g,"$1");l=Kr()(O).call(O,(function(e,n){var r;return(null===(r=e.fieldName)||void 0===r?void 0:y()(r).call(r,o))&&t!==n}))}O.forEach((function(a,o){t===o||l===o?r.push(ae({fieldName:a.fieldName,compareType:e,value:a.value,fieldType:n})):r.push(ae({fieldName:a.fieldName,compareType:a.compareType,value:a.value,fieldType:n}))})),Y(r)}),[O,Y]),ue=function(e){var t=(0,P.c)(O);ce()(t).call(t,e,1),Y(t)},de=function(e,t,n,r){var a=[];O.forEach((function(n,l){if(n.fieldName===e){var o=[];o.push(t),a.push(ae({fieldName:n.fieldName,compareType:n.compareType,value:o,fieldType:r}))}else a.push(ae({fieldName:n.fieldName,compareType:n.compareType,value:n.value,fieldType:r}))})),Y(a)},se=function(e,t,n){!function(e,t,n){var r=[];O.forEach((function(a,l){t===l?r.push(ae({fieldName:a.fieldName,compareType:a.compareType,value:e,fieldType:n})):r.push(ae({fieldName:a.fieldName,compareType:a.compareType,value:a.value}))})),Y(r)}(J(e,n),t,n)};return D().createElement("div",{className:"".concat(n,"-modal"),ref:I},D().createElement("div",{className:"".concat(n,"-modal-body"),style:{marginTop:"0px"}},re.length>0&&D().createElement("div",{style:{width:"100%"}},N()(re).call(re,(function(e,t){return D().createElement(ls,{key:(null==e?void 0:e.key)||(null==e?void 0:e.fieldName),item:e,index:t,filterOptions:U,fieldTree:H,prefixCls:n,handleCompareTypeChange:ie,refBillProps:W,fieldRecords:_,handleValChange:se,handleVarSelect:de,handleDelete:ue,verifyData:te,formId:a})})))),D().createElement("div",{className:"".concat(n,"-modal-footer")},D().createElement("div",{className:"".concat(n,"-modal-footer-left")},D().createElement(w.ConfigProvider,{value:{prefixCls:"kd"}},D().createElement(Un.AddTreeItem,{treeData:U,triggerText:"添加录入内容",onCheck:function(e,t){var n=[],r=O.reduce((function(e,t){var n=t.fieldName,r=t.compareType;(null!=n&&Hd()(n).call(n,"_startdate")||null!=n&&Hd()(n).call(n,"_enddate"))&&(e[n.replace(/^(\S+)(_startdate|_enddate)/g,"$1")]=r);return e}),{});e.forEach((function(e,t){var a=xe()(O).call(O,(function(t){return t.fieldName===e}));if(a)n.push(a);else{var l=Q(G,e,re);if(l){if(null!=e&&Hd()(e).call(e,"_startdate")||null!=e&&Hd()(e).call(e,"_enddate")){var o=e.replace(/^(\S+)(_startdate|_enddate)/g,"$1");r[o]&&(l.compareType=r[o])}n=h()(n).call(n,ae(l))}}})),Y(n)},checkedKeys:z}))),D().createElement("div",{className:"".concat(n,"-modal-footer-right")},D().createElement(w.Button,{size:"small",className:"".concat(n,"-modal-footer-btn"),onClick:oe},"清空"),D().createElement(w.Button,{size:"small",type:"primary",className:"".concat(n,"-modal-footer-btn"),onClick:c},"确定"))))})),is=(0,S.memo)((function(e){var t=e.prefixCls,n=e.title,r=e.value,a=e.formId,l=e.inputFormId,o=e.visible,i=e.setVisible,c=e.fieldKey,u=e.onChange,s=(0,S.useState)(r),f=(0,d.c)(s,2),p=f[0],m=f[1],v=(0,S.useRef)(),g=function(){i(!1),m(r)};return D().createElement(w.Modal,{mask:!0,visible:o,body:D().createElement(os,{ref:v,prefixCls:t,fieldKey:c,formId:a,inputFormId:l,value:p,onChange:function(e){m(e)},onConfirm:function(){null==u||u(p),g()}}),titleIcon:null,className:"".concat(t,"-modal"),maskClosable:!1,footer:D().createElement(D().Fragment,null),width:640,height:520,keyboard:!1,bodyStyle:{padding:0,overflow:"hidden"},footerStyle:{display:"none"},title:n,closable:!0,draggable:!1,destroyOnClose:!0,onCancel:g,onOk:g})}));is.displayName="InputContentModal";var cs=is;function us(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ds(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?us(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):us(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var ss=(0,S.memo)((function(e){var t,n,r=e.handleChange,a=e.className,l=e.editor,o=e.locked,i=e.Name,c=e.Tips,u=e.field,s=e.rootId,f=l.NameHidden,p=l.Required,m=l.Title,v=u.Key,g=u._Type_,y=u.InputForm,C=(0,S.useState)(!1),h=(0,d.c)(C,2),E=h[0],b=h[1],I=(0,S.useContext)(le),N=I.invokeAction,T=I.prefixCls,x=I.getKdesignerApi,A=I.fetchListTree,M=x().data,w="string"==typeof(n=e.value)&&""!=n?JSON.parse(n):n,P=(0,S.useMemo)((function(){return"nocodemulrefbillfield"===g.toLocaleLowerCase()?u.BillEntityIdEx:M.getRootId()}),[g,M,null==u?void 0:u.BillEntityIdEx]),B=(0,S.useMemo)((function(){if(y){var e=y.lastIndexOf(".")+1,t=y.lastIndexOf("["),n=e>0&&t>-1?y.substring(e,t):y;return F()(n).call(n,s)?s:n}return""}),[y]);(0,S.useEffect)((function(){var e=null==w?void 0:w.targetId;e&&e!=y&&r("")}),[y]);var _,O=(0,S.useCallback)((function(e){var t=Kl()({value:e,targetId:y});r(t)}),[r]),j="".concat(T,"-inputContnet-editor"),L=ds(ds({},l),{},{NameHidden:!0}),K=(0,S.useMemo)((function(){return{name:i,className:a,nameHidden:f,tips:c,required:p,title:m}}),[i,a,f,c,p,m]);return D().createElement("div",{className:j},D().createElement("div",{className:"".concat(a,"-nav")},D().createElement(k.NameTipWrapper,K)),D().createElement(k.CustomInputTrigger,(0,R.c)({},e,{editor:L,disabled:o,value:(null==w||null===(t=w.value)||void 0===t?void 0:t.length)>0?(_=w.value,"".concat(_.length,"个内容")):"",onClick:function(){b(!0),A("formula"),B&&N("listtreeconfig",[B])}})),D().createElement(cs,{formId:P,inputFormId:B,prefixCls:j,visible:E,setVisible:b,fieldKey:v,value:(null==w?void 0:w.value)||[],title:i,onChange:O}))}));ss.displayName="InputContentEditor";var fs=(0,k.ErrorBoundaryWrap)(ss,"InputContentEditor");function ps(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ms(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ps(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):ps(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var vs=Un.treeUtils.exludeTreeNodeByCallback,gs=Un.treeUtils.dfs,ys=function e(t,n,r,a,l){return t.reduce((function(t,o){var i,c=o._Type_,u=o.Name,d=o.Key,s=o.BillEntityIdEx,f=o.SelectItemType,p=o.Multi,m=o.children,v=o.selectable;if(Qe(c)){var g,y,C=[{title:"".concat(u,".开始"),titlePrefix:"[日期]",key:l?h()(g="".concat(l,".")).call(g,d,"_startdate"):"".concat(d,"_startdate"),type:c,entityId:s},{title:"".concat(u,".结束"),titlePrefix:"[日期]",key:l?h()(y="".concat(l,".")).call(y,d,"_enddate"):"".concat(d,"_enddate"),type:c,entityId:s}];return h()(t).call(t,C)}var E=void 0!==v?v:!Kt(c),b={title:u,titlePrefix:rn(o,n,r,a),key:l?h()(i="".concat(l,".")).call(i,d):d,type:c,entityId:s,isMulti:1===f||1==p,selectable:E};if(1!=p&&m){var I=ot(c)?d:void 0;b.children=e(m,n,r,a,I)}return Kt(c)&&(b.selectable=!1),h()(t).call(t,b)}),[])},Cs=function(e){var t=e.value,n=e.isMultiMode,r=void 0!==n&&n,a=e.sourceFieldOptions,l=e.relationFieldId,o=e.selBillValue,i=e.onChange,c=e.curListFilterConfig,u=(0,S.useState)(t||[]),s=(0,d.c)(u,2),f=s[0],p=s[1],m=(0,S.useContext)(le),v=m.getKdesignerApi,g=m.getRefBillNameMap,y=v(),C=y.data,E=y.meta,b=Un.ListFilterUtil.filterTreeData,I=Un.ListFilterUtil.canClearSourceField,T=(0,S.useMemo)((function(){return an(c)}),[c]),x=(0,S.useMemo)((function(){var e,t,n=N()(e=C.getData().Items||[]).call(e,(function(e){var t=e._Type_;return ms(ms({},E.getDefaultData(t)),e)})),a=vs((null===(t=fi(n)[0])||void 0===t?void 0:t.children)||[],(function(e){var t=e._Type_,n=e.BillEntityIdEx,a=e.showType,i=e.Multi,c=e.children,u=e.Key,d=e.RefBillKey;return r?(!d||d!==l)&&(!(!ot(t)&&!$e(t)||n!==o||u===l||1!=i)||!(1==i||!c.length)&&(e.selectable=!1,!0)):(!l||u!==l&&d!==l)&&(ot(t)?"1"!==a:!(ct(t)||nt(t)||("NoCodeMulRefBillField"===t||"NoCodeRefBillField"===t)&&void 0===n))}));return ys(a,T,E,g())}),[r,o,l,T,g]),A=function(e,t){var n=xe()(f).call(f,(function(e,n){return n===t})).fieldId;if(e!==n){var r=N()(f).call(f,(function(n,r){return t===r?ms(ms({},n),{},{sourceField:e}):n}));p(r),i(r)}},F=function(e,t){var n=N()(f).call(f,(function(n,r){if(t===r){var l=b(a,gs(x,(function(t){return t.key===e})));return I(l,n.sourceField)?ms(ms({},n),{},{targetField:e}):ms(ms({},n),{},{targetField:e,sourceField:""})}return n}));p(n),i(n)};(0,S.useEffect)((function(){var e=t||[];(0,Se.isEqual)(e,f)||p(e)}),[t]);return D().createElement("div",{className:"bill-finder-actions"},N()(f).call(f,(function(e,t){var n=e.sourceField,r=e.targetField,l=gs(x,(function(e){return e.key===r}))||{},c=b(a,ms({selBillValue:o},l));return D().createElement("div",{className:"row_item",key:t},D().createElement("span",{className:"txt"},"将"),D().createElement(Un.KDTreeSelect,{className:"target-field-select",virtual:!1,allowClear:!0,value:r,treeData:x,showFullLabelTips:!0,onChange:function(e){return F(e,t)},suffixIcon:D().createElement(w.Icon,{prefix:"designericon",type:"duixiangxuanze2"})}),D().createElement("span",{className:"txt"},"的值赋为"),D().createElement(Un.KDTreeSelect,{className:"source-field-select",virtual:!1,disabled:""===r||void 0===r,value:n,treeData:c,showFullLabelTips:!0,treeCheckStrictly:!0,onChange:function(e){return A(e,t)},suffixIcon:D().createElement(w.Icon,{prefix:"designericon",type:"duixiangxuanze2"})}),D().createElement(w.Icon,{className:"delete_icon",prefix:"ncicon",type:"xingshanchu",onClick:function(){return function(e){var t=(0,P.c)(f);ce()(t).call(t,e,1),p(t),i(t)}(t)}}))})),D().createElement("div",{className:"footer-btns"},D().createElement("div",{className:"add-btn",onClick:function(){var e,t=h()(e=[]).call(e,(0,P.c)(f),[{sourceField:"",targetField:""}]);p(t),i(t)}},D().createElement(w.Icon,{prefix:"nocodeplatformicon",type:"zengjia-yuan"}),"添加写入规则"),!!f.length&&D().createElement("div",{className:"clear-all",onClick:function(){p([]),i([])}},"清空")))},hs=["children"];function Es(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function bs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Es(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Es(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var Is=Un.treeUtils.dfs,Ns=Un.treeUtils.getListConfigPure,Ts=Un.treeUtils.treeNodeTransform,xs=Un.treeUtils.getListSortConfig,As=Un.treeUtils.getMultiRefChildrenExclude,Fs=Un.ListFilterUtil.getVarSelectDisabled,Ss={key:"currentRecord",title:"本记录"},Ds={key:"currentRecord",title:"查询结果",isMulti:!0},ks=[{label:"单条",value:"0"},{label:"多条",value:"1"}],Ms=[{type:"array",required:!0,validator:function(e,t,n,r,a){return null!=t&&t.length&&t.every((function(e){return x()(e).every((function(e){return"string"==typeof e?""!==e:!Array.isArray(e)||0!==e.length}))}))?[]:[new Error("请添加写入规则")]}}],ws=function(e,t){return bs(bs({},e),t)},Ps=function(e){var t,n=e.value,r=e.refBillData,a=e.field,l=e.ruleId,o=e.compareTypesMap,i=e.formId,c=e.listFilterConfig,u=e.curFormFieldTree,f=e.onChange,p=(0,S.useContext)(le),m=p.prefixCls,g=p.baseUrl,y=p.onDownLoad,C=p.getControlText,E=p.batchInvoke,b=p.invokeAction,I=p.getDataRef,T=p.getKdesignerApi,x=w.Form.useForm(),A=(0,d.c)(x,1)[0],M=(0,S.useState)({}),R=(0,d.c)(M,2),B=R[0],_=R[1],O=a.Key,j=a.ParentId,L=T(),K=L.data,V=L.meta,U=K.getRootId(),G=(0,S.useReducer)(ws,n),z=(0,d.c)(G,2),H=z[0],q=z[1],Y=(0,S.useRef)(),W=(0,S.useRef)(),X={baseUrl:g,batchInvoke:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];E(e,a.Key,t,n)},getControlText:C,addControlAction:function(e,t){return k.eventBus.on(e,t),function(){k.eventBus.off(e,t)}},onDownLoad:y,batchInvokeListConfig:function(e){E("listconfig","nocodeformdesigner",[e])},batchInvokeQuery:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=v()(t),r=void 0===n?"":n,a=t.search,l=void 0===a?"":a,o=t.order_by,i=void 0===o?"":o,c=t.select,u=void 0===c?"":c,d=t.page_size,s=void 0===d?10:d,f=t.page_no,p=void 0===f?1:f,m=t.ids;E("query","nocodeformdesigner",[e,{filter:r,search:l,order_by:i,select:u,page_size:s,page_no:p,ids:void 0===m?[]:m}])}},Z=(0,S.useMemo)((function(){var e=r.children,t=void 0===e?[]:e;return t[0].icon=D().createElement(w.Icon,{prefix:"nocodeplatformicon",type:"gerenzhongxin",style:{color:"#3987ED"}}),t[1].icon=D().createElement(w.Icon,{prefix:"nocodeplatformicon",type:"zuzhi",style:{color:"#3987ED"}}),Aa(t)[0]}),[r]),Q=Cc({id:O,formId:H.relationFormId,eventName:"setListTreeConfig",parser:function(e){var t=e.data;return $t(t,t,o)},defaultValue:[]}),J=(0,S.useMemo)((function(){if(2===H.valueType)return""===H.relationFormId?[]:H.relationFormId===i?c:Q;if(3===H.valueType){var e;if(""===H.relationFieldId)return[];var t=(null===(e=Is(u,(function(e){return e.key===H.relationFieldId})))||void 0===e?void 0:e.children)||[];return Ts(t,(function(e){var t=e.compareTypes,n=void 0===t?[]:t,r=e.key,a=H.relationFieldId.replace(/\./g,"\\."),l=r.replace(new RegExp("^"+a+"\\.(\\S+)"),"$1");if((null!=l&&F()(l).call(l,"fbasedataid")?l.split(".fbasedataid")[0]:l).split(".").length>2)return!1;var o=v()(n).call(n,(function(e){return"001"!==e.id}));return bs(bs({},e),{},{compareTypes:o,key:l})}))}return[]}),[H.relationFormId,H.relationFieldId,H.valueType,i,c,Q,u]),$=(0,S.useMemo)((function(){return Ns(J)}),[J]),ee=(0,S.useMemo)((function(){return xs(J)}),[J]),te=(0,S.useMemo)((function(){var e;return"1"===H.valueType2Multi?[Ds]:h()(e=[Ss]).call(e,(0,P.c)(As(J)))}),[J,H.valueType2Multi]),ne=(0,S.useMemo)((function(){if(!H.relationFieldId)return!1;var e=Is(u,(function(e){return e.key===H.relationFieldId}));return null==e?void 0:e.isMulti}),[H.relationFieldId,u]),re=(0,S.useMemo)((function(){var e;if(""===H.relationFieldId)return[];if(3===H.valueType&&ne&&"1"===H.valueType3Multi)return[Ds];var t=Is(u,(function(e){return e.key===H.relationFieldId})),n=Ts((null==t?void 0:t.children)||[],(function(e){var t=e.children,n=(0,Ce.c)(e,hs),r=n.isMulti,a=n.key,l=H.relationFieldId.replace(/\./g,"\\."),o=a.replace(new RegExp("^"+l+"\\.(\\S+)"),"$1");return!((null!=o&&F()(o).call(o,"fbasedataid")?o.split(".fbasedataid")[0]:o).split(".").length>2)&&bs(bs({},!r&&t?e:n),{},{key:o})}));return h()(e=[Ss]).call(e,(0,P.c)(n))}),[H.relationFieldId,u,H.valueType3Multi,ne]),ae=(0,S.useMemo)((function(){return ui({metaApi:V,options:c})}),[c]),oe=(0,S.useMemo)((function(){return di({options:c})}),[c,U]),ie=(null===(t=Is(u,(function(e){return e.key===H.relationFieldId})))||void 0===t?void 0:t.entityId)||"",ce=Cc({id:O,formId:H.relationFormId,eventName:"filterItemLook"}),ue=(0,S.useMemo)((function(){var e;return Array.isArray(H.filterInfos)?N()(e=H.filterInfos).call(e,(function(e){return bs(bs({},e),{},{value:"string"==typeof e.value?JSON.parse(e.value):e.value||[]})})):[]}),[H.filterInfos]);(0,S.useEffect)((function(){var e=ce.data,t=ce.param,n=(void 0===t?{}:t).enumField;if(n){var r=null==ue?void 0:v()(ue).call(ue,(function(e){return e.fieldName===n})),a=Is(J,(function(e){return e.key===n}));_((function(t){return bs(bs({},t),{},(0,s.c)({},n,{configuredFilter:{enumEqCompareType:"001",items:r},fieldFilterConfig:a,groupInfo:e}))}))}}),[ce,ue,J]),(0,S.useEffect)((function(){var e;H.relationFormId&&((e=H.relationFormId)!==U&&b("listtreeconfig",[e]))}),[H.relationFormId]),(0,S.useEffect)((function(){if(2===H.valueType){var e=H.filterInfos,t=H.sortInfos,n=H.relationFormId,r=H.valueType2Result,a=H.valueType2Multi,l=H.valueType2Top;A.setFieldsValue({filterInfos:e,sortInfos:t,relationFormId:n,valueType2Result:r,valueType2Multi:a,valueType2Top:l})}else if(3===H.valueType){var o=H.relationFieldId,i=H.valueType3Result,c=H.valueType3FilterInfos,u=H.valueType3SortInfos,d=H.valueType3Multi,s=H.valueType3Top;A.setFieldsValue({relationFieldId:o,valueType3Result:i,valueType3FilterInfos:c,valueType3SortInfos:u,valueType3Multi:d,valueType3Top:s})}}),[H.valueType]),(0,S.useEffect)((function(){var e=H.valueType2Top;A.setFieldsValue({valueType2Top:e})}),[H.valueType2Multi]),(0,S.useEffect)((function(){var e=H.valueType3Top;A.setFieldsValue({valueType3Top:e})}),[H.valueType3Multi]);var de=(0,S.useMemo)((function(){return!(null!=l&&F()(l).call(l,"new_rule_"))}),[n]),se=(0,S.useMemo)((function(){return 2===H.valueType?"1"===H.valueType2Multi:3===H.valueType&&(ne&&"1"===H.valueType3Multi)}),[H.valueType,H.valueType2Multi,H.valueType3Multi,ne]),fe=function(e){!function(e){b("getFilterItemLook",[e,{getEnumData:"true",enumField:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",filterrows:[]}])}(H.relationFormId,e.fieldName)},pe=function(e,t){q((0,s.c)({},e,t)),f((0,s.c)({},e,t))},me=function(e){q(e),f(e)};(0,S.useEffect)((function(){(0,Se.isEqual)(n,H)||(q(n),A.setFieldsValue(n))}),[n]);return D().createElement("div",{className:"bill-finder-setting",key:l},D().createElement("div",{className:"setting-form"},D().createElement(w.ConfigProvider,{value:{prefixCls:"kd"}},D().createElement(w.Form,{layout:"vertical",form:A,labelWidth:"100%",wrapperWidth:"100%",onValuesChange:function(e,t){}},D().createElement(w.Form.Item,{label:"规则名称",name:"ruleName",required:!0,validateTrigger:"onBlur",rules:[{required:!0,message:"请输入规则名称"},{type:"string",validator:function(e,t,n,r,a){return null!=t&&Xr()(t).call(t)?[]:[new Error("请输入规则名称")]}}]},D().createElement(w.Input,{type:"text",borderType:"bordered",size:"middle",placeholder:"请输入规则名称",maxLength:50,value:H.ruleName,onChange:function(e){return pe("ruleName",e.target.value)}})),D().createElement(w.Form.Item,{label:"查找方式",name:"valueType",rules:[{required:!0,message:"请输入规则名称",type:"number"}]},D().createElement(Un.Sectioner,{defaultValue:2,value:H.valueType,options:[{label:"通过筛选条件",value:2},{label:"通过关联表单",value:3}],onChange:function(e){return pe("valueType",e)}})),2===H.valueType&&D().createElement(D().Fragment,null,D().createElement(w.Form.Item,{label:"查找表单",name:"relationFormId",required:!0},D().createElement(Un.KDTreeSelect,{allowClear:!0,value:H.relationFormId||"",treeData:Z,showTreeIcon:!0,treeIcon:function(e){return e.icon},onChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";(e=e||"")!==H.relationFormId&&(me({relationFormId:e,filterInfos:[],sortInfos:[],valueType2Result:[]}),A.setFieldsValue({relationFormId:e,filterInfos:null,sortInfos:null,valueType2Result:null}))}})),D().createElement(w.Form.Item,{label:"配置筛选条件",name:"filterInfos",rules:[{type:"array",required:!0,message:"请配置筛选条件"}]},D().createElement(Un.FilterEditor,{id:"filter",ref:Y,valueRequired:!0,name:"配置筛选条件",tips:"",variablesTree:ae||[],listFilterConfig:$,onGetFieldRecords:fe,fieldRecords:B,nameHidden:!0,style:{marginTop:"0px"},getVarSelectDisabled:Fs,fieldData:{fieldType:"treeSelect",style:{width:"184px"}},filterFooterData:{listType:"tree",triggerText:"添加筛选条件",treeProps:{defaultExpandAll:!1}},value:H.filterInfos||[],refBillProps:X,onChange:function(e){A.setFieldValue("filterInfos",e),pe("filterInfos",e)}})),D().createElement(w.Form.Item,{label:"配置排序条件",name:"sortInfos"},D().createElement(Un.OrderByEditor,{id:"filter",name:"配置排序条件",nameHidden:!0,tips:"",style:{marginTop:"0px"},treeData:ee||[],value:H.sortInfos||[],onChange:function(e){return pe("sortInfos",e)}})),D().createElement(w.Form.Item,{label:"查找数量",name:"valueType2Multi"},D().createElement(Un.Sectioner,{defaultValue:"0",value:H.valueType2Multi,options:ks,onChange:function(e){me({valueType2Multi:e,valueType2Result:[]}),A.setFieldsValue({valueType2Multi:e,valueType2Result:null})}})),"1"===H.valueType2Multi&&D().createElement(w.Form.Item,{label:"数量上限（最多1000条）",name:"valueType2Top",required:!0},D().createElement(w.InputNumber,{borderType:"bordered",value:H.valueType2Top,min:0,max:1e3,mustInScope:!0,decimalLength:0,onChange:function(e){var t;return pe("valueType2Top",(null===(t=e.target)||void 0===t?void 0:t.value)||"")}})),D().createElement(w.Form.Item,{label:"查找到记录后",name:"valueType2Result",rules:Ms},D().createElement(Cs,{prefixCls:m,isMultiMode:se,selBillValue:H.relationFormId||"",sourceFieldOptions:te,value:H.valueType2Result||[],onChange:function(e){return pe("valueType2Result",e)},curListFilterConfig:c}))),3===H.valueType&&D().createElement(D().Fragment,null,D().createElement(w.Form.Item,{label:"选择关联表单",name:"relationFieldId",required:!0},D().createElement(Un.KDTreeSelect,{className:"suffix-icon-no-animation",allowClear:!0,value:H.relationFieldId,treeData:oe,suffixIcon:D().createElement(w.Icon,{prefix:"designericon",type:"duixiangxuanze2"}),onChange:function(e){e!==H.relationFieldId&&(me({relationFieldId:e,valueType3Result:[],valueType3FilterInfos:[],valueType3SortInfos:[]}),A.setFieldsValue({relationFieldId:e,valueType3Result:null,valueType3FilterInfos:null,valueType3SortInfos:null}))},showFullLabelTips:!0})),ne&&D().createElement(D().Fragment,null,D().createElement(w.Form.Item,{label:"配置筛选条件",name:"valueType3FilterInfos",rules:[{type:"array",required:!0,message:"请配置筛选条件"}]},D().createElement(Un.FilterEditor,{id:"filter",ref:W,valueRequired:!0,name:"配置筛选条件",tips:"",variablesTree:ae||[],listFilterConfig:$,onGetFieldRecords:fe,fieldRecords:B,nameHidden:!0,style:{marginTop:"0px"},getVarSelectDisabled:Fs,fieldData:{fieldType:"treeSelect",style:{width:"184px"}},filterFooterData:{listType:"tree",triggerText:"添加筛选条件",treeProps:{defaultExpandAll:!1}},value:H.valueType3FilterInfos||[],refBillProps:X,onChange:function(e){A.setFieldValue("valueType3FilterInfos",e),pe("valueType3FilterInfos",e)}})),D().createElement(w.Form.Item,{label:"配置排序条件",name:"valueType3SortInfos"},D().createElement(Un.OrderByEditor,{id:"filter",name:"配置排序条件",nameHidden:!0,tips:"",style:{marginTop:"0px"},treeData:ee||[],value:H.valueType3SortInfos||[],onChange:function(e){return pe("valueType3SortInfos",e)}})),D().createElement(w.Form.Item,{label:"查找数量",name:"valueType3Multi"},D().createElement(Un.Sectioner,{defaultValue:"0",value:H.valueType3Multi,options:ks,onChange:function(e){me({valueType3Multi:e,valueType3Result:[]}),A.setFieldsValue({valueType3Multi:e,valueType3Result:null})}})),"1"===H.valueType3Multi&&D().createElement(w.Form.Item,{label:"数量上限（最多1000条）",name:"valueType3Top",required:!0},D().createElement(w.InputNumber,{borderType:"bordered",value:H.valueType3Top,min:0,max:1e3,mustInScope:!0,decimalLength:0,onChange:function(e){var t;return pe("valueType3Top",(null===(t=e.target)||void 0===t?void 0:t.value)||"")}}))),D().createElement(w.Form.Item,{label:"查找到记录后",name:"valueType3Result",rules:Ms},D().createElement(Cs,{prefixCls:m,isMultiMode:se,selBillValue:ie||"",relationFieldId:H.relationFieldId,sourceFieldOptions:re,value:H.valueType3Result||[],onChange:function(e){return pe("valueType3Result",e)},curListFilterConfig:c})))))),D().createElement("div",{className:"setting-footer"},D().createElement(w.Button,{size:"small",type:"primary",onClick:function(){var e,t=K.findControl(j),n=t._Type_,r=t.Key,o=ot(n)?h()(e="".concat(r,".")).call(e,a.Key):a.Key;new(jr())((function(e,t){A.validateFields().then((function(t){var n=Ni()(t);e(n)})).catch((function(e){return t(e)}))})).then((function(e){var t,n,r=e.ruleName,a=e.valueType,i=e.valueType2Result,c=e.valueType3Result,u=e.relationFormId,d=e.relationFieldId,s=e.filterInfos,f=e.valueType2Multi,p=e.valueType2Top,m=e.valueType3FilterInfos,v=e.valueType3SortInfos,g=e.valueType3Multi,y=e.valueType3Top,C=e.sortInfos||[],h=2===a&&(null===(t=Y.current)||void 0===t||null===(n=t.updateVerifyAndGetMsg)||void 0===n?void 0:n.call(t)),E={result:2===a?i:c,relationFormId:2===a?u:d};if(2===a)E.filterInfos=s,E.sortInfos=C,E.multi=f,"1"===f&&(E.top=p);else if(3===a){var N,T;if(ne)if(E.multi=g,E.filterInfos=m,E.sortInfos=v,"1"===g&&(E.top=y),(null===(N=W.current)||void 0===N||null===(T=N.updateVerifyAndGetMsg)||void 0===T?void 0:T.call(N)).length)return}var x={ruleName:Xr()(r).call(r),valueType:a,value:E},A={formId:U,fieldKey:o,ruleInfo:Kl()(x)};de&&(A.ruleId=l);var F={nocodeformdesigner:I()};!h.length&&b("saveBizRule",[A],[F])})).catch((function(e){}))}},"保存")))};function Rs(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Bs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rs(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):Rs(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var _s=function(e){var t=e.handleAdd;return D().createElement("div",{className:"rule-empty"},D().createElement("img",{src:Qu,alt:"暂无卡片",width:224,height:128}),D().createElement("div",{className:"empty-text"},"暂无规则，点击下方按钮添加"),D().createElement(w.Button,{type:"primary",icon:D().createElement(w.Icon,{prefix:"nocodeplatformicon",type:"zengjia-yuan"}),onClick:t},"添加规则"))},Os={valueType:2,relationFormId:"",relationFieldId:"",filterInfos:[],sortInfos:[],valueType2Result:[],valueType3Result:[],valueType3FilterInfos:[],valueType3SortInfos:[],valueType2Multi:"0",valueType3Multi:"0",valueType2Top:"100",valueType3Top:"100"},js=function(e){var t=e.ruleInfo,n=e.affectfldkeys,r=e.depfldkeys,a=e.ruleId,l=t&&qt(t)?JSON.parse(t):{},o=l.ruleName,i=l.valueType,c=l.value,u=void 0===c?{}:c,d=Bs(Bs({},Os),{},{affectfldkeys:n,depfldkeys:r,ruleId:a,ruleName:o,valueType:i});if(2===i){var f=u.filterInfos,p=void 0===f?[]:f,m=u.sortInfos,v=void 0===m?[]:m,g=u.result,y=void 0===g?[]:g,C=u.relationFormId,h=void 0===C?"":C,E=u.multi,b=u.top;(0,R.c)(d,{filterInfos:p,sortInfos:v,valueType2Multi:E,valueType2Result:y,relationFormId:h}),b&&(0,R.c)(d,{valueType2Top:b})}else if(3===i){var I=u.result,N=void 0===I?[]:I,T=u.relationFormId,x=void 0===T?"":T;(0,R.c)(d,{valueType3Result:N,relationFieldId:x}),["filterInfos","sortInfos","multi","top"].forEach((function(e){var t=u[e];t&&(0,R.c)(d,(0,s.c)({},"valueType3".concat((0,Se.upperFirst)(e)),t))}))}return d},Ls=(0,S.forwardRef)((function(e,t){var n=e.prefixCls,r=e.field,a=e.refreshEditorDisplay,l=(0,S.useState)(),o=(0,d.c)(l,2),i=o[0],c=o[1],u=(0,S.useState)(null),s=(0,d.c)(u,2),f=s[0],p=s[1],m=(0,S.useContext)(le),g=m.invokeAction,y=m.getKdesignerApi,C=m.getRefBillData,E=m.getCompareTypes,b=m.getBizRules,I=m.setBizRules,T=m.curListTreeApi,x=y().data.getRootId(),A=r.Key,M=E(),P=hc({api:T,parser:function(e){return $t(e,e,M)}}),R=hc({api:T,parser:function(e){return $t(e,e,M,4)}}),B=(0,S.useCallback)((function(){null==f||f.length;var e="new_rule_".concat((0,k.createUUid)()),t=Bs({ruleId:e,ruleName:"未命名规则",depfldkeys:"",affectfldkeys:""},Os);p(f?h()(f).call(f,t):[t]),c(e)}),[f]),_=function(e){var t=(null==f?void 0:Kr()(f).call(f,(function(t){return t.ruleId===e})))||0,n=i;if(i===e){var r=t>0?f[t-1]:void 0,a=f[t+1];r?n=r.ruleId:a&&(n=a.ruleId)}return n},O=function(e,t,n){e.stopPropagation(),null===Un.WebMsg||void 0===Un.WebMsg||Un.WebMsg.showConfirmModal({title:"确定删除".concat(t,"吗？"),type:"delete",onAction:function(e){if("ok"===e)!function(e){if("string"==typeof e&&F()(e).call(e,"new_rule_")){var t=_(e);c(t),p((function(t){return null==t?void 0:v()(t).call(t,(function(t){return t.ruleId!==e}))}))}else g("deleteBizRule",[{ruleId:e}])}(n)}})},j=(0,S.useCallback)((function(e){p(N()(e).call(e,js)),e.length&&c(e[0].ruleId)}),[]),L=function(e){p((function(t){return null==t?void 0:N()(t).call(t,(function(t){return t.ruleId===i?Bs(Bs({},t),e):t}))}))},K=(0,S.useMemo)((function(){return C()}),[C]);(0,S.useEffect)((function(){var e=function(e){j(e),a()};return k.eventBus.on(ir,e),function(){k.eventBus.off(ir,e)}}),[]),(0,S.useEffect)((function(){var e=function(e){var t=_(e);c(t),p((function(t){return null==t?void 0:v()(t).call(t,(function(t){return t.ruleId!==e}))})),function(e){var t=b();I(null==t?void 0:v()(t).call(t,(function(t){return t.ruleId!==e}))),a()}(e)};return k.eventBus.on(cr,e),function(){k.eventBus.off(cr,e)}}),[p,i]),(0,S.useEffect)((function(){var e=function(e){L(e),c(e.ruleId),function(e){var t=b(),n=Bs(Bs({},(null==f?void 0:xe()(f).call(f,(function(e){return e.ruleId===i})))||{}),e),r=null!=i&&F()(i).call(i,"new_rule_")?h()(t).call(t,n):N()(t).call(t,(function(e){return e.ruleId===i?n:e}));I(r),a()}(e)};return k.eventBus.on(lr,e),function(){k.eventBus.off(lr,e)}}),[p,i]),(0,S.useImperativeHandle)(t,(function(){return{getRules:function(){return null==f?void 0:N()(f).call(f,(function(e){var t="null"===e.depfldkeys?"":e.depfldkeys,n="null"===e.affectfldkeys?"":e.affectfldkeys;return Bs(Bs({},e),{},{depfldkeys:t,affectfldkeys:n})}))}}}),[f]);var V=(0,S.useMemo)((function(){return i?null==f?void 0:xe()(f).call(f,(function(e){return e.ruleId===i})):{}}),[i,f]);return f?f.length?D().createElement("div",{className:"".concat(n,"-main")},D().createElement("div",{className:"left-area"},D().createElement("div",{className:"rule-list"},null==f?void 0:N()(f).call(f,(function(e){var t=e.ruleName,n=e.ruleId,r=e.depfldkeys,a=e.affectfldkeys;return D().createElement("div",{className:jn()("rule-item",{"is-active":i===n}),key:n,onClick:function(){return c(n)}},D().createElement("div",{className:"rule-name"},t,D().createElement(w.Icon,{prefix:"ncicon",type:"jingshi",className:jn()("warning-icon",{show:!1})})),D().createElement("div",{className:"tags"},F()(r).call(r,A)&&D().createElement("span",{className:"tag-item"},"触发"),F()(a).call(a,A)&&D().createElement("span",{className:"tag-item"},"受影响的")),D().createElement("div",{className:"delete-btn",onClick:function(e){return O(e,t,n)}},D().createElement(w.Icon,{prefix:"designericon",type:"shanchu"})))}))),D().createElement("div",{className:"add-rule",onClick:B},D().createElement("span",{className:"add-btn"},D().createElement(w.Icon,{prefix:"designericon",type:"zengjia-yuan"}),"新增规则"))),D().createElement("div",{className:"right-area"},D().createElement(Ps,{value:V,refBillData:K,field:r,ruleId:i,compareTypesMap:M,formId:x,listFilterConfig:P,curFormFieldTree:R,onChange:L}))):D().createElement("div",{className:"".concat(n,"-main")},D().createElement(_s,{handleAdd:B})):null})),Ks=function(e){var t=e.prefixCls,n=e.title,r=e.visible,a=e.setVisible,l=e.field,o=e.listFilterConfig,i=e.refreshEditorDisplay,c=(0,S.useRef)(null),u=function(){a(!1)};return D().createElement(w.Modal,{mask:!0,visible:r,body:D().createElement(Ls,{ref:c,prefixCls:t,field:l,listFilterConfig:o,refreshEditorDisplay:i}),titleIcon:null,className:"".concat(t,"-modal"),footer:null,maskClosable:!1,width:960,height:644,keyboard:!1,title:D().createElement("span",{title:n},n),closable:!0,draggable:!1,destroyOnClose:!0,onCancel:u,onOk:u})},Vs=function(e){var t=e.locked,n=e.field,r=n.Name,a=n.Key,l=n.ParentId,o=(0,S.useState)(!1),i=(0,d.c)(o,2),c=i[0],u=i[1],s=(0,S.useContext)(le),f=s.invokeAction,p=s.prefixCls,m=s.getKdesignerApi,v=s.getDataRef,g=s.getBizRules,y=s.fetchListTree,C=m().data,E=C.getRootId(),b=g()||[],I=(0,S.useReducer)((function(e){return e+1}),0),N=(0,d.c)(I,2)[1],T=function(){var e,t=C.findControl(l),r=t._Type_,a=t.Key,o=ot(r)?h()(e="".concat(a,".")).call(e,n.Key):n.Key,i=[{nocodeformdesigner:v()}];f("getBizRules",[{formId:E,fieldKey:o}],i),y(),u(!0)},x=(0,S.useMemo)((function(){var e=b.reduce((function(e,t){var n=t.affectfldkeys,r=t.depfldkeys;return null!=n&&F()(n).call(n,a)||F()(r).call(r,a)?e+1:e}),0);return 0!==e?"".concat(e,"条规则"):""}),[b,a]),A="".concat(p,"-billFinder");return D().createElement(D().Fragment,null,D().createElement(k.CustomInputTrigger,(0,R.c)({},e,{placeholder:"请选择",disabled:t,value:x,onClick:T,onInputClick:T})),D().createElement(Ks,{prefixCls:A,visible:c,setVisible:u,field:n,title:"".concat(r,"-查找表单记录"),refreshEditorDisplay:N}))},Us=Un.Condition.constants,Gs=Us.allFieldRegExp,zs=Us.allExpRegExp,Hs=Us.expRegExp,qs={valueType:1,value:""},Ys=Kl()(qs),Ws={prefixCls:"kd"},Xs=function(e){var t,n=e.className,r=e.locked,a=e.Editor,l=e.Name,o=e.Tips,i=e.field,c=a.NameHidden,u=a.Required,s=a.Title,f=(0,S.useContext)(le),p=f.invokeAction,m=f.getKdesignerApi,v=f.getExpressionData,g=f.getCompareTypes,y=f.curFormulaTreeApi,C=f.fetchListTree,E=i.ParentId,b=i.Name,I=i.Key,N=(0,S.useState)(!1),T=(0,d.c)(N,2),A=T[0],F=T[1],M=m(),P=M.data,R=(M.meta,P.findControl(E)),B=R._Type_,_=R.Key,O=ot(B)?h()(t="".concat(_,".")).call(t,I):I,j=P.getRootId(),L=(0,S.useState)(Ys),K=(0,d.c)(L,2),V=K[0],U=K[1],G=g(),z=(0,S.useMemo)((function(){return v()}),[v]),H=(0,S.useMemo)((function(){return x()(z.functionOperations)}),[z]),q=function(e){var t=e||{},n=t.bizRule,r=t.fieldKey;n&&r===O&&U(n)};(0,S.useEffect)((function(){return k.eventBus.on(gr,q),function(){k.eventBus.off(gr,q)}}),[]);var Y=hc({api:y,parser:function(e){return $t(e,e,G)}}),W=(0,S.useMemo)((function(){var e=ot(B)?_:void 0;return ci({options:Y,currRefbillTableKey:e})}),[Y,j,_]);(0,S.useEffect)((function(){p("getBizRule",[{formId:j,fieldKey:O}],[])}),[]);(0,S.useEffect)((function(){C("formula")}),[b]);var X=function(e){var t=Kl()(e);U(t)},Z=(0,S.useMemo)((function(){return e=function(e){try{if(qt(e)){var t=JSON.parse(e);return(null==t?void 0:t.value)||""}return""}catch(e){}}(V),t=e?e.split("@@"):["","",null],[(n=(0,d.c)(t,3))[1],n[2]];var e,t,n}),[V]),Q=(0,S.useCallback)((function(){F(!0)}),[F]),J=(0,S.useCallback)((function(){F(!1)}),[F]),$=(0,S.useCallback)((function(){Q()}),[Q]);return D().createElement(D().Fragment,null,D().createElement(k.NameTipWrapper,{nameHidden:c,className:n,name:l,tips:o,required:u,title:s}),D().createElement(w.ConfigProvider,{value:Ws},D().createElement(Un.InputCombo,{fieldType:"formula",placeholder:"请输入",disabled:r,onClick:$,value:Z[0],expressionData:z.functionTypes,fieldData:W,onClear:function(e){e.stopPropagation(),p("deleteBizRule",[{formId:j,fieldKey:O}],[]),X(qs)},lang:Number(Z[1]||1),readOnly:!0,autofocus:!1})),D().createElement(w.ConfigProvider,{value:Ws},A&&D().createElement(Un.Condition,{value:Z[0],language:Number(Z[1]||1),modalTitle:"编辑运算公式",editorTitle:i.Name,visible:A,editorPlaceholder:"请编辑运算公式",fieldData:W,fieldTitle:"表单内容",expressionData:z.functionTypes,operations:H,defaultExpandAll:!1,onClose:J,onConfirm:function(e,t){e=function(e,t){var n,r;if(!e)return"";var a=(e=e.replace(/）/g,")").replace(/（/g,"(").replace(/“/g,'"').replace(/”/g,'"').replace(/‘/g,"'").replace(/’/g,"'")).replace(/ {{/g,"{{").replace(/}} /g,"}}").replace(Gs,"$1");return a=a.replace(zs,(function(e){var t;return((null===(t=e.match(Hs))||void 0===t?void 0:t[1])||"").replace("YMDDATE","DATE")})),h()(n=h()(r="".concat(a,"@@")).call(r,e,"@@")).call(n,t?1:0)}(e,t);var n,r={valueType:1,value:e};n=r,p("saveBizRule",[{formId:j,fieldKey:O,ruleInfo:Kl()(n)}]),X(r),F(!1)}})))},Zs=D().memo((function(e){var t,n=e.data,r=e.iconIndex,a=e.onSelect,l=e.isLineIconStyle,o=e.prefixClass,i=(0,S.useState)(0),c=(0,d.c)(i,2),u=c[0],f=c[1],p=(0,S.useRef)(null);(0,S.useEffect)((function(){f(r)}),[r]);var m=(0,S.useCallback)((function(e){f(e),null==a||a(e)}),[a,n]);return(0,S.useLayoutEffect)((function(){var e,t,n=null===(e=p.current)||void 0===e?void 0:e.getElementsByTagName("path");n&&(Array.prototype.forEach.call(n,(function(e){return e.removeAttribute("style")})),null===(t=n[u])||void 0===t||t.setAttribute("style","fill:#212121"))}),[u,p.current]),D().createElement("div",{className:"".concat(o,"-popmain")},D().createElement("div",{ref:p,className:"".concat(o,"-icons")},null==n?void 0:N()(t=n.svgs).call(t,(function(e,t){var n=u===t?"#212121":"";return D().createElement("div",{key:t,onClick:function(){return m(t)},className:jn()((0,s.c)((0,s.c)({},"".concat(o,"-iconf"),l),"".concat(o,"-iconf-active"),l&&u===t)),style:{color:n},dangerouslySetInnerHTML:{__html:e.content}})}))))})),Qs=(0,S.memo)((function(e){var t=e.handleChange,n=e.className,r=e.editor,a=e.Name,l=e.Tips,o=e.value,i=r.NameHidden,c=r.Required,u=(0,S.useContext)(le),s=u.invokeAction,f=u.prefixCls,p=(u.getKdesignerApi,"".concat(f,"-iconPicker-editor")),m=(0,S.useState)({iconIndex:void 0}),v=(0,d.c)(m,2),g=v[0],y=v[1],C=(0,S.useRef)(null),E=(0,S.useState)({}),b=(0,d.c)(E,2),I=b[0],N=b[1];(0,S.useEffect)((function(){s("getSvgLine",[])}),[]);var T=(0,S.useCallback)((function(e){var t,n;N(null==e||null===(t=e.data)||void 0===t?void 0:t.row),M(o,null==e||null===(n=e.data)||void 0===n?void 0:n.row)}),[]);(0,S.useEffect)((function(){return k.eventBus.on(pr,T),function(){k.eventBus.off(pr,T)}}),[]);var x=(0,S.useMemo)((function(){return{name:a,className:n,nameHidden:i,tips:l,required:c}}),[a,n,i,l,c]),A=function(e){var n,r;y({iconIndex:e});var a=encodeURIComponent("#666666"),l=null==I||null===(n=I.svgs)||void 0===n?void 0:n[e].label,o=h()(r="nocode/v2/nocode_sys/common/svgs/create_svg_line?color=".concat(a,"&svg=")).call(r,l);null==t||t(o)},F=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.href).split("?")[1],n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),r=null==t?void 0:t.match(n);return null!=r?unescape(r[2]):null},M=(0,S.useCallback)((function(e,t){var n,r=F("svg",e),a=r&&"undefined"!==r?null==t||null===(n=t.svgs)||void 0===n?void 0:Kr()(n).call(n,(function(e){return e.label===r})):0;y({iconIndex:a})}),[]);(0,S.useLayoutEffect)((function(){var e;if(I&&C.current){null===(e=C.current.getElementsByTagName("path"))||void 0===e||null===(e=e[0])||void 0===e||e.setAttribute("style","fill:".concat("#212121"," "))}}),[I,g,C.current]);var P=(0,S.useMemo)((function(){return D().createElement(Zs,{data:I,iconIndex:g.iconIndex,onSelect:A,prefixClass:p,isLineIconStyle:!0})}),[I,g]),R=(0,S.useCallback)((function(e){if(e)M(o,I);else{var n,r,a=encodeURIComponent("#666666"),l=null==I||null===(n=I.svgs)||void 0===n?void 0:n[g.iconIndex].label,i=h()(r="nocode/v2/nocode_sys/common/svgs/create_svg_line?color=".concat(a,"&svg=")).call(r,l);null==t||t(i)}}),[I,g,t]),B=(0,S.useMemo)((function(){var e,t,n=F("svg",o),r=n&&"undefined"!==n?null==I||null===(e=I.svgs)||void 0===e?void 0:Kr()(e).call(e,(function(e){return e.label===n})):0;return D().createElement("div",{ref:C,className:"".concat(p,"-avatar"),dangerouslySetInnerHTML:{__html:(null==I||null===(t=I.svgs)||void 0===t||null===(t=t[r])||void 0===t?void 0:t.content)||""}})}),[I,g,o]);return D().createElement("div",{className:p},D().createElement("div",{className:"".concat(p,"-nav")},D().createElement(k.NameTipWrapper,x)),D().createElement("div",null,D().createElement(w.ConfigProvider,{value:{prefixCls:"kd"}},D().createElement(w.Tooltip,{placement:"bottomLeft",arrow:!1,popperClassName:"".concat(p,"-pop"),gap:0,tip:P,trigger:"click",onVisibleChange:R},B))))}));Qs.displayName="IconPickerEditor";var Js=(0,k.ErrorBoundaryWrap)(Qs,"IconPickerEditor"),$s=(0,S.memo)((function(e){e.handleChange;var t=e.className,n=e.editor,r=(e.locked,e.Name),a=e.Tips,l=e.field,o=(e.id,e.propName,e.rootId),i=n.NameHidden,c=n.Required,u=n.Title,s=(0,S.useContext)(le),f=s.invokeAction,p=s.getHideFieldRef,m=(0,S.useContext)(k.GlobalConfigContext).showMessage,v=(0,S.useState)(""),g=(0,d.c)(v,2),y=g[0],C=g[1],h=(0,S.useState)([]),E=(0,d.c)(h,2),b=E[0],I=E[1],T=(0,S.useState)({}),x=(0,d.c)(T,2),A=x[0],F=x[1],M=l.BillEntityIdEx,w=l.Key,P=l._Type_,R=l.RefBillId,B="".concat(t,"-association"),_=(0,S.useMemo)((function(){var e,t,n;R&&ot(P)&&(t=null===(n=p())||void 0===n?void 0:n[R]);return(null===(e=t)||void 0===e?void 0:e.Key)||w}),[w,P,R]),O=(0,S.useCallback)((function(e){return N()(e).call(e,(function(e){var t=e||{};return{value:t.id,label:t.caption}}))}),[]),j=(0,S.useCallback)((function(e){var t=e||{},n=t.selected,r=t.data,a=O(r||[]);I(a||[]),C(n||"")}),[O]),L=(0,S.useCallback)((function(e,t){f(Cr,[o,_,M,e||""]),C(e)}),[o,_,M,f,C]),K=(0,S.useCallback)((function(e){"failure"===(null==e?void 0:e.state)&&(m((null==e?void 0:e.message)||"双向关联失败","error"),C(""))}),[]);(0,S.useEffect)((function(){o&&_&&M&&f("getAvailableAssociationFields",[o,_,M])}),[M,_,o,f]),(0,S.useEffect)((function(){return k.eventBus.on(yr,j),k.eventBus.on(Cr,K),k.eventBus.on(mr,F),function(){k.eventBus.off(yr,j),k.eventBus.off(Cr,K),k.eventBus.off(mr,F)}}),[]);(0,S.useMemo)((function(){var e=null==A?void 0:A[l.Key];return!M||0===(null==e?void 0:e.length)}),[M,A,l]);return D().createElement("div",{className:"".concat(B,"-box")},D().createElement(k.NameTipWrapper,{nameHidden:i,className:t,name:r,tips:a,required:c,title:u}),D().createElement(Un.Select,{allowClear:!0,value:y,disabled:!1,options:b,onChange:L}))}));$s.displayName="AssociationEditor";var ef=$s,tf=function(){var e=[];return[[gc,"switchtabsel",""],[pa,"customoption",""],[Oc,"selectoption",""],[Hc,"datascope",""],[Gd,"Tab",""],[eu,"picturedef",""],[wd,"refbilltype",""],[Qc,"refbillprops",""],[du,"dataFill",""],[gu,"inputrange",""],[yu,"DateRange",""],[hu,"date",""],[Su,"decimaldef",""],[Iu,"attachdef",""],[wu,"backcolor"],[Ou,"backimage"],[ld,"displayrule"],[Vs,"bizrule"],[Xs,"formularule"],[od,"textdef",""],[sd,"triggerprocess"],[xd,"enablefilter"],[fs,"inputContent"],[Sd,"richtextdef"],[Rd,"margin"],[Ld,"inputForm"],[Ud,"mulrefbilldef"],[Js,"iconPicker",""],[ef,"association"]].forEach((function(t){var n=(0,d.c)(t,3),r=n[0],a=n[1],l=n[2];e.push([a,r,l])})),e};function nf(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function rf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nf(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):nf(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var af={BizappId:"bizappId",Name:"name",Id:"id",appNum:"formId",Key:"key",EntityId:"rootEntityId"},lf=function(e,t){p()(t).forEach((function(n){_r()(e,n)||(0,R.c)(e,(0,s.c)({},n,t[n]))}))},of=function(e){return(0,yt.produce)(e,(function(e){e.forEach((function(t){(function(e){return e._Type_===Le&&!e.GroupParentId&&!e.GroupIndex&&!e.isTab})(t)&&(t.GroupParentId=(0,k.createUUid)(),t.GroupIndex=0,v()(e).call(e,(function(e){return e.ParentId===t.Id&&function(e){return e._Type_===Le&&!e.GroupParentId&&!e.GroupIndex&&e.isTab}(e)})).forEach((function(e,n){e.GroupParentId=t.GroupParentId,e.GroupIndex=n+1,e.ParentId=t.ParentId})))}))}))},cf=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,Se.cloneDeep)(e),r=n.formmeta,a=n.entitymeta,l={},o={},i=r.Items[0].Id,c=[i],u=new(we()),f={},m=b()(t).reduce((function(e,t){return rf(rf({},e),(n=t,l=(0,d.c)(n,2),o=l[0],i=l[1],c=null==i||null===(r=i.formmeta)||void 0===r||null===(r=r.Items)||void 0===r?void 0:r.reduce((function(e,t){return Ta(Ta({},e),{},(0,s.c)({},t.Id,t))}),{}),null==i||null===(a=i.entitymeta)||void 0===a||null===(a=a.Items)||void 0===a?void 0:a.reduce((function(e,t){var n;return Ta(Ta({},e),{},(0,s.c)({},h()(n="".concat(t.Key,"_")).call(n,o),Ma((null==c?void 0:c[t.Id])||{},t)))}),{})));var n,r,a,l,o,i,c}),{});p()(r).forEach((function(e){r[e]&&af[e]&&(l[af[e]]=r[e])}));var g=r.Items.reduce((function(e,t){var n,r=t||{},a=r._Type_,l=r.Id,o=r.FieldType;return Kt(a)&&c.push(l),lt(o)||ot(o)?h()(n=[]).call(n,(0,P.c)(e),[l]):e}),[]),y=a.Items.reduce((function(e,t){var n,r=t||{},a=r._Type_,l=r.Id,o=r.SourceForm,d=r.ParentId||i;return f[l]=t,ot(a)&&"2"===o&&u.set(l,t),ot(a)&&Fa(t)&&F()(c).call(c,d)?h()(n=[]).call(n,(0,P.c)(e),[t.Id]):e}),[]);return l[G]=of(r.Items.reduce((function(e,t){var n=rf({},t);if(null!=n&&n.ParentId){var l=n.FieldId||n.EntryId||n.CardEntryId,d=null==f?void 0:f[l];d&&(n.EntityData=d,n.ApType=n._Type_,n._Type_=d._Type_,n.FieldType=d._Type_,lf(n,d))}else{var s,p=xe()(s=a.Items).call(s,(function(e){return(null==e?void 0:e.Id)===n.Id}));p&&(n.EntityData=p,lf(n,p))}var C=n.ParentId,E=n.Key,b=n.EntityData;n._isEntryField_&&delete n._isEntryField_,F()(g).call(g,C)&&(n._isEntryField_=!0);var I,N=n.ParentId||i;if(F()(c).call(c,N)&&Fa(n)||F()(y).call(y,N))return o[n.Id]=n,e;if(u.has(C)){var T,x,A=E.toLowerCase().replace("_".concat(C.toLowerCase()),"")+"_"+u.get(C).BillEntityIdEx,S=m[A];if(S){var D,k=[{},{}];Xe.forEach((function(e){n[e]&&(k[0][e]=n[e]),b[e]&&(k[1][e]=b[e])}));var M=Ra(S,C,k);return delete(t=rf({},M)).EntityData,f[M.Id]=M.EntityData,h()(D=[]).call(D,(0,P.c)(e),[M])}return a[G]=v()(T=a[G]).call(T,(function(e){return e.Id!==n.Id})),r[G]=v()(x=r[G]).call(x,(function(e){return e.Id!==n.Id})),e}return h()(I=[]).call(I,(0,P.c)(e),[n])}),[])),a.Items=x()(f),[l,o,n]},uf=function(e,t){var n,r,a=e||{},l=a._Type_,o=a.EntityData,i=void 0===o?{}:o,c=a.ApType,u=rf({},e);c&&(u._Type_=c);var d=h()(n=v()(r=p()(i)).call(r,(function(e){return t.getControlMetaProperty(l,e).Tag===Be}))).call(n,["EntityData","ApType","_isEntryField_"]);return d.forEach((function(e){delete u[e]})),u},df=function e(t,n){return t.reduce((function(t,r){var a,l=r.Id;return n[l]?h()(t).apply(t,h()(a=[r]).call(a,(0,P.c)(e(n[l],n)))):h()(t).call(t,r)}),[])},sf=function(e,t,n,r){var a=n.meta,l=e.entitymeta,o=e.formmeta,i=t.Items,c=void 0===i?[]:i,u=c.reduce((function(e,t){var n=t.ParentId;return void 0!==n&&(void 0===e[n]?e[n]=[t]:e[n].push(t)),e}),{}),d=df([c[0]],u),s=d.reduce((function(e,t){var n=t.Key,a=t.EntityData;t.Id;if(a){var l,o,i=rf(rf({},a),{},{Key:n});if(ot(i._Type_)){var c,u,d,s=rf({},null===(c=r[i.RefBillId])||void 0===c?void 0:c.EntityData);return s.Key=null===(u=r[i.RefBillId])||void 0===u?void 0:u.Key,h()(d=[]).call(d,(0,P.c)(e),[i,s])}var f=null==r||null===(l=r[null==i?void 0:i.RefTableId])||void 0===l?void 0:l.EntityData;if($e(i._Type_)&&null!=i&&i.RefTableId&&f){var p,m=x()(r).reduce((function(e,t){var n;return t.ParentId===(null==i?void 0:i.RefTableId)?h()(n=[]).call(n,(0,P.c)(e),[t.EntityData]):e}),[]);return h()(p=[]).call(p,(0,P.c)(e),[i,f],(0,P.c)(m))}return h()(o=[]).call(o,(0,P.c)(e),[i])}return e}),[]),f=d.reduce((function(e,t){var n,l=t||{},o=l.RefTableId,i=l.FieldType,c=l.RefBillId,u=uf(t,a);if(ot(i)){var d,s=uf(r[c],a);return h()(d=[]).call(d,(0,P.c)(e),[u,s])}var f=null==r?void 0:r[o];if($e(i)&&o&&f){var p,m=x()(r).reduce((function(e,t){var n;return t.ParentId===o?h()(n=[]).call(n,(0,P.c)(e),[uf(t,a)]):e}),[]);return h()(p=[]).call(p,(0,P.c)(e),[u,uf(f,a)],(0,P.c)(m))}return h()(n=[]).call(n,(0,P.c)(e),[u])}),[]),p=rf(rf({},o),{},{Items:f}),m=rf(rf({},l),{},{Items:s});return(0,R.c)(e,{formmeta:p,entitymeta:m})},ff=function(e){var t=e.kdesignerApi,n=e.keywordMapping;return function(e,r,a,l){var o=t.current.meta,i="string"==typeof r?r:r[n.type],c=o.getControlMeta(i)||{},u=c.BaseType,d=c.ApType,s=null==d?void 0:d.Default,f="string"==typeof e?e:e[n.type],p=o.getControlMeta(f)||{},m=p.BaseType,v=p.ApType,g=p.Id,y=v?(null==v?void 0:v[u])||(null==v?void 0:v.Default):g;if(!l.IsContainer)return!1;var C=function(e){var t=o.getControlMeta(e).NotAccept;if(t){var n=t.Ids;return null==n?void 0:F()(n).call(n,y)}}(i);if(C)return{message:"控件类型不符合，不能添加。",success:!1};if(!(C=function(e){var t=o.getControlMeta(e).Accept;if(!t)return!0;if(t){var n=t.Basetypes,r=t.Ids;return(null==r?void 0:F()(r).call(r,y))&&(null==n?void 0:F()(n).call(n,m))}}(i)))return{message:"控件类型不符合，不能添加。",success:!1};return!!(C=function(e){var t=o.getControlMeta(e).AcceptParent;if(!t)return!0;if(t){var n=t.Basetypes,r=t.Ids;return(null==r?void 0:F()(r).call(r,s))||(null==n?void 0:F()(n).call(n,u))}}(f))||{message:"父容器类型不符合,不能添加。",success:!1}}},pf=["property"],mf={},vf=(0,S.memo)((function(e){var t=e.tabName,n=e.tabKey;if(!F()(pf).call(pf,n))return t;var r=(0,S.useContext)(le),a=r.getKdesignerApi,l=r.prefixCls,o=(0,S.useMemo)((function(){return a()}),[]),i=o.error,c=o.meta,u=o.data,s=o.selection,f=i.getError(),m=s.getSelection(),v=(0,S.useState)(!1),g=(0,d.c)(v,2),y=g[0],C=g[1],h=(0,S.useState)([]),E=(0,d.c)(h,2),b=E[0],I=E[1];(0,k.useErrorChangeForceUpdateEffect)(o),(0,k.useSelectionChangeForceUpdateEffect)(o),(0,S.useEffect)((function(){var e;if((null==m?void 0:m.length)>0&&(null===(e=p()(f))||void 0===e?void 0:e.length)>0){var t=m.some((function(e){var t=u.findControl(e)._Type_,n=c.getControlMetaPropertyGroups(t);if(f[e]){var r=p()(f[e]);if(I(r),r.length>0){var a=mf[t];a||(a=[],n.forEach((function(e){null!=e&&e.Nodes&&(null==e||e.Nodes.forEach((function(e){a.push(e.Id)})))})),mf[t]=a);var l=r[0];return F()(a).call(a,l)}}return!1}));C(t)}else y&&C(!1)}),[m,f]);var N=(0,S.useMemo)((function(){return 0===(null==b?void 0:b.length)?"":"存在有".concat(null==b?void 0:b.length,"条错误，请修复后再发布！")}),[b]);return D().createElement("div",{className:"".concat(l,"_customtab")},D().createElement("span",{className:"".concat(l,"_customtab_name")},t),y&&D().createElement(w.Tooltip,{tip:N},D().createElement(wo,{className:"".concat(l,"_customtab_icon")})))}));vf.displayName="CustomTab";var gf=vf;n(3192);function yf(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yf(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):yf(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}var hf={appFormList:[],innerForm:[]},Ef=(0,yt.produce)((function(e,t){var n,r,a=t.key,l=t.payload,o=(null==e?void 0:e[null==l?void 0:l.form])||{},i=o.data,c=void 0===i?{}:i,u=o.ids,d=void 0===u?[]:u,s=c||{},f=s.entitymeta,p=void 0===f?{Items:[]}:f,m=s.formmeta,g=void 0===m?{Items:[]}:m;switch(a){case Vr:for(var y in l){var C;if(Object.prototype.hasOwnProperty.call(l,y))e[y]={data:l[y],ids:N()(C=l[y].entitymeta.Items).call(C,(function(e){return e.Id}))}}break;case Ur:e[l.form]=l.info;break;case zr:if(null==d||!F()(d).call(d,l.data.Id)){var h,E;l.data.ParentId=F()(h=l.form).call(h,"_table")?l.data.ParentId:l.form,l.data.EntityData.ParentId=F()(E=l.form).call(E,"_table")?l.data.EntityData.ParentId:l.form;var b=Cf({},l.data);delete b.EntityData,null!=e&&e[null==l?void 0:l.form]?(p.Items.push(l.data.EntityData),g.Items.push(b)):e[l.form]={data:{entitymeta:{Items:[l.data.EntityData]},formmeta:{Items:[b]}},ids:[]}}break;case Hr:p.Items=v()(n=p.Items).call(n,(function(e){return e.Id!==l.id})),g.Items=v()(r=g.Items).call(r,(function(e){return e.Id!==l.id}));break;case Gr:p.Items.some((function(e){return e.Id===l.id&&(e=(0,R.c)(e,l.data),!0)})),g.Items.some((function(e){return e.Id===l.id&&(e=(0,R.c)(e,l.data),!0)}));break;case qr:e.appFormList=l.data,e.innerForm=l.innerForm;break;case"COPY_FORM_DATA":e[l.form]=Cf({},e[l.source])}}));function bf(){var e=[],t=[],n=1,r=0,a={setData:function(e){if(e){var n=t;t=e,a.fireEvent({value:t,oldValue:n})}},getData:function(){return t},getDataVersion:function(){return r},setDataVersion:function(e){r=e},increaseVersion:function(){n++},getVersion:function(){return n},isVersionEqual:function(){return n===r},addDataChangeListener:function(t){return e.push(t),function(){e=v()(e).call(e,(function(e){return e!==t}))}},fireEvent:function(t){e.forEach((function(e){try{e(t)}catch(e){}}))}};return a}function If(e,t){var n=p()(e);if(l()){var r=l()(e);t&&(r=v()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Nf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?If(Object(n),!0).forEach((function(t){(0,s.c)(e,t,n[t])})):u()?Object.defineProperties(e,u()(n)):If(Object(n)).forEach((function(t){Object.defineProperty(e,t,i()(n,t))}))}return e}(0,yt.enableES5)(),k.ControlView.tabName="内容";var Tf={id:"Id",type:"_Type_",name:"Name",key:"Key",parentId:"ParentId",items:"Items",fieldType:"FieldType",EntityData:"EntityData"},xf=function(e,t){return Nf(Nf({},e),t)},Af=function e(t){return t.reduce((function(t,n){var r=n.selectable,a=n.children,l=n.value,o=n.label;return!1!==r&&(t[l]=o),null!=a&&a.length?Nf(Nf({},t),e(a)):t}),{})},Ff=(0,S.memo)((0,S.forwardRef)((function(e,t){var n=e.data,a=void 0===n?{}:n,l=e.meta,o=void 0===l?{}:l,i=e.onData,c=e.settingData,u=e.showMessage,f=void 0===u?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warning";w.Message[t]({content:e,closable:"error"===t,duration:2e3,style:{background:"#fff",borderColor:"#fff",color:"#212121",boxShadow:"0 4px 10px 1px rgba(0,0,0,0.12)"}})}:u,m=(e.handleCustomInputEditor,e.invokeAction),g=void 0===m?function(e,t,n){}:m,C=e.enforceInvokeAction,E=void 0===C?function(e,t,n){}:C,I=e.baseHooks,T=e.baseUrl,A=e.onApi,M=e.onDownLoad,P=e.addControlAction,R=e.getControlText,B=e.batchInvoke,_=e.floatMenu,O=e.defaultFieldStatusMap,j=void 0===O?{}:O,L=e.fieldStatusSettingMode,K=void 0!==L&&L,V=e.fieldStatusSettingOptions,U=e.expression,G=void 0===U?[]:U,z=e.refBillData,H=void 0===z?[]:z,q=e.tableMetas,Y=void 0===q?[]:q,W=e.compareTypes,X=void 0===W?{}:W,Z=e.ncpToolKits,Q=void 0===Z?{}:Z,J=(0,S.useState)(!0),$=(0,d.c)(J,2),ee=$[0],te=$[1],ne=(0,S.useRef)(null),re=(0,S.useRef)(a),ae=(0,S.useRef)({}),oe=(0,S.useRef)([]),ie=(0,S.useReducer)(Ef,hf),ce=(0,d.c)(ie,2),ue=ce[0],de=ce[1],se=(0,S.useRef)({}),fe=(0,S.useRef)(null),pe=(0,S.useRef)(jt(a,o)),me=(0,S.useRef)(function(e){var t,n=e.formmeta,r=null==n||null===(t=n.Items)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.BillNoSetting;return r?JSON.parse(r):{}}(a)),ve=(0,S.useRef)([]),ge=(0,S.useRef)([]),ye=(0,S.useReducer)(xf,j||{}),Ce=(0,d.c)(ye,2),he=Ce[0],Ee=Ce[1],be=(0,S.useRef)(bf()),Ie=(0,S.useRef)(bf()),Ne=(0,S.useCallback)((function(e){return e}),[]),Te=(0,S.useMemo)((function(){return function(e,t){return(0,k.adaptorMeta)(e,(0,k.mergeTransformKeyMap)(k.transformKeyMap,(0,s.c)({},"items",["Enum"])),t)}(o,a.formmeta)}),[]),xe=(0,S.useMemo)((function(){var e=Y.reduce((function(e,t){return null!=t&&t.billEntityIdEx?Nf(Nf({},e),{},(0,s.c)({},t.billEntityIdEx,t.data)):e}),{}),t=cf(a,(0,Se.cloneDeep)(e)),n=(0,d.c)(t,3),r=n[0],l=n[1],o=n[2];return ae.current=l,re.current=o,null==i||i(o),p()(e).length&&de({key:Vr,payload:e}),r}),[a,Y]);(0,S.useEffect)((function(){se.current=ue}),[ue]);var Ae=(0,S.useCallback)((function(){return(0,Se.cloneDeep)(ae.current)}),[]),Fe=(0,S.useCallback)((function(e){ae.current=e}),[]),De=(0,S.useCallback)((function(e){var t=(null==c?void 0:c[e])||{},n=t.value,r=t.items,a=void 0===r?[]:r;return!n||p()(a).reduce((function(e,t){return!1===a[t].value&&e.push(t),e}),[])}),[c]),ke=(0,S.useCallback)((function(e){(0,Q.publishUserEvent)(Nf({appId:xe.bizappId,formId:xe.id},e))}),[Q]),Me=(0,S.useCallback)((function(e){switch(e){case"main":return{main:Zo};case"left":return{control:k.ControlView,systemCategories:Ki,outline:yi};case"right":return{property:bi};default:return{}}}),[]),we=(0,S.useMemo)((function(){return{showMessage:f,getViews:Me,processPropertyName:Ne,keywordMapping:Tf,enableSearch:!0,enableError:!0,dataPortalIdPrefix:"nocode-designer-top-view",controlViewSetting:{className:"".concat(Pe,"-control-view"),hideHelpIcon:!0,hideAnchorIcon:!0,hideTitleTips:!0,searchInputPlaceholder:"内容",filterCategories:function(e){return v()(e).call(e,(function(e){var t;return!(null!=e&&null!==(t=e.Id)&&void 0!==t&&y()(t).call(t,"System_"))}))},handleItemClick:function(){ke({eventName:"click",action:"fd_add_click"})},getEmptyView:function(){return D().createElement(D().Fragment,null,D().createElement("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOAAAACACAMAAAAlB5WJAAAAjVBMVEUAAADh4uvY3+rZ3erb3enY3+rX3ufZ3e3X3OfZ3Ord3uTX3efY3urX4uvX3efW3OjZ4Onb4Ovj6fPj6fPX3ejn7/bk6PPi5/Tj6fTj6fPj6fTk6fXj6PTi6PTi6PTj5/Ti6fPj6fTk6PTj6fPh5fLj6fPj6vPi6PPk6fXL0NzX3Oji6PPi6PPK0NvX3ehGj5HoAAAALHRSTlMAGhcSJSwiCTIOBj4oDDlENUbD7UoreU7ixq6gh1vMPd3SkfFmgG2ZZvD3u03m2McAAAUISURBVHja7NgLjpswFAVQvxlCKoiSgMdg/oSQTKTe/a+vlaoKw5BOAFV6RpwdWLbv+4jNZrPZbDb/hYqjLLxoCUh9CbMoVmI91D2V+EKm91Uc0rnVeKq+OcJuRYJvJIWwlveo8YL64QkrFRov0jbeogoxQWhb3ng5JsqteqdOiclKiwI1lphBxsISEWaKhBUazNYI/rwUo2Sat8F557q7c9DmqcSolH/UpBhRRhUNVFGJEalgrsEX16aiUVVzte6VRhiS+YGeOuTSrqSJMZQp+ieVYYhxtXAk+nRM34o1+iTbiu+V6EsUvUAl6Cu5RmmOvsyll7gZ+nLBkkJfRC+L0MdztgjRU9AEBXpCwVAxcn+z75DhBOxpmDKaKINJ88uZB0yJSxO5CUwPwU0Ng1Y0mdIw1IKZAqaYZohZ/8Jk5AMu+oaJYMWBQSqaRUkYeDVsNxhymimH4SY4MSPmeqCZDleuMaNgaGi2hmu/doehotkqGO6CjxSdkhYoma5n5PMmdH5LKgUbatELNVU8P2GMjqRFJMvlTIROSoukLPdr2ViVX17rM8FFiE5Li7Qs5/oLOgEtEqBzEVxodM60yBkdLbiQ6OxokR3LQgiDS4u4MAguVn/AdT/R/fvbekPm3Tl+/KZXWibI//jjsspC/+YHf/1cY6u2Czqf62u298eToTemumsYl/b+yVTA0Dr2D7z7o99zuqLz+eFav7L44Q+EZrjHJ9uXTq4/1MDQxke714a/2rn73kZBOIDjPx5EFLWP197tMb3dXdOO7v2/vMOwNLhpCxQWR/xgNPOvfdPELRWoRSPU0TTvV+VRGu62W/qtv/itms/M/2VetmsR7av7HLOK84qhHGLJ5z320nC/XtMoL18KKtZnoiogCsZNcz5XB9/K7kfYRHh9VvD1B5xABCqqM7SdNNwtZsFfgJbZokdWQmg177WRpn8zGvgVdiFmvQSBYPKiyAFw1ov/7E7C42EnIWAxG4IhCMJ0CK2yfn+l6UkEnUaCZmImhDp16HtBCkmVXcNX0nQXciIQERcRuBWqLGyiTeXKG3FZHrtPe4o1GS8TlzUZ3ARTO9tI0ylJcxWGG+TU1j7OhNisuYrDDRCzRXcxpjSTuQUC3nLGkO14fokwKZ1yCxV4IwgxpOjzleufCMsKuBXwhhHSn49xGfwZPdy+MOTIwUS4FeIfiDHCSB3nqzZw//7WpT1vp0OnEGVWUEna34KU7oGOvBZnmX2nbiHL3LA6ciDyWl5n9rWFz6+r3QZaNHPFwAlxtpdedJ92lK1l3QZWzmgeN5A8SE/Hk/Ym5bmQ+ihdAgvnQR49Fynzg9mnC6kPBvYKHz88l5nzg+4zCinzGQSs1V7Ib+lIbxSgClWfWZgxL2At9+S51QM/yq6niiGPkUcP9Nys41lqZiFSGHI7Y7BVevLcbuVVfvKLIifhAqEEUKdevhvmrGRfIXYHXuJvebSTg4UIu5zBS/xNqzb9HzPDCsFE0ResxxnB7T3jCn7ibzu2HCg8R+lIQ/8dGKt6oBCRy75N4HBhYSLqUEPruw/jNVxobdyBg4W4dgBjNlC4xLk9GLWhQpJK4HBhaWl8y9QtC0f8+A9UOOrHY5DCcT8fp0KLwj0kY6AQQzL6CxeQjt7CChLyXjjiXS6CF64ySMuHwtUcUlMv0+5rC9PuawvT7msL0+5Thfv270Nqz88OvEjq7/tkMplMJl/uP6GQwUEv7e1KAAAAAElFTkSuQmCC",alt:"搜索无结果",className:"".concat(Pe,"-control-empty-img")}),D().createElement("span",{className:"".concat(Pe,"-control-empty-img")},"暂无搜索结果"))},hideItemView:De("Categories"),onDragStart:function(e,t,n){pn(e,t,n)}},propertyViewSetting:{className:"".concat(Pe,"-property-view"),hideItemView:De("Property")},getOutlineItemIcon:function(e){return D().createElement(w.Icon,{prefix:"designericon",type:dn(e),className:"nocode-designer-control-icon"})},canAddCallback:ff({showMessage:f,kdesignerApi:ne,keywordMapping:Tf}),preHandle:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return mc.apply(void 0,h()(t).call(t,[Nf(Nf({},ne.current||{}),{},{billPropsData:se.current,invokeAction:g,getHideFieldRef:Ae,setHideFieldRef:Fe,dispatchBillData:de})]))},getPropertyEditors:tf,filterProperty:so,renderCustomTab:function(e,t){return D().createElement(gf,t)}}}),[f,Me,Ne,tf,De,Ae,Fe,de]),Re=(0,S.useCallback)((function(){return pe.current}),[]),Be=(0,S.useCallback)((function(e){pe.current=e,re.current.sysSetting=e;var t=be.current.increaseVersion,n=Ie.current.increaseVersion;t(),n()}),[]),_e=(0,S.useCallback)((function(){return me.current}),[]),Oe=(0,S.useCallback)((function(e){me.current=e,re.current.billNoSetting=e;var t=be.current.increaseVersion,n=Ie.current.increaseVersion;t(),n()}),[]),je=(0,S.useCallback)((function(e){ve.current=e}),[]),Le=(0,S.useCallback)((function(e){ge.current=e}),[]),Ke=(0,S.useCallback)((function(){return ee?"pc":"mobile"}),[ee]),Ve=(0,S.useCallback)((function(e,t){var n=(0,Se.cloneDeep)(se.current),r=b()(n).reduce((function(e,t){var n;return null!==(n=t[1])&&void 0!==n&&n.data?Nf(Nf({},e),{},(0,s.c)({},t[0],t[1].data)):e}),{}),a=cf(e,r),l=(0,d.c)(a,3),o=l[0],i=l[1],c=l[2];ae.current=i,re.current=c,null==t||t.data.resetData(o,!1)}),[]),Ue=(0,S.useCallback)((function(e,t){k.eventBus.emit(e,t)}),[]),Ge=(0,S.useCallback)((function(e){ne.current=Nf(Nf({},e),{},{originApi:e,selection:Nf(Nf({},e.selection),{},{getActiveSelectedId:function(){return e.selection.getActiveSelectedId()||e.data.getRootId()}}),controlCacheApi:r}),A({kdesignerApi:ne.current,getDesignerClientType:Ke,fieldStatusMap:he,resetDesignerData:Ve,getSystemSetting:Re,getBillnoSetting:_e,pubEvent:Ue})}),[A,Ke,he]),ze=(0,S.useCallback)((function(e,t){re.current=sf(re.current,e,ne.current,ae.current),re.current.sysSetting=Re(),re.current.billNoSetting=_e(),re.current.setting=c,i&&i(re.current,t);var n=be.current.increaseVersion,r=Ie.current.increaseVersion;n(),r()}),[c]);(0,S.useEffect)((function(){A({kdesignerApi:ne.current,fieldStatusMap:he,getDesignerClientType:Ke,resetDesignerData:Ve,getSystemSetting:Re,getBillnoSetting:_e,pubEvent:Ue})}),[Ke,he]),(0,S.useEffect)((function(){var e=null==xe?void 0:xe.id;g("getFormRules",[{formId:e,fieldKey:""}]),g("getBizRules",[{formId:e,fieldKey:""}]),E("listtreeconfig",[e,"formula"])}),[]),(0,S.useEffect)((function(){return k.eventBus.on(ar,je),k.eventBus.on(ir,Le),function(){k.eventBus.off(ar,je),k.eventBus.off(ir,Le)}}),[]);var He=function(e){var t=null==xe?void 0:xe.id,n=e.args,r=e.data,a=n||{},l=a.formId,o=a.param,i=(void 0===o?{}:o).sourceType;if(""===l||l===t){var c="formula"===i?be.current:Ie.current,u=c.setData,d=c.setDataVersion,s=c.getVersion;u(r),d(s())}};(0,S.useEffect)((function(){return k.eventBus.on(rr,He),function(){k.eventBus.off(rr,He)}}),[]);var qe=(0,S.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";window.requestAnimationFrame((function(){var t="formula"===e?be.current:Ie.current,n=t.isVersionEqual,r=t.getVersion;if(!n()){var a=null==xe?void 0:xe.id;if(1!==r()){var l="formula"===e?["","formula"]:[""],o=[{nocodeformdesigner:re.current}];g("listtreeconfig",l,o)}else{g("listtreeconfig","formula"===e?[a,"formula"]:[a])}}}))}),[]);(0,S.useEffect)((function(){if(null!=H&&H.children){var e=H.children,t=void 0===e?[]:e;t[0].icon=D().createElement(w.Icon,{prefix:"nocodeplatformicon",type:"gerenzhongxin",style:{color:"#3987ED"}}),t[1].icon=D().createElement(w.Icon,{prefix:"nocodeplatformicon",type:"zuzhi",style:{color:"#3987ED"}});var n=Aa(t),r=(0,d.c)(n,2),a=r[0],l=r[1];de({key:qr,payload:{data:a,innerForm:l}})}}),[H]);var Ye=(0,S.useMemo)((function(){return Af((null==H?void 0:H.children)||[])}),[H]),We=(0,S.useRef)({getKdesignerApi:function(){return ne.current},getExpressionData:function(){return G},getRefBillData:function(){return H},getRefBillNameMap:function(){return Ye},getCompareTypes:function(){return X},getDataRef:function(){return re.current},getCurrentRefBillPropsData:function(){return oe.current},getDisplayRules:function(){return ve.current},getBizRules:function(){return ge.current},setCurrentRefBillPropsData:function(e,t){oe.current[e]=t},fetchListTree:qe,curFormulaTreeApi:be.current,curListTreeApi:Ie.current,getSystemSetting:Re,setSystemSetting:Be,getBillnoSetting:_e,setBillnoSetting:Oe,setDisplayRules:je,setBizRules:Le,getHideFieldRef:Ae,setHideFieldRef:Fe,showMessage:f,invokeAction:g,baseUrl:T,prefixCls:Pe,getPrefixCls:function(e,t,n){var r;return n||(e=e||Pe,t?h()(r="".concat(e,"-")).call(r,t):e)},getBaseHooks:function(e){return(null==I?void 0:I[e])||function(){}},onDownLoad:M,addControlAction:P,getControlText:R,batchInvoke:B}),Xe=(0,S.useMemo)((function(){return Nf({isPC:ee,setIsPC:te,floatMenu:_,fieldStatusSettingMode:K,fieldStatusSettingOptions:V,fieldStatusMap:he,billPropsData:ue,pubUIAction:ke,dispatchFieldStatus:Ee,dispatchBillData:de},We.current)}),[ee,K,_,V,he,ue,ke,de]),Ze=(0,S.useCallback)((function(){var e,t=N()(e=x()(Me("right"))).call(e,(function(e){return(null==e?void 0:e.tabKey)||""})),n=De("Property");return ne.current&&!0!==n?v()(t).call(t,(function(e){return!0})):t}),[De]),Qe=(0,S.useCallback)((function(){var e,t=N()(e=x()(Me("left"))).call(e,(function(e){return(null==e?void 0:e.tabKey)||""})),n=De("Categories");return!0===n?t:v()(t).call(t,(function(e){return null==n||!F()(n).call(n,e)}))}),[De]);return(0,S.useEffect)((function(){var e=function(){var e=ne.current.views,t=e.getViewVisibleKeys("left"),n=e.getViewVisibleKeys("right"),r=Qe(),a=Ze();(0,Se.isEqual)(r,t)||e.setViewsVisibleSetting("left")(r),(0,Se.isEqual)(a,n)||e.setViewsVisibleSetting("right")(a)},t=ne.current.selection.addSelectChangeListener(e);return e(),function(){t&&t()}}),[c]),D().createElement(D().Fragment,null,D().createElement(w.ConfigProvider,{value:{prefixCls:"kdesigner"}},D().createElement(le.Provider,{value:Xe},D().createElement(Sf,{className:"".concat(Pe,"-root"),ref:fe,globalConfig:we,onData:ze,meta:Te,data:xe,onApi:Ge}))))}))),Sf=M();Ff.displayName="NoCodeDesigner";var Df=Ff}}]);