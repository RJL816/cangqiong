"use strict";(self.webpackChunknocode_component=self.webpackChunknocode_component||[]).push([[7044,8832],{52304:function(e,t,n){n.r(t),n.d(t,{default:function(){return W}});var a=n(13939),o=n.n(a),r=n(34716),c=n.n(r),i=n(70696),l=n.n(i),u=n(4884),s=n.n(u),d=n(3464),f=n.n(d),v=n(51400),g=n.n(v),p=n(25028),m=n.n(p),b=n(30112),h=n(72048),k=n(67584),C=n.n(k),I=(n(23992),n(760)),D=n.n(I),S=(n(21300),n(87912),n(97308),n(65984)),y=n.n(S),E="Ohhxvt3A_nocode-designer-wrapper",A=n(71252),N=n.n(A),F=n(81268),w=n(45984),R=n(39756),T=n(57288),_=n(6523),M=n(14020),B=n(16428),L=n(60644);function x(e,t){var n=o()(e);if(c()){var a=c()(e);t&&(a=l()(a).call(a,(function(t){return s()(e,t).enumerable}))),n.push.apply(n,a)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){(0,b.c)(e,t,n[t])})):f()?g()(e,f()(n)):x(Object(n)).forEach((function(t){m()(e,t,s()(n,t))}))}return e}var K=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.forEach((function(t){var a,o;"sendDynamicFormAction"===t.a&&(null===(a=t.p)||void 0===a||null===(a=a[0])||void 0===a?void 0:a.actions.length)>0?e(null===(o=t.p)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.actions,n):n[t.a]=t.p})),n},U=(0,S.memo)((function(e){var t=e.controlMeta,n=(0,S.useContext)(R.m).model,a=(0,S.useState)(),o=(0,h.c)(a,2),r=o[0],c=o[1],i=(0,S.useState)(),l=(0,h.c)(i,2),u=l[0],s=l[1],d=(0,S.useState)({}),f=(0,h.c)(d,2),v=f[0],g=f[1],p=(0,S.useState)([]),m=(0,h.c)(p,2),k=m[0],I=m[1],A=(0,S.useState)([]),x=(0,h.c)(A,2),U=x[0],W=x[1],O=(0,S.useState)(n.getGlobal(_.aK)||null),P=(0,h.c)(O,2),j=P[0],z=P[1],V=t.pageId,q=t.id,H=(0,S.useRef)(!1),Y=(0,S.useState)(n.getGlobal(_.m2)||{}),$=(0,h.c)(Y,2),J=$[0],Q=$[1],X=(0,S.useState)(n.getGlobal(_.E9)||{}),Z=(0,h.c)(X,1)[0],ee=(0,S.useState)(n.getGlobal(_._I)||{}),te=(0,h.c)(ee,1)[0],ne=((0,F.F)("nocode").Component||{}).NoCodeDesigner,ae=(0,S.useRef)(),oe=(0,S.useRef)(),re=(0,S.useCallback)((function(e){var t=(ae.current||{}).pubEvent;switch(e.methodname){case"open":ce(e.args[0]),oe.current=e.args[2].data,(0,B.unstable_batchedUpdates)((function(){s(e.args[2].data),I(e.args[3].expression),W(e.args[4].refBillData),g(e.args[5].tableMetas)}));break;case _.yu:var a=(0,ae.current.getDesignerClientType)();n.emitEvent(_.sV,a);break;default:null==t||t(e.methodname,e.args[0])}}),[ae.current]),ce=(0,S.useCallback)((function(e){var t=n.getPageConfig().targetFormId;(0,T.fetchData)(V,"nocode/getDomainModel.do",{modelType:e,targetFormId:t}).then((function(e){var t=e.data;c("NoCodeModel"===(null==t?void 0:t.Id)?t:null)}))}),[]),ie=(0,S.useCallback)((function(e){e.forEach((function(e){return re(e)}))}),[]),le=(0,S.useCallback)((function(e){z(e)}),[]),ue=(0,S.useCallback)((function(e){Q(e)}),[]),se=(0,S.useCallback)((function(e){switch(e.type){case"updateFormName":he(e.payload);break;case"saveAsTemplate":ke(e.payload)}}),[]);(0,S.useEffect)((function(){var e=n.addControlAction("InvokeControlMethod",V,q,ie),t=n.addEventListener(_.qG,(function(){return ge()})),a=n.addEventListener(_.Yv,(function(){return pe()})),o=n.addEventListener(_.A7,(function(){return me()})),r=n.addEventListener(_.A$,se),c=n.addEventListener(_.aK,le),i=n.addEventListener(_.m2,ue);return function(){e(),t(),a(),o(),r(),c(),i()}}),[]);var de=(0,S.useCallback)((function(e){oe.current=e}),[]),fe=(0,S.useCallback)((function(e){ae.current=G({},e)}),[]);(0,S.useEffect)((function(){window.noCodeDesignerRef={save:ge,getDesignerData:function(){return oe.current}}}),[]),(0,S.useEffect)((function(){r&&u&&ne&&!H.current&&(H.current=!0,n.emitEvent(_._E,!0))}),[r,u,ne]);var ve=(0,S.useCallback)((function(){var e,t=(null===(e=ae.current)||void 0===e?void 0:e.kdesignerApi)||{},n=t.data,a=t.selection,o=n.getData().Items;a.setSelect([o[0].Id]),n.batchUpdateControlPropertyValues({type:"UPDATE",value:[[o[0].Id,{refFieldEdit:{}}]]})}),[]),ge=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"save";((null===(e=ae.current)||void 0===e?void 0:e.kdesignerApi)||{}).controlCacheApi;C()((function(){var e=be(),a={action:"designerBarClick",pageId:V,controlId:q,args:[t],postData:[e],callback:function(e){var t;null==te||te.saveStatus();var n=(K(e.data)||{}).ShowNotificationMsg;0===(null==n||null===(t=n[0])||void 0===t?void 0:t.type)&&ve()},enforce:!0};n.batchInvokeWithForce(a)}),20),C()((function(){null==te||te.saveStatus()}),3e4)},pe=function(){ge("saveandvisit")},me=function(){C()((function(){var e=be(),t=(0,ae.current.getDesignerClientType)(),a={action:"designerBarClick",pageId:V,controlId:q,args:["".concat(t,"_preview")],postData:[e],callback:function(e){var t;null==te||te.saveStatus();var n=(K(e.data)||{}).ShowNotificationMsg;0===(null==n||null===(t=n[0])||void 0===t?void 0:t.type)&&ve()},enforce:!0};n.batchInvokeWithForce(a)}),20),C()((function(){null==te||te.saveStatus()}),3e4)},be=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=ae.current,n=t.getSystemSetting,a=t.getBillnoSetting,o=t.getBizRules,r=t.getDisplayRules,c=t.getFormulaRules,i=G(G({},oe.current),{},{setting:j,sysSetting:n(),billNoSetting:a(),bizRules:o(),displayRules:r(),formulaRules:c()},e),l={};return l[q]=i,l},he=function(e){if(e&&ae.current){var t=(0,L.cloneDeep)(oe.current);t.entitymeta&&(t.entitymeta.Name=e,t.entitymeta.Items[0].Name=e),t.formmeta&&(t.formmeta.Name=e,t.formmeta.Items[0].Name=e);var n=ae.current,a=n.resetDesignerData,o=n.kdesignerApi;null==a||a(t,o)}},ke=function(e){var t=be({templateConfig:e,saveAsTemplate:!0}),a={action:"designerBarClick",pageId:V,controlId:q,args:["save"],postData:[t],callback:null==te?void 0:te.saveStatus,enforce:!0};C()((function(){n.batchInvokeWithForce(a)}),200)},Ce=(0,S.useCallback)((function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];n.batchInvoke(e,V,q,t,a)}),[]),Ie=(0,S.useCallback)((function(e,t){var a={action:e,pageId:V,controlId:q,args:t,postData:arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],enforce:!0};n.batchInvokeWithForce(a)}),[]),De=(0,S.useCallback)((function(e){var t,a=n.getConfig(V),o={params:"1",appId:a.appId,fId:a.formId,fileName:e.name},r=D()(t="".concat(e.url,"&kd_cs_ticket=")).call(t,n.Global.token);(0,M.gr)(r,o)}),[]),Se=N()((0,b.c)({},E,!0));return r&&u&&ne?y().createElement("div",{className:Se},y().createElement(ne,{name:"NoCodeDesigner",meta:r,data:u,expression:k,refBillData:U,tableMetas:v,compareTypes:J,onData:de,invokeAction:Ce,enforceInvokeAction:Ie,onApi:fe,baseHooks:w.hooks,settingData:j,onDownLoad:De,getControlText:n.getControlText,addControlAction:function(e,t,a){return n.addControlAction(e,V,t,a)},fetchControlData:n.fetchControlData,batchInvoke:function(e,t,a,o){return n.batchInvoke(e,V,t,a,o)},baseUrl:{attachment:n.getFileServer("attachment"),picture:n.getFileServer("picture")},ncpToolKits:Z})):null}));U.displayName="KDNocodeDesigner";var W=U}}]);