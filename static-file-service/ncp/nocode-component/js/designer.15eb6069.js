"use strict";(self.webpackChunknocode_component=self.webpackChunknocode_component||[]).push([[7044,8832],{52304:function(e,t,n){n.r(t),n.d(t,{default:function(){return W}});var a=n(13939),o=n.n(a),r=n(34716),c=n.n(r),i=n(70696),l=n.n(i),u=n(4884),s=n.n(u),d=n(3464),f=n.n(d),v=n(51400),g=n.n(v),p=n(25028),m=n.n(p),h=n(30112),b=n(72048),k=n(67584),C=n.n(k),I=(n(23992),n(760)),D=n.n(I),S=(n(21300),n(87912),n(97308),n(65984)),E=n.n(S),y="Ohhxvt3A_nocode-designer-wrapper",A=n(71252),N=n.n(A),F=n(81268),w=n(45984),T=n(39756),_=n(57288),L=n(6523),M=n(14020),x=n(16428),B=n(60644);function G(e,t){var n=o()(e);if(c()){var a=c()(e);t&&(a=l()(a).call(a,(function(t){return s()(e,t).enumerable}))),n.push.apply(n,a)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){(0,h.c)(e,t,n[t])})):f()?g()(e,f()(n)):G(Object(n)).forEach((function(t){m()(e,t,s()(n,t))}))}return e}var R=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.forEach((function(t){var a,o;"sendDynamicFormAction"===t.a&&(null===(a=t.p)||void 0===a||null===(a=a[0])||void 0===a?void 0:a.actions.length)>0?e(null===(o=t.p)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.actions,n):n[t.a]=t.p})),n},U=(0,S.memo)((function(e){var t=e.controlMeta,n=(0,S.useContext)(T.m).model,a=(0,S.useState)(),o=(0,b.c)(a,2),r=o[0],c=o[1],i=(0,S.useState)(),l=(0,b.c)(i,2),u=l[0],s=l[1],d=(0,S.useState)({}),f=(0,b.c)(d,2),v=f[0],g=f[1],p=(0,S.useState)([]),m=(0,b.c)(p,2),k=m[0],I=m[1],A=(0,S.useState)([]),G=(0,b.c)(A,2),U=G[0],W=G[1],O=(0,S.useState)(n.getGlobal(L.aK)||null),P=(0,b.c)(O,2),j=P[0],V=P[1],q=t.pageId,H=t.id,Y=(0,S.useRef)(!1),$=(0,S.useState)(n.getGlobal(L.m2)||{}),z=(0,b.c)($,2),J=z[0],Q=z[1],X=(0,S.useState)(n.getGlobal(L.E9)||{}),Z=(0,b.c)(X,1)[0],ee=(0,S.useState)(n.getGlobal(L._I)||{}),te=(0,b.c)(ee,1)[0],ne=((0,F.F)("nocode").Component||{}).NoCodeDesigner,ae=(0,S.useRef)(),oe=(0,S.useRef)(),re=(0,S.useCallback)((function(e){var t=(ae.current||{}).pubEvent;switch(e.methodname){case"open":ce(e.args[0]),oe.current=e.args[2].data,(0,x.unstable_batchedUpdates)((function(){s(e.args[2].data),I(e.args[3].expression),W(e.args[4].refBillData),g(e.args[5].tableMetas)}));break;case L.yu:var a=(0,ae.current.getDesignerClientType)();n.emitEvent(L.sV,a);break;default:null==t||t(e.methodname,e.args[0])}}),[ae.current]),ce=(0,S.useCallback)((function(e){var t=n.getPageConfig().targetFormId;(0,_.fetchData)(q,"nocode/getDomainModel.do",{modelType:e,targetFormId:t}).then((function(e){return c(e.data)}))}),[]),ie=(0,S.useCallback)((function(e){e.forEach((function(e){return re(e)}))}),[]),le=(0,S.useCallback)((function(e){V(e)}),[]),ue=(0,S.useCallback)((function(e){Q(e)}),[]),se=(0,S.useCallback)((function(e){switch(e.type){case"updateFormName":be(e.payload);break;case"saveAsTemplate":ke(e.payload)}}),[]);(0,S.useEffect)((function(){var e=n.addControlAction("InvokeControlMethod",q,H,ie),t=n.addEventListener(L.qG,(function(){return ge()})),a=n.addEventListener(L.Yv,(function(){return pe()})),o=n.addEventListener(L.A7,(function(){return me()})),r=n.addEventListener(L.A$,se),c=n.addEventListener(L.aK,le),i=n.addEventListener(L.m2,ue);return function(){e(),t(),a(),o(),r(),c(),i()}}),[]);var de=(0,S.useCallback)((function(e){oe.current=e}),[]),fe=(0,S.useCallback)((function(e){ae.current=K({},e)}),[]);(0,S.useEffect)((function(){window.noCodeDesignerRef={save:ge,getDesignerData:function(){return oe.current}}}),[]),(0,S.useEffect)((function(){r&&u&&ne&&!Y.current&&(Y.current=!0,n.emitEvent(L._E,!0))}),[r,u,ne]);var ve=(0,S.useCallback)((function(){var e,t=(null===(e=ae.current)||void 0===e?void 0:e.kdesignerApi)||{},n=t.data,a=t.selection,o=n.getData().Items;a.setSelect([o[0].Id]),n.batchUpdateControlPropertyValues({type:"UPDATE",value:[[o[0].Id,{refFieldEdit:{}}]]})}),[]),ge=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"save";((null===(e=ae.current)||void 0===e?void 0:e.kdesignerApi)||{}).controlCacheApi;C()((function(){var e=he(),a={action:"designerBarClick",pageId:q,controlId:H,args:[t],postData:[e],callback:function(e){var t;null==te||te.saveStatus();var n=(R(e.data)||{}).ShowNotificationMsg;0===(null==n||null===(t=n[0])||void 0===t?void 0:t.type)&&ve()},enforce:!0};n.batchInvokeWithForce(a)}),20),C()((function(){null==te||te.saveStatus()}),3e4)},pe=function(){ge("saveandvisit")},me=function(){C()((function(){var e=he(),t=(0,ae.current.getDesignerClientType)(),a={action:"designerBarClick",pageId:q,controlId:H,args:["".concat(t,"_preview")],postData:[e],callback:function(e){var t;null==te||te.saveStatus();var n=(R(e.data)||{}).ShowNotificationMsg;0===(null==n||null===(t=n[0])||void 0===t?void 0:t.type)&&ve()},enforce:!0};n.batchInvokeWithForce(a)}),20),C()((function(){null==te||te.saveStatus()}),3e4)},he=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=ae.current,n=t.getSystemSetting,a=t.getBillnoSetting,o=K(K({},oe.current),{},{setting:j,sysSetting:n(),billNoSetting:a()},e),r={};return r[H]=o,r},be=function(e){if(e&&ae.current){var t=(0,B.cloneDeep)(oe.current);t.entitymeta&&(t.entitymeta.Name=e,t.entitymeta.Items[0].Name=e),t.formmeta&&(t.formmeta.Name=e,t.formmeta.Items[0].Name=e);var n=ae.current,a=n.resetDesignerData,o=n.kdesignerApi;null==a||a(t,o)}},ke=function(e){var t=he({templateConfig:e,saveAsTemplate:!0}),a={action:"designerBarClick",pageId:q,controlId:H,args:["save"],postData:[t],callback:null==te?void 0:te.saveStatus,enforce:!0};C()((function(){n.batchInvokeWithForce(a)}),200)},Ce=(0,S.useCallback)((function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];n.batchInvoke(e,q,H,t,a)}),[]),Ie=(0,S.useCallback)((function(e,t){var a={action:e,pageId:q,controlId:H,args:t,postData:arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],enforce:!0};n.batchInvokeWithForce(a)}),[]),De=(0,S.useCallback)((function(e){var t,a=n.getConfig(q),o={params:"1",appId:a.appId,fId:a.formId,fileName:e.name},r=D()(t="".concat(e.url,"&kd_cs_ticket=")).call(t,n.Global.token);(0,M.gr)(r,o)}),[]),Se=N()((0,h.c)({},y,!0));return r&&u&&ne?E().createElement("div",{className:Se},E().createElement(ne,{name:"NoCodeDesigner",meta:r,data:u,expression:k,refBillData:U,tableMetas:v,compareTypes:J,onData:de,invokeAction:Ce,enforceInvokeAction:Ie,onApi:fe,baseHooks:w.hooks,settingData:j,onDownLoad:De,getControlText:n.getControlText,addControlAction:function(e,t,a){return n.addControlAction(e,q,t,a)},fetchControlData:n.fetchControlData,batchInvoke:function(e,t,a,o){return n.batchInvoke(e,q,t,a,o)},baseUrl:{attachment:n.getFileServer("attachment"),picture:n.getFileServer("picture")},ncpToolKits:Z})):null}));U.displayName="KDNocodeDesigner";var W=U}}]);