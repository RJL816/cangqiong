"use strict";(self.webpackChunknocode_component=self.webpackChunknocode_component||[]).push([[2780],{63324:function(e,n,a){var u=a(13939),r=a.n(u),l=a(34716),o=a.n(l),c=a(4884),i=a.n(c),s=a(3464),d=a.n(s),f=a(51400),v=a.n(f),p=a(25028),m=a.n(p),h=a(72048),g=a(81043),b=a(30112),k=(a(21300),a(87912),a(97308),a(50524)),C=a.n(k),w=a(760),I=a.n(w),y=a(94728),M=a.n(y),D=a(52892),_=a.n(D),T=a(23992),E=a.n(T),R=a(73020),S=a.n(R),x=a(70696),z=a.n(x),O=a(38456),A=a.n(O),V=a(67584),N=a.n(V),j=a(35680),U=a.n(j),q=a(65984),F=a(39756),L=a(46276),P=a(14020),H=a(44880),G=a(63616),J=a(24964),W=a(62132),Z=a(37668);function B(e,n){var t=r()(e);if(o()){var a=o()(e);n&&(a=z()(a).call(a,(function(n){return i()(e,n).enumerable}))),t.push.apply(t,a)}return t}function K(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?B(Object(t),!0).forEach((function(n){(0,b.c)(e,n,t[n])})):d()?v()(e,d()(t)):B(Object(t)).forEach((function(n){m()(e,n,i()(t,n))}))}return e}var Q="".concat(window.__domainurl__||"","nocode/v2/nocode_sys/attachment"),X=function(e){var n,t=C()(e).call(e,"?")?"&":"?",a=window.NOCODE_SHARE_ID?I()(n="".concat(t,"noCodeShareId=")).call(n,window.NOCODE_SHARE_ID):"";return(0,P.oA)(e+a)},Y=function(e,n,t){var a=M()(e).call(e,(function(e,n){return e.set(n.uid,K(K({},n),{},{name:t.getControlText(n.name)}))}),new(_()));return{newData:n.length?E()(n).call(n,(function(e){return a.get(e.uid)||e})):(0,g.c)(S()(a).call(a)),mapData:a}};n.c=function(e){var n,a,u,r,l=e.controlMeta,o=e.value,c=e.onChange,i=e.uploadAttachmentVerify,s=e.showInfo,d=e.invokeData,f=e.rowIndex,v=void 0===f?-1:f,p=(0,q.useContext)(F.m).model,m=(0,L.s)(l),b=m.readonly,k=m.disabled,w=m.hidden,y=m.required,M=m.rules,D=(0,q.useState)(Y(o||[],[],p).newData),T=(0,h.c)(D,2),R=T[0],x=T[1],O=l.pageId,V=l.id,j=l.uploadNum,B=l.fileMaxSize,$=l.uploadModel,ee=l.attachmentFileType,ne=void 0===ee?"":ee,te=l.displayCount,ae=l.uploadPrompt,ue=l.buttonText,re=(0,q.useRef)(null),le=(0,q.useRef)(Y(o||[],[],p).mapData),oe=(0,q.useRef)(!1),ce=(0,q.useCallback)((function(e){var n=[];e.forEach((function(e){!(0,H.WO)(e,ne)||(0,H.UZ)(e,B)||(0,H.IT)(e)||n.push({uid:e.uid,name:e.name,size:e.size,type:e.type})})),p.batchInvoke("beforeUpload",O,V,[n],[])}),[O,V]),ie=(0,q.useCallback)((function(e){p.batchInvoke("updateValue",O,"",[],[{},[{k:V,r:v,v:e}]])}),[v,O,V]),se=(0,W.c)(ie),de=(0,q.useCallback)((function(e,n){var t=i(e,n,l);return t&&ce(n),t}),[ce,i]),fe=(0,q.useCallback)((function(e){var n=e.file,t=e.fileList,a=y&&0===t.length?"值不能为空":"";re.current.setValidateMessage(a);var u=z()(t).call(t,(function(e){return"notStart"!==e.status}));if("done"===n.status&&n.response.status){var r=K({lastModified:n.lastModified,uid:n.uid,name:n.name,type:n.type,size:n.size},{status:"success",url:n.response.data.url,uploadTime:Date.now()});le.current.set(n.uid,r);var l,o,i=z()(u).call(u,(function(e){return"uploading"===e.status}));if(le.current.size,u.length,i.length,0===i.length)if(c)c((0,g.c)(S()(l=le.current).call(l)));else se((0,g.c)(S()(o=le.current).call(o)))}else"error"!==n.status&&("done"!==n.status||null!=n&&n.response.status)||(s("".concat(n.name,"上传失败，请重新上传")),p.batchInvoke("uploadResult",O,V,[[{uid:n.uid,description:"禁止上传非法文件。",status:"error"}]],[{},[]]));x(u)}),[c,y,O,V,se,s]),ve=(0,q.useCallback)((function(e){var n,t=p.getConfig(O),a=le.current.get(e.uid),u={params:"1",appId:t.appId,fId:t.formId,fileName:a.name},r=I()(n="".concat(X(a.url),"&kd_cs_ticket=")).call(n,p.Global.token);(0,P.gr)(r,u)}),[O]),pe=(0,q.useCallback)((function(e){if(null==R||!R.length)return!1;if(oe.current)return(0,Z.s9)("上一次删除未执行完毕，请稍后再试。",2e3,1);var n=z()(R).call(R,(function(n){return n.uid!==e.uid}));return y&&!n.length&&re.current.setValidateMessage("值不能为空"),oe.current=!0,p.batchInvoke("beforeRemove",O,V,[{uid:e.uid}],[]),x(n),!0}),[R,c,O,V,y]),me=(0,q.useCallback)((function(e){var n=A()(R).call(R,(function(n){return n.uid===e.uid}));if(n.name=e.name,"success"===n.status){var t,a=le.current.get(e.uid);if(a.name=e.name,le.current.set(e.uid,a),p.batchInvoke("rename",O,V,[e.uid,e.name,v],[{},[]]),c)c((0,g.c)(S()(t=le.current).call(t)))}x((0,g.c)(R))}),[R,c,v,O,V]),he=(0,q.useCallback)((function(e){var n;if(!Array.isArray(e.v)||Array.isArray(e.v)&&(null==e||null===(n=e.v)||void 0===n||!n.length))return le.current=new(_()),void x([]);x((function(n){var a=Y(e.v,n,p),u=a.newData,r=a.mapData;if(le.current=r,!1===e.isLoadData){var l=y&&0===u.length?t("nocode.component.00097"):"";re.current.setValidateMessage(l)}return u}))}),[x]);(0,q.useEffect)((function(){o&&he({k:V,v:o})}),[o]);var ge=(0,q.useCallback)((function(e){var n=(null==e?void 0:e[0])||{},t=n.args;if("beforeRemove"===n.methodname)if(t[0].canRemove){var a=[];le.current.forEach((function(e,n){var u=e.lastModified,r=e.name,l=e.size,o=e.status,c=e.type,i=e.uid,s=e.url,d=e.uploadTime;n===t[0].uid?a.push({lastModified:u,name:r,size:l,status:o,type:c,uid:i,url:s,uploadTime:d,delete:!0}):a.push({lastModified:u,name:r,size:l,status:o,type:c,uid:i,url:s,uploadTime:d})})),p.batchInvoke("updateValue",O,"",[],[{},[{k:V,v:a}]],(function(){N()((function(){oe.current=!1}))})),le.current.delete(t[0].uid)}}),[se]);(0,q.useEffect)((function(){d&&ge(d)}),[d]),p.useUpdateControlStates(l,he),p.useInvokeControlMethod(l,ge);var be=ae?I()(n=I()(a=I()(u="请上传小于".concat(B,"M的")).call(u,null==ne?void 0:U()(ne).call(ne,".",""),"文件，文件个数不少于")).call(a,(null==j?void 0:j.min)||0,"个，不多于")).call(n,(null==j?void 0:j.max)||1,"个"):"",ke=!te||b||k?"":I()(r="(".concat(le.current.size,"/")).call(r,(null==j?void 0:j.max)||1,")"),Ce=(0,q.useMemo)((function(){var e=p.getConfig(O),n=e.appId,t=e.formId;return null!=R&&R.length?E()(R).call(R,(function(e){return e.previewurl=(0,G.qo)({url:e.previewurl,pageId:O,appId:n,formId:t,ticket:p.Global.token,needShareId:!C()(J.kJ).call(J.kJ,e.type)}),e})):[]}),[R,O]),we=(0,q.useMemo)((function(){var e;return(((null==p||null===(e=p.getConfig)||void 0===e?void 0:e.call(p))||{}).attPreview||{}).previewType||"0"}),[]);return{action:X(Q),handledDatas:Ce,disabled:k,readonly:b,buttonText:ue,uploadModel:$,handleChange:fe,onDownload:ve,onChangeFileName:me,beforeUpload:de,handleRemove:pe,attachmentFileType:ne,uploadNum:j,notice:be,previewType:we,labelText:ke,required:y,hidden:w,fieldRef:re,datas:R,rules:M}}},60807:function(e,n,t){var a,u=t(13939),r=t.n(u),l=t(34716),o=t.n(l),c=t(4884),i=t.n(c),s=t(3464),d=t.n(s),f=t(51400),v=t.n(f),p=t(25028),m=t.n(p),h=t(81043),g=t(30112),b=t(72048),k=(t(86456),t(21300),t(76124),t(87912),t(97308),t(760)),C=t.n(k),w=t(73980),I=t.n(w),y=t(52892),M=t.n(y),D=t(23992),_=t.n(D),T=t(70696),E=t.n(T),R=t(24244),S=t.n(R),x=t(24496),z=t.n(x),O=t(73020),A=t.n(O),V=t(65984),N=t(46276),j=t(39756),U=t(14020);function q(e,n){var t=r()(e);if(o()){var a=o()(e);n&&(a=E()(a).call(a,(function(n){return i()(e,n).enumerable}))),t.push.apply(t,a)}return t}function F(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?q(Object(t),!0).forEach((function(n){(0,g.c)(e,n,t[n])})):d()?v()(e,d()(t)):q(Object(t)).forEach((function(n){m()(e,n,i()(t,n))}))}return e}var L=window.NOCODE_SHARE_ID?"?noCodeShareId=".concat(window.NOCODE_SHARE_ID):"",P=(0,U.oA)(C()(a="".concat(window.__domainurl__||"","nocode/v2/nocode_sys/image")).call(a,L)),H=function(e,n){var t=e+("/"===n[0]?I()(n).call(n,1):n)+L;return(0,U.oA)(t)};n.c=function(e){var n,t=e.controlMeta,a=e.value,u=e.onChange,r=(0,V.useContext)(j.m).model,l=(0,N.s)(t),o=l.readonly,c=l.disabled,i=l.hidden,s=l.required,d=l.rules,f=t.pageId,v=t.id,p=t.pictureDefValue,m=t.imageFileType,g=t.fileMaxSize,k=t.uploadNum,w=t.ops,I=t.enablePreview,y=t.buttonText,D=t.displayCount,T=t.uploadPrompt,R=(0,V.useRef)(new(M())),x=(0,V.useRef)(null),O=(0,V.useRef)(r.getFileServer("picture")),q=(0,V.useState)(),G=(0,b.c)(q,2),J=G[0],W=G[1],Z=(0,V.useCallback)((function(e){var n=e||[];try{n="string"==typeof n?JSON.parse(n):n}catch(e){n=[]}return _()(n).call(n,(function(e){R.current.set(e.uid,F({},e));var n=H(O.current,e.url);return F(F({},e),{},{url:n})}))}),[]);(0,V.useEffect)((function(){W(Z(p))}),[p]);var B=(0,V.useCallback)((function(e){var n=e.file,a=e.fileList,l=t.mi&&0===a.length?"值不能为空":"";x.current.setValidateMessage(l);var o=E()(a).call(a,(function(e){return"notStart"!==e.status}));if("done"===n.status&&n.response.status){var c,i,s=n.uid,d=n.name,p=n.size,m={url:n.response.data.url,status:"success",uploadTime:Date.now()};R.current.set(n.uid,F({uid:s,name:d,size:p},m)),R.current=new(M())(S()(c=(0,h.c)(R.current)).call(c,(function(e,n){return e[0].localeCompare(n[0])})));var g=z()((0,h.c)(A()(i=R.current).call(i)));if(u)u(g);else{var b={k:v,r:0,v:g};0===E()(o).call(o,(function(e){return"uploading"===e.status})).length&&r.batchInvoke("updateValue",f,"",[],[{},[b]])}o=_()(o).call(o,(function(e){return e.uid===s&&(e.status="success"),e}))}W((0,h.c)(o))}),[]),K=(0,V.useCallback)((function(e){var n,t,a=r.getConfig(f),u=R.current.get(e.uid),l={params:"1",appId:a.appId,fId:a.formId,fileName:u.name},o=C()(n=C()(t="".concat(H(O.current,u.url))).call(t,L?"&":"?","kd_cs_ticket=")).call(n,r.Global.token);(0,U.gr)(o,l)}),[]),Q=(0,V.useCallback)((function(e){var n=(null==J?void 0:E()(J).call(J,(function(n){return n.uid!==e.uid})))||[],t=R.current.get(e.uid);if(W((0,h.c)(n)),t){var a;R.current.delete(e.uid);var l=R.current.size>0?z()((0,h.c)(A()(a=R.current).call(a))):"";if(u)return u(l);var o={k:v,r:0,v:l};r.batchInvoke("updateValue",f,"",[],[{},[o]])}return!0}),[J]),X=(0,V.useCallback)((function(e){if(e.v){if(W(Z(e.v)),!1===e.isLoadData){var n=s&&0===Z(e.v).length?"值不能为空":"";x.current.setValidateMessage(n)}}else R.current=new(M()),W([]),!1===e.isLoadData&&x.current.setValidateMessage("值不能为空")}),[]);r.useUpdateControlStates(t,X),(0,V.useEffect)((function(){X({k:v,v:a})}),[a]);var Y=k||{},$=(0,V.useMemo)((function(){var e;return _()(e=m.split(",")).call(e,(function(e){return w[e]}))}),[m]),ee=(0,V.useMemo)((function(){return _()($).call($,(function(e){return"."+e})).join(",")}),[$]),ne=(0,V.useMemo)((function(){var e,n,t;return T?C()(e=C()(n=C()(t="请上传小于".concat(g,"M的")).call(t,$.join("、"),"文件，文件个数不少于")).call(n,(null==Y?void 0:Y.min)||0,"个，不多于")).call(e,(null==Y?void 0:Y.max)||1,"个。"):""}),[T,g,$,Y]),te=!D||o||c?"":C()(n="(".concat(R.current.size,"/")).call(n,(null==k?void 0:k.max)||1,")");return{action:P,notice:ne,labelText:te,datas:J||[],readonly:o,disabled:c,hidden:i,required:s,rules:d,enablePreview:I,buttonText:y,fieldTitleRef:x,baseUrl:O.current||"",limit:Y,accept:ee,onRemove:Q,handleChange:B,onDownload:K}}}}]);