"use strict";(self.webpackChunknocode_component=self.webpackChunknocode_component||[]).push([[208],{18232:function(e,t,r){function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},o.apply(this,arguments)}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}var i,s=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},i(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});t.Mf=void 0;var a,c=r(81468),u="undefined"==typeof navigator||!0===r.g.PREVENT_CODEMIRROR_RENDER;u||(a=r(72428));var d=function(){function e(){}return e.equals=function(e,t){var r=this,o=Object.keys,i=n(e),s=n(t);return e&&t&&"object"===i&&i===s?o(e).length===o(t).length&&o(e).every((function(o){return r.equals(e[o],t[o])})):e===t},e}(),p=function(){function e(e,t){this.editor=e,this.props=t}return e.prototype.delegateCursor=function(e,t,r){var o=this.editor.getDoc();r&&this.editor.focus(),t?o.setCursor(e):o.setCursor(e,null,{scroll:!1})},e.prototype.delegateScroll=function(e){this.editor.scrollTo(e.x,e.y)},e.prototype.delegateSelection=function(e,t){this.editor.getDoc().setSelections(e),t&&this.editor.focus()},e.prototype.apply=function(e){e&&e.selection&&e.selection.ranges&&this.delegateSelection(e.selection.ranges,e.selection.focus||!1),e&&e.cursor&&this.delegateCursor(e.cursor,e.autoScroll||!1,this.editor.getOption("autofocus")||!1),e&&e.scroll&&this.delegateScroll(e.scroll)},e.prototype.applyNext=function(e,t,r){e&&e.selection&&e.selection.ranges&&t&&t.selection&&t.selection.ranges&&!d.equals(e.selection.ranges,t.selection.ranges)&&this.delegateSelection(t.selection.ranges,t.selection.focus||!1),e&&e.cursor&&t&&t.cursor&&!d.equals(e.cursor,t.cursor)&&this.delegateCursor(r.cursor||t.cursor,t.autoScroll||!1,t.autoCursor||!1),e&&e.scroll&&t&&t.scroll&&!d.equals(e.scroll,t.scroll)&&this.delegateScroll(t.scroll)},e.prototype.applyUserDefined=function(e,t){t&&t.cursor&&this.delegateCursor(t.cursor,e.autoScroll||!1,this.editor.getOption("autofocus")||!1)},e.prototype.wire=function(e){var t=this;Object.keys(e||{}).filter((function(e){return/^on/.test(e)})).forEach((function(e){switch(e){case"onBlur":t.editor.on("blur",(function(e,r){t.props.onBlur(t.editor,r)}));break;case"onContextMenu":t.editor.on("contextmenu",(function(e,r){t.props.onContextMenu(t.editor,r)}));break;case"onCopy":t.editor.on("copy",(function(e,r){t.props.onCopy(t.editor,r)}));break;case"onCursor":t.editor.on("cursorActivity",(function(e){t.props.onCursor(t.editor,t.editor.getDoc().getCursor())}));break;case"onCursorActivity":t.editor.on("cursorActivity",(function(e){t.props.onCursorActivity(t.editor)}));break;case"onCut":t.editor.on("cut",(function(e,r){t.props.onCut(t.editor,r)}));break;case"onDblClick":t.editor.on("dblclick",(function(e,r){t.props.onDblClick(t.editor,r)}));break;case"onDragEnter":t.editor.on("dragenter",(function(e,r){t.props.onDragEnter(t.editor,r)}));break;case"onDragLeave":t.editor.on("dragleave",(function(e,r){t.props.onDragLeave(t.editor,r)}));break;case"onDragOver":t.editor.on("dragover",(function(e,r){t.props.onDragOver(t.editor,r)}));break;case"onDragStart":t.editor.on("dragstart",(function(e,r){t.props.onDragStart(t.editor,r)}));break;case"onDrop":t.editor.on("drop",(function(e,r){t.props.onDrop(t.editor,r)}));break;case"onFocus":t.editor.on("focus",(function(e,r){t.props.onFocus(t.editor,r)}));break;case"onGutterClick":t.editor.on("gutterClick",(function(e,r,o,n){t.props.onGutterClick(t.editor,r,o,n)}));break;case"onInputRead":t.editor.on("inputRead",(function(e,r){t.props.onInputRead(t.editor,r)}));break;case"onKeyDown":t.editor.on("keydown",(function(e,r){t.props.onKeyDown(t.editor,r)}));break;case"onKeyHandled":t.editor.on("keyHandled",(function(e,r,o){t.props.onKeyHandled(t.editor,r,o)}));break;case"onKeyPress":t.editor.on("keypress",(function(e,r){t.props.onKeyPress(t.editor,r)}));break;case"onKeyUp":t.editor.on("keyup",(function(e,r){t.props.onKeyUp(t.editor,r)}));break;case"onMouseDown":t.editor.on("mousedown",(function(e,r){t.props.onMouseDown(t.editor,r)}));break;case"onPaste":t.editor.on("paste",(function(e,r){t.props.onPaste(t.editor,r)}));break;case"onRenderLine":t.editor.on("renderLine",(function(e,r,o){t.props.onRenderLine(t.editor,r,o)}));break;case"onScroll":t.editor.on("scroll",(function(e){t.props.onScroll(t.editor,t.editor.getScrollInfo())}));break;case"onSelection":t.editor.on("beforeSelectionChange",(function(e,r){t.props.onSelection(t.editor,r)}));break;case"onTouchStart":t.editor.on("touchstart",(function(e,r){t.props.onTouchStart(t.editor,r)}));break;case"onUpdate":t.editor.on("update",(function(e){t.props.onUpdate(t.editor)}));break;case"onViewportChange":t.editor.on("viewportChange",(function(e,r,o){t.props.onViewportChange(t.editor,r,o)}))}}))},e}(),l=function(e){function t(t){var r=e.call(this,t)||this;return u||(r.applied=!1,r.appliedNext=!1,r.appliedUserDefined=!1,r.deferred=null,r.emulating=!1,r.hydrated=!1,r.initCb=function(){r.props.editorDidConfigure&&r.props.editorDidConfigure(r.editor)},r.mounted=!1),r}return s(t,e),t.prototype.hydrate=function(e){var t=this,r=e&&e.options?e.options:{},n=o({},a.defaults,this.editor.options,r);Object.keys(n).some((function(e){return t.editor.getOption(e)!==n[e]}))&&Object.keys(n).forEach((function(e){r.hasOwnProperty(e)&&t.editor.getOption(e)!==n[e]&&(t.editor.setOption(e,n[e]),t.mirror.setOption(e,n[e]))})),this.hydrated||(this.deferred?this.resolveChange(e.value):this.initChange(e.value||"")),this.hydrated=!0},t.prototype.initChange=function(e){this.emulating=!0;var t=this.editor.getDoc(),r=t.lastLine(),o=t.getLine(t.lastLine()).length;t.replaceRange(e||"",{line:0,ch:0},{line:r,ch:o}),this.mirror.setValue(e),t.clearHistory(),this.mirror.clearHistory(),this.emulating=!1},t.prototype.resolveChange=function(e){this.emulating=!0;var t=this.editor.getDoc();if("undo"===this.deferred.origin?t.undo():"redo"===this.deferred.origin?t.redo():t.replaceRange(this.deferred.text,this.deferred.from,this.deferred.to,this.deferred.origin),e&&e!==t.getValue()){var r=t.getCursor();t.setValue(e),t.setCursor(r)}this.emulating=!1,this.deferred=null},t.prototype.mirrorChange=function(e){var t=this.editor.getDoc();return"undo"===e.origin?(t.setHistory(this.mirror.getHistory()),this.mirror.undo()):"redo"===e.origin?(t.setHistory(this.mirror.getHistory()),this.mirror.redo()):this.mirror.replaceRange(e.text,e.from,e.to,e.origin),this.mirror.getValue()},t.prototype.componentDidMount=function(){var e=this;u||(this.props.defineMode&&this.props.defineMode.name&&this.props.defineMode.fn&&a.defineMode(this.props.defineMode.name,this.props.defineMode.fn),this.editor=a(this.ref,this.props.options),this.shared=new p(this.editor,this.props),this.mirror=a((function(){}),this.props.options),this.editor.on("electricInput",(function(){e.mirror.setHistory(e.editor.getDoc().getHistory())})),this.editor.on("cursorActivity",(function(){e.mirror.setCursor(e.editor.getDoc().getCursor())})),this.editor.on("beforeChange",(function(t,r){if(!e.emulating){r.cancel(),e.deferred=r;var o=e.mirrorChange(e.deferred);e.props.onBeforeChange&&e.props.onBeforeChange(e.editor,e.deferred,o)}})),this.editor.on("change",(function(t,r){e.mounted&&e.props.onChange&&e.props.onChange(e.editor,r,e.editor.getValue())})),this.hydrate(this.props),this.shared.apply(this.props),this.applied=!0,this.mounted=!0,this.shared.wire(this.props),this.editor.getOption("autofocus")&&this.editor.focus(),this.props.editorDidMount&&this.props.editorDidMount(this.editor,this.editor.getValue(),this.initCb))},t.prototype.componentDidUpdate=function(e){if(!u){var t={cursor:null};this.props.value!==e.value&&(this.hydrated=!1),this.props.autoCursor||void 0===this.props.autoCursor||(t.cursor=this.editor.getDoc().getCursor()),this.hydrate(this.props),this.appliedNext||(this.shared.applyNext(e,this.props,t),this.appliedNext=!0),this.shared.applyUserDefined(e,t),this.appliedUserDefined=!0}},t.prototype.componentWillUnmount=function(){u||this.props.editorWillUnmount&&this.props.editorWillUnmount(a)},t.prototype.shouldComponentUpdate=function(e,t){return!u},t.prototype.render=function(){var e=this;if(u)return null;var t=this.props.className?"react-codemirror2 "+this.props.className:"react-codemirror2";return c.createElement("div",{className:t,ref:function(t){return e.ref=t}})},t}(c.Component);t.Mf=l,function(e){function t(t){var r=e.call(this,t)||this;return u||(r.applied=!1,r.appliedUserDefined=!1,r.continueChange=!1,r.detached=!1,r.hydrated=!1,r.initCb=function(){r.props.editorDidConfigure&&r.props.editorDidConfigure(r.editor)},r.mounted=!1,r.onBeforeChangeCb=function(){r.continueChange=!0}),r}s(t,e),t.prototype.hydrate=function(e){var t=this,r=e&&e.options?e.options:{},n=o({},a.defaults,this.editor.options,r);if(Object.keys(n).some((function(e){return t.editor.getOption(e)!==n[e]}))&&Object.keys(n).forEach((function(e){r.hasOwnProperty(e)&&t.editor.getOption(e)!==n[e]&&t.editor.setOption(e,n[e])})),!this.hydrated){var i=this.editor.getDoc(),s=i.lastLine(),c=i.getLine(i.lastLine()).length;i.replaceRange(e.value||"",{line:0,ch:0},{line:s,ch:c})}this.hydrated=!0},t.prototype.componentDidMount=function(){var e=this;u||(this.detached=!0===this.props.detach,this.props.defineMode&&this.props.defineMode.name&&this.props.defineMode.fn&&a.defineMode(this.props.defineMode.name,this.props.defineMode.fn),this.editor=a(this.ref,this.props.options),this.shared=new p(this.editor,this.props),this.editor.on("beforeChange",(function(t,r){e.props.onBeforeChange&&e.props.onBeforeChange(e.editor,r,e.editor.getValue(),e.onBeforeChangeCb)})),this.editor.on("change",(function(t,r){e.mounted&&e.props.onChange&&(e.props.onBeforeChange?e.continueChange&&e.props.onChange(e.editor,r,e.editor.getValue()):e.props.onChange(e.editor,r,e.editor.getValue()))})),this.hydrate(this.props),this.shared.apply(this.props),this.applied=!0,this.mounted=!0,this.shared.wire(this.props),this.editor.getDoc().clearHistory(),this.props.editorDidMount&&this.props.editorDidMount(this.editor,this.editor.getValue(),this.initCb))},t.prototype.componentDidUpdate=function(e){if(this.detached&&!1===this.props.detach&&(this.detached=!1,e.editorDidAttach&&e.editorDidAttach(this.editor)),this.detached||!0!==this.props.detach||(this.detached=!0,e.editorDidDetach&&e.editorDidDetach(this.editor)),!u&&!this.detached){var t={cursor:null};this.props.value!==e.value&&(this.hydrated=!1,this.applied=!1,this.appliedUserDefined=!1),e.autoCursor||void 0===e.autoCursor||(t.cursor=this.editor.getDoc().getCursor()),this.hydrate(this.props),this.applied||(this.shared.apply(e),this.applied=!0),this.appliedUserDefined||(this.shared.applyUserDefined(e,t),this.appliedUserDefined=!0)}},t.prototype.componentWillUnmount=function(){u||this.props.editorWillUnmount&&this.props.editorWillUnmount(a)},t.prototype.shouldComponentUpdate=function(e,t){var r=!0;return u&&(r=!1),this.detached&&e.detach&&(r=!1),r},t.prototype.render=function(){var e=this;if(u)return null;var t=this.props.className?"react-codemirror2 "+this.props.className:"react-codemirror2";return c.createElement("div",{className:t,ref:function(t){return e.ref=t}})}}(c.Component)},50944:function(e,t,r){r.r(t),r.d(t,{default:function(){return ie}});var o=r(73980),n=r.n(o),i=r(13440),s=r.n(i),a=r(59992),c=r.n(a),u=r(60600),d=r.n(u),p=r(13939),l=r.n(p),f=r(34716),h=r.n(f),g=r(70696),y=r.n(g),m=r(4884),v=r.n(m),C=r(3464),b=r.n(C),k=r(51400),D=r.n(k),E=r(25028),x=r.n(E),O=r(30112),S=r(72048),M=r(67584),w=r.n(M),_=r(24496),R=r.n(_),N=r(33260),U=r.n(N),A=r(94728),j=r.n(A),V=r(760),T=r.n(V),H=(r(86456),r(21300),r(76124),r(87912),r(33768),r(18080),r(90512),r(97308),r(65984)),B=r.n(H),L=r(16428),I=r.n(L),P=r(63548),W=r(18232),F=r(64947),q=(r(31792),r(12848),r(92004),r(80760),r(23360),r(87376),r(60644)),K=r(71252),G=r.n(K),J="wCIb-5q+_code-edit",$="jqjnmfn9_readonly",z="L-uqsBi5_tag_tips",Q=r(5980);function X(e,t){var r=l()(e);if(h()){var o=h()(e);t&&(o=y()(o).call(o,(function(t){return v()(e,t).enumerable}))),r.push.apply(r,o)}return r}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?X(Object(r),!0).forEach((function(t){(0,O.c)(e,t,r[t])})):b()?D()(e,b()(r)):X(Object(r)).forEach((function(t){x()(e,t,v()(r,t))}))}return e}function Z(e,t){var r=void 0!==c()&&d()(e)||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){var r;if(!e)return;if("string"==typeof e)return ee(e,t);var o=n()(r=Object.prototype.toString.call(e)).call(r,8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return s()(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return ee(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,p=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){p=!0,a=e},f:function(){try{u||null==r.return||r.return()}finally{if(p)throw a}}}}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}var te={mode:{name:"custom"},autoCloseBrackets:!0,autofocus:!1,styleActiveLine:!0,lineNumbers:!1,smartIndent:!0,matchBrackets:!0,lineWrapping:!0,singleCursorHeightPerLine:!0,placeholder:"请从左侧选择字段或手动输入文字"},re=(0,H.forwardRef)((function(e,t){var r=e.value,o=e.expressionData,n=e.fieldData,i=e.readOnly,s=e.placeholder,a=e.onClickField,c=e.autofocus,u=(0,H.useState)(""),d=(0,S.c)(u,2),p=d[0],l=d[1],f=(0,H.useReducer)((function(e){return e+1}),0),h=(0,S.c)(f,2)[1],g=(0,H.useRef)(null),y=(0,H.useRef)([]),m=(0,H.useRef)((0,F.getTreeDataFlatten)((0,F.formatFieldTree)((0,q.cloneDeep)(n))));(0,H.useEffect)((function(){var e=(0,F.getTreeDataFlatten)((0,F.formatFieldTree)((0,q.cloneDeep)(n)));if(!(0,q.isEqual)(m.current,e)){m.current=e;var t=g.current.editor;t.doc.getAllMarks().forEach((function(e){return e.clear()})),E(t,{line:0,ch:0})}}),[n]);var v=(0,H.useMemo)((function(){var e,t={},r=Z(o);try{for(r.s();!(e=r.n()).done;){e.value.types.forEach((function(e){t[e.id]=e}))}}catch(e){r.e(e)}finally{r.f()}return t}),[o]),C=(0,H.useCallback)((function(e){var t=g.current.editor;l(e),w()((function(){t.refresh(),t.setCursor(t.lineCount(),0),!i&&t.focus()}),500)}),[g.current,i]);(0,H.useImperativeHandle)(t,(function(){return{insertText:b,forceUpdate:h,setEditorValue:C,getEditorValue:function(){return(0,q.trimStart)(p)},getEditor:function(){return g.current.editor}}})),(0,H.useEffect)((function(){C(r)}),[r]);var b=function(e){var t=g.current.editor,r=t.getCursor();r.line;e=0!==r.ch?" ".concat(e," "):"".concat(e," "),t.replaceRange(e,r),w()((function(){t.refresh(),t.focus(),t.scrollIntoView(null)}),10)},k=(0,H.useCallback)((function(e,t){for(var r=e.getSearchCursor(Q.fieldRegExp,t,{multiline:"disable"}),o=function(){if(0===e.findMarks(r.from(),r.to()).length){var t=r.from(),o=r.to(),n=e.getRange(t,o).match(Q.fieldRegExp),i=(0,S.c)(n,3),s=i[1],a=(i[2],m.current[s]),c=document.createElement("div"),u=a?"tag":"tag_error",d=a?function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];r.unshift([(null==t?void 0:t.titlePrefix)||"",t.title]);var o=m.current[null==t?void 0:t.pKey];return o&&e(o,r),r}(a):null;c.setAttribute("class",u),c.setAttribute("data-id",s),c.setAttribute("data-type","vars"),c.setAttribute("data-text",R()(d)),y.current.push(c),e.markText(t,o,{replacedWith:c})}};r.findNext();)o()}),[p]),D=(0,H.useCallback)((function(e,t){for(var r=e.getSearchCursor(Q.expRegExp,t,{multiline:"disable"});r.findNext();){if(0===e.findMarks(r.from(),r.to()).length){var o=r.from(),n=r.to(),i=e.getRange(o,n).match(Q.expRegExp),s=(0,S.c)(i,4),a=s[1],c=s[2],u=s[3],d=v[a],p="1"===u?d.name||c:d.id||a,l=document.createElement("span"),f=d?"tag":"tag_error";l.setAttribute("class",f),l.setAttribute("class","exp"),l.setAttribute("data-id",a),l.setAttribute("data-text",p),y.current.push(l),e.markText(o,n,{replacedWith:l})}}}),[v]),E=(0,H.useCallback)((function(e,t){k(e,t),D(e,t)}),[k,D]),x=function(e){var t=!1,r=g.current.ref.getElementsByClassName("CodeMirror-code")[0].offsetWidth;y.current.forEach((function(e,o){if(!e.dataset.__react_rendered){var n=e.dataset.id,i=e.dataset.text,s=e.dataset.type;e.dataset.__react_rendered="1";var c="vars"===s?ne:oe;I().render(B().createElement(c,{key:n+o,id:n,text:i,width:r,onClickField:a}),e),t=!0}})),t&&e.refresh()};(0,H.useEffect)((function(){return function(){y.current.forEach((function(e){e.dataset.__react_rendered&&I().unmountComponentAtNode(e)}))}}),[]);var M=Y(Y({},te),{},{readOnly:i,placeholder:s||te.placeholder,autofocus:null==c||c});return B().createElement("div",{className:G()(J,(0,O.c)({},$,i),"kd-nc-code-edit")},B().createElement(W.Mf,{ref:g,value:p,options:M,onBeforeChange:function(e,t,r){if(l(r),Q.expRegExp.test(t.text[0])){var o,n=U()(o=t.text[0]).call(o,"()");w()((function(){return e.setCursor({line:t.from.line,ch:t.from.ch+n+1})}),10)}},onChange:function(e,t,r){var o=Y(Y({},t.from),{},{ch:0});E(e,o)},editorDidMount:function(e){e.setValue(r);var t=w()((function(){clearTimeout(t),e.refresh(),e.setCursor(e.lineCount(),0),!i&&e.focus()}),500)},onUpdate:function(e){x(e)}}))}));function oe(e){var t=e.text,r=e.id,o=e.onClickField;return B().createElement("span",{onClick:function(){return o&&o(r)}},t)}var ne=function(e){var t=e.text,r=e.id,o=e.onClickField,n=e.width,i=JSON.parse(t);if(!i)return null;var s=j()(i).call(i,(function(e,t){return T()(e).call(e,t.join(""))}),[]).join(" > "),a=i.pop(),c=i.length>0?i.pop().join(""):"",u=n/2-16,d=(c?(0,F.getTextWidth)(c,12):0)>u?{flexShrink:1}:{},p=(0,F.getTextWidth)(a,12)>u?{flexShrink:1}:{};return B().createElement(P.Tooltip,{tip:"完整路径：".concat(s),scrollHidden:!0,popperClassName:z,mouseEnterDelay:.3},B().createElement("div",{className:"var_title",onClick:function(){return null==o?void 0:o(r)}},!!c&&B().createElement("div",{style:d,className:"parent_title gray"},B().createElement("span",null,c)),B().createElement("div",{className:"field_title",style:p},B().createElement("span",null,!!a[0]&&B().createElement("span",{className:"gray"},a[0]),B().createElement("span",null,a[1])))))};re.displayName="EditArea";var ie=re}}]);