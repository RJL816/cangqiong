"use strict";(self.webpackChunknocode_component=self.webpackChunknocode_component||[]).push([[2780],{63324:function(e,n,t){var a=t(13939),u=t.n(a),r=t(34716),l=t.n(r),o=t(4884),c=t.n(o),i=t(3464),s=t.n(i),d=t(51400),f=t.n(d),v=t(25028),p=t.n(v),m=t(72048),h=t(81043),b=t(30112),g=(t(21300),t(87912),t(97308),t(50524)),k=t.n(g),C=t(760),w=t.n(C),I=t(94728),y=t.n(I),_=t(52892),M=t.n(_),D=t(23992),T=t.n(D),E=t(73020),R=t.n(E),S=t(70696),x=t.n(S),z=t(38456),O=t.n(z),A=t(35680),N=t.n(A),V=t(65984),j=t(39756),U=t(46276),q=t(14020),F=t(44880),P=t(63616),H=t(24964),G=t(62132);function J(e,n){var t=u()(e);if(l()){var a=l()(e);n&&(a=x()(a).call(a,(function(n){return c()(e,n).enumerable}))),t.push.apply(t,a)}return t}function L(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?J(Object(t),!0).forEach((function(n){(0,b.c)(e,n,t[n])})):s()?f()(e,s()(t)):J(Object(t)).forEach((function(n){p()(e,n,c()(t,n))}))}return e}var W="".concat(window.__domainurl__||"","nocode/v2/nocode_sys/attachment"),Z=function(e){var n,t=k()(e).call(e,"?")?"&":"?",a=window.NOCODE_SHARE_ID?w()(n="".concat(t,"noCodeShareId=")).call(n,window.NOCODE_SHARE_ID):"";return(0,q.oA)(e+a)},B=function(e,n,t){var a=y()(e).call(e,(function(e,n){return e.set(n.uid,L(L({},n),{},{name:t.getControlText(n.name)}))}),new(M()));return{newData:n.length?T()(n).call(n,(function(e){return a.get(e.uid)||e})):(0,h.c)(R()(a).call(a)),mapData:a}};n.c=function(e){var n,t,a,u,r=e.controlMeta,l=e.value,o=e.onChange,c=e.uploadAttachmentVerify,i=e.showInfo,s=e.invokeData,d=e.rowIndex,f=void 0===d?-1:d,v=(0,V.useContext)(j.m).model,p=(0,U.s)(r),b=p.readonly,g=p.disabled,C=p.hidden,I=p.required,y=p.rules,_=(0,V.useState)(B(l||[],[],v).newData),D=(0,m.c)(_,2),E=D[0],S=D[1],z=r.pageId,A=r.id,J=r.uploadNum,K=r.fileMaxSize,Q=r.uploadModel,X=r.attachmentFileType,Y=void 0===X?"":X,$=r.displayCount,ee=r.uploadPrompt,ne=r.buttonText,te=(0,V.useRef)(null),ae=(0,V.useRef)(B(l||[],[],v).mapData),ue=(0,V.useCallback)((function(e){var n=[];e.forEach((function(e){!(0,F.WO)(e,Y)||(0,F.UZ)(e,K)||(0,F.IT)(e)||n.push({uid:e.uid,name:e.name,size:e.size,type:e.type})})),v.batchInvoke("beforeUpload",z,A,[n],[])}),[z,A]),re=(0,V.useCallback)((function(e){v.batchInvoke("updateValue",z,"",[],[{},[{k:A,r:f,v:e}]])}),[f,z,A]),le=(0,G.c)(re),oe=(0,V.useCallback)((function(e,n){var t=c(e,n,r);return t&&ue(n),t}),[ue,c]),ce=(0,V.useCallback)((function(e){var n=e.file,t=e.fileList,a=I&&0===t.length?"值不能为空":"";te.current.setValidateMessage(a);var u=x()(t).call(t,(function(e){return"notStart"!==e.status}));if("done"===n.status&&n.response.status){var r=L({lastModified:n.lastModified,uid:n.uid,name:n.name,type:n.type,size:n.size},{status:"success",url:n.response.data.url,uploadTime:Date.now()});ae.current.set(n.uid,r);var l,c,s=x()(u).call(u,(function(e){return"uploading"===e.status}));if(ae.current.size,u.length,s.length,0===s.length)if(o)o((0,h.c)(R()(l=ae.current).call(l)));else le((0,h.c)(R()(c=ae.current).call(c)))}else"error"!==n.status&&("done"!==n.status||null!=n&&n.response.status)||(i("".concat(n.name,"上传失败，请重新上传")),v.batchInvoke("uploadResult",z,A,[[{uid:n.uid,description:"禁止上传非法文件。",status:"error"}]],[{},[]]));S(u)}),[o,I,z,A,le,i]),ie=(0,V.useCallback)((function(e){var n,t=v.getConfig(z),a=ae.current.get(e.uid),u={params:"1",appId:t.appId,fId:t.formId,fileName:a.name},r=w()(n="".concat(Z(a.url),"&kd_cs_ticket=")).call(n,v.Global.token);(0,q.gr)(r,u)}),[z]),se=(0,V.useCallback)((function(e){if(null==E||!E.length)return!1;var n=x()(E).call(E,(function(n){return n.uid!==e.uid}));return I&&!n.length&&te.current.setValidateMessage("值不能为空"),v.batchInvoke("beforeRemove",z,A,[{uid:e.uid}],[]),S(n),!0}),[E,o,z,A,I]),de=(0,V.useCallback)((function(e){var n=O()(E).call(E,(function(n){return n.uid===e.uid}));if(n.name=e.name,"success"===n.status){var t,a=ae.current.get(e.uid);if(a.name=e.name,ae.current.set(e.uid,a),v.batchInvoke("rename",z,A,[e.uid,e.name,f],[{},[]]),o)o((0,h.c)(R()(t=ae.current).call(t)))}S((0,h.c)(E))}),[E,o,f,z,A]),fe=(0,V.useCallback)((function(e){var n;if(!Array.isArray(e.v)||Array.isArray(e.v)&&(null==e||null===(n=e.v)||void 0===n||!n.length))return ae.current=new(M()),void S([]);S((function(n){var t=B(e.v,n,v),a=t.newData,u=t.mapData;return ae.current=u,a}))}),[S]);(0,V.useEffect)((function(){l&&fe({k:A,v:l})}),[l]);var ve=(0,V.useCallback)((function(e){var n=(null==e?void 0:e[0])||{},t=n.args;if("beforeRemove"===n.methodname)if(t[0].canRemove){var a=[];ae.current.forEach((function(e,n){var u=e.lastModified,r=e.name,l=e.size,o=e.status,c=e.type,i=e.uid,s=e.url,d=e.uploadTime;n===t[0].uid?a.push({lastModified:u,name:r,size:l,status:o,type:c,uid:i,url:s,uploadTime:d,delete:!0}):a.push({lastModified:u,name:r,size:l,status:o,type:c,uid:i,url:s,uploadTime:d})})),le(a),ae.current.delete(t[0].uid)}}),[le]);(0,V.useEffect)((function(){s&&ve(s)}),[s]),v.useUpdateControlStates(r,fe),v.useInvokeControlMethod(r,ve);var pe=ee?w()(n=w()(t=w()(a="请上传小于".concat(K,"M的")).call(a,null==Y?void 0:N()(Y).call(Y,".",""),"文件，文件个数不少于")).call(t,(null==J?void 0:J.min)||0,"个，不多于")).call(n,(null==J?void 0:J.max)||1,"个"):"",me=!$||b||g?"":w()(u="(".concat(ae.current.size,"/")).call(u,(null==J?void 0:J.max)||1,")"),he=(0,V.useMemo)((function(){var e=v.getConfig(z),n=e.appId,t=e.formId;return null!=E&&E.length?T()(E).call(E,(function(e){return e.previewurl=(0,P.qo)({url:e.previewurl,pageId:z,appId:n,formId:t,ticket:v.Global.token,needShareId:!k()(H.kJ).call(H.kJ,e.type)}),e})):[]}),[E,z]),be=(0,V.useMemo)((function(){var e;return(((null==v||null===(e=v.getConfig)||void 0===e?void 0:e.call(v))||{}).attPreview||{}).previewType||"0"}),[]);return{action:Z(W),handledDatas:he,disabled:g,readonly:b,buttonText:ne,uploadModel:Q,handleChange:ce,onDownload:ie,onChangeFileName:de,beforeUpload:oe,handleRemove:se,attachmentFileType:Y,uploadNum:J,notice:pe,previewType:be,labelText:me,required:I,hidden:C,fieldRef:te,datas:E,rules:y}}},60807:function(e,n,t){var a,u=t(13939),r=t.n(u),l=t(34716),o=t.n(l),c=t(4884),i=t.n(c),s=t(3464),d=t.n(s),f=t(51400),v=t.n(f),p=t(25028),m=t.n(p),h=t(81043),b=t(30112),g=t(72048),k=(t(86456),t(21300),t(76124),t(87912),t(97308),t(760)),C=t.n(k),w=t(73980),I=t.n(w),y=t(52892),_=t.n(y),M=t(23992),D=t.n(M),T=t(70696),E=t.n(T),R=t(24244),S=t.n(R),x=t(24496),z=t.n(x),O=t(73020),A=t.n(O),N=t(65984),V=t(46276),j=t(39756),U=t(14020);function q(e,n){var t=r()(e);if(o()){var a=o()(e);n&&(a=E()(a).call(a,(function(n){return i()(e,n).enumerable}))),t.push.apply(t,a)}return t}function F(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?q(Object(t),!0).forEach((function(n){(0,b.c)(e,n,t[n])})):d()?v()(e,d()(t)):q(Object(t)).forEach((function(n){m()(e,n,i()(t,n))}))}return e}var P=window.NOCODE_SHARE_ID?"?noCodeShareId=".concat(window.NOCODE_SHARE_ID):"",H=(0,U.oA)(C()(a="".concat(window.__domainurl__||"","nocode/v2/nocode_sys/image")).call(a,P)),G=function(e,n){var t=e+("/"===n[0]?I()(n).call(n,1):n)+P;return(0,U.oA)(t)};n.c=function(e){var n,t=e.controlMeta,a=e.value,u=e.onChange,r=(0,N.useContext)(j.m).model,l=(0,V.s)(t),o=l.readonly,c=l.disabled,i=l.hidden,s=l.required,d=l.rules,f=t.pageId,v=t.id,p=t.pictureDefValue,m=t.imageFileType,b=t.fileMaxSize,k=t.uploadNum,w=t.ops,I=t.enablePreview,y=t.buttonText,M=t.displayCount,T=t.uploadPrompt,R=(0,N.useRef)(new(_())),x=(0,N.useRef)(null),O=(0,N.useRef)(r.getFileServer("picture")),q=(0,N.useState)(),J=(0,g.c)(q,2),L=J[0],W=J[1],Z=(0,N.useCallback)((function(e){var n=e||[];try{n="string"==typeof n?JSON.parse(n):n}catch(e){n=[]}return D()(n).call(n,(function(e){R.current.set(e.uid,F({},e));var n=G(O.current,e.url);return F(F({},e),{},{url:n})}))}),[]);(0,N.useEffect)((function(){W(Z(p))}),[p]);var B=(0,N.useCallback)((function(e){var n=e.file,a=e.fileList,l=t.mi&&0===a.length?"值不能为空":"";x.current.setValidateMessage(l);var o=E()(a).call(a,(function(e){return"notStart"!==e.status}));if("done"===n.status&&n.response.status){var c,i,s=n.uid,d=n.name,p=n.size,m={url:n.response.data.url,status:"success",uploadTime:Date.now()};R.current.set(n.uid,F({uid:s,name:d,size:p},m)),R.current=new(_())(S()(c=(0,h.c)(R.current)).call(c,(function(e,n){return e[0].localeCompare(n[0])})));var b=z()((0,h.c)(A()(i=R.current).call(i)));if(u)u(b);else{var g={k:v,r:0,v:b};0===E()(o).call(o,(function(e){return"uploading"===e.status})).length&&r.batchInvoke("updateValue",f,"",[],[{},[g]])}o=D()(o).call(o,(function(e){return e.uid===s&&(e.status="success"),e}))}W((0,h.c)(o))}),[]),K=(0,N.useCallback)((function(e){var n,t,a=r.getConfig(f),u=R.current.get(e.uid),l={params:"1",appId:a.appId,fId:a.formId,fileName:u.name},o=C()(n=C()(t="".concat(G(O.current,u.url))).call(t,P?"&":"?","kd_cs_ticket=")).call(n,r.Global.token);(0,U.gr)(o,l)}),[]),Q=(0,N.useCallback)((function(e){var n=(null==L?void 0:E()(L).call(L,(function(n){return n.uid!==e.uid})))||[],t=R.current.get(e.uid);if(W((0,h.c)(n)),t){var a;R.current.delete(e.uid);var l=R.current.size>0?z()((0,h.c)(A()(a=R.current).call(a))):"";if(u)return u(l);var o={k:v,r:0,v:l};r.batchInvoke("updateValue",f,"",[],[{},[o]])}return!0}),[L]),X=(0,N.useCallback)((function(e){e.v?W(Z(e.v)):(R.current=new(_()),W([]))}),[]);r.useUpdateControlStates(t,X),(0,N.useEffect)((function(){X({k:v,v:a})}),[a]);var Y=k||{},$=(0,N.useMemo)((function(){var e;return D()(e=m.split(",")).call(e,(function(e){return w[e]}))}),[m]),ee=(0,N.useMemo)((function(){return D()($).call($,(function(e){return"."+e})).join(",")}),[$]),ne=(0,N.useMemo)((function(){var e,n,t;return T?C()(e=C()(n=C()(t="请上传小于".concat(b,"M的")).call(t,$.join("、"),"文件，文件个数不少于")).call(n,(null==Y?void 0:Y.min)||0,"个，不多于")).call(e,(null==Y?void 0:Y.max)||1,"个。"):""}),[T,b,$,Y]),te=!M||o||c?"":C()(n="(".concat(R.current.size,"/")).call(n,(null==k?void 0:k.max)||1,")");return{action:H,notice:ne,labelText:te,datas:L||[],readonly:o,disabled:c,hidden:i,required:s,rules:d,enablePreview:I,buttonText:y,fieldTitleRef:x,baseUrl:O.current||"",limit:Y,accept:ee,onRemove:Q,handleChange:B,onDownload:K}}}}]);